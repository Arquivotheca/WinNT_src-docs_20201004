<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: multimon.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>multimon.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d2/d4/multimon_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/multimon_8c.html#a1">ClipPointToDesktop</a> (LPPOINT lppt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/multimon_8c.html#a2">xxxEnumDisplayMonitors</a> (HDC hdcPaint, LPRECT lprcPaint, MONITORENUMPROC lpfnEnum, LPARAM lData, BOOL fInternal)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/multimon_8c.html#a3">DestroyMonitor</a> (<a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="multimon.c::ClipPointToDesktop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ClipPointToDesktop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPPOINT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lppt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/multimon_8c-source.html#l00033">33</a> of file <a class="el" href="../../d2/d4/multimon_8c-source.html">multimon.c</a>.
<p>
References <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00056">_MonitorFromPoint()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02211">tagDISPLAYINFO::fDesktopIsRect</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d4/multimon_8c-source.html#l00017">gpMonitorMouse</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00118">PtInRect()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00299">BoundCursor()</a>.
<p>
<pre class="fragment"><div>00034 {
00035     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>        pMonitor;
00036 
00037     UserAssert(!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o18">fDesktopIsRect</a> &amp;&amp;
00038                <span class="stringliteral">"You shouldn't call this function if the desktop is a rectangle.\n"</span>
00039                <span class="stringliteral">"Just clip to gpsi-&gt;rcScreen instead."</span>);
00040 
00041     <span class="comment">/*</span>
00042 <span class="comment">     * Optimization: The cursor is likely to be on the monitor it was last on,</span>
00043 <span class="comment">     * so check for that case.</span>
00044 <span class="comment">     */</span>
00045     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;<a class="code" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a>-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>, *lppt)) {
00046         <span class="keywordflow">return</span>;
00047     }
00048 
00049     pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a6">_MonitorFromPoint</a>(*lppt, MONITOR_DEFAULTTONEAREST);
00050 
00051     <span class="comment">/*</span>
00052 <span class="comment">     * Remember the monitor the cursor is on.</span>
00053 <span class="comment">     */</span>
00054     <a class="code" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a> = pMonitor;
00055 
00056     <span class="keywordflow">if</span> (lppt-&gt;x &lt; pMonitor-&gt;rcMonitor.left) {
00057         lppt-&gt;x = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left;
00058     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lppt-&gt;x &gt;= pMonitor-&gt;rcMonitor.right) {
00059         lppt-&gt;x = pMonitor-&gt;rcMonitor.right-1;
00060     }
00061     <span class="keywordflow">if</span> (lppt-&gt;y &lt; pMonitor-&gt;rcMonitor.top) {
00062         lppt-&gt;y = pMonitor-&gt;rcMonitor.top;
00063     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lppt-&gt;y &gt;= pMonitor-&gt;rcMonitor.bottom) {
00064         lppt-&gt;y = pMonitor-&gt;rcMonitor.bottom-1;
00065     }
00066 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="multimon.c::DestroyMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void DestroyMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMonitor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/multimon_8c-source.html#l00249">249</a> of file <a class="el" href="../../d2/d4/multimon_8c-source.html">multimon.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d4/multimon_8c-source.html#l00017">gpMonitorMouse</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01069">HMFreeObject()</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01237">HMMarkObjectDestroy()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02071">tagMONITOR::hrgnMonitor</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02203">tagDISPLAYINFO::pMonitorFirst</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02202">tagDISPLAYINFO::pMonitorPrimary</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l07370">REMOVE_FROM_LIST</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00565">CleanupGDI()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>.
<p>
<pre class="fragment"><div>00250 {
00251     UserAssert(pMonitor);
00252 
00253     <span class="comment">/*</span>
00254 <span class="comment">     * Remove references to this monitor from the global data.</span>
00255 <span class="comment">     */</span>
00256     <span class="keywordflow">if</span> (pMonitor == <a class="code" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a>) {
00257         <a class="code" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00258     }
00259 
00260     <span class="comment">/*</span>
00261 <span class="comment">     * Remove from the monitor list.</span>
00262 <span class="comment">     */</span>
00263     <a class="code" href="../../d4/d1/userk_8h.html#a752">REMOVE_FROM_LIST</a>(<a class="code" href="../../d0/d2/structtagMONITOR.html">MONITOR</a>, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>, pMonitor, pMonitorNext);
00264 
00265     <span class="comment">/*</span>
00266 <span class="comment">     * Make sure the primary monitor points to a valid monitor. During the</span>
00267 <span class="comment">     * mode changes the primary monitor will be recalculated as appropriate.</span>
00268 <span class="comment">     */</span>
00269     <span class="keywordflow">if</span> (pMonitor == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a>) {
00270         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>;
00271     }
00272 
00273     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a971">HMMarkObjectDestroy</a>(pMonitor)) {
00274 
00275         <span class="keywordflow">if</span> (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>) {
00276            GreDeleteObject(pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>);
00277         }
00278     
00279         <a class="code" href="../../d4/d1/userk_8h.html#a970">HMFreeObject</a>(pMonitor);
00280     }
00281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="multimon.c::xxxEnumDisplayMonitors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxEnumDisplayMonitors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcPaint</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprcPaint</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>MONITORENUMPROC&nbsp;</td>
          <td class="mdname" nowrap> <em>lpfnEnum</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fInternal</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/multimon_8c-source.html#l00099">99</a> of file <a class="el" href="../../d2/d4/multimon_8c-source.html">multimon.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l02151">GetMonitorDC()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00191">IntersectRect()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l02123">LookupDC()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00139">OffsetRect()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02203">tagDISPLAYINFO::pMonitorFirst</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02067">tagMONITOR::pMonitorNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03587">tagDCE::pwndOrg</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01337">ReleaseCacheDC()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a2077">xxxClientMonitorEnumProc()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l13138">NtUserEnumDisplayMonitors()</a>, and <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01615">xxxInternalPaintDesktop()</a>.
<p>
<pre class="fragment"><div>00105 {
00106     RECT            rcPaint;
00107     POINT           ptOrg;
00108     RECT            rcMonitorPaint;
00109     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            fReturn;
00110     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>        pMonitor;
00111     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>              tlpMonitor;
00112     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00113     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a>            pdcePaint;
00114     HDC             hdcMonitor;
00115     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>            pwndOrg;
00116 
00117     <span class="comment">/*</span>
00118 <span class="comment">     * Validate the DC passed in.</span>
00119 <span class="comment">     */</span>
00120     <span class="keywordflow">if</span> (hdcPaint) {
00121 
00122         <span class="keywordflow">if</span> ((pdcePaint = <a class="code" href="../../d4/d1/userk_8h.html#a1706">LookupDC</a>(hdcPaint)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00123             RIPMSG0(RIP_WARNING, <span class="stringliteral">"EnumDisplayMonitors: LookupDC failed"</span>);
00124             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00125         }
00126 
00127         pwndOrg = pdcePaint-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a>;
00128 
00129         <span class="comment">/*</span>
00130 <span class="comment">         * Intersect the painting area with the clipbox.  If there</span>
00131 <span class="comment">         * isn't anything, bail out now.</span>
00132 <span class="comment">         */</span>
00133         <span class="keywordflow">if</span> (GreGetClipBox(hdcPaint, &amp;rcPaint, FALSE) == NULLREGION)
00134             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00135 
00136         <span class="keywordflow">if</span> (lprcPaint &amp;&amp; !<a class="code" href="../../d3/d6/rect_8c.html#a8">IntersectRect</a>(&amp;rcPaint, &amp;rcPaint, lprcPaint))
00137             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00138 
00139         <span class="comment">/*</span>
00140 <span class="comment">         * rcPaint is in dc coordinates.  We must convert to screen</span>
00141 <span class="comment">         * coords so we can intersect with monitors.</span>
00142 <span class="comment">         */</span>
00143         GreGetDCOrg(hdcPaint, &amp;ptOrg);
00144         <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(&amp;rcPaint, ptOrg.x, ptOrg.y);
00145     } <span class="keywordflow">else</span> {
00146         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rcPaint, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>);
00147         <span class="keywordflow">if</span> (lprcPaint &amp;&amp; !<a class="code" href="../../d3/d6/rect_8c.html#a8">IntersectRect</a>(&amp;rcPaint, &amp;rcPaint, lprcPaint))
00148             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00149     }
00150 
00151     fReturn = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00152 
00153     <span class="keywordflow">for</span> (pMonitor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>; pMonitor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00154                 pMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>) {
00155 
00156         <span class="comment">/*</span>
00157 <span class="comment">         * Note: the check for MONF_VISIBLE was removed to allow mirror drivers</span>
00158 <span class="comment">         * to see monitor specific updates.</span>
00159 <span class="comment">         */</span>
00160         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a8">IntersectRect</a>(&amp;rcMonitorPaint, &amp;rcPaint, &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>)) {
00161             <span class="keywordflow">continue</span>;
00162         }
00163 
00164         <span class="keywordflow">if</span> (hdcPaint) {
00165 
00166             <span class="keywordflow">if</span> ((hdcMonitor = <a class="code" href="../../d4/d1/userk_8h.html#a1707">GetMonitorDC</a>(pdcePaint, pMonitor)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00167                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"EnumDisplayMonitors: GetMonitorDC failed"</span>);
00168                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00169             }
00170 
00171             <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(&amp;rcMonitorPaint, -ptOrg.x, -ptOrg.y);
00172             GreIntersectClipRect(
00173                     hdcMonitor,
00174                     rcMonitorPaint.left,
00175                     rcMonitorPaint.top,
00176                     rcMonitorPaint.right,
00177                     rcMonitorPaint.bottom);
00178         } <span class="keywordflow">else</span> {
00179 
00180             hdcMonitor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00181         }
00182 
00183         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(ptiCurrent, pMonitor, &amp;tlpMonitor);
00184 
00185         <span class="keywordflow">if</span> (fInternal) {
00186             fReturn = (*lpfnEnum) (
00187                     (HMONITOR) pMonitor,
00188                     hdcMonitor,
00189                     &amp;rcMonitorPaint,
00190                     lData);
00191 
00192         } <span class="keywordflow">else</span> {
00193             fReturn = <a class="code" href="../../d4/d1/userk_8h.html#a2077">xxxClientMonitorEnumProc</a>(
00194                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pMonitor),
00195                     hdcMonitor,
00196                     &amp;rcMonitorPaint,
00197                     lData,
00198                     lpfnEnum);
00199         }
00200 
00201         <span class="comment">/*</span>
00202 <span class="comment">         * We just called back and the monitor has been freed if</span>
00203 <span class="comment">         * ThreadUnlock returns NULL. The entire monitor configuration may</span>
00204 <span class="comment">         * have changed, the monitors may have been rearranged, so just stop</span>
00205 <span class="comment">         * enumerating at this point.</span>
00206 <span class="comment">         */</span>
00207         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpMonitor) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00208             fReturn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00209         }
00210 
00211         <span class="keywordflow">if</span> (hdcMonitor)
00212             <a class="code" href="../../d4/d1/userk_8h.html#a1698">ReleaseCacheDC</a>(hdcMonitor, FALSE);
00213 
00214         <span class="keywordflow">if</span> (!fReturn)
00215             <span class="keywordflow">break</span>;
00216 
00217         <span class="comment">/*</span>
00218 <span class="comment">         * Revalidate hdcPaint, since it could have been messed with</span>
00219 <span class="comment">         * in the callback.</span>
00220 <span class="comment">         */</span>
00221         <span class="keywordflow">if</span> (hdcPaint) {
00222             <span class="keywordflow">if</span> ((pdcePaint = <a class="code" href="../../d4/d1/userk_8h.html#a1706">LookupDC</a>(hdcPaint)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00223                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"EnumDisplayMonitors: LookupDC failed"</span>);
00224                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00225             }
00226 
00227             <span class="keywordflow">if</span> (pdcePaint-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a> != pwndOrg) {
00228                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"EnumDisplayMonitors: wrong window"</span>);
00229                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00230             }
00231         }
00232     }
00233 
00234     <span class="keywordflow">return</span> fReturn;
00235 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="multimon.c::gpMonitorMouse" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> <a class="el" href="../../d1/d5/multimon_8c.html#a0">gpMonitorMouse</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/multimon_8c-source.html#l00017">17</a> of file <a class="el" href="../../d2/d4/multimon_8c-source.html">multimon.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/multimon_8c-source.html#l00033">ClipPointToDesktop()</a>, and <a class="el" href="../../d2/d4/multimon_8c-source.html#l00249">DestroyMonitor()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
