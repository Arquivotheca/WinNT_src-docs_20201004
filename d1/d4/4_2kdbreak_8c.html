<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: 4/kdbreak.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdbreak.c File Reference</h1><code>#include "<a class="el" href="../../d2/d6/4_2kdp_8h-source.html">kdp.h</a>"</code><br>

<p>
<a href="../../d2/d3/4_2kdbreak_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a0">KdSetOwedBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a1">KdpLowWriteContent</a> (ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a2">KdpLowRestoreBreakpoint</a> (ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a3">KdpAddBreakpoint</a> (IN PVOID Address)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a4">KdpLowWriteContent</a> (IN ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a5">KdpDeleteBreakpoint</a> (IN ULONG <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a6">KdpDeleteBreakpointRange</a> (IN PVOID Lower, IN PVOID Upper)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a7">KdpSuspendBreakpoint</a> (ULONG <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a8">KdpSuspendAllBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a9">KdpLowRestoreBreakpoint</a> (IN ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a10">KdpRestoreAllBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d4/4_2kdbreak_8c.html#a11">KdDeleteAllBreakpoints</a> (VOID)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="4/kdbreak.c::KdDeleteAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdDeleteAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l01349">1349</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00248">BreakpointsSuspended</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>, and <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>.
<p>
<pre class="fragment"><div>01352 {
01353     ULONG <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01354 
01355     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> || <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01356         <span class="keywordflow">return</span>;
01357     }
01358 
01359     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01360 
01361     <span class="keywordflow">for</span> ( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = 1; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &lt;= BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>++ ) {
01362         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(Handle);
01363     }
01364 
01365     <span class="keywordflow">return</span>;
01366 } <span class="comment">// KdDeleteAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="4/kdbreak.c::KdpAddBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KdpAddBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Address</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00060">60</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00174">_BREAKPOINT_ENTRY::Content</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00172">_BREAKPOINT_ENTRY::DirectoryTableBase</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00042">GLOBAL_BREAKPOINT_LIMIT</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00056">KD_BREAKPOINT_IA64_MOVL</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00048">KD_BREAKPOINT_IN_USE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00049">KD_BREAKPOINT_NEEDS_WRITE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00053">KD_BREAKPOINT_STATE_MASK</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00079">KDP_BREAKPOINT_ALIGN</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00076">KDP_BREAKPOINT_TYPE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d3/d5/ia64_2debugsup_8c-source.html#l00174">MmDbgReleaseAddress()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00078">MmDbgWriteCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01580">KdpWriteBreakpoint()</a>, and <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03035">KdpWriteBreakPointEx()</a>.
<p>
<pre class="fragment"><div>00066                    :
00067 
00068     This routine adds an entry to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table and returns a handle
00069     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry.
00070 
00071 Arguments:
00072 
00073     Address - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address where to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint.
00074 
00075 Return Value:
00076 
00077     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00078     breakpoint table, there are no free entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00079     specified address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not correctly aligned, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00080     not valid. Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> assigned breakpoint table entry
00081     plus one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00082 
00083 --*/
00084 
00085 {
00086 
00087     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> Content;
00088     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00089     HARDWARE_PTE Opaque;
00090     PVOID AccessAddress;
00091 
00092     <span class="comment">//DPRINT(("KD: Setting breakpoint at 0x%08x\n", Address));</span>
00093 
00094     <span class="comment">//</span>
00095     <span class="comment">// If the specified address is not properly aligned, then return zero.</span>
00096     <span class="comment">//</span>
00097 
00098     <span class="keywordflow">if</span> (((ULONG_PTR)Address &amp; <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a5">KDP_BREAKPOINT_ALIGN</a>) != 0) {
00099         <span class="keywordflow">return</span> 0;
00100     }
00101 
00102 
00103     <span class="comment">//</span>
00104     <span class="comment">// Don't allow setting the same breakpoint twice.</span>
00105     <span class="comment">//</span>
00106 
00107     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00108         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) != 0 &amp;&amp;
00109             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> == Address) {
00110 
00111             <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) != 0) {
00112 
00113                 <span class="comment">//</span>
00114                 <span class="comment">// Breakpoint was set, the page was written out and was not</span>
00115                 <span class="comment">// accessible when the breakpoint was cleared.  Now the breakpoint</span>
00116                 <span class="comment">// is being set again.  Just clear the defer flag:</span>
00117                 <span class="comment">//</span>
00118                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00119                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> + 1;
00120 
00121             } <span class="keywordflow">else</span> {
00122 
00123                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: Attempt to set breakpoint %08x twice!\n"</span>, Address));
00124                 <span class="keywordflow">return</span> 0;
00125 
00126             }
00127         }
00128     }
00129 
00130     <span class="comment">//</span>
00131     <span class="comment">// Search the breakpoint table for a free entry.</span>
00132     <span class="comment">//</span>
00133 
00134     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00135         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> == 0) {
00136             <span class="keywordflow">break</span>;
00137         }
00138     }
00139 
00140     <span class="comment">//</span>
00141     <span class="comment">// If a free entry was found, then write breakpoint and return the handle</span>
00142     <span class="comment">// value plus one. Otherwise, return zero.</span>
00143     <span class="comment">//</span>
00144 
00145     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == BREAKPOINT_TABLE_SIZE) {
00146         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: ran out of breakpoints!\n"</span>));
00147         <span class="keywordflow">return</span> 0;
00148     }
00149 
00150 
00151     <span class="comment">//DPRINT(("KD: using Index %d\n", Index));</span>
00152 
00153     <span class="comment">//</span>
00154     <span class="comment">// Get the instruction to be replaced. If the instruction cannot be read,</span>
00155     <span class="comment">// then mark breakpoint as not accessible.</span>
00156     <span class="comment">//</span>
00157 
00158     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00159             (PCHAR)&amp;Content,
00160             (PCHAR)Address,
00161             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE) ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00162         AccessAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00163         <span class="comment">//DPRINT(("KD: memory inaccessible\n"));</span>
00164     } <span class="keywordflow">else</span> {
00165         <span class="comment">//DPRINT(("KD: memory readable...\n"));</span>
00166 
00167         <span class="comment">//</span>
00168         <span class="comment">// If the specified address is not write accessible, then return zero.</span>
00169         <span class="comment">// All references must be made through AccessAddress.</span>
00170         <span class="comment">//</span>
00171 
00172         AccessAddress = <a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>((PVOID)Address, &amp;Opaque);
00173         <span class="keywordflow">if</span> (AccessAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00174             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: memory not writable!\n"</span>));
00175             <span class="keywordflow">return</span> 0;
00176         }
00177     }
00178 
00179 <span class="preprocessor">#if defined(_IA64_)</span>
00180 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( AccessAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00181         <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
00182         PVOID BundleAddress;
00183 
00184         <span class="comment">// change template to type 0 if current instruction is MLI</span>
00185 
00186         <span class="comment">// read in intruction template if current instruction is NOT slot 0.</span>
00187         <span class="comment">// check for two-slot MOVL instruction. Reject request if attempt to</span>
00188         <span class="comment">// set break in slot 2 of MLI template.</span>
00189 
00190         <span class="keywordflow">if</span> (((ULONG_PTR)Address &amp; 0xf) != 0) {
00191             (ULONG_PTR)BundleAddress = (ULONG_PTR)AccessAddress &amp; ~(0xf);
00192             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00193                     (PCHAR)&amp;mBuf,
00194                     (PCHAR)BundleAddress,
00195                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00196                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00197                 <span class="comment">//DPRINT(("KD: read 0x%08x template failed\n", BundleAddress));</span>
00198                 <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00199                 <span class="keywordflow">return</span> 0;
00200             } <span class="keywordflow">else</span> {
00201                 <span class="keywordflow">if</span> (((mBuf &amp; INST_TEMPL_MASK) &gt;&gt; 1) == 0x2) {
00202                     <span class="keywordflow">if</span> (((ULONG_PTR)Address &amp; 0xf) == 4) {
00203                         <span class="comment">// if template= type 2 MLI, change to type 0</span>
00204                         mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1);
00205                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>;
00206                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00207                                 (PCHAR)BundleAddress,
00208                                 (PCHAR)&amp;mBuf,
00209                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00210                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00211                             <span class="comment">//DPRINT(("KD: write to 0x%08x template failed\n", BundleAddress));</span>
00212                             <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00213                             <span class="keywordflow">return</span> 0;
00214                          }
00215                          <span class="keywordflow">else</span> {
00216                              <span class="comment">//DPRINT(("KD: change MLI template to type 0 at 0x%08x set\n", Address));</span>
00217                          }
00218                     } <span class="keywordflow">else</span> {
00219                          <span class="comment">// set breakpoint at slot 2 of MOVL is illegal</span>
00220                          <span class="comment">//DPRINT(("KD: illegal to set BP at slot 2 of MOVL at 0x%08x\n", BundleAddress));</span>
00221                          <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00222                          <span class="keywordflow">return</span> 0;
00223                     }
00224                 }
00225             }
00226         }
00227 
00228         <span class="comment">// insert break instruction</span>
00229 
00230         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00231         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> = Content;
00232         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~(<a class="code" href="../../d0/d7/kdp_8h.html#a5">KD_BREAKPOINT_STATE_MASK</a>);
00233         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00234         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00235             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00236                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00237             }
00238             <span class="keywordflow">switch</span> ((ULONG_PTR)Address &amp; 0xf) {
00239             <span class="keywordflow">case</span> 0:
00240                 Content = (Content &amp; ~(INST_SLOT0_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 5);
00241                 <span class="keywordflow">break</span>;
00242 
00243             <span class="keywordflow">case</span> 4:
00244                 Content = (Content &amp; ~(INST_SLOT1_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 14);
00245                 <span class="keywordflow">break</span>;
00246 
00247             <span class="keywordflow">case</span> 8:
00248                 Content = (Content &amp; ~(INST_SLOT2_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 23);
00249                 <span class="keywordflow">break</span>;
00250 
00251             <span class="keywordflow">default</span>:
00252                 <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00253                 <span class="comment">//DPRINT(("KD: KdpAddBreakpoint bad instruction slot#\n"));</span>
00254                 <span class="keywordflow">return</span> 0;
00255             }
00256             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00257                     (PCHAR)AccessAddress,
00258                     (PCHAR)&amp;Content,
00259                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00260                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00261 
00262                 <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00263                 <span class="comment">//DPRINT(("KD: KdpMoveMemory failed writing BP!\n"));</span>
00264                 <span class="keywordflow">return</span> 0;
00265             }
00266             <span class="keywordflow">else</span> {
00267                 <span class="comment">//DPRINT(("KD: breakpoint at 0x%08x set\n", Address));</span>
00268             }
00269         <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00270 
00271     } <span class="keywordflow">else</span> {  <span class="comment">// memory not accessible</span>
00272         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00273         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~(<a class="code" href="../../d0/d7/kdp_8h.html#a5">KD_BREAKPOINT_STATE_MASK</a>);
00274         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00275         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
00276         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00277         <span class="comment">//DPRINT(("KD: breakpoint write deferred\n"));</span>
00278         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00279             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00280                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00281         }
00282     }
00283 <span class="preprocessor">#else</span>
00284 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( AccessAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00285         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00286         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> = Content;
00287         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00288         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00289             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00290                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00291         }
00292         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00293                 (PCHAR)AccessAddress,
00294                 (PCHAR)&amp;KdpBreakpointInstruction,
00295                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00296                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00297 
00298             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: KdpMoveMemory failed writing BP!\n"</span>));
00299         }
00300         <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(AccessAddress, &amp;Opaque);
00301     } <span class="keywordflow">else</span> {
00302         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00303         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a> | <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
00304         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305         <span class="comment">//DPRINT(("KD: breakpoint write deferred\n"));</span>
00306         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00307             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00308                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00309         }
00310     }
00311 <span class="preprocessor">#endif  // IA64</span>
00312 <span class="preprocessor"></span>
00313     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> + 1;
00314 
00315 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="4/kdbreak.c::KdpDeleteBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpDeleteBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00843">843</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00050">KD_BREAKPOINT_SUSPENDED</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00654">KdpLowWriteContent()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01332">KdDeleteAllBreakpoints()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00902">KdpDeleteBreakpointRange()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01632">KdpRestoreBreakpoint()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03157">KdpRestoreBreakPointEx()</a>, and <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03035">KdpWriteBreakPointEx()</a>.
<p>
<pre class="fragment"><div>00849                    :
00850 
00851     This routine deletes an entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table.
00852 
00853 Arguments:
00854 
00855     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index plus one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry
00856         which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be deleted.
00857 
00858 Return Value:
00859 
00860     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a valid
00861     value or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint cannot be deleted because <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old instruction
00862     cannot be replaced. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00863 
00864 --*/
00865 
00866 {
00867     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - 1;
00868 
00869     <span class="comment">//</span>
00870     <span class="comment">// If the specified handle is not valid, then return FALSE.</span>
00871     <span class="comment">//</span>
00872 
00873     <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> == 0) || (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &gt; BREAKPOINT_TABLE_SIZE)) {
00874         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: Breakpoint %d invalid.\n"</span>, Index));
00875         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00876     }
00877 
00878     <span class="comment">//</span>
00879     <span class="comment">// If the specified breakpoint table entry is not valid, then return FALSE.</span>
00880     <span class="comment">//</span>
00881 
00882     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> == 0) {
00883         <span class="comment">//DPRINT(("KD: Breakpoint %d already clear.\n", Index));</span>
00884         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00885     }
00886 
00887     <span class="comment">//</span>
00888     <span class="comment">// If the breakpoint is already suspended, just delete it from the table.</span>
00889     <span class="comment">//</span>
00890 
00891     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) {
00892         <span class="comment">//DPRINT(("KD: Deleting suspended breakpoint %d \n", Index));</span>
00893         <span class="keywordflow">if</span> ( !(<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) ) {
00894             <span class="comment">//DPRINT(("KD: already clear.\n"));</span>
00895             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00896             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00897         }
00898     }
00899 
00900     <span class="comment">//</span>
00901     <span class="comment">// Replace the instruction contents.</span>
00902     <span class="comment">//</span>
00903 
00904     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4/4_2kdbreak_8c.html#a4">KdpLowWriteContent</a>(Index)) {
00905 
00906         <span class="comment">//</span>
00907         <span class="comment">// Delete breakpoint table entry</span>
00908         <span class="comment">//</span>
00909 
00910         <span class="comment">//DPRINT(("KD: Breakpoint %d deleted successfully.\n", Index));</span>
00911         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00912     }
00913 
00914     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00915 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="4/kdbreak.c::KdpDeleteBreakpointRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpDeleteBreakpointRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Lower</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Upper</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00919">919</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00048">KD_BREAKPOINT_IN_USE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, and <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00036">KdpSetLoadState()</a>, and <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00098">KdpSetStateChange()</a>.
<p>
<pre class="fragment"><div>00926                    :
00927 
00928     This routine deletes all breakpoints falling in a given range
00929     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table.
00930 
00931 Arguments:
00932 
00933     Lower - inclusive lower address of range from which to remove BPs.
00934 
00935     Upper - include upper address of range from which to remove BPs.
00936 
00937 Return Value:
00938 
00939     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> any breakpoints removed, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
00940 
00941 --*/
00942 
00943 {
00944     ULONG   <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00945     BOOLEAN ReturnStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00946 
00947     <span class="comment">//</span>
00948     <span class="comment">// Examine each entry in the table in turn</span>
00949     <span class="comment">//</span>
00950 
00951     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00952 
00953         <span class="keywordflow">if</span> ( (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) &amp;&amp;
00954              ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &gt;= Lower) &amp;&amp;
00955               (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &lt;= Upper))
00956            ) {
00957 
00958             <span class="comment">//</span>
00959             <span class="comment">// Breakpoint is in use and falls in range, clear it.</span>
00960             <span class="comment">//</span>
00961 
00962             ReturnStatus = ReturnStatus || <a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(Index+1);
00963         }
00964     }
00965 
00966     <span class="keywordflow">return</span> ReturnStatus;
00967 
00968 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="4/kdbreak.c::KdpLowRestoreBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowRestoreBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l01138">1138</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00174">_BREAKPOINT_ENTRY::Content</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00056">KD_BREAKPOINT_IA64_MOVL</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00049">KD_BREAKPOINT_NEEDS_WRITE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00076">KDP_BREAKPOINT_TYPE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01309">KdpRestoreAllBreakpoints()</a>.
<p>
<pre class="fragment"><div>01144                    :
01145 
01146     This routine attempts to write a breakpoint instruction.
01147     The old contents must have already been stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01148     breakpoint record.
01149 
01150 Arguments:
01151 
01152     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry
01153         which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be written.
01154 
01155 Return Value:
01156 
01157     Returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint was written, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was
01158     not and has been marked <span class="keywordflow">for</span> writing later.
01159 
01160 --*/
01161 
01162 {
01163     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> Content;
01164 
01165 <span class="preprocessor">#if defined(_IA64_)</span>
01166 <span class="preprocessor"></span>    <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
01167     PVOID BundleAddress;
01168 <span class="preprocessor">#endif</span>
01169 <span class="preprocessor"></span>    <span class="comment">//</span>
01170     <span class="comment">// Does the breakpoint need to be written at all?</span>
01171     <span class="comment">//</span>
01172 
01173     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) {
01174 
01175         <span class="comment">//</span>
01176         <span class="comment">// The breakpoint was never removed.  Clear the flag</span>
01177         <span class="comment">// and we are done.</span>
01178         <span class="comment">//</span>
01179 
01180         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
01181         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01182     }
01183 
01184     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> == <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a>) {
01185 
01186         <span class="comment">//</span>
01187         <span class="comment">// The instruction is a breakpoint anyway.</span>
01188         <span class="comment">//</span>
01189 
01190         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01191     }
01192 
01193     <span class="comment">//</span>
01194     <span class="comment">// Replace the instruction contents.</span>
01195     <span class="comment">//</span>
01196 
01197 <span class="preprocessor">#if !defined(_IA64_)</span>
01198 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> == <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a>) {
01199 
01200         <span class="comment">//</span>
01201         <span class="comment">// The instruction is a breakpoint anyway.</span>
01202         <span class="comment">//</span>
01203 
01204         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01205     }
01206 <span class="preprocessor">#endif</span>
01207 <span class="preprocessor"></span>
01208     <span class="comment">//</span>
01209     <span class="comment">// Replace the instruction contents.</span>
01210     <span class="comment">//</span>
01211 
01212 <span class="preprocessor">#if defined(_IA64_)</span>
01213 <span class="preprocessor"></span>
01214     <span class="comment">// read in intruction in case the adjacent instruction has been modified.</span>
01215 
01216     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01217             (PCHAR)&amp;mBuf,
01218             (PCHAR)KdpBreakpointTable[Index].Address,
01219             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01220             ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01221         <span class="comment">//DPRINT(("KD: read 0x%p template failed\n", KdpBreakpointTable[Index].Address));</span>
01222         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01223         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01224         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01225     }
01226 
01227     <span class="keywordflow">switch</span> ((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) {
01228         <span class="keywordflow">case</span> 0:
01229             mBuf = (mBuf &amp; ~(INST_SLOT0_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 5);
01230             <span class="keywordflow">break</span>;
01231 
01232         <span class="keywordflow">case</span> 4:
01233             mBuf = (mBuf &amp; ~(INST_SLOT1_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 14);
01234             <span class="keywordflow">break</span>;
01235 
01236         <span class="keywordflow">case</span> 8:
01237             mBuf = (mBuf &amp; ~(INST_SLOT2_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 23);
01238             <span class="keywordflow">break</span>;
01239 
01240         <span class="keywordflow">default</span>:
01241             <span class="comment">//DPRINT(("KD: KdpAddBreakpoint bad instruction slot#\n"));</span>
01242             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01243     }
01244     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01245             (PCHAR)KdpBreakpointTable[Index].Address,
01246             (PCHAR)&amp;mBuf,
01247             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01248             ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01249 
01250         <span class="comment">//DPRINT(("KD: KdpMoveMemory failed writing BP!\n"));</span>
01251         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01252         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01253         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01254     }
01255     <span class="keywordflow">else</span> {
01256 
01257         <span class="comment">// check for two-slot MOVL instruction. Reject request if attempt to</span>
01258         <span class="comment">// set break in slot 2 of MLI template.</span>
01259         <span class="comment">// change template to type 0 if current instruction is MLI</span>
01260 
01261         <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) != 0) {
01262             (ULONG_PTR)BundleAddress = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; ~(0xf);
01263             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01264                     (PCHAR)&amp;mBuf,
01265                     (PCHAR)BundleAddress,
01266                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01267                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01268                 <span class="comment">//DPRINT(("KD: read template failed at 0x%08x\n", BundleAddress));</span>
01269                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01270                 <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01271                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01272             }
01273             <span class="keywordflow">else</span> {
01274                 <span class="keywordflow">if</span> (((mBuf &amp; INST_TEMPL_MASK) &gt;&gt; 1) == 0x2) {
01275                     <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) == 4) {
01276                         <span class="comment">// if template= type 2 MLI, change to type 0</span>
01277                         mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1);
01278                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>;
01279                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01280                                 (PCHAR)BundleAddress,
01281                                 (PCHAR)&amp;mBuf,
01282                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01283                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01284                             <span class="comment">//DPRINT(("KD: write to 0x%08x template failed\n", BundleAddress));</span>
01285                             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01286                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01287                             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01288                         }
01289                         <span class="keywordflow">else</span> {
01290                              <span class="comment">//DPRINT(("KD: change MLI template to type 0 at 0x%08x set\n", Address));</span>
01291                         }
01292                     } <span class="keywordflow">else</span> {
01293                          <span class="comment">// set breakpoint at slot 2 of MOVL is illegal</span>
01294                          <span class="comment">//DPRINT(("KD: illegal to set BP at slot 2 of MOVL at 0x%08x\n", BundleAddress));</span>
01295                          <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01296                          <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01297                          <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01298                     }
01299                 }
01300             }
01301         }
01302         <span class="comment">//DPRINT(("KD: breakpoint at 0x%08x set\n", Address));</span>
01303         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01304     }
01305 
01306 <span class="preprocessor">#else</span>
01307 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)KdpBreakpointTable[Index].Address,
01308                        (PCHAR)&amp;KdpBreakpointInstruction,
01309                        <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE) ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01310 
01311         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01312         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01313         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01314 
01315     } <span class="keywordflow">else</span> {
01316 
01317         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01318         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01319     }
01320 <span class="preprocessor">#endif</span>
01321 <span class="preprocessor"></span>
01322 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="4/kdbreak.c::KdpLowRestoreBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowRestoreBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="4/kdbreak.c::KdpLowWriteContent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowWriteContent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00654">654</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00174">_BREAKPOINT_ENTRY::Content</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00056">KD_BREAKPOINT_IA64_MOVL</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00049">KD_BREAKPOINT_NEEDS_WRITE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00076">KDP_BREAKPOINT_TYPE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>, and <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00954">KdpSuspendBreakpoint()</a>.
<p>
<pre class="fragment"><div>00660                    :
00661 
00662     This routine attempts to replace <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> code that a breakpoint <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00663     written over.  This routine, <a class="code" href="../../d0/d4/kdbreak_8c.html#a3">KdpAddBreakpoint</a>,
00664     <a class="code" href="../../d0/d4/kdbreak_8c.html#a2">KdpLowRestoreBreakpoint</a> and <a class="code" href="../../d7/d3/kd_8h.html#a21">KdSetOwedBreakpoints</a> are responsible
00665     <span class="keywordflow">for</span> getting data written as requested.  Callers should not
00666     examine or use KdpOweBreakpoints, and they should not set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00667     NEEDS_WRITE or NEEDS_REPLACE flags.
00668 
00669     Callers must still look at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">return</span> value from <span class="keyword">this</span> function,
00670     however: <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> returns <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint record must not be
00671     reused until <a class="code" href="../../d7/d3/kd_8h.html#a21">KdSetOwedBreakpoints</a> has finished with <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
00672 
00673 Arguments:
00674 
00675     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry
00676         which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be deleted.
00677 
00678 Return Value:
00679 
00680     Returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint was removed, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was deferred.
00681 
00682 --*/
00683 
00684 {
00685 <span class="preprocessor">#if defined(_IA64_)</span>
00686 <span class="preprocessor"></span>    <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
00687     PVOID BundleAddress;
00688 <span class="preprocessor">#endif</span>
00689 <span class="preprocessor"></span>
00690     <span class="comment">//</span>
00691     <span class="comment">// Do the contents need to be replaced at all?</span>
00692     <span class="comment">//</span>
00693 
00694     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>) {
00695 
00696         <span class="comment">//</span>
00697         <span class="comment">// The breakpoint was never written out.  Clear the flag</span>
00698         <span class="comment">// and we are done.</span>
00699         <span class="comment">//</span>
00700 
00701         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
00702         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x never written; flag cleared.\n",</span>
00703         <span class="comment">//    KdpBreakpointTable[Index].Address));</span>
00704         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00705     }
00706 
00707 <span class="preprocessor">#if !defined(_IA64_)</span>
00708 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> == <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a>) {
00709 
00710         <span class="comment">//</span>
00711         <span class="comment">// The instruction is a breakpoint anyway.</span>
00712         <span class="comment">//</span>
00713 
00714         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x; instr is really BP; flag cleared.\n",</span>
00715         <span class="comment">//    KdpBreakpointTable[Index].Address));</span>
00716 
00717         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00718     }
00719 <span class="preprocessor">#endif</span>
00720 <span class="preprocessor"></span>
00721 
00722     <span class="comment">//</span>
00723     <span class="comment">// Restore the instruction contents.</span>
00724     <span class="comment">//</span>
00725 
00726 <span class="preprocessor">#if defined(_IA64_)</span>
00727 <span class="preprocessor"></span>    <span class="comment">// Read in memory since adjancent instructions in the same bundle may have</span>
00728     <span class="comment">// been modified after we save them.</span>
00729     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00730             (PCHAR)&amp;mBuf,
00731             (PCHAR)KdpBreakpointTable[Index].Address,
00732             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00733         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00734         <span class="comment">//DPRINT(("KD: read 0x%08x failed\n", KdpBreakpointTable[Index].Address));</span>
00735         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00736         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00737     }
00738     <span class="keywordflow">else</span> {
00739 
00740         <span class="keywordflow">switch</span> ((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) {
00741         <span class="keywordflow">case</span> 0:
00742             mBuf = (mBuf &amp; ~(INST_SLOT0_MASK))
00743                          | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT0_MASK);
00744             <span class="keywordflow">break</span>;
00745 
00746         <span class="keywordflow">case</span> 4:
00747             mBuf = (mBuf &amp; ~(INST_SLOT1_MASK))
00748                          | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT1_MASK);
00749             <span class="keywordflow">break</span>;
00750 
00751         <span class="keywordflow">case</span> 8:
00752             mBuf = (mBuf &amp; ~(INST_SLOT2_MASK))
00753                          | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT2_MASK);
00754             <span class="keywordflow">break</span>;
00755 
00756         <span class="keywordflow">default</span>:
00757             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00758             <span class="comment">//DPRINT(("KD: illegal instruction address 0x%08x\n", KdpBreakpointTable[Index].Address));</span>
00759             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00760         }
00761 
00762         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00763                 (PCHAR)KdpBreakpointTable[Index].Address,
00764                 (PCHAR)&amp;mBuf,
00765                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00766             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00767             <span class="comment">//DPRINT(("KD: write to 0x%08x failed\n", KdpBreakpointTable[Index].Address));</span>
00768             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00769             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00770         }
00771         <span class="keywordflow">else</span> {
00772 
00773             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00774                     (PCHAR)&amp;mBuf,
00775                     (PCHAR)KdpBreakpointTable[Index].Address,
00776                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) == <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00777                 <span class="comment">//DPRINT(("\tcontent after memory move = 0x%08x 0x%08x\n", (ULONG)(mBuf &gt;&gt; 32), (ULONG)mBuf));</span>
00778             }
00779 
00780             <span class="comment">// restore template to MLI if displaced instruction was MOVL</span>
00781 
00782             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>) {
00783                 (ULONG_PTR)BundleAddress = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; ~(0xf);
00784                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00785                         (PCHAR)&amp;mBuf,
00786                         (PCHAR)BundleAddress,
00787                         <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00788                         ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00789                     <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00790                     <span class="comment">//DPRINT(("KD: read template 0x%08x failed\n", KdpBreakpointTable[Index].Address));</span>
00791                     <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00792                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00793                 }
00794                 <span class="keywordflow">else</span> {
00795                     mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1); <span class="comment">// set template to MLI</span>
00796                     mBuf |= 0x4;
00797 
00798                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00799                           (PCHAR)BundleAddress,
00800                           (PCHAR)&amp;mBuf,
00801                           <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00802                           ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00803                         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00804                         <span class="comment">//DPRINT(("KD: write template to 0x%08x failed\n", KdpBreakpointTable[Index].Address));</span>
00805                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00806                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00807                     } <span class="keywordflow">else</span> {
00808                         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x cleared.\n",</span>
00809                          <span class="comment">//   KdpBreakpointTable[Index].Address));</span>
00810                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00811                     }
00812                 }
00813             }
00814             <span class="keywordflow">else</span> {   <span class="comment">// not MOVL</span>
00815                 <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x cleared.\n",</span>
00816                  <span class="comment">//  KdpBreakpointTable[Index].Address));</span>
00817                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00818             }
00819         }
00820     }
00821 <span class="preprocessor">#else</span>
00822 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)KdpBreakpointTable[Index].Address,
00823                         (PCHAR)&amp;KdpBreakpointTable[Index].Content,
00824                         <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE) ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00825 
00826         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00827         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00828         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x; unable to clear, flag set.\n",</span>
00829             <span class="comment">//KdpBreakpointTable[Index].Address));</span>
00830         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00831     } <span class="keywordflow">else</span> {
00832         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x cleared.\n",</span>
00833             <span class="comment">//KdpBreakpointTable[Index].Address));</span>
00834         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00835     }
00836 <span class="preprocessor">#endif</span>
00837 <span class="preprocessor"></span>
00838 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="4/kdbreak.c::KdpLowWriteContent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowWriteContent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="4/kdbreak.c::KdpRestoreAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpRestoreAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l01326">1326</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00248">BreakpointsSuspended</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00048">KD_BREAKPOINT_IN_USE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00050">KD_BREAKPOINT_SUSPENDED</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, and <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l01138">KdpLowRestoreBreakpoint()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">KdEnableDebugger()</a>.
<p>
<pre class="fragment"><div>01329 {
01330     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01331 
01332     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01333 
01334     <span class="keywordflow">for</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++ ) {
01335 
01336         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) &amp;&amp;
01337             (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) ) {
01338 
01339             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>;
01340             <a class="code" href="../../d1/d4/4_2kdbreak_8c.html#a9">KdpLowRestoreBreakpoint</a>(Index);
01341         }
01342     }
01343 
01344     <span class="keywordflow">return</span>;
01345 
01346 } <span class="comment">// KdpRestoreAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="4/kdbreak.c::KdpSuspendAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSuspendAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00989">989</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00248">BreakpointsSuspended</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00954">KdpSuspendBreakpoint()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>.
<p>
<pre class="fragment"><div>00992 {
00993     ULONG <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00994 
00995     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00996 
00997     <span class="keywordflow">for</span> ( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = 1; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &lt;= BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>++ ) {
00998         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a138">KdpSuspendBreakpoint</a>(Handle);
00999     }
01000 
01001     <span class="keywordflow">return</span>;
01002 
01003 } <span class="comment">// KdpSuspendAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="4/kdbreak.c::KdpSuspendBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSuspendBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00971">971</a> of file <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html">4/kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00048">KD_BREAKPOINT_IN_USE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00050">KD_BREAKPOINT_SUSPENDED</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, and <a class="el" href="../../d2/d3/4_2kdbreak_8c-source.html#l00654">KdpLowWriteContent()</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00972">KdpSuspendAllBreakpoints()</a>.
<p>
<pre class="fragment"><div>00974 {
00975     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - 1;
00976 
00977     <span class="keywordflow">if</span> ( (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) &amp;&amp;
00978         !(<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) ) {
00979 
00980         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>;
00981         <a class="code" href="../../d1/d4/4_2kdbreak_8c.html#a4">KdpLowWriteContent</a>(Index);
00982     }
00983 
00984     <span class="keywordflow">return</span>;
00985 
00986 } <span class="comment">// KdpSuspendBreakpoint</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="4/kdbreak.c::KdSetOwedBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdSetOwedBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00056">KiMemoryFault()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
