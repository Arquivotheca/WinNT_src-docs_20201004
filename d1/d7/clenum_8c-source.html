<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: clenum.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>clenum.c</h1><a href="../../d0/d8/clenum_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: clenum</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* For enumeration functions</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* 04-27-91 ScottLu Created.</span>
00009 <span class="comment">\***************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00012 <span class="preprocessor">#pragma hdrstop</span>
00013 <span class="preprocessor"></span>
00014 
<a name="l00015"></a><a class="code" href="../../d0/d8/clenum_8c.html#a0">00015</a> <span class="preprocessor">#define IEP_UNICODE 0x1 // Convert Atom to unicode string (vs ANSI)</span>
<a name="l00016"></a><a class="code" href="../../d0/d8/clenum_8c.html#a1">00016</a> <span class="preprocessor"></span><span class="preprocessor">#define IEP_ENUMEX 0x2 // Pass lParam back to callback function (vs no lParam)</span>
00017 <span class="preprocessor"></span>
<a name="l00018"></a><a class="code" href="../../d0/d8/clenum_8c.html#a4">00018</a> HWND *<a class="code" href="../../d0/d8/clenum_8c.html#a4">phwndCache</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00019 
00020 
00021 <span class="comment">/***************************************************************************\</span>
00022 <span class="comment">* InternalEnumWindows</span>
00023 <span class="comment">*</span>
00024 <span class="comment">* Calls server and gets back a window list. This list is enumerated, for each</span>
00025 <span class="comment">* window the callback address is called (into the application), until either</span>
00026 <span class="comment">* end-of-list is reached or FALSE is return ed. lParam is passed into the</span>
00027 <span class="comment">* callback function for app reference.</span>
00028 <span class="comment">*</span>
00029 <span class="comment">*</span>
00030 <span class="comment">* If any windows are returned (cHwnd &gt; 0) the caller is responsible for</span>
00031 <span class="comment">* freeing the window buffer when done with the list</span>
00032 <span class="comment">*</span>
00033 <span class="comment">*</span>
00034 <span class="comment">* 04-27-91 ScottLu Created.</span>
00035 <span class="comment">\***************************************************************************/</span>
00036 
<a name="l00037"></a><a class="code" href="../../d6/d0/usercli_8h.html#a634">00037</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(
00038     HDESK hdesk,
00039     HWND hwndNext,
00040     BOOL fEnumChildren,
00041     DWORD idThread,
00042     HWND **pphwndFirst)
00043 {
00044     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cHwnd;
00045     HWND *phwndFirst;
00046     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00047     <span class="keywordtype">int</span> cTries;
00048 
00049     <span class="comment">/*</span>
00050 <span class="comment">     * Allocate a buffer to hold the names.</span>
00051 <span class="comment">     */</span>
00052     cHwnd = 64;
00053     phwndFirst = (HWND *)InterlockedExchangePointer(&amp;(PVOID)<a class="code" href="../../d0/d8/clenum_8c.html#a4">phwndCache</a>, 0);
00054     <span class="keywordflow">if</span> (phwndFirst == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00055         phwndFirst = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cHwnd * <span class="keyword">sizeof</span>(HWND));
00056         <span class="keywordflow">if</span> (phwndFirst == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00057             <span class="keywordflow">return</span> 0;
00058     }
00059 
00060     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a291">NtUserBuildHwndList</a>(hdesk, hwndNext, fEnumChildren,
00061             idThread, cHwnd, phwndFirst, &amp;cHwnd);
00062 
00063     <span class="comment">/*</span>
00064 <span class="comment">     * If the buffer wasn't big enough, reallocate</span>
00065 <span class="comment">     * the buffer and try again.</span>
00066 <span class="comment">     */</span>
00067     cTries = 0;
00068     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00069         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(phwndFirst);
00070 
00071         <span class="comment">/*</span>
00072 <span class="comment">         * If we can't seem to get it right,</span>
00073 <span class="comment">         * call it quits</span>
00074 <span class="comment">         */</span>
00075         <span class="keywordflow">if</span> (cTries++ == 10)
00076             <span class="keywordflow">return</span> 0;
00077 
00078         phwndFirst = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cHwnd * <span class="keyword">sizeof</span>(HWND));
00079         <span class="keywordflow">if</span> (phwndFirst == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00080             <span class="keywordflow">return</span> 0;
00081 
00082         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a291">NtUserBuildHwndList</a>(hdesk, hwndNext, fEnumChildren,
00083                 idThread, cHwnd, phwndFirst, &amp;cHwnd);
00084     }
00085 
00086     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) || cHwnd &lt;= 1) {
00087         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(phwndFirst);
00088         <span class="keywordflow">return</span> 0;
00089     }
00090 
00091     *pphwndFirst = phwndFirst;
00092     <span class="keywordflow">return</span> cHwnd - 1;
00093 }
00094 
<a name="l00095"></a><a class="code" href="../../d0/d8/clenum_8c.html#a6">00095</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d0/d8/clenum_8c.html#a6">InternalEnumWindows</a>(
00096     HDESK hdesk,
00097     HWND hwnd,
00098     WNDENUMPROC lpfn,
00099     LPARAM lParam,
00100     DWORD idThread,
00101     BOOL fEnumChildren)
00102 {
00103     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i;
00104     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cHwnd;
00105     HWND *phwndT;
00106     HWND *phwndFirst;
00107     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00108 
00109     <span class="comment">/*</span>
00110 <span class="comment">     * Get the hwnd list.  It is returned in a block of memory</span>
00111 <span class="comment">     * allocated with LocalAlloc.</span>
00112 <span class="comment">     */</span>
00113     <span class="keywordflow">if</span> ((cHwnd = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(hdesk, hwnd, fEnumChildren, idThread,
00114             &amp;phwndFirst)) == -1) {
00115         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00116     }
00117 
00118     <span class="comment">/*</span>
00119 <span class="comment">     * In Win 3.1 it was not an error if there were no windows in the thread</span>
00120 <span class="comment">     */</span>
00121     <span class="keywordflow">if</span> (cHwnd == 0) {
00122         <span class="keywordflow">if</span> (idThread == 0)
00123             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00124         <span class="keywordflow">else</span>
00125             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00126     }
00127 
00128 
00129     <span class="comment">/*</span>
00130 <span class="comment">     * Loop through the windows, call the function pointer back for each</span>
00131 <span class="comment">     * one. End loop if either FALSE is return ed or the end-of-list is</span>
00132 <span class="comment">     * reached.</span>
00133 <span class="comment">     */</span>
00134     phwndT = phwndFirst;
00135     <span class="keywordflow">for</span> (i = 0; i &lt; cHwnd; i++) {
00136 
00137         <span class="comment">/*</span>
00138 <span class="comment">         * call ValidateHwnd instead of RevalidateHwnd so that</span>
00139 <span class="comment">         * restricted processes don't see handles they are not</span>
00140 <span class="comment">         * suppose to see.</span>
00141 <span class="comment">         */</span>
00142         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(*phwndT)) {
00143             <span class="keywordflow">if</span> (!(fSuccess = (*lpfn)(*phwndT, lParam)))
00144                 <span class="keywordflow">break</span>;
00145         }
00146         phwndT++;
00147     }
00148 
00149     <span class="comment">/*</span>
00150 <span class="comment">     * Free up buffer and return status - TRUE if entire list was enumerated,</span>
00151 <span class="comment">     * FALSE otherwise.</span>
00152 <span class="comment">     */</span>
00153     phwndT = (HWND *)InterlockedExchangePointer(&amp;(PVOID)<a class="code" href="../../d0/d8/clenum_8c.html#a4">phwndCache</a>, phwndFirst);
00154     <span class="keywordflow">if</span> (phwndT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00155         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(phwndT);
00156     }
00157     <span class="keywordflow">return</span> fSuccess;
00158 }
00159 
00160 
00161 <span class="comment">/***************************************************************************\</span>
00162 <span class="comment">* EnumWindows</span>
00163 <span class="comment">*</span>
00164 <span class="comment">* Enumerates all top-level windows. Calls back lpfn with each hwnd until</span>
00165 <span class="comment">* either end-of-list or FALSE is return ed. lParam is passed into callback</span>
00166 <span class="comment">* function for app reference.</span>
00167 <span class="comment">*</span>
00168 <span class="comment">* 04-27-91 ScottLu Created.</span>
00169 <span class="comment">\***************************************************************************/</span>
00170 
<a name="l00171"></a><a class="code" href="../../d0/d8/clenum_8c.html#a7">00171</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a7">EnumWindows</a>(
00172     WNDENUMPROC lpfn,
00173     LPARAM lParam)
00174 {
00175     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a6">InternalEnumWindows</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpfn, lParam, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00176 }
00177 
00178 <span class="comment">/***************************************************************************\</span>
00179 <span class="comment">* EnumChildWindows</span>
00180 <span class="comment">*</span>
00181 <span class="comment">* Enumerates all children of the passed in window. Calls back lpfn with each</span>
00182 <span class="comment">* hwnd until either end-of-list or FALSE is return ed. lParam is passed into</span>
00183 <span class="comment">* callback function for app reference.</span>
00184 <span class="comment">*</span>
00185 <span class="comment">* 04-27-91 ScottLu Created.</span>
00186 <span class="comment">\***************************************************************************/</span>
00187 
<a name="l00188"></a><a class="code" href="../../d0/d8/clenum_8c.html#a8">00188</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a8">EnumChildWindows</a>(
00189     HWND hwnd,
00190     WNDENUMPROC lpfn,
00191     LPARAM lParam)
00192 {
00193     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a6">InternalEnumWindows</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, hwnd, lpfn, lParam, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00194 }
00195 
00196 <span class="comment">/***************************************************************************\</span>
00197 <span class="comment">* EnumThreadWindows</span>
00198 <span class="comment">*</span>
00199 <span class="comment">* Enumerates all top level windows created by idThread. Calls back lpfn with</span>
00200 <span class="comment">* each hwnd until either end-of-list or FALSE is return ed. lParam is passed</span>
00201 <span class="comment">* into callback function for app reference.</span>
00202 <span class="comment">*</span>
00203 <span class="comment">* 06-23-91 ScottLu Created.</span>
00204 <span class="comment">\***************************************************************************/</span>
00205 
<a name="l00206"></a><a class="code" href="../../d0/d8/clenum_8c.html#a9">00206</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d0/d8/clenum_8c.html#a9">EnumThreadWindows</a>(
00207     DWORD idThread,
00208     WNDENUMPROC lpfn,
00209     LPARAM lParam)
00210 {
00211     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a6">InternalEnumWindows</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpfn, lParam, idThread, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00212 }
00213 
00214 <span class="comment">/***************************************************************************\</span>
00215 <span class="comment">* EnumDesktopWindows</span>
00216 <span class="comment">*</span>
00217 <span class="comment">* Enumerates all top level windows on the desktop specified by hdesk.</span>
00218 <span class="comment">* Calls back lpfn with each hwnd until either end-of-list or FALSE</span>
00219 <span class="comment">* is returned. lParam is passed into callback function for app reference.</span>
00220 <span class="comment">*</span>
00221 <span class="comment">* 10-10-94 JimA     Created.</span>
00222 <span class="comment">\***************************************************************************/</span>
00223 
<a name="l00224"></a><a class="code" href="../../d0/d8/clenum_8c.html#a10">00224</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d0/d8/clenum_8c.html#a10">EnumDesktopWindows</a>(
00225     HDESK hdesk,
00226     WNDENUMPROC lpfn,
00227     LPARAM lParam)
00228 {
00229     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a6">InternalEnumWindows</a>(hdesk, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpfn, lParam, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00230 }
00231 
00232 
00233 
00234 
00235 <span class="comment">/***************************************************************************\</span>
00236 <span class="comment">* InternalEnumProps</span>
00237 <span class="comment">*</span>
00238 <span class="comment">* Calls server and gets back a list of props for the specified window.</span>
00239 <span class="comment">* The callback address is called (into the application), until either</span>
00240 <span class="comment">* end-of-list is reached or FALSE is return ed.</span>
00241 <span class="comment">* lParam is passed into the callback function for app reference when</span>
00242 <span class="comment">* IEP_ENUMEX is set. Atoms are turned into UNICODE string if IEP_UNICODE</span>
00243 <span class="comment">* is set.</span>
00244 <span class="comment">*</span>
00245 <span class="comment">* 22-Jan-1992 JohnC Created.</span>
00246 <span class="comment">\***************************************************************************/</span>
00247 
<a name="l00248"></a><a class="code" href="../../d0/d8/clenum_8c.html#a2">00248</a> <span class="preprocessor">#define MAX_ATOM_SIZE 512</span>
<a name="l00249"></a><a class="code" href="../../d0/d8/clenum_8c.html#a3">00249</a> <span class="preprocessor"></span><span class="preprocessor">#define ISSTRINGATOM(atom)     ((WORD)(atom) &gt;= 0xc000)</span>
00250 <span class="preprocessor"></span>
<a name="l00251"></a><a class="code" href="../../d0/d8/clenum_8c.html#a11">00251</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> <a class="code" href="../../d0/d8/clenum_8c.html#a11">InternalEnumProps</a>(
00252     HWND hwnd,
00253     PROPENUMPROC lpfn,
00254     LPARAM lParam,
00255     UINT flags)
00256 {
00257     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ii;
00258     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cPropSets;
00259     <a class="code" href="../../d2/d1/struct__PROPSET.html">PPROPSET</a> pPropSet;
00260     WCHAR awch[<a class="code" href="../../d0/d8/clenum_8c.html#a2">MAX_ATOM_SIZE</a>];
00261     PVOID pKey;
00262     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> iRetVal;
00263     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cchName;
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00265     <span class="keywordtype">int</span> cTries;
00266 
00267     <span class="comment">/*</span>
00268 <span class="comment">     * Allocate a buffer to hold the names.</span>
00269 <span class="comment">     */</span>
00270     cPropSets = 32;
00271     pPropSet = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cPropSets * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d1/struct__PROPSET.html">PROPSET</a>));
00272     <span class="keywordflow">if</span> (pPropSet == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00273         <span class="keywordflow">return</span> -1;
00274 
00275     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a292">NtUserBuildPropList</a>(hwnd, cPropSets, pPropSet, &amp;cPropSets);
00276 
00277     <span class="comment">/*</span>
00278 <span class="comment">     * If the buffer wasn't big enough, reallocate</span>
00279 <span class="comment">     * the buffer and try again.</span>
00280 <span class="comment">     */</span>
00281     cTries = 0;
00282     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00283         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pPropSet);
00284 
00285         <span class="comment">/*</span>
00286 <span class="comment">         * If we can't seem to get it right,</span>
00287 <span class="comment">         * call it quits</span>
00288 <span class="comment">         */</span>
00289         <span class="keywordflow">if</span> (cTries++ == 10)
00290             <span class="keywordflow">return</span> -1;
00291 
00292         pPropSet = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cPropSets * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a982">PROPSET</a>));
00293         <span class="keywordflow">if</span> (pPropSet == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00294             <span class="keywordflow">return</span> -1;
00295 
00296         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a292">NtUserBuildPropList</a>(hwnd, cPropSets, pPropSet, &amp;cPropSets);
00297     }
00298 
00299     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00300         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pPropSet);
00301         <span class="keywordflow">return</span> -1;
00302     }
00303 
00304     <span class="keywordflow">for</span> (ii=0; ii&lt;cPropSets; ii++) {
00305 
00306         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8/clenum_8c.html#a3">ISSTRINGATOM</a>(pPropSet[ii].atom)) {
00307 
00308             pKey = (PVOID)awch;
00309             <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d0/d8/clenum_8c.html#a0">IEP_UNICODE</a>)
00310                 cchName = GlobalGetAtomNameW(pPropSet[ii].atom, (LPWSTR)pKey, <a class="code" href="../../d0/d8/clenum_8c.html#a2">MAX_ATOM_SIZE</a>);
00311             <span class="keywordflow">else</span>
00312                 cchName = GlobalGetAtomNameA(pPropSet[ii].atom, (LPSTR)pKey, <span class="keyword">sizeof</span>(awch));
00313 
00314             <span class="comment">/*</span>
00315 <span class="comment">             * If cchName is zero, we must assume that the property belongs</span>
00316 <span class="comment">             * to another process.  Because we can't get the name, just skip</span>
00317 <span class="comment">             * it.</span>
00318 <span class="comment">             */</span>
00319             <span class="keywordflow">if</span> (cchName == 0)
00320                 <span class="keywordflow">continue</span>;
00321 
00322         } <span class="keywordflow">else</span> {
00323             pKey = (PVOID)pPropSet[ii].<a class="code" href="../../d2/d1/struct__PROPSET.html#o1">atom</a>;
00324         }
00325 
00326         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d0/d8/clenum_8c.html#a1">IEP_ENUMEX</a>) {
00327             iRetVal = (*(PROPENUMPROCEX)lpfn)(hwnd, pKey,
00328                     pPropSet[ii].<a class="code" href="../../d2/d1/struct__PROPSET.html#o0">hData</a>, lParam);
00329         } <span class="keywordflow">else</span> {
00330             iRetVal = (*lpfn)(hwnd, pKey, pPropSet[ii].<a class="code" href="../../d2/d1/struct__PROPSET.html#o0">hData</a>);
00331         }
00332 
00333         <span class="keywordflow">if</span> (!iRetVal)
00334             <span class="keywordflow">break</span>;
00335     }
00336 
00337     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pPropSet);
00338 
00339     <span class="keywordflow">return</span> iRetVal;
00340 }
00341 
00342 
00343 <span class="comment">/***************************************************************************\</span>
00344 <span class="comment">* EnumProps</span>
00345 <span class="comment">*</span>
00346 <span class="comment">* This function enumerates all entries in the property list of the specified</span>
00347 <span class="comment">* window. It enumerates the entries by passing them, one by one, to the</span>
00348 <span class="comment">* callback function specified by lpEnumFunc. EnumProps continues until the</span>
00349 <span class="comment">* last entry is enumerated or the callback function return s zero.</span>
00350 <span class="comment">*</span>
00351 <span class="comment">* 22-Jan-1992 JohnC Created.</span>
00352 <span class="comment">\***************************************************************************/</span>
00353 
<a name="l00354"></a><a class="code" href="../../d0/d8/clenum_8c.html#a12">00354</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a12">EnumPropsA</a>(
00355     HWND hwnd,
00356     PROPENUMPROCA lpfn)
00357 {
00358     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a11">InternalEnumProps</a>(hwnd, (PROPENUMPROC)lpfn, 0, 0);
00359 }
00360 
00361 
<a name="l00362"></a><a class="code" href="../../d0/d8/clenum_8c.html#a13">00362</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a13">EnumPropsW</a>(
00363     HWND hwnd,
00364     PROPENUMPROCW lpfn)
00365 {
00366     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a11">InternalEnumProps</a>(hwnd, (PROPENUMPROC)lpfn, 0, <a class="code" href="../../d0/d8/clenum_8c.html#a0">IEP_UNICODE</a>);
00367 }
00368 
00369 <span class="comment">/***************************************************************************\</span>
00370 <span class="comment">* EnumPropsEx</span>
00371 <span class="comment">*</span>
00372 <span class="comment">* This function enumerates all entries in the property list of the specified</span>
00373 <span class="comment">* window. It enumerates the entries by passing them, one by one, to the</span>
00374 <span class="comment">* callback function specified by lpEnumFunc. EnumProps continues until the</span>
00375 <span class="comment">* last entry is enumerated or the callback function return s zero.</span>
00376 <span class="comment">*</span>
00377 <span class="comment">* 22-Jan-1992 JohnC Created.</span>
00378 <span class="comment">\***************************************************************************/</span>
00379 
<a name="l00380"></a><a class="code" href="../../d0/d8/clenum_8c.html#a14">00380</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a14">EnumPropsExA</a>(
00381     HWND hwnd,
00382     PROPENUMPROCEXA lpfn,
00383     LPARAM lParam)
00384 {
00385     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a11">InternalEnumProps</a>(hwnd, (PROPENUMPROC)lpfn, lParam, <a class="code" href="../../d0/d8/clenum_8c.html#a1">IEP_ENUMEX</a>);
00386 }
00387 
<a name="l00388"></a><a class="code" href="../../d0/d8/clenum_8c.html#a15">00388</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a15">EnumPropsExW</a>(
00389     HWND hwnd,
00390     PROPENUMPROCEXW lpfn,
00391     LPARAM lParam)
00392 {
00393     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a11">InternalEnumProps</a>(hwnd, (PROPENUMPROC)lpfn, lParam, <a class="code" href="../../d0/d8/clenum_8c.html#a0">IEP_UNICODE</a>|<a class="code" href="../../d0/d8/clenum_8c.html#a1">IEP_ENUMEX</a>);
00394 }
00395 
00396 
00397 
<a name="l00398"></a><a class="code" href="../../d0/d8/clenum_8c.html#a16">00398</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d0/d8/clenum_8c.html#a16">InternalEnumObjects</a>(
00399     HWINSTA hwinsta,
00400     NAMEENUMPROCW lpfn,
00401     LPARAM lParam,
00402     BOOL fAnsi)
00403 {
00404     <a class="code" href="../../d8/d2/structtagNAMELIST.html">PNAMELIST</a> pNameList;
00405     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00406     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cbData;
00407     PWCHAR pwch;
00408     PCHAR pch;
00409     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> achTmp[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00410     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> iRetVal;
00411     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00412     <span class="keywordtype">int</span> cTries;
00413 
00414     <span class="comment">/*</span>
00415 <span class="comment">     * Allocate a buffer to hold the names.</span>
00416 <span class="comment">     */</span>
00417     cbData = 256;
00418     pNameList = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cbData);
00419     <span class="keywordflow">if</span> (pNameList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00420         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00421 
00422     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a293">NtUserBuildNameList</a>(hwinsta, cbData, pNameList, &amp;cbData);
00423 
00424     <span class="comment">/*</span>
00425 <span class="comment">     * If the buffer wasn't big enough, reallocate</span>
00426 <span class="comment">     * the buffer and try again.</span>
00427 <span class="comment">     */</span>
00428     cTries = 0;
00429     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00430         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pNameList);
00431 
00432         <span class="comment">/*</span>
00433 <span class="comment">         * If we can't seem to get it right,</span>
00434 <span class="comment">         * call it quits</span>
00435 <span class="comment">         */</span>
00436         <span class="keywordflow">if</span> (cTries++ == 10)
00437             <span class="keywordflow">break</span>;
00438 
00439         pNameList = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cbData);
00440         <span class="keywordflow">if</span> (pNameList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00441             <span class="keywordflow">break</span>;
00442 
00443         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a293">NtUserBuildNameList</a>(hwinsta, cbData, pNameList, &amp;cbData);
00444     }
00445 
00446     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00447         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pNameList);
00448         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00449     }
00450 
00451     pwch = pNameList-&gt;<a class="code" href="../../d8/d2/structtagNAMELIST.html#o2">awchNames</a>;
00452     pch = achTmp;
00453 
00454     <span class="keywordflow">for</span> (i = 0; i &lt; pNameList-&gt;<a class="code" href="../../d8/d2/structtagNAMELIST.html#o1">cNames</a>; i++) {
00455         <span class="keywordflow">if</span> (fAnsi) {
00456             <span class="keywordflow">if</span> (WCSToMB(pwch, -1, &amp;pch, <span class="keyword">sizeof</span>(achTmp), <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ==
00457                     <span class="keyword">sizeof</span>(achTmp)) {
00458 
00459                 <span class="comment">/*</span>
00460 <span class="comment">                 * The buffer may have overflowed, so force it to be</span>
00461 <span class="comment">                 * allocated.</span>
00462 <span class="comment">                 */</span>
00463                 <span class="keywordflow">if</span> (WCSToMB(pwch, -1, &amp;pch, -1, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) == 0) {
00464                     iRetVal = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00465                     <span class="keywordflow">break</span>;
00466                 }
00467             }
00468             iRetVal = (*(NAMEENUMPROCA)lpfn)(pch, lParam);
00469             <span class="keywordflow">if</span> (pch != achTmp) {
00470                 <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pch);
00471                 pch = achTmp;
00472             }
00473         } <span class="keywordflow">else</span> {
00474             iRetVal = (*(NAMEENUMPROCW)lpfn)(pwch, lParam);
00475         }
00476         <span class="keywordflow">if</span> (!iRetVal)
00477             <span class="keywordflow">break</span>;
00478 
00479         pwch = pwch + wcslen(pwch) + 1;
00480     }
00481 
00482     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pNameList);
00483 
00484     <span class="keywordflow">return</span> iRetVal;
00485 }
00486 
<a name="l00487"></a><a class="code" href="../../d0/d8/clenum_8c.html#a17">00487</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a17">EnumWindowStationsA</a>(
00488     WINSTAENUMPROCA lpEnumFunc,
00489     LPARAM lParam)
00490 {
00491     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a16">InternalEnumObjects</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (NAMEENUMPROCW)lpEnumFunc, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00492 }
00493 
<a name="l00494"></a><a class="code" href="../../d0/d8/clenum_8c.html#a18">00494</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a18">EnumWindowStationsW</a>(
00495     WINSTAENUMPROCW lpEnumFunc,
00496     LPARAM lParam)
00497 {
00498     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a16">InternalEnumObjects</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (NAMEENUMPROCW)lpEnumFunc, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00499 }
00500 
00501 
<a name="l00502"></a><a class="code" href="../../d0/d8/clenum_8c.html#a19">00502</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a19">EnumDesktopsA</a>(
00503     HWINSTA hwinsta,
00504     DESKTOPENUMPROCA lpEnumFunc,
00505     LPARAM lParam)
00506 {
00507     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a16">InternalEnumObjects</a>(hwinsta, (NAMEENUMPROCW)lpEnumFunc, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00508 }
00509 
<a name="l00510"></a><a class="code" href="../../d0/d8/clenum_8c.html#a20">00510</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d0/d8/clenum_8c.html#a20">EnumDesktopsW</a>(
00511     HWINSTA hwinsta,
00512     DESKTOPENUMPROCW lpEnumFunc,
00513     LPARAM lParam)
00514 {
00515     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8/clenum_8c.html#a16">InternalEnumObjects</a>(hwinsta, (NAMEENUMPROCW)lpEnumFunc, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00516 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
