<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: w32/ntuser/kernel/profile.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>profile.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/structtagFASTREGMAP.html">tagFASTREGMAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">tagPROFILEUSERNAME</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a0">PROOT_CPANEL</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a1">PROOT_ACCESS</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a2">PROOT_CURRENTM</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a3">PROOT_CURRENTU</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a4">PROOT_CONTROL</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a5">PROOT_SERVICES</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a6">PROOT_KEYBOARD</a>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">tagFASTREGMAP</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a7">FASTREGMAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">tagFASTREGMAP</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a8">PFASTREGMAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">tagPROFILEUSERNAME</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a17">PROFILEUSERNAME</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">tagPROFILEUSERNAME</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a18">PPROFILEUSERNAME</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a19">InitPreviousUserString</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PUNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a20">CreateProfileUserName</a> (<a class="el" href="../../d5/d1/struct__TL.html">TL</a> *ptl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a21">FreeProfileUserName</a> (PUNICODE_STRING pProfileUserName, <a class="el" href="../../d5/d1/struct__TL.html">TL</a> *ptl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a22">RemoteOpenCacheKeyEx</a> (UINT idSection, ACCESS_MASK amRequest)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a23">OpenCacheKeyEx</a> (PUNICODE_STRING pMapName OPTIONAL, UINT idSection, ACCESS_MASK amRequest, PDWORD pdwPolicyFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a24">CheckDesktopPolicy</a> (PUNICODE_STRING pProfileUserName OPTIONAL, PCWSTR lpKeyName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a25">CheckDesktopPolicyChange</a> (PUNICODE_STRING pProfileUserName OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a26">FastGetProfileDwordW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpKeyName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDefault)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a27">FastGetProfileKeysW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpDefault, LPWSTR *lpReturnedString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a28">FastGetProfileStringW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpKeyName, LPCWSTR lpDefault, LPWSTR lpReturnedString, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cchBuf)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a29">FastGetProfileIntW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpKeyName, UINT nDefault)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a30">FastWriteProfileStringW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpKeyName, LPCWSTR lpString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a31">FastGetProfileIntFromID</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, UINT idKey, int def)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a32">FastGetProfileStringFromIDW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, UINT idKey, LPCWSTR lpDefault, LPWSTR lpReturnedString, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a33">FastWriteProfileValue</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpKeyName, UINT uType, LPBYTE lpStruct, UINT cbSizeStruct)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a34">FastGetProfileValue</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, LPCWSTR lpKeyName, LPBYTE lpDefault, LPBYTE lpReturn, UINT cbSizeReturn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a35">FastGetProfileIntsW</a> (PUNICODE_STRING pProfileUserName OPTIONAL, <a class="el" href="../../d0/d4/structtagPROFINTINFO.html">PPROFINTINFO</a> ppii)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a36">FastUpdateWinIni</a> (PUNICODE_STRING pProfileUserName OPTIONAL, UINT idSection, UINT wKeyNameId, LPWSTR lpszValue)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>CONST PCWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a9">aFastRegRoot</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">FASTREGMAP</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a10">aFastRegMap</a> [PMAP_LAST+1]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> = POLICY_ALL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a12">PreviousUserStringBuf</a> [256]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a13">PreviousUserString</a> = {0, sizeof <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a12">PreviousUserStringBuf</a>, <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a12">PreviousUserStringBuf</a>}</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a14">luidPrevious</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a> [] = L"\\Registry\\User\\.Default"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a16">DefaultUserString</a> = {sizeof <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a> - sizeof(WCHAR), sizeof <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a>, (WCHAR *)<a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a>}</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="w32/ntuser/kernel/profile.c::PROOT_ACCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_ACCESS&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00030">30</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="w32/ntuser/kernel/profile.c::PROOT_CONTROL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_CONTROL&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00033">33</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="w32/ntuser/kernel/profile.c::PROOT_CPANEL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_CPANEL&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00029">29</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="w32/ntuser/kernel/profile.c::PROOT_CURRENTM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_CURRENTM&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00031">31</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="w32/ntuser/kernel/profile.c::PROOT_CURRENTU" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_CURRENTU&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00032">32</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="w32/ntuser/kernel/profile.c::PROOT_KEYBOARD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_KEYBOARD&nbsp;&nbsp;&nbsp;6          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00035">35</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="w32/ntuser/kernel/profile.c::PROOT_SERVICES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROOT_SERVICES&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00034">34</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a7" doxytag="w32/ntuser/kernel/profile.c::FASTREGMAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">tagFASTREGMAP</a>  <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">FASTREGMAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="w32/ntuser/kernel/profile.c::PFASTREGMAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">tagFASTREGMAP</a> * <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">PFASTREGMAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="w32/ntuser/kernel/profile.c::PPROFILEUSERNAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">tagPROFILEUSERNAME</a> * <a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">PPROFILEUSERNAME</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">CreateProfileUserName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="w32/ntuser/kernel/profile.c::PROFILEUSERNAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">tagPROFILEUSERNAME</a>  <a class="el" href="../../d8/d3/structtagPROFILEUSERNAME.html">PROFILEUSERNAME</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a24" doxytag="w32/ntuser/kernel/profile.c::CheckDesktopPolicy" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CheckDesktopPolicy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00426">426</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00095">gdwPolicyFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00092">GetCurrentProcessId</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00048">NT_ERROR</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06843">PMAP_DESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06885">POLICY_MACHINE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06884">POLICY_USER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00430 {
00431     WCHAR          szKey[80];
00432     HANDLE         hKey;
00433     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          cbSize;
00434     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00435     UNICODE_STRING UnicodeString;
00436     KEY_VALUE_BASIC_INFORMATION  KeyInfo;
00437     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dwPolicyFlags = <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> &amp; (<a class="code" href="../../d4/d1/userk_8h.html#a738">POLICY_MACHINE</a> | <a class="code" href="../../d4/d1/userk_8h.html#a737">POLICY_USER</a>);
00438 
00439     <span class="comment">/*</span>
00440 <span class="comment">     * If there is no policy or the caller is winlogon, let it go.</span>
00441 <span class="comment">     */</span>
00442     <span class="keywordflow">if</span> (!dwPolicyFlags || <a class="code" href="../../d4/d1/userk_8h.html#a19">GetCurrentProcessId</a>() == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00443         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00444     }
00445 
00446     <span class="comment">/*</span>
00447 <span class="comment">     * Convert the ID to a string if we need to.</span>
00448 <span class="comment">     */</span>
00449     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpKeyName)) {
00450         <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(lpKeyName), szKey, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKey));
00451         lpKeyName = szKey;
00452     }
00453 
00454 TryAgain:
00455 
00456     <span class="comment">/*</span>
00457 <span class="comment">     * Try to open a key.</span>
00458 <span class="comment">     */</span>
00459     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
00460                                PMAP_DESKTOP,
00461                                KEY_READ,
00462                                &amp;dwPolicyFlags)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00463         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00464     }
00465 
00466     <span class="comment">/*</span>
00467 <span class="comment">     * See if the value exists.</span>
00468 <span class="comment">     */</span>
00469     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, lpKeyName);
00470     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryValueKey(hKey,
00471                              &amp;UnicodeString,
00472                              KeyValueBasicInformation,
00473                              &amp;KeyInfo,
00474                              <span class="keyword">sizeof</span>(KeyInfo),
00475                              &amp;cbSize);
00476 
00477     ZwClose(hKey);
00478 
00479     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a3">NT_ERROR</a>(Status)) {
00480         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00481     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwPolicyFlags) {
00482         <span class="keywordflow">goto</span> TryAgain;
00483     } <span class="keywordflow">else</span> {
00484         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00485     }
00486 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="w32/ntuser/kernel/profile.c::CheckDesktopPolicyChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CheckDesktopPolicyChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>OPTIONAL</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00499">499</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00095">gdwPolicyFlags</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06843">PMAP_DESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06885">POLICY_MACHINE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06884">POLICY_USER</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>00502 {
00503     <span class="keyword">static</span> LARGE_INTEGER  LastMachineWriteTime;
00504     <span class="keyword">static</span> LARGE_INTEGER  LastUserWriteTime;
00505     KEY_BASIC_INFORMATION KeyInfo;
00506     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                  bPolicyChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00507     HANDLE                hKey;
00508     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                 cbSize;
00509     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                 dwPolicyFlags;
00510 
00511     <span class="comment">/*</span>
00512 <span class="comment">     * Check if machine policy has changed since last time we checked.</span>
00513 <span class="comment">     */</span>
00514     dwPolicyFlags = <a class="code" href="../../d4/d1/userk_8h.html#a738">POLICY_MACHINE</a>;
00515     KeyInfo.LastWriteTime.QuadPart = 0;
00516     hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
00517                           PMAP_DESKTOP,
00518                           KEY_READ,
00519                           &amp;dwPolicyFlags);
00520     <span class="keywordflow">if</span> (hKey) {
00521         ZwQueryKey(hKey,
00522                    KeyValueBasicInformation,
00523                    &amp;KeyInfo,
00524                    <span class="keyword">sizeof</span>(KeyInfo),
00525                    &amp;cbSize);
00526         ZwClose(hKey);
00527         <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a738">POLICY_MACHINE</a>;
00528     } <span class="keywordflow">else</span> {
00529         <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a738">POLICY_MACHINE</a>;
00530     }
00531     <span class="keywordflow">if</span> (LastMachineWriteTime.QuadPart != KeyInfo.LastWriteTime.QuadPart) {
00532         LastMachineWriteTime.QuadPart = KeyInfo.LastWriteTime.QuadPart;
00533         bPolicyChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00534     }
00535 
00536     <span class="comment">/*</span>
00537 <span class="comment">     * Check if user policy has changed since last time we checked.</span>
00538 <span class="comment">     */</span>
00539     dwPolicyFlags = <a class="code" href="../../d4/d1/userk_8h.html#a737">POLICY_USER</a>;
00540     KeyInfo.LastWriteTime.QuadPart = 0;
00541     hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
00542                           PMAP_DESKTOP,
00543                           KEY_READ,
00544                           &amp;dwPolicyFlags);
00545     <span class="keywordflow">if</span> (hKey) {
00546         ZwQueryKey(hKey,
00547                    KeyValueBasicInformation,
00548                    &amp;KeyInfo,
00549                    <span class="keyword">sizeof</span>(KeyInfo),
00550                    &amp;cbSize);
00551         ZwClose(hKey);
00552         <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a737">POLICY_USER</a>;
00553     } <span class="keywordflow">else</span> {
00554         <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a737">POLICY_USER</a>;
00555     }
00556     <span class="keywordflow">if</span> (LastUserWriteTime.QuadPart != KeyInfo.LastWriteTime.QuadPart) {
00557         LastUserWriteTime.QuadPart = KeyInfo.LastWriteTime.QuadPart;
00558         bPolicyChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00559     }
00560 
00561     <span class="keywordflow">return</span> bPolicyChanged;
00562 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="w32/ntuser/kernel/profile.c::CreateProfileUserName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PUNICODE_STRING CreateProfileUserName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d1/struct__TL.html">TL</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ptl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">151</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00147">tagPROFILEUSERNAME::awcName</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00148">tagPROFILEUSERNAME::NameString</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a18">PPROFILEUSERNAME</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00097">PreviousUserString</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l01704">ThreadLockPool</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00775">InitUserScreen()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06023">NtUserSetSysColors()</a>, <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00033">PrepareForLogoff()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00883">xxxDesktopWndProc()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01319">xxxInitWindowStation()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l02606">xxxSetIMEShowStatus()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>00152 {
00153     <a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html">PPROFILEUSERNAME</a> pMapName;
00154 
00155     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00156 
00157     pMapName = UserAllocPoolWithQuota(<span class="keyword">sizeof</span> (<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html">PROFILEUSERNAME</a>), TAG_PROFILEUSERNAME);
00158     <span class="keywordflow">if</span> (!pMapName) {
00159         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateProfileUserName: Allocation failed"</span>);
00160         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00161     }
00162 
00163     <a class="code" href="../../d4/d1/userk_8h.html#a137">ThreadLockPool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), pMapName, ptl);
00164     pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o1">NameString</a>.Length = 0;
00165     pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o1">NameString</a>.MaximumLength = <span class="keyword">sizeof</span> (pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o0">awcName</a>);
00166     pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o1">NameString</a>.Buffer = pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o0">awcName</a>;
00167 
00168     <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a19">InitPreviousUserString</a>();
00169 
00170     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>(&amp;pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o1">NameString</a>, &amp;PreviousUserString);
00171     <span class="keywordflow">return</span> &amp;(pMapName-&gt;<a class="code" href="../../d8/d3/structtagPROFILEUSERNAME.html#o1">NameString</a>);
00172 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileDwordW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FastGetProfileDwordW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDefault</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00575">575</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00188">RemoteOpenCacheKeyEx()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02125">IsIMMEnabledSystem()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00565">OpenMultiplePortDevice()</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00026">SetDebugHotKeys()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02249">Win32UserInitialize()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>00580 {
00581     HANDLE         hKey;
00582     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          cbSize;
00583     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dwRet;
00584     LONG           <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00585     UNICODE_STRING UnicodeString;
00586     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>           Buf[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)];
00587 
00588     UserAssert(idSection &lt;= PMAP_LAST);
00589 
00590     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a>) {
00591 
00592         hKey = <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a22">RemoteOpenCacheKeyEx</a>(idSection, KEY_READ);
00593         <span class="keywordflow">if</span> (hKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00594             <span class="keywordflow">goto</span> Override;
00595         }
00596     }
00597 
00598     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
00599                                idSection,
00600                                KEY_READ,
00601                                NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00602         RIPMSG1(RIP_WARNING | RIP_NONAME, <span class="stringliteral">"%ws"</span>, lpKeyName);
00603         <span class="keywordflow">return</span> dwDefault;
00604     }
00605 
00606 Override:
00607 
00608     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, lpKeyName);
00609     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryValueKey(hKey,
00610                              &amp;UnicodeString,
00611                              KeyValuePartialInformation,
00612                              (PKEY_VALUE_PARTIAL_INFORMATION)Buf,
00613                              <span class="keyword">sizeof</span>(Buf),
00614                              &amp;cbSize);
00615 
00616     dwRet = dwDefault;
00617 
00618     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00619 
00620         dwRet = *((PDWORD)((PKEY_VALUE_PARTIAL_INFORMATION)Buf)-&gt;Data);
00621 
00622     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_OBJECT_NAME_NOT_FOUND) {
00623 
00624         RIPMSG1(RIP_WARNING,
00625                 <span class="stringliteral">"FastGetProfileDwordW: ObjectName not found: %ws"</span>,
00626                 lpKeyName);
00627     }
00628 
00629     ZwClose(hKey);
00630 
00631     <span class="keywordflow">return</span> dwRet;
00632 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileIntFromID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FastGetProfileIntFromID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>def</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01031">1031</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00945">FastGetProfileIntW()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01253">LW_LoadProfileInitData()</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00023">MetricGetID()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>01036 {
01037     <span class="keywordtype">int</span>   result;
01038     WCHAR szKey[80];
01039 
01040 
01041     UserAssert(idSection &lt;= PMAP_LAST);
01042 
01043     <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin, idKey, szKey, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKey));
01044 
01045     result = <a class="code" href="../../d4/d1/userk_8h.html#a2008">FastGetProfileIntW</a>(pProfileUserName,idSection, szKey, def);
01046 
01047     <span class="comment">/*</span>
01048 <span class="comment">     * If you change the below list of STR_* make sure you make a</span>
01049 <span class="comment">     * corresponding change in SetWindowMetricInt (rare.c)</span>
01050 <span class="comment">     */</span>
01051     <span class="keywordflow">switch</span> (idKey) {
01052     <span class="keywordflow">case</span> STR_BORDERWIDTH:
01053     <span class="keywordflow">case</span> STR_SCROLLWIDTH:
01054     <span class="keywordflow">case</span> STR_SCROLLHEIGHT:
01055     <span class="keywordflow">case</span> STR_CAPTIONWIDTH:
01056     <span class="keywordflow">case</span> STR_CAPTIONHEIGHT:
01057     <span class="keywordflow">case</span> STR_SMCAPTIONWIDTH:
01058     <span class="keywordflow">case</span> STR_SMCAPTIONHEIGHT:
01059     <span class="keywordflow">case</span> STR_MENUWIDTH:
01060     <span class="keywordflow">case</span> STR_MENUHEIGHT:
01061     <span class="keywordflow">case</span> STR_ICONHORZSPACING:
01062     <span class="keywordflow">case</span> STR_ICONVERTSPACING:
01063     <span class="keywordflow">case</span> STR_MINWIDTH:
01064     <span class="keywordflow">case</span> STR_MINHORZGAP:
01065     <span class="keywordflow">case</span> STR_MINVERTGAP:
01066         <span class="comment">/*</span>
01067 <span class="comment">         * Convert any registry values stored in TWIPS back to pixels</span>
01068 <span class="comment">         */</span>
01069         <span class="keywordflow">if</span> (result &lt; 0)
01070             result = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(-result, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dmLogPixels, 72 * 20);
01071         <span class="keywordflow">break</span>;
01072     }
01073 
01074     <span class="keywordflow">return</span> result;
01075 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileIntsW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FastGetProfileIntsW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/structtagPROFINTINFO.html">PPROFINTINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ppii</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01290">1290</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00945">FastGetProfileIntW()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06824">tagPROFINTINFO::idSection</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06825">tagPROFINTINFO::lpKeyName</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06826">tagPROFINTINFO::nDefault</a>, <a class="el" href="../../d4/d1/userk_8h.html#a959">PPROFINTINFO</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06827">tagPROFINTINFO::puResult</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01079">xxxSetDeskWallpaper()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>01293 {
01294     WCHAR szKey[40];
01295 
01296     <span class="keywordflow">while</span> (ppii-&gt;<a class="code" href="../../d0/d4/structtagPROFINTINFO.html#o0">idSection</a> != 0) {
01297 
01298         <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin,
01299                              <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(ppii-&gt;<a class="code" href="../../d0/d4/structtagPROFINTINFO.html#o1">lpKeyName</a>),
01300                              szKey,
01301                              <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKey));
01302 
01303         *ppii-&gt;<a class="code" href="../../d0/d4/structtagPROFINTINFO.html#o3">puResult</a> = <a class="code" href="../../d4/d1/userk_8h.html#a2008">FastGetProfileIntW</a>(pProfileUserName,
01304                                                  ppii-&gt;<a class="code" href="../../d0/d4/structtagPROFINTINFO.html#o0">idSection</a>,
01305                                                  szKey,
01306                                                  ppii-&gt;<a class="code" href="../../d0/d4/structtagPROFINTINFO.html#o2">nDefault</a>
01307                                                  );
01308         ppii++;
01309     }
01310 
01311     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01312 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileIntW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT FastGetProfileIntW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>nDefault</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00945">945</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00806">FastGetProfileStringW()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00225">RtlUnicodeStringToInteger()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01031">FastGetProfileIntFromID()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01290">FastGetProfileIntsW()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02393">GetKbdLangSwitch()</a>, <a class="el" href="../../d8/d8/keyboard_8c-source.html#l00256">UpdatePerUserKeyboardIndicators()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02314">xxxUpdatePerUserAccessPackSettings()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>00950 {
00951     WCHAR          ValueBuf[40];
00952     UNICODE_STRING Value;
00953     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           ReturnValue;
00954 
00955     UserAssert(idSection &lt;= PMAP_LAST);
00956 
00957     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a2007">FastGetProfileStringW</a>(pProfileUserName,
00958                                idSection,
00959                                lpKeyName,
00960                                NULL,
00961                                ValueBuf,
00962                                <span class="keyword">sizeof</span>(ValueBuf) / <span class="keyword">sizeof</span>(WCHAR)
00963                                )) {
00964 
00965         <span class="keywordflow">return</span> nDefault;
00966     }
00967 
00968     <span class="comment">/*</span>
00969 <span class="comment">     * Convert string to int.</span>
00970 <span class="comment">     */</span>
00971     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Value, ValueBuf);
00972     <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>(&amp;Value, 10, &amp;ReturnValue);
00973 
00974     <span class="keywordflow">return</span> ReturnValue;
00975 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileKeysW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FastGetProfileKeysW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpDefault</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReturnedString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00642">642</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02036">bEnumerateRegistryFonts()</a>.
<p>
<pre class="fragment"><div>00647 {
00648     HANDLE                       hKey;
00649     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                        cchSize;
00650     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                        cchKey;
00651     LONG                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00652     WCHAR                        <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[256 + 6];
00653     PKEY_VALUE_BASIC_INFORMATION pKeyInfo;
00654     ULONG                        iValue;
00655     LPWSTR                       lpTmp;
00656     LPWSTR                       lpKeys = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00657     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                        dwPoolSize;
00658 
00659     UserAssert(idSection &lt;= PMAP_LAST);
00660 
00661     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
00662                                idSection,
00663                                KEY_READ,
00664                                NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00665         RIPMSG0(RIP_WARNING | RIP_NONAME, <span class="stringliteral">""</span>);
00666         <span class="keywordflow">goto</span> DefExit;
00667     }
00668 
00669     pKeyInfo          = (PKEY_VALUE_BASIC_INFORMATION)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00670     cchSize           = 0;
00671     *lpReturnedString = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00672     iValue            = 0;
00673 
00674     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00675 
00676 <span class="preprocessor">#if DBG</span>
00677 <span class="preprocessor"></span>        wcscpy(Buffer + 256, L<span class="stringliteral">"DON'T"</span>);
00678 <span class="preprocessor">#endif</span>
00679 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwEnumerateValueKey(hKey,
00680                                      iValue,
00681                                      KeyValueBasicInformation,
00682                                      pKeyInfo,
00683                                      <span class="keyword">sizeof</span>(Buffer),
00684                                      &amp;cchKey);
00685 
00686         UserAssert(_wcsicmp(Buffer + 256, L<span class="stringliteral">"DON'T"</span>) == 0);
00687 
00688         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MORE_ENTRIES) {
00689 
00690             <span class="keywordflow">break</span>;
00691 
00692         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00693 
00694             <span class="keywordflow">if</span> (lpKeys) {
00695                 UserFreePool(lpKeys);
00696                 lpKeys = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00697             }
00698             <span class="keywordflow">goto</span> DefExit;
00699         }
00700 
00701         UserAssert(pKeyInfo-&gt;NameLength * <span class="keyword">sizeof</span>(WCHAR) &lt;=
00702                    <span class="keyword">sizeof</span>(Buffer) - <span class="keyword">sizeof</span>(KEY_VALUE_BASIC_INFORMATION));
00703 
00704         UserAssert(cchKey &lt;= <span class="keyword">sizeof</span>(Buffer));
00705 
00706         <span class="comment">/*</span>
00707 <span class="comment">         * A key was found.  Allocate space for it.  Note that</span>
00708 <span class="comment">         * NameLength is in bytes.</span>
00709 <span class="comment">         */</span>
00710         cchKey   = cchSize;
00711         cchSize += pKeyInfo-&gt;NameLength + <span class="keyword">sizeof</span>(WCHAR);
00712 
00713         <span class="keywordflow">if</span> (lpKeys == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00714 
00715             dwPoolSize = cchSize + <span class="keyword">sizeof</span>(WCHAR);
00716             lpKeys = UserAllocPoolWithQuota(dwPoolSize, TAG_PROFILE);
00717 
00718         } <span class="keywordflow">else</span> {
00719 
00720             lpTmp = lpKeys;
00721             lpKeys = UserReAllocPoolWithQuota(lpTmp,
00722                                               dwPoolSize,
00723                                               cchSize + <span class="keyword">sizeof</span>(WCHAR),
00724                                               TAG_PROFILE);
00725 
00726             <span class="comment">/*</span>
00727 <span class="comment">             * Free the original buffer if the allocation fails</span>
00728 <span class="comment">             */</span>
00729             <span class="keywordflow">if</span> (lpKeys == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00730                 UserFreePool(lpTmp);
00731             }
00732             dwPoolSize = cchSize + <span class="keyword">sizeof</span>(WCHAR);
00733         }
00734 
00735         <span class="comment">/*</span>
00736 <span class="comment">         * Check for out of memory.</span>
00737 <span class="comment">         */</span>
00738         <span class="keywordflow">if</span> (lpKeys == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00739             <span class="keywordflow">goto</span> DefExit;
00740 
00741         <span class="comment">/*</span>
00742 <span class="comment">         * NULL terminate the string and append it to</span>
00743 <span class="comment">         * the key list.</span>
00744 <span class="comment">         */</span>
00745         UserAssert(pKeyInfo-&gt;NameLength &lt; <span class="keyword">sizeof</span>(Buffer) - <span class="keyword">sizeof</span>(KEY_VALUE_BASIC_INFORMATION));
00746 
00747         RtlCopyMemory(&amp;lpKeys[cchKey / <span class="keyword">sizeof</span>(WCHAR)], pKeyInfo-&gt;Name, pKeyInfo-&gt;NameLength);
00748         lpKeys[(cchKey + pKeyInfo-&gt;NameLength) / <span class="keyword">sizeof</span>(WCHAR)] = 0;
00749 
00750         iValue++;
00751     }
00752 
00753     <span class="comment">/*</span>
00754 <span class="comment">     * If no keys were found, return the default.</span>
00755 <span class="comment">     */</span>
00756     <span class="keywordflow">if</span> (iValue == 0) {
00757 
00758 DefExit:
00759 
00760         cchSize = wcslen(lpDefault)+1;
00761         lpKeys  = UserAllocPoolWithQuota((cchSize+1) * <span class="keyword">sizeof</span>(WCHAR), TAG_PROFILE);
00762 
00763         <span class="keywordflow">if</span> (lpKeys)
00764             wcscpy(lpKeys, lpDefault);
00765         <span class="keywordflow">else</span>
00766             cchSize = 0;
00767 
00768     } <span class="keywordflow">else</span> {
00769 
00770         <span class="comment">/*</span>
00771 <span class="comment">         * Turn the byte count into a char count.</span>
00772 <span class="comment">         */</span>
00773         cchSize /= <span class="keyword">sizeof</span>(WCHAR);
00774     }
00775 
00776     <span class="comment">/*</span>
00777 <span class="comment">     * Make sure hKey is closed.</span>
00778 <span class="comment">     */</span>
00779     <span class="keywordflow">if</span> (hKey)
00780         ZwClose(hKey);
00781 
00782     <span class="comment">/*</span>
00783 <span class="comment">     * Append the ending NULL.</span>
00784 <span class="comment">     */</span>
00785     <span class="keywordflow">if</span> (lpKeys)
00786         lpKeys[cchSize] = 0;
00787 
00788     *lpReturnedString = lpKeys;
00789 
00790     <span class="keywordflow">return</span> cchSize;
00791 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileStringFromIDW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FastGetProfileStringFromIDW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpDefault</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReturnedString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01086">1086</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00806">FastGetProfileStringW()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l00264">GetDeskWallpaperName()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01268">LW_LoadResources()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01508">xxxODI_ColorInit()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01105">xxxSetDeskPattern()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01685">xxxUpdateSystemCursorsFromRegistry()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01735">xxxUpdateSystemIconsFromRegistry()</a>.
<p>
<pre class="fragment"><div>01093 {
01094     WCHAR szKey[80];
01095 
01096     UserAssert(idSection &lt;= PMAP_LAST);
01097 
01098     <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin, idKey, szKey, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKey));
01099 
01100     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a2007">FastGetProfileStringW</a>(pProfileUserName,
01101                                  idSection,
01102                                  szKey,
01103                                  lpDefault,
01104                                  lpReturnedString,
01105                                  cch
01106                                  );
01107 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileStringW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FastGetProfileStringW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpDefault</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReturnedString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cchBuf</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00806">806</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00095">gdwPolicyFlags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00188">RemoteOpenCacheKeyEx()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02036">bEnumerateRegistryFonts()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00945">FastGetProfileIntW()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01086">FastGetProfileStringFromIDW()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01471">InitCreateUserSubsystem()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00565">OpenMultiplePortDevice()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00814">SetAppCompatFlags()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00702">SetAppImeCompatFlags()</a>, and <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02314">xxxUpdatePerUserAccessPackSettings()</a>.
<p>
<pre class="fragment"><div>00813 {
00814     HANDLE                         hKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00815     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                          cbSize;
00816     LONG                           <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00817     UNICODE_STRING                 UnicodeString;
00818     PKEY_VALUE_PARTIAL_INFORMATION pKeyInfo;
00819     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                           bRemoteOverride = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00820     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                          dwPolicyFlags = <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a>;
00821 
00822 
00823     UserAssert(idSection &lt;= PMAP_LAST);
00824     UserAssert(lpKeyName != NULL);
00825 
00826     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a>) {
00827         hKey = <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a22">RemoteOpenCacheKeyEx</a>(idSection, KEY_READ);
00828         <span class="keywordflow">if</span> (hKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00829             bRemoteOverride = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00830             <span class="keywordflow">goto</span> Override;
00831         }
00832     }
00833 
00834 TryAgain:
00835     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
00836                                idSection,
00837                                KEY_READ,
00838                                &amp;dwPolicyFlags)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00839 
00840 <span class="preprocessor">#if DBG</span>
00841 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;UniqueProcessId != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00842             RIPMSG1(RIP_WARNING | RIP_NONAME, <span class="stringliteral">"%ws"</span>, lpKeyName);
00843         }
00844 <span class="preprocessor">#endif</span>
00845 <span class="preprocessor"></span>        <span class="keywordflow">goto</span> DefExit;
00846     }
00847 
00848 Override:
00849 
00850     cbSize = (cchBuf * <span class="keyword">sizeof</span>(WCHAR)) +
00851             FIELD_OFFSET(KEY_VALUE_PARTIAL_INFORMATION, Data);
00852 
00853     <span class="keywordflow">if</span> ((pKeyInfo = UserAllocPoolWithQuota(cbSize, TAG_PROFILE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00854         <span class="keywordflow">goto</span> DefExit;
00855 
00856     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, lpKeyName);
00857     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryValueKey(hKey,
00858                              &amp;UnicodeString,
00859                              KeyValuePartialInformation,
00860                              pKeyInfo,
00861                              cbSize,
00862                              &amp;cbSize);
00863 
00864     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
00865         RIPMSG0(RIP_WARNING, <span class="stringliteral">"FastGetProfileStringW: Buffer overflow"</span>);
00866         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00867     }
00868 
00869     UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || (Status == STATUS_OBJECT_NAME_NOT_FOUND));
00870 
00871     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00872 
00873         <span class="keywordflow">if</span> (pKeyInfo-&gt;DataLength &gt;= <span class="keyword">sizeof</span>(WCHAR)) {
00874 
00875             ((LPWSTR)(pKeyInfo-&gt;Data))[cchBuf - 1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00876             wcscpy(lpReturnedString, (LPWSTR)pKeyInfo-&gt;Data);
00877 
00878         } <span class="keywordflow">else</span> {
00879             <span class="comment">/*</span>
00880 <span class="comment">             * Appears to be a bug with empty strings - only first</span>
00881 <span class="comment">             * byte is set to NULL. (SAS)</span>
00882 <span class="comment">             */</span>
00883             lpReturnedString[0] = TEXT(<span class="charliteral">'\0'</span>);
00884         }
00885 
00886         cchBuf = pKeyInfo-&gt;DataLength;
00887 
00888         UserFreePool(pKeyInfo);
00889 
00890         ZwClose(hKey);
00891 
00892         <span class="comment">/*</span>
00893 <span class="comment">         * data length includes terminating zero [bodind]</span>
00894 <span class="comment">         */</span>
00895         <span class="keywordflow">return</span> (cchBuf / <span class="keyword">sizeof</span>(WCHAR));
00896 
00897     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bRemoteOverride) {
00898         bRemoteOverride = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00899         UserFreePool(pKeyInfo);
00900         ZwClose(hKey);
00901         hKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00902         <span class="keywordflow">goto</span> TryAgain;
00903 
00904     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwPolicyFlags) {
00905         UserFreePool(pKeyInfo);
00906         ZwClose(hKey);
00907         <span class="keywordflow">goto</span> TryAgain;
00908     }
00909 
00910     UserFreePool(pKeyInfo);
00911 
00912 DefExit:
00913 
00914     <span class="comment">/*</span>
00915 <span class="comment">     * Make sure the key is closed.</span>
00916 <span class="comment">     */</span>
00917     <span class="keywordflow">if</span> (hKey)
00918         ZwClose(hKey);
00919 
00920     <span class="comment">/*</span>
00921 <span class="comment">     * wcscopy copies terminating zero, but the length returned by</span>
00922 <span class="comment">     * wcslen does not, so add 1 to be consistent with success</span>
00923 <span class="comment">     * return [bodind]</span>
00924 <span class="comment">     */</span>
00925     <span class="keywordflow">if</span> (lpDefault != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00926         cchBuf = wcslen(lpDefault) + 1;
00927         RtlCopyMemory(lpReturnedString, lpDefault, cchBuf * <span class="keyword">sizeof</span>(WCHAR));
00928         <span class="keywordflow">return</span> cchBuf;
00929     }
00930 
00931     <span class="keywordflow">return</span> 0;
00932 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="w32/ntuser/kernel/profile.c::FastGetProfileValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FastGetProfileValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>lpDefault</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReturn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cbSizeReturn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01173">1173</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00188">RemoteOpenCacheKeyEx()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02269">SERVERSTRINGMAXSIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00719">CreateFontFromWinIni()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01559">CreateSetupNameArray()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l00194">InitScancodeMap()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01173">LoadCPUserPreferences()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00814">SetAppCompatFlags()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>01180 {
01181     HANDLE                         hKey;
01182     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>                           cbSize;
01183     LONG                           <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01184     UNICODE_STRING                 UnicodeString;
01185     PKEY_VALUE_PARTIAL_INFORMATION pKeyInfo;
01186     WCHAR                          szKey[<a class="code" href="../../d4/d1/userk_8h.html#a247">SERVERSTRINGMAXSIZE</a>];
01187     KEY_VALUE_PARTIAL_INFORMATION  KeyInfo;
01188 
01189     UserAssert(idSection &lt;= PMAP_LAST);
01190 
01191     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpKeyName)) {
01192         *szKey = (WCHAR)0;
01193         <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(lpKeyName), szKey, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKey));
01194         UserAssert(*szKey != (WCHAR)0);
01195         lpKeyName = szKey;
01196     }
01197 
01198     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a>) {
01199         hKey = <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a22">RemoteOpenCacheKeyEx</a>(idSection, KEY_READ);
01200         <span class="keywordflow">if</span> (hKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01201             <span class="keywordflow">goto</span> Override;
01202         }
01203     }
01204 
01205     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
01206                                idSection,
01207                                KEY_READ,
01208                                NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01209         <span class="comment">// if hi-word of lpKeName is 0, it is a resource number not a string</span>
01210 
01211         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpKeyName))
01212             RIPMSG1(RIP_WARNING, <span class="stringliteral">"FastGetProfileValue: Failed to open cache-key (%08x)"</span>, lpKeyName);
01213         <span class="keywordflow">else</span>
01214             RIPMSG1(RIP_WARNING | RIP_NONAME, <span class="stringliteral">"%ws"</span>, lpKeyName);
01215 
01216         <span class="keywordflow">goto</span> DefExit;
01217     }
01218 
01219 Override:
01220 
01221     <span class="keywordflow">if</span> (cbSizeReturn == 0) {
01222         cbSize = <span class="keyword">sizeof</span>(KeyInfo);
01223         pKeyInfo = &amp;KeyInfo;
01224     } <span class="keywordflow">else</span> {
01225         cbSize = cbSizeReturn + FIELD_OFFSET(KEY_VALUE_PARTIAL_INFORMATION, Data);
01226         <span class="keywordflow">if</span> ((pKeyInfo = UserAllocPoolWithQuota(cbSize, TAG_PROFILE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01227             <span class="keywordflow">goto</span> DefExit;
01228         }
01229     }
01230 
01231     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, lpKeyName);
01232 
01233     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryValueKey(hKey,
01234                              &amp;UnicodeString,
01235                              KeyValuePartialInformation,
01236                              pKeyInfo,
01237                              cbSize,
01238                              &amp;cbSize);
01239 
01240     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01241 
01242         UserAssert(cbSizeReturn &gt;= pKeyInfo-&gt;DataLength);
01243 
01244         cbSize = pKeyInfo-&gt;DataLength;
01245         RtlCopyMemory(lpReturn, pKeyInfo-&gt;Data, cbSize);
01246 
01247         <span class="keywordflow">if</span> (cbSizeReturn != 0) {
01248             UserFreePool(pKeyInfo);
01249         }
01250         ZwClose(hKey);
01251 
01252         <span class="keywordflow">return</span> cbSize;
01253     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) &amp;&amp; (cbSizeReturn == 0)) {
01254         ZwClose(hKey);
01255         <span class="keywordflow">return</span> pKeyInfo-&gt;DataLength;
01256     }
01257 
01258 <span class="preprocessor">#if DBG</span>
01259 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_OBJECT_NAME_NOT_FOUND) {
01260         RIPMSG3 (RIP_WARNING, <span class="stringliteral">"FastGetProfileValue: ZwQueryValueKey Failed. Status:%#lx idSection:%#lx KeyName:%s"</span>,
01261                 Status, idSection, UnicodeString.Buffer);
01262     }
01263 <span class="preprocessor">#endif</span>
01264 <span class="preprocessor"></span>
01265     <span class="keywordflow">if</span> (cbSizeReturn != 0) {
01266         UserFreePool(pKeyInfo);
01267     }
01268 
01269 DefExit:
01270 
01271     <span class="keywordflow">if</span> (hKey)
01272         ZwClose(hKey);
01273 
01274     <span class="keywordflow">if</span> (lpDefault) {
01275         RtlMoveMemory(lpReturn, lpDefault, cbSizeReturn);
01276         <span class="keywordflow">return</span> cbSizeReturn;
01277     }
01278 
01279     <span class="keywordflow">return</span> 0;
01280 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="w32/ntuser/kernel/profile.c::FastUpdateWinIni" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FastUpdateWinIni           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wKeyNameId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpszValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01323">1323</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">FastWriteProfileStringW()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>01328 {
01329     WCHAR            szKeyName[40];
01330     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>             bResult = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01331 
01332     UserAssert(idSection &lt;= PMAP_LAST);
01333 
01334     <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin,
01335                          wKeyNameId,
01336                          szKeyName,
01337                          <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKeyName));
01338 
01339     bResult = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01340                                           idSection, szKeyName, lpszValue);
01341 
01342     <span class="keywordflow">return</span> bResult;
01343 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="w32/ntuser/kernel/profile.c::FastWriteProfileStringW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FastWriteProfileStringW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">988</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01323">FastUpdateWinIni()</a>, <a class="el" href="../../d8/d8/keyboard_8c-source.html#l00223">RegisterPerUserKeyboardIndicators()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01118">SetFilterKeys()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01170">SetMouseKeys()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01208">SetSoundSentry()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00306">UpdateWinIniInt()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>00993 {
00994     HANDLE         hKey;
00995     LONG           <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00996     UNICODE_STRING UnicodeString;
00997 
00998     UserAssert(idSection &lt;= PMAP_LAST);
00999 
01000     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
01001                                idSection,
01002                                KEY_WRITE,
01003                                NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01004         RIPMSG1(RIP_WARNING | RIP_NONAME, <span class="stringliteral">"%ws"</span>, lpKeyName);
01005         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01006     }
01007 
01008     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, lpKeyName);
01009     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetValueKey(hKey,
01010                            &amp;UnicodeString,
01011                            0,
01012                            REG_SZ,
01013                            (PVOID)lpString,
01014                            (wcslen(lpString) + 1) * <span class="keyword">sizeof</span>(WCHAR));
01015 
01016     ZwClose(hKey);
01017 
01018     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01019 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="w32/ntuser/kernel/profile.c::FastWriteProfileValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FastWriteProfileValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pProfileUserName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStruct</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cbSizeStruct</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01115">1115</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02269">SERVERSTRINGMAXSIZE</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00777">SetWindowMetricFont()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>01122 {
01123     HANDLE         hKey;
01124     LONG           <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01125     UNICODE_STRING UnicodeString;
01126     WCHAR          szKey[<a class="code" href="../../d4/d1/userk_8h.html#a247">SERVERSTRINGMAXSIZE</a>];
01127 
01128     UserAssert(idSection &lt;= PMAP_LAST);
01129 
01130     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpKeyName)) {
01131         *szKey = (WCHAR)0;
01132         <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(lpKeyName), szKey, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szKey));
01133         UserAssert(*szKey != (WCHAR)0);
01134         lpKeyName = szKey;
01135     }
01136 
01137     <span class="keywordflow">if</span> ((hKey = <a class="code" href="../../d4/d1/userk_8h.html#a2002">OpenCacheKeyEx</a>(pProfileUserName,
01138                                idSection,
01139                                KEY_WRITE,
01140                                NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01141         RIPMSG1(RIP_WARNING, <span class="stringliteral">"FastWriteProfileValue: Failed to open cache-key (%ws)"</span>, lpKeyName);
01142         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01143     }
01144 
01145     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, lpKeyName);
01146 
01147     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetValueKey(hKey,
01148                            &amp;UnicodeString,
01149                            0,
01150                            uType,
01151                            lpStruct,
01152                            cbSizeStruct);
01153     ZwClose(hKey);
01154 
01155 <span class="preprocessor">#if DBG</span>
01156 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01157         RIPMSG3 (RIP_WARNING, <span class="stringliteral">"FastWriteProfileValue: ZwSetValueKey Failed. Status:%#lx idSection:%#lx KeyName:%s"</span>,
01158                  Status, idSection, UnicodeString.Buffer);
01159     }
01160 <span class="preprocessor">#endif</span>
01161 <span class="preprocessor"></span>
01162     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01163 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="w32/ntuser/kernel/profile.c::FreeProfileUserName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void FreeProfileUserName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d1/struct__TL.html">TL</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ptl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00174">174</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l01710">ThreadUnlockAndFreePool</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00775">InitUserScreen()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06023">NtUserSetSysColors()</a>, <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00033">PrepareForLogoff()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00883">xxxDesktopWndProc()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01319">xxxInitWindowStation()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l02606">xxxSetIMEShowStatus()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>00174                                                                    {
00175     UNREFERENCED_PARAMETER(ptl);
00176     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00177     <span class="keywordflow">if</span> (pProfileUserName) {
00178         <a class="code" href="../../d4/d1/userk_8h.html#a139">ThreadUnlockAndFreePool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), ptl);
00179     }
00180 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="w32/ntuser/kernel/profile.c::InitPreviousUserString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void InitPreviousUserString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">103</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00101">DefaultUserString</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00050">GetProcessLuid()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00098">luidPrevious</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00656">luidSystem</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00097">PreviousUserString</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00096">PreviousUserStringBuf</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01453">RtlFormatCurrentUserKeyPath()</a>, and <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">CreateProfileUserName()</a>, and <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>.
<p>
<pre class="fragment"><div>00103                                   {
00104     UNICODE_STRING UserString;
00105     LUID           luidCaller;
00106 
00107     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00108 
00109     <span class="comment">/*</span>
00110 <span class="comment">     * Speed hack, check if luid of this process == system or previous to</span>
00111 <span class="comment">     * save work.</span>
00112 <span class="comment">     */</span>
00113     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d4/d1/userk_8h.html#a961">GetProcessLuid</a>(NULL, &amp;luidCaller))) {
00114 
00115         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>(&amp;luidCaller, &amp;luidPrevious)) {
00116             <span class="keywordflow">return</span>;   <span class="comment">// same as last time - no work.</span>
00117         }
00118         <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a14">luidPrevious</a> = luidCaller;
00119 
00120         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>(&amp;luidCaller, &amp;luidSystem))
00121             <span class="keywordflow">goto</span> DefaultUser;
00122 
00123     } <span class="keywordflow">else</span> {
00124         <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a14">luidPrevious</a> = RtlConvertLongToLuid(0);
00125     }
00126 
00127     <span class="comment">/*</span>
00128 <span class="comment">     * Set up current user registry base string.</span>
00129 <span class="comment">     */</span>
00130     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a26">RtlFormatCurrentUserKeyPath</a>(&amp;UserString))) {
00131 
00132 DefaultUser:
00133 
00134         <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>(&amp;PreviousUserString, &amp;DefaultUserString);
00135 
00136     } <span class="keywordflow">else</span> {
00137         UserAssert(<span class="keyword">sizeof</span>(PreviousUserStringBuf) &gt;= UserString.Length + 4);
00138         <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>(&amp;PreviousUserString, &amp;UserString);
00139         <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;UserString);
00140     }
00141 
00142     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;PreviousUserString, L<span class="stringliteral">"\\"</span>);
00143 
00144 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="w32/ntuser/kernel/profile.c::OpenCacheKeyEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE OpenCacheKeyEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING pMapName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>amRequest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pdwPolicyFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">263</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00555">AccessCheckObject()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00052">aFastRegMap</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00042">aFastRegRoot</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00795">gpepInit</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00038">tagFASTREGMAP::idRoot</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00804">KeyMapping</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06843">PMAP_DESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06886">POLICY_ALL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06885">POLICY_MACHINE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06883">POLICY_NONE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06884">POLICY_USER</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00097">PreviousUserString</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01883">RtlAppendUnicodeStringToString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
<pre class="fragment"><div>00269 {
00270     OBJECT_ATTRIBUTES OA;
00271     WCHAR             UnicodeStringBuf[256];
00272     UNICODE_STRING    UnicodeString;
00273     LONG              <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00274     HANDLE            hKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00275     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>         peCurrent = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00276     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>             dwPolicyFlags;
00277 
00278     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00279 
00280     UserAssert(idSection &lt;= PMAP_LAST);
00281 
00282     <span class="comment">/*</span>
00283 <span class="comment">     * If we're opening the desktop key for read access, we should be checking</span>
00284 <span class="comment">     * for relevant policy.</span>
00285 <span class="comment">     */</span>
00286     <span class="keywordflow">if</span> (idSection == <a class="code" href="../../d4/d1/userk_8h.html#a698">PMAP_DESKTOP</a> &amp;&amp; amRequest == KEY_READ &amp;&amp; pdwPolicyFlags) {
00287         UserAssert(!(*pdwPolicyFlags &amp; ~POLICY_ALL));
00288         dwPolicyFlags = *pdwPolicyFlags;
00289     } <span class="keywordflow">else</span> {
00290         dwPolicyFlags = <a class="code" href="../../d4/d1/userk_8h.html#a736">POLICY_NONE</a>;
00291     }
00292 
00293 TryAgain:
00294 
00295     UnicodeString.Length        = 0;
00296     UnicodeString.MaximumLength = <span class="keyword">sizeof</span>(UnicodeStringBuf);
00297     UnicodeString.Buffer        = UnicodeStringBuf;
00298 
00299 
00300     <span class="keywordflow">if</span> (dwPolicyFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a738">POLICY_MACHINE</a>) {
00301         dwPolicyFlags &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a738">POLICY_MACHINE</a>;
00302         <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00303                                  L<span class="stringliteral">"\\Registry\\Machine\\"</span>);
00304         <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00305                                  L<span class="stringliteral">"Software\\Policies\\Microsoft\\Windows\\"</span>);
00306     } <span class="keywordflow">else</span> {
00307         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a9">aFastRegRoot</a>[<a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a10">aFastRegMap</a>[idSection].<a class="code" href="../../d1/d5/structtagFASTREGMAP.html#o0">idRoot</a>][0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'M'</span>) {
00308             <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, L<span class="stringliteral">"\\Registry\\Machine\\"</span>);
00309         } <span class="keywordflow">else</span> {
00310             <span class="keywordflow">if</span> (!pMapName) {
00311                 <a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a19">InitPreviousUserString</a>();
00312                 <a class="code" href="../../d6/d6/nls_8c.html#a46">RtlAppendUnicodeStringToString</a>(
00313                     &amp;UnicodeString,
00314                     &amp;PreviousUserString);
00315             } <span class="keywordflow">else</span> {
00316                 <a class="code" href="../../d6/d6/nls_8c.html#a46">RtlAppendUnicodeStringToString</a>(
00317                     &amp;UnicodeString,
00318                     pMapName);
00319             }
00320         }
00321         <span class="keywordflow">if</span> (dwPolicyFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a737">POLICY_USER</a>) {
00322             dwPolicyFlags &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a737">POLICY_USER</a>;
00323             <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00324                                      L<span class="stringliteral">"Software\\Policies\\Microsoft\\Windows\\"</span>);
00325         } <span class="keywordflow">else</span> {
00326             dwPolicyFlags &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a736">POLICY_NONE</a>;
00327         }
00328 
00329     }
00330 
00331     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00332                              (PWSTR)&amp;aFastRegRoot[aFastRegMap[idSection].idRoot][1]);
00333 
00334     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00335                              (PWSTR)aFastRegMap[idSection].szSection);
00336 
00337 
00338     <span class="comment">/*</span>
00339 <span class="comment">     * Open the key for kernel mode access</span>
00340 <span class="comment">     */</span>
00341     InitializeObjectAttributes(&amp;OA,
00342                                &amp;UnicodeString,
00343                                OBJ_CASE_INSENSITIVE | OBJ_KERNEL_HANDLE,
00344                                NULL,
00345                                NULL);
00346 
00347     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey(&amp;hKey, amRequest, &amp;OA);
00348 
00349     <span class="keywordflow">if</span> (
00350         (amRequest == KEY_READ)   ||     <span class="comment">/*</span>
00351 <span class="comment">                                          * We must be able to read</span>
00352 <span class="comment">                                          * our registry settings.</span>
00353 <span class="comment">                                          */</span>
00354         (peCurrent == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a>)  ||
00355         (peCurrent == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a300">gpepInit</a>)
00356              ) {
00357 
00358     } <span class="keywordflow">else</span> {
00359         <span class="comment">/*</span>
00360 <span class="comment">         * Now check if the user has access to the key</span>
00361 <span class="comment">         */</span>
00362 
00363         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00364             PVOID pKey;
00365             <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> Status2;
00366             Status2 = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(hKey,
00367                                         amRequest,
00368                                         NULL,
00369                                         KernelMode,
00370                                         &amp;pKey,
00371                                         NULL);
00372 
00373             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status2)) {
00374                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1271">AccessCheckObject</a>(pKey, amRequest, UserMode, &amp;KeyMapping)) {
00375                     ZwClose(hKey);
00376                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
00377                 }
00378                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(pKey);
00379             } <span class="keywordflow">else</span> {
00380                 ZwClose(hKey);
00381                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
00382             }
00383         }
00384 
00385     }
00386 
00387 <span class="preprocessor">#if DBG</span>
00388 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00389         UnicodeStringBuf[UnicodeString.Length / 2] = 0;
00390 
00391         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;UniqueProcessId != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00392             RIPMSG1(RIP_WARNING | RIP_THERESMORE, <span class="stringliteral">"OpenCacheKeyEx failed with Status = %lx key:"</span>, Status);
00393             RIPMSG1(RIP_WARNING | RIP_THERESMORE | RIP_NONAME | RIP_NONEWLINE, <span class="stringliteral">" %ws\\"</span>, UnicodeStringBuf);
00394         }
00395     }
00396 <span class="preprocessor">#endif DBG</span>
00397 <span class="preprocessor"></span>
00398     <span class="comment">/*</span>
00399 <span class="comment">     * If we didn't succeed and we're not down to bottom of policy chain, try again.</span>
00400 <span class="comment">     */</span>
00401     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; dwPolicyFlags) {
00402         <span class="keywordflow">goto</span> TryAgain;
00403     }
00404 
00405     <span class="comment">/*</span>
00406 <span class="comment">     * Update policy level</span>
00407 <span class="comment">     */</span>
00408     <span class="keywordflow">if</span> (pdwPolicyFlags) {
00409         *pdwPolicyFlags = dwPolicyFlags;
00410     }
00411 
00412     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ? hKey : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00413 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="w32/ntuser/kernel/profile.c::RemoteOpenCacheKeyEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE RemoteOpenCacheKeyEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>amRequest</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00188">188</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
References <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00052">aFastRegMap</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00042">aFastRegRoot</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00967">gstrBaseWinStationName</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00038">tagFASTREGMAP::idRoot</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06879">PMAP_LAST</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00575">FastGetProfileDwordW()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00806">FastGetProfileStringW()</a>, and <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01173">FastGetProfileValue()</a>.
<p>
<pre class="fragment"><div>00191 {
00192     OBJECT_ATTRIBUTES OA;
00193     WCHAR             UnicodeStringBuf[512];
00194     UNICODE_STRING    UnicodeString;
00195     LONG              <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00196     HANDLE            hKey;
00197 
00198     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00199 
00200     UserAssert(gbRemoteSession == TRUE);
00201 
00202     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a9">aFastRegRoot</a>[<a class="code" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a10">aFastRegMap</a>[idSection].<a class="code" href="../../d1/d5/structtagFASTREGMAP.html#o0">idRoot</a>][0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'M'</span>)
00203         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00204 
00205     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a351">gstrBaseWinStationName</a>[0] == 0)
00206         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00207 
00208     <span class="keywordflow">if</span> (amRequest != KEY_READ)
00209         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00210 
00211     UserAssert(idSection &lt;= PMAP_LAST);
00212     UnicodeString.Length        = 0;
00213     UnicodeString.MaximumLength = <span class="keyword">sizeof</span>(UnicodeStringBuf);
00214     UnicodeString.Buffer        = UnicodeStringBuf;
00215 
00216     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, L<span class="stringliteral">"\\Registry\\Machine\\"</span>);
00217     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, WINSTATION_REG_NAME);
00218 
00219     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, L<span class="stringliteral">"\\"</span>);
00220     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, gstrBaseWinStationName);
00221     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, L<span class="stringliteral">"\\"</span>);
00222     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, WIN_USEROVERRIDE);
00223     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString, L<span class="stringliteral">"\\"</span>);
00224 
00225     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00226                                       (PWSTR)(&amp;aFastRegRoot[aFastRegMap[idSection].idRoot][1]));
00227     UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00228 
00229     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;UnicodeString,
00230                                       (PWSTR)(aFastRegMap[idSection].szSection));
00231     UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00232 
00233     <span class="comment">/*</span>
00234 <span class="comment">     * Open the key for kernel mode access</span>
00235 <span class="comment">     */</span>
00236     InitializeObjectAttributes(&amp;OA,
00237                                &amp;UnicodeString,
00238                                OBJ_CASE_INSENSITIVE,
00239                                NULL,
00240                                NULL);
00241 
00242     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey(&amp;hKey, amRequest, &amp;OA);
00243 
00244     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ? hKey : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00245 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a10" doxytag="w32/ntuser/kernel/profile.c::aFastRegMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST <a class="el" href="../../d1/d5/structtagFASTREGMAP.html">FASTREGMAP</a> <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a10">aFastRegMap</a>[PMAP_LAST+1]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00052">52</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>, and <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00188">RemoteOpenCacheKeyEx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="w32/ntuser/kernel/profile.c::aFastRegRoot" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST PCWSTR <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a9">aFastRegRoot</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"UControl Panel\\"</span>,                                    
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"UControl Panel\\Accessibility\\"</span>,                     
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MSoftware\\Microsoft\\Windows NT\\CurrentVersion\\"</span>,  
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"USoftware\\Microsoft\\Windows NT\\CurrentVersion\\"</span>,  
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MSystem\\CurrentControlSet\\Control\\"</span>,               
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MSystem\\CurrentControlSet\\Services\\"</span>,              
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"UKeyboard Layout\\"</span>,                                  
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00042">42</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>, and <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00188">RemoteOpenCacheKeyEx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="w32/ntuser/kernel/profile.c::DefaultUserString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a16">DefaultUserString</a> = {sizeof <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a> - sizeof(WCHAR), sizeof <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a>, (WCHAR *)<a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a>}          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00101">101</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="w32/ntuser/kernel/profile.c::gdwPolicyFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a11">gdwPolicyFlags</a> = POLICY_ALL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00095">95</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00426">CheckDesktopPolicy()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00499">CheckDesktopPolicyChange()</a>, and <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00806">FastGetProfileStringW()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="w32/ntuser/kernel/profile.c::luidPrevious" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a14">luidPrevious</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00098">98</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="w32/ntuser/kernel/profile.c::PreviousUserString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a13">PreviousUserString</a> = {0, sizeof <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a12">PreviousUserStringBuf</a>, <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a12">PreviousUserStringBuf</a>}          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00097">97</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">CreateProfileUserName()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>, and <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="w32/ntuser/kernel/profile.c::PreviousUserStringBuf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a12">PreviousUserStringBuf</a>[256]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00096">96</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="w32/ntuser/kernel/profile.c::wszDefaultUser" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST WCHAR <a class="el" href="../../d1/d7/w32_2ntuser_2kernel_2profile_8c.html#a15">wszDefaultUser</a>[] = L"\\Registry\\User\\.Default"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00100">100</a> of file <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html">w32/ntuser/kernel/profile.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:20 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
