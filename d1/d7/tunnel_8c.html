<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tunnel.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tunnel.c File Reference</h1><code>#include "FsRtlP.h"</code><br>

<p>
<a href="../../d2/d6/tunnel_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a0">INLINE</a>&nbsp;&nbsp;&nbsp;__inline</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a1">TUNNEL_KEY_NAME</a>&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\FileSystem"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a2">TUNNEL_AGE_VALUE_NAME</a>&nbsp;&nbsp;&nbsp;L"MaximumTunnelEntryAgeInSeconds"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a3">TUNNEL_SIZE_VALUE_NAME</a>&nbsp;&nbsp;&nbsp;L"MaximumTunnelEntries"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a4">KEY_WORK_AREA</a>&nbsp;&nbsp;&nbsp;((sizeof(KEY_VALUE_FULL_INFORMATION) + sizeof(ULONG)) + 64)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a5">MAX_LOOKASIDE_DEPTH</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a6">LOOKASIDE_NODE_SIZE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a7">TUNNEL_FLAG_NON_LOOKASIDE</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a8">TUNNEL_FLAG_KEY_SHORT</a>&nbsp;&nbsp;&nbsp;0x2</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a13">FsRtlGetTunnelParameterValue</a> (IN PUNICODE_STRING <a class="el" href="../../d8/d2/rtrenval_8c.html#a3">ValueName</a>, IN OUT PULONG Value)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a14">FsRtlPruneTunnelCache</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache, IN OUT PLIST_ENTRY FreePoolList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>INLINE LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a15">FsRtlCompareNodeAndKey</a> (<a class="el" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a> *Node, ULONGLONG DirectoryKey, PUNICODE_STRING <a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>INLINE VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a16">FsRtlFreeTunnelNode</a> (<a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node, PLIST_ENTRY FreePoolList OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>INLINE VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a17">FsRtlEmptyFreePoolList</a> (PLIST_ENTRY FreePoolList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>INLINE VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a18">FsRtlRemoveNodeFromTunnel</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache, IN <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node, IN PLIST_ENTRY FreePoolList, IN PBOOLEAN Splay OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a19">FsRtlInitializeTunnels</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a20">FsRtlInitializeTunnelCache</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a21">FsRtlAddToTunnelCache</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache, IN ULONGLONG DirKey, IN PUNICODE_STRING ShortName, IN PUNICODE_STRING LongName, IN BOOLEAN KeyByShortName, IN ULONG DataLength, IN PVOID Data)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a22">FsRtlFindInTunnelCache</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache, IN ULONGLONG DirKey, IN PUNICODE_STRING <a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a>, OUT PUNICODE_STRING ShortName, OUT PUNICODE_STRING LongName, IN OUT PULONG DataLength, OUT PVOID Data)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a23">FsRtlDeleteKeyFromTunnelCache</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache, IN ULONGLONG DirKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a24">FsRtlDeleteTunnelCache</a> (IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a> Cache)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PAGED_LOOKASIDE_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/tunnel_8c.html#a11">TunnelLookasideList</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="tunnel.c::INLINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INLINE&nbsp;&nbsp;&nbsp;__inline          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00063">63</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="tunnel.c::KEY_WORK_AREA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY_WORK_AREA&nbsp;&nbsp;&nbsp;((sizeof(KEY_VALUE_FULL_INFORMATION) + sizeof(ULONG)) + 64)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00073">73</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="tunnel.c::LOOKASIDE_NODE_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LOOKASIDE_NODE_SIZE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>) +     \
                                  <span class="keyword">sizeof</span>(WCHAR)*(8+1+3) +   \
                                  <span class="keyword">sizeof</span>(WCHAR)*(16) +      \
                                  <span class="keyword">sizeof</span>(ULONGLONG) )
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00093">93</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="tunnel.c::MAX_LOOKASIDE_DEPTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_LOOKASIDE_DEPTH&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00091">91</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="tunnel.c::TUNNEL_AGE_VALUE_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TUNNEL_AGE_VALUE_NAME&nbsp;&nbsp;&nbsp;L"MaximumTunnelEntryAgeInSeconds"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00071">71</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="tunnel.c::TUNNEL_FLAG_KEY_SHORT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TUNNEL_FLAG_KEY_SHORT&nbsp;&nbsp;&nbsp;0x2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00103">103</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00218">FsRtlCompareNodeAndKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="tunnel.c::TUNNEL_FLAG_NON_LOOKASIDE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TUNNEL_FLAG_NON_LOOKASIDE&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00102">102</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="tunnel.c::TUNNEL_KEY_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TUNNEL_KEY_NAME&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\FileSystem"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00070">70</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01371">FsRtlGetTunnelParameterValue()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="tunnel.c::TUNNEL_SIZE_VALUE_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TUNNEL_SIZE_VALUE_NAME&nbsp;&nbsp;&nbsp;L"MaximumTunnelEntries"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00072">72</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a12" doxytag="tunnel.c::PTUNNEL_NODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef   * <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01086">FsRtlDeleteKeyFromTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01226">FsRtlDeleteTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00297">FsRtlEmptyFreePoolList()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">FsRtlFindInTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">FsRtlPruneTunnelCache()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="tunnel.c::FsRtlAddToTunnelCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlAddToTunnelCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cache</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DirKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ShortName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>LongName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyByShortName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DataLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">584</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d0/d1/lboxctl2_8c-source.html#l02757">Compare()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00906">ExAllocateFromPagedLookasideList()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00218">FsRtlCompareNodeAndKey()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00297">FsRtlEmptyFreePoolList()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">FsRtlPruneTunnelCache()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00153">KeQuerySystemTime()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00093">LOOKASIDE_NODE_SIZE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00505">SetFlag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00103">TUNNEL_FLAG_KEY_SHORT</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00102">TUNNEL_FLAG_NON_LOOKASIDE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00090">TunnelLookasideList</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">TunnelMaxEntries</a>.
<p>
<pre class="fragment"><div>00595                    :
00596 
00597     Adds an entry to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache keyed by
00598 
00599         DirectoryKey ## (KeyByShortName ? ShortName : LongName)
00600 
00601     ShortName, LongName, and Data are copied and stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel. As a side
00602     effect, <span class="keywordflow">if</span> there are too many entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache, <span class="keyword">this</span> routine will
00603     initiate expiration in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache.
00604 
00605 Arguments:
00606 
00607     Cache - a tunnel cache initialized by <a class="code" href="../../d1/d8/fsrtl_8h.html#a126">FsRtlInitializeTunnelCache</a>()
00608 
00609     DirKey - the key value of the directory the name appeared in
00610 
00611     ShortName - (optional if !KeyByShortName) the 8.3 name of the file
00612 
00613     LongName - (optional if KeyByShortName) the <span class="keywordtype">long</span> name of the file
00614 
00615     KeyByShortName - specifies which name is keyed in the tunnel cache
00616 
00617     DataLength - specifies the length of the opaque data segment (file
00618     system specific) which contains the tunnelling information for this
00619     file
00620 
00621     Data - pointer to the opaque tunneling data segment
00622 
00623 Return Value:
00624 
00625     None
00626 
00627 --*/
00628 {
00629     LONG <a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a>;
00630     ULONG NodeSize;
00631     PUNICODE_STRING NameKey;
00632     PRTL_SPLAY_LINKS *Links;
00633     LIST_ENTRY FreePoolList;
00634 
00635     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00636     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> NewNode = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00637     BOOLEAN FreeOldNode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00638     BOOLEAN AllocatedFromPool = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00639 
00640     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00641 
00642     <span class="comment">//</span>
00643     <span class="comment">//  If MaxEntries is 0 then tunneling is disabled.</span>
00644     <span class="comment">//</span>
00645 
00646     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> == 0) <span class="keywordflow">return</span>;
00647 
00648     InitializeListHead(&amp;FreePoolList);
00649 
00650     <span class="comment">//</span>
00651     <span class="comment">//  Grab a new node for this data</span>
00652     <span class="comment">//</span>
00653 
00654     NodeSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>) + ShortName-&gt;Length + LongName-&gt;Length + DataLength;
00655 
00656     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a6">LOOKASIDE_NODE_SIZE</a> &gt;= NodeSize) {
00657 
00658         NewNode = <a class="code" href="../../d5/d8/ex_8h.html#a252">ExAllocateFromPagedLookasideList</a>(&amp;TunnelLookasideList);
00659     }
00660 
00661     <span class="keywordflow">if</span> (NewNode == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00662 
00663         <span class="comment">//</span>
00664         <span class="comment">//  Data doesn't fit in lookaside nodes</span>
00665         <span class="comment">//</span>
00666 
00667         NewNode = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, NodeSize, 'PnuT');
00668 
00669         <span class="keywordflow">if</span> (NewNode == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00670 
00671             <span class="comment">//</span>
00672             <span class="comment">//  Give up tunneling this entry</span>
00673             <span class="comment">//</span>
00674 
00675             <span class="keywordflow">return</span>;
00676         }
00677 
00678         AllocatedFromPool = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00679     }
00680 
00681     <span class="comment">//</span>
00682     <span class="comment">//  Traverse the cache to find our insertion point</span>
00683     <span class="comment">//</span>
00684 
00685     NameKey = (KeyByShortName ? ShortName : LongName);
00686 
00687     ExAcquireFastMutex(&amp;Cache-&gt;Mutex);
00688 
00689     Links = &amp;Cache-&gt;Cache;
00690 
00691     <span class="keywordflow">while</span> (*Links) {
00692 
00693         Node = CONTAINING_RECORD(*Links, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, CacheLinks);
00694 
00695         <a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> = <a class="code" href="../../d1/d7/tunnel_8c.html#a15">FsRtlCompareNodeAndKey</a>(Node, DirKey, NameKey);
00696 
00697         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> &gt; 0) {
00698 
00699             Links = &amp;RtlLeftChild(&amp;Node-&gt;CacheLinks);
00700 
00701         } <span class="keywordflow">else</span> {
00702 
00703             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> &lt; 0) {
00704 
00705                 Links = &amp;RtlRightChild(&amp;Node-&gt;CacheLinks);
00706 
00707             } <span class="keywordflow">else</span> {
00708 
00709                 <span class="keywordflow">break</span>;
00710             }
00711         }
00712     }
00713 
00714     <span class="comment">//</span>
00715     <span class="comment">//  Thread new data into the splay tree</span>
00716     <span class="comment">//</span>
00717 
00718     RtlInitializeSplayLinks(&amp;NewNode-&gt;CacheLinks);
00719 
00720     <span class="keywordflow">if</span> (Node) {
00721 
00722         <span class="comment">//</span>
00723         <span class="comment">//  Not inserting first node in tree</span>
00724         <span class="comment">//</span>
00725 
00726         <span class="keywordflow">if</span> (*Links) {
00727 
00728             <span class="comment">//</span>
00729             <span class="comment">//  Entry exists in the cache, so replace by swapping all splay links</span>
00730             <span class="comment">//</span>
00731 
00732             RtlRightChild(&amp;NewNode-&gt;CacheLinks) = RtlRightChild(*Links);
00733             RtlLeftChild(&amp;NewNode-&gt;CacheLinks) = RtlLeftChild(*Links);
00734 
00735             <span class="keywordflow">if</span> (RtlRightChild(*Links)) RtlParent(RtlRightChild(*Links)) = &amp;NewNode-&gt;CacheLinks;
00736             <span class="keywordflow">if</span> (RtlLeftChild(*Links)) RtlParent(RtlLeftChild(*Links)) = &amp;NewNode-&gt;CacheLinks;
00737 
00738             <span class="keywordflow">if</span> (!RtlIsRoot(*Links)) {
00739 
00740                 <span class="comment">//</span>
00741                 <span class="comment">//  Change over the parent links. Note that we've messed with *Links now</span>
00742                 <span class="comment">//  since it is pointing at the parent member.</span>
00743                 <span class="comment">//</span>
00744 
00745                 RtlParent(&amp;NewNode-&gt;CacheLinks) = RtlParent(*Links);
00746 
00747                 <span class="keywordflow">if</span> (RtlIsLeftChild(*Links)) {
00748 
00749                     RtlLeftChild(RtlParent(*Links)) = &amp;NewNode-&gt;CacheLinks;
00750 
00751                 } <span class="keywordflow">else</span> {
00752 
00753                     RtlRightChild(RtlParent(*Links)) = &amp;NewNode-&gt;CacheLinks;
00754                 }
00755 
00756             } <span class="keywordflow">else</span> {
00757 
00758                 <span class="comment">//</span>
00759                 <span class="comment">//  Set root of the cache</span>
00760                 <span class="comment">//</span>
00761 
00762                 Cache-&gt;Cache = &amp;NewNode-&gt;CacheLinks;
00763             }
00764 
00765             <span class="comment">//</span>
00766             <span class="comment">//  Free old node</span>
00767             <span class="comment">//</span>
00768 
00769             RemoveEntryList(&amp;Node-&gt;ListLinks);
00770 
00771             <a class="code" href="../../d1/d7/tunnel_8c.html#a16">FsRtlFreeTunnelNode</a>(Node, &amp;FreePoolList);
00772 
00773             Cache-&gt;NumEntries--;
00774 
00775         } <span class="keywordflow">else</span> {
00776 
00777             <span class="comment">//</span>
00778             <span class="comment">//  Simple insertion as a leaf</span>
00779             <span class="comment">//</span>
00780 
00781             NewNode-&gt;CacheLinks.Parent = &amp;Node-&gt;CacheLinks;
00782             *Links = &amp;NewNode-&gt;CacheLinks;
00783         }
00784 
00785     } <span class="keywordflow">else</span> {
00786 
00787         Cache-&gt;Cache = &amp;NewNode-&gt;CacheLinks;
00788     }
00789 
00790     <span class="comment">//</span>
00791     <span class="comment">//  Thread onto the timer list</span>
00792     <span class="comment">//</span>
00793 
00794     <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a3">KeQuerySystemTime</a>(&amp;NewNode-&gt;CreateTime);
00795     InsertTailList(&amp;Cache-&gt;TimerQueue, &amp;NewNode-&gt;ListLinks);
00796 
00797     Cache-&gt;NumEntries++;
00798 
00799     <span class="comment">//</span>
00800     <span class="comment">//  Stash tunneling information</span>
00801     <span class="comment">//</span>
00802 
00803     NewNode-&gt;DirKey = DirKey;
00804 
00805     <span class="keywordflow">if</span> (KeyByShortName) {
00806 
00807         NewNode-&gt;Flags = <a class="code" href="../../d1/d7/tunnel_8c.html#a8">TUNNEL_FLAG_KEY_SHORT</a>;
00808 
00809     } <span class="keywordflow">else</span> {
00810 
00811         NewNode-&gt;Flags = 0;
00812     }
00813 
00814     <span class="comment">//</span>
00815     <span class="comment">//  Initialize the internal UNICODE_STRINGS to point at the buffer segments. For various</span>
00816     <span class="comment">//  reasons (UNICODE APIs are incomplete, we're avoiding calling any allocate routine more</span>
00817     <span class="comment">//  than once, UNICODE strings are not guaranteed to be null terminated) we have to do a lot</span>
00818     <span class="comment">//  of this by hand.</span>
00819     <span class="comment">//</span>
00820     <span class="comment">//  The data is layed out like this in the allocated block:</span>
00821     <span class="comment">//</span>
00822     <span class="comment">//  -----------------------------------------------------------------------------------</span>
00823     <span class="comment">//  | TUNNEL_NODE | Node-&gt;ShortName.Buffer | Node-&gt;LongName.Buffer | Node-&gt;TunnelData |</span>
00824     <span class="comment">//  -----------------------------------------------------------------------------------</span>
00825     <span class="comment">//</span>
00826 
00827     NewNode-&gt;ShortName.Buffer = (PWCHAR)((PCHAR)NewNode + <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>));
00828     NewNode-&gt;LongName.Buffer = (PWCHAR)((PCHAR)NewNode + <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>) + ShortName-&gt;Length);
00829 
00830     NewNode-&gt;ShortName.Length = NewNode-&gt;ShortName.MaximumLength = ShortName-&gt;Length;
00831     NewNode-&gt;LongName.Length = NewNode-&gt;LongName.MaximumLength = LongName-&gt;Length;
00832 
00833     <span class="keywordflow">if</span> (ShortName-&gt;Length) {
00834 
00835         RtlCopyMemory(NewNode-&gt;ShortName.Buffer, ShortName-&gt;Buffer, ShortName-&gt;Length);
00836     }
00837 
00838     <span class="keywordflow">if</span> (LongName-&gt;Length) {
00839 
00840         RtlCopyMemory(NewNode-&gt;LongName.Buffer, LongName-&gt;Buffer, LongName-&gt;Length);
00841     }
00842 
00843     NewNode-&gt;TunnelData = (PVOID)((PCHAR)NewNode + <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>) + ShortName-&gt;Length + LongName-&gt;Length);
00844 
00845     NewNode-&gt;TunnelDataLength = DataLength;
00846 
00847     RtlCopyMemory(NewNode-&gt;TunnelData, Data, DataLength);
00848 
00849     <span class="keywordflow">if</span> (AllocatedFromPool) {
00850 
00851         <a class="code" href="../../d5/d5/cc_8h.html#a60">SetFlag</a>(NewNode-&gt;Flags, TUNNEL_FLAG_NON_LOOKASIDE);
00852     }
00853 
00854 <span class="preprocessor">#if defined(TUNNELTEST) || defined (KEYVIEW)</span>
00855 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FsRtlAddToTunnelCache:\n"</span>);
00856     DumpNode(NewNode, 1);
00857 <span class="preprocessor">#ifndef KEYVIEW</span>
00858 <span class="preprocessor"></span>    DumpTunnel(Cache);
00859 <span class="preprocessor">#endif</span>
00860 <span class="preprocessor"></span><span class="preprocessor">#endif // TUNNELTEST</span>
00861 <span class="preprocessor"></span>
00862     <span class="comment">//</span>
00863     <span class="comment">//  Clean out the cache, release, and then drop any pool memory we need to</span>
00864     <span class="comment">//</span>
00865 
00866     <a class="code" href="../../d1/d7/tunnel_8c.html#a14">FsRtlPruneTunnelCache</a>(Cache, &amp;FreePoolList);
00867 
00868     ExReleaseFastMutex(&amp;Cache-&gt;Mutex);
00869 
00870     <a class="code" href="../../d1/d7/tunnel_8c.html#a17">FsRtlEmptyFreePoolList</a>(&amp;FreePoolList);
00871 
00872     <span class="keywordflow">return</span>;
00873 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="tunnel.c::FsRtlCompareNodeAndKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INLINE LONG FsRtlCompareNodeAndKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Name</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00218">218</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00140">TUNNEL_NODE::DirKey</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00146">TUNNEL_NODE::Flags</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00152">TUNNEL_NODE::LongName</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01520">RtlCompareUnicodeString()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00153">TUNNEL_NODE::ShortName</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00103">TUNNEL_FLAG_KEY_SHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">FsRtlFindInTunnelCache()</a>.
<p>
<pre class="fragment"><div>00225                    :
00226 
00227     <a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> a tunnel node with a key/name pair
00228 
00229 Arguments:
00230 
00231     Node              - a tunnel node
00232 
00233     DirectoryKey      - a key value
00234 
00235     <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>              - a filename
00236 
00237 Return Value:
00238 
00239     Signed comparison result
00240 
00241 --*/
00242 
00243 {
00244     <span class="keywordflow">return</span>  (Node-&gt;<a class="code" href="../../d5/d1/structTUNNEL__NODE.html#o3">DirKey</a> &gt; DirectoryKey ?  1 :
00245             (Node-&gt;<a class="code" href="../../d5/d1/structTUNNEL__NODE.html#o3">DirKey</a> &lt; DirectoryKey ? -1 :
00246             <a class="code" href="../../d6/d6/nls_8c.html#a41">RtlCompareUnicodeString</a>((<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Node-&gt;<a class="code" href="../../d5/d1/structTUNNEL__NODE.html#o4">Flags</a>, TUNNEL_FLAG_KEY_SHORT) ?
00247                                         &amp;Node-&gt;<a class="code" href="../../d5/d1/structTUNNEL__NODE.html#o6">ShortName</a> : &amp;Node-&gt;<a class="code" href="../../d5/d1/structTUNNEL__NODE.html#o5">LongName</a>),
00248                                     Name,
00249                                     TRUE)));
00250 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="tunnel.c::FsRtlDeleteKeyFromTunnelCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlDeleteKeyFromTunnelCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cache</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DirKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01086">1086</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00297">FsRtlEmptyFreePoolList()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00330">FsRtlRemoveNodeFromTunnel()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>, <a class="el" href="../../d4/d3/splay_8c-source.html#l00759">RtlRealSuccessor()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">TunnelMaxEntries</a>.
<p>
<pre class="fragment"><div>01092                    :
01093 
01094     Deletes all entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache associated with a specific directory
01095 
01096 Arguments:
01097 
01098     Cache - a tunnel cache initialized by <a class="code" href="../../d1/d8/fsrtl_8h.html#a126">FsRtlInitializeTunnelCache</a>()
01099 
01100     DirKey - the key value of the directory (presumeably being removed)
01101 
01102 Return Value:
01103 
01104     None
01105 
01106 --*/
01107 {
01108     PRTL_SPLAY_LINKS Links;
01109     PRTL_SPLAY_LINKS SuccessorLinks;
01110     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node;
01111     LIST_ENTRY FreePoolList;
01112 
01113     PRTL_SPLAY_LINKS LastLinks = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01114     BOOLEAN Splay = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01115 
01116     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01117 
01118     <span class="comment">//</span>
01119     <span class="comment">//  If MaxEntries is 0 then tunneling is disabled.</span>
01120     <span class="comment">//</span>
01121 
01122     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> == 0) <span class="keywordflow">return</span>;
01123 
01124     InitializeListHead(&amp;FreePoolList);
01125 
01126 <span class="preprocessor">#ifdef KEYVIEW</span>
01127 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"++\nDeleting key %08x%08x\n--\n"</span>, DblHex64(DirKey));
01128 <span class="preprocessor">#endif</span>
01129 <span class="preprocessor"></span>
01130     ExAcquireFastMutex(&amp;Cache-&gt;Mutex);
01131 
01132     Links = Cache-&gt;Cache;
01133 
01134     <span class="keywordflow">while</span> (Links) {
01135 
01136         Node = CONTAINING_RECORD(Links, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, CacheLinks);
01137 
01138         <span class="keywordflow">if</span> (Node-&gt;DirKey &gt; DirKey) {
01139 
01140             <span class="comment">//</span>
01141             <span class="comment">//  All nodes to the right are bigger, go left</span>
01142             <span class="comment">//</span>
01143 
01144             Links = RtlLeftChild(&amp;Node-&gt;CacheLinks);
01145 
01146         } <span class="keywordflow">else</span> {
01147 
01148             <span class="keywordflow">if</span> (Node-&gt;DirKey &lt; DirKey) {
01149 
01150                 <span class="keywordflow">if</span> (LastLinks) {
01151 
01152                     <span class="comment">//</span>
01153                     <span class="comment">//  If we have previously seen a candidate node to delete</span>
01154                     <span class="comment">//  and we have now gone too far left - we know where to start.</span>
01155                     <span class="comment">//</span>
01156 
01157                     <span class="keywordflow">break</span>;
01158                 }
01159 
01160                 Links = RtlRightChild(&amp;Node-&gt;CacheLinks);
01161 
01162             } <span class="keywordflow">else</span> {
01163 
01164                 <span class="comment">//</span>
01165                 <span class="comment">//  Node is a candidate to be deleted, but we might have more nodes</span>
01166                 <span class="comment">//  to the left in the tree. Note this location and go on.</span>
01167                 <span class="comment">//</span>
01168 
01169                 LastLinks = Links;
01170                 Links = RtlLeftChild(&amp;Node-&gt;CacheLinks);
01171             }
01172         }
01173     }
01174 
01175     <span class="keywordflow">for</span> (Links = LastLinks;
01176          Links;
01177          Links = SuccessorLinks) {
01178 
01179         SuccessorLinks = <a class="code" href="../../d3/d4/splay_8c.html#a8">RtlRealSuccessor</a>(Links);
01180         Node = CONTAINING_RECORD(Links, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, CacheLinks);
01181 
01182         <span class="keywordflow">if</span> (Node-&gt;DirKey != DirKey) {
01183 
01184             <span class="comment">//</span>
01185             <span class="comment">//  Reached nodes which have a different key, so we're done</span>
01186             <span class="comment">//</span>
01187 
01188             <span class="keywordflow">break</span>;
01189         }
01190 
01191         <a class="code" href="../../d1/d7/tunnel_8c.html#a18">FsRtlRemoveNodeFromTunnel</a>(Cache, Node, &amp;FreePoolList, &amp;Splay);
01192     }
01193 
01194 <span class="preprocessor">#ifdef TUNNELTEST</span>
01195 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FsRtlDeleteKeyFromTunnelCache:\n"</span>);
01196 <span class="preprocessor">#ifndef KEYVIEW</span>
01197 <span class="preprocessor"></span>    DumpTunnel(Cache);
01198 <span class="preprocessor">#endif</span>
01199 <span class="preprocessor"></span><span class="preprocessor">#endif // TUNNELTEST</span>
01200 <span class="preprocessor"></span>
01201     ExReleaseFastMutex(&amp;Cache-&gt;Mutex);
01202 
01203     <span class="comment">//</span>
01204     <span class="comment">//  Free delayed pool</span>
01205     <span class="comment">//</span>
01206 
01207     <a class="code" href="../../d1/d7/tunnel_8c.html#a17">FsRtlEmptyFreePoolList</a>(&amp;FreePoolList);
01208 
01209     <span class="keywordflow">return</span>;
01210 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="tunnel.c::FsRtlDeleteTunnelCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlDeleteTunnelCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Cache</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01226">1226</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">TunnelMaxEntries</a>.
<p>
<pre class="fragment"><div>01231                    :
01232 
01233     Deletes a tunnel cache
01234 
01235 Arguments:
01236 
01237     Cache - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache to <span class="keyword">delete</span>, initialized by <a class="code" href="../../d1/d8/fsrtl_8h.html#a126">FsRtlInitializeTunnelCache</a>()
01238 
01239 Return Value:
01240 
01241     None
01242 
01243 --*/
01244 {
01245     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node;
01246     PLIST_ENTRY Link, Next;
01247 
01248     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01249 
01250     <span class="comment">//</span>
01251     <span class="comment">//  If MaxEntries is 0 then tunneling is disabled.</span>
01252     <span class="comment">//</span>
01253 
01254     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> == 0) <span class="keywordflow">return</span>;
01255 
01256     <span class="comment">//</span>
01257     <span class="comment">//  Zero out the cache and delete everything on the timer list</span>
01258     <span class="comment">//</span>
01259 
01260     Cache-&gt;Cache = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01261     Cache-&gt;NumEntries = 0;
01262 
01263     <span class="keywordflow">for</span> (Link = Cache-&gt;TimerQueue.Flink;
01264          Link != &amp;Cache-&gt;TimerQueue;
01265          Link = Next) {
01266 
01267         Next = Link-&gt;Flink;
01268 
01269         Node = CONTAINING_RECORD(Link, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, ListLinks);
01270 
01271         <a class="code" href="../../d1/d7/tunnel_8c.html#a16">FsRtlFreeTunnelNode</a>(Node, NULL);
01272     }
01273 
01274     InitializeListHead(&amp;Cache-&gt;TimerQueue);
01275 
01276     <span class="keywordflow">return</span>;
01277 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="tunnel.c::FsRtlEmptyFreePoolList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INLINE VOID FsRtlEmptyFreePoolList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PLIST_ENTRY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FreePoolList</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00297">297</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01086">FsRtlDeleteKeyFromTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">FsRtlFindInTunnelCache()</a>.
<p>
<pre class="fragment"><div>00302                    :
00303 
00304     Free all <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> memory that has been delayed onto a free list.
00305 
00306 Arguments:
00307 
00308     FreePoolList    - a list of freeable <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> memory
00309 
00310 Return Value:
00311 
00312     None
00313 
00314 -*/
00315 {
00316     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> FreeNode;
00317 
00318     <span class="keywordflow">while</span> (!IsListEmpty(FreePoolList)) {
00319 
00320         FreeNode = CONTAINING_RECORD(FreePoolList-&gt;Flink, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, ListLinks);
00321         RemoveEntryList(FreePoolList-&gt;Flink);
00322 
00323         <a class="code" href="../../d1/d7/tunnel_8c.html#a16">FsRtlFreeTunnelNode</a>(FreeNode, NULL);
00324     }
00325 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="tunnel.c::FsRtlFindInTunnelCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlFindInTunnelCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cache</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DirKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ShortName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>LongName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DataLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">913</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d1/lboxctl2_8c-source.html#l02757">Compare()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01101">FsRtlAllocatePoolWithTag</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00218">FsRtlCompareNodeAndKey()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00297">FsRtlEmptyFreePoolList()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">FsRtlPruneTunnelCache()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">TunnelMaxEntries</a>.
<p>
<pre class="fragment"><div>00924                    :
00925 
00926     Looks up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key
00927 
00928         DirKey ## <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>
00929 
00930     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache and removes <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>. As a side effect, <span class="keyword">this</span> routine will initiate
00931     expiration of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> aged entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache.
00932 
00933 Arguments:
00934 
00935     Cache - a tunnel cache initialized by <a class="code" href="../../d1/d8/fsrtl_8h.html#a126">FsRtlInitializeTunnelCache</a>()
00936 
00937     DirKey - the key value of the directory the name will appear in
00938 
00939     Name - the name of the entry
00940 
00941     ShortName - return string to hold the <span class="keywordtype">short</span> name of the tunneled file. Must
00942         already be allocated and large enough for max 8.3 name
00943 
00944     LongName -  return string to hold the <span class="keywordtype">long</span> name of the tunneled file. If
00945         already allocated, may be grown if not large enough. Caller is
00946         responsible for noticing this and freeing data regardless of return value.
00947 
00948     DataLength - provides the length of the buffer avaliable to hold the
00949         tunneling information, returns the size of the tunneled information
00950         read out
00951 
00952 Return Value:
00953 
00954     Boolean true if found, false otherwise
00955 
00956 --*/
00957 {
00958     PRTL_SPLAY_LINKS Links;
00959     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node;
00960     LONG <a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a>;
00961     LIST_ENTRY FreePoolList;
00962 
00963     BOOLEAN <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00964 
00965     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00966 
00967     <span class="comment">//</span>
00968     <span class="comment">//  If MaxEntries is 0 then tunneling is disabled.</span>
00969     <span class="comment">//</span>
00970 
00971     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> == 0) <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00972 
00973     InitializeListHead(&amp;FreePoolList);
00974 
00975 <span class="preprocessor">#ifdef KEYVIEW</span>
00976 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"++\nSearching for %wZ , %08x%08x\n--\n"</span>, Name, DblHex64(DirKey));
00977 <span class="preprocessor">#endif</span>
00978 <span class="preprocessor"></span>
00979     ExAcquireFastMutex(&amp;Cache-&gt;Mutex);
00980 
00981     <span class="comment">//</span>
00982     <span class="comment">//  Expire aged entries first so we don't grab old data</span>
00983     <span class="comment">//</span>
00984 
00985     <a class="code" href="../../d1/d7/tunnel_8c.html#a14">FsRtlPruneTunnelCache</a>(Cache, &amp;FreePoolList);
00986 
00987     Links = Cache-&gt;Cache;
00988 
00989     <span class="keywordflow">while</span> (Links) {
00990 
00991         Node = CONTAINING_RECORD(Links, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, CacheLinks);
00992 
00993         <a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> = <a class="code" href="../../d1/d7/tunnel_8c.html#a15">FsRtlCompareNodeAndKey</a>(Node, DirKey, Name);
00994 
00995         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> &gt; 0) {
00996 
00997             Links = RtlLeftChild(&amp;Node-&gt;CacheLinks);
00998 
00999         } <span class="keywordflow">else</span> {
01000 
01001             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a> &lt; 0) {
01002 
01003                 Links = RtlRightChild(&amp;Node-&gt;CacheLinks);
01004 
01005             } <span class="keywordflow">else</span> {
01006 
01007                 <span class="comment">//</span>
01008                 <span class="comment">//  Found tunneling information</span>
01009                 <span class="comment">//</span>
01010 
01011 <span class="preprocessor">#if defined(TUNNELTEST) || defined(KEYVIEW)</span>
01012 <span class="preprocessor"></span>                <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FsRtlFindInTunnelCache:\n"</span>);
01013                 DumpNode(Node, 1);
01014 <span class="preprocessor">#ifndef KEYVIEW</span>
01015 <span class="preprocessor"></span>                DumpTunnel(Cache);
01016 <span class="preprocessor">#endif</span>
01017 <span class="preprocessor"></span><span class="preprocessor">#endif // TUNNELTEST</span>
01018 <span class="preprocessor"></span>
01019                 <span class="keywordflow">break</span>;
01020             }
01021         }
01022     }
01023 
01024     <span class="keywordflow">try</span> {
01025 
01026         <span class="keywordflow">if</span> (Links) {
01027     
01028             <span class="comment">//</span>
01029             <span class="comment">//  Copy node data into caller's area</span>
01030             <span class="comment">//</span>
01031     
01032             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ShortName-&gt;MaximumLength &gt;= (8+1+3)*<span class="keyword">sizeof</span>(WCHAR));
01033             <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>(ShortName, &amp;Node-&gt;ShortName);
01034     
01035             <span class="keywordflow">if</span> (LongName-&gt;MaximumLength &gt;= Node-&gt;LongName.Length) {
01036     
01037                 <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>(LongName, &amp;Node-&gt;LongName);
01038     
01039             } <span class="keywordflow">else</span> {
01040     
01041                 <span class="comment">//</span>
01042                 <span class="comment">//  Need to allocate more memory for the long name</span>
01043                 <span class="comment">//</span>
01044     
01045                 LongName-&gt;Buffer = <a class="code" href="../../d1/d8/fsrtl_8h.html#a37">FsRtlAllocatePoolWithTag</a>(PagedPool, Node-&gt;LongName.Length, '4nuT');
01046                 LongName-&gt;Length = LongName-&gt;MaximumLength = Node-&gt;LongName.Length;
01047     
01048                 RtlCopyMemory(LongName-&gt;Buffer, Node-&gt;LongName.Buffer, Node-&gt;LongName.Length);
01049             }
01050     
01051             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(*DataLength &gt;= Node-&gt;TunnelDataLength);
01052             RtlCopyMemory(Data, Node-&gt;TunnelData, Node-&gt;TunnelDataLength);
01053             *DataLength = Node-&gt;TunnelDataLength;
01054     
01055             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01056         }
01057 
01058     } finally {
01059 
01060         ExReleaseFastMutex(&amp;Cache-&gt;Mutex);
01061     
01062         <a class="code" href="../../d1/d7/tunnel_8c.html#a17">FsRtlEmptyFreePoolList</a>(&amp;FreePoolList);
01063     }
01064     
01065     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01066 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="tunnel.c::FsRtlFreeTunnelNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INLINE VOID FsRtlFreeTunnelNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PLIST_ENTRY FreePoolList&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">255</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00947">ExFreeToPagedLookasideList()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00102">TUNNEL_FLAG_NON_LOOKASIDE</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00090">TunnelLookasideList</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01226">FsRtlDeleteTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00297">FsRtlEmptyFreePoolList()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00330">FsRtlRemoveNodeFromTunnel()</a>.
<p>
<pre class="fragment"><div>00261                    :
00262 
00263     Free a node
00264 
00265 Arguments:
00266 
00267     Node            - a tunnel node to free
00268 
00269     FreePoolList    - optional list to hold freeable <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> memory
00270 
00271 Return Value:
00272 
00273     None
00274 
00275 -*/
00276 {
00277     <span class="keywordflow">if</span> (FreePoolList) {
00278 
00279         InsertHeadList(FreePoolList, &amp;Node-&gt;ListLinks);
00280 
00281     } <span class="keywordflow">else</span> {
00282 
00283         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Node-&gt;Flags, TUNNEL_FLAG_NON_LOOKASIDE)) {
00284     
00285             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Node);
00286     
00287         } <span class="keywordflow">else</span> {
00288     
00289             <a class="code" href="../../d5/d8/ex_8h.html#a253">ExFreeToPagedLookasideList</a>(&amp;TunnelLookasideList, Node);
00290         }
00291     }
00292 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="tunnel.c::FsRtlGetTunnelParameterValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FsRtlGetTunnelParameterValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Value</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01371">1371</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d5/d7/fsrtlpc_8c-source.html#l00026">KEY_WORK_AREA</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00070">TUNNEL_KEY_NAME</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>.
<p>
<pre class="fragment"><div>01378                    :
01379 
01380     Given a unicode value name <span class="keyword">this</span> routine will go into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry
01381     location <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Tunnel parameter information and get <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01382     value.
01383 
01384 Arguments:
01385 
01386     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unicode name <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry value located in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01387                 <span class="keywordtype">double</span> space configuration location of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
01388     Value   - a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ULONG <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result.
01389 
01390 Return Value:
01391 
01392     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01393 
01394     If STATUS_SUCCESSFUL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> location *Value will be
01395     updated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> value from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.  If any failing
01396     status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned, <span class="keyword">this</span> value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> untouched.
01397 
01398 --*/
01399 
01400 {
01401     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01402     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01403     ULONG RequestLength;
01404     ULONG ResultLength;
01405     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[<a class="code" href="../../d4/d8/fsrtlpc_8c.html#a2">KEY_WORK_AREA</a>];
01406     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
01407     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
01408     PKEY_VALUE_FULL_INFORMATION KeyValueInformation;
01409 
01410     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer = <a class="code" href="../../d1/d7/tunnel_8c.html#a1">TUNNEL_KEY_NAME</a>;
01411     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/tunnel_8c.html#a1">TUNNEL_KEY_NAME</a>) - <span class="keyword">sizeof</span>(WCHAR);
01412     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.MaximumLength = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/tunnel_8c.html#a1">TUNNEL_KEY_NAME</a>);
01413 
01414     InitializeObjectAttributes(&amp;ObjectAttributes,
01415                                &amp;KeyName,
01416                                OBJ_CASE_INSENSITIVE,
01417                                NULL,
01418                                NULL);
01419 
01420     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey(&amp;Handle,
01421                        KEY_READ,
01422                        &amp;ObjectAttributes);
01423 
01424     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01425 
01426         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01427     }
01428 
01429     RequestLength = <a class="code" href="../../d4/d8/fsrtlpc_8c.html#a2">KEY_WORK_AREA</a>;
01430 
01431     KeyValueInformation = (PKEY_VALUE_FULL_INFORMATION)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01432 
01433     <span class="keywordflow">while</span> (1) {
01434 
01435         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryValueKey(Handle,
01436                                  ValueName,
01437                                  KeyValueFullInformation,
01438                                  KeyValueInformation,
01439                                  RequestLength,
01440                                  &amp;ResultLength);
01441 
01442         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Status != STATUS_BUFFER_OVERFLOW );
01443 
01444         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
01445 
01446             <span class="comment">//</span>
01447             <span class="comment">// Try to get a buffer big enough.</span>
01448             <span class="comment">//</span>
01449 
01450             <span class="keywordflow">if</span> (KeyValueInformation != (PKEY_VALUE_FULL_INFORMATION)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>) {
01451 
01452                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(KeyValueInformation);
01453             }
01454 
01455             RequestLength += 256;
01456 
01457             KeyValueInformation = (PKEY_VALUE_FULL_INFORMATION)
01458                                   <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool,
01459                                                         RequestLength,
01460                                                         'KnuT');
01461 
01462             <span class="keywordflow">if</span> (!KeyValueInformation) {
01463                 <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01464             }
01465 
01466         } <span class="keywordflow">else</span> {
01467 
01468             <span class="keywordflow">break</span>;
01469         }
01470     }
01471 
01472     ZwClose(Handle);
01473 
01474     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01475 
01476         <span class="keywordflow">if</span> (KeyValueInformation-&gt;DataLength != 0) {
01477 
01478             PULONG DataPtr;
01479 
01480             <span class="comment">//</span>
01481             <span class="comment">// Return contents to the caller.</span>
01482             <span class="comment">//</span>
01483 
01484             DataPtr = (PULONG)
01485               ((PUCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
01486             *Value = *DataPtr;
01487 
01488         } <span class="keywordflow">else</span> {
01489 
01490             <span class="comment">//</span>
01491             <span class="comment">// Treat as if no value was found</span>
01492             <span class="comment">//</span>
01493 
01494             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_NAME_NOT_FOUND;
01495         }
01496     }
01497 
01498     <span class="keywordflow">if</span> (KeyValueInformation != (PKEY_VALUE_FULL_INFORMATION)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>) {
01499 
01500         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(KeyValueInformation);
01501     }
01502 
01503     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01504 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="tunnel.c::FsRtlInitializeTunnelCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlInitializeTunnelCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Cache</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00517">517</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00522                    :
00523 
00524     Initialize a <span class="keyword">new</span> tunnel cache.
00525 
00526 Arguments:
00527 
00528     None
00529 
00530 Return Value:
00531 
00532     None
00533 
00534 --*/
00535 {
00536     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00537 
00538     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>(&amp;Cache-&gt;Mutex);
00539 
00540     Cache-&gt;Cache = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00541     InitializeListHead(&amp;Cache-&gt;TimerQueue);
00542     Cache-&gt;NumEntries = 0;
00543 
00544     <span class="keywordflow">return</span>;
00545 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="tunnel.c::FsRtlInitializeTunnels" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlInitializeTunnels           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">382</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">ExInitializePagedLookasideList()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01371">FsRtlGetTunnelParameterValue()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00093">LOOKASIDE_NODE_SIZE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00091">MAX_LOOKASIDE_DEPTH</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03087">MmIsThisAnNtAsSystem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00071">TUNNEL_AGE_VALUE_NAME</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00072">TUNNEL_SIZE_VALUE_NAME</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00090">TunnelLookasideList</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00080">TunnelMaxAge</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">TunnelMaxEntries</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/fsrtlpc_8c-source.html#l00215">FsRtlInitSystem()</a>.
<p>
<pre class="fragment"><div>00387                    :
00388 
00389     Initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global part of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunneling package.
00390 
00391 Arguments:
00392 
00393     None
00394 
00395 Return Value:
00396 
00397     None
00398 
00399 --*/
00400 {
00401     UNICODE_STRING  <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00402     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>          LookasideDepth;
00403 
00404     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00405 
00406     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/mminit_8c.html#a58">MmIsThisAnNtAsSystem</a>()) {
00407 
00408         <a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> = 1024;
00409 
00410     } <span class="keywordflow">else</span> {
00411 
00412         <a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> = 256;
00413     }
00414 
00415     <a class="code" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a> = 15;
00416 
00417     <span class="comment">//</span>
00418     <span class="comment">//  Query our configurable parameters</span>
00419     <span class="comment">//</span>
00420     <span class="comment">//  Don't worry about failure in retrieving from the registry. We've gotten</span>
00421     <span class="comment">//  this far so fall back on defaults even if there was a problem with resources.</span>
00422     <span class="comment">//</span>
00423 
00424     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer = <a class="code" href="../../d1/d7/tunnel_8c.html#a3">TUNNEL_SIZE_VALUE_NAME</a>;
00425     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/tunnel_8c.html#a3">TUNNEL_SIZE_VALUE_NAME</a>) - <span class="keyword">sizeof</span>(WCHAR);
00426     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.MaximumLength = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/tunnel_8c.html#a3">TUNNEL_SIZE_VALUE_NAME</a>);
00427     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d1/d7/tunnel_8c.html#a13">FsRtlGetTunnelParameterValue</a>(&amp;ValueName, &amp;TunnelMaxEntries);
00428 
00429     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer = <a class="code" href="../../d1/d7/tunnel_8c.html#a2">TUNNEL_AGE_VALUE_NAME</a>;
00430     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/tunnel_8c.html#a2">TUNNEL_AGE_VALUE_NAME</a>) - <span class="keyword">sizeof</span>(WCHAR);
00431     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.MaximumLength = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/tunnel_8c.html#a2">TUNNEL_AGE_VALUE_NAME</a>);
00432     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d1/d7/tunnel_8c.html#a13">FsRtlGetTunnelParameterValue</a>(&amp;ValueName, &amp;TunnelMaxAge);
00433 
00434     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a> == 0) {
00435 
00436         <span class="comment">//</span>
00437         <span class="comment">//  If the registry has been set so the timeout is zero, we should force</span>
00438         <span class="comment">//  the number of entries to zero also. This preserves expectations and lets</span>
00439         <span class="comment">//  us key off of max entries alone in performing the hard disabling of the</span>
00440         <span class="comment">//  caching code.</span>
00441         <span class="comment">//</span>
00442 
00443         <a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> = 0;
00444     }
00445 
00446     <span class="comment">//</span>
00447     <span class="comment">//  Convert from seconds to 10ths of msecs, the internal resolution</span>
00448     <span class="comment">//</span>
00449 
00450     <a class="code" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a> *= 10000000;
00451 
00452     <span class="comment">//</span>
00453     <span class="comment">//  Build the lookaside list for common node allocation</span>
00454     <span class="comment">//</span>
00455 
00456     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> &gt; MAXUSHORT) {
00457 
00458         <span class="comment">//</span>
00459         <span class="comment">//  User is hinting a big need to us</span>
00460         <span class="comment">//</span>
00461 
00462         LookasideDepth = <a class="code" href="../../d1/d7/tunnel_8c.html#a5">MAX_LOOKASIDE_DEPTH</a>;
00463 
00464     } <span class="keywordflow">else</span> {
00465 
00466         LookasideDepth = ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a>)/16;
00467     }
00468 
00469     <span class="keywordflow">if</span> (LookasideDepth == 0 &amp;&amp; <a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a>) {
00470 
00471         <span class="comment">//</span>
00472         <span class="comment">//  Miniscule number of entries allowed. Lookaside 'em all.</span>
00473         <span class="comment">//</span>
00474 
00475         LookasideDepth = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a> + 1;
00476     }
00477 
00478     <span class="keywordflow">if</span> (LookasideDepth &gt; <a class="code" href="../../d1/d7/tunnel_8c.html#a5">MAX_LOOKASIDE_DEPTH</a>) {
00479 
00480         <span class="comment">//</span>
00481         <span class="comment">//  Finally, restrict the depth to something reasonable.</span>
00482         <span class="comment">//</span>
00483 
00484         LookasideDepth = <a class="code" href="../../d1/d7/tunnel_8c.html#a5">MAX_LOOKASIDE_DEPTH</a>;
00485     }
00486 
00487     <a class="code" href="../../d5/d8/ex_8h.html#a250">ExInitializePagedLookasideList</a>( &amp;TunnelLookasideList,
00488                                     NULL,
00489                                     NULL,
00490                                     0,
00491                                     LOOKASIDE_NODE_SIZE,
00492                                     'LnuT',
00493                                     LookasideDepth );
00494 
00495     <span class="keywordflow">return</span>;
00496 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="tunnel.c::FsRtlPruneTunnelCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlPruneTunnelCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cache</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>FreePoolList</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">1281</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00330">FsRtlRemoveNodeFromTunnel()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00153">KeQuerySystemTime()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00080">TunnelMaxAge</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">TunnelMaxEntries</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">FsRtlFindInTunnelCache()</a>.
<p>
<pre class="fragment"><div>01287                    :
01288 
01289     Removes deadwood entries from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache as defined by <a class="code" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a> and <a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a>.
01290     Pool memory <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned on a list <span class="keywordflow">for</span> deletion by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling routine at a time of
01291     its choosing.
01292 
01293     For performance reasons we don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> want to force freeing of memory inside a mutex.
01294 
01295 Arguments:
01296 
01297     Cache - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache to prune
01298 
01299     FreePoolList - a list to queue <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> memory on to
01300 
01301 Return Value:
01302 
01303     None
01304 --*/
01305 {
01306     <a class="code" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a> Node;
01307     LARGE_INTEGER ExpireTime;
01308     LARGE_INTEGER CurrentTime;
01309     BOOLEAN Splay = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01310 
01311     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01312 
01313     <span class="comment">//</span>
01314     <span class="comment">//  Calculate the age of the oldest entry we want to keep</span>
01315     <span class="comment">//</span>
01316 
01317     <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a3">KeQuerySystemTime</a>(&amp;CurrentTime);
01318     ExpireTime.QuadPart = CurrentTime.QuadPart - <a class="code" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a>;
01319 
01320     <span class="comment">//</span>
01321     <span class="comment">//  Expire old entries off of the timer queue.  We have to check</span>
01322     <span class="comment">//  for future time because the clock may jump as a result of</span>
01323     <span class="comment">//  hard clock change.  If we did not do this, a rogue entry</span>
01324     <span class="comment">//  with a future time could sit at the top of the queue and</span>
01325     <span class="comment">//  prevent entries from going away.</span>
01326     <span class="comment">//</span>
01327 
01328     <span class="keywordflow">while</span> (!IsListEmpty(&amp;Cache-&gt;TimerQueue)) {
01329 
01330         Node = CONTAINING_RECORD(Cache-&gt;TimerQueue.Flink, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, ListLinks);
01331 
01332         <span class="keywordflow">if</span> (Node-&gt;CreateTime.QuadPart &lt; ExpireTime.QuadPart ||
01333             Node-&gt;CreateTime.QuadPart &gt; CurrentTime.QuadPart) {
01334 
01335 <span class="preprocessor">#if defined(TUNNELTEST) || defined(KEYVIEW)</span>
01336 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Expiring node %x (%ud%ud 1/10 msec too old)\n"</span>, Node, DblHex64(ExpireTime.QuadPart - Node-&gt;CreateTime.QuadPart));
01337 <span class="preprocessor">#endif // TUNNELTEST</span>
01338 <span class="preprocessor"></span>
01339             <a class="code" href="../../d1/d7/tunnel_8c.html#a18">FsRtlRemoveNodeFromTunnel</a>(Cache, Node, FreePoolList, &amp;Splay);
01340 
01341         } <span class="keywordflow">else</span> {
01342 
01343             <span class="comment">//</span>
01344             <span class="comment">//  No more nodes to be expired</span>
01345             <span class="comment">//</span>
01346 
01347             <span class="keywordflow">break</span>;
01348         }
01349     }
01350 
01351     <span class="comment">//</span>
01352     <span class="comment">//  Remove entries until we're under the TunnelMaxEntries limit</span>
01353     <span class="comment">//</span>
01354 
01355     <span class="keywordflow">while</span> (Cache-&gt;NumEntries &gt; <a class="code" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a>) {
01356 
01357         Node = CONTAINING_RECORD(Cache-&gt;TimerQueue.Flink, <a class="code" href="../../d5/d1/structTUNNEL__NODE.html">TUNNEL_NODE</a>, ListLinks);
01358 
01359 <span class="preprocessor">#if defined(TUNNELTEST) || defined(KEYVIEW)</span>
01360 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dumping node %x (%d &gt; %d)\n"</span>, Node, Cache-&gt;NumEntries, TunnelMaxEntries);
01361 <span class="preprocessor">#endif // TUNNELTEST</span>
01362 <span class="preprocessor"></span>
01363         <a class="code" href="../../d1/d7/tunnel_8c.html#a18">FsRtlRemoveNodeFromTunnel</a>(Cache, Node, FreePoolList, &amp;Splay);
01364     }
01365 
01366     <span class="keywordflow">return</span>;
01367 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="tunnel.c::FsRtlRemoveNodeFromTunnel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INLINE VOID FsRtlRemoveNodeFromTunnel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a69">PTUNNEL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Cache</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d7/tunnel_8c.html#a12">PTUNNEL_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>FreePoolList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PBOOLEAN Splay&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00330">330</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, <a class="el" href="../../d4/d3/splay_8c-source.html#l00385">RtlDelete()</a>, and <a class="el" href="../../d4/d3/splay_8c-source.html#l00502">RtlDeleteNoSplay()</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01086">FsRtlDeleteKeyFromTunnelCache()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">FsRtlPruneTunnelCache()</a>.
<p>
<pre class="fragment"><div>00338                    :
00339 
00340     Performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> common work of deleting a node from a tunnel cache. Pool memory
00341     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not deleted immediately but <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> saved aside on a list <span class="keywordflow">for</span> deletion later
00342     by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling routine.
00343 
00344 Arguments:
00345 
00346     Cache - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tunnel cache <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> node <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
00347 
00348     Node - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> node being removed
00349 
00350     FreePoolList - an initialized list to take <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> node <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was allocated from
00351         <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00352 
00353     Splay - an optional flag to indicate whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree should be splayed on
00354         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">delete</span>. Set to <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> splaying was performed.
00355 
00356 Return Value:
00357 
00358     None.
00359 
00360 --*/
00361 {
00362     <span class="keywordflow">if</span> (Splay &amp;&amp; *Splay) {
00363 
00364         Cache-&gt;Cache = <a class="code" href="../../d3/d4/splay_8c.html#a4">RtlDelete</a>(&amp;Node-&gt;CacheLinks);
00365 
00366         *Splay = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00367 
00368     } <span class="keywordflow">else</span> {
00369 
00370         <a class="code" href="../../d3/d4/splay_8c.html#a5">RtlDeleteNoSplay</a>(&amp;Node-&gt;CacheLinks, &amp;Cache-&gt;Cache);
00371     }
00372 
00373     RemoveEntryList(&amp;Node-&gt;ListLinks);
00374 
00375     Cache-&gt;NumEntries--;
00376 
00377     <a class="code" href="../../d1/d7/tunnel_8c.html#a16">FsRtlFreeTunnelNode</a>(Node, FreePoolList);
00378 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a11" doxytag="tunnel.c::TunnelLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PAGED_LOOKASIDE_LIST</a> <a class="el" href="../../d1/d7/tunnel_8c.html#a11">TunnelLookasideList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00090">90</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="tunnel.c::TunnelMaxAge" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d7/tunnel_8c.html#a10">TunnelMaxAge</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00080">80</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">FsRtlPruneTunnelCache()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="tunnel.c::TunnelMaxEntries" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d7/tunnel_8c.html#a9">TunnelMaxEntries</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00079">79</a> of file <a class="el" href="../../d2/d6/tunnel_8c-source.html">tunnel.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01086">FsRtlDeleteKeyFromTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01226">FsRtlDeleteTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">FsRtlFindInTunnelCache()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>, and <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01281">FsRtlPruneTunnelCache()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:50 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
