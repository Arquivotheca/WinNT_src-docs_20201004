<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rtl/registry.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>registry.c File Reference</h1><code>#include "<a class="el" href="../../d6/d8/ntrtlp_8h-source.html">ntrtlp.h</a>"</code><br>

<p>
<a href="../../d2/d6/rtl_2registry_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a0">REG_INVALID_ATTRIBUTES</a>&nbsp;&nbsp;&nbsp;(OBJ_EXCLUSIVE | OBJ_PERMANENT)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a1">RtlpNtOpenKey</a> (OUT PHANDLE KeyHandle, IN ACCESS_MASK DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, IN ULONG Options)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a2">RtlpNtCreateKey</a> (OUT PHANDLE KeyHandle, IN ACCESS_MASK DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, IN ULONG Options, IN PUNICODE_STRING Provider, OUT OPTIONAL PULONG Disposition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a3">RtlpNtQueryValueKey</a> (IN HANDLE KeyHandle, OUT OPTIONAL PULONG KeyValueType, OUT OPTIONAL PVOID KeyValue, IN OUT OPTIONAL PULONG KeyValueLength, OUT OPTIONAL PLARGE_INTEGER LastWriteTime)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a4">RtlpNtSetValueKey</a> (IN HANDLE KeyHandle, IN ULONG KeyValueType, IN OPTIONAL PVOID KeyValue, IN ULONG KeyValueLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a5">RtlpNtMakeTemporaryKey</a> (IN HANDLE KeyHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/rtl_2registry_8c.html#a6">RtlpNtEnumerateSubKey</a> (IN HANDLE KeyHandle, OUT PUNICODE_STRING SubKeyName, IN ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>, OUT PLARGE_INTEGER LastWriteTime)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="rtl/registry.c::REG_INVALID_ATTRIBUTES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define REG_INVALID_ATTRIBUTES&nbsp;&nbsp;&nbsp;(OBJ_EXCLUSIVE | OBJ_PERMANENT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00055">55</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00139">RtlpNtCreateKey()</a>, and <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00070">RtlpNtOpenKey()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="rtl/registry.c::RtlpNtCreateKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpNtCreateKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Options</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Provider</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT OPTIONAL PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Disposition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00139">139</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00055">REG_INVALID_ATTRIBUTES</a>, and <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00150                    :
00151 
00152     This function creates or opens <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified key in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry.  If
00153     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key does not exist, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key already exists, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
00154     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> opened.
00155 
00156 Arguments:
00157 
00158     KeyHandle - Receives a value called a <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to access
00159         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified key in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registration Database.
00160 
00161     DesiredAccess - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Accesses desired
00162 
00163         REG_KEY_READ - Generic Read access to key
00164           REG_KEY_QUERY_VALUE - Query <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>'s value
00165         REG_KEY_WRITE - Generic Write access to key
00166           REG_KEY_SET_VALUE - Set <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>'s value
00167 
00168     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key being opened.
00169         Note that a key name must be specified.  If a Root <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>
00170         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root.  The name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00171         object must be within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name space allocated to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry, that
00172         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>, all names beginning <span class="stringliteral">"\Registry"</span>.  RootHandle, <span class="keywordflow">if</span> present, must
00173         be a handle to <span class="stringliteral">"\", or "</span>\Registry<span class="stringliteral">", or a key under "</span>\Registry<span class="stringliteral">".</span>
00174 <span class="stringliteral"></span>
00175 <span class="stringliteral"></span>
00176 <span class="stringliteral">    Options - REG_OPTION_READ_FUZZY - Allow Read access on handle even if it is</span>
00177 <span class="stringliteral">                                      open for READ_WRITE access.</span>
00178 <span class="stringliteral"></span>
00179 <span class="stringliteral">              REG_OPTION_VOLATILE - Object is not to be stored across boots.</span>
00180 <span class="stringliteral"></span>
00181 <span class="stringliteral">    Provider - This parameter is reserved for future use and must currently</span>
00182 <span class="stringliteral">        be set to NULL.  It will be used in the future to specify the name of</span>
00183 <span class="stringliteral">        the provider to be used for operations on this node and its descendant</span>
00184 <span class="stringliteral">        nodes.</span>
00185 <span class="stringliteral"></span>
00186 <span class="stringliteral">    Disposition - This optional parameter is a pointer to a variable that</span>
00187 <span class="stringliteral">        will receive a value indicating whether a new Registry key was</span>
00188 <span class="stringliteral">        created or an existing one opened.</span>
00189 <span class="stringliteral"></span>
00190 <span class="stringliteral">        REG_CREATED_NEW_KEY - A new Registry Key was created</span>
00191 <span class="stringliteral">        REG_OPENED_EXISTING_KEY - An existing Registry Key was opened</span>
00192 <span class="stringliteral"></span>
00193 <span class="stringliteral">Return Value:</span>
00194 <span class="stringliteral"></span>
00195 <span class="stringliteral">    NTSTATUS - Result code from call.  The following are returned</span>
00196 <span class="stringliteral"></span>
00197 <span class="stringliteral">        STATUS_SUCCESS - The open was successful.</span>
00198 <span class="stringliteral"></span>
00199 <span class="stringliteral">        STATUS_INVALID_PARAMETER - A parameter other that object name was</span>
00200 <span class="stringliteral">--*/</span>
00201 <span class="stringliteral"></span>
00202 <span class="stringliteral">{</span>
00203 <span class="stringliteral">    RTL_PAGED_CODE();</span>
00204 <span class="stringliteral"></span>
00205 <span class="stringliteral">    if (ARGUMENT_PRESENT(ObjectAttributes)) {</span>
00206 <span class="stringliteral">        ObjectAttributes-&gt;Attributes &amp;= ~(REG_INVALID_ATTRIBUTES);</span>
00207 <span class="stringliteral">    }</span>
00208 <span class="stringliteral"></span>
00209 <span class="stringliteral"></span>
00210 <span class="stringliteral">    return(NtCreateKey( KeyHandle,</span>
00211 <span class="stringliteral">                        DesiredAccess,</span>
00212 <span class="stringliteral">                        ObjectAttributes,</span>
00213 <span class="stringliteral">                        0,                          //TitleIndex</span>
00214 <span class="stringliteral">                        NULL,                       //Class OPTIONAL,</span>
00215 <span class="stringliteral">                        REG_OPTION_NON_VOLATILE,    //CreateOptions,</span>
00216 <span class="stringliteral">                        Disposition</span>
00217 <span class="stringliteral">                        ) );</span>
00218 <span class="stringliteral"></span>
00219 <span class="stringliteral">    DBG_UNREFERENCED_PARAMETER( Options );</span>
00220 <span class="stringliteral">    DBG_UNREFERENCED_PARAMETER( Provider );</span>
00221 <span class="stringliteral">}</span>
</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="rtl/registry.c::RtlpNtEnumerateSubKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpNtEnumerateSubKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>SubKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Index</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>LastWriteTime</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00465">465</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
References <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00610">NtEnumerateKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00474                    :
00475 
00476     This function finds <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next sub key of a given key.  By
00477     making successive calls, all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sub keys of a key can be determined.
00478 
00479 
00480 Arguments:
00481 
00482     KeyHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key whose sub keys are to be enumerated.
00483 
00484     SubKeyName - Pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> in which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sub
00485         key will be returned.
00486 
00487     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> (ZERO-based) number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sub key to be returned.
00488 
00489 
00490     LastWriteTime - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time stamp that specifies when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key
00491         was last written.
00492 
00493 Return Value:
00494 
00495     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - Result code
00496 
00497         STATUS_SUCCESS - The call succeeded
00498 
00499         STATUS_INVALID_PARAMETER - Invalid parameter
00500 
00501         STATUS_NO_MORE_ENTRIES - There <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no key having <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified index
00502 
00503         STATUS_BUFFER_OVERFLOW - The buffer of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output string was not
00504             large enough to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next sub-key name. SubKeyName-&gt;Length
00505             contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes required.
00506 
00507         STATUS_NO_MEMORY - There was not sufficient heap to perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00508             requested operation.
00509 
00510 --*/
00511 
00512 {
00513     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00514     PKEY_BASIC_INFORMATION KeyInformation = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00515     ULONG LocalBufferLength, ResultLength;
00516 
00517     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00518 
00519     LocalBufferLength = 0;
00520     <span class="keywordflow">if</span> (SubKeyName-&gt;MaximumLength &gt; 0) {
00521 
00522         LocalBufferLength = SubKeyName-&gt;MaximumLength +
00523                             FIELD_OFFSET(KEY_BASIC_INFORMATION, Name);
00524         KeyInformation = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0,
00525                                           LocalBufferLength
00526                                           );
00527         <span class="keywordflow">if</span> (KeyInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00528             <span class="keywordflow">return</span>(STATUS_NO_MEMORY);
00529         }
00530     }
00531 
00532     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a17">NtEnumerateKey</a>( KeyHandle,
00533                              Index,
00534                              KeyBasicInformation,    <span class="comment">//KeyInformationClass</span>
00535                              (PVOID)KeyInformation,
00536                              LocalBufferLength,
00537                              &amp;ResultLength
00538                              );
00539 
00540     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00541 
00542         <span class="keywordflow">if</span> ( SubKeyName-&gt;MaximumLength &gt;= KeyInformation-&gt;NameLength) {
00543 
00544             SubKeyName-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyInformation-&gt;NameLength;
00545 
00546             RtlMoveMemory( SubKeyName-&gt;Buffer,
00547                            &amp;KeyInformation-&gt;Name[0],
00548                            SubKeyName-&gt;Length
00549                            );
00550         } <span class="keywordflow">else</span> {
00551             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
00552         }
00553     }
00554 
00555     <span class="comment">//</span>
00556     <span class="comment">// Return the length required if we failed due to a small buffer</span>
00557     <span class="comment">//</span>
00558 
00559     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
00560         SubKeyName-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(ResultLength -
00561                                       FIELD_OFFSET(KEY_BASIC_INFORMATION, Name));
00562     }
00563 
00564 
00565     <span class="comment">//</span>
00566     <span class="comment">// Free up any memory we allocated</span>
00567     <span class="comment">//</span>
00568 
00569     <span class="keywordflow">if</span> (KeyInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00570 
00571         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0,
00572                      KeyInformation
00573                      );
00574     }
00575 
00576 
00577     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00578 
00579     DBG_UNREFERENCED_PARAMETER( LastWriteTime );
00580 
00581 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rtl/registry.c::RtlpNtMakeTemporaryKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpNtMakeTemporaryKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>KeyHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00430">430</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, and <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00436                    :
00437 
00438     This function makes a Registry key temporary.  The key will be deleted
00439     when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last handle to <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> closed.
00440 
00441 Arguments:
00442 
00443     KeyHandle - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle
00444         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's directory.
00445 
00446 Return Value:
00447 
00448     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - Standard Nt Result Code
00449 
00450         STATUS_INVALID_HANDLE - The specified handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invalid.
00451 
00452         STATUS_ACCESS_DENIED - The specified handle does not specify delet
00453             access.
00454 
00455 --*/
00456 
00457 {
00458     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00459 
00460     <span class="keywordflow">return</span>( <a class="code" href="../../d7/d7/ntapi_8c.html#a15">NtDeleteKey</a>(KeyHandle) );
00461 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="rtl/registry.c::RtlpNtOpenKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpNtOpenKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Options</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00070">70</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00055">REG_INVALID_ATTRIBUTES</a>, and <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00079                    :
00080 
00081     This function opens a key in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry.  The key must already exist.
00082 
00083 Arguments:
00084 
00085     KeyHandle - Receives a value called a <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to access
00086         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified key in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registration Database.
00087 
00088     DesiredAccess - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Accesses desired
00089 
00090         REG_KEY_READ - Generic Read access to key
00091           REG_KEY_QUERY_VALUE - Query <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>'s value
00092         REG_KEY_WRITE - Generic Write access to key
00093           REG_KEY_SET_VALUE - Set <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>'s value
00094 
00095     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key being opened.
00096         Note that a key name must be specified.  If a Root <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>
00097         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root.  The name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00098         object must be within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name space allocated to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry, that
00099         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>, all names beginning <span class="stringliteral">"\Registry"</span>.  RootHandle, <span class="keywordflow">if</span> present, must
00100         be a handle to <span class="stringliteral">"\", or "</span>\Registry<span class="stringliteral">", or a key under "</span>\Registry<span class="stringliteral">".</span>
00101 <span class="stringliteral"></span>
00102 <span class="stringliteral">    Options - REG_OPTION_READ_FUZZY - Allow Read access on handle even if</span>
00103 <span class="stringliteral">        it is open for Read/Write access.</span>
00104 <span class="stringliteral"></span>
00105 <span class="stringliteral">Return Value:</span>
00106 <span class="stringliteral"></span>
00107 <span class="stringliteral">    NTSTATUS - Result code from call.  The following are returned</span>
00108 <span class="stringliteral"></span>
00109 <span class="stringliteral">        STATUS_SUCCESS - The open was successful.</span>
00110 <span class="stringliteral"></span>
00111 <span class="stringliteral">        STATUS_INVALID_PARAMETER - A parameter other that object name was</span>
00112 <span class="stringliteral">            invalid.</span>
00113 <span class="stringliteral"></span>
00114 <span class="stringliteral">        STATUS_OBJECT_NAME_INVALID - The key name has invalid syntax</span>
00115 <span class="stringliteral"></span>
00116 <span class="stringliteral">        STATUS_OBJECT_NAME_NOT_FOUND - No key of the given name exists</span>
00117 <span class="stringliteral"></span>
00118 <span class="stringliteral">        STATUS_ACCESS_DENIED - Caller does not have the requested access</span>
00119 <span class="stringliteral">            to the specified key.</span>
00120 <span class="stringliteral">--*/</span>
00121 <span class="stringliteral"></span>
00122 <span class="stringliteral">{</span>
00123 <span class="stringliteral">    RTL_PAGED_CODE();</span>
00124 <span class="stringliteral"></span>
00125 <span class="stringliteral">    if (ARGUMENT_PRESENT(ObjectAttributes)) {</span>
00126 <span class="stringliteral">        ObjectAttributes-&gt;Attributes &amp;= ~(REG_INVALID_ATTRIBUTES);</span>
00127 <span class="stringliteral">    }</span>
00128 <span class="stringliteral"></span>
00129 <span class="stringliteral">    return( NtOpenKey( KeyHandle,</span>
00130 <span class="stringliteral">                       DesiredAccess,</span>
00131 <span class="stringliteral">                       ObjectAttributes</span>
00132 <span class="stringliteral">                       ) );</span>
00133 <span class="stringliteral"></span>
00134 <span class="stringliteral">    DBG_UNREFERENCED_PARAMETER( Options );</span>
00135 <span class="stringliteral">}</span>
</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="rtl/registry.c::RtlpNtQueryValueKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpNtQueryValueKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT OPTIONAL PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT OPTIONAL PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT OPTIONAL PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValueLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT OPTIONAL PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>LastWriteTime</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00226">226</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.
<p>
<pre class="fragment"><div>00236                    :
00237 
00238     This function queries <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of a key.
00239 
00240 Arguments:
00241 
00242     KeyHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of a key opened <span class="keywordflow">for</span> GENERIC_READ access via <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>.
00243 
00244     KeyValueType - Optional pointer to variable that will receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00245         client-defined <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key value (<span class="keywordflow">if</span> any).  If no value has been
00246         set <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key, 0 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00247 
00248     KeyValue - Optional pointer to buffer in which part or all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's
00249         value (as set on the most recent call to NtSetValueKey) will be
00250         returned.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too large to fit into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied
00251         buffer, as much of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value as will fit into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer will be
00252         returned and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> warning STATUS_BUFFER_OVERFLOW <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.  If no
00253         value has ever been set, nothing <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.  If <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified
00254         <span class="keywordflow">for</span> <span class="keyword">this</span> parameter, no <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a> Value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00255 
00256     KeyValueLength - On input, <span class="keyword">this</span> optional parameter points to a variable
00257         that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> KeyValue buffer (<span class="keywordflow">if</span> any).  If
00258         no KeyValue buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> variable content on entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00259         ignored.  On <span class="keywordflow">return</span>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> referenced variable (<span class="keywordflow">if</span> any) receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00260         FULL length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key value.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too
00261         large to fit into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied buffer, as much of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value as will
00262         fit into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer will be returned and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> warning
00263         STATUS_BUFFER_OVERFLOW <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00264 
00265         The returned length <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> intended <span class="keywordflow">for</span> use by calling code in allocating
00266         a buffer of sufficient size to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's value.  After receiving
00267         STATUS_BUFFER_OVERFLOW from <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>, calling code may make a
00268         subsequent call to <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a> with a buffer of size equal to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00269         length returned by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> prior call.
00270 
00271         If no value has been set <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key, 0 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00272 
00273     LastWriteTime - Optional parameter to variable which receives a time stamp
00274         specifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last time that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key was written.
00275 
00276 Return Value:
00277 
00278     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - Result code
00279 
00280         STATUS_SUCCESS - Call was successful
00281 
00282         STATUS_INVALID_PARAMETER - Invalid parameter
00283 
00284         STATUS_ACCESS_DENIED - Caller does not have GENERIC_READ access to
00285             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified key
00286 
00287         STATUS_BUFFER_OVERFLOW - This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a warning that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's value
00288             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too large <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> KeyValue and
00289             KeyValueLength parameters.  Use <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length returned to
00290             determine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of buffer to allocate <span class="keywordflow">for</span> a subsequent
00291             call of <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>.
00292 
00293 --*/
00294 
00295 {
00296 
00297     UNICODE_STRING NullName;
00298     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00299     PKEY_VALUE_PARTIAL_INFORMATION ValueInformation;
00300     ULONG ValueLength;
00301 
00302     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00303 
00304     <span class="comment">//</span>
00305     <span class="comment">// Compute the size of the buffer needed to hold the key value information.</span>
00306     <span class="comment">//</span>
00307 
00308     ValueLength = 0;
00309     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(KeyValueLength)) {
00310         ValueLength = *KeyValueLength;
00311     }
00312 
00313     ValueLength += FIELD_OFFSET(KEY_VALUE_PARTIAL_INFORMATION, Data);
00314     ValueInformation = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(RtlProcessHeap(), 0, ValueLength);
00315     <span class="keywordflow">if</span> (ValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00316         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00317     }
00318 
00319     <span class="comment">//</span>
00320     <span class="comment">// Query the key value.</span>
00321     <span class="comment">//</span>
00322 
00323     NullName.Length = 0;
00324     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(KeyHandle,
00325                              &amp;NullName,
00326                              KeyValuePartialInformation,
00327                              ValueInformation,
00328                              ValueLength,
00329                              &amp;ValueLength);
00330 
00331     <span class="comment">//</span>
00332     <span class="comment">// Temporary hack to allow query of "" attribute when it hasn't</span>
00333     <span class="comment">// yet been set.</span>
00334     <span class="comment">//</span>
00335 
00336     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
00337         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00338         ValueInformation-&gt;DataLength = 0;
00339         ValueInformation-&gt;Type = 0;
00340     }
00341 
00342     <span class="comment">//</span>
00343     <span class="comment">// If requested return the key value length and the key type.</span>
00344     <span class="comment">//</span>
00345 
00346     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW)) {
00347         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(KeyValueLength)) {
00348             *KeyValueLength = ValueInformation-&gt;DataLength;
00349         }
00350 
00351         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(KeyValueType)) {
00352             *KeyValueType = ValueInformation-&gt;Type;
00353         }
00354     }
00355 
00356     <span class="comment">//</span>
00357     <span class="comment">// If the query was successful and buffer overflow did not occur, then</span>
00358     <span class="comment">// return the key value information.</span>
00359     <span class="comment">//</span>
00360 
00361     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; ARGUMENT_PRESENT(KeyValue)) {
00362         RtlMoveMemory(KeyValue,
00363                       &amp;ValueInformation-&gt;Data[0],
00364                       ValueInformation-&gt;DataLength);
00365     }
00366 
00367     <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, ValueInformation);
00368     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00369 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="rtl/registry.c::RtlpNtSetValueKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpNtSetValueKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OPTIONAL PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValueLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00372">372</a> of file <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html">rtl/registry.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, and <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00381                    :
00382 
00383     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and value of a key.
00384 
00385 Arguments:
00386 
00387     KeyHandle - Specifies a handle of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key whose <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and value are to
00388         be set.  The key must have been opened with GENERIC_WRITE access.
00389 
00390     KeyValueType - This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a value that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry defines to
00391         distinguish different client-defined types of data value stored
00392         with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key.  When setting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of a key that has previously
00393         had a Type and Value stored, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Type may be changed.
00394 
00395     KeyValue - Optional pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to be optionally stored as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00396         value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key.  If <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified <span class="keywordflow">for</span> <span class="keyword">this</span> parameter, <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a>
00397         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> will be written.
00398 
00399     KeyValueLength - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to be stored as
00400         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key's value.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> zero value indicates that no data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being stored:
00401         <span class="keywordflow">if</span> zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Value parameter will be ignored.
00402 
00403 Return Value:
00404 
00405     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - Result code.  The following values are returned
00406 
00407         STATUS_SUCCESS - The call was successful
00408 
00409         STATUS_INVALID_PARAMETER - Invalid Parameter(s)
00410 --*/
00411 
00412 {
00413     UNICODE_STRING NullName;
00414     NullName.Length = 0;
00415 
00416     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00417 
00418     <span class="keywordflow">return</span>( <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>( KeyHandle,
00419                            &amp;NullName,       <span class="comment">// ValueName</span>
00420                            0,               <span class="comment">// TitleIndex</span>
00421                            KeyValueType,
00422                            KeyValue,
00423                            KeyValueLength
00424                            ) );
00425 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
