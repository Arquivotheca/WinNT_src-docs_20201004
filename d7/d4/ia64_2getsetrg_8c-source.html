<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: getsetrg.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>getsetrg.c</h1><a href="../../d6/d5/ia64_2getsetrg_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    getsetrg.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implement the code necessary to get and set register values.</span>
00012 <span class="comment">    These routines are used during the emulation of unaligned data references</span>
00013 <span class="comment">    and floating point exceptions.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    David N. Cutler (davec) 17-Jun-1991</span>
00018 <span class="comment"></span>
00019 <span class="comment">Environment:</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Kernel mode only.</span>
00022 <span class="comment"></span>
00023 <span class="comment">Revision History:</span>
00024 <span class="comment"></span>
00025 <span class="comment">--*/</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/ki_8h.html">ki.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="../../d1/d8/ntfpia64_8h.html">ntfpia64.h</a>"</span>
00029 
00030 
00031 
00032 ULONGLONG
<a name="l00033"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a2">00033</a> <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a> (
00034     IN ULONG Register,
00035     IN PKEXCEPTION_FRAME ExceptionFrame,
00036     IN PKTRAP_FRAME TrapFrame
00037     )
00038 
00039 <span class="comment">/*++</span>
00040 <span class="comment"></span>
00041 <span class="comment">Routine Description:</span>
00042 <span class="comment"></span>
00043 <span class="comment">    This function is called to get the value of a register from the specified</span>
00044 <span class="comment">    exception or trap frame.</span>
00045 <span class="comment"></span>
00046 <span class="comment">Arguments:</span>
00047 <span class="comment"></span>
00048 <span class="comment">    Register - Supplies the number of the register whose value is to be</span>
00049 <span class="comment">        returned. Integer registers are specified as 0 - 31 and floating</span>
00050 <span class="comment">        registers are specified as 32 - 63.</span>
00051 <span class="comment"></span>
00052 <span class="comment">    ExceptionFrame - Supplies a pointer to an exception frame.</span>
00053 <span class="comment"></span>
00054 <span class="comment">    TrapFrame - Supplies a pointer to a trap frame.</span>
00055 <span class="comment"></span>
00056 <span class="comment">Return Value:</span>
00057 <span class="comment"></span>
00058 <span class="comment">    The value of the specified register is returned as the function value.</span>
00059 <span class="comment"></span>
00060 <span class="comment">--*/</span>
00061 
00062 {
00063     <span class="comment">//</span>
00064     <span class="comment">// Dispatch on the register number.</span>
00065     <span class="comment">//</span>
00066 
00067     <span class="keywordflow">if</span> (Register == 0) {
00068         <span class="keywordflow">return</span> 0;
00069     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 3) {
00070         Register -= 1;
00071         <span class="keywordflow">return</span> ( *(&amp;TrapFrame-&gt;IntGp + Register) );
00072     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 7) {
00073         Register -= 4;
00074         <span class="keywordflow">return</span> ( *(&amp;ExceptionFrame-&gt;IntS0 + Register) );
00075     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 31) {
00076         Register -= 8;
00077         <span class="keywordflow">return</span> ( *(&amp;TrapFrame-&gt;IntV0 + Register) );
00078     }
00079     
00080     <span class="comment">//</span>
00081     <span class="comment">// Register is the stacked register</span>
00082     <span class="comment">//</span>
00083     <span class="comment">//   (R32 - R127)</span>
00084     <span class="comment">//</span>
00085 
00086     {
00087         PULONGLONG UserBStore, KernelBStore;
00088         ULONG RegisterOffset;
00089         ULONG i;
00090         ULONG SizeOfCurrentFrame;
00091         ULONG SizeOfDirty;
00092         LONG NumberOfDirty;
00093 
00094         SizeOfDirty = (ULONG)(TrapFrame-&gt;RsBSP - TrapFrame-&gt;RsBSPSTORE);
00095         NumberOfDirty = SizeOfDirty &gt;&gt; 3;
00096         SizeOfCurrentFrame = (ULONG)(TrapFrame-&gt;StIFS &amp; 0x7F);
00097 
00098         <span class="keywordflow">if</span> (TrapFrame-&gt;PreviousMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>) {
00099 
00100             <span class="comment">//</span>
00101             <span class="comment">// PreviousMode is user</span>
00102             <span class="comment">//</span>
00103 
00104             KernelBStore = (PULONGLONG)(PCR-&gt;InitialBStore + (TrapFrame-&gt;RsBSPSTORE &amp; 0x1F8) + SizeOfDirty);
00105 
00106             UserBStore = (ULONGLONG *) TrapFrame-&gt;RsBSP; 
00107 
00108             RegisterOffset = Register - 32;
00109 
00110             <span class="keywordflow">do</span> {
00111 
00112                 KernelBStore = KernelBStore - 1;
00113                 UserBStore = UserBStore - 1;
00114                 NumberOfDirty = NumberOfDirty -1;
00115                 
00116                 SizeOfCurrentFrame = SizeOfCurrentFrame - 1;
00117 
00118                 <span class="keywordflow">if</span> (((ULONG_PTR) KernelBStore &amp; 0x1F8) == 0x1F8) {
00119                     
00120                     <span class="comment">//</span>
00121                     <span class="comment">// Adjust UserBsp, by skipping RNAT</span>
00122                     <span class="comment">//</span>
00123 
00124                     KernelBStore = KernelBStore -1;
00125                 }
00126 
00127                 <span class="keywordflow">if</span> (((ULONG_PTR) UserBStore &amp; 0x1F8) == 0x1F8) {
00128                     
00129                     <span class="comment">//</span>
00130                     <span class="comment">// Adjust UserBsp, by skipping RNAT</span>
00131                     <span class="comment">//</span>
00132 
00133                     UserBStore = UserBStore -1;
00134                 }
00135 
00136             } <span class="keywordflow">while</span> (RegisterOffset &lt; SizeOfCurrentFrame); 
00137 
00138             <span class="keywordflow">if</span> (NumberOfDirty &gt;= 0) {
00139                 
00140                 <span class="keywordflow">return</span> (*KernelBStore);
00141 
00142             } <span class="keywordflow">else</span> {
00143 
00144                 <span class="keywordflow">return</span> (*UserBStore);
00145             }
00146             
00147         } <span class="keywordflow">else</span> {
00148 
00149             <span class="comment">//</span>
00150             <span class="comment">// PreviousMode is kernel</span>
00151             <span class="comment">//</span>
00152 
00153             KernelBStore = (ULONGLONG *) TrapFrame-&gt;RsBSP;
00154 
00155             RegisterOffset = Register - 32;
00156 
00157             <span class="keywordflow">do</span> {
00158 
00159                 KernelBStore = KernelBStore - 1;
00160 
00161                 SizeOfCurrentFrame = SizeOfCurrentFrame - 1;
00162 
00163                 <span class="keywordflow">if</span> (((ULONG_PTR) KernelBStore &amp; 0x1F8) == 0x1F8) {
00164                     
00165                     <span class="comment">//</span>
00166                     <span class="comment">// Adjust UserBsp, by skipping RNAT</span>
00167                     <span class="comment">//</span>
00168 
00169                     KernelBStore = KernelBStore -1;
00170                 }
00171                 
00172             } <span class="keywordflow">while</span> (RegisterOffset &lt; SizeOfCurrentFrame); 
00173             
00174             <span class="keywordflow">return</span> (*KernelBStore);
00175         }
00176     }
00177 }   
00178 
00179 
00180 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00181"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a3">00181</a> <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a> (
00182     IN ULONG Register,
00183     IN ULONGLONG Value,
00184     OUT PKEXCEPTION_FRAME ExceptionFrame,
00185     OUT PKTRAP_FRAME TrapFrame
00186     )
00187 
00188 <span class="comment">/*++</span>
00189 <span class="comment"></span>
00190 <span class="comment">Routine Description:</span>
00191 <span class="comment"></span>
00192 <span class="comment">    This function is called to set the value of a register in the specified</span>
00193 <span class="comment">    exception or trap frame.</span>
00194 <span class="comment"></span>
00195 <span class="comment">Arguments:</span>
00196 <span class="comment"></span>
00197 <span class="comment">    Register - Supplies the number of the register whose value is to be</span>
00198 <span class="comment">        stored. Integer registers are specified as 0 - 31 and floating</span>
00199 <span class="comment">        registers are specified as 32 - 63.</span>
00200 <span class="comment"></span>
00201 <span class="comment">    Value - Supplies the value to be stored in the specified register.</span>
00202 <span class="comment"></span>
00203 <span class="comment">    ExceptionFrame - Supplies a pointer to an exception frame.</span>
00204 <span class="comment"></span>
00205 <span class="comment">    TrapFrame - Supplies a pointer to a trap frame.</span>
00206 <span class="comment"></span>
00207 <span class="comment">Return Value:</span>
00208 <span class="comment"></span>
00209 <span class="comment">    None.</span>
00210 <span class="comment"></span>
00211 <span class="comment">--*/</span>
00212 
00213 {
00214 
00215     <span class="comment">//</span>
00216     <span class="comment">// Dispatch on the register number.</span>
00217     <span class="comment">//</span>
00218 
00219     <span class="keywordflow">if</span> (Register == 0) {
00220         <span class="keywordflow">return</span>;
00221     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 3) {
00222         Register -= 1;
00223         *(&amp;TrapFrame-&gt;IntGp + Register) = Value;
00224         <span class="keywordflow">return</span>;
00225     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 7) {
00226         Register -= 4;
00227         *(&amp;ExceptionFrame-&gt;IntS0 + Register) = Value;
00228         <span class="keywordflow">return</span>;
00229     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 31) {
00230         Register -= 8;
00231         *(&amp;TrapFrame-&gt;IntV0 + Register) = Value;
00232         <span class="keywordflow">return</span>;
00233     }
00234 
00235     <span class="comment">//</span>
00236     <span class="comment">// Register is the stacked register</span>
00237     <span class="comment">//</span>
00238     <span class="comment">//   (R32 - R127)</span>
00239     <span class="comment">//</span>
00240 
00241     {
00242         PULONGLONG UserBStore, KernelBStore;
00243         ULONG RegisterOffset;
00244         ULONG i;
00245         ULONG SizeOfCurrentFrame;
00246         ULONG SizeOfDirty;
00247         LONG NumberOfDirty;
00248 
00249         SizeOfDirty = (ULONG)(TrapFrame-&gt;RsBSP - TrapFrame-&gt;RsBSPSTORE);
00250         NumberOfDirty = SizeOfDirty &gt;&gt; 3;
00251         SizeOfCurrentFrame = (ULONG)(TrapFrame-&gt;StIFS &amp; 0x7F);
00252 
00253         <span class="keywordflow">if</span> (TrapFrame-&gt;PreviousMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>) {
00254 
00255             <span class="comment">//</span>
00256             <span class="comment">// PreviousMode is user</span>
00257             <span class="comment">//</span>
00258 
00259             KernelBStore = (PULONGLONG)(PCR-&gt;InitialBStore + (TrapFrame-&gt;RsBSPSTORE &amp; 0x1F8) + SizeOfDirty);
00260 
00261             UserBStore = (ULONGLONG *) TrapFrame-&gt;RsBSP; 
00262 
00263             RegisterOffset = Register - 32;
00264 
00265             <span class="keywordflow">do</span> {
00266 
00267                 KernelBStore = KernelBStore - 1;
00268                 UserBStore = UserBStore - 1;
00269                 NumberOfDirty = NumberOfDirty -1;
00270                 
00271                 SizeOfCurrentFrame = SizeOfCurrentFrame - 1;
00272 
00273                 <span class="keywordflow">if</span> (((ULONG_PTR) KernelBStore &amp; 0x1F8) == 0x1F8) {
00274                     
00275                     <span class="comment">//</span>
00276                     <span class="comment">// Adjust UserBsp, by skipping RNAT</span>
00277                     <span class="comment">//</span>
00278 
00279                     KernelBStore = KernelBStore -1;
00280                 }
00281 
00282                 <span class="keywordflow">if</span> (((ULONG_PTR) UserBStore &amp; 0x1F8) == 0x1F8) {
00283                     
00284                     <span class="comment">//</span>
00285                     <span class="comment">// Adjust UserBsp, by skipping RNAT</span>
00286                     <span class="comment">//</span>
00287 
00288                     UserBStore = UserBStore -1;
00289                 }
00290 
00291             } <span class="keywordflow">while</span> (RegisterOffset &lt; SizeOfCurrentFrame); 
00292 
00293             <span class="keywordflow">if</span> (NumberOfDirty &gt;= 0) {
00294                 
00295                 *KernelBStore = Value;
00296 
00297             } <span class="keywordflow">else</span> {
00298 
00299                 *UserBStore = Value;
00300             }
00301             
00302         } <span class="keywordflow">else</span> {
00303 
00304             <span class="comment">//</span>
00305             <span class="comment">// PreviousMode is kernel</span>
00306             <span class="comment">//</span>
00307 
00308             KernelBStore = (ULONGLONG *) TrapFrame-&gt;RsBSP;
00309 
00310             RegisterOffset = Register - 32;
00311 
00312             <span class="keywordflow">do</span> {
00313 
00314                 KernelBStore = KernelBStore - 1;
00315 
00316                 SizeOfCurrentFrame = SizeOfCurrentFrame - 1;
00317 
00318                 <span class="keywordflow">if</span> (((ULONG_PTR) KernelBStore &amp; 0x1F8) == 0x1F8) {
00319                     
00320                     <span class="comment">//</span>
00321                     <span class="comment">// Adjust UserBsp, by skipping RNAT</span>
00322                     <span class="comment">//</span>
00323 
00324                     KernelBStore = KernelBStore -1;
00325                 }
00326                 
00327             } <span class="keywordflow">while</span> (RegisterOffset &lt; SizeOfCurrentFrame); 
00328             
00329             *KernelBStore = Value;
00330         }
00331     }
00332 }   
00333 
<a name="l00334"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a0">00334</a> <span class="preprocessor">#define GET_NAT_ADDRESS(addr) (((ULONG_PTR) (addr) &gt;&gt; 3) &amp; 0x3F)</span>
00335 <span class="preprocessor"></span>
<a name="l00336"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">00336</a> <span class="preprocessor">#define GET_NAT(Nats, addr) (UCHAR)((Nats &gt;&gt; GET_NAT_ADDRESS(addr)) &amp; 1)</span>
00337 <span class="preprocessor"></span>
00338 
00339 UCHAR
<a name="l00340"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a4">00340</a> <a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a4">KiGetRegisterNaT</a> (
00341     IN ULONG Register,
00342     IN PKEXCEPTION_FRAME ExceptionFrame,
00343     IN PKTRAP_FRAME TrapFrame
00344     )
00345 {
00346     <span class="comment">//</span>
00347     <span class="comment">// Dispatch on the register number.</span>
00348     <span class="comment">//</span>
00349 
00350     <span class="keywordflow">switch</span> (Register) {
00351 
00352         <span class="comment">//</span>
00353         <span class="comment">// Integer register V0.</span>
00354         <span class="comment">//</span>
00355 
00356     <span class="keywordflow">case</span> 0:
00357         <span class="keywordflow">return</span> 0;
00358 
00359         <span class="comment">//</span>
00360         <span class="comment">// Integer Register R1 (GP)</span>
00361         <span class="comment">//</span>
00362 
00363     <span class="keywordflow">case</span> 1:
00364         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntGp));
00365         
00366         <span class="comment">//</span>
00367         <span class="comment">// Integer Register R2 (T0)</span>
00368         <span class="comment">//</span>
00369 
00370     <span class="keywordflow">case</span> 2:
00371         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT0));
00372 
00373         <span class="comment">//</span>
00374         <span class="comment">// Integer Register R3 (T1)</span>
00375         <span class="comment">//</span>
00376 
00377     <span class="keywordflow">case</span> 3:
00378         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT1));
00379 
00380         <span class="comment">//</span>
00381         <span class="comment">// Integer Register R4 (S0)</span>
00382         <span class="comment">//</span>
00383 
00384     <span class="keywordflow">case</span> 4:
00385         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(ExceptionFrame-&gt;IntNats, &amp;ExceptionFrame-&gt;IntS0));
00386 
00387         <span class="comment">//</span>
00388         <span class="comment">// Integer Register R5 (S1)</span>
00389         <span class="comment">//</span>
00390 
00391     <span class="keywordflow">case</span> 5:
00392         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(ExceptionFrame-&gt;IntNats, &amp;ExceptionFrame-&gt;IntS1));
00393 
00394         <span class="comment">//</span>
00395         <span class="comment">// Integer Register R6 (S2)</span>
00396         <span class="comment">//</span>
00397 
00398     <span class="keywordflow">case</span> 6:
00399         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(ExceptionFrame-&gt;IntNats, &amp;ExceptionFrame-&gt;IntS2));
00400 
00401         <span class="comment">//</span>
00402         <span class="comment">// Integer Register R7 (S3)</span>
00403         <span class="comment">//</span>
00404 
00405     <span class="keywordflow">case</span> 7:
00406         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(ExceptionFrame-&gt;IntNats, &amp;ExceptionFrame-&gt;IntS3));
00407 
00408         <span class="comment">//</span>
00409         <span class="comment">// Integer Register R8 (V0)</span>
00410         <span class="comment">//</span>
00411 
00412     <span class="keywordflow">case</span> 8:
00413         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntV0));
00414         
00415         <span class="comment">//</span>
00416         <span class="comment">// Integer Register R9 (T2)</span>
00417         <span class="comment">//</span>
00418    
00419     <span class="keywordflow">case</span> 9:
00420         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT2));
00421 
00422         <span class="comment">//</span>
00423         <span class="comment">// Integer Register R10 (T3)</span>
00424         <span class="comment">//</span>
00425 
00426     <span class="keywordflow">case</span> 10:
00427         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT3));
00428 
00429         <span class="comment">//</span>
00430         <span class="comment">// Integer Register R11 (T4)</span>
00431         <span class="comment">//</span>
00432 
00433     <span class="keywordflow">case</span> 11:
00434         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT4));
00435 
00436         <span class="comment">//</span>
00437         <span class="comment">// Integer Register R12 (Sp)</span>
00438         <span class="comment">//</span>
00439 
00440     <span class="keywordflow">case</span> 12:
00441         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntSp));
00442 
00443         <span class="comment">//</span>
00444         <span class="comment">// Integer Register R13 (Teb)</span>
00445         <span class="comment">//</span>
00446    
00447     <span class="keywordflow">case</span> 13:
00448         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntTeb));
00449 
00450         <span class="comment">//</span>
00451         <span class="comment">// Integer Register R14 (T5)</span>
00452         <span class="comment">//</span>
00453    
00454     <span class="keywordflow">case</span> 14:
00455         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT5));
00456 
00457         <span class="comment">//</span>
00458         <span class="comment">// Integer Register R15 (T6)</span>
00459         <span class="comment">//</span>
00460    
00461     <span class="keywordflow">case</span> 15:
00462         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT6));
00463 
00464         <span class="comment">//</span>
00465         <span class="comment">// Integer Register R16 (T7)</span>
00466         <span class="comment">//</span>
00467    
00468     <span class="keywordflow">case</span> 16:
00469         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT7));
00470 
00471         <span class="comment">//</span>
00472         <span class="comment">// Integer Register R17 (T8)</span>
00473         <span class="comment">//</span>
00474    
00475     <span class="keywordflow">case</span> 17:
00476         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT8));
00477 
00478         <span class="comment">//</span>
00479         <span class="comment">// Integer Register R18 (T9)</span>
00480         <span class="comment">//</span>
00481    
00482     <span class="keywordflow">case</span> 18:
00483         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT9));
00484 
00485         <span class="comment">//</span>
00486         <span class="comment">// Integer Register R19 (T10)</span>
00487         <span class="comment">//</span>
00488    
00489     <span class="keywordflow">case</span> 19:
00490         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT10));
00491 
00492         <span class="comment">//</span>
00493         <span class="comment">// Integer Register R20 (T11)</span>
00494         <span class="comment">//</span>
00495    
00496     <span class="keywordflow">case</span> 20:
00497         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT11));
00498 
00499         <span class="comment">//</span>
00500         <span class="comment">// Integer Register R21 (T12)</span>
00501         <span class="comment">//</span>
00502    
00503     <span class="keywordflow">case</span> 21:
00504         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT12));
00505 
00506         <span class="comment">//</span>
00507         <span class="comment">// Integer Register R22 (T13)</span>
00508         <span class="comment">//</span>
00509    
00510     <span class="keywordflow">case</span> 22:
00511         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT13));
00512 
00513         <span class="comment">//</span>
00514         <span class="comment">// Integer Register R23 (T14)</span>
00515         <span class="comment">//</span>
00516    
00517     <span class="keywordflow">case</span> 23:
00518         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT14));
00519 
00520         <span class="comment">//</span>
00521         <span class="comment">// Integer Register R24 (T15)</span>
00522         <span class="comment">//</span>
00523    
00524     <span class="keywordflow">case</span> 24:
00525         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT15));
00526 
00527         <span class="comment">//</span>
00528         <span class="comment">// Integer Register R25 (T16)</span>
00529         <span class="comment">//</span>
00530    
00531     <span class="keywordflow">case</span> 25:
00532         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT16));
00533 
00534         <span class="comment">//</span>
00535         <span class="comment">// Integer Register R26 (T17)</span>
00536         <span class="comment">//</span>
00537    
00538     <span class="keywordflow">case</span> 26:
00539         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT17));
00540 
00541         <span class="comment">//</span>
00542         <span class="comment">// Integer Register R27 (T18)</span>
00543         <span class="comment">//</span>
00544    
00545     <span class="keywordflow">case</span> 27:
00546         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT18));
00547 
00548         <span class="comment">//</span>
00549         <span class="comment">// Integer Register R28 (T19)</span>
00550         <span class="comment">//</span>
00551    
00552     <span class="keywordflow">case</span> 28:
00553         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT19));
00554 
00555         <span class="comment">//</span>
00556         <span class="comment">// Integer Register R29 (T20)</span>
00557         <span class="comment">//</span>
00558    
00559     <span class="keywordflow">case</span> 29:
00560         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT20));
00561 
00562         <span class="comment">//</span>
00563         <span class="comment">// Integer Register R30 (T21)</span>
00564         <span class="comment">//</span>
00565    
00566     <span class="keywordflow">case</span> 30:
00567         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT21));
00568 
00569         <span class="comment">//</span>
00570         <span class="comment">// Integer Register R31 (T22)</span>
00571         <span class="comment">//</span>
00572 
00573     <span class="keywordflow">case</span> 31:
00574         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a1">GET_NAT</a>(TrapFrame-&gt;IntNats, &amp;TrapFrame-&gt;IntT22));
00575 
00576     <span class="keywordflow">default</span>:
00577         <span class="keywordflow">break</span>;
00578    
00579     }
00580 
00581     <span class="keywordflow">return</span> 0;
00582 }
00583 
00584 
00585 FLOAT128
<a name="l00586"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a5">00586</a> <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a2">KiGetFloatRegisterValue</a> (
00587     IN ULONG Register,
00588     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00589     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00590     )
00591 
00592 {
00593     <span class="keywordflow">if</span> (Register == 0) {
00594         FLOAT128 <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> = {0ULL,0ULL};
00595         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>;
00596     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register == 1) {
00597         FLOAT128 <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> = {0x8000000000000000ULL,0x000000000000FFFFULL}; <span class="comment">// low,high</span>
00598         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>;
00599     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 5) {
00600         Register -= 2;
00601         <span class="keywordflow">return</span> ( *(&amp;ExceptionFrame-&gt;FltS0 + Register) );
00602     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 15) {
00603         Register -= 6;
00604         <span class="keywordflow">return</span> ( *(&amp;TrapFrame-&gt;FltT0 + Register) );
00605     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 31) {
00606         Register -= 16;
00607         <span class="keywordflow">return</span> ( *(&amp;ExceptionFrame-&gt;FltS4 + Register) );
00608     } <span class="keywordflow">else</span> {
00609         PKHIGHER_FP_VOLATILE HigherVolatile;
00610 
00611         HigherVolatile = GET_HIGH_FLOATING_POINT_REGISTER_SAVEAREA();
00612         Register -= 32;
00613         <span class="keywordflow">return</span> ( *(&amp;HigherVolatile-&gt;FltF32 + Register) );
00614     }
00615 }
00616 
00617 
00618 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00619"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a6">00619</a> <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a> (
00620     IN ULONG Register,
00621     IN FLOAT128 Value,
00622     OUT <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00623     OUT <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00624     )
00625 
00626 {
00627     <span class="keywordflow">if</span> (Register &lt;= 1) {
00628         <span class="keywordflow">return</span>;
00629     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 5) {
00630         Register -= 2;
00631         *(&amp;ExceptionFrame-&gt;FltS0 + Register) = Value;
00632         <span class="keywordflow">return</span>;
00633     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 15) {
00634         Register -= 6;
00635         *(&amp;TrapFrame-&gt;FltT0 + Register) = Value;
00636         <span class="keywordflow">return</span>;
00637     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Register &lt;= 31) {
00638         Register -= 16;
00639         *(&amp;ExceptionFrame-&gt;FltS4 + Register) = Value;
00640         <span class="keywordflow">return</span>;
00641     } <span class="keywordflow">else</span> {
00642         PKHIGHER_FP_VOLATILE HigherVolatile;
00643 
00644         HigherVolatile = GET_HIGH_FLOATING_POINT_REGISTER_SAVEAREA();
00645         Register -= 32;
00646         *(&amp;HigherVolatile-&gt;FltF32 + Register) = Value;
00647         <span class="keywordflow">return</span>;
00648     }
00649 }
00650 
00651 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00652 __cdecl
<a name="l00653"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a7">00653</a> <a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a7">KeSaveStateForHibernate</a>(
00654     IN PKPROCESSOR_STATE ProcessorState
00655     )
00656 <span class="comment">/*++</span>
00657 <span class="comment"></span>
00658 <span class="comment">Routine Description:</span>
00659 <span class="comment"></span>
00660 <span class="comment">    Saves all processor-specific state that must be preserved</span>
00661 <span class="comment">    across an S4 state (hibernation).</span>
00662 <span class="comment"></span>
00663 <span class="comment">Arguments:</span>
00664 <span class="comment"></span>
00665 <span class="comment">    ProcessorState - Supplies the KPROCESSOR_STATE where the</span>
00666 <span class="comment">        current CPU's state is to be saved.</span>
00667 <span class="comment"></span>
00668 <span class="comment">Return Value:</span>
00669 <span class="comment"></span>
00670 <span class="comment">    None.</span>
00671 <span class="comment"></span>
00672 <span class="comment">--*/</span>
00673 
00674 {
00675     <span class="comment">//</span>
00676     <span class="comment">// BUGBUG John Vert (jvert) 4/30/1998</span>
00677     <span class="comment">//  someone needs to implement this and probably put it in a more </span>
00678     <span class="comment">//  appropriate file.</span>
00679     
00680 }
00681 
00682 
00683 FLOAT128
<a name="l00684"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a8">00684</a> <a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a8">get_fp_register</a> (
00685     IN ULONG Register,
00686     IN PVOID FpState
00687     )
00688 {
00689     <span class="keywordflow">return</span>(<a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a2">KiGetFloatRegisterValue</a> (
00690                Register, 
00691                ((<a class="code" href="../../d8/d2/struct__FLOATING__POINT__STATE.html">PFLOATING_POINT_STATE</a>)FpState)-&gt;ExceptionFrame,
00692                ((<a class="code" href="../../d8/d2/struct__FLOATING__POINT__STATE.html">PFLOATING_POINT_STATE</a>)FpState)-&gt;TrapFrame
00693                ));
00694 }
00695 
00696 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00697"></a><a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a9">00697</a> <a class="code" href="../../d6/d5/ia64_2getsetrg_8c.html#a9">set_fp_register</a> (
00698     IN ULONG Register,
00699     IN FLOAT128 Value,
00700     IN PVOID FpState
00701     )
00702 {
00703     <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a> (
00704         Register, 
00705         Value,
00706         ((<a class="code" href="../../d8/d2/struct__FLOATING__POINT__STATE.html">PFLOATING_POINT_STATE</a>)FpState)-&gt;ExceptionFrame,
00707         ((<a class="code" href="../../d8/d2/struct__FLOATING__POINT__STATE.html">PFLOATING_POINT_STATE</a>)FpState)-&gt;TrapFrame
00708         );
00709 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:13 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
