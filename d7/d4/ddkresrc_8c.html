<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ddkresrc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ddkresrc.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>
<code>#include &lt;nturtl.h&gt;</code><br>

<p>
<a href="../../d8/d3/ddkresrc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a0">ASSERT_RESOURCE</a>(_Resource)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a1">ExclusiveWaiter</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a2">SharedWaiter</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a3">DisablePriorityBoost</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a4">CounterShiftBit</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a5">IsExclusiveWaiting</a>(a)&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; ExclusiveWaiter) != 0)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a6">IsOwnedExclusive</a>(a)&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; ResourceOwnedExclusive) != 0)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a7">IsOwnedExclusive</a>(a)&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; ResourceOwnedExclusive) != 0)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a8">IsBoostAllowed</a>(a)&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; DisablePriorityBoost) == 0)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a9">AcquireResourceLock</a>(_Resource, _Irql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a>(_Resource, _Irql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a11">INITIAL_TABLE_SIZE</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a12">WaitForResourceExclusive</a>(_Resource, _OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a13">WakeExclusiveWaiters</a>(_Resource)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a18">ExpWaitForResourceDdk</a> (IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>, IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a19">ExInitializeResource</a> (IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a20">ExAcquireResourceExclusive</a> (IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>, IN BOOLEAN Wait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a21">ExReleaseResourceForThread</a> (IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>, IN <a class="el" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a> OurThread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a22">ExDeleteResource</a> (IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a14">ExpTimeout</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a15">ExpResourceTimeoutCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a16">ExpResourceSpinLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/ddkresrc_8c.html#a17">ExpSystemResourcesList</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a9" doxytag="ddkresrc.c::AcquireResourceLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define AcquireResourceLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Resource,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Irql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{              \
    ExAcquireSpinLock( &amp;_Resource-&gt;SpinLock, _Irql );       \
    <a class="code" href="../../d7/d4/ddkresrc_8c.html#a0">ASSERT_RESOURCE</a>( _Resource );                           \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00115">115</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00249">ExAcquireResourceExclusive()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00342">ExReleaseResourceForThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ddkresrc.c::ASSERT_RESOURCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ASSERT_RESOURCE          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Resource&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00070">70</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00762">ExAcquireResourceSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01014">ExAcquireSharedStarveExclusive()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01165">ExAcquireSharedWaitForExclusive()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01942">ExConvertExclusiveToSharedLite()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00422">ExDeleteResource()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02005">ExDeleteResourceLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00370">ExDisableResourceBoostLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02187">ExIsResourceAcquiredExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02245">ExIsResourceAcquiredSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02683">ExpFindCurrentThread()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01607">ExReleaseResourceForThreadLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01389">ExReleaseResourceLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01820">ExSetResourceOwnerPointer()</a>, and <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00598">ExTryToAcquireResourceExclusiveLite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ddkresrc.c::CounterShiftBit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CounterShiftBit&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00086">86</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ddkresrc.c::DisablePriorityBoost" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DisablePriorityBoost&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00080">80</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00370">ExDisableResourceBoostLite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ddkresrc.c::ExclusiveWaiter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ExclusiveWaiter&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00077">77</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ddkresrc.c::INITIAL_TABLE_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INITIAL_TABLE_SIZE&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00124">124</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00172">ExInitializeResource()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ddkresrc.c::IsBoostAllowed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IsBoostAllowed          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; DisablePriorityBoost) == 0)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00092">92</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02506">ExpWaitForResource()</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ddkresrc.c::IsExclusiveWaiting" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IsExclusiveWaiting          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; ExclusiveWaiter) != 0)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00089">89</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00762">ExAcquireResourceSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01165">ExAcquireSharedWaitForExclusive()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00422">ExDeleteResource()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02005">ExDeleteResourceLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02506">ExpWaitForResource()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00342">ExReleaseResourceForThread()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01607">ExReleaseResourceForThreadLite()</a>, and <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01389">ExReleaseResourceLite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ddkresrc.c::IsOwnedExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IsOwnedExclusive          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; ResourceOwnedExclusive) != 0)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00091">91</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ddkresrc.c::IsOwnedExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IsOwnedExclusive          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((a)-&gt;Flag &amp; ResourceOwnedExclusive) != 0)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00091">91</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00249">ExAcquireResourceExclusive()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00762">ExAcquireResourceSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01014">ExAcquireSharedStarveExclusive()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01165">ExAcquireSharedWaitForExclusive()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01942">ExConvertExclusiveToSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02187">ExIsResourceAcquiredExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02506">ExpWaitForResource()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01607">ExReleaseResourceForThreadLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01389">ExReleaseResourceLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01820">ExSetResourceOwnerPointer()</a>, and <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00598">ExTryToAcquireResourceExclusiveLite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ddkresrc.c::ReleaseResourceLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ReleaseResourceLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Resource,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Irql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{              \
    ExReleaseSpinLock( &amp;_Resource-&gt;SpinLock, _Irql );       \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00120">120</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00249">ExAcquireResourceExclusive()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00342">ExReleaseResourceForThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ddkresrc.c::SharedWaiter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SharedWaiter&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00078">78</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ddkresrc.c::WaitForResourceExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WaitForResourceExclusive          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Resource,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{               \
    _Resource-&gt;Flag |= <a class="code" href="../../d7/d4/ddkresrc_8c.html#a1">ExclusiveWaiter</a>;                                 \
    _Resource-&gt;NumberOfExclusiveWaiters += 1;                           \
    <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a> ( _Resource, _OldIrql );                        \
    <a class="code" href="../../d7/d4/ddkresrc_8c.html#a18">ExpWaitForResourceDdk</a>  ( _Resource, &amp;_Resource-&gt;ExclusiveWaiters ); \
    <a class="code" href="../../d7/d4/ddkresrc_8c.html#a9">AcquireResourceLock</a> ( _Resource, &amp;_OldIrql);                        \
    <span class="keywordflow">if</span> (--_Resource-&gt;NumberOfExclusiveWaiters != 0) {                   \
        _Resource-&gt;Flag |= <a class="code" href="../../d7/d4/ddkresrc_8c.html#a1">ExclusiveWaiter</a>;                             \
    }                                                                   \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00126">126</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00249">ExAcquireResourceExclusive()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ddkresrc.c::WakeExclusiveWaiters" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WakeExclusiveWaiters          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Resource&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                            \
    _Resource-&gt;Flag &amp;= ~<a class="code" href="../../d7/d4/ddkresrc_8c.html#a1">ExclusiveWaiter</a>;                                \
    <a class="code" href="../../d4/d9/ke_8h.html#a282">KeSetEvent</a>(&amp;_Resource-&gt;ExclusiveWaiters, 0, FALSE);                 \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00137">137</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00342">ExReleaseResourceForThread()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a20" doxytag="ddkresrc.c::ExAcquireResourceExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ExAcquireResourceExclusive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Resource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00249">249</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
References <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00115">AcquireResourceLock</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02289">_ERESOURCE::ActiveCount</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02274">ERESOURCE_THREAD</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02455">ExGetCurrentResourceThread</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02290">_ERESOURCE::Flag</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00091">IsOwnedExclusive</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02293">_ERESOURCE::OwnerThreads</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00120">ReleaseResourceLock</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02309">ResourceNeverExclusive</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02311">ResourceOwnedExclusive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00126">WaitForResourceExclusive</a>.
<p>
<pre class="fragment"><div>00256                    :
00257 
00258     The routine acquires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource <span class="keywordflow">for</span> exclusive access.  Upon <span class="keywordflow">return</span> from
00259     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> acquired <span class="keywordflow">for</span> exclusive access.
00260 
00261 Arguments:
00262 
00263     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource to acquire
00264 
00265     Wait - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed to wait <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource
00266         to become available <span class="keywordflow">for</span> must <span class="keywordflow">return</span> immediately
00267 
00268 Return Value:
00269 
00270     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> acquired and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
00271 
00272 --*/
00273 
00274 {
00275     KIRQL OldIrql;
00276     <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a>  OurThread;
00277 
00278     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"Routine cannot be called at DPC "</span>, !KeIsExecutingDpc() );
00279 
00280     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o3">Flag</a> &amp; ResourceNeverExclusive) == 0);
00281 
00282     OurThread = (ULONG_PTR)<a class="code" href="../../d5/d8/ex_8h.html#a67">ExGetCurrentResourceThread</a>();
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">//  Get exclusive access to this resource structure</span>
00286     <span class="comment">//</span>
00287 
00288     <a class="code" href="../../d7/d4/ddkresrc_8c.html#a9">AcquireResourceLock</a>( Resource, &amp;OldIrql );
00289 
00290     <span class="comment">//</span>
00291     <span class="comment">//  Loop until the resource is ours or exit if we cannot wait.</span>
00292     <span class="comment">//</span>
00293 
00294     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00295         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a> == 0) {
00296 
00297             <span class="comment">//</span>
00298             <span class="comment">// Resource is un-owned, obtain it exclusive</span>
00299             <span class="comment">//</span>
00300 
00301             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;InitialOwnerThreads[0] = OurThread;
00302             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[0] = OurThread;
00303             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;OwnerCounts[0]  = 1;
00304             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a>     = 1;
00305             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o3">Flag</a>           |= <a class="code" href="../../d5/d8/ex_8h.html#a64">ResourceOwnedExclusive</a>;
00306             <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a> ( Resource, OldIrql );
00307             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00308         }
00309 
00310         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/ddkresrc_8c.html#a6">IsOwnedExclusive</a>(Resource) &amp;&amp;
00311             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[0] == OurThread) {
00312 
00313             <span class="comment">//</span>
00314             <span class="comment">// Our thread is already the exclusive resource owner</span>
00315             <span class="comment">//</span>
00316 
00317             <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;OwnerCounts[0] += 1;
00318             <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a>( Resource, OldIrql );
00319             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00320         }
00321 
00322         <span class="comment">//</span>
00323         <span class="comment">//  Check if we are allowed to wait or must return immediately, and</span>
00324         <span class="comment">//  indicate that we didn't acquire the resource</span>
00325         <span class="comment">//</span>
00326 
00327         <span class="keywordflow">if</span> (!Wait) {
00328             <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a>( Resource, OldIrql );
00329             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00330         }
00331 
00332         <span class="comment">//</span>
00333         <span class="comment">//  Otherwise we need to wait to acquire the resource.</span>
00334         <span class="comment">//</span>
00335 
00336         <a class="code" href="../../d7/d4/ddkresrc_8c.html#a12">WaitForResourceExclusive</a> ( Resource, OldIrql );
00337     }
00338 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ddkresrc.c::ExDeleteResource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExDeleteResource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Resource</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00422">422</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00070">ASSERT_RESOURCE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00099">ExpResourceSpinLock</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00089">IsExclusiveWaiting</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l02287">_ERESOURCE::SystemResourcesList</a>.
<p>
<pre class="fragment"><div>00428                    :
00429 
00430     This routine deletes (i.e., uninitializes) the input resource variable
00431 
00432 
00433 Arguments:
00434 
00435     Resource - Supplies the resource variable being deleted
00436 
00437 Return Value:
00438 
00439     None
00440 
00441 --*/
00442 
00443 {
00444     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"Routine cannot be called at DPC "</span>, !KeIsExecutingDpc() );
00445 
00446     <a class="code" href="../../d7/d4/ddkresrc_8c.html#a0">ASSERT_RESOURCE</a>( Resource );
00447     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( !<a class="code" href="../../d7/d4/ddkresrc_8c.html#a5">IsExclusiveWaiting</a>(Resource) );
00448 
00449 
00450     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> &gt;= (<a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>)MM_USER_PROBE_ADDRESS) {
00451         KIRQL OldIrql;
00452 
00453         ExAcquireSpinLock( &amp;ExpResourceSpinLock, &amp;OldIrql );
00454         RemoveEntryList( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o0">SystemResourcesList</a> );
00455         ExReleaseSpinLock( &amp;ExpResourceSpinLock, OldIrql );
00456 
00457     }
00458 
00459     <span class="keywordflow">return</span> STATUS_SUCCESS;
00460 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ddkresrc.c::ExInitializeResource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExInitializeResource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Resource</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00172">172</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l02289">_ERESOURCE::ActiveCount</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02294">_ERESOURCE::ContentionCount</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02299">_ERESOURCE::CreatorBackTraceIndex</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02292">_ERESOURCE::ExclusiveWaiters</a>, <a class="el" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList()</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00099">ExpResourceSpinLock</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00157">ExpSystemResourcesList</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02290">_ERESOURCE::Flag</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00124">INITIAL_TABLE_SIZE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00039">KeInitializeSemaphore()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00437">MmDeterminePoolType()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02296">_ERESOURCE::NumberOfExclusiveWaiters</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02295">_ERESOURCE::NumberOfSharedWaiters</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02293">_ERESOURCE::OwnerThreads</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02291">_ERESOURCE::SharedWaiters</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02302">_ERESOURCE::SpinLock</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l02287">_ERESOURCE::SystemResourcesList</a>.
<p>
<pre class="fragment"><div>00178                    :
00179 
00180     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input resource variable
00181 
00182 Arguments:
00183 
00184     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource variable being initialized
00185 
00186 Return Value:
00187 
00188     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
00189 
00190 --*/
00191 
00192 {
00193     ULONG   i;
00194 
00195     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"A resource cannot be in paged pool "</span>, <a class="code" href="../../d1/d6/allocpag_8c.html#a48">MmDeterminePoolType</a>(Resource) == NonPagedPool);
00196     <span class="comment">//</span>
00197     <span class="comment">//  Initialize the shared and exclusive waiting counters and semaphore.</span>
00198     <span class="comment">//  The counters indicate how many are waiting for access to the resource</span>
00199     <span class="comment">//  and the semaphores are used to wait on the resource.  Note that</span>
00200     <span class="comment">//  the semaphores can also indicate the number waiting for a resource</span>
00201     <span class="comment">//  however there is a race condition in the algorithm on the acquire</span>
00202     <span class="comment">//  side if count if not updated before the critical section is exited.</span>
00203     <span class="comment">//  So we need to have an outside counter.</span>
00204     <span class="comment">//</span>
00205 
00206     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o8">NumberOfSharedWaiters</a>    = 0;
00207     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o9">NumberOfExclusiveWaiters</a> = 0;
00208 
00209     <a class="code" href="../../d1/d6/semphobj_8c.html#a1">KeInitializeSemaphore</a> ( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o4">SharedWaiters</a>, 0, MAXLONG );
00210     <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>     ( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o5">ExclusiveWaiters</a>, SynchronizationEvent, FALSE );
00211     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>  ( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o12">SpinLock</a> );
00212 
00213     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a> = <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;InitialOwnerThreads;
00214     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;OwnerCounts  = <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;InitialOwnerCounts;
00215 
00216     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;TableSize    = <a class="code" href="../../d7/d4/ddkresrc_8c.html#a11">INITIAL_TABLE_SIZE</a>;
00217     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a>  = 0;
00218     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;TableRover   = 1;
00219     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o3">Flag</a>         = 0;
00220 
00221     <span class="keywordflow">for</span>(i=0; i &lt; <a class="code" href="../../d7/d4/ddkresrc_8c.html#a11">INITIAL_TABLE_SIZE</a>; i++) {
00222         <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[i] = 0;
00223         <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;OwnerCounts[i] = 0;
00224     }
00225 
00226     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o7">ContentionCount</a> = 0;
00227     InitializeListHead( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o0">SystemResourcesList</a> );
00228 
00229 <span class="preprocessor">#if i386 &amp;&amp; !FPO</span>
00230 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_KERNEL_STACK_TRACE_DB) {
00231         <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o11">CreatorBackTraceIndex</a> = RtlLogStackBackTrace();
00232         }
00233     <span class="keywordflow">else</span> {
00234         <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o11">CreatorBackTraceIndex</a> = 0;
00235         }
00236 <span class="preprocessor">#endif // i386 &amp;&amp; !FPO</span>
00237 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> &gt;= (<a class="code" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>)MM_USER_PROBE_ADDRESS) {
00238         <a class="code" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList</a> (
00239                 &amp;ExpSystemResourcesList,
00240                 &amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o0">SystemResourcesList</a>,
00241                 &amp;ExpResourceSpinLock );
00242     }
00243 
00244     <span class="keywordflow">return</span> STATUS_SUCCESS;
00245 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ddkresrc.c::ExpWaitForResourceDdk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExpWaitForResourceDdk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Resource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">463</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
References <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00115">AcquireResourceLock</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02289">_ERESOURCE::ActiveCount</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02294">_ERESOURCE::ContentionCount</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00169">ERESOURCE_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00100">ExpResourceTimeoutCount</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00035">ExpTimeout</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00092">IsBoostAllowed</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00089">IsExclusiveWaiting</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00091">IsOwnedExclusive</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00459">KeBoostPriorityThread()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02296">_ERESOURCE::NumberOfExclusiveWaiters</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02293">_ERESOURCE::OwnerThreads</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00120">ReleaseResourceLock</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00469                    :
00470 
00471     The routine waits on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>'s object to be set.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00472     wait <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too <span class="keywordtype">long</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current owners of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource are boosted
00473     in priority.
00474 
00475 Arguments:
00476 
00477     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource
00478 
00479     Object - <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> or Semaphore to wait on
00480 
00481 Return Value:
00482 
00483     None
00484 
00485 --*/
00486 {
00487     KIRQL       OldIrql;
00488     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00489     ULONG       i;
00490 
00491 
00492     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o7">ContentionCount</a> += 1;
00493 
00494     i = 0;
00495     <span class="keywordflow">for</span> (; ;) {
00496         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a> (
00497                         Object,
00498                         Executive,
00499                         KernelMode,
00500                         FALSE,
00501                         &amp;ExpTimeout );
00502 
00503         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_TIMEOUT) {
00504             <span class="keywordflow">break</span>;
00505         }
00506 
00507         <span class="keywordflow">if</span> (i++ &gt;= <a class="code" href="../../d8/d0/cmdat3_8c.html#a44">ExpResourceTimeoutCount</a>) {
00508             i = 0;
00509 
00510             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Resource @ %lx\n"</span>, Resource);
00511             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ActiveCount = %04lx  Flags = %s%s%s\n"</span>,
00512                 <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a>,
00513                 <a class="code" href="../../d7/d4/ddkresrc_8c.html#a6">IsOwnedExclusive</a>(Resource)   ? <span class="stringliteral">"IsOwnedExclusive "</span> : <span class="stringliteral">""</span>,
00514                 <span class="stringliteral">""</span>,
00515                 <a class="code" href="../../d7/d4/ddkresrc_8c.html#a5">IsExclusiveWaiting</a>(Resource) ? <span class="stringliteral">"ExclusiveWaiter "</span>  : <span class="stringliteral">""</span>
00516             );
00517 
00518             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" NumberOfExclusiveWaiters = %04lx\n"</span>, <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o9">NumberOfExclusiveWaiters</a>);
00519 
00520             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"  Thread = %08lx, Count = %02x\n"</span>,
00521                 <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[0],
00522                 <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;OwnerCounts[0] );
00523 
00524             DbgBreakPoint();
00525             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EX - Rewaiting\n"</span>);
00526         }
00527 
00528         <span class="comment">//</span>
00529         <span class="comment">//  Give owning thread(s) a priority boost</span>
00530         <span class="comment">//</span>
00531 
00532         <a class="code" href="../../d7/d4/ddkresrc_8c.html#a9">AcquireResourceLock</a>( Resource, &amp;OldIrql );
00533 
00534         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/ddkresrc_8c.html#a8">IsBoostAllowed</a>(Resource) &amp;&amp; <a class="code" href="../../d7/d4/ddkresrc_8c.html#a6">IsOwnedExclusive</a>(Resource)) {
00535 
00536             <span class="comment">//</span>
00537             <span class="comment">//  Only one thread, boost it</span>
00538             <span class="comment">//</span>
00539 
00540             <a class="code" href="../../d9/d1/thredobj_8c.html#a4">KeBoostPriorityThread</a>((<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>) <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[0],
00541                                   ERESOURCE_INCREMENT );
00542         }
00543 
00544         <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a>( Resource, OldIrql );
00545 
00546         <span class="comment">//</span>
00547         <span class="comment">//  Loop and wait some more</span>
00548         <span class="comment">//</span>
00549     }
00550 
00551     <span class="comment">//</span>
00552     <span class="comment">//  Wait was satisfied</span>
00553     <span class="comment">//</span>
00554 
00555     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00556     <span class="keywordflow">return</span> ;
00557 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ddkresrc.c::ExReleaseResourceForThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExReleaseResourceForThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d4/struct__NTDDK__ERESOURCE.html">PNTDDK_ERESOURCE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Resource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OurThread</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00342">342</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
References <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00115">AcquireResourceLock</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02289">_ERESOURCE::ActiveCount</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02290">_ERESOURCE::Flag</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00089">IsExclusiveWaiting</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02293">_ERESOURCE::OwnerThreads</a>, <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00120">ReleaseResourceLock</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02311">ResourceOwnedExclusive</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00137">WakeExclusiveWaiters</a>.
<p>
<pre class="fragment"><div>00349                    :
00350 
00351     This routine release <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input resource <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> indicated thread.  The
00352     resource could have been acquired <span class="keywordflow">for</span> either shared or exclusive access.
00353 
00354 Arguments:
00355 
00356     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource to release
00357 
00358     Thread - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread that originally acquired <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource
00359 
00360 Return Value:
00361 
00362     None.
00363 
00364 --*/
00365 
00366 {
00367     KIRQL OldIrql;
00368 
00369     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( OurThread != 0 );
00370 
00371     <span class="comment">//</span>
00372     <span class="comment">//  Get exclusive access to this resource structure</span>
00373     <span class="comment">//</span>
00374 
00375     <a class="code" href="../../d7/d4/ddkresrc_8c.html#a9">AcquireResourceLock</a>( Resource, &amp;OldIrql );
00376 
00377     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[0] == OurThread );
00378 
00379     <span class="comment">//</span>
00380     <span class="comment">// OwnerThread[0] is optimized for resources which get</span>
00381     <span class="comment">// single users.  We check it first, plus we clear the</span>
00382     <span class="comment">// threadid if the counts goes to zero</span>
00383     <span class="comment">//</span>
00384 
00385     <span class="keywordflow">if</span> (--<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;OwnerCounts[0] != 0) {
00386         <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a>( Resource, OldIrql );
00387         <span class="keywordflow">return</span>;
00388     }
00389 
00390     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o6">OwnerThreads</a>[0] = 0;
00391     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;InitialOwnerThreads[0] = 0;
00392 
00393     <span class="comment">//</span>
00394     <span class="comment">// Thread's count went to zero, lower the resource's active count.</span>
00395     <span class="comment">//</span>
00396 
00397     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a> -= 1;
00398 
00399     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o2">ActiveCount</a> == 0 );
00400 
00401     <span class="comment">//</span>
00402     <span class="comment">// Resource's activecount went to zero - clear possible exclusive</span>
00403     <span class="comment">// owner bit, and wake any waiters</span>
00404     <span class="comment">//</span>
00405 
00406     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/ddkresrc_8c.html#a5">IsExclusiveWaiting</a>(Resource)) {
00407 
00408         <a class="code" href="../../d7/d4/ddkresrc_8c.html#a13">WakeExclusiveWaiters</a> ( Resource );
00409     }
00410 
00411     <span class="comment">//</span>
00412     <span class="comment">//  No longer owned exclusive</span>
00413     <span class="comment">//</span>
00414 
00415     <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>-&gt;<a class="code" href="../../d6/d4/struct__ERESOURCE.html#o3">Flag</a> &amp;= ~<a class="code" href="../../d5/d8/ex_8h.html#a64">ResourceOwnedExclusive</a>;
00416 
00417     <a class="code" href="../../d7/d4/ddkresrc_8c.html#a10">ReleaseResourceLock</a>( Resource, OldIrql );
00418     <span class="keywordflow">return</span>;
00419 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a16" doxytag="ddkresrc.c::ExpResourceSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d8/d8/ex_2resource_8c.html#a9">ExpResourceSpinLock</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00099">99</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00422">ExDeleteResource()</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00172">ExInitializeResource()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ddkresrc.c::ExpResourceTimeoutCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d8/d8/ex_2resource_8c.html#a8">ExpResourceTimeoutCount</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00041">41</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ddkresrc.c::ExpSystemResourcesList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d5/4_2kddata_8c.html#a2">ExpSystemResourcesList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00157">157</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00172">ExInitializeResource()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00209">ExInitializeResourceLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02894">ExpCheckForResource()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00150">ExpResourceInitialization()</a>, and <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02335">ExQuerySystemLockInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ddkresrc.c::ExpTimeout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d8/d8/ex_2resource_8c.html#a7">ExpTimeout</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00035">35</a> of file <a class="el" href="../../d8/d3/ddkresrc_8c-source.html">ddkresrc.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00150">ExpResourceInitialization()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02506">ExpWaitForResource()</a>, and <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
