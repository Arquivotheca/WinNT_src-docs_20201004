<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: obquery.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>obquery.c</h1><a href="../../d6/d1/obquery_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    obquery.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Query Object system service</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Steve Wood (stevewo) 12-May-1989</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d5/d1/obp_8h.html">obp.h</a>"</span>
00022 
00023 <span class="comment">//</span>
00024 <span class="comment">//  Local procedure prototypes</span>
00025 <span class="comment">//</span>
00026 
00027 <span class="comment">//</span>
00028 <span class="comment">//  The following structure is used to pass the call back routine</span>
00029 <span class="comment">//  "ObpSetHandleAttributes" the captured object information and</span>
00030 <span class="comment">//  the processor mode of the caller.</span>
00031 <span class="comment">//</span>
00032 
<a name="l00033"></a><a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html">00033</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html">__OBP_SET_HANDLE_ATTRIBUTES</a> {
00034 
<a name="l00035"></a><a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o0">00035</a>     OBJECT_HANDLE_FLAG_INFORMATION <a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o0">ObjectInformation</a>;
00036 
<a name="l00037"></a><a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o1">00037</a>     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> <a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o1">PreviousMode</a>;
00038 
00039 } <a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html">OBP_SET_HANDLE_ATTRIBUTES</a>, *<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html">POBP_SET_HANDLE_ATTRIBUTES</a>;
00040 
00041 BOOLEAN
00042 <a class="code" href="../../d6/d1/obquery_8c.html#a11">ObpSetHandleAttributes</a> (
00043     IN OUT PVOID TableEntry,
00044     IN ULONG_PTR Parameter
00045     );
00046 
00047 <span class="preprocessor">#if defined(ALLOC_PRAGMA)</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,NtQueryObject)</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,ObQueryNameString)</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,ObQueryTypeName)</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,ObQueryTypeInfo)</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,ObQueryObjectAuditingByHandle)</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,NtSetInformationObject)</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00055 <span class="preprocessor"></span>
00056 
00057 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00058"></a><a class="code" href="../../d6/d1/obquery_8c.html#a5">00058</a> <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a> (
00059     IN HANDLE Handle,
00060     IN OBJECT_INFORMATION_CLASS ObjectInformationClass,
00061     OUT PVOID ObjectInformation,
00062     IN ULONG ObjectInformationLength,
00063     OUT PULONG ReturnLength OPTIONAL
00064     )
00065 
00066 <span class="comment">/*++</span>
00067 <span class="comment"></span>
00068 <span class="comment">Routine description:</span>
00069 <span class="comment"></span>
00070 <span class="comment">    This routine is used to query information about a given object</span>
00071 <span class="comment"></span>
00072 <span class="comment">Arguments:</span>
00073 <span class="comment"></span>
00074 <span class="comment">    Handle - Supplies a handle to the object being queried.  This value</span>
00075 <span class="comment">        is ignored if the requested information class is for type</span>
00076 <span class="comment">        information.</span>
00077 <span class="comment"></span>
00078 <span class="comment">    ObjectInformationClass - Specifies the type of information to return</span>
00079 <span class="comment"></span>
00080 <span class="comment">    ObjectInformation - Supplies an output buffer for the information being</span>
00081 <span class="comment">        returned</span>
00082 <span class="comment"></span>
00083 <span class="comment">    ObjectInformationLength - Specifies, in bytes, the length of the</span>
00084 <span class="comment">        preceding object information buffer</span>
00085 <span class="comment"></span>
00086 <span class="comment">    ReturnLength - Optionally receives the length, in bytes, used to store</span>
00087 <span class="comment">        the object information</span>
00088 <span class="comment"></span>
00089 <span class="comment">Return Value:</span>
00090 <span class="comment"></span>
00091 <span class="comment">    An appropriate status value</span>
00092 <span class="comment"></span>
00093 <span class="comment">--*/</span>
00094 
00095 {
00096     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00097     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00098     PVOID Object;
00099     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00100     <a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a> QuotaInfo;
00101     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
00102     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
00103     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectDirectoryHeader;
00104     <a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">POBJECT_DIRECTORY</a> ObjectDirectory;
00105     ACCESS_MASK GrantedAccess;
00106     POBJECT_HANDLE_FLAG_INFORMATION HandleFlags;
00107     <a class="code" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">OBJECT_HANDLE_INFORMATION</a> HandleInformation;
00108     ULONG NameInfoSize;
00109     ULONG SecurityDescriptorSize;
00110     ULONG TempReturnLength;
00111     OBJECT_BASIC_INFORMATION ObjectBasicInfo;
00112     POBJECT_TYPES_INFORMATION TypesInformation;
00113     POBJECT_TYPE_INFORMATION TypeInfo;
00114     ULONG i;
00115 
00116     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00117 
00118     <span class="comment">//</span>
00119     <span class="comment">//  Initialize our local variables</span>
00120     <span class="comment">//</span>
00121 
00122     TempReturnLength = 0;
00123 
00124     <span class="comment">//</span>
00125     <span class="comment">//  Get previous processor mode and probe output argument if necessary.</span>
00126     <span class="comment">//</span>
00127 
00128     PreviousMode = KeGetPreviousMode();
00129 
00130     <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00131 
00132         <span class="keywordflow">try</span> {
00133 
00134             <span class="keywordflow">if</span> (ObjectInformationClass != ObjectHandleFlagInformation) {
00135 
00136                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>( ObjectInformation,
00137                                ObjectInformationLength,
00138                                <span class="keyword">sizeof</span>( ULONG ));
00139 
00140             } <span class="keywordflow">else</span> {
00141 
00142                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>( ObjectInformation,
00143                                ObjectInformationLength,
00144                                1 );
00145             }
00146 
00147             <span class="comment">//</span>
00148             <span class="comment">//  We'll use a local temp return length variable to pass</span>
00149             <span class="comment">//  through to the later ob query calls which will increment</span>
00150             <span class="comment">//  its value.  We can't pass the users return length directly</span>
00151             <span class="comment">//  because the user might also be altering its value behind</span>
00152             <span class="comment">//  our back.</span>
00153             <span class="comment">//</span>
00154 
00155             <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ReturnLength )) {
00156 
00157                 <a class="code" href="../../d5/d8/ex_8h.html#a40">ProbeForWriteUlong</a>( ReturnLength );
00158             }
00159 
00160         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00161 
00162             <span class="keywordflow">return</span>( GetExceptionCode() );
00163         }
00164     }
00165 
00166     <span class="comment">//</span>
00167     <span class="comment">//  If the query is not for types information then we</span>
00168     <span class="comment">//  will have to get the object in question. Otherwise</span>
00169     <span class="comment">//  for types information there really isn't an object</span>
00170     <span class="comment">//  to grab.</span>
00171     <span class="comment">//</span>
00172 
00173     <span class="keywordflow">if</span> (ObjectInformationClass != ObjectTypesInformation) {
00174 
00175         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
00176                                             0,
00177                                             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00178                                             PreviousMode,
00179                                             &amp;Object,
00180                                             &amp;HandleInformation );
00181 
00182         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00183 
00184             <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00185         }
00186 
00187         GrantedAccess = HandleInformation.<a class="code" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html#o1">GrantedAccess</a>;
00188 
00189         ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00190         ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
00191 
00192     } <span class="keywordflow">else</span> {
00193 
00194         GrantedAccess = 0;
00195         Object = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00196         ObjectHeader = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00197         ObjectType = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00198     }
00199 
00200     <span class="comment">//</span>
00201     <span class="comment">//  Now process the particular information class being</span>
00202     <span class="comment">//  requested</span>
00203     <span class="comment">//</span>
00204 
00205     <span class="keywordflow">switch</span>( ObjectInformationClass ) {
00206 
00207     <span class="keywordflow">case</span> ObjectBasicInformation:
00208 
00209         <span class="comment">//</span>
00210         <span class="comment">//  Make sure the output buffer is long enough and then</span>
00211         <span class="comment">//  fill in the appropriate fields into our local copy</span>
00212         <span class="comment">//  of basic information.</span>
00213         <span class="comment">//</span>
00214 
00215         <span class="keywordflow">if</span> (ObjectInformationLength != <span class="keyword">sizeof</span>( OBJECT_BASIC_INFORMATION )) {
00216 
00217             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Object );
00218 
00219             <span class="keywordflow">return</span>( STATUS_INFO_LENGTH_MISMATCH );
00220         }
00221 
00222         ObjectBasicInfo.Attributes = HandleInformation.<a class="code" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html#o0">HandleAttributes</a>;
00223 
00224         <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>) {
00225 
00226             ObjectBasicInfo.Attributes |= OBJ_PERMANENT;
00227         }
00228 
00229         <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a4">OB_FLAG_EXCLUSIVE_OBJECT</a>) {
00230 
00231             ObjectBasicInfo.Attributes |= OBJ_EXCLUSIVE;
00232         }
00233 
00234         ObjectBasicInfo.GrantedAccess = GrantedAccess;
00235         ObjectBasicInfo.HandleCount = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o1">HandleCount</a>;
00236         ObjectBasicInfo.PointerCount = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o0">PointerCount</a>;
00237 
00238         QuotaInfo = <a class="code" href="../../d4/d0/ob_8h.html#a10">OBJECT_HEADER_TO_QUOTA_INFO</a>( ObjectHeader );
00239 
00240         <span class="keywordflow">if</span> (QuotaInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00241 
00242             ObjectBasicInfo.PagedPoolCharge = QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o0">PagedPoolCharge</a>;
00243             ObjectBasicInfo.NonPagedPoolCharge = QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o1">NonPagedPoolCharge</a>;
00244 
00245         } <span class="keywordflow">else</span> {
00246 
00247             ObjectBasicInfo.PagedPoolCharge = 0;
00248             ObjectBasicInfo.NonPagedPoolCharge = 0;
00249         }
00250 
00251         <span class="keywordflow">if</span> (ObjectType == <a class="code" href="../../d5/d1/obp_8h.html#a43">ObpSymbolicLinkObjectType</a>) {
00252 
00253             ObjectBasicInfo.CreationTime = ((<a class="code" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">POBJECT_SYMBOLIC_LINK</a>)Object)-&gt;CreationTime;
00254 
00255         } <span class="keywordflow">else</span> {
00256 
00257             RtlZeroMemory( &amp;ObjectBasicInfo.CreationTime,
00258                            <span class="keyword">sizeof</span>( ObjectBasicInfo.CreationTime ));
00259         }
00260 
00261         <span class="comment">//</span>
00262         <span class="comment">//  Compute the size of the object name string by taking its name plus</span>
00263         <span class="comment">//  seperators and traversing up to the root adding each directories</span>
00264         <span class="comment">//  name length plus seperators</span>
00265         <span class="comment">//</span>
00266 
00267         NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
00268 
00269         <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00270         
00271             <a class="code" href="../../d5/d1/obp_8h.html#a10">ObpEnterRootDirectoryMutex</a>();
00272 
00273             ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
00274 
00275             <span class="comment">//</span>
00276             <span class="comment">//  **** this "IF" is probably not needed because of the preceding</span>
00277             <span class="comment">//  "IF"</span>
00278             <span class="comment">//</span>
00279 
00280             <span class="keywordflow">if</span> (ObjectDirectory) {
00281 
00282                 NameInfoSize = <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length;
00283 
00284                 <span class="keywordflow">while</span> (ObjectDirectory) {
00285 
00286                     ObjectDirectoryHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( ObjectDirectory );
00287                     NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectDirectoryHeader );
00288 
00289                     <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00290 
00291                         NameInfoSize += <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length;
00292                         ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
00293 
00294                     } <span class="keywordflow">else</span> {
00295 
00296                         <span class="keywordflow">break</span>;
00297                     }
00298                 }
00299 
00300                 NameInfoSize += <span class="keyword">sizeof</span>( OBJECT_NAME_INFORMATION ) + <span class="keyword">sizeof</span>( UNICODE_NULL );
00301             }
00302             
00303             <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00304 
00305         } <span class="keywordflow">else</span> {
00306 
00307             NameInfoSize = 0;
00308         }
00309 
00310         ObjectBasicInfo.NameInfoSize = NameInfoSize;
00311         ObjectBasicInfo.TypeInfoSize = ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a>.Length + <span class="keyword">sizeof</span>( UNICODE_NULL ) +
00312                                         <span class="keyword">sizeof</span>( OBJECT_TYPE_INFORMATION );
00313 
00314         <a class="code" href="../../d8/d1/obsdata_8c.html#a24">ObpAcquireDescriptorCacheReadLock</a>();
00315         
00316         <span class="keywordflow">if</span> ((GrantedAccess &amp; READ_CONTROL) &amp;&amp;
00317             ARGUMENT_PRESENT( ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o10">SecurityDescriptor</a> )) {
00318 
00319             SecurityDescriptorSize = <a class="code" href="../../d8/d6/sertl_8c.html#a56">RtlLengthSecurityDescriptor</a>(
00320                                          ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o10">SecurityDescriptor</a>);
00321 
00322         } <span class="keywordflow">else</span> {
00323 
00324             SecurityDescriptorSize = 0;
00325         }
00326 
00327         <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00328 
00329         ObjectBasicInfo.SecurityDescriptorSize = SecurityDescriptorSize;
00330 
00331         <span class="comment">//</span>
00332         <span class="comment">//  Now that we've packaged up our local copy of basic info we need</span>
00333         <span class="comment">//  to copy it into the output buffer and set the return</span>
00334         <span class="comment">//  length</span>
00335         <span class="comment">//</span>
00336 
00337         <span class="keywordflow">try</span> {
00338 
00339             *(POBJECT_BASIC_INFORMATION) ObjectInformation = ObjectBasicInfo;
00340 
00341             TempReturnLength = ObjectInformationLength;
00342 
00343         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00344 
00345             <span class="comment">//</span>
00346             <span class="comment">// Fall through, since we cannot undo what we have done.</span>
00347             <span class="comment">//</span>
00348         }
00349 
00350         <span class="keywordflow">break</span>;
00351 
00352     <span class="keywordflow">case</span> ObjectNameInformation:
00353 
00354         <span class="comment">//</span>
00355         <span class="comment">//  Call a local worker routine</span>
00356         <span class="comment">//</span>
00357 
00358         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a7">ObQueryNameString</a>( Object,
00359                                     (POBJECT_NAME_INFORMATION)ObjectInformation,
00360                                     ObjectInformationLength,
00361                                     &amp;TempReturnLength );
00362         <span class="keywordflow">break</span>;
00363 
00364     <span class="keywordflow">case</span> ObjectTypeInformation:
00365 
00366         <span class="comment">//</span>
00367         <span class="comment">//  Call a local worker routine</span>
00368         <span class="comment">//</span>
00369 
00370         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a9">ObQueryTypeInfo</a>( ObjectType,
00371                                   (POBJECT_TYPE_INFORMATION)ObjectInformation,
00372                                   ObjectInformationLength,
00373                                   &amp;TempReturnLength );
00374         <span class="keywordflow">break</span>;
00375 
00376     <span class="keywordflow">case</span> ObjectTypesInformation:
00377 
00378         <span class="keywordflow">try</span> {
00379 
00380             <span class="comment">//</span>
00381             <span class="comment">//  The first thing we do is set the return length to cover the</span>
00382             <span class="comment">//  types info record.  Later in each call to query type info</span>
00383             <span class="comment">//  this value will be updated as necessary</span>
00384             <span class="comment">//</span>
00385 
00386             TempReturnLength = <span class="keyword">sizeof</span>( OBJECT_TYPES_INFORMATION );
00387 
00388             <span class="comment">//</span>
00389             <span class="comment">//  Make sure there is enough room to hold the types info record</span>
00390             <span class="comment">//  and if so then compute the number of defined types there are</span>
00391             <span class="comment">//</span>
00392 
00393             TypesInformation = (POBJECT_TYPES_INFORMATION)ObjectInformation;
00394 
00395             <span class="keywordflow">if</span> (ObjectInformationLength &lt; <span class="keyword">sizeof</span>( OBJECT_TYPES_INFORMATION ) ) {
00396 
00397                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INFO_LENGTH_MISMATCH;
00398 
00399             } <span class="keywordflow">else</span> {
00400 
00401                 TypesInformation-&gt;NumberOfTypes = 0;
00402 
00403                 <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d5/d1/obp_8h.html#a14">OBP_MAX_DEFINED_OBJECT_TYPES</a>; i++) {
00404 
00405                     ObjectType = <a class="code" href="../../d5/d1/obp_8h.html#a38">ObpObjectTypes</a>[ i ];
00406 
00407                     <span class="keywordflow">if</span> (ObjectType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00408 
00409                         <span class="keywordflow">break</span>;
00410                     }
00411 
00412                     TypesInformation-&gt;NumberOfTypes += 1;
00413                 }
00414             }
00415 
00416             <span class="comment">//</span>
00417             <span class="comment">//  For each defined type we will query the type info for the</span>
00418             <span class="comment">//  object type and adjust the TypeInfo pointer to the next</span>
00419             <span class="comment">//  free spot</span>
00420             <span class="comment">//</span>
00421 
00422             TypeInfo = (POBJECT_TYPE_INFORMATION)(TypesInformation + 1);
00423 
00424             <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d5/d1/obp_8h.html#a14">OBP_MAX_DEFINED_OBJECT_TYPES</a>; i++) {
00425 
00426                 ObjectType = <a class="code" href="../../d5/d1/obp_8h.html#a38">ObpObjectTypes</a>[ i ];
00427 
00428                 <span class="keywordflow">if</span> (ObjectType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00429 
00430                     <span class="keywordflow">break</span>;
00431                 }
00432 
00433                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a9">ObQueryTypeInfo</a>( ObjectType,
00434                                           TypeInfo,
00435                                           ObjectInformationLength,
00436                                           &amp;TempReturnLength );
00437 
00438                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00439 
00440                     TypeInfo = (POBJECT_TYPE_INFORMATION)
00441                         ((PCHAR)(TypeInfo+1) + <a class="code" href="../../d0/d9/ntosdef_8h.html#a4">ALIGN_UP</a>( TypeInfo-&gt;TypeName.MaximumLength, ULONG ));
00442                 }
00443             }
00444 
00445         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00446 
00447             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00448         }
00449 
00450         <span class="keywordflow">break</span>;
00451 
00452     <span class="keywordflow">case</span> ObjectHandleFlagInformation:
00453 
00454         <span class="keywordflow">try</span> {
00455 
00456             <span class="comment">//</span>
00457             <span class="comment">//  Set the amount of data we are going to return</span>
00458             <span class="comment">//</span>
00459 
00460             TempReturnLength = <span class="keyword">sizeof</span>(OBJECT_HANDLE_FLAG_INFORMATION);
00461 
00462             HandleFlags = (POBJECT_HANDLE_FLAG_INFORMATION)ObjectInformation;
00463 
00464             <span class="comment">//</span>
00465             <span class="comment">//  Make sure we have enough room for the query, and if so we'll</span>
00466             <span class="comment">//  set the output based on the flags stored in the handle</span>
00467             <span class="comment">//</span>
00468 
00469             <span class="keywordflow">if</span> (ObjectInformationLength &lt; <span class="keyword">sizeof</span>( OBJECT_HANDLE_FLAG_INFORMATION)) {
00470 
00471                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INFO_LENGTH_MISMATCH;
00472 
00473             } <span class="keywordflow">else</span> {
00474 
00475                 HandleFlags-&gt;Inherit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00476 
00477                 <span class="keywordflow">if</span> (HandleInformation.<a class="code" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html#o0">HandleAttributes</a> &amp; OBJ_INHERIT) {
00478 
00479                     HandleFlags-&gt;Inherit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00480                 }
00481 
00482                 HandleFlags-&gt;ProtectFromClose = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00483 
00484                 <span class="keywordflow">if</span> (HandleInformation.<a class="code" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html#o0">HandleAttributes</a> &amp; <a class="code" href="../../d5/d1/obp_8h.html#a15">OBJ_PROTECT_CLOSE</a>) {
00485 
00486                     HandleFlags-&gt;ProtectFromClose = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00487                 }
00488             }
00489 
00490         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00491 
00492             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00493         }
00494 
00495         <span class="keywordflow">break</span>;
00496 
00497     <span class="keywordflow">default</span>:
00498 
00499         <span class="comment">//</span>
00500         <span class="comment">//  To get to this point we must have had an object and the</span>
00501         <span class="comment">//  information class is not defined, so we should dereference the</span>
00502         <span class="comment">//  object and return to our user the bad status</span>
00503         <span class="comment">//</span>
00504 
00505         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Object );
00506 
00507         <span class="keywordflow">return</span>( STATUS_INVALID_INFO_CLASS );
00508     }
00509 
00510     <span class="comment">//</span>
00511     <span class="comment">//  Now if the caller asked for a return length we'll set it from</span>
00512     <span class="comment">//  our local copy</span>
00513     <span class="comment">//</span>
00514 
00515     <span class="keywordflow">try</span> {
00516 
00517         <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ReturnLength ) ) {
00518 
00519             *ReturnLength = TempReturnLength;
00520         }
00521 
00522     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00523 
00524         <span class="comment">//</span>
00525         <span class="comment">//  Fall through, since we cannot undo what we have done.</span>
00526         <span class="comment">//</span>
00527     }
00528 
00529     <span class="comment">//</span>
00530     <span class="comment">//  In the end we can free the object if there was one and return</span>
00531     <span class="comment">//  to our caller</span>
00532     <span class="comment">//</span>
00533 
00534     <span class="keywordflow">if</span> (Object != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00535 
00536         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Object );
00537     }
00538 
00539     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00540 }
00541 
00542 
00543 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00544 NTAPI
<a name="l00545"></a><a class="code" href="../../d6/d1/obquery_8c.html#a6">00545</a> <a class="code" href="../../d6/d1/obquery_8c.html#a6">NtSetInformationObject</a> (
00546     IN HANDLE Handle,
00547     IN OBJECT_INFORMATION_CLASS ObjectInformationClass,
00548     IN PVOID ObjectInformation,
00549     IN ULONG ObjectInformationLength
00550     )
00551 
00552 <span class="comment">/*++</span>
00553 <span class="comment"></span>
00554 <span class="comment">Routine description:</span>
00555 <span class="comment"></span>
00556 <span class="comment">    This routine is used to set handle information about a specified</span>
00557 <span class="comment">    handle</span>
00558 <span class="comment"></span>
00559 <span class="comment">Arguments:</span>
00560 <span class="comment"></span>
00561 <span class="comment">    Handle - Supplies the handle being modified</span>
00562 <span class="comment"></span>
00563 <span class="comment">    ObjectInformationClass - Specifies the class of information being</span>
00564 <span class="comment">        modified.  The only accepted value is ObjectHandleFlagInformation</span>
00565 <span class="comment"></span>
00566 <span class="comment">    ObjectInformation - Supplies the buffer containing the handle</span>
00567 <span class="comment">        flag information structure</span>
00568 <span class="comment"></span>
00569 <span class="comment">    ObjectInformationLength - Specifies the length, in bytes, of the</span>
00570 <span class="comment">        object information buffer</span>
00571 <span class="comment"></span>
00572 <span class="comment">Return Value:</span>
00573 <span class="comment"></span>
00574 <span class="comment">    An appropriate status value</span>
00575 <span class="comment"></span>
00576 <span class="comment">--*/</span>
00577 
00578 {
00579     <a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html">OBP_SET_HANDLE_ATTRIBUTES</a> CapturedInformation;
00580     HANDLE ObjectHandle;
00581     PVOID ObjectTable;
00582     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00583     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00584     BOOLEAN AttachedToProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00585     <a class="code" href="../../d3/d5/struct__KAPC__STATE.html">KAPC_STATE</a> ApcState;
00586 
00587     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00588 
00589     <span class="comment">//</span>
00590     <span class="comment">//  Check if the information class and information length are correct.</span>
00591     <span class="comment">//</span>
00592 
00593     <span class="keywordflow">if</span> (ObjectInformationClass != ObjectHandleFlagInformation) {
00594 
00595         <span class="keywordflow">return</span> STATUS_INVALID_INFO_CLASS;
00596     }
00597 
00598     <span class="keywordflow">if</span> (ObjectInformationLength != <span class="keyword">sizeof</span>(OBJECT_HANDLE_FLAG_INFORMATION)) {
00599 
00600         <span class="keywordflow">return</span> STATUS_INFO_LENGTH_MISMATCH;
00601     }
00602 
00603     <span class="comment">//</span>
00604     <span class="comment">//  Get previous processor mode and probe and capture the input</span>
00605     <span class="comment">//  buffer</span>
00606     <span class="comment">//</span>
00607 
00608     CapturedInformation.<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o1">PreviousMode</a> = KeGetPreviousMode();
00609 
00610     <span class="keywordflow">try</span> {
00611 
00612         <span class="keywordflow">if</span> (CapturedInformation.<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o1">PreviousMode</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00613 
00614             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ObjectInformation, ObjectInformationLength, 1);
00615         }
00616 
00617         CapturedInformation.<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o0">ObjectInformation</a> = *(POBJECT_HANDLE_FLAG_INFORMATION)ObjectInformation;
00618 
00619     } except(<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00620 
00621         <span class="keywordflow">return</span> GetExceptionCode();
00622     }
00623 
00624 <span class="preprocessor">#if 0</span>
00625 <span class="preprocessor"></span>
00626     <span class="comment">//</span>
00627     <span class="comment">//  On checked builds, check that if the Kernel handle bit is set,</span>
00628     <span class="comment">//  then we're coming from Kernel mode. We should probably fail the</span>
00629     <span class="comment">//  call if bit set &amp;&amp; !Kmode</span>
00630     <span class="comment">//</span>
00631 
00632     <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> != NtCurrentThread()) &amp;&amp; (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> != NtCurrentProcess())) {
00633 
00634         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &lt; 0 ) ? (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) : <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00635     }
00636 
00637 <span class="preprocessor">#endif</span>
00638 <span class="preprocessor"></span>
00639     <span class="comment">//</span>
00640     <span class="comment">//  Get the address of the object table for the current process.  Or</span>
00641     <span class="comment">//  get the system handle table if this is a kernel handle and we are</span>
00642     <span class="comment">//  in kernel mode</span>
00643     <span class="comment">//</span>
00644 
00645     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ioverifier_8c.html#a14">IsKernelHandle</a>( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>, CapturedInformation.<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o1">PreviousMode</a> )) {
00646 
00647         <span class="comment">//</span>
00648         <span class="comment">//  Make the handle look like a regular handle</span>
00649         <span class="comment">//</span>
00650 
00651         ObjectHandle = <a class="code" href="../../d5/d1/obp_8h.html#a27">DecodeKernelHandle</a>( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> );
00652 
00653         <span class="comment">//</span>
00654         <span class="comment">//  The global kernel handle table</span>
00655         <span class="comment">//</span>
00656 
00657         ObjectTable = <a class="code" href="../../d5/d1/obp_8h.html#a54">ObpKernelHandleTable</a>;
00658 
00659         <span class="comment">//</span>
00660         <span class="comment">//  Go to the system process</span>
00661         <span class="comment">//</span>
00662 
00663         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() != <a class="code" href="../../d1/d9/ps_8h.html#a53">PsInitialSystemProcess</a>) {
00664             <a class="code" href="../../d3/d5/procobj_8c.html#a6">KeStackAttachProcess</a> (&amp;<a class="code" href="../../d1/d9/ps_8h.html#a53">PsInitialSystemProcess</a>-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>, &amp;ApcState);
00665             AttachedToProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00666         }
00667 
00668     } <span class="keywordflow">else</span> {
00669 
00670         ObjectTable = <a class="code" href="../../d5/d1/obp_8h.html#a12">ObpGetObjectTable</a>();
00671         ObjectHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00672     }
00673 
00674     <span class="comment">//</span>
00675     <span class="comment">//  Make the change to the handle table entry.  The callback</span>
00676     <span class="comment">//  routine will do the actual change</span>
00677     <span class="comment">//</span>
00678 
00679     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a298">ExChangeHandle</a>( ObjectTable,
00680                         ObjectHandle,
00681                         <a class="code" href="../../d6/d1/obquery_8c.html#a4">ObpSetHandleAttributes</a>,
00682                         (ULONG_PTR)&amp;CapturedInformation) ) {
00683 
00684         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00685 
00686     } <span class="keywordflow">else</span> {
00687 
00688         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
00689     }
00690 
00691     <span class="comment">//</span>
00692     <span class="comment">//  If we are attached to the system process then return</span>
00693     <span class="comment">//  back to our caller</span>
00694     <span class="comment">//</span>
00695 
00696     <span class="keywordflow">if</span> (AttachedToProcess) {
00697         <a class="code" href="../../d3/d5/procobj_8c.html#a8">KeUnstackDetachProcess</a>(&amp;ApcState);
00698         AttachedToProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00699     }
00700 
00701     <span class="comment">//</span>
00702     <span class="comment">//  And return to our caller</span>
00703     <span class="comment">//</span>
00704 
00705     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00706 }
00707 
00708 
<a name="l00709"></a><a class="code" href="../../d6/d1/obquery_8c.html#a0">00709</a> <span class="preprocessor">#define OBP_MISSING_NAME_LITERAL L"..."</span>
<a name="l00710"></a><a class="code" href="../../d6/d1/obquery_8c.html#a1">00710</a> <span class="preprocessor"></span><span class="preprocessor">#define OBP_MISSING_NAME_LITERAL_SIZE (sizeof( OBP_MISSING_NAME_LITERAL ) - sizeof( UNICODE_NULL ))</span>
00711 <span class="preprocessor"></span>
00712 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00713"></a><a class="code" href="../../d6/d1/obquery_8c.html#a7">00713</a> <a class="code" href="../../d6/d1/obquery_8c.html#a7">ObQueryNameString</a> (
00714     IN PVOID Object,
00715     OUT POBJECT_NAME_INFORMATION ObjectNameInfo,
00716     IN ULONG Length,
00717     OUT PULONG ReturnLength
00718     )
00719 
00720 <span class="comment">/*++</span>
00721 <span class="comment"></span>
00722 <span class="comment">Routine description:</span>
00723 <span class="comment"></span>
00724 <span class="comment">    This routine processes a query of an object's name information</span>
00725 <span class="comment"></span>
00726 <span class="comment">Arguments:</span>
00727 <span class="comment"></span>
00728 <span class="comment">    Object - Supplies the object being queried</span>
00729 <span class="comment"></span>
00730 <span class="comment">    ObjectNameInfo - Supplies the buffer to store the name string</span>
00731 <span class="comment">        information</span>
00732 <span class="comment"></span>
00733 <span class="comment">    Length - Specifies the length, in bytes, of the original object</span>
00734 <span class="comment">        name info buffer.</span>
00735 <span class="comment"></span>
00736 <span class="comment">    ReturnLength - Contains the number of bytes already used up</span>
00737 <span class="comment">        in the object name info. On return this receives an updated</span>
00738 <span class="comment">        byte count.</span>
00739 <span class="comment"></span>
00740 <span class="comment">        (Length minus ReturnLength) is really now many bytes are left</span>
00741 <span class="comment">        in the output buffer.  The buffer supplied to this call may</span>
00742 <span class="comment">        actually be offset within the original users buffer</span>
00743 <span class="comment"></span>
00744 <span class="comment">Return Value:</span>
00745 <span class="comment"></span>
00746 <span class="comment">    An appropriate status value</span>
00747 <span class="comment"></span>
00748 <span class="comment">--*/</span>
00749 
00750 {
00751     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00752     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00753     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
00754     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectDirectoryHeader;
00755     <a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">POBJECT_DIRECTORY</a> ObjectDirectory;
00756     ULONG NameInfoSize;
00757     PUNICODE_STRING <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
00758     PWCH StringBuffer;
00759     ULONG NameSize;
00760 
00761     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00762 
00763     <span class="comment">//</span>
00764     <span class="comment">//  Get the object header and name info record if it exists</span>
00765     <span class="comment">//</span>
00766 
00767     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00768     NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
00769 
00770     <span class="comment">//</span>
00771     <span class="comment">//  If the object type has a query name callback routine then</span>
00772     <span class="comment">//  that is how we get the name</span>
00773     <span class="comment">//</span>
00774 
00775     <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o18">QueryNameProcedure</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00776 
00777         <span class="keywordflow">try</span> {
00778 
00779             KIRQL SaveIrql;
00780 
00781             <a class="code" href="../../d5/d1/obp_8h.html#a0">ObpBeginTypeSpecificCallOut</a>( SaveIrql );
00782             <a class="code" href="../../d5/d1/obp_8h.html#a1">ObpEndTypeSpecificCallOut</a>( SaveIrql, <span class="stringliteral">"Query"</span>, ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>, Object );
00783 
00784             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o18">QueryNameProcedure</a>)( Object,
00785                                                                          (BOOLEAN)((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length != 0)),
00786                                                                          ObjectNameInfo,
00787                                                                          Length,
00788                                                                          ReturnLength );
00789 
00790         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00791 
00792             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00793         }
00794 
00795         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00796     }
00797 
00798     <span class="comment">//</span>
00799     <span class="comment">//  Otherwise, the object type does not specify a query name</span>
00800     <span class="comment">//  procedure so we get to do the work.  The first thing</span>
00801     <span class="comment">//  to check is if the object doesn't even have a name.  If</span>
00802     <span class="comment">//  object doesn't have a name then we'll return an empty name</span>
00803     <span class="comment">//  info structure.</span>
00804     <span class="comment">//</span>
00805 
00806     <span class="keywordflow">if</span> ((NameInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00807 
00808         <span class="comment">//</span>
00809         <span class="comment">//  Compute the length of our return buffer, set the output</span>
00810         <span class="comment">//  if necessary and make sure the supplied buffer is large</span>
00811         <span class="comment">//  enough</span>
00812         <span class="comment">//</span>
00813 
00814         NameInfoSize = <span class="keyword">sizeof</span>( OBJECT_NAME_INFORMATION );
00815 
00816         <span class="keywordflow">try</span> {
00817 
00818             *ReturnLength = NameInfoSize;
00819 
00820         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00821 
00822             <span class="keywordflow">return</span>( GetExceptionCode() );
00823         }
00824 
00825         <span class="keywordflow">if</span> (Length &lt; NameInfoSize) {
00826 
00827             <span class="keywordflow">return</span>( STATUS_INFO_LENGTH_MISMATCH );
00828         }
00829 
00830         <span class="comment">//</span>
00831         <span class="comment">//  Initialize the output buffer to be an empty string</span>
00832         <span class="comment">//  and then return to our caller</span>
00833         <span class="comment">//</span>
00834 
00835         <span class="keywordflow">try</span> {
00836 
00837             ObjectNameInfo-&gt;Name.Length = 0;
00838             ObjectNameInfo-&gt;Name.MaximumLength = 0;
00839             ObjectNameInfo-&gt;Name.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00840 
00841         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00842 
00843             <span class="comment">//</span>
00844             <span class="comment">//  Fall through, since we cannot undo what we have done.</span>
00845             <span class="comment">//</span>
00846             <span class="comment">//  **** This should probably get the exception code and return</span>
00847             <span class="comment">//  that value</span>
00848             <span class="comment">//</span>
00849         }
00850 
00851         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00852     }
00853 
00854     <span class="comment">//</span>
00855     <span class="comment">//  First lock the directory mutex to stop before we chase stuff down</span>
00856     <span class="comment">//</span>
00857 
00858     <a class="code" href="../../d5/d1/obp_8h.html#a10">ObpEnterRootDirectoryMutex</a>();
00859 
00860     <span class="keywordflow">try</span> {
00861 
00862         <span class="comment">//</span>
00863         <span class="comment">//  The object does have a name but now see if this is</span>
00864         <span class="comment">//  just the root directory object in which case the name size</span>
00865         <span class="comment">//  is only the "\" character</span>
00866         <span class="comment">//</span>
00867 
00868         <span class="keywordflow">if</span> (Object == <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) {
00869 
00870             NameSize = <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR );
00871 
00872         } <span class="keywordflow">else</span> {
00873 
00874             <span class="comment">//</span>
00875             <span class="comment">//  The named object is not the root so for every directory</span>
00876             <span class="comment">//  working out way up we'll add its size to the name keeping</span>
00877             <span class="comment">//  track of "\" characters inbetween each component.  We first</span>
00878             <span class="comment">//  start with the object name itself and then move on to</span>
00879             <span class="comment">//  the directories</span>
00880             <span class="comment">//</span>
00881 
00882             ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
00883             NameSize = <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length;
00884 
00885             <span class="comment">//</span>
00886             <span class="comment">//  While we are not at the root we'll keep moving up</span>
00887             <span class="comment">//</span>
00888 
00889             <span class="keywordflow">while</span> ((ObjectDirectory != <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) &amp;&amp; (ObjectDirectory)) {
00890 
00891                 <span class="comment">//</span>
00892                 <span class="comment">//  Get the name information for this directory</span>
00893                 <span class="comment">//</span>
00894 
00895                 ObjectDirectoryHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( ObjectDirectory );
00896                 NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectDirectoryHeader );
00897 
00898                 <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00899 
00900                     <span class="comment">//</span>
00901                     <span class="comment">//  This directory has a name so add it to the accomulated</span>
00902                     <span class="comment">//  size and move up the tree</span>
00903                     <span class="comment">//</span>
00904 
00905                     NameSize += <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length;
00906                     ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
00907 
00908                 } <span class="keywordflow">else</span> {
00909 
00910                     <span class="comment">//</span>
00911                     <span class="comment">//  This directory does not have a name so we'll give it</span>
00912                     <span class="comment">//  the "..." name and stop the loop</span>
00913                     <span class="comment">//</span>
00914 
00915                     NameSize += <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + <a class="code" href="../../d6/d1/obquery_8c.html#a1">OBP_MISSING_NAME_LITERAL_SIZE</a>;
00916                     <span class="keywordflow">break</span>;
00917                 }
00918             }
00919         }
00920 
00921         <span class="comment">//</span>
00922         <span class="comment">//  At this point NameSize is the number of bytes we need to store the</span>
00923         <span class="comment">//  name of the object from the root down.  The total buffer size we are</span>
00924         <span class="comment">//  going to need will include this size, plus object name information</span>
00925         <span class="comment">//  structure, plus an ending null character</span>
00926         <span class="comment">//</span>
00927 
00928         NameInfoSize = NameSize + <span class="keyword">sizeof</span>( OBJECT_NAME_INFORMATION ) + <span class="keyword">sizeof</span>( UNICODE_NULL );
00929 
00930         <span class="comment">//</span>
00931         <span class="comment">//  Set the output size and make sure the supplied buffer is large enough</span>
00932         <span class="comment">//  to hold the information</span>
00933         <span class="comment">//</span>
00934 
00935         <span class="keywordflow">try</span> {
00936 
00937             *ReturnLength = NameInfoSize;
00938 
00939         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00940 
00941             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00942             leave;
00943         }
00944 
00945         <span class="keywordflow">if</span> (Length &lt; NameInfoSize) {
00946 
00947             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INFO_LENGTH_MISMATCH;
00948             leave;
00949         }
00950 
00951         <span class="comment">//</span>
00952         <span class="comment">//  **** the following IF isn't necessary because name info size is</span>
00953         <span class="comment">//  already guaranteed to be nonzero from about 23 lines above</span>
00954         <span class="comment">//</span>
00955 
00956         <span class="keywordflow">if</span> (NameInfoSize != 0) {
00957 
00958             <span class="comment">//</span>
00959             <span class="comment">//  Set the String buffer to point to the byte right after the</span>
00960             <span class="comment">//  last byte in the output string.  This following logic actually</span>
00961             <span class="comment">//  fills in the buffer backwards working from the name back to the</span>
00962             <span class="comment">//  root</span>
00963             <span class="comment">//</span>
00964 
00965             StringBuffer = (PWCH)ObjectNameInfo;
00966             StringBuffer = (PWCH)((PCH)StringBuffer + NameInfoSize);
00967 
00968             NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
00969 
00970             <span class="keywordflow">try</span> {
00971 
00972                 <span class="comment">//</span>
00973                 <span class="comment">//  Terminate the string with a null and backup one unicode</span>
00974                 <span class="comment">//  character</span>
00975                 <span class="comment">//</span>
00976 
00977                 *--StringBuffer = UNICODE_NULL;
00978 
00979                 <span class="comment">//</span>
00980                 <span class="comment">//  If the object in question is not the root directory</span>
00981                 <span class="comment">//  then we are going to put its name in the string buffer</span>
00982                 <span class="comment">//  When we finally reach the root directory we'll append on</span>
00983                 <span class="comment">//  the final "\"</span>
00984                 <span class="comment">//</span>
00985 
00986                 <span class="keywordflow">if</span> (Object != <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) {
00987 
00988                     <span class="comment">//</span>
00989                     <span class="comment">//  Add in the objects name</span>
00990                     <span class="comment">//</span>
00991 
00992                     <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = &amp;NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>;
00993                     StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length);
00994                     RtlMoveMemory( StringBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length );
00995 
00996                     <span class="comment">//</span>
00997                     <span class="comment">//  While we are not at the root directory we'll keep</span>
00998                     <span class="comment">//  moving up</span>
00999                     <span class="comment">//</span>
01000 
01001                     ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
01002 
01003                     <span class="keywordflow">while</span> ((ObjectDirectory != <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) &amp;&amp; (ObjectDirectory)) {
01004 
01005                         <span class="comment">//</span>
01006                         <span class="comment">//  Get the name information for this directory</span>
01007                         <span class="comment">//</span>
01008 
01009                         ObjectDirectoryHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( ObjectDirectory );
01010                         NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectDirectoryHeader );
01011 
01012                         <span class="comment">//</span>
01013                         <span class="comment">//  Tack on the "\" between the last name we added and</span>
01014                         <span class="comment">//  this new name</span>
01015                         <span class="comment">//</span>
01016 
01017                         *--StringBuffer = OBJ_NAME_PATH_SEPARATOR;
01018 
01019                         <span class="comment">//</span>
01020                         <span class="comment">//  Preappend the directory name, if it has one, and</span>
01021                         <span class="comment">//  move up to the next directory.</span>
01022                         <span class="comment">//</span>
01023 
01024                         <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01025 
01026                             <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = &amp;NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>;
01027                             StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length);
01028                             RtlMoveMemory( StringBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length );
01029                             ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
01030 
01031                         } <span class="keywordflow">else</span> {
01032 
01033                             <span class="comment">//</span>
01034                             <span class="comment">//  The directory is nameless so use the "..." for</span>
01035                             <span class="comment">//  its name and break out of the loop</span>
01036                             <span class="comment">//</span>
01037 
01038                             StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d6/d1/obquery_8c.html#a1">OBP_MISSING_NAME_LITERAL_SIZE</a>);
01039                             RtlMoveMemory( StringBuffer,
01040                                            <a class="code" href="../../d6/d1/obquery_8c.html#a0">OBP_MISSING_NAME_LITERAL</a>,
01041                                            <a class="code" href="../../d6/d1/obquery_8c.html#a1">OBP_MISSING_NAME_LITERAL_SIZE</a> );
01042                             <span class="keywordflow">break</span>;
01043                         }
01044                     }
01045                 }
01046 
01047                 <span class="comment">//</span>
01048                 <span class="comment">//  Tack on the "\" for the root directory and then set the</span>
01049                 <span class="comment">//  output unicode string variable to have the right size</span>
01050                 <span class="comment">//  and point to the right spot.</span>
01051                 <span class="comment">//</span>
01052 
01053                 *--StringBuffer = OBJ_NAME_PATH_SEPARATOR;
01054 
01055                 ObjectNameInfo-&gt;Name.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)NameSize;
01056                 ObjectNameInfo-&gt;Name.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NameSize+<span class="keyword">sizeof</span>( UNICODE_NULL ));
01057                 ObjectNameInfo-&gt;Name.Buffer = StringBuffer;
01058 
01059             } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01060 
01061                 <span class="comment">//</span>
01062                 <span class="comment">// Fall through, since we cannot undo what we have done.</span>
01063                 <span class="comment">//</span>
01064                 <span class="comment">//  **** This should probably get the exception code and return</span>
01065                 <span class="comment">//  that value</span>
01066                 <span class="comment">//</span>
01067             }
01068         }
01069 
01070         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01071 
01072     } finally {
01073 
01074         <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
01075     }
01076 
01077     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01078 }
01079 
01080 
01081 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l01082"></a><a class="code" href="../../d6/d1/obquery_8c.html#a8">01082</a> <a class="code" href="../../d6/d1/obquery_8c.html#a8">ObQueryTypeName</a> (
01083     IN PVOID Object,
01084     PUNICODE_STRING ObjectTypeName,
01085     IN ULONG Length,
01086     OUT PULONG ReturnLength
01087     )
01088 
01089 <span class="comment">/*++</span>
01090 <span class="comment"></span>
01091 <span class="comment">Routine description:</span>
01092 <span class="comment"></span>
01093 <span class="comment">    This routine processes a query of an object's type name</span>
01094 <span class="comment"></span>
01095 <span class="comment">Arguments:</span>
01096 <span class="comment"></span>
01097 <span class="comment">    Object - Supplies the object being queried</span>
01098 <span class="comment"></span>
01099 <span class="comment">    ObjectTypeName - Supplies the buffer to store the type name</span>
01100 <span class="comment">        string information</span>
01101 <span class="comment"></span>
01102 <span class="comment">    Length - Specifies the length, in bytes, of the object type</span>
01103 <span class="comment">        name buffer</span>
01104 <span class="comment"></span>
01105 <span class="comment">    ReturnLength - Contains the number of bytes already used up</span>
01106 <span class="comment">        in the object type name buffer. On return this receives</span>
01107 <span class="comment">        an updated byte count</span>
01108 <span class="comment"></span>
01109 <span class="comment">        (Length minus ReturnLength) is really now many bytes are left</span>
01110 <span class="comment">        in the output buffer.  The buffer supplied to this call may</span>
01111 <span class="comment">        actually be offset within the original users buffer</span>
01112 <span class="comment"></span>
01113 <span class="comment">Return Value:</span>
01114 <span class="comment"></span>
01115 <span class="comment">    An appropriate status value</span>
01116 <span class="comment"></span>
01117 <span class="comment">--*/</span>
01118 
01119 {
01120     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
01121     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01122     ULONG TypeNameSize;
01123     PUNICODE_STRING <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
01124     PWCH StringBuffer;
01125     ULONG NameSize;
01126 
01127     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01128 
01129     <span class="comment">//</span>
01130     <span class="comment">//  From the object get its object type and from that get the size of</span>
01131     <span class="comment">//  the object type name.  The total size for we need for the output</span>
01132     <span class="comment">//  buffer must fit the name, a terminating null, and a preceding</span>
01133     <span class="comment">//  unicode string structure</span>
01134     <span class="comment">//</span>
01135 
01136     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01137     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
01138 
01139     NameSize = ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a>.Length;
01140     TypeNameSize = NameSize + <span class="keyword">sizeof</span>( UNICODE_NULL ) + <span class="keyword">sizeof</span>( UNICODE_STRING );
01141 
01142     <span class="comment">//</span>
01143     <span class="comment">//  Update the number of bytes we need and make sure the output buffer is</span>
01144     <span class="comment">//  large enough</span>
01145     <span class="comment">//</span>
01146     <span class="comment">//  **** to be consistent with all our callers and other routines in</span>
01147     <span class="comment">//  this module this should probably be a "+=" and not just "="</span>
01148     <span class="comment">//</span>
01149 
01150     <span class="keywordflow">try</span> {
01151 
01152         *ReturnLength = TypeNameSize;
01153 
01154     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01155 
01156         <span class="keywordflow">return</span>( GetExceptionCode() );
01157     }
01158 
01159     <span class="keywordflow">if</span> (Length &lt; TypeNameSize) {
01160 
01161         <span class="keywordflow">return</span>( STATUS_INFO_LENGTH_MISMATCH );
01162     }
01163 
01164     <span class="comment">//</span>
01165     <span class="comment">//  **** this IF is probably not needed because of the earlier computation</span>
01166     <span class="comment">//  of type name size</span>
01167     <span class="comment">//</span>
01168 
01169     <span class="keywordflow">if</span> (TypeNameSize != 0) {
01170 
01171         <span class="comment">//</span>
01172         <span class="comment">//  Set string buffer to point to the one byte beyond the</span>
01173         <span class="comment">//  buffer that we're going to fill in</span>
01174         <span class="comment">//</span>
01175 
01176         StringBuffer = (PWCH)ObjectTypeName;
01177         StringBuffer = (PWCH)((PCH)StringBuffer + TypeNameSize);
01178 
01179         <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a>;
01180 
01181         <span class="keywordflow">try</span> {
01182 
01183             <span class="comment">//</span>
01184             <span class="comment">//  Tack on the terminating null character and copy over</span>
01185             <span class="comment">//  the type name</span>
01186             <span class="comment">//</span>
01187 
01188             *--StringBuffer = UNICODE_NULL;
01189 
01190             StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length);
01191 
01192             RtlMoveMemory( StringBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length );
01193 
01194             <span class="comment">//</span>
01195             <span class="comment">//  Now set the preceding unicode string to have the right</span>
01196             <span class="comment">//  lengths and to point to this buffer</span>
01197             <span class="comment">//</span>
01198 
01199             ObjectTypeName-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)NameSize;
01200             ObjectTypeName-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NameSize+<span class="keyword">sizeof</span>( UNICODE_NULL ));
01201             ObjectTypeName-&gt;Buffer = StringBuffer;
01202 
01203         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01204 
01205             <span class="comment">//</span>
01206             <span class="comment">// Fall through, since we cannot undo what we have done.</span>
01207             <span class="comment">//</span>
01208         }
01209     }
01210 
01211     <span class="keywordflow">return</span>( STATUS_SUCCESS );
01212 }
01213 
01214 
01215 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l01216"></a><a class="code" href="../../d6/d1/obquery_8c.html#a9">01216</a> <a class="code" href="../../d6/d1/obquery_8c.html#a9">ObQueryTypeInfo</a> (
01217     IN <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType,
01218     OUT POBJECT_TYPE_INFORMATION ObjectTypeInfo,
01219     IN ULONG Length,
01220     OUT PULONG ReturnLength
01221     )
01222 
01223 <span class="comment">/*++</span>
01224 <span class="comment"></span>
01225 <span class="comment">Routine description:</span>
01226 <span class="comment"></span>
01227 <span class="comment">    This routine processes the query for object type information</span>
01228 <span class="comment"></span>
01229 <span class="comment">Arguments:</span>
01230 <span class="comment"></span>
01231 <span class="comment">    Object - Supplies a pointer to the object type being queried</span>
01232 <span class="comment"></span>
01233 <span class="comment">    ObjectTypeInfo - Supplies the buffer to store the type information</span>
01234 <span class="comment"></span>
01235 <span class="comment">    Length - Specifies the length, in bytes, of the object type</span>
01236 <span class="comment">        information buffer</span>
01237 <span class="comment"></span>
01238 <span class="comment">    ReturnLength - Contains the number of bytes already used up</span>
01239 <span class="comment">        in the object type information buffer. On return this receives</span>
01240 <span class="comment">        an updated byte count</span>
01241 <span class="comment"></span>
01242 <span class="comment">        (Length minus ReturnLength) is really now many bytes are left</span>
01243 <span class="comment">        in the output buffer.  The buffer supplied to this call may</span>
01244 <span class="comment">        actually be offset within the original users buffer</span>
01245 <span class="comment"></span>
01246 <span class="comment">Return Value:</span>
01247 <span class="comment"></span>
01248 <span class="comment">    An appropriate status value</span>
01249 <span class="comment"></span>
01250 <span class="comment">--*/</span>
01251 
01252 {
01253     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01254 
01255     <span class="keywordflow">try</span> {
01256 
01257         <span class="comment">//</span>
01258         <span class="comment">//  The total number of bytes needed for this query includes the</span>
01259         <span class="comment">//  object type information structure plus the name of the type</span>
01260         <span class="comment">//  rounded up to a ulong boundary</span>
01261         <span class="comment">//</span>
01262 
01263         *ReturnLength += <span class="keyword">sizeof</span>( *ObjectTypeInfo ) + <a class="code" href="../../d0/d9/ntosdef_8h.html#a4">ALIGN_UP</a>( ObjectType-&gt;Name.MaximumLength, ULONG );
01264 
01265         <span class="comment">//</span>
01266         <span class="comment">//  Make sure the buffer is large enough for this information and</span>
01267         <span class="comment">//  then fill in the record</span>
01268         <span class="comment">//</span>
01269 
01270         <span class="keywordflow">if</span> (Length &lt; *ReturnLength) {
01271 
01272             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INFO_LENGTH_MISMATCH;
01273 
01274         } <span class="keywordflow">else</span> {
01275 
01276             ObjectTypeInfo-&gt;TotalNumberOfObjects = ObjectType-&gt;TotalNumberOfObjects;
01277             ObjectTypeInfo-&gt;TotalNumberOfHandles = ObjectType-&gt;TotalNumberOfHandles;
01278             ObjectTypeInfo-&gt;HighWaterNumberOfObjects = ObjectType-&gt;HighWaterNumberOfObjects;
01279             ObjectTypeInfo-&gt;HighWaterNumberOfHandles = ObjectType-&gt;HighWaterNumberOfHandles;
01280             ObjectTypeInfo-&gt;InvalidAttributes = ObjectType-&gt;TypeInfo.InvalidAttributes;
01281             ObjectTypeInfo-&gt;GenericMapping = ObjectType-&gt;TypeInfo.GenericMapping;
01282             ObjectTypeInfo-&gt;ValidAccessMask = ObjectType-&gt;TypeInfo.ValidAccessMask;
01283             ObjectTypeInfo-&gt;SecurityRequired = ObjectType-&gt;TypeInfo.SecurityRequired;
01284             ObjectTypeInfo-&gt;MaintainHandleCount = ObjectType-&gt;TypeInfo.MaintainHandleCount;
01285             ObjectTypeInfo-&gt;PoolType = ObjectType-&gt;TypeInfo.PoolType;
01286             ObjectTypeInfo-&gt;DefaultPagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultPagedPoolCharge;
01287             ObjectTypeInfo-&gt;DefaultNonPagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultNonPagedPoolCharge;
01288 
01289             <span class="comment">//</span>
01290             <span class="comment">//  The type name goes right after this structure.  We cannot use</span>
01291             <span class="comment">//  rtl routine like RtlCopyUnicodeString that might use the local</span>
01292             <span class="comment">//  memory to keep state, because this is the user buffer and it</span>
01293             <span class="comment">//  could be changing by user</span>
01294             <span class="comment">//</span>
01295 
01296             ObjectTypeInfo-&gt;TypeName.Buffer = (PWSTR)(ObjectTypeInfo+1);
01297             ObjectTypeInfo-&gt;TypeName.Length = ObjectType-&gt;Name.Length;
01298             ObjectTypeInfo-&gt;TypeName.MaximumLength = ObjectType-&gt;Name.MaximumLength;
01299 
01300             RtlMoveMemory( (PWSTR)(ObjectTypeInfo+1),
01301                            ObjectType-&gt;Name.Buffer,
01302                            ObjectType-&gt;Name.Length );
01303 
01304             ((PWSTR)(ObjectTypeInfo+1))[ ObjectType-&gt;Name.Length/<span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
01305 
01306             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01307         }
01308 
01309     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01310 
01311         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
01312     }
01313 
01314     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01315 }
01316 
01317 
01318 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l01319"></a><a class="code" href="../../d6/d1/obquery_8c.html#a10">01319</a> <a class="code" href="../../d6/d1/obquery_8c.html#a10">ObQueryObjectAuditingByHandle</a> (
01320     IN HANDLE Handle,
01321     OUT PBOOLEAN GenerateOnClose
01322     )
01323 
01324 <span class="comment">/*++</span>
01325 <span class="comment"></span>
01326 <span class="comment">Routine description:</span>
01327 <span class="comment"></span>
01328 <span class="comment">    This routine tells the caller if the indicated handle will</span>
01329 <span class="comment">    generate an audit if it is closed</span>
01330 <span class="comment"></span>
01331 <span class="comment">Arguments:</span>
01332 <span class="comment"></span>
01333 <span class="comment">    Handle - Supplies the handle being queried</span>
01334 <span class="comment"></span>
01335 <span class="comment">    GenerateOnClose - Receives TRUE if the handle will generate</span>
01336 <span class="comment">        an audit if closed and FALSE otherwise</span>
01337 <span class="comment"></span>
01338 <span class="comment">Return Value:</span>
01339 <span class="comment"></span>
01340 <span class="comment">    An appropriate status value</span>
01341 <span class="comment"></span>
01342 <span class="comment">--*/</span>
01343 
01344 {
01345     <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">PHANDLE_TABLE</a> ObjectTable;
01346     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> ObjectTableEntry;
01347     PVOID Object;
01348     ULONG CapturedGrantedAccess;
01349     ULONG CapturedAttributes;
01350     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01351 
01352     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01353 
01354     <span class="comment">//</span>
01355     <span class="comment">//  Protect ourselves from being interrupted while we hold a handle table</span>
01356     <span class="comment">//  entry lock</span>
01357     <span class="comment">//</span>
01358 
01359     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
01360 
01361     <span class="keywordflow">try</span> {
01362 
01363         <a class="code" href="../../d5/d1/obp_8h.html#a2">ObpValidateIrql</a>( <span class="stringliteral">"ObQueryObjectAuditingByHandle"</span> );
01364 
01365 
01366         <span class="comment">//</span>
01367         <span class="comment">//  For the current process we'll grab its object table and</span>
01368         <span class="comment">//  then get the object table entry</span>
01369         <span class="comment">//</span>
01370 
01371         ObjectTable = <a class="code" href="../../d5/d1/obp_8h.html#a12">ObpGetObjectTable</a>();
01372 
01373         ObjectTableEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>( ObjectTable,
01374                                                   <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> );
01375 
01376         <span class="comment">//</span>
01377         <span class="comment">//  If we were given a valid handle we'll look at the attributes</span>
01378         <span class="comment">//  stored in the object table entry to decide if we generate</span>
01379         <span class="comment">//  an audit on close</span>
01380         <span class="comment">//</span>
01381 
01382         <span class="keywordflow">if</span> (ObjectTableEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01383 
01384             CapturedAttributes = ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o1">ObAttributes</a>;
01385 
01386             <span class="keywordflow">if</span> (CapturedAttributes &amp; <a class="code" href="../../d7/d7/ntapi_8c.html#a2">OBJ_AUDIT_OBJECT_CLOSE</a>) {
01387 
01388                 *GenerateOnClose = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01389 
01390             } <span class="keywordflow">else</span> {
01391 
01392                 *GenerateOnClose = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01393             }
01394 
01395             <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>( ObjectTable, ObjectTableEntry );
01396 
01397             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01398 
01399         } <span class="keywordflow">else</span> {
01400 
01401             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_HANDLE;
01402         }
01403 
01404     } finally {
01405 
01406         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
01407     }
01408 
01409     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01410 }
01411 
01412 
01413 <span class="preprocessor">#if DBG</span>
01414 <span class="preprocessor"></span>PUNICODE_STRING
01415 ObGetObjectName (
01416     IN PVOID Object
01417     )
01418 
01419 <span class="comment">/*++</span>
01420 <span class="comment"></span>
01421 <span class="comment">Routine description:</span>
01422 <span class="comment"></span>
01423 <span class="comment">    This routine returns a pointer to the name of object</span>
01424 <span class="comment"></span>
01425 <span class="comment">Arguments:</span>
01426 <span class="comment"></span>
01427 <span class="comment">    Object - Supplies the object being queried</span>
01428 <span class="comment"></span>
01429 <span class="comment">Return Value:</span>
01430 <span class="comment"></span>
01431 <span class="comment">    The address of the unicode string that stores the object</span>
01432 <span class="comment">    name if available and NULL otherwise</span>
01433 <span class="comment"></span>
01434 <span class="comment">--*/</span>
01435 
01436 {
01437     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01438     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
01439 
01440     <span class="comment">//</span>
01441     <span class="comment">//  Translate the input object to a name info structure</span>
01442     <span class="comment">//</span>
01443 
01444     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01445     NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
01446 
01447     <span class="comment">//</span>
01448     <span class="comment">//  If the object has a name then return the address of</span>
01449     <span class="comment">//  the name otherwise return null</span>
01450     <span class="comment">//</span>
01451 
01452     <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length != 0)) {
01453 
01454         <span class="keywordflow">return</span> &amp;NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>;
01455 
01456     } <span class="keywordflow">else</span> {
01457 
01458         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01459     }
01460 }
01461 <span class="preprocessor">#endif // DBG</span>
01462 <span class="preprocessor"></span>
01463 
01464 <span class="comment">//</span>
01465 <span class="comment">//  Local support routine</span>
01466 <span class="comment">//</span>
01467 
01468 BOOLEAN
<a name="l01469"></a><a class="code" href="../../d6/d1/obquery_8c.html#a11">01469</a> <a class="code" href="../../d6/d1/obquery_8c.html#a11">ObpSetHandleAttributes</a> (
01470     IN OUT <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> ObjectTableEntry,
01471     IN ULONG_PTR Parameter
01472     )
01473 
01474 <span class="comment">/*++</span>
01475 <span class="comment"></span>
01476 <span class="comment">Routine description:</span>
01477 <span class="comment"></span>
01478 <span class="comment">    This is the call back routine for the ExChangeHandle from</span>
01479 <span class="comment">    NtSetInformationObject</span>
01480 <span class="comment"></span>
01481 <span class="comment">Arguments:</span>
01482 <span class="comment"></span>
01483 <span class="comment">    ObjectTableEntry - Supplies a pointer to the object table entry being</span>
01484 <span class="comment">        modified</span>
01485 <span class="comment"></span>
01486 <span class="comment">    Parameter - Supplies a pointer to the OBJECT_HANDLE_FLAG_INFORMATION</span>
01487 <span class="comment">        structure to set into the table entry</span>
01488 <span class="comment"></span>
01489 <span class="comment">Return Value:</span>
01490 <span class="comment"></span>
01491 <span class="comment">    Returns TRUE if the operation is successful otherwise FALSE</span>
01492 <span class="comment"></span>
01493 <span class="comment">--*/</span>
01494 
01495 {
01496     <a class="code" href="../../d6/d1/obquery_8c.html#a3">POBP_SET_HANDLE_ATTRIBUTES</a> ObjectInformation;
01497     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01498 
01499     ObjectInformation = (<a class="code" href="../../d6/d1/obquery_8c.html#a3">POBP_SET_HANDLE_ATTRIBUTES</a>)Parameter;
01500 
01501     <span class="comment">//</span>
01502     <span class="comment">//  Get a pointer to the object type via the object header and if the</span>
01503     <span class="comment">//  caller has asked for inherit but the object type says that inherit</span>
01504     <span class="comment">//  is an invalid flag then return false</span>
01505     <span class="comment">//</span>
01506 
01507     ObjectHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(((ULONG_PTR)(ObjectTableEntry-&gt;Object)) &amp; ~<a class="code" href="../../d5/d1/obp_8h.html#a17">OBJ_HANDLE_ATTRIBUTES</a>);
01508 
01509     <span class="keywordflow">if</span> ((ObjectInformation-&gt;<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o0">ObjectInformation</a>.Inherit) &amp;&amp;
01510         ((ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o3">InvalidAttributes</a> &amp; OBJ_INHERIT) != 0)) {
01511 
01512         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01513     }
01514 
01515     <span class="comment">//</span>
01516     <span class="comment">//  User mode cannot set the object attributes for kernel objects</span>
01517     <span class="comment">//</span>
01518 
01519     <span class="keywordflow">if</span> ((ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a2">OB_FLAG_KERNEL_OBJECT</a>) &amp;&amp;
01520         (ObjectInformation-&gt;<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o1">PreviousMode</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>)) {
01521 
01522         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01523     }
01524 
01525     <span class="comment">//</span>
01526     <span class="comment">//  For each piece of information (inheriit and protect from close) that</span>
01527     <span class="comment">//  is in the object information buffer we'll set or clear the bits in</span>
01528     <span class="comment">//  the object table entry.  The bits modified are the low order bits of</span>
01529     <span class="comment">//  used to store the pointer to the object header.</span>
01530     <span class="comment">//</span>
01531 
01532     <span class="keywordflow">if</span> (ObjectInformation-&gt;<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o0">ObjectInformation</a>.Inherit) {
01533 
01534         ObjectTableEntry-&gt;ObAttributes |= OBJ_INHERIT;
01535 
01536     } <span class="keywordflow">else</span> {
01537 
01538         ObjectTableEntry-&gt;ObAttributes &amp;= ~OBJ_INHERIT;
01539     }
01540 
01541     <span class="keywordflow">if</span> (ObjectInformation-&gt;<a class="code" href="../../d1/d4/struct____OBP__SET__HANDLE__ATTRIBUTES.html#o0">ObjectInformation</a>.ProtectFromClose) {
01542 
01543         ObjectTableEntry-&gt;ObAttributes |= <a class="code" href="../../d5/d1/obp_8h.html#a15">OBJ_PROTECT_CLOSE</a>;
01544 
01545     } <span class="keywordflow">else</span> {
01546 
01547         ObjectTableEntry-&gt;ObAttributes &amp;= ~<a class="code" href="../../d5/d1/obp_8h.html#a15">OBJ_PROTECT_CLOSE</a>;
01548     }
01549 
01550     <span class="comment">//</span>
01551     <span class="comment">//  And return to our caller</span>
01552     <span class="comment">//</span>
01553 
01554     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01555 }
01556 
01557 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
