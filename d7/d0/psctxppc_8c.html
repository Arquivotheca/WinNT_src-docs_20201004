<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: psctxppc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>psctxppc.c File Reference</h1><code>#include "<a class="el" href="../../d9/d0/psp_8h-source.html">psp.h</a>"</code><br>

<p>
<a href="../../d8/d9/psctxppc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/psctxppc_8c.html#a0">STK_MIN_FRAME</a>&nbsp;&nbsp;&nbsp;56</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/psctxppc_8c.html#a2">PspGetContext</a> (IN PKTRAP_FRAME TrapFrame, IN PKNONVOLATILE_CONTEXT_POINTERS ContextPointers, IN OUT PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/psctxppc_8c.html#a3">PspSetContext</a> (IN OUT PKTRAP_FRAME TrapFrame, IN PKNONVOLATILE_CONTEXT_POINTERS ContextPointers, IN PCONTEXT ContextRecord, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ProcessorMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/psctxppc_8c.html#a4">PspGetSetContextApc</a> (IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *NormalRoutine, IN PVOID *NormalContext, IN PVOID *SystemArgument1, IN PVOID *SystemArgument2)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/psctxppc_8c.html#a1">KiBreakPoints</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="psctxppc.c::STK_MIN_FRAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define STK_MIN_FRAME&nbsp;&nbsp;&nbsp;56          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00027">27</a> of file <a class="el" href="../../d8/d9/psctxppc_8c-source.html">psctxppc.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d7/ppc_2apcuser_8c-source.html#l00034">KiInitializeUserApc()</a>, <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00386">PspGetSetContextApc()</a>, <a class="el" href="../../d7/d5/rtl_2ppc_2context_8c-source.html#l00031">RtlInitializeContext()</a>, and <a class="el" href="../../d7/d5/rtl_2ppc_2context_8c-source.html#l00114">RtlRemoteCall()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="psctxppc.c::PspGetContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspGetContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKNONVOLATILE_CONTEXT_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextPointers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00031">31</a> of file <a class="el" href="../../d8/d9/psctxppc_8c-source.html">psctxppc.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, and <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00078">KiBreakPoints</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00386">PspGetSetContextApc()</a>, <a class="el" href="../../d4/d9/psctx386_8c-source.html#l00131">PspGetSetContextSpecialApc()</a>, and <a class="el" href="../../d5/d9/psctxalp_8c-source.html#l00349">PspGetSetContextSpecialApcMain()</a>.
<p>
<pre class="fragment"><div>00039                    :
00040 
00041     This function selectively moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap frame
00042     and nonvolatile context to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context record.
00043 
00044 Arguments:
00045 
00046     TrapFrame - Supplies a pointer to a trap frame.
00047 
00048     ContextPointers - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of context pointers record.
00049 
00050     ContextRecord - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context record.
00051 
00052 Return Value:
00053 
00054     None.
00055 
00056 --*/
00057 
00058 {
00059 
00060     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) {
00061 
00062         <span class="comment">//</span>
00063         <span class="comment">// Get machine state, instr address, link, count registers</span>
00064         <span class="comment">//</span>
00065 
00066         ContextRecord-&gt;Msr = TrapFrame-&gt;Msr;
00067         ContextRecord-&gt;Iar = TrapFrame-&gt;Iar;
00068         ContextRecord-&gt;Lr  = TrapFrame-&gt;Lr;
00069         ContextRecord-&gt;Ctr = TrapFrame-&gt;Ctr;
00070     }
00071 
00072     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) {
00073 
00074         <span class="comment">//</span>
00075         <span class="comment">// Get volatile integer regs in trap frame are 0..12</span>
00076         <span class="comment">//</span>
00077 
00078         RtlMoveMemory (&amp;ContextRecord-&gt;Gpr0, &amp;TrapFrame-&gt;Gpr0,
00079                        sizeof (ULONG) * 13);
00080 
00081         <span class="comment">//</span>
00082         <span class="comment">// Get non-volatile integer regs in exception frame are 13..31</span>
00083         <span class="comment">//</span>
00084 
00085         ContextRecord-&gt;Gpr13 = *ContextPointers-&gt;IntegerContext[13];
00086         ContextRecord-&gt;Gpr14 = *ContextPointers-&gt;IntegerContext[14];
00087         ContextRecord-&gt;Gpr15 = *ContextPointers-&gt;IntegerContext[15];
00088         ContextRecord-&gt;Gpr16 = *ContextPointers-&gt;IntegerContext[16];
00089         ContextRecord-&gt;Gpr17 = *ContextPointers-&gt;IntegerContext[17];
00090         ContextRecord-&gt;Gpr18 = *ContextPointers-&gt;IntegerContext[18];
00091         ContextRecord-&gt;Gpr19 = *ContextPointers-&gt;IntegerContext[19];
00092         ContextRecord-&gt;Gpr20 = *ContextPointers-&gt;IntegerContext[20];
00093         ContextRecord-&gt;Gpr21 = *ContextPointers-&gt;IntegerContext[21];
00094         ContextRecord-&gt;Gpr22 = *ContextPointers-&gt;IntegerContext[22];
00095         ContextRecord-&gt;Gpr23 = *ContextPointers-&gt;IntegerContext[23];
00096         ContextRecord-&gt;Gpr24 = *ContextPointers-&gt;IntegerContext[24];
00097         ContextRecord-&gt;Gpr25 = *ContextPointers-&gt;IntegerContext[25];
00098         ContextRecord-&gt;Gpr26 = *ContextPointers-&gt;IntegerContext[26];
00099         ContextRecord-&gt;Gpr27 = *ContextPointers-&gt;IntegerContext[27];
00100         ContextRecord-&gt;Gpr28 = *ContextPointers-&gt;IntegerContext[28];
00101         ContextRecord-&gt;Gpr29 = *ContextPointers-&gt;IntegerContext[29];
00102         ContextRecord-&gt;Gpr30 = *ContextPointers-&gt;IntegerContext[30];
00103         ContextRecord-&gt;Gpr31 = *ContextPointers-&gt;IntegerContext[31];
00104 
00105         <span class="comment">//</span>
00106         <span class="comment">// The CR is made up of volatile and non-volatile fields,</span>
00107         <span class="comment">// but the entire CR is saved in the trap frame</span>
00108         <span class="comment">//</span>
00109 
00110         ContextRecord-&gt;Cr = TrapFrame-&gt;Cr;
00111 
00112         <span class="comment">//</span>
00113         <span class="comment">// Fixed Point Exception Register (XER) is part of the</span>
00114         <span class="comment">// integer state</span>
00115         <span class="comment">//</span>
00116 
00117         ContextRecord-&gt;Xer = TrapFrame-&gt;Xer;
00118     }
00119 
00120     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) ==
00121          <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) {
00122 
00123         <span class="comment">//</span>
00124         <span class="comment">// Get volatile floating point regs in trap frame are 0..13</span>
00125         <span class="comment">//</span>
00126 
00127         RtlMoveMemory(&amp;ContextRecord-&gt;Fpr0, &amp;TrapFrame-&gt;Fpr0,
00128                      <span class="keyword">sizeof</span>(DOUBLE) * (14));
00129 
00130         <span class="comment">//</span>
00131         <span class="comment">// Get non-volatile floating point regs 14..31</span>
00132         <span class="comment">//</span>
00133 
00134         ContextRecord-&gt;Fpr14 = *ContextPointers-&gt;FloatingContext[14];
00135         ContextRecord-&gt;Fpr15 = *ContextPointers-&gt;FloatingContext[15];
00136         ContextRecord-&gt;Fpr16 = *ContextPointers-&gt;FloatingContext[16];
00137         ContextRecord-&gt;Fpr17 = *ContextPointers-&gt;FloatingContext[17];
00138         ContextRecord-&gt;Fpr18 = *ContextPointers-&gt;FloatingContext[18];
00139         ContextRecord-&gt;Fpr19 = *ContextPointers-&gt;FloatingContext[19];
00140         ContextRecord-&gt;Fpr20 = *ContextPointers-&gt;FloatingContext[20];
00141         ContextRecord-&gt;Fpr21 = *ContextPointers-&gt;FloatingContext[21];
00142         ContextRecord-&gt;Fpr22 = *ContextPointers-&gt;FloatingContext[22];
00143         ContextRecord-&gt;Fpr23 = *ContextPointers-&gt;FloatingContext[23];
00144         ContextRecord-&gt;Fpr24 = *ContextPointers-&gt;FloatingContext[24];
00145         ContextRecord-&gt;Fpr25 = *ContextPointers-&gt;FloatingContext[25];
00146         ContextRecord-&gt;Fpr26 = *ContextPointers-&gt;FloatingContext[26];
00147         ContextRecord-&gt;Fpr27 = *ContextPointers-&gt;FloatingContext[27];
00148         ContextRecord-&gt;Fpr28 = *ContextPointers-&gt;FloatingContext[28];
00149         ContextRecord-&gt;Fpr29 = *ContextPointers-&gt;FloatingContext[29];
00150         ContextRecord-&gt;Fpr30 = *ContextPointers-&gt;FloatingContext[30];
00151         ContextRecord-&gt;Fpr31 = *ContextPointers-&gt;FloatingContext[31];
00152 
00153         <span class="comment">//</span>
00154         <span class="comment">// Get floating point status and control register.</span>
00155         <span class="comment">//</span>
00156 
00157         ContextRecord-&gt;Fpscr = TrapFrame-&gt;Fpscr;
00158     }
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">// Fetch Dr register contents if requested.  Values may be trash.</span>
00162     <span class="comment">//</span>
00163 
00164     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; CONTEXT_DEBUG_REGISTERS) ==
00165         CONTEXT_DEBUG_REGISTERS) {
00166 
00167 
00168         ContextRecord-&gt;Dr0 = TrapFrame-&gt;Dr0;
00169         ContextRecord-&gt;Dr1 = TrapFrame-&gt;Dr1;
00170         ContextRecord-&gt;Dr2 = TrapFrame-&gt;Dr2;
00171         ContextRecord-&gt;Dr3 = TrapFrame-&gt;Dr3;
00172         ContextRecord-&gt;Dr6 = TrapFrame-&gt;Dr6;
00173         ContextRecord-&gt;Dr5 = 0;           <span class="comment">// Zero initialize unused regs</span>
00174         ContextRecord-&gt;Dr4 = 0;
00175 
00176         <span class="comment">//</span>
00177         <span class="comment">// If it's a user mode frame, and the thread doesn't have DRs set,</span>
00178         <span class="comment">// and we just return the trash in the frame, we risk accidentally</span>
00179         <span class="comment">// making the thread active with trash values on a set.  Therefore,</span>
00180         <span class="comment">// Dr7 must be set to the number of available data address breakpoint</span>
00181         <span class="comment">// registers if we get a non-active user mode frame.</span>
00182         <span class="comment">//</span>
00183         <span class="keywordflow">if</span> (((TrapFrame-&gt;PreviousMode) != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp;
00184             (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;DebugActive)) {
00185 
00186             ContextRecord-&gt;Dr7 = TrapFrame-&gt;Dr7;
00187             ContextRecord-&gt;Dr6 |= <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a7">KiBreakPoints</a>;
00188         } <span class="keywordflow">else</span> {
00189 
00190             ContextRecord-&gt;Dr7 = 0;
00191             ContextRecord-&gt;Dr6 = <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a7">KiBreakPoints</a>;
00192         }
00193     }
00194 
00195     <span class="keywordflow">return</span>;
00196 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="psctxppc.c::PspGetSetContextApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspGetSetContextApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Apc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00386">386</a> of file <a class="el" href="../../d8/d9/psctxppc_8c-source.html">psctxppc.c</a>.
<p>
References <a class="el" href="../../d9/d0/psp_8h-source.html#l00080">_GETSETCONTEXT::Context</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00556">_KTHREAD::InitialStack</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00078">_GETSETCONTEXT::Mode</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00079">_GETSETCONTEXT::OperationComplete</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d9/psctxalp_8c-source.html#l00029">PspGetContext()</a>, <a class="el" href="../../d4/d9/psctx386_8c-source.html#l00088">PspSetContext()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00348">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00557">_KTHREAD::StackLimit</a>, <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00027">STK_MIN_FRAME</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00347">_ETHREAD::Tcb</a>.
<p>
<pre class="fragment"><div>00396                    :
00397 
00398     This function either captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00399     thread, or sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread. The
00400     operation <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> determined by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of SystemArgument1. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a>
00401     zero value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used <span class="keywordflow">for</span> get context, and a nonzero value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used
00402     <span class="keywordflow">for</span> set context.
00403 
00404 Arguments:
00405 
00406     Apc - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object that caused entry
00407           into <span class="keyword">this</span> routine.
00408 
00409     NormalRoutine - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> normal routine function that
00410         was specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC was initialized. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00411         used.
00412 
00413     NormalContext - Supplies a pointer to an arbitrary data structure that
00414         was specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC was initialized. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00415         used.
00416 
00417     SystemArgument1, SystemArgument2 - Supplies a set of two pointer to two
00418         arguments that contain untyped data. These parameters are not used.
00419 
00420 Return Value:
00421 
00422     None.
00423 
00424 --*/
00425 
00426 {
00427 
00428     <a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html">PGETSETCONTEXT</a> ContextBlock;
00429     KNONVOLATILE_CONTEXT_POINTERS ContextPointers;
00430     CONTEXT ContextRecord;
00431     ULONG ControlPc;
00432     ULONG EstablisherFrame;
00433     PRUNTIME_FUNCTION FunctionEntry;
00434     BOOLEAN InFunction;
00435     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
00436     ULONG TrapFrame1;
00437     ULONG TrapFrame2;
00438 
00439     <span class="comment">//</span>
00440     <span class="comment">// Get the address of the context block and compute the address of the</span>
00441     <span class="comment">// system entry trap frame.</span>
00442     <span class="comment">//</span>
00443 
00444     ContextBlock = CONTAINING_RECORD(Apc, <a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html">GETSETCONTEXT</a>, Apc);
00445     Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00446     TrapFrame1 = (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o2">InitialStack</a> - (KTRAP_FRAME_LENGTH +
00447                  <span class="keyword">sizeof</span>(KEXCEPTION_FRAME) + (2 * <span class="keyword">sizeof</span>(ULONG)));
00448     TrapFrame2 = (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o2">InitialStack</a> - (KTRAP_FRAME_LENGTH +
00449                  <span class="keyword">sizeof</span>(KEXCEPTION_FRAME) + <a class="code" href="../../d7/d0/psctxppc_8c.html#a0">STK_MIN_FRAME</a> +
00450                  (10 * <span class="keyword">sizeof</span>(ULONG)));
00451 
00452     <span class="comment">//</span>
00453     <span class="comment">// Capture the current thread context and set the initial control PC</span>
00454     <span class="comment">// value.</span>
00455     <span class="comment">//</span>
00456 
00457     RtlCaptureContext(&amp;ContextRecord);
00458     ControlPc = ContextRecord.Lr;
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">// Initialize context pointers for the nonvolatile integer and floating</span>
00462     <span class="comment">// registers.</span>
00463     <span class="comment">//</span>
00464 
00465     ContextPointers.IntegerContext[13] = &amp;ContextRecord.Gpr13;
00466     ContextPointers.IntegerContext[14] = &amp;ContextRecord.Gpr14;
00467     ContextPointers.IntegerContext[15] = &amp;ContextRecord.Gpr15;
00468     ContextPointers.IntegerContext[16] = &amp;ContextRecord.Gpr16;
00469     ContextPointers.IntegerContext[17] = &amp;ContextRecord.Gpr17;
00470     ContextPointers.IntegerContext[18] = &amp;ContextRecord.Gpr18;
00471     ContextPointers.IntegerContext[19] = &amp;ContextRecord.Gpr19;
00472     ContextPointers.IntegerContext[20] = &amp;ContextRecord.Gpr20;
00473     ContextPointers.IntegerContext[21] = &amp;ContextRecord.Gpr21;
00474     ContextPointers.IntegerContext[22] = &amp;ContextRecord.Gpr22;
00475     ContextPointers.IntegerContext[23] = &amp;ContextRecord.Gpr23;
00476     ContextPointers.IntegerContext[24] = &amp;ContextRecord.Gpr24;
00477     ContextPointers.IntegerContext[25] = &amp;ContextRecord.Gpr25;
00478     ContextPointers.IntegerContext[26] = &amp;ContextRecord.Gpr26;
00479     ContextPointers.IntegerContext[27] = &amp;ContextRecord.Gpr27;
00480     ContextPointers.IntegerContext[28] = &amp;ContextRecord.Gpr28;
00481     ContextPointers.IntegerContext[29] = &amp;ContextRecord.Gpr29;
00482     ContextPointers.IntegerContext[30] = &amp;ContextRecord.Gpr30;
00483     ContextPointers.IntegerContext[31] = &amp;ContextRecord.Gpr31;
00484 
00485     ContextPointers.FloatingContext[14] = &amp;ContextRecord.Fpr14;
00486     ContextPointers.FloatingContext[15] = &amp;ContextRecord.Fpr15;
00487     ContextPointers.FloatingContext[16] = &amp;ContextRecord.Fpr16;
00488     ContextPointers.FloatingContext[17] = &amp;ContextRecord.Fpr17;
00489     ContextPointers.FloatingContext[18] = &amp;ContextRecord.Fpr18;
00490     ContextPointers.FloatingContext[19] = &amp;ContextRecord.Fpr19;
00491     ContextPointers.FloatingContext[20] = &amp;ContextRecord.Fpr20;
00492     ContextPointers.FloatingContext[21] = &amp;ContextRecord.Fpr21;
00493     ContextPointers.FloatingContext[22] = &amp;ContextRecord.Fpr22;
00494     ContextPointers.FloatingContext[23] = &amp;ContextRecord.Fpr23;
00495     ContextPointers.FloatingContext[24] = &amp;ContextRecord.Fpr24;
00496     ContextPointers.FloatingContext[25] = &amp;ContextRecord.Fpr25;
00497     ContextPointers.FloatingContext[26] = &amp;ContextRecord.Fpr26;
00498     ContextPointers.FloatingContext[27] = &amp;ContextRecord.Fpr27;
00499     ContextPointers.FloatingContext[28] = &amp;ContextRecord.Fpr28;
00500     ContextPointers.FloatingContext[29] = &amp;ContextRecord.Fpr29;
00501     ContextPointers.FloatingContext[30] = &amp;ContextRecord.Fpr30;
00502     ContextPointers.FloatingContext[31] = &amp;ContextRecord.Fpr31;
00503 
00504     <span class="comment">//</span>
00505     <span class="comment">// Start with the frame specified by the context record and virtually</span>
00506     <span class="comment">// unwind call frames until the system entry trap frame is encountered.</span>
00507     <span class="comment">//</span>
00508 
00509     <span class="keywordflow">do</span> {
00510 
00511         <span class="comment">//</span>
00512         <span class="comment">// Lookup the function table entry using the point at which control</span>
00513         <span class="comment">// left the procedure.</span>
00514         <span class="comment">//</span>
00515 
00516         FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc);
00517 
00518         <span class="comment">//</span>
00519         <span class="comment">// Virtually unwind to the caller of the current routine to</span>
00520         <span class="comment">// obtain the address where control left the caller.</span>
00521         <span class="comment">//</span>
00522 
00523         ControlPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ControlPc,
00524                                      FunctionEntry,
00525                                      &amp;ContextRecord,
00526                                      &amp;InFunction,
00527                                      &amp;EstablisherFrame,
00528                                      &amp;ContextPointers,
00529                                      (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o3">StackLimit</a>,
00530                                      (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o2">InitialStack</a>);
00531 
00532     } <span class="keywordflow">while</span> ((ContextRecord.Gpr1 &gt;= (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o3">StackLimit</a>) &amp;&amp;
00533              (ContextRecord.Gpr1 &lt; (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o2">InitialStack</a>));
00534 
00535     <span class="comment">//</span>
00536     <span class="comment">// If system argument one is nonzero, then set the context of the current</span>
00537     <span class="comment">// thread. Otherwise, get the context of the current thread.</span>
00538     <span class="comment">//</span>
00539 
00540     <span class="keywordflow">if</span> (Apc-&gt;SystemArgument1 != 0) {
00541 
00542         <span class="comment">//</span>
00543         <span class="comment">// Set context of current thread.</span>
00544         <span class="comment">//</span>
00545 
00546         <a class="code" href="../../d8/d1/psp_8h.html#a72">PspSetContext</a>((PKTRAP_FRAME)TrapFrame1,
00547                       &amp;ContextPointers,
00548                       &amp;ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o3">Context</a>,
00549                       ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o1">Mode</a>);
00550 
00551     } <span class="keywordflow">else</span> {
00552 
00553         <span class="comment">//</span>
00554         <span class="comment">// Get context of current thread.</span>
00555         <span class="comment">//</span>
00556 
00557         <a class="code" href="../../d8/d1/psp_8h.html#a73">PspGetContext</a>((PKTRAP_FRAME)TrapFrame1,
00558                       &amp;ContextPointers,
00559                       &amp;ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o3">Context</a>);
00560     }
00561 
00562     <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o2">OperationComplete</a>, 0, FALSE);
00563     <span class="keywordflow">return</span>;
00564 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="psctxppc.c::PspSetContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspSetContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKNONVOLATILE_CONTEXT_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextPointers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessorMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00199">199</a> of file <a class="el" href="../../d8/d9/psctxppc_8c-source.html">psctxppc.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00068">KeGetPcr</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>.
<p>
<pre class="fragment"><div>00208                    :
00209 
00210     This function selectively moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context
00211     record to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap frame and nonvolatile context.
00212 
00213 Arguments:
00214 
00215     TrapFrame - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a trap frame.
00216 
00217     ContextPointers - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context pointers record.
00218 
00219     ContextRecord - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context record.
00220 
00221     ProcessorMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode to use when sanitizing
00222         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d2/festate_8h.html#a2">PSR</a> and FSR.
00223 
00224 Return Value:
00225 
00226     None.
00227 
00228 --*/
00229 
00230 {
00231 
00232     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) {
00233 
00234         <span class="comment">//</span>
00235         <span class="comment">// Set instruction address, link, count, and machine state registers</span>
00236         <span class="comment">//</span>
00237 
00238         TrapFrame-&gt;Lr  = ContextRecord-&gt;Lr;
00239         TrapFrame-&gt;Ctr = ContextRecord-&gt;Ctr;
00240         TrapFrame-&gt;Msr = SANITIZE_MSR(ContextRecord-&gt;Msr, ProcessorMode);
00241 
00242         <span class="comment">//</span>
00243         <span class="comment">// If this is a remote call dereference the function descritor in</span>
00244         <span class="comment">// the remote threads context.</span>
00245         <span class="comment">//</span>
00246         <span class="keywordflow">if</span> (((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) ==
00247               <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) &amp;&amp;
00248             (ContextRecord-&gt;Gpr2 == 0)) {
00249            <span class="keywordflow">try</span> {
00250 
00251                <span class="comment">//</span>
00252                <span class="comment">// Make sure we have read access to the function descriptor.</span>
00253                <span class="comment">//</span>
00254                <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ContextRecord-&gt;Iar,
00255                             (<span class="keyword">sizeof</span>(ULONG) * 2), <span class="keyword">sizeof</span>(ULONG));
00256                TrapFrame-&gt;Iar = *((PULONG)(ContextRecord-&gt;Iar))++;
00257                ContextRecord-&gt;Gpr2 = *(PULONG)(ContextRecord-&gt;Iar);
00258 
00259            } except(EXCEPTION_EXECUTE_HANDLER) {
00260 
00261                <span class="comment">//</span>
00262                <span class="comment">// Remote thread doesn't have access to the function</span>
00263                <span class="comment">// descriptor. Just set the IAR and let the thread take</span>
00264                <span class="comment">// the exception.</span>
00265                <span class="comment">//</span>
00266                TrapFrame-&gt;Iar = ContextRecord-&gt;Iar;
00267                <span class="keywordflow">return</span>;
00268            }
00269         } <span class="keywordflow">else</span> {
00270            TrapFrame-&gt;Iar = ContextRecord-&gt;Iar;
00271         }
00272     }
00273 
00274     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) {
00275 
00276         <span class="comment">//</span>
00277         <span class="comment">// Volatile integer regs are 0..12</span>
00278         <span class="comment">//</span>
00279 
00280         RtlMoveMemory(&amp;TrapFrame-&gt;Gpr0, &amp;ContextRecord-&gt;Gpr0,
00281                      <span class="keyword">sizeof</span>(ULONG) * (13));
00282 
00283         <span class="comment">//</span>
00284         <span class="comment">// Non-volatile integer regs are 13..31</span>
00285         <span class="comment">//</span>
00286 
00287         *ContextPointers-&gt;IntegerContext[13] = ContextRecord-&gt;Gpr13;
00288         *ContextPointers-&gt;IntegerContext[14] = ContextRecord-&gt;Gpr14;
00289         *ContextPointers-&gt;IntegerContext[15] = ContextRecord-&gt;Gpr15;
00290         *ContextPointers-&gt;IntegerContext[16] = ContextRecord-&gt;Gpr16;
00291         *ContextPointers-&gt;IntegerContext[17] = ContextRecord-&gt;Gpr17;
00292         *ContextPointers-&gt;IntegerContext[18] = ContextRecord-&gt;Gpr18;
00293         *ContextPointers-&gt;IntegerContext[19] = ContextRecord-&gt;Gpr19;
00294         *ContextPointers-&gt;IntegerContext[20] = ContextRecord-&gt;Gpr20;
00295         *ContextPointers-&gt;IntegerContext[21] = ContextRecord-&gt;Gpr21;
00296         *ContextPointers-&gt;IntegerContext[22] = ContextRecord-&gt;Gpr22;
00297         *ContextPointers-&gt;IntegerContext[23] = ContextRecord-&gt;Gpr23;
00298         *ContextPointers-&gt;IntegerContext[24] = ContextRecord-&gt;Gpr24;
00299         *ContextPointers-&gt;IntegerContext[25] = ContextRecord-&gt;Gpr25;
00300         *ContextPointers-&gt;IntegerContext[26] = ContextRecord-&gt;Gpr26;
00301         *ContextPointers-&gt;IntegerContext[27] = ContextRecord-&gt;Gpr27;
00302         *ContextPointers-&gt;IntegerContext[28] = ContextRecord-&gt;Gpr28;
00303         *ContextPointers-&gt;IntegerContext[29] = ContextRecord-&gt;Gpr29;
00304         *ContextPointers-&gt;IntegerContext[30] = ContextRecord-&gt;Gpr30;
00305         *ContextPointers-&gt;IntegerContext[31] = ContextRecord-&gt;Gpr31;
00306 
00307         <span class="comment">//</span>
00308         <span class="comment">// Copy the Condition Reg and Fixed Point Exception Reg</span>
00309         <span class="comment">//</span>
00310 
00311         TrapFrame-&gt;Cr = ContextRecord-&gt;Cr;
00312         TrapFrame-&gt;Xer = ContextRecord-&gt;Xer;
00313     }
00314 
00315     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) ==
00316          <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) {
00317 
00318         <span class="comment">//</span>
00319         <span class="comment">// Volatile floating point regs are 0..13</span>
00320         <span class="comment">//</span>
00321 
00322         RtlMoveMemory(&amp;TrapFrame-&gt;Fpr0, &amp;ContextRecord-&gt;Fpr0,
00323                      <span class="keyword">sizeof</span>(DOUBLE) * (14));
00324 
00325         <span class="comment">//</span>
00326         <span class="comment">// Non-volatile floating point regs are 14..31</span>
00327         <span class="comment">//</span>
00328 
00329         *ContextPointers-&gt;FloatingContext[14] = ContextRecord-&gt;Fpr14;
00330         *ContextPointers-&gt;FloatingContext[15] = ContextRecord-&gt;Fpr15;
00331         *ContextPointers-&gt;FloatingContext[16] = ContextRecord-&gt;Fpr16;
00332         *ContextPointers-&gt;FloatingContext[17] = ContextRecord-&gt;Fpr17;
00333         *ContextPointers-&gt;FloatingContext[18] = ContextRecord-&gt;Fpr18;
00334         *ContextPointers-&gt;FloatingContext[19] = ContextRecord-&gt;Fpr19;
00335         *ContextPointers-&gt;FloatingContext[20] = ContextRecord-&gt;Fpr20;
00336         *ContextPointers-&gt;FloatingContext[21] = ContextRecord-&gt;Fpr21;
00337         *ContextPointers-&gt;FloatingContext[22] = ContextRecord-&gt;Fpr22;
00338         *ContextPointers-&gt;FloatingContext[23] = ContextRecord-&gt;Fpr23;
00339         *ContextPointers-&gt;FloatingContext[24] = ContextRecord-&gt;Fpr24;
00340         *ContextPointers-&gt;FloatingContext[25] = ContextRecord-&gt;Fpr25;
00341         *ContextPointers-&gt;FloatingContext[26] = ContextRecord-&gt;Fpr26;
00342         *ContextPointers-&gt;FloatingContext[27] = ContextRecord-&gt;Fpr27;
00343         *ContextPointers-&gt;FloatingContext[28] = ContextRecord-&gt;Fpr28;
00344         *ContextPointers-&gt;FloatingContext[29] = ContextRecord-&gt;Fpr29;
00345         *ContextPointers-&gt;FloatingContext[30] = ContextRecord-&gt;Fpr30;
00346         *ContextPointers-&gt;FloatingContext[31] = ContextRecord-&gt;Fpr31;
00347 
00348         <span class="comment">//</span>
00349         <span class="comment">// Set floating point status and control register.</span>
00350         <span class="comment">//</span>
00351 
00352         TrapFrame-&gt;Fpscr = SANITIZE_FPSCR(ContextRecord-&gt;Fpscr, ProcessorMode);
00353     }
00354 
00355     <span class="comment">//</span>
00356     <span class="comment">// Set debug register state if specified.  If previous mode is user</span>
00357     <span class="comment">// mode (i.e. it's a user frame we're setting) and if effect will be to</span>
00358     <span class="comment">// cause at least one of the debug register enable bits in Dr7</span>
00359     <span class="comment">// to be set then set DebugActive to the enable bit mask.</span>
00360     <span class="comment">//</span>
00361 
00362     <span class="keywordflow">if</span> ((ContextRecord-&gt;ContextFlags &amp; CONTEXT_DEBUG_REGISTERS) ==
00363          CONTEXT_DEBUG_REGISTERS) {
00364 
00365         <span class="comment">//</span>
00366         <span class="comment">// Set the debug control register for the 601 and 604</span>
00367         <span class="comment">// indicating the number of address breakpoints supported.</span>
00368         <span class="comment">//</span>
00369         TrapFrame-&gt;Dr0 = SANITIZE_DRADDR(ContextRecord-&gt;Dr0, ProcessorMode);
00370         TrapFrame-&gt;Dr1 = SANITIZE_DRADDR(ContextRecord-&gt;Dr1, ProcessorMode);
00371         TrapFrame-&gt;Dr2 = SANITIZE_DRADDR(ContextRecord-&gt;Dr2, ProcessorMode);
00372         TrapFrame-&gt;Dr3 = SANITIZE_DRADDR(ContextRecord-&gt;Dr3, ProcessorMode);
00373         TrapFrame-&gt;Dr6 = SANITIZE_DR6(ContextRecord-&gt;Dr6, ProcessorMode);
00374         TrapFrame-&gt;Dr7 = SANITIZE_DR7(ContextRecord-&gt;Dr7, ProcessorMode);
00375 
00376         <span class="keywordflow">if</span> (ProcessorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00377               <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a1">KeGetPcr</a>()-&gt;DebugActive = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;DebugActive =
00378                                         (UCHAR)(TrapFrame-&gt;Dr7 &amp; DR7_ACTIVE);
00379         }
00380     }
00381 
00382     <span class="keywordflow">return</span>;
00383 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="psctxppc.c::KiBreakPoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d7/d0/psctxppc_8c.html#a1">KiBreakPoints</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00028">28</a> of file <a class="el" href="../../d8/d9/psctxppc_8c-source.html">psctxppc.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">KeContextFromKframes()</a>, and <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00031">PspGetContext()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:23 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
