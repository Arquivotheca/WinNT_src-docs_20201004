<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lb1.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lb1.c</h1><a href="../../d6/d1/lb1_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ********************************\</span>
00002 <span class="comment">* Module Name: lb1.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* ListBox routines</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* ??-???-???? ianja    Ported from Win 3.0 sources</span>
00010 <span class="comment">* 14-Feb-1991 mikeke   Added Revalidation code</span>
00011 <span class="comment">\*****************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
<a name="l00016"></a><a class="code" href="../../d6/d1/lb1_8c.html#a0">00016</a> <a class="code" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a> <a class="code" href="../../d6/d1/lb1_8c.html#a0">ListboxLookaside</a>;
00017 
00018 
00019 <span class="comment">/***************************************************************************\</span>
00020 <span class="comment">* xxxLBoxCtlWndProc</span>
00021 <span class="comment">*</span>
00022 <span class="comment">* Window Procedure for ListBox AND ComboLBox control.</span>
00023 <span class="comment">* NOTE: All window procedures are APIENTRY</span>
00024 <span class="comment">* WARNING: This listbox code contains some internal messages and styles which</span>
00025 <span class="comment">* are defined in combcom.h and in combcom.inc.  They may be redefined</span>
00026 <span class="comment">* (or renumbered) as needed to extend the windows API.</span>
00027 <span class="comment">*</span>
00028 <span class="comment">* History:</span>
00029 <span class="comment">* 16-Apr-1992 beng      Added LB_SETCOUNT</span>
00030 <span class="comment">\***************************************************************************/</span>
00031 
<a name="l00032"></a><a class="code" href="../../d6/d0/usercli_8h.html#a612">00032</a> LRESULT <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a> <a class="code" href="../../d6/d0/usercli_8h.html#a612">ListBoxWndProcWorker</a>(
00033     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00034     UINT message,
00035     WPARAM wParam,
00036     LPARAM lParam,
00037     DWORD fAnsi)
00038 {
00039     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00040     PAINTSTRUCT ps;
00041     HDC         hdc;
00042     LPRECT      lprc;
00043     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb;    <span class="comment">/* List Box Instance Variable */</span>
00044     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> iSel;     <span class="comment">/* Index of selected item */</span>
00045     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dw;
00046     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
00047     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wFlags;
00048     LPWSTR lpwsz = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00049     LRESULT lReturn = 0;
00050     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fInit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00051 
00052     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00053 
00054     <a class="code" href="../../d6/d0/usercli_8h.html#a28">VALIDATECLASSANDSIZE</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>);
00055     <a class="code" href="../../d6/d0/usercli_8h.html#a29">INITCONTROLLOOKASIDE</a>(&amp;<a class="code" href="../../d6/d1/lb1_8c.html#a0">ListboxLookaside</a>, <a class="code" href="../../d7/d9/structtagLBIV.html">LBIV</a>, spwnd, 4);
00056 
00057     <span class="comment">/*</span>
00058 <span class="comment">     * Get the plb for the given window now since we will use it a lot in</span>
00059 <span class="comment">     * various handlers. This was stored using SetWindowLong(hwnd,0,plb)</span>
00060 <span class="comment">     * when the listbox was first created (by INITCONTROLLOOKASIDE above)</span>
00061 <span class="comment">     */</span>
00062     plb = ((<a class="code" href="../../d9/d9/structtagLBWND.html">PLBWND</a>)pwnd)-&gt;pLBIV;
00063 
00064     <span class="comment">/*</span>
00065 <span class="comment">     * Handle ANSI translations of input parameters</span>
00066 <span class="comment">     */</span>
00067     <span class="keywordflow">if</span> (fAnsi) {
00068         <span class="keywordflow">switch</span> (message) {
00069         <span class="keywordflow">case</span> LB_ADDSTRING:
00070         <span class="keywordflow">case</span> LB_ADDSTRINGUPPER:
00071         <span class="keywordflow">case</span> LB_ADDSTRINGLOWER:
00072         <span class="keywordflow">case</span> LB_FINDSTRING:
00073         <span class="keywordflow">case</span> LB_FINDSTRINGEXACT:
00074         <span class="keywordflow">case</span> LB_INSERTSTRING:
00075         <span class="keywordflow">case</span> LB_INSERTSTRINGUPPER:
00076         <span class="keywordflow">case</span> LB_INSERTSTRINGLOWER:
00077         <span class="keywordflow">case</span> LB_SELECTSTRING:
00078             <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o30">fHasStrings</a>) {
00079                 <span class="keywordflow">break</span>;
00080             }
00081             <span class="comment">// Fall through...</span>
00082         <span class="keywordflow">case</span> LB_ADDFILE:
00083         <span class="keywordflow">case</span> LB_DIR:
00084             <span class="keywordflow">if</span> (lParam) {
00085                 <span class="keywordflow">if</span> (!MBToWCS((LPSTR)lParam, -1, &amp;lpwsz, -1, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>))
00086                     <span class="keywordflow">return</span> LB_ERR;
00087             }
00088             <span class="keywordflow">break</span>;
00089         <span class="keywordflow">default</span>:
00090             <span class="keywordflow">break</span>;
00091         }
00092         <span class="keywordflow">if</span> (lpwsz) {
00093             lParam = (LPARAM)lpwsz;
00094         }
00095     }
00096 
00097     <span class="keywordflow">switch</span> (message) {
00098 
00099     <span class="keywordflow">case</span> LB_GETTOPINDEX:        <span class="comment">// Return index of top item displayed.</span>
00100         <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a>;
00101 
00102     <span class="keywordflow">case</span> LB_SETTOPINDEX:
00103         <span class="keywordflow">if</span> (wParam &amp;&amp; ((<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam &lt; 0 || (INT)wParam &gt;= plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>)) {
00104             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00105             <span class="keywordflow">return</span> LB_ERR;
00106         }
00107         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>) {
00108             <a class="code" href="../../d6/d0/usercli_8h.html#a730">xxxNewITop</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam);
00109         }
00110         <span class="keywordflow">break</span>;
00111 
00112     <span class="keywordflow">case</span> WM_STYLECHANGED:
00113         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o48">fRtoLReading</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>) != 0);
00114         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o47">fRightAlign</a>  = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a624">WEFRIGHT</a>) != 0);
00115         <a class="code" href="../../d6/d0/usercli_8h.html#a714">xxxCheckRedraw</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, 0);
00116         <span class="keywordflow">break</span>;
00117 
00118     <span class="keywordflow">case</span> WM_WINDOWPOSCHANGED:
00119 
00120         <span class="comment">/*</span>
00121 <span class="comment">         * If we are in the middle of creation, ignore this</span>
00122 <span class="comment">         * message because it will generate a WM_SIZE message.</span>
00123 <span class="comment">         * See xxxLBCreate().</span>
00124 <span class="comment">         */</span>
00125         <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o45">fIgnoreSizeMsg</a>)
00126             <span class="keywordflow">goto</span> CallDWP;
00127         <span class="keywordflow">break</span>;
00128 
00129     <span class="keywordflow">case</span> WM_SIZE:
00130 
00131         <span class="comment">/*</span>
00132 <span class="comment">         * If we are in the middle of creation, ignore size</span>
00133 <span class="comment">         * messages.  See xxxLBCreate().</span>
00134 <span class="comment">         */</span>
00135         <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o45">fIgnoreSizeMsg</a>)
00136             <a class="code" href="../../d6/d0/usercli_8h.html#a726">xxxLBSize</a>(plb, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lParam), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lParam));
00137         <span class="keywordflow">break</span>;
00138 
00139     <span class="keywordflow">case</span> WM_ERASEBKGND:
00140         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>, &amp;tlpwndParent);
00141         <a class="code" href="../../d6/d0/usercli_8h.html#a234">FillWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>), hwnd, (HDC)wParam,
00142                 (HBRUSH)CTLCOLOR_LISTBOX);
00143         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00144         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00145 
00146     <span class="keywordflow">case</span> LB_RESETCONTENT:
00147         <a class="code" href="../../d6/d0/usercli_8h.html#a737">xxxLBResetContent</a>(plb);
00148         <span class="keywordflow">break</span>;
00149 
00150     <span class="keywordflow">case</span> WM_TIMER:
00151         <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a52">IDSYS_LBSEARCH</a>) {
00152             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o61">iTypeSearch</a> = 0;
00153             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a208">NtUserKillTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a52">IDSYS_LBSEARCH</a>);
00154             <a class="code" href="../../d6/d0/usercli_8h.html#a717">xxxInvertLBItem</a>(plb, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00155             <span class="keywordflow">break</span>;
00156         }
00157 
00158         message = WM_MOUSEMOVE;
00159         <a class="code" href="../../d6/d0/usercli_8h.html#a734">xxxTrackMouse</a>(plb, message, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o17">ptPrev</a>);
00160         <span class="keywordflow">break</span>;
00161 
00162         <span class="comment">/*</span>
00163 <span class="comment">         * Fall through</span>
00164 <span class="comment">         */</span>
00165     <span class="keywordflow">case</span> WM_MOUSEMOVE:
00166     <span class="keywordflow">case</span> WM_LBUTTONDOWN:
00167     <span class="keywordflow">case</span> WM_LBUTTONUP:
00168     <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
00169         {
00170             POINT pt;
00171 
00172             POINTSTOPOINT(pt, lParam);
00173             <a class="code" href="../../d6/d0/usercli_8h.html#a734">xxxTrackMouse</a>(plb, message, pt);
00174         }
00175         <span class="keywordflow">break</span>;
00176 
00177     <span class="keywordflow">case</span> WM_MBUTTONDOWN:
00178         <a class="code" href="../../d6/d0/usercli_8h.html#a782">EnterReaderModeHelper</a>(hwnd);
00179         <span class="keywordflow">break</span>;
00180 
00181     <span class="keywordflow">case</span> WM_CAPTURECHANGED:
00182             <span class="comment">//</span>
00183             <span class="comment">// Note that this message should be handled only on unexpected</span>
00184             <span class="comment">// capture changes currently.</span>
00185             <span class="comment">//</span>
00186         UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>));
00187         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o25">fCaptured</a>)
00188             <a class="code" href="../../d6/d0/usercli_8h.html#a740">xxxLBButtonUp</a>(plb, <a class="code" href="../../d6/d0/usercli_8h.html#a120">LBUP_NOTIFY</a>);
00189         <span class="keywordflow">break</span>;
00190 
00191     <span class="keywordflow">case</span> LBCB_STARTTRACK:
00192         <span class="comment">//</span>
00193         <span class="comment">// Start tracking mouse moves in the listbox, setting capture</span>
00194         <span class="comment">//</span>
00195         <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o58">pcbox</a>)
00196             <span class="keywordflow">break</span>;
00197 
00198         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o25">fCaptured</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00199         <span class="keywordflow">if</span> (wParam) {
00200             POINT pt;
00201 
00202             POINTSTOPOINT(pt, lParam);
00203 
00204             <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a21">_ScreenToClient</a>(pwnd, &amp;pt);
00205             <a class="code" href="../../d6/d0/usercli_8h.html#a734">xxxTrackMouse</a>(plb, WM_LBUTTONDOWN, pt);
00206         } <span class="keywordflow">else</span> {
00207             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a221">NtUserSetCapture</a>(hwnd);
00208             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o25">fCaptured</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00209             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o51">iLastSelection</a> = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a>;
00210         }
00211         <span class="keywordflow">break</span>;
00212 
00213     <span class="keywordflow">case</span> LBCB_ENDTRACK:
00214         <span class="comment">// Kill capture, tracking, etc.</span>
00215         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o25">fCaptured</a>)
00216             <a class="code" href="../../d6/d0/usercli_8h.html#a740">xxxLBButtonUp</a>(plb, <a class="code" href="../../d6/d0/usercli_8h.html#a118">LBUP_RELEASECAPTURE</a> | (wParam ? <a class="code" href="../../d6/d0/usercli_8h.html#a122">LBUP_SELCHANGE</a> :
00217                 <a class="code" href="../../d6/d0/usercli_8h.html#a119">LBUP_RESETSELECTION</a>));
00218         <span class="keywordflow">break</span>;
00219 
00220     <span class="keywordflow">case</span> WM_PRINTCLIENT:
00221         <a class="code" href="../../d6/d0/usercli_8h.html#a710">xxxLBPaint</a>(plb, (HDC) wParam, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00222         <span class="keywordflow">break</span>;
00223 
00224     <span class="keywordflow">case</span> WM_PAINT:
00225         <span class="keywordflow">if</span> (wParam) {
00226             hdc = (HDC) wParam;
00227             lprc = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00228         } <span class="keywordflow">else</span> {
00229             hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a246">NtUserBeginPaint</a>(hwnd, &amp;ps);
00230             lprc = &amp;(ps.rcPaint);
00231         }
00232 
00233         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a108">IsLBoxVisible</a>(plb))
00234             <a class="code" href="../../d6/d0/usercli_8h.html#a710">xxxLBPaint</a>(plb, hdc, lprc);
00235 
00236         <span class="keywordflow">if</span> (!wParam)
00237             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a248">NtUserEndPaint</a>(hwnd, &amp;ps);
00238         <span class="keywordflow">break</span>;
00239 
00240     <span class="keywordflow">case</span> WM_NCDESTROY:
00241     <span class="keywordflow">case</span> WM_FINALDESTROY:
00242         <a class="code" href="../../d6/d0/usercli_8h.html#a698">xxxDestroyLBox</a>(plb, pwnd);
00243         <span class="keywordflow">break</span>;
00244 
00245     <span class="keywordflow">case</span> WM_SETFOCUS:
00246 <span class="comment">// DISABLED in Win 3.1        xxxUpdateWindow(pwnd);</span>
00247         <a class="code" href="../../d6/d0/usercli_8h.html#a66">CaretCreate</a>(plb);
00248         <a class="code" href="../../d6/d0/usercli_8h.html#a695">xxxLBSetCaret</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00249         <a class="code" href="../../d6/d0/usercli_8h.html#a732">xxxNotifyOwner</a>(plb, LBN_SETFOCUS);
00250         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00251             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(pwnd)) {
00252                 <a class="code" href="../../d6/d0/usercli_8h.html#a409">LBEvent</a>(plb, EVENT_OBJECT_FOCUS, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a>);
00253             }
00254         }
00255         <span class="keywordflow">break</span>;
00256 
00257     <span class="keywordflow">case</span> WM_KILLFOCUS:
00258         <span class="comment">/*</span>
00259 <span class="comment">         * Reset the wheel delta count.</span>
00260 <span class="comment">         */</span>
00261         <a class="code" href="../../d1/d8/clglobal_8c.html#a1">gcWheelDelta</a> = 0;
00262 
00263         <a class="code" href="../../d6/d0/usercli_8h.html#a695">xxxLBSetCaret</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00264         <a class="code" href="../../d6/d0/usercli_8h.html#a696">xxxCaretDestroy</a>(plb);
00265         <a class="code" href="../../d6/d0/usercli_8h.html#a732">xxxNotifyOwner</a>(plb, LBN_KILLFOCUS);
00266         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o61">iTypeSearch</a>) {
00267             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o61">iTypeSearch</a> = 0;
00268             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a208">NtUserKillTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a52">IDSYS_LBSEARCH</a>);
00269         }
00270         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o62">pszTypeSearch</a>) {
00271             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o62">pszTypeSearch</a>);
00272             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o62">pszTypeSearch</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00273         }
00274         <span class="keywordflow">break</span>;
00275 
00276     <span class="keywordflow">case</span> WM_MOUSEWHEEL:
00277         {
00278             <span class="keywordtype">int</span>     cDetants;
00279             <span class="keywordtype">int</span>     cPage;
00280             <span class="keywordtype">int</span>     cLines;
00281             RECT    rc;
00282             <span class="keywordtype">int</span>     windowWidth;
00283             <span class="keywordtype">int</span>     cPos;
00284 
00285             <span class="comment">/*</span>
00286 <span class="comment">             * Don't handle zoom and datazoom.</span>
00287 <span class="comment">             */</span>
00288             <span class="keywordflow">if</span> (wParam &amp; (MK_SHIFT | MK_CONTROL)) {
00289                 <span class="keywordflow">goto</span> CallDWP;
00290             }
00291 
00292             lReturn = 1;
00293             <a class="code" href="../../d1/d8/clglobal_8c.html#a1">gcWheelDelta</a> -= (<span class="keywordtype">short</span>) HIWORD(wParam);
00294             cDetants = <a class="code" href="../../d1/d8/clglobal_8c.html#a1">gcWheelDelta</a> / WHEEL_DELTA;
00295             <span class="keywordflow">if</span> (    cDetants != 0 &amp;&amp;
00296                     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ucWheelScrollLines &gt; 0 &amp;&amp;
00297                     (pwnd-&gt;style &amp; (WS_VSCROLL | WS_HSCROLL))) {
00298 
00299                 <a class="code" href="../../d1/d8/clglobal_8c.html#a1">gcWheelDelta</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a1">gcWheelDelta</a> % WHEEL_DELTA;
00300 
00301                 <span class="keywordflow">if</span> (pwnd-&gt;style &amp; WS_VSCROLL) {
00302                     cPage = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(1, (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a> - 1));
00303                     cLines = cDetants *
00304                             (<span class="keywordtype">int</span>) <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) cPage, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ucWheelScrollLines);
00305 
00306                     cPos = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0, <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a> + cLines, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> - 1));
00307                     <span class="keywordflow">if</span> (cPos != plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a>) {
00308                         <a class="code" href="../../d6/d0/usercli_8h.html#a705">xxxLBoxCtlScroll</a>(plb, SB_THUMBPOSITION, cPos);
00309                         <a class="code" href="../../d6/d0/usercli_8h.html#a705">xxxLBoxCtlScroll</a>(plb, SB_ENDSCROLL, 0);
00310                     }
00311                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00312                     cPage = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(1, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o16">numberOfColumns</a>);
00313                     cLines = cDetants * (<span class="keywordtype">int</span>) <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) cPage, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ucWheelScrollLines);
00314                     cPos = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(
00315                             0,
00316                             <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a> / plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o15">itemsPerColumn</a>) + cLines,
00317                                 plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> - 1 - ((plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> - 1) % plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o15">itemsPerColumn</a>)));
00318 
00319                     <span class="keywordflow">if</span> (cPos != plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a>) {
00320                         <a class="code" href="../../d6/d0/usercli_8h.html#a704">xxxLBoxCtlHScrollMultiColumn</a>(plb, SB_THUMBPOSITION, cPos);
00321                         <a class="code" href="../../d6/d0/usercli_8h.html#a704">xxxLBoxCtlHScrollMultiColumn</a>(plb, SB_ENDSCROLL, 0);
00322                     }
00323                 } <span class="keywordflow">else</span> {
00324                     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>, &amp;rc);
00325                     windowWidth = rc.right;
00326                     cPage = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a>, (windowWidth / 3) * 2) /
00327                             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a>;
00328 
00329                     cLines = cDetants *
00330                             (<span class="keywordtype">int</span>) <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) cPage, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ucWheelScrollLines);
00331 
00332                     cPos = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(
00333                             0,
00334                             <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o56">xOrigin</a> + (cLines * plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a>),
00335                                 plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o57">maxWidth</a>));
00336 
00337                     <span class="keywordflow">if</span> (cPos != plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o56">xOrigin</a>) {
00338                         <a class="code" href="../../d6/d0/usercli_8h.html#a703">xxxLBoxCtlHScroll</a>(plb, SB_THUMBPOSITION, cPos);
00339                         <a class="code" href="../../d6/d0/usercli_8h.html#a703">xxxLBoxCtlHScroll</a>(plb, SB_ENDSCROLL, 0);
00340                     }
00341                 }
00342             }
00343         }
00344         <span class="keywordflow">break</span>;
00345 
00346     <span class="keywordflow">case</span> WM_VSCROLL:
00347         <a class="code" href="../../d6/d0/usercli_8h.html#a705">xxxLBoxCtlScroll</a>(plb, LOWORD(wParam), HIWORD(wParam));
00348         <span class="keywordflow">break</span>;
00349 
00350     <span class="keywordflow">case</span> WM_HSCROLL:
00351         <a class="code" href="../../d6/d0/usercli_8h.html#a703">xxxLBoxCtlHScroll</a>(plb, LOWORD(wParam), HIWORD(wParam));
00352         <span class="keywordflow">break</span>;
00353 
00354     <span class="keywordflow">case</span> WM_GETDLGCODE:
00355         <span class="keywordflow">return</span> DLGC_WANTARROWS | DLGC_WANTCHARS;
00356 
00357     <span class="keywordflow">case</span> WM_CREATE:
00358         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a697">xxxLBCreate</a>(plb, pwnd, (LPCREATESTRUCT) lParam);
00359 
00360     <span class="keywordflow">case</span> WM_SETREDRAW:
00361 
00362         <span class="comment">/*</span>
00363 <span class="comment">         * If wParam is nonzero, the redraw flag is set</span>
00364 <span class="comment">         * If wParam is zero, the flag is cleared</span>
00365 <span class="comment">         */</span>
00366         <a class="code" href="../../d6/d0/usercli_8h.html#a738">xxxLBSetRedraw</a>(plb, (wParam != 0));
00367         <span class="keywordflow">break</span>;
00368 
00369     <span class="keywordflow">case</span> WM_ENABLE:
00370         <a class="code" href="../../d6/d0/usercli_8h.html#a711">xxxLBInvalidateRect</a>(plb, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, !plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a>);
00371         <span class="keywordflow">break</span>;
00372 
00373     <span class="keywordflow">case</span> WM_SETFONT:
00374         <a class="code" href="../../d6/d0/usercli_8h.html#a723">xxxLBSetFont</a>(plb, (HANDLE)wParam, LOWORD(lParam));
00375         <span class="keywordflow">break</span>;
00376 
00377     <span class="keywordflow">case</span> WM_GETFONT:
00378         <span class="keywordflow">return</span> (LRESULT)plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o55">hFont</a>;
00379 
00380     <span class="keywordflow">case</span> WM_DRAGSELECT:
00381     <span class="keywordflow">case</span> WM_DRAGLOOP:
00382     <span class="keywordflow">case</span> WM_DRAGMOVE:
00383     <span class="keywordflow">case</span> WM_DROPFILES:
00384         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>, &amp;tlpwndParent);
00385         lReturn = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>), message, wParam, lParam);
00386         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00387         <span class="keywordflow">return</span> lReturn;
00388 
00389 
00390     <span class="keywordflow">case</span> WM_QUERYDROPOBJECT:
00391     <span class="keywordflow">case</span> WM_DROPOBJECT:
00392 
00393         <span class="comment">/*</span>
00394 <span class="comment">         * fix up control data, then pass message to parent</span>
00395 <span class="comment">         */</span>
00396         <a class="code" href="../../d6/d0/usercli_8h.html#a720">LBDropObjectHandler</a>(plb, (PDROPSTRUCT)lParam);
00397         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>, &amp;tlpwndParent);
00398         lReturn = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>), message, wParam, lParam);
00399         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00400         <span class="keywordflow">return</span> lReturn;
00401 
00402     <span class="keywordflow">case</span> LB_GETITEMRECT:
00403         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a744">LBGetItemRect</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (LPRECT)lParam);
00404 
00405     <span class="keywordflow">case</span> LB_GETITEMDATA:
00406         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a721">LBGetItemData</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam);  <span class="comment">// wParam = item index</span>
00407 
00408     <span class="keywordflow">case</span> LB_SETITEMDATA:
00409 
00410         <span class="comment">/*</span>
00411 <span class="comment">         * wParam is item index</span>
00412 <span class="comment">         */</span>
00413         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a724">LBSetItemData</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, lParam);
00414 
00415     <span class="keywordflow">case</span> LB_ADDSTRINGUPPER:
00416         wFlags = <a class="code" href="../../d6/d0/usercli_8h.html#a64">UPPERCASE</a> | <a class="code" href="../../d6/d0/usercli_8h.html#a117">LBI_ADD</a>;
00417         <span class="keywordflow">goto</span> CallInsertItem;
00418 
00419     <span class="keywordflow">case</span> LB_ADDSTRINGLOWER:
00420         wFlags = <a class="code" href="../../d6/d0/usercli_8h.html#a65">LOWERCASE</a> | <a class="code" href="../../d6/d0/usercli_8h.html#a117">LBI_ADD</a>;
00421         <span class="keywordflow">goto</span> CallInsertItem;
00422 
00423     <span class="keywordflow">case</span> LB_ADDSTRING:
00424         wFlags = <a class="code" href="../../d6/d0/usercli_8h.html#a117">LBI_ADD</a>;
00425         <span class="keywordflow">goto</span> CallInsertItem;
00426 
00427     <span class="keywordflow">case</span> LB_INSERTSTRINGUPPER:
00428         wFlags = <a class="code" href="../../d6/d0/usercli_8h.html#a64">UPPERCASE</a>;
00429         <span class="keywordflow">goto</span> CallInsertItem;
00430 
00431     <span class="keywordflow">case</span> LB_INSERTSTRINGLOWER:
00432         wFlags = <a class="code" href="../../d6/d0/usercli_8h.html#a65">LOWERCASE</a>;
00433         <span class="keywordflow">goto</span> CallInsertItem;
00434 
00435     <span class="keywordflow">case</span> LB_INSERTSTRING:
00436         wFlags = 0;
00437 CallInsertItem:
00438         lReturn = ((LRESULT) <a class="code" href="../../d6/d0/usercli_8h.html#a685">xxxLBInsertItem</a>(plb, (LPWSTR) lParam, (<span class="keywordtype">int</span>) wParam, wFlags));
00439         <span class="keywordflow">break</span>;
00440 
00441     <span class="keywordflow">case</span> LB_INITSTORAGE:
00442         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a749">xxxLBInitStorage</a>(plb, fAnsi, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)lParam);
00443 
00444     <span class="keywordflow">case</span> LB_DELETESTRING:
00445         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a707">xxxLBoxCtlDelete</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam);
00446 
00447     <span class="keywordflow">case</span> LB_DIR:
00448         <span class="comment">/*</span>
00449 <span class="comment">         * wParam - Dos attribute value.</span>
00450 <span class="comment">         * lParam - Points to a file specification string</span>
00451 <span class="comment">         */</span>
00452         lReturn = <a class="code" href="../../d6/d0/usercli_8h.html#a728">xxxLbDir</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (LPWSTR)lParam);
00453         <span class="keywordflow">break</span>;
00454 
00455     <span class="keywordflow">case</span> LB_ADDFILE:
00456         lReturn = <a class="code" href="../../d6/d0/usercli_8h.html#a729">xxxLbInsertFile</a>(plb, (LPWSTR)lParam);
00457         <span class="keywordflow">break</span>;
00458 
00459     <span class="keywordflow">case</span> LB_SETSEL:
00460         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a692">xxxLBSetSel</a>(plb, (wParam != 0), (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)lParam);
00461 
00462     <span class="keywordflow">case</span> LB_SETCURSEL:
00463         <span class="comment">/*</span>
00464 <span class="comment">         * If window obscured, update so invert will work correctly</span>
00465 <span class="comment">         */</span>
00466 <span class="comment">// DISABLED in Win 3.1        xxxUpdateWindow(pwnd);</span>
00467         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a690">xxxLBSetCurSel</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam);
00468 
00469     <span class="keywordflow">case</span> LB_GETSEL:
00470         <span class="keywordflow">if</span> (wParam &gt;= (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>)
00471                 <span class="keywordflow">return</span>((LRESULT) LB_ERR);
00472 
00473         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a687">IsSelected</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, <a class="code" href="../../d6/d0/usercli_8h.html#a249">SELONLY</a>);
00474 
00475     <span class="keywordflow">case</span> LB_GETCURSEL:
00476         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>) {
00477             <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a>;
00478         }
00479         <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a>;
00480 
00481     <span class="keywordflow">case</span> LB_SELITEMRANGE:
00482         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>) {
00483             <span class="comment">/*</span>
00484 <span class="comment">             * Can't select a range if only single selections are enabled</span>
00485 <span class="comment">             */</span>
00486             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE,<span class="stringliteral">"Invalid index passed to LB_SELITEMRANGE"</span>);
00487             <span class="keywordflow">return</span> LB_ERR;
00488         }
00489 
00490         <a class="code" href="../../d6/d0/usercli_8h.html#a689">xxxLBSelRange</a>(plb, LOWORD(lParam), HIWORD(lParam), (wParam != 0));
00491         <span class="keywordflow">break</span>;
00492 
00493     <span class="keywordflow">case</span> LB_SELITEMRANGEEX:
00494         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>) {
00495             <span class="comment">/*</span>
00496 <span class="comment">             * Can't select a range if only single selections are enabled</span>
00497 <span class="comment">             */</span>
00498             RIPERR0(ERROR_INVALID_LB_MESSAGE, RIP_VERBOSE,<span class="stringliteral">"LB_SELITEMRANGEEX:Can't select a range if only single selections are enabled"</span>);
00499             <span class="keywordflow">return</span> LB_ERR;
00500         } <span class="keywordflow">else</span> {
00501             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fHighlight = ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)lParam &gt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)wParam);
00502             <span class="keywordflow">if</span> (fHighlight == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00503                 ULONG_PTR temp = lParam;
00504                 lParam = wParam;
00505                 wParam = temp;
00506             }
00507             <a class="code" href="../../d6/d0/usercli_8h.html#a689">xxxLBSelRange</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)lParam, fHighlight);
00508         }
00509         <span class="keywordflow">break</span>;
00510 
00511     <span class="keywordflow">case</span> LB_GETTEXTLEN:
00512         <span class="keywordflow">if</span> (lParam != 0) {
00513             RIPMSG1(RIP_WARNING, <span class="stringliteral">"LB_GETTEXTLEN with lParam = %lx\n"</span>, lParam);
00514         }
00515         lReturn = <a class="code" href="../../d6/d0/usercli_8h.html#a722">LBGetText</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, fAnsi, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00516         <span class="keywordflow">break</span>;
00517 
00518     <span class="keywordflow">case</span> LB_GETTEXT:
00519         lReturn = <a class="code" href="../../d6/d0/usercli_8h.html#a722">LBGetText</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, fAnsi, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (LPWSTR)lParam);
00520         <span class="keywordflow">break</span>;
00521 
00522     <span class="keywordflow">case</span> LB_GETCOUNT:
00523         <span class="comment">// Lotus Approach calls CallWndProc(ListWndProc, LB_GETCOUNT,...)</span>
00524         <span class="comment">// on a window that doesn't have a plb yet. So, we need to make</span>
00525         <span class="comment">// this check. Bug #6675 - 11/7/94 --</span>
00526         <span class="keywordflow">if</span>(plb)
00527             <span class="keywordflow">return</span>((LRESULT) plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>);
00528         <span class="keywordflow">else</span>
00529             <span class="keywordflow">return</span>(0);
00530 
00531     <span class="keywordflow">case</span> LB_SETCOUNT:
00532         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a747">xxxLBSetCount</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam);
00533 
00534     <span class="keywordflow">case</span> LB_SELECTSTRING:
00535     <span class="keywordflow">case</span> LB_FINDSTRING:
00536         iSel = <a class="code" href="../../d6/d0/usercli_8h.html#a683">xxxFindString</a>(plb, (LPWSTR)lParam, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, <a class="code" href="../../d6/d0/usercli_8h.html#a111">PREFIX</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00537         <span class="keywordflow">if</span> (message == LB_FINDSTRING || iSel == LB_ERR) {
00538             lReturn = iSel;
00539         } <span class="keywordflow">else</span> {
00540             lReturn = <a class="code" href="../../d6/d0/usercli_8h.html#a690">xxxLBSetCurSel</a>(plb, iSel);
00541         }
00542         <span class="keywordflow">break</span>;
00543 
00544     <span class="keywordflow">case</span> LB_GETLOCALE:
00545         <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o60">dwLocaleId</a>;
00546 
00547     <span class="keywordflow">case</span> LB_SETLOCALE:
00548 
00549         <span class="comment">/*</span>
00550 <span class="comment">         * Validate locale</span>
00551 <span class="comment">         */</span>
00552         wParam = ConvertDefaultLocale((LCID)wParam);
00553         <span class="keywordflow">if</span> (!IsValidLocale((LCID)wParam, LCID_INSTALLED))
00554             <span class="keywordflow">return</span> LB_ERR;
00555 
00556         dw = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o60">dwLocaleId</a>;
00557         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o60">dwLocaleId</a> = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)wParam;
00558         <span class="keywordflow">return</span> dw;
00559 
00560     <span class="keywordflow">case</span> WM_KEYDOWN:
00561 
00562         <span class="comment">/*</span>
00563 <span class="comment">         * IanJa: Use LOWORD() to get low 16-bits of wParam - this should</span>
00564 <span class="comment">         * work for Win16 &amp; Win32.  The value obtained is the virtual key</span>
00565 <span class="comment">         */</span>
00566         <a class="code" href="../../d6/d0/usercli_8h.html#a709">xxxLBoxCtlKeyInput</a>(plb, message, LOWORD(wParam));
00567         <span class="keywordflow">break</span>;
00568 
00569     <span class="keywordflow">case</span> WM_CHAR:
00570         <a class="code" href="../../d6/d0/usercli_8h.html#a708">xxxLBoxCtlCharInput</a>(plb, LOWORD(wParam), fAnsi);
00571         <span class="keywordflow">break</span>;
00572 
00573     <span class="keywordflow">case</span> LB_GETSELITEMS:
00574     <span class="keywordflow">case</span> LB_GETSELCOUNT:
00575 
00576         <span class="comment">/*</span>
00577 <span class="comment">         * IanJa/Win32 should this be LPWORD now?</span>
00578 <span class="comment">         */</span>
00579         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a691">LBoxGetSelItems</a>(plb, (message == LB_GETSELCOUNT), (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam,
00580                 (LPINT)lParam);
00581 
00582     <span class="keywordflow">case</span> LB_SETTABSTOPS:
00583 
00584         <span class="comment">/*</span>
00585 <span class="comment">         * IanJa/Win32: Tabs given by array of INT for backwards compatability</span>
00586 <span class="comment">         */</span>
00587         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a725">LBSetTabStops</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (LPINT)lParam);
00588 
00589     <span class="keywordflow">case</span> LB_GETHORIZONTALEXTENT:
00590 
00591         <span class="comment">/*</span>
00592 <span class="comment">         * Return the max width of the listbox used for horizontal scrolling</span>
00593 <span class="comment">         */</span>
00594         <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o57">maxWidth</a>;
00595 
00596     <span class="keywordflow">case</span> LB_SETHORIZONTALEXTENT:
00597 
00598         <span class="comment">/*</span>
00599 <span class="comment">         * Set the max width of the listbox used for horizontal scrolling</span>
00600 <span class="comment">         */</span>
00601         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o57">maxWidth</a> != (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam) {
00602             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o57">maxWidth</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam;
00603 
00604             <span class="comment">/*</span>
00605 <span class="comment">             * When horizontal extent is set, Show/hide the scroll bars.</span>
00606 <span class="comment">             * NOTE: LBShowHideScrollBars() takes care if Redraw is OFF.</span>
00607 <span class="comment">             * Fix for Bug #2477 -- 01/14/91 -- SANKAR --</span>
00608 <span class="comment">             */</span>
00609             <a class="code" href="../../d6/d0/usercli_8h.html#a706">xxxLBShowHideScrollBars</a>(plb); <span class="comment">//Try to show or hide scroll bars</span>
00610             <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o38">fHorzBar</a> &amp;&amp; plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o47">fRightAlign</a> &amp;&amp; !(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a> || plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a>)) {
00611                 <span class="comment">/*</span>
00612 <span class="comment">                 * origin to right</span>
00613 <span class="comment">                 */</span>
00614                 <a class="code" href="../../d6/d0/usercli_8h.html#a703">xxxLBoxCtlHScroll</a>(plb, SB_BOTTOM, 0);
00615             }
00616         }
00617         <span class="keywordflow">break</span>;    <span class="comment">/* originally returned register ax (message) ! */</span>
00618 
00619     <span class="keywordflow">case</span> LB_SETCOLUMNWIDTH:
00620 
00621         <span class="comment">/*</span>
00622 <span class="comment">         * Set the width of a column in a multicolumn listbox</span>
00623 <span class="comment">         */</span>
00624         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o14">cxColumn</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam;
00625         <a class="code" href="../../d6/d0/usercli_8h.html#a743">LBCalcItemRowsAndColumns</a>(plb);
00626         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a108">IsLBoxVisible</a>(plb))
00627             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00628         <a class="code" href="../../d6/d0/usercli_8h.html#a706">xxxLBShowHideScrollBars</a>(plb);
00629         <span class="keywordflow">break</span>;
00630 
00631     <span class="keywordflow">case</span> LB_SETANCHORINDEX:
00632         <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam &gt;= plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>) {
00633             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE,<span class="stringliteral">"Invalid index passed to LB_SETANCHORINDEX"</span>);
00634             <span class="keywordflow">return</span> LB_ERR;
00635         }
00636         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o52">iMouseDown</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam;
00637         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o53">iLastMouseMove</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam;
00638         <a class="code" href="../../d6/d0/usercli_8h.html#a716">xxxInsureVisible</a>(plb, (<span class="keywordtype">int</span>) wParam, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)(lParam != 0));
00639         <span class="keywordflow">break</span>;
00640 
00641     <span class="keywordflow">case</span> LB_GETANCHORINDEX:
00642         <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o52">iMouseDown</a>;
00643 
00644     <span class="keywordflow">case</span> LB_SETCARETINDEX:
00645         <span class="keywordflow">if</span> ( (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a> == -1) || ((plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> != <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>) &amp;&amp;
00646                     (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> &gt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam))) {
00647 
00648             <span class="comment">/*</span>
00649 <span class="comment">             * Set's the iSelBase to the wParam</span>
00650 <span class="comment">             * if lParam, then don't scroll if partially visible</span>
00651 <span class="comment">             * else scroll into view if not fully visible</span>
00652 <span class="comment">             */</span>
00653             <a class="code" href="../../d6/d0/usercli_8h.html#a716">xxxInsureVisible</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)LOWORD(lParam));
00654             <a class="code" href="../../d6/d0/usercli_8h.html#a693">xxxSetISelBase</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam);
00655             <span class="keywordflow">break</span>;
00656         } <span class="keywordflow">else</span> {
00657             <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam &gt;= plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>) {
00658                 RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE,<span class="stringliteral">"Invalid index passed to LB_SETCARETINDEX"</span>);
00659             }
00660             <span class="keywordflow">return</span> LB_ERR;
00661         }
00662         <span class="keywordflow">break</span>;
00663 
00664     <span class="keywordflow">case</span> LB_GETCARETINDEX:
00665         <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a>;
00666 
00667     <span class="keywordflow">case</span> LB_SETITEMHEIGHT:
00668     <span class="keywordflow">case</span> LB_GETITEMHEIGHT:
00669         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a719">LBGetSetItemHeightHandler</a>(plb, message, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, LOWORD(lParam));
00670         <span class="keywordflow">break</span>;
00671 
00672     <span class="keywordflow">case</span> LB_FINDSTRINGEXACT:
00673         lReturn = <a class="code" href="../../d6/d0/usercli_8h.html#a683">xxxFindString</a>(plb, (LPWSTR)lParam, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)wParam, <a class="code" href="../../d6/d0/usercli_8h.html#a110">EQ</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00674         <span class="keywordflow">break</span>;
00675 
00676     <span class="keywordflow">case</span> LB_ITEMFROMPOINT: {
00677         POINT pt;
00678         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bOutside;
00679         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwItem;
00680 
00681         POINTSTOPOINT(pt, lParam);
00682         bOutside = <a class="code" href="../../d6/d0/usercli_8h.html#a686">ISelFromPt</a>(plb, pt, &amp;dwItem);
00683         UserAssert(bOutside == 1 || bOutside == 0);
00684         <span class="keywordflow">return</span> (LRESULT)MAKELONG(dwItem, bOutside);
00685     }
00686 
00687     <span class="keywordflow">case</span> LBCB_CARETON:
00688 
00689         <span class="comment">/*</span>
00690 <span class="comment">         * Internal message for combo box support</span>
00691 <span class="comment">         */</span>
00692         <a class="code" href="../../d6/d0/usercli_8h.html#a66">CaretCreate</a>(plb);
00693         <span class="comment">// Set up the caret in the proper location for drop downs.</span>
00694         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a> = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a>;
00695         <a class="code" href="../../d6/d0/usercli_8h.html#a695">xxxLBSetCaret</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00696         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00697             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(pwnd)) {
00698                 <a class="code" href="../../d6/d0/usercli_8h.html#a409">LBEvent</a>(plb, EVENT_OBJECT_FOCUS, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a>);
00699             }
00700         }
00701         <span class="keywordflow">return</span>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a>);
00702 
00703     <span class="keywordflow">case</span> LBCB_CARETOFF:
00704 
00705         <span class="comment">/*</span>
00706 <span class="comment">         * Internal message for combo box support</span>
00707 <span class="comment">         */</span>
00708         <a class="code" href="../../d6/d0/usercli_8h.html#a695">xxxLBSetCaret</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00709         <a class="code" href="../../d6/d0/usercli_8h.html#a696">xxxCaretDestroy</a>(plb);
00710         <span class="keywordflow">break</span>;
00711 
00712     <span class="keywordflow">case</span> WM_NCCREATE:
00713         <span class="keywordflow">if</span> ((pwnd-&gt;style &amp; LBS_MULTICOLUMN) &amp;&amp; (pwnd-&gt;style &amp; WS_VSCROLL))
00714         {
00715             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> mask = WS_VSCROLL;
00716             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags = 0;
00717             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00718                 mask |= WS_HSCROLL;
00719                 flags = WS_HSCROLL;
00720             }
00721             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a285">NtUserAlterWindowStyle</a>(hwnd, mask, flags);
00722         }
00723         <span class="keywordflow">goto</span> CallDWP;
00724 
00725      <span class="keywordflow">default</span>:
00726 CallDWP:
00727         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, fAnsi);
00728     }
00729 
00730     <span class="comment">/*</span>
00731 <span class="comment">     * Handle translation of ANSI output data and free buffer</span>
00732 <span class="comment">     */</span>
00733     <span class="keywordflow">if</span> (lpwsz) {
00734         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(lpwsz);
00735     }
00736 
00737     <span class="keywordflow">return</span> lReturn;
00738 }
00739 
00740 
00741 <span class="comment">/***************************************************************************\</span>
00742 <span class="comment">\***************************************************************************/</span>
00743 
<a name="l00744"></a><a class="code" href="../../d6/d0/usercli_8h.html#a582">00744</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a582">ListBoxWndProcA</a>(
00745     HWND hwnd,
00746     UINT message,
00747     WPARAM wParam,
00748     LPARAM lParam)
00749 {
00750     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00751 
00752     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00753         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00754     }
00755 
00756     <span class="comment">/*</span>
00757 <span class="comment">     * If the control is not interested in this message,</span>
00758 <span class="comment">     * pass it to DefWindowProc.</span>
00759 <span class="comment">     */</span>
00760     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>))
00761         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00762 
00763     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a612">ListBoxWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00764 }
00765 
<a name="l00766"></a><a class="code" href="../../d6/d0/usercli_8h.html#a583">00766</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a583">ListBoxWndProcW</a>(
00767     HWND hwnd,
00768     UINT message,
00769     WPARAM wParam,
00770     LPARAM lParam)
00771 {
00772     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00773 
00774     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00775         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00776     }
00777 
00778     <span class="comment">/*</span>
00779 <span class="comment">     * If the control is not interested in this message,</span>
00780 <span class="comment">     * pass it to DefWindowProc.</span>
00781 <span class="comment">     */</span>
00782     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>))
00783         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00784 
00785     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a612">ListBoxWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00786 }
00787 
<a name="l00788"></a><a class="code" href="../../d6/d0/usercli_8h.html#a588">00788</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a588">ComboListBoxWndProcA</a>(
00789     HWND hwnd,
00790     UINT message,
00791     WPARAM wParam,
00792     LPARAM lParam)
00793 {
00794     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00795 
00796     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00797         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00798     }
00799 
00800     <span class="comment">/*</span>
00801 <span class="comment">     * If the control is not interested in this message,</span>
00802 <span class="comment">     * pass it to DefWindowProc.</span>
00803 <span class="comment">     */</span>
00804     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>))
00805         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00806 
00807     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a612">ListBoxWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00808 }
00809 
<a name="l00810"></a><a class="code" href="../../d6/d0/usercli_8h.html#a589">00810</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a589">ComboListBoxWndProcW</a>(
00811     HWND hwnd,
00812     UINT message,
00813     WPARAM wParam,
00814     LPARAM lParam)
00815 {
00816     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00817 
00818     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00819         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00820     }
00821 
00822     <span class="comment">/*</span>
00823 <span class="comment">     * If the control is not interested in this message,</span>
00824 <span class="comment">     * pass it to DefWindowProc.</span>
00825 <span class="comment">     */</span>
00826     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>))
00827         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00828 
00829     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a612">ListBoxWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00830 }
00831 
00832 
00833 <span class="comment">/***************************************************************************\</span>
00834 <span class="comment">* GetLpszItem</span>
00835 <span class="comment">*</span>
00836 <span class="comment">* Returns a far pointer to the string belonging to item sItem</span>
00837 <span class="comment">* ONLY for Listboxes maintaining their own strings (pLBIV-&gt;fHasStrings == TRUE)</span>
00838 <span class="comment">*</span>
00839 <span class="comment">* History:</span>
00840 <span class="comment">\***************************************************************************/</span>
00841 
<a name="l00842"></a><a class="code" href="../../d6/d0/usercli_8h.html#a715">00842</a> LPWSTR <a class="code" href="../../d6/d0/usercli_8h.html#a715">GetLpszItem</a>(
00843     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> pLBIV,
00844     INT sItem)
00845 {
00846     LONG offsz;
00847     <a class="code" href="../../d6/d9/structtagLBItem.html">lpLBItem</a> plbi;
00848 
00849     <span class="keywordflow">if</span> (sItem &lt; 0 || sItem &gt;= pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>) {
00850         RIPERR1(ERROR_INVALID_PARAMETER,
00851                 RIP_WARNING,
00852                 <span class="stringliteral">"Invalid parameter \"sItem\" (%ld) to GetLpszItem"</span>,
00853                 sItem);
00854 
00855         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00856     }
00857 
00858     <span class="comment">/*</span>
00859 <span class="comment">     * get pointer to item index array</span>
00860 <span class="comment">     * NOTE: NOT OWNERDRAW</span>
00861 <span class="comment">     */</span>
00862     plbi = (<a class="code" href="../../d6/d9/structtagLBItem.html">lpLBItem</a>)(pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o8">rgpch</a>);
00863     offsz = plbi[sItem].<a class="code" href="../../d6/d9/structtagLBItem.html#o0">offsz</a>;
00864     <span class="keywordflow">return</span> (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o9">hStrings</a>) + offsz);
00865 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:36 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
