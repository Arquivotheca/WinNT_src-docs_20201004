<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mips/dmpstate.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dmpstate.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d8/d9/mips_2dmpstate_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/mips_2dmpstate_8c.html#a1">KiDisplayString</a> (IN ULONG Column, IN ULONG Row, IN PCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PRUNTIME_FUNCTION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/mips_2dmpstate_8c.html#a2">KiLookupFunctionEntry</a> (IN ULONG ControlPc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/mips_2dmpstate_8c.html#a3">KiPcToFileHeader</a> (IN PVOID PcValue, OUT PVOID *BaseOfImage, OUT PLDR_DATA_TABLE_ENTRY *DataTableEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/mips_2dmpstate_8c.html#a4">KeDumpMachineState</a> (IN PKPROCESSOR_STATE ProcessorState, IN PCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN PULONG BugCheckParameters, IN ULONG NumberOfParameters, IN <a class="el" href="../../d4/d9/ke_8h.html#a116">PKE_BUGCHECK_UNICODE_TO_ANSI</a> UnicodeToAnsiRoutine)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/mips_2dmpstate_8c.html#a0">PsLoadedModuleList</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="mips/dmpstate.c::KeDumpMachineState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeDumpMachineState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKPROCESSOR_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessorState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckParameters</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfParameters</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a116">PKE_BUGCHECK_UNICODE_TO_ANSI</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeToAnsiRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00059">59</a> of file <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html">mips/dmpstate.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d2/d7/hal_8h.html#a160">HalDisplayString()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a161">HalQueryDisplayParameters()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a162">HalSetDisplayParameters()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02773">KeLoaderBlock</a>, <a class="el" href="../../d8/d0/ppc_2dmpstate_8c.html#a2">KiDisplayString()</a>, <a class="el" href="../../d8/d0/ppc_2dmpstate_8c.html#a3">KiLookupFunctionEntry()</a>, <a class="el" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01844">_LOADER_PARAMETER_BLOCK::LoadOrderListHead</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00028">MmDbgReadCheck()</a>, <a class="el" href="../../d6/d4/triage_8c-source.html#l00042">NtBuildNumber</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00582">PsLoadedModuleList</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00029">RtlImageNtHeader()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
<pre class="fragment"><div>00069                    :
00070 
00071     This function formats and displays <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine state at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00072     to bug check.
00073 
00074 Arguments:
00075 
00076     ProcessorState - Supplies a pointer to a processor state record.
00077 
00078     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to a buffer to be used to output machine
00079         state information.
00080 
00081     BugCheckParameters - Supplies a pointer to an array of additional
00082         bug check information.
00083 
00084     NumberOfParameters - Suppiles <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check parameters
00085         array.
00086 
00087     UnicodeToAnsiRoutine - Supplies a pointer to a routine to convert <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> strings
00088         to Ansi strings without touching paged <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> tables.
00089 
00090 Return Value:
00091 
00092     None.
00093 
00094 --*/
00095 
00096 {
00097 
00098     PCONTEXT ContextRecord;
00099     ULONG ControlPc;
00100     PLDR_DATA_TABLE_ENTRY DataTableEntry;
00101     ULONG DisplayColumn;
00102     ULONG DisplayHeight;
00103     ULONG DisplayRow;
00104     ULONG DisplayWidth;
00105     UNICODE_STRING DllName;
00106     ULONG EstablisherFrame;
00107     PRUNTIME_FUNCTION FunctionEntry;
00108     PVOID ImageBase;
00109     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00110     BOOLEAN InFunction;
00111     ULONG LastStack;
00112     PLIST_ENTRY ModuleListHead;
00113     PLIST_ENTRY NextEntry;
00114     ULONG NextPc;
00115     ULONG StackLimit;
00116     UCHAR AnsiBuffer[ 32 ];
00117     ULONG DateStamp;
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Query display parameters.</span>
00121     <span class="comment">//</span>
00122 
00123     <a class="code" href="../../d2/d7/hal_8h.html#a161">HalQueryDisplayParameters</a>(&amp;DisplayWidth,
00124                               &amp;DisplayHeight,
00125                               &amp;DisplayColumn,
00126                               &amp;DisplayRow);
00127 
00128     <span class="comment">//</span>
00129     <span class="comment">// Display any addresses that fall within the range of any module in</span>
00130     <span class="comment">// the loaded module list.</span>
00131     <span class="comment">//</span>
00132 
00133     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; NumberOfParameters; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00134         ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a>((PVOID)*BugCheckParameters,
00135                                      &amp;ImageBase,
00136                                      &amp;DataTableEntry);
00137 
00138         <span class="keywordflow">if</span> (ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00139             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00140                     <span class="stringliteral">"*** %08lX has base at %08lX - %s\n"</span>,
00141                     *BugCheckParameters,
00142                     ImageBase,
00143                     (*UnicodeToAnsiRoutine)( &amp;DataTableEntry-&gt;BaseDllName, AnsiBuffer, <span class="keyword">sizeof</span>( AnsiBuffer )));
00144 
00145             <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00146         }
00147 
00148         BugCheckParameters += 1;
00149     }
00150 
00151     <span class="comment">//</span>
00152     <span class="comment">// Virtually unwind to the caller of bug check.</span>
00153     <span class="comment">//</span>
00154 
00155     ContextRecord = &amp;ProcessorState-&gt;ContextFrame;
00156     LastStack = (ULONG)ContextRecord-&gt;XIntSp;
00157     ControlPc = (ULONG)(ContextRecord-&gt;XIntRa - 4);
00158     NextPc = ControlPc;
00159     FunctionEntry = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a3">KiLookupFunctionEntry</a>(ControlPc);
00160     <span class="keywordflow">if</span> (FunctionEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00161         NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ControlPc | 1,
00162                                   FunctionEntry,
00163                                   ContextRecord,
00164                                   &amp;InFunction,
00165                                   &amp;EstablisherFrame,
00166                                   NULL);
00167     }
00168 
00169     <span class="comment">//</span>
00170     <span class="comment">// At this point the context record contains the machine state at the</span>
00171     <span class="comment">// call to bug check.</span>
00172     <span class="comment">//</span>
00173     <span class="comment">// Put out the machine state at the time of the bugcheck.</span>
00174     <span class="comment">//</span>
00175 
00176     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00177             <span class="stringliteral">"\nMachine State at Call to Bug Check PC : %08lX PSR : %08lX\n\n"</span>,
00178             (ULONG)ContextRecord-&gt;XIntRa,
00179             ContextRecord-&gt;Psr);
00180 
00181     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00182 
00183     <span class="comment">//</span>
00184     <span class="comment">// Format and output the integer registers.</span>
00185     <span class="comment">//</span>
00186 
00187     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00188             <span class="stringliteral">"AT :%8lX  V0 :%8lX  V1 :%8lX  A0 :%8lX\n"</span>,
00189             (ULONG)ContextRecord-&gt;XIntAt,
00190             (ULONG)ContextRecord-&gt;XIntV0,
00191             (ULONG)ContextRecord-&gt;XIntV1,
00192             (ULONG)ContextRecord-&gt;XIntA0);
00193 
00194     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00195 
00196     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00197             <span class="stringliteral">"A1 :%8lX  A2 :%8lX  A3 :%8lX  T0 :%8lX\n"</span>,
00198             (ULONG)ContextRecord-&gt;XIntA1,
00199             (ULONG)ContextRecord-&gt;XIntA2,
00200             (ULONG)ContextRecord-&gt;XIntA3,
00201             (ULONG)ContextRecord-&gt;XIntT0);
00202 
00203     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00204 
00205     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00206             <span class="stringliteral">"T1 :%8lX  T2 :%8lX  T3 :%8lX  T4 :%8lX\n"</span>,
00207             (ULONG)ContextRecord-&gt;XIntT1,
00208             (ULONG)ContextRecord-&gt;XIntT2,
00209             (ULONG)ContextRecord-&gt;XIntT3,
00210             (ULONG)ContextRecord-&gt;XIntT4);
00211 
00212     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00213 
00214     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00215             <span class="stringliteral">"T5 :%8lX  T6 :%8lX  T7 :%8lX  T8 :%8lX\n"</span>,
00216             (ULONG)ContextRecord-&gt;XIntT5,
00217             (ULONG)ContextRecord-&gt;XIntT6,
00218             (ULONG)ContextRecord-&gt;XIntT7,
00219             (ULONG)ContextRecord-&gt;XIntT8);
00220 
00221     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00222 
00223     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00224             <span class="stringliteral">"T9 :%8lX  S0 :%8lX  S1 :%8lX  S2 :%8lX\n"</span>,
00225             (ULONG)ContextRecord-&gt;XIntT9,
00226             (ULONG)ContextRecord-&gt;XIntS0,
00227             (ULONG)ContextRecord-&gt;XIntS1,
00228             (ULONG)ContextRecord-&gt;XIntS2);
00229 
00230     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00231 
00232     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00233             <span class="stringliteral">"S3 :%8lX  S4 :%8lX  S5 :%8lX  S6 :%8lX\n"</span>,
00234             (ULONG)ContextRecord-&gt;XIntS3,
00235             (ULONG)ContextRecord-&gt;XIntS4,
00236             (ULONG)ContextRecord-&gt;XIntS5,
00237             (ULONG)ContextRecord-&gt;XIntS6);
00238 
00239     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00240 
00241     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00242             <span class="stringliteral">"S7 :%8lX  S8 :%8lX  GP :%8lX  SP :%8lX\n"</span>,
00243             (ULONG)ContextRecord-&gt;XIntS7,
00244             (ULONG)ContextRecord-&gt;XIntS8,
00245             (ULONG)ContextRecord-&gt;XIntGp,
00246             (ULONG)ContextRecord-&gt;XIntSp);
00247 
00248      <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00249 
00250      <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00251             <span class="stringliteral">"RA :%8lX  LO :%8lX  HI :%8lX  FSR:%8lX\n"</span>,
00252             (ULONG)ContextRecord-&gt;XIntRa,
00253             (ULONG)ContextRecord-&gt;XIntLo,
00254             (ULONG)ContextRecord-&gt;XIntHi,
00255             (ULONG)ContextRecord-&gt;Fsr);
00256 
00257     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00258 
00259     <span class="comment">//</span>
00260     <span class="comment">// Format and output the firswt four floating registers.</span>
00261     <span class="comment">//</span>
00262 
00263     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00264             <span class="stringliteral">"F0 :%8lX  F1 :%8lX  F2 :%8lX  F3 :%8lX\n"</span>,
00265             ContextRecord-&gt;FltF0,
00266             ContextRecord-&gt;FltF1,
00267             ContextRecord-&gt;FltF2,
00268             ContextRecord-&gt;FltF3);
00269 
00270     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00271 
00272     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00273             <span class="stringliteral">"F4 :%8lX  F5 :%8lX  F6 :%8lX  F7 :%8lX\n"</span>,
00274             ContextRecord-&gt;FltF4,
00275             ContextRecord-&gt;FltF5,
00276             ContextRecord-&gt;FltF6,
00277             ContextRecord-&gt;FltF7);
00278 
00279     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00280 
00281     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00282             <span class="stringliteral">"F8 :%8lX  F9 :%8lX  F10:%8lX  F11:%8lX\n"</span>,
00283             ContextRecord-&gt;FltF8,
00284             ContextRecord-&gt;FltF9,
00285             ContextRecord-&gt;FltF10,
00286             ContextRecord-&gt;FltF11);
00287 
00288     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00289 
00290     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00291             <span class="stringliteral">"F12:%8lX  F13:%8lX  F14:%8lX  F15:%8lX\n"</span>,
00292             ContextRecord-&gt;FltF12,
00293             ContextRecord-&gt;FltF13,
00294             ContextRecord-&gt;FltF14,
00295             ContextRecord-&gt;FltF15);
00296 
00297     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00298 
00299     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00300             <span class="stringliteral">"F16:%8lX  F17:%8lX  F18:%8lX  F19:%8lX\n"</span>,
00301             ContextRecord-&gt;FltF16,
00302             ContextRecord-&gt;FltF17,
00303             ContextRecord-&gt;FltF18,
00304             ContextRecord-&gt;FltF19);
00305 
00306     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00307 
00308     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00309             <span class="stringliteral">"F20:%8lX  F21:%8lX  F22:%8lX  F23:%8lX\n"</span>,
00310             ContextRecord-&gt;FltF20,
00311             ContextRecord-&gt;FltF21,
00312             ContextRecord-&gt;FltF22,
00313             ContextRecord-&gt;FltF23);
00314 
00315     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00316 
00317     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00318             <span class="stringliteral">"F24:%8lX  F25:%8lX  F26:%8lX  F27:%8lX\n"</span>,
00319             ContextRecord-&gt;FltF24,
00320             ContextRecord-&gt;FltF25,
00321             ContextRecord-&gt;FltF26,
00322             ContextRecord-&gt;FltF27);
00323 
00324     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00325 
00326     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00327             <span class="stringliteral">"F28:%8lX  F29:%8lX  F30:%8lX  F31:%8lX\n\n"</span>,
00328             ContextRecord-&gt;FltF28,
00329             ContextRecord-&gt;FltF29,
00330             ContextRecord-&gt;FltF30,
00331             ContextRecord-&gt;FltF31);
00332 
00333     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00334 
00335     <span class="comment">//</span>
00336     <span class="comment">// Output short stack back trace with base address.</span>
00337     <span class="comment">//</span>
00338 
00339     DllName.Length = 0;
00340     DllName.Buffer = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">""</span>;
00341     <span class="keywordflow">if</span> (FunctionEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00342         StackLimit = (ULONG)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelStack;
00343         <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(<span class="stringliteral">"Callee-Sp Return-Ra  Dll Base - Name\n"</span>);
00344         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; 8; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00345             ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a>((PVOID)ControlPc,
00346                                          &amp;ImageBase,
00347                                          &amp;DataTableEntry);
00348 
00349             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00350                     <span class="stringliteral">" %08lX %08lX : %08lX - %s\n"</span>,
00351                     (ULONG)ContextRecord-&gt;XIntSp,
00352                     NextPc + 4,
00353                     ImageBase,
00354                     (*UnicodeToAnsiRoutine)( (ImageBase != NULL) ? &amp;DataTableEntry-&gt;BaseDllName : &amp;DllName,
00355                                              AnsiBuffer, <span class="keyword">sizeof</span>( AnsiBuffer )));
00356 
00357             <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00358             <span class="keywordflow">if</span> ((NextPc != ControlPc) || ((ULONG)ContextRecord-&gt;XIntSp != LastStack)) {
00359                 ControlPc = NextPc;
00360                 LastStack = (ULONG)ContextRecord-&gt;XIntSp;
00361                 FunctionEntry = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a3">KiLookupFunctionEntry</a>(ControlPc);
00362                 <span class="keywordflow">if</span> ((FunctionEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (LastStack &lt; StackLimit)) {
00363                     NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ControlPc | 1,
00364                                               FunctionEntry,
00365                                               ContextRecord,
00366                                               &amp;InFunction,
00367                                               &amp;EstablisherFrame,
00368                                               NULL);
00369                 } <span class="keywordflow">else</span> {
00370                     NextPc = (ULONG)ContextRecord-&gt;XIntRa;
00371                 }
00372 
00373             } <span class="keywordflow">else</span> {
00374                 <span class="keywordflow">break</span>;
00375             }
00376         }
00377     }
00378 
00379     <span class="comment">//</span>
00380     <span class="comment">// Output the build number and other useful information.</span>
00381     <span class="comment">//</span>
00382 
00383     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00384            <span class="stringliteral">"\nIRQL : %d, DPC Active : %s, SYSVER 0x%08x\n"</span>,
00385            KeGetCurrentIrql(),
00386            KeIsExecutingDpc() ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span>,
00387            NtBuildNumber);
00388 
00389     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00390 
00391     <span class="comment">//</span>
00392     <span class="comment">// Output the processor id and the primary cache sizes.</span>
00393     <span class="comment">//</span>
00394 
00395     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00396             <span class="stringliteral">"Processor Id %d.%d, Icache : %d, Dcache : %d\n"</span>,
00397             (PCR-&gt;ProcessorId &gt;&gt; 8) &amp; 0xff,
00398             PCR-&gt;ProcessorId &amp; 0xff,
00399             PCR-&gt;FirstLevelIcacheSize,
00400             PCR-&gt;FirstLevelDcacheSize);
00401 
00402     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// If the display width is greater than 80 + 24 (the size of a DLL</span>
00406     <span class="comment">// name and base address), then display all the modules loaded in</span>
00407     <span class="comment">// the system.</span>
00408     <span class="comment">//</span>
00409 
00410     <a class="code" href="../../d2/d7/hal_8h.html#a161">HalQueryDisplayParameters</a>(&amp;DisplayWidth,
00411                               &amp;DisplayHeight,
00412                               &amp;DisplayColumn,
00413                               &amp;DisplayRow);
00414 
00415     <span class="keywordflow">if</span> (DisplayWidth &gt; (80 + 24)) {
00416         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00417             ModuleListHead = &amp;<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o0">LoadOrderListHead</a>;
00418 
00419         } <span class="keywordflow">else</span> {
00420             ModuleListHead = &amp;<a class="code" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a>;
00421         }
00422 
00423         <span class="comment">//</span>
00424         <span class="comment">// Output display headers.</span>
00425         <span class="comment">//</span>
00426 
00427         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 1;
00428         <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a2">KiDisplayString</a>(80, Index, <span class="stringliteral">"Dll Base DateStmp - Name"</span>);
00429         NextEntry = ModuleListHead-&gt;Flink;
00430         <span class="keywordflow">if</span> (NextEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00431 
00432             <span class="comment">//</span>
00433             <span class="comment">// Scan the list of loaded modules and display their base</span>
00434             <span class="comment">// address and name.</span>
00435             <span class="comment">//</span>
00436 
00437             <span class="keywordflow">while</span> (NextEntry != ModuleListHead) {
00438                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
00439                 DataTableEntry = CONTAINING_RECORD(NextEntry,
00440                                                    LDR_DATA_TABLE_ENTRY,
00441                                                    InLoadOrderLinks);
00442 
00443                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(DataTableEntry-&gt;DllBase) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00444                     PIMAGE_NT_HEADERS NtHeaders;
00445 
00446                     NtHeaders = <a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(DataTableEntry-&gt;DllBase);
00447                     DateStamp = NtHeaders-&gt;FileHeader.TimeDateStamp;
00448 
00449                 } <span class="keywordflow">else</span> {
00450                     DateStamp = 0;
00451                 }
00452                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,
00453                         <span class="stringliteral">"%08lX %08lx - %s"</span>,
00454                         DataTableEntry-&gt;DllBase,
00455                         DateStamp,
00456                         (*UnicodeToAnsiRoutine)( &amp;DataTableEntry-&gt;BaseDllName, AnsiBuffer, <span class="keyword">sizeof</span>( AnsiBuffer )));
00457 
00458                 <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a2">KiDisplayString</a>(80, Index, Buffer);
00459                 NextEntry = NextEntry-&gt;Flink;
00460                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &gt; DisplayHeight) {
00461                     <span class="keywordflow">break</span>;
00462                 }
00463             }
00464         }
00465     }
00466 
00467     <span class="comment">//</span>
00468     <span class="comment">// Reset the current display position.</span>
00469     <span class="comment">//</span>
00470 
00471     <a class="code" href="../../d2/d7/hal_8h.html#a162">HalSetDisplayParameters</a>(DisplayColumn, DisplayRow);
00472     <span class="keywordflow">return</span>;
00473 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mips/dmpstate.c::KiDisplayString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDisplayString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Column</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Row</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00476">476</a> of file <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html">mips/dmpstate.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d2/d7/hal_8h.html#a160">HalDisplayString()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a162">HalSetDisplayParameters()</a>.
<p>
<pre class="fragment"><div>00484                    :
00485 
00486     This function display a string starting at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified column and row
00487     position on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen.
00488 
00489 Arguments:
00490 
00491     Column - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting column of where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> displayed.
00492 
00493     Row - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting row of where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> displayed.
00494 
00495     Bufer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> displayed.
00496 
00497 Return Value:
00498 
00499     None.
00500 
00501 --*/
00502 
00503 {
00504 
00505     <span class="comment">//</span>
00506     <span class="comment">// Position the cursor and display the string.</span>
00507     <span class="comment">//</span>
00508 
00509     <a class="code" href="../../d2/d7/hal_8h.html#a162">HalSetDisplayParameters</a>(Column, Row);
00510     <a class="code" href="../../d2/d7/hal_8h.html#a160">HalDisplayString</a>(Buffer);
00511     <span class="keywordflow">return</span>;
00512 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mips/dmpstate.c::KiLookupFunctionEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PRUNTIME_FUNCTION KiLookupFunctionEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ControlPc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00515">515</a> of file <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html">mips/dmpstate.c</a>.
<p>
References <a class="el" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00521                    :
00522 
00523     This function searches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> currently active function tables <span class="keywordflow">for</span> an entry
00524     that corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified PC value.
00525 
00526 Arguments:
00527 
00528     ControlPc - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of an instruction within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00529         function.
00530 
00531 Return Value:
00532 
00533     If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no entry in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function table <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified PC, then
00534     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function table entry
00535     that corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified PC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00536 
00537 --*/
00538 
00539 {
00540 
00541     PLDR_DATA_TABLE_ENTRY DataTableEntry;
00542     PRUNTIME_FUNCTION FunctionEntry;
00543     PRUNTIME_FUNCTION FunctionTable;
00544     ULONG SizeOfExceptionTable;
00545     LONG High;
00546     PVOID ImageBase;
00547     LONG Low;
00548     LONG Middle;
00549 
00550     <span class="comment">//</span>
00551     <span class="comment">// Search for the image that includes the specified PC value.</span>
00552     <span class="comment">//</span>
00553 
00554     ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a>((PVOID)ControlPc,
00555                                  &amp;ImageBase,
00556                                  &amp;DataTableEntry);
00557 
00558     <span class="comment">//</span>
00559     <span class="comment">// If an image is found that includes the specified PC, then locate the</span>
00560     <span class="comment">// function table for the image.</span>
00561     <span class="comment">//</span>
00562 
00563     <span class="keywordflow">if</span> (ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00564         FunctionTable = (PRUNTIME_FUNCTION)<a class="code" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a>(
00565                          ImageBase, TRUE, IMAGE_DIRECTORY_ENTRY_EXCEPTION,
00566                          &amp;SizeOfExceptionTable);
00567 
00568         <span class="comment">//</span>
00569         <span class="comment">// If a function table is located, then search the function table</span>
00570         <span class="comment">// for a function table entry for the specified PC.</span>
00571         <span class="comment">//</span>
00572 
00573         <span class="keywordflow">if</span> (FunctionTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00574 
00575             <span class="comment">//</span>
00576             <span class="comment">// Initialize search indicies.</span>
00577             <span class="comment">//</span>
00578 
00579             Low = 0;
00580             High = (SizeOfExceptionTable / <span class="keyword">sizeof</span>(RUNTIME_FUNCTION)) - 1;
00581 
00582             <span class="comment">//</span>
00583             <span class="comment">// Perform binary search on the function table for a function table</span>
00584             <span class="comment">// entry that subsumes the specified PC.</span>
00585             <span class="comment">//</span>
00586 
00587             <span class="keywordflow">while</span> (High &gt;= Low) {
00588 
00589                 <span class="comment">//</span>
00590                 <span class="comment">// Compute next probe index and test entry. If the specified PC</span>
00591                 <span class="comment">// is greater than of equal to the beginning address and less</span>
00592                 <span class="comment">// than the ending address of the function table entry, then</span>
00593                 <span class="comment">// return the address of the function table entry. Otherwise,</span>
00594                 <span class="comment">// continue the search.</span>
00595                 <span class="comment">//</span>
00596 
00597                 Middle = (Low + High) &gt;&gt; 1;
00598                 FunctionEntry = &amp;FunctionTable[Middle];
00599                 <span class="keywordflow">if</span> (ControlPc &lt; FunctionEntry-&gt;BeginAddress) {
00600                     High = Middle - 1;
00601 
00602                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ControlPc &gt;= FunctionEntry-&gt;EndAddress) {
00603                     Low = Middle + 1;
00604 
00605                 } <span class="keywordflow">else</span> {
00606 
00607                     <span class="comment">//</span>
00608                     <span class="comment">// The capability exists for more than one function entry</span>
00609                     <span class="comment">// to map to the same function. This permits a function to</span>
00610                     <span class="comment">// have discontiguous code segments described by separate</span>
00611                     <span class="comment">// function table entries. If the ending prologue address</span>
00612                     <span class="comment">// is not within the limits of the begining and ending</span>
00613                     <span class="comment">// address of the function able entry, then the prologue</span>
00614                     <span class="comment">// ending address is the address of a function table entry</span>
00615                     <span class="comment">// that accurately describes the ending prologue address.</span>
00616                     <span class="comment">//</span>
00617 
00618                     <span class="keywordflow">if</span> ((FunctionEntry-&gt;PrologEndAddress &lt; FunctionEntry-&gt;BeginAddress) ||
00619                         (FunctionEntry-&gt;PrologEndAddress &gt;= FunctionEntry-&gt;EndAddress)) {
00620                         FunctionEntry = (PRUNTIME_FUNCTION)FunctionEntry-&gt;PrologEndAddress;
00621                     }
00622 
00623                     <span class="keywordflow">return</span> FunctionEntry;
00624                 }
00625             }
00626         }
00627     }
00628 
00629     <span class="comment">//</span>
00630     <span class="comment">// A function table entry for the specified PC was not found.</span>
00631     <span class="comment">//</span>
00632 
00633     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00634 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mips/dmpstate.c::KiPcToFileHeader" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID KiPcToFileHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>PcValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseOfImage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLDR_DATA_TABLE_ENTRY *&nbsp;</td>
          <td class="mdname" nowrap> <em>DataTableEntry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00637">637</a> of file <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html">mips/dmpstate.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l02773">KeLoaderBlock</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01844">_LOADER_PARAMETER_BLOCK::LoadOrderListHead</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00582">PsLoadedModuleList</a>.
<p>
<pre class="fragment"><div>00645                    :
00646 
00647     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of an image that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00648     specified PcValue. An image contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue
00649     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ImageBase, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ImageBase plus <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00650     <span class="keyword">virtual</span> image.
00651 
00652 Arguments:
00653 
00654     PcValue - Supplies a PcValue.
00655 
00656     BaseOfImage - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base address <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00657         PcValue. This value must be added to any relative addresses in
00658         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> headers to locate portions of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image.
00659 
00660     DataTableEntry - Suppies a pointer to a variable that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00661         address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data table entry that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image.
00662 
00663 Return Value:
00664 
00665     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - No image was found that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue.
00666 
00667     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image that contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00668         PcValue.
00669 
00670 --*/
00671 
00672 {
00673 
00674     PLIST_ENTRY ModuleListHead;
00675     PLDR_DATA_TABLE_ENTRY Entry;
00676     PLIST_ENTRY Next;
00677     ULONG Bounds;
00678     PVOID ReturnBase, Base;
00679 
00680     <span class="comment">//</span>
00681     <span class="comment">// If the module list has been initialized, then scan the list to</span>
00682     <span class="comment">// locate the appropriate entry.</span>
00683     <span class="comment">//</span>
00684 
00685     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00686         ModuleListHead = &amp;<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o0">LoadOrderListHead</a>;
00687 
00688     } <span class="keywordflow">else</span> {
00689         ModuleListHead = &amp;<a class="code" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a>;
00690     }
00691 
00692     ReturnBase = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00693     Next = ModuleListHead-&gt;Flink;
00694     <span class="keywordflow">if</span> (Next != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00695         <span class="keywordflow">while</span> (Next != ModuleListHead) {
00696             Entry = CONTAINING_RECORD(Next,
00697                                       LDR_DATA_TABLE_ENTRY,
00698                                       InLoadOrderLinks);
00699 
00700             Next = Next-&gt;Flink;
00701             Base = Entry-&gt;DllBase;
00702             Bounds = (ULONG)Base + Entry-&gt;SizeOfImage;
00703             <span class="keywordflow">if</span> ((ULONG)PcValue &gt;= (ULONG)Base &amp;&amp; (ULONG)PcValue &lt; Bounds) {
00704                 *DataTableEntry = Entry;
00705                 ReturnBase = Base;
00706                 <span class="keywordflow">break</span>;
00707             }
00708         }
00709     }
00710 
00711     *BaseOfImage = ReturnBase;
00712     <span class="keywordflow">return</span> ReturnBase;
00713 }
}
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="mips/dmpstate.c::PsLoadedModuleList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d8/d8/sysload_8c.html#a27">PsLoadedModuleList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00056">56</a> of file <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html">mips/dmpstate.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
