<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: 4/ia64/kdcpuapi.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdcpuapi.c File Reference</h1><code>#include "<a class="el" href="../../d2/d6/4_2kdp_8h-source.html">kdp.h</a>"</code><br>

<p>
<a href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a0">END_OF_CONTROL_SPACE</a>&nbsp;&nbsp;&nbsp;(sizeof(KPROCESSOR_STATE))</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a1">KdpSetLoadState</a> (IN PDBGKD_WAIT_STATE_CHANGE64 WaitStateChange, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a2">KdpSetStateChange</a> (IN PDBGKD_WAIT_STATE_CHANGE64 WaitStateChange, IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord, IN BOOLEAN SecondChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a3">KdpGetStateChange</a> (IN PDBGKD_MANIPULATE_STATE64 ManipulateState, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a4">KdpReadControlSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a5">KdpWriteControlSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a6">KdpReadIoSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/4_2ia64_2kdcpuapi_8c.html#a7">KdpWriteIoSpace</a> (IN PDBGKD_MANIPULATE_STATE64 m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="4/ia64/kdcpuapi.c::END_OF_CONTROL_SPACE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define END_OF_CONTROL_SPACE&nbsp;&nbsp;&nbsp;(sizeof(KPROCESSOR_STATE))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00024">24</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="4/ia64/kdcpuapi.c::KdpGetStateChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpGetStateChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>ManipulateState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00179">179</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>00186                    :
00187 
00188     Extract continuation <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> data from Manipulate_State message
00189 
00190     N.B. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a noop <span class="keywordflow">for</span> MIPS.
00191 
00192 Arguments:
00193 
00194     ManipulateState - supplies pointer to Manipulate_State packet
00195 
00196     ContextRecord - Supplies a pointer to a context record.
00197 
00198 Return Value:
00199 
00200     None.
00201 
00202 --*/
00203 
00204 {
00205 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="4/ia64/kdcpuapi.c::KdpReadControlSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadControlSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00208">208</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00432">KDP_MESSAGE_BUFFER_SIZE</a>, <a class="el" href="../../d2/d7/alpha_2kdpcpu_8h.html#a12">KdpGetCurrentPrcb()</a>, <a class="el" href="../../d2/d7/alpha_2kdpcpu_8h.html#a13">KdpGetCurrentThread()</a>, <a class="el" href="../../d2/d7/alpha_2kdpcpu_8h.html#a7">KdpGetPcr()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d7/d7/4_2axp64_2kdpcpu_8h.html#a9">KdpReadInternalProcessorCounters()</a>, <a class="el" href="../../d7/d7/4_2axp64_2kdpcpu_8h.html#a8">KdpReadInternalProcessorState()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>00216                    :
00217 
00218     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a read <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> space state
00219     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read implementation
00220     specific system data.
00221 
00222 Arguments:
00223 
00224     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00225 
00226     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00227 
00228     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00229 
00230 Return Value:
00231 
00232     None.
00233 
00234 --*/
00235 
00236 {
00237 
00238     PDBGKD_READ_MEMORY64 a = &amp;m-&gt;u.ReadMemory;
00239     ULONG Length;
00240     STRING MessageHeader;
00241     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = AdditionalData-&gt;Buffer;
00242 
00243     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00244     MessageHeader.Buffer = (PCHAR)m;
00245 
00246     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00247 
00248     <span class="keywordflow">if</span> (a-&gt;TransferCount &gt; (PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE64))) {
00249         Length = PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE64);
00250 
00251     } <span class="keywordflow">else</span> {
00252         Length = a-&gt;TransferCount;
00253     }
00254 
00255     <span class="comment">//</span>
00256     <span class="comment">// Case on address to determine what part of Control space is being read.</span>
00257     <span class="comment">//</span>
00258 
00259     <span class="keywordflow">switch</span> ( a-&gt;TargetBaseAddress ) {
00260 
00261         <span class="comment">//</span>
00262         <span class="comment">// Return the pcr address for the current processor.</span>
00263         <span class="comment">//</span>
00264 
00265     <span class="keywordflow">case</span> DEBUG_CONTROL_SPACE_PCR:
00266 
00267         *(PKPCR *)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = (PKPCR)(KSEG3_BASE + 
00268                                (<a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[m-&gt;Processor]-&gt;PcrPage &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>));
00269         AdditionalData-&gt;Length = <span class="keyword">sizeof</span>( PKPCR );
00270         a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
00271         m-&gt;ReturnStatus = STATUS_SUCCESS;
00272         <span class="keywordflow">break</span>;
00273 
00274         <span class="comment">//</span>
00275         <span class="comment">// Return the prcb address for the current processor.</span>
00276         <span class="comment">//</span>
00277 
00278     <span class="keywordflow">case</span> DEBUG_CONTROL_SPACE_PRCB:
00279 
00280         *(PKPRCB *)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[m-&gt;Processor];
00281         AdditionalData-&gt;Length = <span class="keyword">sizeof</span>( PKPRCB );
00282         a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
00283         m-&gt;ReturnStatus = STATUS_SUCCESS;
00284         <span class="keywordflow">break</span>;
00285 
00286         <span class="comment">//</span>
00287         <span class="comment">// Return the pointer to the current thread address for the</span>
00288         <span class="comment">// current processor.</span>
00289         <span class="comment">//</span>
00290 
00291     <span class="keywordflow">case</span> DEBUG_CONTROL_SPACE_THREAD:
00292 
00293         *(<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> *)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[m-&gt;Processor]-&gt;CurrentThread;
00294         AdditionalData-&gt;Length = <span class="keyword">sizeof</span>( <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> );
00295         a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
00296         m-&gt;ReturnStatus = STATUS_SUCCESS;
00297         <span class="keywordflow">break</span>;
00298 
00299 
00300     <span class="keywordflow">case</span> DEBUG_CONTROL_SPACE_KSPECIAL:
00301 
00302         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a> (Buffer, 
00303                        (PVOID)&amp;(KiProcessorBlock[m-&gt;Processor]-&gt;ProcessorState.SpecialRegisters),
00304                        <span class="keyword">sizeof</span>( KSPECIAL_REGISTERS )
00305                       );
00306         AdditionalData-&gt;Length = <span class="keyword">sizeof</span>( KSPECIAL_REGISTERS );
00307         a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
00308         m-&gt;ReturnStatus = STATUS_SUCCESS;
00309         <span class="keywordflow">break</span>;
00310 
00311     <span class="keywordflow">default</span>:
00312 
00313         AdditionalData-&gt;Length = 0;
00314         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00315         a-&gt;ActualBytesRead = 0;
00316 
00317     }
00318 
00319     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00320         PACKET_TYPE_KD_STATE_MANIPULATE,
00321         &amp;MessageHeader,
00322         AdditionalData
00323         );
00324 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="4/ia64/kdcpuapi.c::KdpReadIoSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadIoSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00393">393</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l01170">BusNumber</a>, <a class="el" href="../../d2/d7/hal_8h.html#a184">HalTranslateBusAddress()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00050">InterfaceType</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00028">MmDbgReadCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>00401                    :
00402 
00403     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a read io space state
00404     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read system io
00405     locations.
00406 
00407 Arguments:
00408 
00409     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00410 
00411     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00412 
00413     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00414 
00415 Return Value:
00416 
00417     None.
00418 
00419 --*/
00420 
00421 {
00422     PDBGKD_READ_WRITE_IO64 a = &amp;m-&gt;u.ReadWriteIo;
00423     STRING MessageHeader;
00424     PUCHAR b;
00425     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a> s;
00426     PULONG l;
00427 
00428     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00429     MessageHeader.Buffer = (PCHAR)m;
00430 
00431     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00432 
00433     m-&gt;ReturnStatus = STATUS_SUCCESS;
00434 
00435     <span class="comment">//</span>
00436     <span class="comment">// Check Size and Alignment</span>
00437     <span class="comment">//</span>
00438 
00439     <span class="keywordflow">switch</span> ( a-&gt;DataSize ) {
00440         <span class="keywordflow">case</span> 1:
00441             b = (PUCHAR)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>((PVOID)a-&gt;IoAddress);
00442             <span class="keywordflow">if</span> ( b ) {
00443                 a-&gt;DataValue = (ULONG)*b;
00444             } <span class="keywordflow">else</span> {
00445                 m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00446             }
00447             <span class="keywordflow">break</span>;
00448         <span class="keywordflow">case</span> 2:
00449             <span class="keywordflow">if</span> ((ULONG_PTR)a-&gt;IoAddress &amp; 1 ) {
00450                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00451             } <span class="keywordflow">else</span> {
00452                 s = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>((PVOID)a-&gt;IoAddress);
00453                 <span class="keywordflow">if</span> ( s ) {
00454                     a-&gt;DataValue = (ULONG)*s;
00455                 } <span class="keywordflow">else</span> {
00456                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00457                 }
00458             }
00459             <span class="keywordflow">break</span>;
00460         <span class="keywordflow">case</span> 4:
00461             <span class="keywordflow">if</span> ((ULONG_PTR)a-&gt;IoAddress &amp; 3 ) {
00462                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00463             } <span class="keywordflow">else</span> {
00464                 l = (PULONG)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>((PVOID)a-&gt;IoAddress);
00465                 <span class="keywordflow">if</span> ( l ) {
00466                     a-&gt;DataValue = (ULONG)*l;
00467                 } <span class="keywordflow">else</span> {
00468                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00469                 }
00470             }
00471             <span class="keywordflow">break</span>;
00472         <span class="keywordflow">default</span>:
00473             m-&gt;ReturnStatus = STATUS_INVALID_PARAMETER;
00474     }
00475 
00476     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00477         PACKET_TYPE_KD_STATE_MANIPULATE,
00478         &amp;MessageHeader,
00479         NULL
00480         );
00481 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="4/ia64/kdcpuapi.c::KdpSetLoadState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSetLoadState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_WAIT_STATE_CHANGE64&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitStateChange</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00028">28</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00902">KdpDeleteBreakpointRange()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02434">KdpReportLoadSymbolsStateChange()</a>.
<p>
<pre class="fragment"><div>00035                    :
00036 
00037     Fill in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Wait_State_Change message record <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> load symbol <span class="keywordflow">case</span>.
00038 
00039 Arguments:
00040 
00041     WaitStateChange - Supplies pointer to record to fill in
00042 
00043     ContextRecord - Supplies a pointer to a context record.
00044 
00045 Return Value:
00046 
00047     None.
00048 
00049 --*/
00050 
00051 {
00052 
00053     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00054     PVOID <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
00055 
00056     <span class="comment">//</span>
00057     <span class="comment">// Copy the immediate instruction stream into the control report structure.</span>
00058     <span class="comment">//</span>
00059 
00060     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> =  <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00061                            (PCHAR)WaitStateChange-&gt;ProgramCounter,
00062                            DBGKD_MAXSTREAM);
00063 
00064     WaitStateChange-&gt;ControlReport.InstructionCount = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00065 
00066     <span class="comment">//</span>
00067     <span class="comment">// Clear breakpoints in the copied instruction stream. If any breakpoints</span>
00068     <span class="comment">// are cleared, then recopy the instruction stream and restore the break-</span>
00069     <span class="comment">// points afterward.</span>
00070     <span class="comment">//</span>
00071 
00072     <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = (PVOID)((PUCHAR)(WaitStateChange-&gt;ProgramCounter) + <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> - 1);
00073     <span class="keywordflow">if</span> (KdpSuspendBreakpointRange((PVOID)WaitStateChange-&gt;ProgramCounter, End) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00074         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00075                       (PCHAR)WaitStateChange-&gt;ProgramCounter,
00076                       WaitStateChange-&gt;ControlReport.InstructionCount);
00077         KdpRestoreBreakpointRange((PVOID)WaitStateChange-&gt;ProgramCounter, End);
00078     }
00079 
00080     <span class="comment">//</span>
00081     <span class="comment">// Copy the context record into the wait state change structure.</span>
00082     <span class="comment">//</span>
00083 
00084     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;Context,
00085                   (PCHAR)ContextRecord,
00086                   <span class="keyword">sizeof</span>(*ContextRecord));
00087 
00088     <span class="keywordflow">return</span>;
00089 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="4/ia64/kdcpuapi.c::KdpSetStateChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSetStateChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_WAIT_STATE_CHANGE64&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitStateChange</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SecondChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00092">92</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00902">KdpDeleteBreakpointRange()</a>, <a class="el" href="../../d2/d7/alpha_2kdpcpu_8h.html#a12">KdpGetCurrentPrcb()</a>, <a class="el" href="../../d2/d7/alpha_2kdpcpu_8h.html#a13">KdpGetCurrentThread()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00150">KdpQuickMoveMemory()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02778">KeProcessorLevel</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02351">KdpReportExceptionStateChange()</a>.
<p>
<pre class="fragment"><div>00101                    :
00102 
00103     Fill in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Wait_State_Change message record.
00104 
00105 Arguments:
00106 
00107     WaitStateChange - Supplies pointer to record to fill in
00108 
00109     ExceptionRecord - Supplies a pointer to an exception record.
00110 
00111     ContextRecord - Supplies a pointer to a context record.
00112 
00113     SecondChance - Supplies a <span class="keywordtype">boolean</span> value that determines whether <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00114         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first or second chance <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception.
00115 
00116 Return Value:
00117 
00118     None.
00119 
00120 --*/
00121 
00122 {
00123 
00124     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00125     PVOID <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
00126 
00127     <span class="comment">//</span>
00128     <span class="comment">// Set up description of event, including exception record</span>
00129     <span class="comment">//</span>
00130 
00131     WaitStateChange-&gt;NewState = DbgKdExceptionStateChange;
00132     WaitStateChange-&gt;ProcessorLevel = <a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a>;
00133     WaitStateChange-&gt;Processor = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number;
00134     WaitStateChange-&gt;NumberProcessors = (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00135     WaitStateChange-&gt;Thread = (ULONG64)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00136     WaitStateChange-&gt;ProgramCounter = (ULONG64)CONTEXT_TO_PROGRAM_COUNTER(ContextRecord);
00137     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;u.Exception.ExceptionRecord,
00138                        (PCHAR)ExceptionRecord,
00139                        <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
00140 
00141     WaitStateChange-&gt;u.Exception.FirstChance = !SecondChance;
00142 
00143     <span class="comment">//</span>
00144     <span class="comment">// Copy the immediate instruction stream into the control report structure.</span>
00145     <span class="comment">//</span>
00146 
00147     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> =  <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00148                            (PCHAR)WaitStateChange-&gt;ProgramCounter,
00149                            DBGKD_MAXSTREAM);
00150 
00151     WaitStateChange-&gt;ControlReport.InstructionCount = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00152 
00153     <span class="comment">//</span>
00154     <span class="comment">// Clear breakpoints in the copied instruction stream. If any breakpoints</span>
00155     <span class="comment">// are cleared, then recopy the instruction stream and restore the break-</span>
00156     <span class="comment">// points afterward.</span>
00157     <span class="comment">//</span>
00158 
00159     <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = (PVOID)((PUCHAR)(WaitStateChange-&gt;ProgramCounter) + <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> - 1);
00160     <span class="keywordflow">if</span> (KdpSuspendBreakpointRange((PVOID)WaitStateChange-&gt;ProgramCounter, End) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00161         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00162                       (PCHAR)WaitStateChange-&gt;ProgramCounter,
00163                       WaitStateChange-&gt;ControlReport.InstructionCount);
00164         KdpRestoreBreakpointRange((PVOID)WaitStateChange-&gt;ProgramCounter, End);
00165     }
00166 
00167     <span class="comment">//</span>
00168     <span class="comment">// Copy the context record into the wait state change structure.</span>
00169     <span class="comment">//</span>
00170 
00171     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;Context,
00172                   (PCHAR)ContextRecord,
00173                   <span class="keyword">sizeof</span>(*ContextRecord));
00174 
00175     <span class="keywordflow">return</span>;
00176 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="4/ia64/kdcpuapi.c::KdpWriteControlSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteControlSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00327">327</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>00335                    :
00336 
00337     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> space state
00338     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write implementation
00339     specific system data.
00340 
00341 Arguments:
00342 
00343     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00344 
00345     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00346 
00347     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00348 
00349 Return Value:
00350 
00351     None.
00352 
00353 --*/
00354 
00355 {
00356     PDBGKD_WRITE_MEMORY64 a = &amp;m-&gt;u.WriteMemory;
00357     STRING MessageHeader;
00358     ULONG  Length;
00359     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = AdditionalData-&gt;Buffer;
00360 
00361     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00362     MessageHeader.Buffer = (PCHAR)m;
00363 
00364     <span class="keywordflow">switch</span> ( (ULONG_PTR)a-&gt;TargetBaseAddress ) {
00365 
00366     <span class="keywordflow">case</span> DEBUG_CONTROL_SPACE_KSPECIAL:
00367 
00368         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a> ((PVOID)&amp;(KiProcessorBlock[m-&gt;Processor]-&gt;ProcessorState.SpecialRegisters),
00369                        Buffer,
00370                        <span class="keyword">sizeof</span>( KSPECIAL_REGISTERS )
00371                       );
00372         AdditionalData-&gt;Length = <span class="keyword">sizeof</span>( KSPECIAL_REGISTERS );
00373         a-&gt;ActualBytesWritten = AdditionalData-&gt;Length;
00374         m-&gt;ReturnStatus = STATUS_SUCCESS;
00375         <span class="keywordflow">break</span>;
00376 
00377     <span class="keywordflow">default</span>:
00378 
00379         AdditionalData-&gt;Length = 0;
00380         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00381         a-&gt;ActualBytesWritten = 0;
00382 
00383     }
00384 
00385     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00386         PACKET_TYPE_KD_STATE_MANIPULATE,
00387         &amp;MessageHeader,
00388         AdditionalData
00389         );
00390 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="4/ia64/kdcpuapi.c::KdpWriteIoSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteIoSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE64&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html#l00484">484</a> of file <a class="el" href="../../d8/d4/4_2ia64_2kdcpuapi_8c-source.html">4/ia64/kdcpuapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l01170">BusNumber</a>, <a class="el" href="../../d2/d7/hal_8h.html#a184">HalTranslateBusAddress()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00050">InterfaceType</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d3/d5/ia64_2debugsup_8c-source.html#l00174">MmDbgReleaseAddress()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00078">MmDbgWriteCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>00492                    :
00493 
00494     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write io space state
00495     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write to system io
00496     locations.
00497 
00498 Arguments:
00499 
00500     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
00501 
00502     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
00503 
00504     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00505 
00506 Return Value:
00507 
00508     None.
00509 
00510 --*/
00511 
00512 {
00513     PDBGKD_READ_WRITE_IO64 a = &amp;m-&gt;u.ReadWriteIo;
00514     STRING MessageHeader;
00515     PUCHAR b;
00516     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a> s;
00517     PULONG l;
00518     HARDWARE_PTE Opaque;
00519 
00520     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00521     MessageHeader.Buffer = (PCHAR)m;
00522 
00523     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00524 
00525     m-&gt;ReturnStatus = STATUS_SUCCESS;
00526 
00527     <span class="comment">//</span>
00528     <span class="comment">// Check Size and Alignment</span>
00529     <span class="comment">//</span>
00530 
00531     <span class="keywordflow">switch</span> ( a-&gt;DataSize ) {
00532         <span class="keywordflow">case</span> 1:
00533             b = (PUCHAR)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>((PVOID)a-&gt;IoAddress, &amp;Opaque);
00534             <span class="keywordflow">if</span> ( b ) {
00535                 WRITE_REGISTER_UCHAR(b,(UCHAR)a-&gt;DataValue);
00536                 <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(b, &amp;Opaque);
00537             } <span class="keywordflow">else</span> {
00538                 m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00539             }
00540             <span class="keywordflow">break</span>;
00541         <span class="keywordflow">case</span> 2:
00542             <span class="keywordflow">if</span> ((ULONG_PTR)a-&gt;IoAddress &amp; 1 ) {
00543                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00544             } <span class="keywordflow">else</span> {
00545                 s = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>((PVOID)a-&gt;IoAddress, &amp;Opaque);
00546                 <span class="keywordflow">if</span> ( s ) {
00547                     WRITE_REGISTER_USHORT(s,(USHORT)a-&gt;DataValue);
00548                     <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(s, &amp;Opaque);
00549                 } <span class="keywordflow">else</span> {
00550                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00551                 }
00552             }
00553             <span class="keywordflow">break</span>;
00554         <span class="keywordflow">case</span> 4:
00555             <span class="keywordflow">if</span> ((ULONG_PTR)a-&gt;IoAddress &amp; 3 ) {
00556                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00557             } <span class="keywordflow">else</span> {
00558                 l = (PULONG)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>((PVOID)a-&gt;IoAddress, &amp;Opaque);
00559                 <span class="keywordflow">if</span> ( l ) {
00560                     WRITE_REGISTER_ULONG(l,a-&gt;DataValue);
00561                     <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(l, &amp;Opaque);
00562                 } <span class="keywordflow">else</span> {
00563                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00564                 }
00565             }
00566             <span class="keywordflow">break</span>;
00567         <span class="keywordflow">default</span>:
00568             m-&gt;ReturnStatus = STATUS_INVALID_PARAMETER;
00569     }
00570 
00571     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00572         PACKET_TYPE_KD_STATE_MANIPULATE,
00573         &amp;MessageHeader,
00574         NULL
00575         );
00576 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
