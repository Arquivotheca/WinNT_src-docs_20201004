<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: sep.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>sep.h</h1><a href="../../d6/d6/sep_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    sep.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the internal (private) declarations needed by the</span>
00012 <span class="comment">    Kernel mode security routines.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Gary Kimura (GaryKi) 31-Mar-1989</span>
00017 <span class="comment">    Jim Kelly (JimK) 2-Mar-1990</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment"></span>
00022 <span class="comment">--*/</span>
00023 
00024 <span class="preprocessor">#ifndef _SEP_</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define _SEP_</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include "<a class="code" href="../../d9/d8/ntos_8h.html">ntos.h</a>"</span>
00028 <span class="preprocessor">#include &lt;ntrmlsa.h&gt;</span>
00029 <span class="preprocessor">#include "seopaque.h"</span>
00030 
00031 
00032 
00034 <span class="comment">//                                                                     //</span>
00035 <span class="comment">//                SE Diagnostics                                       //</span>
00036 <span class="comment">//                                                                     //</span>
00038 <span class="comment"></span>
00039 
00040 
00041 <span class="preprocessor">#if DBG</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define SE_DIAGNOSTICS_ENABLED 1</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#endif // DBG</span>
00044 <span class="preprocessor"></span>
00045 
00046 <span class="comment">//</span>
00047 <span class="comment">// These definitions are useful diagnostics aids</span>
00048 <span class="comment">//</span>
00049 
00050 <span class="preprocessor">#if SE_DIAGNOSTICS_ENABLED</span>
00051 <span class="preprocessor"></span>
00052 <span class="comment">//</span>
00053 <span class="comment">// Test for enabled diagnostic</span>
00054 <span class="comment">//</span>
00055 
00056 <span class="preprocessor">#define IF_SE_GLOBAL( FlagName ) \</span>
00057 <span class="preprocessor">    if (SeGlobalFlag &amp; (SE_DIAG_##FlagName))</span>
00058 <span class="preprocessor"></span>
00059 <span class="comment">//</span>
00060 <span class="comment">// Diagnostics print statement</span>
00061 <span class="comment">//</span>
00062 
00063 <span class="preprocessor">#define SeDiagPrint( FlagName, _Text_ )                               \</span>
00064 <span class="preprocessor">    IF_SE_GLOBAL( FlagName )                                          \</span>
00065 <span class="preprocessor">        DbgPrint _Text_</span>
00066 <span class="preprocessor"></span>
00067 
00068 <span class="preprocessor">#else</span>
00069 <span class="preprocessor"></span>
00070 <span class="comment">//</span>
00071 <span class="comment">// diagnostics not enabled - No diagnostics included in build</span>
00072 <span class="comment">//</span>
00073 
00074 
00075 <span class="comment">//</span>
00076 <span class="comment">// Test for diagnostics enabled</span>
00077 <span class="comment">//</span>
00078 
<a name="l00079"></a><a class="code" href="../../d6/d6/sep_8h.html#a0">00079</a> <span class="preprocessor">#define IF_SE_GLOBAL( FlagName ) if (FALSE)</span>
00080 <span class="preprocessor"></span>
00081 <span class="comment">//</span>
00082 <span class="comment">// Diagnostics print statement (expands to no-op)</span>
00083 <span class="comment">//</span>
00084 
<a name="l00085"></a><a class="code" href="../../d6/d6/sep_8h.html#a1">00085</a> <span class="preprocessor">#define SeDiagPrint( FlagName, _Text_ )     ;</span>
00086 <span class="preprocessor"></span>
00087 <span class="preprocessor">#endif // SE_DIAGNOSTICS_ENABLED</span>
00088 <span class="preprocessor"></span>
00089 
00090 
00091 
00092 <span class="comment">//</span>
00093 <span class="comment">// The following flags enable or disable various diagnostic</span>
00094 <span class="comment">// capabilities within SE code.  These flags are set in</span>
00095 <span class="comment">// SeGlobalFlag (only available within a DBG system).</span>
00096 <span class="comment">//</span>
00097 <span class="comment">//      SD_TRACKING - Display information about create/deletion of</span>
00098 <span class="comment">//          shared security descriptors</span>
00099 <span class="comment">//</span>
00100 <span class="comment">//</span>
00101 
<a name="l00102"></a><a class="code" href="../../d6/d6/sep_8h.html#a2">00102</a> <span class="preprocessor">#define SE_DIAG_SD_TRACKING          ((ULONG) 0x00000001L)</span>
00103 <span class="preprocessor"></span>
00104 
00105 
00106 
00107 
00108 <span class="comment">//</span>
00109 <span class="comment">// Control flag manipulation macros</span>
00110 <span class="comment">//</span>
00111 
00112 <span class="comment">//</span>
00113 <span class="comment">//  Macro to query whether or not control flags ALL on</span>
00114 <span class="comment">//  or not (ie, returns FALSE if any of the flags are not set)</span>
00115 <span class="comment">//</span>
00116 
<a name="l00117"></a><a class="code" href="../../d6/d6/sep_8h.html#a3">00117</a> <span class="preprocessor">#define SepAreFlagsSet( Mask, Bits )                                           \</span>
00118 <span class="preprocessor">            (                                                                  \</span>
00119 <span class="preprocessor">            ((Mask) &amp; ( Bits )) == ( Bits )                                    \</span>
00120 <span class="preprocessor">            )</span>
00121 <span class="preprocessor"></span>
00122 <span class="comment">//</span>
00123 <span class="comment">//  Macro to set the specified control bits in the given Security Descriptor</span>
00124 <span class="comment">//</span>
00125 
<a name="l00126"></a><a class="code" href="../../d6/d6/sep_8h.html#a4">00126</a> <span class="preprocessor">#define SepSetFlags( Mask, Bits )                                              \</span>
00127 <span class="preprocessor">            (                                                                  \</span>
00128 <span class="preprocessor">            ( Mask ) |= ( Bits )                                               \</span>
00129 <span class="preprocessor">            )</span>
00130 <span class="preprocessor"></span>
00131 <span class="comment">//</span>
00132 <span class="comment">//  Macro to clear the passed control bits in the given Security Descriptor</span>
00133 <span class="comment">//</span>
00134 
<a name="l00135"></a><a class="code" href="../../d6/d6/sep_8h.html#a5">00135</a> <span class="preprocessor">#define SepClearFlags( Mask, Bits )                                            \</span>
00136 <span class="preprocessor">            (                                                                  \</span>
00137 <span class="preprocessor">            ( Mask ) &amp;= ~( Bits )                                              \</span>
00138 <span class="preprocessor">            )</span>
00139 <span class="preprocessor"></span>
00140 
00141 
00142 
00143 <span class="comment">//</span>
00144 <span class="comment">// Macro to determine the size of a PRIVILEGE_SET</span>
00145 <span class="comment">//</span>
00146 
<a name="l00147"></a><a class="code" href="../../d6/d6/sep_8h.html#a6">00147</a> <span class="preprocessor">#define SepPrivilegeSetSize( PrivilegeSet )                                    \</span>
00148 <span class="preprocessor">        ( ( PrivilegeSet ) == NULL ? 0 :                                       \</span>
00149 <span class="preprocessor">        ((( PrivilegeSet )-&gt;PrivilegeCount &gt; 0)                                \</span>
00150 <span class="preprocessor">         ?                                                                     \</span>
00151 <span class="preprocessor">         ((ULONG)sizeof(PRIVILEGE_SET) +                                       \</span>
00152 <span class="preprocessor">           (                                                                   \</span>
00153 <span class="preprocessor">             (( PrivilegeSet )-&gt;PrivilegeCount  -  ANYSIZE_ARRAY) *            \</span>
00154 <span class="preprocessor">             (ULONG)sizeof(LUID_AND_ATTRIBUTES)                                \</span>
00155 <span class="preprocessor">           )                                                                   \</span>
00156 <span class="preprocessor">         )                                                                     \</span>
00157 <span class="preprocessor">         : ((ULONG)sizeof(PRIVILEGE_SET) - (ULONG)sizeof(LUID_AND_ATTRIBUTES)) \</span>
00158 <span class="preprocessor">        ))</span>
00159 <span class="preprocessor"></span>
00160 
00161 <span class="comment">//</span>
00162 <span class="comment">//      Return the effective token from a SecurityContext</span>
00163 <span class="comment">//</span>
00164 
<a name="l00165"></a><a class="code" href="../../d6/d6/sep_8h.html#a7">00165</a> <span class="preprocessor">#define EffectiveToken( SubjectSecurityContext ) (                            \</span>
00166 <span class="preprocessor">                 (SubjectSecurityContext)-&gt;ClientToken ?                      \</span>
00167 <span class="preprocessor">                 (SubjectSecurityContext)-&gt;ClientToken :                      \</span>
00168 <span class="preprocessor">                 (SubjectSecurityContext)-&gt;PrimaryToken                       \</span>
00169 <span class="preprocessor">                 )                                                            \</span>
00170 <span class="preprocessor"></span>
00171 <span class="preprocessor"></span>
00172 <span class="comment">//</span>
00173 <span class="comment">//      Return a pointer to the Sid of the User of a given token</span>
00174 <span class="comment">//</span>
00175 
<a name="l00176"></a><a class="code" href="../../d6/d6/sep_8h.html#a8">00176</a> <span class="preprocessor">#define SepTokenUserSid( Token )   ((PTOKEN)(Token))-&gt;UserAndGroups-&gt;Sid</span>
00177 <span class="preprocessor"></span>
00178 
00179 <span class="comment">//</span>
00180 <span class="comment">//      Return the AuthenticationId from a given token</span>
00181 <span class="comment">//</span>
00182 
<a name="l00183"></a><a class="code" href="../../d6/d6/sep_8h.html#a9">00183</a> <span class="preprocessor">#define SepTokenAuthenticationId( Token )   (((PTOKEN)(Token))-&gt;AuthenticationId)</span>
00184 <span class="preprocessor"></span>
00185 
00186 
00187 <span class="comment">//</span>
00188 <span class="comment">//</span>
00189 <span class="comment">// BOOLEAN</span>
00190 <span class="comment">// SepBadImpersonationLevel(</span>
00191 <span class="comment">//     IN SECURITY_IMPERSONATION_LEVEL ImpersonationLevel,</span>
00192 <span class="comment">//     IN BOOLEAN ServerIsRemote</span>
00193 <span class="comment">//     )</span>
00194 <span class="comment">//</span>
00195 <span class="comment">// Routine Description:</span>
00196 <span class="comment">//</span>
00197 <span class="comment">//     Determine whether a client is trying to impersonate innappropriately</span>
00198 <span class="comment">//     This routine should only be called if a thread requesting impersonation</span>
00199 <span class="comment">//     is itself already impersonating a client of its own.  This routine</span>
00200 <span class="comment">//     indicates whether the client is attempting to violate the level of</span>
00201 <span class="comment">//     impersonation granted to it by its client.</span>
00202 <span class="comment">//</span>
00203 <span class="comment">// Arguments:</span>
00204 <span class="comment">//</span>
00205 <span class="comment">//     ImpersonationLevel - Is the impersonation level of the client's</span>
00206 <span class="comment">//         effective token.</span>
00207 <span class="comment">//</span>
00208 <span class="comment">//     ServerIsRemote - Is a boolean flag indicating whether the client</span>
00209 <span class="comment">//         is requesting impersonation services to a remote system.  TRUE</span>
00210 <span class="comment">//         indicates the session is a remote session, FALSE indicates the</span>
00211 <span class="comment">//         session is a local session.  Delegation level is necessary to</span>
00212 <span class="comment">//         achieve a remote session.</span>
00213 <span class="comment">//</span>
00214 <span class="comment">// Return Value:</span>
00215 <span class="comment">//</span>
00216 <span class="comment">//     TRUE - Indicates that the impersonation level of the client's client</span>
00217 <span class="comment">//         token is innapropriate for the attempted impersonation.</span>
00218 <span class="comment">//         An error (STATUS_BAD_IMPERSONATION_LEVEL) should be generated.</span>
00219 <span class="comment">//</span>
00220 <span class="comment">//     FALSE - Indicates the impersonation attempt is not bad, and should</span>
00221 <span class="comment">//         be allowed.</span>
00222 <span class="comment">//</span>
00223 <span class="comment">//</span>
00224 
<a name="l00225"></a><a class="code" href="../../d6/d6/sep_8h.html#a10">00225</a> <span class="preprocessor">#define SepBadImpersonationLevel(IL,SIR)  ((                                   \</span>
00226 <span class="preprocessor">            ((IL) == SecurityAnonymous) || ((IL) == SecurityIdentification) || \</span>
00227 <span class="preprocessor">            ( (SIR) &amp;&amp; ((IL) != SecurityDelegation) )                          \</span>
00228 <span class="preprocessor">            ) ? TRUE : FALSE )</span>
00229 <span class="preprocessor"></span>
00230 
00231 
00232 <span class="comment">//++</span>
00233 <span class="comment">//</span>
00234 <span class="comment">// BOOL</span>
00235 <span class="comment">// IsValidElementCount(</span>
00236 <span class="comment">//      IN ULONG Count,</span>
00237 <span class="comment">//      IN &lt;STRUCTURE&gt;</span>
00238 <span class="comment">//      );</span>
00239 <span class="comment">//</span>
00240 <span class="comment">//--</span>
00241 
<a name="l00242"></a><a class="code" href="../../d6/d6/sep_8h.html#a11">00242</a> <span class="preprocessor">#define IsValidElementCount( Count, STRUCTURE ) \</span>
00243 <span class="preprocessor">    ( Count &lt; ( (ULONG_PTR) ( (PUCHAR) ( (PUCHAR) (LONG_PTR)(LONG)0xFFFFFFFF - (PUCHAR) MM_SYSTEM_RANGE_START ) + 1 ) \</span>
00244 <span class="preprocessor">        / sizeof( STRUCTURE ) ) )</span>
00245 <span class="preprocessor"></span>
00246 
00247 
00249 <span class="comment">//                                                                       //</span>
00250 <span class="comment">//  Constants                                                            //</span>
00251 <span class="comment">//                                                                       //</span>
00253 <span class="comment"></span>
<a name="l00254"></a><a class="code" href="../../d6/d6/sep_8h.html#a12">00254</a> <span class="preprocessor">#define SEP_MAX_GROUP_COUNT 4096</span>
<a name="l00255"></a><a class="code" href="../../d6/d6/sep_8h.html#a13">00255</a> <span class="preprocessor"></span><span class="preprocessor">#define SEP_MAX_PRIVILEGE_COUNT 4096</span>
00256 <span class="preprocessor"></span>
00257 
00259 <span class="comment">//                                                                       //</span>
00260 <span class="comment">//  Private Data types                                                   //</span>
00261 <span class="comment">//                                                                       //</span>
00263 <span class="comment"></span>
00264 
<a name="l00265"></a><a class="code" href="../../d6/d6/sep_8h.html#a19">00265</a> <span class="keyword">extern</span> HANDLE <a class="code" href="../../d8/d5/seglobal_8c.html#a91">SepLsaHandle</a>;
00266 
<a name="l00267"></a><a class="code" href="../../d6/d6/sep_8h.html#a20">00267</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d3/d5/seaudit_8c.html#a1">SepAuditShutdownEvents</a>;
00268 
00269 <span class="comment">//</span>
00270 <span class="comment">// Spinlock protecting the queue of work being passed to LSA</span>
00271 <span class="comment">//</span>
00272 
<a name="l00273"></a><a class="code" href="../../d6/d6/sep_8h.html#a21">00273</a> <span class="keyword">extern</span> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d8/d5/seglobal_8c.html#a94">SepLsaQueueLock</a>;
00274 
<a name="l00275"></a><a class="code" href="../../d6/d6/sep_8h.html#a22">00275</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d8/d5/seglobal_8c.html#a96">SepLsaQueueLength</a>;
00276 
00277 <span class="comment">//</span>
00278 <span class="comment">// Doubly linked list of work items queued to worker threads.</span>
00279 <span class="comment">//</span>
00280 
<a name="l00281"></a><a class="code" href="../../d6/d6/sep_8h.html#a23">00281</a> <span class="keyword">extern</span> LIST_ENTRY <a class="code" href="../../d8/d5/seglobal_8c.html#a95">SepLsaQueue</a>;
00282 
00283 
00284 <span class="comment">// #define SepAcquireTokenReadLock(T)  KeEnterCriticalRegion();          \</span>
00285 <span class="comment">//                                     ExAcquireResourceShared(&amp;SepTokenLock, TRUE)</span>
00286 
<a name="l00287"></a><a class="code" href="../../d6/d6/sep_8h.html#a14">00287</a> <span class="preprocessor">#define SepLockLsaQueue()  KeEnterCriticalRegion();                           \</span>
00288 <span class="preprocessor">                           ExAcquireResourceExclusive(&amp;SepLsaQueueLock, TRUE)</span>
00289 <span class="preprocessor"></span>
<a name="l00290"></a><a class="code" href="../../d6/d6/sep_8h.html#a15">00290</a> <span class="preprocessor">#define SepUnlockLsaQueue() ExReleaseResource(&amp;SepLsaQueueLock);              \</span>
00291 <span class="preprocessor">                            KeLeaveCriticalRegion()</span>
00292 <span class="preprocessor"></span>
<a name="l00293"></a><a class="code" href="../../d6/d6/sep_8h.html#a16">00293</a> <span class="preprocessor">#define  SepWorkListHead()  ((PSEP_LSA_WORK_ITEM)(&amp;SepLsaQueue)-&gt;Flink)</span>
00294 <span class="preprocessor"></span>
00295 <span class="preprocessor">#ifndef ExAllocatePool</span>
<a name="l00296"></a><a class="code" href="../../d6/d6/sep_8h.html#a17">00296</a> <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePool(a,b) ExAllocatePoolWithTag(a,b,'  eS')</span>
00297 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00298 <span class="preprocessor"></span><span class="preprocessor">#ifndef ExAllocatePoolWithQuota</span>
<a name="l00299"></a><a class="code" href="../../d6/d6/sep_8h.html#a18">00299</a> <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePoolWithQuota(a,b) ExAllocatePoolWithQuotaTag(a,b,'  eS')</span>
00300 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00301 <span class="preprocessor"></span>
00302 <span class="keyword">typedef</span>
00303 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00304"></a><a class="code" href="../../d6/d6/sep_8h.html#a24">00304</a> (*PSEP_LSA_WORKER_CLEANUP_ROUTINE)(
00305     IN PVOID Parameter
00306     );
00307 
00308 
<a name="l00309"></a><a class="code" href="../../d6/d6/sep_8h.html#a77">00309</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d6/d6/sep_8h.html#a77">_SEP_LSA_WORK_ITEM_TAG</a> {
00310     <a class="code" href="../../d6/d6/sep_8h.html#a77a33">SepDeleteLogon</a>,
00311     <a class="code" href="../../d6/d6/sep_8h.html#a77a34">SepAuditRecord</a>
00312 } <a class="code" href="../../d6/d6/sep_8h.html#a25">SEP_LSA_WORK_ITEM_TAG</a>, *<a class="code" href="../../d6/d6/sep_8h.html#a26">PSEP_LSA_WORK_ITEM_TAG</a>;
00313 
00314 
00315 
00316 
00317 
<a name="l00318"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">00318</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">_SEP_LSA_WORK_ITEM</a> {
00319 
00320     <span class="comment">//</span>
00321     <span class="comment">// This field must be the first field of this structure</span>
00322     <span class="comment">//</span>
00323 
<a name="l00324"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o0">00324</a>     LIST_ENTRY                      <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o0">List</a>;
00325 
00326     <span class="comment">//</span>
00327     <span class="comment">// Command Params Memory type</span>
00328     <span class="comment">//</span>
00329 
<a name="l00330"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o1">00330</a>     SEP_RM_LSA_MEMORY_TYPE          <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o1">CommandParamsMemoryType</a>;
00331 
00332     <span class="comment">//</span>
00333     <span class="comment">// Tag describing what kind of structure we've got</span>
00334     <span class="comment">//</span>
00335 
<a name="l00336"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o2">00336</a>     <a class="code" href="../../d6/d6/sep_8h.html#a25">SEP_LSA_WORK_ITEM_TAG</a>           <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o2">Tag</a>;
00337 
00338     <span class="comment">//</span>
00339     <span class="comment">// The following union contains the data to be passed</span>
00340     <span class="comment">// to LSA.</span>
00341     <span class="comment">//</span>
00342 
00343     <span class="keyword">union </span>{
00344 
<a name="l00345"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o3">00345</a>         PVOID                       <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o3">BaseAddress</a>;
<a name="l00346"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o4">00346</a>         LUID                        <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o4">LogonId</a>;
00347 
00348     } CommandParams;
00349 
00350     <span class="comment">//</span>
00351     <span class="comment">// These fields must be filled in by the caller of SepRmCallLsa</span>
00352     <span class="comment">//</span>
00353 
<a name="l00354"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o6">00354</a>     LSA_COMMAND_NUMBER              <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o6">CommandNumber</a>;
<a name="l00355"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">00355</a>     ULONG                           <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o7">CommandParamsLength</a>;
<a name="l00356"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o8">00356</a>     PVOID                           <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o8">ReplyBuffer</a>;
<a name="l00357"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o9">00357</a>     ULONG                           <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o9">ReplyBufferLength</a>;
00358 
00359     <span class="comment">//</span>
00360     <span class="comment">// CleanupFunction (if specified) will be called with CleanupParameter</span>
00361     <span class="comment">// as its argument before the SEP_LSA_WORK_ITEM is freed by SepRmCallLsa</span>
00362     <span class="comment">//</span>
00363 
<a name="l00364"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o10">00364</a>     <a class="code" href="../../d6/d6/sep_8h.html#a24">PSEP_LSA_WORKER_CLEANUP_ROUTINE</a> <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o10">CleanupFunction</a>;
<a name="l00365"></a><a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o11">00365</a>     PVOID                           <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html#o11">CleanupParameter</a>;
00366 
00367 } <a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">SEP_LSA_WORK_ITEM</a>, *<a class="code" href="../../d8/d1/struct__SEP__LSA__WORK__ITEM.html">PSEP_LSA_WORK_ITEM</a>;
00368 
00369 
<a name="l00370"></a><a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html">00370</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html">_SEP_WORK_ITEM</a> {
00371 
<a name="l00372"></a><a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html#o0">00372</a>     <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a>  <a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html#o0">WorkItem</a>;
00373 
00374 } <a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html">SEP_WORK_ITEM</a>, *<a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html">PSEP_WORK_ITEM</a>;
00375 
<a name="l00376"></a><a class="code" href="../../d6/d6/sep_8h.html#a31">00376</a> <span class="keyword">extern</span> <a class="code" href="../../d2/d2/struct__SEP__WORK__ITEM.html">SEP_WORK_ITEM</a> <a class="code" href="../../d8/d5/seglobal_8c.html#a97">SepExWorkItem</a>;
00377 
00378 
00379 
00380 
00381 
00382 
00383 
00385 <span class="comment">//                                                                       //</span>
00386 <span class="comment">//  Private Routines                                                     //</span>
00387 <span class="comment">//                                                                       //</span>
00389 <span class="comment"></span>
00390 BOOLEAN
00391 <a class="code" href="../../d6/d6/sep_8h.html#a35">SepDevelopmentTest</a>( VOID );      <span class="comment">//Used only for development testing</span>
00392 
00393 
00394 BOOLEAN
00395 <a class="code" href="../../d6/d6/sep_8h.html#a36">SepInitializationPhase0</a>( VOID );
00396 
00397 BOOLEAN
00398 <a class="code" href="../../d6/d6/sep_8h.html#a37">SepInitializationPhase1</a>( VOID );
00399 
00400 BOOLEAN
00401 <a class="code" href="../../d8/d5/seglobal_8c.html#a100">SepVariableInitialization</a>( VOID );
00402 
00403 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00404 <a class="code" href="../../d4/d3/token_8c.html#a17">SepCreateToken</a>(
00405     OUT PHANDLE TokenHandle,
00406     IN KPROCESSOR_MODE RequestorMode,
00407     IN ACCESS_MASK DesiredAccess,
00408     IN POBJECT_ATTRIBUTES ObjectAttributes OPTIONAL,
00409     IN TOKEN_TYPE TokenType,
00410     IN SECURITY_IMPERSONATION_LEVEL ImpersonationLevel OPTIONAL,
00411     IN PLUID AuthenticationId,
00412     IN PLARGE_INTEGER ExpirationTime,
00413     IN PSID_AND_ATTRIBUTES User,
00414     IN ULONG GroupCount,
00415     IN PSID_AND_ATTRIBUTES Groups,
00416     IN ULONG GroupsLength,
00417     IN ULONG PrivilegeCount,
00418     IN PLUID_AND_ATTRIBUTES Privileges,
00419     IN ULONG PrivilegesLength,
00420     IN PSID Owner OPTIONAL,
00421     IN PSID PrimaryGroup,
00422     IN PACL DefaultDacl OPTIONAL,
00423     IN PTOKEN_SOURCE TokenSource,
00424     IN BOOLEAN SystemToken,
00425     IN PSECURITY_TOKEN_PROXY_DATA ProxyData OPTIONAL,
00426     IN PSECURITY_TOKEN_AUDIT_DATA AuditData OPTIONAL
00427     );
00428 
00429 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00430 <a class="code" href="../../d6/d6/sep_8h.html#a40">SepReferenceLogonSession</a>(
00431     IN PLUID LogonId
00432     );
00433 
00434 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00435 <a class="code" href="../../d6/d6/sep_8h.html#a41">SepDeReferenceLogonSession</a>(
00436     IN PLUID LogonId
00437     );
00438 
00439 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00440 <a class="code" href="../../d6/d6/sep_8h.html#a42">SepLockSubjectContext</a>(
00441     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext
00442     );
00443 
00444 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00445 <a class="code" href="../../d6/d6/sep_8h.html#a43">SepFreeSubjectContext</a>(
00446     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext
00447     );
00448 
00449 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00450 <a class="code" href="../../d0/d8/subject_8c.html#a4">SepGetDefaultsSubjectContext</a>(
00451     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext,
00452     OUT PSID *Owner,
00453     OUT PSID *Group,
00454     OUT PSID *ServerOwner,
00455     OUT PSID *ServerGroup,
00456     OUT PACL *Dacl
00457     );
00458 
00459 BOOLEAN
00460 <a class="code" href="../../d0/d8/subject_8c.html#a6">SepValidOwnerSubjectContext</a>(
00461     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext,
00462     IN PSID Owner,
00463     IN BOOLEAN ServerObject
00464     );
00465 
00466 BOOLEAN
00467 <a class="code" href="../../d0/d8/subject_8c.html#a5">SepIdAssignableAsGroup</a>(
00468     IN PACCESS_TOKEN Token,
00469     IN PSID Group
00470     );
00471 
00472 BOOLEAN
00473 <a class="code" href="../../d6/d6/sep_8h.html#a47">SepCheckAcl</a> (
00474     IN PACL Acl,
00475     IN ULONG Length
00476     );
00477 
00478 BOOLEAN
00479 <a class="code" href="../../d6/d6/sep_8h.html#a48">SepAuditAlarm</a> (
00480     IN PUNICODE_STRING SubsystemName,
00481     IN PVOID HandleId,
00482     IN PUNICODE_STRING ObjectTypeName,
00483     IN PUNICODE_STRING ObjectName,
00484     IN PSECURITY_DESCRIPTOR SecurityDescriptor,
00485     IN ACCESS_MASK DesiredAccess,
00486     IN BOOLEAN ObjectCreation,
00487     IN ACCESS_MASK GrantedAccess,
00488     OUT PBOOLEAN GenerateOnClose
00489     );
00490 
00491 BOOLEAN
00492 <a class="code" href="../../d6/d6/sep_8h.html#a49">SepSinglePrivilegeCheck</a> (
00493    LUID DesiredPrivilege,
00494    IN PACCESS_TOKEN EffectiveToken,
00495    IN KPROCESSOR_MODE PreviousMode
00496    );
00497 
00498 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00499 <a class="code" href="../../d6/d6/sep_8h.html#a50">SepRmCallLsa</a>(
00500     PSEP_WORK_ITEM SepWorkItem
00501     );
00502 
00503 BOOLEAN
00504 <a class="code" href="../../d6/d6/sep_8h.html#a51">SepInitializeWorkList</a>(
00505     VOID
00506     );
00507 
00508 BOOLEAN
00509 <a class="code" href="../../d0/d0/rmmain_8c.html#a7">SepRmInitPhase0</a>(
00510     );
00511 
00512 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00513 <a class="code" href="../../d6/d6/sep_8h.html#a53">SepConcatenatePrivileges</a>(
00514     IN PPRIVILEGE_SET TargetPrivilegeSet,
00515     IN ULONG TargetBufferSize,
00516     IN PPRIVILEGE_SET SourcePrivilegeSet
00517     );
00518 
00519 BOOLEAN
00520 <a class="code" href="../../d6/d6/sep_8h.html#a54">SepTokenIsOwner</a>(
00521     IN PACCESS_TOKEN Token,
00522     IN PSECURITY_DESCRIPTOR SecurityDescriptor,
00523     IN BOOLEAN TokenLocked
00524     );
00525 
00526 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00527 <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a> (
00528     IN PACL Acl
00529     );
00530 
00531 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00532 <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(
00533     IN PSID Sid
00534     );
00535 
00536 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00537 <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>(
00538     IN PSECURITY_DESCRIPTOR SecurityDescriptor,
00539     IN PSZ TitleString
00540     );
00541 
00542 BOOLEAN
00543 <a class="code" href="../../d6/d6/sep_8h.html#a58">SepSidTranslation</a>(
00544     PSID Sid,
00545     PSTRING AccountName
00546     );
00547 
00548 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00549 <a class="code" href="../../d6/d6/sep_8h.html#a59">SepDumpTokenInfo</a>(
00550     IN PACCESS_TOKEN Token
00551     );
00552 
00553 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00554 <a class="code" href="../../d6/d6/sep_8h.html#a60">SepDumpString</a>(
00555     IN PUNICODE_STRING String
00556     );
00557 
00558 BOOLEAN
00559 <a class="code" href="../../d6/d6/sep_8h.html#a61">SepSidInToken</a> (
00560     IN PACCESS_TOKEN Token,
00561     IN PSID PrincipalSelfSid,
00562     IN PSID Sid,
00563     IN BOOLEAN DenyAce
00564     );
00565 
00566 
00567 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00568 <a class="code" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a>(
00569     IN PACL Sacl,
00570     IN PACCESS_TOKEN Token,
00571     IN ACCESS_MASK DesiredAccess,
00572     IN BOOLEAN AccessGranted,
00573     OUT PBOOLEAN GenerateAudit,
00574     OUT PBOOLEAN GenerateAlarm
00575     );
00576 
00577 
00578 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00579 <a class="code" href="../../d6/d6/sep_8h.html#a63">SepCopyString</a> (
00580     IN PUNICODE_STRING SourceString,
00581     OUT PUNICODE_STRING *DestString
00582     );
00583 
00584 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00585 <a class="code" href="../../d6/d6/sep_8h.html#a64">SepAssemblePrivileges</a>(
00586     IN ULONG PrivilegeCount,
00587     IN BOOLEAN SystemSecurity,
00588     IN BOOLEAN WriteOwner,
00589     OUT PPRIVILEGE_SET *Privileges
00590     );
00591 
00592 
00593 PUNICODE_STRING
00594 <a class="code" href="../../d7/d6/sepaudit_8c.html#a18">SepQueryTypeString</a>(
00595     IN PVOID Object
00596     );
00597 
00598 
00599 POBJECT_NAME_INFORMATION
00600 <a class="code" href="../../d7/d6/sepaudit_8c.html#a17">SepQueryNameString</a>(
00601     IN PVOID Object
00602     );
00603 
00604 BOOLEAN
00605 <a class="code" href="../../d6/d6/sep_8h.html#a67">SepFilterPrivilegeAudits</a>(
00606     IN PPRIVILEGE_SET PrivilegeSet
00607     );
00608 
00609 BOOLEAN
00610 <a class="code" href="../../d6/d6/sep_8h.html#a68">SepQueueWorkItem</a>(
00611     IN PSEP_LSA_WORK_ITEM LsaWorkItem,
00612     IN BOOLEAN ForceQueue
00613     );
00614 
00615 <a class="code" href="../../d6/d6/sep_8h.html#a28">PSEP_LSA_WORK_ITEM</a>
00616 <a class="code" href="../../d0/d5/adtlog_8c.html#a6">SepDequeueWorkItem</a>(
00617     VOID
00618     );
00619 
00620 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00621 <a class="code" href="../../d7/d6/sepaudit_8c.html#a22">SepAdtGenerateDiscardAudit</a>(
00622     VOID
00623     );
00624 
00625 BOOLEAN
00626 <a class="code" href="../../d6/d6/sep_8h.html#a70">SepAdtValidateAuditBounds</a>(
00627     ULONG Upper,
00628     ULONG Lower
00629     );
00630 
00631 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00632 <a class="code" href="../../d6/d6/sep_8h.html#a71">SepAdtInitializeCrashOnFail</a>(
00633     VOID
00634     );
00635 
00636 BOOLEAN
00637 <a class="code" href="../../d6/d6/sep_8h.html#a72">SepAdtInitializePrivilegeAuditing</a>(
00638     VOID
00639     );
00640 
00641 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00642 <a class="code" href="../../d6/d6/sep_8h.html#a73">SepCopyProxyData</a> (
00643     OUT PSECURITY_TOKEN_PROXY_DATA * DestProxyData,
00644     IN PSECURITY_TOKEN_PROXY_DATA SourceProxyData
00645     );
00646 
00647 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00648 <a class="code" href="../../d6/d6/sep_8h.html#a74">SepFreeProxyData</a> (
00649     IN PSECURITY_TOKEN_PROXY_DATA ProxyData
00650     );
00651 
00652 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00653 <a class="code" href="../../d6/d6/sep_8h.html#a75">SepProbeAndCaptureQosData</a>(
00654     IN PSECURITY_ADVANCED_QUALITY_OF_SERVICE CapturedSecurityQos
00655     );
00656 
00657 PACCESS_TOKEN
00658 <a class="code" href="../../d6/d6/sep_8h.html#a76">SeMakeAnonymousToken</a> ();
00659 
00660 <span class="preprocessor">#endif // _SEP_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:46 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
