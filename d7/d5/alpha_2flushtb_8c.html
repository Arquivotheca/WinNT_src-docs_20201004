<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: alpha/flushtb.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flushtb.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d8/d4/alpha_2flushtb_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a0">KiFlushEntireTbTarget</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a1">KiFlushMultipleTbTarget</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Number, IN PVOID Virtual, IN PVOID Pid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a2">KiFlushSingleTbTarget</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Virtual, IN PVOID Pid, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a3">KiFlushMultipleTbTarget64</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Number, IN PVOID Virtual, IN PVOID Pid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a4">KiFlushSingleTbTarget64</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Virtual, IN PVOID Pid, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a5">KeFlushEntireTb</a> (IN BOOLEAN Invalid, IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a6">KeFlushMultipleTb</a> (IN ULONG Number, IN PVOID *Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE *PtePointer OPTIONAL, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HARDWARE_PTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a7">KeFlushSingleTb</a> (IN PVOID Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE PtePointer, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a8">KeFlushMultipleTb64</a> (IN ULONG Number, IN PULONG_PTR Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE *PtePointer OPTIONAL, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HARDWARE_PTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/alpha_2flushtb_8c.html#a9">KeFlushSingleTb64</a> (IN ULONG_PTR Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE PtePointer, IN HARDWARE_PTE PteValue)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="alpha/flushtb.c::KeFlushEntireTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushEntireTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">86</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00188">KiFlushEntireTbTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>.
<p>
<pre class="fragment"><div>00093                    :
00094 
00095     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer (TB) on all
00096     processors that are currently running threads which are children
00097     of the current process or flushes the entire translation buffer
00098     on all processors in the host configuration.
00099 
00100 Arguments:
00101 
00102     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies the reason for
00103         flushing the translation buffer.
00104 
00105     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00106         translation buffers are to be flushed.
00107 
00108 Return Value:
00109 
00110     None.
00111 
00112 --*/
00113 
00114 {
00115 
00116     KIRQL OldIrql;
00117     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00118     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00119     KAFFINITY TargetProcessors;
00120 
00121     <span class="comment">//</span>
00122     <span class="comment">// Compute the target set of processors, disable context switching,</span>
00123     <span class="comment">// and send the flush entire parameters to the target processors,</span>
00124     <span class="comment">// if any, for execution.</span>
00125     <span class="comment">//</span>
00126 
00127 <span class="preprocessor">#if defined(NT_UP)</span>
00128 <span class="preprocessor"></span>
00129     __tbia();
00130 
00131 <span class="preprocessor">#else</span>
00132 <span class="preprocessor"></span>
00133     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00134         OldIrql = KeRaiseIrqlToSynchLevel();
00135         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00136 
00137     } <span class="keywordflow">else</span> {
00138         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00139         Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00140         Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00141         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00142         <span class="keywordflow">if</span> (TargetProcessors != Process-&gt;RunOnProcessors) {
00143             Process-&gt;ProcessSequence = KiMasterSequence - 1;
00144         }
00145     }
00146 
00147     TargetProcessors &amp;= PCR-&gt;NotMember;
00148     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00149         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00150                         KiFlushEntireTbTarget,
00151                         NULL,
00152                         NULL,
00153                         NULL);
00154     }
00155 
00156     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushEntireTb);
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">// Flush TB on current processor.</span>
00160     <span class="comment">//</span>
00161 
00162     <span class="comment">// KeFlushCurrentTb();</span>
00163     __tbia();
00164 
00165     <span class="comment">//</span>
00166     <span class="comment">// Wait until all target processors have finished.</span>
00167     <span class="comment">//</span>
00168 
00169     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00170         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00171     }
00172 
00173     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00174         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00175     } <span class="keywordflow">else</span> {
00176         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00177     }
00178 
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>
00181     <span class="keywordflow">return</span>;
00182 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="alpha/flushtb.c::KeFlushMultipleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushMultipleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE *PtePointer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">231</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a115">KiFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00353">KiFlushMultipleTbTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00242                    :
00243 
00244     This function flushes multiple entries from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00245     on all processors that are currently running threads which are
00246     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a multiple entries from
00247     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00248 
00249 Arguments:
00250 
00251     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00252 
00253     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> addresses that
00254         are within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pages whose <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entries are to be
00255         flushed.
00256 
00257     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00258         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00259 
00260     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00261         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00262 
00263     PtePointer - Supplies an optional pointer to an array of pointers to
00264        page table entries that receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry
00265        value.
00266 
00267     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00268 
00269 Return Value:
00270 
00271     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00272     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00273 
00274 --*/
00275 
00276 {
00277 
00278     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00279     KIRQL OldIrql;
00280     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00281     KAFFINITY TargetProcessors;
00282     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// Compute the target set of processors and send the flush multiple</span>
00286     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00287     <span class="comment">//</span>
00288 
00289     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00290         OldIrql = KeRaiseIrqlToSynchLevel();
00291         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00292 
00293     } <span class="keywordflow">else</span> {
00294         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00295         Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00296         Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00297         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00298         <span class="keywordflow">if</span> (TargetProcessors != Process-&gt;RunOnProcessors) {
00299             Process-&gt;ProcessSequence = KiMasterSequence - 1;
00300         }
00301     }
00302 
00303     <span class="comment">//</span>
00304     <span class="comment">// If a page table entry address address is specified, then set the</span>
00305     <span class="comment">// specified page table entries to the specific value.</span>
00306     <span class="comment">//</span>
00307 
00308     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00309         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00310             *PtePointer[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = PteValue;
00311         }
00312     }
00313 
00314     TargetProcessors &amp;= PCR-&gt;NotMember;
00315     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00316         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00317                         KiFlushMultipleTbTarget,
00318                         ULongToPtr(Number),
00319                         (PVOID)Virtual,
00320                         NULL);
00321     }
00322 
00323     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushMultipleTb);
00324 
00325     <span class="comment">//</span>
00326     <span class="comment">// Flush the specified entries from the TB on the current processor.</span>
00327     <span class="comment">//</span>
00328 
00329     <a class="code" href="../../d0/d0/ki_8h.html#a115">KiFlushMultipleTb</a>(Invalid, &amp;Virtual[0], Number);
00330 
00331     <span class="comment">//</span>
00332     <span class="comment">// Wait until all target processors have finished.</span>
00333     <span class="comment">//</span>
00334 
00335     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00336         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00337     }
00338 
00339     <span class="comment">//</span>
00340     <span class="comment">// If the context swap lock was acquired, release it.</span>
00341     <span class="comment">//</span>
00342     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00343         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00344 
00345     } <span class="keywordflow">else</span> {
00346         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00347     }
00348 
00349     <span class="keywordflow">return</span>;
00350 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="alpha/flushtb.c::KeFlushMultipleTb64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushMultipleTb64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE *PtePointer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">587</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00733">KiFlushMultipleTbTarget64()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00598                    :
00599 
00600     This function flushes multiple entries from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00601     on all processors that are currently running threads which are
00602     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a multiple entries from
00603     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00604 
00605 Arguments:
00606 
00607     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00608 
00609     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> page numbers that
00610         are flushed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB.
00611 
00612     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00613         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00614 
00615     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00616         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00617 
00618     PtePointer - Supplies an optional pointer to an array of pointers to
00619        page table entries that receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry
00620        value.
00621 
00622     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00623 
00624 Return Value:
00625 
00626     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00627     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00628 
00629 --*/
00630 
00631 {
00632 
00633     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00634     KIRQL OldIrql;
00635     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00636     KAFFINITY TargetProcessors;
00637     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00638 
00639     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Number &lt;= FLUSH_MULTIPLE_MAXIMUM);
00640 
00641     <span class="comment">//</span>
00642     <span class="comment">// Compute the target set of processors.</span>
00643     <span class="comment">//</span>
00644 
00645 <span class="preprocessor">#if defined(NT_UP)</span>
00646 <span class="preprocessor"></span>
00647     OldIrql = KeRaiseIrqlToSynchLevel();
00648 
00649 <span class="preprocessor">#else</span>
00650 <span class="preprocessor"></span>
00651     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00652         OldIrql = KeRaiseIrqlToSynchLevel();
00653         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00654 
00655     } <span class="keywordflow">else</span> {
00656         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00657         Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00658         Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00659         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00660         <span class="keywordflow">if</span> (TargetProcessors != Process-&gt;RunOnProcessors) {
00661             Process-&gt;ProcessSequence = KiMasterSequence - 1;
00662         }
00663     }
00664 
00665     TargetProcessors &amp;= PCR-&gt;NotMember;
00666 
00667 <span class="preprocessor">#endif</span>
00668 <span class="preprocessor"></span>
00669     <span class="comment">//</span>
00670     <span class="comment">// If a page table entry address array is specified, then set the</span>
00671     <span class="comment">// specified page table entries to the specific value.</span>
00672     <span class="comment">//</span>
00673 
00674     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00675         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00676             *PtePointer[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = PteValue;
00677         }
00678     }
00679 
00680     <span class="comment">//</span>
00681     <span class="comment">// If any target processors are specified, then send a flush multiple</span>
00682     <span class="comment">// packet to the target set of processor.</span>
00683     <span class="comment">//</span>
00684 
00685 <span class="preprocessor">#if !defined(NT_UP)</span>
00686 <span class="preprocessor"></span>
00687     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00688         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00689                         KiFlushMultipleTbTarget64,
00690                         ULongToPtr(Number),
00691                         (PVOID)Virtual,
00692                         NULL);
00693     }
00694 
00695 <span class="preprocessor">#endif</span>
00696 <span class="preprocessor"></span>
00697     <span class="comment">//</span>
00698     <span class="comment">// Flush the specified entries from the TB on the current processor.</span>
00699     <span class="comment">//</span>
00700 
00701     KiFlushMultipleTb64(Invalid, &amp;Virtual[0], Number);
00702 
00703     <span class="comment">//</span>
00704     <span class="comment">// Wait until all target processors have finished.</span>
00705     <span class="comment">//</span>
00706 
00707 <span class="preprocessor">#if defined(NT_UP)</span>
00708 <span class="preprocessor"></span>
00709     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00710 
00711 <span class="preprocessor">#else</span>
00712 <span class="preprocessor"></span>
00713     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00714         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00715     }
00716 
00717     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00718         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00719 
00720     } <span class="keywordflow">else</span> {
00721         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00722     }
00723 
00724 <span class="preprocessor">#endif</span>
00725 <span class="preprocessor"></span>
00726     <span class="keywordflow">return</span>;
00727 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="alpha/flushtb.c::KeFlushSingleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HARDWARE_PTE KeFlushSingleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PtePointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">420</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00535">KiFlushSingleTbTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00430                    :
00431 
00432     This function flushes a single entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00433     on all processors that are currently running threads which are
00434     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a single entry from
00435     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00436 
00437 Arguments:
00438 
00439     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> address that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page whose
00440         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be flushed.
00441 
00442     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00443         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00444 
00445     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00446         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00447 
00448     PtePointer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page table entry which
00449         receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified value.
00450 
00451     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00452 
00453 Return Value:
00454 
00455     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00456     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00457 
00458 --*/
00459 
00460 {
00461 
00462     KIRQL OldIrql;
00463     HARDWARE_PTE OldPte;
00464     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00465     KAFFINITY TargetProcessors;
00466     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00467 
00468     <span class="comment">//</span>
00469     <span class="comment">// Compute the target set of processors and send the flush single</span>
00470     <span class="comment">// paramters to the target processors, if any, for execution.</span>
00471     <span class="comment">//</span>
00472 
00473     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00474         OldIrql = KeRaiseIrqlToSynchLevel();
00475         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00476 
00477     } <span class="keywordflow">else</span> {
00478         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00479         Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00480         Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00481         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00482         <span class="keywordflow">if</span> (TargetProcessors != Process-&gt;RunOnProcessors) {
00483             Process-&gt;ProcessSequence = KiMasterSequence - 1;
00484         }
00485     }
00486 
00487     <span class="comment">//</span>
00488     <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00489     <span class="comment">// page table entry to the new value.</span>
00490     <span class="comment">//</span>
00491 
00492     OldPte = *PtePointer;
00493     *PtePointer = PteValue;
00494     TargetProcessors &amp;= PCR-&gt;NotMember;
00495     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00496         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00497                         KiFlushSingleTbTarget,
00498                         (PVOID)Virtual,
00499                         NULL,
00500                         NULL);
00501     }
00502 
00503     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushSingleTb);
00504 
00505     <span class="comment">//</span>
00506     <span class="comment">// Flush the specified entry from the TB on the current processor.</span>
00507     <span class="comment">//</span>
00508 
00509 <span class="comment">//    KiFlushSingleTb(Invalid, Virtual);</span>
00510     __tbis(Virtual);
00511 
00512     <span class="comment">//</span>
00513     <span class="comment">// Wait until all target processors have finished.</span>
00514     <span class="comment">//</span>
00515 
00516     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00517         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00518     }
00519 
00520     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00521         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00522 
00523     } <span class="keywordflow">else</span> {
00524         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00525     }
00526 
00527     <span class="comment">//</span>
00528     <span class="comment">// return the previous page table entry value.</span>
00529     <span class="comment">//</span>
00530 
00531     <span class="keywordflow">return</span> OldPte;
00532 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="alpha/flushtb.c::KeFlushSingleTb64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HARDWARE_PTE KeFlushSingleTb64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PtePointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">797</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00932">KiFlushSingleTbTarget64()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00807                    :
00808 
00809     This function flushes a single entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00810     on all processors that are currently running threads which are
00811     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a single entry from
00812     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00813 
00814 Arguments:
00815 
00816     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> page number that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB.
00817 
00818     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00819         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00820 
00821     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00822         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00823 
00824     PtePointer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page table entry which
00825         receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified value.
00826 
00827     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00828 
00829 Return Value:
00830 
00831     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00832     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00833 
00834 --*/
00835 
00836 {
00837 
00838     KIRQL OldIrql;
00839     HARDWARE_PTE OldPte;
00840     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00841     KAFFINITY TargetProcessors;
00842     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00843 
00844     <span class="comment">//</span>
00845     <span class="comment">// Compute the target set of processors.</span>
00846     <span class="comment">//</span>
00847 
00848 <span class="preprocessor">#if defined(NT_UP)</span>
00849 <span class="preprocessor"></span>
00850     OldIrql = KeRaiseIrqlToSynchLevel();
00851 
00852 <span class="preprocessor">#else</span>
00853 <span class="preprocessor"></span>
00854     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00855         OldIrql = KeRaiseIrqlToSynchLevel();
00856         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00857 
00858     } <span class="keywordflow">else</span> {
00859         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00860         Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00861         Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00862         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00863         <span class="keywordflow">if</span> (TargetProcessors != Process-&gt;RunOnProcessors) {
00864             Process-&gt;ProcessSequence = KiMasterSequence - 1;
00865         }
00866     }
00867 
00868     TargetProcessors &amp;= PCR-&gt;NotMember;
00869 
00870 <span class="preprocessor">#endif</span>
00871 <span class="preprocessor"></span>
00872     <span class="comment">//</span>
00873     <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00874     <span class="comment">// page table entry to the new value.</span>
00875     <span class="comment">//</span>
00876 
00877     OldPte = *PtePointer;
00878     *PtePointer = PteValue;
00879 
00880     <span class="comment">//</span>
00881     <span class="comment">// If any target processors are specified, then send a flush single</span>
00882     <span class="comment">// packet to the target set of processors.</span>
00883 
00884 <span class="preprocessor">#if !defined(NT_UP)</span>
00885 <span class="preprocessor"></span>
00886     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00887         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00888                         KiFlushSingleTbTarget64,
00889                         (PVOID)Virtual,
00890                         NULL,
00891                         NULL);
00892     }
00893 
00894 <span class="preprocessor">#endif</span>
00895 <span class="preprocessor"></span>
00896     <span class="comment">//</span>
00897     <span class="comment">// Flush the specified entry from the TB on the current processor.</span>
00898     <span class="comment">//</span>
00899 
00900     KiFlushSingleTb64(Invalid, Virtual);
00901 
00902     <span class="comment">//</span>
00903     <span class="comment">// Wait until all target processors have finished.</span>
00904     <span class="comment">//</span>
00905 
00906 <span class="preprocessor">#if defined(NT_UP)</span>
00907 <span class="preprocessor"></span>
00908     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00909 
00910 <span class="preprocessor">#else</span>
00911 <span class="preprocessor"></span>
00912     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00913         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00914     }
00915 
00916     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00917         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00918 
00919     } <span class="keywordflow">else</span> {
00920         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00921     }
00922 
00923 <span class="preprocessor">#endif</span>
00924 <span class="preprocessor"></span>
00925     <span class="keywordflow">return</span> OldPte;
00926 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="alpha/flushtb.c::KiFlushEntireTbTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushEntireTbTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00188">188</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00733">KiGetNewRid()</a>.
<p>
<pre class="fragment"><div>00197                    :
00198 
00199     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire TB.
00200 
00201 Arguments:
00202 
00203     SignalDone - Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00204         requested operation has been performed.
00205 
00206     Parameter1 - Parameter3 - not used
00207 
00208 Return Value:
00209 
00210     None.
00211 
00212 --*/
00213 
00214 {
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">// Flush the entire TB on the current processor</span>
00218     <span class="comment">//</span>
00219 
00220     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00221 
00222     <span class="comment">// KeFlushCurrentTb();</span>
00223     __tbia();
00224 
00225     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushEntireTb);
00226 
00227     <span class="keywordflow">return</span>;
00228 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="alpha/flushtb.c::KiFlushMultipleTbTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushMultipleTbTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Pid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00353">353</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d0/ki_8h.html#a115">KiFlushMultipleTb()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>.
<p>
<pre class="fragment"><div>00362                    :
00363 
00364     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing multiple TB entries.
00365 
00366 Arguments:
00367 
00368     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00369         requested operation has been performed.
00370 
00371     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00372 
00373     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> addresses that
00374         are within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pages whose <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entries are to be
00375         flushed.
00376 
00377     Pid - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PID of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB entries to flush.
00378 
00379 Return Value:
00380 
00381     None.
00382 
00383 --*/
00384 
00385 {
00386 
00387     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00388     ULONG Limit;
00389     PVOID Array[FLUSH_MULTIPLE_MAXIMUM];
00390 
00391     <span class="comment">//</span>
00392     <span class="comment">// Flush multiple entries from the TB on the current processor</span>
00393     <span class="comment">//</span>
00394 
00395     <span class="comment">//</span>
00396     <span class="comment">// Capture the virtual addresses that are to be flushed from the TB</span>
00397     <span class="comment">// on the current processor and clear the packet address.</span>
00398     <span class="comment">//</span>
00399 
00400     Limit = (ULONG)((ULONG_PTR)Number);
00401     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Limit; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00402         Array[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = ((PVOID *)(<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a>))[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00403     }
00404 
00405     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00406 
00407     <span class="comment">//</span>
00408     <span class="comment">// Flush the specified virtual addresses from the TB on the current</span>
00409     <span class="comment">// processor.</span>
00410     <span class="comment">//</span>
00411 
00412     <a class="code" href="../../d0/d0/ki_8h.html#a115">KiFlushMultipleTb</a>(TRUE, &amp;Array[0], Limit);
00413 
00414     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushMultipleTb);
00415 
00416     <span class="keywordflow">return</span>;
00417 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="alpha/flushtb.c::KiFlushMultipleTbTarget64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushMultipleTbTarget64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Pid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00733">733</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">KeFlushMultipleTb64()</a>.
<p>
<pre class="fragment"><div>00742                    :
00743 
00744     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing multiple TB entries.
00745 
00746 Arguments:
00747 
00748     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00749         requested operation has been performed.
00750 
00751     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00752 
00753     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> page numbers that
00754         are flushed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB.
00755 
00756     Pid - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PID of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB entries to flush.
00757 
00758 Return Value:
00759 
00760     None.
00761 
00762 --*/
00763 
00764 {
00765 
00766     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00767     ULONG Limit;
00768     ULONG_PTR Array[FLUSH_MULTIPLE_MAXIMUM];
00769 
00770     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((ULONG_PTR)Number &lt;= FLUSH_MULTIPLE_MAXIMUM);
00771 
00772     <span class="comment">//</span>
00773     <span class="comment">// Capture the virtual addresses that are to be flushed from the TB</span>
00774     <span class="comment">// on the current processor and clear the packet address.</span>
00775     <span class="comment">//</span>
00776 
00777     Limit = (ULONG)((ULONG_PTR)Number);
00778     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Limit; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00779         Array[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = ((PULONG_PTR)(<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a>))[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00780     }
00781 
00782     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00783 
00784     <span class="comment">//</span>
00785     <span class="comment">// Flush the specified virtual addresses from the TB on the current</span>
00786     <span class="comment">// processor.</span>
00787     <span class="comment">//</span>
00788 
00789     KiFlushMultipleTb64(TRUE, &amp;Array[0], Limit);
00790     <span class="keywordflow">return</span>;
00791 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="alpha/flushtb.c::KiFlushSingleTbTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushSingleTbTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Pid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00535">535</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>.
<p>
<pre class="fragment"><div>00544                    :
00545 
00546     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing a single TB entry.
00547 
00548 Arguments:
00549 
00550     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00551         requested operation has been performed.
00552 
00553     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> address that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page whose
00554         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be flushed.
00555 
00556     RequestPacket - Supplies a pointer to a flush single TB packet address.
00557 
00558     Pid - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PID of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB entries to flush.
00559 
00560     Parameter3 - Not used.
00561 
00562 Return Value:
00563 
00564     None.
00565 
00566 --*/
00567 
00568 {
00569 
00570     <span class="comment">//</span>
00571     <span class="comment">// Flush a single entry form the TB on the current processor.</span>
00572     <span class="comment">//</span>
00573 
00574     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00575 <span class="comment">//    KiFlushSingleTb(TRUE, Virtual);</span>
00576     __tbis(Virtual);
00577 
00578     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushSingleTb);
00579 
00580     <span class="keywordflow">return</span>;
00581 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="alpha/flushtb.c::KiFlushSingleTbTarget64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushSingleTbTarget64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Pid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00932">932</a> of file <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html">alpha/flushtb.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">KeFlushSingleTb64()</a>.
<p>
<pre class="fragment"><div>00941                    :
00942 
00943     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing a single TB entry.
00944 
00945 Arguments:
00946 
00947     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00948         requested operation has been performed.
00949 
00950     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> page number that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TB.
00951 
00952     RequestPacket - Supplies a pointer to a flush single TB packet address.
00953 
00954     Pid - Not used.
00955 
00956     Parameter3 - Not used.
00957 
00958 Return Value:
00959 
00960     None.
00961 
00962 --*/
00963 
00964 {
00965 
00966     <span class="comment">//</span>
00967     <span class="comment">// Flush a single entry form the TB on the current processor.</span>
00968     <span class="comment">//</span>
00969 
00970     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00971     KiFlushSingleTb64(TRUE, (ULONG_PTR)Virtual);
00972     <span class="keywordflow">return</span>;
00973 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
