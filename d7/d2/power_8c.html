<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: power.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>power.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include &lt;ntcsrmsg.h&gt;</code><br>
<code>#include "<a class="el" href="../../d3/d9/csrmsg_8h-source.html">csrmsg.h</a>"</code><br>
<code>#include "ntddvdeo.h"</code><br>

<p>
<a href="../../d8/d1/power_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">tagPOWERREQUEST</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">tagPOWERREQUEST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a6">POWERREQUEST</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">tagPOWERREQUEST</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a7">PPOWERREQUEST</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>__inline VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a11">CancelPowerRequest</a> (<a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> pPowerRequest)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a12">QueuePowerRequest</a> (<a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a> Parms)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a13">UnqueuePowerRequest</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a14">InitializePowerRequestList</a> (HANDLE hPowerRequestEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a15">CleanupPowerRequestList</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a16">DeletePowerRequestList</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a17">xxxUserPowerEventCalloutWorker</a> (<a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a> Parms)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a18">UserPowerEventCallout</a> (<a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a> Parms)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a19">xxxUserPowerStateCalloutWorker</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a20">UserPowerStateCallout</a> (<a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">PKWIN32_POWERSTATE_PARAMETERS</a> Parms)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a21">xxxUserPowerCalloutWorker</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a22">VideoPortCalloutThread</a> (PVIDEO_WIN32K_CALLBACKS_PARAMS Params)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a23">VideoPortCallout</a> (IN PVOID Params)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a0">gbUserInitialized</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a1">fGdiEnabled</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a2">gPowerRequestList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a4">gpEventPowerRequest</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a5">gbHibernate</a> = FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/power_8c.html#a8">gpPowerRequestCurrent</a></td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a6" doxytag="power.c::POWERREQUEST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">tagPOWERREQUEST</a>  <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">POWERREQUEST</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="power.c::PPOWERREQUEST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">tagPOWERREQUEST</a> * <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00216">CleanupPowerRequestList()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00152">UnqueuePowerRequest()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="power.c::CancelPowerRequest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CancelPowerRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pPowerRequest</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00058">58</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d1/power_8c-source.html#l00031">tagPOWERREQUEST::Event</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00034">EVENT_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00036">gpPowerRequestCurrent</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00032">tagPOWERREQUEST::Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00216">CleanupPowerRequestList()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.
<p>
<pre class="fragment"><div>00060 {
00061     UserAssert(pPowerRequest != gpPowerRequestCurrent);
00062     pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o2">Status</a> = STATUS_UNSUCCESSFUL;
00063     <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o1">Event</a>, EVENT_INCREMENT, FALSE);
00064 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="power.c::CleanupPowerRequestList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CleanupPowerRequestList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00216">216</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d1/power_8c-source.html#l00058">CancelPowerRequest()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00925">gbNoMorePowerCallouts</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00025">gpPowerRequestMutex</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d2/power_8c.html#a7">PPOWERREQUEST</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00152">UnqueuePowerRequest()</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02087">CleanupResources()</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02146">InitiateWin32kCleanup()</a>.
<p>
<pre class="fragment"><div>00217 {
00218     <a class="code" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> pPowerRequest;
00219 
00220     <span class="comment">/*</span>
00221 <span class="comment">     * Make sure no new power requests come in.</span>
00222 <span class="comment">     */</span>
00223     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a324">gbNoMorePowerCallouts</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00224 
00225     <span class="comment">/*</span>
00226 <span class="comment">     * If we never allocated anything, there's nothing to clean up.</span>
00227 <span class="comment">     */</span>
00228     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00229         <span class="keywordflow">return</span>;
00230     }
00231 
00232     <span class="comment">/*</span>
00233 <span class="comment">     * Mark any pending power requests as cacelled.</span>
00234 <span class="comment">     */</span>
00235     <span class="keywordflow">while</span> ((pPowerRequest = <a class="code" href="../../d7/d2/power_8c.html#a13">UnqueuePowerRequest</a>()) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00236         <a class="code" href="../../d7/d2/power_8c.html#a11">CancelPowerRequest</a>(pPowerRequest);
00237     }
00238 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="power.c::DeletePowerRequestList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DeletePowerRequestList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00250">250</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d1/power_8c-source.html#l00024">gPowerRequestList</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00025">gpPowerRequestMutex</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00097">Win32kNtUserCleanup()</a>.
<p>
<pre class="fragment"><div>00251 {
00252     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a>) {
00253 
00254         <span class="comment">/*</span>
00255 <span class="comment">         * Make sure there are no pending power requests.</span>
00256 <span class="comment">         */</span>
00257         UserAssert(IsListEmpty(&amp;gPowerRequestList));
00258 
00259         <span class="comment">/*</span>
00260 <span class="comment">         * Free the power request structures.</span>
00261 <span class="comment">         */</span>
00262         UserFreePool(gpPowerRequestMutex);
00263         <a class="code" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00264     }
00265 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="power.c::EnterPowerCrit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline VOID EnterPowerCrit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00038">38</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00025">gpPowerRequestMutex</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00152">UnqueuePowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00608">UserPowerStateCallout()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00481">xxxUserPowerStateCalloutWorker()</a>.
<p>
<pre class="fragment"><div>00038                                {
00039     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00040     <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(gpPowerRequestMutex);
00041 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="power.c::InitializePowerRequestList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS InitializePowerRequestList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hPowerRequestEvent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00180">180</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00030">ExEventObjectType</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00026">gpEventPowerRequest</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00024">gPowerRequestList</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00025">gpPowerRequestMutex</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02713">NtUserInitialize()</a>.
<p>
<pre class="fragment"><div>00182 {
00183     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00184 
00185     InitializeListHead(&amp;gPowerRequestList);
00186 
00187     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(hPowerRequestEvent,
00188                                        EVENT_ALL_ACCESS,
00189                                        *ExEventObjectType,
00190                                        KernelMode,
00191                                        &amp;gpEventPowerRequest,
00192                                        NULL);
00193     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00194         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00195     }
00196 
00197     <a class="code" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a> = UserAllocPoolNonPaged(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>), TAG_POWER);
00198     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00199         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00200     }
00201     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>(gpPowerRequestMutex);
00202 
00203     <span class="keywordflow">return</span> STATUS_SUCCESS;
00204 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="power.c::LeavePowerCrit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline VOID LeavePowerCrit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00043">43</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00025">gpPowerRequestMutex</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00152">UnqueuePowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00608">UserPowerStateCallout()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00481">xxxUserPowerStateCalloutWorker()</a>.
<p>
<pre class="fragment"><div>00043                                {
00044     <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(gpPowerRequestMutex);
00045     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00046 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="power.c::QueuePowerRequest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS QueuePowerRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Parms</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00076">76</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00038">EnterPowerCrit()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00031">tagPOWERREQUEST::Event</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00034">EVENT_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00925">gbNoMorePowerCallouts</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00026">gpEventPowerRequest</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00024">gPowerRequestList</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00036">gpPowerRequestCurrent</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00025">gpPowerRequestMutex</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00043">LeavePowerCrit()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00033">tagPOWERREQUEST::Parms</a>, <a class="el" href="../../d1/d9/ps_8h.html#a83">PKWIN32_POWEREVENT_PARAMETERS</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00030">tagPOWERREQUEST::PowerRequestLink</a>, <a class="el" href="../../d7/d2/power_8c.html#a7">PPOWERREQUEST</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00032">tagPOWERREQUEST::Status</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01704">ThreadLockPool</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01707">ThreadUnlockPool</a>, <a class="el" href="../../d4/d9/ke_8h.html#a407a211">WrUserRequest</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00455">UserPowerEventCallout()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00608">UserPowerStateCallout()</a>.
<p>
<pre class="fragment"><div>00078 {
00079     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00080     <a class="code" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> pPowerRequest;
00081     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlPool;
00082 
00083     UserAssert(gpEventPowerRequest != NULL);
00084     UserAssert(gpPowerRequestMutex != NULL);
00085 
00086     <span class="comment">/*</span>
00087 <span class="comment">     * Allocate and initialize the power request.</span>
00088 <span class="comment">     */</span>
00089     pPowerRequest = UserAllocPoolNonPaged(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html">POWERREQUEST</a>), TAG_POWER);
00090     <span class="keywordflow">if</span> (pPowerRequest == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00091         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00092     }
00093     <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>(&amp;pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o1">Event</a>, SynchronizationEvent, FALSE);
00094     pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o3">Parms</a> = Parms;
00095 
00096     <span class="comment">/*</span>
00097 <span class="comment">     * Insert the power request into the list.</span>
00098 <span class="comment">     */</span>
00099     <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00100     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a324">gbNoMorePowerCallouts</a>) {
00101         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00102     } <span class="keywordflow">else</span> {
00103         InsertHeadList(&amp;gPowerRequestList, &amp;pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o0">PowerRequestLink</a>);
00104     }
00105     <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00106 
00107     <span class="comment">/*</span>
00108 <span class="comment">     * If this is a system thread or a non-GUI thread, tell CSRSS to do the</span>
00109 <span class="comment">     * work and wait for it to finish. Otherwise, we'll do the work ourselves.</span>
00110 <span class="comment">     */</span>
00111     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00112         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()) ||
00113                 W32GetCurrentThread() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00114             <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(gpEventPowerRequest, EVENT_INCREMENT, FALSE);
00115         } <span class="keywordflow">else</span> {
00116             <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00117             <a class="code" href="../../d4/d1/userk_8h.html#a137">ThreadLockPool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), pPowerRequest, &amp;tlPool);
00118             <a class="code" href="../../d4/d1/userk_8h.html#a1969">xxxUserPowerCalloutWorker</a>();
00119             <a class="code" href="../../d4/d1/userk_8h.html#a138">ThreadUnlockPool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), &amp;tlPool);
00120             <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00121         }
00122         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(&amp;pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o1">Event</a>,
00123                                        WrUserRequest,
00124                                        KernelMode,
00125                                        FALSE,
00126                                        NULL);
00127 
00128         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00129             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o2">Status</a>;
00130         }
00131     }
00132 
00133     <span class="comment">/*</span>
00134 <span class="comment">     * Free the power request.</span>
00135 <span class="comment">     */</span>
00136     UserAssert(pPowerRequest != gpPowerRequestCurrent);
00137     UserFreePool(pPowerRequest);
00138 
00139     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00140 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="power.c::UnqueuePowerRequest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> UnqueuePowerRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00152">152</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d1/power_8c-source.html#l00038">EnterPowerCrit()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00024">gPowerRequestList</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00043">LeavePowerCrit()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d2/power_8c.html#a7">PPOWERREQUEST</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00216">CleanupPowerRequestList()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.
<p>
<pre class="fragment"><div>00153 {
00154     PLIST_ENTRY pEntry;
00155     <a class="code" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> pPowerRequest = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00156 
00157     <span class="comment">/*</span>
00158 <span class="comment">     * Remove a power request from the list.</span>
00159 <span class="comment">     */</span>
00160     <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00161     <span class="keywordflow">if</span> (!IsListEmpty(&amp;gPowerRequestList)) {
00162         pEntry = RemoveTailList(&amp;gPowerRequestList);
00163         pPowerRequest = CONTAINING_RECORD(pEntry, <a class="code" href="../../d5/d3/structtagPOWERREQUEST.html">POWERREQUEST</a>, PowerRequestLink);
00164     }
00165     <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00166 
00167     <span class="keywordflow">return</span> pPowerRequest;
00168 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="power.c::UserPowerEventCallout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UserPowerEventCallout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Parms</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00455">455</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00925">gbNoMorePowerCallouts</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00923">gbVideoInitialized</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>.
<p>
<pre class="fragment"><div>00457 {
00458 
00459     <span class="comment">/*</span>
00460 <span class="comment">     * Make sure CSRSS is running.</span>
00461 <span class="comment">     */</span>
00462     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a323">gbVideoInitialized</a> || <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a324">gbNoMorePowerCallouts</a>) {
00463         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00464     }
00465 
00466     UserAssert(gpepCSRSS != NULL);
00467 
00468     <span class="comment">/*</span>
00469 <span class="comment">     * Process the power request.</span>
00470 <span class="comment">     */</span>
00471     <span class="keywordflow">return</span> <a class="code" href="../../d7/d2/power_8c.html#a12">QueuePowerRequest</a>(Parms);
00472 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="power.c::UserPowerStateCallout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UserPowerStateCallout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">PKWIN32_POWERSTATE_PARAMETERS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Parms</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00608">608</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06625">tagPOWERSTATE::bsmParams</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00808">BROADCASTSYSTEMMSGPARAMS::dwFlags</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00038">EnterPowerCrit()</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00034">EVENT_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06620">tagPOWERSTATE::fCritical</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06619">tagPOWERSTATE::fInProgress</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l01114">_WIN32_POWERSTATE_PARAMETERS::Flags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06621">tagPOWERSTATE::fOverrideApps</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06622">tagPOWERSTATE::fQueryAllowed</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06623">tagPOWERSTATE::fUIAllowed</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00925">gbNoMorePowerCallouts</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00923">gbVideoInitialized</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00901">gPowerState</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00071">gspwndLogonNotify</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00043">LeavePowerCrit()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l01113">_WIN32_POWERSTATE_PARAMETERS::MinSystemState</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06624">tagPOWERSTATE::pEvent</a>, <a class="el" href="../../d1/d9/ps_8h.html#a85">PKWIN32_POWERSTATE_PARAMETERS</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l01111">_WIN32_POWERSTATE_PARAMETERS::Promotion</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06626">tagPOWERSTATE::psParams</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l01112">_WIN32_POWERSTATE_PARAMETERS::SystemAction</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00610 {
00611     BOOLEAN Promotion = Parms-&gt;<a class="code" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html#o0">Promotion</a>;
00612     POWER_ACTION SystemAction = Parms-&gt;<a class="code" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html#o1">SystemAction</a>;
00613     SYSTEM_POWER_STATE MinSystemState = Parms-&gt;<a class="code" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html#o2">MinSystemState</a>;
00614     ULONG Flags = Parms-&gt;<a class="code" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html#o3">Flags</a>;
00615 
00616     <span class="comment">/*</span>
00617 <span class="comment">     * Make sure CSRSS is running.</span>
00618 <span class="comment">     */</span>
00619     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a323">gbVideoInitialized</a> || <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a324">gbNoMorePowerCallouts</a> || !<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a17">gspwndLogonNotify</a>) {
00620         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00621     }
00622 
00623     UserAssert(gpepCSRSS != NULL);
00624 
00625     <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00626 
00627     <span class="comment">/*</span>
00628 <span class="comment">     * Make sure we're not trying to promote a non-existent request</span>
00629 <span class="comment">     * or start a new one when we're already doing it.</span>
00630 <span class="comment">     */</span>
00631     <span class="keywordflow">if</span> ((Promotion &amp;&amp; !<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o0">fInProgress</a>) ||
00632         (!Promotion &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o0">fInProgress</a>)) {
00633         <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00634         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00635     }
00636 
00637     <span class="comment">/*</span>
00638 <span class="comment">     * Save our state.</span>
00639 <span class="comment">     */</span>
00640     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o0">fInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00641     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o2">fOverrideApps</a> = (Flags &amp; POWER_ACTION_OVERRIDE_APPS) != 0;
00642     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o1">fCritical</a> = (Flags &amp; POWER_ACTION_CRITICAL) != 0;
00643     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o3">fQueryAllowed</a> = (Flags &amp; POWER_ACTION_QUERY_ALLOWED) != 0;
00644     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o4">fUIAllowed</a> = (Flags &amp; POWER_ACTION_UI_ALLOWED) != 0;
00645     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o7">psParams</a>.SystemAction = SystemAction;
00646     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o7">psParams</a>.MinSystemState = MinSystemState;
00647     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o7">psParams</a>.Flags = Flags;
00648     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o2">fOverrideApps</a>) {
00649         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_NOHANG | BSF_FORCEIFHUNG;
00650     }
00651     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o1">fCritical</a>) {
00652         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_NOHANG | BSF_QUERY;
00653     }
00654     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o5">pEvent</a>) {
00655         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o5">pEvent</a>, EVENT_INCREMENT, FALSE);
00656     }
00657 
00658     <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00659 
00660     <span class="comment">/*</span>
00661 <span class="comment">     * If this is a promotion, we're done.</span>
00662 <span class="comment">     */</span>
00663     <span class="keywordflow">if</span> (Promotion) {
00664         <span class="keywordflow">return</span> STATUS_SUCCESS;
00665     }
00666 
00667     <span class="comment">/*</span>
00668 <span class="comment">     * Process the power request.</span>
00669 <span class="comment">     */</span>
00670     <span class="keywordflow">return</span> <a class="code" href="../../d7/d2/power_8c.html#a12">QueuePowerRequest</a>(NULL);
00671 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="power.c::VideoPortCallout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VideoPortCallout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Params</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00845">845</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d5/d7/ex_8c-source.html#l00131">CreateSystemThread()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00727">VideoPortCalloutThread()</a>.
<p>
<pre class="fragment"><div>00848 {
00849 
00850     <span class="comment">/*</span>
00851 <span class="comment">     * To make sure this is a system thread, we create a new thread.</span>
00852 <span class="comment">     */</span>
00853 
00854     HANDLE   hThread;
00855     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00856 
00857     <span class="comment">// DbgPrint("Callout --- Enter !!!\n");</span>
00858 
00859     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/userk_8h.html#a963">CreateSystemThread</a>(VideoPortCalloutThread, Params, &amp;hThread);
00860     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00861         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(hThread, FALSE, NULL);
00862         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00863             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ((PVIDEO_WIN32K_CALLBACKS_PARAMS)(Params))-&gt;Status;
00864         }
00865         ZwClose(hThread);
00866     }
00867 
00868     <span class="comment">// DbgPrint("Callout --- Leave !!!\n");</span>
00869 
00870     ((PVIDEO_WIN32K_CALLBACKS_PARAMS)(Params))-&gt;Status = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00871 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="power.c::VideoPortCalloutThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VideoPortCalloutThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVIDEO_WIN32K_CALLBACKS_PARAMS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Params</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00727">727</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d0/d5/io_8h.html#a602a412">BusRelations</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00027">gbHibernate</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00191">InitSystemThread()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01395">IoInvalidateDeviceRelations()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00095">ISCSRSS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05804">xxxRestoreCsrssThreadDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05713">xxxSetCsrssThreadDesktop()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1758">xxxUserChangeDisplaySettings()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03136">xxxUserResetDisplayDevice()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00845">VideoPortCallout()</a>.
<p>
<pre class="fragment"><div>00730 {
00731 
00732     <span class="comment">/*</span>
00733 <span class="comment">     * Convert this thread to GUI if it's not already converted</span>
00734 <span class="comment">     */</span>
00735     UserAssert(W32GetCurrentThread() == NULL);
00736 
00737     Params-&gt;Status = <a class="code" href="../../d4/d1/userk_8h.html#a964">InitSystemThread</a>(NULL);
00738 
00739     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Params-&gt;Status)) {
00740         <span class="keywordflow">return</span>;
00741     }
00742 
00743     <span class="comment">// DbgPrint("video --- Before CritSect\n");</span>
00744     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00745     <span class="comment">// DbgPrint("video --- After CritSect\n");</span>
00746 
00747 
00748     <span class="keywordflow">switch</span> (Params-&gt;CalloutType) {
00749 
00750     <span class="keywordflow">case</span> VideoWakeupCallout:
00751         <a class="code" href="../../d7/d2/power_8c.html#a5">gbHibernate</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00752         <span class="keywordflow">break</span>;
00753 
00754     <span class="keywordflow">case</span> VideoDisplaySwitchCallout:
00755         {
00756             UNICODE_STRING   strDeviceName;
00757             DEVMODEW         NewMode;
00758             ULONG            bPrune;
00759 
00760             <span class="keywordflow">if</span> (Params-&gt;PhysDisp != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00761             {
00762                 <span class="keywordflow">if</span> (DrvDisplaySwitchHandler(Params-&gt;PhysDisp, &amp;strDeviceName, &amp;NewMode, &amp;bPrune))
00763                 {
00764                     DESKRESTOREDATA drdRestore;
00765 
00766                     drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00767 
00768                     <span class="comment">/*</span>
00769 <span class="comment">                     * CSRSS is not the only process to diliver power callout</span>
00770 <span class="comment">                     */</span>
00771 
00772                     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a20">ISCSRSS</a>() ||
00773                         <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a> (<a class="code" href="../../d4/d1/userk_8h.html#a1829">xxxSetCsrssThreadDesktop</a>(grpdeskRitInput, &amp;drdRestore)) )
00774                     {
00775                         <span class="keywordflow">if</span> (!DrvQueryMDEVPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>)) {
00776 
00777                             DrvEnableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00778                             DrvSetMDEVPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00779                         }
00780 
00781                         <a class="code" href="../../d4/d1/userk_8h.html#a1758">xxxUserChangeDisplaySettings</a>(NULL, NULL, NULL, grpdeskRitInput,
00782                                  ((bPrune) ? 0 : CDS_RAWMODE) | CDS_TRYCLOSEST | CDS_RESET, 0, KernelMode);
00783 
00784                         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a20">ISCSRSS</a>())
00785                         {
00786                             <a class="code" href="../../d4/d1/userk_8h.html#a1830">xxxRestoreCsrssThreadDesktop</a>(&amp;drdRestore);
00787                         }
00788                     }
00789                 }
00790             }
00791         }
00792 
00793         <span class="comment">//</span>
00794         <span class="comment">// If there is a requirement to reenumerate sub-devices</span>
00795         <span class="comment">//</span>
00796         <span class="keywordflow">if</span> (Params-&gt;Param)
00797         {
00798             <a class="code" href="../../d8/d0/pnpioapi_8c.html#a79">IoInvalidateDeviceRelations</a>((<a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>)Params-&gt;Param, BusRelations);
00799         }
00800 
00801         Params-&gt;Status = STATUS_SUCCESS;
00802         <span class="keywordflow">break</span>;
00803 
00804     <span class="keywordflow">case</span> VideoFindAdapterCallout:
00805 
00806         <span class="keywordflow">if</span> (Params-&gt;Param) {
00807 
00808             DrvEnableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00809             <a class="code" href="../../d9/d6/desktop_8c.html#a26">xxxUserResetDisplayDevice</a>();
00810 
00811         } <span class="keywordflow">else</span> {
00812 
00813             DrvDisableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00814         }
00815 
00816         Params-&gt;Status = STATUS_SUCCESS;
00817         <span class="keywordflow">break</span>;
00818 
00819     <span class="keywordflow">default</span>:
00820 
00821         UserAssert(FALSE);
00822 
00823         Params-&gt;Status = STATUS_UNSUCCESSFUL;
00824 
00825     }
00826 
00827 
00828     <span class="comment">// DbgPrint("video --- Before Leave CritSect\n");</span>
00829     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00830     <span class="comment">// DbgPrint("video --- After Leave CritSect\n");</span>
00831 
00832 
00833     <span class="keywordflow">return</span>;
00834 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="power.c::xxxUserPowerCalloutWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxUserPowerCalloutWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00684">684</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d8/d1/power_8c-source.html#l00058">CancelPowerRequest()</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00034">EVENT_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00036">gpPowerRequestCurrent</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d2/power_8c.html#a7">PPOWERREQUEST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00032">tagPOWERREQUEST::Status</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01713">ThreadLockPoolCleanup</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01716">ThreadUnlockPoolCleanup</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00152">UnqueuePowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00274">xxxUserPowerEventCalloutWorker()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00481">xxxUserPowerStateCalloutWorker()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>.
<p>
<pre class="fragment"><div>00685 {
00686     <a class="code" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> pPowerRequest;
00687     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlPool;
00688 
00689     <span class="keywordflow">while</span> ((pPowerRequest = <a class="code" href="../../d7/d2/power_8c.html#a13">UnqueuePowerRequest</a>()) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00690         <span class="comment">/*</span>
00691 <span class="comment">         * Make sure the event gets signalled even if the thread dies in a</span>
00692 <span class="comment">         * callback or the waiting thread might get stuck.</span>
00693 <span class="comment">         */</span>
00694         <a class="code" href="../../d4/d1/userk_8h.html#a140">ThreadLockPoolCleanup</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), pPowerRequest, &amp;tlPool, CancelPowerRequest);
00695 
00696         <span class="comment">/*</span>
00697 <span class="comment">         * Call the appropriate power worker function.</span>
00698 <span class="comment">         */</span>
00699         <a class="code" href="../../d7/d2/power_8c.html#a8">gpPowerRequestCurrent</a> = pPowerRequest;
00700         <span class="keywordflow">if</span> (pPowerRequest-&gt;Parms) {
00701             pPowerRequest-&gt;<a class="code" href="../../d5/d3/structtagPOWERREQUEST.html#o2">Status</a> = <a class="code" href="../../d7/d2/power_8c.html#a17">xxxUserPowerEventCalloutWorker</a>(pPowerRequest-&gt;Parms);
00702         } <span class="keywordflow">else</span> {
00703             pPowerRequest-&gt;Status = <a class="code" href="../../d7/d2/power_8c.html#a19">xxxUserPowerStateCalloutWorker</a>();
00704         }
00705         <a class="code" href="../../d7/d2/power_8c.html#a8">gpPowerRequestCurrent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00706 
00707         <span class="comment">/*</span>
00708 <span class="comment">         * Tell the waiting thread to proceed.</span>
00709 <span class="comment">         */</span>
00710         <a class="code" href="../../d4/d1/userk_8h.html#a141">ThreadUnlockPoolCleanup</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), &amp;tlPool);
00711         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;pPowerRequest-&gt;Event, EVENT_INCREMENT, FALSE);
00712     }
00713 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="power.c::xxxUserPowerEventCalloutWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS xxxUserPowerEventCalloutWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Parms</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00274">274</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d5/io_8h.html#a602a412">BusRelations</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l01107">_WIN32_POWEREVENT_PARAMETERS::Code</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00808">BROADCASTSYSTEMMSGPARAMS::dwFlags</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00807">BROADCASTSYSTEMMSGPARAMS::dwRecipients</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l01106">_WIN32_POWEREVENT_PARAMETERS::EventNumber</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00027">gbHibernate</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00925">gbNoMorePowerCallouts</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00071">gspwndLogonNotify</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01395">IoInvalidateDeviceRelations()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00095">ISCSRSS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d1/d9/ps_8h.html#a81">PSPOWEREVENTTYPE</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a103">PsW32DisplayState</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a99">PsW32EventCode</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a98">PsW32FullWake</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a106">PsW32GdiOff</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a107">PsW32GdiOn</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a100">PsW32PowerPolicyChanged</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a101">PsW32SystemPowerState</a>, <a class="el" href="../../d1/d9/ps_8h.html#a158a102">PsW32SystemTime</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05804">xxxRestoreCsrssThreadDesktop()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00466">xxxSendMessageBSM()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05713">xxxSetCsrssThreadDesktop()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1493">xxxSystemParametersInfo()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1758">xxxUserChangeDisplaySettings()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03136">xxxUserResetDisplayDevice()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.
<p>
<pre class="fragment"><div>00276 {
00277     <a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html">BROADCASTSYSTEMMSGPARAMS</a> bsmParams;
00278     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00279     <a class="code" href="../../d1/d9/ps_8h.html#a81">PSPOWEREVENTTYPE</a> EventNumber = Parms-&gt;<a class="code" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html#o0">EventNumber</a>;
00280     ULONG_PTR Code = Parms-&gt;<a class="code" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html#o1">Code</a>;
00281     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bCurrentPowerOn;
00282 
00283     <span class="comment">/*</span>
00284 <span class="comment">     * Make sure CSRSS is still running.</span>
00285 <span class="comment">     */</span>
00286     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a324">gbNoMorePowerCallouts</a>) {
00287         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00288     }
00289 
00290     <span class="keywordflow">switch</span> (EventNumber) {
00291     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a98">PsW32FullWake</a>:
00292         <span class="comment">/*</span>
00293 <span class="comment">         * Let all the applications know that they can resume operation.</span>
00294 <span class="comment">         */</span>
00295         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00296         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_QUEUENOTIFYMESSAGE;
00297         <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00298                           WM_POWERBROADCAST,
00299                           PBT_APMRESUMESUSPEND,
00300                           0,
00301                           &amp;bsmParams);
00302         <span class="keywordflow">break</span>;
00303 
00304     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a99">PsW32EventCode</a>:
00305         <span class="comment">/*</span>
00306 <span class="comment">         * Post a message to winlogon, and let them put up a message box</span>
00307 <span class="comment">         * or play a sound.</span>
00308 <span class="comment">         */</span>
00309 
00310         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a17">gspwndLogonNotify</a>) {
00311             <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(gspwndLogonNotify, WM_LOGONNOTIFY, LOGON_PLAYPOWERSOUND, (ULONG)Code);
00312             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00313         } <span class="keywordflow">else</span> {
00314             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00315         }
00316 
00317         <span class="keywordflow">break</span>;
00318 
00319     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a100">PsW32PowerPolicyChanged</a>:
00320         <span class="comment">/*</span>
00321 <span class="comment">         * Set video timeout value.</span>
00322 <span class="comment">         */</span>
00323         <a class="code" href="../../d4/d1/userk_8h.html#a1493">xxxSystemParametersInfo</a>(SPI_SETLOWPOWERTIMEOUT, (ULONG)Code, 0, 0);
00324         <a class="code" href="../../d4/d1/userk_8h.html#a1493">xxxSystemParametersInfo</a>(SPI_SETPOWEROFFTIMEOUT, (ULONG)Code, 0, 0);
00325         <span class="keywordflow">break</span>;
00326 
00327     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a101">PsW32SystemPowerState</a>:
00328         <span class="comment">/*</span>
00329 <span class="comment">         * Let all the applications know that the power status has changed.</span>
00330 <span class="comment">         */</span>
00331         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00332         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_POSTMESSAGE;
00333         <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00334                           WM_POWERBROADCAST,
00335                           PBT_APMPOWERSTATUSCHANGE,
00336                           0,
00337                           &amp;bsmParams);
00338         <span class="keywordflow">break</span>;
00339 
00340     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a102">PsW32SystemTime</a>:
00341         <span class="comment">/*</span>
00342 <span class="comment">         * Let all the applications know that the system time has changed.</span>
00343 <span class="comment">         */</span>
00344         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00345         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_POSTMESSAGE;
00346         <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00347                           WM_TIMECHANGE,
00348                           0,
00349                           0,
00350                           &amp;bsmParams);
00351         <span class="keywordflow">break</span>;
00352 
00353     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a103">PsW32DisplayState</a>:
00354         <span class="comment">/*</span>
00355 <span class="comment">         * Set video timeout active status.</span>
00356 <span class="comment">         */</span>
00357         <a class="code" href="../../d4/d1/userk_8h.html#a1493">xxxSystemParametersInfo</a>(SPI_SETLOWPOWERACTIVE, !Code, 0, 0);
00358         <a class="code" href="../../d4/d1/userk_8h.html#a1493">xxxSystemParametersInfo</a>(SPI_SETPOWEROFFACTIVE, !Code, 0, 0);
00359         <span class="keywordflow">break</span>;
00360 
00361     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a106">PsW32GdiOff</a>:
00362         <span class="comment">/*</span>
00363 <span class="comment">         * At this point we will disable the display device</span>
00364 <span class="comment">         */</span>
00365 
00366         DrvSetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD3);
00367 
00368         bCurrentPowerOn = DrvQueryMDEVPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>);
00369         <span class="keywordflow">if</span> (bCurrentPowerOn) {
00370             DrvDisableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00371         }
00372         DrvSetMDEVPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, FALSE);
00373 
00374         <span class="keywordflow">break</span>;
00375 
00376     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/ps_8h.html#a158a107">PsW32GdiOn</a>:
00377         <span class="comment">/*</span>
00378 <span class="comment">         * Call video driver to turn the display back on.</span>
00379 <span class="comment">         */</span>
00380         bCurrentPowerOn = DrvQueryMDEVPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>);
00381         <span class="keywordflow">if</span> (!bCurrentPowerOn) {
00382             DrvEnableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00383         }
00384         DrvSetMDEVPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00385         DrvSetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD0);
00386 
00387         <span class="comment">/*</span>
00388 <span class="comment">         * Repaint the whole screen</span>
00389 <span class="comment">         */</span>
00390         <a class="code" href="../../d9/d6/desktop_8c.html#a26">xxxUserResetDisplayDevice</a>();
00391 
00392         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/power_8c.html#a5">gbHibernate</a>)
00393         {
00394             HANDLE pdo;
00395 
00396             PVOID PhysDisp = DrvWakeupHandler(&amp;pdo);
00397 
00398             <span class="keywordflow">if</span> (PhysDisp)
00399             {
00400                 UNICODE_STRING   strDeviceName;
00401                 DEVMODEW         NewMode;
00402                 ULONG            bPrune;
00403 
00404                 <span class="keywordflow">if</span> (DrvDisplaySwitchHandler(PhysDisp, &amp;strDeviceName, &amp;NewMode, &amp;bPrune))
00405                 {
00406                     <span class="comment">/*</span>
00407 <span class="comment">                     * CSRSS is not the only process to diliver power callout</span>
00408 <span class="comment">                     */</span>
00409                     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a20">ISCSRSS</a>()) {
00410                         <a class="code" href="../../d4/d1/userk_8h.html#a1758">xxxUserChangeDisplaySettings</a>(NULL, NULL, NULL, grpdeskRitInput,
00411                                  ((bPrune) ? 0 : CDS_RAWMODE) | CDS_TRYCLOSEST | CDS_RESET, 0, KernelMode);
00412                     }
00413                     <span class="keywordflow">else</span>
00414                     {
00415                         DESKRESTOREDATA drdRestore;
00416 
00417                         drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00418                         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a> (<a class="code" href="../../d4/d1/userk_8h.html#a1829">xxxSetCsrssThreadDesktop</a>(grpdeskRitInput, &amp;drdRestore)) )
00419                         {
00420                             <a class="code" href="../../d4/d1/userk_8h.html#a1758">xxxUserChangeDisplaySettings</a>(NULL, NULL, NULL, NULL,
00421                                      ((bPrune) ? 0 : CDS_RAWMODE) | CDS_TRYCLOSEST | CDS_RESET, 0, KernelMode);
00422                             <a class="code" href="../../d4/d1/userk_8h.html#a1830">xxxRestoreCsrssThreadDesktop</a>(&amp;drdRestore);
00423                         }
00424                     }
00425                 }
00426 
00427                 <span class="comment">//</span>
00428                 <span class="comment">// If there is a requirement to reenumerate sub-devices</span>
00429                 <span class="comment">//</span>
00430                 <span class="keywordflow">if</span> (pdo)
00431                 {
00432                     <a class="code" href="../../d8/d0/pnpioapi_8c.html#a79">IoInvalidateDeviceRelations</a>((<a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>)pdo, BusRelations);
00433                 }
00434             }
00435         }
00436         <a class="code" href="../../d7/d2/power_8c.html#a5">gbHibernate</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00437 
00438         <span class="keywordflow">break</span>;
00439 
00440     <span class="keywordflow">default</span>:
00441         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NOT_IMPLEMENTED;
00442         <span class="keywordflow">break</span>;
00443     }
00444 
00445     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00446 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="power.c::xxxUserPowerStateCalloutWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS xxxUserPowerStateCalloutWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00481">481</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06625">tagPOWERSTATE::bsmParams</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00808">BROADCASTSYSTEMMSGPARAMS::dwFlags</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00807">BROADCASTSYSTEMMSGPARAMS::dwRecipients</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00038">EnterPowerCrit()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06620">tagPOWERSTATE::fCritical</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00023">fGdiEnabled</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06619">tagPOWERSTATE::fInProgress</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06621">tagPOWERSTATE::fOverrideApps</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06622">tagPOWERSTATE::fQueryAllowed</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06623">tagPOWERSTATE::fUIAllowed</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00925">gbNoMorePowerCallouts</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00198">glinp</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00901">gPowerState</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00071">gspwndLogonNotify</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00043">LeavePowerCrit()</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06624">tagPOWERSTATE::pEvent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06626">tagPOWERSTATE::psParams</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03260">tagLASTINPUT::timeLastInputMessage</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00466">xxxSendMessageBSM()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.
<p>
<pre class="fragment"><div>00482 {
00483     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fContinue;
00484     <a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html">BROADCASTSYSTEMMSGPARAMS</a> bsmParams;
00485     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00486     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00487 
00488     <span class="comment">/*</span>
00489 <span class="comment">     * Make sure CSRSS is still running.</span>
00490 <span class="comment">     */</span>
00491     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a324">gbNoMorePowerCallouts</a>) {
00492         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00493     }
00494 
00495     <span class="comment">/*</span>
00496 <span class="comment">     * Store the event so this thread can be promoted later.</span>
00497 <span class="comment">     */</span>
00498     <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00499     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o5">pEvent</a> = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pEventQueueServer;
00500     <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00501 
00502     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o1">fCritical</a>) {
00503         <span class="comment">/*</span>
00504 <span class="comment">         * Ask the applications if we can suspend operation.</span>
00505 <span class="comment">         */</span>
00506         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o3">fQueryAllowed</a>) {
00507             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00508             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_NOHANG | BSF_FORCEIFHUNG;
00509             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o4">fUIAllowed</a>) {
00510                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> |= BSF_ALLOWSFW;
00511             }
00512             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o2">fOverrideApps</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00513                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> |= (BSF_QUERY | BSF_NOTIMEOUTIFNOTHUNG);
00514             }
00515             fContinue = <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00516                                           WM_POWERBROADCAST,
00517                                           PBT_APMQUERYSUSPEND,
00518                                           <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o4">fUIAllowed</a>,
00519                                           &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>);
00520 
00521             <span class="comment">/*</span>
00522 <span class="comment">             * If an app says to abort and we're not in override apps or</span>
00523 <span class="comment">             * critical mode, send out the suspend failed message and bail.</span>
00524 <span class="comment">             */</span>
00525             <span class="keywordflow">if</span> (!(fContinue || <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o2">fOverrideApps</a> || <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o1">fCritical</a>)) {
00526                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00527                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_QUEUENOTIFYMESSAGE;
00528                 <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00529                                   WM_POWERBROADCAST,
00530                                   PBT_APMQUERYSUSPENDFAILED,
00531                                   0,
00532                                   &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>);
00533                 <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00534                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o5">pEvent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00535                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o0">fInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00536                 <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00537                 <span class="keywordflow">return</span> STATUS_CANCELLED;
00538             }
00539         }
00540 
00541         <span class="comment">/*</span>
00542 <span class="comment">         * Let all the applications know they should suspend operation.</span>
00543 <span class="comment">         */</span>
00544         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o1">fCritical</a>) {
00545             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00546             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_NOHANG | BSF_FORCEIFHUNG;
00547             <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00548                               WM_POWERBROADCAST,
00549                               PBT_APMSUSPEND,
00550                               0,
00551                               &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o6">bsmParams</a>);
00552         }
00553     }
00554 
00555     <span class="comment">/*</span>
00556 <span class="comment">     * Clear the event so the thread won't wake up prematurely.</span>
00557 <span class="comment">     */</span>
00558     <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00559     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o5">pEvent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00560     <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00561 
00562     <span class="comment">/*</span>
00563 <span class="comment">     * Look for a Winlogon window to notify.</span>
00564 <span class="comment">     */</span>
00565     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a17">gspwndLogonNotify</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00566         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o7">psParams</a>.FullScreenMode = !<a class="code" href="../../d9/d6/desktop_8c.html#a3">fGdiEnabled</a>;
00567         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(gspwndLogonNotify, &amp;tlpwnd);
00568         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(gspwndLogonNotify,
00569                                           WM_LOGONNOTIFY,
00570                                           LOGON_POWERSTATE,
00571                                           (LPARAM)&amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o7">psParams</a>);
00572         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00573     }
00574 
00575     <span class="comment">/*</span>
00576 <span class="comment">     * The power state broadcast is over.</span>
00577 <span class="comment">     */</span>
00578     <a class="code" href="../../d7/d2/power_8c.html#a9">EnterPowerCrit</a>();
00579     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a313">gPowerState</a>.<a class="code" href="../../d6/d3/structtagPOWERSTATE.html#o0">fInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00580     <a class="code" href="../../d7/d2/power_8c.html#a10">LeavePowerCrit</a>();
00581 
00582     <span class="comment">/*</span>
00583 <span class="comment">     * Tickle the input time so we don't fire up a screen saver right away.</span>
00584 <span class="comment">     */</span>
00585     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o0">timeLastInputMessage</a> = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>();
00586 
00587     <span class="comment">/*</span>
00588 <span class="comment">     * Let all the applications know that we're waking up.</span>
00589 <span class="comment">     */</span>
00590     bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = BSM_ALLDESKTOPS;
00591     bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = BSF_QUEUENOTIFYMESSAGE;
00592     <a class="code" href="../../d4/d1/userk_8h.html#a1577">xxxSendMessageBSM</a>(NULL,
00593                       WM_POWERBROADCAST,
00594                       PBT_APMRESUMEAUTOMATIC,
00595                       0,
00596                       &amp;bsmParams);
00597 
00598     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00599 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="power.c::fGdiEnabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d7/d2/power_8c.html#a1">fGdiEnabled</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00022">22</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="power.c::gbHibernate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d7/d2/power_8c.html#a5">gbHibernate</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00027">27</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00727">VideoPortCalloutThread()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00274">xxxUserPowerEventCalloutWorker()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="power.c::gbUserInitialized" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d9/d6/kernel_2server_8c.html#a13">gbUserInitialized</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00021">21</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02004">UserInitialize()</a>, and <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02595">UserThreadCallout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="power.c::gpEventPowerRequest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="el" href="../../d7/d2/power_8c.html#a4">gpEventPowerRequest</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00026">26</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00180">InitializePowerRequestList()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="power.c::gPowerRequestList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d7/d2/power_8c.html#a2">gPowerRequestList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00024">24</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00250">DeletePowerRequestList()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00180">InitializePowerRequestList()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00152">UnqueuePowerRequest()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="power.c::gpPowerRequestCurrent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d3/structtagPOWERREQUEST.html">PPOWERREQUEST</a> <a class="el" href="../../d7/d2/power_8c.html#a8">gpPowerRequestCurrent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00036">36</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00058">CancelPowerRequest()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00684">xxxUserPowerCalloutWorker()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="power.c::gpPowerRequestMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a> <a class="el" href="../../d7/d2/power_8c.html#a3">gpPowerRequestMutex</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/power_8c-source.html#l00025">25</a> of file <a class="el" href="../../d8/d1/power_8c-source.html">power.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00216">CleanupPowerRequestList()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00250">DeletePowerRequestList()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00038">EnterPowerCrit()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00180">InitializePowerRequestList()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00043">LeavePowerCrit()</a>, and <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:17 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
