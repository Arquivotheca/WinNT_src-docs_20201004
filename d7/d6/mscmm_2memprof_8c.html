<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mscmm/memprof.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>memprof.c File Reference</h1><code>#include "Windef.h"</code><br>
<code>#include "WinGdi.h"</code><br>
<code>#include &lt;wtypes.h&gt;</code><br>
<code>#include &lt;winbase.h&gt;</code><br>
<code>#include &lt;windowsX.h&gt;</code><br>
<code>#include "ICM.h"</code><br>
<code>#include "General.h"</code><br>
<code>#include "MemProf.h"</code><br>
<code>#include "MemLink.h"</code><br>
<code>#include &lt;<a class="el" href="../../d1/d4/io_8h-source.html">io.h</a>&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>

<p>
<a href="../../d8/d5/mscmm_2memprof_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d6/mscmm_2memprof_8c.html#a0">MyNewDeviceLink</a> (<a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw, <a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet, LPSTR theProf)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d6/mscmm_2memprof_8c.html#a1">MyNewDeviceLinkW</a> (<a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw, <a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet, LPWSTR theProf)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d6/mscmm_2memprof_8c.html#a2">MyNewDeviceLinkFill</a> (<a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw, <a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet, HPROFILE aHProf)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>long&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d6/mscmm_2memprof_8c.html#a3">SaveMyProfile</a> (LPSTR lpProfileName, LPWSTR lpProfileNameW, PPROFILE theProf)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="mscmm/memprof.c::MyNewDeviceLink" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> MyNewDeviceLink           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a28">CMWorldRef</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cw</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>profileSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>theProf</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00046">46</a> of file <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html">mscmm/memprof.c</a>.
<p>
<pre class="fragment"><div>00047 {
00048         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
00049         PROFILE                 pProf;
00050         HPROFILE                aHProf;
00051 
00052         pProf.pProfileData = (PVOID *)theProf;
00053         pProf.dwType = PROFILE_FILENAME;
00054         pProf.cbDataSize = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)pProf.pProfileData) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
00055         aHProf = OpenColorProfile( &amp;pProf, PROFILE_READWRITE, 0, CREATE_ALWAYS );
00056         <span class="keywordflow">if</span>( !aHProf ){
00057                 err = GetLastError();
00058                 <span class="keywordflow">goto</span> CleanupAndExit;
00059         }
00060         err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a4">MyNewDeviceLinkFill</a>( cw, profileSet, aHProf );
00061 
00062 CleanupAndExit:
00063         <span class="keywordflow">return</span> err;
00064 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mscmm/memprof.c::MyNewDeviceLinkFill" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> MyNewDeviceLinkFill           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a28">CMWorldRef</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cw</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>profileSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>aHProf</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00085">85</a> of file <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html">mscmm/memprof.c</a>.
<p>
<pre class="fragment"><div>00086 {
00087         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
00088         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
00089 <span class="preprocessor">#ifdef __MWERKS__</span>
00090 <span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>                   theText[] = <span class="stringliteral">"\pLogColorSpProfile¥"</span>;
00091 <span class="preprocessor">#else</span>
00092 <span class="preprocessor"></span>      <span class="keywordtype">char</span>                      theText[] = <span class="stringliteral">"\024DeviceLinkProfile   "</span>;
00093 <span class="preprocessor">#endif</span>
00094 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
00095         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                     aPtr=0;
00096         <span class="keywordtype">long</span>                    theHeaderSize;
00097         <span class="keywordtype">long</span>                    theDescSize;
00098         <span class="keywordtype">long</span>                    theMediaSize;
00099         <span class="keywordtype">long</span>                    theCopyRightSize;
00100         <span class="keywordtype">long</span>                    currentSize=0;
00101         <span class="keywordtype">long</span>                    theTotalSize=0;
00102         <span class="keywordtype">long</span>                    theSequenceDescSize = 0;
00103         <span class="keywordtype">long</span>                    theA2B0Size;
00104         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   aIntent;
00105         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  sCS,dCS,clutSize;
00106         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSErr;
00107 
00108 
00109         <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> D50XYZ = { 0.9642, 1.0000, 0.8249 };
00110         <a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a> D50 = { (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o0">X</a> * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o1">Y</a> * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o2">Z</a> * 65536)};
00111         theHeaderSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>);
00112 
00113         theDescSize   =                                                                           <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
00114                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
00115                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* ASCII length */</span>
00116                                                                                                                 + theText[0]                            <span class="comment">/* ASCII profile description */</span>
00117                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode code */</span>
00118                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode character count */</span>
00119                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)        <span class="comment">/* Macintosh script code */</span>
00120                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)         <span class="comment">/* Macintosh string length */</span>
00121                                                                                                                 + 67                                            <span class="comment">/* Macintosh string */</span>
00122                                                                                                                 ;
00123         theCopyRightSize   =                                                              <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
00124                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
00125                                                                                                                 + copyrightText[0]                      <span class="comment">/* ASCII profile description */</span>
00126                                                                                                                 ;
00127         theMediaSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> );;
00128 
00129         aPtr = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a6">SmartNewPtrClear</a>( 5000, &amp;aOSerr );
00130         err = aOSerr;
00131         <span class="keywordflow">if</span> (err)
00132                 <span class="keywordflow">goto</span> CleanupAndExit;
00133 
00134         aIntent = 0;
00135 
00136         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a4">MyGetColorSpaces</a>( profileSet, &amp;sCS, &amp;dCS );
00137         <span class="keywordflow">if</span> (err)
00138                 <span class="keywordflow">goto</span> CleanupAndExit;
00139                 
00140         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a14">MyAdd_NL_HeaderMS</a>(theHeaderSize+4, (<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>*)aPtr, aIntent, sCS, dCS );
00141         <span class="keywordflow">if</span> (err)
00142                 <span class="keywordflow">goto</span> CleanupAndExit;
00143                 
00144         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a26">SetColorProfileHeader</a>( aHProf, (PPROFILEHEADER)aPtr);
00145         <span class="keywordflow">if</span> (!err){
00146                 err = GetLastError();
00147                 <span class="keywordflow">goto</span> CleanupAndExit;
00148         }
00149 
00150         err =<a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a7">MyAdd_NL_DescriptionTag</a>    ( (<a class="code" href="../../d6/d8/structLHTextDescriptionType.html">LHTextDescriptionType</a> *)aPtr, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)theText );
00151         <span class="keywordflow">if</span> (err)
00152                 <span class="keywordflow">goto</span> CleanupAndExit;
00153         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a>( aHProf, icSigProfileDescriptionTag, theDescSize );
00154         <span class="keywordflow">if</span> (!err){
00155                 err = GetLastError();
00156                 <span class="keywordflow">goto</span> CleanupAndExit;
00157         }
00158         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a23">SetColorProfileElement</a>( aHProf, icSigProfileDescriptionTag, 0, (DWORD *)&amp;theDescSize, aPtr );
00159         <span class="keywordflow">if</span> (!err){
00160                 err = GetLastError();
00161                 <span class="keywordflow">goto</span> CleanupAndExit;
00162         }
00163 
00164         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)aPtr, &amp;D50);
00165         <span class="keywordflow">if</span> (err)
00166                 <span class="keywordflow">goto</span> CleanupAndExit;
00167 
00168         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a>( aHProf, icSigMediaWhitePointTag, theMediaSize );
00169         <span class="keywordflow">if</span> (!err){
00170                 err = GetLastError();
00171                 <span class="keywordflow">goto</span> CleanupAndExit;
00172         }
00173         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a23">SetColorProfileElement</a>( aHProf, icSigMediaWhitePointTag, 0, (DWORD *)&amp;theMediaSize, aPtr );
00174         <span class="keywordflow">if</span> (!err){
00175                 err = GetLastError();
00176                 <span class="keywordflow">goto</span> CleanupAndExit;
00177         }
00178 
00179         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a10">MyAdd_NL_CopyrightTag</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)copyrightText, (<a class="code" href="../../d7/d8/structLHTextType.html">LHTextType</a> *)aPtr);
00180         <span class="keywordflow">if</span> (err)
00181                 <span class="keywordflow">goto</span> CleanupAndExit;
00182         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a>( aHProf, icSigCopyrightTag, theCopyRightSize );
00183         <span class="keywordflow">if</span> (!err){
00184                 err = GetLastError();
00185                 <span class="keywordflow">goto</span> CleanupAndExit;
00186         }
00187         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a23">SetColorProfileElement</a>( aHProf, icSigCopyrightTag, 0, (DWORD *)&amp;theCopyRightSize, aPtr );
00188         <span class="keywordflow">if</span> (!err){
00189                 err = GetLastError();
00190                 <span class="keywordflow">goto</span> CleanupAndExit;
00191         }
00192                 
00193         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a11">MyAdd_NL_SequenceDescTag</a>( profileSet, (<a class="code" href="../../d8/d3/structicProfileSequenceDescType.html">icProfileSequenceDescType</a> *)aPtr, &amp;theSequenceDescSize );
00194         <span class="keywordflow">if</span> (err)
00195                 <span class="keywordflow">goto</span> CleanupAndExit;
00196         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a>( aHProf, icSigProfileSequenceDescTag, theSequenceDescSize );
00197         <span class="keywordflow">if</span> (!err){
00198                 err = GetLastError();
00199                 <span class="keywordflow">goto</span> CleanupAndExit;
00200         }
00201         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a23">SetColorProfileElement</a>( aHProf, icSigProfileSequenceDescTag, 0, (DWORD *)&amp;theSequenceDescSize, aPtr );
00202         <span class="keywordflow">if</span> (!err){
00203                 err = GetLastError();
00204                 <span class="keywordflow">goto</span> CleanupAndExit;
00205         }
00206         
00207         aPtr = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( aPtr );
00208 
00209     theA2B0Size = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a7">GetSizes</a>( (CMMModelPtr)cw, &amp;clutSize );
00210 
00211         aPtr =  <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>( theA2B0Size, &amp;aOSErr );
00212         err = aOSErr;
00213         <span class="keywordflow">if</span> (err)
00214                 <span class="keywordflow">goto</span> CleanupAndExit;
00215 
00216         <span class="keywordflow">if</span> ( ((<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)cw)-&gt;lutParam.colorLutWordSize == 8)
00217         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a12">MyAdd_NL_AToB0Tag_mft1</a>( (CMMModelPtr)cw, (<a class="code" href="../../d9/d2/structicLut8Type.html">icLut8Type</a> *)aPtr, clutSize );
00218     <span class="keywordflow">else</span>
00219         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a13">MyAdd_NL_AToB0Tag_mft2</a>( (CMMModelPtr)cw, (<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *)aPtr, clutSize );
00220 
00221         <span class="keywordflow">if</span> (err)
00222                 <span class="keywordflow">goto</span> CleanupAndExit;
00223 
00224         <span class="comment">//if( theA2B0Size &gt; 12000 ) theA2B0Size = 12000;</span>
00225         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a>( aHProf, icSigAToB0Tag, theA2B0Size );
00226         <span class="keywordflow">if</span> (!err){
00227                 err = GetLastError();
00228                 <span class="keywordflow">goto</span> CleanupAndExit;
00229         }
00230         err = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a23">SetColorProfileElement</a>( aHProf, icSigAToB0Tag, 0, (DWORD *)&amp;theA2B0Size, aPtr );
00231         <span class="keywordflow">if</span> (!err){
00232                 err = GetLastError();
00233                 <span class="keywordflow">goto</span> CleanupAndExit;
00234         }
00235                 
00236         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00237         
00238 CleanupAndExit:
00239         <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a13">CloseColorProfile</a>( aHProf );
00240         aPtr = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( aPtr );
00241         <span class="keywordflow">return</span> err;
00242 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mscmm/memprof.c::MyNewDeviceLinkW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> MyNewDeviceLinkW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a28">CMWorldRef</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cw</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>profileSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>theProf</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00066">66</a> of file <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html">mscmm/memprof.c</a>.
<p>
<pre class="fragment"><div>00067 {
00068         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
00069         PROFILE                 pProf;
00070         HPROFILE                aHProf;
00071 
00072         pProf.pProfileData = (PVOID *)theProf;
00073         pProf.dwType = PROFILE_FILENAME;
00074         pProf.cbDataSize = wcslen((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *)pProf.pProfileData) * <span class="keyword">sizeof</span>(WCHAR);
00075         aHProf = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a12">OpenColorProfileW</a>( &amp;pProf, PROFILE_READWRITE, 0, CREATE_ALWAYS );
00076         <span class="keywordflow">if</span>( !aHProf ){
00077                 err = GetLastError();
00078                 <span class="keywordflow">goto</span> CleanupAndExit;
00079         }
00080         err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a4">MyNewDeviceLinkFill</a>( cw, profileSet, aHProf );
00081 CleanupAndExit:
00082         <span class="keywordflow">return</span> err;
00083 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mscmm/memprof.c::SaveMyProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> long SaveMyProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpProfileName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpProfileNameW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>theProf</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00274">274</a> of file <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html">mscmm/memprof.c</a>.
<p>
<pre class="fragment"><div>00275 {
00276         <span class="keywordtype">long</span> ret;
00277         <span class="keywordtype">int</span> fh;
00278 
00279         <span class="keywordflow">if</span>( theProf-&gt;dwType != PROFILE_MEMBUFFER ){
00280                 SetLastError( (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) unimpErr );
00281                 <span class="keywordflow">return</span> 0;
00282         }
00283         <span class="keywordflow">if</span>( lpProfileNameW == 0 ){
00284                 <span class="keywordflow">if</span>( lpProfileName == 0 ) <span class="keywordflow">return</span> 0;
00285                 fh = _open( lpProfileName, _O_BINARY | _O_CREAT  | _O_EXCL, _S_IREAD | _S_IWRITE );
00286         }
00287         <span class="keywordflow">else</span>{
00288                 fh = _wopen( lpProfileNameW, _O_BINARY | _O_CREAT  | _O_EXCL, _S_IREAD | _S_IWRITE );
00289         }
00290         <span class="keywordflow">if</span>( fh == -1 ) <span class="keywordflow">return</span> -1;
00291 
00292         <span class="keywordflow">if</span>( theProf-&gt;pProfileData == 0 ){
00293                 SetLastError( ERROR_INVALID_DATA );
00294                 <span class="keywordflow">return</span> 0;
00295         }
00296         ret = _write( fh, theProf-&gt;pProfileData, theProf-&gt;cbDataSize );
00297         <span class="keywordflow">if</span>( ret == -1 ) <span class="keywordflow">return</span> -1;
00298 
00299         ret = _close( fh );
00300         <span class="keywordflow">if</span>( ret == -1 ) <span class="keywordflow">return</span> -1;
00301         <span class="keywordflow">return</span> 0;
00302 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:37 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
