<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: country.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>country.c</h1><a href="../../d6/d7/country_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">// Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00002 <span class="comment">//</span>
00003 <span class="comment">//  MODULE:   country.c</span>
00004 <span class="comment">//</span>
00005 <span class="comment">//  PURPOSE:   Console IME control.</span>
00006 <span class="comment">//             FarEast country specific module for conime.</span>
00007 <span class="comment">//</span>
00008 <span class="comment">//  PLATFORMS: Windows NT-FE 3.51</span>
00009 <span class="comment">//</span>
00010 <span class="comment">//  FUNCTIONS:</span>
00011 <span class="comment">//    ImeUIMakeInfoString() - routine for make status string</span>
00012 <span class="comment">//</span>
00013 <span class="comment">//  History:</span>
00014 <span class="comment">//</span>
00015 <span class="comment">//  10.Jul.1996 v-HirShi (Hirotoshi Shimizu)    Created for TAIWAN &amp; KOREA &amp; PRC</span>
00016 <span class="comment">//</span>
00017 <span class="comment">//  COMMENTS:</span>
00018 <span class="comment">//</span>
00019 <span class="preprocessor">#include "<a class="code" href="../../d5/d3/w32_2ntcon_2conime_2precomp_8h.html">precomp.h</a>"</span>
00020 <span class="preprocessor">#pragma hdrstop</span>
00021 <span class="preprocessor"></span>
00022 <span class="comment">// for Japanese</span>
00023 <span class="comment">//                             none  plaural single    auto  phrase</span>
<a name="l00024"></a><a class="code" href="../../d6/d7/country_8c.html#a0">00024</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a0">IMECMode</a>[]          = { 0x7121, 0x8907, 0x5358, 0x81ea, 0x9023 };
<a name="l00025"></a><a class="code" href="../../d6/d7/country_8c.html#a1">00025</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a1">IMECModeRoman</a>[]     = { 0xff9b, 0xff70, 0xff8f, 0x0020 };
<a name="l00026"></a><a class="code" href="../../d6/d7/country_8c.html#a2">00026</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a2">IMECModeKana</a>[]      = { 0xff76, 0xff85, 0x0020, 0x0020 };
<a name="l00027"></a><a class="code" href="../../d6/d7/country_8c.html#a3">00027</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a3">IMECModeAHAN</a>[]      = { 0x534a, 0x0041, 0x0020 };
<a name="l00028"></a><a class="code" href="../../d6/d7/country_8c.html#a4">00028</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a4">IMECModeAZEN</a>[]      = { 0x5168, 0xff21 };
<a name="l00029"></a><a class="code" href="../../d6/d7/country_8c.html#a5">00029</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a5">IMECModeHHAN</a>[]      = { 0x534a, 0xff71, 0x0020 };
<a name="l00030"></a><a class="code" href="../../d6/d7/country_8c.html#a6">00030</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a6">IMECModeHZEN</a>[]      = { 0x5168, 0x3042 };
<a name="l00031"></a><a class="code" href="../../d6/d7/country_8c.html#a7">00031</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a7">IMECModeKHAN</a>[]      = { 0x534a, 0xff76, 0x0020 };
<a name="l00032"></a><a class="code" href="../../d6/d7/country_8c.html#a8">00032</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a8">IMECModeKZEN</a>[]      = { 0x5168, 0x30ab };
00033 
00034 <span class="comment">// for CHT /Taiwan</span>
<a name="l00035"></a><a class="code" href="../../d6/d7/country_8c.html#a9">00035</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a9">IMECModeFullShape</a>[] = { 0x5168, 0x5f62 };
<a name="l00036"></a><a class="code" href="../../d6/d7/country_8c.html#a10">00036</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a10">IMECModeHalfShape</a>[] = { 0x534a, 0x5f62 };
<a name="l00037"></a><a class="code" href="../../d6/d7/country_8c.html#a11">00037</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a11">IMECModeKeyboard</a>[]  = { 0x9375, 0x76e4 };
<a name="l00038"></a><a class="code" href="../../d6/d7/country_8c.html#a12">00038</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a12">IMECModeSymbol</a>[]    = { 0x7b26, 0x53f7 };
<a name="l00039"></a><a class="code" href="../../d6/d7/country_8c.html#a13">00039</a> WCHAR <a class="code" href="../../d6/d7/country_8c.html#a13">IMECGuide</a>[9][7]     = {{ 0x5009, 0x9821, 0x8acb, 0x8f38, 0x5165, 0x5b57, 0x6839 },    <span class="comment">// kura</span>
00040                              { 0x5167, 0x78bc, 0x8acb, 0x8f38, 0x5165, 0x5167, 0x78bc },    <span class="comment">// naima</span>
00041                              { 0x55ae, 0x78bc, 0x8acb, 0x8f38, 0x5165, 0x55ae, 0x78bc },    <span class="comment">// tanma</span>
00042                              { 0x901f, 0x6210, 0x8acb, 0x8f38, 0x5165, 0x5b57, 0x6839 },    <span class="comment">// sokusei</span>
00043                              { 0x5927, 0x6613, 0x8acb, 0x8f38, 0x5165, 0x5b57, 0x6839 },    <span class="comment">// taieki</span>
00044                              { 0x82f1, 0x6570, 0x3000, 0x3000, 0x3000, 0x3000, 0x3000 },    <span class="comment">// eisuu</span>
00045                              { 0xff55, 0xff53, 0x3000, 0x3000, 0x3000, 0x3000, 0x3000 },    <span class="comment">// US</span>
00046                              { 0x6ce8, 0x97f3, 0x8acb, 0x8f38, 0x5165, 0x7b26, 0x865f },    <span class="comment">// chuon fugou</span>
00047                              { 0x6ce8, 0x97f3, 0x8acb, 0x3000, 0x9078, 0x3000, 0x5b57 } }; <span class="comment">// chuon senji</span>
00048 <span class="comment">/*</span>
00049 <span class="comment">WCHAR IMECNAMEPRC[9][7]   = { 0x5168, 0x62fc, 0 };                   // zenhei</span>
00050 <span class="comment">                            { 0x53cc, 0x62fc, 0 };                   // souhei</span>
00051 <span class="comment">                            { 0x6807, 0x51c6, 0 };                   // sijun</span>
00052 <span class="comment">                            { 0x53cc, 0x6253, 0 };                   // souda</span>
00053 <span class="comment">                            { 0x90d1, 0x7801, 0 };                   // hou?</span>
00054 <span class="comment">                            { 0x8868, 0x5f62, 0x7801, 0 };           // hyoukei</span>
00055 <span class="comment">                            { 0x7e41, 0x4f53, 0x6ce8, 0x97f3, 0 };   // chuon</span>
00056 <span class="comment">                            { 0x7e41, 0x4f53, 0x4ed3, 0x9889, 0 };   // kaihou</span>
00057 <span class="comment">                            { 0x533a, 0x4f4d, 0 };                   // kui</span>
00058 <span class="comment">                            { 0x0047, 0x0042, 0x004a, 0x5185, 0x7801, 0 };   // GBKnaikou</span>
00059 <span class="comment">                            { 0x0055, 0x006e, 0x0069, 0x0063, 0x006f, 0x0064, 0x0065, 0 };   // Unicode</span>
00060 <span class="comment">*/</span>
00061 
00062 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00063"></a><a class="code" href="../../d6/d7/country_8c.html#a14">00063</a> <a class="code" href="../../d6/d7/country_8c.html#a14">ConimeHotkey</a>(
00064     HWND hWnd,
00065     HANDLE hConsole,
00066     DWORD HotkeyID
00067     )
00068 {
00069 <span class="comment">//    PCONSOLE_TABLE ConTbl;</span>
00070 <span class="comment">//</span>
00071 <span class="comment">//    ConTbl = SearchConsole(hConsole);</span>
00072 <span class="comment">//    if (ConTbl == NULL) {</span>
00073 <span class="comment">//        DBGPRINT(("CONIME: Error! Cannot found registed Console\n"));</span>
00074 <span class="comment">//        return FALSE;</span>
00075 <span class="comment">//    }</span>
00076 
00077     <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a9">ImmSimulateHotKey</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>,(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)HotkeyID);
00078 }
00079 
00080 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00081"></a><a class="code" href="../../d6/d7/country_8c.html#a15">00081</a> <a class="code" href="../../d6/d7/country_8c.html#a15">GetIMEName</a>(
00082     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl
00083     )
00084 {
00085     WCHAR buf[<a class="code" href="../../d4/d5/conimep_8h.html#a38">MaxBufSize</a>];
00086     WCHAR name[<a class="code" href="../../d4/d5/conimep_8h.html#a38">MaxBufSize</a>];
00087     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> bufsize = <a class="code" href="../../d4/d5/conimep_8h.html#a38">MaxBufSize</a>;
00088     LONG lResult;
00089     HKEY hkLayout;
00090     <span class="keywordtype">int</span> i;
00091 
00092     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[0] = TEXT(<span class="charliteral">'\0'</span>);
00093     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o12">GuideLine</a>[0] = TEXT(<span class="charliteral">'\0'</span>);
00094 
00095     <span class="keywordflow">if</span> (ImmEscape(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>, ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o4">hIMC_Current</a>, IME_ESC_IME_NAME, (LPTSTR)&amp;name) == 0)
00096     {
00097         <span class="keywordflow">if</span> (!ImmGetIMEFileName(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>, (LPTSTR)&amp;name, <a class="code" href="../../d4/d5/conimep_8h.html#a38">MaxBufSize</a> ) )
00098         {
00099             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8/ntcftxt_8h.html#a17">GetKeyboardLayoutName</a>((LPTSTR)&amp;name) ) 
00100             {
00101                 <span class="comment">/*</span>
00102 <span class="comment">                 * quick dirty ImmIsIME</span>
00103 <span class="comment">                 */</span>
00104                 <span class="keywordflow">if</span> (name[0] != TEXT(<span class="charliteral">'E'</span>) &amp;&amp;
00105                     name[0] != TEXT(<span class="charliteral">'e'</span>))
00106                 {
00107                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00108                 }
00109 
00110                 lstrcpy( buf, <a class="code" href="../../d4/d5/conimep_8h.html#a39">KBDLAYOUT</a> );
00111                 lstrcat( buf, <a class="code" href="../../d4/d5/conimep_8h.html#a41">KBDSEPALATER</a> );
00112                 lstrcat( buf, name );
00113                 lResult = RegOpenKeyEx(HKEY_LOCAL_MACHINE,
00114                                        (LPCTSTR)buf,
00115                                        0,
00116                                        KEY_QUERY_VALUE | KEY_ENUMERATE_SUB_KEYS,
00117                                        &amp;hkLayout );
00118                 <span class="keywordflow">if</span> ( lResult == ERROR_SUCCESS ) {
00119                     lResult = RegQueryValueEx( hkLayout,
00120                                                <a class="code" href="../../d4/d5/conimep_8h.html#a40">KBDLAYOUTTEXT</a>,
00121                                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00122                                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00123                                                (LPBYTE)ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>,
00124                                                &amp;bufsize );
00125                     RegCloseKey( hkLayout );
00126                     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[0] != TEXT(<span class="charliteral">'\0'</span>)) {
00127                         <span class="keywordflow">for</span> (i = 0; i &lt; 8; i ++){
00128                             <span class="keywordflow">if</span> ((ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[0] == <a class="code" href="../../d6/d7/country_8c.html#a13">IMECGuide</a>[i][0]) &amp;&amp;
00129                                 (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[1] == <a class="code" href="../../d6/d7/country_8c.html#a13">IMECGuide</a>[i][1]) ) {
00130                                 lstrcpyn(&amp;(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o12">GuideLine</a>[0]), &amp;(<a class="code" href="../../d6/d7/country_8c.html#a13">IMECGuide</a>[i][2]), <a class="code" href="../../d4/d5/conimep_8h.html#a86">IMECGuideLen</a>+1);
00131                                 <span class="keywordflow">break</span>;
00132                             }
00133                         }
00134                     }
00135                 }
00136                 <span class="keywordflow">else</span>{
00137                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00138                 }
00139             }
00140             <span class="keywordflow">else</span>
00141             {
00142                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00143             }
00144         }
00145         <span class="keywordflow">else</span>
00146         {
00147             lstrcpy( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>, name );
00148         }
00149     }
00150     <span class="keywordflow">else</span>
00151     {
00152         lstrcpy( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>, name);
00153     }
00154 
00155     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00156 }
00157 
00158 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00159"></a><a class="code" href="../../d6/d7/country_8c.html#a16">00159</a> <a class="code" href="../../d6/d7/country_8c.html#a16">GetOpenStatusByCodepage</a>(
00160     HIMC hIMC,
00161     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl
00162     )
00163 {
00164     <span class="keywordflow">switch</span> ( <a class="code" href="../../d4/d5/conimep_8h.html#a50">HKL_TO_LANGID</a>(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>))
00165     {
00166         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a43">LANG_ID_JAPAN</a>:
00167             <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a31">ImmGetOpenStatus</a>(hIMC);
00168             <span class="keywordflow">break</span>;
00169         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a42">LANG_ID_TAIWAN</a>:
00170         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a45">LANG_ID_PRC</a>:
00171         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a44">LANG_ID_KOREA</a>:
00172             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/ctxtinfo_8c.html#a31">ImmGetOpenStatus</a>(hIMC)) {
00173                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>);
00174             }
00175             <span class="keywordflow">break</span>;
00176         <span class="keywordflow">default</span>:
00177             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00178     }
00179     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00180 }
00181 
00182 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00183"></a><a class="code" href="../../d6/d7/country_8c.html#a17">00183</a> <a class="code" href="../../d6/d7/country_8c.html#a17">ImeUIMakeInfoString</a>(
00184     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00185     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo
00186     )
00187 {
00188 
00189     <span class="keywordflow">switch</span> ( <a class="code" href="../../d4/d5/conimep_8h.html#a50">HKL_TO_LANGID</a>(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>))
00190     {
00191         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a43">LANG_ID_JAPAN</a>:
00192             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/country_8c.html#a18">MakeInfoStringJapan</a>(ConTbl, lpModeInfo);
00193             <span class="keywordflow">break</span>;
00194         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a42">LANG_ID_TAIWAN</a>:
00195             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/country_8c.html#a19">MakeInfoStringTaiwan</a>(ConTbl, lpModeInfo);
00196             <span class="keywordflow">break</span>;
00197         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a45">LANG_ID_PRC</a>:
00198             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/country_8c.html#a25">MakeInfoStringPRC</a>(ConTbl, lpModeInfo);
00199             <span class="keywordflow">break</span>;
00200         <span class="keywordflow">case</span>    <a class="code" href="../../d4/d5/conimep_8h.html#a44">LANG_ID_KOREA</a>:
00201             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/country_8c.html#a30">MakeInfoStringKorea</a>(ConTbl, lpModeInfo);
00202             <span class="keywordflow">break</span>;
00203         <span class="keywordflow">default</span>:
00204             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00205     }
00206 }
00207 
00208 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00209"></a><a class="code" href="../../d6/d7/country_8c.html#a18">00209</a> <a class="code" href="../../d6/d7/country_8c.html#a18">MakeInfoStringJapan</a>(
00210     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00211     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo
00212     )
00213 {
00214     <span class="keywordtype">int</span> i , j;
00215     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwConversion;
00216     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSentence;
00217 
00218     dwConversion = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>;
00219     dwSentence = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o8">dwSentence</a>;
00220 
00221     i = j = 0;
00222     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o6">fOpen</a>){
00223         <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_FULLSHAPE) {
00224             <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_NATIVE) {
00225                 <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_KATAKANA) {
00226                     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a81">IMECModeKZENLen</a>; j++, i++)
00227                         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a8">IMECModeKZEN</a>[j];
00228                 }
00229                 <span class="keywordflow">else</span> {
00230                     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a79">IMECModeHZENLen</a>; j++, i++)
00231                         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a6">IMECModeHZEN</a>[j];
00232                 }
00233             }
00234             <span class="keywordflow">else</span> {
00235                 <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a77">IMECModeAZENLen</a>; j++, i++)
00236                     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a4">IMECModeAZEN</a>[j];
00237             }
00238         }
00239         <span class="keywordflow">else</span> {
00240             <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_NATIVE) {
00241                 <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_KATAKANA) {
00242                     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a80">IMECModeKHANLen</a>; j++, i++)
00243                         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a7">IMECModeKHAN</a>[j];
00244                 }
00245                 <span class="keywordflow">else</span> {
00246                     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a78">IMECModeHHANLen</a>; j++, i++)
00247                         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a5">IMECModeHHAN</a>[j];
00248                 }
00249             }
00250             <span class="keywordflow">else</span> {
00251                 <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a76">IMECModeAHANLen</a>; j++, i++)
00252                     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a3">IMECModeAHAN</a>[j];
00253             }
00254         }
00255 
00256         <span class="keywordflow">if</span> (dwSentence &amp; IME_SMODE_NONE)
00257             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a0">IMECMode</a>[<a class="code" href="../../d4/d5/conimep_8h.html#a69">MODEDISP_NONE</a>];
00258         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwSentence &amp; IME_SMODE_PLAURALCLAUSE)
00259             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a0">IMECMode</a>[<a class="code" href="../../d4/d5/conimep_8h.html#a70">MODEDISP_PLAURAL</a>];
00260         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwSentence &amp; IME_SMODE_SINGLECONVERT)
00261             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a0">IMECMode</a>[<a class="code" href="../../d4/d5/conimep_8h.html#a71">MODEDISP_SINGLE</a>];
00262         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwSentence &amp; IME_SMODE_AUTOMATIC)
00263             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a0">IMECMode</a>[<a class="code" href="../../d4/d5/conimep_8h.html#a72">MODEDISP_AUTO</a>];
00264         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwSentence &amp; IME_SMODE_PHRASEPREDICT)
00265             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a0">IMECMode</a>[<a class="code" href="../../d4/d5/conimep_8h.html#a73">MODEDISP_PHRASE</a>];
00266         <span class="keywordflow">else</span> {
00267             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = 0x0020;
00268             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = 0x0020;
00269         }
00270         i++;
00271 
00272         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_KANA) &amp; 1) {
00273             <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a75">IMECModeKanaLen</a>; j++, i++)
00274                 lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a2">IMECModeKana</a>[j];
00275         }
00276         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_ROMAN) {
00277             <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a74">IMECModeRomanLen</a>; j++, i++)
00278                 lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a1">IMECModeRoman</a>[j];
00279         }
00280     }
00281     <span class="keywordflow">else</span> {
00282         <span class="comment">/*</span>
00283 <span class="comment">         * In this case, fOpen is 0 (==close).</span>
00284 <span class="comment">         * Should be fill mode text buffer in console.</span>
00285 <span class="comment">         * So, console can do fill up that pass to 0 length.</span>
00286 <span class="comment">         */</span>
00287         i = 0;
00288     }
00289     <span class="keywordflow">for</span> (j = 0; j &lt; i; j++ )
00290         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[j].Attributes = 0x0007;
00291     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o0">ModeStringLen</a> = i;
00292     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o1">Position</a> = <a class="code" href="../../d3/d5/conime_8h.html#a2">VIEW_RIGHT</a>;
00293     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00294 }
00295 
00296 
00297 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00298"></a><a class="code" href="../../d6/d7/country_8c.html#a19">00298</a> <a class="code" href="../../d6/d7/country_8c.html#a19">MakeInfoStringTaiwan</a>(
00299     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00300     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo
00301     )
00302 {
00303     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00304     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ModeInfoPtr;
00305     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthForDisp;
00306 
00307     ModeInfoPtr = 0;
00308 
00309     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>) ){
00310         ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a20">MakeStatusStrTaiwan1</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00311         <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o13">fInComposition</a>) {
00312             <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o16">fInCandidate</a>){
00313                 ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a23">IncludeCandidateT</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00314             }
00315             <span class="keywordflow">else</span>{
00316                 ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a22">IncludeCompositionT</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00317             }
00318         }
00319         ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a21">MakeStatusStrTaiwan2</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00320     }
00321 
00322     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o0">ModeStringLen</a> = ModeInfoPtr;
00323     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o1">Position</a> = <a class="code" href="../../d3/d5/conime_8h.html#a1">VIEW_LEFT</a>;
00324     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00325 }
00326 
00327 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00328"></a><a class="code" href="../../d6/d7/country_8c.html#a20">00328</a> <a class="code" href="../../d6/d7/country_8c.html#a20">MakeStatusStrTaiwan1</a>(
00329     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00330     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00331     DWORD ModeInfoPtr
00332     )
00333 {
00334     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00335     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00336     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Length;
00337     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwConversion;
00338 
00339     dwConversion = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>;
00340 
00341     i = ModeInfoPtr;
00342     j = 0;
00343     Length = 0;
00344     <span class="keywordflow">while</span> (Length &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a87">IMECNameLength</a> ) {
00345         <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[j] == 0 )
00346             <span class="keywordflow">break</span>;
00347         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[j];
00348         Length += <a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar) ? 2 : 1;
00349         j++;
00350         i++;
00351     }
00352     <span class="keywordflow">if</span> (Length &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a87">IMECNameLength</a>+1) {
00353         <span class="keywordflow">for</span> (j = Length; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a87">IMECNameLength</a>+1; j++ ) {
00354             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00355         }
00356     }
00357 
00358     <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_FULLSHAPE) {
00359         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a82">IMECModeFullShapeLen</a>; j++)
00360             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a9">IMECModeFullShape</a>[j];
00361     }
00362     <span class="keywordflow">else</span>{
00363         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a83">IMECModeHalfShapeLen</a>; j++)
00364             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a10">IMECModeHalfShape</a>[j];
00365     }
00366 
00367     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00368 
00369 <span class="preprocessor">#if defined (CANDCOUNTPRC) //for wider candidate list space Oct.16.1996</span>
00370 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o16">fInCandidate</a>){
00371         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a86">IMECGuideLen</a>; j++ )
00372             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a13">IMECGuide</a>[8][2+j];
00373     }
00374     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o12">GuideLine</a>[0]){
00375         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a86">IMECGuideLen</a>; j++ )
00376             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o12">GuideLine</a>[j];
00377     }
00378 <span class="preprocessor">#endif</span>
00379 <span class="preprocessor"></span>
00380     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d4/d5/conimep_8h.html#a60">UNICODE_COLON</a>;
00381 
00382     <span class="keywordflow">for</span> (j = 0; j &lt; i; j++ )
00383         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[j].Attributes = 0x0007;
00384     <span class="keywordflow">return</span> i;
00385 }
00386 
00387 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00388"></a><a class="code" href="../../d6/d7/country_8c.html#a21">00388</a> <a class="code" href="../../d6/d7/country_8c.html#a21">MakeStatusStrTaiwan2</a>(
00389     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00390     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00391     DWORD ModeInfoPtr
00392     )
00393 {
00394     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthOfStr;
00395     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthForNum;
00396     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthForNum2;
00397     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CountDispWidth;
00398     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> StatusWidth;
00399     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00400     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00401 
00402     i = ModeInfoPtr;
00403 
00404     StatusWidth = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o2">ScreenBufferSize</a>.X;
00405     <span class="keywordflow">if</span> (StatusWidth &gt; <a class="code" href="../../d3/d5/conime_8h.html#a3">MAXSTATUSCOL</a>) {
00406         StatusWidth = <a class="code" href="../../d3/d5/conime_8h.html#a3">MAXSTATUSCOL</a>;
00407     }
00408 <span class="preprocessor">#if defined (CANDCOUNTCHT) //for wider candidate list space v-hirshi Oct.16.1996</span>
00409 <span class="preprocessor"></span>    LengthOfStr = <a class="code" href="../../d6/d7/country_8c.html#a24">DispLenStructedUnicode</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>,ModeInfoPtr) + 1 + 4;
00410 <span class="preprocessor">#else</span>
00411 <span class="preprocessor"></span>    LengthOfStr = <a class="code" href="../../d6/d7/country_8c.html#a24">DispLenStructedUnicode</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>,ModeInfoPtr);
00412 <span class="preprocessor">#endif</span>
00413 <span class="preprocessor"></span>
00414     <span class="keywordflow">if</span> (LengthOfStr &gt; StatusWidth) {
00415         <span class="keywordflow">for</span> ( ; LengthOfStr &gt; StatusWidth; i-- ) {
00416             LengthOfStr -= (<a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar) ? 2 : 1 );
00417         }
00418     }
00419 
00420     <span class="keywordflow">for</span> (j = 0; j &lt; (StatusWidth - LengthOfStr); j++) {
00421         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00422     }
00423 
00424 <span class="preprocessor">#if defined (CANDCOUNTCHT) //for wider candidate list space v-hirshi Oct.16.1996</span>
00425 <span class="preprocessor"></span>    lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00426 
00427     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a> &amp; IME_CMODE_SYMBOL) {
00428         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a85">IMECModeSymbolLen</a>; j++)
00429             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a12">IMECModeSymbol</a>[j];
00430     }
00431     <span class="keywordflow">else</span>{
00432         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a84">IMECModeKeyboardLen</a>; j++)
00433             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a11">IMECModeKeyboard</a>[j];
00434     }
00435 <span class="preprocessor">#endif</span>
00436 <span class="preprocessor"></span>
00437     <span class="keywordflow">for</span> (j = ModeInfoPtr; j &lt; i; j++ )
00438         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[j].Attributes = 0x0007;
00439     <span class="keywordflow">return</span> i;
00440 }
00441 
00442 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00443"></a><a class="code" href="../../d6/d7/country_8c.html#a22">00443</a> <a class="code" href="../../d6/d7/country_8c.html#a22">IncludeCompositionT</a>(
00444     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00445     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00446     DWORD ModeInfoPtr
00447     )
00448 {
00449     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00450     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00451     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> k;
00452     PWCHAR      TempBuf;
00453     PUCHAR      TempBufA;
00454     <a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">LPCONIME_UICOMPMESSAGE</a> lpCompStrMem;
00455 
00456     i = ModeInfoPtr;
00457     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00458         <span class="keywordflow">return</span> i;
00459     }
00460     lpCompStrMem = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a>;
00461     TempBuf  = (PWCHAR)((PUCHAR)lpCompStrMem + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">CONIME_UICOMPMESSAGE</a>));
00462     TempBufA = (PUCHAR)((PUCHAR)lpCompStrMem + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">CONIME_UICOMPMESSAGE</a>) +
00463                        lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o3">dwCompStrLen</a> +  <span class="keyword">sizeof</span>(WCHAR));
00464 
00465     k = 0;
00466     <span class="keywordflow">for</span> (j = 0; k &lt; lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o3">dwCompStrLen</a>; j++, k += <span class="keyword">sizeof</span>(WCHAR)) {
00467        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = TempBuf[j];
00468        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Attributes = lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o7">CompAttrColor</a>[TempBufA[j]];
00469     }
00470     <span class="keywordflow">return</span> i;
00471 }
00472 
00473 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00474"></a><a class="code" href="../../d6/d7/country_8c.html#a23">00474</a> <a class="code" href="../../d6/d7/country_8c.html#a23">IncludeCandidateT</a>(
00475     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00476     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00477     DWORD ModeInfoPtr
00478     )
00479 {
00480     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00481     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00482     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLength;
00483     PWCHAR      TempBuf;
00484     PUCHAR      TempBufA;
00485     <a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html">LPCONIME_CANDMESSAGE</a> SystemLine;
00486     <a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">LPCONIME_UICOMPMESSAGE</a> lpCompStrMem;
00487     lpCompStrMem = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a>;
00488 
00489     i = ModeInfoPtr;
00490     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o18">SystemLine</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00491         <span class="keywordflow">return</span> i;
00492     }
00493     SystemLine = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o18">SystemLine</a>;
00494     dwLength = (SystemLine-&gt;<a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html#o0">AttrOff</a> - <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) ) / <span class="keyword">sizeof</span>(WCHAR) ;
00495     TempBuf  = (PWCHAR)(SystemLine-&gt;<a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html#o1">String</a>);
00496     TempBufA = (PUCHAR)((LPSTR)SystemLine + SystemLine-&gt;<a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html#o0">AttrOff</a>);
00497 
00498     <span class="keywordflow">for</span> (j = 0; TempBuf[j] != 0; j++ ) {
00499        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = TempBuf[j];
00500        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Attributes = lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o7">CompAttrColor</a>[TempBufA[j]];
00501     }
00502 
00503     <span class="keywordflow">return</span> i;
00504 }
00505 
00506 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00507"></a><a class="code" href="../../d6/d7/country_8c.html#a24">00507</a> <a class="code" href="../../d6/d7/country_8c.html#a24">DispLenStructedUnicode</a>(
00508     PCHAR_INFO lpString,
00509     DWORD SrcLength
00510     )
00511 {
00512     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00513     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Length;
00514 
00515     Length = 0;
00516 
00517     <span class="keywordflow">for</span> ( i = 0; i &lt; SrcLength; i++) {
00518         Length += <a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(lpString[i].Char.UnicodeChar) ? 2 : 1;
00519     }
00520     <span class="keywordflow">return</span> Length;
00521 }
00522 
00523 
00524 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00525"></a><a class="code" href="../../d6/d7/country_8c.html#a25">00525</a> <a class="code" href="../../d6/d7/country_8c.html#a25">MakeInfoStringPRC</a>(
00526     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00527     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo
00528     )
00529 {
00530     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00531     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ModeInfoPtr;
00532     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthForDisp;
00533 
00534     ModeInfoPtr = 0;
00535 
00536     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o3">hklActive</a>) ){
00537         ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a26">MakeStatusStrPRC1</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00538         <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o13">fInComposition</a>) {
00539             <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o16">fInCandidate</a>){
00540                 ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a29">IncludeCandidateP</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00541             }
00542             <span class="keywordflow">else</span>{
00543                 ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a28">IncludeCompositionP</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00544             }
00545         }
00546         ModeInfoPtr = <a class="code" href="../../d6/d7/country_8c.html#a27">MakeStatusStrPRC2</a>(ConTbl, lpModeInfo, ModeInfoPtr);
00547     }
00548 
00549     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o0">ModeStringLen</a> = ModeInfoPtr;
00550     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o1">Position</a> = <a class="code" href="../../d3/d5/conime_8h.html#a1">VIEW_LEFT</a>;
00551     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00552 }
00553 
00554 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00555"></a><a class="code" href="../../d6/d7/country_8c.html#a26">00555</a> <a class="code" href="../../d6/d7/country_8c.html#a26">MakeStatusStrPRC1</a>(
00556     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00557     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00558     DWORD ModeInfoPtr
00559     )
00560 {
00561     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00562     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00563     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwConversion;
00564     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Length;
00565 
00566     dwConversion = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>;
00567 
00568     i = ModeInfoPtr;
00569     j = 0;
00570     Length = 0;
00571     <span class="keywordflow">while</span> (Length &lt; 9) {
00572         <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[j] == 0 )
00573             <span class="keywordflow">break</span>;
00574         <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[j] == 0x8f93)
00575             <span class="keywordflow">break</span>;
00576         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o11">LayoutName</a>[j];
00577         Length += <a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar) ? 2 : 1;
00578         j++;
00579         i++;
00580     }
00581     <span class="keywordflow">if</span> (Length &lt; 9) {
00582         <span class="keywordflow">for</span> (j = Length; j &lt; 9; j++ ) {
00583             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00584         }
00585     }
00586 
00587 
00588     <span class="keywordflow">if</span> (dwConversion &amp; IME_CMODE_FULLSHAPE) {
00589         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a82">IMECModeFullShapeLen</a>; j++)
00590             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a9">IMECModeFullShape</a>[j];
00591     }
00592     <span class="keywordflow">else</span>{
00593         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a83">IMECModeHalfShapeLen</a>; j++)
00594             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a10">IMECModeHalfShape</a>[j];
00595     }
00596 
00597 <span class="comment">// v-HirShi Oct.14.1996 delete it for get space</span>
00598 <span class="comment">//  lpModeInfo-&gt;ModeString[i++].Char.UnicodeChar = UNICODE_SPACE;</span>
00599 
00600     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d4/d5/conimep_8h.html#a60">UNICODE_COLON</a>;
00601 
00602     <span class="keywordflow">for</span> (j = 0; j &lt; i; j++ )
00603         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[j].Attributes = 0x0007;
00604     <span class="keywordflow">return</span> i;
00605 }
00606 
00607 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00608"></a><a class="code" href="../../d6/d7/country_8c.html#a27">00608</a> <a class="code" href="../../d6/d7/country_8c.html#a27">MakeStatusStrPRC2</a>(
00609     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00610     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00611     DWORD ModeInfoPtr
00612     )
00613 {
00614     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthOfStr;
00615     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthForNum;
00616     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LengthForNum2;
00617     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CountDispWidth;
00618     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> StatusWidth;
00619     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00620     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00621 
00622     i = ModeInfoPtr;
00623 
00624     StatusWidth = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o2">ScreenBufferSize</a>.X;
00625     <span class="keywordflow">if</span> (StatusWidth &gt; <a class="code" href="../../d3/d5/conime_8h.html#a3">MAXSTATUSCOL</a>) {
00626         StatusWidth = <a class="code" href="../../d3/d5/conime_8h.html#a3">MAXSTATUSCOL</a>;
00627     }
00628 <span class="preprocessor">#if defined (CANDCOUNTPRC) //for wider candidate list space v-hirshi Oct.16.1996</span>
00629 <span class="preprocessor"></span>    LengthOfStr = <a class="code" href="../../d6/d7/country_8c.html#a24">DispLenStructedUnicode</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>,ModeInfoPtr) + 1 + 4;
00630 <span class="preprocessor">#else</span>
00631 <span class="preprocessor"></span>    LengthOfStr = <a class="code" href="../../d6/d7/country_8c.html#a24">DispLenStructedUnicode</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>,ModeInfoPtr);
00632 <span class="preprocessor">#endif</span>
00633 <span class="preprocessor"></span>
00634     <span class="keywordflow">if</span> (LengthOfStr &gt; StatusWidth) {
00635         <span class="keywordflow">for</span> ( ; LengthOfStr &gt; StatusWidth; i-- ) {
00636             LengthOfStr -= (<a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar) ? 2 : 1 );
00637         }
00638     }
00639     <span class="keywordflow">for</span> (j = 0; j &lt; (StatusWidth - LengthOfStr); j++) {
00640         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00641     }
00642 <span class="preprocessor">#if defined (CANDCOUNTPRC) //for wider candidate list space v-hirshi Oct.16.1996</span>
00643 <span class="preprocessor"></span>    lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00644 
00645     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a> &amp; IME_CMODE_SYMBOL) {
00646         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a85">IMECModeSymbolLen</a>; j++)
00647             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a12">IMECModeSymbol</a>[j];
00648     }
00649     <span class="keywordflow">else</span>{
00650         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a84">IMECModeKeyboardLen</a>; j++)
00651             lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d6/d7/country_8c.html#a11">IMECModeKeyboard</a>[j];
00652     }
00653 <span class="preprocessor">#endif</span>
00654 <span class="preprocessor"></span>
00655     <span class="keywordflow">for</span> (j = ModeInfoPtr; j &lt; i; j++ )
00656         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[j].Attributes = 0x0007;
00657     <span class="keywordflow">return</span> i;
00658 }
00659 
00660 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00661"></a><a class="code" href="../../d6/d7/country_8c.html#a28">00661</a> <a class="code" href="../../d6/d7/country_8c.html#a28">IncludeCompositionP</a>(
00662     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00663     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00664     DWORD ModeInfoPtr
00665     )
00666 {
00667     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00668     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00669     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> k;
00670     PWCHAR      TempBuf;
00671     PUCHAR      TempBufA;
00672     <a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">LPCONIME_UICOMPMESSAGE</a> lpCompStrMem;
00673 
00674     i = ModeInfoPtr;
00675     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00676         <span class="keywordflow">return</span> i;
00677     }
00678     lpCompStrMem = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a>;
00679     TempBuf  = (PWCHAR)((PUCHAR)lpCompStrMem + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">CONIME_UICOMPMESSAGE</a>));
00680     TempBufA = (PUCHAR)((PUCHAR)lpCompStrMem + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">CONIME_UICOMPMESSAGE</a>) +
00681                        lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o3">dwCompStrLen</a> +  <span class="keyword">sizeof</span>(WCHAR));
00682 
00683     k = 0;
00684     <span class="keywordflow">for</span> (j = 0; k &lt; lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o3">dwCompStrLen</a>; j++, k += <span class="keyword">sizeof</span>(WCHAR)) {
00685        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = TempBuf[j];
00686        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Attributes = lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o7">CompAttrColor</a>[TempBufA[j]];
00687     }
00688     <span class="keywordflow">return</span> i;
00689 }
00690 
00691 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00692"></a><a class="code" href="../../d6/d7/country_8c.html#a29">00692</a> <a class="code" href="../../d6/d7/country_8c.html#a29">IncludeCandidateP</a>(
00693     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00694     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo,
00695     DWORD ModeInfoPtr
00696     )
00697 {
00698     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00699     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
00700     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> k;
00701     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> UnicodeLen;
00702     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLength;
00703     PWCHAR      TempBuf;
00704     PUCHAR      TempBufA;
00705     <a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html">LPCONIME_CANDMESSAGE</a> SystemLine;
00706     <a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">LPCONIME_UICOMPMESSAGE</a> lpCompStrMem;
00707 
00708     i = ModeInfoPtr;
00709     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o18">SystemLine</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00710         <span class="keywordflow">return</span> i;
00711     }
00712     lpCompStrMem = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a>;
00713     TempBuf  = (PWCHAR)((PUCHAR)lpCompStrMem + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">CONIME_UICOMPMESSAGE</a>));
00714     TempBufA = (PUCHAR)((PUCHAR)lpCompStrMem + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html">CONIME_UICOMPMESSAGE</a>) +
00715                        lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o3">dwCompStrLen</a> +  <span class="keyword">sizeof</span>(WCHAR));
00716 
00717     k = 0;
00718     UnicodeLen = 0;
00719     <span class="keywordflow">for</span> (j = 0; (k &lt; lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o3">dwCompStrLen</a> )&amp;&amp;(UnicodeLen &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a68">PRCCOMPWIDTH</a>); j++, k += <span class="keyword">sizeof</span>(WCHAR)) {
00720        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = TempBuf[j];
00721        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Attributes = lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o7">CompAttrColor</a>[TempBufA[j]];
00722        UnicodeLen += <a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(TempBuf[j]) ? 2 : 1;
00723     }
00724 
00725     <span class="keywordflow">for</span> ( j = UnicodeLen; j &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a68">PRCCOMPWIDTH</a>; j++) {
00726         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00727     }
00728     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d4/d5/conimep_8h.html#a60">UNICODE_COLON</a>;
00729 
00730     SystemLine = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o18">SystemLine</a>;
00731     dwLength = (SystemLine-&gt;<a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html#o0">AttrOff</a> - <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) ) / <span class="keyword">sizeof</span>(WCHAR) ;
00732     TempBuf  = (PWCHAR)(SystemLine-&gt;<a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html#o1">String</a>);
00733     TempBufA = (PUCHAR)((LPSTR)SystemLine + SystemLine-&gt;<a class="code" href="../../d8/d8/struct__CONIME__CANDMESSAGE.html#o0">AttrOff</a>);
00734 
00735     <span class="keywordflow">for</span> (j = 0; TempBuf[j] != 0; j++ ) {
00736        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i].Char.UnicodeChar = TempBuf[j];
00737        lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Attributes = lpCompStrMem-&gt;<a class="code" href="../../d9/d8/struct__CONIME__UICOMPMESSAGE.html#o7">CompAttrColor</a>[TempBufA[j]];
00738     }
00739 
00740     <span class="keywordflow">return</span> i;
00741 }
00742 
00743 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00744"></a><a class="code" href="../../d6/d7/country_8c.html#a30">00744</a> <a class="code" href="../../d6/d7/country_8c.html#a30">MakeInfoStringKorea</a>(
00745     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl,
00746     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo
00747     )
00748 {
00749     <span class="keywordtype">int</span> i , j;
00750 
00751     i = 0;
00752     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[i++].Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00753     <span class="keywordflow">for</span> (j = 0; j &lt; i; j++ )
00754         lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o2">ModeString</a>[j].Attributes = 0x0007;
00755     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o0">ModeStringLen</a> = i;
00756     lpModeInfo-&gt;<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html#o1">Position</a> = <a class="code" href="../../d3/d5/conime_8h.html#a2">VIEW_RIGHT</a>;
00757     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00758 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:34 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
