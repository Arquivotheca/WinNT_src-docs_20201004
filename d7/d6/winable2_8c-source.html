<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: winable2.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>winable2.c</h1><a href="../../d6/d7/winable2_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************** Module Header ********************************\</span>
00002 <span class="comment">* Module Name: winable2.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* This has the following Active Accesibility API</span>
00005 <span class="comment">*     GetGUIThreadInfo</span>
00006 <span class="comment">*</span>
00007 <span class="comment">* The Win Event Hooks are handled in winable.c</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00010 <span class="comment">*</span>
00011 <span class="comment">* History:</span>
00012 <span class="comment">* 08-30-96 IanJa  Ported from Windows '95</span>
00013 <span class="comment">\***************************************************************************/</span>
00014 
00015 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00016 <span class="preprocessor">#pragma hdrstop</span>
00017 <span class="preprocessor"></span>
00018 <span class="comment">/*****************************************************************************\</span>
00019 <span class="comment">*</span>
00020 <span class="comment">*  GetGUIThreadInfo()</span>
00021 <span class="comment">*</span>
00022 <span class="comment">*  This gets GUI information out of context.  If you pass in a NULL thread ID,</span>
00023 <span class="comment">*  we will get the 'global' information, using the foreground thread.  This</span>
00024 <span class="comment">*  is guaranteed to be the real active window, focus window, etc.  Yes, you</span>
00025 <span class="comment">*  could do it yourself by calling GetForegroundWindow, getting the thread ID</span>
00026 <span class="comment">*  of that window via GetWindowThreadProcessId, then passing the ID into</span>
00027 <span class="comment">*  GetGUIThreadInfo().  However, that takes three calls and aside from being</span>
00028 <span class="comment">*  a pain, anything could happen in the middle.  So passing in NULL gets</span>
00029 <span class="comment">*  you stuff in one call and hence also works right.</span>
00030 <span class="comment">*</span>
00031 <span class="comment">*  This function returns FALSE if the thread doesn't have a queue or the</span>
00032 <span class="comment">*  thread ID is bogus.</span>
00033 <span class="comment">*</span>
00034 <span class="comment">\*****************************************************************************/</span>
00035 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI
<a name="l00036"></a><a class="code" href="../../d6/d7/winable2_8c.html#a0">00036</a> <a class="code" href="../../d6/d7/winable2_8c.html#a0">_GetGUIThreadInfo</a>(<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti, PGUITHREADINFO pgui)
00037 {
00038     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00039 
00040     <span class="comment">/*</span>
00041 <span class="comment">     * Validate threadinfo structure</span>
00042 <span class="comment">     */</span>
00043     <span class="keywordflow">if</span> (pgui-&gt;cbSize != <span class="keyword">sizeof</span>(GUITHREADINFO)) {
00044         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"GUITHREADINFO.cbSize %d is wrong"</span>, pgui-&gt;cbSize);
00045         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00046     }
00047 
00048     <span class="comment">/*</span>
00049 <span class="comment">     * Is this a valid initialized GUI thread?</span>
00050 <span class="comment">     */</span>
00051     <span class="keywordflow">if</span> (pti != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00052         <span class="keywordflow">if</span> ((pq = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00053             <span class="comment">// does this ever happen?</span>
00054             RIPMSG1(RIP_ERROR, <span class="stringliteral">"GetGUIThreadInfo: No queue for pti %lx"</span>, pti);
00055             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00056         }
00057     } <span class="keywordflow">else</span> {
00058         <span class="comment">/*</span>
00059 <span class="comment">         * Use the foreground queue. To get menu state information we must also</span>
00060 <span class="comment">         * figure out the right pti.  This matches _GetForegroundWindow() logic.</span>
00061 <span class="comment">         */</span>
00062         <span class="keywordflow">if</span> ((pq = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00063             <span class="comment">// this does sometimes happen...</span>
00064             RIPMSG0(RIP_WARNING, <span class="stringliteral">"GetGUIThreadInfo: No foreground queue"</span>);
00065             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00066         }
00067 
00068         <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a> &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>)-&gt;pq == pq)) {
00069             pti = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>);
00070             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()-&gt;rpdesk != pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>) {
00071                 RIPERR0(ERROR_ACCESS_DENIED, RIP_VERBOSE, <span class="stringliteral">"Foreground window on different desktop"</span>);
00072                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00073             }
00074         }
00075     }
00076 
00077     UserAssert(pq != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00078 
00079     <span class="comment">/*</span>
00080 <span class="comment">     * For C2 security, verify that pq and pti are on the current thread's desktop.</span>
00081 <span class="comment">     * We can't directly determine which desktop pq belongs to, but we can at</span>
00082 <span class="comment">     * least ensure that any caret info we return is not from another desktop</span>
00083 <span class="comment">     */</span>
00084     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a> &amp;&amp;
00085             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>)-&gt;rpdesk != <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()-&gt;rpdesk)) {
00086         RIPERR0(ERROR_ACCESS_DENIED, RIP_VERBOSE, <span class="stringliteral">"Foreground caret on different desktop"</span>);
00087         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00088     }
00089     <span class="keywordflow">if</span> (pti &amp;&amp; (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a> != <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()-&gt;rpdesk)) {
00090         RIPERR0(ERROR_ACCESS_DENIED, RIP_VERBOSE, <span class="stringliteral">"Foreground thread on different desktop"</span>);
00091         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00092     }
00093 
00094     pgui-&gt;flags        = 0;
00095     pgui-&gt;hwndMoveSize = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00096     pgui-&gt;hwndMenuOwner = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00097 
00098     <span class="comment">/*</span>
00099 <span class="comment">     * Get Menu information from the THREADINFO</span>
00100 <span class="comment">     */</span>
00101     <span class="keywordflow">if</span> (pti != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00102         <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o30">pmsd</a> &amp;&amp; !pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o30">pmsd</a>-&gt;<a class="code" href="../../d4/d9/struct__MOVESIZEDATA.html#o16">fTrackCancelled</a> &amp;&amp; pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o30">pmsd</a>-&gt;<a class="code" href="../../d4/d9/struct__MOVESIZEDATA.html#o0">spwnd</a>) {
00103             pgui-&gt;flags |= GUI_INMOVESIZE;
00104             pgui-&gt;hwndMoveSize = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o30">pmsd</a>-&gt;<a class="code" href="../../d4/d9/struct__MOVESIZEDATA.html#o0">spwnd</a>);
00105         }
00106 
00107         <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a> &amp;&amp; pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a>-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>) {
00108             pgui-&gt;flags |= GUI_INMENUMODE;
00109 
00110             <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a>-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o1">fHasMenuBar</a>) {
00111                 <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a>-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o2">fIsSysMenu</a>) {
00112                     pgui-&gt;flags |= GUI_SYSTEMMENUMODE;
00113                 }
00114             } <span class="keywordflow">else</span> {
00115                 pgui-&gt;flags |= GUI_POPUPMENUMODE;
00116             }
00117 
00118             <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a>-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a>)
00119                 pgui-&gt;hwndMenuOwner = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a>-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a>);
00120         }
00121     }
00122 
00123     <span class="comment">/*</span>
00124 <span class="comment">     * Get the rest of the information from the queue</span>
00125 <span class="comment">     */</span>
00126     pgui-&gt;hwndActive   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>);
00127     pgui-&gt;hwndFocus    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>);
00128     pgui-&gt;hwndCapture  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>);
00129 
00130     pgui-&gt;hwndCaret    = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00131 
00132     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>) {
00133         pgui-&gt;hwndCaret = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>);
00134 
00135         <span class="comment">/*</span>
00136 <span class="comment">         * These coords are always relative to the client of hwndCaret</span>
00137 <span class="comment">         * of course.</span>
00138 <span class="comment">         */</span>
00139         pgui-&gt;rcCaret.left   = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o4">x</a>;
00140         pgui-&gt;rcCaret.right  = pgui-&gt;rcCaret.left + pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o7">cx</a>;
00141         pgui-&gt;rcCaret.top    = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o5">y</a>;
00142         pgui-&gt;rcCaret.bottom = pgui-&gt;rcCaret.top + pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o6">cy</a>;
00143 
00144         <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> == 0)
00145             pgui-&gt;flags |= GUI_CARETBLINKING;
00146     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pti &amp;&amp; (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;W32PF_Flags &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a58">W32PF_CONSOLEHASFOCUS</a>)) {
00147         <span class="comment">/*</span>
00148 <span class="comment">         * The thread is running in the console window with focus. Pull</span>
00149 <span class="comment">         * out the info from the console pseudo caret.</span>
00150 <span class="comment">         */</span>
00151         pgui-&gt;hwndCaret = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o19">cciConsole</a>.hwnd;
00152         pgui-&gt;rcCaret = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o19">cciConsole</a>.rc;
00153     } <span class="keywordflow">else</span> {
00154         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(&amp;pgui-&gt;rcCaret);
00155     }
00156 
00157     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00158 }
00159 
00160 
00161 <span class="comment">/****************************************************************************\</span>
00162 <span class="comment">*</span>
00163 <span class="comment">* _GetTitleBarInfo()</span>
00164 <span class="comment">*</span>
00165 <span class="comment">* Gets info about a window's title bar.  If the window is bogus or</span>
00166 <span class="comment">* doesn't have a titlebar, this will fail.</span>
00167 <span class="comment">*</span>
00168 <span class="comment">\****************************************************************************/</span>
00169 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI
<a name="l00170"></a><a class="code" href="../../d6/d7/winable2_8c.html#a1">00170</a> <a class="code" href="../../d6/d7/winable2_8c.html#a1">xxxGetTitleBarInfo</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, PTITLEBARINFO ptbi)
00171 {
00172     <span class="keywordtype">int</span>     cxB;
00173 
00174     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00175 
00176     <span class="comment">/*</span>
00177 <span class="comment">     * Validate titlebarinfo structure</span>
00178 <span class="comment">     */</span>
00179     <span class="keywordflow">if</span> (ptbi-&gt;cbSize != <span class="keyword">sizeof</span>(TITLEBARINFO)) {
00180         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"TITLEBARINFO.cbSize %d is wrong"</span>, ptbi-&gt;cbSize);
00181         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00182     }
00183 
00184     RtlZeroMemory(&amp;ptbi-&gt;rgstate, <span class="keyword">sizeof</span>(ptbi-&gt;rgstate));
00185 
00186     ptbi-&gt;rgstate[INDEX_TITLEBAR_SELF] |= STATE_SYSTEM_FOCUSABLE;
00187     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a645">WFBORDERMASK</a>) != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a646">WFCAPTION</a>))
00188     {
00189         <span class="comment">// No titlebar.</span>
00190         ptbi-&gt;rgstate[INDEX_TITLEBAR_SELF] |= STATE_SYSTEM_INVISIBLE;
00191         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00192     }
00193 
00194     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a553">WFCPRESENT</a>))
00195     {
00196         <span class="comment">// Off screen (didn't fit)</span>
00197         ptbi-&gt;rgstate[INDEX_TITLEBAR_SELF] |= STATE_SYSTEM_OFFSCREEN;
00198         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(&amp;ptbi-&gt;rcTitleBar);
00199         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00200     }
00201 
00202     <span class="comment">/*</span>
00203 <span class="comment">     * Get titlebar rect</span>
00204 <span class="comment">     */</span>
00205     ptbi-&gt;rcTitleBar = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>;
00206     cxB = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00207     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;ptbi-&gt;rcTitleBar, -cxB * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -cxB * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00208     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>)) {
00209         ptbi-&gt;rcTitleBar.bottom = ptbi-&gt;rcTitleBar.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMCAPTION);
00210     } <span class="keywordflow">else</span> {
00211         ptbi-&gt;rcTitleBar.bottom = ptbi-&gt;rcTitleBar.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYCAPTION);
00212     }
00213 
00214     <span class="comment">/*</span>
00215 <span class="comment">     * Don't include the system menu area!</span>
00216 <span class="comment">     */</span>
00217     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>) &amp;&amp; <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">_HasCaptionIcon</a>(pwnd))
00218         ptbi-&gt;rcTitleBar.left += (ptbi-&gt;rcTitleBar.bottom - ptbi-&gt;rcTitleBar.top - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00219 
00220     <span class="comment">/*</span>
00221 <span class="comment">     * Close button</span>
00222 <span class="comment">     */</span>
00223     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00224         ptbi-&gt;rgstate[INDEX_TITLEBAR_CLOSEBUTTON] |= STATE_SYSTEM_INVISIBLE;
00225     } <span class="keywordflow">else</span> {
00226         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a1">xxxMNCanClose</a>(pwnd))
00227             ptbi-&gt;rgstate[INDEX_TITLEBAR_CLOSEBUTTON] |= STATE_SYSTEM_UNAVAILABLE;
00228 
00229         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a597">WFCLOSEBUTTONDOWN</a>))
00230             ptbi-&gt;rgstate[INDEX_TITLEBAR_CLOSEBUTTON] |= STATE_SYSTEM_PRESSED;
00231     }
00232 
00233 
00234     <span class="comment">/*</span>
00235 <span class="comment">     * Max button</span>
00236 <span class="comment">     */</span>
00237     <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00238         ptbi-&gt;rgstate[INDEX_TITLEBAR_MAXBUTTON] |= STATE_SYSTEM_INVISIBLE;
00239     } <span class="keywordflow">else</span> {
00240         <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a634">WFMAXBOX</a>)) {
00241             <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a636">WFMINBOX</a>)) {
00242                 ptbi-&gt;rgstate[INDEX_TITLEBAR_MAXBUTTON] |= STATE_SYSTEM_INVISIBLE;
00243             } <span class="keywordflow">else</span> {
00244                 ptbi-&gt;rgstate[INDEX_TITLEBAR_MAXBUTTON] |= STATE_SYSTEM_UNAVAILABLE;
00245             }
00246         }
00247 
00248         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a598">WFZOOMBUTTONDOWN</a>))
00249             ptbi-&gt;rgstate[INDEX_TITLEBAR_MAXBUTTON] |= STATE_SYSTEM_PRESSED;
00250     }
00251 
00252 
00253     <span class="comment">/*</span>
00254 <span class="comment">     * Min button</span>
00255 <span class="comment">     */</span>
00256     <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00257         ptbi-&gt;rgstate[INDEX_TITLEBAR_MINBUTTON] |= STATE_SYSTEM_INVISIBLE;
00258     } <span class="keywordflow">else</span> {
00259         <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a636">WFMINBOX</a>)) {
00260             <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a634">WFMAXBOX</a>)) {
00261                 ptbi-&gt;rgstate[INDEX_TITLEBAR_MINBUTTON] |= STATE_SYSTEM_INVISIBLE;
00262             } <span class="keywordflow">else</span> {
00263                 ptbi-&gt;rgstate[INDEX_TITLEBAR_MINBUTTON] |= STATE_SYSTEM_UNAVAILABLE;
00264             }
00265         }
00266 
00267         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a599">WFREDUCEBUTTONDOWN</a>))
00268             ptbi-&gt;rgstate[INDEX_TITLEBAR_MINBUTTON] |= STATE_SYSTEM_PRESSED;
00269     }
00270 
00271 
00272     <span class="comment">/*</span>
00273 <span class="comment">     * Help button</span>
00274 <span class="comment">     */</span>
00275     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a623">WEFCONTEXTHELP</a>) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a636">WFMINBOX</a>) ||
00276             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a634">WFMAXBOX</a>)) {
00277         ptbi-&gt;rgstate[INDEX_TITLEBAR_HELPBUTTON] |= STATE_SYSTEM_INVISIBLE;
00278     } <span class="keywordflow">else</span> {
00279         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a600">WFHELPBUTTONDOWN</a>))
00280             ptbi-&gt;rgstate[INDEX_TITLEBAR_HELPBUTTON] |= STATE_SYSTEM_PRESSED;
00281     }
00282 
00283     <span class="comment">// IME button BOGUS!</span>
00284     ptbi-&gt;rgstate[INDEX_TITLEBAR_IMEBUTTON] = STATE_SYSTEM_INVISIBLE;
00285 
00286 <span class="preprocessor">#if 0</span>
00287 <span class="preprocessor"></span>    <span class="comment">/*</span>
00288 <span class="comment">     * System menu</span>
00289 <span class="comment">     */</span>
00290     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>) || !<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">_HasCaptionIcon</a>(pwnd))
00291         ptbi-&gt;stateSysMenu |= STATE_SYSTEM_INVISIBLE;
00292 <span class="preprocessor">#endif</span>
00293 <span class="preprocessor"></span>
00294     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00295 }
00296 
00297 <span class="comment">/*****************************************************************************\</span>
00298 <span class="comment">*</span>
00299 <span class="comment">*  _GetScrollBarInfo()</span>
00300 <span class="comment">*</span>
00301 <span class="comment">*  Gets state &amp; location information about a scrollbar.</span>
00302 <span class="comment">*</span>
00303 <span class="comment">*  Note we fill in the minimal amount of useful info.  OLEACC is responsible</span>
00304 <span class="comment">*  for extrapolation.  I.E., if both the line up and line down buttons are</span>
00305 <span class="comment">*  disabled, the whole scrollbar is, and the thumb is invisible.</span>
00306 <span class="comment">*</span>
00307 <span class="comment">\*****************************************************************************/</span>
00308 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI
<a name="l00309"></a><a class="code" href="../../d6/d7/winable2_8c.html#a2">00309</a> <a class="code" href="../../d6/d7/winable2_8c.html#a2">_GetScrollBarInfo</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LONG idObject, PSCROLLBARINFO psbi)
00310 {
00311     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   wDisable;
00312     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fVertical;
00313     <a class="code" href="../../d3/d5/structtagSBCALC.html">SBCALC</a> SBCalc;
00314 
00315     <span class="comment">/*</span>
00316 <span class="comment">     * Validate scrollbarinfo structure</span>
00317 <span class="comment">     */</span>
00318     <span class="keywordflow">if</span> (psbi-&gt;cbSize != <span class="keyword">sizeof</span>(SCROLLBARINFO)) {
00319         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"SCROLLBARINFO.cbSize %d is wrong"</span>, psbi-&gt;cbSize);
00320         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00321     }
00322 
00323     RtlZeroMemory(&amp;psbi-&gt;rgstate, <span class="keyword">sizeof</span>(psbi-&gt;rgstate));
00324 
00325     <span class="comment">/*</span>
00326 <span class="comment">     * Calculate where everything is.</span>
00327 <span class="comment">     */</span>
00328     <span class="keywordflow">if</span> (idObject == OBJID_CLIENT) {
00329         RECT rc;
00330         wDisable = ((<a class="code" href="../../d7/d5/structtagSBWND.html">PSBWND</a>)pwnd)-&gt;wDisableFlags;
00331         fVertical = ((<a class="code" href="../../d7/d5/structtagSBWND.html">PSBWND</a>)pwnd)-&gt;fVert;
00332         <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">GetRect</a>(pwnd, &amp;rc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a902">GRECT_CLIENT</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a905">GRECT_CLIENTCOORDS</a>);
00333         <a class="code" href="../../d4/d1/userk_8h.html#a1423">CalcSBStuff2</a>(&amp;SBCalc, &amp;rc, (<a class="code" href="../../d4/d5/structtagSBDATA.html">PSBDATA</a>)&amp;((<a class="code" href="../../d7/d5/structtagSBWND.html">PSBWND</a>)pwnd)-&gt;SBCalc, ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1093">PSBWND</a>)pwnd)-&gt;fVert);
00334     } <span class="keywordflow">else</span> {
00335         <span class="comment">/*</span>
00336 <span class="comment">         * Is this window scrollbar here?</span>
00337 <span class="comment">         */</span>
00338         <span class="keywordflow">if</span> (idObject == OBJID_VSCROLL) {
00339             fVertical = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00340             <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a641">WFVSCROLL</a>)) {
00341                 <span class="comment">// No scrollbar.</span>
00342                 psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] |= STATE_SYSTEM_INVISIBLE;
00343             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a551">WFVPRESENT</a>)) {
00344                 <span class="comment">// Window too short to display it.</span>
00345                 psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] |= STATE_SYSTEM_OFFSCREEN;
00346             }
00347         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idObject == OBJID_HSCROLL) {
00348             fVertical = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00349             <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a640">WFHSCROLL</a>)) {
00350                 <span class="comment">// No scrollbar.</span>
00351                 psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] |= STATE_SYSTEM_INVISIBLE;
00352             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a552">WFHPRESENT</a>)) {
00353                 psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] |= STATE_SYSTEM_OFFSCREEN;
00354             }
00355         } <span class="keywordflow">else</span> {
00356             RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"invalid idObject %d"</span>, idObject);
00357             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00358         }
00359 
00360         <span class="keywordflow">if</span> (psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] &amp; STATE_SYSTEM_INVISIBLE)
00361             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00362 
00363         wDisable = <a class="code" href="../../d4/d1/userk_8h.html#a1486">GetWndSBDisableFlags</a>(pwnd, fVertical);
00364 
00365         <span class="keywordflow">if</span> (!(psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] &amp; STATE_SYSTEM_OFFSCREEN))
00366             <a class="code" href="../../d4/d1/userk_8h.html#a1422">CalcSBStuff</a>(pwnd, &amp;SBCalc, fVertical);
00367     }
00368 
00369     <span class="comment">/*</span>
00370 <span class="comment">     * Setup button states.</span>
00371 <span class="comment">     */</span>
00372     <span class="keywordflow">if</span> (wDisable &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a765">LTUPFLAG</a>) {
00373         psbi-&gt;rgstate[INDEX_SCROLLBAR_UP] |= STATE_SYSTEM_UNAVAILABLE;
00374         psbi-&gt;rgstate[INDEX_SCROLLBAR_UPPAGE] |= STATE_SYSTEM_UNAVAILABLE;
00375     }
00376 
00377     <span class="keywordflow">if</span> (wDisable &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a766">RTDNFLAG</a>) {
00378         psbi-&gt;rgstate[INDEX_SCROLLBAR_DOWN] |= STATE_SYSTEM_UNAVAILABLE;
00379         psbi-&gt;rgstate[INDEX_SCROLLBAR_DOWNPAGE] |= STATE_SYSTEM_UNAVAILABLE;
00380     }
00381 
00382     <span class="keywordflow">if</span> ((wDisable &amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a765">LTUPFLAG</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a766">RTDNFLAG</a>)) == (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a765">LTUPFLAG</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a766">RTDNFLAG</a>))
00383         psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] |= STATE_SYSTEM_UNAVAILABLE;
00384 
00385     <span class="comment">/*</span>
00386 <span class="comment">     * Button pressed?</span>
00387 <span class="comment">     */</span>
00388     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a605">WFSCROLLBUTTONDOWN</a>) &amp;&amp;
00389             ((idObject != OBJID_VSCROLL) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a606">WFVERTSCROLLTRACK</a>))) {
00390         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a601">WFLINEUPBUTTONDOWN</a>))
00391             psbi-&gt;rgstate[INDEX_SCROLLBAR_UP] |= STATE_SYSTEM_PRESSED;
00392 
00393         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a602">WFPAGEUPBUTTONDOWN</a>))
00394             psbi-&gt;rgstate[INDEX_SCROLLBAR_UPPAGE] |= STATE_SYSTEM_PRESSED;
00395 
00396         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a603">WFPAGEDNBUTTONDOWN</a>))
00397             psbi-&gt;rgstate[INDEX_SCROLLBAR_DOWNPAGE] |= STATE_SYSTEM_PRESSED;
00398 
00399         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a604">WFLINEDNBUTTONDOWN</a>))
00400             psbi-&gt;rgstate[INDEX_SCROLLBAR_DOWN] |= STATE_SYSTEM_PRESSED;
00401     }
00402 
00403     <span class="comment">/*</span>
00404 <span class="comment">     * Fill in area locations.</span>
00405 <span class="comment">     */</span>
00406     <span class="keywordflow">if</span> (!(psbi-&gt;rgstate[INDEX_SCROLLBAR_SELF] &amp; STATE_SYSTEM_OFFSCREEN)) {
00407         <span class="keywordflow">if</span> (fVertical) {
00408             psbi-&gt;rcScrollBar.left = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o3">pxLeft</a>;
00409             psbi-&gt;rcScrollBar.top = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>;
00410             psbi-&gt;rcScrollBar.right = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o4">pxRight</a>;
00411             psbi-&gt;rcScrollBar.bottom = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o2">pxBottom</a>;
00412         } <span class="keywordflow">else</span> {
00413             psbi-&gt;rcScrollBar.left = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>;
00414             psbi-&gt;rcScrollBar.top = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o3">pxLeft</a>;
00415             psbi-&gt;rcScrollBar.right = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o2">pxBottom</a>;
00416             psbi-&gt;rcScrollBar.bottom = SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o4">pxRight</a>;
00417         }
00418 
00419         <span class="keywordflow">if</span> (idObject == OBJID_CLIENT) {
00420             <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(&amp;psbi-&gt;rcScrollBar, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
00421         } <span class="keywordflow">else</span> {
00422             <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(&amp;psbi-&gt;rcScrollBar, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top);
00423         }
00424 
00425         psbi-&gt;dxyLineButton = (SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o6">pxUpArrow</a> - SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>);
00426         psbi-&gt;xyThumbTop = (SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o10">pxThumbTop</a> - SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>);
00427         psbi-&gt;xyThumbBottom = (SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o9">pxThumbBottom</a> - SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>);
00428 
00429         <span class="comment">/*</span>
00430 <span class="comment">         * Is the thumb all the way to the left/top?  If so, page up is</span>
00431 <span class="comment">         * not visible.</span>
00432 <span class="comment">         */</span>
00433         <span class="keywordflow">if</span> (SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o10">pxThumbTop</a> == SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o6">pxUpArrow</a>)
00434             psbi-&gt;rgstate[INDEX_SCROLLBAR_UPPAGE] |= STATE_SYSTEM_INVISIBLE;
00435 
00436         <span class="comment">/*</span>
00437 <span class="comment">         * Is the thumb all the way to the right/down?  If so, page down</span>
00438 <span class="comment">         * is not visible.</span>
00439 <span class="comment">         */</span>
00440         <span class="keywordflow">if</span> (SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o9">pxThumbBottom</a> == SBCalc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o7">pxDownArrow</a>)
00441             psbi-&gt;rgstate[INDEX_SCROLLBAR_DOWNPAGE] |= STATE_SYSTEM_INVISIBLE;
00442     }
00443 
00444     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00445 }
00446 
00447 
00448 <span class="comment">/*****************************************************************************\</span>
00449 <span class="comment">* GetAncestor()</span>
00450 <span class="comment">*</span>
00451 <span class="comment">* This gets one of:</span>
00452 <span class="comment">*     * The _real_ parent.  This does NOT include the owner, unlike</span>
00453 <span class="comment">*         GetParent().  Stops at a top level window unless we start with</span>
00454 <span class="comment">*         the desktop.  In which case, we return the desktop.</span>
00455 <span class="comment">*     * The _real_ root, caused by walking up the chain getting the</span>
00456 <span class="comment">*         ancestor.</span>
00457 <span class="comment">*     * The _real_ owned root, caused by GetParent()ing up.</span>
00458 <span class="comment">\*****************************************************************************/</span>
00459 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> WINAPI
<a name="l00460"></a><a class="code" href="../../d6/d7/winable2_8c.html#a3">00460</a> <a class="code" href="../../d6/d7/winable2_8c.html#a3">_GetAncestor</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT gaFlags)
00461 {
00462     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00463 
00464     <span class="comment">/*</span>
00465 <span class="comment">     * If we start with the desktop return NULL.</span>
00466 <span class="comment">     */</span>
00467     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd))
00468         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00469 
00470     <span class="keywordflow">switch</span> (gaFlags) {
00471     <span class="keywordflow">case</span> GA_PARENT:
00472         pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>;
00473         <span class="keywordflow">break</span>;
00474 
00475     <span class="keywordflow">case</span> GA_ROOT:
00476         <span class="keywordflow">while</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)) &amp;&amp;
00477                (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d1/userk_8h.html#a323">PWNDMESSAGE</a>(pwnd))) {
00478             pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>;
00479         }
00480         <span class="keywordflow">break</span>;
00481 
00482     <span class="keywordflow">case</span> GA_ROOTOWNER:
00483         <span class="keywordflow">while</span> (pwndParent = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a14">_GetParent</a>(pwnd)) {
00484             pwnd = pwndParent;
00485         }
00486         <span class="keywordflow">break</span>;
00487     }
00488 
00489     <span class="keywordflow">return</span> pwnd;
00490 }
00491 
00492 
00493 <span class="comment">/*****************************************************************************\</span>
00494 <span class="comment">*</span>
00495 <span class="comment">* RealChildWindowFromPoint()</span>
00496 <span class="comment">*</span>
00497 <span class="comment">* This returns the REAL child window at a point.  The problem is that</span>
00498 <span class="comment">* ChildWindowFromPoint() doesn't deal with HTTRANSPARENT areas of</span>
00499 <span class="comment">* standard controls.  We want to return a child behind a groupbox if it</span>
00500 <span class="comment">* is in the "clear" area.  But we want to return a static field always</span>
00501 <span class="comment">* even though it too returns HTTRANSPARENT.</span>
00502 <span class="comment">*</span>
00503 <span class="comment">\*****************************************************************************/</span>
00504 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> WINAPI
<a name="l00505"></a><a class="code" href="../../d6/d7/winable2_8c.html#a4">00505</a> <a class="code" href="../../d6/d7/winable2_8c.html#a4">_RealChildWindowFromPoint</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent, POINT pt)
00506 {
00507     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndChild;
00508     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndSave;
00509 
00510     <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwndParent)) {
00511         pt.x += pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00512         pt.y += pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00513     }
00514 
00515     <span class="comment">/*</span>
00516 <span class="comment">     * Is this point even in the parent?</span>
00517 <span class="comment">     */</span>
00518     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>, pt)  ||
00519         (pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> &amp;&amp; !GrePtInRegion(pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>, pt.x, pt.y))) {
00520         <span class="comment">// Nope</span>
00521         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00522     }
00523 
00524     pwndSave = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00525 
00526     <span class="comment">/*</span>
00527 <span class="comment">     * Loop through the children.</span>
00528 <span class="comment">     */</span>
00529     <span class="keywordflow">for</span> (pwndChild = pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>; pwndChild; pwndChild = pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) {
00530         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00531             <span class="keywordflow">continue</span>;
00532 
00533         <span class="comment">/*</span>
00534 <span class="comment">         * Is this point in the child's window?</span>
00535 <span class="comment">         */</span>
00536         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, pt) ||
00537                 (pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> &amp;&amp; !GrePtInRegion(pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>, pt.x, pt.y)))
00538             <span class="keywordflow">continue</span>;
00539 
00540         <span class="comment">/*</span>
00541 <span class="comment">         * OK, we are in somebody's window.  Is this by chance a group box?</span>
00542 <span class="comment">         */</span>
00543         <span class="keywordflow">if</span> ((pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a68">ICLS_BUTTON</a>]) ||
00544                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndChild) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>)) {
00545             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX)) {
00546                pwndSave = pwndChild;
00547                <span class="keywordflow">continue</span>;
00548             }
00549         }
00550 
00551         <span class="keywordflow">return</span> pwndChild;
00552     }
00553 
00554     <span class="comment">/*</span>
00555 <span class="comment">     * Did we save a groupbox which turned out to have nothing behind it</span>
00556 <span class="comment">     * at that point?</span>
00557 <span class="comment">     */</span>
00558     <span class="keywordflow">if</span> (pwndSave) {
00559         <span class="keywordflow">return</span> pwndSave;
00560     } <span class="keywordflow">else</span> {
00561         <span class="keywordflow">return</span> pwndParent;
00562     }
00563 }
00564 
00565 
00566 <span class="comment">/*****************************************************************************\</span>
00567 <span class="comment">* xxxGetMenuBarInfo()</span>
00568 <span class="comment">*</span>
00569 <span class="comment">* This succeeds if the menu/menu item exists.</span>
00570 <span class="comment">*</span>
00571 <span class="comment">* Parameters:</span>
00572 <span class="comment">*     pwnd        window</span>
00573 <span class="comment">*     idObject    this can be OBJID_MENU, OBJID_SYSMENU, or OBJID_CLIENT</span>
00574 <span class="comment">*     idItem      which thing do we need info on? 0..cItems. 0 indicates</span>
00575 <span class="comment">*                 the menu itself, 1 is the first item on the menu...</span>
00576 <span class="comment">*     pmbi        Pointer to a MENUBARINFO structure that gets filled in</span>
00577 <span class="comment">*</span>
00578 <span class="comment">\*****************************************************************************/</span>
00579 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI
<a name="l00580"></a><a class="code" href="../../d6/d7/winable2_8c.html#a5">00580</a> <a class="code" href="../../d6/d7/winable2_8c.html#a5">xxxGetMenuBarInfo</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <span class="keywordtype">long</span> idObject, <span class="keywordtype">long</span> idItem, PMENUBARINFO pmbi)
00581 {
00582     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>       pMenu;
00583     <span class="keywordtype">int</span>         cBorders;
00584     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>       pItem;
00585     <a class="code" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a>  ppopup;
00586 
00587     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00588 
00589     <span class="comment">/*</span>
00590 <span class="comment">     * Validate menubarinfo structure</span>
00591 <span class="comment">     */</span>
00592     <span class="keywordflow">if</span> (pmbi-&gt;cbSize != <span class="keyword">sizeof</span>(MENUBARINFO)) {
00593         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"MENUBARINFO.cbSize %d is wrong"</span>, pmbi-&gt;cbSize);
00594         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00595     }
00596 
00597     <span class="comment">/*</span>
00598 <span class="comment">     * Initialize the fields</span>
00599 <span class="comment">     */</span>
00600     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(&amp;pmbi-&gt;rcBar);
00601     pmbi-&gt;hMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00602     pmbi-&gt;hwndMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00603     pmbi-&gt;fBarFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00604     pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00605 
00606     <span class="comment">/*</span>
00607 <span class="comment">     * Get the menu handle we will deal with.</span>
00608 <span class="comment">     */</span>
00609     <span class="keywordflow">if</span> (idObject == OBJID_MENU) {
00610         <span class="keywordtype">int</span> cBorders;
00611 
00612         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a654">WFCHILD</a>) || !pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)
00613             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00614 
00615         pMenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>;
00616         <span class="keywordflow">if</span> (!pMenu)
00617             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00618 
00619         <span class="comment">// If we have an item, is it in the valid range?</span>
00620         <span class="keywordflow">if</span> ((idItem &lt; 0) || ((DWORD)idItem &gt; pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>))
00621             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00622 
00623         <span class="comment">/*</span>
00624 <span class="comment">         * Menu handle</span>
00625 <span class="comment">         */</span>
00626         pmbi-&gt;hMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pMenu);
00627 
00628         <span class="comment">/*</span>
00629 <span class="comment">         * Menu rect</span>
00630 <span class="comment">         */</span>
00631         <span class="keywordflow">if</span> (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a> &amp;&amp; pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>) {
00632             <span class="keywordflow">if</span> (!idItem) {
00633                 cBorders = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00634                 pmbi-&gt;rcBar.left = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00635                 pmbi-&gt;rcBar.top = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top + cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00636 
00637                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a553">WFCPRESENT</a>)) {
00638                     pmbi-&gt;rcBar.top += (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMCAPTION) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYCAPTION));
00639                 }
00640 
00641                 pmbi-&gt;rcBar.right = pmbi-&gt;rcBar.left + pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a>;
00642                 pmbi-&gt;rcBar.bottom = pmbi-&gt;rcBar.top + pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
00643             } <span class="keywordflow">else</span> {
00644                 pItem = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a> + idItem - 1;
00645 
00646                 pmbi-&gt;rcBar.left = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
00647                 pmbi-&gt;rcBar.top = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00648                 pmbi-&gt;rcBar.right = pmbi-&gt;rcBar.left + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>;
00649                 pmbi-&gt;rcBar.bottom = pmbi-&gt;rcBar.top + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
00650             }
00651         }
00652 
00653         <span class="comment">/*</span>
00654 <span class="comment">         * Are we currently in app menu bar mode?</span>
00655 <span class="comment">         */</span>
00656         ppopup = <a class="code" href="../../d4/d1/userk_8h.html#a1321">GetpGlobalPopupMenu</a>(pwnd);
00657         <span class="keywordflow">if</span> (ppopup &amp;&amp; ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o1">fHasMenuBar</a> &amp;&amp; !ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o2">fIsSysMenu</a> &amp;&amp;
00658             (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a> == pwnd))
00659         {
00660             <span class="comment">// Yes, we are.</span>
00661             pmbi-&gt;fBarFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00662 
00663             <span class="keywordflow">if</span> (!idItem) {
00664                 pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00665             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o34">posSelectedItem</a> == (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)idItem-1) {
00666                 pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00667                 UserAssert(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a>);
00668                 pmbi-&gt;hwndMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o27">spwndNextPopup</a>);
00669             }
00670         }
00671 
00672     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idObject == OBJID_SYSMENU) {
00673         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>))
00674             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00675 
00676         pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1404">xxxGetSysMenu</a>(pwnd, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00677         <span class="keywordflow">if</span> (!pMenu)
00678             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00679 
00680         <span class="comment">// If we have an item, is it in the valid range?</span>
00681         <span class="keywordflow">if</span> ((idItem &lt; 0) || ((DWORD)idItem &gt; pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>))
00682             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00683 
00684         pmbi-&gt;hMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pMenu);
00685 
00686         <span class="comment">/*</span>
00687 <span class="comment">         * Menu rect</span>
00688 <span class="comment">         */</span>
00689         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">_HasCaptionIcon</a>(pwnd)) {
00690             <span class="comment">// The menu and single item take up the same space</span>
00691             cBorders = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00692             pmbi-&gt;rcBar.left = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00693             pmbi-&gt;rcBar.top = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top + cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00694 
00695             pmbi-&gt;rcBar.right = pmbi-&gt;rcBar.left +
00696                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE));
00697 
00698             pmbi-&gt;rcBar.bottom = pmbi-&gt;rcBar.top +
00699                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE));
00700         }
00701 
00702         <span class="comment">/*</span>
00703 <span class="comment">         * Are we currently in system menu bar mode?</span>
00704 <span class="comment">         */</span>
00705         ppopup = <a class="code" href="../../d4/d1/userk_8h.html#a1321">GetpGlobalPopupMenu</a>(pwnd);
00706         <span class="keywordflow">if</span> (ppopup &amp;&amp; ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o1">fHasMenuBar</a> &amp;&amp; ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o2">fIsSysMenu</a> &amp;&amp;
00707             (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a> == pwnd))
00708         {
00709             <span class="comment">// Yes, we are.</span>
00710             pmbi-&gt;fBarFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00711 
00712             <span class="keywordflow">if</span> (!idItem) {
00713                 pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00714             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o34">posSelectedItem</a> == (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)idItem - 1) {
00715                 pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00716                 UserAssert(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a>);
00717                 pmbi-&gt;hwndMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o27">spwndNextPopup</a>);
00718             }
00719         }
00720     }
00721     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idObject == OBJID_CLIENT)
00722     {
00723         HMENU hMenu;
00724         hMenu = (HMENU)<a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, MN_GETHMENU, 0, 0);
00725         pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a102">HtoP</a>(hMenu);
00726         <span class="keywordflow">if</span> (!pMenu)
00727             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00728 
00729         <span class="comment">// If we have an item, is it in the valid range?</span>
00730         <span class="keywordflow">if</span> ((idItem &lt; 0) || ((DWORD)idItem &gt; pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>))
00731             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00732 
00733         pmbi-&gt;hMenu = hMenu;
00734 
00735         <span class="keywordflow">if</span> (!idItem) {
00736             pmbi-&gt;rcBar = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00737         } <span class="keywordflow">else</span> {
00738             pItem = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a> + idItem - 1;
00739 
00740             pmbi-&gt;rcBar.left = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
00741             pmbi-&gt;rcBar.top = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00742             pmbi-&gt;rcBar.right = pmbi-&gt;rcBar.left + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>;
00743             pmbi-&gt;rcBar.bottom = pmbi-&gt;rcBar.top + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
00744         }
00745 
00746         <span class="comment">/*</span>
00747 <span class="comment">         * Are we currently in popup mode with us as one of the popups</span>
00748 <span class="comment">         * showing?</span>
00749 <span class="comment">         */</span>
00750         ppopup = ((<a class="code" href="../../d5/d1/structtagMENUWND.html">PMENUWND</a>)pwnd)-&gt;ppopupmenu;
00751         <span class="keywordflow">if</span> (ppopup &amp;&amp; (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o32">ppopupmenuRoot</a> == <a class="code" href="../../d4/d1/userk_8h.html#a1321">GetpGlobalPopupMenu</a>(pwnd))) {
00752             pmbi-&gt;fBarFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00753 
00754             <span class="keywordflow">if</span> (!idItem) {
00755                 pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00756             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)idItem == ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o34">posSelectedItem</a> + 1) {
00757                 pmbi-&gt;fFocused = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00758                 pmbi-&gt;hwndMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o27">spwndNextPopup</a>);
00759             }
00760         }
00761     } <span class="keywordflow">else</span> {
00762         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00763     }
00764 
00765     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00766 }
00767 
00768 
00769 <span class="comment">/***************************************************************************\</span>
00770 <span class="comment">*</span>
00771 <span class="comment">* _GetComboBoxInfo()</span>
00772 <span class="comment">*</span>
00773 <span class="comment">* This returns combobox information for either a combo or its dropdown</span>
00774 <span class="comment">* list.</span>
00775 <span class="comment">*</span>
00776 <span class="comment">\***************************************************************************/</span>
00777 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI
<a name="l00778"></a><a class="code" href="../../d6/d7/winable2_8c.html#a6">00778</a> <a class="code" href="../../d6/d7/winable2_8c.html#a6">_GetComboBoxInfo</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, PCOMBOBOXINFO pcbi)
00779 {
00780     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>    pcls;
00781     COMBOBOXINFO cbi = {
00782         <span class="keyword">sizeof</span> cbi,
00783     };
00784     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fOtherProcess;
00785     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRetval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00786     WORD wWindowType = 0;
00787 
00788     <span class="comment">/*</span>
00789 <span class="comment">     * Make sure it is a combobox or a dropdown</span>
00790 <span class="comment">     */</span>
00791     pcls = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>;
00792 
00793 
00794     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a201">FNID_COMBOBOX</a>) ||
00795             (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a73">ICLS_COMBOBOX</a>])) {
00796         wWindowType = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a201">FNID_COMBOBOX</a>;
00797     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a202">FNID_COMBOLISTBOX</a>) ||
00798             (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a81">ICLS_COMBOLISTBOX</a>])) {
00799         wWindowType = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a202">FNID_COMBOLISTBOX</a>;
00800     } <span class="keywordflow">else</span> {
00801         RIPERR1(ERROR_WINDOW_NOT_COMBOBOX, RIP_WARNING,
00802                 <span class="stringliteral">"pwnd %#p not a combobox or dropdown"</span>, pwnd);
00803         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00804     }
00805 
00806     <span class="comment">/*</span>
00807 <span class="comment">     * Validate combo structure</span>
00808 <span class="comment">     */</span>
00809     <span class="keywordflow">if</span> (pcbi-&gt;cbSize != <span class="keyword">sizeof</span>(COMBOBOXINFO)) {
00810         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"COMBOBOXINFO.cbSize %d is wrong"</span>, pcbi-&gt;cbSize);
00811         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00812     }
00813 
00814     <span class="keywordflow">if</span> (fOtherProcess = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi != <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>())) {
00815         <a class="code" href="../../d3/d5/procobj_8c.html#a4">KeAttachProcess</a>(&amp;<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi-&gt;Process-&gt;Pcb);
00816     }
00817 
00818     <span class="keywordflow">try</span> {
00819         <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> ccxPcboxSnap;
00820         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  ccxPwndSnap;
00821         HWND  ccxHwndSnap;
00822 
00823         <span class="comment">/*</span>
00824 <span class="comment">         * Snap and probe the CBOX structure, since it is client side.</span>
00825 <span class="comment">         */</span>
00826         <span class="keywordflow">if</span> (wWindowType == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a201">FNID_COMBOBOX</a>) {
00827             ccxPcboxSnap = ((<a class="code" href="../../d0/d1/structtagCOMBOWND.html">PCOMBOWND</a>)pwnd)-&gt;pcbox;
00828         } <span class="keywordflow">else</span> {
00829             <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> ccxPlbSnap;
00830             <span class="comment">/*</span>
00831 <span class="comment">             * If this is a listbox, we must snap and probe the LBIV structure</span>
00832 <span class="comment">             * in order to get to the CBOX structure.</span>
00833 <span class="comment">             */</span>
00834             ccxPlbSnap = ((<a class="code" href="../../d9/d9/structtagLBWND.html">PLBWND</a>)pwnd)-&gt;pLBIV;
00835             <span class="keywordflow">if</span> (!ccxPlbSnap) {
00836                 <span class="keywordflow">goto</span> errorexit;
00837             }
00838             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ccxPlbSnap, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d9/structtagLBIV.html">LBIV</a>), <a class="code" href="../../d4/d1/userk_8h.html#a22">DATAALIGN</a>);
00839             ccxPcboxSnap = ccxPlbSnap-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o58">pcbox</a>;
00840         }
00841         <span class="keywordflow">if</span> (!ccxPcboxSnap) {
00842             <span class="keywordflow">goto</span> errorexit;
00843         }
00844         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ccxPcboxSnap, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d9/structtagCBox.html">CBOX</a>), <a class="code" href="../../d4/d1/userk_8h.html#a22">DATAALIGN</a>);
00845 
00846         <span class="comment">/*</span>
00847 <span class="comment">         * Get the combo information now</span>
00848 <span class="comment">         */</span>
00849 
00850         <span class="comment">/*</span>
00851 <span class="comment">         * Snap and probe the client side pointer to the Combo window</span>
00852 <span class="comment">         */</span>
00853         ccxPwndSnap = ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>;
00854         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ccxPwndSnap, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__HEAD.html">HEAD</a>), <a class="code" href="../../d4/d1/userk_8h.html#a22">DATAALIGN</a>);
00855         cbi.hwndCombo = <a class="code" href="../../d1/d0/inc_2user_8h.html#a443">HWCCX</a>(ccxPwndSnap);
00856 
00857         <span class="comment">/*</span>
00858 <span class="comment">         * Snap &amp; probe the client side pointer to the Edit window.</span>
00859 <span class="comment">         * To compare spwndEdit and pwnd, we should compare handles</span>
00860 <span class="comment">         * since spwndEdit is a client-side address and pwnd is a</span>
00861 <span class="comment">         * kernel-mode address,</span>
00862 <span class="comment">         */</span>
00863 
00864         ccxPwndSnap = ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>;
00865         <span class="comment">/*</span>
00866 <span class="comment">         * If combobox is not fully initialized and spwndEdit is NULL,</span>
00867 <span class="comment">         * we should fail.</span>
00868 <span class="comment">         */</span>
00869         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ccxPwndSnap, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1014">HEAD</a>), <a class="code" href="../../d4/d1/userk_8h.html#a22">DATAALIGN</a>);
00870         ccxHwndSnap = <a class="code" href="../../d1/d0/inc_2user_8h.html#a443">HWCCX</a>(ccxPwndSnap);
00871         <span class="keywordflow">if</span> (ccxHwndSnap == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd)) {
00872             <span class="comment">/*</span>
00873 <span class="comment">             * ComboBox doesn't have Edit control.</span>
00874 <span class="comment">             */</span>
00875             cbi.hwndItem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00876         } <span class="keywordflow">else</span> {
00877             cbi.hwndItem = <a class="code" href="../../d1/d0/inc_2user_8h.html#a443">HWCCX</a>(ccxPwndSnap);
00878         }
00879 
00880         <span class="comment">/*</span>
00881 <span class="comment">         * Snap and probe the client side pointer to the List window</span>
00882 <span class="comment">         */</span>
00883         ccxPwndSnap = ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>;
00884         <span class="comment">/*</span>
00885 <span class="comment">         * If combobox is not fully initialized and spwndList is NULL,</span>
00886 <span class="comment">         * we should fail.</span>
00887 <span class="comment">         */</span>
00888         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ccxPwndSnap, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1014">HEAD</a>), <a class="code" href="../../d4/d1/userk_8h.html#a22">DATAALIGN</a>);
00889         cbi.hwndList = <a class="code" href="../../d1/d0/inc_2user_8h.html#a443">HWCCX</a>(ccxPwndSnap);
00890 
00891         <span class="comment">/*</span>
00892 <span class="comment">         * Snap the rest of the combo information.</span>
00893 <span class="comment">         * We don't need to probe any of these, since there are no more indirections.</span>
00894 <span class="comment">         */</span>
00895         cbi.rcItem = ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>;
00896         cbi.rcButton = ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>;
00897 
00898         <span class="comment">/*</span>
00899 <span class="comment">         * Button state</span>
00900 <span class="comment">         */</span>
00901         cbi.stateButton = 0;
00902         <span class="keywordflow">if</span> (ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> == CBS_SIMPLE) {
00903             cbi.stateButton |= STATE_SYSTEM_INVISIBLE;
00904         }
00905         <span class="keywordflow">if</span> (ccxPcboxSnap-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o14">fButtonPressed</a>) {
00906             cbi.stateButton |= STATE_SYSTEM_PRESSED;
00907         }
00908     } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00909         <span class="keywordflow">goto</span> errorexit;
00910     }
00911 
00912     *pcbi = cbi;
00913     bRetval = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00914 
00915 errorexit:
00916     <span class="keywordflow">if</span> (fOtherProcess) {
00917         <a class="code" href="../../d3/d5/procobj_8c.html#a7">KeDetachProcess</a>();
00918     }
00919     <span class="keywordflow">return</span> bRetval;
00920 }
00921 
00922 
00923 <span class="comment">/***************************************************************************\</span>
00924 <span class="comment">*</span>
00925 <span class="comment">* _GetListBoxInfo()</span>
00926 <span class="comment">*</span>
00927 <span class="comment">* Currently returns back the # of items per column.  There is no way to get</span>
00928 <span class="comment">* or calculate this info any other way in a multicolumn list.</span>
00929 <span class="comment">*</span>
00930 <span class="comment">* For now, no structure is returned. If we ever need one more thing, make one.</span>
00931 <span class="comment">*</span>
00932 <span class="comment">* Since I have to run on multiple platforms, I can't define a message.</span>
00933 <span class="comment">* To do so would require that</span>
00934 <span class="comment">*     * I make changes to the thunk table</span>
00935 <span class="comment">*     * I make sure the 32-bit define doesn't collide with some NT new msg</span>
00936 <span class="comment">*     * I use a different value on Win '95 vs Memphis due to additions</span>
00937 <span class="comment">*     * I test apps extensively since many of them pass on bogus valued</span>
00938 <span class="comment">*         messages to the listbox handler which checks to see if they</span>
00939 <span class="comment">*         are in range.  In other words, any value I pick is probably</span>
00940 <span class="comment">*         going to flake out MSVC++ 4.0.</span>
00941 <span class="comment">*</span>
00942 <span class="comment">*  Ergo an API instead.</span>
00943 <span class="comment">*</span>
00944 <span class="comment">\***************************************************************************/</span>
00945 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> WINAPI
<a name="l00946"></a><a class="code" href="../../d6/d7/winable2_8c.html#a7">00946</a> <a class="code" href="../../d6/d7/winable2_8c.html#a7">_GetListBoxInfo</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00947 {
00948     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>    pcls;
00949     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwRet = 0;
00950     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fOtherProcess;
00951 
00952     <span class="comment">/*</span>
00953 <span class="comment">     * Make sure it is a combobox or a dropdown</span>
00954 <span class="comment">     */</span>
00955     pcls = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>;
00956     <span class="keywordflow">if</span> ((pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a71">ICLS_LISTBOX</a>]) &amp;&amp;
00957             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>)) {
00958         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"pwnd %#p is not a listbox"</span>, pwnd);
00959         <span class="keywordflow">return</span> 0;
00960     }
00961 
00962     <span class="keywordflow">if</span> (fOtherProcess = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi != <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>())) {
00963         <a class="code" href="../../d3/d5/procobj_8c.html#a4">KeAttachProcess</a>(&amp;<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi-&gt;Process-&gt;Pcb);
00964     }
00965 
00966     <span class="keywordflow">try</span> {
00967         <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a>   ccxPlbSnap;
00968 
00969         <span class="comment">/*</span>
00970 <span class="comment">         * Snap and probe the pointer to the LBIV, since it is client-side.</span>
00971 <span class="comment">         */</span>
00972         ccxPlbSnap = ((<a class="code" href="../../d9/d9/structtagLBWND.html">PLBWND</a>)pwnd)-&gt;pLBIV;
00973         <span class="keywordflow">if</span> (!ccxPlbSnap) {
00974             <span class="keywordflow">goto</span> errorexit;
00975         }
00976         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ccxPlbSnap, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d9/structtagLBIV.html">LBIV</a>), <a class="code" href="../../d4/d1/userk_8h.html#a22">DATAALIGN</a>);
00977 
00978         <span class="keywordflow">if</span> (ccxPlbSnap-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00979             dwRet = ccxPlbSnap-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o15">itemsPerColumn</a>;
00980         } <span class="keywordflow">else</span> {
00981             dwRet = ccxPlbSnap-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>;
00982         }
00983     } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00984         dwRet = 0;
00985     }
00986 
00987 errorexit:
00988     <span class="keywordflow">if</span> (fOtherProcess) {
00989         <a class="code" href="../../d3/d5/procobj_8c.html#a7">KeDetachProcess</a>();
00990     }
00991 
00992     <span class="keywordflow">return</span> dwRet;
00993 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
