<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: sftkbdt1.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>sftkbdt1.c</h1><a href="../../d6/d8/sftkbdt1_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************************************************************\</span>
00002 <span class="comment">* Module Name: sftkbdt1.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Soft keyboard support for Traditional Chinese</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 02-Jan-1996 wkwok    - ported from Win95</span>
00010 <span class="comment">\**************************************************************************/</span>
00011 <span class="preprocessor">#include "<a class="code" href="../../d8/d3/w32_2ntuser_2imm_2precomp_8h.html">precomp.h</a>"</span>
00012 <span class="preprocessor">#pragma hdrstop</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d9/softkbd_8h.html">softkbd.h</a>"</span>
00015 
00016 
<a name="l00017"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a1">00017</a> CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a1">bSKT1VirtKey</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a41">SKT1_TOTAL_KEY_NUM</a>] = {     <span class="comment">// Virtual Key for Letter Buttons</span>
00018 <span class="comment">//  `          1    2    3    4    5    6    7    8    9    0</span>
00019     VK_OEM_3, <span class="charliteral">'1'</span>, <span class="charliteral">'2'</span>, <span class="charliteral">'3'</span>, <span class="charliteral">'4'</span>, <span class="charliteral">'5'</span>, <span class="charliteral">'6'</span>, <span class="charliteral">'7'</span>, <span class="charliteral">'8'</span>, <span class="charliteral">'9'</span>, <span class="charliteral">'0'</span>,
00020 <span class="comment">//  -             =             \\                line 1 letter above</span>
00021     VK_OEM_MINUS, VK_OEM_EQUAL, VK_OEM_BSLASH,
00022 <span class="comment">//   q    w    e    r    t    y    u    i    o    p</span>
00023     <span class="charliteral">'Q'</span>, <span class="charliteral">'W'</span>, <span class="charliteral">'E'</span>, <span class="charliteral">'R'</span>, <span class="charliteral">'T'</span>, <span class="charliteral">'Y'</span>, <span class="charliteral">'U'</span>, <span class="charliteral">'I'</span>, <span class="charliteral">'O'</span>, <span class="charliteral">'P'</span>,
00024 <span class="comment">//  [                ]                            line 2 letter above</span>
00025     VK_OEM_LBRACKET, VK_OEM_RBRACKET,
00026 <span class="comment">//   a    s    d    f    g    h    j    k    l</span>
00027     <span class="charliteral">'A'</span>, <span class="charliteral">'S'</span>, <span class="charliteral">'D'</span>, <span class="charliteral">'F'</span>, <span class="charliteral">'G'</span>, <span class="charliteral">'H'</span>, <span class="charliteral">'J'</span>, <span class="charliteral">'K'</span>, <span class="charliteral">'L'</span>,
00028 <span class="comment">//   ;               '                            line 3 letter above</span>
00029     VK_OEM_SEMICLN, VK_OEM_QUOTE,
00030 <span class="comment">//   z    x    c    v    b    n    m</span>
00031     <span class="charliteral">'Z'</span>, <span class="charliteral">'X'</span>, <span class="charliteral">'C'</span>, <span class="charliteral">'V'</span>, <span class="charliteral">'B'</span>, <span class="charliteral">'N'</span>, <span class="charliteral">'M'</span>,
00032 <span class="comment">//  ,              .              /               line 4 letter above</span>
00033     VK_OEM_COMMA,  VK_OEM_PERIOD, VK_OEM_SLASH,
00034 <span class="comment">//  &lt;-       tab     caps        enter</span>
00035     VK_BACK, VK_TAB, VK_CAPITAL, VK_RETURN,
00036 <span class="comment">//  shift1    shift2    ctrl1       ctrl2</span>
00037     VK_SHIFT, VK_SHIFT, VK_CONTROL, VK_CONTROL,
00038 <span class="comment">//  alt1     alt2     esc        space            special key above</span>
00039     VK_MENU, VK_MENU, VK_ESCAPE, VK_SPACE
00040 };
00041 
00042 
<a name="l00043"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">00043</a> LOGFONT <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>;
00044 
00045 
00046 <span class="comment">/**********************************************************************/</span>
00047 <span class="comment">/* GetSKT1TextMetric                                                  */</span>
00048 <span class="comment">/**********************************************************************/</span>
00049 
<a name="l00050"></a><a class="code" href="../../d7/d9/softkbd_8h.html#a145">00050</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a145">GetSKT1TextMetric</a>(
00051      LPTEXTMETRIC   lptm)
00052 {
00053     HDC     hDC;
00054     HFONT   hOldFont;
00055     SIZE    szDbcs;
00056     <span class="keyword">const</span> WCHAR wcDbcs = 0x4e11;
00057 
00058     hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>((HWND)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00059 
00060     <span class="comment">// get the 9 pixels font</span>
00061     RtlZeroMemory(&amp;<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>, <span class="keyword">sizeof</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>);
00062     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfHeight = -12;
00063     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfWeight = FW_NORMAL;
00064 
00065     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfCharSet = CHINESEBIG5_CHARSET;
00066 
00067     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfOutPrecision = OUT_TT_ONLY_PRECIS;
00068     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfClipPrecision = CLIP_DEFAULT_PRECIS;
00069     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfQuality = PROOF_QUALITY;
00070     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfPitchAndFamily = FIXED_PITCH|FF_MODERN;
00071 
00072     hOldFont = (HFONT)SelectObject(hDC, CreateFontIndirect(&amp;<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>));
00073 
00074     GetTextMetrics(hDC, lptm);
00075 
00076     <span class="comment">/*</span>
00077 <span class="comment">     * NT5: Dirty hack for "Lucida Console" which was "font linked" on NT5, and</span>
00078 <span class="comment">     * GetTextMetrics API does not return correct text metrics.</span>
00079 <span class="comment">     */</span>
00080     <span class="keywordflow">if</span> (GetTextExtentPoint32(hDC, &amp;wcDbcs, 1, &amp;szDbcs) &amp;&amp; lptm-&gt;tmMaxCharWidth &lt; szDbcs.cx) {
00081         TAGMSG2(DBGTAG_IMM, <span class="stringliteral">"GetSKT1TextMetric: tmMaxCharWidth(%d) is smaller than real width(%d)."</span>,
00082                 lptm-&gt;tmMaxCharWidth, szDbcs.cx);
00083         lptm-&gt;tmMaxCharWidth = szDbcs.cx;
00084     }
00085 
00086     DeleteObject(SelectObject(hDC, hOldFont));
00087 
00088     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>((HWND)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, hDC);
00089 
00090     <span class="keywordflow">return</span>;
00091 }
00092 
00093 <span class="comment">/**********************************************************************/</span>
00094 <span class="comment">/* InitSKT1ButtonPos                                                  */</span>
00095 <span class="comment">/**********************************************************************/</span>
<a name="l00096"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a4">00096</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a4">InitSKT1ButtonPos</a>(
00097     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt)
00098 {
00099     TEXTMETRIC  tm;
00100     <span class="keywordtype">int</span>         nButtonWidthUnit, nButtonHeightUnit;
00101     <span class="keywordtype">int</span>         i, nLetterButtonStart, nLetterButtonEnd, xStartPos, yStartPos;
00102 
00103     <a class="code" href="../../d7/d9/softkbd_8h.html#a145">GetSKT1TextMetric</a>(&amp;tm);
00104 
00105     nButtonWidthUnit = tm.tmMaxCharWidth + <a class="code" href="../../d7/d9/softkbd_8h.html#a46">SKT1_LABEL_BMP_X</a> - <a class="code" href="../../d7/d9/softkbd_8h.html#a8">SKT1_XOVERLAP</a>;
00106 
00107 <span class="preprocessor">#define INIT_WIDTH(name, width) \</span>
00108 <span class="preprocessor">            lpSKT1Ctxt-&gt;nButtonWidth[SKT1_ ## name ## _TYPE] = (width)</span>
00109 <span class="preprocessor"></span>
00110     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(LETTER,      nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a11">SKT1_LETTER_WIDTH_TIMES</a> / 2);
00111     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(BACKSPACE,   nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a12">SKT1_BACKSPACE_WIDTH_TIMES</a> / 2 + 1);
00112     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(TAB,         nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a13">SKT1_TAB_WIDTH_TIMES</a> / 2 + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2);
00113     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(CAPS,        nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a14">SKT1_CAPS_WIDTH_TIMES</a> / 2 + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00114     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(<a class="code" href="../../d7/d4/trace_8h.html#a0">ENTER</a>,       nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a15">SKT1_ENTER_WIDTH_TIMES</a> / 2 + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2);
00115     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(<a class="code" href="../../d2/d9/uipriv_8c.html#a0">SHIFT</a>,       nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a16">SKT1_SHIFT_WIDTH_TIMES</a> / 2 + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2);
00116     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(CTRL,        nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a17">SKT1_CTRL_WIDTH_TIMES</a> / 2 + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2);
00117     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(ALT,         nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a18">SKT1_ALT_WIDTH_TIMES</a> / 2 + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2);
00118     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(ESC,         nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a19">SKT1_ESC_WIDTH_TIMES</a> / 2 + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> / 2);
00119     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a0">INIT_WIDTH</a>(<a class="code" href="../../d9/d7/udf_8h.html#a27">SPACE</a>,       nButtonWidthUnit * <a class="code" href="../../d7/d9/softkbd_8h.html#a20">SKT1_SPACE_WIDTH_TIMES</a> / 2 + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> * 5);
00120 
00121 <span class="preprocessor">#undef INIT_WIDTH</span>
00122 <span class="preprocessor"></span>
00123     nButtonHeightUnit = tm.tmHeight + <a class="code" href="../../d7/d9/softkbd_8h.html#a47">SKT1_LABEL_BMP_Y</a>;
00124     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] = nButtonHeightUnit;
00125     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[1] = nButtonHeightUnit * 2 + <a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a>; <span class="comment">// enter</span>
00126 
00127     <span class="comment">// init first row attribute</span>
00128     xStartPos = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a9">gptRaiseEdge</a>.x + <a class="code" href="../../d7/d9/softkbd_8h.html#a3">SKT1_XOUT</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2;
00129     yStartPos = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a9">gptRaiseEdge</a>.y + <a class="code" href="../../d7/d9/softkbd_8h.html#a4">SKT1_YOUT</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a> + 1) / 2;
00130 
00131     nLetterButtonStart = 0;
00132     nLetterButtonEnd = nLetterButtonStart + <a class="code" href="../../d7/d9/softkbd_8h.html#a42">SKT1_ROW1_LETTER_NUM</a>;
00133 
00134     <span class="keywordflow">for</span> (i = nLetterButtonStart; i &lt; nLetterButtonEnd; i++) {
00135         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x = xStartPos;
00136         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y = yStartPos;
00137         xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00138     }
00139     <span class="comment">// backspace</span>
00140     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].x = xStartPos;
00141     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].y = yStartPos;
00142 
00143     <span class="comment">// init second row attribute</span>
00144     xStartPos = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a9">gptRaiseEdge</a>.x + <a class="code" href="../../d7/d9/softkbd_8h.html#a3">SKT1_XOUT</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2;
00145     yStartPos += (nButtonHeightUnit + <a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a>);
00146     <span class="comment">// tab</span>
00147     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].x = xStartPos;
00148     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].y = yStartPos;
00149     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a137">SKT1_TAB_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00150     <span class="comment">// letter</span>
00151     nLetterButtonStart = nLetterButtonEnd;
00152     nLetterButtonEnd = nLetterButtonStart + <a class="code" href="../../d7/d9/softkbd_8h.html#a43">SKT1_ROW2_LETTER_NUM</a>;
00153     <span class="keywordflow">for</span> (i = nLetterButtonStart; i &lt; nLetterButtonEnd; i++) {
00154         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x = xStartPos;
00155         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y = yStartPos;
00156         xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00157     }
00158     <span class="comment">// enter</span>
00159     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].x = xStartPos;
00160     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].y = yStartPos;
00161 
00162     <span class="comment">// init third row</span>
00163     xStartPos = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a9">gptRaiseEdge</a>.x + <a class="code" href="../../d7/d9/softkbd_8h.html#a3">SKT1_XOUT</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2;
00164     yStartPos += (nButtonHeightUnit + <a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a>);
00165     <span class="comment">// caps</span>
00166     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].x = xStartPos;
00167     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].y = yStartPos;
00168     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a138">SKT1_CAPS_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00169     <span class="comment">// letter</span>
00170     nLetterButtonStart = nLetterButtonEnd;
00171     nLetterButtonEnd = nLetterButtonStart + <a class="code" href="../../d7/d9/softkbd_8h.html#a44">SKT1_ROW3_LETTER_NUM</a>;
00172     <span class="keywordflow">for</span> (i = nLetterButtonStart; i &lt; nLetterButtonEnd; i++) {
00173         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x = xStartPos;
00174         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y = yStartPos;
00175         xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00176     }
00177 
00178     <span class="comment">// init fourth row</span>
00179     xStartPos = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a9">gptRaiseEdge</a>.x + <a class="code" href="../../d7/d9/softkbd_8h.html#a3">SKT1_XOUT</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2;
00180     yStartPos += (nButtonHeightUnit + <a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a>);
00181     <span class="comment">// shift 1</span>
00182     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].x = xStartPos;
00183     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].y = yStartPos;
00184     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00185     <span class="comment">// letter</span>
00186     nLetterButtonStart = nLetterButtonEnd;
00187     nLetterButtonEnd = nLetterButtonStart + <a class="code" href="../../d7/d9/softkbd_8h.html#a45">SKT1_ROW4_LETTER_NUM</a>;
00188     <span class="keywordflow">for</span> (i = nLetterButtonStart; i &lt; nLetterButtonEnd; i++) {
00189         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x = xStartPos;
00190         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y = yStartPos;
00191         xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00192     }
00193     <span class="comment">// shift 2</span>
00194     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].x = xStartPos;
00195     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].y = yStartPos;
00196 
00197     <span class="comment">// init fifth row</span>
00198     xStartPos = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a9">gptRaiseEdge</a>.x + <a class="code" href="../../d7/d9/softkbd_8h.html#a3">SKT1_XOUT</a> + (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2;
00199     yStartPos += (nButtonHeightUnit + <a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a>);
00200     <span class="comment">// ctrl 1</span>
00201     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].x = xStartPos;
00202     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].y = yStartPos;
00203     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00204     <span class="comment">// esc</span>
00205     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].x = xStartPos;
00206     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].y = yStartPos;
00207     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a143">SKT1_ESC_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00208     <span class="comment">// alt 1</span>
00209     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].x = xStartPos;
00210     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].y = yStartPos;
00211     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00212     <span class="comment">// space</span>
00213     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>].x = xStartPos;
00214     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>].y = yStartPos;
00215     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a144">SKT1_SPACE_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00216     <span class="comment">// alt 2 .. skip blank</span>
00217     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].x = xStartPos;
00218     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].y = yStartPos;
00219     xStartPos += (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>) +
00220         (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a143">SKT1_ESC_TYPE</a>] + <a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a>);
00221     <span class="comment">// ctrl 2</span>
00222     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].x = xStartPos;
00223     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].y = yStartPos;
00224 
00225     <span class="keywordflow">return</span>;
00226 }
00227 
00228 <span class="comment">/**********************************************************************/</span>
00229 <span class="comment">/* SKT1DrawConvexRect                                                 */</span>
00230 <span class="comment">/*     draw a convex rectangle                                        */</span>
00231 <span class="comment">/*              (x,y)     x+nWidth+1                                  */</span>
00232 <span class="comment">/*               +-----1------+                                       */</span>
00233 <span class="comment">/*               |+----2-----||                                       */</span>
00234 <span class="comment">/*               ||          ||                                       */</span>
00235 <span class="comment">/*               ||          3|                                       */</span>
00236 <span class="comment">/*               ||          ||                                       */</span>
00237 <span class="comment">/*               |V          || &lt;---- Rectangle                       */</span>
00238 <span class="comment">/*               |&lt;----------+|                                       */</span>
00239 <span class="comment">/*  y+nHeight+1  +------------+                                       */</span>
00240 <span class="comment">/*  1 - black                                                         */</span>
00241 <span class="comment">/*  2 - while                                                         */</span>
00242 <span class="comment">/*  3 - dark gray                                                     */</span>
00243 <span class="comment">/**********************************************************************/</span>
<a name="l00244"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">00244</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(
00245     HDC hDC,
00246     <span class="keywordtype">int</span> x,
00247     <span class="keywordtype">int</span> y,
00248     <span class="keywordtype">int</span> nWidth,
00249     <span class="keywordtype">int</span> nHeight)
00250 {
00251     <span class="comment">// extend the context rect size</span>
00252     x -= (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1) / 2;
00253     y -= (<a class="code" href="../../d7/d9/softkbd_8h.html#a2">SKT1_YIN</a> + 1) / 2;
00254     nWidth += (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1);
00255     nHeight += (<a class="code" href="../../d7/d9/softkbd_8h.html#a1">SKT1_XIN</a> + 1);
00256 
00257     <span class="comment">// 1</span>
00258     SelectObject(hDC, GetStockObject(BLACK_PEN));
00259     SelectObject(hDC, GetStockObject(LTGRAY_BRUSH));
00260     Rectangle(hDC, x, y, x + nWidth, y + nHeight);
00261     PatBlt(hDC, x, y, 1, 1, PATCOPY);
00262     PatBlt(hDC, x + nWidth, y, -1, 1, PATCOPY);
00263     PatBlt(hDC, x, y + nHeight, 1, -1, PATCOPY);
00264     PatBlt(hDC, x + nWidth, y + nHeight, -1, -1, PATCOPY);
00265 
00266     x++;
00267     y++;
00268     nWidth -= 2;
00269     nHeight -= 2;
00270 
00271     <span class="comment">// 2</span>
00272     PatBlt(hDC, x, y + nHeight, 1, -nHeight, WHITENESS);
00273     PatBlt(hDC, x, y, nWidth , 1, WHITENESS);
00274     <span class="comment">// 3</span>
00275     SelectObject(hDC, GetStockObject(GRAY_BRUSH));
00276     PatBlt(hDC, x, y + nHeight, nWidth, -1, PATCOPY);
00277     PatBlt(hDC, x + nWidth, y + nHeight, -1, -nHeight, PATCOPY);
00278 
00279     <span class="keywordflow">return</span>;
00280 }
00281 
00282 <span class="comment">/**********************************************************************/</span>
00283 <span class="comment">/* SKT1DrawBitmap                                                     */</span>
00284 <span class="comment">/**********************************************************************/</span>
<a name="l00285"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">00285</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(
00286     HDC hDC,
00287     <span class="keywordtype">int</span> x,
00288     <span class="keywordtype">int</span> y,
00289     <span class="keywordtype">int</span> nWidth,
00290     <span class="keywordtype">int</span> nHeight,
00291     LPCWSTR lpszBitmap)
00292 {
00293     HDC     hMemDC;
00294     HBITMAP hBitmap, hOldBmp;
00295 
00296     hBitmap = (HBITMAP)LoadBitmap(<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a2">ghInst</a>, lpszBitmap);
00297 
00298     hMemDC = CreateCompatibleDC(hDC);
00299 
00300     hOldBmp = (HBITMAP)SelectObject(hMemDC, hBitmap);
00301 
00302     BitBlt(hDC, x, y, nWidth, nHeight, hMemDC, 0 , 0, SRCCOPY);
00303 
00304     SelectObject(hMemDC, hOldBmp);
00305 
00306     DeleteObject(hBitmap);
00307 
00308     DeleteDC(hMemDC);
00309 
00310     <span class="keywordflow">return</span>;
00311 }
00312 
00313 <span class="comment">/**********************************************************************/</span>
00314 <span class="comment">/* SKT1DrawLabel                                                      */</span>
00315 <span class="comment">/**********************************************************************/</span>
<a name="l00316"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a7">00316</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a7">SKT1DrawLabel</a>(
00317     HDC        hDC,
00318     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt,
00319     LPCWSTR     lpszLabel)
00320 {
00321     HDC     hMemDC;
00322     HBITMAP hBitmap, hOldBmp;
00323     <span class="keywordtype">int</span>     i;
00324 
00325     hBitmap = LoadBitmap(<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a2">ghInst</a>, lpszLabel);
00326     hMemDC = CreateCompatibleDC(hDC);
00327     hOldBmp = (HBITMAP)SelectObject(hMemDC, hBitmap);
00328 
00329     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a21">SKT1_LETTER_KEY_NUM</a>; i++) {
00330         BitBlt(hDC,
00331             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y,
00332             <a class="code" href="../../d7/d9/softkbd_8h.html#a46">SKT1_LABEL_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a47">SKT1_LABEL_BMP_Y</a>,
00333             hMemDC, i * <a class="code" href="../../d7/d9/softkbd_8h.html#a46">SKT1_LABEL_BMP_X</a>, 0, SRCCOPY);
00334     }
00335 
00336     SelectObject(hMemDC, hOldBmp);
00337     DeleteDC(hMemDC);
00338     DeleteObject(hBitmap);
00339 
00340     <span class="keywordflow">return</span>;
00341 }
00342 
00343 
00344 <span class="comment">/**********************************************************************/</span>
00345 <span class="comment">/* InitSKT1Bitmap                                                     */</span>
00346 <span class="comment">/**********************************************************************/</span>
<a name="l00347"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a8">00347</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a8">InitSKT1Bitmap</a>(
00348     HWND hSKWnd,
00349     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt)
00350 {
00351     HDC  hDC, hMemDC;
00352     RECT rcClient;
00353     <span class="keywordtype">int</span>  i;
00354 
00355     hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
00356     hMemDC = CreateCompatibleDC(hDC);
00357     <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hSKWnd, &amp;rcClient);
00358     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o4">hSKBitmap</a> = CreateCompatibleBitmap(hDC,
00359         rcClient.right - rcClient.left,
00360         rcClient.bottom - rcClient.top);
00361     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd, hDC);
00362     SelectObject(hMemDC, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o4">hSKBitmap</a>);
00363 
00364     <span class="comment">// draw SK rectangle</span>
00365     SelectObject(hMemDC, GetStockObject(NULL_PEN));
00366     SelectObject(hMemDC, GetStockObject(LTGRAY_BRUSH));
00367     Rectangle(hMemDC, rcClient.left, rcClient.top,
00368         rcClient.right + 1, rcClient.bottom + 1);
00369 
00370     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hMemDC, &amp;rcClient, BDR_RAISED, BF_RECT);
00371 
00372     <span class="comment">// draw the button from the last line</span>
00373     <span class="comment">// ctrl 1   -&gt; line 5 special key</span>
00374     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00375         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].x,
00376         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].y,
00377         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>],
00378         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00379     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00380         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].x +
00381         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a58">SKT1_CTRL_BMP_X</a> / 2,
00382         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].y +
00383         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a59">SKT1_CTRL_BMP_Y</a> / 2,
00384         <a class="code" href="../../d7/d9/softkbd_8h.html#a58">SKT1_CTRL_BMP_X</a>,
00385         <a class="code" href="../../d7/d9/softkbd_8h.html#a59">SKT1_CTRL_BMP_Y</a>,
00386         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a33">CTRL_T1</a>));
00387 
00388     <span class="comment">// ctrl 2</span>
00389     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00390         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].x,
00391         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].y,
00392         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>],
00393         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00394     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00395         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].x +
00396         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a58">SKT1_CTRL_BMP_X</a> / 2,
00397         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].y +
00398         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a59">SKT1_CTRL_BMP_Y</a> / 2,
00399         <a class="code" href="../../d7/d9/softkbd_8h.html#a58">SKT1_CTRL_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a59">SKT1_CTRL_BMP_Y</a>,
00400         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a33">CTRL_T1</a>));
00401 
00402     <span class="comment">// esc</span>
00403     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00404         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].x,
00405         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].y,
00406         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a143">SKT1_ESC_TYPE</a>],
00407         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00408     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00409         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].x +
00410         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a143">SKT1_ESC_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a60">SKT1_ESC_BMP_X</a> / 2,
00411         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].y +
00412         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a61">SKT1_ESC_BMP_Y</a> / 2,
00413         <a class="code" href="../../d7/d9/softkbd_8h.html#a60">SKT1_ESC_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a61">SKT1_ESC_BMP_Y</a>,
00414         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a34">ESC_T1</a>));
00415 
00416     <span class="comment">// alt 1</span>
00417     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00418         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].x,
00419         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].y,
00420         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>],
00421         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00422     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00423         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].x +
00424         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a62">SKT1_ALT_BMP_X</a> / 2,
00425         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].y +
00426         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a63">SKT1_ALT_BMP_Y</a> / 2,
00427         <a class="code" href="../../d7/d9/softkbd_8h.html#a62">SKT1_ALT_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a63">SKT1_ALT_BMP_Y</a>,
00428         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a35">ALT_T1</a>));
00429 
00430     <span class="comment">// alt 2</span>
00431     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00432         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].x,
00433         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].y,
00434         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>],
00435         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00436     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00437         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].x +
00438         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a62">SKT1_ALT_BMP_X</a> / 2,
00439         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].y +
00440         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a63">SKT1_ALT_BMP_Y</a> / 2,
00441         <a class="code" href="../../d7/d9/softkbd_8h.html#a62">SKT1_ALT_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a63">SKT1_ALT_BMP_Y</a>,
00442         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a35">ALT_T1</a>));
00443 
00444     <span class="comment">// space</span>
00445     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00446         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>].x,
00447         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>].y,
00448         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a144">SKT1_SPACE_TYPE</a>],
00449         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00450 
00451     <span class="comment">// line 4</span>
00452     <span class="comment">// shift 1</span>
00453     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00454         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].x,
00455         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].y,
00456         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>],
00457         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00458     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00459         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].x +
00460         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a56">SKT1_SHIFT_BMP_X</a> / 2,
00461         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].y +
00462         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a57">SKT1_SHIFT_BMP_Y</a> / 2,
00463         <a class="code" href="../../d7/d9/softkbd_8h.html#a56">SKT1_SHIFT_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a57">SKT1_SHIFT_BMP_Y</a>,
00464         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a32">SHIFT_T1</a>));
00465 
00466     <span class="comment">// shift 2</span>
00467     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00468         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].x,
00469         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].y,
00470         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>],
00471         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00472     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00473         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].x +
00474         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a56">SKT1_SHIFT_BMP_X</a> / 2,
00475         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].y +
00476         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a57">SKT1_SHIFT_BMP_Y</a> / 2,
00477         <a class="code" href="../../d7/d9/softkbd_8h.html#a56">SKT1_SHIFT_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a57">SKT1_SHIFT_BMP_Y</a>,
00478         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a32">SHIFT_T1</a>));
00479 
00480     <span class="comment">// line 3</span>
00481     <span class="comment">// caps</span>
00482     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00483         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].x,
00484         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].y,
00485         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a138">SKT1_CAPS_TYPE</a>],
00486         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00487     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00488         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].x +
00489         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a138">SKT1_CAPS_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a52">SKT1_CAPS_BMP_X</a> / 2,
00490         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].y +
00491         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a53">SKT1_CAPS_BMP_Y</a> / 2,
00492         <a class="code" href="../../d7/d9/softkbd_8h.html#a52">SKT1_CAPS_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a53">SKT1_CAPS_BMP_Y</a>,
00493         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a30">CAPS_T1</a>));
00494 
00495     <span class="comment">// line 2</span>
00496     <span class="comment">// tab</span>
00497     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00498         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].x,
00499         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].y,
00500         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a137">SKT1_TAB_TYPE</a>],
00501         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00502     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00503         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].x +
00504         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a137">SKT1_TAB_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a50">SKT1_TAB_BMP_X</a> / 2,
00505         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].y +
00506         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a51">SKT1_TAB_BMP_Y</a> / 2,
00507         <a class="code" href="../../d7/d9/softkbd_8h.html#a50">SKT1_TAB_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a51">SKT1_TAB_BMP_Y</a>,
00508         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a29">TAB_T1</a>));
00509 
00510     <span class="comment">// enter</span>
00511     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00512         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].x,
00513         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].y,
00514         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a139">SKT1_ENTER_TYPE</a>],
00515         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[1]);
00516     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00517         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].x +
00518         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a139">SKT1_ENTER_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a54">SKT1_ENTER_BMP_X</a> / 2,
00519         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].y +
00520         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[1] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a55">SKT1_ENTER_BMP_Y</a> / 2,
00521         <a class="code" href="../../d7/d9/softkbd_8h.html#a54">SKT1_ENTER_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a55">SKT1_ENTER_BMP_Y</a>,
00522         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a31">ENTER_T1</a>));
00523 
00524     <span class="comment">// line 1</span>
00525     <span class="comment">// backspace</span>
00526     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00527         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].x,
00528         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].y,
00529         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a136">SKT1_BACKSPACE_TYPE</a>],
00530         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00531     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a6">SKT1DrawBitmap</a>(hMemDC,
00532         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].x +
00533         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a136">SKT1_BACKSPACE_TYPE</a>] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a48">SKT1_BACKSPACE_BMP_X</a> / 2,
00534         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].y +
00535         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] / 2 - <a class="code" href="../../d7/d9/softkbd_8h.html#a49">SKT1_BACKSPACE_BMP_Y</a> / 2,
00536         <a class="code" href="../../d7/d9/softkbd_8h.html#a48">SKT1_BACKSPACE_BMP_X</a>, <a class="code" href="../../d7/d9/softkbd_8h.html#a49">SKT1_BACKSPACE_BMP_Y</a>,
00537         MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a28">BACK_T1</a>));
00538 
00539     <span class="comment">// draw letter buttons</span>
00540     <span class="keywordflow">for</span> (i = <a class="code" href="../../d7/d9/softkbd_8h.html#a21">SKT1_LETTER_KEY_NUM</a> - 1; i &gt;= 0 ; i--) {
00541         <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a5">SKT1DrawConvexRect</a>(hMemDC,
00542             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x,
00543             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y,
00544             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>],
00545             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0]);
00546     }
00547 
00548     <span class="comment">// draw latter label</span>
00549     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a7">SKT1DrawLabel</a>(hMemDC, lpSKT1Ctxt, MAKEINTRESOURCEW(<a class="code" href="../../d4/d0/immcli_8h.html#a36">LABEL_T1</a>));
00550 
00551     DeleteDC(hMemDC);
00552 
00553     <span class="keywordflow">return</span>;
00554 }
00555 
00556 
00557 <span class="comment">/**********************************************************************/</span>
00558 <span class="comment">/* CreateT1Window                                                     */</span>
00559 <span class="comment">/**********************************************************************/</span>
<a name="l00560"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a9">00560</a> LRESULT <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a9">CreateT1Window</a>(
00561     HWND hSKWnd)
00562 {
00563     HGLOBAL    hSKT1Ctxt;
00564     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
00565 
00566     hSKT1Ctxt = GlobalAlloc(GHND, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">SKT1CTXT</a>));
00567     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
00568         <span class="keywordflow">return</span> (-1);
00569     }
00570 
00571     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
00572     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
00573         GlobalFree(hSKT1Ctxt);
00574         <span class="keywordflow">return</span> (-1);
00575     }
00576 
00577     <a class="code" href="../../d5/d9/cltxt_8h.html#a12">SetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>, (LONG_PTR)hSKT1Ctxt);
00578 
00579     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> = <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>;
00580     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x = <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>;
00581     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y = <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>;
00582     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o5">lfCharSet</a> = CHINESEBIG5_CHARSET;
00583 
00584     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a4">InitSKT1ButtonPos</a>(lpSKT1Ctxt);
00585 
00586     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a8">InitSKT1Bitmap</a>(hSKWnd, lpSKT1Ctxt);
00587 
00588     GlobalUnlock(hSKT1Ctxt);
00589 
00590     <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00591 }
00592 
00593 <span class="comment">/**********************************************************************/</span>
00594 <span class="comment">/* SKT1DrawDragBorder()                                               */</span>
00595 <span class="comment">/**********************************************************************/</span>
<a name="l00596"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">00596</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">SKT1DrawDragBorder</a>(
00597     HWND    hWnd,               <span class="comment">// window of IME is dragged</span>
00598     LPPOINT lpptCursor,         <span class="comment">// the cursor position</span>
00599     LPPOINT lpptOffset)         <span class="comment">// the offset form cursor to window org</span>
00600 {
00601     HDC  hDC;
00602     <span class="keywordtype">int</span>  cxBorder, cyBorder;
00603     <span class="keywordtype">int</span>  x, y;
00604     RECT rcWnd;
00605 
00606     cxBorder = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CXBORDER);   <span class="comment">// width of border</span>
00607     cyBorder = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CYBORDER);   <span class="comment">// height of border</span>
00608 
00609     x = lpptCursor-&gt;x - lpptOffset-&gt;x;
00610     y = lpptCursor-&gt;y - lpptOffset-&gt;y;
00611 
00612     <span class="comment">// check for the max boundary of the display</span>
00613     <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, &amp;rcWnd);
00614 
00615     <span class="comment">// draw the moving track</span>
00616     hDC = CreateDC(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DISPLAY"</span>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00617     SelectObject(hDC, GetStockObject(GRAY_BRUSH));
00618 
00619     <span class="comment">// -&gt;</span>
00620     PatBlt(hDC, x, y, rcWnd.right - rcWnd.left - cxBorder, cyBorder,
00621         PATINVERT);
00622     <span class="comment">// v</span>
00623     PatBlt(hDC, x, y + cyBorder, cxBorder, rcWnd.bottom - rcWnd.top -
00624         cyBorder, PATINVERT);
00625     <span class="comment">// _&gt;</span>
00626     PatBlt(hDC, x + cxBorder, y + rcWnd.bottom - rcWnd.top,
00627         rcWnd.right - rcWnd.left - cxBorder, -cyBorder, PATINVERT);
00628     <span class="comment">//  v</span>
00629     PatBlt(hDC, x + rcWnd.right - rcWnd.left, y,
00630         - cxBorder, rcWnd.bottom - rcWnd.top - cyBorder, PATINVERT);
00631 
00632     DeleteDC(hDC);
00633     <span class="keywordflow">return</span>;
00634 }
00635 
00636 <span class="comment">/**********************************************************************/</span>
00637 <span class="comment">/* DestroyT1Window                                                    */</span>
00638 <span class="comment">/**********************************************************************/</span>
<a name="l00639"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a11">00639</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a11">DestroyT1Window</a>(
00640     HWND hSKWnd)
00641 {
00642     HGLOBAL    hSKT1Ctxt;
00643     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
00644     HWND       hUIWnd;
00645 
00646     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
00647     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
00648         <span class="keywordflow">return</span>;
00649     }
00650 
00651     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
00652     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
00653         <span class="keywordflow">return</span>;
00654     }
00655 
00656     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x != <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a> &amp;&amp;
00657             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y != <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>) {
00658         <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">SKT1DrawDragBorder</a>(hSKWnd, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>,
00659             &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>);
00660     }
00661 
00662     DeleteObject(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o4">hSKBitmap</a>);
00663 
00664     GlobalUnlock(hSKT1Ctxt);
00665     GlobalFree(hSKT1Ctxt);
00666 
00667     hUIWnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a12">GetWindow</a>(hSKWnd, GW_OWNER);
00668     <span class="keywordflow">if</span> (!hUIWnd) {
00669         <span class="keywordflow">return</span>;
00670     }
00671 
00672     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hUIWnd, WM_IME_NOTIFY, IMN_SOFTKBDDESTROYED, 0);
00673 
00674     <span class="keywordflow">return</span>;
00675 }
00676 
00677 <span class="comment">/**********************************************************************/</span>
00678 <span class="comment">/* SKT1InvertButton                                                   */</span>
00679 <span class="comment">/**********************************************************************/</span>
<a name="l00680"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a12">00680</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a12">SKT1InvertButton</a>(
00681     HWND       hSKWnd,
00682     HDC        hPaintDC,
00683     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt,
00684     UINT       uKeyIndex)
00685 {
00686     HDC hDC;
00687     <span class="keywordtype">int</span> nWidth, nHeight;
00688 
00689     <span class="keywordflow">if</span> (uKeyIndex &gt;= <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>) {
00690         <span class="keywordflow">return</span>;
00691     }
00692 
00693     nWidth = 0;
00694     <span class="keywordflow">if</span> (hPaintDC) {
00695         hDC = hPaintDC;
00696     } <span class="keywordflow">else</span> {
00697         hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
00698     }
00699 
00700     <span class="keywordflow">if</span> (uKeyIndex &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a21">SKT1_LETTER_KEY_NUM</a>) {
00701         nWidth = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>];
00702     } <span class="keywordflow">else</span> {
00703         <span class="keywordflow">switch</span> (uKeyIndex) {
00704         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>:
00705             nWidth = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a136">SKT1_BACKSPACE_TYPE</a>];
00706             <span class="keywordflow">break</span>;
00707         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>:
00708             nWidth = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a137">SKT1_TAB_TYPE</a>];
00709             <span class="keywordflow">break</span>;
00710         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>:
00711             nWidth = 0;
00712             <a class="code" href="../../d3/d8/client_8c.html#a110">MessageBeep</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) -1);
00713             <span class="keywordflow">break</span>;
00714         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>:
00715             nWidth = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a139">SKT1_ENTER_TYPE</a>];
00716             <span class="keywordflow">break</span>;
00717         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>:
00718         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1:
00719         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>:
00720         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1:
00721         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>:
00722         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1:
00723             nWidth = 0;
00724             <a class="code" href="../../d3/d8/client_8c.html#a110">MessageBeep</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) -1);
00725             <span class="keywordflow">break</span>;
00726         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>:
00727             nWidth = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a143">SKT1_ESC_TYPE</a>];
00728             <span class="keywordflow">break</span>;
00729         <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>:
00730             nWidth = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a144">SKT1_SPACE_TYPE</a>];
00731             <span class="keywordflow">break</span>;
00732         <span class="keywordflow">default</span>:
00733             <span class="keywordflow">break</span>;
00734         }
00735     }
00736 
00737     <span class="keywordflow">if</span> (uKeyIndex == <a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>) {
00738         nHeight = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[1];
00739     } <span class="keywordflow">else</span> {
00740         nHeight = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0];
00741     }
00742 
00743     <span class="keywordflow">if</span> (nWidth) {
00744         <span class="comment">// do not reverse border</span>
00745         PatBlt(hDC, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[uKeyIndex].x - 1,
00746             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[uKeyIndex].y - 1,
00747             nWidth + 2, nHeight + 2, DSTINVERT);
00748     }
00749 
00750     <span class="keywordflow">if</span> (!hPaintDC) {
00751         <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd, hDC);
00752     }
00753 
00754     <span class="keywordflow">return</span>;
00755 }
00756 
00757 <span class="comment">/**********************************************************************/</span>
00758 <span class="comment">/* UpdateSKT1Window                                                   */</span>
00759 <span class="comment">/**********************************************************************/</span>
<a name="l00760"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a13">00760</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a13">UpdateSKT1Window</a>(
00761     HDC  hDC,
00762     HWND hSKWnd)
00763 {
00764     HGLOBAL    hSKT1Ctxt;
00765     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
00766     HDC        hMemDC;
00767     RECT       rcClient;
00768 
00769     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
00770     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
00771         <span class="keywordflow">return</span>;
00772     }
00773 
00774     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
00775     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
00776         <span class="keywordflow">return</span>;
00777     }
00778 
00779     hMemDC = CreateCompatibleDC(hDC);
00780 
00781     SelectObject(hMemDC, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o4">hSKBitmap</a>);
00782 
00783     <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hSKWnd, &amp;rcClient);
00784 
00785     BitBlt(hDC, 0, 0, rcClient.right - rcClient.left,
00786         rcClient.bottom - rcClient.top,
00787         hMemDC, 0, 0, SRCCOPY);
00788 
00789     DeleteDC(hMemDC);
00790 
00791     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>) {
00792         <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a12">SKT1InvertButton</a>(hSKWnd, hDC, lpSKT1Ctxt, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a>);
00793     }
00794 
00795     GlobalUnlock(hSKT1Ctxt);
00796 
00797     <span class="keywordflow">return</span>;
00798 }
00799 
00800 <span class="comment">/**********************************************************************/</span>
00801 <span class="comment">/* SKT1MousePosition()                                                */</span>
00802 <span class="comment">/**********************************************************************/</span>
<a name="l00803"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a14">00803</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a14">SKT1MousePosition</a>(
00804     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt,
00805     LPPOINT    lpptCursor)
00806 {
00807     <span class="keywordtype">int</span>   i;
00808 
00809     <span class="comment">// check letter button</span>
00810     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a21">SKT1_LETTER_KEY_NUM</a>; i++) {
00811         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x,
00812                 lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y,
00813                 lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>],
00814                 lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00815                 lpptCursor)) {
00816             <span class="keywordflow">return</span> i;
00817         }
00818     }
00819 
00820     <span class="comment">// backSapce</span>
00821     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].x,
00822             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>].y,
00823             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a136">SKT1_BACKSPACE_TYPE</a>],
00824             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00825             lpptCursor)) {
00826         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>;
00827     }
00828 
00829     <span class="comment">// tab</span>
00830     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].x,
00831             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>].y,
00832             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a137">SKT1_TAB_TYPE</a>],
00833             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00834             lpptCursor)) {
00835         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>;
00836     }
00837 
00838     <span class="comment">// caps</span>
00839     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].x,
00840             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>].y,
00841             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a138">SKT1_CAPS_TYPE</a>],
00842             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00843             lpptCursor)) {
00844         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a26">SKT1_CAPS_INDEX</a>;
00845     }
00846 
00847     <span class="comment">// enter</span>
00848     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].x,
00849             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>].y,
00850             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a139">SKT1_ENTER_TYPE</a>],
00851             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[1],
00852             lpptCursor)) {
00853         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>;
00854     }
00855 
00856     <span class="comment">// shift 1</span>
00857     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].x,
00858             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>].y,
00859             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>],
00860             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00861             lpptCursor)) {
00862         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>;
00863     }
00864 
00865     <span class="comment">// shift 2</span>
00866     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].x,
00867             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a> + 1].y,
00868             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a140">SKT1_SHIFT_TYPE</a>],
00869             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00870             lpptCursor)) {
00871         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a30">SKT1_SHIFT_INDEX</a>;
00872     }
00873 
00874     <span class="comment">// ctrl 1</span>
00875     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].x,
00876             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>].y,
00877             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>],
00878             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00879             lpptCursor)) {
00880         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>;
00881     }
00882 
00883     <span class="comment">// ctrl 2</span>
00884     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].x,
00885             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a> + 1].y,
00886             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a141">SKT1_CTRL_TYPE</a>],
00887             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00888             lpptCursor)) {
00889         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a32">SKT1_CTRL_INDEX</a>;
00890     }
00891 
00892     <span class="comment">// alt 1</span>
00893     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].x,
00894             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>].y,
00895             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>],
00896             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00897             lpptCursor)) {
00898         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>;
00899     }
00900 
00901     <span class="comment">// alt 2</span>
00902     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].x,
00903             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a> + 1].y,
00904             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a142">SKT1_ALT_TYPE</a>],
00905             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00906             lpptCursor)) {
00907         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a34">SKT1_ALT_INDEX</a>;
00908     }
00909 
00910     <span class="comment">// esc</span>
00911     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].x,
00912             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>].y,
00913             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a143">SKT1_ESC_TYPE</a>],
00914             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00915             lpptCursor)) {
00916         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>;
00917     }
00918 
00919     <span class="comment">// space</span>
00920     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a35">ImmPtInRect</a>(lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>].x,
00921             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>].y,
00922             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a144">SKT1_SPACE_TYPE</a>],
00923             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0],
00924             lpptCursor)) {
00925         <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>;
00926     }
00927 
00928     <span class="keywordflow">return</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>;      <span class="comment">// This means out of range</span>
00929 }
00930 
00931 <span class="comment">/**********************************************************************/</span>
00932 <span class="comment">/* SKT1IsValidButton                                                  */</span>
00933 <span class="comment">/**********************************************************************/</span>
<a name="l00934"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a15">00934</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a15">SKT1IsValidButton</a>(
00935     UINT       uKeyIndex,
00936     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt)
00937 {
00938     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet;
00939 
00940     <span class="keywordflow">if</span> (uKeyIndex &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a21">SKT1_LETTER_KEY_NUM</a>) {
00941         <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o3">wCodeTable</a>[uKeyIndex]) {
00942             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00943         } <span class="keywordflow">else</span> {
00944             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00945         }
00946     }
00947 
00948     <span class="comment">// special key</span>
00949     <span class="keywordflow">switch</span> (uKeyIndex) {
00950     <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a22">SKT1_BACKSPACE_INDEX</a>:
00951     <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a24">SKT1_TAB_INDEX</a>:
00952     <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a28">SKT1_ENTER_INDEX</a>:
00953     <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a36">SKT1_ESC_INDEX</a>:
00954     <span class="keywordflow">case</span> <a class="code" href="../../d7/d9/softkbd_8h.html#a38">SKT1_SPACE_INDEX</a>:
00955         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00956         <span class="keywordflow">break</span>;
00957     <span class="keywordflow">default</span>:
00958         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00959         <span class="keywordflow">break</span>;
00960     }
00961 
00962     <span class="keywordflow">return</span> fRet;
00963 }
00964 
00965 <span class="comment">/**********************************************************************/</span>
00966 <span class="comment">/* SKT1SetCursor                                                      */</span>
00967 <span class="comment">/**********************************************************************/</span>
<a name="l00968"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a16">00968</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a16">SKT1SetCursor</a>(
00969     HWND   hSKWnd,
00970     LPARAM lParam)
00971 {
00972     HGLOBAL    hSKT1Ctxt;
00973     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
00974     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>       uKeyIndex;
00975     RECT       rcWnd;
00976     RECT       rcWork;
00977     SIZE       szWork;
00978     <span class="keyword">extern</span>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d9/softkbd_8c.html#a3">GetAllMonitorSize</a>(LPRECT lprc);
00979 
00980     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
00981     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
00982         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00983     }
00984 
00985     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
00986     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
00987         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00988     }
00989 
00990     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x != <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a> &amp;&amp;
00991             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y != <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>) {
00992         <span class="comment">// in drag operation</span>
00993         <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(LoadCursor(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, IDC_SIZEALL));
00994         <span class="keywordflow">goto</span> UnlockSKT1Ctxt;
00995     }
00996 
00997     <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>);
00998     <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(hSKWnd, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>);
00999 
01000     uKeyIndex = <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a14">SKT1MousePosition</a>(lpSKT1Ctxt, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>);
01001 
01002     <span class="keywordflow">if</span> (uKeyIndex &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>) {
01003         <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(LoadCursor(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, IDC_HAND));
01004     } <span class="keywordflow">else</span> {
01005         <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(LoadCursor(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, IDC_SIZEALL));
01006     }
01007 
01008 
01009     <span class="keywordflow">if</span> (HIWORD(lParam) != WM_LBUTTONDOWN) {
01010         <span class="keywordflow">goto</span> UnlockSKT1Ctxt;
01011     }
01012 
01013     <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(hSKWnd);
01014 
01015     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>) {
01016         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uVirtKey;
01017 
01018         uVirtKey = <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a1">bSKT1VirtKey</a>[lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a>];
01019         <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
01020             (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)KEYEVENTF_KEYUP, 0);
01021         <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a12">SKT1InvertButton</a>(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpSKT1Ctxt, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a>);
01022         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> = <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>;
01023     }
01024 
01025     <span class="keywordflow">if</span> (uKeyIndex &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>) {
01026         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uVirtKey;
01027 
01028         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a15">SKT1IsValidButton</a>(uKeyIndex, lpSKT1Ctxt)) {
01029             uVirtKey = <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a1">bSKT1VirtKey</a>[uKeyIndex];
01030             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
01031                 0, 0);
01032             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> = uKeyIndex;
01033             <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a12">SKT1InvertButton</a>(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpSKT1Ctxt, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a>);
01034         } <span class="keywordflow">else</span> {
01035             <a class="code" href="../../d3/d8/client_8c.html#a110">MessageBeep</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1);
01036         }
01037         <span class="keywordflow">goto</span> UnlockSKT1Ctxt;
01038     }
01039 
01040     <a class="code" href="../../d6/d9/softkbd_8c.html#a3">GetAllMonitorSize</a>(&amp;rcWork);
01041     szWork.cx = rcWork.right - rcWork.left;
01042     szWork.cy = rcWork.bottom - rcWork.top;
01043 
01044     <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>);
01045     <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(hSKWnd, &amp;rcWnd);
01046     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>.x - rcWnd.left;
01047     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>.y - rcWnd.top;
01048 
01049     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">SKT1DrawDragBorder</a>(hSKWnd, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>,
01050         &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>);
01051 
01052 UnlockSKT1Ctxt:
01053     GlobalUnlock(hSKT1Ctxt);
01054 
01055     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01056 }
01057 
01058 <span class="comment">/**********************************************************************/</span>
01059 <span class="comment">/* SKT1MouseMove                                                      */</span>
01060 <span class="comment">/**********************************************************************/</span>
<a name="l01061"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a17">01061</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a17">SKT1MouseMove</a>(
01062     HWND hSKWnd)
01063 {
01064     HGLOBAL    hSKT1Ctxt;
01065     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
01066 
01067     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
01068     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
01069         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01070     }
01071 
01072     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
01073     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
01074         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01075     }
01076 
01077     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x == <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a> ||
01078             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y == <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>) {
01079         GlobalUnlock(hSKT1Ctxt);
01080         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01081     }
01082 
01083     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">SKT1DrawDragBorder</a>(hSKWnd, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>,
01084         &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>);
01085 
01086     <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>);
01087 
01088     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">SKT1DrawDragBorder</a>(hSKWnd, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>,
01089         &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>);
01090 
01091     GlobalUnlock(hSKT1Ctxt);
01092 
01093     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01094 }
01095 
01096 <span class="comment">/**********************************************************************/</span>
01097 <span class="comment">/* SKT1ButtonUp                                                       */</span>
01098 <span class="comment">/**********************************************************************/</span>
<a name="l01099"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a18">01099</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a18">SKT1ButtonUp</a>(
01100     HWND hSKWnd)
01101 {
01102     HGLOBAL        hSKT1Ctxt;
01103     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>     lpSKT1Ctxt;
01104     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fRet;
01105     POINT          pt;
01106     HWND           hUIWnd;
01107     HIMC           hIMC;
01108     LPINPUTCONTEXT lpIMC;
01109 
01110     fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01111 
01112     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/immcli_8h.html#a22">IsWndEqual</a>(<a class="code" href="../../d3/d8/winmgrc_8c.html#a12">GetCapture</a>(), hSKWnd)) {
01113         <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
01114     }
01115 
01116     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
01117     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
01118         <span class="keywordflow">return</span> (fRet);
01119     }
01120 
01121     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
01122     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
01123         <span class="keywordflow">return</span> (fRet);
01124     }
01125 
01126     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>) {
01127         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uVirtKey;
01128 
01129         uVirtKey = <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a1">bSKT1VirtKey</a>[lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a>];
01130         <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)uVirtKey, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a10">guScanCode</a>[uVirtKey],
01131             (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)KEYEVENTF_KEYUP, 0);
01132         <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a12">SKT1InvertButton</a>(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpSKT1Ctxt, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a>);
01133         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> = <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>;
01134         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01135         <span class="keywordflow">goto</span> UnlockSKT1Context;
01136     }
01137 
01138     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x == <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a> ||
01139             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y == <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>) {
01140         <span class="keywordflow">goto</span> UnlockSKT1Context;
01141     }
01142 
01143     <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a10">SKT1DrawDragBorder</a>(hSKWnd, &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>,
01144         &amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>);
01145 
01146     pt.x = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>.x - lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x,
01147     pt.y = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o7">ptSkCursor</a>.y - lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y,
01148 
01149     <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a0">SetWindowPos</a>(hSKWnd, (HWND)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pt.x, pt.y,
01150         0, 0, SWP_NOACTIVATE|SWP_NOSIZE|SWP_NOZORDER);
01151 
01152     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.x = <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>;
01153     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o8">ptSkOffset</a>.y = <a class="code" href="../../d7/d9/softkbd_8h.html#a64">SKT1_NOT_DRAG</a>;
01154 
01155     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o6">uKeyIndex</a> = <a class="code" href="../../d7/d9/softkbd_8h.html#a40">SKT1_TOTAL_INDEX</a>;
01156 
01157     fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01158 
01159     hUIWnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a12">GetWindow</a>(hSKWnd, GW_OWNER);
01160 
01161     hIMC = (HIMC)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hUIWnd, IMMGWLP_IMC);
01162     <span class="keywordflow">if</span> (!hIMC) {
01163         <span class="keywordflow">goto</span> UnlockSKT1Context;
01164     }
01165 
01166     lpIMC = (LPINPUTCONTEXT)<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hIMC);
01167     <span class="keywordflow">if</span> (!lpIMC) {
01168         <span class="keywordflow">goto</span> UnlockSKT1Context;
01169     }
01170 
01171     lpIMC-&gt;ptSoftKbdPos.x = pt.x;
01172     lpIMC-&gt;ptSoftKbdPos.y = pt.y;
01173     lpIMC-&gt;fdwInit |= INIT_SOFTKBDPOS;
01174 
01175     <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
01176 
01177 UnlockSKT1Context:
01178     GlobalUnlock(hSKT1Ctxt);
01179 
01180     <span class="keywordflow">return</span> (fRet);
01181 }
01182 
01183 <span class="comment">/**********************************************************************/</span>
01184 <span class="comment">/* SetSKT1Data                                                        */</span>
01185 <span class="comment">/**********************************************************************/</span>
<a name="l01186"></a><a class="code" href="../../d6/d8/sftkbdt1_8c.html#a19">01186</a> LRESULT <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a19">SetSKT1Data</a>(
01187     HWND          hSKWnd,
01188     LPSOFTKBDDATA lpSoftKbdData)
01189 {
01190     HGLOBAL    hSKT1Ctxt;
01191     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
01192     HDC        hDC, hMemDC;
01193     HGDIOBJ    hOldFont;
01194     <span class="keywordtype">int</span>        i;
01195 
01196     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
01197     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
01198         <span class="keywordflow">return</span> (1);
01199     }
01200 
01201     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
01202     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
01203         <span class="keywordflow">return</span> (1);
01204     }
01205 
01206     hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(hSKWnd);
01207     hMemDC = CreateCompatibleDC(hDC);
01208     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(hSKWnd, hDC);
01209     SelectObject(hMemDC, lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o4">hSKBitmap</a>);
01210 
01211     SetBkColor(hMemDC, RGB(0xC0, 0xC0, 0xC0));
01212 
01213     <span class="keywordflow">if</span> (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o5">lfCharSet</a> != DEFAULT_CHARSET) {
01214         LOGFONT lfFont;
01215         CopyMemory(&amp;lfFont, &amp;<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>, <span class="keyword">sizeof</span> (LOGFONT));
01216         lfFont.lfCharSet = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o5">lfCharSet</a>;
01217         hOldFont = (HFONT)SelectObject(hMemDC, CreateFontIndirect(&amp;lfFont));
01218     }
01219     <span class="keywordflow">else</span> {
01220         hOldFont = (HFONT)SelectObject(hMemDC, CreateFontIndirect(&amp;<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>));
01221     }
01222 
01223     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d9/softkbd_8h.html#a21">SKT1_LETTER_KEY_NUM</a>; i++) {
01224         <span class="keywordtype">int</span>  cbCount;
01225         RECT rcOpaque;
01226 
01227         lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o3">wCodeTable</a>[i] = lpSoftKbdData-&gt;wCode[0][<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a1">bSKT1VirtKey</a>[i]];
01228 
01229         cbCount = (lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o3">wCodeTable</a>[i] == 0) ? 0 : 1;
01230 
01231         rcOpaque.left = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].x + <a class="code" href="../../d7/d9/softkbd_8h.html#a46">SKT1_LABEL_BMP_X</a> -
01232             <a class="code" href="../../d7/d9/softkbd_8h.html#a8">SKT1_XOVERLAP</a>;
01233         rcOpaque.top = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o2">ptButtonPos</a>[i].y + <a class="code" href="../../d7/d9/softkbd_8h.html#a47">SKT1_LABEL_BMP_Y</a>;
01234 
01235         rcOpaque.right = rcOpaque.left +
01236             lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o0">nButtonWidth</a>[<a class="code" href="../../d7/d9/softkbd_8h.html#a149a135">SKT1_LETTER_TYPE</a>] - <a class="code" href="../../d7/d9/softkbd_8h.html#a46">SKT1_LABEL_BMP_X</a> +
01237             <a class="code" href="../../d7/d9/softkbd_8h.html#a8">SKT1_XOVERLAP</a>;
01238         rcOpaque.bottom = rcOpaque.top + lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o1">nButtonHeight</a>[0] -
01239             <a class="code" href="../../d7/d9/softkbd_8h.html#a47">SKT1_LABEL_BMP_Y</a>;
01240 
01241         ExtTextOut(hMemDC, rcOpaque.left, rcOpaque.top,
01242             ETO_OPAQUE, &amp;rcOpaque,
01243             (LPWSTR)&amp;lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o3">wCodeTable</a>[i], cbCount, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01244     }
01245 
01246     DeleteObject(SelectObject(hMemDC, hOldFont));
01247 
01248     DeleteDC(hMemDC);
01249 
01250     GlobalUnlock(hSKT1Ctxt);
01251 
01252     <span class="keywordflow">return</span> (0);
01253 }
01254 
01255 <span class="comment">/**********************************************************************/</span>
01256 <span class="comment">/* SKWndProcT1                                                        */</span>
01257 <span class="comment">/**********************************************************************/</span>
<a name="l01258"></a><a class="code" href="../../d7/d9/softkbd_8h.html#a146">01258</a> LRESULT CALLBACK <a class="code" href="../../d7/d9/softkbd_8h.html#a146">SKWndProcT1</a>(
01259     HWND   hSKWnd,
01260     UINT   uMsg,
01261     WPARAM wParam,
01262     LPARAM lParam)
01263 {
01264     <span class="keywordflow">switch</span> (uMsg) {
01265     <span class="keywordflow">case</span> WM_CREATE:
01266         <span class="keywordflow">return</span> <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a9">CreateT1Window</a>(hSKWnd);
01267     <span class="keywordflow">case</span> WM_DESTROY:
01268         <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a11">DestroyT1Window</a>(hSKWnd);
01269         <span class="keywordflow">break</span>;
01270     <span class="keywordflow">case</span> WM_PAINT:
01271         {
01272             HDC         hDC;
01273             PAINTSTRUCT ps;
01274 
01275             hDC = <a class="code" href="../../d3/d0/user32_8def.html#a41">BeginPaint</a>(hSKWnd, &amp;ps);
01276             <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a13">UpdateSKT1Window</a>(hDC, hSKWnd);
01277             EndPaint(hSKWnd, &amp;ps);
01278         }
01279         <span class="keywordflow">break</span>;
01280     <span class="keywordflow">case</span> WM_SETCURSOR:
01281         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a16">SKT1SetCursor</a>(hSKWnd, lParam)) {
01282             <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01283         }
01284         <span class="keywordflow">break</span>;
01285     <span class="keywordflow">case</span> WM_MOUSEMOVE:
01286         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a17">SKT1MouseMove</a>(hSKWnd)) {
01287             <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01288         }
01289         <span class="keywordflow">break</span>;
01290     <span class="keywordflow">case</span> WM_LBUTTONUP:
01291         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a18">SKT1ButtonUp</a>(hSKWnd)) {
01292             <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01293         }
01294         <span class="keywordflow">break</span>;
01295     <span class="keywordflow">case</span> WM_MOUSEACTIVATE:
01296         <span class="keywordflow">return</span> (MA_NOACTIVATE);
01297     <span class="keywordflow">case</span> WM_SHOWWINDOW:
01298         <span class="keywordflow">if</span> (lParam != 0) {
01299         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)wParam == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01300         } <span class="keywordflow">else</span> {
01301             <span class="comment">// we want to hide the soft keyboard on mouse button down</span>
01302             <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a18">SKT1ButtonUp</a>(hSKWnd);
01303         }
01304 
01305         <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01306 
01307     <span class="keywordflow">case</span> WM_IME_CONTROL:
01308         <span class="keywordflow">switch</span> (wParam) {
01309         <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
01310             {
01311                 HGLOBAL    hSKT1Ctxt;
01312                 <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
01313                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>       lfCharSet;
01314 
01315                 hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
01316                 <span class="keywordflow">if</span> (!hSKT1Ctxt) {
01317                     <span class="keywordflow">return</span> (1);
01318                 }
01319 
01320                 lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
01321                 <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
01322                     <span class="keywordflow">return</span> (1);
01323                 }
01324 
01325                 lfCharSet = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o5">lfCharSet</a>;
01326 
01327                 GlobalUnlock(hSKT1Ctxt);
01328 
01329                 *(LPLOGFONT)lParam = <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>;
01330 
01331                 <span class="keywordflow">if</span> (lfCharSet != DEFAULT_CHARSET) {
01332                     ((LPLOGFONT)lParam)-&gt;lfCharSet = lfCharSet;
01333                 }
01334 
01335                 <span class="keywordflow">return</span> (0);
01336             }
01337             <span class="keywordflow">break</span>;
01338         <span class="keywordflow">case</span> IMC_SETSOFTKBDFONT:
01339             {
01340                 <span class="comment">// in differet version of Windows</span>
01341                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8/sftkbdt1_8c.html#a2">lfSKT1Font</a>.lfCharSet != ((LPLOGFONT)lParam)-&gt;lfCharSet) {
01342                     HGLOBAL    hSKT1Ctxt;
01343                     <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
01344 
01345                     hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd,
01346                         <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
01347                     <span class="keywordflow">if</span> (!hSKT1Ctxt) {
01348                         <span class="keywordflow">return</span> 1;
01349                     }
01350 
01351                     lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
01352                     <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
01353                         <span class="keywordflow">return</span> 1;
01354                     }
01355 
01356                     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o5">lfCharSet</a> = ((LPLOGFONT)lParam)-&gt;lfCharSet;
01357 
01358                     GlobalUnlock(hSKT1Ctxt);
01359                 }
01360             }
01361             <span class="keywordflow">break</span>;
01362         <span class="keywordflow">case</span> IMC_GETSOFTKBDPOS:
01363             {
01364                 RECT rcWnd;
01365 
01366                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(hSKWnd, &amp;rcWnd);
01367 
01368                 <span class="keywordflow">return</span> MAKELRESULT(rcWnd.left, rcWnd.top);
01369             }
01370             <span class="keywordflow">break</span>;
01371         <span class="keywordflow">case</span> IMC_SETSOFTKBDPOS:
01372             {
01373                 POINT          ptSoftKbdPos;
01374                 HWND           hUIWnd;
01375                 HIMC           hIMC;
01376                 LPINPUTCONTEXT lpIMC;
01377 
01378                 ptSoftKbdPos.x = ((LPPOINTS)lParam)-&gt;x;
01379                 ptSoftKbdPos.y = ((LPPOINTS)lParam)-&gt;y;
01380 
01381                 <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a0">SetWindowPos</a>(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01382                     ptSoftKbdPos.x, ptSoftKbdPos.y,
01383                     0, 0, SWP_NOACTIVATE|SWP_NOSIZE|SWP_NOZORDER);
01384 
01385                 <span class="comment">// Here we want to get - the owner or parent window</span>
01386                 hUIWnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a13">GetParent</a>(hSKWnd);
01387 
01388                 <span class="keywordflow">if</span> (!hUIWnd) {
01389                     <span class="keywordflow">return</span> (1);
01390                 }
01391 
01392                 hIMC = (HIMC) <a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hUIWnd, IMMGWLP_IMC);
01393 
01394                 <span class="keywordflow">if</span> (!hIMC) {
01395                     <span class="keywordflow">return</span> (1);
01396                 }
01397 
01398                 lpIMC = (LPINPUTCONTEXT)<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hIMC);
01399 
01400                 <span class="keywordflow">if</span> (!lpIMC) {
01401                     <span class="keywordflow">return</span> (1);
01402                 }
01403 
01404                 lpIMC-&gt;ptSoftKbdPos = ptSoftKbdPos;
01405 
01406                 <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
01407 
01408                 <span class="keywordflow">return</span> (0);
01409             }
01410             <span class="keywordflow">break</span>;
01411         <span class="keywordflow">case</span> IMC_SETSOFTKBDDATA:
01412             {
01413                 LRESULT lRet;
01414 
01415                 lRet = <a class="code" href="../../d6/d8/sftkbdt1_8c.html#a19">SetSKT1Data</a>(hSKWnd, (LPSOFTKBDDATA)lParam);
01416                 <span class="keywordflow">if</span> (!lRet) {
01417                     InvalidateRect(hSKWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01418                     <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(hSKWnd, WM_PAINT, 0, 0);
01419                 }
01420                 <span class="keywordflow">return</span> (lRet);
01421             }
01422             <span class="keywordflow">break</span>;
01423         <span class="keywordflow">case</span> IMC_GETSOFTKBDSUBTYPE:
01424         <span class="keywordflow">case</span> IMC_SETSOFTKBDSUBTYPE:
01425             {
01426                 HGLOBAL    hSKT1Ctxt;
01427                 <a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a> lpSKT1Ctxt;
01428                 LRESULT    lRet;
01429 
01430                 lRet = -1;
01431 
01432                 hSKT1Ctxt = (HGLOBAL)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hSKWnd, <a class="code" href="../../d7/d9/softkbd_8h.html#a9">SKT1_CONTEXT</a>);
01433                 <span class="keywordflow">if</span> (!hSKT1Ctxt) {
01434                     <span class="keywordflow">return</span> (lRet);
01435                 }
01436 
01437                 lpSKT1Ctxt = (<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html">LPSKT1CTXT</a>)GlobalLock(hSKT1Ctxt);
01438                 <span class="keywordflow">if</span> (!lpSKT1Ctxt) {
01439                     <span class="keywordflow">return</span> (lRet);
01440                 }
01441 
01442                 <span class="keywordflow">if</span> (wParam == IMC_GETSOFTKBDSUBTYPE) {
01443                     lRet = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o9">uSubType</a>;
01444                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == IMC_SETSOFTKBDSUBTYPE) {
01445                     lRet = lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o9">uSubType</a>;
01446                     lpSKT1Ctxt-&gt;<a class="code" href="../../d6/d9/struct__tagSKT1CTXT.html#o9">uSubType</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)lParam;
01447                 } <span class="keywordflow">else</span> {
01448                     lRet = -1;
01449                 }
01450 
01451                 GlobalUnlock(hSKT1Ctxt);
01452                 <span class="keywordflow">return</span> (lRet);
01453             }
01454             <span class="keywordflow">break</span>;
01455         <span class="keywordflow">default</span>:
01456             <span class="keywordflow">break</span>;
01457         }
01458         <span class="keywordflow">break</span>;
01459     <span class="keywordflow">default</span>:
01460         <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hSKWnd, uMsg, wParam, lParam);
01461     }
01462 
01463     <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01464 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
