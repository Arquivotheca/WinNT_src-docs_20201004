<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: devquobj.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>devquobj.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d8/d6/devquobj_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a0">ASSERT_DEVICE_QUEUE</a>(E)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a1">KeInitializeDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a2">KeInsertDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue, IN <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> DeviceQueueEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a3">KeInsertByKeyDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue, IN <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> DeviceQueueEntry, IN ULONG SortKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a4">KeRemoveDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a5">KeRemoveByKeyDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue, IN ULONG SortKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/devquobj_8c.html#a6">KeRemoveEntryDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue, IN <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> DeviceQueueEntry)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="devquobj.c::ASSERT_DEVICE_QUEUE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ASSERT_DEVICE_QUEUE          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">E&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{            \
    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((E)-&gt;Type == DeviceQueueObject); \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00034">34</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00145">KeInsertByKeyDeviceQueue()</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00083">KeInsertDeviceQueue()</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00294">KeRemoveByKeyDeviceQueue()</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00226">KeRemoveDeviceQueue()</a>, and <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00384">KeRemoveEntryDeviceQueue()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="devquobj.c::KeInitializeDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeInitializeDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceQueue</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00040">40</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a402a177">DeviceQueueObject</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a68">KDEVICE_QUEUE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a69">PKDEVICE_QUEUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l03917">IoCreateController()</a>, and <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04073">IoCreateDevice()</a>.
<p>
<pre class="fragment"><div>00046                    :
00047 
00048     This function initializes a kernel device queue object.
00049 
00050 Arguments:
00051 
00052     DeviceQueue - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> device
00053         queue.
00054 
00055     SpinLock - Supplies a pointer to an executive spin lock.
00056 
00057 Return Value:
00058 
00059     None.
00060 
00061 --*/
00062 
00063 {
00064 
00065     <span class="comment">//</span>
00066     <span class="comment">// Initialize standard control object header.</span>
00067     <span class="comment">//</span>
00068 
00069     DeviceQueue-&gt;Type = <a class="code" href="../../d4/d9/ke_8h.html#a402a177">DeviceQueueObject</a>;
00070     DeviceQueue-&gt;Size = <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d5/struct__KDEVICE__QUEUE.html">KDEVICE_QUEUE</a>);
00071 
00072     <span class="comment">//</span>
00073     <span class="comment">// Initialize the device queue list head, spin lock, and busy indicator.</span>
00074     <span class="comment">//</span>
00075 
00076     InitializeListHead(&amp;DeviceQueue-&gt;DeviceListHead);
00077     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;DeviceQueue-&gt;Lock);
00078     DeviceQueue-&gt;Busy = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00079     <span class="keywordflow">return</span>;
00080 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="devquobj.c::KeInsertByKeyDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeInsertByKeyDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueueEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SortKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00145">145</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00034">ASSERT_DEVICE_QUEUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a71">KDEVICE_QUEUE_ENTRY</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00403">_KDEVICE_QUEUE_ENTRY::SortKey</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10735">IoStartPacket()</a>.
<p>
<pre class="fragment"><div>00153                    :
00154 
00155     This function inserts a device queue entry into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device
00156     queue according to a sort key. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not busy, then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00157     set busy and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue. Otherwise
00158     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue at a position such
00159     that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sort key <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> greater than or equal to its predecessor
00160     and less than its successor.
00161 
00162     N.B. This function can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called from <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.
00163 
00164 Arguments:
00165 
00166     DeviceQueue - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> device queue.
00167 
00168     DeviceQueueEntry - Supplies a pointer to a device queue entry.
00169 
00170     SortKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sort key by which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> position to insert <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device
00171         queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be determined.
00172 
00173 Return Value:
00174 
00175     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not busy, then a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise a
00176     value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00177 
00178 --*/
00179 
00180 {
00181 
00182     BOOLEAN Inserted;
00183     PLIST_ENTRY NextEntry;
00184     <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> QueueEntry;
00185 
00186     <a class="code" href="../../d7/d7/devquobj_8c.html#a0">ASSERT_DEVICE_QUEUE</a>(DeviceQueue);
00187     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00188 
00189     <span class="comment">//</span>
00190     <span class="comment">// Lock specified device queue.</span>
00191     <span class="comment">//</span>
00192 
00193     KiAcquireSpinLock(&amp;DeviceQueue-&gt;Lock);
00194 
00195     <span class="comment">//</span>
00196     <span class="comment">// Insert the specified device queue entry in the device queue at the</span>
00197     <span class="comment">// position specified by the sort key if the device queue is busy.</span>
00198     <span class="comment">// Otherwise set the device queue busy an don't insert the device queue</span>
00199     <span class="comment">// entry.</span>
00200     <span class="comment">//</span>
00201 
00202     DeviceQueueEntry-&gt;SortKey = SortKey;
00203     <span class="keywordflow">if</span> (DeviceQueue-&gt;Busy == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00204         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00205         NextEntry = DeviceQueue-&gt;DeviceListHead.Flink;
00206         <span class="keywordflow">while</span> (NextEntry != &amp;DeviceQueue-&gt;DeviceListHead) {
00207             QueueEntry = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">KDEVICE_QUEUE_ENTRY</a>,
00208                                            DeviceListEntry);
00209             <span class="keywordflow">if</span> (SortKey &lt; QueueEntry-&gt;<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html#o1">SortKey</a>) {
00210                 <span class="keywordflow">break</span>;
00211             }
00212             NextEntry = NextEntry-&gt;Flink;
00213         }
00214         NextEntry = NextEntry-&gt;Blink;
00215         InsertHeadList(NextEntry, &amp;DeviceQueueEntry-&gt;DeviceListEntry);
00216     } <span class="keywordflow">else</span> {
00217         DeviceQueue-&gt;Busy = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00218         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00219     }
00220     DeviceQueueEntry-&gt;Inserted = Inserted;
00221     KiReleaseSpinLock(&amp;DeviceQueue-&gt;Lock);
00222     <span class="keywordflow">return</span> Inserted;
00223 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="devquobj.c::KeInsertDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeInsertDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueueEntry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00083">83</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00034">ASSERT_DEVICE_QUEUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a72">PKDEVICE_QUEUE_ENTRY</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l00240">IoAllocateController()</a>, and <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10735">IoStartPacket()</a>.
<p>
<pre class="fragment"><div>00090                    :
00091 
00092     This function inserts a device queue entry at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tail of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00093     device queue. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not busy, then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set busy and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entry
00094     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue. Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> placed
00095     at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue.
00096 
00097     N.B. This function can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called from <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.
00098 
00099 Arguments:
00100 
00101     DeviceQueue - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> device queue.
00102 
00103     DeviceQueueEntry - Supplies a pointer to a device queue entry.
00104 
00105 Return Value:
00106 
00107     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not busy, then a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise a
00108     value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00109 
00110 --*/
00111 
00112 {
00113 
00114     BOOLEAN Inserted;
00115 
00116     <a class="code" href="../../d7/d7/devquobj_8c.html#a0">ASSERT_DEVICE_QUEUE</a>(DeviceQueue);
00117     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Lock specified device queue.</span>
00121     <span class="comment">//</span>
00122 
00123     KiAcquireSpinLock(&amp;DeviceQueue-&gt;Lock);
00124 
00125     <span class="comment">//</span>
00126     <span class="comment">// Insert the specified device queue entry at the end of the device queue</span>
00127     <span class="comment">// if the device queue is busy. Otherwise set the device queue busy and</span>
00128     <span class="comment">// don't insert the device queue entry.</span>
00129     <span class="comment">//</span>
00130 
00131     <span class="keywordflow">if</span> (DeviceQueue-&gt;Busy == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00132         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00133         InsertTailList(&amp;DeviceQueue-&gt;DeviceListHead,
00134                        &amp;DeviceQueueEntry-&gt;DeviceListEntry);
00135     } <span class="keywordflow">else</span> {
00136         DeviceQueue-&gt;Busy = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00137         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00138     }
00139     DeviceQueueEntry-&gt;Inserted = Inserted;
00140     KiReleaseSpinLock(&amp;DeviceQueue-&gt;Lock);
00141     <span class="keywordflow">return</span> Inserted;
00142 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="devquobj.c::KeRemoveByKeyDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> KeRemoveByKeyDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SortKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00294">294</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00034">ASSERT_DEVICE_QUEUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00402">_KDEVICE_QUEUE_ENTRY::DeviceListEntry</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00404">_KDEVICE_QUEUE_ENTRY::Inserted</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00403">_KDEVICE_QUEUE_ENTRY::SortKey</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10649">IoStartNextPacketByKey()</a>.
<p>
<pre class="fragment"><div>00301                    :
00302 
00303     This function removes an entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device
00304     queue. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> empty, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set Not-Busy
00305     and a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> an entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> removed
00306     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of device queue entry
00307     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.  The queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> search <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first entry which has a value
00308     greater than or equal to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SortKey.  If no such entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00309     first entry of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00310 
00311     N.B. This function can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called from <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.
00312 
00313 Arguments:
00314 
00315     DeviceQueue - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> device queue.
00316 
00317     SortKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sort key by which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> position to remove <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device
00318         queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be determined.
00319 
00320 Return Value:
00321 
00322     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> empty. Otherwise a
00323     pointer to a device queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00324 
00325 --*/
00326 
00327 {
00328 
00329     <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> DeviceQueueEntry;
00330     PLIST_ENTRY NextEntry;
00331 
00332     <a class="code" href="../../d7/d7/devquobj_8c.html#a0">ASSERT_DEVICE_QUEUE</a>(DeviceQueue);
00333     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00334 
00335     <span class="comment">//</span>
00336     <span class="comment">// Lock specified device queue.</span>
00337     <span class="comment">//</span>
00338 
00339     KiAcquireSpinLock(&amp;DeviceQueue-&gt;Lock);
00340 
00341     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceQueue-&gt;Busy == TRUE);
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">// If the device queue is not empty, then remove the first entry from</span>
00345     <span class="comment">// the queue. Otherwise set the device queue not busy.</span>
00346     <span class="comment">//</span>
00347 
00348     <span class="keywordflow">if</span> (IsListEmpty(&amp;DeviceQueue-&gt;DeviceListHead) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00349         DeviceQueue-&gt;Busy = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00350         DeviceQueueEntry = (<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00351     } <span class="keywordflow">else</span> {
00352         NextEntry = DeviceQueue-&gt;DeviceListHead.Flink;
00353         <span class="keywordflow">while</span> (NextEntry != &amp;DeviceQueue-&gt;DeviceListHead) {
00354             DeviceQueueEntry = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">KDEVICE_QUEUE_ENTRY</a>,
00355                                            DeviceListEntry);
00356             <span class="keywordflow">if</span> (SortKey &lt;= DeviceQueueEntry-&gt;<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html#o1">SortKey</a>) {
00357                 <span class="keywordflow">break</span>;
00358             }
00359             NextEntry = NextEntry-&gt;Flink;
00360         }
00361 
00362         <span class="keywordflow">if</span> (NextEntry != &amp;DeviceQueue-&gt;DeviceListHead) {
00363             RemoveEntryList(&amp;DeviceQueueEntry-&gt;<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html#o0">DeviceListEntry</a>);
00364 
00365         } <span class="keywordflow">else</span> {
00366             NextEntry = RemoveHeadList(&amp;DeviceQueue-&gt;DeviceListHead);
00367             DeviceQueueEntry = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">KDEVICE_QUEUE_ENTRY</a>,
00368                                              DeviceListEntry);
00369         }
00370 
00371         DeviceQueueEntry-&gt;<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html#o2">Inserted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00372     }
00373 
00374     <span class="comment">//</span>
00375     <span class="comment">// Release device queue spin lock and return address of device queue</span>
00376     <span class="comment">// entry.</span>
00377     <span class="comment">//</span>
00378 
00379     KiReleaseSpinLock(&amp;DeviceQueue-&gt;Lock);
00380     <span class="keywordflow">return</span> DeviceQueueEntry;
00381 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="devquobj.c::KeRemoveDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> KeRemoveDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceQueue</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00226">226</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00034">ASSERT_DEVICE_QUEUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00404">_KDEVICE_QUEUE_ENTRY::Inserted</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06574">IoFreeController()</a>, and <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10564">IoStartNextPacket()</a>.
<p>
<pre class="fragment"><div>00232                    :
00233 
00234     This function removes an entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> head of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device
00235     queue. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> empty, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set Not-Busy
00236     and a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> removed
00237     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> head of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of device queue entry
00238     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00239 
00240     N.B. This function can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called from <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.
00241 
00242 Arguments:
00243 
00244     DeviceQueue - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> device queue.
00245 
00246 Return Value:
00247 
00248     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> empty. Otherwise a
00249     pointer to a device queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00250 
00251 --*/
00252 
00253 {
00254 
00255     <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a> DeviceQueueEntry;
00256     PLIST_ENTRY NextEntry;
00257 
00258     <a class="code" href="../../d7/d7/devquobj_8c.html#a0">ASSERT_DEVICE_QUEUE</a>(DeviceQueue);
00259     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00260 
00261     <span class="comment">//</span>
00262     <span class="comment">// Lock specified device queue.</span>
00263     <span class="comment">//</span>
00264 
00265     KiAcquireSpinLock(&amp;DeviceQueue-&gt;Lock);
00266 
00267     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceQueue-&gt;Busy == TRUE);
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">// If the device queue is not empty, then remove the first entry from</span>
00271     <span class="comment">// the queue. Otherwise set the device queue not busy.</span>
00272     <span class="comment">//</span>
00273 
00274     <span class="keywordflow">if</span> (IsListEmpty(&amp;DeviceQueue-&gt;DeviceListHead) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00275         DeviceQueue-&gt;Busy = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00276         DeviceQueueEntry = (<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00277     } <span class="keywordflow">else</span> {
00278         NextEntry = RemoveHeadList(&amp;DeviceQueue-&gt;DeviceListHead);
00279         DeviceQueueEntry = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">KDEVICE_QUEUE_ENTRY</a>,
00280                                              DeviceListEntry);
00281         DeviceQueueEntry-&gt;<a class="code" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html#o2">Inserted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00282     }
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// Release device queue spin lock and return address of device queue</span>
00286     <span class="comment">// entry.</span>
00287     <span class="comment">//</span>
00288 
00289     KiReleaseSpinLock(&amp;DeviceQueue-&gt;Lock);
00290     <span class="keywordflow">return</span> DeviceQueueEntry;
00291 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="devquobj.c::KeRemoveEntryDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeRemoveEntryDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/struct__KDEVICE__QUEUE__ENTRY.html">PKDEVICE_QUEUE_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueueEntry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00384">384</a> of file <a class="el" href="../../d8/d6/devquobj_8c-source.html">devquobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d6/devquobj_8c-source.html#l00034">ASSERT_DEVICE_QUEUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00391                    :
00392 
00393     This function removes a specified entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device
00394     queue. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue, then no
00395     operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed. Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00396     removed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue and its inserted status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00397 
00398 Arguments:
00399 
00400     DeviceQueue - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> device queue.
00401 
00402     DeviceQueueEntry - Supplies a pointer to a device queue entry which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
00403         be removed from its device queue.
00404 
00405 Return Value:
00406 
00407     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device queue entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> removed from its
00408     device queue. Otherwise a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00409 
00410 --*/
00411 
00412 {
00413 
00414     KIRQL OldIrql;
00415     BOOLEAN Removed;
00416 
00417     <a class="code" href="../../d7/d7/devquobj_8c.html#a0">ASSERT_DEVICE_QUEUE</a>(DeviceQueue);
00418     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">// Raise IRQL to dispatcher level and lock specified device queue.</span>
00422     <span class="comment">//</span>
00423 
00424     ExAcquireSpinLock(&amp;DeviceQueue-&gt;Lock, &amp;OldIrql);
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">// If the device queue entry is not in a device queue, then no operation</span>
00428     <span class="comment">// is performed. Otherwise remove the specified device queue entry from its</span>
00429     <span class="comment">// device queue.</span>
00430     <span class="comment">//</span>
00431 
00432     Removed = DeviceQueueEntry-&gt;Inserted;
00433     <span class="keywordflow">if</span> (Removed == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00434         DeviceQueueEntry-&gt;Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00435         RemoveEntryList(&amp;DeviceQueueEntry-&gt;DeviceListEntry);
00436     }
00437 
00438     <span class="comment">//</span>
00439     <span class="comment">// Unlock specified device queue, lower IRQL to its previous level, and</span>
00440     <span class="comment">// return whether the device queue entry was removed from its queue.</span>
00441     <span class="comment">//</span>
00442 
00443     ExReleaseSpinLock(&amp;DeviceQueue-&gt;Lock, OldIrql);
00444     <span class="keywordflow">return</span> Removed;
00445 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
