<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dlgmgrc.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dlgmgrc.c</h1><a href="../../d6/d9/dlgmgrc_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: dlgmgrc.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains client side dialog functionality</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 15-Dec-1993 JohnC      Pulled functions from user\server.</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 
00016 <span class="comment">/***************************************************************************\</span>
00017 <span class="comment">* UT_PrevGroupItem</span>
00018 <span class="comment">*</span>
00019 <span class="comment">* History:</span>
00020 <span class="comment">\***************************************************************************/</span>
00021 
<a name="l00022"></a><a class="code" href="../../d6/d9/dlgmgrc_8c.html#a0">00022</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a0">UT_PrevGroupItem</a>(
00023     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00024     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndCurrent)
00025 {
00026     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndPrev;
00027 
00028     <span class="keywordflow">if</span> (pwndCurrent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndCurrent, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a637">WFGROUP</a>))
00029         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a640">_PrevControl</a>(pwndDlg, pwndCurrent, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED);
00030 
00031     pwndPrev = pwndCurrent;
00032 
00033     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00034         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndDlg, pwndPrev, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED);
00035 
00036         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a637">WFGROUP</a>) || pwnd == pwndCurrent)
00037             <span class="keywordflow">return</span> pwndPrev;
00038 
00039         pwndPrev = pwnd;
00040     }
00041 }
00042 
00043 
00044 <span class="comment">/***************************************************************************\</span>
00045 <span class="comment">* UT_NextGroupItem</span>
00046 <span class="comment">*</span>
00047 <span class="comment">* History:</span>
00048 <span class="comment">\***************************************************************************/</span>
00049 
<a name="l00050"></a><a class="code" href="../../d6/d9/dlgmgrc_8c.html#a1">00050</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a1">UT_NextGroupItem</a>(
00051     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00052     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndCurrent)
00053 {
00054     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndNext;
00055 
00056     pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndDlg, pwndCurrent, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED);
00057 
00058     <span class="keywordflow">if</span> (pwndCurrent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a637">WFGROUP</a>))
00059         <span class="keywordflow">return</span> pwnd;
00060 
00061     pwndNext = pwndCurrent;
00062 
00063     <span class="keywordflow">while</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndNext, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a637">WFGROUP</a>)) {
00064         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a640">_PrevControl</a>(pwndDlg, pwndNext, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED);
00065         <span class="keywordflow">if</span> (pwnd == pwndCurrent)
00066             <span class="keywordflow">return</span> pwndNext;
00067         pwndNext = pwnd;
00068     }
00069 
00070     <span class="keywordflow">return</span> pwndNext;
00071 }
00072 
00073 <span class="comment">/***************************************************************************\</span>
00074 <span class="comment">* _PrevControl</span>
00075 <span class="comment">*</span>
00076 <span class="comment">* History:</span>
00077 <span class="comment">\***************************************************************************/</span>
<a name="l00078"></a><a class="code" href="../../d6/d0/usercli_8h.html#a640">00078</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a640">_PrevControl</a>(
00079     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndRoot,
00080     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndStart,
00081     UINT uFlags)
00082 {
00083     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirstFound;
00084     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNext;
00085     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndFirst;
00086 
00087     <span class="keywordflow">if</span> (!pwndStart)
00088         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00089 
00090     UserAssert(pwndRoot != pwndStart);
00091     UserAssert(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndStart, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>));
00092 
00093     pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndRoot, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, uFlags);
00094 
00095     pwndFirst = pwnd;
00096     fFirstFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00097     <span class="keywordflow">while</span> (pwndNext = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndRoot, pwnd, uFlags)) {
00098 
00099         <span class="keywordflow">if</span> (pwndNext == pwndStart)
00100             <span class="keywordflow">break</span>;
00101 
00102         <span class="keywordflow">if</span> (pwndNext == pwndFirst) {
00103             <span class="keywordflow">if</span> (fFirstFound) {
00104                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_PrevControl: Loop Detected"</span>);
00105                 <span class="keywordflow">break</span>;
00106             } <span class="keywordflow">else</span> {
00107                 fFirstFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00108             }
00109         }
00110 
00111         pwnd = pwndNext;
00112     }
00113 
00114     <span class="keywordflow">return</span> pwnd;
00115 }
00116 <span class="comment">/***************************************************************************\</span>
00117 <span class="comment">*</span>
00118 <span class="comment">*  GetChildControl()</span>
00119 <span class="comment">*</span>
00120 <span class="comment">*  Gets valid ancestor of given window.</span>
00121 <span class="comment">*  A valid dialog control is a direct descendant of a "form" control.</span>
00122 <span class="comment">*</span>
00123 <span class="comment">\***************************************************************************/</span>
00124 
<a name="l00125"></a><a class="code" href="../../d6/d0/usercli_8h.html#a643">00125</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndRoot, <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild) {
00126     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndControl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00127 
00128     <span class="keywordflow">while</span> (pwndChild &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwndChild) &amp;&amp; (pwndChild != pwndRoot)) {
00129         pwndControl = pwndChild;
00130         pwndChild = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndChild, spwndParent);
00131 
00132         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>))
00133             <span class="keywordflow">break</span>;
00134     }
00135 
00136     <span class="keywordflow">return</span>(pwndControl);
00137 }
00138 
00139 <span class="comment">/***************************************************************************\</span>
00140 <span class="comment">*</span>
00141 <span class="comment">*  _NextSibblingOrAncestor</span>
00142 <span class="comment">*</span>
00143 <span class="comment">* Called by _NextControl. It returns the next control to pwndStart. If there</span>
00144 <span class="comment">* is a next window (pwndStart-&gt;spwndNext), then that is it.</span>
00145 <span class="comment">* Otherwise, the next control is up the parent chain. However, if it's already</span>
00146 <span class="comment">* at the top of the chain (pwndRoot == pwndStart-&gt;spwndParent), then the next</span>
00147 <span class="comment">* control is the first child of pwndRoot. But if it's not at the top of the chain,</span>
00148 <span class="comment">* then the next control is pwndStart-&gt;spwndParent or an ancestor.</span>
00149 <span class="comment">*</span>
00150 <span class="comment">\***************************************************************************/</span>
<a name="l00151"></a><a class="code" href="../../d6/d9/dlgmgrc_8c.html#a4">00151</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a4">_NextSibblingOrAncestor</a> (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndRoot, <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndStart)
00152 {
00153     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00154 <span class="preprocessor">#if DBG</span>
00155 <span class="preprocessor"></span>    <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNext;
00156 <span class="preprocessor">#endif</span>
00157 <span class="preprocessor"></span>
00158     <span class="comment">// If there is a sibbling, go for it</span>
00159     <span class="keywordflow">if</span> (pwndStart-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00160         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndStart, spwndNext));
00161     }
00162 
00163     <span class="comment">// If it cannot go up the parent chain, then return the first sibbling.</span>
00164     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndStart, spwndParent);
00165     <span class="keywordflow">if</span> (pwndParent == pwndRoot) {
00166         <span class="comment">// Note that if pwndStart doesn't have any sibblings,</span>
00167         <span class="comment">//  this will return pwndStart again</span>
00168         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndParent, spwndChild));
00169     }
00170 
00171 
00172     <span class="comment">// Otherwise walk up the parent chain looking for the first window with</span>
00173     <span class="comment">// a WS_EX_CONTROLPARENT parent.</span>
00174 
00175 <span class="preprocessor">#if DBG</span>
00176 <span class="preprocessor"></span>    pwndNext =
00177 <span class="preprocessor">#else</span>
00178 <span class="preprocessor"></span>    <span class="keywordflow">return</span>
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>        <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(pwndRoot, pwndParent);
00181 
00182 <span class="preprocessor">#if DBG</span>
00183 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((pwndNext != pwndParent) || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>)) {
00184         <span class="comment">// Code looping through the controls in a dialog might go into an infinite</span>
00185         <span class="comment">//  loop because of this (i.e., xxxRemoveDefaultButton, _GetNextDlgTabItem,..)</span>
00186         <span class="comment">// We've walked up the parent chain but will never walk down the child chain again</span>
00187         <span class="comment">//  because there is a NON WS_EX_CONTROLPARENT parent window somewhere in the chain.</span>
00188         RIPMSG0 (RIP_ERROR, <span class="stringliteral">"_NextSibblingOrAncestor: Non WS_EX_CONTROLPARENT window in parent chain"</span>);
00189     }
00190     <span class="keywordflow">return</span> pwndNext;
00191 <span class="preprocessor">#endif</span>
00192 <span class="preprocessor"></span>}
00193 <span class="comment">/***************************************************************************\</span>
00194 <span class="comment">*</span>
00195 <span class="comment">*  _NextControl()</span>
00196 <span class="comment">*</span>
00197 <span class="comment">* It searches for the next NON WS_EX_CONTROLPARENT control following pwndStart.</span>
00198 <span class="comment">* If pwndStart is NULL, the search begins with pwndRoot's first child;</span>
00199 <span class="comment">* otherwise, it starts with the control next to pwndStart.</span>
00200 <span class="comment">* This is a depth-first search that can start anywhere in the window tree.</span>
00201 <span class="comment">* uFlags determine what WS_EX_CONTROLPARENT windows should be skipped or recursed into.</span>
00202 <span class="comment">* If skipping a window, the search moves to the next control (see _NextSibblingOrAncestor);</span>
00203 <span class="comment">* otherwise, the search walks down the child chain (recursive call).</span>
00204 <span class="comment">* If the search fails, it returns pwndRoot.</span>
00205 <span class="comment">*</span>
00206 <span class="comment">\***************************************************************************/</span>
<a name="l00207"></a><a class="code" href="../../d6/d0/usercli_8h.html#a639">00207</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(
00208     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndRoot,
00209     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndStart,
00210     UINT uFlags)
00211 {
00212     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSkip, fAncestor;
00213     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndLast, pwndSibblingLoop;
00214     <span class="comment">/* Bug 272874 - joejo</span>
00215 <span class="comment">     *</span>
00216 <span class="comment">     * Stop infinite loop by only looping a finite number of times and</span>
00217 <span class="comment">     * then bailing.</span>
00218 <span class="comment">     */</span>
00219     <span class="keywordtype">int</span> nLoopCount = 0;
00220     
00221     UserAssert (pwndRoot != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00222 
00223     <span class="keywordflow">if</span> (pwndStart == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00224         <span class="comment">// Start with pwndRoot's first child</span>
00225         pwndStart = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndRoot, spwndChild);
00226         pwndLast = pwndStart;
00227         fAncestor = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00228     } <span class="keywordflow">else</span> {
00229         UserAssert ((pwndRoot != pwndStart) &amp;&amp; <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a5">_IsDescendant</a>(pwndRoot, pwndStart));
00230 
00231         <span class="comment">// Save starting handle and get next one</span>
00232         pwndLast = pwndStart;
00233         pwndSibblingLoop = pwndStart;
00234         fAncestor = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00235         <span class="keywordflow">goto</span> TryNextOne;
00236     }
00237 
00238 
00239     <span class="comment">// If no more controls, game over</span>
00240     <span class="keywordflow">if</span> (pwndStart == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00241         <span class="keywordflow">return</span> pwndRoot;
00242     }
00243 
00244     <span class="comment">// Search for a non WS_EX_CONTROLPARENT window; if a window should be skipped,</span>
00245     <span class="comment">// try its spwndNext; otherwise, walk down its child chain.</span>
00246     pwndSibblingLoop = pwndStart;
00247     <span class="keywordflow">do</span> {
00248         
00249         <span class="comment">//If not WS_EX_CONTROLPARENT parent, done.</span>
00250         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndStart, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>)) {
00251             <span class="keywordflow">return</span> pwndStart;
00252         }
00253 
00254         <span class="comment">// Do they want to skip this window?</span>
00255         fSkip = ((uFlags &amp; CWP_SKIPINVISIBLE) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndStart, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00256                 || ((uFlags &amp; CWP_SKIPDISABLED) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndStart, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>));
00257 
00258 
00259         <span class="comment">// Remember the current window</span>
00260         pwndLast = pwndStart;
00261 
00262         <span class="comment">// Walk down child chain?</span>
00263         <span class="keywordflow">if</span> (!fSkip &amp;&amp; !fAncestor) {
00264             pwndStart = <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a> (pwndStart, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, uFlags);
00265             <span class="comment">// If it found one, done.</span>
00266             <span class="keywordflow">if</span> (pwndStart != pwndLast) {
00267                 <span class="keywordflow">return</span> pwndStart;
00268             }
00269         }
00270 
00271 TryNextOne:
00272         <span class="comment">// Try the next one.</span>
00273         pwndStart = <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a4">_NextSibblingOrAncestor</a> (pwndRoot, pwndStart);
00274         <span class="keywordflow">if</span> (pwndStart == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00275             <span class="keywordflow">break</span>;
00276         }
00277 
00278         <span class="comment">// If parents are the same, we are still in the same sibbling chain</span>
00279         <span class="keywordflow">if</span> (pwndLast-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == pwndStart-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>) {
00280             <span class="comment">// If we had just moved up the parent chain last time around,</span>
00281             <span class="comment">//  mark this as the beginning of the new sibbling chain.</span>
00282             <span class="comment">// Otherwise, check if we've looped through all sibblings already.</span>
00283             <span class="keywordflow">if</span> (fAncestor) {
00284                 <span class="comment">// Beggining of new sibbling chain.</span>
00285                 pwndSibblingLoop = pwndStart;
00286             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pwndStart == pwndSibblingLoop) {
00287                 <span class="comment">// Already visited all sibblings, so done.</span>
00288                 <span class="keywordflow">break</span>;
00289             }
00290             fAncestor = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00291         } <span class="keywordflow">else</span> {
00292             <span class="comment">// We must have moved up the parent chain, so don't</span>
00293             <span class="comment">//  walk down the child chain right away (try the next window first)</span>
00294             <span class="comment">// Eventhough we are on a new sibbling chain, we don't update</span>
00295             <span class="comment">// pwndSibblingLoop yet; this is because we must walk down this</span>
00296             <span class="comment">// child chain again to make sure we visit all the descendents</span>
00297             fAncestor = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00298         }
00299 
00300     <span class="comment">/* Bug 272874 - joejo</span>
00301 <span class="comment">     *</span>
00302 <span class="comment">     * Stop infinite loop by only looping a finite number of times and</span>
00303 <span class="comment">     * then bailing.</span>
00304 <span class="comment">     */</span>
00305     } <span class="keywordflow">while</span> (nLoopCount++ &lt; 256 * 4);
00306 
00307     <span class="comment">// It couldn't find one...</span>
00308     <span class="keywordflow">return</span> pwndRoot;
00309 }
00310 
00311 <span class="comment">/***************************************************************************\</span>
00312 <span class="comment">* GetNextDlgTabItem</span>
00313 <span class="comment">*</span>
00314 <span class="comment">* History:</span>
00315 <span class="comment">* 19-Feb-1991 JimA      Added access check</span>
00316 <span class="comment">\***************************************************************************/</span>
00317 
<a name="l00318"></a><a class="code" href="../../d6/d9/dlgmgrc_8c.html#a6">00318</a> HWND WINAPI <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a6">GetNextDlgTabItem</a>(
00319     HWND hwndDlg,
00320     HWND hwnd,
00321     BOOL fPrev)
00322 {
00323 
00324     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00325     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg;
00326     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNext;
00327 
00328     pwndDlg = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndDlg);
00329 
00330     <span class="keywordflow">if</span> (pwndDlg == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00331         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00332 
00333     <span class="keywordflow">if</span> (hwnd != (HWND)0) {
00334         pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00335 
00336         <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00337             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00338 
00339     } <span class="keywordflow">else</span> {
00340         pwnd = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00341     }
00342 
00343     pwndNext = <a class="code" href="../../d6/d0/usercli_8h.html#a642">_GetNextDlgTabItem</a>(pwndDlg, pwnd, fPrev);
00344 
00345     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndNext));
00346 }
00347 
<a name="l00348"></a><a class="code" href="../../d6/d0/usercli_8h.html#a642">00348</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a642">_GetNextDlgTabItem</a>(
00349     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00350     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00351     BOOL fPrev)
00352 {
00353     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndSave;
00354 
00355     <span class="keywordflow">if</span> (pwnd == pwndDlg)
00356         pwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00357     <span class="keywordflow">else</span>
00358     {
00359         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(pwndDlg, pwnd);
00360         <span class="keywordflow">if</span> (pwnd &amp;&amp; !<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a5">_IsDescendant</a>(pwndDlg, pwnd))
00361             <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00362     }
00363 
00364     <span class="comment">//</span>
00365     <span class="comment">// BACKWARD COMPATIBILITY</span>
00366     <span class="comment">//</span>
00367     <span class="comment">// Note that the result when there are no tabstops of</span>
00368     <span class="comment">// IGetNextDlgTabItem(pwndDlg, NULL, FALSE) was the last item, now</span>
00369     <span class="comment">// will be the first item.  We could put a check for fRecurse here</span>
00370     <span class="comment">// and do the old thing if not set.</span>
00371     <span class="comment">//</span>
00372 
00373     <span class="comment">// We are going to bug out if we hit the first child a second time.</span>
00374 
00375     pwndSave = pwnd;
00376 
00377     pwnd = (fPrev ? <a class="code" href="../../d6/d0/usercli_8h.html#a640">_PrevControl</a>(pwndDlg, pwnd, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED) :
00378                     <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndDlg, pwnd, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED));
00379 
00380     <span class="keywordflow">if</span> (!pwnd)
00381         <span class="keywordflow">goto</span> AllOver;
00382 
00383     <span class="keywordflow">while</span> ((pwnd != pwndSave) &amp;&amp; (pwnd != pwndDlg)) {
00384         UserAssert(pwnd);
00385 
00386         <span class="keywordflow">if</span> (!pwndSave)
00387             pwndSave = pwnd;
00388 
00389         <span class="keywordflow">if</span> ((pwnd-&gt;style &amp; (WS_TABSTOP | WS_VISIBLE | WS_DISABLED))  == (WS_TABSTOP | WS_VISIBLE))
00390             <span class="comment">// Found it.</span>
00391             <span class="keywordflow">break</span>;
00392 
00393         pwnd = (fPrev ? <a class="code" href="../../d6/d0/usercli_8h.html#a640">_PrevControl</a>(pwndDlg, pwnd, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED) :
00394                         <a class="code" href="../../d6/d0/usercli_8h.html#a639">_NextControl</a>(pwndDlg, pwnd, CWP_SKIPINVISIBLE | CWP_SKIPDISABLED));
00395     }
00396 
00397 AllOver:
00398     <span class="keywordflow">return</span> pwnd;
00399 }
00400 
00401 <span class="comment">/***************************************************************************\</span>
00402 <span class="comment">*</span>
00403 <span class="comment">*  _GetNextDlgGroupItem()</span>
00404 <span class="comment">*</span>
00405 <span class="comment">\***************************************************************************/</span>
00406 
<a name="l00407"></a><a class="code" href="../../d6/d9/dlgmgrc_8c.html#a8">00407</a> HWND <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a8">GetNextDlgGroupItem</a>(
00408     HWND hwndDlg,
00409     HWND hwndCtl,
00410     BOOL bPrevious)
00411 {
00412     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg;
00413     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndCtl;
00414     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNext;
00415 
00416     pwndDlg = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndDlg);
00417 
00418     <span class="keywordflow">if</span> (pwndDlg == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00419         <span class="keywordflow">return</span> 0;
00420 
00421 
00422     <span class="keywordflow">if</span> (hwndCtl != (HWND)0) {
00423         pwndCtl = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndCtl);
00424 
00425         <span class="keywordflow">if</span> (pwndCtl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00426             <span class="keywordflow">return</span> 0;
00427     } <span class="keywordflow">else</span> {
00428         pwndCtl = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00429     }
00430 
00431     <span class="keywordflow">if</span> (pwndCtl == pwndDlg)
00432         pwndCtl = pwndDlg;
00433 
00434     pwndNext = <a class="code" href="../../d6/d0/usercli_8h.html#a641">_GetNextDlgGroupItem</a>(pwndDlg, pwndCtl, bPrevious);
00435 
00436     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndNext));
00437 }
00438 
<a name="l00439"></a><a class="code" href="../../d6/d0/usercli_8h.html#a641">00439</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a641">_GetNextDlgGroupItem</a>(
00440     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg,
00441     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00442     BOOL fPrev)
00443 {
00444     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndCurrent;
00445     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fOnceAround = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00446 
00447     pwnd = pwndCurrent = <a class="code" href="../../d6/d0/usercli_8h.html#a643">_GetChildControl</a>(pwndDlg, pwnd);
00448 
00449     <span class="keywordflow">do</span> {
00450         pwnd = (fPrev ? <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a0">UT_PrevGroupItem</a>(pwndDlg, pwnd) :
00451                         <a class="code" href="../../d6/d9/dlgmgrc_8c.html#a1">UT_NextGroupItem</a>(pwndDlg, pwnd));
00452 
00453         <span class="keywordflow">if</span> (pwnd == pwndCurrent)
00454             fOnceAround = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00455 
00456         <span class="keywordflow">if</span> (!pwndCurrent)
00457             pwndCurrent = pwnd;
00458     }
00459     <span class="keywordflow">while</span> (!fOnceAround &amp;&amp; ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>) || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))));
00460 
00461     <span class="keywordflow">return</span> pwnd;
00462 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:45 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
