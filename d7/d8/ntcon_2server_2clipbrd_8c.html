<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ntcon/server/clipbrd.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>clipbrd.c File Reference</h1><code>#include "<a class="el" href="../../d7/d2/w32_2ntcon_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a0">MyInvert</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PSMALL_RECT SmallRect)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a1">InvertSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, BOOL Inverting)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a2">ExtendSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN COORD CursorPosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a3">CancelMouseSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a4">CancelKeySelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN BOOL JustCursor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a5">ConvertToMouseSelect</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN COORD MousePosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a6">ClearSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a7">StoreSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a8">DoCopy</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a9">DoStringPaste</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PWCHAR pwStr, IN UINT DataSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a10">DoPaste</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a11">InitSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a12">DoMark</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a13">DoSelectAll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a14">DoScroll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a15">ClearScroll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a16">ScrollIfNecessary</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="ntcon/server/clipbrd.c::CancelKeySelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CancelKeySelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>JustCursor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">338</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00032">msgMarkMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">ConvertToMouseSelect()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>.
<p>
<pre class="fragment"><div>00349 {
00350     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00351 
00352     <span class="keywordflow">if</span> (!JustCursor) {
00353 
00354         <span class="comment">//</span>
00355         <span class="comment">// turn off selection flag</span>
00356         <span class="comment">//</span>
00357 
00358         Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
00359 
00360         <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgMarkMode,FALSE);
00361     }
00362 
00363     <span class="comment">//</span>
00364     <span class="comment">// invert old select rect, if we have one.</span>
00365     <span class="comment">//</span>
00366 
00367     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00368     <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>) {
00369         <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00370     } <span class="keywordflow">else</span> {
00371         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
00372     }
00373 
00374     <span class="comment">// restore text cursor</span>
00375 
00376     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00377         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a4">SetCursorInformation</a>(ScreenInfo,
00378                              Console-&gt;TextCursorSize,
00379                              Console-&gt;TextCursorVisible
00380                             );
00381         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(ScreenInfo,
00382                           Console-&gt;TextCursorPosition,
00383                           TRUE
00384                          );
00385     }
00386     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
00387 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ntcon/server/clipbrd.c::CancelMouseSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CancelMouseSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">308</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03414">ReleaseCapture()</a>, and <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>.
<p>
<pre class="fragment"><div>00318 {
00319     <span class="comment">//</span>
00320     <span class="comment">// turn off selection flag</span>
00321     <span class="comment">//</span>
00322 
00323     Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
00324 
00325     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,FALSE);
00326 
00327     <span class="comment">//</span>
00328     <span class="comment">// invert old select rect.  if we're selecting by mouse, we</span>
00329     <span class="comment">// always have a selection rect.</span>
00330     <span class="comment">//</span>
00331 
00332     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00333 
00334     <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
00335 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ntcon/server/clipbrd.c::ClearScroll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ClearScroll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01222">1222</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00033">msgScrollMode</a>, and <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>01225 {
01226     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgScrollMode,FALSE);
01227     Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>;
01228 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ntcon/server/clipbrd.c::ClearSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ClearSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">437</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">CancelMouseSelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02442">UnblockWriteConsole()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>00440 {
00441     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
00442         <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a>) {
00443             <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a3">CancelMouseSelection</a>(Console);
00444         } <span class="keywordflow">else</span> {
00445             <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a4">CancelKeySelection</a>(Console,FALSE);
00446         }
00447         <a class="code" href="../../d0/d7/server_2stream_8c.html#a30">UnblockWriteConsole</a>(Console, CONSOLE_SELECTING);
00448     }
00449 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ntcon/server/clipbrd.c::ConvertToMouseSelect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ConvertToMouseSelect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>MousePosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">390</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00125">CONSOLE_MOUSE_DOWN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00032">msgMarkMode</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00361">SetCapture</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.
<p>
<pre class="fragment"><div>00401 {
00402     Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a> | <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>;
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// undo key selection</span>
00406     <span class="comment">//</span>
00407 
00408     <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a4">CancelKeySelection</a>(Console,TRUE);
00409 
00410     Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
00411 
00412     <span class="comment">//</span>
00413     <span class="comment">// invert new selection</span>
00414     <span class="comment">//</span>
00415 
00416     Console-&gt;SelectionAnchor = MousePosition;
00417     Console-&gt;SelectionRect.Left =Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
00418     Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
00419     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00420 
00421     <span class="comment">//</span>
00422     <span class="comment">// update title bar</span>
00423     <span class="comment">//</span>
00424 
00425     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgMarkMode,FALSE);
00426     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,TRUE);
00427 
00428     <span class="comment">//</span>
00429     <span class="comment">// capture mouse movement</span>
00430     <span class="comment">//</span>
00431 
00432     <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
00433 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ntcon/server/clipbrd.c::DoCopy" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoCopy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">807</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.
<p>
<pre class="fragment"><div>00810 {
00811     <a class="code" href="../../d8/d5/consrv_8h.html#a307">StoreSelection</a>(Console);        <span class="comment">// store selection in clipboard</span>
00812     <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);        <span class="comment">// clear selection in console</span>
00813 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ntcon/server/clipbrd.c::DoMark" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoMark           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01167">1167</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01170 {
01171     <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a11">InitSelection</a>(Console);        <span class="comment">// initialize selection</span>
01172 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ntcon/server/clipbrd.c::DoPaste" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoPaste           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">1008</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00306">CloseClipboard</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00390">GetClipboardData()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00540">OpenClipboard()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.
<p>
<pre class="fragment"><div>01019 {
01020     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
01021     HANDLE ClipboardDataHandle;
01022 
01023     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>) {
01024         <span class="keywordflow">return</span>;
01025     }
01026 
01027     <span class="comment">//</span>
01028     <span class="comment">// Get paste data from clipboard</span>
01029     <span class="comment">//</span>
01030 
01031     Success = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(Console-&gt;hWnd);
01032     <span class="keywordflow">if</span> (!Success)
01033         <span class="keywordflow">return</span>;
01034 
01035     <span class="keywordflow">if</span> (Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01036         PWCHAR pwstr;
01037 
01038         ClipboardDataHandle = <a class="code" href="../../d3/d8/client_8c.html#a42">GetClipboardData</a>(CF_UNICODETEXT);
01039         <span class="keywordflow">if</span> (ClipboardDataHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01040             <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();   <span class="comment">// Close clipboard</span>
01041             <span class="keywordflow">return</span>;
01042         }
01043         pwstr = GlobalLock(ClipboardDataHandle);
01044         <a class="code" href="../../d8/d5/consrv_8h.html#a303">DoStringPaste</a>(Console,pwstr,(ULONG)GlobalSize(ClipboardDataHandle)/<span class="keyword">sizeof</span>(WCHAR));
01045         GlobalUnlock(ClipboardDataHandle);
01046 
01047     } <span class="keywordflow">else</span> {
01048         HBITMAP hBitmapSource,hBitmapTarget;
01049         HDC hDCMemSource,hDCMemTarget;
01050         BITMAP bm;
01051         <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01052 
01053         hBitmapSource = <a class="code" href="../../d3/d8/client_8c.html#a42">GetClipboardData</a>(CF_BITMAP);
01054         <span class="keywordflow">if</span> (hBitmapSource) {
01055 
01056             ScreenInfo = Console-&gt;CurrentScreenBuffer;
01057             <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex,
01058                                   FALSE, NULL);
01059 
01060             hBitmapTarget = CreateDIBitmap(Console-&gt;hDC,
01061                                      &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo-&gt;bmiHeader,
01062                                      CBM_INIT,
01063                                      ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
01064                                      ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
01065                                      ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage
01066                                     );
01067             <span class="keywordflow">if</span> (hBitmapTarget) {
01068                 hDCMemTarget = CreateCompatibleDC ( Console-&gt;hDC );
01069                 hDCMemSource = CreateCompatibleDC ( Console-&gt;hDC );
01070                 SelectObject( hDCMemTarget, hBitmapTarget );
01071                 SelectObject( hDCMemSource, hBitmapSource );
01072                 GetObjectW(hBitmapSource, <span class="keyword">sizeof</span> (BITMAP), (LPSTR) &amp;bm);
01073                 BitBlt ( hDCMemTarget, 0, 0, bm.bmWidth, bm.bmHeight,
01074                      hDCMemSource, 0, 0, SRCCOPY);
01075                 GetObjectW(hBitmapTarget, <span class="keyword">sizeof</span> (BITMAP), (LPSTR) &amp;bm);
01076 
01077                 <span class="comment">// copy the bits from the DC to memory</span>
01078 
01079                 GetDIBits(hDCMemTarget, hBitmapTarget, 0, bm.bmHeight,
01080                           ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
01081                           ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
01082                           ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage);
01083                 DeleteDC(hDCMemSource);
01084                 DeleteDC(hDCMemTarget);
01085                 DeleteObject(hBitmapTarget);
01086                 InvalidateRect(Console-&gt;hWnd,NULL,FALSE); <span class="comment">// force repaint</span>
01087             }
01088             <a class="code" href="../../d2/d5/mutant_8c.html#a8">NtReleaseMutant</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex, NULL);
01089         }
01090     }
01091     <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();
01092     <span class="keywordflow">return</span>;
01093 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ntcon/server/clipbrd.c::DoScroll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoScroll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01211">1211</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00033">msgScrollMode</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01214 {
01215     <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>)) {
01216         <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgScrollMode,TRUE);
01217         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>;
01218     }
01219 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ntcon/server/clipbrd.c::DoSelectAll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoSelectAll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">1175</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01178 {
01179     COORD Position;
01180     COORD WindowOrigin;
01181     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01182 
01183     <span class="comment">// clear any old selections</span>
01184     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
01185         <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);
01186     }
01187 
01188     <span class="comment">// save the old window position</span>
01189     ScreenInfo = Console-&gt;CurrentScreenBuffer;
01190     WindowOrigin.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
01191     WindowOrigin.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
01192 
01193     <span class="comment">// initialize selection</span>
01194     Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
01195     Console-&gt;SelectionFlags = <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a> | <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
01196     Console-&gt;SelectionAnchor.X = Console-&gt;SelectionRect.Left = Console-&gt;SelectionRect.Right = 0;
01197     Console-&gt;SelectionAnchor.Y = Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = 0;
01198     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
01199     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,TRUE);
01200 
01201     <span class="comment">// extend selection</span>
01202     Position.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X - 1;
01203     Position.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y;
01204     <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console, Position);
01205 
01206     <span class="comment">// restore the old window position</span>
01207     <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo, TRUE, WindowOrigin);
01208 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ntcon/server/clipbrd.c::DoStringPaste" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoStringPaste           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>DataSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">835</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00057">DATA_CHUNK_SIZE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00115">LoadKeyEvent</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00339">MapVirtualKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l01013">VkKeyScan()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l05853">DoDrop()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">DoPaste()</a>.
<p>
<pre class="fragment"><div>00840 {
00841     PINPUT_RECORD StringData,CurRecord;
00842     PWCHAR CurChar;
00843     WCHAR Char;
00844     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00845     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ChunkSize,j;
00846     ULONG EventsWritten;
00847 
00848 
00849     <span class="keywordflow">if</span>(!pwStr) {
00850        <span class="keywordflow">return</span>;
00851     }
00852 
00853     <span class="keywordflow">if</span> (DataSize &gt; <a class="code" href="../../d8/d5/consrv_8h.html#a7">DATA_CHUNK_SIZE</a>) {
00854         ChunkSize = <a class="code" href="../../d8/d5/consrv_8h.html#a7">DATA_CHUNK_SIZE</a>;
00855     } <span class="keywordflow">else</span> {
00856         ChunkSize = DataSize;
00857     }
00858 
00859     <span class="comment">//</span>
00860     <span class="comment">// allocate space to copy data.</span>
00861     <span class="comment">//</span>
00862 
00863     StringData = (PINPUT_RECORD)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),ChunkSize*<span class="keyword">sizeof</span>(INPUT_RECORD)*8); <span class="comment">// 8 is maximum number of events per char</span>
00864     <span class="keywordflow">if</span> (StringData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00865         <span class="keywordflow">return</span>;
00866     }
00867 
00868     <span class="comment">//</span>
00869     <span class="comment">// transfer data to the input buffer in chunks</span>
00870     <span class="comment">//</span>
00871 
00872     CurChar = pwStr;   <span class="comment">// LATER remove this</span>
00873     <span class="keywordflow">for</span> (j = 0; j &lt; DataSize; j += ChunkSize) {
00874         <span class="keywordflow">if</span> (ChunkSize &gt; DataSize - j) {
00875             ChunkSize = DataSize - j;
00876         }
00877         CurRecord = StringData;
00878         <span class="keywordflow">for</span> (i = 0, EventsWritten = 0; i &lt; ChunkSize; i++) {
00879             <span class="comment">// filter out LF if not first char and preceded by CR</span>
00880             Char = *CurChar;
00881             <span class="keywordflow">if</span> (Char != <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a> || (i==0 &amp;&amp; j==0) || (*(CurChar-1)) != <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>) {
00882                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> KeyState;
00883                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> KeyFlags;
00884                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> AltGr=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00885                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Shift=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00886 
00887                 <span class="keywordflow">if</span> (Char == 0) {
00888                     j = DataSize;
00889                     <span class="keywordflow">break</span>;
00890                 }
00891 
00892                 KeyState = <a class="code" href="../../d0/d8/ntcftxt_8h.html#a31">VkKeyScan</a>(Char);
00893 <span class="preprocessor">#if defined(FE_SB)</span>
00894 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00895                     (KeyState == -1)) {
00896                     WORD CharType;
00897                     <span class="comment">//</span>
00898                     <span class="comment">// Determine DBCS character because these character doesn't know by VkKeyScan.</span>
00899                     <span class="comment">// GetStringTypeW(CT_CTYPE3) &amp; C3_ALPHA can determine all linguistic characters.</span>
00900                     <span class="comment">// However, this is not include symbolic character for DBCS.</span>
00901                     <span class="comment">// IsConsoleFullWidth can help for DBCS symbolic character.</span>
00902                     <span class="comment">//</span>
00903                     GetStringTypeW(CT_CTYPE3,&amp;Char,1,&amp;CharType);
00904                     <span class="keywordflow">if</span> ((CharType &amp; C3_ALPHA) ||
00905                         IsConsoleFullWidth(Console-&gt;hDC,Console-&gt;OutputCP,Char)) {
00906                         KeyState = 0;
00907                     }
00908                 }
00909 <span class="preprocessor">#endif</span>
00910 <span class="preprocessor"></span>
00911                 <span class="comment">// if VkKeyScanW fails (char is not in kbd layout), we must</span>
00912                 <span class="comment">// emulate the key being input through the numpad</span>
00913 
00914                 <span class="keywordflow">if</span> (KeyState == -1) {
00915                     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> CharString[4];
00916                     UCHAR OemChar;
00917                     PCHAR pCharString;
00918 
00919                     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;OutputCP,
00920                                  &amp;Char,
00921                                  1,
00922                                  &amp;OemChar,
00923                                  1
00924                                 );
00925 
00926                     _itoa(OemChar, CharString, 10);
00927 
00928                     EventsWritten++;
00929                     <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,VK_MENU,0x38,LEFT_ALT_PRESSED);
00930                     CurRecord++;
00931 
00932                     <span class="keywordflow">for</span> (pCharString=CharString;*pCharString;pCharString++) {
00933                         WORD wVirtualKey, wScancode;
00934                         EventsWritten++;
00935                         wVirtualKey = *pCharString-<span class="charliteral">'0'</span>+VK_NUMPAD0;
00936                         wScancode = (WORD)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a18">MapVirtualKey</a>(wVirtualKey, 0);
00937                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,wVirtualKey,wScancode,LEFT_ALT_PRESSED);
00938                         CurRecord++;
00939                         EventsWritten++;
00940                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,0,wVirtualKey,wScancode,LEFT_ALT_PRESSED);
00941                         CurRecord++;
00942                     }
00943 
00944                     EventsWritten++;
00945                     <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,Char,VK_MENU,0x38,0);
00946                     CurRecord++;
00947                 } <span class="keywordflow">else</span> {
00948                     KeyFlags = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(KeyState);
00949 
00950                     <span class="comment">// handle yucky alt-gr keys</span>
00951                     <span class="keywordflow">if</span> ((KeyFlags &amp; 6) == 6) {
00952                         AltGr=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00953                         EventsWritten++;
00954                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,VK_MENU,0x38,ENHANCED_KEY | LEFT_CTRL_PRESSED | RIGHT_ALT_PRESSED);
00955                         CurRecord++;
00956                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (KeyFlags &amp; 1) {
00957                         Shift=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00958                         EventsWritten++;
00959                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,VK_SHIFT,0x2a,SHIFT_PRESSED);
00960                         CurRecord++;
00961                     }
00962 
00963                     EventsWritten++;
00964                     <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,
00965                                  TRUE,
00966                                  Char,
00967                                  <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(KeyState),
00968                                  (WORD)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a18">MapVirtualKey</a>(CurRecord-&gt;Event.KeyEvent.wVirtualKeyCode,0),
00969                                  0);
00970                     <span class="keywordflow">if</span> (KeyFlags &amp; 1)
00971                         CurRecord-&gt;Event.KeyEvent.dwControlKeyState |= SHIFT_PRESSED;
00972                     <span class="keywordflow">if</span> (KeyFlags &amp; 2)
00973                         CurRecord-&gt;Event.KeyEvent.dwControlKeyState |= LEFT_CTRL_PRESSED;
00974                     <span class="keywordflow">if</span> (KeyFlags &amp; 4)
00975                         CurRecord-&gt;Event.KeyEvent.dwControlKeyState |= RIGHT_ALT_PRESSED;
00976                     CurRecord++;
00977 
00978                     EventsWritten++;
00979                     *CurRecord = *(CurRecord-1);
00980                     CurRecord-&gt;Event.KeyEvent.bKeyDown = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00981                     CurRecord++;
00982 
00983                     <span class="comment">// handle yucky alt-gr keys</span>
00984                     <span class="keywordflow">if</span> (AltGr) {
00985                         EventsWritten++;
00986                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,0,VK_MENU,0x38,ENHANCED_KEY);
00987                         CurRecord++;
00988                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Shift) {
00989                         EventsWritten++;
00990                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,0,VK_SHIFT,0x2a,0);
00991                         CurRecord++;
00992                     }
00993                 }
00994             }
00995             CurChar++;
00996         }
00997         EventsWritten = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>(Console,
00998                                          &amp;Console-&gt;InputBuffer,
00999                                          StringData,
01000                                          EventsWritten
01001                                          );
01002     }
01003     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(StringData);
01004     <span class="keywordflow">return</span>;
01005 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ntcon/server/clipbrd.c::ExtendSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExtendSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>CursorPosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">178</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00133">CON_FONTSIZE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02348">MakeCursorVisible()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01231">ScrollIfNecessary()</a>.
<p>
<pre class="fragment"><div>00189 {
00190     SMALL_RECT OldSelectionRect;
00191     HRGN OldRegion,NewRegion,CombineRegion;
00192     COORD FontSize;
00193     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo = Console-&gt;CurrentScreenBuffer;
00194 
00195     <span class="keywordflow">if</span> (CursorPosition.X &lt; 0) {
00196         CursorPosition.X = 0;
00197     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.X &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X) {
00198         CursorPosition.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X-1;
00199     }
00200 
00201     <span class="keywordflow">if</span> (CursorPosition.Y &lt; 0) {
00202         CursorPosition.Y = 0;
00203     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.Y &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00204         CursorPosition.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-1;
00205     }
00206 
00207     <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>)) {
00208 
00209         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00210             <span class="comment">// scroll if necessary to make cursor visible.</span>
00211             <a class="code" href="../../d0/d7/server_2stream_8c.html#a28">MakeCursorVisible</a>(ScreenInfo, CursorPosition);
00212             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;SelectionFlags &amp; CONSOLE_MOUSE_SELECTION));
00213 
00214             <span class="comment">//</span>
00215             <span class="comment">// if the selection rect hasn't actually been started,</span>
00216             <span class="comment">// the selection cursor is still blinking.  turn it off.</span>
00217             <span class="comment">//</span>
00218 
00219             <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
00220         }
00221         Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
00222         Console-&gt;SelectionRect.Left =Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
00223         Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
00224 
00225         <span class="comment">// invert the cursor corner</span>
00226 
00227 <span class="preprocessor">#ifdef FE_SB</span>
00228 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
00229                 ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00230 <span class="preprocessor">#else</span>
00231 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00232 <span class="preprocessor">#endif</span>
00233 <span class="preprocessor"></span>        {
00234             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00235         }
00236     } <span class="keywordflow">else</span> {
00237 
00238         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00239             <span class="comment">// scroll if necessary to make cursor visible.</span>
00240             <a class="code" href="../../d0/d7/server_2stream_8c.html#a28">MakeCursorVisible</a>(ScreenInfo,CursorPosition);
00241         }
00242 <span class="preprocessor">#ifdef FE_SB</span>
00243 <span class="preprocessor"></span>        <span class="comment">//</span>
00244         <span class="comment">// uninvert old selection</span>
00245         <span class="comment">//</span>
00246         <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
00247             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console, &amp;Console-&gt;SelectionRect);
00248         }
00249 <span class="preprocessor">#endif  // FE_SB</span>
00250 <span class="preprocessor"></span>    }
00251 
00252     <span class="comment">//</span>
00253     <span class="comment">// update selection rect</span>
00254     <span class="comment">//</span>
00255 
00256     OldSelectionRect = Console-&gt;SelectionRect;
00257     <span class="keywordflow">if</span> (CursorPosition.X &lt;= Console-&gt;SelectionAnchor.X) {
00258         Console-&gt;SelectionRect.Left = CursorPosition.X;
00259         Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
00260     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.X &gt; Console-&gt;SelectionAnchor.X) {
00261         Console-&gt;SelectionRect.Right = CursorPosition.X;
00262         Console-&gt;SelectionRect.Left = Console-&gt;SelectionAnchor.X;
00263     }
00264     <span class="keywordflow">if</span> (CursorPosition.Y &lt;= Console-&gt;SelectionAnchor.Y) {
00265         Console-&gt;SelectionRect.Top = CursorPosition.Y;
00266         Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
00267     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.Y &gt; Console-&gt;SelectionAnchor.Y) {
00268         Console-&gt;SelectionRect.Bottom = CursorPosition.Y;
00269         Console-&gt;SelectionRect.Top = Console-&gt;SelectionAnchor.Y;
00270     }
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">// change inverted selection</span>
00274     <span class="comment">//</span>
00275 <span class="preprocessor">#ifdef FE_SB</span>
00276 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
00277         <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console, &amp;Console-&gt;SelectionRect);
00278     } <span class="keywordflow">else</span>
00279 <span class="preprocessor">#endif</span>
00280 <span class="preprocessor"></span>    {
00281         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00282             FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a29">CON_FONTSIZE</a>(Console);
00283         } <span class="keywordflow">else</span> {
00284             FontSize.X = 1;
00285             FontSize.Y = 1;
00286         }
00287         CombineRegion = CreateRectRgn(0,0,0,0);
00288         OldRegion = CreateRectRgn((OldSelectionRect.Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left)*FontSize.X,
00289                                   (OldSelectionRect.Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top)*FontSize.Y,
00290                                   (OldSelectionRect.Right-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left+1)*FontSize.X,
00291                                   (OldSelectionRect.Bottom-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top+1)*FontSize.Y
00292                                  );
00293         NewRegion = CreateRectRgn((Console-&gt;SelectionRect.Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left)*FontSize.X,
00294                                   (Console-&gt;SelectionRect.Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top)*FontSize.Y,
00295                                   (Console-&gt;SelectionRect.Right-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left+1)*FontSize.X,
00296                                   (Console-&gt;SelectionRect.Bottom-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top+1)*FontSize.Y
00297                                  );
00298         CombineRgn(CombineRegion,OldRegion,NewRegion,RGN_XOR);
00299 
00300         InvertRgn(Console-&gt;hDC,CombineRegion);
00301         DeleteObject(OldRegion);
00302         DeleteObject(NewRegion);
00303         DeleteObject(CombineRegion);
00304     }
00305 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ntcon/server/clipbrd.c::InitSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">1096</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">CancelMouseSelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00032">msgMarkMode</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01167">DoMark()</a>.
<p>
<pre class="fragment"><div>01107 {
01108     COORD Position;
01109     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01110 
01111     <span class="comment">//</span>
01112     <span class="comment">// if already selecting, cancel selection.</span>
01113     <span class="comment">//</span>
01114 
01115     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
01116         <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a>) {
01117             <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a3">CancelMouseSelection</a>(Console);
01118         } <span class="keywordflow">else</span> {
01119             <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a4">CancelKeySelection</a>(Console,FALSE);
01120         }
01121     }
01122 
01123     <span class="comment">//</span>
01124     <span class="comment">// set flags</span>
01125     <span class="comment">//</span>
01126 
01127     Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
01128     Console-&gt;SelectionFlags = 0;
01129 
01130     <span class="comment">//</span>
01131     <span class="comment">// save old cursor position and</span>
01132     <span class="comment">// make console cursor into selection cursor.</span>
01133     <span class="comment">//</span>
01134 
01135     ScreenInfo = Console-&gt;CurrentScreenBuffer;
01136     Console-&gt;TextCursorPosition = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition;
01137     Console-&gt;TextCursorVisible = (BOOLEAN)ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorVisible;
01138     Console-&gt;TextCursorSize =   ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorSize;
01139     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
01140     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a4">SetCursorInformation</a>(ScreenInfo,
01141                          100,
01142                          TRUE
01143                         );
01144     Position.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
01145     Position.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
01146     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(ScreenInfo,
01147                       Position,
01148                       TRUE
01149                      );
01150     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
01151 
01152     <span class="comment">//</span>
01153     <span class="comment">// init select rect</span>
01154     <span class="comment">//</span>
01155 
01156     Console-&gt;SelectionAnchor = Position;
01157 
01158     <span class="comment">//</span>
01159     <span class="comment">// set win text</span>
01160     <span class="comment">//</span>
01161 
01162     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgMarkMode,TRUE);
01163 
01164 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ntcon/server/clipbrd.c::InvertSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InvertSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Inverting</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00155">155</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00126">CONSOLE_SELECTION_INVERTED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00293">WriteRegionToScreenBitMap()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.
<p>
<pre class="fragment"><div>00159 {
00160     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Inverted;
00161     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> &amp;&amp;
00162         Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>) {
00163         Inverted = (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a30">CONSOLE_SELECTION_INVERTED</a>) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00164         <span class="keywordflow">if</span> (Inverting == Inverted) {
00165             <span class="keywordflow">return</span>;
00166         }
00167         <span class="keywordflow">if</span> (Inverting) {
00168             Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a30">CONSOLE_SELECTION_INVERTED</a>;
00169         } <span class="keywordflow">else</span> {
00170             Console-&gt;SelectionFlags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a30">CONSOLE_SELECTION_INVERTED</a>;
00171         }
00172         <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00173     }
00174 
00175 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ntcon/server/clipbrd.c::MyInvert" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MyInvert           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>SmallRect</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">70</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd()</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00065">Rect::bottom</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00064">Rect::left</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00068">Rect</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00066">Rect::right</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00063">Rect::top</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">CancelMouseSelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">ConvertToMouseSelect()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00155">InvertSelection()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
<pre class="fragment"><div>00081 {
00082     RECT <a class="code" href="../../d5/d6/structRect.html">Rect</a>;
00083     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00084 <span class="preprocessor">#ifdef FE_SB</span>
00085 <span class="preprocessor"></span>    SMALL_RECT SmallRect2;
00086     COORD TargetPoint;
00087     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
00088 <span class="preprocessor">#endif  // FE_SB</span>
00089 <span class="preprocessor"></span>
00090     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00091 <span class="preprocessor">#ifdef FE_SB</span>
00092 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
00093             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00094         <span class="keywordflow">for</span> (SmallRect2.Top=SmallRect-&gt;Top; SmallRect2.Top &lt;= SmallRect-&gt;Bottom;SmallRect2.Top++) {
00095             SmallRect2.Bottom = SmallRect2.Top;
00096             SmallRect2.Left = SmallRect-&gt;Left;
00097             SmallRect2.Right = SmallRect-&gt;Right;
00098 
00099             TargetPoint.X = SmallRect2.Left;
00100             TargetPoint.Y = SmallRect2.Top;
00101             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = SmallRect2.Right - SmallRect2.Left + 1;
00102             <a class="code" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd</a>(StringLength,TargetPoint,ScreenInfo,&amp;SmallRect2);
00103 
00104             <span class="keywordflow">if</span> (SmallRect2.Left &lt;= SmallRect2.Right) {
00105                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> = SmallRect2.Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00106                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> = SmallRect2.Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00107                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> = SmallRect2.Right+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00108                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> = SmallRect2.Bottom+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00109                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00110                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00111                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00112                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00113                 PatBlt(Console-&gt;hDC,
00114                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00115                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00116                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a>  - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00117                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00118                        DSTINVERT
00119                       );
00120             }
00121         }
00122     } <span class="keywordflow">else</span>
00123 <span class="preprocessor">#endif  // FE_SB</span>
00124 <span class="preprocessor"></span>    {
00125         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> = SmallRect-&gt;Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00126         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> = SmallRect-&gt;Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00127         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> = SmallRect-&gt;Right+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00128         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> = SmallRect-&gt;Bottom+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00129 <span class="preprocessor">#ifdef FE_SB</span>
00130 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
00131                 ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00132 <span class="preprocessor">#else</span>
00133 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00134 <span class="preprocessor">#endif</span>
00135 <span class="preprocessor"></span>        {
00136             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00137             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00138             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00139             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00140         }
00141 
00142         PatBlt(Console-&gt;hDC,
00143                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00144                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00145                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a>  - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00146                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00147                   DSTINVERT
00148                  );
00149     }
00150 
00151     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00152 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ntcon/server/clipbrd.c::ScrollIfNecessary" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ScrollIfNecessary           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01231">1231</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00125">CONSOLE_MOUSE_DOWN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00608">GetClientRect()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00624">GetCursorPos()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00155">MapWindowPoints()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00118">PtInRect()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00670">ScreenToClient()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01235 {
01236     POINT CursorPos;
01237     RECT ClientRect;
01238     COORD MousePosition;
01239 
01240     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> &amp;&amp;
01241         Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>) {
01242         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;CursorPos)) {
01243             <span class="keywordflow">return</span>;
01244         }
01245         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(Console-&gt;hWnd,&amp;ClientRect)) {
01246             <span class="keywordflow">return</span>;
01247         }
01248         <a class="code" href="../../d3/d8/winmgrc_8c.html#a15">MapWindowPoints</a>(Console-&gt;hWnd,NULL,(LPPOINT)&amp;ClientRect,2);
01249         <span class="keywordflow">if</span> (!(<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;ClientRect,CursorPos))) {
01250             <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(Console-&gt;hWnd,&amp;CursorPos);
01251             MousePosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)CursorPos.x;
01252             MousePosition.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)CursorPos.y;
01253             <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01254                 MousePosition.X /= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
01255                 MousePosition.Y /= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
01256             }
01257             MousePosition.X += ScreenInfo-&gt;Window.Left;
01258             MousePosition.Y += ScreenInfo-&gt;Window.Top;
01259 
01260             <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console,
01261                             MousePosition
01262                            );
01263         }
01264     }
01265 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ntcon/server/clipbrd.c::StoreSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID StoreSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">452</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00306">CloseClipboard</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00199">ConsoleHeapSize</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00169">_SCREEN_INFORMATION::hPalette</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00102">KEY_PRESSED</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00540">OpenClipboard()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01415">ReadRectFromScreenBuffer()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00718">SelectPalette</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00876">SetClipboardData()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03111">UNICODE_SPACE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00267">WINDOW_SIZE_X</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00268">WINDOW_SIZE_Y</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>00462 {
00463     PCHAR_INFO Selection,CurCharInfo;
00464     COORD SourcePoint;
00465     COORD TargetSize;
00466     SMALL_RECT TargetRect;
00467     PWCHAR CurChar,CharBuf;
00468     HANDLE ClipboardDataHandle;
00469     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00470     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
00471     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00472     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bFalseUnicode;
00473     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMungeData;
00474 <span class="preprocessor">#if defined(FE_SB)</span>
00475 <span class="preprocessor"></span>    COORD TargetSize2;
00476     PWCHAR TmpClipboardData;
00477     SMALL_RECT SmallRect2;
00478     COORD TargetPoint;
00479     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
00480     WCHAR wchCARRIAGERETURN;
00481     WCHAR wchLINEFEED;
00482     <span class="keywordtype">int</span> iExtra = 0;
00483     <span class="keywordtype">int</span> iFeReserve = 1;
00484 <span class="preprocessor">#endif</span>
00485 <span class="preprocessor"></span>
00486     <span class="comment">//</span>
00487     <span class="comment">// See if there is a selection to get</span>
00488     <span class="comment">//</span>
00489 
00490     <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>)) {
00491         <span class="keywordflow">return</span>;
00492     }
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">// read selection rectangle.  clip it first.</span>
00496     <span class="comment">//</span>
00497 
00498     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00499     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Left &lt; 0) {
00500         Console-&gt;SelectionRect.Left = 0;
00501     }
00502     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Top &lt; 0) {
00503         Console-&gt;SelectionRect.Top = 0;
00504     }
00505     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Right &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X) {
00506         Console-&gt;SelectionRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X-1);
00507     }
00508     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Bottom &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00509         Console-&gt;SelectionRect.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-1);
00510     }
00511 
00512     TargetSize.X = <a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;Console-&gt;SelectionRect);
00513     TargetSize.Y = <a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;Console-&gt;SelectionRect);
00514     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00515 <span class="preprocessor">#if defined(FE_SB)</span>
00516 <span class="preprocessor"></span>
00517         <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
00518             iExtra = 4 ;     <span class="comment">// 4 is for DBCS lead or tail extra</span>
00519             iFeReserve = 2 ; <span class="comment">// FE does this for safety</span>
00520             TmpClipboardData = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),(<span class="keyword">sizeof</span>(WCHAR) * TargetSize.Y * (TargetSize.X + iExtra) + <span class="keyword">sizeof</span>(WCHAR)));
00521             <span class="keywordflow">if</span> (TmpClipboardData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00522                 <span class="keywordflow">return</span>;
00523             }
00524         } <span class="keywordflow">else</span> {
00525             TmpClipboardData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00526         }
00527 
00528         Selection = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),<span class="keyword">sizeof</span>(CHAR_INFO) * (TargetSize.X + iExtra) * TargetSize.Y * iFeReserve);
00529         <span class="keywordflow">if</span> (Selection == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00530         {
00531             <span class="keywordflow">if</span> (TmpClipboardData)
00532                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpClipboardData);
00533             <span class="keywordflow">return</span>;
00534         }
00535 <span class="preprocessor">#else</span>
00536 <span class="preprocessor"></span>        Selection = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),<span class="keyword">sizeof</span>(CHAR_INFO) * TargetSize.X * TargetSize.Y);
00537         <span class="keywordflow">if</span> (Selection == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00538             <span class="keywordflow">return</span>;
00539 <span class="preprocessor">#endif</span>
00540 <span class="preprocessor"></span>
00541 <span class="preprocessor">#if defined(FE_SB)</span>
00542 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_CP(Console)) {
00543 <span class="preprocessor">#endif</span>
00544 <span class="preprocessor"></span>
00545 <span class="preprocessor">#ifdef i386</span>
00546 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) &amp;&amp;
00547             (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) {
00548             ReadRegionFromScreenHW(ScreenInfo,
00549                                    &amp;Console-&gt;SelectionRect,
00550                                    Selection);
00551             CurCharInfo = Selection;
00552             <span class="keywordflow">for</span> (i=0; i&lt;TargetSize.Y; i++) {
00553                 <span class="keywordflow">for</span> (j=0; j&lt;TargetSize.X; j++,CurCharInfo++) {
00554                     CurCharInfo-&gt;Char.UnicodeChar = SB_CharToWcharGlyph(Console-&gt;OutputCP, CurCharInfo-&gt;Char.AsciiChar);
00555                 }
00556             }
00557         } <span class="keywordflow">else</span> {
00558 <span class="preprocessor">#endif</span>
00559 <span class="preprocessor"></span>            SourcePoint.X = Console-&gt;SelectionRect.Left;
00560             SourcePoint.Y = Console-&gt;SelectionRect.Top;
00561             TargetRect.Left = TargetRect.Top = 0;
00562             TargetRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.X-1);
00563             TargetRect.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.Y-1);
00564             <a class="code" href="../../d6/d2/output_8c.html#a50">ReadRectFromScreenBuffer</a>(ScreenInfo,
00565                                      SourcePoint,
00566                                      Selection,
00567                                      TargetSize,
00568                                      &amp;TargetRect);
00569 <span class="preprocessor">#ifdef i386</span>
00570 <span class="preprocessor"></span>        }
00571 <span class="preprocessor">#endif</span>
00572 <span class="preprocessor"></span>
00573         <span class="comment">// extra 2 per line is for CRLF, extra 1 is for null</span>
00574         ClipboardDataHandle = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE,
00575                 (TargetSize.Y * (TargetSize.X + 2) + 1) * <span class="keyword">sizeof</span>(WCHAR));
00576         <span class="keywordflow">if</span> (ClipboardDataHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00577             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Selection);
00578             <span class="keywordflow">return</span>;
00579         }
00580 <span class="preprocessor">#if defined(FE_SB)</span>
00581 <span class="preprocessor"></span>    }
00582 <span class="preprocessor">#endif</span>
00583 <span class="preprocessor"></span>
00584         <span class="comment">//</span>
00585         <span class="comment">// convert to clipboard form</span>
00586         <span class="comment">//</span>
00587 
00588 <span class="preprocessor">#if defined(FE_SB)</span>
00589 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
00590             <span class="keywordflow">if</span> ((ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00591                     !(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
00592                 <span class="comment">/*</span>
00593 <span class="comment">                 * False Unicode is obtained, so we will have to convert it to</span>
00594 <span class="comment">                 * Real Unicode, in which case we can't put CR or LF in now, since</span>
00595 <span class="comment">                 * they will be converted into 0x266A and 0x25d9.  Temporarily</span>
00596 <span class="comment">                 * mark the CR/LF positions with 0x0000 instead.</span>
00597 <span class="comment">                 */</span>
00598                 wchCARRIAGERETURN = 0x0000;
00599                 wchLINEFEED = 0x0000;
00600             } <span class="keywordflow">else</span> {
00601                 wchCARRIAGERETURN = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
00602                 wchLINEFEED = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
00603             }
00604 
00605             CurChar = TmpClipboardData;
00606             bMungeData = (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) == 0;
00607             <span class="keywordflow">for</span> (i=0;i&lt;TargetSize.Y;i++) {
00608                 PWCHAR pwchLineStart = CurChar;
00609 
00610                 SourcePoint.X = Console-&gt;SelectionRect.Left;
00611                 SourcePoint.Y = Console-&gt;SelectionRect.Top + i;
00612                 TargetSize2.X = TargetSize.X;
00613                 TargetSize2.Y = 1;
00614 
00615                 SmallRect2.Left = SourcePoint.X;
00616                 SmallRect2.Top = SourcePoint.Y;
00617                 SmallRect2.Right = SourcePoint.X + TargetSize2.X - 1;
00618                 SmallRect2.Bottom = SourcePoint.Y;
00619                 TargetPoint = SourcePoint;
00620                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = TargetSize2.X;
00621                 <a class="code" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd</a>(StringLength,TargetPoint,ScreenInfo,&amp;SmallRect2);
00622 
00623                 SourcePoint.X = SmallRect2.Left;
00624                 SourcePoint.Y = SmallRect2.Top;
00625                 TargetSize2.X = SmallRect2.Right - SmallRect2.Left + 1;
00626                 TargetSize2.Y = 1;
00627                 TargetRect.Left = TargetRect.Top = TargetRect.Bottom = 0;
00628                 TargetRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize2.X-1);
00629 
00630                 <a class="code" href="../../d6/d2/output_8c.html#a50">ReadRectFromScreenBuffer</a>(ScreenInfo,
00631                                          SourcePoint,
00632                                          Selection,
00633                                          TargetSize2,
00634                                          &amp;TargetRect);
00635 
00636                 CurCharInfo = Selection;
00637                 <span class="keywordflow">for</span> (j=0;j&lt;TargetSize2.X;j++,CurCharInfo++) {
00638                     <span class="keywordflow">if</span> (!(CurCharInfo-&gt;Attributes &amp; COMMON_LVB_TRAILING_BYTE))
00639                         *CurChar++ = CurCharInfo-&gt;Char.UnicodeChar;
00640                 }
00641                 <span class="comment">// trim trailing spaces</span>
00642                 <span class="keywordflow">if</span> (bMungeData) {
00643                     CurChar--;
00644                     <span class="keywordflow">while</span> ((CurChar &gt;= pwchLineStart) &amp;&amp; (*CurChar == <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>))
00645                         CurChar--;
00646                     CurChar++;
00647                     *CurChar++ = wchCARRIAGERETURN;
00648                     *CurChar++ = wchLINEFEED;
00649                 }
00650             }
00651         }
00652         <span class="keywordflow">else</span> {
00653 <span class="preprocessor">#endif</span>
00654 <span class="preprocessor"></span>        CurCharInfo = Selection;
00655         CurChar = CharBuf = GlobalLock(ClipboardDataHandle);
00656         bFalseUnicode = ((ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00657                 !(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN));
00658         bMungeData = (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) == 0;
00659         <span class="keywordflow">for</span> (i=0;i&lt;TargetSize.Y;i++) {
00660             PWCHAR pwchLineStart = CurChar;
00661 
00662             <span class="keywordflow">for</span> (j=0;j&lt;TargetSize.X;j++,CurCharInfo++,CurChar++) {
00663                 *CurChar = CurCharInfo-&gt;Char.UnicodeChar;
00664                 <span class="keywordflow">if</span> (*CurChar == 0) {
00665                     *CurChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00666                 }
00667             }
00668             <span class="comment">// trim trailing spaces</span>
00669             <span class="keywordflow">if</span> (bMungeData) {
00670                 CurChar--;
00671                 <span class="keywordflow">while</span> ((CurChar &gt;= pwchLineStart) &amp;&amp; (*CurChar == <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>))
00672                     CurChar--;
00673                 CurChar++;
00674             }
00675 
00676             <span class="keywordflow">if</span> (bFalseUnicode) {
00677                 <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(pwchLineStart,
00678                         (ULONG)(CurChar - pwchLineStart), Console-&gt;OutputCP);
00679             }
00680             <span class="keywordflow">if</span> (bMungeData) {
00681                 *CurChar++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
00682                 *CurChar++ = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
00683             }
00684         }
00685 <span class="preprocessor">#if defined(FE_SB)</span>
00686 <span class="preprocessor"></span>        }
00687 <span class="preprocessor">#endif</span>
00688 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (bMungeData) {
00689             <span class="keywordflow">if</span> (TargetSize.Y)
00690                 CurChar -= 2;   <span class="comment">// don't put CRLF on last line</span>
00691         }
00692         *CurChar = <span class="charliteral">'\0'</span>;    <span class="comment">// null terminate</span>
00693 
00694 <span class="preprocessor">#if defined(FE_SB)</span>
00695 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
00696             <span class="comment">// extra 4 is for CRLF and DBCS Reserved, extra 1 is for null</span>
00697             ClipboardDataHandle = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE,
00698                     (<span class="keyword">sizeof</span>(WCHAR) * TargetSize.Y * (TargetSize.X+(4*<span class="keyword">sizeof</span>(WCHAR)))) +
00699                                                         (1*<span class="keyword">sizeof</span>(WCHAR)));
00700             <span class="keywordflow">if</span> (ClipboardDataHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00701                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Selection);
00702                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpClipboardData);
00703                 <span class="keywordflow">return</span>;
00704             }
00705 
00706             CharBuf = GlobalLock(ClipboardDataHandle);
00707             RtlCopyMemory(CharBuf,TmpClipboardData,<a class="code" href="../../d8/d5/consrv_8h.html#a39">ConsoleHeapSize</a>(TmpClipboardData));
00708             CurChar = CharBuf + (CurChar - TmpClipboardData);
00709 
00710             <span class="keywordflow">if</span> (wchCARRIAGERETURN == 0x0000) {
00711                 <span class="comment">/*</span>
00712 <span class="comment">                 * We have False Unicode, so we temporarily represented CRLFs with</span>
00713 <span class="comment">                 * 0x0000s to avoid undesirable conversions (above).</span>
00714 <span class="comment">                 * Convert to Real Unicode and restore real CRLFs.</span>
00715 <span class="comment">                 */</span>
00716                 PWCHAR pwch;
00717                 <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(CharBuf,
00718                                     (ULONG)(CurChar - CharBuf),
00719                                     Console-&gt;OutputCP
00720                                    );
00721                 <span class="keywordflow">for</span> (pwch = CharBuf; pwch &lt; CurChar; pwch++) {
00722                     <span class="keywordflow">if</span> ((*pwch == 0x0000) &amp;&amp; (pwch[1] == 0x0000)) {
00723                         *pwch++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
00724                         *pwch = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
00725                     }
00726                 }
00727             }
00728         }
00729 <span class="preprocessor">#endif</span>
00730 <span class="preprocessor"></span>
00731         GlobalUnlock(ClipboardDataHandle);
00732 <span class="preprocessor">#if defined(FE_SB)</span>
00733 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (TmpClipboardData)
00734             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpClipboardData);
00735 <span class="preprocessor">#endif</span>
00736 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Selection);
00737         Success = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(Console-&gt;hWnd);
00738         <span class="keywordflow">if</span> (!Success) {
00739             GlobalFree(ClipboardDataHandle);
00740             <span class="keywordflow">return</span>;
00741         }
00742 
00743         Success = EmptyClipboard();
00744         <span class="keywordflow">if</span> (!Success) {
00745             GlobalFree(ClipboardDataHandle);
00746             <span class="keywordflow">return</span>;
00747         }
00748 
00749         <a class="code" href="../../d3/d8/client_8c.html#a43">SetClipboardData</a>(CF_UNICODETEXT,ClipboardDataHandle);
00750         <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();   <span class="comment">// Close clipboard</span>
00751     } <span class="keywordflow">else</span> {
00752         HBITMAP hBitmapTarget, hBitmapOld;
00753         HDC hDCMem;
00754         HPALETTE hPaletteOld;
00755         <span class="keywordtype">int</span> Height;
00756 
00757         <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex,
00758                               FALSE, NULL);
00759 
00760         hDCMem = CreateCompatibleDC(Console-&gt;hDC);
00761         hBitmapTarget = CreateCompatibleBitmap(Console-&gt;hDC,
00762                                                   TargetSize.X,
00763                                                   TargetSize.Y);
00764         <span class="keywordflow">if</span> (hBitmapTarget) {
00765             hBitmapOld = SelectObject(hDCMem, hBitmapTarget);
00766             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>) {
00767                 hPaletteOld = <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(hDCMem,
00768                                              ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>,
00769                                              FALSE);
00770             }
00771             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00772 
00773             <span class="comment">// if (DIB is a top-down)</span>
00774             <span class="comment">//      ySrc = abs(height) - rect.bottom - 1;</span>
00775             <span class="comment">// else</span>
00776             <span class="comment">//      ySrc = rect.Bottom.</span>
00777             <span class="comment">//</span>
00778             Height = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo-&gt;bmiHeader.biHeight;
00779 
00780             StretchDIBits(hDCMem, 0, 0,
00781                         TargetSize.X, TargetSize.Y,
00782                         Console-&gt;SelectionRect.Left + ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left,
00783                         (Height &lt; 0) ? -Height - (Console-&gt;SelectionRect.Bottom + ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top) -  1
00784                         : Console-&gt;SelectionRect.Bottom + ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top,
00785                         TargetSize.X, TargetSize.Y,
00786                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
00787                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
00788                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage,
00789                         SRCCOPY);
00790             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00791             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>) {
00792                 <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(hDCMem, hPaletteOld, FALSE);
00793             }
00794             SelectObject(hDCMem, hBitmapOld);
00795             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(Console-&gt;hWnd);
00796             EmptyClipboard();
00797             <a class="code" href="../../d3/d8/client_8c.html#a43">SetClipboardData</a>(CF_BITMAP,hBitmapTarget);
00798             <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();
00799         }
00800         DeleteDC(hDCMem);
00801         <a class="code" href="../../d2/d5/mutant_8c.html#a8">NtReleaseMutant</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex, NULL);
00802     }
00803 
00804 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
