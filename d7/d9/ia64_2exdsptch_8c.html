<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ia64/exdsptch.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>exdsptch.c File Reference</h1><code>#include "<a class="el" href="../../d6/d8/ntrtlp_8h-source.html">ntrtlp.h</a>"</code><br>

<p>
<a href="../../d8/d8/ia64_2exdsptch_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a0">IS_HANDLER_DEFINED</a>(f, base)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a1">HANDLER</a>(f, base, target)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a2">RAISE_EXCEPTION</a>(<a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>, ExceptionRecordt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(Frame1, Frame2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a4">INITIALIZE_FRAME</a>(Frame)&nbsp;&nbsp;&nbsp;Frame.MemoryStackFp = Frame.BackingStoreFp = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a5">CHECK_MSTACK_FRAME</a>(Establisher, Target)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a6">CHECK_BSTORE_FRAME</a>(Establisher, Target)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a7">IS_EM_SETJMP_REGISTRATION</a>(ExRegistration)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PRUNTIME_FUNCTION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a9">RtlLookupStaticFunctionEntry</a> (IN ULONG_PTR ControlPc, OUT PBOOLEAN InImage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PRUNTIME_FUNCTION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a10">RtlLookupDynamicFunctionEntry</a> (IN ULONG_PTR ControlPc, OUT PULONGLONG ImageBase, OUT PULONGLONG TargetGp)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a11">RtlRestoreContext</a> (IN PCONTEXT ContextRecord, IN PEXCEPTION_RECORD ExceptionRecord OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONGLONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a12">RtlpVirtualUnwind</a> (IN ULONGLONG ImageBase, IN ULONGLONG ControlPc, IN PRUNTIME_FUNCTION FunctionEntry, IN PCONTEXT ContextRecord, OUT PBOOLEAN InFunction, OUT PFRAME_POINTERS EstablisherFrame, IN OUT PKNONVOLATILE_CONTEXT_POINTERS ContextPointers OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PEXCEPTION_REGISTRATION_RECORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a13">RtlpGetRegistrationHead</a> (IN VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a14">RtlpUnlinkHandler</a> (PEXCEPTION_REGISTRATION_RECORD UnlinkPointer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PRUNTIME_FUNCTION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a15">RtlLookupFunctionEntry</a> (IN ULONGLONG ControlPc, OUT PULONGLONG ImageBase, OUT PULONGLONG TargetGp)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a16">RtlpRaiseException</a> (IN PEXCEPTION_RECORD ExceptionRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a17">RtlRaiseException</a> (IN PEXCEPTION_RECORD ExceptionRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a18">RtlpRaiseStatus</a> (IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a19">RtlRaiseStatus</a> (IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a20">RtlUnwind</a> (IN PVOID TargetFrame OPTIONAL, IN PVOID TargetIp OPTIONAL, IN PEXCEPTION_RECORD ExceptionRecord OPTIONAL, IN PVOID ReturnValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a21">RtlUnwind2</a> (IN FRAME_POINTERS TargetFrame OPTIONAL, IN PVOID TargetIp OPTIONAL, IN PEXCEPTION_RECORD ExceptionRecord OPTIONAL, IN PVOID ReturnValue, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a22">RtlDispatchException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PLIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a23">RtlGetFunctionTableListHead</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a24">RtlAddFunctionTable</a> (IN PRUNTIME_FUNCTION FunctionTable, IN ULONG EntryCount, IN ULONGLONG BaseAddress, IN ULONGLONG TargetGp)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a25">RtlDeleteFunctionTable</a> (IN PRUNTIME_FUNCTION FunctionTable)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a8">DynamicFunctionTable</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a6" doxytag="ia64/exdsptch.c::CHECK_BSTORE_FRAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CHECK_BSTORE_FRAME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Establisher,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Target&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((Establisher.BackingStoreFp &lt; LowBStoreLimit) ||                         \
     (Establisher.BackingStoreFp &gt; HighBStoreLimit) ||                        \
     ((Target.BackingStoreFp != 0) &amp;&amp;                                         \
      ((ULONG)Target.BackingStoreFp &gt; (ULONG)Establisher.BackingStoreFp)) ||  \
     ((Establisher.BackingStoreFp &amp; 0x7) != 0))
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00101">101</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">RtlDispatchException()</a>, and <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">RtlUnwind2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ia64/exdsptch.c::CHECK_MSTACK_FRAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CHECK_MSTACK_FRAME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Establisher,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Target&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((Establisher.MemoryStackFp &lt; LowStackLimit) ||                        \
     (Establisher.MemoryStackFp &gt; HighStackLimit) ||                       \
     ((Target.MemoryStackFp != 0) &amp;&amp;                                       \
      ((ULONG)Target.MemoryStackFp &lt; (ULONG)Establisher.MemoryStackFp)) || \
     ((Establisher.MemoryStackFp &amp; 0x3) != 0))
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00094">94</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">RtlDispatchException()</a>, and <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">RtlUnwind2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ia64/exdsptch.c::HANDLER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HANDLER          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">f,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>base,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>target&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(PEXCEPTION_ROUTINE)                                                        \
        (*(PULONGLONG) ((LONGLONG)target +                                      \
        (*(PULONGLONG) (base + f-&gt;UnwindInfoAddress + <span class="keyword">sizeof</span>(UNWIND_INFO)  +    \
        (((PUNWIND_INFO) (base + f-&gt;UnwindInfoAddress))-&gt;DataLength * <span class="keyword">sizeof</span>(ULONGLONG))))))
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00071">71</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">RtlDispatchException()</a>, and <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">RtlUnwind2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ia64/exdsptch.c::INITIALIZE_FRAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INITIALIZE_FRAME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Frame&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;Frame.MemoryStackFp = Frame.BackingStoreFp = 0</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00091">91</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">RtlDispatchException()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ia64/exdsptch.c::IS_EM_SETJMP_REGISTRATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IS_EM_SETJMP_REGISTRATION          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ExRegistration&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(   (ExRegistration != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)                                                            &amp;&amp;  \
        (ExRegistration != EXCEPTION_CHAIN_END)                                             &amp;&amp;  \
        (ExRegistration-&gt;Next == (<span class="keyword">struct </span>_EXCEPTION_REGISTRATION_RECORD *)(LONG_PTR) 1)          \
    )
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00108">108</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00518">RtlUnwind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ia64/exdsptch.c::IS_HANDLER_DEFINED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IS_HANDLER_DEFINED          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">f,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>base&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(f-&gt;UnwindInfoAddress &amp;&amp;                                       \
        (((PUNWIND_INFO)(base+f-&gt;UnwindInfoAddress))-&gt;Flags &amp; 0x3))
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00067">67</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ia64/exdsptch.c::IS_SAME_FRAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IS_SAME_FRAME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Frame1,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Frame2&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( (Frame1.MemoryStackFp == Frame2.MemoryStackFp) &amp;&amp;            \
      (Frame1.BackingStoreFp == Frame2.BackingStoreFp) )
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00087">87</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">RtlDispatchException()</a>, and <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">RtlUnwind2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ia64/exdsptch.c::RAISE_EXCEPTION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RAISE_EXCEPTION          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ExceptionRecordt&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                \
    EXCEPTION_RECORD ExceptionRecordn;                             \
                                                                   \
    ExceptionRecordn.ExceptionCode = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;                       \
    ExceptionRecordn.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;    \
    ExceptionRecordn.ExceptionRecord = ExceptionRecordt;           \
    ExceptionRecordn.NumberParameters = 0;                         \
    <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a17">RtlRaiseException</a>(&amp;ExceptionRecordn);                          \
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00077">77</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a24" doxytag="ia64/exdsptch.c::RtlAddFunctionTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RtlAddFunctionTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRUNTIME_FUNCTION&nbsp;</td>
          <td class="mdname" nowrap> <em>FunctionTable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>EntryCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetGp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l01422">1422</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00137">DynamicFunctionTable</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00142">LoaderLock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01431                    :
01432 
01433     Add a dynamic function table to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dynamic function table list. Dynamic
01434     function tables describe code generated at run-time. The dynamic function
01435     tables are searched via a call to <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a10">RtlLookupDynamicFunctionEntry</a>().
01436     Normally <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> invoked via calls to <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>().
01437 
01438     The FunctionTable entries need not be sorted in any particular order. The
01439     list <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> scanned <span class="keywordflow">for</span> a <a class="code" href="../../d3/d8/udfprocs_8h.html#a3">Min</a> and <a class="code" href="../../d3/d8/udfprocs_8h.html#a4">Max</a> address range and whether or not <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01440     sorted. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> latter <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a10">RtlLookupDynamicFunctionEntry</a>() uses a binary
01441     search, otherwise it uses a linear search.
01442 
01443     The dynamic function entries will be searched only after a search
01444     through the static function entries associated with all current
01445     process images has failed.
01446 
01447 Arguments:
01448 
01449    FunctionTable       Address of an array of function entries where
01450                        each element is of type RUNTIME_FUNCTION.
01451 
01452    EntryCount          The number of function entries in the array
01453 
01454    BaseAddress         Base address to calculate the real address  of the function table entry
01455    TargetGp            return back to RtlLookupFunctionEntry for future query.
01456 
01457 Return value:
01458 
01459    TRUE                if RtlAddFunctionTable completed successfully
01460    FALSE               if RtlAddFunctionTable completed unsuccessfully
01461 
01462 --*/
01463 {
01464     PDYNAMIC_FUNCTION_TABLE pNew;
01465     PRUNTIME_FUNCTION FunctionEntry;
01466     ULONG i;
01467 
01468     <span class="keywordflow">if</span> (EntryCount == 0)
01469         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01470 
01471     <span class="comment">//</span>
01472     <span class="comment">// Make sure the link list is initialized;</span>
01473     <span class="comment">//</span>
01474 
01475     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a7">DynamicFunctionTable</a>.Flink == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01476        InitializeListHead(&amp;DynamicFunctionTable);
01477     }
01478 
01479     <span class="comment">//</span>
01480     <span class="comment">//  Allocate memory for this link list entry</span>
01481     <span class="comment">//</span>
01482 
01483     pNew = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, <span class="keyword">sizeof</span>(DYNAMIC_FUNCTION_TABLE) );
01484 
01485     <span class="keywordflow">if</span> (pNew != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01486         pNew-&gt;FunctionTable = FunctionTable;
01487         pNew-&gt;EntryCount = EntryCount;
01488         NtQuerySystemTime( &amp;pNew-&gt;TimeStamp );
01489 
01490         <span class="comment">//</span>
01491         <span class="comment">// Scan the function table for Minimum/Maximum and to determine</span>
01492         <span class="comment">// if it is sorted. If the latter, we can perform a binary search.</span>
01493         <span class="comment">//</span>
01494 
01495         FunctionEntry = FunctionTable;
01496         pNew-&gt;MinimumAddress = RF_BEGIN_ADDRESS( BaseAddress, FunctionEntry);
01497         pNew-&gt;MaximumAddress = RF_END_ADDRESS(BaseAddress, FunctionEntry);
01498         pNew-&gt;Sorted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01499         FunctionEntry++;
01500 
01501         <span class="keywordflow">for</span> (i = 1; i &lt; EntryCount; FunctionEntry++, i++) {
01502             <span class="keywordflow">if</span> (pNew-&gt;Sorted &amp;&amp; FunctionEntry-&gt;BeginAddress &lt; FunctionTable[i-1].BeginAddress) {
01503                 pNew-&gt;Sorted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01504             }
01505             <span class="keywordflow">if</span> (RF_BEGIN_ADDRESS(FunctionTable, FunctionEntry) &lt; pNew-&gt;MinimumAddress) {
01506                 pNew-&gt;MinimumAddress = RF_BEGIN_ADDRESS( BaseAddress, FunctionEntry);
01507             }
01508             <span class="keywordflow">if</span> (RF_END_ADDRESS( FunctionTable, FunctionEntry) &gt; pNew-&gt;MaximumAddress) {
01509                 pNew-&gt;MaximumAddress = RF_END_ADDRESS( BaseAddress, FunctionEntry);
01510             }
01511         }
01512 
01513         <span class="comment">//</span>
01514         <span class="comment">// Insert the new entry in the dynamic function table list.</span>
01515         <span class="comment">// Protect the insertion with the loader lock.</span>
01516         <span class="comment">//</span>
01517 
01518         pNew-&gt;BaseAddress = BaseAddress;
01519         pNew-&gt;TargetGp    = TargetGp;
01520 
01521         RtlEnterCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01522         InsertTailList((PLIST_ENTRY)&amp;DynamicFunctionTable, (PLIST_ENTRY)pNew);
01523         RtlLeaveCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01524 
01525         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01526     } <span class="keywordflow">else</span> {
01527         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01528     }
01529 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ia64/exdsptch.c::RtlDeleteFunctionTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RtlDeleteFunctionTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRUNTIME_FUNCTION&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FunctionTable</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l01532">1532</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00137">DynamicFunctionTable</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00142">LoaderLock</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01535 {
01536 
01537 <span class="comment">/*++</span>
01538 <span class="comment"></span>
01539 <span class="comment">Routine Description:</span>
01540 <span class="comment"></span>
01541 <span class="comment">    Remove a dynamic function table from the dynamic function table list.</span>
01542 <span class="comment"></span>
01543 <span class="comment">Arguments:</span>
01544 <span class="comment"></span>
01545 <span class="comment">   FunctionTable       Address of an array of function entries that</span>
01546 <span class="comment">                       was passed in a previous call to RtlAddFunctionTable</span>
01547 <span class="comment"></span>
01548 <span class="comment">Return Value</span>
01549 <span class="comment"></span>
01550 <span class="comment">    TRUE - If function completed successfully</span>
01551 <span class="comment">    FALSE - If function completed unsuccessfully</span>
01552 <span class="comment"></span>
01553 <span class="comment">--*/</span>
01554 
01555     PDYNAMIC_FUNCTION_TABLE CurrentEntry;
01556     PLIST_ENTRY Head;
01557     PLIST_ENTRY Next;
01558     BOOLEAN <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01559 
01560     RtlEnterCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01561 
01562     <span class="comment">//</span>
01563     <span class="comment">// Search the dynamic function table list for a match on the the function</span>
01564     <span class="comment">// table address.</span>
01565     <span class="comment">//</span>
01566 
01567     Head = &amp;<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a7">DynamicFunctionTable</a>;
01568     <span class="keywordflow">for</span> (Next = Head-&gt;Blink; Next != Head; Next = Next-&gt;Blink) {
01569         CurrentEntry = CONTAINING_RECORD(Next,DYNAMIC_FUNCTION_TABLE,Links);
01570         <span class="keywordflow">if</span> (CurrentEntry-&gt;FunctionTable == FunctionTable) {
01571             RemoveEntryList((PLIST_ENTRY)CurrentEntry);
01572             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, CurrentEntry );
01573             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01574             <span class="keywordflow">break</span>;
01575         }
01576     }
01577 
01578     RtlLeaveCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01579     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01580 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ia64/exdsptch.c::RtlDispatchException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RtlDispatchException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">985</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00101">CHECK_BSTORE_FRAME</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00094">CHECK_MSTACK_FRAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00053">EXCEPTION_COLLIDED_UNWIND</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00051">EXCEPTION_NESTED_CALL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00047">EXCEPTION_NONCONTINUABLE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00050">EXCEPTION_STACK_INVALID</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00062">ExceptionCollidedUnwind</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00059">ExceptionContinueExecution</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00060">ExceptionContinueSearch</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00061">ExceptionNestedException</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00071">HANDLER</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00091">INITIALIZE_FRAME</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00079">IS_HANDLER_DEFINED</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00087">IS_SAME_FRAME</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00065">RAISE_EXCEPTION</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00348">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d9/d9/rtl_2ia64_2miscc_8c-source.html#l00075">Rtlp64GetBStoreLimits()</a>, <a class="el" href="../../d9/d9/rtl_2ia64_2miscc_8c-source.html#l00178">Rtlp64GetStackLimits()</a>, <a class="el" href="../../d3/d9/ntrtli64_8h.html#a4">RtlpExecuteEmHandlerForException()</a>, <a class="el" href="../../d4/d8/excptdbg_8c-source.html#l00065">RtlpLogExceptionHandler()</a>, <a class="el" href="../../d5/d9/ntrtlp_8h.html#a49">RtlpLogLastExceptionDisposition()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00992                    :
00993 
00994     This function attempts to dispatch an exception to a frame based
00995     handler by searching backwards through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call frames by unwinding
00996     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RSE backing store as well as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory stack.  The search begins 
00997     with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> frame specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record and continues backward 
00998     until either a handler <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found that handles <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> stack 
00999     and/or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> backing store <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found to be invalid (i.e., out of limits 
01000     or unaligned), or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call hierarchy <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reached.
01001 
01002     As each frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> encountered, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PC where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> corresponding
01003     function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> determined and used to lookup exception handler information
01004     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> runtime function table built by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> linker. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> respective
01005     routine has an exception handler, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01006     handler does not handle <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> prologue of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine
01007     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> undone to <span class="stringliteral">"unwind"</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> effect of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> prologue and then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next
01008     frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> examined.
01009 
01010 Arguments:
01011 
01012     ExceptionRecord - Supplies a pointer to an exception record.
01013 
01014     ContextRecord - Supplies a pointer to a context record.
01015 
01016 Return Value:
01017 
01018     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled by one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> frame based handlers, then
01019     a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01020 
01021 --*/
01022 
01023 {
01024     ULONGLONG TargetGp;
01025     ULONGLONG ImageBase;
01026     CONTEXT ContextRecordEm;
01027     ULONGLONG ControlPc;
01028     ULONGLONG NextPc;
01029     <a class="code" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">DISPATCHER_CONTEXT</a> DispatcherContext;
01030     EXCEPTION_DISPOSITION Disposition;
01031     ULONG ExceptionFlags;
01032     PRUNTIME_FUNCTION FunctionEntry;
01033     FRAME_POINTERS EstablisherFrame;
01034     FRAME_POINTERS TargetFrame;       <span class="comment">// to be removed in the future</span>
01035     ULONGLONG HighStackLimit; 
01036     ULONGLONG LowStackLimit;
01037     ULONGLONG HighBStoreLimit; 
01038     ULONGLONG LowBStoreLimit;
01039     FRAME_POINTERS NestedFrame;
01040     FRAME_POINTERS NullFrame;
01041     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01042     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01043     BOOLEAN InFunction;
01044 
01045     <span class="comment">//</span>
01046     <span class="comment">// Get the current stack limits, make a copy of the context record,</span>
01047     <span class="comment">// get the initial PC value, capture the exception flags, and set</span>
01048     <span class="comment">// the nested exception frame pointer.</span>
01049     <span class="comment">//</span>
01050 
01051     <a class="code" href="../../d3/d9/ntrtli64_8h.html#a0">Rtlp64GetStackLimits</a>(&amp;LowStackLimit, &amp;HighStackLimit);
01052     <a class="code" href="../../d3/d9/ntrtli64_8h.html#a1">Rtlp64GetBStoreLimits</a>(&amp;LowBStoreLimit, &amp;HighBStoreLimit);
01053 
01054     RtlMoveMemory(&amp;ContextRecordEm, ContextRecord, <span class="keyword">sizeof</span>(CONTEXT));
01055 
01056     <span class="keywordflow">if</span> ( (ExceptionRecord-&gt;ExceptionCode == STATUS_ACCESS_VIOLATION) &amp;&amp;
01057          (ExceptionRecord-&gt;NumberParameters == 5) &amp;&amp;
01058          (ExceptionRecord-&gt;ExceptionInformation[4] &amp; (1 &lt;&lt; ISR_X)) )
01059     {
01060         ControlPc = ExceptionRecord-&gt;ExceptionInformation[3];
01061         ControlPc = RtlIa64InsertIPSlotNumber(ControlPc,
01062                                ((ContextRecordEm.StIPSR &gt;&gt; PSR_RI) &amp; 0x3));
01063     } <span class="keywordflow">else</span> {
01064         ControlPc = RtlIa64InsertIPSlotNumber(ContextRecordEm.StIIP,
01065                                ((ContextRecordEm.StIPSR &gt;&gt; PSR_RI) &amp; 0x3));
01066     }
01067 
01068     ExceptionFlags = ExceptionRecord-&gt;ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
01069 
01070     <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a4">INITIALIZE_FRAME</a>(NestedFrame);
01071     <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a4">INITIALIZE_FRAME</a>(NullFrame);
01072 
01073     <span class="comment">//</span>
01074     <span class="comment">// Start with the frame specified by the context record and search</span>
01075     <span class="comment">// backwards through the chain of call frames attempting to find an</span>
01076     <span class="comment">// exception handler that will handle the exception.</span>
01077     <span class="comment">//</span>
01078 
01079     <span class="keywordflow">do</span> {
01080 
01081         <span class="comment">//</span>
01082         <span class="comment">// Lookup the function table entry using the point at which control</span>
01083         <span class="comment">// left the procedure.</span>
01084         <span class="comment">//</span>
01085 
01086 
01087         FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc, &amp;ImageBase, &amp;TargetGp);
01088 
01089         <span class="comment">//</span>
01090         <span class="comment">// If there is a function table entry for the routine, then </span>
01091         <span class="comment">// virtually unwind to the caller of the current routine to </span>
01092         <span class="comment">// obtain the virtual frame pointer of the establisher and check </span>
01093         <span class="comment">// if there is an exception handler for the frame.</span>
01094         <span class="comment">//</span>
01095 
01096         <span class="keywordflow">if</span> (FunctionEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01097             NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
01098                                       ControlPc,
01099                                       FunctionEntry,
01100                                       &amp;ContextRecordEm,
01101                                       &amp;InFunction,
01102                                       &amp;EstablisherFrame,
01103                                       NULL);
01104 
01105             <span class="comment">//</span>
01106             <span class="comment">// If either one or both of the two virtual frame pointers are </span>
01107             <span class="comment">// not within the specified stack limits or unaligned, </span>
01108             <span class="comment">// then set the stack invalid flag in the exception record and </span>
01109             <span class="comment">// return exception not handled.  Otherwise, check if the </span>
01110             <span class="comment">// current routine has an exception handler.</span>
01111             <span class="comment">//</span>
01112 
01113             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a5">CHECK_MSTACK_FRAME</a>(EstablisherFrame, NullFrame)) {
01114 
01115                 ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a28">EXCEPTION_STACK_INVALID</a>;
01116                 <span class="keywordflow">break</span>;
01117 
01118             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a6">CHECK_BSTORE_FRAME</a>(EstablisherFrame, NullFrame)) {
01119     
01120                 ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a28">EXCEPTION_STACK_INVALID</a>;
01121                 <span class="keywordflow">break</span>;
01122 
01123             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a1">IS_HANDLER_DEFINED</a>(FunctionEntry, ImageBase) &amp;&amp; InFunction)) {
01124 
01125                 <span class="comment">// </span>
01126                 <span class="comment">// The handler (i.e. personality routine) has to be called </span>
01127                 <span class="comment">// to search for an exception handler in this frame.  The </span>
01128                 <span class="comment">// handler must be executed by calling a stub routine that </span>
01129                 <span class="comment">// is written in assembler.  This is required because up </span>
01130                 <span class="comment">// level addressing of this routine information is required </span>
01131                 <span class="comment">// when a nested exception is encountered.</span>
01132                 <span class="comment">//</span>
01133 
01134                 DispatcherContext.ControlPc = ControlPc;
01135                 DispatcherContext.FunctionEntry = FunctionEntry;
01136                 DispatcherContext.ImageBase = ImageBase;
01137 
01138                 <span class="keywordflow">do</span> {
01139 
01140                     ExceptionRecord-&gt;ExceptionFlags = ExceptionFlags;
01141 
01142                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_ENABLE_EXCEPTION_LOGGING) {
01143                         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a48">RtlpLogExceptionHandler</a>(
01144                                         ExceptionRecord,
01145                                         ContextRecord,
01146                                         (ULONG)ControlPc,
01147                                         FunctionEntry,
01148                                         <span class="keyword">sizeof</span>(RUNTIME_FUNCTION));
01149                     }
01150 
01151                     DispatcherContext.EstablisherFrame = EstablisherFrame;
01152                     DispatcherContext.ContextRecord = ContextRecord;
01153                     Disposition = <a class="code" href="../../d3/d9/ntrtli64_8h.html#a4">RtlpExecuteEmHandlerForException</a>(
01154                                       ExceptionRecord,
01155                                       EstablisherFrame.MemoryStackFp,
01156                                       EstablisherFrame.BackingStoreFp,
01157                                       ContextRecord,
01158                                       &amp;DispatcherContext, 
01159                                       TargetGp,
01160                                       <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a1">HANDLER</a>(FunctionEntry, ImageBase, TargetGp)); 
01161 
01162                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_ENABLE_EXCEPTION_LOGGING) {
01163                         <a class="code" href="../../d5/d9/ntrtlp_8h.html#a49">RtlpLogLastExceptionDisposition</a>(Index, Disposition);
01164                     }
01165 
01166                     ExceptionFlags |=
01167                         (ExceptionRecord-&gt;ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>);
01168 
01169                     ExceptionFlags &amp;= ~<a class="code" href="../../d6/d7/halmips_8h.html#a31">EXCEPTION_COLLIDED_UNWIND</a>;
01170 
01171                     <span class="comment">//</span>
01172                     <span class="comment">// If the current scan is within a nested context and the</span>
01173                     <span class="comment">// frame just examined is the end of the nested region,</span>
01174                     <span class="comment">// then clear the nested context frame and the nested</span>
01175                     <span class="comment">// exception flag in the exception flags.</span>
01176                     <span class="comment">//</span>
01177 
01178                     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(NestedFrame, EstablisherFrame)) {
01179                         ExceptionFlags &amp;= (~<a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>);
01180                         <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a4">INITIALIZE_FRAME</a>(NestedFrame);
01181                     }
01182 
01183                     <span class="comment">//</span>
01184                     <span class="comment">// Case on the handler disposition.</span>
01185                     <span class="comment">//</span>
01186 
01187                     <span class="keywordflow">switch</span> (Disposition) {
01188 
01189                     <span class="comment">//</span>
01190                     <span class="comment">// The disposition is to continue execution.</span>
01191                     <span class="comment">//</span>
01192                     <span class="comment">// If the exception is not continuable, then raise the</span>
01193                     <span class="comment">// exception STATUS_NONCONTINUABLE_EXCEPTION.  Otherwise,</span>
01194                     <span class="comment">// return exception handled.</span>
01195                     <span class="comment">//</span>
01196 
01197                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a36">ExceptionContinueExecution</a>:
01198                         <span class="keywordflow">if</span> ((ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>) != 0) {
01199                             <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a0">RAISE_EXCEPTION</a>(STATUS_NONCONTINUABLE_EXCEPTION, 
01200                                             ExceptionRecord);
01201                         } <span class="keywordflow">else</span> {
01202                             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01203                         }
01204 
01205                     <span class="comment">//</span>
01206                     <span class="comment">// The disposition is to continue the search.</span>
01207                     <span class="comment">//</span>
01208                     <span class="comment">// Get the next frame address and continue the search.</span>
01209                     <span class="comment">//</span>
01210 
01211                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a>:
01212                         <span class="keywordflow">break</span>;
01213 
01214                     <span class="comment">//</span>
01215                     <span class="comment">// The disposition is nested exception.</span>
01216                     <span class="comment">//</span>
01217                     <span class="comment">// Set the nested context frame to the establisher frame</span>
01218                     <span class="comment">// address and set the nested exception flag in the</span>
01219                     <span class="comment">// exception flags.</span>
01220                     <span class="comment">//</span>
01221         
01222                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a38">ExceptionNestedException</a>:
01223                         ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>;
01224                         <span class="keywordflow">if</span> (DispatcherContext.EstablisherFrame.MemoryStackFp &gt; NestedFrame.MemoryStackFp) {
01225                             NestedFrame = DispatcherContext.EstablisherFrame;
01226                         }
01227                         <span class="keywordflow">break</span>;
01228 
01229                     <span class="comment">//</span>
01230                     <span class="comment">// The disposition is hitting a frame processed by a</span>
01231                     <span class="comment">// previous unwind.</span>
01232                     <span class="comment">//</span>
01233                     <span class="comment">// Set the target of the current dispatch to the context</span>
01234                     <span class="comment">// record of the previous unwind</span>
01235                     <span class="comment">//</span>
01236 
01237                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a39">ExceptionCollidedUnwind</a>:
01238                         ControlPc = DispatcherContext.ControlPc;
01239                         NextPc = ControlPc;
01240                         EstablisherFrame = DispatcherContext.EstablisherFrame;
01241                         FunctionEntry = DispatcherContext.FunctionEntry;
01242                         ImageBase = DispatcherContext.ImageBase;
01243                         RtlMoveMemory(&amp;ContextRecordEm, 
01244                                       DispatcherContext.ContextRecord,
01245                                       <span class="keyword">sizeof</span>(CONTEXT));
01246                         ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a31">EXCEPTION_COLLIDED_UNWIND</a>;
01247                         TargetGp = (ULONG_PTR)(<a class="code" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a>(
01248                                                    (PVOID)ImageBase,
01249                                                    TRUE,
01250                                                    IMAGE_DIRECTORY_ENTRY_GLOBALPTR,
01251                                                    &amp;Size
01252                                                    ));
01253                         <span class="keywordflow">break</span>;
01254 
01255                     <span class="comment">//</span>
01256                     <span class="comment">// All other disposition values are invalid.</span>
01257                     <span class="comment">//</span>
01258                     <span class="comment">// Raise invalid disposition exception.</span>
01259                     <span class="comment">//</span>
01260 
01261                     <span class="keywordflow">default</span>:
01262                         <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a0">RAISE_EXCEPTION</a>(STATUS_INVALID_DISPOSITION, ExceptionRecord);
01263                         <span class="keywordflow">break</span>;
01264                     }
01265 
01266                 } <span class="keywordflow">while</span> ((ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a31">EXCEPTION_COLLIDED_UNWIND</a>) != 0);
01267 
01268             }
01269 
01270         } <span class="keywordflow">else</span> {
01271 
01272             <span class="comment">//</span>
01273             <span class="comment">// No function table entry is found.</span>
01274             <span class="comment">//</span>
01275 
01276             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> BsFrameSize, TempFrameSize;
01277 
01278             NextPc = RtlIa64InsertIPSlotNumber((ContextRecordEm.BrRp-16), 2);
01279             ContextRecordEm.StIFS = ContextRecordEm.RsPFS;
01280             BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ContextRecordEm.StIFS &gt;&gt; PFS_SIZE_SHIFT) &amp; PFS_SIZE_MASK;
01281             TempFrameSize = BsFrameSize - (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((ContextRecordEm.RsBSP &gt;&gt; 3) &amp; NAT_BITS_PER_RNAT_REG);
01282             <span class="keywordflow">while</span> (TempFrameSize &gt; 0) {
01283                 BsFrameSize++;
01284                 TempFrameSize -= NAT_BITS_PER_RNAT_REG;
01285             }
01286             ContextRecordEm.RsBSP -= BsFrameSize * <span class="keyword">sizeof</span>(ULONGLONG);
01287             ContextRecordEm.RsBSPSTORE = ContextRecordEm.RsBSP;
01288 
01289             <span class="keywordflow">if</span> (NextPc == ControlPc) {
01290                 <span class="keywordflow">break</span>;
01291             }
01292         }
01293 
01294         <span class="comment">//</span>
01295         <span class="comment">// Set the point at which control left the previous routine.</span>
01296         <span class="comment">//</span>
01297 
01298         ControlPc = NextPc;
01299 
01300     } <span class="keywordflow">while</span> ( (ContextRecordEm.IntSp &lt; HighStackLimit) ||
01301               (ContextRecordEm.RsBSP &gt; LowBStoreLimit) );
01302 
01303     <span class="comment">//</span>
01304     <span class="comment">// Could not handle the exception.</span>
01305     <span class="comment">//</span>
01306     <span class="comment">// Set final exception flags and return exception not handled.</span>
01307     <span class="comment">//</span>
01308 
01309     ExceptionRecord-&gt;ExceptionFlags = ExceptionFlags;
01310     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01311 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="ia64/exdsptch.c::RtlGetFunctionTableListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PLIST_ENTRY RtlGetFunctionTableListHead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l01402">1402</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00137">DynamicFunctionTable</a>.
<p>
<pre class="fragment"><div>01408                    :
01409 
01410     Return <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dynamic function table list head.
01411 
01412 Return value:
01413 
01414     Address of dynamic function table list head.
01415 
01416 --*/
01417 {
01418     <span class="keywordflow">return</span> &amp;<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a7">DynamicFunctionTable</a>;
01419 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ia64/exdsptch.c::RtlLookupDynamicFunctionEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PRUNTIME_FUNCTION RtlLookupDynamicFunctionEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ControlPc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ImageBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetGp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l01583">1583</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00137">DynamicFunctionTable</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00142">LoaderLock</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l02364">RtlLookupDirectFunctionEntry()</a>, and <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00184">RtlLookupFunctionEntry()</a>.
<p>
<pre class="fragment"><div>01591                    :
01592 
01593   This function searches through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dynamic function entry
01594   tables and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function entry address that corresponds
01595   to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ControlPc. This routine does NOT perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01596   secondary function entry indirection. That <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed
01597   by <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>().
01598 
01599   Argument:
01600 
01601      ControlPc           Supplies a ControlPc.
01602      ImageBase           OUT Base address <span class="keywordflow">for</span> dynamic code
01603 
01604   Return Value
01605 
01606      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - No function entry found that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ControlPc.
01607 
01608      NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function entry that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01609                 code containing ControlPC.
01610 
01611 --*/
01612 
01613 {
01614     PDYNAMIC_FUNCTION_TABLE CurrentEntry;
01615     PLIST_ENTRY Next,Head;
01616     PRUNTIME_FUNCTION FunctionTable;
01617     PRUNTIME_FUNCTION FunctionEntry;
01618     LONG High;
01619     LONG Low;
01620     LONG Middle;
01621     SIZE_T BaseAddress;
01622 
01623 
01624     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a7">DynamicFunctionTable</a>.Flink == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || ImageBase == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01625         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01626 
01627 
01628         <span class="comment">//</span>
01629         <span class="comment">//  Search the tree starting from the head, continue until the entry</span>
01630         <span class="comment">//  is found or we reach the end of the list.</span>
01631         <span class="comment">//</span>
01632     <span class="keywordflow">if</span> (RtlTryEnterCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock) ) {
01633 
01634         Head = &amp;<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a7">DynamicFunctionTable</a>;
01635         <span class="keywordflow">for</span> (Next = Head-&gt;Blink; Next != Head; Next = Next-&gt;Blink) {
01636             CurrentEntry = CONTAINING_RECORD(Next,DYNAMIC_FUNCTION_TABLE,Links);
01637             FunctionTable = CurrentEntry-&gt;FunctionTable;
01638 
01639             <span class="comment">//</span>
01640             <span class="comment">// Check if the ControlPC is within the range of this function table</span>
01641             <span class="comment">//</span>
01642 
01643             <span class="keywordflow">if</span> ((ControlPc &gt;= CurrentEntry-&gt;MinimumAddress) &amp;&amp;
01644                 (ControlPc &lt;  CurrentEntry-&gt;MaximumAddress) ) {
01645 
01646 
01647                 <span class="comment">// If this function table is sorted do a binary search.</span>
01648 
01649                 BaseAddress = CurrentEntry-&gt;BaseAddress;
01650                 <span class="keywordflow">if</span> (CurrentEntry-&gt;Sorted) {
01651 
01652                     <span class="comment">//</span>
01653                     <span class="comment">// Perform binary search on the function table for a function table</span>
01654                     <span class="comment">// entry that subsumes the specified PC.</span>
01655                     <span class="comment">//</span>
01656 
01657                     Low = 0;
01658                     High = CurrentEntry-&gt;EntryCount -1 ;
01659                     
01660                     <span class="keywordflow">while</span> (High &gt;= Low) {
01661 
01662                         <span class="comment">//</span>
01663                         <span class="comment">// Compute next probe index and test entry. If the specified PC</span>
01664                         <span class="comment">// is greater than of equal to the beginning address and less</span>
01665                         <span class="comment">// than the ending address of the function table entry, then</span>
01666                         <span class="comment">// return the address of the function table entry. Otherwise,</span>
01667                         <span class="comment">// continue the search.</span>
01668                         <span class="comment">//</span>
01669 
01670 
01671                         Middle = (Low + High) &gt;&gt; 1;
01672                         FunctionEntry = &amp;FunctionTable[Middle];
01673 
01674                         <span class="keywordflow">if</span> (ControlPc &lt; RF_BEGIN_ADDRESS( BaseAddress, FunctionEntry)) {
01675                             High = Middle - 1;
01676 
01677                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ControlPc &gt;= RF_END_ADDRESS( BaseAddress, FunctionEntry)) {
01678                             Low = Middle + 1;
01679 
01680                         } <span class="keywordflow">else</span> {
01681 
01682                             *ImageBase = CurrentEntry-&gt;BaseAddress;
01683 
01684                             <span class="keywordflow">if</span> ( TargetGp != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
01685                                 *TargetGp  = CurrentEntry-&gt;TargetGp;
01686 
01687                             RtlLeaveCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01688                             <span class="keywordflow">return</span> FunctionEntry;
01689                         }
01690                     }
01691 
01692                 } <span class="keywordflow">else</span> {    <span class="comment">// Not sorted. Do linear search.</span>
01693 
01694                     PRUNTIME_FUNCTION LastFunctionEntry = &amp;FunctionTable[CurrentEntry-&gt;EntryCount];
01695 
01696 
01697                     <span class="keywordflow">for</span> (FunctionEntry = FunctionTable; FunctionEntry &lt; LastFunctionEntry; FunctionEntry++) {
01698 
01699                         <span class="keywordflow">if</span> ((ControlPc &gt;= RF_BEGIN_ADDRESS( BaseAddress, FunctionEntry)) &amp;&amp;
01700                             (ControlPc &lt;  RF_END_ADDRESS( BaseAddress, FunctionEntry))) {
01701 
01702                             
01703                             *ImageBase = CurrentEntry-&gt;BaseAddress;
01704 
01705                             <span class="keywordflow">if</span> ( TargetGp != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
01706                                 *TargetGp  = CurrentEntry-&gt;TargetGp;
01707 
01708                             RtlLeaveCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01709                             <span class="keywordflow">return</span> FunctionEntry;
01710                         }
01711                     }
01712                 } <span class="comment">// binary/linear search</span>
01713             } <span class="comment">// if in range</span>
01714         } <span class="comment">// for (... Next != Head ...)</span>
01715         RtlLeaveCriticalSection((PRTL_CRITICAL_SECTION)NtCurrentPeb()-&gt;LoaderLock);
01716     } <span class="comment">// LoaderLock</span>
01717 
01718     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01719 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ia64/exdsptch.c::RtlLookupFunctionEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PRUNTIME_FUNCTION RtlLookupFunctionEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ControlPc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ImageBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetGp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00184">184</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l01583">RtlLookupDynamicFunctionEntry()</a>, <a class="el" href="../../d7/d3/pctohdr_8c-source.html#l00042">RtlPcToFileHeader()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00192                    :
00193 
00194     This function searches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> currently active function tables <span class="keywordflow">for</span> an
00195     entry that corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified PC value.
00196 
00197 Arguments:
00198 
00199     ControlPc - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address of an instruction bundle
00200         within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified function.
00201 
00202     ImageBase - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> module to which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00203                 function belongs.
00204 
00205     TargetGp - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global pointer value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> module.
00206 
00207 Return Value:
00208 
00209     If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no entry in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function table <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified PC, then
00210     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.  Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function table entry
00211     that corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified PC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00212 
00213 --*/
00214 
00215 {
00216     PRUNTIME_FUNCTION FunctionEntry;
00217     PRUNTIME_FUNCTION FunctionTable;
00218     ULONG SizeOfExceptionTable;
00219     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00220     LONG High;
00221     LONG Middle;
00222     LONG Low;
00223     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> i;
00224 
00225     <span class="comment">//</span>
00226     <span class="comment">// Search for the image that includes the specified swizzled PC value.</span>
00227     <span class="comment">//</span>
00228 
00229     *ImageBase = (ULONG_PTR)<a class="code" href="../../d6/d4/pctohdr_8c.html#a1">RtlPcToFileHeader</a>((PVOID)ControlPc, 
00230                                               (PVOID *)ImageBase);
00231     
00232 
00233     <span class="comment">//</span>
00234     <span class="comment">// If an image is found that includes the specified PC, then locate the</span>
00235     <span class="comment">// function table for the image.</span>
00236     <span class="comment">//</span>
00237 
00238     <span class="keywordflow">if</span> ((PVOID)*ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00239 
00240         *TargetGp = (ULONG_PTR)(<a class="code" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a>(
00241                                (PVOID)*ImageBase,
00242                                TRUE,
00243                                IMAGE_DIRECTORY_ENTRY_GLOBALPTR,
00244                                &amp;Size
00245                                ));
00246 
00247         FunctionTable = (PRUNTIME_FUNCTION)<a class="code" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a>(
00248                          (PVOID)*ImageBase, 
00249                          TRUE, 
00250                          IMAGE_DIRECTORY_ENTRY_EXCEPTION,
00251                          &amp;SizeOfExceptionTable);
00252 
00253         <span class="comment">//</span>
00254         <span class="comment">// If a function table is located, then search the table for a</span>
00255         <span class="comment">// function table entry for the specified PC.</span>
00256         <span class="comment">//</span>
00257 
00258         <span class="keywordflow">if</span> (FunctionTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00259 
00260             <span class="comment">//</span>
00261             <span class="comment">// Initialize search indices.</span>
00262             <span class="comment">//</span>
00263 
00264             Low = 0;
00265             High = (SizeOfExceptionTable / <span class="keyword">sizeof</span>(RUNTIME_FUNCTION)) - 1;
00266             ControlPc = ControlPc - *ImageBase;
00267 
00268             <span class="comment">//</span>
00269             <span class="comment">// Perform binary search on the function table for a function table</span>
00270             <span class="comment">// entry that subsumes the specified PC.</span>
00271             <span class="comment">//</span>
00272 
00273             <span class="keywordflow">while</span> (High &gt;= Low) {
00274 
00275                 <span class="comment">//</span>
00276                 <span class="comment">// Compute next probe index and test entry. If the specified PC</span>
00277                 <span class="comment">// is greater than of equal to the beginning address and less</span>
00278                 <span class="comment">// than the ending address of the function table entry, then</span>
00279                 <span class="comment">// return the address of the function table entry. Otherwise,</span>
00280                 <span class="comment">// continue the search.</span>
00281                 <span class="comment">//</span>
00282 
00283                 Middle = (Low + High) &gt;&gt; 1;
00284                 FunctionEntry = &amp;FunctionTable[Middle];
00285 
00286                 <span class="keywordflow">if</span> (ControlPc &lt; FunctionEntry-&gt;BeginAddress) {
00287                     High = Middle - 1;
00288 
00289                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ControlPc &gt;= FunctionEntry-&gt;EndAddress) {
00290                     Low = Middle + 1;
00291 
00292                 } <span class="keywordflow">else</span> {
00293                     <span class="keywordflow">return</span> FunctionEntry;
00294 
00295                 }
00296             }
00297         }
00298     } 
00299 <span class="preprocessor">#if !defined(NTOS_KERNEL_RUNTIME)</span>
00300 <span class="preprocessor"></span>    
00301     <span class="keywordflow">else</span>     <span class="comment">// ImageBase == NULL</span>
00302         <span class="keywordflow">return</span>   <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a10">RtlLookupDynamicFunctionEntry</a> ( ControlPc, ImageBase, TargetGp );
00303 
00304 <span class="preprocessor">#endif  // NTOS_KERNEL_RUNTIME</span>
00305 <span class="preprocessor"></span>
00306     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00307 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ia64/exdsptch.c::RtlLookupStaticFunctionEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PRUNTIME_FUNCTION RtlLookupStaticFunctionEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ControlPc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>InImage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l02364">RtlLookupDirectFunctionEntry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ia64/exdsptch.c::RtlpGetRegistrationHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PEXCEPTION_REGISTRATION_RECORD RtlpGetRegistrationHead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VOID</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00128">128</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
<pre class="fragment"><div>00134                    :
00135 
00136     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first exception registration
00137     record <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
00138 
00139 Arguments:
00140 
00141     None.
00142 
00143 Return Value:
00144 
00145     The address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first registration record.
00146 
00147 --*/
00148 
00149 {
00150     PTEB CurrentTeb = NtCurrentTeb();
00151 
00152     <span class="keywordflow">return</span> (CurrentTeb ? CurrentTeb-&gt;NtTib.ExceptionList : EXCEPTION_CHAIN_END);
00153 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ia64/exdsptch.c::RtlpRaiseException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlpRaiseException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExceptionRecord</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00311">311</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00348">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00563">RtlRaiseStatus()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00603">RtlRaiseException()</a>.
<p>
<pre class="fragment"><div>00317                    :
00318 
00319     This function raises a software exception by building a context record
00320     and calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> raise exception system service.
00321 
00322 Arguments:
00323 
00324     ExceptionRecord - Supplies a pointer to an exception record.
00325 
00326 Return Value:
00327 
00328     None.
00329 
00330 --*/
00331 
00332 {
00333     ULONGLONG ImageBase;
00334     ULONGLONG TargetGp;
00335     ULONGLONG ControlPc;
00336     CONTEXT ContextRecord;
00337     FRAME_POINTERS EstablisherFrame;
00338     PRUNTIME_FUNCTION FunctionEntry;
00339     BOOLEAN InFunction;
00340     ULONGLONG NextPc;
00341     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">// Capture the current context, virtually unwind to the caller of this</span>
00345     <span class="comment">// routine, set the fault instruction address to that of the caller, and</span>
00346     <span class="comment">// call the raise exception system service.</span>
00347     <span class="comment">//</span>
00348 
00349     RtlCaptureContext(&amp;ContextRecord);
00350     ControlPc = RtlIa64InsertIPSlotNumber((ContextRecord.BrRp-16), 2);
00351     FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc, &amp;ImageBase, &amp;TargetGp);
00352     NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
00353                               ControlPc,
00354                               FunctionEntry,
00355                               &amp;ContextRecord,
00356                               &amp;InFunction,
00357                               &amp;EstablisherFrame,
00358                               NULL);
00359 
00360     ContextRecord.StIIP = NextPc + 8;
00361     ContextRecord.StIPSR &amp;= ~((ULONGLONG) 3 &lt;&lt; PSR_RI);
00362     ExceptionRecord-&gt;ExceptionAddress = (PVOID)ContextRecord.StIIP;
00363     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwRaiseException(ExceptionRecord, &amp;ContextRecord, TRUE);
00364 
00365     <span class="comment">//</span>
00366     <span class="comment">// There should never be a return from this system service unless</span>
00367     <span class="comment">// there is a problem with the argument list itself. Raise another</span>
00368     <span class="comment">// exception specifying the status value returned.</span>
00369     <span class="comment">//</span>
00370 
00371     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(Status);
00372     <span class="keywordflow">return</span>;
00373 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ia64/exdsptch.c::RtlpRaiseStatus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlpRaiseStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Status</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00409">409</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00047">EXCEPTION_NONCONTINUABLE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00348">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00563">RtlRaiseStatus()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00705">RtlRaiseStatus()</a>.
<p>
<pre class="fragment"><div>00415                    :
00416 
00417     This function raises an exception with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified status value. The
00418     exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> marked as noncontinuable with no parameters.
00419 
00420 Arguments:
00421 
00422     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status value to be used as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception code
00423         <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be raised.
00424 
00425 Return Value:
00426 
00427     None.
00428 
00429 --*/
00430 
00431 {
00432     ULONGLONG ImageBase;
00433     ULONGLONG TargetGp;
00434     ULONGLONG ControlPc;
00435     ULONGLONG NextPc;
00436     CONTEXT ContextRecord;
00437     FRAME_POINTERS EstablisherFrame;
00438     EXCEPTION_RECORD ExceptionRecord;
00439     PRUNTIME_FUNCTION FunctionEntry;
00440     BOOLEAN InFunction;
00441 
00442     <span class="comment">//</span>
00443     <span class="comment">// Construct an exception record.</span>
00444     <span class="comment">//</span>
00445 
00446     ExceptionRecord.ExceptionCode = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00447     ExceptionRecord.ExceptionRecord = (PEXCEPTION_RECORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00448     ExceptionRecord.NumberParameters = 0;
00449     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00450 
00451     <span class="comment">//</span>
00452     <span class="comment">// Capture the current context, virtually unwind to the caller of this</span>
00453     <span class="comment">// routine, set the fault instruction address to that of the caller, and</span>
00454     <span class="comment">// call the raise exception system service.</span>
00455     <span class="comment">//</span>
00456 
00457     RtlCaptureContext(&amp;ContextRecord);
00458     ControlPc = RtlIa64InsertIPSlotNumber((ContextRecord.BrRp-16), 2);
00459     FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc, &amp;ImageBase, &amp;TargetGp);
00460     NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
00461                               ControlPc,
00462                               FunctionEntry,
00463                               &amp;ContextRecord,
00464                               &amp;InFunction,
00465                               &amp;EstablisherFrame,
00466                               NULL);
00467     ContextRecord.StIIP = NextPc + 8;
00468     ContextRecord.StIPSR &amp;= ~((ULONGLONG) 3 &lt;&lt; PSR_RI);
00469     ExceptionRecord.ExceptionAddress = (PVOID)ContextRecord.StIIP;
00470     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwRaiseException(&amp;ExceptionRecord, &amp;ContextRecord, TRUE);
00471 
00472     <span class="comment">//</span>
00473     <span class="comment">// There should never be a return from this system service unless</span>
00474     <span class="comment">// there is a problem with the argument list itself. Raise another</span>
00475     <span class="comment">// exception specifying the status value returned.</span>
00476     <span class="comment">//</span>
00477 
00478     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(Status);
00479     <span class="keywordflow">return</span>;
00480 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ia64/exdsptch.c::RtlpUnlinkHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlpUnlinkHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PEXCEPTION_REGISTRATION_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>UnlinkPointer</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00157">157</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d8/i386_2exdsptch_8c-source.html#l00303">RtlUnwind()</a>.
<p>
<pre class="fragment"><div>00163                    :
00164 
00165     This function removes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified exception registration record
00166     (and thus <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> relevant handler) from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception traversal chain.
00167 
00168 Arguments:
00169 
00170     UnlinkPointer - Address of registration record to unlink.
00171 
00172 Return Value:
00173 
00174     None.
00175 
00176 --*/
00177 
00178 {
00179     NtCurrentTeb()-&gt;NtTib.ExceptionList = UnlinkPointer-&gt;Next;
00180 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ia64/exdsptch.c::RtlpVirtualUnwind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONGLONG RtlpVirtualUnwind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ImageBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ControlPc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PRUNTIME_FUNCTION&nbsp;</td>
          <td class="mdname" nowrap> <em>FunctionEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>InFunction</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PFRAME_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>EstablisherFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PKNONVOLATILE_CONTEXT_POINTERS ContextPointers&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l01315">1315</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>.
<p>
<pre class="fragment"><div>01327                    :
01328 
01329     This function virtually unwinds <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specfified function by executing its
01330     prologue code backwards.
01331 
01332     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a leaf function, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left
01333     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> obtained from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function
01334     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a nested function, but not an exception or interrupt frame, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01335     prologue code <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed backwards and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left
01336     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> obtained from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> updated context record.
01337 
01338     Otherwise, an exception or interrupt entry to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being unwound
01339     and a specially coded prologue restores <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">return</span> address twice. Once
01340     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fault instruction address and once from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> saved <span class="keywordflow">return</span> address
01341     <span class="keyword">register</span>. The first restore <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01342     second restore <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> place in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> updated context record.
01343 
01344     If a context pointers record <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address where each
01345     nonvolatile registers <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> restored from <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> recorded in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate
01346     element of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context pointers record.
01347 
01348     N.B. This function copies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context record and <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> computes
01349          <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> establisher frame and whether <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> actually in a function.
01350 
01351 Arguments:
01352 
01353     ImageBase - Base address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> module to which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function belongs.
01354 
01355     ControlPc - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
01356         function.
01357 
01358     FunctionEntry - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function table entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01359         specified function.
01360 
01361     ContextRecord - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context record.
01362 
01363     InFunction - Supplies a pointer to a variable that receives whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01364         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> PC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current function.
01365 
01366     EstablisherFrame - Supplies a pointer to a variable that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01367         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> establisher frame pointer value.
01368 
01369     ContextPointers - Supplies an optional pointer to a context pointers
01370         record.
01371 
01372 Return Value:
01373 
01374     The address where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01375     function value.
01376 
01377 --*/
01378 
01379 {
01380 
01381     CONTEXT LocalContext;
01382 
01383     <span class="comment">//</span>
01384     <span class="comment">// Copy the context record so updates will not be reflected in the</span>
01385     <span class="comment">// original copy and then virtually unwind to the caller of the</span>
01386     <span class="comment">// specified control point.</span>
01387     <span class="comment">//</span>
01388 
01389     RtlCopyMemory((PVOID)&amp;LocalContext, ContextRecord, <span class="keyword">sizeof</span>(CONTEXT));
01390     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
01391                             ControlPc,
01392                             FunctionEntry,
01393                             &amp;LocalContext,
01394                             InFunction,
01395                             EstablisherFrame,
01396                             ContextPointers);
01397 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ia64/exdsptch.c::RtlRaiseException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlRaiseException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExceptionRecord</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00377">377</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00311">RtlpRaiseException()</a>.
<p>
<pre class="fragment"><div>00383                    :
00384 
00385     This function raises a software exception by building a context record
00386     and calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> raise exception system service.
00387 
00388     N.B. This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a shell routine that simply calls another routine
00389          to <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> real work. The <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to avoid a problem
00390          in <span class="keywordflow">try</span>/finally scopes where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last statement in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scope <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a
00391          call to raise an exception.
00392 
00393 Arguments:
00394 
00395     ExceptionRecord - Supplies a pointer to an exception record.
00396 
00397 Return Value:
00398 
00399     None.
00400 
00401 --*/
00402 
00403 {
00404     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a4">RtlpRaiseException</a>(ExceptionRecord);
00405     <span class="keywordflow">return</span>;
00406 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ia64/exdsptch.c::RtlRaiseStatus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlRaiseStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Status</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00484">484</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00409">RtlpRaiseStatus()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00490                    :
00491 
00492     This function raises an exception with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified status value. The
00493     exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> marked as noncontinuable with no parameters.
00494 
00495     N.B. This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a shell routine that simply calls another routine
00496          to <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> real work. The <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to avoid a problem
00497          in <span class="keywordflow">try</span>/finally scopes where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last statement in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scope <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a
00498          call to raise an exception.
00499 
00500 Arguments:
00501 
00502     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status value to be used as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception code
00503         <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be raised.
00504 
00505 Return Value:
00506 
00507     None.
00508 
00509 --*/
00510 
00511 {
00512     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a5">RtlpRaiseStatus</a>(Status);
00513     <span class="keywordflow">return</span>;
00514 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ia64/exdsptch.c::RtlRestoreContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlRestoreContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD ExceptionRecord&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">RtlUnwind2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ia64/exdsptch.c::RtlUnwind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlUnwind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID TargetFrame&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID TargetIp&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD ExceptionRecord&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00518">518</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00108">IS_EM_SETJMP_REGISTRATION</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00737">RtlUnwind2()</a>.
<p>
<pre class="fragment"><div>00527                    :
00528 
00529     This function initiates an unwind of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> call frames. The machine
00530     state at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to unwind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> captured in a context record
00531     and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwinding flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception flags of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00532     record. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TargetFrame parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> unwind
00533     flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception flags of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception record. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> backward
00534     scan through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> call frames <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> then performed to find <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00535     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind operation.
00536 
00537     As each frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> encounter, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PC where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> corresponding
00538     function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> determined and used to lookup exception handler information
00539     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> runtime function table built by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> linker. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> respective
00540     routine has an exception handler, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00541 
00542     N.B. This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided <span class="keywordflow">for</span> backward compatibility with release 1.
00543 
00544 Arguments:
00545 
00546     TargetFrame - Supplies an optional pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call frame that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00547         target of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind. If <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then an <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>
00548         unwind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed.
00549 
00550     TargetIp - Supplies an optional instruction address that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00551         continuation address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind. This address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00552         target frame parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified.
00553 
00554     ExceptionRecord - Supplies an optional pointer to an exception record.
00555 
00556     ReturnValue - Supplies a value that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> integer
00557         function <span class="keywordflow">return</span> <span class="keyword">register</span> just before continuing execution.
00558 
00559 Return Value:
00560 
00561     None.
00562 
00563 --*/
00564 
00565 {
00566     CONTEXT ContextRecord;
00567     FRAME_POINTERS Frame;
00568     PEXCEPTION_REGISTRATION_RECORD RegistrationPointer;
00569 
00570     Frame.MemoryStackFp = (ULONG_PTR)TargetFrame;
00571     Frame.BackingStoreFp = 0;
00572     ContextRecord.StIPSR = 0;
00573 
00574     RegistrationPointer = (PEXCEPTION_REGISTRATION_RECORD)TargetFrame;
00575     <span class="keywordflow">if</span> ((RegistrationPointer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00576         <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a7">IS_EM_SETJMP_REGISTRATION</a>(RegistrationPointer)) {
00577 
00578         <span class="comment">//</span>
00579         <span class="comment">// iA longjmp to an EM setjmp site, materialize the TargetFrame.</span>
00580         <span class="comment">// resume execution in EM mode.</span>
00581         <span class="comment">//</span>
00582 
00583         PULONGLONG Record = (PULONGLONG)(RegistrationPointer);
00584 
00585         Frame.MemoryStackFp = Record[1];
00586         Frame.BackingStoreFp = Record[2];
00587     }
00588 
00589     <span class="comment">//</span>
00590     <span class="comment">// Call real unwind routine specifying a context record as an</span>
00591     <span class="comment">// extra argument.</span>
00592     <span class="comment">//</span>
00593 
00594     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a12">RtlUnwind2</a>(Frame,
00595                TargetIp,
00596                ExceptionRecord,
00597                ReturnValue,
00598                &amp;ContextRecord);
00599 
00600     <span class="keywordflow">return</span>;
00601 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ia64/exdsptch.c::RtlUnwind2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlUnwind2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN FRAME_POINTERS TargetFrame&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID TargetIp&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD ExceptionRecord&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">605</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.
<p>
References <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00101">CHECK_BSTORE_FRAME</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00094">CHECK_MSTACK_FRAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00053">EXCEPTION_COLLIDED_UNWIND</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00049">EXCEPTION_EXIT_UNWIND</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00052">EXCEPTION_TARGET_UNWIND</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00048">EXCEPTION_UNWINDING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00062">ExceptionCollidedUnwind</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00060">ExceptionContinueSearch</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00071">HANDLER</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00079">IS_HANDLER_DEFINED</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00087">IS_SAME_FRAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00065">RAISE_EXCEPTION</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00348">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d9/d9/rtl_2ia64_2miscc_8c-source.html#l00075">Rtlp64GetBStoreLimits()</a>, <a class="el" href="../../d9/d9/rtl_2ia64_2miscc_8c-source.html#l00178">Rtlp64GetStackLimits()</a>, <a class="el" href="../../d3/d9/ntrtli64_8h.html#a5">RtlpExecuteEmHandlerForUnwind()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l01102">RtlpVirtualUnwind()</a>, <a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a11">RtlRestoreContext()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
<pre class="fragment"><div>00615                    :
00616 
00617     This function initiates an unwind of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> call frames. The machine
00618     state at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to unwind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> captured in a context record
00619     and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwinding flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception flags of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00620     record. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TargetFrame parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> unwind
00621     flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception flags of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception record. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> backward
00622     scan through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> call frames <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> then performed to find <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00623     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind operation.
00624 
00625     As each frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> encounter, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PC where <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> left <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> corresponding
00626     function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> determined and used to lookup exception handler information
00627     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> runtime function table built by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> linker. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> respective
00628     routine has an exception handler, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00629 
00630 Arguments:
00631 
00632     TargetFrame - Supplies an optional pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call frame that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00633         target of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind. If <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then an <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>
00634         unwind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed.
00635 
00636     TargetIp - Supplies an optional instruction address that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00637         continuation address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind. This address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00638         target frame parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified.
00639 
00640     ExceptionRecord - Supplies an optional pointer to an exception record.
00641 
00642     ReturnValue - Supplies a value that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> integer
00643         function <span class="keywordflow">return</span> <span class="keyword">register</span> just before continuing execution.
00644 
00645     ContextRecord - Supplies a pointer to a context record that can be used
00646         to store context druing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unwind operation.
00647 
00648 Return Value:
00649 
00650     None.
00651 
00652 --*/
00653 
00654 {
00655     ULONGLONG TargetGp;
00656     ULONGLONG ImageBase;
00657     ULONGLONG ControlPc;
00658     ULONGLONG NextPc;
00659     ULONG ExceptionFlags;
00660     <a class="code" href="../../d0/d6/struct__DISPATCHER__CONTEXT.html">DISPATCHER_CONTEXT</a> DispatcherContext;
00661     EXCEPTION_DISPOSITION Disposition;
00662     FRAME_POINTERS EstablisherFrame;
00663     EXCEPTION_RECORD ExceptionRecord1;
00664     PRUNTIME_FUNCTION FunctionEntry;
00665     ULONGLONG HighStackLimit;
00666     ULONGLONG LowStackLimit;
00667     ULONGLONG HighBStoreLimit;
00668     ULONGLONG LowBStoreLimit;
00669     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00670     BOOLEAN InFunction;
00671 
00672     <span class="comment">//</span>
00673     <span class="comment">// Get current memory stack and backing store limits, capture the </span>
00674     <span class="comment">// current context, virtually unwind to the caller of this routine, </span>
00675     <span class="comment">// get the initial PC value, and set the unwind target address.</span>
00676     <span class="comment">//</span>
00677     <span class="comment">// N.B. The target gp value is found in the input context record.</span>
00678     <span class="comment">//      The unwinder guarantees that it will not be destroyed</span>
00679     <span class="comment">//      as it is just a scratch register.</span>
00680     <span class="comment">//</span>
00681 
00682     RtlCaptureContext(ContextRecord);
00683 
00684     <span class="comment">//</span>
00685     <span class="comment">// Before getting the limits from the TEB, must flush the RSE to have</span>
00686     <span class="comment">// the OS to grow the backing store and update the BStoreLimit.</span>
00687     <span class="comment">//</span>
00688 
00689     <a class="code" href="../../d3/d9/ntrtli64_8h.html#a0">Rtlp64GetStackLimits</a>(&amp;LowStackLimit, &amp;HighStackLimit);
00690     <a class="code" href="../../d3/d9/ntrtli64_8h.html#a1">Rtlp64GetBStoreLimits</a>(&amp;LowBStoreLimit, &amp;HighBStoreLimit);
00691 
00692     ControlPc = RtlIa64InsertIPSlotNumber((ContextRecord-&gt;BrRp-16), 2);
00693     FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc, &amp;ImageBase, &amp;TargetGp);
00694     NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
00695                               ControlPc,
00696                               FunctionEntry,
00697                               ContextRecord,
00698                               &amp;InFunction,
00699                               &amp;EstablisherFrame,
00700                               NULL);
00701 
00702     ControlPc = NextPc;
00703     ContextRecord-&gt;StIIP = (ULONGLONG)TargetIp;
00704 
00705 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00706 <span class="preprocessor"></span>    ContextRecord-&gt;StIPSR = SANITIZE_PSR(ContextRecord-&gt;StIPSR, KernelMode);
00707 <span class="preprocessor">#else</span>
00708 <span class="preprocessor"></span>    ContextRecord-&gt;StIPSR = SANITIZE_PSR(ContextRecord-&gt;StIPSR, UserMode);
00709 <span class="preprocessor">#endif // defined(NTOS_KERNEL_RUNTIME)</span>
00710 <span class="preprocessor"></span>
00711     <span class="comment">//</span>
00712     <span class="comment">// If an exception record is not specified, then build a local exception</span>
00713     <span class="comment">// record for use in calling exception handlers during the unwind operation.</span>
00714     <span class="comment">//</span>
00715 
00716     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ExceptionRecord) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00717         ExceptionRecord = &amp;ExceptionRecord1;
00718         ExceptionRecord1.ExceptionCode = STATUS_UNWIND;
00719         ExceptionRecord1.ExceptionRecord = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00720         ExceptionRecord1.ExceptionAddress = (PVOID)ControlPc;
00721         ExceptionRecord1.NumberParameters = 0;
00722     }
00723 
00724     <span class="comment">//</span>
00725     <span class="comment">// If the target frame of the unwind is specified, then a normal unwind</span>
00726     <span class="comment">// is being performed. Otherwise, an exit unwind is being performed.</span>
00727     <span class="comment">//</span>
00728 
00729     ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a26">EXCEPTION_UNWINDING</a>;
00730     <span class="keywordflow">if</span> (TargetFrame.BackingStoreFp == 0 &amp;&amp; TargetFrame.MemoryStackFp == 0) {
00731         ExceptionRecord-&gt;ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a27">EXCEPTION_EXIT_UNWIND</a>;
00732     }
00733 
00734     <span class="comment">//</span>
00735     <span class="comment">// Scan backward through the call frame hierarchy and call exception</span>
00736     <span class="comment">// handlers until the target frame of the unwind is reached.</span>
00737     <span class="comment">//</span>
00738 
00739     <span class="keywordflow">do</span> {
00740 
00741         <span class="comment">//</span>
00742         <span class="comment">// Lookup the function table entry using the point at which control</span>
00743         <span class="comment">// left the procedure.</span>
00744         <span class="comment">//</span>
00745 
00746 
00747         FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc, &amp;ImageBase, &amp;TargetGp);
00748 
00749         <span class="comment">//</span>
00750         <span class="comment">// If there is a function table entry for the routine, then </span>
00751         <span class="comment">// virtually unwind to the caller of the routine to obtain the </span>
00752         <span class="comment">// virtual frame pointer of the establisher, but don't update </span>
00753         <span class="comment">// the context record.</span>
00754         <span class="comment">//</span>
00755 
00756         <span class="keywordflow">if</span> (FunctionEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00757             NextPc = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a6">RtlpVirtualUnwind</a>(ImageBase,
00758                                        ControlPc,
00759                                        FunctionEntry,
00760                                        ContextRecord,
00761                                        &amp;InFunction,
00762                                        &amp;EstablisherFrame,
00763                                        NULL);
00764 
00765         <span class="comment">//</span>
00766         <span class="comment">// If virtual frame is not within the specified limits, unaligned, </span>
00767         <span class="comment">// or the target frame is below the virtual frame and an exit </span>
00768         <span class="comment">// unwind is not being performed, then raise the exception </span>
00769         <span class="comment">// STATUS_BAD_STACK or STATUS_BAD_BSTORE. Otherwise,</span>
00770         <span class="comment">// check to determine if the current routine has an exception</span>
00771         <span class="comment">// handler.</span>
00772         <span class="comment">//</span>
00773 
00774             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a5">CHECK_MSTACK_FRAME</a>(EstablisherFrame, TargetFrame)) {
00775 
00776                 <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a0">RAISE_EXCEPTION</a>(STATUS_BAD_STACK, ExceptionRecord);
00777 
00778             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a6">CHECK_BSTORE_FRAME</a>(EstablisherFrame, TargetFrame)) {
00779 
00780                 <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a0">RAISE_EXCEPTION</a>(STATUS_BAD_STACK, ExceptionRecord);
00781 
00782             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (InFunction &amp;&amp; <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a1">IS_HANDLER_DEFINED</a>(FunctionEntry, ImageBase)) {
00783 
00784                 <span class="comment">//</span>
00785                 <span class="comment">// The frame has an exception handler.</span>
00786                 <span class="comment">//</span>
00787                 <span class="comment">// The handler (i.e. personality routine) has to be called to</span>
00788                 <span class="comment">// execute any termination routines in this frame.</span>
00789                 <span class="comment">//</span>
00790                 <span class="comment">// The control PC, establisher frame pointer, the address</span>
00791                 <span class="comment">// of the function table entry, and the address of the</span>
00792                 <span class="comment">// context record are all stored in the dispatcher context.</span>
00793                 <span class="comment">// This information is used by the unwind linkage routine</span>
00794                 <span class="comment">// and can be used by the exception handler itself.</span>
00795                 <span class="comment">//</span>
00796 
00797                 DispatcherContext.ControlPc = ControlPc;
00798                 DispatcherContext.FunctionEntry = FunctionEntry;
00799                 DispatcherContext.ImageBase = ImageBase;
00800                 DispatcherContext.ContextRecord = ContextRecord;
00801 
00802                 <span class="comment">//</span>
00803                 <span class="comment">// Call the exception handler.</span>
00804                 <span class="comment">//</span>
00805 
00806                 <span class="keywordflow">do</span> {
00807 
00808                     <span class="comment">//</span>
00809                     <span class="comment">// If the establisher frame is the target of the unwind</span>
00810                     <span class="comment">// operation, then set the target unwind flag.</span>
00811                     <span class="comment">//</span>
00812 
00813                     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(TargetFrame, EstablisherFrame)) {
00814                         ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a30">EXCEPTION_TARGET_UNWIND</a>;
00815                     }
00816 
00817                     ExceptionRecord-&gt;ExceptionFlags = ExceptionFlags;
00818 
00819                     <span class="comment">//</span>
00820                     <span class="comment">// Set the specified return value in case the exception</span>
00821                     <span class="comment">// handler directly continues execution.</span>
00822                     <span class="comment">//</span>
00823 
00824                     ContextRecord-&gt;IntV0 = (ULONGLONG)ReturnValue;
00825 
00826                     <span class="comment">//</span>
00827                     <span class="comment">// A linkage routine written in assembler is used to </span>
00828                     <span class="comment">// actually call the actual exception handler. This is </span>
00829                     <span class="comment">// required by the exception handler that is associated </span>
00830                     <span class="comment">// with the linkage routine so it can have access to two </span>
00831                     <span class="comment">// sets of dispatcher context when it is called.</span>
00832                     <span class="comment">//</span>
00833 
00834                     DispatcherContext.EstablisherFrame = EstablisherFrame;
00835                     Disposition = <a class="code" href="../../d3/d9/ntrtli64_8h.html#a5">RtlpExecuteEmHandlerForUnwind</a>(
00836                                       ExceptionRecord,
00837                                       EstablisherFrame.MemoryStackFp,
00838                                       EstablisherFrame.BackingStoreFp,
00839                                       ContextRecord,
00840                                       &amp;DispatcherContext,
00841                                       TargetGp,
00842                                       <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a1">HANDLER</a>(FunctionEntry, ImageBase, TargetGp));
00843 
00844                     <span class="comment">//</span>
00845                     <span class="comment">// Clear target unwind and collided unwind flags.</span>
00846                     <span class="comment">//</span>
00847 
00848                     ExceptionFlags &amp;= ~(<a class="code" href="../../d6/d7/halmips_8h.html#a31">EXCEPTION_COLLIDED_UNWIND</a> |
00849                                                 <a class="code" href="../../d6/d7/halmips_8h.html#a30">EXCEPTION_TARGET_UNWIND</a>);
00850 
00851                     <span class="comment">//</span>
00852                     <span class="comment">// Case on the handler disposition.</span>
00853                     <span class="comment">//</span>
00854 
00855                     <span class="keywordflow">switch</span> (Disposition) {
00856 
00857                     <span class="comment">//</span>
00858                     <span class="comment">// The disposition is to continue the search.</span>
00859                     <span class="comment">//</span>
00860                     <span class="comment">// If the target frame has not been reached, then</span>
00861                     <span class="comment">// virtually unwind to the caller of the current</span>
00862                     <span class="comment">// routine, update the context record, and continue</span>
00863                     <span class="comment">// the search for a handler.</span>
00864                     <span class="comment">//</span>
00865 
00866                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a> :
00867 
00868                         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(EstablisherFrame, TargetFrame)) {
00869                             NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
00870                                                       ControlPc,
00871                                                       FunctionEntry,
00872                                                       ContextRecord,
00873                                                       &amp;InFunction,
00874                                                       &amp;EstablisherFrame,
00875                                                       NULL);
00876                         }
00877                         <span class="keywordflow">break</span>;
00878 
00879                     <span class="comment">//</span>
00880                     <span class="comment">// The disposition is collided unwind.</span>
00881                     <span class="comment">//</span>
00882                     <span class="comment">// Set the target of the current unwind to the context</span>
00883                     <span class="comment">// record of the previous unwind, and reexecute the</span>
00884                     <span class="comment">// exception handler from the collided frame with the</span>
00885                     <span class="comment">// collided unwind flag set in the exception record.</span>
00886                     <span class="comment">//</span>
00887 
00888                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a39">ExceptionCollidedUnwind</a> :
00889 
00890                         ControlPc = DispatcherContext.ControlPc;
00891                         FunctionEntry = DispatcherContext.FunctionEntry;
00892                         ImageBase = DispatcherContext.ImageBase;
00893                         ContextRecord = DispatcherContext.ContextRecord;
00894                         ContextRecord-&gt;StIIP = (ULONGLONG)TargetIp;
00895                         ExceptionFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a31">EXCEPTION_COLLIDED_UNWIND</a>;
00896                         EstablisherFrame = DispatcherContext.EstablisherFrame;
00897                         TargetGp = (ULONG_PTR)(<a class="code" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a>(
00898                                                    (PVOID)ImageBase,
00899                                                    TRUE,
00900                                                    IMAGE_DIRECTORY_ENTRY_GLOBALPTR,
00901                                                    &amp;Size
00902                                                    ));
00903                         <span class="keywordflow">break</span>;
00904 
00905                     <span class="comment">//</span>
00906                     <span class="comment">// All other disposition values are invalid.</span>
00907                     <span class="comment">//</span>
00908                     <span class="comment">// Raise invalid disposition exception.</span>
00909                     <span class="comment">//</span>
00910 
00911                     <span class="keywordflow">default</span> :
00912                         <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a0">RAISE_EXCEPTION</a>(STATUS_INVALID_DISPOSITION, ExceptionRecord);
00913                     }
00914 
00915                 } <span class="keywordflow">while</span> ((ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a31">EXCEPTION_COLLIDED_UNWIND</a>) != 0);
00916 
00917             } <span class="keywordflow">else</span> {
00918 
00919                 <span class="comment">//</span>
00920                 <span class="comment">// If the target frame has not been reached, then virtually </span>
00921                 <span class="comment">// unwind to the caller of the current routine and update </span>
00922                 <span class="comment">// the context record.</span>
00923                 <span class="comment">//</span>
00924 
00925                 <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(EstablisherFrame, TargetFrame)) {
00926                     NextPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ImageBase,
00927                                               ControlPc,
00928                                               FunctionEntry,
00929                                               ContextRecord,
00930                                               &amp;InFunction,
00931                                               &amp;EstablisherFrame,
00932                                               NULL);
00933                 }
00934             }
00935 
00936         } <span class="keywordflow">else</span> {
00937 
00938             <span class="comment">//</span>
00939             <span class="comment">// No function table entry was found.  </span>
00940             <span class="comment">//</span>
00941 
00942             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> BsFrameSize, TempFrameSize;
00943 
00944             NextPc = RtlIa64InsertIPSlotNumber((ContextRecord-&gt;BrRp-16), 2);
00945             ContextRecord-&gt;StIFS = ContextRecord-&gt;RsPFS;
00946             BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ContextRecord-&gt;StIFS &gt;&gt; PFS_SIZE_SHIFT) &amp; PFS_SIZE_MASK;
00947             TempFrameSize = BsFrameSize - (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((ContextRecord-&gt;RsBSP &gt;&gt; 3) &amp; NAT_BITS_PER_RNAT_REG);
00948             <span class="keywordflow">while</span> (TempFrameSize &gt; 0) {
00949                 BsFrameSize++;
00950                 TempFrameSize -= NAT_BITS_PER_RNAT_REG;
00951             }
00952             ContextRecord-&gt;RsBSP -= BsFrameSize * <span class="keyword">sizeof</span>(ULONGLONG);
00953             ContextRecord-&gt;RsBSPSTORE = ContextRecord-&gt;RsBSP;
00954         }
00955 
00956         <span class="comment">//</span>
00957         <span class="comment">// Set point at which control left the previous routine.</span>
00958         <span class="comment">//</span>
00959 
00960         ControlPc = NextPc;
00961 
00962     } <span class="keywordflow">while</span> (((EstablisherFrame.MemoryStackFp &lt; HighStackLimit) ||
00963              (EstablisherFrame.BackingStoreFp &gt; LowBStoreLimit)) &amp;&amp;
00964              !(<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(EstablisherFrame, TargetFrame)));
00965 
00966     <span class="comment">//</span>
00967     <span class="comment">// If the establisher stack pointer is equal to the target frame</span>
00968     <span class="comment">// pointer, then continue execution. Otherwise, an exit unwind was</span>
00969     <span class="comment">// performed or the target of the unwind did not exist and the</span>
00970     <span class="comment">// debugger and subsystem are given a second chance to handle the</span>
00971     <span class="comment">// unwind.</span>
00972     <span class="comment">//</span>
00973 
00974     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a3">IS_SAME_FRAME</a>(EstablisherFrame, TargetFrame)) {
00975         ContextRecord-&gt;IntGp = TargetGp;
00976         ContextRecord-&gt;StIPSR &amp;= ~(0x3i64 &lt;&lt; PSR_RI);
00977         ContextRecord-&gt;IntV0 = (ULONGLONG)ReturnValue;
00978         <a class="code" href="../../d7/d9/ia64_2exdsptch_8c.html#a11">RtlRestoreContext</a>(ContextRecord, ExceptionRecord);
00979     } <span class="keywordflow">else</span> {
00980         ZwRaiseException(ExceptionRecord, ContextRecord, FALSE);
00981     }
00982 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a8" doxytag="ia64/exdsptch.c::DynamicFunctionTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d7/d9/ia64_2exdsptch_8c.html#a8">DynamicFunctionTable</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00052">52</a> of file <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html">ia64/exdsptch.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:35 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
