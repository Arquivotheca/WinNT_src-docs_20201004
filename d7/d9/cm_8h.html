<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cm.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cm.h File Reference</h1>
<p>
<a href="../../d8/d8/cm_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">_BOOT_DRIVER_LIST_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">_CM_SYSTEM_CONTROL_VECTOR</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">_BOOT_DRIVER_LIST_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a24">BOOT_DRIVER_LIST_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">_BOOT_DRIVER_LIST_ENTRY</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a25">PBOOT_DRIVER_LIST_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">_CM_SYSTEM_CONTROL_VECTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a26">CM_SYSTEM_CONTROL_VECTOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">_CM_SYSTEM_CONTROL_VECTOR</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a27">PCM_SYSTEM_CONTROL_VECTOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a28">PCM_TRACE_NOTIFY_ROUTINE</a> )(IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>, IN HANDLE KeyHandle, IN LONGLONG ElapsedTime, IN PUNICODE_STRING <a class="el" href="../../d8/d3/rtvbatcr_8c.html#a3">KeyName</a>, IN UCHAR Type)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PHANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a29">CmGetSystemDriverList</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a30">CmInitSystem1</a> (IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a31">CmInitSystem2</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a32">CmNotifyRunDown</a> (<a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a33">CmShutdownSystem</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a34">CmBootLastKnownGood</a> (ULONG ErrorLevel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a35">CmGetSystemControlValues</a> (PVOID SystemHiveBuffer, <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">PCM_SYSTEM_CONTROL_VECTOR</a> ControlVector)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a36">CmQueryRegistryQuotaInformation</a> (IN PSYSTEM_REGISTRY_QUOTA_INFORMATION RegistryQuotaInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a37">CmSetRegistryQuotaInformation</a> (IN PSYSTEM_REGISTRY_QUOTA_INFORMATION RegistryQuotaInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a38">CmSetTraceNotifyRoutine</a> (IN <a class="el" href="../../d7/d9/cm_8h.html#a28">PCM_TRACE_NOTIFY_ROUTINE</a> NotifyRoutine, IN BOOLEAN Remove)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a0">CmRegistryRootName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a1">CmRegistryMachineName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a2">CmRegistryMachineHardwareName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a3">CmRegistryMachineHardwareDescriptionName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a4">CmRegistryMachineHardwareDescriptionSystemName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a5">CmRegistryMachineHardwareDeviceMapName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a6">CmRegistryMachineHardwareResourceMapName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a7">CmRegistryMachineHardwareOwnerMapName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a8">CmRegistryMachineSystemName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a9">CmRegistryMachineSystemCurrentControlSet</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a10">CmRegistryMachineSystemCurrentControlSetEnumName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a11">CmRegistryMachineSystemCurrentControlSetEnumRootName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a12">CmRegistryMachineSystemCurrentControlSetServices</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a13">CmRegistryMachineSystemCurrentControlSetHardwareProfilesCurrent</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a14">CmRegistryMachineSystemCurrentControlSetControlClass</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a15">CmRegistryMachineSystemCurrentControlSetControlSafeBoot</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a16">CmRegistryMachineSystemCurrentControlSetControlSessionManagerMemoryManagement</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a17">CmRegistryMachineSystemCurrentControlSetControlBootLog</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a18">CmRegistryMachineSystemCurrentControlSetServicesEventLog</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a19">CmRegistryUserName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a20">CmTypeName</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a21">CmTypeString</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a22">CmClassName</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/cm_8h.html#a23">CmClassString</a> []</td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a24" doxytag="cm.h::BOOT_DRIVER_LIST_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">_BOOT_DRIVER_LIST_ENTRY</a>  <a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">BOOT_DRIVER_LIST_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="cm.h::CM_SYSTEM_CONTROL_VECTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">_CM_SYSTEM_CONTROL_VECTOR</a>  <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">CM_SYSTEM_CONTROL_VECTOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="cm.h::PBOOT_DRIVER_LIST_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">_BOOT_DRIVER_LIST_ENTRY</a> * <a class="el" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">PBOOT_DRIVER_LIST_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="cm.h::PCM_SYSTEM_CONTROL_VECTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">_CM_SYSTEM_CONTROL_VECTOR</a> * <a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">PCM_SYSTEM_CONTROL_VECTOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="cm.h::PCM_TRACE_NOTIFY_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d7/d9/cm_8h.html#a28">PCM_TRACE_NOTIFY_ROUTINE</a>)(IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>, IN HANDLE KeyHandle, IN LONGLONG ElapsedTime, IN PUNICODE_STRING <a class="el" href="../../d8/d3/rtvbatcr_8c.html#a3">KeyName</a>, IN UCHAR Type)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00197">197</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a34" doxytag="cm.h::CmBootLastKnownGood" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmBootLastKnownGood           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ErrorLevel</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03778">3778</a> of file <a class="el" href="../../d2/d2/cmsysini_8c-source.html">cmsysini.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00311">CmFirstTime</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03863">CmpIsLastKnownGoodBoot()</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d4/d9/ke_8h.html#a411a244">HalRebootRoutine</a>, <a class="el" href="../../d2/d7/hal_8h.html#a177">HalReturnToFirmware()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a168">HalSetEnvironmentVariable()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>.
<p>
<pre class="fragment"><div>03784                    :
03785 
03786     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to indicate a <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a> during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> boot process.
03787     The actual result <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of ErrorLevel:
03788 
03789         IGNORE - Will <span class="keywordflow">return</span>, boot should proceed
03790         NORMAL - Will <span class="keywordflow">return</span>, boot should proceed
03791 
03792         SEVERE - If not booting LastKnownGood, will <span class="keywordflow">switch</span> to LastKnownGood
03793                  and reboot <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
03794 
03795                  If already booting LastKnownGood, will <span class="keywordflow">return</span>.  Boot should
03796                  proceed.
03797 
03798         CRITICAL - If not booting LastKnownGood, will <span class="keywordflow">switch</span> to LastKnownGood
03799                  and reboot <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
03800 
03801                  If already booting LastKnownGood, will bugcheck.
03802 
03803 Arguments:
03804 
03805     ErrorLevel - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> severity level of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>
03806 
03807 Return Value:
03808 
03809     None.  If <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> returns, boot should proceed.  May cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system to
03810     reboot.
03811 
03812 --*/
03813 
03814 {
03815     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03816 
03817     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03818 
03819     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/cmdat_8c.html#a68">CmFirstTime</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03820 
03821         <span class="comment">//</span>
03822         <span class="comment">// NtInitializeRegistry has been called, so handling</span>
03823         <span class="comment">// driver errors is not a task for ScReg.</span>
03824         <span class="comment">// Treat all errors as Normal</span>
03825         <span class="comment">//</span>
03826         <span class="keywordflow">return</span>;
03827     }
03828 
03829     <span class="keywordflow">switch</span> (ErrorLevel) {
03830         <span class="keywordflow">case</span> NormalError:
03831         <span class="keywordflow">case</span> IgnoreError:
03832             <span class="keywordflow">break</span>;
03833 
03834         <span class="keywordflow">case</span> SevereError:
03835             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d3/cmsysini_8c.html#a57">CmpIsLastKnownGoodBoot</a>()) {
03836                 <span class="keywordflow">break</span>;
03837             } <span class="keywordflow">else</span> {
03838                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d7/hal_8h.html#a168">HalSetEnvironmentVariable</a>(<span class="stringliteral">"LastKnownGood"</span>, <span class="stringliteral">"TRUE"</span>);
03839                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
03840                     <a class="code" href="../../d2/d7/hal_8h.html#a177">HalReturnToFirmware</a>(HalRebootRoutine);
03841                 }
03842             }
03843             <span class="keywordflow">break</span>;
03844 
03845         <span class="keywordflow">case</span> CriticalError:
03846             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d3/cmsysini_8c.html#a57">CmpIsLastKnownGoodBoot</a>()) {
03847                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CRITICAL_SERVICE_FAILED,5,9,0,0);
03848             } <span class="keywordflow">else</span> {
03849                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d7/hal_8h.html#a168">HalSetEnvironmentVariable</a>(<span class="stringliteral">"LastKnownGood"</span>, <span class="stringliteral">"TRUE"</span>);
03850                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
03851                     <a class="code" href="../../d2/d7/hal_8h.html#a177">HalReturnToFirmware</a>(HalRebootRoutine);
03852                 } <span class="keywordflow">else</span> {
03853                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(SET_ENV_VAR_FAILED,5,10,0,0);
03854                 }
03855             }
03856             <span class="keywordflow">break</span>;
03857     }
03858     <span class="keywordflow">return</span>;
03859 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="cm.h::CmGetSystemControlValues" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmGetSystemControlValues           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemHiveBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html">PCM_SYSTEM_CONTROL_VECTOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ControlVector</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">50</a> of file <a class="el" href="../../d6/d9/cmcontrl_8c-source.html">cmcontrl.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d8/cm_8h-source.html#l00165">_CM_SYSTEM_CONTROL_VECTOR::Buffer</a>, <a class="el" href="../../d8/d8/cm_8h-source.html#l00166">_CM_SYSTEM_CONTROL_VECTOR::BufferLength</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00489">CM_KEY_VALUE_SMALL</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00023">CmDefaultLanguageId</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00024">CmDefaultLanguageIdLength</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00025">CmDefaultLanguageIdType</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00027">CmInstallUILanguageId</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00028">CmInstallUILanguageIdLength</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00029">CmInstallUILanguageIdType</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00310">CmpConvertLangId()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l01082">CmpFindControlSet()</a>, <a class="el" href="../../d8/d0/cmindex_8c-source.html#l00186">CmpFindSubKeyByName()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l01243">CmpFindValueByName</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00508">CmpIsHKeyValueSmall</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00256">CmpWalkPath()</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00498">_CM_KEY_VALUE::Data</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00497">_CM_KEY_VALUE::DataLength</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00106">HCELL_INDEX</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00109">HCELL_NIL</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00568">HFILE_TYPE_PRIMARY</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00201">HINIT_FLAT</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00203">HIVE_VOLATILE</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00290">HvGetCell</a>, <a class="el" href="../../d6/d0/hiveinit_8c-source.html#l00158">HvInitializeHive()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d8/d8/cm_8h-source.html#l00162">_CM_SYSTEM_CONTROL_VECTOR::KeyPath</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d1/hivedata_8h.html#a56">PHBASE_BLOCK</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00107">PHCELL_INDEX</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00584">PsDefaultSystemLocaleId</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00585">PsDefaultThreadLocaleId</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00586">PsDefaultUILanguageId</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00587">PsInstallUILanguageId</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d0/cmdata_8h-source.html#l00499">_CM_KEY_VALUE::Type</a>, <a class="el" href="../../d8/d8/cm_8h-source.html#l00173">_CM_SYSTEM_CONTROL_VECTOR::Type</a>, and <a class="el" href="../../d8/d8/cm_8h-source.html#l00164">_CM_SYSTEM_CONTROL_VECTOR::ValueName</a>.
<p>
<pre class="fragment"><div>00056                    :
00057 
00058     Look <span class="keywordflow">for</span> registry values in current <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> set, as specified
00059     by entries in ControlVector.  Report data <span class="keywordflow">for</span> value entries
00060     (<span class="keywordflow">if</span> any) to variables ControlVector points to.
00061 
00062 Arguments:
00063 
00064     SystemHiveBuffer - pointer to flat image of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system hive
00065 
00066     ControlVector - pointer to structure that describes what values
00067                     to suck <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> and store
00068 
00069 Return Value:
00070 
00071     NONE.
00072 
00073 --*/
00074 {
00075     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>        status;
00076     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          SystemHive;
00077     <a class="code" href="../../d9/d6/struct__CMHIVE.html">CMHIVE</a>          TempHive;
00078     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     RootCell;
00079     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     BaseCell;
00080     UNICODE_STRING  <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>;
00081     <a class="code" href="../../d0/d1/hivedata_8h.html#a50">PHCELL_INDEX</a>    <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00082     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     KeyCell;
00083     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     ValueCell;
00084     <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a>   ValueBody;
00085     PVOID           ValueData;
00086     ULONG           Length;
00087     BOOLEAN         AutoSelect;
00088     BOOLEAN         small;
00089     ULONG           tmplength;
00090 
00091 
00092     <span class="comment">//</span>
00093     <span class="comment">// set up to read flat system hive image loader passes us</span>
00094     <span class="comment">//</span>
00095     RtlZeroMemory((PVOID)&amp;TempHive, <span class="keyword">sizeof</span>(TempHive));
00096     SystemHive = &amp;(TempHive.Hive);
00097     status = <a class="code" href="../../d5/d1/hiveinit_8c.html#a3">HvInitializeHive</a>(
00098                 SystemHive,
00099                 HINIT_FLAT,
00100                 HIVE_VOLATILE,
00101                 HFILE_TYPE_PRIMARY,
00102                 SystemHiveBuffer,
00103                 NULL,
00104                 NULL,
00105                 NULL,
00106                 NULL,
00107                 NULL,
00108                 NULL,
00109                 1,
00110                 NULL
00111                 );
00112     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00113         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(BAD_SYSTEM_CONFIG_INFO,1,1,0,0);
00114     }
00115 
00116     <span class="comment">//</span>
00117     <span class="comment">// get hive.cell of root of current control set</span>
00118     <span class="comment">//</span>
00119     RootCell = ((<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html">PHBASE_BLOCK</a>)SystemHiveBuffer)-&gt;RootCell;
00120     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name, L<span class="stringliteral">"current"</span>);
00121     BaseCell = <a class="code" href="../../d1/d2/cmp_8h.html#a296">CmpFindControlSet</a>(
00122                     SystemHive,
00123                     RootCell,
00124                     &amp;Name,
00125                     &amp;AutoSelect
00126                     );
00127     <span class="keywordflow">if</span> (BaseCell == <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00128         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(BAD_SYSTEM_CONFIG_INFO,1,2,0,0);
00129     }
00130 
00131     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name, L<span class="stringliteral">"control"</span>);
00132     BaseCell = <a class="code" href="../../d1/d2/cmp_8h.html#a303">CmpFindSubKeyByName</a>(SystemHive,
00133                                    (<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(SystemHive,BaseCell),
00134                                    &amp;Name);
00135     <span class="keywordflow">if</span> (BaseCell == <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00136         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(BAD_SYSTEM_CONFIG_INFO,1,3,0,0);
00137     }
00138 
00139     <span class="comment">//</span>
00140     <span class="comment">// SystemHive.BaseCell = \registry\machine\system\currentcontrolset\control</span>
00141     <span class="comment">//</span>
00142 
00143     <span class="comment">//</span>
00144     <span class="comment">// step through vector, trying to fetch each value</span>
00145     <span class="comment">//</span>
00146     <span class="keywordflow">while</span> (ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o0">KeyPath</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00147 
00148         <span class="comment">//</span>
00149         <span class="comment">//  Assume we will fail to find the key or value.</span>
00150         <span class="comment">//</span>
00151         
00152         Length = (ULONG)-1;
00153 
00154         KeyCell = <a class="code" href="../../d5/d0/cmcontrl_8c.html#a6">CmpWalkPath</a>(SystemHive, BaseCell, ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o0">KeyPath</a>);
00155 
00156         <span class="keywordflow">if</span> (KeyCell != <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00157 
00158             <span class="comment">//</span>
00159             <span class="comment">// found the key, look for the value entry</span>
00160             <span class="comment">//</span>
00161             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name, ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o1">ValueName</a>);
00162             ValueCell = <a class="code" href="../../d1/d2/cmp_8h.html#a117">CmpFindValueByName</a>(SystemHive,
00163                                            (<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(SystemHive,KeyCell),
00164                                            &amp;Name);
00165             <span class="keywordflow">if</span> (ValueCell != <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00166 
00167                 <span class="comment">//</span>
00168                 <span class="comment">// SystemHive.ValueCell is value entry body</span>
00169                 <span class="comment">//</span>
00170 
00171                 <span class="keywordflow">if</span> (ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o3">BufferLength</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00172                     tmplength = <span class="keyword">sizeof</span>(ULONG);
00173                 } <span class="keywordflow">else</span> {
00174                     tmplength = *(ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o3">BufferLength</a>);
00175                 }
00176 
00177                 ValueBody = (<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a>)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(SystemHive, ValueCell);
00178 
00179                 small = <a class="code" href="../../d9/d0/cmdata_8h.html#a38">CmpIsHKeyValueSmall</a>(Length, ValueBody-&gt;<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o2">DataLength</a>);
00180 
00181                 <span class="keywordflow">if</span> (tmplength &lt; Length) {
00182                     Length = tmplength;
00183                 }
00184 
00185                 <span class="keywordflow">if</span> (Length &gt; 0) {
00186 
00187                     <span class="keywordflow">if</span> (small == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00188                         ValueData = (PVOID)(&amp;(ValueBody-&gt;<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o3">Data</a>));
00189                     } <span class="keywordflow">else</span> {
00190                         ValueData = (PVOID)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(SystemHive, ValueBody-&gt;<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o3">Data</a>);
00191                     }
00192 
00193                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((small ? (Length &lt;= CM_KEY_VALUE_SMALL) : TRUE));
00194 
00195                     RtlMoveMemory(
00196                         ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o2">Buffer</a>,
00197                         ValueData,
00198                         Length
00199                         );
00200                 }
00201 
00202                 <span class="keywordflow">if</span> (ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o4">Type</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00203                     *(ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o4">Type</a>) = ValueBody-&gt;<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o4">Type</a>;
00204                 }
00205             }
00206         }
00207 
00208         <span class="comment">//</span>
00209         <span class="comment">// Stash the length of result (-1 if nothing was found)</span>
00210         <span class="comment">//</span>
00211         
00212         <span class="keywordflow">if</span> (ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o3">BufferLength</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00213             *(ControlVector-&gt;<a class="code" href="../../d8/d6/struct__CM__SYSTEM__CONTROL__VECTOR.html#o3">BufferLength</a>) = Length;
00214         }
00215 
00216         ControlVector++;
00217     }
00218 
00219     <span class="comment">//</span>
00220     <span class="comment">// Get the default locale ID for the system from the registry.</span>
00221     <span class="comment">//</span>
00222 
00223     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/cmcontrl_8c.html#a2">CmDefaultLanguageIdType</a> == REG_SZ) {
00224         <a class="code" href="../../d1/d9/ps_8h.html#a58">PsDefaultSystemLocaleId</a> = (LCID) <a class="code" href="../../d5/d0/cmcontrl_8c.html#a7">CmpConvertLangId</a>( 
00225                                                 CmDefaultLanguageId,
00226                                                 CmDefaultLanguageIdLength);
00227     } <span class="keywordflow">else</span> {
00228         <a class="code" href="../../d1/d9/ps_8h.html#a58">PsDefaultSystemLocaleId</a> = 0x00000409;
00229     }
00230 
00231     <span class="comment">//</span>
00232     <span class="comment">// Get the install (native UI) language ID for the system from the registry.</span>
00233     <span class="comment">//</span>
00234 
00235     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/cmcontrl_8c.html#a5">CmInstallUILanguageIdType</a> == REG_SZ) {
00236         <a class="code" href="../../d1/d9/ps_8h.html#a61">PsInstallUILanguageId</a> =  <a class="code" href="../../d5/d0/cmcontrl_8c.html#a7">CmpConvertLangId</a>( 
00237                                                 CmInstallUILanguageId,
00238                                                 CmInstallUILanguageIdLength);
00239     } <span class="keywordflow">else</span> {
00240         <a class="code" href="../../d1/d9/ps_8h.html#a61">PsInstallUILanguageId</a> = LANGIDFROMLCID(PsDefaultSystemLocaleId);
00241     }
00242 
00243     <span class="comment">//</span>
00244     <span class="comment">// Set the default thread locale to the default system locale</span>
00245     <span class="comment">// for now.  This will get changed as soon as somebody logs in.</span>
00246     <span class="comment">// Use the install (native) language id as our default UI language id. </span>
00247     <span class="comment">// This also will get changed as soon as somebody logs in.</span>
00248     <span class="comment">//</span>
00249 
00250     <a class="code" href="../../d1/d9/ps_8h.html#a59">PsDefaultThreadLocaleId</a> = <a class="code" href="../../d1/d9/ps_8h.html#a58">PsDefaultSystemLocaleId</a>;
00251     <a class="code" href="../../d1/d9/ps_8h.html#a60">PsDefaultUILanguageId</a> = <a class="code" href="../../d1/d9/ps_8h.html#a61">PsInstallUILanguageId</a>;
00252 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="cm.h::CmGetSystemDriverList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PHANDLE CmGetSystemDriverList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">2169</a> of file <a class="el" href="../../d2/d2/cmsysini_8c-source.html">cmsysini.c</a>.
<p>
References <a class="el" href="../../d2/d1/cmp_8h-source.html#l00242">CML_BUGCHECK</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00293">CMLOG</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l01082">CmpFindControlSet()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00333">CmpFindDrivers()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02380">CmpFreeDriverList()</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00289">CmpKeyObjectType</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00081">CmpLockRegistryExclusive()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00920">CmpResolveDriverDependencies()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00744">CmpSortDriverList()</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00116">CmpUnlockRegistry()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00272">CMS_INIT_ERROR</a>, <a class="el" href="../../d7/d6/fs__rec_8c-source.html#l00067">DriverEntry()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00106">HCELL_INDEX</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00109">HCELL_NIL</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00092">Hive</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03146">IopInitializeSystemDrivers()</a>.
<p>
<pre class="fragment"><div>02175                    :
02176 
02177     Traverses <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current SERVICES subtree and creates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of drivers
02178     to be loaded during Phase 1 initialization.
02179 
02180 Arguments:
02181 
02182     None
02183 
02184 Return Value:
02185 
02186     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to an array of handles, each of which refers to a key in
02187     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> \Services section of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> set.  The caller will traverse
02188     <span class="keyword">this</span> array and load and initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> drivers described by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> keys.
02189 
02190     The last key will be <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.  The array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated in Pool and should
02191     be freed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
02192 
02193 --*/
02194 
02195 {
02196     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
02197     HANDLE SystemHandle;
02198     UNICODE_STRING <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>;
02199     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02200     <a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">PCM_KEY_BODY</a> KeyBody;
02201     LIST_ENTRY DriverList;
02202     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
02203     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> RootCell;
02204     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> ControlCell;
02205     ULONG DriverCount;
02206     PLIST_ENTRY Current;
02207     PHANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
02208     <a class="code" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">PBOOT_DRIVER_LIST_ENTRY</a> <a class="code" href="../../d6/d7/fs__rec_8c.html#a3">DriverEntry</a>;
02209     BOOLEAN Success;
02210     BOOLEAN AutoSelect;
02211 
02212     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02213     InitializeListHead(&amp;DriverList);
02214     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name,
02215                          L<span class="stringliteral">"\\Registry\\Machine\\System"</span>);
02216 
02217     InitializeObjectAttributes(&amp;ObjectAttributes,
02218                                &amp;Name,
02219                                OBJ_CASE_INSENSITIVE,
02220                                (HANDLE)NULL,
02221                                NULL);
02222     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(&amp;SystemHandle,
02223                        KEY_READ,
02224                        &amp;ObjectAttributes);
02225 
02226     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02227         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02228             KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't open registry key %wZ\n"</span>,&amp;Name));
02229             KdPrint((<span class="stringliteral">"CM:     status %08lx\n"</span>, Status));
02230         }
02231         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02232     }
02233 
02234 
02235     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( SystemHandle,
02236                                         KEY_QUERY_VALUE,
02237                                         CmpKeyObjectType,
02238                                         KernelMode,
02239                                         (PVOID *)(&amp;KeyBody),
02240                                         NULL );
02241     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02242         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02243             KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't dereference Systemhandle\n"</span>));
02244             KdPrint((<span class="stringliteral">"CM:     status %08lx\n"</span>, Status));
02245         }
02246         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(SystemHandle);
02247         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02248     }
02249 
02250     <a class="code" href="../../d0/d3/cmsubs3_8c.html#a4">CmpLockRegistryExclusive</a>();
02251 
02252     <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a> = KeyBody-&gt;<a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o1">KeyControlBlock</a>-&gt;<a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o5">KeyHive</a>;
02253     RootCell = KeyBody-&gt;<a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o1">KeyControlBlock</a>-&gt;<a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o6">KeyCell</a>;
02254 
02255     <span class="comment">//</span>
02256     <span class="comment">// Now we have found out the PHHIVE and HCELL_INDEX of the root of the</span>
02257     <span class="comment">// SYSTEM hive, we can use all the same code that the OS Loader does.</span>
02258     <span class="comment">//</span>
02259 
02260     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name, L<span class="stringliteral">"Current"</span>);
02261     ControlCell = <a class="code" href="../../d1/d2/cmp_8h.html#a296">CmpFindControlSet</a>(Hive,
02262                                     RootCell,
02263                                     &amp;Name,
02264                                     &amp;AutoSelect);
02265     <span class="keywordflow">if</span> (ControlCell == <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
02266         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02267             KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't find control set\n"</span>));
02268         }
02269         <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
02270         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>((PVOID)KeyBody);
02271         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(SystemHandle);
02272         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02273     }
02274 
02275     Success = <a class="code" href="../../d1/d2/cmp_8h.html#a297">CmpFindDrivers</a>(Hive,
02276                              ControlCell,
02277                              SystemLoad,
02278                              NULL,
02279                              &amp;DriverList);
02280 
02281 
02282     <span class="keywordflow">if</span> (!Success) {
02283         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02284             KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't find any valid drivers\n"</span>));
02285         }
02286         <a class="code" href="../../d1/d3/cmsysini_8c.html#a39">CmpFreeDriverList</a>(Hive, &amp;DriverList);
02287         <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
02288         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>((PVOID)KeyBody);
02289         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(SystemHandle);
02290         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02291     }
02292 
02293     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d2/cmp_8h.html#a302">CmpSortDriverList</a>(Hive,
02294                            ControlCell,
02295                            &amp;DriverList)) {
02296         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02297             KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't sort driver list\n"</span>));
02298         }
02299         <a class="code" href="../../d1/d3/cmsysini_8c.html#a39">CmpFreeDriverList</a>(Hive, &amp;DriverList);
02300         <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
02301         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>((PVOID)KeyBody);
02302         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(SystemHandle);
02303         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02304     }
02305 
02306     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d2/cmp_8h.html#a301">CmpResolveDriverDependencies</a>(&amp;DriverList)) {
02307         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02308             KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't resolve driver dependencies\n"</span>));
02309         }
02310         <a class="code" href="../../d1/d3/cmsysini_8c.html#a39">CmpFreeDriverList</a>(Hive, &amp;DriverList);
02311         <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
02312         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>((PVOID)KeyBody);
02313         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(SystemHandle);
02314         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02315     }
02316     <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
02317     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>((PVOID)KeyBody);
02318     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(SystemHandle);
02319 
02320     <span class="comment">//</span>
02321     <span class="comment">// We now have a fully sorted and ordered list of drivers to be loaded</span>
02322     <span class="comment">// by IoInit.</span>
02323     <span class="comment">//</span>
02324 
02325     <span class="comment">//</span>
02326     <span class="comment">// Count the nodes in the list.</span>
02327     <span class="comment">//</span>
02328     Current = DriverList.Flink;
02329     DriverCount = 0;
02330     <span class="keywordflow">while</span> (Current != &amp;DriverList) {
02331         ++DriverCount;
02332         Current = Current-&gt;Flink;
02333     }
02334 
02335     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = (PHANDLE)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool,
02336                                      (DriverCount+1) * <span class="keyword">sizeof</span>(HANDLE));
02337 
02338     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02339         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,5,8,0,0); <span class="comment">// odds against this are huge</span>
02340     }
02341 
02342     <span class="comment">//</span>
02343     <span class="comment">// Walk the list, opening each registry key and adding it to the</span>
02344     <span class="comment">// table of handles.</span>
02345     <span class="comment">//</span>
02346     Current = DriverList.Flink;
02347     DriverCount = 0;
02348     <span class="keywordflow">while</span> (Current != &amp;DriverList) {
02349         <a class="code" href="../../d6/d7/fs__rec_8c.html#a3">DriverEntry</a> = CONTAINING_RECORD(Current,
02350                                         <a class="code" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">BOOT_DRIVER_LIST_ENTRY</a>,
02351                                         Link);
02352 
02353         InitializeObjectAttributes(&amp;ObjectAttributes,
02354                                    &amp;<a class="code" href="../../d6/d7/fs__rec_8c.html#a3">DriverEntry</a>-&gt;RegistryPath,
02355                                    OBJ_CASE_INSENSITIVE,
02356                                    (HANDLE)NULL,
02357                                    NULL);
02358 
02359         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(Handle+DriverCount,
02360                            KEY_READ | KEY_WRITE,
02361                            &amp;ObjectAttributes);
02362         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02363             <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
02364                 KdPrint((<span class="stringliteral">"CM: CmGetSystemDriverList couldn't open driver "</span>));
02365                 KdPrint((<span class="stringliteral">"key %wZ\n"</span>, &amp;<a class="code" href="../../d6/d7/fs__rec_8c.html#a3">DriverEntry</a>-&gt;RegistryPath));
02366                 KdPrint((<span class="stringliteral">"    status %08lx\n"</span>,Status));
02367             }
02368         } <span class="keywordflow">else</span> {
02369             ++DriverCount;
02370         }
02371         Current = Current-&gt;Flink;
02372     }
02373     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>[DriverCount] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02374 
02375     <span class="keywordflow">return</span>(<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>);
02376 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="cm.h::CmInitSystem1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmInitSystem1           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LoaderBlock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">293</a> of file <a class="el" href="../../d2/d2/cmsysini_8c-source.html">cmsysini.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00064">CLONE_HIVE_INDEX</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l01609">_HIVE_LIST_ENTRY::CmHive</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00242">CML_BUGCHECK</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00246">CML_MAJOR</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00293">CMLOG</a>, <a class="el" href="../../d7/d0/cmhvlist_8c-source.html#l00042">CmpAddToHiveFileList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03262">CmpCloneControlSet()</a>, <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00293">CmpComputeGlobalQuotaAllowed()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02786">CmpCreateControlSet()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01074">CmpCreateObjectTypes()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00027">CmpHiveListHead</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01227">CmpHiveRootSecurityDescriptor()</a>, <a class="el" href="../../d9/d1/cmsubs_8c-source.html#l01512">CmpInitializeCache()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, <a class="el" href="../../d9/d0/cminit_8c-source.html#l00471">CmpInitializeHive()</a>, <a class="el" href="../../d7/d0/config_2ppc_2init_8c-source.html#l00033">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02022">CmpInitializeSystemHive()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00229">CmpKcbLock</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00496">CmpLinkHiveToMaster()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03983">CmpLinkKeyToHive()</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00043">CmpLoadOptions</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00081">CmpLockRegistryExclusive()</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00250">CmpMachineHiveList</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00036">CmpMasterHive</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00276">CmpNoMasterCreates</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00642">CmpPostLock</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l01174">CmpRegistryLock</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00032">CmpStashBuffer</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00033">CmpStashBufferSize</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00050">CmpSystemProcess</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00116">CmpUnlockRegistry()</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00168">CmRegistryMachineHardwareName</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00167">CmRegistryMachineName</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00186">CmRegistrySystemCloneName</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00185">CmRegistryUserName</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00256">CMS_INIT</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00272">CMS_INIT_ERROR</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02473">ExInitializeResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00122">HBLOCK_SIZE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00568">HFILE_TYPE_PRIMARY</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00197">HINIT_CREATE</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00203">HIVE_VOLATILE</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00159">nullclass</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00298                    :
00299 
00300     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called as part of phase1 init, after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00301     manager has been inited, but before IoInit.  It's purpose <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
00302     set up basic registry object operations, and transform data
00303     captured during boot into registry <a class="code" href="../../d8/d3/rtvbatcr_8c.html#a8">format</a> (whether it was read
00304     from the SYSTEM hive file by the osloader or computed by recognizers.)
00305     After <span class="keyword">this</span> call, Nt*Key calls work, but only part of the name
00306     space is available and any changes written must be held in
00307     memory.
00308 
00309     CmpMachineHiveList entries marked CM_PHASE_1 are available
00310     after <span class="keywordflow">return</span> from <span class="keyword">this</span> call, but writes must be held in memory.
00311 
00312     This function will:
00313 
00314         1.  Create the regisrty worker/lazy-write thread
00315         2.  Create the registry key object type
00316         4.  Create the master hive
00317         5.  Create the \REGISTRY node
00318         6.  Create a KEY object that refers to \REGISTRY
00319         7.  Create \REGISTRY\MACHINE node
00320         8.  Create the SYSTEM hive, fill in with data from loader
00321         9.  Create the HARDWARE hive, fill in with data from loader
00322        10.  Create:
00323                 \REGISTRY\MACHINE\SYSTEM
00324                 \REGISTRY\MACHINE\HARDWARE
00325                 Both of which will be link nodes in the master hive.
00326 
00327     NOTE:   We <span class="keywordflow">do</span> NOT free allocated pool in failure <span class="keywordflow">case</span>.  This is because
00328             our caller is going to bugcheck anyway, and having the memory
00329             object to look at is useful.
00330 
00331 Arguments:
00332 
00333     LoaderBlock - supplies the LoaderBlock passed in from the OSLoader.
00334         By looking through the memory descriptor list we can find the
00335         SYSTEM hive which the OSLoader has placed in memory <span class="keywordflow">for</span> us.
00336 
00337 Return Value:
00338 
00339     TRUE <span class="keywordflow">if</span> all operations were successful, <span class="keyword">false</span> <span class="keywordflow">if</span> any failed.
00340 
00341     Bugchecks when something went wrong (CONFIG_INITIALIZATION_FAILED,4,.....)
00342 
00343 --*/
00344 {
00345     HANDLE  key1;
00346     OBJECT_ATTRIBUTES ObjectAttributes;
00347     NTSTATUS    status;
00348     NTSTATUS    status2;
00349     PSECURITY_DESCRIPTOR SecurityDescriptor;
00350     <a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> HardwareHive;
00351     <a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> CloneHive;
00352     UNICODE_STRING NameString;
00353 
00354     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00355     <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_INIT) KdPrint((<span class="stringliteral">"CmInitSystem1\n"</span>));
00356 
00357     <span class="comment">//</span>
00358     <span class="comment">// Initialize Names of all registry paths.</span>
00359     <span class="comment">// This simply initializes unicode strings so we don't have to bother</span>
00360     <span class="comment">// with it later. This can not fail.</span>
00361     <span class="comment">//</span>
00362     <a class="code" href="../../d1/d2/cmp_8h.html#a277">CmpInitializeRegistryNames</a>();
00363 
00364     <span class="comment">//</span>
00365     <span class="comment">// Compute registry global quota</span>
00366     <span class="comment">//</span>
00367     <a class="code" href="../../d1/d2/cmp_8h.html#a246">CmpComputeGlobalQuotaAllowed</a>();
00368 
00369     <span class="comment">//</span>
00370     <span class="comment">// Initialize the hive list head</span>
00371     <span class="comment">//</span>
00372     InitializeListHead(&amp;CmpHiveListHead);
00373 
00374     <span class="comment">//</span>
00375     <span class="comment">// Initialize the global registry resource</span>
00376     <span class="comment">//</span>
00377     <a class="code" href="../../d5/d8/ex_8h.html#a68">ExInitializeResource</a>(&amp;CmpRegistryLock);
00378 
00379     <span class="comment">//</span>
00380     <span class="comment">// Initialize the KCB tree mutex</span>
00381     <span class="comment">//</span>
00382     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>(&amp;CmpKcbLock);
00383 
00384     <span class="comment">//</span>
00385     <span class="comment">// Initialize the PostList mutex</span>
00386     <span class="comment">//</span>
00387     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>(&amp;CmpPostLock);
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">// Initialize the cache</span>
00391     <span class="comment">//</span>
00392     CmpInitializeCache ();
00393 
00394     <span class="comment">//</span>
00395     <span class="comment">// Save the current process to allow us to attach to it later.</span>
00396     <span class="comment">//</span>
00397     CmpSystemProcess = &amp;<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Pcb;
00398 
00399     <a class="code" href="../../d0/d3/cmsubs3_8c.html#a4">CmpLockRegistryExclusive</a>();
00400 
00401     <span class="comment">//</span>
00402     <span class="comment">// Create the Key object type.</span>
00403     <span class="comment">//</span>
00404     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d3/cmsysini_8c.html#a36">CmpCreateObjectTypes</a>()) {
00405         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_INIT_ERROR) {
00406             KdPrint((<span class="stringliteral">"CmInitSystem1: CmpCreateObjectTypes failed\n"</span>));
00407         }
00408         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,1,0,0); <span class="comment">// could not registrate with object manager</span>
00409         <span class="keywordflow">return</span> FALSE;
00410     }
00411 
00412 
00413     <span class="comment">//</span>
00414     <span class="comment">// Create the master hive and initialize it.</span>
00415     <span class="comment">//</span>
00416     status = <a class="code" href="../../d1/d2/cmp_8h.html#a275">CmpInitializeHive</a>(&amp;CmpMasterHive,
00417                 HINIT_CREATE,
00418                 HIVE_VOLATILE,
00419                 HFILE_TYPE_PRIMARY,     <span class="comment">// i.e. no logging, no alterate</span>
00420                 NULL,
00421                 NULL,
00422                 NULL,
00423                 NULL,
00424                 NULL,
00425                 NULL);
00426     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00427         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
00428             KdPrint((<span class="stringliteral">"CmInitSystem1: CmpInitializeHive(master) failed\n"</span>));
00429         }
00430         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,2,0,0); <span class="comment">// could not initialize master hive</span>
00431         <span class="keywordflow">return</span> (FALSE);
00432     }
00433 
00434     <span class="comment">//</span>
00435     <span class="comment">// try to allocate a stash buffer.  if we can't get 1 page this</span>
00436     <span class="comment">// early on, we're in deep trouble, so punt.</span>
00437     <span class="comment">//</span>
00438     CmpStashBuffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, HBLOCK_SIZE,'bSmC');
00439     <span class="keywordflow">if</span> (CmpStashBuffer == NULL) {
00440         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,3,0,0); <span class="comment">// odds against this are huge</span>
00441         <span class="keywordflow">return</span> FALSE;
00442     }
00443     CmpStashBufferSize = HBLOCK_SIZE;
00444 
00445     <span class="comment">//</span>
00446     <span class="comment">// Create the \REGISTRY node</span>
00447     <span class="comment">//</span>
00448     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d3/cmsysini_8c.html#a37">CmpCreateRegistryRoot</a>()) {
00449         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_INIT_ERROR) {
00450             KdPrint((<span class="stringliteral">"CmInitSystem1: CmpCreateRegistryRoot failed\n"</span>));
00451         }
00452         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,4,0,0); <span class="comment">// could not create root of the registry</span>
00453         <span class="keywordflow">return</span> FALSE;
00454     }
00455 
00456     <span class="comment">//</span>
00457     <span class="comment">// --- 6. Create \REGISTRY\MACHINE and \REGISTRY\USER nodes ---</span>
00458     <span class="comment">//</span>
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">// Get default security descriptor for the nodes we will create.</span>
00462     <span class="comment">//</span>
00463     SecurityDescriptor = <a class="code" href="../../d7/d2/cmse_8c.html#a13">CmpHiveRootSecurityDescriptor</a>();
00464 
00465     InitializeObjectAttributes(
00466         &amp;ObjectAttributes,
00467         &amp;CmRegistryMachineName,
00468         OBJ_CASE_INSENSITIVE,
00469         (HANDLE)NULL,
00470         SecurityDescriptor
00471         );
00472 
00473     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00474                         &amp;key1,
00475                         KEY_READ | KEY_WRITE,
00476                         &amp;ObjectAttributes,
00477                         0,
00478                         &amp;nullclass,
00479                         0,
00480                         NULL
00481         )))
00482     {
00483         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(SecurityDescriptor);
00484         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_INIT_ERROR) {
00485             KdPrint((<span class="stringliteral">"CmInitSystem1: NtCreateKey(MACHINE) failed\n"</span>));
00486         }
00487         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,5,0,0); <span class="comment">// could not create HKLM</span>
00488         <span class="keywordflow">return</span> FALSE;
00489     }
00490 
00491     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(key1);
00492 
00493     InitializeObjectAttributes(
00494         &amp;ObjectAttributes,
00495         &amp;CmRegistryUserName,
00496         OBJ_CASE_INSENSITIVE,
00497         (HANDLE)NULL,
00498         SecurityDescriptor
00499         );
00500 
00501     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00502                         &amp;key1,
00503                         KEY_READ | KEY_WRITE,
00504                         &amp;ObjectAttributes,
00505                         0,
00506                         &amp;nullclass,
00507                         0,
00508                         NULL
00509         )))
00510     {
00511         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(SecurityDescriptor);
00512         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_INIT_ERROR) {
00513             KdPrint((<span class="stringliteral">"CmInitSystem1: NtCreateKey(USER) failed\n"</span>));
00514         }
00515         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,6,0,0); <span class="comment">// could not create HKUSER</span>
00516         <span class="keywordflow">return</span> FALSE;
00517     }
00518 
00519     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(key1);
00520 
00521 
00522     <span class="comment">//</span>
00523     <span class="comment">// --- 7. Create the SYSTEM hive, fill in with data from loader ---</span>
00524     <span class="comment">//</span>
00525     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d3/cmsysini_8c.html#a41">CmpInitializeSystemHive</a>(LoaderBlock)) {
00526         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(SecurityDescriptor);
00527         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
00528             KdPrint((<span class="stringliteral">"CmpInitSystem1: "</span>));
00529             KdPrint((<span class="stringliteral">"Hive allocation failure for SYSTEM\n"</span>));
00530         }
00531         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,7,0,0); <span class="comment">// could not create SystemHive</span>
00532         <span class="keywordflow">return</span>(FALSE);
00533     }
00534 
00535     <span class="comment">//</span>
00536     <span class="comment">// Create the symbolic link \Registry\Machine\System\CurrentControlSet</span>
00537     <span class="comment">//</span>
00538     status = <a class="code" href="../../d1/d3/cmsysini_8c.html#a34">CmpCreateControlSet</a>(LoaderBlock);
00539     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00540         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,8,0,0); <span class="comment">// could not create CurrentControlSet</span>
00541         <span class="keywordflow">return</span>(FALSE);
00542     }
00543 
00544     <span class="comment">//</span>
00545     <span class="comment">// Handle the copying of the CurrentControlSet to a Clone volatile</span>
00546     <span class="comment">// hive (but only if we really want to have a clone)</span>
00547     <span class="comment">//</span>
00548 
00549 #<span class="keywordflow">if</span> CLONE_CONTROL_SET
00550 
00551     <span class="comment">//</span>
00552     <span class="comment">// Create the Clone temporary hive, link it into the master hive,</span>
00553     <span class="comment">// and make a symbolic link to it.</span>
00554     <span class="comment">//</span>
00555     status = <a class="code" href="../../d1/d2/cmp_8h.html#a275">CmpInitializeHive</a>(&amp;CloneHive,
00556                 HINIT_CREATE,
00557                 HIVE_VOLATILE,
00558                 HFILE_TYPE_PRIMARY,
00559                 NULL,
00560                 NULL,
00561                 NULL,
00562                 NULL,
00563                 NULL,
00564                 NULL);
00565     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00566         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
00567             KdPrint((<span class="stringliteral">"CmpInitSystem1: "</span>));
00568             KdPrint((<span class="stringliteral">"Could not initialize CLONE hive\n"</span>));
00569         }
00570         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,9,0,0); <span class="comment">// could not initialize clone hive</span>
00571         <span class="keywordflow">return</span>(FALSE);
00572     }
00573 
00574     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/cmwraper_8c.html#a28">CmpLinkHiveToMaster</a>(
00575             &amp;CmRegistrySystemCloneName,
00576             NULL,
00577             CloneHive,
00578             TRUE,
00579             SecurityDescriptor
00580             ) != STATUS_SUCCESS)
00581     {
00582         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
00583             KdPrint((<span class="stringliteral">"CmInitSystem1: CmpLinkHiveToMaster(Clone) failed\n"</span>));
00584         }
00585         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,10,0,0); <span class="comment">// could not link clone hive to master hive</span>
00586         <span class="keywordflow">return</span> FALSE;
00587     }
00588     <a class="code" href="../../d1/d2/cmp_8h.html#a309">CmpAddToHiveFileList</a>(CloneHive);
00589     CmpMachineHiveList[CLONE_HIVE_INDEX].CmHive = CloneHive;
00590 
00591     <a class="code" href="../../d1/d3/cmsysini_8c.html#a32">CmpLinkKeyToHive</a>(
00592         L<span class="stringliteral">"\\Registry\\Machine\\System\\Clone"</span>,
00593         L<span class="stringliteral">"\\Registry\\Machine\\CLONE\\CLONE"</span>
00594         );
00595 
00596 
00597     <span class="comment">//</span>
00598     <span class="comment">// Clone the current control set for the service controller</span>
00599     <span class="comment">//</span>
00600     status = <a class="code" href="../../d1/d3/cmsysini_8c.html#a35">CmpCloneControlSet</a>();
00601 
00602     <span class="comment">//</span>
00603     <span class="comment">// If this didn't work, it's bad, but not bad enough to fail the boot</span>
00604     <span class="comment">//</span>
00605     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status));
00606 
00607 #endif
00608 
00609     <span class="comment">//</span>
00610     <span class="comment">// --- 8. Create the HARDWARE hive, fill in with data from loader ---</span>
00611     <span class="comment">//</span>
00612     status = <a class="code" href="../../d1/d2/cmp_8h.html#a275">CmpInitializeHive</a>(&amp;HardwareHive,
00613                 HINIT_CREATE,
00614                 HIVE_VOLATILE,
00615                 HFILE_TYPE_PRIMARY,     <span class="comment">// i.e. no log, no alternate</span>
00616                 NULL,
00617                 NULL,
00618                 NULL,
00619                 NULL,
00620                 NULL,
00621                 NULL);
00622     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00623         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(SecurityDescriptor);
00624         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_BUGCHECK, CMS_INIT_ERROR) {
00625             KdPrint((<span class="stringliteral">"CmpInitSystem1: "</span>));
00626             KdPrint((<span class="stringliteral">"Could not initialize HARDWARE hive\n"</span>));
00627         }
00628         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,11,0,0); <span class="comment">// could not initialize hardware hive</span>
00629         <span class="keywordflow">return</span>(FALSE);
00630     }
00631 
00632     <span class="comment">//</span>
00633     <span class="comment">// Allocate the root node</span>
00634     <span class="comment">//</span>
00635     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/cmwraper_8c.html#a28">CmpLinkHiveToMaster</a>(
00636             &amp;CmRegistryMachineHardwareName,
00637             NULL,
00638             HardwareHive,
00639             TRUE,
00640             SecurityDescriptor
00641             ) != STATUS_SUCCESS)
00642     {
00643         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_MAJOR, CMS_INIT_ERROR) {
00644             KdPrint((<span class="stringliteral">"CmInitSystem1: CmpLinkHiveToMaster(Hardware) failed\n"</span>));
00645         }
00646         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,12,0,0); <span class="comment">// could not link hardware hive to master hive</span>
00647         <span class="keywordflow">return</span> FALSE;
00648     }
00649     <a class="code" href="../../d1/d2/cmp_8h.html#a309">CmpAddToHiveFileList</a>(HardwareHive);
00650 
00651     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(SecurityDescriptor);
00652 
00653     CmpMachineHiveList[0].CmHive = HardwareHive;
00654 
00655     <span class="comment">//</span>
00656     <span class="comment">// put loader configuration tree data to our hardware registry.</span>
00657     <span class="comment">//</span>
00658     status = <a class="code" href="../../d1/d2/cmp_8h.html#a272">CmpInitializeHardwareConfiguration</a>(LoaderBlock);
00659 
00660     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00661         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,13,0,0); <span class="comment">// could not initialize hardware configuration</span>
00662         <span class="keywordflow">return</span>(FALSE);
00663     }
00664 
00665     CmpNoMasterCreates = TRUE;
00666     <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
00667 
00668     <span class="comment">//</span>
00669     <span class="comment">// put machine dependant configuration data to our hardware registry.</span>
00670     <span class="comment">//</span>
00671     status = <a class="code" href="../../d6/d1/config_2ppc_2init_8c.html#a0">CmpInitializeMachineDependentConfiguration</a>(LoaderBlock);
00672 
00673 
00674     <span class="comment">//</span>
00675     <span class="comment">// store boot loader command tail in registry</span>
00676     <span class="comment">//</span>
00677     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00678         &amp;NameString,
00679         L<span class="stringliteral">"\\REGISTRY\\MACHINE\\SYSTEM\\CurrentControlSet\\Control"</span>
00680         );
00681 
00682     InitializeObjectAttributes(
00683         &amp;ObjectAttributes,
00684         &amp;NameString,
00685         OBJ_CASE_INSENSITIVE,
00686         (HANDLE)NULL,
00687         NULL
00688         );
00689 
00690     status2 = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00691                 &amp;key1,
00692                 KEY_WRITE,
00693                 &amp;ObjectAttributes
00694                 );
00695 
00696     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status2)) {
00697         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00698             &amp;NameString,
00699             L<span class="stringliteral">"SystemStartOptions"</span>
00700             );
00701 
00702         <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00703             key1,
00704             &amp;NameString,
00705             0,              <span class="comment">// TitleIndex</span>
00706             REG_SZ,
00707             <a class="code" href="../../d6/d0/cmdat_8c.html#a0">CmpLoadOptions</a>.Buffer,
00708             <a class="code" href="../../d6/d0/cmdat_8c.html#a0">CmpLoadOptions</a>.Length
00709             );
00710 
00711         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(key1);
00712     }
00713     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(<a class="code" href="../../d6/d0/cmdat_8c.html#a0">CmpLoadOptions</a>.Buffer);
00714 
00715 
00716     if (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00717         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(CONFIG_INITIALIZATION_FAILED,4,14,0,0); <span class="comment">// could not open CurrentControlSet\\Control</span>
00718         <span class="keywordflow">return</span>(FALSE);
00719     }
00720 
00721     <span class="keywordflow">return</span> TRUE;
00722 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="cm.h::CmInitSystem2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmInitSystem2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="cm.h::CmNotifyRunDown" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmNotifyRunDown           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01028">1028</a> of file <a class="el" href="../../d1/d1/cmnotify_8c-source.html">cmnotify.c</a>.
<p>
References <a class="el" href="../../d2/d1/cmp_8h-source.html#l00595">_CM_ASYNC_USER_POST_BLOCK::Apc</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00607">_CM_POST_BLOCK_UNION::AsyncUser</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00617">_CM_POST_BLOCK::CancelPostList</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00243">CML_API</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00293">CMLOG</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01738">CmpCancelSlavePost()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00054">CmpClearListEntry</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03764">CmpFreePostBlock()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01634">CmpFreeSlavePost()</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00081">CmpLockRegistryExclusive()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00048">CmpRemoveEntryList</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l02019">CmpSetIoStatus</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00116">CmpUnlockRegistry()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00267">CMS_EXCEPTION</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00257">CMS_NTAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00596">_CM_ASYNC_USER_POST_BLOCK::IoStatusBlock</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00632">IsMasterPostBlock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00291">KeRemoveQueueApc()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00615">_CM_POST_BLOCK::NotifyList</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d2/cmp_8h.html#a335a205">PostAsyncUser</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00382">_ETHREAD::PostBlockList</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00630">PostBlockType</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00616">_CM_POST_BLOCK::ThreadList</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00620">_CM_POST_BLOCK::u</a>, and <a class="el" href="../../d2/d1/cmp_8h-source.html#l00594">_CM_ASYNC_USER_POST_BLOCK::UserEvent</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.
<p>
<pre class="fragment"><div>01033                    :
01034 
01035     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called from <a class="code" href="../../d8/d0/psdelete_8c.html#a12">PspExitThread</a> to clean up any pending
01036     notify requests.
01037 
01038     It will traverse <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's PostBlockList, <span class="keywordflow">for</span> each PostBlock <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
01039     finds, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will:
01040 
01041         1.  Remove <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> relevent NotifyBlock.  This requires
01042             that we hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry mutex.
01043 
01044         2.  Remove <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's PostBlockList.  This requires
01045             that we run at APC level.
01046 
01047         3.  By <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time <span class="keyword">this</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> runs, user apcs are not interesting
01048             and neither are SystemEvents, so <span class="keywordflow">do</span> not bother processing
01049             them.
01050 
01051             UserEvents and IoStatusBlocks could be refered to by other
01052             threads in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same process, or even a different process,
01053             so process them so those threads know what happened, use
01054             status code of STATUS_NOTIFY_CLEANUP.
01055 
01056             If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> notify <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a master one, cancel all slave notifications.
01057             Else <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> remove <span class="keyword">this</span> notification from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> master CancelPortList
01058 
01059         4.  Free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> post block.
01060 
01061 Arguments:
01062 
01063     Thread - pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> executive thread object <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
01064              we wish to <span class="keywordflow">do</span> rundown on.
01065 
01066 Return Value:
01067 
01068     NONE.
01069 
01070 --*/
01071 {
01072     <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">PCM_POST_BLOCK</a>      PostBlock;
01073     <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">PCM_NOTIFY_BLOCK</a>    NotifyBlock;
01074     KIRQL               OldIrql;
01075 
01076     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01077 
01078     <span class="keywordflow">if</span> ( IsListEmpty(&amp;(Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o8">PostBlockList</a>)) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ) {
01079         <span class="keywordflow">return</span>;
01080     }
01081 
01082     <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_API, CMS_NTAPI) {
01083         KdPrint((<span class="stringliteral">"CmNotifyRunDown: ethread:%08lx\n"</span>, Thread));
01084     }
01085 
01086     <a class="code" href="../../d0/d3/cmsubs3_8c.html#a4">CmpLockRegistryExclusive</a>();
01087 
01088         <span class="comment">//</span>
01089     <span class="comment">// Aquire exclusive access over the postlist(s)</span>
01090     <span class="comment">//</span>
01091     <span class="comment">// This is not needed (see the rule above)</span>
01092     <span class="comment">//LOCK_POST_LIST(); </span>
01093 
01094     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;OldIrql);
01095     <span class="keywordflow">while</span> (IsListEmpty(&amp;(Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o8">PostBlockList</a>)) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01096 
01097         <span class="comment">//</span>
01098         <span class="comment">// remove from thread list</span>
01099         <span class="comment">//</span>
01100         PostBlock = (<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">PCM_POST_BLOCK</a>)RemoveHeadList(&amp;(Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o8">PostBlockList</a>));
01101         PostBlock = CONTAINING_RECORD(
01102                         PostBlock,
01103                         <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">CM_POST_BLOCK</a>,
01104                         ThreadList
01105                         );
01106 
01107         <span class="comment">// Protect for multiple deletion of the same object</span>
01108         <a class="code" href="../../d1/d2/cmp_8h.html#a2">CmpClearListEntry</a>(&amp;(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o1">ThreadList</a>));
01109 
01110         <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_API, CMS_NTAPI) {
01111 <span class="preprocessor">#if DBG</span>
01112 <span class="preprocessor"></span>            <span class="keywordflow">if</span>(PostBlock-&gt;TraceIntoDebugger) {
01113                 KdPrint((<span class="stringliteral">"[CM]CmpNotifyRunDown: ethread:%08lx, PostBlock:%08lx\n"</span>, Thread,PostBlock));
01114             }
01115 <span class="preprocessor">#endif</span>
01116 <span class="preprocessor"></span>        }
01117 
01118         <span class="comment">//</span>
01119         <span class="comment">// Canceling a master notification implies canceling all the slave notifications</span>
01120         <span class="comment">// from the CancelPostList</span>
01121         <span class="comment">//</span>
01122         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d2/cmp_8h.html#a89">IsMasterPostBlock</a>(PostBlock)) {
01123             <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_API, CMS_NTAPI) {
01124 <span class="preprocessor">#if DBG</span>
01125 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(PostBlock-&gt;TraceIntoDebugger) {
01126                         KdPrint((<span class="stringliteral">"[CM]\tCmpNotifyRunDown: PostBlock:%08lx is a master block\n"</span>, PostBlock));
01127                 }
01128 <span class="preprocessor">#endif</span>
01129 <span class="preprocessor"></span>            }
01130             <span class="comment">//</span>
01131             <span class="comment">// at this point, CmpReportNotify and friends will no longer</span>
01132             <span class="comment">// attempt to post this post block.</span>
01133             <span class="comment">//</span>
01134             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d2/cmp_8h.html#a88">PostBlockType</a>(PostBlock) == <a class="code" href="../../d1/d2/cmp_8h.html#a335a205">PostAsyncUser</a>) {
01135                 <span class="comment">//</span>
01136                 <span class="comment">// report status and wake up any threads that might otherwise</span>
01137                 <span class="comment">// be stuck.  also drop any event references we hold</span>
01138                 <span class="comment">//</span>
01139                 <span class="comment">//  Sundown only: Use a 32bit IO_STATUS_BLOCK if the caller is 32bit. </span>
01140 
01141                 <span class="keywordflow">try</span> {
01142                     <a class="code" href="../../d1/d2/cmp_8h.html#a151">CmpSetIoStatus</a>(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">u</a>-&gt;<a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">AsyncUser</a>.<a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o2">IoStatusBlock</a>, 
01143                                    STATUS_NOTIFY_CLEANUP, 
01144                                    0L, 
01145                                    <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Wow64Process != NULL);
01146                 } except (EXCEPTION_EXECUTE_HANDLER) {
01147                     <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_API, CMS_EXCEPTION) {
01148                         KdPrint((<span class="stringliteral">"!!CmNotifyRundown: code:%08lx\n"</span>, GetExceptionCode()));
01149                     }
01150                     NOTHING;
01151                 }
01152 
01153                 <span class="keywordflow">if</span> (PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">u</a>-&gt;<a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">AsyncUser</a>.<a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o0">UserEvent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01154                     <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(
01155                         PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">u</a>-&gt;<a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">AsyncUser</a>.<a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o0">UserEvent</a>,
01156                         0,
01157                         FALSE
01158                         );
01159                     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">u</a>-&gt;<a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">AsyncUser</a>.<a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o0">UserEvent</a>);
01160                 }
01161 
01162                 <span class="comment">//</span>
01163                 <span class="comment">// Cancel the APC. Otherwise the rundown routine will also</span>
01164                 <span class="comment">// free the post block if the APC happens to be queued at</span>
01165                 <span class="comment">// this point. If the APC is queued, then the post block has</span>
01166                 <span class="comment">// already been removed from the notify list, so don't remove</span>
01167                 <span class="comment">// it again.</span>
01168                 <span class="comment">//</span>
01169                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/apcobj_8c.html#a4">KeRemoveQueueApc</a>(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">u</a>-&gt;<a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">AsyncUser</a>.<a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o1">Apc</a>)) {
01170 
01171                     <span class="comment">//</span>
01172                     <span class="comment">// remove from notify block's list</span>
01173                     <span class="comment">//</span>
01174                     <span class="comment">// Use Cmp variant to protect for multiple deletion of the same object</span>
01175                     <a class="code" href="../../d1/d2/cmp_8h.html#a1">CmpRemoveEntryList</a>(&amp;(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o0">NotifyList</a>));
01176                 }
01177             } <span class="keywordflow">else</span> {
01178                 <span class="comment">//</span>
01179                 <span class="comment">// remove from notify block's list</span>
01180                 <span class="comment">//</span>
01181                 <span class="comment">// Use Cmp variant to protect for multiple deletion of the same object</span>
01182                 <a class="code" href="../../d1/d2/cmp_8h.html#a1">CmpRemoveEntryList</a>(&amp;(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o0">NotifyList</a>));
01183             }
01184 
01185             <span class="comment">//</span>
01186             <span class="comment">// Cancel all slave Post requests that may be linked to self</span>
01187             <span class="comment">//</span>
01188             <a class="code" href="../../d0/d2/cmnotify_8c.html#a3">CmpCancelSlavePost</a>(PostBlock,NULL); <span class="comment">// we do not want delayed deref</span>
01189                         <span class="comment">//</span>
01190                         <span class="comment">// Free the slave Post blocks too</span>
01191                         <span class="comment">//</span>
01192                         <a class="code" href="../../d0/d2/cmnotify_8c.html#a4">CmpFreeSlavePost</a>(PostBlock);
01193         } <span class="keywordflow">else</span> {
01194 
01195             <a class="code" href="../../d1/d2/cmp_8h.html#a55">CMLOG</a>(CML_API, CMS_NTAPI) {
01196 <span class="preprocessor">#if DBG</span>
01197 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(PostBlock-&gt;TraceIntoDebugger) {
01198                     KdPrint((<span class="stringliteral">"[CM]\tCmpNotifyRunDown: PostBlock:%08lx is a slave block\n"</span>, PostBlock));
01199                 }
01200 <span class="preprocessor">#endif</span>
01201 <span class="preprocessor"></span>            }
01202             <span class="comment">//</span>
01203             <span class="comment">// Is a slave PostBlock, just remove self from the Notify PostList</span>
01204             <span class="comment">//</span>
01205             <span class="comment">// Use Cmp variant to protect for multiple deletion of the same object</span>
01206             <a class="code" href="../../d1/d2/cmp_8h.html#a1">CmpRemoveEntryList</a>(&amp;(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o0">NotifyList</a>));
01207 
01208             <span class="comment">//</span>
01209             <span class="comment">// and unchain from the Master CancelPostList</span>
01210             <span class="comment">//</span>
01211             <span class="comment">// Use Cmp variant to protect for multiple deletion of the same object</span>
01212             <a class="code" href="../../d1/d2/cmp_8h.html#a1">CmpRemoveEntryList</a>(&amp;(PostBlock-&gt;<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o2">CancelPostList</a>));
01213 
01214         }
01215 
01216         <span class="comment">//</span>
01217         <span class="comment">// Free the post block.  Use Ex call because PostBlocks are NOT</span>
01218         <span class="comment">// part of the global registry pool computation, but are instead</span>
01219         <span class="comment">// part of NonPagedPool with Quota.</span>
01220         <span class="comment">//</span>
01221         <a class="code" href="../../d7/d7/ntapi_8c.html#a36">CmpFreePostBlock</a>(PostBlock);
01222     }
01223 
01224     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
01225 
01226     <span class="comment">// This is not needed (see the rule above)</span>
01227     <span class="comment">//UNLOCK_POST_LIST();</span>
01228 
01229     <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
01230     <span class="keywordflow">return</span>;
01231 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="cm.h::CmQueryRegistryQuotaInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmQueryRegistryQuotaInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSYSTEM_REGISTRY_QUOTA_INFORMATION&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RegistryQuotaInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00092">92</a> of file <a class="el" href="../../d6/d0/cmgquota_8c-source.html">cmgquota.c</a>.
<p>
References <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00051">CmpGlobalQuota</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00063">CmpGlobalQuotaUsed</a>, and <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00074">MmSizeOfPagedPoolInBytes</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>.
<p>
<pre class="fragment"><div>00098                    :
00099 
00100     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry quota information
00101 
00102 Arguments:
00103 
00104     RegistryQuotaInformation - Supplies pointer to buffer that will <span class="keywordflow">return</span>
00105         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry quota information.
00106 
00107 Return Value:
00108 
00109     None.
00110 
00111 --*/
00112 
00113 {
00114     RegistryQuotaInformation-&gt;RegistryQuotaAllowed  = <a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a>;
00115     RegistryQuotaInformation-&gt;RegistryQuotaUsed     = <a class="code" href="../../d7/d0/cmdat2_8c.html#a9">CmpGlobalQuotaUsed</a>;
00116     RegistryQuotaInformation-&gt;PagedPoolSize         = <a class="code" href="../../d8/d0/cmdat3_8c.html#a18">MmSizeOfPagedPoolInBytes</a>;
00117 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="cm.h::CmSetRegistryQuotaInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmSetRegistryQuotaInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSYSTEM_REGISTRY_QUOTA_INFORMATION&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RegistryQuotaInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00121">121</a> of file <a class="el" href="../../d6/d0/cmgquota_8c-source.html">cmgquota.c</a>.
<p>
References <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00053">CM_MINIMUM_GLOBAL_QUOTA</a>, <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00059">CM_REGISTRY_WARNING_LEVEL</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00422">CM_WRAP_LIMIT</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00051">CmpGlobalQuota</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00037">CmpGlobalQuotaAllowed</a>, and <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00038">CmpGlobalQuotaWarning</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>.
<p>
<pre class="fragment"><div>00127                    :
00128 
00129     Sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry quota information.  The caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to have
00130     completed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> necessary security checks already.
00131 
00132 Arguments:
00133 
00134     RegistryQuotaInformation - Supplies pointer to buffer that provides
00135         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> registry quota information.
00136 
00137 Return Value:
00138 
00139     None.
00140 
00141 --*/
00142 
00143 {
00144     <a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a> = RegistryQuotaInformation-&gt;RegistryQuotaAllowed;
00145 
00146     <span class="comment">//</span>
00147     <span class="comment">// Sanity checks against insane values</span>
00148     <span class="comment">//</span>
00149     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a> &gt; <a class="code" href="../../d1/d2/cmp_8h.html#a69">CM_WRAP_LIMIT</a>) {
00150         <a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a> = <a class="code" href="../../d1/d2/cmp_8h.html#a69">CM_WRAP_LIMIT</a>;
00151     }
00152     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a> &lt; <a class="code" href="../../d5/d1/cmgquota_8c.html#a2">CM_MINIMUM_GLOBAL_QUOTA</a>) {
00153         <a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a> = <a class="code" href="../../d5/d1/cmgquota_8c.html#a2">CM_MINIMUM_GLOBAL_QUOTA</a>;
00154     }
00155 
00156     <span class="comment">//</span>
00157     <span class="comment">// Recompute the warning level</span>
00158     <span class="comment">//</span>
00159     <a class="code" href="../../d8/d9/cmapi_8c.html#a8">CmpGlobalQuotaWarning</a> = <a class="code" href="../../d5/d1/cmgquota_8c.html#a3">CM_REGISTRY_WARNING_LEVEL</a> * (<a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a> / 100);
00160 
00161     <a class="code" href="../../d8/d9/cmapi_8c.html#a7">CmpGlobalQuotaAllowed</a> = <a class="code" href="../../d7/d0/cmdat2_8c.html#a4">CmpGlobalQuota</a>;
00162 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="cm.h::CmSetTraceNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmSetTraceNotifyRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d9/cm_8h.html#a28">PCM_TRACE_NOTIFY_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NotifyRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Remove</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="cm.h::CmShutdownSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CmShutdownSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03944">3944</a> of file <a class="el" href="../../d2/d2/cmsysini_8c-source.html">cmsysini.c</a>.
<p>
References <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00081">CmpLockRegistryExclusive()</a>, <a class="el" href="../../d1/d2/cmsubs3_8c-source.html#l00116">CmpUnlockRegistry()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00115">CmpWorker()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00738">_REGISTRY_COMMAND::Command</a>, <a class="el" href="../../d9/d2/cmwrapr2_8c-source.html#l00029">CommandArea</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00076">HvShutdownComplete</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00724">REG_CMD_SHUTDOWN</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>03949                    :
03950 
03951     Shuts down <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
03952 
03953     Call to CmpWorkerThread, which will call back
03954     to <a class="code" href="../../d1/d2/cmp_8h.html#a243">CmpDoFlushAll</a>();
03955 
03956 Arguments:
03957 
03958     NONE
03959 
03960 Return Value:
03961 
03962     NONE
03963 
03964 --*/
03965 {
03966     <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html">REGISTRY_COMMAND</a> <a class="code" href="../../d8/d3/cmwrapr2_8c.html#a0">CommandArea</a>;
03967 
03968     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03969     <a class="code" href="../../d0/d3/cmsubs3_8c.html#a4">CmpLockRegistryExclusive</a>();
03970 
03971     <a class="code" href="../../d8/d3/cmwrapr2_8c.html#a0">CommandArea</a>.<a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o0">Command</a> = <a class="code" href="../../d1/d2/cmp_8h.html#a106">REG_CMD_SHUTDOWN</a>;
03972     <a class="code" href="../../d5/d3/cmworker_8c.html#a20">CmpWorker</a>(&amp;CommandArea);
03973 
03974     <a class="code" href="../../d7/d0/cmdat2_8c.html#a13">HvShutdownComplete</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;      <span class="comment">// Tell HvSyncHive to ignore all</span>
03975                                     <span class="comment">// further requests</span>
03976 
03977     <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>();
03978     <span class="keywordflow">return</span>;
03979 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a22" doxytag="cm.h::CmClassName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a22">CmClassName</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00091">91</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, and <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="cm.h::CmClassString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d7/d9/cm_8h.html#a23">CmClassString</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00092">92</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="cm.h::CmRegistryMachineHardwareDescriptionName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a3">CmRegistryMachineHardwareDescriptionName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00035">35</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, and <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="cm.h::CmRegistryMachineHardwareDescriptionSystemName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a4">CmRegistryMachineHardwareDescriptionSystemName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00037">37</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/config_2alpha_2init_8c-source.html#l00037">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00070">IoQueryDeviceDescription()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02008">KeSetup80387OrEmulate()</a>, and <a class="el" href="../../d8/d3/vdminit_8c-source.html#l00019">VdmpInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="cm.h::CmRegistryMachineHardwareDeviceMapName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a5">CmRegistryMachineHardwareDeviceMapName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00039">39</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, and <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="cm.h::CmRegistryMachineHardwareName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a2">CmRegistryMachineHardwareName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00034">34</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, and <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="cm.h::CmRegistryMachineHardwareOwnerMapName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a7">CmRegistryMachineHardwareOwnerMapName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00043">43</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="cm.h::CmRegistryMachineHardwareResourceMapName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a6">CmRegistryMachineHardwareResourceMapName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00041">41</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l02034">IopBuildCmResourceList()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00066">IopInitializeResourceMap()</a>, and <a class="el" href="../../d2/d7/report_8c-source.html#l00193">IoReportHalResourceUsage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="cm.h::CmRegistryMachineName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a1">CmRegistryMachineName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00033">33</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, and <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04000">IopProcessCriticalDeviceRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSet" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a9">CmRegistryMachineSystemCurrentControlSet</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00047">47</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01845">CmpInterlockedFunction()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03458">CmpSaveBootControlSet()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, and <a class="el" href="../../d5/d5/netboot_8c-source.html#l01982">IopSetupRemoteBootCard()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetControlBootLog" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a17">CmRegistryMachineSystemCurrentControlSetControlBootLog</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00063">63</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l09046">IopBootLog()</a>, and <a class="el" href="../../d3/d3/internal_8c-source.html#l09157">IopCopyBootLogRegistryToFile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetControlClass" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a14">CmRegistryMachineSystemCurrentControlSetControlClass</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00057">57</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l02525">IopCallDriverAddDevice()</a>, and <a class="el" href="../../d5/d5/netboot_8c-source.html#l01982">IopSetupRemoteBootCard()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetControlSafeBoot" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a15">CmRegistryMachineSystemCurrentControlSetControlSafeBoot</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00059">59</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, and <a class="el" href="../../d3/d3/internal_8c-source.html#l08822">IopSafebootDriverLoad()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetControlSessionManagerMemoryManagement" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a16">CmRegistryMachineSystemCurrentControlSetControlSessionManagerMemoryManagement</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00061">61</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, and <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetEnumName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a10">CmRegistryMachineSystemCurrentControlSetEnumName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00049">49</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02209">IopApplyFunctionToServiceInstances()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l02525">IopCallDriverAddDevice()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03960">IopCleanupDeviceRegistryValues()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05453">IopDeleteLegacyKey()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03759">IopDeviceObjectFromDeviceInstance()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03897">IopDeviceObjectToDeviceInstance()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02779">IopDriverLoadingFailed()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03443">IopIsDeviceInstanceEnabled()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l01891">IopMakeGloballyUniqueId()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l03762">IopProcessCriticalDevice()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01538">IopProcessNewDeviceNode()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00931">IopServiceInstanceToDeviceInstance()</a>, and <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetEnumRootName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a11">CmRegistryMachineSystemCurrentControlSetEnumRootName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00051">51</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00091">IopCreateMadeupNode()</a>, and <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00680">IopGetRootDevices()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetHardwareProfilesCurrent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a13">CmRegistryMachineSystemCurrentControlSetHardwareProfilesCurrent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00055">55</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01477">IopGetDeviceInstanceCsConfigFlags()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03443">IopIsDeviceInstanceEnabled()</a>, and <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01712">IopOpenCurrentHwProfileDeviceInstanceKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetServices" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a12">CmRegistryMachineSystemCurrentControlSetServices</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00053">53</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l00314">IopAddRemoteBootValuesToRegistry()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01339">IopOpenServiceEnumKeys()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01755">IopUnloadAttachedDriver()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03953">MiResolveImageReferences()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06717">MmCallDllInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="cm.h::CmRegistryMachineSystemCurrentControlSetServicesEventLog" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a18">CmRegistryMachineSystemCurrentControlSetServicesEventLog</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00065">65</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, and <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="cm.h::CmRegistryMachineSystemName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a8">CmRegistryMachineSystemName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00045">45</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02022">CmpInitializeSystemHive()</a>, and <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03862">IopStoreSystemPartitionInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="cm.h::CmRegistryRootName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a0">CmRegistryRootName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00032">32</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, and <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="cm.h::CmRegistryUserName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a19">CmRegistryUserName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00067">67</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, and <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="cm.h::CmTypeName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d7/d9/cm_8h.html#a20">CmTypeName</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00082">82</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>, and <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02008">KeSetup80387OrEmulate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="cm.h::CmTypeString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d7/d9/cm_8h.html#a21">CmTypeString</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/cm_8h-source.html#l00083">83</a> of file <a class="el" href="../../d8/d8/cm_8h-source.html">cm.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/cmdatini_8c-source.html#l00089">CmpInitializeRegistryNames()</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00223">pIoQueryBusDescription()</a>, and <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00565">pIoQueryDeviceDescription()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:06 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
