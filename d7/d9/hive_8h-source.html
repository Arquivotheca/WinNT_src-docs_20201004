<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hive.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hive.h</h1><a href="../../d6/d0/hive_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    hive.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the private (internal) header file for the</span>
00012 <span class="comment">    direct memory loaded hive manager.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Bryan M. Willman (bryanwi) 28-May-91</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">Revision History:</span>
00021 <span class="comment"></span>
00022 <span class="comment">    26-Mar-92 bryanwi - changed to type 1.0 hive format</span>
00023 <span class="comment"></span>
00024 <span class="comment">    13-Jan-99 Dragos C. Sambotin (dragoss) - factoring the data structure declarations</span>
00025 <span class="comment">        in \nt\private\ntos\inc\hivedata.h :: to be available from outside.</span>
00026 <span class="comment"></span>
00027 <span class="comment"></span>
00028 <span class="comment">--*/</span>
00029 
00030 <span class="preprocessor">#ifndef _HIVE_</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#define _HIVE_</span>
00032 <span class="preprocessor"></span>
00033 <span class="comment">// Hive data structure declarations</span>
00034 <span class="comment">// file location: \nt\private\ntos\inc</span>
00035 <span class="preprocessor">#include "<a class="code" href="../../d0/d1/hivedata_8h.html">hivedata.h</a>"</span>
00036 
00037 <span class="preprocessor">#if DBG</span>
00038 <span class="preprocessor"></span>
00039 <span class="keyword">extern</span> ULONG HvHiveChecking;
00040 
00041 <span class="preprocessor">#define DHvCheckHive(a) if(HvHiveChecking) ASSERT(HvCheckHive(a,NULL) == 0)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define DHvCheckBin(h,a)  if(HvHiveChecking) ASSERT(HvCheckBin(h,a,NULL) == 0)</span>
00043 <span class="preprocessor"></span>
00044 <span class="preprocessor">#else</span>
<a name="l00045"></a><a class="code" href="../../d6/d0/hive_8h.html#a0">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define DHvCheckHive(a)</span>
<a name="l00046"></a><a class="code" href="../../d6/d0/hive_8h.html#a1">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define DHvCheckBin(h,a)</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
<a name="l00049"></a><a class="code" href="../../d6/d0/hive_8h.html#a2">00049</a> <span class="preprocessor">#define ROUND_UP(a, b)  \</span>
00050 <span class="preprocessor">    ( ((ULONG)(a) + (ULONG)(b) - 1) &amp; ~((ULONG)(b) - 1) )</span>
00051 <span class="preprocessor"></span>
00052 
00053 <span class="comment">//</span>
00054 <span class="comment">// tombstone for an HBIN that is not resident in memory.  This list is searched</span>
00055 <span class="comment">// before any new HBIN is added.</span>
00056 <span class="comment">//</span>
00057 
<a name="l00058"></a><a class="code" href="../../d6/d0/hive_8h.html#a3">00058</a> <span class="preprocessor">#define ASSERT_LISTENTRY(ListEntry) \</span>
00059 <span class="preprocessor">    ASSERT((ListEntry)-&gt;Flink-&gt;Blink==ListEntry); \</span>
00060 <span class="preprocessor">    ASSERT((ListEntry)-&gt;Blink-&gt;Flink==ListEntry);</span>
00061 <span class="preprocessor"></span>
00062 <span class="comment">//</span>
00063 <span class="comment">// ===== Hive Private Procedure Prototypes =====</span>
00064 <span class="comment">//</span>
00065 <a class="code" href="../../d7/d4/struct__HBIN.html">PHBIN</a>
00066 <a class="code" href="../../d7/d0/hivebin_8c.html#a1">HvpAddBin</a>(
00067     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
00068     ULONG           NewSize,
00069     HSTORAGE_TYPE   Type
00070     );
00071 
00072 <a class="code" href="../../d2/d8/struct__HMAP__ENTRY.html">PHMAP_ENTRY</a>
00073 <a class="code" href="../../d8/d0/hivecell_8c.html#a14">HvpGetCellMap</a>(
00074     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00075     HCELL_INDEX Cell
00076     );
00077 
00078 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00079 <a class="code" href="../../d7/d1/hivemap_8c.html#a12">HvpFreeMap</a>(
00080     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
00081     <a class="code" href="../../d1/d8/struct__HMAP__DIRECTORY.html">PHMAP_DIRECTORY</a> Dir,
00082     ULONG           Start,
00083     ULONG           End
00084     );
00085 
00086 BOOLEAN
00087 <a class="code" href="../../d7/d1/hivemap_8c.html#a13">HvpAllocateMap</a>(
00088     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
00089     <a class="code" href="../../d1/d8/struct__HMAP__DIRECTORY.html">PHMAP_DIRECTORY</a> Dir,
00090     ULONG           Start,
00091     ULONG           End
00092     );
00093 
00094 BOOLEAN
00095 <a class="code" href="../../d0/d2/hivesync_8c.html#a11">HvpGrowLog1</a>(
00096     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00097     ULONG   Count
00098     );
00099 
00100 BOOLEAN
00101 <a class="code" href="../../d0/d2/hivesync_8c.html#a12">HvpGrowLog2</a>(
00102     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00103     ULONG   Size
00104     );
00105 
00106 ULONG
00107 <a class="code" href="../../d9/d1/hivesum_8c.html#a0">HvpHeaderCheckSum</a>(
00108     <a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html">PHBASE_BLOCK</a>    BaseBlock
00109     );
00110 
00111 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00112 <a class="code" href="../../d7/d1/hivemap_8c.html#a9">HvpBuildMap</a>(
00113     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00114     PVOID   Image,
00115     PHCELL_INDEX TailDisplay OPTIONAL
00116     );
00117 
00118 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00119 <a class="code" href="../../d7/d1/hivemap_8c.html#a6">HvpBuildMapAndCopy</a>(
00120     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00121     PVOID   Image,
00122     PHCELL_INDEX TailDisplay OPTIONAL
00123     );
00124 
00125 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00126 <a class="code" href="../../d7/d1/hivemap_8c.html#a7">HvpInitMap</a>(
00127     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive
00128     );
00129 
00130 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00131 <a class="code" href="../../d7/d1/hivemap_8c.html#a11">HvpCleanMap</a>(
00132     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive
00133     );
00134 
00135 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00136 <a class="code" href="../../d7/d1/hivemap_8c.html#a8">HvpEnlistBinInMap</a>(
00137     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00138     ULONG   Length,
00139     <a class="code" href="../../d7/d4/struct__HBIN.html">PHBIN</a>   Bin,
00140     ULONG   Offset,
00141     PHCELL_INDEX TailDisplay OPTIONAL
00142     );
00143 
00144 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00145 <a class="code" href="../../d5/d1/hiveinit_8c.html#a2">HvpFreeAllocatedBins</a>(
00146     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive
00147     );
00148 
00149 BOOLEAN
00150 <a class="code" href="../../d0/d2/hivesync_8c.html#a14">HvpDoWriteHive</a>(
00151     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
00152     ULONG           FileType
00153     );
00154 
00155 <span class="keyword">struct </span><a class="code" href="../../d4/d9/struct__CELL__DATA.html">_CELL_DATA</a> *
00156 <a class="code" href="../../d8/d0/hivecell_8c.html#a13">HvpGetCellFlat</a>(
00157     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00158     HCELL_INDEX Cell
00159     );
00160 
00161 <span class="keyword">struct </span><a class="code" href="../../d4/d9/struct__CELL__DATA.html">_CELL_DATA</a> *
00162 <a class="code" href="../../d8/d0/hivecell_8c.html#a12">HvpGetCellPaged</a>(
00163     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00164     HCELL_INDEX Cell
00165     );
00166 
00167 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00168 <a class="code" href="../../d8/d0/hivecell_8c.html#a18">HvpEnlistFreeCell</a>(
00169     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00170     HCELL_INDEX Cell,
00171     ULONG      Size,
00172     HSTORAGE_TYPE   Type,
00173     BOOLEAN CoalesceForward,
00174     PHCELL_INDEX TailDisplay OPTIONAL
00175     );
00176 
00177 BOOLEAN
00178 <a class="code" href="../../d7/d1/hivemap_8c.html#a10">HvpEnlistFreeCells</a>(
00179     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00180     <a class="code" href="../../d7/d4/struct__HBIN.html">PHBIN</a>   Bin,
00181     ULONG   BinOffset,
00182     PHCELL_INDEX TailDisplay OPTIONAL
00183     );
00184 
00185 
00186 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00187 <a class="code" href="../../d8/d0/hivecell_8c.html#a19">HvpDelistFreeCell</a>(
00188     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00189     <a class="code" href="../../d8/d4/struct__HCELL.html">PHCELL</a>  Pcell,
00190     HSTORAGE_TYPE Type,
00191     PHCELL_INDEX TailDisplay OPTIONAL
00192     );
00193 
00194 <span class="comment">//</span>
00195 <span class="comment">// ===== Hive Public Procedure Prototypes =====</span>
00196 <span class="comment">//</span>
<a name="l00197"></a><a class="code" href="../../d6/d0/hive_8h.html#a4">00197</a> <span class="preprocessor">#define HINIT_CREATE            0</span>
<a name="l00198"></a><a class="code" href="../../d6/d0/hive_8h.html#a5">00198</a> <span class="preprocessor"></span><span class="preprocessor">#define HINIT_MEMORY            1</span>
<a name="l00199"></a><a class="code" href="../../d6/d0/hive_8h.html#a6">00199</a> <span class="preprocessor"></span><span class="preprocessor">#define HINIT_FILE              2</span>
<a name="l00200"></a><a class="code" href="../../d6/d0/hive_8h.html#a7">00200</a> <span class="preprocessor"></span><span class="preprocessor">#define HINIT_MEMORY_INPLACE    3</span>
<a name="l00201"></a><a class="code" href="../../d6/d0/hive_8h.html#a8">00201</a> <span class="preprocessor"></span><span class="preprocessor">#define HINIT_FLAT              4</span>
00202 <span class="preprocessor"></span>
<a name="l00203"></a><a class="code" href="../../d6/d0/hive_8h.html#a9">00203</a> <span class="preprocessor">#define HIVE_VOLATILE           1</span>
<a name="l00204"></a><a class="code" href="../../d6/d0/hive_8h.html#a10">00204</a> <span class="preprocessor"></span><span class="preprocessor">#define HIVE_NOLAZYFLUSH        2</span>
<a name="l00205"></a><a class="code" href="../../d6/d0/hive_8h.html#a11">00205</a> <span class="preprocessor"></span><span class="preprocessor">#define HIVE_HAS_BEEN_REPLACED  4</span>
00206 <span class="preprocessor"></span>
00207 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00208 <a class="code" href="../../d5/d1/hiveinit_8c.html#a3">HvInitializeHive</a>(
00209     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>                  Hive,
00210     ULONG                   OperationType,
00211     ULONG                   HiveFlags,
00212     ULONG                   FileTypes,
00213     PVOID                   HiveData OPTIONAL,
00214     PALLOCATE_ROUTINE       AllocateRoutine,
00215     PFREE_ROUTINE           FreeRoutine,
00216     <a class="code" href="../../d0/d1/hivedata_8h.html#a65">PFILE_SET_SIZE_ROUTINE</a>  FileSetSizeRoutine,
00217     <a class="code" href="../../d0/d1/hivedata_8h.html#a67">PFILE_WRITE_ROUTINE</a>     FileWriteRoutine,
00218     <a class="code" href="../../d0/d1/hivedata_8h.html#a68">PFILE_READ_ROUTINE</a>      FileReadRoutine,
00219     <a class="code" href="../../d0/d1/hivedata_8h.html#a69">PFILE_FLUSH_ROUTINE</a>     FileFlushRoutine,
00220     ULONG                   Cluster,
00221     PUNICODE_STRING         FileName
00222     );
00223 
00224 BOOLEAN
00225 <a class="code" href="../../d0/d2/hivesync_8c.html#a13">HvSyncHive</a>(
00226     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive
00227     );
00228 
00229 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00230 <a class="code" href="../../d0/d2/hivesync_8c.html#a15">HvWriteHive</a>(
00231     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive
00232     );
00233 
00234 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00235 <a class="code" href="../../d6/d1/hiveload_8c.html#a19">HvLoadHive</a>(
00236     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00237     PHCELL_INDEX TailDisplay OPTIONAL
00238     );
00239 
00240 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00241 <a class="code" href="../../d0/d2/hivesync_8c.html#a6">HvRefreshHive</a>(
00242     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive
00243     );
00244 
00245 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00246 <a class="code" href="../../d6/d0/hive_8h.html#a38">HvReadInMemoryHive</a>(
00247     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00248     PVOID   *HiveImage
00249     );
00250 
00251 ULONG
00252 <a class="code" href="../../d9/d0/hivechek_8c.html#a9">HvCheckHive</a>(
00253     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00254     PULONG  Storage OPTIONAL
00255     );
00256 
00257 ULONG
00258 <a class="code" href="../../d9/d0/hivechek_8c.html#a10">HvCheckBin</a>(
00259     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
00260     <a class="code" href="../../d7/d4/struct__HBIN.html">PHBIN</a>   Bin,
00261     PULONG  Storage
00262     );
00263 
00264 BOOLEAN
00265 <a class="code" href="../../d0/d2/hivesync_8c.html#a7">HvMarkCellDirty</a>(
00266     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00267     HCELL_INDEX Cell
00268     );
00269 
00270 BOOLEAN
00271 <a class="code" href="../../d0/d2/hivesync_8c.html#a8">HvIsBinDirty</a>(
00272     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
00273     IN HCELL_INDEX Cell
00274     );
00275 
00276 BOOLEAN
00277 <a class="code" href="../../d0/d2/hivesync_8c.html#a9">HvMarkDirty</a>(
00278     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00279     HCELL_INDEX Start,
00280     ULONG       Length
00281     );
00282 
00283 BOOLEAN
00284 <a class="code" href="../../d0/d2/hivesync_8c.html#a10">HvMarkClean</a>(
00285     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00286     HCELL_INDEX Start,
00287     ULONG       Length
00288     );
00289 
<a name="l00290"></a><a class="code" href="../../d6/d0/hive_8h.html#a12">00290</a> <span class="preprocessor">#define HvGetCell(Hive, Cell)   (((Hive)-&gt;GetCellRoutine)(Hive, Cell))</span>
00291 <span class="preprocessor"></span>
<a name="l00292"></a><a class="code" href="../../d6/d0/hive_8h.html#a13">00292</a> <span class="preprocessor">#define HvpGetHCell(Hive, Cell) ( USE_OLD_CELL(Hive) ?                      \</span>
00293 <span class="preprocessor">                                  CONTAINING_RECORD(HvGetCell(Hive,Cell),   \</span>
00294 <span class="preprocessor">                                                    HCELL,                  \</span>
00295 <span class="preprocessor">                                                    u.OldCell.u.UserData) : \</span>
00296 <span class="preprocessor">                                  CONTAINING_RECORD(HvGetCell(Hive,Cell),   \</span>
00297 <span class="preprocessor">                                                    HCELL,                  \</span>
00298 <span class="preprocessor">                                                    u.NewCell.u.UserData))</span>
00299 <span class="preprocessor"></span>
00300 
00301 LONG
00302 <a class="code" href="../../d8/d0/hivecell_8c.html#a15">HvGetCellSize</a>(
00303     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00304     PVOID       Address
00305     );
00306 
00307 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
00308 <a class="code" href="../../d8/d0/hivecell_8c.html#a16">HvAllocateCell</a>(
00309     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
00310     ULONG           NewSize,
00311     HSTORAGE_TYPE   Type
00312     );
00313 
00314 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00315 <a class="code" href="../../d8/d0/hivecell_8c.html#a17">HvFreeCell</a>(
00316     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00317     HCELL_INDEX Cell
00318     );
00319 
00320 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
00321 <a class="code" href="../../d8/d0/hivecell_8c.html#a20">HvReallocateCell</a>(
00322     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00323     HCELL_INDEX Cell,
00324     ULONG       NewSize
00325     );
00326 
00327 BOOLEAN
00328 <a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(
00329     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00330     HCELL_INDEX Cell
00331     );
00332 
00333 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00334 <a class="code" href="../../d2/d1/hivefree_8c.html#a0">HvFreeHive</a>(
00335     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive
00336     );
00337 
00338 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00339 <a class="code" href="../../d2/d1/hivefree_8c.html#a1">HvFreeHivePartial</a>(
00340     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00341     HCELL_INDEX Start,
00342     HSTORAGE_TYPE Type
00343     );
00344 
00345 <span class="preprocessor">#endif // _HIVE_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:17 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
