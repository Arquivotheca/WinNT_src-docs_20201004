<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: uob.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>uob.c File Reference</h1><code>#include &lt;nt.h&gt;</code><br>
<code>#include &lt;ntrtl.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>

<p>
<a href="../../d8/d8/uob_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a3">TestParent</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a4">TestChild</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a5">DumpObjectDirs</a> (IN PCH DirName, IN ULONG Level)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a6">main</a> (int argc, char **argv, char **envp, int DebugFlag)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a0">DirTypeName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a1">LinkTypeName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a> [4096]</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="uob.c::DumpObjectDirs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DumpObjectDirs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCH&nbsp;</td>
          <td class="mdname" nowrap> <em>DirName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Level</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00039">39</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00029">DirTypeName</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00030">LinkTypeName</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00032">NtCreateDirectoryObject()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00247">NtOpenSymbolicLinkObject()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00333">NtQuerySymbolicLinkObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00399">RtlEqualString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/uob_8c-source.html#l00232">TestParent()</a>.
<p>
<pre class="fragment"><div>00043 {
00044     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00045     STRING <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>;
00046     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00047     ULONG Context, Length;
00048     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00049     BOOLEAN RestartScan;
00050     POBJECT_DIRECTORY_INFORMATION DirInfo;
00051     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> DirInfoBuffer[ 256 ];
00052     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> SubDirName[ 128 ];
00053     STRING LinkName;
00054     STRING LinkTarget;
00055     HANDLE LinkHandle;
00056 
00057     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;Name, DirName );
00058     InitializeObjectAttributes( &amp;ObjectAttributes,
00059                                 &amp;Name,
00060                                 OBJ_OPENIF | OBJ_CASE_INSENSITIVE,
00061                                 NULL,
00062                                 NULL
00063                               );
00064     <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;Handle,
00065                              DIRECTORY_ALL_ACCESS,
00066                              &amp;ObjectAttributes
00067                            );
00068 
00069     DirInfo = (POBJECT_DIRECTORY_INFORMATION)&amp;DirInfoBuffer;
00070     RestartScan = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00071     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00072         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a2">NtQueryDirectoryObject</a>( Handle,
00073                                          (PVOID)DirInfo,
00074                                          <span class="keyword">sizeof</span>( DirInfoBuffer ),
00075                                          TRUE,
00076                                          RestartScan,
00077                                          &amp;Context,
00078                                          &amp;Length
00079                                        );
00080         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00081             <span class="keywordflow">break</span>;
00082             }
00083 
00084         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"%s%s%Z - %Z"</span>,
00085                  DirName,
00086                  Level ? <span class="stringliteral">"\\"</span> : <span class="stringliteral">""</span>,
00087                  &amp;DirInfo-&gt;Name,
00088                  &amp;DirInfo-&gt;TypeName
00089                  );
00090         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/string_8c.html#a11">RtlEqualString</a>( &amp;DirInfo-&gt;TypeName, &amp;DirTypeName, TRUE )) {
00091             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"\n"</span> );
00092             strcpy( SubDirName, DirName );
00093             <span class="keywordflow">if</span> (Level) {
00094                 strcat( SubDirName, <span class="stringliteral">"\\"</span> );
00095                 }
00096             strcat( SubDirName, DirInfo-&gt;Name.Buffer );
00097             <a class="code" href="../../d7/d9/uob_8c.html#a5">DumpObjectDirs</a>( SubDirName, Level+1 );
00098             }
00099         <span class="keywordflow">else</span>
00100         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/string_8c.html#a11">RtlEqualString</a>( &amp;DirInfo-&gt;TypeName, &amp;LinkTypeName, TRUE )) {
00101             strcpy( SubDirName, DirName );
00102             <span class="keywordflow">if</span> (Level) {
00103                 strcat( SubDirName, <span class="stringliteral">"\\"</span> );
00104                 }
00105             strcat( SubDirName, DirInfo-&gt;Name.Buffer );
00106             <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkName, SubDirName );
00107             InitializeObjectAttributes( &amp;ObjectAttributes,
00108                                         &amp;LinkName,
00109                                         0,
00110                                         NULL,
00111                                         NULL
00112                                       );
00113             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a6">NtOpenSymbolicLinkObject</a>( &amp;LinkHandle,
00114                                                SYMBOLIC_LINK_ALL_ACCESS,
00115                                                &amp;ObjectAttributes
00116                                              );
00117             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00118                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">" - unable to open symbolic link (%X)\n"</span>, Status  );
00119                 }
00120             <span class="keywordflow">else</span> {
00121                 LinkTarget.MaximumLength = <span class="keyword">sizeof</span>( SubDirName );
00122                 LinkTarget.Length = 0;
00123                 LinkTarget.Buffer = SubDirName;
00124                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a7">NtQuerySymbolicLinkObject</a>( LinkHandle,
00125                                                     &amp;LinkTarget
00126                                                   );
00127                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00128                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">" - unable to query symbolic link target (%X)\n"</span>, Status );
00129                     }
00130                 <span class="keywordflow">else</span> {
00131                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">" =&gt; %Z\n"</span>, &amp;LinkTarget );
00132                     }
00133 
00134                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( LinkHandle );
00135                 }
00136             }
00137         <span class="keywordflow">else</span> {
00138             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"\n"</span> );
00139             }
00140 
00141         RestartScan = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00142         }
00143 
00144     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( Handle );
00145 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="uob.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>envp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>DebugFlag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00149">149</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00147">ParameterBuffer</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l00813">RtlCreateUserProcess()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00624">TestChild()</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00232">TestParent()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00155 {
00156     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00157     STRING ImageName;
00158     PRTL_USER_PROCESS_PARAMETERS ProcessParameters;
00159     RTL_USER_PROCESS_INFORMATION ProcessInformation;
00160 
00161     <span class="keywordflow">if</span> (argc == 1) {
00162         <a class="code" href="../../d7/d9/uob_8c.html#a3">TestParent</a>();
00163 
00164         Parameters[ RTL_USER_PROC_PARAMS_IMAGEFILE ] = argv[ 0 ];
00165 
00166         Parameters[ RTL_USER_PROC_PARAMS_CMDLINE ] = <span class="stringliteral">" CHILD"</span>;
00167 
00168         Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG ] =
00169              DebugFlag ? <span class="stringliteral">"1"</span> : <span class="stringliteral">"0"</span>;
00170 
00171         Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG+1 ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00172 
00173         Arguments[ 0 ] = argv[ 0 ];
00174         Arguments[ 1 ] = <span class="stringliteral">"CHILD"</span>;
00175         Arguments[ 2 ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00176 
00177         ProcessParameters = (PRTL_USER_PROCESS_PARAMETERS)<a class="code" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a>;
00178         ProcessParameters-&gt;Length = 0;
00179         ProcessParameters-&gt;MaximumLength = <span class="keyword">sizeof</span>( <a class="code" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a> );
00180 
00181         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RtlVectorsToProcessParameters( Arguments,
00182                                                 envp,
00183                                                 Parameters,
00184                                                 ProcessParameters
00185                                               );
00186         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00187             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"RtlVectorToProcessParameters failed - Status = %X\n"</span>,
00188                       Status
00189                     );
00190             }
00191         <span class="keywordflow">else</span> {
00192             <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;ImageName, <span class="stringliteral">"\\C:\\TMP\\UOB.EXE"</span> );
00193             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a12">RtlCreateUserProcess</a>( &amp;ImageName,
00194                                            NULL,
00195                                            NULL,
00196                                            NULL,
00197                                            TRUE,
00198                                            NULL,
00199                                            NULL,
00200                                            ProcessParameters,
00201                                            &amp;ProcessInformation,
00202                                            NULL
00203                                          );
00204             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00205                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"RtlCreateUserProcess( %Z ) failed - Status = %X\n"</span>,
00206                           &amp;ImageName, Status
00207                         );
00208                 }
00209             <span class="keywordflow">else</span> {
00210                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>( ProcessInformation.Thread, NULL );
00211                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>( ProcessInformation.Process,
00212                                                 FALSE,
00213                                                 (PLARGE_INTEGER)NULL
00214                                               );
00215                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00216                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtWaitForSingleObject failed - Status = %X\n"</span>,
00217                               Status
00218                             );
00219                     }
00220                 }
00221             }
00222         }
00223     <span class="keywordflow">else</span> {
00224         <a class="code" href="../../d7/d9/uob_8c.html#a4">TestChild</a>();
00225         }
00226 
00227     <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00228 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="uob.c::TestChild" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID TestChild           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00624">624</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00063">DirectoryHandle</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00048">DirectoryName</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00144">NtOpenDirectoryObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/uob_8c-source.html#l00149">main()</a>.
<p>
<pre class="fragment"><div>00625 {
00626     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00627     STRING <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>;
00628     HANDLE <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>;
00629     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00630 
00631     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00632 
00633     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Entering Object Manager User Mode Child Test Program\n"</span> );
00634 
00635     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;DirectoryName, <span class="stringliteral">"\\ExclusiveDir"</span> );
00636     InitializeObjectAttributes( &amp;ObjectAttributes,
00637                                 &amp;DirectoryName,
00638                                 OBJ_CASE_INSENSITIVE,
00639                                 NULL,
00640                                 NULL
00641                               );
00642     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00643                                     DIRECTORY_ALL_ACCESS,
00644                                     &amp;ObjectAttributes
00645                                   );
00646     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00647         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>,
00648                  &amp;DirectoryName, Status );
00649         }
00650 
00651     InitializeObjectAttributes( &amp;ObjectAttributes,
00652                                 &amp;DirectoryName,
00653                                 OBJ_CASE_INSENSITIVE | OBJ_EXCLUSIVE,
00654                                 NULL,
00655                                 NULL
00656                               );
00657     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00658                                     DIRECTORY_ALL_ACCESS,
00659                                     &amp;ObjectAttributes
00660                                   );
00661     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00662         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>,
00663                  &amp;DirectoryName, Status );
00664         }
00665 
00666     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Exiting Object Manager User Mode Child Test Program with Status = %X\n"</span>, Status );
00667 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="uob.c::TestParent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID TestParent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00232">232</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00063">DirectoryHandle</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00048">DirectoryName</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00029">DirTypeName</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00039">DumpObjectDirs()</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00030">LinkTypeName</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00032">NtCreateDirectoryObject()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00134">NtCreateSection()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00052">NtCreateSymbolicLinkObject()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00414">NtMakeTemporaryObject()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00144">NtOpenDirectoryObject()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/uob_8c-source.html#l00149">main()</a>.
<p>
<pre class="fragment"><div>00233 {
00234     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00235     STRING <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>;
00236     STRING LinkName;
00237     STRING LinkTarget;
00238     STRING SectionName;
00239     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00240     HANDLE <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>, LinkHandle, SectionHandle;
00241     ULONG ReturnedLength;
00242     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> ObjectInfoBuffer[ 512 ];
00243     OBJECT_BASIC_INFORMATION ObjectBasicInfo;
00244     POBJECT_NAME_INFORMATION ObjectNameInfo;
00245     POBJECT_TYPE_INFORMATION ObjectTypeInfo;
00246     LARGE_INTEGER SectionSize;
00247 
00248     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00249 
00250     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Entering Object Manager User Mode Test Program\n"</span> );
00251 
00252     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;SectionName, <span class="stringliteral">"\\A:\\OSO001.MSG"</span> );
00253     InitializeObjectAttributes( &amp;ObjectAttributes,
00254                                 &amp;SectionName,
00255                                 OBJ_OPENIF | OBJ_CASE_INSENSITIVE,
00256                                 NULL,
00257                                 NULL
00258                               );
00259 
00260     SectionSize.LowPart = 0x1000;
00261     SectiinSize.HighPart = 0;
00262     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/creasect_8c.html#a19">NtCreateSection</a>( &amp;SectionHandle,
00263                               GENERIC_READ,
00264                               &amp;ObjectAttributes,
00265                               &amp;SectionSize,
00266                               PAGE_READONLY,
00267                               SEC_RESERVE,
00268                               NULL
00269                             );
00270     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00271         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z section object (%X) [OK]\n"</span>, &amp;SectionName, Status );
00272         }
00273 
00274     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;DirectoryName, <span class="stringliteral">"\\Drives"</span> );
00275     InitializeObjectAttributes( &amp;ObjectAttributes,
00276                                 &amp;DirectoryName,
00277                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00278                                 NULL,
00279                                 (PSECURITY_DESCRIPTOR)1
00280 
00281                               );
00282     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Length = 0;
00283     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;DirectoryHandle,
00284                                       -1,
00285                                       &amp;ObjectAttributes
00286                                     );
00287     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00288         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00289                  &amp;DirectoryName, Status );
00290         }
00291 
00292     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;DirectoryName, <span class="stringliteral">"\\Drives"</span> );
00293     InitializeObjectAttributes( &amp;ObjectAttributes,
00294                                 &amp;DirectoryName,
00295                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00296                                 NULL,
00297                                 (PSECURITY_DESCRIPTOR)1
00298 
00299                               );
00300     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Length = 0;
00301     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;DirectoryHandle,
00302                                       DIRECTORY_ALL_ACCESS,
00303                                       &amp;ObjectAttributes
00304                                     );
00305     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00306         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00307                  &amp;DirectoryName, Status );
00308         }
00309 
00310     InitializeObjectAttributes( &amp;ObjectAttributes,
00311                                 &amp;DirectoryName,
00312                                 -1,
00313                                 NULL,
00314                                 (PSECURITY_DESCRIPTOR)1
00315 
00316                               );
00317     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;DirectoryHandle,
00318                                       DIRECTORY_ALL_ACCESS,
00319                                       &amp;ObjectAttributes
00320                                     );
00321     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00322         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00323                  &amp;DirectoryName, Status );
00324         }
00325 
00326     InitializeObjectAttributes( &amp;ObjectAttributes,
00327                                 &amp;DirectoryName,
00328                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00329                                 NULL,
00330                                 (PSECURITY_DESCRIPTOR)1
00331 
00332                               );
00333     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;DirectoryHandle,
00334                                       DIRECTORY_ALL_ACCESS,
00335                                       &amp;ObjectAttributes
00336                                     );
00337     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00338         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00339                  &amp;DirectoryName, Status );
00340         }
00341 
00342     InitializeObjectAttributes( &amp;ObjectAttributes,
00343                                 &amp;DirectoryName,
00344                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00345                                 NULL,
00346                                 NULL
00347 
00348                               );
00349     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;DirectoryHandle,
00350                                       DIRECTORY_ALL_ACCESS,
00351                                       &amp;ObjectAttributes
00352                                     );
00353     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00354         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X)\n"</span>,
00355                  &amp;DirectoryName, Status );
00356         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00357         }
00358 
00359     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( DirectoryHandle );
00360     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00361         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z directory object handle - %lx (%X)\n"</span>,
00362                  &amp;DirectoryName,
00363                  DirectoryHandle,
00364                  Status
00365                  );
00366         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00367         }
00368 
00369     InitializeObjectAttributes( &amp;ObjectAttributes,
00370                                 &amp;DirectoryName,
00371                                 OBJ_CASE_INSENSITIVE,
00372                                 NULL,
00373                                 NULL
00374                               );
00375     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00376                                     DIRECTORY_ALL_ACCESS,
00377                                     &amp;ObjectAttributes
00378                                   );
00379     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00380         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X)\n"</span>,
00381                  &amp;DirectoryName, Status );
00382         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00383         }
00384 
00385     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a>( DirectoryHandle,
00386                             ObjectBasicInformation,
00387                             &amp;ObjectBasicInfo,
00388                             <span class="keyword">sizeof</span>( ObjectBasicInfo ),
00389                             &amp;ReturnedLength
00390                           );
00391     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00392         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectBasicInfo ) failed - Status == %X\n"</span>,
00393                  DirectoryHandle,
00394                  Status
00395                  );
00396         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00397         }
00398     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectBasicInfo ) returned %lx bytes\n"</span>,
00399              DirectoryHandle,
00400              ReturnedLength
00401              );
00402     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Attributes = %lx\n"</span>,          ObjectBasicInfo.Attributes );
00403     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    GrantedAccess = %lx\n"</span>,       ObjectBasicInfo.GrantedAccess );
00404     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    HandleCount = %lx\n"</span>,         ObjectBasicInfo.HandleCount );
00405     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    PointerCount = %lx\n"</span>,        ObjectBasicInfo.PointerCount );
00406     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    PagedPoolCharge = %lx\n"</span>,     ObjectBasicInfo.PagedPoolCharge );
00407     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    NonPagedPoolCharge = %lx\n"</span>,  ObjectBasicInfo.NonPagedPoolCharge );
00408     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    NameInfoSize = %lx\n"</span>,        ObjectBasicInfo.NameInfoSize );
00409     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    TypeInfoSize = %lx\n"</span>,        ObjectBasicInfo.TypeInfoSize );
00410     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    SecurityDescriptorSize = %lx\n"</span>, ObjectBasicInfo.SecurityDescriptorSize );
00411 
00412     ObjectNameInfo = (POBJECT_NAME_INFORMATION)ObjectInfoBuffer;
00413     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a>( DirectoryHandle,
00414                             ObjectNameInformation,
00415                             ObjectNameInfo,
00416                             <span class="keyword">sizeof</span>( ObjectInfoBuffer ),
00417                             &amp;ReturnedLength
00418                           );
00419     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00420         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectNameInfo ) failed - Status == %X\n"</span>,
00421                  DirectoryHandle,
00422                  Status
00423                  );
00424         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00425         }
00426     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectNameInfo ) returned %lx bytes\n"</span>,
00427              DirectoryHandle,
00428              ReturnedLength
00429              );
00430     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Name = (%ld,%ld) '%Z'\n"</span>,
00431              ObjectNameInfo-&gt;Name.MaximumLength,
00432              ObjectNameInfo-&gt;Name.Length,
00433              &amp;ObjectNameInfo-&gt;Name
00434            );
00435 
00436 
00437     ObjectTypeInfo = (POBJECT_TYPE_INFORMATION)ObjectInfoBuffer;
00438     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a>( DirectoryHandle,
00439                             ObjectTypeInformation,
00440                             ObjectTypeInfo,
00441                             <span class="keyword">sizeof</span>( ObjectInfoBuffer ),
00442                             &amp;ReturnedLength
00443                           );
00444     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00445         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectTypeInfo ) failed - Status == %X\n"</span>,
00446                  DirectoryHandle,
00447                  Status
00448                  );
00449         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00450         }
00451     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectTypeInfo ) returned %lx bytes\n"</span>,
00452              DirectoryHandle,
00453              ReturnedLength
00454              );
00455     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    TypeName = (%ld,%ld) '%Z'\n"</span>,
00456              ObjectTypeInfo-&gt;TypeName.MaximumLength,
00457              ObjectTypeInfo-&gt;TypeName.Length,
00458              &amp;ObjectTypeInfo-&gt;TypeName
00459            );
00460 
00461     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkName, <span class="stringliteral">"TestSymbolicLink"</span> );
00462     InitializeObjectAttributes( &amp;ObjectAttributes,
00463                                 &amp;LinkName,
00464                                 OBJ_CASE_INSENSITIVE,
00465                                 NULL,
00466                                 NULL
00467                               );
00468     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.RootDirectory = <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>;
00469     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkTarget, <span class="stringliteral">"\\Device\\FileSystem"</span> );
00470     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a5">NtCreateSymbolicLinkObject</a>( &amp;LinkHandle,
00471                                          SYMBOLIC_LINK_ALL_ACCESS,
00472                                          &amp;ObjectAttributes,
00473                                          &amp;LinkTarget
00474                                        );
00475 
00476     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00477         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z =&gt; %Z symbolic link object (%X)\n"</span>,
00478                  &amp;LinkName, &amp;LinkTarget, Status );
00479         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00480         }
00481 
00482     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( DirectoryHandle );
00483     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00484         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z directory object handle - %lx (%X)\n"</span>,
00485                  &amp;DirectoryName,
00486                  DirectoryHandle,
00487                  Status
00488                  );
00489         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00490         }
00491 
00492     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;DirTypeName, <span class="stringliteral">"Directory"</span> );
00493     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkTypeName, <span class="stringliteral">"SymbolicLink"</span> );
00494     <a class="code" href="../../d7/d9/uob_8c.html#a5">DumpObjectDirs</a>( <span class="stringliteral">"\\"</span>, 0 );
00495 
00496     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkName, <span class="stringliteral">"TestSymbolicLink"</span> );
00497     InitializeObjectAttributes( &amp;ObjectAttributes,
00498                                 &amp;LinkName,
00499                                 OBJ_CASE_INSENSITIVE,
00500                                 NULL,
00501                                 NULL
00502                               );
00503     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.RootDirectory = LinkHandle;
00504     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00505                                     DIRECTORY_ALL_ACCESS,
00506                                     &amp;ObjectAttributes
00507                                   );
00508     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00509         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>, &amp;DirectoryName, Status );
00510         }
00511 
00512     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( LinkHandle );
00513     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00514         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z symbolic link handle - %lx (%X)\n"</span>,
00515                  &amp;LinkName,
00516                  LinkHandle,
00517                  Status
00518                  );
00519         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00520         }
00521 
00522     InitializeObjectAttributes( &amp;ObjectAttributes,
00523                                 &amp;DirectoryName,
00524                                 OBJ_CASE_INSENSITIVE,
00525                                 NULL,
00526                                 NULL
00527                               );
00528     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00529                                     DIRECTORY_ALL_ACCESS,
00530                                     &amp;ObjectAttributes
00531                                   );
00532     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00533         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X)\n"</span>, &amp;DirectoryName, Status );
00534         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00535         }
00536 
00537     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a2">NtMakeTemporaryObject</a>( DirectoryHandle );
00538     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00539         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtMakeTemporaryObject( %lx ) failed - Status == %X\n"</span>,
00540                  DirectoryHandle,
00541                  Status
00542                );
00543         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00544         }
00545 
00546     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( DirectoryHandle );
00547     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00548         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z directory object handle - %lx (%X)\n"</span>,
00549                  &amp;DirectoryName,
00550                  DirectoryHandle,
00551                  Status
00552                  );
00553         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00554         }
00555 
00556     InitializeObjectAttributes( &amp;ObjectAttributes,
00557                                 &amp;DirectoryName,
00558                                 OBJ_CASE_INSENSITIVE,
00559                                 NULL,
00560                                 NULL
00561                               );
00562     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00563                                     DIRECTORY_ALL_ACCESS,
00564                                     &amp;ObjectAttributes
00565                                   );
00566     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00567         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>, &amp;DirectoryName, Status );
00568         }
00569 
00570     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;DirectoryName, <span class="stringliteral">"\\ExclusiveDir"</span> );
00571     InitializeObjectAttributes( &amp;ObjectAttributes,
00572                                 &amp;DirectoryName,
00573                                 OBJ_CASE_INSENSITIVE | OBJ_EXCLUSIVE,
00574                                 NULL,
00575                                 NULL
00576 
00577                               );
00578     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;DirectoryHandle,
00579                                       DIRECTORY_ALL_ACCESS,
00580                                       &amp;ObjectAttributes
00581                                     );
00582     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00583         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X)\n"</span>,
00584                  &amp;DirectoryName, Status );
00585         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00586         }
00587 
00588     InitializeObjectAttributes( &amp;ObjectAttributes,
00589                                 &amp;DirectoryName,
00590                                 OBJ_CASE_INSENSITIVE | OBJ_EXCLUSIVE,
00591                                 NULL,
00592                                 NULL
00593                               );
00594     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00595                                     DIRECTORY_ALL_ACCESS,
00596                                     &amp;ObjectAttributes
00597                                   );
00598     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00599         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X)\n"</span>,
00600                  &amp;DirectoryName, Status );
00601         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), Status );
00602         }
00603 
00604     InitializeObjectAttributes( &amp;ObjectAttributes,
00605                                 &amp;DirectoryName,
00606                                 OBJ_CASE_INSENSITIVE,
00607                                 NULL,
00608                                 NULL
00609                               );
00610     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;DirectoryHandle,
00611                                     DIRECTORY_ALL_ACCESS,
00612                                     &amp;ObjectAttributes
00613                                   );
00614     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00615         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>,
00616                  &amp;DirectoryName, Status );
00617         }
00618 
00619     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Exiting Object Manager User Mode Test Program with Status = %X\n"</span>, Status );
00620 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="uob.c::DirTypeName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> STRING <a class="el" href="../../d7/d9/uob_8c.html#a0">DirTypeName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00029">29</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/uob_8c-source.html#l00039">DumpObjectDirs()</a>, and <a class="el" href="../../d8/d8/uob_8c-source.html#l00232">TestParent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="uob.c::LinkTypeName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> STRING <a class="el" href="../../d7/d9/uob_8c.html#a1">LinkTypeName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00030">30</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/uob_8c-source.html#l00039">DumpObjectDirs()</a>, and <a class="el" href="../../d8/d8/uob_8c-source.html#l00232">TestParent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="uob.c::ParameterBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char <a class="el" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a>[4096]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/uob_8c-source.html#l00147">147</a> of file <a class="el" href="../../d8/d8/uob_8c-source.html">uob.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/uob_8c-source.html#l00149">main()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:52 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
