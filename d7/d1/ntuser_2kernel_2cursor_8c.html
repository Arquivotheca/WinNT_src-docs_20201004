<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ntuser/kernel/cursor.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cursor.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a0">zzzSetCursor</a> (<a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcur)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a1">zzzSetCursorPos</a> (int x, int y)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a2">zzzInternalSetCursorPos</a> (int x, int y)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a3">IncCursorLevel</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a4">DecCursorLevel</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a5">zzzShowCursor</a> (BOOL fShow)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a6">zzzClipCursor</a> (LPCRECT prcClip)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a7">BoundCursor</a> (LPPOINT lppt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a8">SetVDMCursorBounds</a> (LPRECT lprc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a9">zzzAnimateCursor</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndDummy, UINT message, UINT_PTR nID, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a10">FCursorShadowed</a> (PCURSINFO pci)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a11">zzzUpdateCursorImage</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a12">SetPointer</a> (BOOL fSet)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a13">zzzHideCursorNoCapture</a> ()</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a7" doxytag="ntuser/kernel/cursor.c::BoundCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID BoundCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPPOINT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lppt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00299">299</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d2/d4/multimon_8c-source.html#l00033">ClipPointToDesktop()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02211">tagDISPLAYINFO::fDesktopIsRect</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00195">grcCursorClip</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00212">grcVDMCursorBounds</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00061">gspwndFullScreen</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06595">PUDF_VDMBOUNDSACTIVE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01936">xxxMoveEventAbsolute()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02187">zzzActiveCursorTracking()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00114">zzzInternalSetCursorPos()</a>.
<p>
<pre class="fragment"><div>00301 {
00302     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_VDMBOUNDSACTIVE) &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a15">gspwndFullScreen</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00303 
00304         <span class="keywordflow">if</span> (lppt-&gt;x &lt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.left) {
00305             lppt-&gt;x = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.left;
00306         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lppt-&gt;x &gt;= <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.right) {
00307             lppt-&gt;x = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.right - 1;
00308         }
00309 
00310         <span class="keywordflow">if</span> (lppt-&gt;y &lt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.top) {
00311             lppt-&gt;y = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.top;
00312         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lppt-&gt;y &gt;= <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.bottom) {
00313             lppt-&gt;y = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a>.bottom - 1;
00314         }
00315 
00316     } <span class="keywordflow">else</span> {
00317 
00318         <span class="keywordflow">if</span> (lppt-&gt;x &lt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.left) {
00319             lppt-&gt;x = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.left;
00320         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lppt-&gt;x &gt;= <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.right) {
00321             lppt-&gt;x = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.right - 1;
00322         }
00323 
00324         <span class="keywordflow">if</span> (lppt-&gt;y &lt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.top) {
00325             lppt-&gt;y = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.top;
00326         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lppt-&gt;y &gt;= <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.bottom) {
00327             lppt-&gt;y = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.bottom - 1;
00328         }
00329     }
00330 
00331     <span class="comment">/*</span>
00332 <span class="comment">     * If we have more than one monitor, then we need to clip the</span>
00333 <span class="comment">     * cursor to a point on the desktop.</span>
00334 <span class="comment">     */</span>
00335     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o18">fDesktopIsRect</a>) {
00336         <a class="code" href="../../d4/d1/userk_8h.html#a2078">ClipPointToDesktop</a>(lppt);
00337     }
00338 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ntuser/kernel/cursor.c::DecCursorLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DecCursorLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pti</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00154">154</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03127">tagQ::iCursorLevel</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03376">tagTHREADINFO::iCursorLevel</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00170">zzzShowCursor()</a>.
<p>
<pre class="fragment"><div>00156 {
00157     pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o37">iCursorLevel</a>--;
00158     pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a>--;
00159 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ntuser/kernel/cursor.c::FCursorShadowed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline FCursorShadowed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCURSINFO&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pci</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00479">479</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06672">TestALPHA</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00676">SetPointer()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
<pre class="fragment"><div>00480 {
00481     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d1/userk_8h.html#a666">TestALPHA</a>(CURSORSHADOW) &amp;&amp; (pci-&gt;CURSORF_flags &amp; CURSORF_SYSTEM));
00482 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ntuser/kernel/cursor.c::IncCursorLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IncCursorLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pti</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00147">147</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03127">tagQ::iCursorLevel</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03376">tagTHREADINFO::iCursorLevel</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00170">zzzShowCursor()</a>.
<p>
<pre class="fragment"><div>00149 {
00150     pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o37">iCursorLevel</a>++;
00151     pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a>++;
00152 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ntuser/kernel/cursor.c::SetPointer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fSet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00676">676</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00479">FCursorShadowed()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05956">GETPCI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00101">gpqCursor</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03127">tagQ::iCursorLevel</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03126">tagQ::spcurCurrent</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>, <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00273">xxxRemoteReconnect()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03136">xxxUserResetDisplayDevice()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
<pre class="fragment"><div>00677 {
00678     <span class="keywordflow">if</span> (fSet) {
00679         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a> &gt;= 0 &amp;&amp;
00680                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00681                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(MOUSEPRESENT)) {
00682 
00683             PCURSINFO pci = <a class="code" href="../../d4/d1/userk_8h.html#a600">GETPCI</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a>);
00684             ULONG fl = <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a10">FCursorShadowed</a>(pci) ? SPS_ALPHA : 0;
00685 
00686             GreSetPointer(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, pci, fl);
00687         }
00688     } <span class="keywordflow">else</span> {
00689         GreSetPointer(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, NULL, 0);
00690     }
00691 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ntuser/kernel/cursor.c::SetVDMCursorBounds" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetVDMCursorBounds           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPRECT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lprc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00351">351</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06611">CLEAR_PUDF</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00212">grcVDMCursorBounds</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06595">PUDF_VDMBOUNDSACTIVE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06610">SET_PUDF</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l06445">xxxConsoleControl()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>.
<p>
<pre class="fragment"><div>00353 {
00354     <span class="keywordflow">if</span> (lprc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00355 
00356         <span class="comment">/*</span>
00357 <span class="comment">         * Set grcVDMCursorBounds before TEST_PUDF(PUDF_VDMBOUNDSACTIVE), because</span>
00358 <span class="comment">         * MoveEvent() calls BoundCursor() from outside the USER CritSect!</span>
00359 <span class="comment">         */</span>
00360         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a> = *lprc;
00361         <a class="code" href="../../d4/d1/userk_8h.html#a659">SET_PUDF</a>(PUDF_VDMBOUNDSACTIVE);
00362 
00363     } <span class="keywordflow">else</span> {
00364 
00365         <span class="comment">/*</span>
00366 <span class="comment">         * Turn vdm bounds off.</span>
00367 <span class="comment">         */</span>
00368         <a class="code" href="../../d4/d1/userk_8h.html#a660">CLEAR_PUDF</a>(PUDF_VDMBOUNDSACTIVE);
00369     }
00370 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ntuser/kernel/cursor.c::zzzAnimateCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID zzzAnimateCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndDummy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00389">389</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02176">CURSORF_ACON</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00213">gdwLastAniTick</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00214">gidCursorTimer</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00210">gpcurLogCurrent</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00389">zzzAnimateCursor()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00389">zzzAnimateCursor()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
<pre class="fragment"><div>00394 {
00395     <span class="keywordtype">int</span>   iicur;
00396     <a class="code" href="../../d1/d8/structtagACON.html">PACON</a> <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>;
00397     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>    tlpacon;
00398     <span class="keywordtype">int</span>   LostTime;
00399     <span class="keywordtype">int</span>   tTime;
00400 
00401     <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a> = (<a class="code" href="../../d1/d8/structtagACON.html">PACON</a>)<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a83">gpcurLogCurrent</a>;
00402 
00403     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !(<a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a537">CURSORF_ACON</a>)) {
00404         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a86">gdwLastAniTick</a> = 0;
00405         <span class="keywordflow">return</span>;
00406     }
00407 
00408     <span class="comment">/*</span>
00409 <span class="comment">     * Find out actual time loss since last update.</span>
00410 <span class="comment">     */</span>
00411     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a86">gdwLastAniTick</a>) {
00412 
00413         LostTime = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>() - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a86">gdwLastAniTick</a> -
00414                 (<a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;ajifRate[<a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;iicur] * 100 / 6);
00415 
00416         <span class="keywordflow">if</span> (LostTime &lt; 0)
00417             LostTime = 0;
00418 
00419     } <span class="keywordflow">else</span> {
00420 
00421         LostTime = 0;
00422     }
00423 
00424     <span class="comment">/*</span>
00425 <span class="comment">     * Increment the animation index.</span>
00426 <span class="comment">     */</span>
00427     iicur = <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;iicur + 1;
00428     <span class="keywordflow">if</span> (iicur &gt;= <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;cicur)
00429         iicur = 0;
00430 
00431     <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;iicur = iicur;
00432 
00433     <span class="comment">/*</span>
00434 <span class="comment">     * This forces the new cursor to be drawn.</span>
00435 <span class="comment">     */</span>
00436     <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pacon, &amp;tlpacon);
00437     <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a11">zzzUpdateCursorImage</a>();
00438 
00439     tTime = <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;ajifRate[iicur] * 100 / 6;
00440 
00441     <span class="keywordflow">while</span> (tTime &lt; LostTime) {
00442 
00443         <span class="comment">/*</span>
00444 <span class="comment">         * Animation is outrunning our ability to render it - skip frames</span>
00445 <span class="comment">         * to catch up.</span>
00446 <span class="comment">         */</span>
00447         LostTime -= tTime;
00448 
00449         <span class="comment">/*</span>
00450 <span class="comment">         * Increment the animation index.</span>
00451 <span class="comment">         */</span>
00452         iicur = <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;iicur + 1;
00453         <span class="keywordflow">if</span> (iicur &gt;= <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;cicur)
00454             iicur = 0;
00455 
00456         <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;iicur = iicur;
00457 
00458         tTime = <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;ajifRate[iicur] * 100 / 6;
00459     }
00460     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpacon);
00461 
00462     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a86">gdwLastAniTick</a> = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>() - LostTime;
00463     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a87">gidCursorTimer</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(NULL, gidCursorTimer, tTime - LostTime, zzzAnimateCursor, TMRF_RIT | TMRF_ONESHOT);
00464 
00465     <span class="keywordflow">return</span>;
00466 
00467 
00468     DBG_UNREFERENCED_PARAMETER(pwndDummy);
00469     DBG_UNREFERENCED_PARAMETER(message);
00470     DBG_UNREFERENCED_PARAMETER(nID);
00471     DBG_UNREFERENCED_PARAMETER(lParam);
00472 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ntuser/kernel/cursor.c::zzzClipCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL zzzClipCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCRECT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>prcClip</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00216">216</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00195">grcCursorClip</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00101">IsRectEmpty()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00118">PtInRect()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00114">zzzInternalSetCursorPos()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03935">NtUserClipCursor()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00802">xxxDWP_DoCancelMode()</a>, <a class="el" href="../../d9/d2/movesize_8c-source.html#l01053">xxxMoveSize()</a>, <a class="el" href="../../d9/d2/movesize_8c-source.html#l00437">xxxMS_TrackMove()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l03772">xxxProcessEventMessage()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l01342">xxxSetForegroundWindow2()</a>, and <a class="el" href="../../d9/d2/movesize_8c-source.html#l00873">xxxTrackInitSize()</a>.
<p>
<pre class="fragment"><div>00218 {
00219     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00220 
00221     <span class="comment">/*</span>
00222 <span class="comment">     * Don't let this happen if it doesn't have access.</span>
00223 <span class="comment">     */</span>
00224     <span class="keywordflow">if</span> (Process != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a> &amp;&amp; !<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
00225         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00226     }
00227 
00228     <span class="comment">/*</span>
00229 <span class="comment">     * The comment from NT 3.51:</span>
00230 <span class="comment">     *     Non-foreground threads can only set the clipping rectangle</span>
00231 <span class="comment">     *     if it was empty, or if they are restoring it to the whole screen.</span>
00232 <span class="comment">     *</span>
00233 <span class="comment">     * But the code from NT 3.51 says "IsRectEmpty" instead of</span>
00234 <span class="comment">     * "!IsRectEmpty", as would follow from the comment. We leave</span>
00235 <span class="comment">     * the code as it was, as following the comment appears to</span>
00236 <span class="comment">     * break apps.</span>
00237 <span class="comment">     *</span>
00238 <span class="comment">     * CONSIDER: Removing this test altogether after NT4.0 ships.</span>
00239 <span class="comment">     */</span>
00240     <span class="keywordflow">if</span> (    <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> &amp;&amp;
00241             prcClip != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00242             <a class="code" href="../../d3/d6/rect_8c.html#a4">IsRectEmpty</a>(&amp;grcCursorClip)) {
00243         RIPERR0(ERROR_ACCESS_DENIED, RIP_WARNING, <span class="stringliteral">"Access denied in _ClipCursor"</span>);
00244         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00245     }
00246 
00247     <span class="keywordflow">if</span> (prcClip == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00248 
00249         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>;
00250 
00251     } <span class="keywordflow">else</span> {
00252 
00253         <span class="comment">/*</span>
00254 <span class="comment">         * Never let our cursor leave the screen. Can't use IntersectRect()</span>
00255 <span class="comment">         * because it doesn't allow rects with 0 width or height.</span>
00256 <span class="comment">         */</span>
00257         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.left   = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.left  , prcClip-&gt;left);
00258         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.right  = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.right , prcClip-&gt;right);
00259         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.top    = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.top   , prcClip-&gt;top);
00260         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.bottom = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.bottom, prcClip-&gt;bottom);
00261 
00262         <span class="comment">/*</span>
00263 <span class="comment">         * Check for invalid clip rect.</span>
00264 <span class="comment">         */</span>
00265         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.left &gt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.right ||
00266             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.top &gt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a>.bottom) {
00267 
00268             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a75">grcCursorClip</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>;
00269         }
00270     }
00271 
00272     <span class="comment">/*</span>
00273 <span class="comment">     * Update the cursor position if it's currently outside the</span>
00274 <span class="comment">     * cursor clip-rect.</span>
00275 <span class="comment">     */</span>
00276     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;grcCursorClip, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor)) {
00277         <a class="code" href="../../d4/d1/userk_8h.html#a1179">zzzInternalSetCursorPos</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor.x, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor.y);
00278     }
00279 
00280     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ntuser/kernel/cursor.c::zzzHideCursorNoCapture" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void zzzHideCursorNoCapture           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00701">701</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d7/d2/queue_8c-source.html#l01033">GetAppCompatFlags2()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03109">tagQ::spwndCapture</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00028">zzzSetCursor()</a>.
<p>
<pre class="fragment"><div>00702 {
00703     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00704 
00705     <span class="keywordflow">if</span> (!ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a> &amp;&amp; (<a class="code" href="../../d6/d3/queue_8c.html#a35">GetAppCompatFlags2</a>(VER40) &amp; GACF2_EDITNOMOUSEHIDE) == 0) {
00706         <a class="code" href="../../d4/d1/userk_8h.html#a1785">zzzSetCursor</a>(NULL);
00707     }
00708 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ntuser/kernel/cursor.c::zzzInternalSetCursorPos" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID zzzInternalSetCursorPos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00114">114</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00299">BoundCursor()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00199">gptCursorAsync</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l01363">zzzSetFMouseMoved()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00985">ResetSharedDesktops()</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01797">xxxCallJournalPlaybackHook()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>, <a class="el" href="../../d9/d2/movesize_8c-source.html#l01053">xxxMoveSize()</a>, <a class="el" href="../../d9/d2/movesize_8c-source.html#l00437">xxxMS_TrackMove()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03136">xxxUserResetDisplayDevice()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02187">zzzActiveCursorTracking()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00216">zzzClipCursor()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00080">zzzSetCursorPos()</a>.
<p>
<pre class="fragment"><div>00118 {
00119 
00120     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a79">gptCursorAsync</a>.x = x;
00121     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a79">gptCursorAsync</a>.y = y;
00122 
00123     <a class="code" href="../../d4/d1/userk_8h.html#a1182">BoundCursor</a>(&amp;gptCursorAsync);
00124     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a79">gptCursorAsync</a>;
00125     GreMovePointer(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor.x, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor.y);
00126 
00127     <span class="comment">/*</span>
00128 <span class="comment">     * Cursor has changed position, so generate a mouse event so the</span>
00129 <span class="comment">     * window underneath the new location knows it's there and sets the</span>
00130 <span class="comment">     * shape accordingly.</span>
00131 <span class="comment">     */</span>
00132     <a class="code" href="../../d5/d3/ntuser_2kernel_2input_8c.html#a32">zzzSetFMouseMoved</a>();
00133 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ntuser/kernel/cursor.c::zzzSetCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> zzzSetCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pcur</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00028">28</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00101">gpqCursor</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05944">LockQCursor</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03126">tagQ::spcurCurrent</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00364">ThreadLockWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05886">NtUserSetCursor()</a>, <a class="el" href="../../d7/d0/dragdrop_8c-source.html#l00026">xxxDragObject()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00402">xxxDWP_SetCursor()</a>, <a class="el" href="../../d3/d9/kernel_2help_8c-source.html#l00073">xxxHelpLoop()</a>, <a class="el" href="../../d9/d2/movesize_8c-source.html#l01053">xxxMoveSize()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l03305">xxxScanSysQueue()</a>, <a class="el" href="../../d2/d2/tmswitch_8c-source.html#l01564">xxxSwitchWndProc()</a>, <a class="el" href="../../d9/d2/movesize_8c-source.html#l00873">xxxTrackInitSize()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00701">zzzHideCursorNoCapture()</a>.
<p>
<pre class="fragment"><div>00030 {
00031     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a>      pq;
00032     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcurPrev;
00033     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00034 
00035     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00036 
00037     pcurPrev = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a>;
00038 
00039     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a> != pcur) {
00040 
00041         <span class="comment">/*</span>
00042 <span class="comment">         * Lock() returns pobjOld - if it is still valid.  Don't want to</span>
00043 <span class="comment">         * return a pcurPrev that is an invalid pointer.</span>
00044 <span class="comment">         */</span>
00045         pcurPrev = <a class="code" href="../../d4/d1/userk_8h.html#a599">LockQCursor</a>(pq, pcur);
00046 
00047         <span class="comment">/*</span>
00048 <span class="comment">         * If no thread 'owns' the cursor, we must be in initialization</span>
00049 <span class="comment">         * so go ahead and assign it to ourself.</span>
00050 <span class="comment">         */</span>
00051         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00052             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a> = pq;
00053 
00054         <span class="comment">/*</span>
00055 <span class="comment">         * If we're changing the local-cursor for the thread currently</span>
00056 <span class="comment">         * representing the global-cursor, update the cursor image now.</span>
00057 <span class="comment">         */</span>
00058         <span class="keywordflow">if</span> (pq == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>) {
00059             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpcur;
00060             <a class="code" href="../../d6/d0/usercli_8h.html#a38">ThreadLockWithPti</a>(ptiCurrent, pcurPrev, &amp;tlpcur);
00061             <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a11">zzzUpdateCursorImage</a>();
00062             pcurPrev = <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpcur);
00063         }
00064     }
00065 
00066     <span class="keywordflow">return</span> pcurPrev;
00067 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ntuser/kernel/cursor.c::zzzSetCursorPos" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL zzzSetCursorPos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00080">80</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01772">SAVEPOINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00114">zzzInternalSetCursorPos()</a>.
<p>
<pre class="fragment"><div>00083 {
00084     <span class="comment">/*</span>
00085 <span class="comment">     * Blow it off if the caller doesn't have the proper access rights</span>
00086 <span class="comment">     */</span>
00087     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
00088         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00089     }
00090 
00091     <a class="code" href="../../d4/d1/userk_8h.html#a1179">zzzInternalSetCursorPos</a>(x, y);
00092 
00093     <span class="comment">/*</span>
00094 <span class="comment">     * Save the absolute coordinates in the global array</span>
00095 <span class="comment">     * for GetMouseMovePointsEx.</span>
00096 <span class="comment">     */</span>
00097     <a class="code" href="../../d4/d1/userk_8h.html#a152">SAVEPOINT</a>(x, y,
00098               <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVIRTUALSCREEN) - 1,
00099               <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVIRTUALSCREEN) - 1,
00100               <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>(), 0);
00101 
00102     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00103 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ntuser/kernel/cursor.c::zzzShowCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int zzzShowCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fShow</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00170">170</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00154">DecCursorLevel()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06469">DeferWinEventNotify</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00101">gpqCursor</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03127">tagQ::iCursorLevel</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00147">IncCursorLevel()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06473">zzzEndDeferWinEventNotify</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/dragdrop_8c-source.html#l00026">xxxDragObject()</a>, and <a class="el" href="../../d9/d2/movesize_8c-source.html#l01053">xxxMoveSize()</a>.
<p>
<pre class="fragment"><div>00172 {
00173     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00174     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a>          pq;
00175     <span class="keywordtype">int</span>         iCursorLevel;
00176 
00177     pq = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00178     <span class="comment">/*</span>
00179 <span class="comment">     * To preserve pq</span>
00180 <span class="comment">     */</span>
00181     <a class="code" href="../../d4/d1/userk_8h.html#a614">DeferWinEventNotify</a>();
00182 
00183     <span class="keywordflow">if</span> (fShow) {
00184 
00185         <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a3">IncCursorLevel</a>(pti);
00186 
00187         <span class="keywordflow">if</span> ((pq == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>) &amp;&amp; (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a> == 0))
00188             <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a11">zzzUpdateCursorImage</a>();
00189 
00190     } <span class="keywordflow">else</span> {
00191 
00192         <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a4">DecCursorLevel</a>(pti);
00193 
00194         <span class="keywordflow">if</span> ((pq == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>) &amp;&amp; (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a> == -1))
00195             <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a11">zzzUpdateCursorImage</a>();
00196     }
00197 
00198     iCursorLevel = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a>;
00199     <a class="code" href="../../d4/d1/userk_8h.html#a617">zzzEndDeferWinEventNotify</a>();
00200 
00201     <span class="keywordflow">return</span> iCursorLevel;
00202 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ntuser/kernel/cursor.c::zzzUpdateCursorImage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID zzzUpdateCursorImage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">496</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02176">CURSORF_ACON</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00479">FCursorShadowed()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00213">gdwLastAniTick</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05956">GETPCI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00210">gpcurLogCurrent</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00211">gpcurPhysCurrent</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00101">gpqCursor</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00194">gtimeStartCursorHide</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00261">gtmridAniCursor</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03127">tagQ::iCursorLevel</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04068">KILLRITTIMER</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00676">SetPointer()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03126">tagQ::spcurCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02773">SYSCUR</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06464">WEF_USEPWNDTHREAD</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00389">zzzAnimateCursor()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l06494">zzzWindowEvent</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00389">zzzAnimateCursor()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00591">zzzCalcStartCursorHide()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00028">zzzSetCursor()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l01363">zzzSetFMouseMoved()</a>, <a class="el" href="../../d5/d3/kernel_2acons_8c-source.html#l00069">zzzSetSystemImage()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00170">zzzShowCursor()</a>.
<p>
<pre class="fragment"><div>00497 {
00498     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcurLogNew;
00499     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcurPhysNew;
00500     <a class="code" href="../../d1/d8/structtagACON.html">PACON</a>   <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>;
00501     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcurPhysOld;
00502 
00503     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00504         <span class="keywordflow">return</span>;
00505 
00506     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a> &lt; 0) || (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00507 
00508         pcurLogNew = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00509 
00510     } <span class="keywordflow">else</span> {
00511 
00512         <span class="comment">/*</span>
00513 <span class="comment">         * Assume we're using the current cursor.</span>
00514 <span class="comment">         */</span>
00515         pcurLogNew = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a>;
00516 
00517         <span class="comment">/*</span>
00518 <span class="comment">         * Check to see if we should use the "app starting" cursor.</span>
00519 <span class="comment">         */</span>
00520         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a74">gtimeStartCursorHide</a> != 0) {
00521 
00522             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a> == <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(ARROW) ||
00523                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a> == <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(APPSTARTING)) {
00524 
00525                 pcurLogNew = <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(APPSTARTING);
00526             }
00527         }
00528     }
00529 
00530     <span class="comment">/*</span>
00531 <span class="comment">     * If the logical cursor is changing then start/stop the cursor</span>
00532 <span class="comment">     * animation timer as appropriate.</span>
00533 <span class="comment">     */</span>
00534     <span class="keywordflow">if</span> (pcurLogNew != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a83">gpcurLogCurrent</a>) {
00535 
00536         <span class="comment">/*</span>
00537 <span class="comment">         * If the old cursor was animating, shut off the animation timer.</span>
00538 <span class="comment">         */</span>
00539         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a114">gtmridAniCursor</a> != 0) {
00540             <span class="comment">/*</span>
00541 <span class="comment">             * Disable animation.</span>
00542 <span class="comment">             */</span>
00543             <a class="code" href="../../d4/d1/userk_8h.html#a499">KILLRITTIMER</a>(NULL, gtmridAniCursor);
00544             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a114">gtmridAniCursor</a> = 0;
00545         }
00546 
00547         <span class="comment">/*</span>
00548 <span class="comment">         * If the new cursor is animated, start the animation timer.</span>
00549 <span class="comment">         */</span>
00550         <span class="keywordflow">if</span> ((pcurLogNew != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (pcurLogNew-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a537">CURSORF_ACON</a>)) {
00551 
00552             <span class="comment">/*</span>
00553 <span class="comment">             * Start the animation over from the beginning.</span>
00554 <span class="comment">             */</span>
00555             <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a> = (<a class="code" href="../../d1/d8/structtagACON.html">PACON</a>)pcurLogNew;
00556             <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;iicur = 0;
00557 
00558             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a86">gdwLastAniTick</a> = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>();
00559 
00560             <span class="comment">/*</span>
00561 <span class="comment">             * Use the rate table to keep the timer on track.</span>
00562 <span class="comment">             * 1 Jiffy = 1/60 sec = 100/6 ms</span>
00563 <span class="comment">             */</span>
00564             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a114">gtmridAniCursor</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(NULL, gtmridAniCursor,
00565                     <a class="code" href="../../d4/d4/kernel_2acons_8c.html#a1">pacon</a>-&gt;ajifRate[0] * 100 / 6, zzzAnimateCursor, TMRF_RIT | TMRF_ONESHOT);
00566         }
00567     }
00568 
00569     <span class="comment">/*</span>
00570 <span class="comment">     * If this is an animated cursor, find and use the current frame</span>
00571 <span class="comment">     * of the animation.  NOTE: this is done AFTER the AppStarting</span>
00572 <span class="comment">     * business so the AppStarting cursor itself can be animated.</span>
00573 <span class="comment">     */</span>
00574     <span class="keywordflow">if</span> (pcurLogNew != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pcurLogNew-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a537">CURSORF_ACON</a>) {
00575 
00576         pcurPhysNew = ((<a class="code" href="../../d1/d8/structtagACON.html">PACON</a>)pcurLogNew)-&gt;aspcur[((<a class="code" href="../../d1/d8/structtagACON.html">PACON</a>)pcurLogNew)-&gt;
00577                 aicur[((<a class="code" href="../../d1/d8/structtagACON.html">PACON</a>)pcurLogNew)-&gt;iicur]];
00578     } <span class="keywordflow">else</span> {
00579 
00580         pcurPhysNew = pcurLogNew;
00581     }
00582 
00583     <span class="comment">/*</span>
00584 <span class="comment">     * Remember the new logical cursor.</span>
00585 <span class="comment">     */</span>
00586     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a83">gpcurLogCurrent</a> = pcurLogNew;
00587 
00588     <span class="comment">/*</span>
00589 <span class="comment">     * If the physical cursor is changing then update screen.</span>
00590 <span class="comment">     */</span>
00591     <span class="keywordflow">if</span> (pcurPhysNew != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a84">gpcurPhysCurrent</a>) {
00592 
00593         pcurPhysOld = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a84">gpcurPhysCurrent</a>;
00594 
00595         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a84">gpcurPhysCurrent</a> = pcurPhysNew;
00596 
00597         <span class="keywordflow">if</span> (pcurPhysNew == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00598 
00599             <a class="code" href="../../d4/d1/userk_8h.html#a1790">SetPointer</a>(FALSE);
00600 
00601         } <span class="keywordflow">else</span> {
00602             ULONG fl = 0;
00603 
00604             <span class="keywordflow">if</span> (pcurLogNew-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a537">CURSORF_ACON</a>) {
00605                 fl |= SPS_ANIMATEUPDATE;
00606             }
00607             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a10">FCursorShadowed</a>(<a class="code" href="../../d4/d1/userk_8h.html#a600">GETPCI</a>(pcurLogNew))) {
00608                 fl |= SPS_ALPHA;
00609             }
00610             GreSetPointer(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d4/d1/userk_8h.html#a600">GETPCI</a>(pcurPhysNew), fl);
00611         }
00612 
00613         <span class="comment">/*</span>
00614 <span class="comment">         * Notify anyone who cares about the change</span>
00615 <span class="comment">         * This can happen on the RIT, so we need to pass on the real</span>
00616 <span class="comment">         * thread/process ID.  Hence we use hwndCursor.</span>
00617 <span class="comment">         * This comment is from WIn'95 so it may not be true - IanJa.</span>
00618 <span class="comment">         */</span>
00619         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00620             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   event;
00621             <span class="comment">/*</span>
00622 <span class="comment">             * These are the events we send:</span>
00623 <span class="comment">             *      hcurPhys now NULL       -&gt;  EVENT_OBJECT_HIDE</span>
00624 <span class="comment">             *      hcurPhys was NULL       -&gt;  EVENT_OBJECT_SHOW</span>
00625 <span class="comment">             *      hcurPhys changing       -&gt;  EVENT_OBJECT_NAMECHANGE</span>
00626 <span class="comment">             * Since we only go through this code if hcurPhys is actually</span>
00627 <span class="comment">             * changing, these checks are simple.</span>
00628 <span class="comment">             */</span>
00629             <span class="keywordflow">if</span> (!pcurPhysNew) {
00630                 event = EVENT_OBJECT_HIDE;
00631             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pcurPhysOld) {
00632                 event = EVENT_OBJECT_SHOW;
00633             } <span class="keywordflow">else</span> {
00634                 event = EVENT_OBJECT_NAMECHANGE;
00635             }
00636             <a class="code" href="../../d4/d1/userk_8h.html#a619">zzzWindowEvent</a>(event, NULL, OBJID_CURSOR, INDEXID_CONTAINER, WEF_USEPWNDTHREAD);
00637         }
00638     }
00639 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:23 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
