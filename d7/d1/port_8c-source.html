<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: port.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>port.c</h1><a href="../../d6/d2/port_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1992  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    port.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This is the console fullscreen driver for the VGA card.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Environment:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    kernel mode only</span>
00016 <span class="comment"></span>
00017 <span class="comment">Notes:</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#include "stdarg.h"</span>
00024 <span class="preprocessor">#include "stdio.h"</span>
00025 <span class="preprocessor">#include "ntddk.h"</span>
00026 <span class="preprocessor">#include "<a class="code" href="../../d7/d8/fsvga_8h.html">fsvga.h</a>"</span>
00027 <span class="preprocessor">#include "fsvgalog.h"</span>
00028 
00029 
00030 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00031"></a><a class="code" href="../../d6/d2/port_8c.html#a0">00031</a> <a class="code" href="../../d6/d2/port_8c.html#a0">GetHardwareScrollReg</a>(
00032     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension
00033     )
00034 
00035 <span class="comment">/*++</span>
00036 <span class="comment"></span>
00037 <span class="comment">Routine Description:</span>
00038 <span class="comment"></span>
00039 <span class="comment">    This routine gets the hardware scrolls register value.</span>
00040 <span class="comment"></span>
00041 <span class="comment">Arguments:</span>
00042 <span class="comment"></span>
00043 <span class="comment">Return Value:</span>
00044 <span class="comment"></span>
00045 <span class="comment">--*/</span>
00046 
00047 {
00048     UCHAR <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a>;
00049     UCHAR <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a>;
00050     UCHAR mid;
00051 
00052     WRITE_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a18">CRTCAddressPortColor</a>],
00053                       <a class="code" href="../../d1/d6/vga_8h.html#a50">IND_START_ADRS_L</a>);
00054     <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> = READ_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a19">CRTCDataPortColor</a>]);
00055 
00056     WRITE_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a18">CRTCAddressPortColor</a>],
00057                       <a class="code" href="../../d1/d6/vga_8h.html#a49">IND_START_ADRS_H</a>);
00058     <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> = READ_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a19">CRTCDataPortColor</a>]);
00059 
00060     deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o0">StartAddress</a> = MAKEWORD(<a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a>, <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a>);
00061 
00062     WRITE_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a18">CRTCAddressPortColor</a>],
00063                       <a class="code" href="../../d1/d6/vga_8h.html#a51">IND_LINE_COMPARE</a>);
00064     <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> = READ_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a19">CRTCDataPortColor</a>]);
00065 
00066     WRITE_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a18">CRTCAddressPortColor</a>],
00067                       <a class="code" href="../../d1/d6/vga_8h.html#a52">IND_LINE_COMPARE8</a>);
00068     mid = READ_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a19">CRTCDataPortColor</a>]);
00069     mid = (mid &gt;&gt; 4) &amp; 1;
00070 
00071     WRITE_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a18">CRTCAddressPortColor</a>],
00072                       <a class="code" href="../../d1/d6/vga_8h.html#a53">IND_LINE_COMPARE9</a>);
00073     <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> = READ_PORT_UCHAR(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a19">CRTCDataPortColor</a>]);
00074     <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> = (<a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> &gt;&gt; 5) &amp; 2;
00075 
00076     <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> |= mid;
00077     deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o1">LineCompare</a> = MAKEWORD(<a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a>, <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a>);
00078 }
00079 
00080 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00081"></a><a class="code" href="../../d6/d2/port_8c.html#a1">00081</a> <a class="code" href="../../d6/d2/port_8c.html#a1">SetGRAMWriteMode</a>(
00082     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension
00083     )
00084 
00085 <span class="comment">/*++</span>
00086 <span class="comment"></span>
00087 <span class="comment">Routine Description:</span>
00088 <span class="comment"></span>
00089 <span class="comment">    This routine sets the write mode of graphics register.</span>
00090 <span class="comment"></span>
00091 <span class="comment">Arguments:</span>
00092 <span class="comment"></span>
00093 <span class="comment">Return Value:</span>
00094 <span class="comment"></span>
00095 <span class="comment">--*/</span>
00096 
00097 {
00098     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00099                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a42">IND_GRAPH_MODE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a68">M_PROC_WRITE</a>+<a class="code" href="../../d1/d6/vga_8h.html#a72">M_DATA_READ</a>));
00100 
00101     <span class="comment">//</span>
00102     <span class="comment">// Set up to write data without interacting with the latches.</span>
00103     <span class="comment">//</span>
00104     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00105                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a40">IND_DATA_ROTATE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a64">DR_SET</a>));
00106 
00107     <span class="comment">//</span>
00108     <span class="comment">// Enable all the available EGA planes.</span>
00109     <span class="comment">//</span>
00110     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a21">SEQUAddressPort</a>],
00111                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a46">IND_MAP_MASK</a>, <a class="code" href="../../d1/d6/vga_8h.html#a61">GRAPH_ADDR_MASK</a>));
00112     <span class="comment">//</span>
00113     <span class="comment">// Use all pixel positions.</span>
00114     <span class="comment">//</span>
00115     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00116                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a44">IND_BIT_MASK</a>, <a class="code" href="../../d1/d6/vga_8h.html#a76">BIT_MASK_DEFAULT</a>));
00117 
00118 }
00119 
00120 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00121"></a><a class="code" href="../../d6/d2/port_8c.html#a2">00121</a> <a class="code" href="../../d6/d2/port_8c.html#a2">SetGRAMCopyMode</a>(
00122     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension
00123     )
00124 
00125 <span class="comment">/*++</span>
00126 <span class="comment"></span>
00127 <span class="comment">Routine Description:</span>
00128 <span class="comment"></span>
00129 <span class="comment">    This routine sets the copy mode of graphics register.</span>
00130 <span class="comment"></span>
00131 <span class="comment">Arguments:</span>
00132 <span class="comment"></span>
00133 <span class="comment">Return Value:</span>
00134 <span class="comment"></span>
00135 <span class="comment">--*/</span>
00136 
00137 {
00138     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00139                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a42">IND_GRAPH_MODE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a69">M_LATCH_WRITE</a>+<a class="code" href="../../d1/d6/vga_8h.html#a73">M_COLOR_READ</a>));
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">// Set up to write data without interacting with the latches.</span>
00143     <span class="comment">//</span>
00144     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00145                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a40">IND_DATA_ROTATE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a64">DR_SET</a>));
00146 
00147     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00148                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a55">IND_COLOR_DONT_CARE</a>, 0));
00149 }
00150 
00151 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00152"></a><a class="code" href="../../d6/d2/port_8c.html#a3">00152</a> <a class="code" href="../../d6/d2/port_8c.html#a3">SetGRAMInvertMode</a>(
00153     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension
00154     )
00155 
00156 <span class="comment">/*++</span>
00157 <span class="comment"></span>
00158 <span class="comment">Routine Description:</span>
00159 <span class="comment"></span>
00160 <span class="comment">    This routine sets the invert mode of graphics register.</span>
00161 <span class="comment"></span>
00162 <span class="comment">Arguments:</span>
00163 <span class="comment"></span>
00164 <span class="comment">Return Value:</span>
00165 <span class="comment"></span>
00166 <span class="comment">--*/</span>
00167 
00168 {
00169     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00170                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a42">IND_GRAPH_MODE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a71">M_AND_WRITE</a>+<a class="code" href="../../d1/d6/vga_8h.html#a73">M_COLOR_READ</a>));
00171 
00172     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00173                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a40">IND_DATA_ROTATE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a67">DR_XOR</a>));
00174 
00175     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00176                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a44">IND_BIT_MASK</a>, <a class="code" href="../../d1/d6/vga_8h.html#a76">BIT_MASK_DEFAULT</a>));
00177 
00178     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00179                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a55">IND_COLOR_DONT_CARE</a>, 0));
00180 
00181     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00182                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a54">IND_SET_RESET</a>, 0xff));
00183 }
00184 
00185 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00186"></a><a class="code" href="../../d6/d2/port_8c.html#a4">00186</a> <a class="code" href="../../d6/d2/port_8c.html#a4">set_opaque_bkgnd_proc</a>(
00187     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension,
00188     PUCHAR FrameBuffer,
00189     WORD Attributes
00190     )
00191 
00192 <span class="comment">/*++</span>
00193 <span class="comment"></span>
00194 <span class="comment">set_opaque_bkgnd</span>
00195 <span class="comment"></span>
00196 <span class="comment">  Set the VGA registers for drawing a full screen byte with opaque</span>
00197 <span class="comment">  font and opaque background.</span>
00198 <span class="comment"></span>
00199 <span class="comment">Created.</span>
00200 <span class="comment"></span>
00201 <span class="comment">--*/</span>
00202 
00203 {
00204     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> ColorFg = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(Attributes) &amp; 0x0f;
00205     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> ColorBg = (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(Attributes) &amp; 0xf0) &gt;&gt; 4;
00206 
00207     <span class="keywordflow">if</span> (Attributes &amp; COMMON_LVB_REVERSE_VIDEO)
00208     {
00209         Attributes = ColorBg;
00210         ColorBg = ColorFg;
00211         ColorFg = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Attributes;
00212     }
00213 
00214     <span class="keywordflow">if</span> (deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o7">ColorFg</a> == ColorFg &amp;&amp;
00215         deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o8">ColorBg</a> == ColorBg)
00216         <span class="keywordflow">return</span>;
00217 
00218     deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o7">ColorFg</a> = ColorFg;
00219     deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o8">ColorBg</a> = ColorBg;
00220 
00221     <a class="code" href="../../d6/d2/port_8c.html#a6">ColorSetDirect</a>(deviceExtension, FrameBuffer, ColorFg, ColorBg);
00222 }
00223 
00224 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00225"></a><a class="code" href="../../d6/d2/port_8c.html#a5">00225</a> <a class="code" href="../../d6/d2/port_8c.html#a5">ColorSetGridMask</a>(
00226     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension,
00227     BYTE BitMask
00228     )
00229 {
00230 
00231     <span class="comment">//</span>
00232     <span class="comment">// That color is used for all planes.</span>
00233     <span class="comment">//</span>
00234     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00235                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a39">IND_SET_RESET_ENABLE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a61">GRAPH_ADDR_MASK</a>));
00236 
00237     <span class="comment">//</span>
00238     <span class="comment">// Change the Set/Reset register to be all set.</span>
00239     <span class="comment">//</span>
00240     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00241                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a54">IND_SET_RESET</a>, 0x07));
00242 
00243     <span class="comment">//</span>
00244     <span class="comment">// Use specified pixel positions.</span>
00245     <span class="comment">//</span>
00246     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00247                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a44">IND_BIT_MASK</a>, BitMask));
00248 
00249     <span class="comment">//</span>
00250     <span class="comment">// Set up to write data without interacting with the latches.</span>
00251     <span class="comment">//</span>
00252     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00253                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a40">IND_DATA_ROTATE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a64">DR_SET</a>));
00254 }
00255 
00256 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00257"></a><a class="code" href="../../d6/d2/port_8c.html#a6">00257</a> <a class="code" href="../../d6/d2/port_8c.html#a6">ColorSetDirect</a>(
00258     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension,
00259     PUCHAR FrameBuffer,
00260     BYTE ColorFg,
00261     BYTE ColorBg
00262     )
00263 
00264 <span class="comment">/*++</span>
00265 <span class="comment"></span>
00266 <span class="comment">ColorSetDirect</span>
00267 <span class="comment"></span>
00268 <span class="comment">  Set the VGA registers for drawing a full screen byte with opaque</span>
00269 <span class="comment">  font and opaque background.</span>
00270 <span class="comment"></span>
00271 <span class="comment">Created.</span>
00272 <span class="comment"></span>
00273 <span class="comment">--*/</span>
00274 
00275 {
00276     <span class="comment">//</span>
00277     <span class="comment">// Set up to write data without interacting with the latches.</span>
00278     <span class="comment">//</span>
00279     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00280                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a40">IND_DATA_ROTATE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a64">DR_SET</a>));
00281 
00282     <span class="comment">//</span>
00283     <span class="comment">// Put the background color in the Set/Reset register.</span>
00284     <span class="comment">//</span>
00285     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00286                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a54">IND_SET_RESET</a>, ColorBg));
00287 
00288     <span class="comment">//</span>
00289     <span class="comment">// That color is used for all planes.</span>
00290     <span class="comment">//</span>
00291     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00292                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a39">IND_SET_RESET_ENABLE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a61">GRAPH_ADDR_MASK</a>));
00293 
00294     <span class="comment">//</span>
00295     <span class="comment">// This gets our background color into the latches.</span>
00296     <span class="comment">//</span>
00297     <a class="code" href="../../d7/d8/fsvga_8h.html#a52">AccessGRAM_WR</a>(FrameBuffer, <a class="code" href="../../d1/d6/vga_8h.html#a61">GRAPH_ADDR_MASK</a>);
00298 
00299     <span class="comment">//</span>
00300     <span class="comment">// Change the Set/Reset register to be all zeroes.</span>
00301     <span class="comment">//</span>
00302     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00303                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a54">IND_SET_RESET</a>, 0));
00304 
00305     <span class="comment">//</span>
00306     <span class="comment">// The Set/Reset enable register now flags where the foreground/background colors are the same.</span>
00307     <span class="comment">//</span>
00308     ColorFg = ~(ColorFg ^ ColorBg);
00309     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00310                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a39">IND_SET_RESET_ENABLE</a>, ColorFg));
00311 
00312     <span class="comment">//</span>
00313     <span class="comment">// Color differences will be xor'd with the latches.</span>
00314     <span class="comment">//</span>
00315     WRITE_PORT_USHORT(deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o48">DeviceRegisters</a>[<a class="code" href="../../d7/d8/fsvga_8h.html#a66a20">GRAPHAddressPort</a>],
00316                       MAKEWORD(<a class="code" href="../../d1/d6/vga_8h.html#a40">IND_DATA_ROTATE</a>, <a class="code" href="../../d1/d6/vga_8h.html#a67">DR_XOR</a>));
00317 
00318 
00319 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
