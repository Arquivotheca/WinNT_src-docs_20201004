<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: validate.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>validate.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include &lt;ntsdexts.h&gt;</code><br>
<code>#include "<a class="el" href="../../d8/d8/wow_8h-source.html">wow.h</a>"</code><br>

<p>
<a href="../../d8/d2/validate_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a0">ClientSharedInfo</a>()&nbsp;&nbsp;&nbsp;(&amp;<a class="el" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a318">gSharedInfo</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a1">ServerInfo</a>()&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a317">gpsi</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a2">INCCRITSECCOUNT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a3">INCDEVICEINFOLISTCRITSECCOUNT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a4">CheckDevLockOut</a>()</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a6">ValidateHwinsta</a> (HWINSTA hwinsta, <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, ACCESS_MASK amDesired, <a class="el" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> *ppwinsta)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a7">ValidateHdesk</a> (HDESK hdesk, <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, ACCESS_MASK amDesired, <a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> *ppdesk)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HRGN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a8">UserValidateCopyRgn</a> (HRGN hrgn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a9">ValidateHmenu</a> (HMENU hmenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a10">ValidateHmonitor</a> (HMONITOR hmonitor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a11">IsHandleEntrySecure</a> (HANDLE h, <a class="el" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> phe)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a12">ValidateHandleSecure</a> (HANDLE h)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a13">ValidateHwnd</a> (HWND hwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a14">UserEnterUserCritSec</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a15">UserLeaveUserCritSec</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a16">UserGetCurrentDesktopId</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *pdwDesktopId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a17">UserIsUserCritSecIn</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a18">EnterCrit</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a19">EnterSharedCrit</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a20">LeaveCrit</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a21">ChangeAcquireResourceType</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>__int64&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/validate_8c.html#a5">gCSTimeExclusiveWhenEntering</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a4" doxytag="validate.c::CheckDevLockOut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CheckDevLockOut          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00795">795</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/validate_8c-source.html#l00887">ChangeAcquireResourceType()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00798">EnterCrit()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00833">EnterSharedCrit()</a>, and <a class="el" href="../../d8/d2/validate_8c-source.html#l00846">LeaveCrit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="validate.c::ClientSharedInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ClientSharedInfo          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(&amp;<a class="el" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a318">gSharedInfo</a>)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00020">20</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="validate.c::INCCRITSECCOUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INCCRITSECCOUNT          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00768">768</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/validate_8c-source.html#l00798">EnterCrit()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00833">EnterSharedCrit()</a>, and <a class="el" href="../../d8/d2/validate_8c-source.html#l00846">LeaveCrit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="validate.c::INCDEVICEINFOLISTCRITSECCOUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INCDEVICEINFOLISTCRITSECCOUNT          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00769">769</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="validate.c::ServerInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ServerInfo          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a317">gpsi</a>)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00021">21</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="validate.c::ChangeAcquireResourceType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ChangeAcquireResourceType           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00887">887</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d8/d2/validate_8c-source.html#l00795">CheckDevLockOut</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00757">gpresUser</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00665">gptiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01847">ISATOMICCHECK</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09596">NtUserGetKeyState()</a>.
<p>
<pre class="fragment"><div>00889 {
00890 <span class="preprocessor">#if DBG</span>
00891 <span class="preprocessor"></span>    FlushCallStack();
00892     <a class="code" href="../../d7/d3/validate_8c.html#a4">CheckDevLockOut</a>();
00893     UserAssert(!<a class="code" href="../../d4/d1/userk_8h.html#a168">ISATOMICCHECK</a>());
00894 <span class="preprocessor">#endif // DBG</span>
00895 <span class="preprocessor"></span>    <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(gpresUser);
00896     <a class="code" href="../../d5/d8/ex_8h.html#a269">ExAcquireResourceExclusiveLite</a>(gpresUser, TRUE);
00897     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a246">gptiCurrent</a> = ((<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)(W32GetCurrentThread()));
00898 <span class="preprocessor">#if DBG</span>
00899 <span class="preprocessor"></span>    GetCallStack();
00900 <span class="preprocessor">#endif // DBG</span>
00901 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="validate.c::EnterCrit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void EnterCrit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00798">798</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01836">CheckCritOut</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01837">CheckDeviceInfoListCritOut</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00795">CheckDevLockOut</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00034">gCSTimeExclusiveWhenEntering</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00757">gpresUser</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00665">gptiCurrent</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00768">INCCRITSECCOUNT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01847">ISATOMICCHECK</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00799 {
00800     <a class="code" href="../../d4/d1/userk_8h.html#a157">CheckCritOut</a>();
00801     <a class="code" href="../../d4/d1/userk_8h.html#a158">CheckDeviceInfoListCritOut</a>();
00802     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00803     <a class="code" href="../../d5/d8/ex_8h.html#a269">ExAcquireResourceExclusiveLite</a>(gpresUser, TRUE);
00804     <a class="code" href="../../d7/d3/validate_8c.html#a4">CheckDevLockOut</a>();
00805     UserAssert(!<a class="code" href="../../d4/d1/userk_8h.html#a168">ISATOMICCHECK</a>());
00806     UserAssert(gptiCurrent == NULL);
00807     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a246">gptiCurrent</a> = ((<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)(W32GetCurrentThread()));
00808     <a class="code" href="../../d7/d3/validate_8c.html#a2">INCCRITSECCOUNT</a>;
00809 <span class="preprocessor">#if defined (USER_PERFORMANCE)</span>
00810 <span class="preprocessor"></span>    {
00811         __int64 i64Frecv;
00812         *(LARGE_INTEGER*)(&amp;<a class="code" href="../../d7/d3/validate_8c.html#a5">gCSTimeExclusiveWhenEntering</a>) = <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>((LARGE_INTEGER*)&amp;i64Frecv);
00813         InterlockedIncrement(&amp;gCSStatistics.cExclusive);
00814     }
00815 <span class="preprocessor">#endif // (USER_PERFORMANCE)</span>
00816 <span class="preprocessor"></span>
00817 <span class="preprocessor">#if DBG</span>
00818 <span class="preprocessor"></span>    GetCallStack();
00819 <span class="preprocessor">#endif // DBG</span>
00820 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="validate.c::EnterSharedCrit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void EnterSharedCrit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00833">833</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d8/d2/validate_8c-source.html#l00795">CheckDevLockOut</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00762">ExAcquireResourceSharedLite()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00757">gpresUser</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00768">INCCRITSECCOUNT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01847">ISATOMICCHECK</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/desktop_8c-source.html#l04171">xxxUserFindHandleForObject()</a>.
<p>
<pre class="fragment"><div>00834 {
00835     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00836     <a class="code" href="../../d5/d8/ex_8h.html#a268">ExAcquireResourceSharedLite</a>(gpresUser, TRUE);
00837     <a class="code" href="../../d7/d3/validate_8c.html#a4">CheckDevLockOut</a>();
00838     UserAssert(!<a class="code" href="../../d4/d1/userk_8h.html#a168">ISATOMICCHECK</a>());
00839 <span class="preprocessor">#if defined (USER_PERFORMANCE)</span>
00840 <span class="preprocessor"></span>    InterlockedIncrement(&amp;gCSStatistics.cShared);
00841 <span class="preprocessor">#endif // (USER_PERFORMANCE)</span>
00842 <span class="preprocessor"></span>
00843     <a class="code" href="../../d7/d3/validate_8c.html#a2">INCCRITSECCOUNT</a>;
00844 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="validate.c::IsHandleEntrySecure" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsHandleEntrySecure           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>h</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>phe</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00232">232</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01438">tagHANDLETYPEINFO::bObjectCreateFlags</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01514">_HANDLEENTRY::bType</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/ntuser_2kernel_2globals_8h-source.html#l00496">gahti</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01344">OCF_PROCESSOWNED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01343">OCF_THREADOWNED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03453">tagW32JOB::pgh</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01447">_HANDLEENTRY::pOwner</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03319">tagTHREADINFO::ppi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03501">tagPROCESSINFO::pW32Job</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03451">tagW32JOB::ughCrt</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03452">tagW32JOB::ughMax</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/validate_8c-source.html#l00321">ValidateHandleSecure()</a>, and <a class="el" href="../../d8/d2/validate_8c-source.html#l00348">ValidateHwnd()</a>.
<p>
<pre class="fragment"><div>00235 {
00236     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        bCreateFlags;
00237     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppiOwner;
00238     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppiCurrent;
00239     <a class="code" href="../../d1/d9/structtagW32JOB.html">PW32JOB</a>      pW32Job;
00240     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        ind;
00241     PULONG_PTR    pgh;
00242 
00243     <span class="comment">/*</span>
00244 <span class="comment">     * get the current process</span>
00245 <span class="comment">     */</span>
00246     ppiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>();
00247 
00248     <span class="keywordflow">if</span> (ppiCurrent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00249         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00250 
00251     UserAssert(ppiCurrent-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o25">pW32Job</a> != NULL);
00252 
00253     UserAssert(ppiCurrent-&gt;W32PF_Flags &amp; W32PF_RESTRICTED);
00254 
00255     <span class="comment">/*</span>
00256 <span class="comment">     * get the process that owns the handle</span>
00257 <span class="comment">     */</span>
00258 
00259     bCreateFlags = <a class="code" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a241">gahti</a>[phe-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].<a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html#o2">bObjectCreateFlags</a>;
00260 
00261     ppiOwner = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00262 
00263     <span class="keywordflow">if</span> (bCreateFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a414">OCF_PROCESSOWNED</a>) {
00264         ppiOwner = (<a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a>)phe-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>;
00265     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bCreateFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a413">OCF_THREADOWNED</a>) {
00266 
00267         <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
00268 
00269         pti = (<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)phe-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>;
00270 
00271         <span class="keywordflow">if</span> (pti != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00272             ppiOwner = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>;
00273         }
00274     }
00275 
00276     <span class="comment">/*</span>
00277 <span class="comment">     * if the owner is NULL then consider the handle secure</span>
00278 <span class="comment">     */</span>
00279     <span class="keywordflow">if</span> (ppiOwner == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00280         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00281 
00282 
00283     <span class="comment">/*</span>
00284 <span class="comment">     * if the handle is owned by a process in the same job, then it's secure</span>
00285 <span class="comment">     */</span>
00286     <span class="keywordflow">if</span> (ppiOwner-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o25">pW32Job</a> == ppiCurrent-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o25">pW32Job</a>)
00287         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00288 
00289     <span class="comment">/*</span>
00290 <span class="comment">     * the handle is not owned by the current process</span>
00291 <span class="comment">     */</span>
00292 
00293     pW32Job = ppiCurrent-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o25">pW32Job</a>;
00294 
00295     <span class="keywordflow">if</span> (pW32Job-&gt;<a class="code" href="../../d1/d9/structtagW32JOB.html#o9">pgh</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00296         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00297 
00298     pgh = pW32Job-&gt;<a class="code" href="../../d1/d9/structtagW32JOB.html#o9">pgh</a>;
00299 
00300     UserAssert(pW32Job-&gt;<a class="code" href="../../d1/d9/structtagW32JOB.html#o7">ughCrt</a> &lt;= pW32Job-&gt;<a class="code" href="../../d1/d9/structtagW32JOB.html#o8">ughMax</a>);
00301 
00302     <span class="keywordflow">for</span> (ind = 0; ind &lt; pW32Job-&gt;<a class="code" href="../../d1/d9/structtagW32JOB.html#o7">ughCrt</a>; ind++) {
00303         <span class="keywordflow">if</span> (*(pgh + ind) == (ULONG_PTR)h) {
00304             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305         }
00306     }
00307 
00308     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00309 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="validate.c::LeaveCrit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void LeaveCrit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00846">846</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01836">CheckCritOut</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00795">CheckDevLockOut</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00034">gCSTimeExclusiveWhenEntering</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00757">gpresUser</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00665">gptiCurrent</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00768">INCCRITSECCOUNT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01847">ISATOMICCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00847 {
00848     <a class="code" href="../../d7/d3/validate_8c.html#a2">INCCRITSECCOUNT</a>;
00849 <span class="preprocessor">#if DBG</span>
00850 <span class="preprocessor"></span>    UserAssert(!<a class="code" href="../../d4/d1/userk_8h.html#a168">ISATOMICCHECK</a>());
00851     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00852     <a class="code" href="../../d7/d3/validate_8c.html#a4">CheckDevLockOut</a>();
00853     FlushCallStack();
00854     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a246">gptiCurrent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00855 <span class="preprocessor">#endif // DBG</span>
00856 <span class="preprocessor"></span>
00857 <span class="preprocessor">#if defined (USER_PERFORMANCE)</span>
00858 <span class="preprocessor"></span>    <span class="comment">/*</span>
00859 <span class="comment">     * A non null gCSTimeExclusiveWhenEntering means the</span>
00860 <span class="comment">     * critical section is owned exclusive</span>
00861 <span class="comment">     */</span>
00862     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/validate_8c.html#a5">gCSTimeExclusiveWhenEntering</a>) {
00863         __int64 i64Temp, i64Frecv;
00864 
00865         *(LARGE_INTEGER*)(&amp;i64Temp) = <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>((LARGE_INTEGER*)&amp;i64Frecv);
00866         gCSStatistics.i64TimeExclusive += i64Temp - <a class="code" href="../../d7/d3/validate_8c.html#a5">gCSTimeExclusiveWhenEntering</a>;
00867         <a class="code" href="../../d7/d3/validate_8c.html#a5">gCSTimeExclusiveWhenEntering</a> = 0;
00868     }
00869 <span class="preprocessor">#endif // (USER_PERFORMANCE)</span>
00870 <span class="preprocessor"></span>    <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(gpresUser);
00871     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00872     <a class="code" href="../../d4/d1/userk_8h.html#a157">CheckCritOut</a>();
00873 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="validate.c::UserEnterUserCritSec" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserEnterUserCritSec           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00472">472</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00473 {
00474     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00475 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="validate.c::UserGetCurrentDesktopId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UserGetCurrentDesktopId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pdwDesktopId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00494">494</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02651">tagDESKTOP::dwDesktopId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00495 {
00496     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesktop;
00497 
00498     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00499 
00500     <span class="comment">/*</span>
00501 <span class="comment">     * PtiCurrent()-&gt;rpdesk can be NULL !!! (in the case of thread shutdown).</span>
00502 <span class="comment">     */</span>
00503 
00504     pdesktop = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;rpdesk;
00505 
00506     <span class="keywordflow">if</span> (pdesktop != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>) {
00507         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UserGetCurrentDesktopId on wrong desktop pdesk\n"</span>);
00508         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00509     }
00510 
00511     *pdwDesktopId = pdesktop-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o5">dwDesktopId</a>;
00512 
00513     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00514 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="validate.c::UserIsUserCritSecIn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UserIsUserCritSecIn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00773">773</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02187">ExIsResourceAcquiredExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02245">ExIsResourceAcquiredSharedLite()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00757">gpresUser</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00774 {
00775     UserAssert(gpresUser != NULL);
00776     <span class="keywordflow">return</span>( (<a class="code" href="../../d5/d8/ex_8h.html#a281">ExIsResourceAcquiredExclusiveLite</a>(gpresUser) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) ||
00777             (<a class="code" href="../../d5/d8/ex_8h.html#a282">ExIsResourceAcquiredSharedLite</a>(gpresUser) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>));
00778 
00779     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00780 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="validate.c::UserLeaveUserCritSec" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserLeaveUserCritSec           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00477">477</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00478 {
00479     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00480 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="validate.c::UserValidateCopyRgn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HRGN UserValidateCopyRgn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HRGN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hrgn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00151">151</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l02217">CopyRgn</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00057">CreateEmptyRgn()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l00696">xxxDWP_DoNCActivate()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l05661">xxxSetWindowRgn()</a>.
<p>
<pre class="fragment"><div>00153 {
00154     HRGN hrgnCopy = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00155 
00156 
00157     <span class="keywordflow">if</span> (hrgn &amp;&amp; (GreValidateServerHandle(hrgn, RGN_TYPE))) {
00158 
00159         hrgnCopy = <a class="code" href="../../d4/d1/userk_8h.html#a1162">CreateEmptyRgn</a>();
00160 
00161         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a227">CopyRgn</a>(hrgnCopy, hrgn) == ERROR) {
00162 
00163             GreDeleteObject(hrgnCopy);
00164 
00165             hrgnCopy = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00166         }
00167     }
00168 
00169     <span class="keywordflow">return</span> hrgnCopy;
00170 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="validate.c::ValidateHandleSecure" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ValidateHandleSecure           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>h</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00321">321</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d8/d8/wow_8h-source.html#l00080">BeginTypeValidateHandleMacro</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01835">CheckCritInShared</a>, <a class="el" href="../../d8/d8/wow_8h-source.html#l00089">EndTypeValidateHandleMacro</a>, <a class="el" href="../../d8/d8/wow_8h-source.html#l00093">EndValidateHandleMacro</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00232">IsHandleEntrySecure()</a>, <a class="el" href="../../d8/d8/wow_8h-source.html#l00015">StartValidateHandleMacro</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00926">TYPE_GENERIC</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07894">NtUserValidateHandleSecure()</a>.
<p>
<pre class="fragment"><div>00323 {
00324     PVOID pobj;
00325 
00326     <a class="code" href="../../d4/d1/userk_8h.html#a156">CheckCritInShared</a>();
00327 
00328     <a class="code" href="../../d7/d9/wow_8h.html#a0">StartValidateHandleMacro</a>(h)
00329     BeginTypeValidateHandleMacro(pobj, TYPE_GENERIC)
00330 
00331         if (IsHandleEntrySecure(h, phe)) {
00332             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00333         }
00334 
00335     <a class="code" href="../../d7/d9/wow_8h.html#a4">EndTypeValidateHandleMacro</a>
00336     <a class="code" href="../../d7/d9/wow_8h.html#a5">EndValidateHandleMacro</a>
00337 
00338     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00339 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="validate.c::ValidateHdesk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ValidateHdesk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDESK&nbsp;</td>
          <td class="mdname" nowrap> <em>hdesk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>amDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppdesk</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00092">92</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l02579">DF_DESKWNDDESTROYED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02580">DF_DESTROYED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02578">DF_DYING</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00011">Error</a>, <a class="el" href="../../d4/d6/win32_8c-source.html#l00033">ExDesktopObjectType</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01539">LogDesktop</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08222">NtUserBuildHwndList()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01434">NtUserSetThreadDesktop()</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01467">NtUserSwitchDesktop()</a>.
<p>
<pre class="fragment"><div>00097 {
00098     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00099 
00100     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
00101             hdesk,
00102             amDesired,
00103             *ExDesktopObjectType,
00104             AccessMode,
00105             ppdesk,
00106             NULL);
00107 
00108     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00109 
00110         <span class="keywordflow">if</span> ((*ppdesk)-&gt;dwSessionId != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a>) {
00111 
00112             RIPNTERR3(STATUS_INVALID_HANDLE, RIP_WARNING,
00113                       <span class="stringliteral">"SessionId %d. Wrong session id %d for pdesk %#p"</span>,
00114                       gSessionId, (*ppdesk)-&gt;dwSessionId, *ppdesk);
00115 
00116             <span class="keywordflow">goto</span> <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a1">Error</a>;
00117         }
00118 
00119         <a class="code" href="../../d4/d1/userk_8h.html#a120">LogDesktop</a>(*ppdesk, LDL_VALIDATE_HDESK, TRUE, (ULONG_PTR)<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>());
00120 
00121         <span class="keywordflow">if</span> ((*ppdesk)-&gt;dwDTFlags &amp; (<a class="code" href="../../d4/d1/userk_8h.html#a287">DF_DESTROYED</a> | <a class="code" href="../../d4/d1/userk_8h.html#a286">DF_DESKWNDDESTROYED</a> | <a class="code" href="../../d4/d1/userk_8h.html#a285">DF_DYING</a>)) {
00122             RIPNTERR1(STATUS_INVALID_HANDLE, RIP_ERROR,
00123                       <span class="stringliteral">"ValidateHdesk: destroyed desktop %#p"</span>,
00124                       *ppdesk);
00125 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a1">Error</a>:
00126             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(*ppdesk);
00127 <span class="preprocessor">#if DBG</span>
00128 <span class="preprocessor"></span>            *ppdesk = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00129 <span class="preprocessor">#endif // DBG</span>
00130 <span class="preprocessor"></span>
00131             <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
00132         }
00133     } <span class="keywordflow">else</span> {
00134         RIPNTERR1(Status, RIP_VERBOSE, <span class="stringliteral">"ValidateHdesk failed for %#p"</span>, hdesk);
00135     }
00136 
00137     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00138 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="validate.c::ValidateHmenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> ValidateHmenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HMENU&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hmenu</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00181">181</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02786">tagMENU::head</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00150">HMValidateHandle()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00907">TYPE_MENU</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, <a class="el" href="../../d4/d1/mnchange_8c-source.html#l00796">xxxSetLPITEMInfo()</a>, and <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00568">xxxSetWindowData()</a>.
<p>
<pre class="fragment"><div>00183 {
00184     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00185     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenuRet;
00186 
00187     pmenuRet = (<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a6">HMValidateHandle</a>(hmenu, TYPE_MENU);
00188 
00189     <span class="keywordflow">if</span> (pmenuRet != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00190             ((pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;  <span class="comment">// hack so console initialization works.</span>
00191             pmenuRet-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o0">head</a>.rpdesk != pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>))) {
00192         RIPERR1(ERROR_INVALID_MENU_HANDLE, RIP_WARNING, <span class="stringliteral">"Invalid menu handle (%#p)"</span>, hmenu);
00193         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00194     }
00195 
00196     <span class="keywordflow">return</span> pmenuRet;
00197 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="validate.c::ValidateHmonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> ValidateHmonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HMONITOR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hmonitor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00210">210</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00419">HMValidateSharedHandle()</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00917">TYPE_MONITOR</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l13465">GetHDevName()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01501">xxxCreateThreadInfo()</a>, and <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>.
<p>
<pre class="fragment"><div>00212 {
00213     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a9">HMValidateSharedHandle</a>(hmonitor, TYPE_MONITOR);
00214 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="validate.c::ValidateHwinsta" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ValidateHwinsta           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWINSTA&nbsp;</td>
          <td class="mdname" nowrap> <em>hwinsta</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>amDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppwinsta</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00046">46</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d4/d6/win32_8c-source.html#l00032">ExWindowStationObjectType</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08365">NtUserBuildNameList()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01118">NtUserCloseWindowStation()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07070">NtUserLockWindowStation()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07110">NtUserSetWindowStationUser()</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07090">NtUserUnlockWindowStation()</a>.
<p>
<pre class="fragment"><div>00051 {
00052     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00053 
00054     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
00055             hwinsta,
00056             amDesired,
00057             *ExWindowStationObjectType,
00058             AccessMode,
00059             ppwinsta,
00060             NULL);
00061 
00062     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00063         RIPNTERR1(Status, RIP_VERBOSE, <span class="stringliteral">"ValidateHwinsta failed for %#p"</span>, hwinsta);
00064 
00065     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*ppwinsta)-&gt;dwSessionId != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a>) {
00066 
00067         RIPNTERR3(STATUS_INVALID_HANDLE, RIP_WARNING,
00068                   <span class="stringliteral">"SessionId %d. Wrong session id %d for pwinsta %#p"</span>,
00069                   gSessionId, (*ppwinsta)-&gt;dwSessionId, *ppwinsta);
00070 
00071         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(*ppwinsta);
00072 <span class="preprocessor">#if DBG</span>
00073 <span class="preprocessor"></span>        *ppwinsta = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00074 <span class="preprocessor">#endif // DBG</span>
00075 <span class="preprocessor"></span>
00076         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
00077     }
00078 
00079     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00080 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="validate.c::ValidateHwnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> FASTCALL ValidateHwnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00348">348</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00534">_CLIENTINFO::CallbackWnd</a>, <a class="el" href="../../d8/d8/wow_8h-source.html#l00093">EndValidateHandleMacro</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00034">FASTCALL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l02773">GetDesktopView()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01429">HANDLEF_DESTROY</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00150">HMValidateHandle()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00488">_CALLBACKWND::hwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03284">IS_THREAD_RESTRICTED</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00232">IsHandleEntrySecure()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03319">tagTHREADINFO::ppi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00507">_CALLBACKWND::pwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, <a class="el" href="../../d8/d8/wow_8h-source.html#l00015">StartValidateHandleMacro</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02828">TIF_SYSTEMTHREAD</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00906">TYPE_WINDOW</a>.
<p>
<pre class="fragment"><div>00350 {
00351     <a class="code" href="../../d7/d9/wow_8h.html#a0">StartValidateHandleMacro</a>(hwnd)
00352 
00353         <span class="comment">/*</span>
00354 <span class="comment">         * Now make sure the app is</span>
00355 <span class="comment">         * passing the right handle</span>
00356 <span class="comment">         * type for this api. If the</span>
00357 <span class="comment">         * handle is TYPE_FREE, this'll</span>
00358 <span class="comment">         * catch it.</span>
00359 <span class="comment">         */</span>
00360         if (phe-&gt;bType == TYPE_WINDOW) {
00361 
00362             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00363 
00364             <span class="comment">/*</span>
00365 <span class="comment">             * This is called from thunks for routines in the shared critsec.</span>
00366 <span class="comment">             */</span>
00367             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndRet = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)phe-&gt;phead;
00368 
00369             <span class="comment">/*</span>
00370 <span class="comment">             * This test establishes that the window belongs to the current</span>
00371 <span class="comment">             * 'desktop'.. The two exceptions are for the desktop-window of</span>
00372 <span class="comment">             * the current desktop, which ends up belonging to another desktop,</span>
00373 <span class="comment">             * and when pti-&gt;rpdesk is NULL.  This last case happens for</span>
00374 <span class="comment">             * initialization of TIF_SYSTEMTHREAD threads (ie. console windows).</span>
00375 <span class="comment">             * IanJa doesn't know if we should be test TIF_CSRSSTHREAD here, but</span>
00376 <span class="comment">             * JohnC thinks the whole test below is no longer required ??? LATER</span>
00377 <span class="comment">             */</span>
00378 
00379             <span class="keywordflow">if</span> (pwndRet != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00380                 <span class="keywordflow">if</span> (phe-&gt;bFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a421">HANDLEF_DESTROY</a>) {
00381                     RIPERR2(ERROR_INVALID_WINDOW_HANDLE,
00382                         RIP_WARNING,<span class="stringliteral">"ValidateHwnd, hwnd %#p, pwnd %#p already destroyed\n"</span>,
00383                             hwnd, pwndRet);
00384                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00385                 }
00386                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndRet) == pti ||
00387                        (
00388                         (pwndRet-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a> ||
00389                          (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a797">TIF_SYSTEMTHREAD</a>) ||  <span class="comment">// | TIF_CSRSSTHREAD I think</span>
00390                          <a class="code" href="../../d4/d1/userk_8h.html#a1283">GetDesktopView</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>, pwndRet-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk) !=
00391                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))) {
00392 
00393                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a382">IS_THREAD_RESTRICTED</a>(pti, JOB_OBJECT_UILIMIT_HANDLES)) {
00394 
00395                         <span class="comment">/*</span>
00396 <span class="comment">                         * make sure this window belongs to this process</span>
00397 <span class="comment">                         */</span>
00398                         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d3/validate_8c.html#a11">IsHandleEntrySecure</a>(hwnd, phe)) {
00399                             RIPERR1(ERROR_INVALID_WINDOW_HANDLE,
00400                                     RIP_WARNING,
00401                                     <span class="stringliteral">"ValidateHwnd: Invalid hwnd (%#p) for restricted process\n"</span>,
00402                                     hwnd);
00403                             pwndRet = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00404                         }
00405                     }
00406                     <span class="keywordflow">return</span> pwndRet;
00407                 }
00408             }
00409         }
00410 
00411     <a class="code" href="../../d7/d9/wow_8h.html#a5">EndValidateHandleMacro</a>
00412 
00413     RIPERR1(ERROR_INVALID_WINDOW_HANDLE,
00414             RIP_WARNING,
00415             <span class="stringliteral">"ValidateHwnd: Invalid hwnd (%#p)"</span>,
00416             hwnd);
00417     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00418 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a5" doxytag="validate.c::gCSTimeExclusiveWhenEntering" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __int64 <a class="el" href="../../d7/d3/validate_8c.html#a5">gCSTimeExclusiveWhenEntering</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/validate_8c-source.html#l00034">34</a> of file <a class="el" href="../../d8/d2/validate_8c-source.html">validate.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/validate_8c-source.html#l00798">EnterCrit()</a>, and <a class="el" href="../../d8/d2/validate_8c-source.html#l00846">LeaveCrit()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:06 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
