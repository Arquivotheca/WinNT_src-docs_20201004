<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kd.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kd.h File Reference</h1>
<p>
<a href="../../d8/d2/kd_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">_KD_SYMBOLS_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">_DEBUG_PARAMETERS</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a0">CP_GET_SUCCESS</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a1">CP_GET_NODATA</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a2">CP_GET_ERROR</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a3">FREEZE_BACKUP</a>&nbsp;&nbsp;&nbsp;0x0001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a4">FREEZE_SKIPPED_PROCESSOR</a>&nbsp;&nbsp;&nbsp;0x0002</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a5">FREEZE_FROZEN</a>&nbsp;&nbsp;&nbsp;0x0004</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a>&nbsp;&nbsp;&nbsp;4096</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">_KD_SYMBOLS_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a8">KD_SYMBOLS_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">_KD_SYMBOLS_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a9">PKD_SYMBOLS_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">_DEBUG_PARAMETERS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a10">DEBUG_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">_DEBUG_PARAMETERS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a11">PDEBUG_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef _DBGKD_DEBUG_DATA_HEADER64 *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a16">KdInitSystem</a> (IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock, BOOLEAN StopInDebugger)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a17">KdEnterDebugger</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a18">KdExitDebugger</a> (IN BOOLEAN Enable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a19">KdPollBreakIn</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a20">KdIsThisAKdTrap</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a21">KdSetOwedBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a22">KdDeleteAllBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a23">KdUpdateTimeSlipEvent</a> (PVOID Event)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a24">KdUpdateDataBlock</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a25">KdGetDataBlock</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a26">KdRegisterDebuggerDataBlock</a> (IN ULONG Tag, IN <a class="el" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a> DataHeader, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a27">KdDeregisterDebuggerDataBlock32</a> (IN <a class="el" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a> DataHeader)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a28">KdDisableDebugger</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a29">KdEnableDebugger</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a30">KdLogDbgPrint</a> (IN PSTRING <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a12">KdDebuggerNotPresent</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">DEBUG_PARAMETERS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/kd_8h.html#a14">KdDebugParameters</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="kd.h::CP_GET_ERROR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CP_GET_ERROR&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00032">32</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00342">KdpReceivePacket()</a>, and <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00095">KdpReceivePacketLeader()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="kd.h::CP_GET_NODATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CP_GET_NODATA&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00031">31</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00342">KdpReceivePacket()</a>, and <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00095">KdpReceivePacketLeader()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="kd.h::CP_GET_SUCCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CP_GET_SUCCESS&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00030">30</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00165">KdpPollBreakInWithPortLock()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00342">KdpReceivePacket()</a>, and <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00209">KdpReceiveString()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="kd.h::FREEZE_BACKUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FREEZE_BACKUP&nbsp;&nbsp;&nbsp;0x0001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00040">40</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00303">KdEnterDebugger()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="kd.h::FREEZE_FROZEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FREEZE_FROZEN&nbsp;&nbsp;&nbsp;0x0004          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00042">42</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="kd.h::FREEZE_SKIPPED_PROCESSOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FREEZE_SKIPPED_PROCESSOR&nbsp;&nbsp;&nbsp;0x0002          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00041">41</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00303">KdEnterDebugger()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="kd.h::KDPRINTBUFFERSIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KDPRINTBUFFERSIZE&nbsp;&nbsp;&nbsp;4096          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00203">203</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00379">KdLogDbgPrint()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a10" doxytag="kd.h::DEBUG_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">_DEBUG_PARAMETERS</a>  <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">DEBUG_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="kd.h::KD_SYMBOLS_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">_KD_SYMBOLS_INFO</a>  <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">KD_SYMBOLS_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="kd.h::PDBGKD_DEBUG_DATA_HEADER64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct _DBGKD_DEBUG_DATA_HEADER64* <a class="el" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00167">167</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00363">KdDeregisterDebuggerDataBlock()</a>, and <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00287">KdRegisterDebuggerDataBlock()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="kd.h::PDEBUG_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">_DEBUG_PARAMETERS</a> * <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">PDEBUG_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="kd.h::PKD_SYMBOLS_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">_KD_SYMBOLS_INFO</a> * <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">PKD_SYMBOLS_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d4/debug3_8c-source.html#l00062">DebugLoadImageSymbols()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a22" doxytag="kd.h::KdDeleteAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdDeleteAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01332">1332</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00248">BreakpointsSuspended</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>, and <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>.
<p>
<pre class="fragment"><div>01335 {
01336     ULONG <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01337 
01338     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> || <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01339         <span class="keywordflow">return</span>;
01340     }
01341 
01342     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01343 
01344     <span class="keywordflow">for</span> ( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = 1; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &lt;= BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>++ ) {
01345         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(Handle);
01346     }
01347 
01348     <span class="keywordflow">return</span>;
01349 } <span class="comment">// KdDeleteAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="kd.h::KdDeregisterDebuggerDataBlock32" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdDeregisterDebuggerDataBlock32           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DataHeader</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="kd.h::KdDisableDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdDisableDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">3240</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00243">KdDisableCount</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00026">KdpPortLock()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00244">KdPreviouslyEnabled</a>, <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00386">KdpStub()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00972">KdpSuspendAllBreakpoints()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, and <a class="el" href="../../d1/d6/kdp_8h-source.html#l00437">KiDebugRoutine</a>.
<p>
<pre class="fragment"><div>03246                    :
03247 
03248     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to disable <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger.
03249 
03250 Arguments:
03251 
03252     None.
03253 
03254 Return Value:
03255 
03256     None.
03257 
03258 --*/
03259 
03260 {
03261     KIRQL oldIrql ;
03262 
03263     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(DISPATCH_LEVEL, &amp;oldIrql) ;
03264     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a145">KdpPortLock</a>();
03265 
03266     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>) {
03267 
03268         <a class="code" href="../../d8/d3/kdapi_8c.html#a4">KdPreviouslyEnabled</a> = <a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> &amp;&amp; (!<a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a>) ;
03269         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a>) {
03270 
03271             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a139">KdpSuspendAllBreakpoints</a>() ;
03272             <a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> = <a class="code" href="../../d7/d8/alpha_2kdtrap_8c.html#a2">KdpStub</a>;
03273             <a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
03274         }
03275     }
03276     <a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>++ ;
03277     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
03278     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(oldIrql);
03279 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="kd.h::KdEnableDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdEnableDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">3282</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00243">KdDisableCount</a>, <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00072">KdInitSystem()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00026">KdpPortLock()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01309">KdpRestoreAllBreakpoints()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00244">KdPreviouslyEnabled</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d1/po_8h-source.html#l00464">PoHiberInProgress</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>03287                    :
03288 
03289     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to reenable <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger after a call to
03290     <a class="code" href="../../d7/d3/kd_8h.html#a28">KdDisableDebugger</a>.
03291 
03292 Arguments:
03293 
03294     None.
03295 
03296 Return Value:
03297 
03298     None.
03299 
03300 --*/
03301 {
03302     KIRQL oldIrql ;
03303 
03304     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(DISPATCH_LEVEL, &amp;oldIrql) ;
03305     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a145">KdpPortLock</a>();
03306 
03307     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KdDisableCount &gt; 0) ;
03308     <a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>-- ;
03309 
03310     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>) {
03311         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d3/kdapi_8c.html#a4">KdPreviouslyEnabled</a>) {
03312 
03313             <span class="comment">//</span>
03314             <span class="comment">// Ugly HACKHACK - Make sure the timers aren't reset.</span>
03315             <span class="comment">//</span>
03316             <a class="code" href="../../d1/d2/po_8h.html#a55">PoHiberInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
03317             <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a4">KdInitSystem</a>(NULL, FALSE) ;
03318             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a140">KdpRestoreAllBreakpoints</a>();
03319             <a class="code" href="../../d1/d2/po_8h.html#a55">PoHiberInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
03320         }
03321     }
03322     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
03323     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(oldIrql);
03324 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="kd.h::KdEnterDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdEnterDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00303">303</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00040">FREEZE_BACKUP</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00041">FREEZE_SKIPPED_PROCESSOR</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00301">KdEnteredDebugger</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00056">KdpDebuggerLock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a204">KdPortSave()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00222">KdpPortLocked</a>, <a class="el" href="../../d3/d3/alpha_2kdcmsup_8c-source.html#l00024">KdpQueryPerformanceCounter()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00209">KdTimerDifference</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00207">KdTimerStart</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00208">KdTimerStop</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00389">KiFreezeFlag</a>, <a class="el" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock()</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00046">TimeFields</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00028">KdpTrap()</a>, and <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00316">KdSetOwedBreakpoints()</a>.
<p>
<pre class="fragment"><div>00310                    :
00311 
00312     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to enter <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger. Its purpose
00313     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to freeze all other processors and aqcuire <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger
00314     comm port.
00315 
00316 Arguments:
00317 
00318     TrapFrame - Supplies a pointer to a trap frame that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00319         trap.
00320 
00321     ExceptionFrame - Supplies a pointer to an exception frame that
00322         describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap.
00323 
00324 Return Value:
00325 
00326     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous interrupt enable.
00327 
00328 --*/
00329 
00330 {
00331 
00332     BOOLEAN Enable;
00333     TIME_FIELDS <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>;
00334 <span class="preprocessor">#if DBG</span>
00335 <span class="preprocessor"></span>    <span class="keyword">extern</span> ULONG <a class="code" href="../../d5/d9/kernldat_8c.html#a43">KiFreezeFlag</a>;
00336 <span class="preprocessor">#endif</span>
00337 <span class="preprocessor"></span>
00338     <span class="comment">//</span>
00339     <span class="comment">// HACKHACK - do some crude timer support</span>
00340     <span class="comment">//            but not if called from KdSetOwedBreakpoints()</span>
00341     <span class="comment">//</span>
00342 
00343     <span class="keywordflow">if</span> (TrapFrame) {
00344         <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a> = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a5">KdpQueryPerformanceCounter</a> (TrapFrame);
00345         <a class="code" href="../../d8/d5/kddata_8c.html#a58">KdTimerDifference</a>.QuadPart = <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>.QuadPart - <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a>.QuadPart;
00346     } <span class="keywordflow">else</span> {
00347         <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>.QuadPart = 0;
00348     }
00349 
00350     <span class="comment">//</span>
00351     <span class="comment">// Freeze all other processors, raise IRQL to HIGH_LEVEL, and save debug</span>
00352     <span class="comment">// port state.  We lock the port so that KdPollBreakin and a debugger</span>
00353     <span class="comment">// operation don't interfere with each other.</span>
00354     <span class="comment">//</span>
00355 
00356     Enable = <a class="code" href="../../d9/d4/ke_2debug_8c.html#a9">KeFreezeExecution</a>(TrapFrame, ExceptionFrame);
00357     <a class="code" href="../../d8/d5/kddata_8c.html#a68">KdpPortLocked</a> = <a class="code" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock</a>(&amp;KdpDebuggerLock);
00358     <a class="code" href="../../d2/d7/hal_8h.html#a204">KdPortSave</a>();
00359     <a class="code" href="../../d8/d5/kddata_8c.html#a109">KdEnteredDebugger</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00360 
00361 <span class="preprocessor">#if DBG</span>
00362 <span class="preprocessor"></span>
00363     <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a43">KiFreezeFlag</a> &amp; <a class="code" href="../../d7/d3/kd_8h.html#a3">FREEZE_BACKUP</a>) != 0) {
00364         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"FreezeLock was jammed!  Backup SpinLock was used!\n"</span>));
00365     }
00366 
00367     <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a43">KiFreezeFlag</a> &amp; <a class="code" href="../../d7/d3/kd_8h.html#a4">FREEZE_SKIPPED_PROCESSOR</a>) != 0) {
00368         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"Some processors not frozen in debugger!\n"</span>));
00369     }
00370 
00371     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a68">KdpPortLocked</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00372         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"Port lock was not acquired!\n"</span>));
00373     }
00374 
00375 <span class="preprocessor">#endif</span>
00376 <span class="preprocessor"></span>
00377     <span class="keywordflow">return</span> Enable;
00378 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="kd.h::KdExitDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdExitDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Enable</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00381">381</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d2/d7/hal_8h.html#a203">KdPortRestore()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00222">KdpPortLocked</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00290">KdpTimeSlipDpc</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00293">KdpTimeSlipPending</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00207">KdTimerStart</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00208">KdTimerStop</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d1/po_8h-source.html#l00464">PoHiberInProgress</a>, and <a class="el" href="../../d7/d5/ttime_8c-source.html#l00046">TimeFields</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00028">KdpTrap()</a>, and <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00316">KdSetOwedBreakpoints()</a>.
<p>
<pre class="fragment"><div>00387                    :
00388 
00389     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger. It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reverse
00390     of <a class="code" href="../../d7/d3/kd_8h.html#a17">KdEnterDebugger</a>.
00391 
00392 Arguments:
00393 
00394     Enable - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous interrupt enable which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be restored.
00395 
00396 Return Value:
00397 
00398     None.
00399 
00400 --*/
00401 
00402 {
00403     ULONG ElapsedTime;
00404     ULARGE_INTEGER TimeDifference;
00405     TIME_FIELDS <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>;
00406     ULONG Pending;
00407 
00408     <span class="comment">//</span>
00409     <span class="comment">// restore stuff and exit</span>
00410     <span class="comment">//</span>
00411 
00412     <a class="code" href="../../d2/d7/hal_8h.html#a203">KdPortRestore</a>();
00413     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a68">KdpPortLocked</a>) {
00414         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
00415     }
00416 
00417     <a class="code" href="../../d9/d4/ke_2debug_8c.html#a12">KeThawExecution</a>(Enable);
00418 
00419     <span class="comment">//</span>
00420     <span class="comment">// Do some crude timer support.  If KdEnterDebugger didn't</span>
00421     <span class="comment">// Query the performance counter, then don't do it here either.</span>
00422     <span class="comment">//</span>
00423 
00424     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>.QuadPart == 0) {
00425         <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>;
00426     } <span class="keywordflow">else</span> {
00427         <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a> = <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>(NULL);
00428     }
00429 
00430     <span class="comment">//</span>
00431     <span class="comment">// Process a time slip</span>
00432     <span class="comment">//</span>
00433 
00434     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d2/po_8h.html#a55">PoHiberInProgress</a>) {
00435 
00436         Pending = InterlockedIncrement(&amp;KdpTimeSlipPending);
00437 
00438         <span class="comment">//</span>
00439         <span class="comment">// If there's wasn't a time slip pending, queue the DPC to handle it</span>
00440         <span class="comment">//</span>
00441 
00442         <span class="keywordflow">if</span> (Pending == 1) {
00443             InterlockedIncrement(&amp;KdpTimeSlipPending);
00444             <a class="code" href="../../d4/d1/dpcobj_8c.html#a2">KeInsertQueueDpc</a>(&amp;KdpTimeSlipDpc, NULL, NULL);
00445         }
00446     }
00447 
00448     <span class="keywordflow">return</span>;
00449 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="kd.h::KdGetDataBlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR KdGetDataBlock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00055">55</a> of file <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html">4/kdinit.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00106">KdDebuggerDataBlock</a>.
<p>
Referenced by <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01519">IoWriteCrashDump()</a>.
<p>
<pre class="fragment"><div>00060                    :
00061 
00062     We have to update <span class="keyword">this</span> variable seperately since <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> initialized at a
00063     later time by PS.  PS will call us to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data block.
00064 
00065 --*/
00066 {
00067     <span class="keywordflow">return</span> (ULONG_PTR)(&amp;<a class="code" href="../../d8/d5/kddata_8c.html#a50">KdDebuggerDataBlock</a>);
00068 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="kd.h::KdInitSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdInitSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LoaderBlock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>StopInDebugger</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">36</a> of file <a class="el" href="../../d5/d5/kdinit_8c-source.html">kdinit.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00027">BAUD_OPTION</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00115">_DEBUG_PARAMETERS::BaudRate</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00114">_DEBUG_PARAMETERS::CommunicationPort</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00172">_BREAKPOINT_ENTRY::DirectoryTableBase</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01961">ExInitializeWorkItem</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00106">KdDebuggerDataBlock</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00142">KdDebugParameters</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00082">KDP_BREAKPOINT_VALUE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00280">KdpDebuggerDataListHead</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00299">KdpDebuggerStructuresInitialized</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00206">KdPerformanceCounterRate</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00264">KdpNextPacketIdToSend</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00266">KdpNtosImageBase</a>, <a class="el" href="../../d2/d7/hal_8h.html#a199">KdPortInitialize()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00265">KdpPacketIdExpected</a>, <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00386">KdpStub()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02318">KdpSwitchProcessor()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00290">KdpTimeSlipDpc</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00494">KdpTimeSlipDpcRoutine()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00292">KdpTimeSlipTimer</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00528">KdpTimeSlipWork()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00291">KdpTimeSlipWorkItem</a>, <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00028">KdpTrap()</a>, <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00287">KdRegisterDebuggerDataBlock()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00207">KdTimerStart</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00039">KeInitializeDpc()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00043">KeInitializeTimer()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00437">KiDebugRoutine</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00438">KiDebugSwitchRoutine</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00028">PORT_OPTION</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">KdEnableDebugger()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d9/d9/ppc_2dmpstate_8c-source.html#l00067">KeDumpMachineState()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>, and <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.
<p>
<pre class="fragment"><div>00043                    :
00044 
00045     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> portable kernel debugger.
00046 
00047 Arguments:
00048 
00049     LoaderBlock - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">LOADER_PARAMETER_BLOCK</a> passed
00050         in from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> OS Loader.
00051 
00052     StopInDebugger - Supplies a <span class="keywordtype">boolean</span> value that determines whether a
00053         debug message and breakpoint are generated.
00054 
00055 Return Value:
00056 
00057     None.
00058 
00059 --*/
00060 
00061 {
00062 
00063     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00064     BOOLEAN Initialize;
00065     PCHAR Options;
00066     PCHAR BaudOption;
00067     PCHAR PortOption;
00068 
00069     <span class="comment">//</span>
00070     <span class="comment">// If kernel debugger is already initialized, then return.</span>
00071     <span class="comment">//</span>
00072 
00073     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00074         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00075     }
00076 
00077     <a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> = <a class="code" href="../../d7/d8/alpha_2kdtrap_8c.html#a2">KdpStub</a>;
00078 
00079     <span class="comment">//</span>
00080     <span class="comment">// Determine whether or not the debugger should be enabled.</span>
00081     <span class="comment">//</span>
00082     <span class="comment">// Note that if LoaderBlock == NULL, then KdInitSystem was called</span>
00083     <span class="comment">// from BugCheck code. For this case the debugger is always enabled</span>
00084     <span class="comment">// to report the bugcheck if possible.</span>
00085     <span class="comment">//</span>
00086 
00087     <span class="keywordflow">if</span> (LoaderBlock != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00088 
00089         <a class="code" href="../../d8/d5/kddata_8c.html#a94">KdpNtosImageBase</a> =  CONTAINING_RECORD(
00090                                     (LoaderBlock-&gt;LoadOrderListHead.Flink),
00091                                     LDR_DATA_TABLE_ENTRY,
00092                                     InLoadOrderLinks)-&gt;DllBase;
00093 
00094         <span class="comment">//</span>
00095         <span class="comment">// Initialize the debugger data block list when called at startup time.</span>
00096         <span class="comment">//</span>
00097 
00098         InitializeListHead(&amp;KdpDebuggerDataListHead);
00099 
00100         <span class="comment">//</span>
00101         <span class="comment">// Fill in and register the debugger's debugger data block.</span>
00102         <span class="comment">// Most fields are already initialized, some fields will not be</span>
00103         <span class="comment">// filled in until later.</span>
00104         <span class="comment">//</span>
00105 
00106         <a class="code" href="../../d8/d5/kddata_8c.html#a50">KdDebuggerDataBlock</a>.KernBase = (ULONG_PTR) <a class="code" href="../../d8/d5/kddata_8c.html#a94">KdpNtosImageBase</a>;
00107         <a class="code" href="../../d8/d5/kddata_8c.html#a50">KdDebuggerDataBlock</a>.KeUserCallbackDispatcher = (ULONG_PTR) <a class="code" href="../../d4/d9/ke_8h.html#a149">KeUserCallbackDispatcher</a>;
00108 
00109         <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a5">KdRegisterDebuggerDataBlock</a>(KDBG_TAG,
00110                                     &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a50">KdDebuggerDataBlock</a>.Header,
00111                                     <span class="keyword">sizeof</span>(KdDebuggerDataBlock));
00112 
00113         <span class="keywordflow">if</span> (LoaderBlock-&gt;LoadOptions != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00114             Options = LoaderBlock-&gt;LoadOptions;
00115             _strupr(Options);
00116 
00117             <span class="comment">//</span>
00118             <span class="comment">// If any of the port option, baud option, or debug is specified,</span>
00119             <span class="comment">// then enable the debugger unless it is explictly disabled.</span>
00120             <span class="comment">//</span>
00121 
00122             Initialize = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00123             PortOption = strstr(Options, PORT_OPTION);
00124             BaudOption = strstr(Options, BAUD_OPTION);
00125             <span class="keywordflow">if</span> ((PortOption == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (BaudOption == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00126                 <span class="keywordflow">if</span> (strstr(Options, <span class="stringliteral">"DEBUG"</span>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00127                     Initialize = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00128                 }
00129 
00130             } <span class="keywordflow">else</span> {
00131                 <span class="keywordflow">if</span> (PortOption) {
00132                     PortOption = strstr(PortOption, <span class="stringliteral">"COM"</span>);
00133                     <span class="keywordflow">if</span> (PortOption) {
00134                         <a class="code" href="../../d7/d3/kd_8h.html#a14">KdDebugParameters</a>.<a class="code" href="../../d0/d2/struct__DEBUG__PARAMETERS.html#o0">CommunicationPort</a> =
00135                                                      atol(PortOption + 3);
00136                     }
00137                 }
00138 
00139                 <span class="keywordflow">if</span> (BaudOption) {
00140                     BaudOption += <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(BAUD_OPTION);
00141                     <span class="keywordflow">while</span> (*BaudOption == <span class="charliteral">' '</span>) {
00142                         BaudOption++;
00143                     }
00144 
00145                     <span class="keywordflow">if</span> (*BaudOption != <span class="charliteral">'\0'</span>) {
00146                         <a class="code" href="../../d7/d3/kd_8h.html#a14">KdDebugParameters</a>.<a class="code" href="../../d0/d2/struct__DEBUG__PARAMETERS.html#o1">BaudRate</a> = atol(BaudOption + 1);
00147                     }
00148                 }
00149             }
00150 
00151             <span class="comment">//</span>
00152             <span class="comment">// If the debugger is explicitly disabled, then set to NODEBUG.</span>
00153             <span class="comment">//</span>
00154 
00155             <span class="keywordflow">if</span> (strstr(Options, <span class="stringliteral">"NODEBUG"</span>)) {
00156                 Initialize = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00157                 <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00158             }
00159 
00160             <span class="keywordflow">if</span> (strstr(Options, <span class="stringliteral">"CRASHDEBUG"</span>)) {
00161                 Initialize = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00162                 <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00163             }
00164 
00165         } <span class="keywordflow">else</span> {
00166 
00167             <span class="comment">//</span>
00168             <span class="comment">// If the load options are not specified, then set to NODEBUG.</span>
00169             <span class="comment">//</span>
00170 
00171             <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00172             Initialize = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00173         }
00174 
00175     } <span class="keywordflow">else</span> {
00176         Initialize = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00177     }
00178 
00179     <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d7/hal_8h.html#a199">KdPortInitialize</a>(&amp;KdDebugParameters, LoaderBlock, Initialize) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ||
00180         (Initialize == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00181         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00182     }
00183 
00184     <span class="comment">//</span>
00185     <span class="comment">// Set address of kernel debugger trap routine.</span>
00186     <span class="comment">//</span>
00187 
00188     <a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> = <a class="code" href="../../d7/d8/alpha_2kdtrap_8c.html#a0">KdpTrap</a>;
00189 
00190     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d5/kddata_8c.html#a107">KdpDebuggerStructuresInitialized</a>) {
00191 
00192         <a class="code" href="../../d0/d7/kdp_8h.html#a25">KiDebugSwitchRoutine</a> = <a class="code" href="../../d8/d3/kdapi_8c.html#a30">KdpSwitchProcessor</a>;
00193         <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a6">KDP_BREAKPOINT_VALUE</a>;
00194         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00195 
00196         <span class="comment">//</span>
00197         <span class="comment">// Initialize the breakpoint table.</span>
00198         <span class="comment">//</span>
00199 
00200         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00201             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00202             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00203             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00204         }
00205 
00206         <span class="comment">//</span>
00207         <span class="comment">// Initialize TimeSlip</span>
00208         <span class="comment">//</span>
00209         <a class="code" href="../../d4/d1/dpcobj_8c.html#a1">KeInitializeDpc</a>(&amp;KdpTimeSlipDpc, KdpTimeSlipDpcRoutine, NULL);
00210         <a class="code" href="../../d3/d2/timerobj_8c.html#a1">KeInitializeTimer</a>(&amp;KdpTimeSlipTimer);
00211         <a class="code" href="../../d5/d8/ex_8h.html#a55">ExInitializeWorkItem</a>(&amp;KdpTimeSlipWorkItem, KdpTimeSlipWork, NULL);
00212 
00213         <a class="code" href="../../d8/d5/kddata_8c.html#a107">KdpDebuggerStructuresInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00214     }
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">//  Initialize timer facility - HACKHACK</span>
00218     <span class="comment">//</span>
00219 
00220     <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>(&amp;KdPerformanceCounterRate);
00221     <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a>.HighPart = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00222     <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a>.LowPart = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00223 
00224     <span class="comment">//</span>
00225     <span class="comment">// Initialize ID for NEXT packet to send and Expect ID of next incoming</span>
00226     <span class="comment">// packet.</span>
00227     <span class="comment">//</span>
00228 
00229     <a class="code" href="../../d8/d5/kddata_8c.html#a92">KdpNextPacketIdToSend</a> = INITIAL_PACKET_ID | SYNC_PACKET_ID;
00230     <a class="code" href="../../d8/d5/kddata_8c.html#a93">KdpPacketIdExpected</a> = INITIAL_PACKET_ID;
00231 
00232     <span class="comment">//</span>
00233     <span class="comment">// Mark debugger enabled.</span>
00234     <span class="comment">//</span>
00235     <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00236     <a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00237     SharedUserData-&gt;KdDebuggerEnabled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00238 
00239     <span class="comment">//</span>
00240     <span class="comment">// If requested, stop in the kernel debugger.</span>
00241     <span class="comment">//</span>
00242 
00243     <span class="keywordflow">if</span> (StopInDebugger) {
00244         DbgBreakPoint();
00245     }
00246 
00247     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00248 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="kd.h::KdIsThisAKdTrap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdIsThisAKdTrap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00264">264</a> of file <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html">alpha/kdtrap.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00617">BREAKIN_BREAKPOINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00616">KERNEL_BREAKPOINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>.
<p>
<pre class="fragment"><div>00272                    :
00273 
00274     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called whenever a user-mode exception occurs and
00275     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> might be a kernel debugger exception (Like DbgPrint/DbgPrompt ).
00276 
00277 Arguments:
00278 
00279     ExceptionRecord - Supplies a pointer to an exception record that
00280         describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception.
00281 
00282     ContextRecord - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception.
00283 
00284     PreviousMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous processor mode.
00285 
00286 Return Value:
00287 
00288     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger.
00289     Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00290 
00291 --*/
00292 
00293 {
00294 
00295     <span class="comment">//</span>
00296     <span class="comment">// Isolate the breakpoint code from the breakpoint instruction which</span>
00297     <span class="comment">// is stored by the exception dispatch code in the information field</span>
00298     <span class="comment">// of the exception record.</span>
00299     <span class="comment">//</span>
00300 
00301     <span class="comment">//</span>
00302     <span class="comment">// Switch on the breakpoint code.</span>
00303     <span class="comment">//</span>
00304 
00305     <span class="keywordflow">switch</span> (ExceptionRecord-&gt;ExceptionInformation[0]) {
00306 
00307         <span class="comment">//</span>
00308         <span class="comment">// Kernel breakpoint code.</span>
00309         <span class="comment">//</span>
00310 
00311     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a453">KERNEL_BREAKPOINT</a>:
00312     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a454">BREAKIN_BREAKPOINT</a>:
00313 <span class="preprocessor">#if DEVL</span>
00314 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00315 <span class="preprocessor">#else</span>
00316 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00317             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00318 
00319         } <span class="keywordflow">else</span> {
00320             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00321         }
00322 <span class="preprocessor">#endif</span>
00323 <span class="preprocessor"></span>
00324         <span class="comment">//</span>
00325         <span class="comment">// Debug print code.</span>
00326         <span class="comment">//</span>
00327 
00328     <span class="keywordflow">case</span> DEBUG_PRINT_BREAKPOINT:
00329         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00330 
00331         <span class="comment">//</span>
00332         <span class="comment">// Debug prompt code.</span>
00333         <span class="comment">//</span>
00334     <span class="keywordflow">case</span> DEBUG_PROMPT_BREAKPOINT:
00335         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00336 
00337         <span class="comment">//</span>
00338         <span class="comment">// Debug stop code.</span>
00339         <span class="comment">//</span>
00340 
00341     <span class="keywordflow">case</span> DEBUG_STOP_BREAKPOINT:
00342 <span class="preprocessor">#if DEVL</span>
00343 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00344 <span class="preprocessor">#else</span>
00345 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00346             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00347 
00348         } <span class="keywordflow">else</span> {
00349             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00350         }
00351 <span class="preprocessor">#endif</span>
00352 <span class="preprocessor"></span>
00353         <span class="comment">//</span>
00354         <span class="comment">// Debug load symbols code.</span>
00355         <span class="comment">//</span>
00356 
00357     <span class="keywordflow">case</span> DEBUG_LOAD_SYMBOLS_BREAKPOINT:
00358         <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00359             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00360 
00361         } <span class="keywordflow">else</span> {
00362             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00363         }
00364 
00365         <span class="comment">//</span>
00366         <span class="comment">// Debug unload symbols code.</span>
00367         <span class="comment">//</span>
00368 
00369     <span class="keywordflow">case</span> DEBUG_UNLOAD_SYMBOLS_BREAKPOINT:
00370         <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00371             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00372 
00373         } <span class="keywordflow">else</span> {
00374             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00375         }
00376         <span class="comment">//</span>
00377         <span class="comment">// All other codes.</span>
00378         <span class="comment">//</span>
00379 
00380     <span class="keywordflow">default</span>:
00381         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00382     }
00383 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="kd.h::KdLogDbgPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdLogDbgPrint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSTRING&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>String</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00379">379</a> of file <a class="el" href="../../d5/d5/kdinit_8c-source.html">kdinit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00104">KdpPrintSpinLock</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00203">KDPRINTBUFFERSIZE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00101">KdPrintCircularBuffer</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00103">KdPrintRolloverCount</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00102">KdPrintWritePointer</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock()</a>, and <a class="el" href="../../d5/d8/talloc_8c-source.html#l00027">String</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00028">KdpTrap()</a>.
<p>
<pre class="fragment"><div>00382 {
00383     KIRQL OldIrql;
00384     ULONG Length;
00385     ULONG LengthCopied;
00386 
00387     <span class="keywordflow">for</span> (; ;) {
00388         <span class="keywordflow">if</span> (KeTestSpinLock (&amp;KdpPrintSpinLock)) {
00389             <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a> (HIGH_LEVEL, &amp;OldIrql);
00390             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock</a>(&amp;KdpPrintSpinLock)) {
00391                 <span class="keywordflow">break</span>;          <span class="comment">// got the lock</span>
00392             }
00393             <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00394         }
00395     }
00396 
00397     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a>) {
00398         Length = <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length;
00399         <span class="comment">//</span>
00400         <span class="comment">// truncate ridiculous strings</span>
00401         <span class="comment">//</span>
00402         <span class="keywordflow">if</span> (Length &gt; <a class="code" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a>) {
00403             Length = <a class="code" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a>;
00404         }
00405 
00406         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> + Length &lt;= <a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a>+<a class="code" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a>) {
00407             LengthCopied = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(KdPrintWritePointer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, Length);
00408             <a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> += LengthCopied;
00409             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> &gt;= <a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a>+<a class="code" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a>) {
00410                 <a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a>;
00411                 <a class="code" href="../../d8/d5/kddata_8c.html#a48">KdPrintRolloverCount</a>++;
00412             }
00413         } <span class="keywordflow">else</span> {
00414             ULONG First = (ULONG)(<a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a> + <a class="code" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a> - <a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a>);
00415             LengthCopied = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(KdPrintWritePointer,
00416                                          <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer,
00417                                          First);
00418             <span class="keywordflow">if</span> (LengthCopied == First) {
00419                 LengthCopied += <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(KdPrintCircularBuffer,
00420                                               <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer + First,
00421                                               Length - First);
00422             }
00423             <span class="keywordflow">if</span> (LengthCopied &gt; First) {
00424                 <a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a> + LengthCopied - First;
00425                 <a class="code" href="../../d8/d5/kddata_8c.html#a48">KdPrintRolloverCount</a>++;
00426             } <span class="keywordflow">else</span> {
00427                 <a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> += LengthCopied;
00428                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> &gt;= <a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a>+<a class="code" href="../../d7/d3/kd_8h.html#a6">KDPRINTBUFFERSIZE</a>) {
00429                     <a class="code" href="../../d8/d5/kddata_8c.html#a47">KdPrintWritePointer</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a46">KdPrintCircularBuffer</a>;
00430                     <a class="code" href="../../d8/d5/kddata_8c.html#a48">KdPrintRolloverCount</a>++;
00431                 }
00432             }
00433         }
00434     }
00435 
00436     KiReleaseSpinLock(&amp;KdpPrintSpinLock);
00437     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00438 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="kd.h::KdPollBreakIn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdPollBreakIn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">93</a> of file <a class="el" href="../../d7/d5/kdlock_8c-source.html">kdlock.c</a>.
<p>
References <a class="el" href="../../d8/d2/kd_8h-source.html#l00030">CP_GET_SUCCESS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00260">KdpControlCPending</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00261">KdpControlCPressed</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00056">KdpDebuggerLock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a201">KdPortPollByte()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.
<p>
<pre class="fragment"><div>00099                    :
00100 
00101     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> raises IRQL to high_level, seizes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> port
00102     spinlock, and checks to see <span class="keywordflow">if</span> a breakin packet <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> pending.
00103     If a packet <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> present, <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <span class="keywordflow">else</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00104 
00105     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> packet <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> present <span class="keywordflow">if</span>:
00106 
00107     There <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a valid character which matches BREAK_CHAR.
00108 
00109     N.B.    Interrupts must be OFF around <span class="keyword">this</span> call
00110 
00111 Return Value:
00112 
00113     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> breakin sequence present, caller should execute <span class="keywordtype">int</span>-3.
00114     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> no breakin seen.
00115 
00116 --*/
00117 
00118 {
00119     BOOLEAN BreakIn;
00120     BOOLEAN Enable;
00121     UCHAR   Input;
00122     KIRQL   OldIrql;
00123     ULONG   <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00124 
00125     <span class="comment">//</span>
00126     <span class="comment">// If the debugger is enabled, see if a breakin by the kernel</span>
00127     <span class="comment">// debugger is pending.</span>
00128     <span class="comment">//</span>
00129 
00130     BreakIn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00131     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00132         Enable = <a class="code" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a>();
00133 <span class="preprocessor">#ifndef _X86_</span>
00134 <span class="preprocessor"></span>        <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
00135 <span class="preprocessor">#endif</span>
00136 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a89">KdpControlCPending</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00137             <a class="code" href="../../d8/d5/kddata_8c.html#a90">KdpControlCPressed</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00138             BreakIn = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00139             <a class="code" href="../../d8/d5/kddata_8c.html#a89">KdpControlCPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00140 
00141         } <span class="keywordflow">else</span> {
00142             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock</a>(&amp;KdpDebuggerLock) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00143                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d7/hal_8h.html#a201">KdPortPollByte</a>(&amp;Input);
00144                 <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d7/d3/kd_8h.html#a0">CP_GET_SUCCESS</a>) &amp;&amp;
00145                     (Input == BREAKIN_PACKET_BYTE)) {
00146                     BreakIn = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00147                     <a class="code" href="../../d8/d5/kddata_8c.html#a90">KdpControlCPressed</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00148                 }
00149 
00150                 <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
00151             }
00152         }
00153 
00154 <span class="preprocessor">#ifndef _X86_</span>
00155 <span class="preprocessor"></span>        <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00156 <span class="preprocessor">#endif</span>
00157 <span class="preprocessor"></span>        <a class="code" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts</a>(Enable);
00158     }
00159 
00160     <span class="keywordflow">return</span> BreakIn;
00161 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="kd.h::KdRegisterDebuggerDataBlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdRegisterDebuggerDataBlock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DataHeader</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00287">287</a> of file <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html">4/kdinit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/dumpuser_8c-source.html#l00048">Header</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00279">KdpDataSpinLock</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00280">KdpDebuggerDataListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00094">List</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00167">PDBGKD_DEBUG_DATA_HEADER64</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>.
<p>
<pre class="fragment"><div>00294                    :
00295 
00296     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by a component or driver to <span class="keyword">register</span> a
00297     debugger data block.  The data block <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> accessible to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00298     kernel debugger, thus providing a reliable method of exposing
00299     random data to debugger extensions.
00300 
00301 Arguments:
00302 
00303     Tag - Supplies a unique 4 byte tag which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to identify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00304             data block.
00305 
00306     DataHeader - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger data block header.
00307             The OwnerTag field must contain a unique value, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>
00308             field must contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data block, including <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00309             header.  If <span class="keyword">this</span> block <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already present, or there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00310             already a block with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same value <span class="keywordflow">for</span> OwnerTag, <span class="keyword">this</span> one
00311             will not be inserted.  If <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incorrect, <span class="keyword">this</span> code will
00312             not notice, but <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> usermode side of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger might not
00313             function correctly.
00314 
00315     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data block, including <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> header.
00316 
00317 Return Value:
00318 
00319     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block was added to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
00320 
00321 --*/
00322 {
00323     KIRQL OldIrql;
00324     PLIST_ENTRY <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>;
00325     <a class="code" href="../../d7/d3/kd_8h.html#a15">PDBGKD_DEBUG_DATA_HEADER64</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>;
00326 
00327     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>(&amp;KdpDataSpinLock, &amp;OldIrql);
00328 
00329     <span class="comment">//</span>
00330     <span class="comment">// Look for a record with the same tag or address</span>
00331     <span class="comment">//</span>
00332 
00333     <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a97">KdpDebuggerDataListHead</a>.Flink;
00334 
00335     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a> != &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a97">KdpDebuggerDataListHead</a>) {
00336 
00337         <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> = CONTAINING_RECORD(List, DBGKD_DEBUG_DATA_HEADER64, List);
00338 
00339         <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a> = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>-&gt;Flink;
00340 
00341         <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> == DataHeader) || (<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;OwnerTag == Tag)) {
00342             <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KdpDataSpinLock, OldIrql);
00343             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00344         }
00345     }
00346 
00347     <span class="comment">//</span>
00348     <span class="comment">// It wasn't already there, so add it.</span>
00349     <span class="comment">//</span>
00350 
00351     DataHeader-&gt;OwnerTag = Tag;
00352     DataHeader-&gt;Size = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00353 
00354     InsertTailList(&amp;KdpDebuggerDataListHead, (PLIST_ENTRY)(&amp;DataHeader-&gt;List));
00355 
00356     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KdpDataSpinLock, OldIrql);
00357 
00358     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00359 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="kd.h::KdSetOwedBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdSetOwedBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00316">316</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00174">_BREAKPOINT_ENTRY::Content</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00172">_BREAKPOINT_ENTRY::DirectoryTableBase</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00042">GLOBAL_BREAKPOINT_LIMIT</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00056">KD_BREAKPOINT_IA64_MOVL</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00048">KD_BREAKPOINT_IN_USE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00049">KD_BREAKPOINT_NEEDS_WRITE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00053">KD_BREAKPOINT_STATE_MASK</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00050">KD_BREAKPOINT_SUSPENDED</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l00277">KdEnterDebugger()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l00355">KdExitDebugger()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00076">KDP_BREAKPOINT_TYPE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d3/d5/ia64_2debugsup_8c-source.html#l00174">MmDbgReleaseAddress()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00078">MmDbgWriteCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00322                    :
00323 
00324     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called after returning from memory management calls
00325     that may cause an inpage.  Its purpose <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to store pending
00326     breakpoints in pages just <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> valid.
00327 
00328 Arguments:
00329 
00330     None.
00331 
00332 Return Value:
00333 
00334     None.
00335 
00336 --*/
00337 
00338 {
00339 
00340     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> Content;
00341     BOOLEAN Enable;
00342     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00343     ULONG_PTR Opaque;
00344 
00345     <span class="comment">//</span>
00346     <span class="comment">// If we don't owe any breakpoints then return</span>
00347     <span class="comment">//</span>
00348 
00349     <span class="keywordflow">if</span> ( !<a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> ) {
00350         <span class="keywordflow">return</span>;
00351     }
00352 
00353 
00354     <span class="comment">//</span>
00355     <span class="comment">// Freeze all other processors, disable interrupts, and save debug</span>
00356     <span class="comment">// port state.</span>
00357     <span class="comment">//</span>
00358 
00359     Enable = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a17">KdEnterDebugger</a>(NULL, NULL);
00360     <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00361 
00362     <span class="comment">//</span>
00363     <span class="comment">// Search the breakpoint table for breakpoints that need to be</span>
00364     <span class="comment">// written or replaced.</span>
00365     <span class="comment">//</span>
00366 
00367     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00368         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;
00369                 (<a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a> | <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) ) {
00370 
00371             <span class="comment">//</span>
00372             <span class="comment">// Breakpoint needs to be written</span>
00373             <span class="comment">//</span>
00374             <span class="comment">//DPRINT(("KD: Breakpoint %d at 0x%08x: trying to %s after page in.\n",</span>
00375             <span class="comment">//    Index,</span>
00376             <span class="comment">//    KdpBreakpointTable[Index].Address,</span>
00377             <span class="comment">//    (KdpBreakpointTable[Index].Flags &amp; KD_BREAKPOINT_NEEDS_WRITE) ?</span>
00378             <span class="comment">//        "set" : "clear"));</span>
00379 
00380             <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &gt;= (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) ||
00381                 (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> ==
00382                  <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0])) {
00383 
00384                 <span class="comment">//</span>
00385                 <span class="comment">// Check to see if we have write access to the memory</span>
00386                 <span class="comment">//</span>
00387                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>((PVOID)KdpBreakpointTable[Index].Address,                                       &amp;Opaque) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00388                     <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00389                     <span class="comment">//DPRINT(("KD: address not writeable.\n"));</span>
00390                     <span class="keywordflow">break</span>;
00391                 }
00392 
00393                 <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>(
00394                         (PVOID)KdpBreakpointTable[Index].Address,
00395                         Opaque
00396                         );
00397 
00398                 <span class="comment">//</span>
00399                 <span class="comment">// Breakpoint is global, or its directory base matches</span>
00400                 <span class="comment">//</span>
00401 
00402                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00403                         (PCHAR)&amp;Content,
00404                         (PCHAR)KdpBreakpointTable[Index].Address,
00405                         <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00406                         ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00407 
00408                     <span class="comment">//</span>
00409                     <span class="comment">// Memory is still inaccessible (is this possible after</span>
00410                     <span class="comment">// the call above to MmDbgWriteCheck?)</span>
00411                     <span class="comment">//</span>
00412 
00413                     <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read from 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00414 
00415                     <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00416 
00417                 } <span class="keywordflow">else</span> {
00418                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>) {
00419                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> = Content;
00420 <span class="preprocessor">#if defined(_IA64_)</span>
00421 <span class="preprocessor"></span>                        <span class="keywordflow">switch</span> ((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) {
00422                         <span class="keywordflow">case</span> 0:
00423                             Content = (Content &amp; ~(INST_SLOT0_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 5);
00424                             <span class="keywordflow">break</span>;
00425 
00426                         <span class="keywordflow">case</span> 4:
00427                             Content = (Content &amp; ~(INST_SLOT1_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 14);
00428                             <span class="keywordflow">break</span>;
00429 
00430                         <span class="keywordflow">case</span> 8:
00431                             Content = (Content &amp; ~(INST_SLOT2_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 23);
00432                             <span class="keywordflow">break</span>;
00433 
00434                         <span class="keywordflow">default</span>:
00435                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: illegal instruction address 0x%08x\n"</span>, KdpBreakpointTable[Index].Address));
00436                             <span class="keywordflow">return</span>;
00437                         }
00438                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00439                                 (PCHAR)KdpBreakpointTable[Index].Address,
00440                                 (PCHAR)&amp;Content,
00441                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00442                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00443                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00444                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00445                         }
00446 
00447                         <span class="comment">// read in intruction template if current instruction is NOT slot 0.</span>
00448                         <span class="comment">// check for two-slot MOVL instruction. Reject request if attempt to</span>
00449                         <span class="comment">// set break in slot 2 of MLI template.</span>
00450 
00451                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) != 0) {
00452                             <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
00453                             PVOID BundleAddress;
00454 
00455                             (ULONG_PTR)BundleAddress = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a>  &amp; ~(0xf);
00456                             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00457                                     (PCHAR)&amp;mBuf,
00458                                     (PCHAR)BundleAddress,
00459                                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00460                                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00461                                 <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00462                                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read 0x%08x template failed\n"</span>, KdpBreakpointTable[Index].Address));
00463                             } <span class="keywordflow">else</span> {
00464                                 <span class="keywordflow">if</span> (((mBuf &amp; INST_TEMPL_MASK) &gt;&gt; 1) == 0x2) {
00465                                     <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a>  &amp; 0xf) == 4) {
00466                                         <span class="comment">// if template= type 2 MLI, change to type 0</span>
00467                                         mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1);
00468                                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>;
00469                                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00470                                             (PCHAR)BundleAddress,
00471                                             (PCHAR)&amp;mBuf,
00472                                             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00473                                             ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00474                                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00475                                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x template failed\n"</span>, KdpBreakpointTable[Index].Address));
00476                                         }
00477                                         <span class="keywordflow">else</span> {
00478                                             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~(<a class="code" href="../../d0/d7/kdp_8h.html#a5">KD_BREAKPOINT_STATE_MASK</a>);
00479                                             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00480                                             <span class="comment">//DPRINT(("KD: write to 0x%08x ok\n", KdpBreakpointTable[Index].Address));</span>
00481                                         }
00482                                     } <span class="keywordflow">else</span> {
00483                                         <span class="comment">// set breakpoint at slot 2 of MOVL is illegal</span>
00484                                         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00485                                         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: illegal attempt to set BP at slot 2 of 0x%08x\n"</span>, KdpBreakpointTable[Index].Address));
00486                                     }
00487                                 }
00488                                 <span class="keywordflow">else</span> {
00489                                     <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~(<a class="code" href="../../d0/d7/kdp_8h.html#a5">KD_BREAKPOINT_STATE_MASK</a>);
00490                                     <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00491                                     <span class="comment">//DPRINT(("KD: write to 0x%08x ok\n", KdpBreakpointTable[Index].Address));</span>
00492                                 }
00493                             }
00494                         }
00495 <span class="preprocessor">#else</span>
00496 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00497                                 (PCHAR)KdpBreakpointTable[Index].Address,
00498                                 (PCHAR)&amp;KdpBreakpointInstruction,
00499                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00500                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00501                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00502                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00503                         } <span class="keywordflow">else</span> {
00504                             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00505                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x ok\n"</span>, KdpBreakpointTable[Index].Address));
00506                         }
00507 <span class="preprocessor">#endif</span>
00508 <span class="preprocessor"></span>                    } <span class="keywordflow">else</span> {
00509 <span class="preprocessor">#if defined(_IA64_)</span>
00510 <span class="preprocessor"></span>
00511                         <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
00512                         PVOID BundleAddress;
00513 
00514                         <span class="comment">// restore original instruction content</span>
00515 
00516                         <span class="comment">// Read in memory since adjancent instructions in the same bundle may have</span>
00517                         <span class="comment">// been modified after we save them.</span>
00518                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00519                                 (PCHAR)&amp;mBuf,
00520                                 (PCHAR)KdpBreakpointTable[Index].Address,
00521                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00522                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00523                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read 0x%08x template failed\n"</span>, KdpBreakpointTable[Index].Address));
00524                         }
00525                         <span class="keywordflow">else</span> {
00526                             <span class="keywordflow">switch</span> ((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) {
00527                             <span class="keywordflow">case</span> 0:
00528                                 mBuf = (mBuf &amp; ~(INST_SLOT0_MASK))
00529                                              | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT0_MASK);
00530                                 <span class="keywordflow">break</span>;
00531 
00532                             <span class="keywordflow">case</span> 4:
00533                                 mBuf = (mBuf &amp; ~(INST_SLOT1_MASK))
00534                                              | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT1_MASK);
00535                                 <span class="keywordflow">break</span>;
00536 
00537                             <span class="keywordflow">case</span> 8:
00538                                 mBuf = (mBuf &amp; ~(INST_SLOT2_MASK))
00539                                              | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT2_MASK);
00540                                 <span class="keywordflow">break</span>;
00541 
00542                             <span class="keywordflow">default</span>:
00543                                 <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00544                                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: illegal instruction address 0x%08x\n"</span>, KdpBreakpointTable[Index].Address));
00545                             }
00546 
00547                             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00548                                     (PCHAR)KdpBreakpointTable[Index].Address,
00549                                     (PCHAR)&amp;mBuf,
00550                                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00551                                 <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00552                                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00553                             }
00554                             <span class="keywordflow">else</span> {
00555                                  <span class="comment">// restore template to MLI if displaced instruction was MOVL</span>
00556 
00557                                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>) {
00558                                     (ULONG_PTR)BundleAddress = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; ~(0xf);
00559                                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00560                                             (PCHAR)&amp;mBuf,
00561                                             (PCHAR)BundleAddress,
00562                                             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00563                                             ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00564                                         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00565                                         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read template 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00566                                     }
00567                                     <span class="keywordflow">else</span> {
00568                                         mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1); <span class="comment">// set template to MLI</span>
00569                                         mBuf |= 0x4;
00570 
00571                                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00572                                               (PCHAR)BundleAddress,
00573                                               (PCHAR)&amp;mBuf,
00574                                               <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00575                                               ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00576                                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00577                                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write template to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00578                                         } <span class="keywordflow">else</span> {
00579                                             <span class="comment">//DPRINT(("KD: write to 0x%08x ok\n", KdpBreakpointTable[Index].Address));</span>
00580                                             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) {
00581                                                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= (<a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a> | <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>);
00582                                             } <span class="keywordflow">else</span> {
00583                                                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00584                                             }
00585                                         }
00586                                     }
00587                                 } <span class="keywordflow">else</span> {
00588                                     <span class="comment">//DPRINT(("KD: write to 0x%08x ok\n", KdpBreakpointTable[Index].Address));</span>
00589                                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) {
00590                                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= (<a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a> | <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>);
00591                                     } <span class="keywordflow">else</span> {
00592                                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00593                                     }
00594                                 }
00595                             }
00596                         }
00597 <span class="preprocessor">#else</span>
00598 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00599                                 (PCHAR)KdpBreakpointTable[Index].Address,
00600                                 (PCHAR)&amp;KdpBreakpointTable[Index].Content,
00601                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00602                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00603                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00604                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00605                         } <span class="keywordflow">else</span> {
00606                             <span class="comment">//DPRINT(("KD: write to 0x%08x ok\n", KdpBreakpointTable[Index].Address));</span>
00607                             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) {
00608                                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a> | <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00609                             } <span class="keywordflow">else</span> {
00610                                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00611                             }
00612                         }
00613 <span class="preprocessor">#endif // _IA64_</span>
00614 <span class="preprocessor"></span>
00615                     }
00616                 }
00617 
00618             } <span class="keywordflow">else</span> {
00619 
00620                 <span class="comment">//</span>
00621                 <span class="comment">// Breakpoint is local and its directory base does not match</span>
00622                 <span class="comment">//</span>
00623 
00624                 <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00625             }
00626         }
00627     }
00628 
00629     <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a18">KdExitDebugger</a>(Enable);
00630     <span class="keywordflow">return</span>;
00631 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="kd.h::KdUpdateDataBlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdUpdateDataBlock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00038">38</a> of file <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html">4/kdinit.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00106">KdDebuggerDataBlock</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02809">KeUserCallbackDispatcher</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/psinit_8c-source.html#l00745">PspInitializeSystemDll()</a>.
<p>
<pre class="fragment"><div>00043                    :
00044 
00045     We have to update <span class="keyword">this</span> variable seperately since <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> initialized at a
00046     later time by PS.  PS will call us to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data block.
00047 
00048 --*/
00049 {
00050     <a class="code" href="../../d8/d5/kddata_8c.html#a50">KdDebuggerDataBlock</a>.KeUserCallbackDispatcher = (ULONG_PTR) <a class="code" href="../../d4/d9/ke_8h.html#a149">KeUserCallbackDispatcher</a>;
00051 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="kd.h::KdUpdateTimeSlipEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdUpdateTimeSlipEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00453">453</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">Event()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00289">KdpTimeSlipEvent</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00288">KdpTimeSlipEventLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>.
<p>
<pre class="fragment"><div>00459                    :
00460 
00461     Update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference to an event object which will be signalled when
00462     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger has caused <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system clock to skew.
00463 
00464 Arguments:
00465 
00466     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> - Supplies a pointer to an event object
00467 
00468 Return Value:
00469 
00470     None
00471 
00472 --*/
00473 
00474 {
00475     KIRQL OldIrql;
00476 
00477     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>(&amp;KdpTimeSlipEventLock, &amp;OldIrql);
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">// Dereference the old event and forget about it.</span>
00481     <span class="comment">// Remember the new event if there is one.</span>
00482     <span class="comment">//</span>
00483 
00484     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a99">KdpTimeSlipEvent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00485         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(KdpTimeSlipEvent);
00486     }
00487 
00488     <a class="code" href="../../d8/d5/kddata_8c.html#a99">KdpTimeSlipEvent</a> = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>;
00489 
00490     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KdpTimeSlipEventLock, OldIrql);
00491 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a13" doxytag="kd.h::KdDebuggerEnabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d9/d5/4_2kddata_8c.html#a124">KdDebuggerEnabled</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">134</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00776">IopDriverCorrectnessApplyControl()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00960">IopDriverCorrectnessThrowBugCheck()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01332">KdDeleteAllBreakpoints()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00165">KdpPollBreakInWithPortLock()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00532">NtRaiseHardError()</a>, and <a class="el" href="../../d3/d2/dbgctrl_8c-source.html#l00036">NtSystemDebugControl()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="kd.h::KdDebuggerNotPresent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d9/d5/4_2kddata_8c.html#a123">KdDebuggerNotPresent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00133">133</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00095">KdpReceivePacketLeader()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>, <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00028">KdpTrap()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00941">MiEnsureAvailablePageOrWait()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="kd.h::KdDebugParameters" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/struct__DEBUG__PARAMETERS.html">DEBUG_PARAMETERS</a> <a class="el" href="../../d1/d7/4_2kdp_8h.html#a81">KdDebugParameters</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00142">142</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="kd.h::KdPitchDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d9/d5/4_2kddata_8c.html#a125">KdPitchDebugger</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">66</a> of file <a class="el" href="../../d8/d2/kd_8h-source.html">kd.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01332">KdDeleteAllBreakpoints()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>, <a class="el" href="../../d9/d7/i386_2kdtrap_8c-source.html#l00462">KdpStub()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>, and <a class="el" href="../../d6/d0/mminit_8c-source.html#l02735">MiEnablePagingTheExecutive()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
