<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: private.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>private.c</h1><a href="../../d6/d4/client_2private_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    private.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This file implements private APIs for Hardware Desktop Support.</span>
00012 <span class="comment">    </span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Therese Stowell (thereses) 12-13-1991</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">Notes:</span>
00020 <span class="comment">    </span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#include "<a class="code" href="../../d4/d3/w32_2ntcon_2client_2precomp_8h.html">precomp.h</a>"</span>
00024 <span class="preprocessor">#pragma hdrstop</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#pragma hdrstop</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00028 <span class="preprocessor"></span>
<a name="l00029"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a0">00029</a> <span class="keyword">typedef</span> HANDLE (*<a class="code" href="../../d6/d4/client_2private_8c.html#a0">PCONVPALFUNC</a>)(HANDLE);
<a name="l00030"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a1">00030</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a0">PCONVPALFUNC</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a1">pfnGdiConvertPalette</a>;
00031 
00032 <span class="preprocessor">#endif </span>
00033 <span class="preprocessor"></span>
00034 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00035 <span class="preprocessor"></span>
00036 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00037 WINAPI
<a name="l00038"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a2">00038</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a2">SetConsoleCursor</a>(
00039     IN HANDLE hConsoleOutput,
00040     IN HCURSOR hCursor
00041     )
00042 
00043 <span class="comment">/*++</span>
00044 <span class="comment"></span>
00045 <span class="comment">Description:</span>
00046 <span class="comment"></span>
00047 <span class="comment">    Sets the mouse pointer for the specified screen buffer.</span>
00048 <span class="comment"></span>
00049 <span class="comment">Parameters:</span>
00050 <span class="comment"></span>
00051 <span class="comment">    hConsoleOutput - Supplies a console output handle.</span>
00052 <span class="comment"></span>
00053 <span class="comment">    hCursor - win32 cursor handle, should be NULL to set the default</span>
00054 <span class="comment">        cursor.</span>
00055 <span class="comment"></span>
00056 <span class="comment">Return value:</span>
00057 <span class="comment"></span>
00058 <span class="comment">    TRUE - The operation was successful.</span>
00059 <span class="comment"></span>
00060 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00061 <span class="comment">        using GetLastError.</span>
00062 <span class="comment"></span>
00063 <span class="comment">--*/</span>
00064 
00065 {
00066 
00067     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00068     <a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html">PCONSOLE_SETCURSOR_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleCursor;
00069     
00070     a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00071     a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00072     a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o2">CursorHandle</a> = hCursor;
00073     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00074                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00075                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00076                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a206">ConsolepSetCursor</a>
00077                                             ),
00078                          <span class="keyword">sizeof</span>( *a )
00079                        );
00080     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00081         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00082         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00083     }
00084     <span class="keywordflow">else</span> {
00085         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00086     }
00087 
00088 }
00089 
00090 <span class="keywordtype">int</span>
00091 WINAPI
<a name="l00092"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a3">00092</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a3">ShowConsoleCursor</a>(
00093     IN HANDLE hConsoleOutput,
00094     IN BOOL bShow
00095     )
00096 
00097 <span class="comment">/*++</span>
00098 <span class="comment"></span>
00099 <span class="comment">Description:</span>
00100 <span class="comment"></span>
00101 <span class="comment">    Sets the mouse pointer visibility counter.  If the counter is less than</span>
00102 <span class="comment">    zero, the mouse pointer is not shown.</span>
00103 <span class="comment"></span>
00104 <span class="comment">Parameters:</span>
00105 <span class="comment"></span>
00106 <span class="comment">    hOutput - Supplies a console output handle.</span>
00107 <span class="comment"></span>
00108 <span class="comment">    bShow - if TRUE, the display count is to be increased. if FALSE,</span>
00109 <span class="comment">        decreased.</span>
00110 <span class="comment"></span>
00111 <span class="comment">Return value:</span>
00112 <span class="comment"></span>
00113 <span class="comment">    The return value specifies the new display count.</span>
00114 <span class="comment"></span>
00115 <span class="comment">--*/</span>
00116 
00117 {
00118 
00119     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00120     <a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html">PCONSOLE_SHOWCURSOR_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.ShowConsoleCursor;
00121 
00122     a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00123     a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00124     a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o2">bShow</a> = bShow;
00125     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00126                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00127                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00128                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a207">ConsolepShowCursor</a>
00129                                             ),
00130                          <span class="keyword">sizeof</span>( *a )
00131                        );
00132     <span class="keywordflow">return</span> a-&gt;DisplayCount;
00133 
00134 }
00135 
00136 HMENU
00137 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00138"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a4">00138</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a4">ConsoleMenuControl</a>(
00139     IN HANDLE hConsoleOutput,
00140     IN UINT dwCommandIdLow,
00141     IN UINT dwCommandIdHigh
00142     )
00143 
00144 <span class="comment">/*++</span>
00145 <span class="comment"></span>
00146 <span class="comment">Description:</span>
00147 <span class="comment"></span>
00148 <span class="comment">    Sets the command id range for the current screen buffer and returns the</span>
00149 <span class="comment">    menu handle.</span>
00150 <span class="comment"></span>
00151 <span class="comment">Parameters:</span>
00152 <span class="comment"></span>
00153 <span class="comment">    hConsoleOutput - Supplies a console output handle.</span>
00154 <span class="comment"></span>
00155 <span class="comment">    dwCommandIdLow - Specifies the lowest command id to store in the input buffer.</span>
00156 <span class="comment"></span>
00157 <span class="comment">    dwCommandIdHigh - Specifies the highest command id to store in the input</span>
00158 <span class="comment">        buffer.</span>
00159 <span class="comment"></span>
00160 <span class="comment">Return value:</span>
00161 <span class="comment"></span>
00162 <span class="comment">    TRUE - The operation was successful.</span>
00163 <span class="comment"></span>
00164 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00165 <span class="comment">        using GetLastError.</span>
00166 <span class="comment"></span>
00167 <span class="comment">--*/</span>
00168 
00169 {
00170 
00171     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00172     <a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html">PCONSOLE_MENUCONTROL_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.ConsoleMenuControl;
00173 
00174     a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00175     a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00176     a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o2">CommandIdLow</a> =dwCommandIdLow;
00177     a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o3">CommandIdHigh</a> = dwCommandIdHigh;
00178     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00179                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00180                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00181                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a208">ConsolepMenuControl</a>
00182                                             ),
00183                          <span class="keyword">sizeof</span>( *a )
00184                        );
00185     <span class="keywordflow">return</span> a-&gt;hMenu;
00186 
00187 }
00188 
00189 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00190 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a> 
<a name="l00191"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a5">00191</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a5">SetConsolePaletteInternal</a>(
00192     IN HANDLE hConsoleOutput,
00193     IN HPALETTE hPalette,
00194     IN UINT dwUsage 
00195     )
00196 {
00197 
00198     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00199     <a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html">PCONSOLE_SETPALETTE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsolePalette;
00200     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00201 
00202     a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00203     a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00204     a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o2">hPalette</a> = hPalette;
00205     a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o3">dwUsage</a> = dwUsage;
00206     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00207                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00208                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00209                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a209">ConsolepSetPalette</a>
00210                                             ),
00211                          <span class="keyword">sizeof</span>( *a )
00212                        );
00213     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00214         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00215         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00216     }
00217     <span class="keywordflow">else</span> {
00218         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00219     }
00220 
00221 }
00222 
00223 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00224 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00225"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a6">00225</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a6">SetConsoleDisplayMode</a>(
00226     IN HANDLE hConsoleOutput,
00227     IN DWORD dwFlags,
00228     OUT PCOORD lpNewScreenBufferDimensions
00229     )
00230 
00231 <span class="comment">/*++</span>
00232 <span class="comment"></span>
00233 <span class="comment">Description:</span>
00234 <span class="comment"></span>
00235 <span class="comment">    This routine sets the console display mode for an output buffer.</span>
00236 <span class="comment">    This API is only supported on x86 machines.  Frame buffer consoles</span>
00237 <span class="comment">    are always windowed.</span>
00238 <span class="comment"></span>
00239 <span class="comment">Parameters:</span>
00240 <span class="comment"></span>
00241 <span class="comment">    hConsoleOutput - Supplies a console output handle.</span>
00242 <span class="comment"></span>
00243 <span class="comment">    dwFlags - Specifies the display mode. Options are:</span>
00244 <span class="comment"></span>
00245 <span class="comment">        CONSOLE_FULLSCREEN_MODE - data is displayed fullscreen</span>
00246 <span class="comment"></span>
00247 <span class="comment">        CONSOLE_WINDOWED_MODE - data is displayed in a window</span>
00248 <span class="comment"></span>
00249 <span class="comment">    lpNewScreenBufferDimensions - On output, contains the new dimensions of</span>
00250 <span class="comment">        the screen buffer.  The dimensions are in rows and columns for</span>
00251 <span class="comment">        textmode screen buffers.</span>
00252 <span class="comment">Return value:</span>
00253 <span class="comment"></span>
00254 <span class="comment">    TRUE - The operation was successful.</span>
00255 <span class="comment"></span>
00256 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00257 <span class="comment">        using GetLastError.</span>
00258 <span class="comment"></span>
00259 <span class="comment">--*/</span>
00260 
00261 {
00262 
00263     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00264     <a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html">PCONSOLE_SETDISPLAYMODE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleDisplayMode;
00265     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00266 
00267 <span class="preprocessor">#if !defined(_X86_)</span>
00268 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00269 <span class="preprocessor">#else</span>
00270 <span class="preprocessor"></span>    
00271     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;(a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o4">hEvent</a>),
00272                            EVENT_ALL_ACCESS, 
00273                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00274                            SynchronizationEvent,
00275                            (BOOLEAN)<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00276                            );
00277     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00278        <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00279        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00280     }
00281 
00282     a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00283     a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00284     a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o2">dwFlags</a> = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00285 
00286     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00287                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00288                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00289                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a210">ConsolepSetDisplayMode</a>
00290                                             ),
00291                          <span class="keyword">sizeof</span>( *a )
00292                        );
00293     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00294         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00295         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(a-&gt;hEvent);
00296         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00297 
00298     }
00299     <span class="keywordflow">else</span> {
00300              <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(a-&gt;hEvent, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00301         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(a-&gt;hEvent);
00302 
00303          <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0) {
00304             <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00305             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00306          }
00307         <span class="keywordflow">try</span> {
00308             *lpNewScreenBufferDimensions = a-&gt;ScreenBufferDimensions;
00309         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00310             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00311             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00312         }
00313         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00314     }
00315 
00316 <span class="preprocessor">#endif</span>
00317 <span class="preprocessor"></span>
00318 }
00319 
00320 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00321 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00322"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a7">00322</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a7">RegisterConsoleVDM</a>(
00323     IN DWORD dwRegisterFlags,
00324     IN HANDLE hStartHardwareEvent,
00325     IN HANDLE hEndHardwareEvent,
00326     IN LPWSTR lpStateSectionName,
00327     IN DWORD dwStateSectionNameLength,
00328     OUT LPDWORD lpStateLength,
00329     OUT PVOID *lpState,
00330     IN LPWSTR lpVDMBufferSectionName,
00331     IN DWORD dwVDMBufferSectionNameLength,
00332     IN COORD VDMBufferSize OPTIONAL,
00333     OUT PVOID *lpVDMBuffer
00334     )
00335 
00336 <span class="comment">/*++</span>
00337 <span class="comment"></span>
00338 <span class="comment">Description:</span>
00339 <span class="comment"></span>
00340 <span class="comment">    This routine registers the VDM with the console.</span>
00341 <span class="comment"></span>
00342 <span class="comment">Parameters:</span>
00343 <span class="comment"></span>
00344 <span class="comment">    hStartHardwareEvent - the event the VDM waits on to be</span>
00345 <span class="comment">        notified of gaining/losing control of the hardware.</span>
00346 <span class="comment"></span>
00347 <span class="comment">    hEndHardwareEvent - the event the VDM sets when it is done</span>
00348 <span class="comment">        saving/restoring the hardware.</span>
00349 <span class="comment"></span>
00350 <span class="comment">Return value:</span>
00351 <span class="comment"></span>
00352 <span class="comment">    TRUE - The operation was successful.</span>
00353 <span class="comment"></span>
00354 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00355 <span class="comment">        using GetLastError.</span>
00356 <span class="comment"></span>
00357 <span class="comment">--*/</span>
00358 
00359 {
00360     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00361     <a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html">PCONSOLE_REGISTERVDM_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.RegisterConsoleVDM;
00362     PCSR_CAPTURE_HEADER CaptureBuffer;
00363 
00364     a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00365     a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o1">RegisterFlags</a> = dwRegisterFlags;
00366     <span class="keywordflow">if</span> (dwRegisterFlags) {
00367         a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o2">StartEvent</a> = hStartHardwareEvent;
00368         a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o3">EndEvent</a> = hEndHardwareEvent;
00369         a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o9">VDMBufferSectionNameLength</a> = dwVDMBufferSectionNameLength;
00370         a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o10">VDMBufferSize</a> = VDMBufferSize;
00371         a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o5">StateSectionNameLength</a> = dwStateSectionNameLength;
00372         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 2,
00373                                                   dwStateSectionNameLength+dwVDMBufferSectionNameLength
00374                                                 );
00375         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00376             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00377             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00378         }
00379 
00380         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00381                                  lpStateSectionName,
00382                                  dwStateSectionNameLength,
00383                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o4">StateSectionName</a>
00384                                    );
00385 
00386         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00387                                  lpVDMBufferSectionName,
00388                                  dwVDMBufferSectionNameLength,
00389                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o8">VDMBufferSectionName</a>
00390                                    );
00391     } <span class="keywordflow">else</span> {
00392         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00393     }
00394     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00395                          CaptureBuffer,
00396                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00397                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a211">ConsolepRegisterVDM</a>
00398                                             ),
00399                          <span class="keyword">sizeof</span>( *a )
00400                        );
00401     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00402         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00403     }
00404     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00405         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00406         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00407     }
00408     <span class="keywordflow">else</span> {
00409         <span class="keywordflow">if</span> (dwRegisterFlags) {
00410             <span class="keywordflow">try</span> {
00411                 *lpStateLength = a-&gt;StateLength;
00412                 *lpState = a-&gt;StateBuffer;
00413                 *lpVDMBuffer = a-&gt;VDMBuffer;
00414             } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00415                 <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00416                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00417             }
00418         }
00419         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00420     }
00421 }
00422 
00423 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00424 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00425"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a8">00425</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a8">GetConsoleHardwareState</a>(
00426     IN HANDLE hConsoleOutput,
00427     OUT PCOORD lpResolution,
00428     OUT PCOORD lpFontSize
00429     )
00430 
00431 <span class="comment">/*++</span>
00432 <span class="comment"></span>
00433 <span class="comment">Description:</span>
00434 <span class="comment"></span>
00435 <span class="comment">    This routine returns the video resolution and font.</span>
00436 <span class="comment"></span>
00437 <span class="comment">Parameters:</span>
00438 <span class="comment"></span>
00439 <span class="comment">    hConsoleOutput - Supplies a console output handle.</span>
00440 <span class="comment"></span>
00441 <span class="comment">    lpResolution - Pointer to structure to store screen</span>
00442 <span class="comment">        resolution in.  Resolution is returned in pixels.</span>
00443 <span class="comment"></span>
00444 <span class="comment">    lpFontSize - Pointer to structure to store font size in.</span>
00445 <span class="comment">        Font size is returned in pixels.</span>
00446 <span class="comment"></span>
00447 <span class="comment">Return value:</span>
00448 <span class="comment"></span>
00449 <span class="comment">    TRUE - The operation was successful.</span>
00450 <span class="comment"></span>
00451 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00452 <span class="comment">        using GetLastError.</span>
00453 <span class="comment"></span>
00454 <span class="comment">--*/</span>
00455 
00456 {
00457 
00458     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00459     <a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html">PCONSOLE_GETHARDWARESTATE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleHardwareState;
00460 
00461     a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00462     a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00463     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00464                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00465                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00466                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a212">ConsolepGetHardwareState</a>
00467                                             ),
00468                          <span class="keyword">sizeof</span>( *a )
00469                        );
00470     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00471         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00472         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00473     }
00474     <span class="keywordflow">else</span> {
00475         <span class="keywordflow">try</span> {
00476             *lpResolution = a-&gt;Resolution;
00477             *lpFontSize = a-&gt;FontSize;
00478         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00479             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00480             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00481         }
00482         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00483     }
00484 
00485 }
00486 
00487 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00488 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00489"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a9">00489</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a9">SetConsoleHardwareState</a>(
00490     IN HANDLE hConsoleOutput,
00491     IN COORD dwResolution,
00492     IN COORD dwFontSize
00493     )
00494 
00495 <span class="comment">/*++</span>
00496 <span class="comment"></span>
00497 <span class="comment">Description:</span>
00498 <span class="comment"></span>
00499 <span class="comment">    This routine set the video resolution and font.</span>
00500 <span class="comment"></span>
00501 <span class="comment">Parameters:</span>
00502 <span class="comment"></span>
00503 <span class="comment">    hConsoleOutput - Supplies a console output handle.</span>
00504 <span class="comment"></span>
00505 <span class="comment">    dwResolution - Contains screen resolution to set.</span>
00506 <span class="comment">        Resolution is returned in pixels.</span>
00507 <span class="comment"></span>
00508 <span class="comment">    dwFontSize - Contains font size to set.</span>
00509 <span class="comment">        Font size is returned in pixels.</span>
00510 <span class="comment"></span>
00511 <span class="comment">Return value:</span>
00512 <span class="comment"></span>
00513 <span class="comment">    TRUE - The operation was successful.</span>
00514 <span class="comment"></span>
00515 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00516 <span class="comment">        using GetLastError.</span>
00517 <span class="comment"></span>
00518 <span class="comment">--*/</span>
00519 
00520 {
00521 
00522     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00523     <a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html">PCONSOLE_SETHARDWARESTATE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleHardwareState;
00524 
00525     a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00526     a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00527     a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o2">Resolution</a> = dwResolution;
00528     a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o3">FontSize</a> = dwFontSize;
00529     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00530                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00531                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00532                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a213">ConsolepSetHardwareState</a>
00533                                             ),
00534                          <span class="keyword">sizeof</span>( *a )
00535                        );
00536     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00537         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00538         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00539     }
00540     <span class="keywordflow">else</span> {
00541         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00542     }
00543 
00544 }
00545 
00546 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00547 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00548"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a10">00548</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a10">GetConsoleDisplayMode</a>(
00549     OUT LPDWORD lpModeFlags
00550     )
00551 
00552 <span class="comment">/*++</span>
00553 <span class="comment"></span>
00554 <span class="comment">Description:</span>
00555 <span class="comment"></span>
00556 <span class="comment">    This routine returns the display mode of the console.</span>
00557 <span class="comment"></span>
00558 <span class="comment">Parameters:</span>
00559 <span class="comment"></span>
00560 <span class="comment">    lpModeFlags - pointer to store display mode in.</span>
00561 <span class="comment"></span>
00562 <span class="comment">Return value:</span>
00563 <span class="comment"></span>
00564 <span class="comment">    TRUE - The operation was successful.</span>
00565 <span class="comment"></span>
00566 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00567 <span class="comment">        using GetLastError.</span>
00568 <span class="comment"></span>
00569 <span class="comment">--*/</span>
00570 
00571 {
00572 
00573     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00574     <a class="code" href="../../d7/d1/struct__CONSOLE__GETDISPLAYMODE__MSG.html">PCONSOLE_GETDISPLAYMODE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleDisplayMode;
00575 
00576     a-&gt;<a class="code" href="../../d7/d1/struct__CONSOLE__GETDISPLAYMODE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00577     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00578                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00579                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00580                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a214">ConsolepGetDisplayMode</a>
00581                                             ),
00582                          <span class="keyword">sizeof</span>( *a )
00583                        );
00584     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00585         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00586         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00587     }
00588     <span class="keywordflow">else</span> {
00589         <span class="keywordflow">try</span> {
00590             *lpModeFlags = a-&gt;ModeFlags;
00591         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00592             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00593             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00594         }
00595         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00596     }
00597 
00598 }
00599 
00600 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00601 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00602"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a11">00602</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a11">SetConsoleKeyShortcuts</a>(
00603     IN BOOL bSet,
00604     IN BYTE bReserveKeys,
00605     IN LPAPPKEY lpAppKeys,
00606     IN DWORD dwNumAppKeys
00607     )
00608 
00609 <span class="comment">/*++</span>
00610 <span class="comment"></span>
00611 <span class="comment">Description:</span>
00612 <span class="comment"></span>
00613 <span class="comment">    Only one set of key shortcuts is valid per console.  Calling</span>
00614 <span class="comment">    SetConsoleKeyShortcuts(set) overwrites any previous settings.</span>
00615 <span class="comment">    SetConsoleKeyShortcuts(!set) removes any shortcuts.</span>
00616 <span class="comment"></span>
00617 <span class="comment">Parameters:</span>
00618 <span class="comment"></span>
00619 <span class="comment">    bSet - if TRUE, set shortcuts.  else remove shortcuts.</span>
00620 <span class="comment"></span>
00621 <span class="comment">    bReserveKeys - byte containing reserve key info.</span>
00622 <span class="comment"></span>
00623 <span class="comment">    lpAppKeys - pointer to application-defined shortcut keys.  can be null.</span>
00624 <span class="comment"></span>
00625 <span class="comment">    dwNumAppKeys - number of app keys contained in lpAppKeys.</span>
00626 <span class="comment"></span>
00627 <span class="comment">Return value:</span>
00628 <span class="comment"></span>
00629 <span class="comment">    TRUE - The operation was successful.</span>
00630 <span class="comment"></span>
00631 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00632 <span class="comment">        using GetLastError.</span>
00633 <span class="comment"></span>
00634 <span class="comment">--*/</span>
00635 
00636 {
00637 
00638     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00639     <a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html">PCONSOLE_SETKEYSHORTCUTS_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleKeyShortcuts;
00640     PCSR_CAPTURE_HEADER CaptureBuffer;
00641 
00642     a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00643     a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o1">Set</a> = bSet;
00644     a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o2">ReserveKeys</a> = bReserveKeys;
00645     <span class="keywordflow">if</span> (lpAppKeys == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00646         a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o3">NumAppKeys</a> = 0;
00647         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00648     } <span class="keywordflow">else</span> {
00649         a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o3">NumAppKeys</a> = dwNumAppKeys;
00650         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00651                                                   dwNumAppKeys * <span class="keyword">sizeof</span>(APPKEY)
00652                                                 );
00653         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00654             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00655             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00656         }
00657         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00658                                  lpAppKeys,
00659                                  dwNumAppKeys * <span class="keyword">sizeof</span>(APPKEY),
00660                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o4">AppKeys</a>
00661                                );
00662     }
00663 
00664     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00665                          CaptureBuffer,
00666                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00667                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a228">ConsolepSetKeyShortcuts</a>
00668                                             ),
00669                          <span class="keyword">sizeof</span>( *a )
00670                        );
00671     <span class="keywordflow">if</span> (CaptureBuffer)
00672         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00673     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00674         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00675         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00676     }
00677     <span class="keywordflow">else</span> {
00678         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00679     }
00680 
00681 }
00682 
00683 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00684 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00685"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a12">00685</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a12">SetConsoleMenuClose</a>(
00686     IN BOOL bEnable
00687     )
00688 
00689 <span class="comment">/*++</span>
00690 <span class="comment"></span>
00691 <span class="comment">Description:</span>
00692 <span class="comment"></span>
00693 <span class="comment">    This routine returns the display mode of the console.</span>
00694 <span class="comment"></span>
00695 <span class="comment">Parameters:</span>
00696 <span class="comment"></span>
00697 <span class="comment">    bEnable - if TRUE, close is enabled in the system menu.</span>
00698 <span class="comment"></span>
00699 <span class="comment">Return value:</span>
00700 <span class="comment"></span>
00701 <span class="comment">    TRUE - The operation was successful.</span>
00702 <span class="comment"></span>
00703 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00704 <span class="comment">        using GetLastError.</span>
00705 <span class="comment"></span>
00706 <span class="comment">--*/</span>
00707 
00708 {
00709 
00710     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00711     <a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html">PCONSOLE_SETMENUCLOSE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleMenuClose;
00712 
00713     a-&gt;<a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00714     a-&gt;<a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html#o1">Enable</a> = bEnable;
00715     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00716                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00717                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00718                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a229">ConsolepSetMenuClose</a>
00719                                             ),
00720                          <span class="keyword">sizeof</span>( *a )
00721                        );
00722     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00723         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00724         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00725     }
00726     <span class="keywordflow">else</span> {
00727         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00728     }
00729 
00730 }
00731 
00732 <span class="preprocessor">#endif </span>
00733 <span class="preprocessor"></span>
00734 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00735 <span class="preprocessor"></span>
00736 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00737"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a13">00737</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a13">SetConsolePalette</a>(
00738     IN HANDLE hConsoleOutput,
00739     IN HPALETTE hPalette,
00740     IN UINT dwUsage
00741     )
00742 
00743 <span class="comment">/*++</span>
00744 <span class="comment"></span>
00745 <span class="comment">Description:</span>
00746 <span class="comment"></span>
00747 <span class="comment">    Sets the palette for the console screen buffer.</span>
00748 <span class="comment"></span>
00749 <span class="comment">Parameters:</span>
00750 <span class="comment"></span>
00751 <span class="comment">    hOutput - Supplies a console output handle.</span>
00752 <span class="comment"></span>
00753 <span class="comment">    hPalette - Supplies a handle to the palette to set.</span>
00754 <span class="comment"></span>
00755 <span class="comment">    dwUsage - Specifies use of the system palette.</span>
00756 <span class="comment"></span>
00757 <span class="comment">        SYSPAL_NOSTATIC - System palette contains no static colors</span>
00758 <span class="comment">                          except black and white.</span>
00759 <span class="comment"></span>
00760 <span class="comment">        SYSPAL_STATIC -   System palette contains static colors</span>
00761 <span class="comment">                          which will not change when an application</span>
00762 <span class="comment">                          realizes its logical palette.</span>
00763 <span class="comment"></span>
00764 <span class="comment">Return value:</span>
00765 <span class="comment"></span>
00766 <span class="comment">    TRUE - The operation was successful.</span>
00767 <span class="comment"></span>
00768 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00769 <span class="comment">        using GetLastError.</span>
00770 <span class="comment"></span>
00771 <span class="comment">--*/</span>
00772 
00773 {
00774 
00775     HANDLE hmodGdi;
00776     UNICODE_STRING ModuleNameString;
00777     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00778 
00779     <span class="keywordflow">if</span> ( !<a class="code" href="../../d6/d4/client_2private_8c.html#a1">pfnGdiConvertPalette</a> ) {
00780         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ModuleNameString, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"gdi32"</span> );
00781         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d2/ldrapi_8c.html#a2">LdrLoadDll</a>( UNICODE_NULL, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;ModuleNameString, &amp;hmodGdi ); 
00782         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) ) {
00783             <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00784             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00785             }
00786         <a class="code" href="../../d6/d4/client_2private_8c.html#a1">pfnGdiConvertPalette</a> = (<a class="code" href="../../d6/d4/client_2private_8c.html#a0">PCONVPALFUNC</a>)GetProcAddress(hmodGdi, <span class="stringliteral">"GdiConvertPalette"</span>);
00787         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/client_2private_8c.html#a1">pfnGdiConvertPalette</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00788             <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(STATUS_PROCEDURE_NOT_FOUND);
00789             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00790             }
00791 
00792         }
00793 
00794     hPalette = (*pfnGdiConvertPalette)(hPalette);
00795 
00796     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/client_2private_8c.html#a5">SetConsolePaletteInternal</a>(hConsoleOutput,
00797                                      hPalette,
00798                                      dwUsage);
00799 }
00800 
00801 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00802 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00803"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a14">00803</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a14">WriteConsoleInputVDMA</a>(
00804     HANDLE hConsoleInput,
00805     PINPUT_RECORD lpBuffer,
00806     DWORD nLength,
00807     LPDWORD lpNumberOfEventsWritten
00808     )
00809 {
00810     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a8">WriteConsoleInputInternal</a>(hConsoleInput,lpBuffer,nLength,lpNumberOfEventsWritten,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00811 }
00812 
00813 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00814 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00815"></a><a class="code" href="../../d6/d4/client_2private_8c.html#a15">00815</a> <a class="code" href="../../d6/d4/client_2private_8c.html#a15">WriteConsoleInputVDMW</a>(
00816     HANDLE hConsoleInput,
00817     PINPUT_RECORD lpBuffer,
00818     DWORD nLength,
00819     LPDWORD lpNumberOfEventsWritten
00820     )
00821 {
00822     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a8">WriteConsoleInputInternal</a>(hConsoleInput,lpBuffer,nLength,lpNumberOfEventsWritten,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00823 }
00824 
00825 <span class="preprocessor">#endif </span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
