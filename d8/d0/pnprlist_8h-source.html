<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: pnprlist.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>pnprlist.h</h1><a href="../../d7/d1/pnprlist_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1998 Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    pnprlist.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This file declares the routines and data structures used to manipulate</span>
00012 <span class="comment">    relations list.  Relation lists are used by Plug and Play during the</span>
00013 <span class="comment">    processing of device removal and ejection.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    Robert Nelson (robertn) Apr, 1998.</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="comment">//</span>
00024 <span class="comment">// A RELATION_LIST_ENTRY is an element of a relation list.</span>
00025 <span class="comment">//</span>
00026 <span class="comment">// It contains all the PDEVICE_OBJECTS which exist at the same level in the</span>
00027 <span class="comment">// DEVICE_NODE tree.</span>
00028 <span class="comment">//</span>
00029 <span class="comment">// Individual PDEVICE_OBJECT entries are tagged by setting their lowest bit.</span>
00030 <span class="comment">//</span>
00031 <span class="comment">// MaxCount indicates the size of the Devices array.  Count indicates the number</span>
00032 <span class="comment">// of elements which are currently being used.  When a relation list is</span>
00033 <span class="comment">// compressed Count will equal MaxCount.</span>
00034 <span class="comment">//</span>
<a name="l00035"></a><a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html">00035</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html">_RELATION_LIST_ENTRY</a> {
<a name="l00036"></a><a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html#o0">00036</a>     ULONG                   <a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html#o0">Count</a>;          <span class="comment">// Number of current entries</span>
<a name="l00037"></a><a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html#o1">00037</a>     ULONG                   <a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html#o1">MaxCount</a>;       <span class="comment">// Size of Entries list</span>
<a name="l00038"></a><a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html#o2">00038</a>     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>          <a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html#o2">Devices</a>[1];     <span class="comment">// Variable length list of device objects</span>
00039 }   <a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html">RELATION_LIST_ENTRY</a>, *<a class="code" href="../../d7/d3/struct__RELATION__LIST__ENTRY.html">PRELATION_LIST_ENTRY</a>;
00040 
00041 <span class="comment">//</span>
00042 <span class="comment">// A RELATION_LIST contains a number of RELATION_LIST_ENTRY structures.</span>
00043 <span class="comment">//</span>
00044 <span class="comment">// Each entry in Entries describes all the devices of a given level in the</span>
00045 <span class="comment">// DEVICE_NODE tree.  In order to conserve memory, space is only allocated for</span>
00046 <span class="comment">// the entries between the lowest and highest levels inclusive.  The member</span>
00047 <span class="comment">// FirstLevel indicates which level is at index 0 of Entries.  MaxLevel</span>
00048 <span class="comment">// indicates the last level represented in Entries.  The number of entries is</span>
00049 <span class="comment">// determined by the formula MaxLevel - FirstLevel + 1.  The Entries array can</span>
00050 <span class="comment">// be sparse.  Each element of Entries will either be a PRELATION_LIST_ENTRY or</span>
00051 <span class="comment">// NULL.</span>
00052 <span class="comment">//</span>
00053 <span class="comment">// The total number of PDEVICE_OBJECTs in all PRELATION_LIST_ENTRYs is kept in</span>
00054 <span class="comment">// Count.  Individual PDEVICE_OBJECTS may be tagged.  The tag is maintained in</span>
00055 <span class="comment">// Bit 0 of the PDEVICE_OBJECT.  The total number of PDEVICE_OBJECTs tagged is</span>
00056 <span class="comment">// kept in TagCount.  This is used to rapidly determine whether or not all</span>
00057 <span class="comment">// objects have been tagged.</span>
00058 <span class="comment">//</span>
<a name="l00059"></a><a class="code" href="../../d6/d3/struct__RELATION__LIST.html">00059</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d3/struct__RELATION__LIST.html">_RELATION_LIST</a> {
<a name="l00060"></a><a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o0">00060</a>     ULONG                   <a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o0">Count</a>;          <span class="comment">// Count of Devices in all Entries</span>
<a name="l00061"></a><a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o1">00061</a>     ULONG                   <a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o1">TagCount</a>;       <span class="comment">// Count of Tagged Devices</span>
<a name="l00062"></a><a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o2">00062</a>     ULONG                   <a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o2">FirstLevel</a>;     <span class="comment">// Level Number of Entries[0]</span>
<a name="l00063"></a><a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o3">00063</a>     ULONG                   <a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o3">MaxLevel</a>;       <span class="comment">// - FirstLevel + 1 = Number of Entries</span>
<a name="l00064"></a><a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o4">00064</a>     <a class="code" href="../../d7/d1/pnprlist_8h.html#a1">PRELATION_LIST_ENTRY</a>    <a class="code" href="../../d6/d3/struct__RELATION__LIST.html#o4">Entries</a>[1];     <span class="comment">// Variable length list of entries</span>
00065 }   <a class="code" href="../../d6/d3/struct__RELATION__LIST.html">RELATION_LIST</a>, *<a class="code" href="../../d6/d3/struct__RELATION__LIST.html">PRELATION_LIST</a>;
00066 
00067 <span class="comment">//</span>
00068 <span class="comment">// A PENDING_RELATIONS_LIST_ENTRY is used to track relation lists for operations</span>
00069 <span class="comment">// which may pend.  This includes removal when open handles exist and device</span>
00070 <span class="comment">// ejection.</span>
00071 <span class="comment">//</span>
00072 <span class="comment">// The Link field is used to link the PENDING_RELATIONS_LIST_ENTRYs together.</span>
00073 <span class="comment">//</span>
00074 <span class="comment">// The DeviceObject field is the DEVICE_OBJECT to which the operation was</span>
00075 <span class="comment">// originally targetted.  It will also exist as a member of the relations list.</span>
00076 <span class="comment">//</span>
00077 <span class="comment">// The RelationsList is a list of BusRelations, RemovalRelations, (and</span>
00078 <span class="comment">// EjectionRelations in the case of eject) which are related to DeviceObject and</span>
00079 <span class="comment">// its relations.</span>
00080 <span class="comment">//</span>
00081 <span class="comment">// The EjectIrp is pointer to the Eject IRP which has been sent to the PDO.  If</span>
00082 <span class="comment">// this is a pending surprise removal then EjectIrp is not used.</span>
00083 <span class="comment">//</span>
<a name="l00084"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html">00084</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html">_PENDING_RELATIONS_LIST_ENTRY</a> {
<a name="l00085"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o0">00085</a>     LIST_ENTRY              <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o0">Link</a>;
<a name="l00086"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o1">00086</a>     <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a>         <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o1">WorkItem</a>;
<a name="l00087"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o2">00087</a>     PPNP_DEVICE_EVENT_ENTRY <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o2">DeviceEvent</a>;
<a name="l00088"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o3">00088</a>     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>          <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o3">DeviceObject</a>;
<a name="l00089"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o4">00089</a>     <a class="code" href="../../d7/d1/pnprlist_8h.html#a3">PRELATION_LIST</a>          <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o4">RelationsList</a>;
<a name="l00090"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o5">00090</a>     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a>                    <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o5">EjectIrp</a>;
<a name="l00091"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o6">00091</a>     ULONG                   <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o6">Problem</a>;
<a name="l00092"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o7">00092</a>     BOOLEAN                 <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o7">ProfileChangingEject</a>;
<a name="l00093"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o8">00093</a>     BOOLEAN                 <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o8">DisplaySafeRemovalDialog</a>;
<a name="l00094"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o9">00094</a>     SYSTEM_POWER_STATE      <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o9">LightestSleepState</a>;
<a name="l00095"></a><a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o10">00095</a>     PDOCK_INTERFACE         <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html#o10">DockInterface</a>;
00096 }   <a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html">PENDING_RELATIONS_LIST_ENTRY</a>, *<a class="code" href="../../d8/d4/struct__PENDING__RELATIONS__LIST__ENTRY.html">PPENDING_RELATIONS_LIST_ENTRY</a>;
00097 
00098 <span class="comment">//</span>
00099 <span class="comment">// Functions exported to other kernel modules.</span>
00100 <span class="comment">//</span>
00101 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00102 <a class="code" href="../../d7/d1/pnprlist_8h.html#a7">IopAddRelationToList</a>(
00103     IN PRELATION_LIST List,
00104     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00105     IN BOOLEAN DirectDescendant,
00106     IN BOOLEAN Tagged
00107     );
00108 
00109 <a class="code" href="../../d7/d1/pnprlist_8h.html#a3">PRELATION_LIST</a>
00110 <a class="code" href="../../d6/d1/pnprlist_8c.html#a4">IopAllocateRelationList</a>(
00111     VOID
00112     );
00113 
00114 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00115 <a class="code" href="../../d7/d1/pnprlist_8h.html#a8">IopCompressRelationList</a>(
00116     IN OUT PRELATION_LIST *List
00117     );
00118 
00119 BOOLEAN
00120 <a class="code" href="../../d7/d1/pnprlist_8h.html#a9">IopEnumerateRelations</a>(
00121     IN PRELATION_LIST List,
00122     IN OUT PULONG Marker,
00123     OUT <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> *PhysicalDevice,
00124     OUT BOOLEAN *DirectDescendant, OPTIONAL
00125     OUT BOOLEAN *Tagged, OPTIONAL
00126     BOOLEAN Reverse
00127     );
00128 
00129 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00130 <a class="code" href="../../d7/d1/pnprlist_8h.html#a10">IopFreeRelationList</a>(
00131     IN PRELATION_LIST List
00132     );
00133 
00134 ULONG
00135 <a class="code" href="../../d7/d1/pnprlist_8h.html#a11">IopGetRelationsCount</a>(
00136     IN PRELATION_LIST List
00137     );
00138 
00139 ULONG
00140 <a class="code" href="../../d7/d1/pnprlist_8h.html#a12">IopGetRelationsTaggedCount</a>(
00141     IN PRELATION_LIST List
00142     );
00143 
00144 BOOLEAN
00145 <a class="code" href="../../d7/d1/pnprlist_8h.html#a13">IopIsRelationInList</a>(
00146     IN PRELATION_LIST List,
00147     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00148     );
00149 
00150 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00151 <a class="code" href="../../d7/d1/pnprlist_8h.html#a14">IopMergeRelationLists</a>(
00152     IN OUT PRELATION_LIST TargetList,
00153     IN PRELATION_LIST SourceList,
00154     IN BOOLEAN Tagged
00155     );
00156 
00157 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00158 <a class="code" href="../../d7/d1/pnprlist_8h.html#a15">IopRemoveIndirectRelationsFromList</a>(
00159     IN PRELATION_LIST List
00160     );
00161 
00162 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00163 <a class="code" href="../../d7/d1/pnprlist_8h.html#a16">IopRemoveRelationFromList</a>(
00164     IN PRELATION_LIST List,
00165     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00166     );
00167 
00168 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00169 <a class="code" href="../../d7/d1/pnprlist_8h.html#a17">IopSetAllRelationsTags</a>(
00170     IN PRELATION_LIST List,
00171     IN BOOLEAN Tagged
00172     );
00173 
00174 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00175 <a class="code" href="../../d7/d1/pnprlist_8h.html#a18">IopSetRelationsTag</a>(
00176     IN PRELATION_LIST List,
00177     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00178     IN BOOLEAN Tagged
00179     );
00180 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:23 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
