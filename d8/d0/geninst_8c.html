<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: geninst.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>geninst.c File Reference</h1><code>#include "<a class="el" href="../../d2/d1/cmp_8h-source.html">cmp.h</a>"</code><br>
<code>#include "stdlib.h"</code><br>
<code>#include "<a class="el" href="../../d7/d2/parseini_8h-source.html">parseini.h</a>"</code><br>
<code>#include "<a class="el" href="../../d0/d0/geninst_8h-source.html">geninst.h</a>"</code><br>

<p>
<a href="../../d9/d9/geninst_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a0">FLG_ADDREG_BINVALUETYPE</a>&nbsp;&nbsp;&nbsp;( 0x00000001 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a1">FLG_ADDREG_NOCLOBBER</a>&nbsp;&nbsp;&nbsp;( 0x00000002 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a2">FLG_ADDREG_DELVAL</a>&nbsp;&nbsp;&nbsp;( 0x00000004 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a3">FLG_ADDREG_APPEND</a>&nbsp;&nbsp;&nbsp;( 0x00000008 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a4">FLG_ADDREG_KEYONLY</a>&nbsp;&nbsp;&nbsp;( 0x00000010 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a5">FLG_ADDREG_OVERWRITEONLY</a>&nbsp;&nbsp;&nbsp;( 0x00000020 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a6">FLG_ADDREG_TYPE_MASK</a>&nbsp;&nbsp;&nbsp;( 0xFFFF0000 | FLG_ADDREG_BINVALUETYPE )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a7">FLG_ADDREG_TYPE_SZ</a>&nbsp;&nbsp;&nbsp;( 0x00000000                           )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a8">FLG_ADDREG_TYPE_MULTI_SZ</a>&nbsp;&nbsp;&nbsp;( 0x00010000                           )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a9">FLG_ADDREG_TYPE_EXPAND_SZ</a>&nbsp;&nbsp;&nbsp;( 0x00020000                           )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a10">FLG_ADDREG_TYPE_BINARY</a>&nbsp;&nbsp;&nbsp;( 0x00000000 | FLG_ADDREG_BINVALUETYPE )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a11">FLG_ADDREG_TYPE_DWORD</a>&nbsp;&nbsp;&nbsp;( 0x00010000 | FLG_ADDREG_BINVALUETYPE )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a12">FLG_ADDREG_TYPE_NONE</a>&nbsp;&nbsp;&nbsp;( 0x00020000 | FLG_ADDREG_BINVALUETYPE )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a13">FLG_BITREG_CLEAR</a>&nbsp;&nbsp;&nbsp;( 0x00000000 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a14">FLG_BITREG_SET</a>&nbsp;&nbsp;&nbsp;( 0x00000001 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a15">FLG_BITREG_TYPE_BINARY</a>&nbsp;&nbsp;&nbsp;( 0x00000000 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a16">FLG_BITREG_TYPE_DWORD</a>&nbsp;&nbsp;&nbsp;( 0x00000002 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a17">NUM_OF_INF_RULES</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOLEAN(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a18">PFN_INFRULE</a> )(IN PVOID InfHandle, IN PCHAR Section, IN PVOID <a class="el" href="../../d8/d0/geninst_8c.html#a22">RefData</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOLEAN(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a19">PFN_REGLINE</a> )(IN PVOID InfHandle, IN PCHAR Section, IN ULONG LineIndex)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a24">CmpProcessReg</a> (IN PVOID InfHandle, IN PCHAR Section, IN PVOID <a class="el" href="../../d8/d0/geninst_8c.html#a22">RefData</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a25">CmpProcessAddRegLine</a> (IN PVOID InfHandle, IN PCHAR Section, IN ULONG LineIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a26">CmpProcessDelRegLine</a> (IN PVOID InfHandle, IN PCHAR Section, IN ULONG LineIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a27">CmpProcessBitRegLine</a> (IN PVOID InfHandle, IN PCHAR Section, IN ULONG LineIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a28">CmpGetAddRegInfData</a> (IN PVOID InfHandle, IN PCHAR Section, IN ULONG LineIndex, IN ULONG ValueIndex, IN ULONG ValueType, OUT PVOID *Data, OUT PULONG DataSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a29">CmpOpenRegKey</a> (IN OUT PHANDLE <a class="el" href="../../d3/d0/user32_8def.html#a52">Key</a>, IN OUT PULONG Disposition, IN PCHAR Root, IN PCHAR SubKey, IN ULONG DesiredAccess, IN BOOLEAN Create)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a30">CmpAppendStringToMultiSz</a> (IN HANDLE <a class="el" href="../../d3/d0/user32_8def.html#a52">Key</a>, IN PCHAR <a class="el" href="../../d8/d2/rtrenval_8c.html#a3">ValueName</a>, IN OUT PVOID *Data, IN OUT PULONG DataSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a31">CmpGenInstall</a> (IN PVOID InfHandle, IN PCHAR Section)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;PCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d8/d0/geninst_8c.html#a20">Name</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d8/d0/geninst_8c.html#a18">PFN_INFRULE</a>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d8/d0/geninst_8c.html#a21">Action</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;PVOID&nbsp;&nbsp;&nbsp;<a class="el" href="../../d8/d0/geninst_8c.html#a22">RefData</a></td></tr>

<tr><td class="memItemLeft" nowrap valign=top>}&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d0/geninst_8c.html#a23">gInfRuleTable</a> [NUM_OF_INF_RULES]</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a3" doxytag="geninst.c::FLG_ADDREG_APPEND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_APPEND&nbsp;&nbsp;&nbsp;( 0x00000008 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00125">125</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="geninst.c::FLG_ADDREG_BINVALUETYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_BINVALUETYPE&nbsp;&nbsp;&nbsp;( 0x00000001 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00122">122</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="geninst.c::FLG_ADDREG_DELVAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_DELVAL&nbsp;&nbsp;&nbsp;( 0x00000004 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00124">124</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="geninst.c::FLG_ADDREG_KEYONLY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_KEYONLY&nbsp;&nbsp;&nbsp;( 0x00000010 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00127">127</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="geninst.c::FLG_ADDREG_NOCLOBBER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_NOCLOBBER&nbsp;&nbsp;&nbsp;( 0x00000002 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00123">123</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="geninst.c::FLG_ADDREG_OVERWRITEONLY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_OVERWRITEONLY&nbsp;&nbsp;&nbsp;( 0x00000020 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00128">128</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="geninst.c::FLG_ADDREG_TYPE_BINARY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_BINARY&nbsp;&nbsp;&nbsp;( 0x00000000 | FLG_ADDREG_BINVALUETYPE )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00134">134</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="geninst.c::FLG_ADDREG_TYPE_DWORD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_DWORD&nbsp;&nbsp;&nbsp;( 0x00010000 | FLG_ADDREG_BINVALUETYPE )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00135">135</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="geninst.c::FLG_ADDREG_TYPE_EXPAND_SZ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_EXPAND_SZ&nbsp;&nbsp;&nbsp;( 0x00020000                           )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00133">133</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="geninst.c::FLG_ADDREG_TYPE_MASK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_MASK&nbsp;&nbsp;&nbsp;( 0xFFFF0000 | FLG_ADDREG_BINVALUETYPE )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00130">130</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="geninst.c::FLG_ADDREG_TYPE_MULTI_SZ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_MULTI_SZ&nbsp;&nbsp;&nbsp;( 0x00010000                           )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00132">132</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="geninst.c::FLG_ADDREG_TYPE_NONE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_NONE&nbsp;&nbsp;&nbsp;( 0x00020000 | FLG_ADDREG_BINVALUETYPE )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00136">136</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="geninst.c::FLG_ADDREG_TYPE_SZ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_ADDREG_TYPE_SZ&nbsp;&nbsp;&nbsp;( 0x00000000                           )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00131">131</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="geninst.c::FLG_BITREG_CLEAR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_BITREG_CLEAR&nbsp;&nbsp;&nbsp;( 0x00000000 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00138">138</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="geninst.c::FLG_BITREG_SET" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_BITREG_SET&nbsp;&nbsp;&nbsp;( 0x00000001 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00139">139</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00776">CmpProcessBitRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="geninst.c::FLG_BITREG_TYPE_BINARY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_BITREG_TYPE_BINARY&nbsp;&nbsp;&nbsp;( 0x00000000 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00140">140</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="geninst.c::FLG_BITREG_TYPE_DWORD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLG_BITREG_TYPE_DWORD&nbsp;&nbsp;&nbsp;( 0x00000002 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00141">141</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00776">CmpProcessBitRegLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="geninst.c::NUM_OF_INF_RULES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NUM_OF_INF_RULES&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00147">147</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00176">CmpGenInstall()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a18" doxytag="geninst.c::PFN_INFRULE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOLEAN(*  <a class="el" href="../../d8/d0/geninst_8c.html#a18">PFN_INFRULE</a>)(IN PVOID InfHandle, IN PCHAR Section, IN PVOID <a class="el" href="../../d8/d0/geninst_8c.html#a22">RefData</a>)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00037">37</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="geninst.c::PFN_REGLINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOLEAN(*  <a class="el" href="../../d8/d0/geninst_8c.html#a19">PFN_REGLINE</a>)(IN PVOID InfHandle, IN PCHAR Section, IN ULONG LineIndex)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00045">45</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00258">CmpProcessReg()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a30" doxytag="geninst.c::CmpAppendStringToMultiSz" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpAppendStringToMultiSz           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Key</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DataSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l01392">1392</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.
<p>
<pre class="fragment"><div>01401                        :
01402 
01403         This routine opens\creates a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry key.
01404 
01405     Input Parameters:
01406 
01407         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a> - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key.
01408 
01409         <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value to be appended to.
01410 
01411         Data - <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> multi-sz to be appended.
01412 
01413         DataSize - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data.
01414 
01415     Return Value:
01416 
01417         Standard NT status value.
01418 
01419 --*/
01420 
01421 {
01422     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    status;
01423     ULONG                       size;
01424     ANSI_STRING                 ansiString;
01425     UNICODE_STRING              unicodeString;
01426     PKEY_VALUE_FULL_INFORMATION valueInfo;
01427     PVOID                       buffer;
01428     PVOID                       str;
01429 
01430     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DataSize &amp;&amp; *DataSize);
01431     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(*Data);
01432 
01433     <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, ValueName);
01434     status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
01435     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01436     {
01437         size = 0;
01438         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(   Key,
01439                                     &amp;unicodeString,
01440                                     KeyValueFullInformation,
01441                                     NULL,
01442                                     0,
01443                                     &amp;size);
01444         <span class="keywordflow">if</span> (size)
01445         {
01446             buffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, size, CM_GENINST_TAG);
01447             <span class="keywordflow">if</span> (buffer)
01448             {
01449                 status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(   Key,
01450                                             &amp;unicodeString,
01451                                             KeyValueFullInformation,
01452                                             buffer,
01453                                             size,
01454                                             &amp;size);
01455                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01456                 {
01457                     valueInfo = (PKEY_VALUE_FULL_INFORMATION)buffer;
01458                     str = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(    PagedPool,
01459                                                     valueInfo-&gt;DataLength +
01460                                                         *DataSize - <span class="keyword">sizeof</span>(UNICODE_NULL),
01461                                                     CM_GENINST_TAG);
01462                     <span class="keywordflow">if</span> (str)
01463                     {
01464                         memcpy( str,
01465                                 (PCHAR)buffer + valueInfo-&gt;DataOffset,
01466                                 valueInfo-&gt;DataLength);
01467                         memcpy( (PCHAR)str + valueInfo-&gt;DataLength - <span class="keyword">sizeof</span>(UNICODE_NULL),
01468                                 *Data,
01469                                 *DataSize);
01470                         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(*Data);
01471                         *Data = str;
01472                         *DataSize += valueInfo-&gt;DataLength - <span class="keyword">sizeof</span>(UNICODE_NULL);
01473                     }
01474                     <span class="keywordflow">else</span>
01475                     {
01476                         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpAppendStringToMultiSz: Failed to allocate memory!\n"</span>);
01477                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(str);
01478                         status = STATUS_NO_MEMORY;
01479                     }
01480                 }
01481                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
01482             }
01483             <span class="keywordflow">else</span>
01484             {
01485                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpAppendStringToMultiSz: Failed to allocate memory!\n"</span>);
01486                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(buffer);
01487                 status = STATUS_NO_MEMORY;
01488             }
01489         }
01490         <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
01491     }
01492 
01493     <span class="keywordflow">return</span> (status);
01494 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="geninst.c::CmpGenInstall" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpGenInstall           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00176">176</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d6/d2/parseini_8c-source.html#l01890">CmpGetKeyName()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d6/d3/parseini_8h.html#a3">CmpSearchInfSection()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d0/geninst_8c.html#a23">gInfRuleTable</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00147">NUM_OF_INF_RULES</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00315">CmpMatchInfList()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l01145">CmpMatchInstallRule()</a>.
<p>
<pre class="fragment"><div>00183                        :
00184 
00185         This routine does a GenInstall of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
00186 
00187     Input Parameters:
00188 
00189         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00190 
00191         Section - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section to be read.
00192 
00193     Return Value:
00194 
00195         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire section was processed successfully.
00196 
00197 --*/
00198 
00199 {
00200     ULONG   ruleNumber;
00201     ULONG   i;
00202     PCHAR   ruleName;
00203     PCHAR   regSection;
00204     BOOLEAN result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00205 
00206     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/parseini_8h.html#a3">CmpSearchInfSection</a>(InfHandle, Section))
00207     {
00208         <span class="comment">//</span>
00209         <span class="comment">// Go through all the rules in the section and try to process</span>
00210         <span class="comment">// each of them.</span>
00211         <span class="comment">//</span>
00212 
00213         <span class="keywordflow">for</span> (   ruleNumber = 0;
00214                 ruleName = <a class="code" href="../../d6/d3/parseini_8h.html#a2">CmpGetKeyName</a>(InfHandle, Section, ruleNumber);
00215                 ruleNumber++)
00216         {
00217 
00218             <span class="comment">//</span>
00219             <span class="comment">// Search for the proceesing function in our table.</span>
00220             <span class="comment">//</span>
00221 
00222             <span class="keywordflow">for</span> (   i = 0;
00223                     i &lt; <a class="code" href="../../d8/d0/geninst_8c.html#a17">NUM_OF_INF_RULES</a> &amp;&amp;
00224                         _stricmp(ruleName, gInfRuleTable[i].Name);
00225                     i++);
00226 
00227             <span class="keywordflow">if</span> (    i &gt;= <a class="code" href="../../d8/d0/geninst_8c.html#a17">NUM_OF_INF_RULES</a> ||
00228                     (regSection = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
00229                                                             Section,
00230                                                             ruleNumber,
00231                                                             0)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00232                     !<a class="code" href="../../d6/d3/parseini_8h.html#a3">CmpSearchInfSection</a>(InfHandle, Section))
00233             {
00234                 result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00235                 <span class="keywordflow">break</span>;
00236             }
00237 
00238             <span class="keywordflow">if</span> (!(*<a class="code" href="../../d8/d0/geninst_8c.html#a23">gInfRuleTable</a>[i].Action)(InfHandle, regSection, <a class="code" href="../../d8/d0/geninst_8c.html#a23">gInfRuleTable</a>[i].RefData))
00239             {
00240                 result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00241             }
00242         }
00243 
00244         <span class="comment">//</span>
00245         <span class="comment">// All inf rules processed.</span>
00246         <span class="comment">//</span>
00247 
00248         <span class="keywordflow">if</span> (ruleNumber)
00249         {
00250             result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00251         }
00252     }
00253 
00254     <span class="keywordflow">return</span> (result);
00255 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="geninst.c::CmpGetAddRegInfData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpGetAddRegInfData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LineIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DataSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00987">987</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l02177">CmpGetBinaryField()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l02120">CmpGetIntField()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l02060">CmpGetSectionLineIndexValueCount()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>.
<p>
<pre class="fragment"><div>00999                        :
01000 
01001         This routine reads AddReg data from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
01002 
01003     Input Parameters:
01004 
01005         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
01006 
01007         Section - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section to be read.
01008 
01009         LineIndex - <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> line to be read.
01010 
01011         ValueIndex - <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value to be read.
01012 
01013         ValueType - Data <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to be read.
01014 
01015         Data - Receives pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in which data has been read.
01016 
01017         DataSize - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data buffer.
01018 
01019     Return Value:
01020 
01021         Standard NT status value.
01022 
01023 --*/
01024 
01025 {
01026     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>        status = STATUS_UNSUCCESSFUL;
01027     PCHAR           str;
01028     ULONG           count;
01029     ULONG           i;
01030     ANSI_STRING     ansiString;
01031     UNICODE_STRING  unicodeString;
01032 
01033     <span class="comment">//</span>
01034     <span class="comment">// Validate the required fields.</span>
01035     <span class="comment">//</span>
01036 
01037     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Data);
01038     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DataSize);
01039 
01040     <span class="keywordflow">switch</span> (ValueType)
01041     {
01042         <span class="keywordflow">case</span> REG_DWORD:
01043 
01044             *DataSize = <span class="keyword">sizeof</span>(ULONG);
01045             *Data = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, *DataSize, CM_GENINST_TAG);
01046             <span class="keywordflow">if</span> (*Data)
01047             {
01048                 <span class="comment">//</span>
01049                 <span class="comment">// DWORD data is specified as four bytes in W9x.</span>
01050                 <span class="comment">//</span>
01051 
01052                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/parseini_8h.html#a6">CmpGetSectionLineIndexValueCount</a>(   InfHandle,
01053                                                         Section,
01054                                                         LineIndex) == 8)
01055                 {
01056                     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/parseini_8h.html#a8">CmpGetBinaryField</a>( InfHandle,
01057                                             Section,
01058                                             LineIndex,
01059                                             ValueIndex,
01060                                             *Data,
01061                                             *DataSize,
01062                                             NULL))
01063                     {
01064                         *((PULONG)*Data) = 0;
01065                     }
01066 
01067                     status = STATUS_SUCCESS;
01068                 }
01069                 <span class="keywordflow">else</span>
01070                 {
01071                     <span class="comment">//</span>
01072                     <span class="comment">// Get the DWORD value.</span>
01073                     <span class="comment">//</span>
01074 
01075                     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/parseini_8h.html#a7">CmpGetIntField</a>(    InfHandle,
01076                                             Section,
01077                                             LineIndex,
01078                                             4,
01079                                             *Data))
01080                     {
01081                         *((PULONG)*Data) = 0;
01082                     }
01083 
01084                     status = STATUS_SUCCESS;
01085                 }
01086             }
01087             <span class="keywordflow">else</span>
01088             {
01089                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(*Data);
01090                 status = STATUS_NO_MEMORY;
01091             }
01092 
01093             <span class="keywordflow">break</span>;
01094 
01095         <span class="keywordflow">case</span> REG_SZ:
01096         <span class="keywordflow">case</span> REG_EXPAND_SZ:
01097 
01098             <span class="comment">//</span>
01099             <span class="comment">// Null terminated string. Gets converted to unicode before being</span>
01100             <span class="comment">// added into the registry.</span>
01101             <span class="comment">//</span>
01102 
01103             str = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
01104                                             Section,
01105                                             LineIndex,
01106                                             ValueIndex);
01107             <span class="keywordflow">if</span> (str)
01108             {
01109                 <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, str);
01110                 *DataSize = (ansiString.Length &lt;&lt; 1) + <span class="keyword">sizeof</span>(UNICODE_NULL);
01111                 unicodeString.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)*DataSize;
01112                 unicodeString.Buffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, *DataSize, CM_GENINST_TAG);
01113                 *Data = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01114                 <span class="keywordflow">if</span> (unicodeString.Buffer)
01115                 {
01116                     status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, FALSE);
01117                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01118                     {
01119                         *Data = unicodeString.Buffer;
01120                         status = STATUS_SUCCESS;
01121                     }
01122                 }
01123                 <span class="keywordflow">else</span>
01124                 {
01125                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(unicodeString.Buffer);
01126                     status = STATUS_NO_MEMORY;
01127                 }
01128             }
01129             <span class="keywordflow">else</span>
01130             {
01131                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(str);
01132                 status = STATUS_NO_MEMORY;
01133             }
01134 
01135             <span class="keywordflow">break</span>;
01136 
01137         <span class="keywordflow">case</span> REG_MULTI_SZ:
01138 
01139             *DataSize = 0;
01140             *Data = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01141 
01142             <span class="comment">//</span>
01143             <span class="comment">// Loop to determine the total memory that needs to be allocated.</span>
01144             <span class="comment">//</span>
01145 
01146             count = <a class="code" href="../../d6/d3/parseini_8h.html#a6">CmpGetSectionLineIndexValueCount</a>(   InfHandle,
01147                                                         Section,
01148                                                         LineIndex);
01149             <span class="keywordflow">if</span> (count &gt; ValueIndex)
01150             {
01151                 count -= ValueIndex;
01152                 <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
01153                 {
01154                     str = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
01155                                                     Section,
01156                                                     LineIndex,
01157                                                     ValueIndex + i);
01158                     <span class="keywordflow">if</span> (str == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01159                     {
01160                         <span class="keywordflow">break</span>;
01161                     }
01162 
01163                     *DataSize += ((<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(str) * <span class="keyword">sizeof</span>(WCHAR)) + <span class="keyword">sizeof</span>(UNICODE_NULL));
01164                 }
01165 
01166                 <span class="keywordflow">if</span> (i == count)
01167                 {
01168                     <span class="comment">//</span>
01169                     <span class="comment">// Account for the terminating NULL.</span>
01170                     <span class="comment">//</span>
01171 
01172                     *DataSize += <span class="keyword">sizeof</span>(UNICODE_NULL);
01173                     *Data = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, *DataSize, CM_GENINST_TAG);
01174                     <span class="keywordflow">if</span> (*Data)
01175                     {
01176                         <span class="keywordflow">for</span> (   i = 0, unicodeString.Buffer = *Data;
01177                                 i &lt; count;
01178                                 i++, (PCHAR)unicodeString.Buffer += unicodeString.MaximumLength)
01179                         {
01180                             str = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
01181                                                             Section,
01182                                                             LineIndex,
01183                                                             ValueIndex + i);
01184                             <span class="keywordflow">if</span> (str == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01185                             {
01186                                 <span class="keywordflow">break</span>;
01187                             }
01188                             <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, str);
01189                             unicodeString.MaximumLength = (ansiString.Length * <span class="keyword">sizeof</span>(WCHAR)) + <span class="keyword">sizeof</span>(UNICODE_NULL);
01190                             status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, FALSE);
01191                             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01192                             {
01193                                 <span class="keywordflow">break</span>;
01194                             }
01195                         }
01196 
01197                         <span class="comment">//</span>
01198                         <span class="comment">// Terminate the multi-sz string.</span>
01199                         <span class="comment">//</span>
01200 
01201                         <span class="keywordflow">if</span> (i == count)
01202                         {
01203                             unicodeString.Buffer[0] = UNICODE_NULL;
01204                             status = STATUS_SUCCESS;
01205                         }
01206                     }
01207                     <span class="keywordflow">else</span>
01208                     {
01209                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(*Data);
01210                         status = STATUS_NO_MEMORY;
01211                     }
01212                 }
01213             }
01214 
01215             <span class="keywordflow">break</span>;
01216 
01217         <span class="keywordflow">case</span> REG_BINARY:
01218         <span class="keywordflow">default</span>:
01219 
01220             <span class="comment">//</span>
01221             <span class="comment">// Free form binary data.</span>
01222             <span class="comment">//</span>
01223 
01224             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/parseini_8h.html#a8">CmpGetBinaryField</a>(  InfHandle,
01225                                     Section,
01226                                     LineIndex,
01227                                     ValueIndex,
01228                                     NULL,
01229                                     0,
01230                                     DataSize) &amp;&amp; *DataSize)
01231             {
01232                 *Data = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, *DataSize, CM_GENINST_TAG);
01233                 <span class="keywordflow">if</span> (*Data)
01234                 {
01235                     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/parseini_8h.html#a8">CmpGetBinaryField</a>( InfHandle,
01236                                             Section,
01237                                             LineIndex,
01238                                             4,
01239                                             *Data,
01240                                             *DataSize,
01241                                             NULL))
01242                     {
01243                         status = STATUS_SUCCESS;
01244                     }
01245                 }
01246                 <span class="keywordflow">else</span>
01247                 {
01248                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(*Data);
01249                     status = STATUS_NO_MEMORY;
01250                 }
01251             }
01252             <span class="keywordflow">else</span>
01253             {
01254                 status = STATUS_UNSUCCESSFUL;
01255             }
01256 
01257             <span class="keywordflow">break</span>;
01258     }
01259 
01260     <span class="keywordflow">return</span> (status);
01261 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="geninst.c::CmpOpenRegKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpOpenRegKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Key</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Disposition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>SubKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Create</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l01264">1264</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d5/consubs_8c-source.html#l00023">Create()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">CmpProcessAddRegLine()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00776">CmpProcessBitRegLine()</a>, and <a class="el" href="../../d9/d9/geninst_8c-source.html#l00658">CmpProcessDelRegLine()</a>.
<p>
<pre class="fragment"><div>01275                        :
01276 
01277         This routine opens\creates a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry key.
01278 
01279     Input Parameters:
01280 
01281         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a> - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key.
01282 
01283         Disposition - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> disposition of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key.
01284 
01285         Root - Abbreviated name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root key.
01286 
01287         SubKey - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subkey under <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root.
01288 
01289         DesiredAccess - Desired access flags <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key.
01290 
01291         <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key needs to be created instead of opened.
01292 
01293     Return Value:
01294 
01295         Standard NT status value.
01296 
01297 --*/
01298 
01299 {
01300     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status = STATUS_OBJECT_NAME_INVALID;
01301     ULONG               size;
01302     PCHAR               str;
01303     ANSI_STRING         ansiString;
01304     UNICODE_STRING      unicodeString;
01305     OBJECT_ATTRIBUTES   objectAttributes;
01306 
01307     str = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01308     size = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(SubKey) + 1;
01309 
01310     <span class="comment">//</span>
01311     <span class="comment">// Check if we understand the specified root name.</span>
01312     <span class="comment">//</span>
01313 
01314     <span class="keywordflow">if</span> (_stricmp(Root, <span class="stringliteral">"HKLM"</span>) == 0)
01315     {
01316         size += <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(<span class="stringliteral">"\\Registry\\Machine\\"</span>);
01317         str = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, size, CM_GENINST_TAG);
01318         <span class="keywordflow">if</span> (str)
01319         {
01320             strcpy(str, <span class="stringliteral">"\\Registry\\Machine\\"</span>);
01321             strcat(str, SubKey);
01322         }
01323         <span class="keywordflow">else</span>
01324         {
01325             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(str);
01326             status = STATUS_NO_MEMORY;
01327         }
01328     }
01329     <span class="keywordflow">else</span>
01330     {
01331         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(_stricmp(Root, <span class="stringliteral">"HKLM"</span>) == 0);
01332     }
01333 
01334     <span class="comment">//</span>
01335     <span class="comment">// Proceed if we have a valid key name.</span>
01336     <span class="comment">//</span>
01337 
01338     <span class="keywordflow">if</span> (str)
01339     {
01340         <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, str);
01341         status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
01342         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01343         {
01344             InitializeObjectAttributes( &amp;objectAttributes,
01345                                         &amp;unicodeString,
01346                                         OBJ_CASE_INSENSITIVE,
01347                                         NULL,
01348                                         NULL);
01349             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a>)
01350             {
01351                 <span class="comment">//</span>
01352                 <span class="comment">// Create a new key or open an existing one.</span>
01353                 <span class="comment">//</span>
01354 
01355                 status = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(   Key,
01356                                         DesiredAccess,
01357                                         &amp;objectAttributes,
01358                                         0,
01359                                         NULL,
01360                                         REG_OPTION_NON_VOLATILE,
01361                                         Disposition ? Disposition : &amp;size);
01362             }
01363             <span class="keywordflow">else</span>
01364             {
01365                 <span class="comment">//</span>
01366                 <span class="comment">// Open existing key.</span>
01367                 <span class="comment">//</span>
01368 
01369                 <span class="keywordflow">if</span> (Disposition)
01370                 {
01371                     *Disposition = REG_OPENED_EXISTING_KEY;
01372                 }
01373                 status = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>( Key,
01374                                     DesiredAccess,
01375                                     &amp;objectAttributes);
01376             }
01377 
01378             <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
01379         }
01380         <span class="keywordflow">else</span>
01381         {
01382             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status));
01383         }
01384 
01385         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(str);
01386     }
01387 
01388     <span class="keywordflow">return</span> (status);
01389 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="geninst.c::CmpProcessAddRegLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpProcessAddRegLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LineIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00311">311</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d9/d9/geninst_8c-source.html#l01392">CmpAppendStringToMultiSz()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00987">CmpGetAddRegInfData()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l02120">CmpGetIntField()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l01264">CmpOpenRegKey()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00125">FLG_ADDREG_APPEND</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00122">FLG_ADDREG_BINVALUETYPE</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00124">FLG_ADDREG_DELVAL</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00127">FLG_ADDREG_KEYONLY</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00123">FLG_ADDREG_NOCLOBBER</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00128">FLG_ADDREG_OVERWRITEONLY</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00134">FLG_ADDREG_TYPE_BINARY</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00135">FLG_ADDREG_TYPE_DWORD</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00133">FLG_ADDREG_TYPE_EXPAND_SZ</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00130">FLG_ADDREG_TYPE_MASK</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00132">FLG_ADDREG_TYPE_MULTI_SZ</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00136">FLG_ADDREG_TYPE_NONE</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00131">FLG_ADDREG_TYPE_SZ</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00504">NtDeleteValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00319                        :
00320 
00321         This routine processes a AddReg line in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
00322 
00323     Input Parameters:
00324 
00325         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00326 
00327         Section - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section to be read.
00328 
00329         LineIndex - <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> line to be read.
00330 
00331     Return Value:
00332 
00333         Standard NT status value.
00334 
00335 --*/
00336 
00337 {
00338     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status = STATUS_UNSUCCESSFUL;
00339     PCHAR               rootKeyName;
00340     PCHAR               subKeyName;
00341     PCHAR               valueName;
00342     ULONG               flags;
00343     ULONG               valueType;
00344     PCHAR               buffer;
00345     HANDLE              key;
00346     ULONG               disposition;
00347     BOOLEAN             dontSet;
00348     PVOID               data = 0;
00349     ULONG               dataSize = 0;
00350     ANSI_STRING         ansiString;
00351     UNICODE_STRING      unicodeString;
00352     OBJECT_ATTRIBUTES   objectAttributes;
00353 
00354     <span class="comment">//</span>
00355     <span class="comment">// Get the root-key name.</span>
00356     <span class="comment">//</span>
00357 
00358     rootKeyName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
00359                                             Section,
00360                                             LineIndex,
00361                                             0);
00362     <span class="keywordflow">if</span> (rootKeyName)
00363     {
00364         <span class="comment">//</span>
00365         <span class="comment">// Get the optional sub-key name.</span>
00366         <span class="comment">//</span>
00367 
00368         subKeyName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(    InfHandle,
00369                                                 Section,
00370                                                 LineIndex,
00371                                                 1);
00372 
00373         <span class="comment">//</span>
00374         <span class="comment">// Value name is optional. Can be NULL or "".</span>
00375         <span class="comment">//</span>
00376 
00377         valueName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>( InfHandle,
00378                                             Section,
00379                                             LineIndex,
00380                                             2);
00381         <span class="comment">//</span>
00382         <span class="comment">// If we don't have a value name, the type is REG_SZ to force</span>
00383         <span class="comment">// the right behavior in RegSetValueEx. Otherwise get the data type.</span>
00384         <span class="comment">//</span>
00385 
00386         valueType = REG_SZ;
00387 
00388         <span class="comment">//</span>
00389         <span class="comment">// Read in the flags.</span>
00390         <span class="comment">//</span>
00391 
00392         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/parseini_8h.html#a7">CmpGetIntField</a>(    InfHandle,
00393                                 Section,
00394                                 LineIndex,
00395                                 3,
00396                                 &amp;flags))
00397         {
00398             flags = 0;
00399         }
00400 
00401         <span class="comment">//</span>
00402         <span class="comment">// Convert the flags to the registry type.</span>
00403         <span class="comment">//</span>
00404 
00405         <span class="keywordflow">switch</span>(flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a6">FLG_ADDREG_TYPE_MASK</a>)
00406         {
00407 
00408             <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/geninst_8c.html#a7">FLG_ADDREG_TYPE_SZ</a>:
00409 
00410                 valueType = REG_SZ;
00411                 <span class="keywordflow">break</span>;
00412 
00413             <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/geninst_8c.html#a8">FLG_ADDREG_TYPE_MULTI_SZ</a>:
00414 
00415                 valueType = REG_MULTI_SZ;
00416                 <span class="keywordflow">break</span>;
00417 
00418             <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/geninst_8c.html#a9">FLG_ADDREG_TYPE_EXPAND_SZ</a>:
00419 
00420                 valueType = REG_EXPAND_SZ;
00421                 <span class="keywordflow">break</span>;
00422 
00423             <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/geninst_8c.html#a10">FLG_ADDREG_TYPE_BINARY</a>:
00424 
00425                 valueType = REG_BINARY;
00426                 <span class="keywordflow">break</span>;
00427 
00428             <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/geninst_8c.html#a11">FLG_ADDREG_TYPE_DWORD</a>:
00429 
00430                 valueType = REG_DWORD;
00431                 <span class="keywordflow">break</span>;
00432 
00433             <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/geninst_8c.html#a12">FLG_ADDREG_TYPE_NONE</a>:
00434 
00435                 valueType = REG_NONE;
00436                 <span class="keywordflow">break</span>;
00437 
00438             <span class="keywordflow">default</span> :
00439 
00440                 <span class="comment">//</span>
00441                 <span class="comment">// If the FLG_ADDREG_BINVALUETYPE is set, then the highword</span>
00442                 <span class="comment">// can contain just about any random reg data type ordinal value.</span>
00443                 <span class="comment">//</span>
00444 
00445                 <span class="keywordflow">if</span>(flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a0">FLG_ADDREG_BINVALUETYPE</a>)
00446                 {
00447                     <span class="comment">//</span>
00448                     <span class="comment">// Disallow the following reg data types:</span>
00449                     <span class="comment">//</span>
00450                     <span class="comment">//    REG_NONE, REG_SZ, REG_EXPAND_SZ, REG_MULTI_SZ</span>
00451                     <span class="comment">//</span>
00452 
00453                     valueType = HIGHWORD(flags);
00454 
00455                     <span class="keywordflow">if</span>(valueType &lt; REG_BINARY || valueType == REG_MULTI_SZ)
00456                     {
00457                         <span class="keywordflow">return</span> (STATUS_INVALID_PARAMETER);
00458                     }
00459 
00460                 }
00461                 <span class="keywordflow">else</span>
00462                 {
00463                     <span class="keywordflow">return</span> (STATUS_INVALID_PARAMETER);
00464                 }
00465                 <span class="keywordflow">break</span>;
00466         }
00467 
00468         <span class="comment">//</span>
00469         <span class="comment">// Presently, the append behavior flag is only supported for</span>
00470         <span class="comment">// REG_MULTI_SZ values.</span>
00471         <span class="comment">//</span>
00472 
00473         <span class="keywordflow">if</span>((flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a3">FLG_ADDREG_APPEND</a>) &amp;&amp; valueType != REG_MULTI_SZ)
00474         {
00475             <span class="keywordflow">return</span> (STATUS_INVALID_PARAMETER);
00476         }
00477 
00478         <span class="comment">//</span>
00479         <span class="comment">// W9x compatibility.</span>
00480         <span class="comment">//</span>
00481 
00482         <span class="keywordflow">if</span>( (!valueName || *valueName == <span class="charliteral">'\0'</span>) &amp;&amp; valueType == REG_EXPAND_SZ)
00483         {
00484             valueType = REG_SZ;
00485         }
00486 
00487         status = <a class="code" href="../../d8/d0/geninst_8c.html#a28">CmpGetAddRegInfData</a>(   InfHandle,
00488                                         Section,
00489                                         LineIndex,
00490                                         4,
00491                                         valueType,
00492                                         &amp;data,
00493                                         &amp;dataSize);
00494 
00495         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00496         {
00497             <span class="comment">//</span>
00498             <span class="comment">// Open the specified key if possible.</span>
00499             <span class="comment">//</span>
00500 
00501             status = <a class="code" href="../../d8/d0/geninst_8c.html#a29">CmpOpenRegKey</a>( &amp;key,
00502                                     &amp;disposition,
00503                                     rootKeyName,
00504                                     subKeyName,
00505                                     KEY_QUERY_VALUE | KEY_SET_VALUE,
00506                                     (BOOLEAN)!(flags &amp; FLG_ADDREG_OVERWRITEONLY));
00507             <span class="comment">//</span>
00508             <span class="comment">// This variable gets set to TRUE if we dont actually want to set</span>
00509             <span class="comment">// the value.</span>
00510             <span class="comment">//</span>
00511 
00512             dontSet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00513             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00514             {
00515                 <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a3">FLG_ADDREG_APPEND</a>)
00516                 {
00517                     status = <a class="code" href="../../d8/d0/geninst_8c.html#a30">CmpAppendStringToMultiSz</a>(  key,
00518                                                         valueName,
00519                                                         &amp;data,
00520                                                         &amp;dataSize);
00521                 }
00522                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00523                 {
00524                     <span class="comment">//</span>
00525                     <span class="comment">// W9x compatibility.</span>
00526                     <span class="comment">//</span>
00527 
00528                     <span class="keywordflow">if</span> (disposition == REG_OPENED_EXISTING_KEY)
00529                     {
00530                         <span class="keywordflow">if</span> (    (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a1">FLG_ADDREG_NOCLOBBER</a>) &amp;&amp;
00531                                 (valueName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || *valueName == <span class="charliteral">'\0'</span>))
00532                         {
00533                             <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, <span class="stringliteral">""</span>);
00534                             status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
00535                             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00536                             {
00537 
00538                                 status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(   key,
00539                                                             &amp;unicodeString,
00540                                                             KeyValueBasicInformation,
00541                                                             NULL,
00542                                                             0,
00543                                                             &amp;disposition);
00544                                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) || status == STATUS_BUFFER_TOO_SMALL)
00545                                 {
00546                                     flags &amp;= ~<a class="code" href="../../d8/d0/geninst_8c.html#a1">FLG_ADDREG_NOCLOBBER</a>;
00547                                 }
00548                                 status = STATUS_SUCCESS;
00549 
00550                                 <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
00551                             }
00552                         }
00553 
00554                         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a2">FLG_ADDREG_DELVAL</a>)
00555                         {
00556                             <span class="comment">//</span>
00557                             <span class="comment">// setupx compatibility.</span>
00558                             <span class="comment">//</span>
00559 
00560                             dontSet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00561                             <span class="keywordflow">if</span> (valueName)
00562                             {
00563                                 <span class="comment">//</span>
00564                                 <span class="comment">// Delete the specified value.</span>
00565                                 <span class="comment">//</span>
00566 
00567                                 <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, valueName);
00568                                 status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
00569                                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00570                                 {
00571                                     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>(key, &amp;unicodeString);
00572                                     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
00573                                 }
00574                             }
00575                         }
00576                     }
00577                     <span class="keywordflow">else</span>
00578                     {
00579                         flags &amp;= ~<a class="code" href="../../d8/d0/geninst_8c.html#a1">FLG_ADDREG_NOCLOBBER</a>;
00580                     }
00581 
00582                     <span class="keywordflow">if</span> (!dontSet)
00583                     {
00584                         <span class="comment">//</span>
00585                         <span class="comment">// Respect the key only flag.</span>
00586                         <span class="comment">//</span>
00587 
00588                         <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a4">FLG_ADDREG_KEYONLY</a>))
00589                         {
00590                             <span class="comment">//</span>
00591                             <span class="comment">// If no clobber flag is set, make sure that the value does not</span>
00592                             <span class="comment">// already exist.</span>
00593                             <span class="comment">//</span>
00594 
00595                             <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, valueName);
00596                             status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
00597                             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00598                             {
00599                                 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    existStatus;
00600 
00601                                 <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a1">FLG_ADDREG_NOCLOBBER</a>)
00602                                 {
00603                                     existStatus = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(  key,
00604                                                                     &amp;unicodeString,
00605                                                                     KeyValueBasicInformation,
00606                                                                     NULL,
00607                                                                     0,
00608                                                                     &amp;disposition);
00609                                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(existStatus) || existStatus == STATUS_BUFFER_TOO_SMALL) {
00610                                         dontSet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00611                                     }
00612                                 }
00613                                 <span class="keywordflow">else</span>
00614                                 {
00615                                     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a5">FLG_ADDREG_OVERWRITEONLY</a>)
00616                                     {
00617                                         existStatus = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(  key,
00618                                                                         &amp;unicodeString,
00619                                                                         KeyValueBasicInformation,
00620                                                                         NULL,
00621                                                                         0,
00622                                                                         &amp;disposition);
00623                                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(existStatus) &amp;&amp; existStatus != STATUS_BUFFER_TOO_SMALL) {
00624                                             dontSet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00625                                         }
00626                                     }
00627                                 }
00628 
00629                                 <span class="keywordflow">if</span> (!dontSet)
00630                                 {
00631                                     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>( key,
00632                                                             &amp;unicodeString,
00633                                                             0,
00634                                                             valueType,
00635                                                             data,
00636                                                             dataSize);
00637                                 }
00638 
00639                                 <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
00640                             }
00641                         }
00642                     }
00643                 }
00644 
00645                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(key);
00646             }
00647             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a5">FLG_ADDREG_OVERWRITEONLY</a>)
00648             {
00649                 status = STATUS_SUCCESS;
00650             }
00651         }
00652     }
00653 
00654     <span class="keywordflow">return</span> (status);
00655 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="geninst.c::CmpProcessBitRegLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpProcessBitRegLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LineIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00776">776</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l02120">CmpGetIntField()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l01264">CmpOpenRegKey()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00139">FLG_BITREG_SET</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00141">FLG_BITREG_TYPE_DWORD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00784                        :
00785 
00786         This routine processes a BitReg line in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
00787 
00788     Input Parameters:
00789 
00790         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00791 
00792         Section - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section to be read.
00793 
00794         LineIndex - <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> line to be read.
00795 
00796     Return Value:
00797 
00798         Standard NT status value.
00799 
00800 --*/
00801 
00802 {
00803     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    status = STATUS_UNSUCCESSFUL;
00804     PCHAR                       rootKeyName;
00805     PCHAR                       subKeyName;
00806     PCHAR                       valueName;
00807     ULONG                       flags;
00808     ULONG                       mask;
00809     ULONG                       field;
00810     HANDLE                      key;
00811     ULONG                       disposition;
00812     ANSI_STRING                 ansiString;
00813     UNICODE_STRING              unicodeString;
00814     PCHAR                       buffer;
00815     ULONG                       size;
00816     PKEY_VALUE_FULL_INFORMATION valueInfo;
00817 
00818     <span class="comment">//</span>
00819     <span class="comment">// Get the root-key name.</span>
00820     <span class="comment">//</span>
00821 
00822     rootKeyName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
00823                                             Section,
00824                                             LineIndex,
00825                                             0);
00826     <span class="keywordflow">if</span> (rootKeyName)
00827     {
00828         <span class="comment">//</span>
00829         <span class="comment">// Get the optional sub-key name.</span>
00830         <span class="comment">//</span>
00831 
00832         subKeyName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(    InfHandle,
00833                                                 Section,
00834                                                 LineIndex,
00835                                                 1);
00836 
00837         <span class="comment">//</span>
00838         <span class="comment">// Value name is optional. Can be NULL or "".</span>
00839         <span class="comment">//</span>
00840 
00841         valueName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>( InfHandle,
00842                                             Section,
00843                                             LineIndex,
00844                                             2);
00845         <span class="keywordflow">if</span> (valueName &amp;&amp; *valueName)
00846         {
00847             <span class="comment">//</span>
00848             <span class="comment">// Read in the flags.</span>
00849             <span class="comment">//</span>
00850 
00851             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/parseini_8h.html#a7">CmpGetIntField</a>(    InfHandle,
00852                                     Section,
00853                                     LineIndex,
00854                                     3,
00855                                     &amp;flags))
00856             {
00857                 flags = 0;
00858             }
00859 
00860             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/parseini_8h.html#a7">CmpGetIntField</a>(    InfHandle,
00861                                     Section,
00862                                     LineIndex,
00863                                     4,
00864                                     &amp;mask))
00865             {
00866                 mask = 0;
00867             }
00868 
00869             <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a16">FLG_BITREG_TYPE_DWORD</a>))
00870             {
00871                 <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/parseini_8h.html#a7">CmpGetIntField</a>(    InfHandle,
00872                                         Section,
00873                                         LineIndex,
00874                                         5,
00875                                         &amp;field))
00876                 {
00877                     <span class="keywordflow">return</span> (status);
00878                 }
00879             }
00880 
00881             <span class="comment">//</span>
00882             <span class="comment">// Open the specified registry key.</span>
00883             <span class="comment">//</span>
00884 
00885             status = <a class="code" href="../../d8/d0/geninst_8c.html#a29">CmpOpenRegKey</a>( &amp;key,
00886                                     &amp;disposition,
00887                                     rootKeyName,
00888                                     subKeyName,
00889                                     KEY_ALL_ACCESS,
00890                                     FALSE);
00891             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00892             {
00893                 <span class="comment">//</span>
00894                 <span class="comment">// Read the existing data.</span>
00895                 <span class="comment">//</span>
00896 
00897                 <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, valueName);
00898                 status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
00899                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00900                 {
00901                     size = 0;
00902                     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(   key,
00903                                                 &amp;unicodeString,
00904                                                 KeyValueFullInformation,
00905                                                 NULL,
00906                                                 0,
00907                                                 &amp;size);
00908                     <span class="keywordflow">if</span> (size)
00909                     {
00910                         status = STATUS_NO_MEMORY;
00911                         buffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, size, CM_GENINST_TAG);
00912                         <span class="keywordflow">if</span> (buffer)
00913                         {
00914                             status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(   key,
00915                                                         &amp;unicodeString,
00916                                                         KeyValueFullInformation,
00917                                                         buffer,
00918                                                         size,
00919                                                         &amp;size);
00920                             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00921                             {
00922                                 valueInfo = (PKEY_VALUE_FULL_INFORMATION)buffer;
00923                                 <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a16">FLG_BITREG_TYPE_DWORD</a>)
00924                                 {
00925                                     <span class="keywordflow">if</span> (valueInfo-&gt;Type == REG_DWORD &amp;&amp; valueInfo-&gt;DataLength == <span class="keyword">sizeof</span>(ULONG))
00926                                     {
00927                                         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a14">FLG_BITREG_SET</a>)
00928                                         {
00929                                             *(PULONG)(buffer + valueInfo-&gt;DataOffset) |= mask;
00930                                         }
00931                                         <span class="keywordflow">else</span>
00932                                         {
00933                                             *(PULONG)(buffer + valueInfo-&gt;DataOffset) &amp;= ~mask;
00934                                         }
00935                                     }
00936                                 }
00937                                 <span class="keywordflow">else</span>
00938                                 {
00939                                     <span class="keywordflow">if</span> (valueInfo-&gt;Type == REG_BINARY &amp;&amp; field &lt; valueInfo-&gt;DataLength)
00940                                     {
00941                                         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d8/d0/geninst_8c.html#a14">FLG_BITREG_SET</a>)
00942                                         {
00943                                             *(PUCHAR)(buffer + valueInfo-&gt;DataOffset + field) |= mask;
00944                                         }
00945                                         <span class="keywordflow">else</span>
00946                                         {
00947                                             *(PUCHAR)(buffer + valueInfo-&gt;DataOffset + field) &amp;= ~mask;
00948                                         }
00949                                     }
00950                                 }
00951                                 status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>( key,
00952                                                         &amp;unicodeString,
00953                                                         0,
00954                                                         valueInfo-&gt;Type,
00955                                                         buffer + valueInfo-&gt;DataOffset,
00956                                                         valueInfo-&gt;DataLength);
00957                             }
00958                             <span class="keywordflow">else</span>
00959                             {
00960                                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Value cannot be read for BitReg in %s line %d\n"</span>, Section, LineIndex);
00961                                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status));
00962                             }
00963                             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
00964                         }
00965                         <span class="keywordflow">else</span>
00966                         {
00967                             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(buffer);
00968                             status = STATUS_NO_MEMORY;
00969                         }
00970                     }
00971 
00972                     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
00973                 }
00974                 <span class="comment">//</span>
00975                 <span class="comment">// Close the key handle.</span>
00976                 <span class="comment">//</span>
00977 
00978                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(key);
00979             }
00980         }
00981     }
00982 
00983     <span class="keywordflow">return</span> (status);
00984 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="geninst.c::CmpProcessDelRegLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpProcessDelRegLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LineIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00658">658</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l01264">CmpOpenRegKey()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00504">NtDeleteValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00666                        :
00667 
00668         This routine processes a DelReg line in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
00669 
00670     Input Parameters:
00671 
00672         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00673 
00674         Section - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section to be read.
00675 
00676         LineIndex - <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> line to be read.
00677 
00678     Return Value:
00679 
00680         Standard NT status value.
00681 
00682 --*/
00683 
00684 {
00685     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status = STATUS_UNSUCCESSFUL;
00686     PCHAR               rootKeyName;
00687     PCHAR               subKeyName;
00688     PCHAR               valueName;
00689     HANDLE              key;
00690     ULONG               disposition;
00691     ANSI_STRING         ansiString;
00692     UNICODE_STRING      unicodeString;
00693 
00694     <span class="comment">//</span>
00695     <span class="comment">// Read the required fields.</span>
00696     <span class="comment">//</span>
00697 
00698     rootKeyName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(   InfHandle,
00699                                             Section,
00700                                             LineIndex,
00701                                             0);
00702 
00703     subKeyName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(    InfHandle,
00704                                             Section,
00705                                             LineIndex,
00706                                             1);
00707 
00708     <span class="keywordflow">if</span> (rootKeyName &amp;&amp; subKeyName)
00709     {
00710         <span class="comment">//</span>
00711         <span class="comment">// Read the optional field.</span>
00712         <span class="comment">//</span>
00713 
00714         valueName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>( InfHandle,
00715                                             Section,
00716                                             LineIndex,
00717                                             2);
00718 
00719         <span class="comment">//</span>
00720         <span class="comment">// Open the specified registry key.</span>
00721         <span class="comment">//</span>
00722 
00723         status = <a class="code" href="../../d8/d0/geninst_8c.html#a29">CmpOpenRegKey</a>( &amp;key,
00724                                 &amp;disposition,
00725                                 rootKeyName,
00726                                 subKeyName,
00727                                 KEY_ALL_ACCESS,
00728                                 FALSE);
00729 
00730         <span class="comment">//</span>
00731         <span class="comment">// Proceed if we successfully opened the registry key.</span>
00732         <span class="comment">//</span>
00733 
00734         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00735         {
00736 
00737             <span class="comment">//</span>
00738             <span class="comment">// If the key was successfully opened, do the DelReg.</span>
00739             <span class="comment">//</span>
00740 
00741             <span class="keywordflow">if</span> (valueName)
00742             {
00743                 <span class="comment">//</span>
00744                 <span class="comment">// Delete the specified value.</span>
00745                 <span class="comment">//</span>
00746 
00747                 <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;ansiString, valueName);
00748                 status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeString, &amp;ansiString, TRUE);
00749                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00750                 {
00751                     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>(key, &amp;unicodeString);
00752                     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeString);
00753                 }
00754             }
00755             <span class="keywordflow">else</span>
00756             {
00757                 <span class="comment">//</span>
00758                 <span class="comment">// No value specified. The subkey needs to be deleted.</span>
00759                 <span class="comment">//</span>
00760 
00761                 status = <a class="code" href="../../d7/d7/ntapi_8c.html#a15">NtDeleteKey</a>(key);
00762             }
00763 
00764             <span class="comment">//</span>
00765             <span class="comment">// Close the key handle.</span>
00766             <span class="comment">//</span>
00767 
00768             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(key);
00769         }
00770     }
00771 
00772     <span class="keywordflow">return</span> (status);
00773 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="geninst.c::CmpProcessReg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpProcessReg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>RefData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00258">258</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
References <a class="el" href="../../d6/d2/parseini_8c-source.html#l01942">CmpSearchInfLine()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00045">PFN_REGLINE</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00156">RefData</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00266                        :
00267 
00268         This routine processes a AddReg section in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
00269 
00270     Input Parameters:
00271 
00272         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00273 
00274         Section - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section to be read.
00275 
00276     Return Value:
00277 
00278         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire section was processed successfully.
00279 
00280 --*/
00281 
00282 {
00283     ULONG       lineIndex;
00284     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status = STATUS_SUCCESS;
00285     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    temp;
00286 
00287     <span class="comment">//</span>
00288     <span class="comment">// Process all the lines in the xxxReg Section.</span>
00289     <span class="comment">//</span>
00290 
00291     <span class="keywordflow">for</span> (   lineIndex = 0;
00292             <a class="code" href="../../d6/d3/parseini_8h.html#a4">CmpSearchInfLine</a>(InfHandle, Section, lineIndex);
00293             lineIndex++)
00294     {
00295         temp = (*(<a class="code" href="../../d8/d0/geninst_8c.html#a19">PFN_REGLINE</a>)<a class="code" href="../../d8/d0/geninst_8c.html#a22">RefData</a>)(InfHandle, Section, lineIndex);
00296         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(temp))
00297         {
00298             status = temp;
00299         }
00300     }
00301 
00302     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
00303     {
00304         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00305     }
00306 
00307     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00308 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a21" doxytag="geninst.c::Action" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d0/geninst_8c.html#a18">PFN_INFRULE</a> <a class="el" href="../../d9/d3/rules_8c.html#a7">Action</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00155">155</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="geninst.c::gInfRuleTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct { ... }   <a class="el" href="../../d8/d0/geninst_8c.html#a23">gInfRuleTable</a>[NUM_OF_INF_RULES]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00176">CmpGenInstall()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="geninst.c::Name" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCHAR <a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">154</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/arbiter_8c-source.html#l00192">ArbInitializeArbiterInstance()</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">CmGetSystemControlValues()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">CmGetSystemDriverList()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l00697">CmpAssignSecurityDescriptor()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00323">CmpCheckKey()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00588">CmpCheckValueList()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l01252">CmpCreateLinkNode()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l04234">CmpCreatePredefined()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01328">CmpCreateRootNode()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00033">CmpDoCreate()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l01082">CmpFindControlSet()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00333">CmpFindDrivers()</a>, <a class="el" href="../../d5/d2/cmtree_8c-source.html#l00033">CmpFindNameInList()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00108">CmpFindNLSData()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l01284">CmpFindProfileOption()</a>, <a class="el" href="../../d5/d2/cmtree_8c-source.html#l00309">CmpFindValueByNameFromCache()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00176">CmpGenInstall()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01165">CmpGetKeySecurity()</a>, <a class="el" href="../../d9/d1/cmsubs_8c-source.html#l00368">CmpGetNameControlBlock()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01109">CmpGetObjectSecurity()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00726">CmpInitializeHiveList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01845">CmpInterlockedFunction()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00473">CmpIsLoadType()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00394">CmpMatchDescription()</a>, <a class="el" href="../../d0/d1/cmname_8c-source.html#l00033">CmpNameSize()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d0/d2/cmsubs2_8c-source.html#l00110">CmpQueryKeyData()</a>, <a class="el" href="../../d6/d1/cmquery_8c-source.html#l00028">CmpQueryKeyName()</a>, <a class="el" href="../../d0/d2/cmsubs2_8c-source.html#l00531">CmpQueryKeyValueData()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l01221">CmpSetCurrentProfile()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l00744">CmpSortDriverList()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l00647">CmQueryKey()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00097">CmRestoreKey()</a>, <a class="el" href="../../d5/d3/prefix_8c-source.html#l00843">CompareNamesCaseSensitive()</a>, <a class="el" href="../../d5/d3/prefix_8c-source.html#l02191">CompareUnicodeStrings()</a>, <a class="el" href="../../d5/d3/prefix_8c-source.html#l00750">ComputeNameLength()</a>, <a class="el" href="../../d5/d3/prefix_8c-source.html#l02126">ComputeUnicodeNameLength()</a>, <a class="el" href="../../d8/d8/uob_8c-source.html#l00039">DumpObjectDirs()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00625">EhCreateChild()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00585">EhOpenChildByName()</a>, <a class="el" href="../../d5/d4/logger_8c-source.html#l00062">ExCreateDebugLogTag()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00218">FsRtlCompareNodeAndKey()</a>, <a class="el" href="../../d2/d2/dbcsname_8c-source.html#l00694">FsRtlDoesDbcsContainWildCards()</a>, <a class="el" href="../../d5/d4/name_8c-source.html#l00229">FsRtlDoesNameContainWildCards()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00913">FsRtlFindInTunnelCache()</a>, <a class="el" href="../../d2/d2/dbcsname_8c-source.html#l00771">FsRtlIsDbcsInExpression()</a>, <a class="el" href="../../d5/d4/name_8c-source.html#l00415">FsRtlIsNameInExpression()</a>, <a class="el" href="../../d5/d4/name_8c-source.html#l00482">FsRtlIsNameInExpressionPrivate()</a>, <a class="el" href="../../d6/d8/gen8dot3_8c-source.html#l00555">GetNextWchar()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00386">IopCaptureObjectName()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00296">IsVolumeName()</a>, <a class="el" href="../../d1/d1/lboxctl3_8c-source.html#l01071">LB_CreateLBLine()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l01312">LdrpGetFileVersion()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l02747">LdrpNameToOrdinal()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l00214">LdrpWalkImportDescriptor()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l02277">LdrQueryApplicationCompatibilityGoo()</a>, <a class="el" href="../../d5/d1/rtmisc1_8c-source.html#l00075">main()</a>, <a class="el" href="../../d7/d7/exatom_8c-source.html#l00294">NtQueryInformationAtom()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00705">ObpLookupDirectoryEntry()</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>, <a class="el" href="../../d1/d9/rtl_2atom_8c-source.html#l00516">RtlAddAtomToAtomTable()</a>, <a class="el" href="../../d6/d8/gen8dot3_8c-source.html#l00669">RtlComputeLfnChecksum()</a>, <a class="el" href="../../d6/d8/gen8dot3_8c-source.html#l00081">RtlGenerate8dot3Name()</a>, <a class="el" href="../../d6/d8/gen8dot3_8c-source.html#l00729">RtlIsNameLegalDOS8Dot3()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l05143">RtlpDphIsDllTargeted()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l05087">RtlpDphTargetDllsLoadCallBack()</a>, <a class="el" href="../../d1/d9/rtl_2atom_8c-source.html#l00385">RtlpGetIntegerAtom()</a>, <a class="el" href="../../d1/d9/rtl_2atom_8c-source.html#l00451">RtlpHashStringToAtom()</a>, <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00465">RtlpNtEnumerateSubKey()</a>, <a class="el" href="../../d6/d6/environ_8c-source.html#l00250">RtlQueryEnvironmentVariable_U()</a>, <a class="el" href="../../d6/d6/environ_8c-source.html#l00458">RtlSetEnvironmentVariable()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l01582">SepClientOpenPipe()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, <a class="el" href="../../d3/d9/tenv_8c-source.html#l00046">SetEnvironment()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00301">UdfCandidateShortName()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00689">UdfConvertCS0DstringToUnicode()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00726">UdfFindDirEntry()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00557">UdfFindNameLink()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00064">UdfInsertPrefix()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00927">UdfRenderNameToLegalUnicode()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01131">UdfUpcaseName()</a>, and <a class="el" href="../../d1/d8/uilist_8c-source.html#l00272">ValidateName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="geninst.c::RefData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d0/geninst_8c.html#a22">RefData</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/geninst_8c-source.html#l00156">156</a> of file <a class="el" href="../../d9/d9/geninst_8c-source.html">geninst.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/geninst_8c-source.html#l00258">CmpProcessReg()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
