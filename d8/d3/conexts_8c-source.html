<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: conexts.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>conexts.c</h1><a href="../../d7/d4/conexts_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/***************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: conexts.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains random debugging related functions.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">\***************************************************************************/</span>
00009 
00010 
00011 <span class="preprocessor">#include "<a class="code" href="../../d6/d3/w32_2ntcon_2server_2precomp_8h.html">precomp.h</a>"</span>
00012 <span class="preprocessor">#pragma hdrstop</span>
<a name="l00013"></a><a class="code" href="../../d7/d4/conexts_8c.html#a0">00013</a> <span class="preprocessor"></span><span class="preprocessor">#define NOEXTAPI</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#include &lt;wdbgexts.h&gt;</span>
00015 
00016 <span class="comment">/***************************************************************************\</span>
00017 <span class="comment">* Global variables</span>
00018 <span class="comment">\***************************************************************************/</span>
<a name="l00019"></a><a class="code" href="../../d7/d4/conexts_8c.html#a13">00019</a> PSTR <a class="code" href="../../d7/d4/conexts_8c.html#a13">pszAccessViolation</a> = <span class="stringliteral">"CONEXTS: Access violation on \"%s\", switch to server context\n"</span>;
<a name="l00020"></a><a class="code" href="../../d7/d4/conexts_8c.html#a14">00020</a> PSTR <a class="code" href="../../d7/d4/conexts_8c.html#a14">pszMoveException</a>   = <span class="stringliteral">"CONEXTS: exception in move()\n"</span>;
<a name="l00021"></a><a class="code" href="../../d7/d4/conexts_8c.html#a15">00021</a> PSTR <a class="code" href="../../d7/d4/conexts_8c.html#a15">pszReadFailure</a>     = <span class="stringliteral">"CONEXTS: moveBlock(%x, %x, %x) failed!\n"</span>;
00022 
00023 <span class="comment">/***************************************************************************\</span>
00024 <span class="comment">* Macros</span>
00025 <span class="comment">\***************************************************************************/</span>
<a name="l00026"></a><a class="code" href="../../d7/d4/conexts_8c.html#a1">00026</a> <span class="preprocessor">#define move(dst, src)  moveBlock(dst, src, sizeof(dst))</span>
00027 <span class="preprocessor"></span>
<a name="l00028"></a><a class="code" href="../../d7/d4/conexts_8c.html#a2">00028</a> <span class="preprocessor">#define moveBlock(dst, src, size)                                                                     \</span>
00029 <span class="preprocessor">try {                                                                                                 \</span>
00030 <span class="preprocessor">    if (lpExtensionApis-&gt;nSize &gt;= sizeof(WINDBG_EXTENSION_APIS)) {                                    \</span>
00031 <span class="preprocessor">        if (!(*lpExtensionApis-&gt;lpReadProcessMemoryRoutine)((DWORD_PTR)(src), &amp;(dst), (size), NULL)) {    \</span>
00032 <span class="preprocessor">            (*lpExtensionApis-&gt;lpOutputRoutine)(pszReadFailure, &amp;dst, src, size);                     \</span>
00033 <span class="preprocessor">            return FALSE;                                                                             \</span>
00034 <span class="preprocessor">         }                                                                                            \</span>
00035 <span class="preprocessor">    } else {                                                                                          \</span>
00036 <span class="preprocessor">        if (!NT_SUCCESS(NtReadVirtualMemory(hCurrentProcess, (LPVOID)(src), &amp;(dst), (size), NULL))) { \</span>
00037 <span class="preprocessor">            (*lpExtensionApis-&gt;lpOutputRoutine)(pszReadFailure, &amp;dst, src, size);                     \</span>
00038 <span class="preprocessor">            return FALSE;                                                                             \</span>
00039 <span class="preprocessor">        }                                                                                             \</span>
00040 <span class="preprocessor">    }                                                                                                 \</span>
00041 <span class="preprocessor">} except (EXCEPTION_EXECUTE_HANDLER) {                                                                \</span>
00042 <span class="preprocessor">    (*lpExtensionApis-&gt;lpOutputRoutine)(pszMoveException);                                            \</span>
00043 <span class="preprocessor">    return FALSE;                                                                                     \</span>
00044 <span class="preprocessor">}</span>
00045 <span class="preprocessor"></span>
<a name="l00046"></a><a class="code" href="../../d7/d4/conexts_8c.html#a3">00046</a> <span class="preprocessor">#define moveExpressionValue(dst, src)                                 \</span>
00047 <span class="preprocessor">try {                                                                 \</span>
00048 <span class="preprocessor">    DWORD dwGlobal = (DWORD)lpExtensionApis-&gt;lpGetExpressionRoutine(src);    \</span>
00049 <span class="preprocessor">    if (lpExtensionApis-&gt;nSize &lt; sizeof(WINDBG_EXTENSION_APIS)) {     \</span>
00050 <span class="preprocessor">        move(dwGlobal, dwGlobal);                                     \</span>
00051 <span class="preprocessor">    }                                                                 \</span>
00052 <span class="preprocessor">    (DWORD)dst = dwGlobal;                                            \</span>
00053 <span class="preprocessor">} except (GetExceptionCode() == EXCEPTION_ACCESS_VIOLATION ?          \</span>
00054 <span class="preprocessor">            EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH) {  \</span>
00055 <span class="preprocessor">    (*lpExtensionApis-&gt;lpOutputRoutine)(pszAccessViolation, src);     \</span>
00056 <span class="preprocessor">    return FALSE;                                                     \</span>
00057 <span class="preprocessor">}</span>
00058 <span class="preprocessor"></span>
<a name="l00059"></a><a class="code" href="../../d7/d4/conexts_8c.html#a4">00059</a> <span class="preprocessor">#define moveExpressionValuePtr(dst, src)                              \</span>
00060 <span class="preprocessor">try {                                                                 \</span>
00061 <span class="preprocessor">    DWORD_PTR dwGlobal = lpExtensionApis-&gt;lpGetExpressionRoutine(src);\</span>
00062 <span class="preprocessor">    if (lpExtensionApis-&gt;nSize &lt; sizeof(WINDBG_EXTENSION_APIS)) {     \</span>
00063 <span class="preprocessor">        move(dwGlobal, dwGlobal);                                     \</span>
00064 <span class="preprocessor">    }                                                                 \</span>
00065 <span class="preprocessor">    (DWORD_PTR)dst = dwGlobal;                                        \</span>
00066 <span class="preprocessor">} except (GetExceptionCode() == EXCEPTION_ACCESS_VIOLATION ?          \</span>
00067 <span class="preprocessor">            EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH) {  \</span>
00068 <span class="preprocessor">    (*lpExtensionApis-&gt;lpOutputRoutine)(pszAccessViolation, src);     \</span>
00069 <span class="preprocessor">    return FALSE;                                                     \</span>
00070 <span class="preprocessor">}</span>
00071 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="../../d7/d4/conexts_8c.html#a5">00072</a> <span class="preprocessor">#define moveExpressionAddress(dst, src)                               \</span>
00073 <span class="preprocessor">try {                                                                 \</span>
00074 <span class="preprocessor">    if (lpExtensionApis-&gt;nSize &gt;= sizeof(WINDBG_EXTENSION_APIS)) {    \</span>
00075 <span class="preprocessor">        (DWORD_PTR)dst = lpExtensionApis-&gt;lpGetExpressionRoutine("&amp;"src); \</span>
00076 <span class="preprocessor">    } else {                                                          \</span>
00077 <span class="preprocessor">        (DWORD_PTR)dst = lpExtensionApis-&gt;lpGetExpressionRoutine(src);    \</span>
00078 <span class="preprocessor">    }                                                                 \</span>
00079 <span class="preprocessor">} except (GetExceptionCode() == EXCEPTION_ACCESS_VIOLATION ?          \</span>
00080 <span class="preprocessor">            EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH) {  \</span>
00081 <span class="preprocessor">    (*lpExtensionApis-&gt;lpOutputRoutine)(pszAccessViolation, src);     \</span>
00082 <span class="preprocessor">    return FALSE;                                                     \</span>
00083 <span class="preprocessor">}</span>
00084 <span class="preprocessor"></span>
<a name="l00085"></a><a class="code" href="../../d7/d4/conexts_8c.html#a21">00085</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(
00086     HANDLE hCurrentProcess,
00087     PWINDBG_EXTENSION_APIS lpExtensionApis,
00088     LPWSTR psrc,
00089     ULONG cbSrc,
00090     LPSTR pdst,
00091     ULONG cbDst)
00092 {
00093     WCHAR awch[80];
00094     ULONG cchText;
00095 
00096     cbSrc = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cbSrc, <span class="keyword">sizeof</span>(awch) - <span class="keyword">sizeof</span>(WCHAR));
00097     <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(awch, psrc, cbSrc);
00098     awch[cbSrc/<span class="keyword">sizeof</span>(WCHAR)] = 0;
00099 
00100     cchText = wcslen(awch);
00101     <span class="keywordflow">if</span> (cchText == 0) {
00102         strcpy(pdst, <span class="stringliteral">"&lt;null&gt;"</span>);
00103     } <span class="keywordflow">else</span> {
00104         cbSrc = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cbSrc + <span class="keyword">sizeof</span>(WCHAR), (cchText + 1) * <span class="keyword">sizeof</span>(WCHAR));
00105         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a37">RtlUnicodeToMultiByteN</a>(pdst, cbDst, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00106                 awch, cbSrc);
00107         pdst[cbDst-1] = 0;
00108     }
00109     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00110 }
00111 
<a name="l00112"></a><a class="code" href="../../d7/d4/conexts_8c.html#a16">00112</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a16">gbShowFlagNames</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00113 
<a name="l00114"></a><a class="code" href="../../d7/d4/conexts_8c.html#a6">00114</a> <span class="preprocessor">#define NO_FLAG (LPSTR)0xFFFFFFFF  // use this for non-meaningful entries.</span>
00115 <span class="preprocessor"></span>
<a name="l00116"></a><a class="code" href="../../d7/d4/conexts_8c.html#a7">00116</a> <span class="preprocessor">#define GF_CONSOLE  1</span>
<a name="l00117"></a><a class="code" href="../../d7/d4/conexts_8c.html#a17">00117</a> <span class="preprocessor"></span>LPSTR <a class="code" href="../../d7/d4/conexts_8c.html#a17">apszConsoleFlags</a>[] = {
00118    <span class="stringliteral">"CONSOLE_IS_ICONIC"</span>              , <span class="comment">// 0x000001</span>
00119    <span class="stringliteral">"CONSOLE_OUTPUT_SUSPENDED"</span>       , <span class="comment">// 0x000002</span>
00120    <span class="stringliteral">"CONSOLE_HAS_FOCUS"</span>              , <span class="comment">// 0x000004</span>
00121    <span class="stringliteral">"CONSOLE_IGNORE_NEXT_MOUSE_INPUT"</span>, <span class="comment">// 0x000008</span>
00122    <span class="stringliteral">"CONSOLE_SELECTING"</span>              , <span class="comment">// 0x000010</span>
00123    <span class="stringliteral">"CONSOLE_SCROLLING"</span>              , <span class="comment">// 0x000020</span>
00124    <span class="stringliteral">"CONSOLE_DISABLE_CLOSE"</span>          , <span class="comment">// 0x000040</span>
00125    <span class="stringliteral">"CONSOLE_NOTIFY_LAST_CLOSE"</span>      , <span class="comment">// 0x000080</span>
00126    <span class="stringliteral">"CONSOLE_NO_WINDOW"</span>              , <span class="comment">// 0x000100</span>
00127    <span class="stringliteral">"CONSOLE_VDM_REGISTERED"</span>         , <span class="comment">// 0x000200</span>
00128    <span class="stringliteral">"CONSOLE_UPDATING_SCROLL_BARS"</span>   , <span class="comment">// 0x000400</span>
00129    <span class="stringliteral">"CONSOLE_QUICK_EDIT_MODE"</span>        , <span class="comment">// 0x000800</span>
00130    <span class="stringliteral">"CONSOLE_TERMINATING"</span>            , <span class="comment">// 0x001000</span>
00131    <span class="stringliteral">"CONSOLE_CONNECTED_TO_EMULATOR"</span>  , <span class="comment">// 0x002000</span>
00132    <span class="stringliteral">"CONSOLE_FULLSCREEN_NOPAINT"</span>     , <span class="comment">// 0x004000</span>
00133    <span class="stringliteral">"CONSOLE_SHUTTING_DOWN"</span>          , <span class="comment">// 0x008000</span>
00134    <span class="stringliteral">"CONSOLE_AUTO_POSITION"</span>          , <span class="comment">// 0x010000</span>
00135    <span class="stringliteral">"CONSOLE_IGNORE_NEXT_KEYUP"</span>      , <span class="comment">// 0x020000</span>
00136    <span class="stringliteral">"CONSOLE_WOW_REGISTERED"</span>         , <span class="comment">// 0x040000</span>
00137    <span class="stringliteral">"CONSOLE_USE_PRIVATE_FLAGS"</span>      , <span class="comment">// 0x080000</span>
00138    <span class="stringliteral">"CONSOLE_HISTORY_NODUP"</span>          , <span class="comment">// 0x100000</span>
00139    <span class="stringliteral">"CONSOLE_SCROLLBAR_TRACKING"</span>     , <span class="comment">// 0x200000</span>
00140    <span class="stringliteral">"CONSOLE_IN_DESTRUCTION"</span>         , <span class="comment">// 0x400000</span>
00141    <span class="stringliteral">"CONSOLE_SETTING_WINDOW_SIZE"</span>    , <span class="comment">// 0x800000</span>
00142    <span class="stringliteral">"CONSOLE_DEFAULT_BUFFER_SIZE"</span>    , <span class="comment">// 0x0100000</span>
00143     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                              <span class="comment">// no more</span>
00144 };
00145 
<a name="l00146"></a><a class="code" href="../../d7/d4/conexts_8c.html#a8">00146</a> <span class="preprocessor">#define GF_CONSOLESEL  2</span>
<a name="l00147"></a><a class="code" href="../../d7/d4/conexts_8c.html#a18">00147</a> <span class="preprocessor"></span>LPSTR <a class="code" href="../../d7/d4/conexts_8c.html#a18">apszConsoleSelectionFlags</a>[] = {
00148    <span class="stringliteral">"CONSOLE_SELECTION_NOT_EMPTY"</span>    , <span class="comment">// 1</span>
00149    <span class="stringliteral">"CONSOLE_MOUSE_SELECTION"</span>        , <span class="comment">// 2</span>
00150    <span class="stringliteral">"CONSOLE_MOUSE_DOWN"</span>             , <span class="comment">// 4</span>
00151    <span class="stringliteral">"CONSOLE_SELECTION_INVERTED"</span>     , <span class="comment">// 8</span>
00152    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                               <span class="comment">// no more</span>
00153 };
00154 
<a name="l00155"></a><a class="code" href="../../d7/d4/conexts_8c.html#a9">00155</a> <span class="preprocessor">#define GF_FULLSCREEN  3</span>
<a name="l00156"></a><a class="code" href="../../d7/d4/conexts_8c.html#a19">00156</a> <span class="preprocessor"></span>LPSTR <a class="code" href="../../d7/d4/conexts_8c.html#a19">apszFullScreenFlags</a>[] = {
00157    <span class="stringliteral">"CONSOLE_FULLSCREEN"</span>,             <span class="comment">// 0</span>
00158    <span class="stringliteral">"CONSOLE_FULLSCREEN_HARDWARE"</span>,    <span class="comment">// 1</span>
00159    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00160 };
00161 
<a name="l00162"></a><a class="code" href="../../d7/d4/conexts_8c.html#a10">00162</a> <span class="preprocessor">#define GF_CMDHIST     4</span>
<a name="l00163"></a><a class="code" href="../../d7/d4/conexts_8c.html#a20">00163</a> <span class="preprocessor"></span>LPSTR <a class="code" href="../../d7/d4/conexts_8c.html#a20">apszCommandHistoryFlags</a>[] = {
00164    <span class="stringliteral">"CLE_ALLOCATED"</span>,                  <span class="comment">// 0x01</span>
00165    <span class="stringliteral">"CLE_RESET"</span>,                      <span class="comment">// 0x02</span>
00166    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00167 };
00168 
00169 
00170 <span class="comment">/*</span>
00171 <span class="comment"> * Converts a 32bit set of flags into an appropriate string.</span>
00172 <span class="comment"> * pszBuf should be large enough to hold this string, no checks are done.</span>
00173 <span class="comment"> * pszBuf can be NULL, allowing use of a local static buffer but note that</span>
00174 <span class="comment"> * this is not reentrant.</span>
00175 <span class="comment"> * Output string has the form: " = FLAG1 | FLAG2 ..."</span>
00176 <span class="comment"> */</span>
<a name="l00177"></a><a class="code" href="../../d7/d4/conexts_8c.html#a22">00177</a> LPSTR <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(
00178 WORD wType,
00179 DWORD dwFlags,
00180 LPSTR pszBuf)
00181 {
00182     <span class="keyword">static</span> <span class="keywordtype">char</span> szT[400];
00183     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00184     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00185     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fNoMoreNames = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00186     LPSTR *apszFlags;
00187 
00188     <span class="keywordflow">if</span> (pszBuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00189         pszBuf = szT;
00190     }
00191     *pszBuf = <span class="charliteral">'\0'</span>;
00192 
00193     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d4/conexts_8c.html#a16">gbShowFlagNames</a>) {
00194         <span class="keywordflow">return</span>(pszBuf);
00195     }
00196 
00197     <span class="keywordflow">switch</span> (wType) {
00198     <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/conexts_8c.html#a7">GF_CONSOLE</a>:
00199         apszFlags = <a class="code" href="../../d7/d4/conexts_8c.html#a17">apszConsoleFlags</a>;
00200         <span class="keywordflow">break</span>;
00201 
00202     <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/conexts_8c.html#a8">GF_CONSOLESEL</a>:
00203         apszFlags = <a class="code" href="../../d7/d4/conexts_8c.html#a18">apszConsoleSelectionFlags</a>;
00204         <span class="keywordflow">break</span>;
00205 
00206     <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/conexts_8c.html#a9">GF_FULLSCREEN</a>:
00207         apszFlags = <a class="code" href="../../d7/d4/conexts_8c.html#a19">apszFullScreenFlags</a>;
00208         <span class="keywordflow">break</span>;
00209 
00210     <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/conexts_8c.html#a10">GF_CMDHIST</a>:
00211         apszFlags = <a class="code" href="../../d7/d4/conexts_8c.html#a20">apszCommandHistoryFlags</a>;
00212         <span class="keywordflow">break</span>;
00213 
00214     <span class="keywordflow">default</span>:
00215         strcpy(pszBuf, <span class="stringliteral">" = Invalid flag type."</span>);
00216         <span class="keywordflow">return</span>(pszBuf);
00217     }
00218 
00219     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &gt;&gt;= 1, i++) {
00220 
00221         <span class="keywordflow">if</span> (!fNoMoreNames &amp;&amp; (apszFlags[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00222             fNoMoreNames = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00223         }
00224         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; 1) {
00225             <span class="keywordflow">if</span> (!fFirst) {
00226                 strcat(pszBuf, <span class="stringliteral">" | "</span>);
00227             } <span class="keywordflow">else</span> {
00228                 strcat(pszBuf, <span class="stringliteral">" = "</span>);
00229                 fFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00230             }
00231             <span class="keywordflow">if</span> (fNoMoreNames || (apszFlags[i] == <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>)) {
00232                 <span class="keywordtype">char</span> ach[16];
00233                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"0x%lx"</span>, 1 &lt;&lt; i);
00234                 strcat(pszBuf, ach);
00235             } <span class="keywordflow">else</span> {
00236                 strcat(pszBuf, apszFlags[i]);
00237             }
00238         }
00239     }
00240     <span class="keywordflow">return</span> pszBuf;
00241 }
00242 
00243 
00244 <span class="comment">/***************************************************************************\</span>
00245 <span class="comment">* help - list help for debugger extensions in CONEXTS.</span>
00246 <span class="comment">*</span>
00247 <span class="comment">*</span>
00248 <span class="comment">* 04-Feb-1994 IanJa     Created.</span>
00249 <span class="comment">\***************************************************************************/</span>
00250 
<a name="l00251"></a><a class="code" href="../../d7/d4/conexts_8c.html#a23">00251</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a23">help</a>(
00252     HANDLE hCurrentProcess,
00253     HANDLE hCurrentThread,
00254     DWORD dwCurrentPc,
00255     PWINDBG_EXTENSION_APIS lpExtensionApis,
00256     LPSTR lpArgumentString)
00257 {
00258     PWINDBG_OUTPUT_ROUTINE Print;
00259     PWINDBG_GET_EXPRESSION EvalExpression;
00260     PWINDBG_GET_SYMBOL GetSymbol;
00261 
00262     UNREFERENCED_PARAMETER(hCurrentProcess);
00263     UNREFERENCED_PARAMETER(hCurrentThread);
00264     UNREFERENCED_PARAMETER(dwCurrentPc);
00265 
00266     Print = lpExtensionApis-&gt;lpOutputRoutine;
00267     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
00268     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
00269 
00270     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
00271         lpArgumentString++;
00272 
00273     <span class="keywordflow">if</span> (*lpArgumentString == <span class="charliteral">'\0'</span>) {
00274         Print(<span class="stringliteral">"conexts help:\n\n"</span>);
00275         Print(<span class="stringliteral">"!help [cmd]            - this list, or details about cmd\n"</span>);
00276         Print(<span class="stringliteral">"!dc [fvh] [pconsole]   - Dump CONSOLE_INFORMATION struct\n"</span>);
00277         Print(<span class="stringliteral">"!dch &lt;p&gt;               - Dump Command History\n"</span>);
00278         Print(<span class="stringliteral">"!dcpt [address]        - Dump CPTABLEINFO (default: GlyphCP)\n"</span>);
00279         Print(<span class="stringliteral">"!dmem [v] [pconsole]   - Dump memory usage\n"</span>);
00280         Print(<span class="stringliteral">"!df                    - Dump font cache\n"</span>);
00281         Print(<span class="stringliteral">"!di &lt;p&gt;                - Dump input buffer info\n"</span>);
00282         Print(<span class="stringliteral">"!dir &lt;p&gt;               - Dump input record ???\n"</span>);
00283         Print(<span class="stringliteral">"!ds &lt;pscreen&gt;          - Dump SCREEN_INFORMATION struct\n"</span>);
00284         Print(<span class="stringliteral">"!dt [f] [v[n]] &lt;pcon&gt;  - Dump screen buffer info\n"</span>);
00285     } <span class="keywordflow">else</span> {
00286         <span class="keywordflow">if</span> (*lpArgumentString == <span class="charliteral">'!'</span>)
00287             lpArgumentString++;
00288         <span class="keywordflow">if</span> (strcmp(lpArgumentString, <span class="stringliteral">"df"</span>) == 0) {
00289             Print(<span class="stringliteral">"!df         - dumps Faces and then the cache\n"</span>);
00290 
00291         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lpArgumentString, <span class="stringliteral">"dc"</span>) == 0) {
00292             Print(<span class="stringliteral">"!dc [fhv]          - dumps CONSOLE_INFORMATION struct for all consoles\n"</span>);
00293             Print(<span class="stringliteral">"!dc [fhv] address  - dumps CONSOLE_INFORMATION struct for console at address\n"</span>);
00294             Print(<span class="stringliteral">"   optional flags (must be sparated by spaces) :\n"</span>);
00295             Print(<span class="stringliteral">"     f - show names of flags\n"</span>);
00296             Print(<span class="stringliteral">"     h - show command histories\n"</span>);
00297             Print(<span class="stringliteral">"     v - show verbose information\n"</span>);
00298             Print(<span class="stringliteral">"eg: \"dc f h v\"\n"</span>);
00299 
00300         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lpArgumentString, <span class="stringliteral">"dt"</span>) == 0) {
00301             Print(<span class="stringliteral">"!dt [fc] [v[n]] addr - dumps text buffer info for Console at addr\n"</span>);
00302             Print(<span class="stringliteral">"!dt                  - dumps text buffer info for all Consoles\n"</span>);
00303             Print(<span class="stringliteral">"  f    - show flags\n"</span>);
00304             Print(<span class="stringliteral">"  c    - checks text buffer integrity\n"</span>);
00305             Print(<span class="stringliteral">"  v[n] - show first n lines (default 10)\n"</span>);
00306 
00307         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lpArgumentString, <span class="stringliteral">"di"</span>) == 0) {
00308             Print(<span class="stringliteral">"!di address - dumps text buffer info (INPUT_INFORMATION)\n"</span>);
00309             Print(<span class="stringliteral">"!di         - dumps text buffer info for all Consoles\n"</span>);
00310 
00311         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lpArgumentString, <span class="stringliteral">"ds"</span>) == 0) {
00312             Print(<span class="stringliteral">"!ds address - dumps SCREEN_INFORMATION struct at address\n"</span>);
00313 
00314         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lpArgumentString, <span class="stringliteral">"dmem"</span>) == 0) {
00315             Print(<span class="stringliteral">"!dmem [v]       - dumps memory usage for all consoles\n"</span>);
00316             Print(<span class="stringliteral">"!dmem [v] addr  - dumps memory usage for all console at addr\n"</span>);
00317             Print(<span class="stringliteral">"     v - show verbose information\n"</span>);
00318 
00319         }
00320     }
00321 
00322     <span class="keywordflow">return</span> 0;
00323 }
00324 
00325 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>(HANDLE, HANDLE, DWORD, PWINDBG_EXTENSION_APIS, LPSTR);
00326 
00327 <span class="comment">/***************************************************************************\</span>
00328 <span class="comment">* dc - Dump Console - dump CONSOLE_INFORMATION struct</span>
00329 <span class="comment">*</span>
00330 <span class="comment">* dc address    - dumps simple info for console at address</span>
00331 <span class="comment">*                 (takes handle too)</span>
00332 <span class="comment">\***************************************************************************/</span>
00333 
<a name="l00334"></a><a class="code" href="../../d7/d4/conexts_8c.html#a25">00334</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a25">dc</a>(
00335     HANDLE hCurrentProcess,
00336     HANDLE hCurrentThread,
00337     DWORD dwCurrentPc,
00338     PWINDBG_EXTENSION_APIS lpExtensionApis,
00339     LPSTR lpArgString)
00340 {
00341     PWINDBG_OUTPUT_ROUTINE Print;
00342     PWINDBG_GET_EXPRESSION EvalExpression;
00343     PWINDBG_GET_SYMBOL GetSymbol;
00344 
00345     <span class="keywordtype">char</span> ach[120];
00346     <span class="keywordtype">char</span> chVerbose, chShowFlags, chHistory;
00347     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fPrintLine;
00348     ULONG i;
00349     ULONG <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>;
00350     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>;
00351     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">CONSOLE_INFORMATION</a> Console;
00352     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> pConsole = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00353 
00354     Print = lpExtensionApis-&gt;lpOutputRoutine;
00355     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
00356     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
00357 
00358     <a class="code" href="../../d7/d4/conexts_8c.html#a16">gbShowFlagNames</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00359     chVerbose   = <span class="charliteral">' '</span>;
00360     chShowFlags = <span class="charliteral">' '</span>;
00361     chHistory = <span class="charliteral">' '</span>;
00362 
00363     <span class="keywordflow">do</span> {
00364         <span class="comment">/*</span>
00365 <span class="comment">         * Skip white space</span>
00366 <span class="comment">         */</span>
00367         <span class="keywordflow">while</span> (*lpArgString &amp;&amp; *lpArgString == <span class="charliteral">' '</span>)
00368             lpArgString++;
00369 
00370         <span class="comment">/*</span>
00371 <span class="comment">         * f : show flags</span>
00372 <span class="comment">         */</span>
00373         <span class="keywordflow">switch</span> (*lpArgString) {
00374         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>: <span class="comment">// show flags</span>
00375             <a class="code" href="../../d7/d4/conexts_8c.html#a16">gbShowFlagNames</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00376             chShowFlags = <span class="charliteral">'f'</span>;
00377             <span class="keywordflow">break</span>;
00378 
00379         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00380             chVerbose = <span class="charliteral">'v'</span>;
00381             <span class="keywordflow">break</span>;
00382 
00383         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00384             chHistory = <span class="charliteral">'h'</span>;
00385             <span class="keywordflow">break</span>;
00386 
00387         <span class="keywordflow">case</span> <span class="charliteral">'\0'</span>:
00388             <span class="comment">/*</span>
00389 <span class="comment">             * If no console is specified, loop through all of them</span>
00390 <span class="comment">             */</span>
00391             <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>,
00392                                 <span class="stringliteral">"winsrv!NumberOfConsoleHandles"</span>);
00393             <a class="code" href="../../d7/d4/conexts_8c.html#a4">moveExpressionValuePtr</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>,
00394                                 <span class="stringliteral">"winsrv!ConsoleHandles"</span>);
00395             fPrintLine = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00396             <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>; i++) {
00397                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pConsole, <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>);
00398                 <span class="keywordflow">if</span> (pConsole != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00399                     <span class="keywordflow">if</span> (fPrintLine)
00400                         Print(<span class="stringliteral">"==========================================\n"</span>);
00401                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%c %c %c %p"</span>, chVerbose, chShowFlags, chHistory, pConsole);
00402                     <a class="code" href="../../d7/d4/conexts_8c.html#a25">dc</a>(hCurrentProcess, hCurrentThread, dwCurrentPc, lpExtensionApis, ach);
00403                     fPrintLine = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00404                 }
00405                 <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>++;
00406             }
00407             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00408 
00409         <span class="keywordflow">default</span>:
00410             pConsole = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)EvalExpression(lpArgString);
00411             <span class="keywordflow">break</span>;
00412         }
00413         lpArgString++;
00414 
00415     } <span class="keywordflow">while</span> (pConsole == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00416 
00417     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Console, pConsole);
00418 
00419     <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(hCurrentProcess,
00420                        lpExtensionApis,
00421                        Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
00422                        Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>,
00423                        ach,
00424                        <span class="keyword">sizeof</span>(ach));
00425     Print(<span class="stringliteral">"PCONSOLE @ 0x%lX   \"%s\"\n"</span>, pConsole, ach);
00426 
00427     <span class="keywordflow">if</span> (chHistory == <span class="charliteral">'h'</span>) {
00428         PLIST_ENTRY ListHead, ListNext;
00429         LIST_ENTRY ListEntry;
00430         <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
00431 
00432         ListHead = &amp;(pConsole-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o20">CommandHistoryList</a>);
00433         ListNext = Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o20">CommandHistoryList</a>.Flink;
00434         <span class="keywordflow">while</span> (ListNext != ListHead) {
00435             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
00436             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%p"</span>, <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>);
00437             <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>(hCurrentProcess, hCurrentThread, dwCurrentPc,
00438                     lpExtensionApis, ach);
00439             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ListEntry, ListNext);
00440             ListNext = ListEntry.Flink;
00441             Print(<span class="stringliteral">"----\n"</span>);
00442         }
00443         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00444     }
00445 
00446     Print(<span class="stringliteral">"\t pConsoleLock           0x%08lX\n"</span>
00447           <span class="stringliteral">"\t RefCount               0x%04lX\n"</span>
00448           <span class="stringliteral">"\t WaitCount              0x%04lX\n"</span>
00449           <span class="stringliteral">"\t pInputBuffer           0x%08lX\n"</span>
00450           <span class="stringliteral">"\t pCurrentScreenBuffer   0x%08lX\n"</span>
00451           <span class="stringliteral">"\t pScreenBuffers         0x%08lX\n"</span>
00452           <span class="stringliteral">"\t hWnd                   0x%08lX\n"</span>
00453           <span class="stringliteral">"\t hDC                    0x%08lX\n"</span>
00454           <span class="stringliteral">"\t LastAttributes         0x%04lX\n"</span>,
00455           &amp;pConsole-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o0">ConsoleLock</a>,
00456           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o1">RefCount</a>,
00457           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o2">WaitCount</a>,
00458           &amp;pConsole-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>,
00459           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
00460           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o5">ScreenBuffers</a>,
00461           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,
00462           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>,
00463           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o33">LastAttributes</a>);
00464 
00465     Print(<span class="stringliteral">"\t Flags                  0x%08lX%s\n"</span>,
00466           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a>, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a7">GF_CONSOLE</a>, Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>));
00467     Print(<span class="stringliteral">"\t FullScreenFlags        0x%04lX%s\n"</span>,
00468           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a>,
00469           <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a9">GF_FULLSCREEN</a>, Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>));
00470     Print(<span class="stringliteral">"\t ConsoleHandle          0x%08lX\n"</span>
00471           <span class="stringliteral">"\t CtrlFlags              0x%08lX\n"</span>,
00472           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
00473           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o66">CtrlFlags</a>
00474           );
00475 
00476     <span class="keywordflow">if</span> (chVerbose == <span class="charliteral">'v'</span>) {
00477         Print(<span class="stringliteral">"\t hMenu                  0x%08lX\n"</span>
00478               <span class="stringliteral">"\t hHeirMenu              0x%08lX\n"</span>
00479               <span class="stringliteral">"\t hSysPalette            0x%08lX\n"</span>
00480               <span class="stringliteral">"\t WindowRect.L T R B     0x%08lX 0x%08lX 0x%08lX 0x%08lX\n"</span>
00481               <span class="stringliteral">"\t ResizeFlags            0x%08lX\n"</span>
00482               <span class="stringliteral">"\t OutputQueue.F B        0x%08lX 0x%08lX\n"</span>
00483               <span class="stringliteral">"\t InitEvents[]           0x%08lX 0x%08lX\n"</span>
00484               <span class="stringliteral">"\t ClientThreadHandle     0x%08lX\n"</span>
00485               <span class="stringliteral">"\t ProcessHandleList.F B  0x%08lX 0x%08lX\n"</span>
00486               <span class="stringliteral">"\t CommandHistoryList.F B 0x%08lX 0x%08lX\n"</span>
00487               <span class="stringliteral">"\t ExeAliasList.F B       0x%08lX 0x%08lX\n"</span>,
00488               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o11">hMenu</a>,
00489               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o12">hHeirMenu</a>,
00490               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o13">hSysPalette</a>,
00491               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.left,
00492               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.top,
00493               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.right,
00494               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.bottom,
00495               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o15">ResizeFlags</a>,
00496               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o16">OutputQueue</a>.Flink,
00497               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o16">OutputQueue</a>.Blink,
00498               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o17">InitEvents</a>[0],
00499               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o17">InitEvents</a>[1],
00500               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o18">ClientThreadHandle</a>,
00501               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o19">ProcessHandleList</a>.Flink,
00502               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o19">ProcessHandleList</a>.Blink,
00503               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o20">CommandHistoryList</a>.Flink,
00504               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o20">CommandHistoryList</a>.Blink,
00505               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o21">ExeAliasList</a>.Flink,
00506               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o21">ExeAliasList</a>.Blink
00507               );
00508         <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(hCurrentProcess,
00509                            lpExtensionApis,
00510                            Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o27">OriginalTitle</a>,
00511                            Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o25">OriginalTitleLength</a>,
00512                            ach,
00513                            <span class="keyword">sizeof</span>(ach)
00514                            );
00515         Print(<span class="stringliteral">"\t NumCommandHistories    0x%04lX\n"</span>
00516               <span class="stringliteral">"\t MaxCommandHistories    0x%04lX\n"</span>
00517               <span class="stringliteral">"\t CommandHistorySize     0x%04lX\n"</span>
00518               <span class="stringliteral">"\t OriginalTitleLength    0x%04lX\n"</span>
00519               <span class="stringliteral">"\t TitleLength            0x%04lX\n"</span>
00520               <span class="stringliteral">"\t OriginalTitle          %s\n"</span>
00521               <span class="stringliteral">"\t dwHotKey               0x%08lX\n"</span>
00522               <span class="stringliteral">"\t hIcon                  0x%08lX\n"</span>
00523               <span class="stringliteral">"\t iIcondId               0x%08lX\n"</span>
00524               <span class="stringliteral">"\t ReserveKeys            0x%02lX\n"</span>
00525               <span class="stringliteral">"\t WaitQueue              0x%08lX\n"</span>,
00526               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o22">NumCommandHistories</a>,
00527               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o23">MaxCommandHistories</a>,
00528               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o24">CommandHistorySize</a>,
00529               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o25">OriginalTitleLength</a>,
00530               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>,
00531               ach,
00532               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o29">dwHotKey</a>,
00533               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>,
00534               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o32">iIconId</a>,
00535               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o34">ReserveKeys</a>,
00536               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o36">WaitQueue</a>
00537               );
00538         Print(<span class="stringliteral">"\t SelectionFlags         0x%08lX%s\n"</span>
00539               <span class="stringliteral">"\t SelectionRect.L T R B  0x%04lX 0x%04lX 0x%04lX 0x%04lX\n"</span>
00540               <span class="stringliteral">"\t SelectionAnchor.X Y    0x%04lX 0x%04lX\n"</span>
00541               <span class="stringliteral">"\t TextCursorPosition.X Y 0x%04lX 0x%04lX\n"</span>
00542               <span class="stringliteral">"\t TextCursorSize         0x%08lX\n"</span>
00543               <span class="stringliteral">"\t TextCursorVisible      0x%02lX\n"</span>
00544               <span class="stringliteral">"\t InsertMode             0x%02lX\n"</span>
00545               <span class="stringliteral">"\t wShowWindow            0x%04lX\n"</span>
00546               <span class="stringliteral">"\t dwWindowOriginX        0x%08lX\n"</span>
00547               <span class="stringliteral">"\t dwWindowOriginY        0x%08lX\n"</span>
00548               <span class="stringliteral">"\t PopupCount             0x%04lX\n"</span>,
00549               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o37">SelectionFlags</a>,
00550               <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a8">GF_CONSOLESEL</a>, Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o37">SelectionFlags</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>),
00551               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Left,
00552               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Top,
00553               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Right,
00554               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Bottom,
00555               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a>.X,
00556               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a>.Y,
00557               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o40">TextCursorPosition</a>.X,
00558               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o40">TextCursorPosition</a>.Y,
00559               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o41">TextCursorSize</a>,
00560               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o42">TextCursorVisible</a>,
00561               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a>,
00562               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o44">wShowWindow</a>,
00563               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o45">dwWindowOriginX</a>,
00564               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o46">dwWindowOriginY</a>,
00565               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o48">PopupCount</a>
00566               );
00567         Print(<span class="stringliteral">"\t VDMStartHardwareEvent  0x%08lX\n"</span>
00568               <span class="stringliteral">"\t VDMEndHardwareEvent    0x%08lX\n"</span>
00569               <span class="stringliteral">"\t VDMProcessHandle       0x%08lX\n"</span>
00570               <span class="stringliteral">"\t VDMProcessId           0x%08lX\n"</span>
00571               <span class="stringliteral">"\t VDMBufferSectionHandle 0x%08lX\n"</span>
00572               <span class="stringliteral">"\t VDMBuffer              0x%08lX\n"</span>
00573               <span class="stringliteral">"\t VDMBufferClient        0x%08lX\n"</span>
00574               <span class="stringliteral">"\t VDMBufferSize.X Y      0x%04lX 0x%04lX\n"</span>
00575               <span class="stringliteral">"\t StateSectionHandle     0x%08lX\n"</span>
00576               <span class="stringliteral">"\t StateBuffer            0x%08lX\n"</span>
00577               <span class="stringliteral">"\t StateBufferClient      0x%08lX\n"</span>
00578               <span class="stringliteral">"\t StateLength            0x%08lX\n"</span>,
00579               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o49">VDMStartHardwareEvent</a>,
00580               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o50">VDMEndHardwareEvent</a>,
00581               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>,
00582               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a>,
00583               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o53">VDMBufferSectionHandle</a>,
00584               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a>,
00585               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o55">VDMBufferClient</a>,
00586               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o56">VDMBufferSize</a>.X,
00587               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o56">VDMBufferSize</a>.Y,
00588               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o57">StateSectionHandle</a>,
00589               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o58">StateBuffer</a>,
00590               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o59">StateBufferClient</a>,
00591               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o60">StateLength</a>
00592               );
00593         Print(<span class="stringliteral">"\t CP                     0x%08lX\n"</span>
00594               <span class="stringliteral">"\t OutputCP               0x%08lX\n"</span>
00595               <span class="stringliteral">"\t hWndProgMan            0x%08lX\n"</span>
00596               <span class="stringliteral">"\t bIconInit              0x%08lX\n"</span>
00597               <span class="stringliteral">"\t LimitingProcessId      0x%08lX\n"</span>
00598               <span class="stringliteral">"\t TerminationEvent       0x%08lX\n"</span>
00599               <span class="stringliteral">"\t VerticalClientToWin    0x%04lX\n"</span>
00600               <span class="stringliteral">"\t HorizontalClientToWin  0x%04lX\n"</span>,
00601               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00602               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,
00603               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a>,
00604               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o64">bIconInit</a>,
00605               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o67">LimitingProcessId</a>,
00606               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o68">TerminationEvent</a>,
00607               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o69">VerticalClientToWindow</a>,
00608               Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o70">HorizontalClientToWindow</a>
00609               );
00610 <span class="preprocessor">#if defined(FE_SB)</span>
00611 <span class="preprocessor"></span>        Print(<span class="stringliteral">"\t EudcInformation        0x%08lX\n"</span>
00612               <span class="stringliteral">"\t FontCacheInformation   0x%08lX\n"</span>,
00613               Console.EudcInformation,
00614               Console.FontCacheInformation
00615               );
00616 <span class="preprocessor">#if defined(FE_IME)</span>
00617 <span class="preprocessor"></span>        Print(<span class="stringliteral">"\tConsoleIme:\n"</span>
00618               <span class="stringliteral">"\t ScrollFlag             0x%08lX\n"</span>
00619               <span class="stringliteral">"\t ScrollWaitTimeout      0x%08lX\n"</span>
00620               <span class="stringliteral">"\t ScrollWaitCountDown    0x%08lX\n"</span>
00621               <span class="stringliteral">"\t CompStrData            0x%08lX\n"</span>
00622               <span class="stringliteral">"\t ConvAreaMode           0x%08lX\n"</span>
00623               <span class="stringliteral">"\t ConvAreaSystem         0x%08lX\n"</span>
00624               <span class="stringliteral">"\t NumberOfConvAreaCompStr 0x%08lX\n"</span>
00625               <span class="stringliteral">"\t ConvAreaCompStr         0x%08lX\n"</span>
00626               <span class="stringliteral">"\t ConvAreaRoot           0x%08lX\n"</span>,
00627               Console.ConsoleIme.ScrollFlag,
00628               Console.ConsoleIme.ScrollWaitTimeout,
00629               Console.ConsoleIme.ScrollWaitCountDown,
00630               Console.ConsoleIme.CompStrData,
00631               Console.ConsoleIme.ConvAreaMode,
00632               Console.ConsoleIme.ConvAreaSystem,
00633               Console.ConsoleIme.NumberOfConvAreaCompStr,
00634               Console.ConsoleIme.ConvAreaCompStr,
00635               Console.ConsoleIme.ConvAreaRoot
00636               );
00637 <span class="preprocessor">#endif</span>
00638 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00639 <span class="preprocessor"></span>    }
00640     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00641 }
00642 
00643 <span class="comment">/***************************************************************************\</span>
00644 <span class="comment">* dt - Dump Text - dump text buffer information</span>
00645 <span class="comment">*</span>
00646 <span class="comment">* dt address    - dumps text buffer information  for console at address</span>
00647 <span class="comment">*</span>
00648 <span class="comment">\***************************************************************************/</span>
00649 
<a name="l00650"></a><a class="code" href="../../d7/d4/conexts_8c.html#a26">00650</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>(
00651     HANDLE hCurrentProcess,
00652     HANDLE hCurrentThread,
00653     DWORD dwCurrentPc,
00654     PWINDBG_EXTENSION_APIS lpExtensionApis,
00655     LPSTR lpArgString)
00656 {
00657     PWINDBG_OUTPUT_ROUTINE Print;
00658     PWINDBG_GET_EXPRESSION EvalExpression;
00659     PWINDBG_GET_SYMBOL GetSymbol;
00660 
00661     <span class="keywordtype">char</span> ach[120];
00662     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fPrintLine;
00663     ULONG i, nLines;
00664     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> sh;
00665     ULONG <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>;
00666     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>;
00667     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">CONSOLE_INFORMATION</a> Console;
00668     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">SCREEN_INFORMATION</a> Screen;
00669     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> pConsole;
00670     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FrameBufPtr;
00671     <span class="keywordtype">char</span> chVerbose = <span class="charliteral">' '</span>;
00672     <span class="keywordtype">char</span> chShowFlags = <span class="charliteral">' '</span>;
00673     <span class="keywordtype">char</span> chCheck = <span class="charliteral">' '</span>;
00674     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> pRow;
00675 
00676     Print = lpExtensionApis-&gt;lpOutputRoutine;
00677     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
00678     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
00679 
00680 
00681     <span class="comment">/*</span>
00682 <span class="comment">     * Get arguments</span>
00683 <span class="comment">     */</span>
00684     pConsole = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00685     <span class="keywordflow">do</span> {
00686         <span class="comment">/*</span>
00687 <span class="comment">         * Skip white space</span>
00688 <span class="comment">         */</span>
00689         <span class="keywordflow">while</span> (*lpArgString &amp;&amp; *lpArgString == <span class="charliteral">' '</span>)
00690             lpArgString++;
00691 
00692         <span class="keywordflow">switch</span> (*lpArgString) {
00693         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00694             <a class="code" href="../../d7/d4/conexts_8c.html#a16">gbShowFlagNames</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00695             chShowFlags = <span class="charliteral">'f'</span>;
00696             <span class="keywordflow">break</span>;
00697 
00698         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00699             chCheck = <span class="charliteral">'c'</span>;
00700             <span class="keywordflow">break</span>;
00701 
00702         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00703             chVerbose = <span class="charliteral">'v'</span>;
00704             nLines = 0;
00705             lpArgString++;
00706             <span class="keywordflow">while</span> ((*lpArgString &gt;= <span class="charliteral">'0'</span>) &amp;&amp; (*lpArgString &lt;= <span class="charliteral">'9'</span>)) {
00707                 nLines *= 10;
00708                 nLines += *lpArgString - <span class="charliteral">'0'</span>;
00709                 lpArgString++;
00710             }
00711             lpArgString--;
00712             <span class="keywordflow">if</span> (nLines == 0) {
00713                 nLines = 10;
00714             }
00715             <span class="keywordflow">break</span>;
00716 
00717         <span class="keywordflow">case</span> <span class="charliteral">'\0'</span>:
00718             <span class="comment">/*</span>
00719 <span class="comment">             * If no console is specified, dt all of them</span>
00720 <span class="comment">             */</span>
00721             <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>,
00722                                 <span class="stringliteral">"winsrv!NumberOfConsoleHandles"</span>);
00723             <a class="code" href="../../d7/d4/conexts_8c.html#a4">moveExpressionValuePtr</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>,
00724                                 <span class="stringliteral">"winsrv!ConsoleHandles"</span>);
00725             fPrintLine = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00726             <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>; i++) {
00727                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pConsole, <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>);
00728                 <span class="keywordflow">if</span> (pConsole != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00729                     <span class="keywordflow">if</span> (fPrintLine)
00730                         Print(<span class="stringliteral">"==========================================\n"</span>);
00731                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%c %c %p"</span>, chVerbose, chShowFlags, pConsole);
00732                     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>(hCurrentProcess, hCurrentThread,
00733                                      dwCurrentPc, lpExtensionApis, ach)) {
00734                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00735                     }
00736                     fPrintLine = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00737                 }
00738                 <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>++;
00739             }
00740             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00741 
00742         <span class="keywordflow">default</span>:
00743             pConsole = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)EvalExpression(lpArgString);
00744             <span class="keywordflow">break</span>;
00745         }
00746         lpArgString++;
00747     } <span class="keywordflow">while</span> (pConsole == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00748 
00749     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Console, pConsole);
00750 
00751     Print(<span class="stringliteral">"PCONSOLE @ 0x%lX\n"</span>, pConsole);
00752     <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(hCurrentProcess,
00753                        lpExtensionApis,
00754                        Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
00755                        Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>,
00756                        ach,
00757                        <span class="keyword">sizeof</span>(ach));
00758     Print(<span class="stringliteral">"\t Title                %s\n"</span>
00759           <span class="stringliteral">"\t pCurrentScreenBuffer 0x%08lX\n"</span>
00760           <span class="stringliteral">"\t pScreenBuffers       0x%08lX\n"</span>
00761           <span class="stringliteral">"\t VDMBuffer            0x%08lx\n"</span>
00762           <span class="stringliteral">"\t CP %d,  OutputCP %d\n"</span>,
00763           ach,
00764           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
00765           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o5">ScreenBuffers</a>,
00766           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a>,
00767           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00768           Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>
00769           );
00770 
00771     <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(FrameBufPtr, <span class="stringliteral">"winsrv!FrameBufPtr"</span>);
00772     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Screen, Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>);
00773     <span class="keywordflow">if</span> (Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00774         Print(<span class="stringliteral">"\t TextInfo.Rows         0x%08X\n"</span>
00775               <span class="stringliteral">"\t TextInfo.TextRows     0x%08X\n"</span>
00776               <span class="stringliteral">"\t TextInfo.FirstRow     0x%08X\n"</span>
00777               <span class="stringliteral">"\t FrameBufPtr           0x%08X\n"</span>,
00778               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Rows,
00779               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.TextRows,
00780               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.FirstRow,
00781               FrameBufPtr);
00782     }
00783 
00784     pRow = Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Rows;
00785     <span class="keywordflow">if</span> (chCheck) {
00786         Print(<span class="stringliteral">"Checking BufferInfo...\n"</span>);
00787         <span class="keywordflow">for</span> (sh = 0; sh &lt; Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y; sh++) {
00788             <a class="code" href="../../d9/d4/struct__ROW.html">ROW</a> Row;
00789             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Row, pRow);
00790 
00791             <span class="comment">/*</span>
00792 <span class="comment">             * Check that Attrs points to the in-place AttrPair if there</span>
00793 <span class="comment">             * if only one AttrPair for this Row.</span>
00794 <span class="comment">             */</span>
00795             <span class="keywordflow">if</span> (Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a> == 1) {
00796                 <span class="keywordflow">if</span> (Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a> != &amp;(pRow-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>)) {
00797                     Print(<span class="stringliteral">"Bad Row[%lx]:  Attrs %lx should be %lx\n"</span>,
00798                         sh, Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>, pRow-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>);
00799                 }
00800             }
00801 
00802             <span class="comment">/*</span>
00803 <span class="comment">             * Some other checks?</span>
00804 <span class="comment">             */</span>
00805 
00806             pRow++;
00807         }
00808         Print(<span class="stringliteral">"...check completed\n"</span>);
00809     }
00810 
00811     <span class="keywordflow">if</span> (chVerbose == <span class="charliteral">' '</span>) {
00812         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00813     }
00814 
00815     pRow = Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Rows;
00816     <span class="keywordflow">for</span> (i = 0; i &lt; nLines; i++) {
00817         <a class="code" href="../../d9/d4/struct__ROW.html">ROW</a> Row;
00818         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Row, pRow);
00819 
00820         <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(hCurrentProcess,
00821                            lpExtensionApis,
00822                            Row.<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>,
00823                            -1,
00824                            ach,
00825                            <span class="keyword">sizeof</span>(ach));
00826         Print(<span class="stringliteral">"Row %2d: %4x %4x, %4x %4x, %lx:\"%.40s\"\n"</span>,
00827             i,
00828             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o0">Right</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o1">OldRight</a>,
00829             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o3">OldLeft</a>,
00830             Row.<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>, ach);
00831         Print(<span class="stringliteral">"      %4x %4x,%04x or %lx\n"</span>,
00832             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a>,
00833             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>.<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a>,
00834             (WORD)Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>.<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a>,
00835             Row.<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>);
00836         pRow++;
00837     }
00838     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00839 }
00840 
00841 <span class="comment">/***************************************************************************\</span>
00842 <span class="comment">* df - Dump Font - dump Font information</span>
00843 <span class="comment">*</span>
00844 <span class="comment">* df address    - dumps simple info for console at address</span>
00845 <span class="comment">*                 (takes handle too)</span>
00846 <span class="comment">\***************************************************************************/</span>
00847 
<a name="l00848"></a><a class="code" href="../../d7/d4/conexts_8c.html#a27">00848</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a27">df</a>(
00849     HANDLE hCurrentProcess,
00850     HANDLE hCurrentThread,
00851     DWORD dwCurrentPc,
00852     PWINDBG_EXTENSION_APIS lpExtensionApis,
00853     LPSTR lpArgumentString)
00854 {
00855     PWINDBG_OUTPUT_ROUTINE Print;
00856     PWINDBG_GET_EXPRESSION EvalExpression;
00857     PWINDBG_GET_SYMBOL GetSymbol;
00858     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> Buff[<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/structtagFACENODE.html">FACENODE</a>) + (LF_FACESIZE * <span class="keyword">sizeof</span>(WCHAR))];
00859     <a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> pFN;
00860 
00861     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>;
00862     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a>;
00863     <a class="code" href="../../d5/d9/struct__FONT__INFO.html">FONT_INFO</a> <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>;
00864     <a class="code" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a> pFontInfo;
00865     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dw;
00866 
00867     UNREFERENCED_PARAMETER(hCurrentProcess);
00868     UNREFERENCED_PARAMETER(hCurrentThread);
00869     UNREFERENCED_PARAMETER(dwCurrentPc);
00870 
00871     Print = lpExtensionApis-&gt;lpOutputRoutine;
00872     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
00873     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
00874 
00875 
00876     <span class="comment">/*</span>
00877 <span class="comment">     * Skip space</span>
00878 <span class="comment">     */</span>
00879 
00880     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
00881         lpArgumentString++;
00882 
00883 
00884     Print(<span class="stringliteral">"Faces:\n"</span>);
00885     <a class="code" href="../../d7/d4/conexts_8c.html#a4">moveExpressionValuePtr</a>(pFN, <span class="stringliteral">"winsrv!gpFaceNames"</span>);
00886     <span class="keywordflow">while</span> (pFN != 0) {
00887         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Buff, pFN);
00888         pFN = (<a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a>)Buff;
00889         Print(<span class="stringliteral">" \"%ls\"\t%s %s %s %s %s %s\n"</span>,
00890               &amp;pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>[0],
00891               pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a50">EF_NEW</a>        ? <span class="stringliteral">"NEW"</span>        : <span class="stringliteral">"   "</span>,
00892               pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a51">EF_OLD</a>        ? <span class="stringliteral">"OLD"</span>        : <span class="stringliteral">"   "</span>,
00893               pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a52">EF_ENUMERATED</a> ? <span class="stringliteral">"ENUMERATED"</span> : <span class="stringliteral">"          "</span>,
00894               pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>    ? <span class="stringliteral">"OEMFONT"</span>    : <span class="stringliteral">"       "</span>,
00895               pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a54">EF_TTFONT</a>     ? <span class="stringliteral">"TTFONT"</span>     : <span class="stringliteral">"      "</span>,
00896               pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a>    ? <span class="stringliteral">"DEFFACE"</span>    : <span class="stringliteral">"       "</span>);
00897         pFN = pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o0">pNext</a>;
00898     }
00899 
00900     <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a>, <span class="stringliteral">"winsrv!FontInfoLength"</span>);
00901     <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>, <span class="stringliteral">"winsrv!NumberOfFonts"</span>);
00902     <a class="code" href="../../d7/d4/conexts_8c.html#a4">moveExpressionValuePtr</a>(pFontInfo, <span class="stringliteral">"winsrv!FontInfo"</span>);
00903 
00904     Print(<span class="stringliteral">"0x%lx fonts cached, 0x%lx allocated:\n"</span>, <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>, <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a>);
00905 
00906     <span class="keywordflow">for</span> (dw = 0; dw &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; dw++, pFontInfo++) {
00907         WCHAR FaceName[LF_FACESIZE];
00908         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>, pFontInfo);
00909         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(FaceName, <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o4">FaceName</a>);
00910         Print(<span class="stringliteral">"%04x hFont    0x%08lX \"%ls\"\n"</span>
00911               <span class="stringliteral">"     SizeWant (%d;%d)\n"</span>
00912               <span class="stringliteral">"     Size     (%d;%d)\n"</span>
00913               <span class="stringliteral">"     Family   %02X\n"</span>
00914               <span class="stringliteral">"     Weight   0x%08lX\n"</span>,
00915               dw,
00916               <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o0">hFont</a>,
00917               FaceName,
00918               <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.X, <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y,
00919               <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X, <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y,
00920               <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>,
00921               <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o3">Weight</a>);
00922 <span class="preprocessor">#if defined(FE_SB)</span>
00923 <span class="preprocessor"></span>        Print(<span class="stringliteral">"     CharSet  0x%02X\n"</span>,
00924               <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>.tmCharSet);
00925 <span class="preprocessor">#endif</span>
00926 <span class="preprocessor"></span>    }
00927 
00928     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00929 }
00930 
00931 <span class="comment">/***************************************************************************\</span>
00932 <span class="comment">* di - Dump Input - dump input buffer</span>
00933 <span class="comment">*</span>
00934 <span class="comment">* di address    - dumps simple info for input at address</span>
00935 <span class="comment">*</span>
00936 <span class="comment">\***************************************************************************/</span>
00937 
<a name="l00938"></a><a class="code" href="../../d7/d4/conexts_8c.html#a28">00938</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>(
00939     HANDLE hCurrentProcess,
00940     HANDLE hCurrentThread,
00941     DWORD dwCurrentPc,
00942     PWINDBG_EXTENSION_APIS lpExtensionApis,
00943     LPSTR lpArgumentString)
00944 {
00945     PWINDBG_OUTPUT_ROUTINE Print;
00946     PWINDBG_GET_EXPRESSION EvalExpression;
00947     PWINDBG_GET_SYMBOL GetSymbol;
00948 
00949     <a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html">INPUT_INFORMATION</a> Input;
00950     <a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> pInput;
00951 
00952     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> pConsole;
00953     ULONG <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>;
00954     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>;
00955     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fPrintLine;
00956     ULONG i;
00957     <span class="keywordtype">char</span> ach[120];
00958 
00959     Print = lpExtensionApis-&gt;lpOutputRoutine;
00960     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
00961     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
00962 
00963 
00964     <span class="comment">/*</span>
00965 <span class="comment">     * Skip with space</span>
00966 <span class="comment">     */</span>
00967 
00968     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
00969         lpArgumentString++;
00970 
00971     <span class="comment">/*</span>
00972 <span class="comment">     * If no INPUT_INFORMATION is specified, dt all of them</span>
00973 <span class="comment">     */</span>
00974     <span class="keywordflow">if</span> (*lpArgumentString == 0) {
00975         <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>,
00976                             <span class="stringliteral">"winsrv!NumberOfConsoleHandles"</span>);
00977         <a class="code" href="../../d7/d4/conexts_8c.html#a4">moveExpressionValuePtr</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>,
00978                             <span class="stringliteral">"winsrv!ConsoleHandles"</span>);
00979         fPrintLine = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00980         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>; i++) {
00981             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pConsole, <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>);
00982             <span class="keywordflow">if</span> (pConsole != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00983                 <span class="keywordflow">if</span> (fPrintLine)
00984                     Print(<span class="stringliteral">"---\n"</span>);
00985                 pInput = &amp;pConsole-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>;
00986 <span class="preprocessor">#ifdef _WIN64</span>
00987 <span class="preprocessor"></span>                _i64toa((ULONG64)pInput, ach, 16);
00988 <span class="preprocessor">#else</span>
00989 <span class="preprocessor"></span>                _itoa((ULONG)pInput, ach, 16);
00990 <span class="preprocessor">#endif</span>
00991 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>(hCurrentProcess, hCurrentThread, dwCurrentPc, lpExtensionApis, ach)) {
00992                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00993                 }
00994                 fPrintLine = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00995             }
00996             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>++;
00997         }
00998         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00999     } <span class="keywordflow">else</span> {
01000         pInput = (<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>)EvalExpression(lpArgumentString);
01001     }
01002 
01003     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Input, pInput);
01004 
01005     Print(<span class="stringliteral">"PINPUT @ 0x%lX\n"</span>, pInput);
01006     Print(<span class="stringliteral">"\t pInputBuffer         0x%08lX\n"</span>
01007           <span class="stringliteral">"\t InputBufferSize      0x%08lX\n"</span>
01008           <span class="stringliteral">"\t AllocatedBufferSize  0x%08lX\n"</span>
01009           <span class="stringliteral">"\t InputMode            0x%08lX\n"</span>
01010           <span class="stringliteral">"\t RefCount             0x%08lX\n"</span>
01011           <span class="stringliteral">"\t First                0x%08lX\n"</span>
01012           <span class="stringliteral">"\t In                   0x%08lX\n"</span>
01013           <span class="stringliteral">"\t Out                  0x%08lX\n"</span>
01014           <span class="stringliteral">"\t Last                 0x%08lX\n"</span>
01015           <span class="stringliteral">"\t ReadWaitQueue.Flink  0x%08lX\n"</span>
01016           <span class="stringliteral">"\t ReadWaitQueue.Blink  0x%08lX\n"</span>
01017           <span class="stringliteral">"\t InputWaitEvent       0x%08lX\n"</span>,
01018           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o0">InputBuffer</a>,
01019           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o1">InputBufferSize</a>,
01020           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o3">AllocatedBufferSize</a>,
01021           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a>,
01022           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o5">RefCount</a>,
01023           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o6">First</a>,
01024           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o7">In</a>,
01025           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o8">Out</a>,
01026           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o9">Last</a>,
01027           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o10">ReadWaitQueue</a>.Flink,
01028           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o10">ReadWaitQueue</a>.Blink,
01029           Input.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o11">InputWaitEvent</a>
01030           );
01031 
01032     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01033 }
01034 <span class="comment">/***************************************************************************\</span>
01035 <span class="comment">* dir - Dump Input Record - dump input buffer</span>
01036 <span class="comment">*</span>
01037 <span class="comment">* dir address number    - dumps simple info for input at address</span>
01038 <span class="comment">*</span>
01039 <span class="comment">\***************************************************************************/</span>
01040 
<a name="l01041"></a><a class="code" href="../../d7/d4/conexts_8c.html#a29">01041</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a29">dir</a>(
01042     HANDLE hCurrentProcess,
01043     HANDLE hCurrentThread,
01044     DWORD dwCurrentPc,
01045     PWINDBG_EXTENSION_APIS lpExtensionApis,
01046     LPSTR lpArgumentString)
01047 {
01048     PWINDBG_OUTPUT_ROUTINE Print;
01049     PWINDBG_GET_EXPRESSION EvalExpression;
01050     PWINDBG_GET_SYMBOL GetSymbol;
01051 
01052     INPUT_RECORD InputRecord;
01053     PINPUT_RECORD pInputRecord;
01054 
01055     <span class="keywordtype">char</span> ach[80];
01056     <span class="keywordtype">int</span> cch;
01057     LPSTR lpAddress;
01058     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumRecords,i;
01059 
01060     UNREFERENCED_PARAMETER(hCurrentProcess);
01061     UNREFERENCED_PARAMETER(hCurrentThread);
01062     UNREFERENCED_PARAMETER(dwCurrentPc);
01063 
01064     Print = lpExtensionApis-&gt;lpOutputRoutine;
01065     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
01066     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
01067 
01068 
01069     <span class="comment">/*</span>
01070 <span class="comment">     * Skip with space</span>
01071 <span class="comment">     */</span>
01072 
01073     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
01074         lpArgumentString++;
01075 
01076     lpAddress = lpArgumentString;
01077     <span class="keywordflow">while</span> (*lpArgumentString != <span class="charliteral">' '</span> &amp;&amp; *lpArgumentString != 0)
01078         lpArgumentString++;
01079 
01080     cch = (<span class="keywordtype">int</span>)(lpArgumentString - lpAddress);
01081     <span class="keywordflow">if</span> (cch &gt; 79)
01082         cch = 79;
01083 
01084     strncpy(ach, lpAddress, cch);
01085 
01086     pInputRecord = (PINPUT_RECORD)EvalExpression(lpAddress);
01087     NumRecords = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)EvalExpression(lpArgumentString);
01088 
01089     Print(<span class="stringliteral">"%x PINPUTRECORDs @ 0x%lX\n"</span>, NumRecords, pInputRecord);
01090     <span class="keywordflow">for</span> (i=0;i&lt;NumRecords;i++) {
01091         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(InputRecord, pInputRecord);
01092 
01093         <span class="keywordflow">switch</span> (InputRecord.EventType) {
01094             <span class="keywordflow">case</span> KEY_EVENT:
01095                 Print(<span class="stringliteral">"\t KEY_EVENT\n"</span>);
01096                 <span class="keywordflow">if</span> (InputRecord.Event.KeyEvent.bKeyDown)
01097                     Print(<span class="stringliteral">"\t  KeyDown\n"</span>);
01098                 <span class="keywordflow">else</span>
01099                     Print(<span class="stringliteral">"\t  KeyUp\n"</span>);
01100                 Print(<span class="stringliteral">"\t  wRepeatCount %d\n"</span>,
01101                       InputRecord.Event.KeyEvent.wRepeatCount);
01102                 Print(<span class="stringliteral">"\t  wVirtualKeyCode %x\n"</span>,
01103                       InputRecord.Event.KeyEvent.wVirtualKeyCode);
01104                 Print(<span class="stringliteral">"\t  wVirtualScanCode %x\n"</span>,
01105                       InputRecord.Event.KeyEvent.wVirtualScanCode);
01106                 Print(<span class="stringliteral">"\t  aChar is %c"</span>,
01107                       InputRecord.Event.KeyEvent.uChar.AsciiChar);
01108                 Print(<span class="stringliteral">"\n"</span>);
01109                 Print(<span class="stringliteral">"\t  uChar is %x\n"</span>,
01110                       InputRecord.Event.KeyEvent.uChar.UnicodeChar);
01111                 Print(<span class="stringliteral">"\t  dwControlKeyState %x\n"</span>,
01112                       InputRecord.Event.KeyEvent.dwControlKeyState);
01113                 <span class="keywordflow">break</span>;
01114             <span class="keywordflow">case</span> MOUSE_EVENT:
01115                 Print(<span class="stringliteral">"\t MOUSE_EVENT\n"</span>
01116                       <span class="stringliteral">"\t   dwMousePosition %x %x\n"</span>
01117                       <span class="stringliteral">"\t   dwButtonState %x\n"</span>
01118                       <span class="stringliteral">"\t   dwControlKeyState %x\n"</span>
01119                       <span class="stringliteral">"\t   dwEventFlags %x\n"</span>,
01120                       InputRecord.Event.MouseEvent.dwMousePosition.X,
01121                       InputRecord.Event.MouseEvent.dwMousePosition.Y,
01122                       InputRecord.Event.MouseEvent.dwButtonState,
01123                       InputRecord.Event.MouseEvent.dwControlKeyState,
01124                       InputRecord.Event.MouseEvent.dwEventFlags
01125                      );
01126 
01127                 <span class="keywordflow">break</span>;
01128             <span class="keywordflow">case</span> WINDOW_BUFFER_SIZE_EVENT:
01129                 Print(<span class="stringliteral">"\t WINDOW_BUFFER_SIZE_EVENT\n"</span>
01130                       <span class="stringliteral">"\t   dwSize %x %x\n"</span>,
01131                       InputRecord.Event.WindowBufferSizeEvent.dwSize.X,
01132                       InputRecord.Event.WindowBufferSizeEvent.dwSize.Y
01133                      );
01134                 <span class="keywordflow">break</span>;
01135             <span class="keywordflow">case</span> MENU_EVENT:
01136                 Print(<span class="stringliteral">"\t MENU_EVENT\n"</span>
01137                       <span class="stringliteral">"\t   dwCommandId %x\n"</span>,
01138                       InputRecord.Event.MenuEvent.dwCommandId
01139                      );
01140                 <span class="keywordflow">break</span>;
01141             <span class="keywordflow">case</span> FOCUS_EVENT:
01142                 Print(<span class="stringliteral">"\t FOCUS_EVENT\n"</span>);
01143                 <span class="keywordflow">if</span> (InputRecord.Event.FocusEvent.bSetFocus)
01144                     Print(<span class="stringliteral">"\t bSetFocus is TRUE\n"</span>);
01145                 <span class="keywordflow">else</span>
01146                     Print(<span class="stringliteral">"\t bSetFocus is FALSE\n"</span>);
01147                 <span class="keywordflow">break</span>;
01148             <span class="keywordflow">default</span>:
01149                 Print(<span class="stringliteral">"\t Unknown event type %x\n"</span>,InputRecord.EventType);
01150                 <span class="keywordflow">break</span>;
01151         }
01152         pInputRecord++;
01153     }
01154     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01155 }
01156 
01157 <span class="comment">/***************************************************************************\</span>
01158 <span class="comment">* ds - Dump Screen - dump SCREEN_INFORMATION struct</span>
01159 <span class="comment">*</span>
01160 <span class="comment">* ds address    - dumps simple info for input at address</span>
01161 <span class="comment">*</span>
01162 <span class="comment">\***************************************************************************/</span>
01163 
<a name="l01164"></a><a class="code" href="../../d7/d4/conexts_8c.html#a30">01164</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a30">ds</a>(
01165     HANDLE hCurrentProcess,
01166     HANDLE hCurrentThread,
01167     DWORD dwCurrentPc,
01168     PWINDBG_EXTENSION_APIS lpExtensionApis,
01169     LPSTR lpArgumentString)
01170 {
01171     PWINDBG_OUTPUT_ROUTINE Print;
01172     PWINDBG_GET_EXPRESSION EvalExpression;
01173     PWINDBG_GET_SYMBOL GetSymbol;
01174 
01175     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">SCREEN_INFORMATION</a> Screen;
01176     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen;
01177 
01178     UNREFERENCED_PARAMETER(hCurrentProcess);
01179     UNREFERENCED_PARAMETER(hCurrentThread);
01180     UNREFERENCED_PARAMETER(dwCurrentPc);
01181 
01182     Print = lpExtensionApis-&gt;lpOutputRoutine;
01183     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
01184     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
01185 
01186 
01187     <span class="comment">/*</span>
01188 <span class="comment">     * Skip with space</span>
01189 <span class="comment">     */</span>
01190 
01191     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
01192         lpArgumentString++;
01193 
01194 
01195     pScreen = (<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>)EvalExpression(lpArgumentString);
01196     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Screen, pScreen);
01197 
01198     Print(<span class="stringliteral">"PSCREEN @ 0x%lX\n"</span>, pScreen);
01199     Print(<span class="stringliteral">"\t pConsole             0x%08lX\n"</span>
01200           <span class="stringliteral">"\t Flags                0x%08lX %s | %s\n"</span>
01201           <span class="stringliteral">"\t OutputMode           0x%08lX\n"</span>
01202           <span class="stringliteral">"\t RefCount             0x%08lX\n"</span>
01203           <span class="stringliteral">"\t ScreenBufferSize.X Y 0x%08X 0x%08X\n"</span>
01204           <span class="stringliteral">"\t Window.L T R B       0x%08X 0x%08X 0x%08X 0x%08X\n"</span>
01205           <span class="stringliteral">"\t ResizingWindow       0x%08X\n"</span>,
01206           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>,
01207           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a>,
01208           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a> ? <span class="stringliteral">"TEXTMODE"</span> : <span class="stringliteral">"GRAPHICS"</span>,
01209           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a> ? <span class="stringliteral">"OEMFONT"</span> : <span class="stringliteral">"TT FONT"</span>,
01210           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o2">OutputMode</a>,
01211           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o3">RefCount</a>,
01212           (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X,
01213           (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y,
01214           (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left,
01215           (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top,
01216           (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right,
01217           (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom,
01218           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o7">ResizingWindow</a>
01219           );
01220     Print(<span class="stringliteral">"\t Attributes           0x%08X\n"</span>
01221           <span class="stringliteral">"\t PopupAttributes      0x%08X\n"</span>
01222           <span class="stringliteral">"\t WindowMaximizedX     0x%08X\n"</span>
01223           <span class="stringliteral">"\t WindowMaximizedY     0x%08X\n"</span>
01224           <span class="stringliteral">"\t WindowMaximized      0x%08X\n"</span>
01225           <span class="stringliteral">"\t CommandIdLow High    0x%08X 0x%08X\n"</span>
01226           <span class="stringliteral">"\t CursorHandle         0x%08X\n"</span>
01227           <span class="stringliteral">"\t hPalette             0x%08X\n"</span>
01228           <span class="stringliteral">"\t dwUsage              0x%08X\n"</span>
01229           <span class="stringliteral">"\t CursorDisplayCount   0x%08X\n"</span>
01230           <span class="stringliteral">"\t WheelDelta           0x%08X\n"</span>,
01231           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>,
01232           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o9">PopupAttributes</a>,
01233           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o10">WindowMaximizedX</a>,
01234           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o11">WindowMaximizedY</a>,
01235           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o12">WindowMaximized</a>,
01236           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o13">CommandIdLow</a>,
01237           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o14">CommandIdHigh</a>,
01238           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o15">CursorHandle</a>,
01239           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>,
01240           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o17">dwUsage</a>,
01241           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o18">CursorDisplayCount</a>,
01242           Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o19">WheelDelta</a>
01243           );
01244     <span class="keywordflow">if</span> (Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01245         Print(<span class="stringliteral">"\t TextInfo.Rows         0x%08X\n"</span>
01246               <span class="stringliteral">"\t TextInfo.TextRows     0x%08X\n"</span>
01247               <span class="stringliteral">"\t TextInfo.FirstRow     0x%08X\n"</span>,
01248               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Rows,
01249               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.TextRows,
01250               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.FirstRow);
01251 
01252         Print(<span class="stringliteral">"\t TextInfo.CurrentTextBufferFont.FontSize       0x%04X,0x%04X\n"</span>
01253               <span class="stringliteral">"\t TextInfo.CurrentTextBufferFont.FontNumber     0x%08X\n"</span>,
01254               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontSize.X,
01255               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontSize.Y,
01256               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontNumber);
01257 
01258         Print(<span class="stringliteral">"\t TextInfo.CurrentTextBufferFont.Family, Weight 0x%08X, 0x%08X\n"</span>
01259               <span class="stringliteral">"\t TextInfo.CurrentTextBufferFont.FaceName       %ls\n"</span>
01260               <span class="stringliteral">"\t TextInfo.CurrentTextBufferFont.FontCodePage   %d\n"</span>,
01261               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.Family,
01262               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.Weight,
01263               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FaceName,
01264               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontCodePage);
01265 
01266         <span class="keywordflow">if</span> (Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ListOfTextBufferFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01267             <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> pLinkFont;
01268             <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">TEXT_BUFFER_FONT_INFO</a>  LinkFont;
01269             ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0;
01270 
01271             pLinkFont = Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ListOfTextBufferFont;
01272 
01273             <span class="keywordflow">while</span> (pLinkFont != 0) {
01274                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(LinkFont, pLinkFont);
01275 
01276                 Print(<span class="stringliteral">"\t Link Font #%d\n"</span>, <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++);
01277                 Print(<span class="stringliteral">"\t  TextInfo.LinkOfTextBufferFont.FontSize       0x%04X,0x%04X\n"</span>
01278                       <span class="stringliteral">"\t  TextInfo.LinkOfTextBufferFont.FontNumber     0x%08X\n"</span>,
01279                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o1">FontSize</a>.X,
01280                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o1">FontSize</a>.Y,
01281                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o2">FontNumber</a>);
01282 
01283                 Print(<span class="stringliteral">"\t  TextInfo.LinkOfTextBufferFont.Family, Weight 0x%08X, 0x%08X\n"</span>
01284                       <span class="stringliteral">"\t  TextInfo.LinkOfTextBufferFont.FaceName       %ls\n"</span>
01285                       <span class="stringliteral">"\t  TextInfo.LinkOfTextBufferFont.FontCodePage   %d\n"</span>,
01286                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o5">Family</a>,
01287                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o4">Weight</a>,
01288                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o3">FaceName</a>,
01289                       LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a>);
01290 
01291                 pLinkFont = LinkFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
01292             }
01293             Print(<span class="stringliteral">"\n"</span>);
01294         }
01295 
01296         Print(<span class="stringliteral">"\t TextInfo.ModeIndex         0x%08X\n"</span>
01297 #ifdef i386
01298               <span class="stringliteral">"\t TextInfo.WindowedWindowSize.X Y 0x%08X 0x%08X\n"</span>
01299               <span class="stringliteral">"\t TextInfo.WindowedScreenSize.X Y 0x%08X 0x%08X\n"</span>
01300               <span class="stringliteral">"\t TextInfo.MousePosition.X Y 0x%08X 0x%08X\n"</span>
01301 #endif
01302               <span class="stringliteral">"\t TextInfo.Flags             0x%08X\n"</span>,
01303 
01304               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex,
01305 #ifdef i386
01306               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedWindowSize.X,
01307               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedWindowSize.Y,
01308               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedScreenSize.X,
01309               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedScreenSize.Y,
01310               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.MousePosition.X,
01311               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.MousePosition.Y,
01312 #endif
01313               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Flags);
01314 
01315         Print(<span class="stringliteral">"\t TextInfo.CursorVisible        0x%08X\n"</span>
01316               <span class="stringliteral">"\t TextInfo.CursorOn             0x%08X\n"</span>
01317               <span class="stringliteral">"\t TextInfo.DelayCursor          0x%08X\n"</span>
01318               <span class="stringliteral">"\t TextInfo.CursorPosition.X Y   0x%08X 0x%08X\n"</span>
01319               <span class="stringliteral">"\t TextInfo.CursorSize           0x%08X\n"</span>
01320               <span class="stringliteral">"\t TextInfo.CursorYSize          0x%08X\n"</span>
01321               <span class="stringliteral">"\t TextInfo.UpdatingScreen       0x%08X\n"</span>,
01322               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorVisible,
01323               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorOn,
01324               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.DelayCursor,
01325               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X,
01326               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y,
01327               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorSize,
01328               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorYSize,
01329               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.UpdatingScreen);
01330 
01331     } <span class="keywordflow">else</span> {
01332         Print(<span class="stringliteral">"\t GraphicsInfo.BitMapInfoLength 0x%08X\n"</span>
01333               <span class="stringliteral">"\t GraphicsInfo.lpBitMapInfo     0x%08X\n"</span>
01334               <span class="stringliteral">"\t GraphicsInfo.BitMap           0x%08X\n"</span>
01335               <span class="stringliteral">"\t GraphicsInfo.ClientBitMap     0x%08X\n"</span>
01336               <span class="stringliteral">"\t GraphicsInfo.ClientProcess    0x%08X\n"</span>
01337               <span class="stringliteral">"\t GraphicsInfo.hMutex           0x%08X\n"</span>
01338               <span class="stringliteral">"\t GraphicsInfo.hSection         0x%08X\n"</span>
01339               <span class="stringliteral">"\t GraphicsInfo.dwUsage          0x%08X\n"</span>,
01340               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMapInfoLength,
01341               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
01342               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
01343               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.ClientBitMap,
01344               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.ClientProcess,
01345               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex,
01346               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hSection,
01347               Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage
01348         );
01349     }
01350 
01351     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01352 }
01353 
01354 <span class="comment">/***************************************************************************\</span>
01355 <span class="comment">* dcpt - Dump CPTABLEINFO</span>
01356 <span class="comment">*</span>
01357 <span class="comment">* dcpt address    - dumps CPTABLEINFO at address</span>
01358 <span class="comment">* dcpt            - dumps CPTABLEINFO at GlyphCP</span>
01359 <span class="comment">*</span>
01360 <span class="comment">\***************************************************************************/</span>
01361 
<a name="l01362"></a><a class="code" href="../../d7/d4/conexts_8c.html#a31">01362</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a31">dcpt</a>(
01363     HANDLE hCurrentProcess,
01364     HANDLE hCurrentThread,
01365     DWORD dwCurrentPc,
01366     PWINDBG_EXTENSION_APIS lpExtensionApis,
01367     LPSTR lpArgumentString)
01368 {
01369     PWINDBG_OUTPUT_ROUTINE Print;
01370     PWINDBG_GET_EXPRESSION EvalExpression;
01371     PWINDBG_GET_SYMBOL GetSymbol;
01372 
01373     PCPTABLEINFO pcpt;
01374     CPTABLEINFO cpt;
01375 
01376     UNREFERENCED_PARAMETER(hCurrentProcess);
01377     UNREFERENCED_PARAMETER(hCurrentThread);
01378     UNREFERENCED_PARAMETER(dwCurrentPc);
01379 
01380     Print = lpExtensionApis-&gt;lpOutputRoutine;
01381     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
01382     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
01383 
01384 
01385     <span class="comment">/*</span>
01386 <span class="comment">     * Skip with space</span>
01387 <span class="comment">     */</span>
01388 
01389     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
01390         lpArgumentString++;
01391 
01392     <span class="comment">/*</span>
01393 <span class="comment">     * If no CPTABLEINFO is specified, use the GlyphCP</span>
01394 <span class="comment">     */</span>
01395     <span class="keywordflow">if</span> (*lpArgumentString == 0) {
01396         lpArgumentString = <span class="stringliteral">"winsrv!GlyphCP"</span>;
01397     }
01398     pcpt = (PCPTABLEINFO)EvalExpression(lpArgumentString);
01399     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cpt, pcpt);
01400 
01401     Print(<span class="stringliteral">"CPTABLEINFO @ 0x%lX\n"</span>, pcpt);
01402 
01403     Print(<span class="stringliteral">"  CodePage = 0x%x (%d)\n"</span>
01404           <span class="stringliteral">"  MaximumCharacterSize = %x\n"</span>
01405           <span class="stringliteral">"  DefaultChar = %x\n"</span>,
01406           cpt.CodePage, cpt.CodePage,
01407           cpt.MaximumCharacterSize,
01408           cpt.DefaultChar);
01409 
01410     Print(<span class="stringliteral">"  UniDefaultChar = 0x%04x\n"</span>
01411           <span class="stringliteral">"  TransDefaultChar = %x\n"</span>
01412           <span class="stringliteral">"  TransUniDefaultChar = 0x%04x\n"</span>
01413           <span class="stringliteral">"  DBCSCodePage = 0x%x (%d)\n"</span>,
01414           cpt.UniDefaultChar,
01415           cpt.TransDefaultChar,
01416           cpt.TransUniDefaultChar,
01417           cpt.DBCSCodePage, cpt.DBCSCodePage);
01418 
01419     Print(<span class="stringliteral">"  LeadByte[MAXIMUM_LEADBYTES] = %04x,%04x,%04x,...\n"</span>
01420           <span class="stringliteral">"  MultiByteTable = %x\n"</span>
01421           <span class="stringliteral">"  WideCharTable = %lx\n"</span>
01422           <span class="stringliteral">"  DBCSRanges = %lx\n"</span>
01423           <span class="stringliteral">"  DBCSOffsets = %lx\n"</span>,
01424           cpt.LeadByte[0], cpt.LeadByte[1], cpt.LeadByte[2],
01425           cpt.MultiByteTable,
01426           cpt.WideCharTable,
01427           cpt.DBCSRanges,
01428           cpt.DBCSOffsets);
01429 
01430     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01431 }
01432 
01433 <span class="comment">/***************************************************************************\</span>
01434 <span class="comment">* dch  - Dump Command History</span>
01435 <span class="comment">*</span>
01436 <span class="comment">* dch address    - dumps COMMAND_HISTORY at address</span>
01437 <span class="comment">* dch            - dumps some random COMMAND_HISTORY</span>
01438 <span class="comment">*</span>
01439 <span class="comment">\***************************************************************************/</span>
01440 
<a name="l01441"></a><a class="code" href="../../d7/d4/conexts_8c.html#a24">01441</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>(
01442     HANDLE hCurrentProcess,
01443     HANDLE hCurrentThread,
01444     DWORD dwCurrentPc,
01445     PWINDBG_EXTENSION_APIS lpExtensionApis,
01446     LPSTR lpArgumentString)
01447 {
01448     PWINDBG_OUTPUT_ROUTINE Print;
01449     PWINDBG_GET_EXPRESSION EvalExpression;
01450     PWINDBG_GET_SYMBOL GetSymbol;
01451 
01452     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> pCmdHist;
01453     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a> CmdHist;
01454     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> pCmd;
01455     <span class="keyword">union </span>{
01456         <a class="code" href="../../d8/d7/struct__COMMAND.html">COMMAND</a> Cmd;
01457         WCHAR awch[80];
01458     } DbgCmd;
01459 
01460     <span class="keywordtype">int</span> i;
01461     <span class="keywordtype">char</span> ach[120];
01462 
01463     UNREFERENCED_PARAMETER(hCurrentThread);
01464     UNREFERENCED_PARAMETER(dwCurrentPc);
01465 
01466     Print = lpExtensionApis-&gt;lpOutputRoutine;
01467     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
01468     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
01469 
01470     <span class="comment">/*</span>
01471 <span class="comment">     * Skip spaces</span>
01472 <span class="comment">     */</span>
01473     <span class="keywordflow">while</span> (*lpArgumentString == <span class="charliteral">' '</span>)
01474         lpArgumentString++;
01475 
01476     <span class="comment">/*</span>
01477 <span class="comment">     * If no COMMAND_HISTORY is specified, use something ????</span>
01478 <span class="comment">     */</span>
01479     <span class="keywordflow">if</span> (*lpArgumentString == 0) {
01480         Print(<span class="stringliteral">"must specify address of COMMAND_HISTORY struct\n"</span>);
01481         Print(<span class="stringliteral">"(a breakpoint on winsrv!AddCommand() may help)\n"</span>);
01482         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01483     }
01484 
01485     pCmdHist = (<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>)EvalExpression(lpArgumentString);
01486     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(CmdHist, pCmdHist);
01487 
01488     Print(<span class="stringliteral">"COMMAND_HISTORY @ 0x%lX\n"</span>, pCmdHist);
01489 
01490     Print(<span class="stringliteral">"  Flags            = 0x%08lX%s\n"</span>,
01491           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o0">Flags</a>,  <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a10">GF_CMDHIST</a>, CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o0">Flags</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>));
01492     Print(<span class="stringliteral">"  ListLink.F B     = 0x%08lX 0x%08lX\n"</span>,
01493           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o1">ListLink</a>.Flink, CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o1">ListLink</a>.Blink);
01494 
01495     <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(hCurrentProcess,
01496                        lpExtensionApis,
01497                        CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o2">AppName</a>,
01498                        -1,
01499                        ach,
01500                        <span class="keyword">sizeof</span>(ach));
01501     Print(<span class="stringliteral">"  AppName          = %s\n"</span>, ach);
01502 
01503     Print(<span class="stringliteral">"  NumberOfCommands = 0x%lx\n"</span>
01504           <span class="stringliteral">"  LastAdded        = 0x%lx\n"</span>
01505           <span class="stringliteral">"  LastDisplayed    = 0x%lx\n"</span>
01506           <span class="stringliteral">"  FirstCommand     = 0x%lx\n"</span>
01507           <span class="stringliteral">"  MaximumNumberOfCommands = 0x%lx\n"</span>,
01508           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>,
01509           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o4">LastAdded</a>,
01510           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o5">LastDisplayed</a>,
01511           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o6">FirstCommand</a>,
01512           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o7">MaximumNumberOfCommands</a>);
01513 
01514     Print(<span class="stringliteral">"  ProcessHandle    = 0x%08lX\n"</span>,
01515           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o8">ProcessHandle</a>);
01516 
01517     Print(<span class="stringliteral">"  PopupList.F B    = 0x%08lX 0x%08lX\n"</span>,
01518           CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Blink);
01519 
01520     <span class="keywordflow">for</span> (i = 0; i &lt; CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>; i++) {
01521         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pCmd, &amp;(pCmdHist-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]));
01522 
01523         <span class="comment">// first get the count of bytes in the string...</span>
01524         <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(DbgCmd, pCmd, <span class="keyword">sizeof</span>(DbgCmd.Cmd.CommandLength));
01525 
01526         <span class="comment">// ...then get the string (and the count of bytes again)</span>
01527         <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(DbgCmd, pCmd,
01528                 DbgCmd.Cmd.<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a> + <span class="keyword">sizeof</span>(DbgCmd.Cmd.CommandLength));
01529 
01530         <span class="comment">// DebugConvertToAnsi(hCurrentProcess,lpExtensionApis,</span>
01531         <span class="comment">//         DbgCmd.Cmd.Command, ach);</span>
01532         DbgCmd.Cmd.CommandLength /= <span class="keyword">sizeof</span>(WCHAR);
01533         DbgCmd.Cmd.Command[DbgCmd.Cmd.CommandLength] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01534         Print(<span class="stringliteral">"   %03d: %d chars = \"%S\"\n"</span>, i,
01535                 DbgCmd.Cmd.CommandLength,
01536                 DbgCmd.Cmd.Command);
01537         <span class="keywordflow">if</span> (i == CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o4">LastAdded</a>) {
01538             Print(<span class="stringliteral">"        (Last Added)\n"</span>);
01539         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o5">LastDisplayed</a>) {
01540             Print(<span class="stringliteral">"        (Last Displayed)\n"</span>);
01541         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == CmdHist.<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o6">FirstCommand</a>) {
01542             Print(<span class="stringliteral">"        (First Command)\n"</span>);
01543         }
01544     }
01545 
01546     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01547 }
01548 
01549 <span class="comment">/***************************************************************************\</span>
01550 <span class="comment">* dmem - Dump Memory Usage</span>
01551 <span class="comment">\***************************************************************************/</span>
01552 
<a name="l01553"></a><a class="code" href="../../d7/d4/conexts_8c.html#a11">01553</a> <span class="preprocessor">#define HEAP_GRANULARITY    8</span>
<a name="l01554"></a><a class="code" href="../../d7/d4/conexts_8c.html#a12">01554</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_SIZE(Size)     (((Size) + (HEAP_GRANULARITY - 1) + HEAP_GRANULARITY) &amp; ~(HEAP_GRANULARITY - 1))</span>
01555 <span class="preprocessor"></span>
<a name="l01556"></a><a class="code" href="../../d7/d4/conexts_8c.html#a32">01556</a> ULONG <a class="code" href="../../d7/d4/conexts_8c.html#a32">dmem</a>(
01557     HANDLE hCurrentProcess,
01558     HANDLE hCurrentThread,
01559     DWORD dwCurrentPc,
01560     PWINDBG_EXTENSION_APIS lpExtensionApis,
01561     LPSTR lpArgString)
01562 {
01563     PWINDBG_OUTPUT_ROUTINE Print;
01564     PWINDBG_GET_EXPRESSION EvalExpression;
01565     PWINDBG_GET_SYMBOL GetSymbol;
01566 
01567     <span class="keywordtype">char</span> ach[120];
01568     <span class="keywordtype">char</span> chVerbose;
01569     ULONG i;
01570     ULONG <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>;
01571     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>;
01572     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">CONSOLE_INFORMATION</a> Console;
01573     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> pConsole = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01574     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">SCREEN_INFORMATION</a> Screen;
01575     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01576     ULONG cbTotal = 0;
01577     ULONG cbConsole = 0;
01578     ULONG cbInput = 0;
01579     ULONG cbOutput = 0;
01580     ULONG cbFE = 0;
01581 
01582     Print = lpExtensionApis-&gt;lpOutputRoutine;
01583     EvalExpression = lpExtensionApis-&gt;lpGetExpressionRoutine;
01584     GetSymbol = lpExtensionApis-&gt;lpGetSymbolRoutine;
01585 
01586     chVerbose   = <span class="charliteral">' '</span>;
01587 
01588     <span class="keywordflow">do</span> {
01589         <span class="comment">/*</span>
01590 <span class="comment">         * Skip white space</span>
01591 <span class="comment">         */</span>
01592         <span class="keywordflow">while</span> (*lpArgString &amp;&amp; *lpArgString == <span class="charliteral">' '</span>)
01593             lpArgString++;
01594 
01595         <span class="keywordflow">switch</span> (*lpArgString) {
01596         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
01597             chVerbose = <span class="charliteral">'v'</span>;
01598             <span class="keywordflow">break</span>;
01599 
01600         <span class="keywordflow">case</span> <span class="charliteral">'\0'</span>:
01601             <span class="comment">/*</span>
01602 <span class="comment">             * If no console is specified, loop through all of them</span>
01603 <span class="comment">             */</span>
01604             <a class="code" href="../../d7/d4/conexts_8c.html#a3">moveExpressionValue</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>,
01605                                 <span class="stringliteral">"winsrv!NumberOfConsoleHandles"</span>);
01606             <a class="code" href="../../d7/d4/conexts_8c.html#a4">moveExpressionValuePtr</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>,
01607                                 <span class="stringliteral">"winsrv!ConsoleHandles"</span>);
01608             <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>; i++) {
01609                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pConsole, <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>);
01610                 <span class="keywordflow">if</span> (pConsole != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01611                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%c %p"</span>, chVerbose, pConsole);
01612                     cbTotal += <a class="code" href="../../d7/d4/conexts_8c.html#a32">dmem</a>(hCurrentProcess, hCurrentThread, dwCurrentPc, lpExtensionApis, ach);
01613                     Print(<span class="stringliteral">"==========================================\n"</span>);
01614                 }
01615                 <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>++;
01616             }
01617             Print(<span class="stringliteral">"Total Size for all consoles = %d bytes\n"</span>, cbTotal);
01618             <span class="keywordflow">return</span> cbTotal;
01619 
01620         <span class="keywordflow">default</span>:
01621             pConsole = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)EvalExpression(lpArgString);
01622             <span class="keywordflow">break</span>;
01623         }
01624         lpArgString++;
01625 
01626     } <span class="keywordflow">while</span> (pConsole == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01627 
01628     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Console, pConsole);
01629 
01630     <a class="code" href="../../d7/d4/conexts_8c.html#a21">DebugConvertToAnsi</a>(hCurrentProcess,
01631                        lpExtensionApis,
01632                        Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
01633                        Console.<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>,
01634                        ach,
01635                        <span class="keyword">sizeof</span>(ach));
01636     Print(<span class="stringliteral">"PCONSOLE @ 0x%lX   \"%s\"\n"</span>, pConsole, ach);
01637 
01638     cbConsole = <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(<span class="keyword">sizeof</span>(Console)) +
01639                 <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Console.TitleLength) +
01640                 <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Console.OriginalTitleLength);
01641 
01642     cbInput = <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Console.InputBuffer.AllocatedBufferSize);
01643 
01644     pScreen = Console.ScreenBuffers;
01645     <span class="keywordflow">while</span> (pScreen != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01646 
01647         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Screen, pScreen);
01648         cbOutput += <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(<span class="keyword">sizeof</span>(Screen));
01649 
01650         <span class="keywordflow">if</span> (Screen.Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01651             cbOutput += <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Screen.ScreenBufferSize.Y * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/struct__ROW.html">ROW</a>)) +
01652                         <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Screen.ScreenBufferSize.X * Screen.ScreenBufferSize.Y * <span class="keyword">sizeof</span>(WCHAR));
01653             <span class="keywordflow">if</span> (Screen.BufferInfo.TextInfo.DbcsScreenBuffer.TransBufferCharacter) {
01654                 cbFE += <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Screen.ScreenBufferSize.X * Screen.ScreenBufferSize.Y * <span class="keyword">sizeof</span>(WCHAR));
01655             }
01656             <span class="keywordflow">if</span> (Screen.BufferInfo.TextInfo.DbcsScreenBuffer.TransBufferAttribute) {
01657                 cbFE += <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Screen.ScreenBufferSize.X * Screen.ScreenBufferSize.Y * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>));
01658             }
01659             <span class="keywordflow">if</span> (Screen.BufferInfo.TextInfo.DbcsScreenBuffer.TransWriteConsole) {
01660                 cbFE += <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Screen.ScreenBufferSize.X * Screen.ScreenBufferSize.Y * <span class="keyword">sizeof</span>(WCHAR));
01661             }
01662             <span class="keywordflow">if</span> (Screen.BufferInfo.TextInfo.DbcsScreenBuffer.KAttrRows) {
01663                 cbFE += <a class="code" href="../../d7/d4/conexts_8c.html#a12">HEAP_SIZE</a>(Screen.ScreenBufferSize.X * Screen.ScreenBufferSize.Y * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>));
01664             }
01665         }
01666 
01667         pScreen = Screen.<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o23">Next</a>;
01668     }
01669 
01670     cbTotal = cbConsole + cbInput + cbOutput + cbFE;
01671 
01672     <span class="keywordflow">if</span> (chVerbose == <span class="charliteral">'v'</span>) {
01673         Print(<span class="stringliteral">"    Console Size = %7d\n"</span>, cbConsole);
01674         Print(<span class="stringliteral">"    Input Size   = %7d\n"</span>, cbInput);
01675         Print(<span class="stringliteral">"    Output Size  = %7d\n"</span>, cbOutput);
01676         Print(<span class="stringliteral">"    FE Size      = %7d\n"</span>, cbFE);
01677     }
01678 
01679     Print(<span class="stringliteral">"Total Size       = %7d\n"</span>, cbTotal);
01680 
01681     <span class="keywordflow">return</span> cbTotal;
01682 }
01683 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
