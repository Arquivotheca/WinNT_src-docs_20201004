<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kdapi.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdapi.c File Reference</h1><code>#include "<a class="el" href="../../d1/d6/kdp_8h-source.html">kdp.h</a>"</code><br>

<p>
<a href="../../d9/d2/kdapi_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a0">SHIFT10000</a>&nbsp;&nbsp;&nbsp;13</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a1">Convert100nsToMilliseconds</a>(LARGE_INTEGER)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a5">KdpQueryPerformanceCounter</a> (IN PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a6">KdpProcessInternalBreakpoint</a> (ULONG BreakpointNumber)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a7">KdQuerySpecialCalls</a> (PDBGKD_MANIPULATE_STATE m, ULONG Length, PULONG RequiredLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a8">KdSetSpecialCall</a> (PDBGKD_MANIPULATE_STATE m, PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a9">KdClearSpecialCalls</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a10">KdpGetVersion</a> (IN PDBGKD_MANIPULATE_STATE m)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a11">KdpNotSupported</a> (IN PDBGKD_MANIPULATE_STATE m)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a12">KdpCauseBugCheck</a> (IN PDBGKD_MANIPULATE_STATE m)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a13">KdpWriteBreakPointEx</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a14">KdpRestoreBreakPointEx</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a15">KdpSearchMemory</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a16">KdEnterDebugger</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a17">KdExitDebugger</a> (IN BOOLEAN Enable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a18">KdUpdateTimeSlipEvent</a> (PVOID Event)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a19">KdpTimeSlipDpcRoutine</a> (<a class="el" href="../../d1/d6/struct__KDPC.html">PKDPC</a> Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a20">KdpTimeSlipWork</a> (IN PVOID Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a21">KdpSendWaitContinue</a> (IN ULONG OutPacketType, IN PSTRING OutMessageHeader, IN PSTRING OutMessageData OPTIONAL, IN OUT PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a22">KdpReadVirtualMemory</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a23">KdpReadVirtualMemory64</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a24">KdpWriteVirtualMemory</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a25">KdpWriteVirtualMemory64</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a26">KdpGetContext</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a27">KdpSetContext</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a28">KdpWriteBreakpoint</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a29">KdpRestoreBreakpoint</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a30">KdpSwitchProcessor</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN OUT PCONTEXT ContextRecord, IN BOOLEAN SecondChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a31">KdpReportExceptionStateChange</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN OUT PCONTEXT ContextRecord, IN BOOLEAN SecondChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a32">KdpReportLoadSymbolsStateChange</a> (IN PSTRING PathName, IN <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">PKD_SYMBOLS_INFO</a> SymbolInfo, IN BOOLEAN UnloadSymbols, IN OUT PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a33">KdpReadPhysicalMemory</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a34">KdpWritePhysicalMemory</a> (IN PDBGKD_MANIPULATE_STATE m, IN PSTRING AdditionalData, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a35">KdDisableDebugger</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a36">KdEnableDebugger</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a2">Magic10000</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/kdapi_8c.html#a4">KdPreviouslyEnabled</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="kdapi.c::Convert100nsToMilliseconds" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define Convert100nsToMilliseconds          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LARGE_INTEGER&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                         \
    RtlExtendedMagicDivide( (LARGE_INTEGER), Magic10000, SHIFT10000 )       \
    )
</div></pre>
<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00048">48</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/time_8c-source.html#l00361">TimeToDaysAndFraction()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="kdapi.c::SHIFT10000" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SHIFT10000&nbsp;&nbsp;&nbsp;13          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00047">47</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a9" doxytag="kdapi.c::KdClearSpecialCalls" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdClearSpecialCalls           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="kdapi.c::KdDisableDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdDisableDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">3240</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00243">KdDisableCount</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00026">KdpPortLock()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00244">KdPreviouslyEnabled</a>, <a class="el" href="../../d8/d7/alpha_2kdtrap_8c-source.html#l00386">KdpStub()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00972">KdpSuspendAllBreakpoints()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, and <a class="el" href="../../d1/d6/kdp_8h-source.html#l00437">KiDebugRoutine</a>.
<p>
<pre class="fragment"><div>03246                    :
03247 
03248     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to disable <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger.
03249 
03250 Arguments:
03251 
03252     None.
03253 
03254 Return Value:
03255 
03256     None.
03257 
03258 --*/
03259 
03260 {
03261     KIRQL oldIrql ;
03262 
03263     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(DISPATCH_LEVEL, &amp;oldIrql) ;
03264     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a145">KdpPortLock</a>();
03265 
03266     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>) {
03267 
03268         <a class="code" href="../../d8/d3/kdapi_8c.html#a4">KdPreviouslyEnabled</a> = <a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> &amp;&amp; (!<a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a>) ;
03269         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a>) {
03270 
03271             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a139">KdpSuspendAllBreakpoints</a>() ;
03272             <a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> = <a class="code" href="../../d7/d8/alpha_2kdtrap_8c.html#a2">KdpStub</a>;
03273             <a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
03274         }
03275     }
03276     <a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>++ ;
03277     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
03278     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(oldIrql);
03279 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="kdapi.c::KdEnableDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdEnableDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">3282</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00243">KdDisableCount</a>, <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00072">KdInitSystem()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00026">KdpPortLock()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01309">KdpRestoreAllBreakpoints()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00244">KdPreviouslyEnabled</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d1/po_8h-source.html#l00464">PoHiberInProgress</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>03287                    :
03288 
03289     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to reenable <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger after a call to
03290     <a class="code" href="../../d7/d3/kd_8h.html#a28">KdDisableDebugger</a>.
03291 
03292 Arguments:
03293 
03294     None.
03295 
03296 Return Value:
03297 
03298     None.
03299 
03300 --*/
03301 {
03302     KIRQL oldIrql ;
03303 
03304     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(DISPATCH_LEVEL, &amp;oldIrql) ;
03305     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a145">KdpPortLock</a>();
03306 
03307     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KdDisableCount &gt; 0) ;
03308     <a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>-- ;
03309 
03310     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d3/kdapi_8c.html#a3">KdDisableCount</a>) {
03311         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d3/kdapi_8c.html#a4">KdPreviouslyEnabled</a>) {
03312 
03313             <span class="comment">//</span>
03314             <span class="comment">// Ugly HACKHACK - Make sure the timers aren't reset.</span>
03315             <span class="comment">//</span>
03316             <a class="code" href="../../d1/d2/po_8h.html#a55">PoHiberInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
03317             <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a4">KdInitSystem</a>(NULL, FALSE) ;
03318             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a140">KdpRestoreAllBreakpoints</a>();
03319             <a class="code" href="../../d1/d2/po_8h.html#a55">PoHiberInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
03320         }
03321     }
03322     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
03323     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(oldIrql);
03324 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="kdapi.c::KdEnterDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdEnterDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00303">303</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00040">FREEZE_BACKUP</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00041">FREEZE_SKIPPED_PROCESSOR</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00301">KdEnteredDebugger</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00056">KdpDebuggerLock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a204">KdPortSave()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00222">KdpPortLocked</a>, <a class="el" href="../../d3/d3/alpha_2kdcmsup_8c-source.html#l00024">KdpQueryPerformanceCounter()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00209">KdTimerDifference</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00207">KdTimerStart</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00208">KdTimerStop</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00389">KiFreezeFlag</a>, <a class="el" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock()</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00046">TimeFields</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00310                    :
00311 
00312     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to enter <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger. Its purpose
00313     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to freeze all other processors and aqcuire <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger
00314     comm port.
00315 
00316 Arguments:
00317 
00318     TrapFrame - Supplies a pointer to a trap frame that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00319         trap.
00320 
00321     ExceptionFrame - Supplies a pointer to an exception frame that
00322         describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap.
00323 
00324 Return Value:
00325 
00326     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous interrupt enable.
00327 
00328 --*/
00329 
00330 {
00331 
00332     BOOLEAN Enable;
00333     TIME_FIELDS <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>;
00334 <span class="preprocessor">#if DBG</span>
00335 <span class="preprocessor"></span>    <span class="keyword">extern</span> ULONG <a class="code" href="../../d5/d9/kernldat_8c.html#a43">KiFreezeFlag</a>;
00336 <span class="preprocessor">#endif</span>
00337 <span class="preprocessor"></span>
00338     <span class="comment">//</span>
00339     <span class="comment">// HACKHACK - do some crude timer support</span>
00340     <span class="comment">//            but not if called from KdSetOwedBreakpoints()</span>
00341     <span class="comment">//</span>
00342 
00343     <span class="keywordflow">if</span> (TrapFrame) {
00344         <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a> = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a5">KdpQueryPerformanceCounter</a> (TrapFrame);
00345         <a class="code" href="../../d8/d5/kddata_8c.html#a58">KdTimerDifference</a>.QuadPart = <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>.QuadPart - <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a>.QuadPart;
00346     } <span class="keywordflow">else</span> {
00347         <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>.QuadPart = 0;
00348     }
00349 
00350     <span class="comment">//</span>
00351     <span class="comment">// Freeze all other processors, raise IRQL to HIGH_LEVEL, and save debug</span>
00352     <span class="comment">// port state.  We lock the port so that KdPollBreakin and a debugger</span>
00353     <span class="comment">// operation don't interfere with each other.</span>
00354     <span class="comment">//</span>
00355 
00356     Enable = <a class="code" href="../../d9/d4/ke_2debug_8c.html#a9">KeFreezeExecution</a>(TrapFrame, ExceptionFrame);
00357     <a class="code" href="../../d8/d5/kddata_8c.html#a68">KdpPortLocked</a> = <a class="code" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock</a>(&amp;KdpDebuggerLock);
00358     <a class="code" href="../../d2/d7/hal_8h.html#a204">KdPortSave</a>();
00359     <a class="code" href="../../d8/d5/kddata_8c.html#a109">KdEnteredDebugger</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00360 
00361 <span class="preprocessor">#if DBG</span>
00362 <span class="preprocessor"></span>
00363     <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a43">KiFreezeFlag</a> &amp; <a class="code" href="../../d7/d3/kd_8h.html#a3">FREEZE_BACKUP</a>) != 0) {
00364         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"FreezeLock was jammed!  Backup SpinLock was used!\n"</span>));
00365     }
00366 
00367     <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a43">KiFreezeFlag</a> &amp; <a class="code" href="../../d7/d3/kd_8h.html#a4">FREEZE_SKIPPED_PROCESSOR</a>) != 0) {
00368         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"Some processors not frozen in debugger!\n"</span>));
00369     }
00370 
00371     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a68">KdpPortLocked</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00372         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"Port lock was not acquired!\n"</span>));
00373     }
00374 
00375 <span class="preprocessor">#endif</span>
00376 <span class="preprocessor"></span>
00377     <span class="keywordflow">return</span> Enable;
00378 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="kdapi.c::KdExitDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdExitDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Enable</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00381">381</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d2/d7/hal_8h.html#a203">KdPortRestore()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00222">KdpPortLocked</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00060">KdpPortUnlock()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00290">KdpTimeSlipDpc</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00293">KdpTimeSlipPending</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00207">KdTimerStart</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00208">KdTimerStop</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d1/po_8h-source.html#l00464">PoHiberInProgress</a>, and <a class="el" href="../../d7/d5/ttime_8c-source.html#l00046">TimeFields</a>.
<p>
<pre class="fragment"><div>00387                    :
00388 
00389     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger. It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reverse
00390     of <a class="code" href="../../d7/d3/kd_8h.html#a17">KdEnterDebugger</a>.
00391 
00392 Arguments:
00393 
00394     Enable - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous interrupt enable which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be restored.
00395 
00396 Return Value:
00397 
00398     None.
00399 
00400 --*/
00401 
00402 {
00403     ULONG ElapsedTime;
00404     ULARGE_INTEGER TimeDifference;
00405     TIME_FIELDS <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>;
00406     ULONG Pending;
00407 
00408     <span class="comment">//</span>
00409     <span class="comment">// restore stuff and exit</span>
00410     <span class="comment">//</span>
00411 
00412     <a class="code" href="../../d2/d7/hal_8h.html#a203">KdPortRestore</a>();
00413     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a68">KdpPortLocked</a>) {
00414         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a146">KdpPortUnlock</a>();
00415     }
00416 
00417     <a class="code" href="../../d9/d4/ke_2debug_8c.html#a12">KeThawExecution</a>(Enable);
00418 
00419     <span class="comment">//</span>
00420     <span class="comment">// Do some crude timer support.  If KdEnterDebugger didn't</span>
00421     <span class="comment">// Query the performance counter, then don't do it here either.</span>
00422     <span class="comment">//</span>
00423 
00424     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>.QuadPart == 0) {
00425         <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a57">KdTimerStop</a>;
00426     } <span class="keywordflow">else</span> {
00427         <a class="code" href="../../d8/d5/kddata_8c.html#a56">KdTimerStart</a> = <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>(NULL);
00428     }
00429 
00430     <span class="comment">//</span>
00431     <span class="comment">// Process a time slip</span>
00432     <span class="comment">//</span>
00433 
00434     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d2/po_8h.html#a55">PoHiberInProgress</a>) {
00435 
00436         Pending = InterlockedIncrement(&amp;KdpTimeSlipPending);
00437 
00438         <span class="comment">//</span>
00439         <span class="comment">// If there's wasn't a time slip pending, queue the DPC to handle it</span>
00440         <span class="comment">//</span>
00441 
00442         <span class="keywordflow">if</span> (Pending == 1) {
00443             InterlockedIncrement(&amp;KdpTimeSlipPending);
00444             <a class="code" href="../../d4/d1/dpcobj_8c.html#a2">KeInsertQueueDpc</a>(&amp;KdpTimeSlipDpc, NULL, NULL);
00445         }
00446     }
00447 
00448     <span class="keywordflow">return</span>;
00449 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="kdapi.c::KdpCauseBugCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpCauseBugCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>m</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03007">3007</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>03013                    :
03014 
03015     This routine causes a bugcheck.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used <span class="keywordflow">for</span> testing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger.
03016 
03017 Arguments:
03018 
03019     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
03020 
03021 Return Value:
03022 
03023     None.
03024 
03025 --*/
03026 
03027 {
03028 
03029     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>( *(PULONG)&amp;m-&gt;u, 0, 0, 0, 0 );
03030 
03031 } <span class="comment">// KdCauseBugCheck</span>

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="kdapi.c::KdpGetContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpGetContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01461">1461</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>01469                    :
01470 
01471     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a get context state
01472     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
01473     context.
01474 
01475 Arguments:
01476 
01477     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01478 
01479     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01480 
01481     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01482 
01483 Return Value:
01484 
01485     None.
01486 
01487 --*/
01488 
01489 {
01490     PDBGKD_GET_CONTEXT a = &amp;m-&gt;u.GetContext;
01491     STRING MessageHeader;
01492 
01493     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01494     MessageHeader.Buffer = (PCHAR)m;
01495 
01496     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
01497 
01498     <span class="keywordflow">if</span> (m-&gt;Processor &gt;= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>) {
01499         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01500     } <span class="keywordflow">else</span> {
01501         m-&gt;ReturnStatus = STATUS_SUCCESS;
01502         AdditionalData-&gt;Length = <span class="keyword">sizeof</span>(CONTEXT);
01503         <span class="keywordflow">if</span> (m-&gt;Processor == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number) {
01504             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>(AdditionalData-&gt;Buffer, (PCHAR)Context, <span class="keyword">sizeof</span>(CONTEXT));
01505         } <span class="keywordflow">else</span> {
01506             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>(AdditionalData-&gt;Buffer,
01507                           (PCHAR)&amp;KiProcessorBlock[m-&gt;Processor]-&gt;ProcessorState.ContextFrame,
01508                           <span class="keyword">sizeof</span>(CONTEXT)
01509                          );
01510         }
01511     }
01512 
01513     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01514                   PACKET_TYPE_KD_STATE_MANIPULATE,
01515                   &amp;MessageHeader,
01516                   AdditionalData
01517                   );
01518 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="kdapi.c::KdpGetVersion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpGetVersion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>m</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02838">2838</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00280">KdpDebuggerDataListHead</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00266">KdpNtosImageBase</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02809">KeUserCallbackDispatcher</a>, <a class="el" href="../../d0/d0/ki_8h.html#a98">KiCallUserMode()</a>, <a class="el" href="../../d6/d4/triage_8c-source.html#l00042">NtBuildNumber</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00582">PsLoadedModuleList</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00580">PsNtosImageBase</a>, and <a class="el" href="../../d0/d7/kdp_8h.html#a130">RtlpBreakWithStatusInstruction()</a>.
<p>
<pre class="fragment"><div>02844                    :
02845 
02846     This function returns to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller a general information packet
02847     that contains useful information to a debugger.  This packet <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also
02848     used <span class="keywordflow">for</span> a debugger to determine <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> writebreakpointex and
02849     readbreakpointex apis are available.
02850 
02851 Arguments:
02852 
02853     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
02854 
02855 Return Value:
02856 
02857     None.
02858 
02859 --*/
02860 
02861 {
02862     STRING                   messageHeader;
02863 
02864 
02865     messageHeader.Length = <span class="keyword">sizeof</span>(*m);
02866     messageHeader.Buffer = (PCHAR)m;
02867 
02868     RtlZeroMemory(&amp;m-&gt;u.GetVersion, <span class="keyword">sizeof</span>(m-&gt;u.GetVersion));
02869     <span class="comment">//</span>
02870     <span class="comment">// the current build number</span>
02871     <span class="comment">//</span>
02872     m-&gt;u.GetVersion.MinorVersion = (<span class="keywordtype">short</span>)<a class="code" href="../../d5/d5/triage_8c.html#a0">NtBuildNumber</a>;
02873     m-&gt;u.GetVersion.MajorVersion = (<span class="keywordtype">short</span>)((<a class="code" href="../../d5/d5/triage_8c.html#a0">NtBuildNumber</a> &gt;&gt; 28) &amp; 0xFFFFFFF);
02874 
02875     <span class="comment">//</span>
02876     <span class="comment">// kd protocol version number.  this should be incremented if the</span>
02877     <span class="comment">// protocol changes.</span>
02878     <span class="comment">//</span>
02879     m-&gt;u.GetVersion.ProtocolVersion = 4;
02880     m-&gt;u.GetVersion.Flags = DBGKD_VERS_FLAG_DATA;
02881 
02882 <span class="preprocessor">#if !defined(NT_UP)</span>
02883 <span class="preprocessor"></span>    m-&gt;u.GetVersion.Flags |= DBGKD_VERS_FLAG_MP;
02884 <span class="preprocessor">#endif</span>
02885 <span class="preprocessor"></span>
02886 <span class="preprocessor">#if defined(_M_IX86)</span>
02887 <span class="preprocessor"></span>    m-&gt;u.GetVersion.MachineType = IMAGE_FILE_MACHINE_I386;
02888 <span class="preprocessor">#elif defined(_M_MRX000)</span>
02889 <span class="preprocessor"></span>    m-&gt;u.GetVersion.MachineType = IMAGE_FILE_MACHINE_R4000;
02890 <span class="preprocessor">#elif defined(_M_ALPHA)</span>
02891 <span class="preprocessor"></span>    m-&gt;u.GetVersion.MachineType = IMAGE_FILE_MACHINE_ALPHA;
02892 <span class="preprocessor">#if defined (_AXP64_)</span>
02893 <span class="preprocessor"></span>    m-&gt;u.GetVersion.Flags |= DBGKD_VERS_FLAG_PTR64;
02894 <span class="preprocessor">#endif</span>
02895 <span class="preprocessor"></span><span class="preprocessor">#elif defined(_M_PPC)</span>
02896 <span class="preprocessor"></span>    m-&gt;u.GetVersion.MachineType = IMAGE_FILE_MACHINE_POWERPC;
02897 <span class="preprocessor">#elif defined(_M_IA64)</span>
02898 <span class="preprocessor"></span>    m-&gt;u.GetVersion.MachineType = IMAGE_FILE_MACHINE_IA64;
02899     m-&gt;u.GetVersion.Flags |= DBGKD_VERS_FLAG_PTR64;
02900 <span class="preprocessor">#else</span>
02901 <span class="preprocessor"></span><span class="preprocessor">#error( "unknown target machine" );</span>
02902 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02903 <span class="preprocessor"></span>
02904     <span class="comment">//</span>
02905     <span class="comment">// address of the loader table</span>
02906     <span class="comment">//</span>
02907     m-&gt;u.GetVersion.PsLoadedModuleList = (ULONG_PTR)&amp;<a class="code" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a>;
02908 
02909     <span class="comment">//</span>
02910     <span class="comment">// If the debugger is being initialized during boot, PsNtosImageBase</span>
02911     <span class="comment">// and PsLoadedModuleList are not yet valid.  KdInitSystem got</span>
02912     <span class="comment">// the image base from the loader block.</span>
02913     <span class="comment">// On the other hand, if the debugger was initialized by a bugcheck,</span>
02914     <span class="comment">// it didn't get a loader block to look at, but the system was</span>
02915     <span class="comment">// running so the other variables are valid.</span>
02916     <span class="comment">//</span>
02917     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a94">KdpNtosImageBase</a>) {
02918         m-&gt;u.GetVersion.KernBase = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a94">KdpNtosImageBase</a>;
02919     } <span class="keywordflow">else</span> {
02920         m-&gt;u.GetVersion.KernBase = (ULONG_PTR)<a class="code" href="../../d1/d9/ps_8h.html#a54">PsNtosImageBase</a>;
02921     }
02922 
02923     <span class="comment">//</span>
02924     <span class="comment">// These fields are obsolete with the introduction of</span>
02925     <span class="comment">// KdDebuggerDataBlock.  They are being kept for a while</span>
02926     <span class="comment">// so people can still use their 4.0 debuggers.</span>
02927     <span class="comment">//</span>
02928     m-&gt;u.GetVersion.ThCallbackStack = FIELD_OFFSET(<a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>, CallbackStack);
02929     m-&gt;u.GetVersion.KiCallUserMode = (ULONG_PTR)<a class="code" href="../../d0/d0/ki_8h.html#a98">KiCallUserMode</a>;
02930     m-&gt;u.GetVersion.KeUserCallbackDispatcher = (ULONG_PTR) <a class="code" href="../../d4/d9/ke_8h.html#a149">KeUserCallbackDispatcher</a>;
02931     m-&gt;u.GetVersion.NextCallback = FIELD_OFFSET(KCALLOUT_FRAME, CbStk);
02932 <span class="preprocessor">#if defined(_X86_)</span>
02933 <span class="preprocessor"></span>    m-&gt;u.GetVersion.FramePointer = FIELD_OFFSET(KCALLOUT_FRAME, Ebp);
02934 <span class="preprocessor">#endif</span>
02935 <span class="preprocessor"></span>    m-&gt;u.GetVersion.BreakpointWithStatus = (ULONG_PTR)<a class="code" href="../../d0/d7/kdp_8h.html#a130">RtlpBreakWithStatusInstruction</a>;
02936 
02937 
02938 
02939 
02940 
02941     m-&gt;u.GetVersion.DebuggerDataList = (ULONG_PTR)&amp;<a class="code" href="../../d8/d5/kddata_8c.html#a97">KdpDebuggerDataListHead</a>;
02942 
02943     <span class="comment">//</span>
02944     <span class="comment">// the usual stuff</span>
02945     <span class="comment">//</span>
02946     m-&gt;ReturnStatus = STATUS_SUCCESS;
02947     m-&gt;ApiNumber = DbgKdGetVersionApi;
02948 
02949     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(PACKET_TYPE_KD_STATE_MANIPULATE,
02950                   &amp;messageHeader,
02951                   NULL
02952                  );
02953 
02954     <span class="keywordflow">return</span>;
02955 } <span class="comment">// KdGetVersion</span>

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="kdapi.c::KdpNotSupported" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KdpNotSupported           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>m</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02959">2959</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>02964                    :
02965 
02966     This routine returns STATUS_UNSUCCESSFUL to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger
02967 
02968 Arguments:
02969 
02970     m - Supplies a DBGKD_MANIPULATE_STATE <span class="keyword">struct </span>to answer with
02971 
02972 Return Value:
02973 
02974     0, to indicate that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system should not continue
02975 
02976 --*/
02977 {
02978 
02979     STRING          MessageHeader;
02980     <span class="comment">//</span>
02981     <span class="comment">// setup packet</span>
02982     <span class="comment">//</span>
02983     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
02984     MessageHeader.Buffer = (PCHAR)m;
02985     m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
02986 
02987     <span class="comment">//</span>
02988     <span class="comment">// send back our response</span>
02989     <span class="comment">//</span>
02990     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
02991         PACKET_TYPE_KD_STATE_MANIPULATE,
02992         &amp;MessageHeader,
02993         NULL
02994         );
02995 
02996     <span class="comment">//</span>
02997     <span class="comment">// return the caller's continue status value.  if this is a non-zero</span>
02998     <span class="comment">// value the system is continued using this value as the continuestatus.</span>
02999     <span class="comment">//</span>
03000 
03001     <span class="keywordflow">return</span> 0;
03002 
03003 } <span class="comment">// KdpNotSupported</span>

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="kdapi.c::KdpProcessInternalBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpProcessInternalBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>BreakpointNumber</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="kdapi.c::KdpQueryPerformanceCounter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER KdpQueryPerformanceCounter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TrapFrame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d3/alpha_2kdcmsup_8c-source.html#l00024">24</a> of file <a class="el" href="../../d3/d3/alpha_2kdcmsup_8c-source.html">alpha/kdcmsup.c</a>.
<p>
<pre class="fragment"><div>00030                    :
00031 
00032     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system performance
00033     counter.
00034 
00035 Arguments:
00036 
00037     None.
00038 
00039 Return Value:
00040 
00041     The value returned by <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00042     function value.
00043 
00044 --*/
00045 
00046 {
00047 
00048     <span class="keywordflow">return</span> <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>(0);
00049 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="kdapi.c::KdpReadPhysicalMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadPhysicalMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02534">2534</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>02542                    :
02543 
02544     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response to a read physical memory
02545     state manipulation message. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read physical memory
02546     and <span class="keywordflow">return</span>.
02547 
02548     N.B. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> now more dangerous than ever:  <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> modified physical
02549     memory <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped to a <span class="keyword">virtual</span> page which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">protected</span> as readonly <a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a>,
02550     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory manager will eventually bugcheck when <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> discovers that
02551     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page has been modified.
02552 
02553 Arguments:
02554 
02555     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
02556 
02557     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
02558 
02559     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
02560 
02561 Return Value:
02562 
02563     None.
02564 
02565 --*/
02566 
02567 {
02568     PDBGKD_READ_MEMORY a = &amp;m-&gt;u.ReadMemory;
02569     ULONG Length;
02570     STRING MessageHeader;
02571     PVOID VirtualAddress;
02572     PHYSICAL_ADDRESS Source;
02573     PUCHAR Destination;
02574     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> NumberBytes;
02575     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> BytesLeft;
02576 
02577     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
02578     MessageHeader.Buffer = (PCHAR)m;
02579 
02580     <span class="comment">//</span>
02581     <span class="comment">// make sure that nothing but a read memory message was transmitted</span>
02582     <span class="comment">//</span>
02583 
02584     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
02585 
02586     <span class="comment">//</span>
02587     <span class="comment">// Trim transfer count to fit in a single message</span>
02588     <span class="comment">//</span>
02589 
02590     <span class="keywordflow">if</span> (a-&gt;TransferCount &gt; (PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE))) {
02591         Length = PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
02592     } <span class="keywordflow">else</span> {
02593         Length = a-&gt;TransferCount;
02594     }
02595 
02596     <span class="comment">//</span>
02597     <span class="comment">// Since the MmDbgTranslatePhysicalAddress only maps in one physical</span>
02598     <span class="comment">// page at a time, we need to break the memory move up into smaller</span>
02599     <span class="comment">// moves which don't cross page boundaries.  There are two cases we</span>
02600     <span class="comment">// need to deal with.  The area to be moved may start and end on the</span>
02601     <span class="comment">// same page, or it may start and end on different pages (with an</span>
02602     <span class="comment">// arbitrary number of pages in between)</span>
02603     <span class="comment">//</span>
02604     Source.QuadPart = (ULONG_PTR)a-&gt;TargetBaseAddress;
02605     Destination = AdditionalData-&gt;Buffer;
02606     BytesLeft = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Length;
02607     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d1/mm_8h.html#a7">PAGE_ALIGN</a>((PUCHAR)a-&gt;TargetBaseAddress) ==
02608        <a class="code" href="../../d2/d1/mm_8h.html#a7">PAGE_ALIGN</a>((PUCHAR)(a-&gt;TargetBaseAddress)+Length)) {
02609         <span class="comment">//</span>
02610         <span class="comment">// Memory move starts and ends on the same page.</span>
02611         <span class="comment">//</span>
02612         VirtualAddress=<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a4">MmDbgTranslatePhysicalAddress</a>(Source);
02613         <span class="keywordflow">if</span> (VirtualAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02614             AdditionalData-&gt;Length = 0;
02615         } <span class="keywordflow">else</span> {
02616             AdditionalData-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02617                                                 Destination,
02618                                                 VirtualAddress,
02619                                                 BytesLeft
02620                                                 );
02621             BytesLeft -= AdditionalData-&gt;Length;
02622         }
02623     } <span class="keywordflow">else</span> {
02624         <span class="comment">//</span>
02625         <span class="comment">// Memory move spans page boundaries</span>
02626         <span class="comment">//</span>
02627         VirtualAddress=<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a4">MmDbgTranslatePhysicalAddress</a>(Source);
02628         <span class="keywordflow">if</span> (VirtualAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02629             AdditionalData-&gt;Length = 0;
02630         } <span class="keywordflow">else</span> {
02631             NumberBytes = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - <a class="code" href="../../d2/d1/mm_8h.html#a6">BYTE_OFFSET</a>(VirtualAddress));
02632             AdditionalData-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02633                                             Destination,
02634                                             VirtualAddress,
02635                                             NumberBytes
02636                                             );
02637             Source.LowPart += NumberBytes;
02638             Destination += NumberBytes;
02639             BytesLeft -= NumberBytes;
02640             <span class="keywordflow">while</span>(BytesLeft &gt; 0) {
02641                 <span class="comment">//</span>
02642                 <span class="comment">// Transfer a full page or the last bit,</span>
02643                 <span class="comment">// whichever is smaller.</span>
02644                 <span class="comment">//</span>
02645                 VirtualAddress = <a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a4">MmDbgTranslatePhysicalAddress</a>(Source);
02646                 <span class="keywordflow">if</span> (VirtualAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02647                     <span class="keywordflow">break</span>;
02648                 } <span class="keywordflow">else</span> {
02649                     NumberBytes = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) ((<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> &lt; BytesLeft) ? <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> : BytesLeft);
02650                     AdditionalData-&gt;Length += (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02651                                                     Destination,
02652                                                     VirtualAddress,
02653                                                     NumberBytes
02654                                                     );
02655                     Source.LowPart += NumberBytes;
02656                     Destination += NumberBytes;
02657                     BytesLeft -= NumberBytes;
02658                 }
02659             }
02660         }
02661     }
02662 
02663     <span class="keywordflow">if</span> (Length == AdditionalData-&gt;Length) {
02664         m-&gt;ReturnStatus = STATUS_SUCCESS;
02665     } <span class="keywordflow">else</span> {
02666         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
02667     }
02668     a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
02669 
02670     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
02671                   PACKET_TYPE_KD_STATE_MANIPULATE,
02672                   &amp;MessageHeader,
02673                   AdditionalData
02674                   );
02675     UNREFERENCED_PARAMETER(Context);
02676 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="kdapi.c::KdpReadVirtualMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadVirtualMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01139">1139</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>01147                    :
01148 
01149     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response to a read <span class="keyword">virtual</span> memory 32-bit
01150     state manipulation message. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read <span class="keyword">virtual</span> memory
01151     and <span class="keywordflow">return</span>.
01152 
01153 Arguments:
01154 
01155     m - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01156 
01157     AdditionalData - Supplies a pointer to a descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to read.
01158 
01159     Context - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01160 
01161 Return Value:
01162 
01163     None.
01164 
01165 --*/
01166 
01167 {
01168 
01169     ULONG Length;
01170     STRING MessageHeader;
01171 
01172     <span class="comment">//</span>
01173     <span class="comment">// Trim the transfer count to fit in a single message.</span>
01174     <span class="comment">//</span>
01175 
01176     Length = m-&gt;u.ReadMemory.TransferCount;
01177     <span class="keywordflow">if</span> (Length &gt; (PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE))) {
01178         Length = PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
01179     }
01180 
01181     <span class="comment">//</span>
01182     <span class="comment">// Move the data to the destination buffer.</span>
01183     <span class="comment">//</span>
01184 
01185     AdditionalData-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(AdditionalData-&gt;Buffer,
01186                                                    m-&gt;u.ReadMemory.TargetBaseAddress,
01187                                                    Length);
01188 
01189     <span class="comment">//</span>
01190     <span class="comment">// If all the data is read, then return a success status. Otherwise,</span>
01191     <span class="comment">// return unsuccessful.</span>
01192     <span class="comment">//</span>
01193 
01194     m-&gt;ReturnStatus = STATUS_SUCCESS;
01195     <span class="keywordflow">if</span> (Length != AdditionalData-&gt;Length) {
01196         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01197     }
01198 
01199     <span class="comment">//</span>
01200     <span class="comment">// Set the actual number of bytes read, initialize the message header,</span>
01201     <span class="comment">// and send the reply packet to the host debugger.</span>
01202     <span class="comment">//</span>
01203 
01204     m-&gt;u.ReadMemory.ActualBytesRead = AdditionalData-&gt;Length;
01205     MessageHeader.Length = <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
01206     MessageHeader.Buffer = (PCHAR)m;
01207     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(PACKET_TYPE_KD_STATE_MANIPULATE,
01208                   &amp;MessageHeader,
01209                   AdditionalData);
01210 
01211     <span class="keywordflow">return</span>;
01212 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="kdapi.c::KdpReadVirtualMemory64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpReadVirtualMemory64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01215">1215</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00156">MmDbgReadCheck64()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>01223                    :
01224 
01225     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a read <span class="keyword">virtual</span> memory 64-bit
01226     state manipulation message. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to read <span class="keyword">virtual</span> memory
01227     and <span class="keywordflow">return</span>.
01228 
01229 Arguments:
01230 
01231     m - Supplies a pointer to a state manipulation message.
01232 
01233     AdditionalData - Supplies a pointer to descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to read.
01234 
01235     Context - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01236 
01237 Return Value:
01238 
01239     None.
01240 
01241 --*/
01242 
01243 {
01244 
01245     UCHAR * POINTER_64 Address;
01246     PUCHAR Destination;
01247     ULONG Length;
01248     STRING MessageHeader;
01249     UCHAR * POINTER_64 Source;
01250 
01251     <span class="comment">//</span>
01252     <span class="comment">// Trim the transfer count to fit in a single message.</span>
01253     <span class="comment">//</span>
01254 
01255     Length = m-&gt;u.ReadMemory64.TransferCount;
01256     <span class="keywordflow">if</span> (Length &gt; (PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE))) {
01257         Length = PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
01258     }
01259 
01260     <span class="comment">//</span>
01261     <span class="comment">// Move the data to the destination buffer.</span>
01262     <span class="comment">//</span>
01263 
01264     AdditionalData-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Length;
01265 
01266 <span class="preprocessor">#if defined(_MIPS_) || defined(_ALPHA_)</span>
01267 <span class="preprocessor"></span>
01268     Destination = AdditionalData-&gt;Buffer;
01269     Source = (UCHAR * POINTER_64)m-&gt;u.ReadMemory64.TargetBaseAddress;
01270     <span class="keywordflow">while</span> (Length &gt; 0) {
01271         <span class="keywordflow">if</span> ((Address = <a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a2">MmDbgReadCheck64</a>(Source)) == NULL64) {
01272             <span class="keywordflow">break</span>;
01273         }
01274 
01275         *Destination++ = *Address;
01276         Source += 1;
01277         Length -= 1;
01278     }
01279 
01280 <span class="preprocessor">#endif</span>
01281 <span class="preprocessor"></span>
01282     <span class="comment">//</span>
01283     <span class="comment">// If all the data is read, then return a success status. Otherwise,</span>
01284     <span class="comment">// return an unsuccessful status.</span>
01285     <span class="comment">//</span>
01286 
01287     m-&gt;ReturnStatus = STATUS_SUCCESS;
01288     <span class="keywordflow">if</span> (Length != 0) {
01289         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01290     }
01291 
01292     <span class="comment">//</span>
01293     <span class="comment">// Set the actual number of bytes read, initialize the message header,</span>
01294     <span class="comment">// and send the reply packet to the host debugger.</span>
01295     <span class="comment">//</span>
01296 
01297     m-&gt;u.ReadMemory64.ActualBytesRead = AdditionalData-&gt;Length - Length;
01298     MessageHeader.Length = <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
01299     MessageHeader.Buffer = (PCHAR)m;
01300     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(PACKET_TYPE_KD_STATE_MANIPULATE,
01301                   &amp;MessageHeader,
01302                   AdditionalData);
01303 
01304     <span class="keywordflow">return</span>;
01305 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="kdapi.c::KdpReportExceptionStateChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpReportExceptionStateChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SecondChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02351">2351</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>02359                    :
02360 
02361     This routine sends an exception state change packet to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel
02362     debugger and waits <span class="keywordflow">for</span> a manipulate state message.
02363 
02364 Arguments:
02365 
02366     ExceptionRecord - Supplies a pointer to an exception record.
02367 
02368     ContextRecord - Supplies a pointer to a context record.
02369 
02370     SecondChance - Supplies a <span class="keywordtype">boolean</span> value that determines whether <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
02371         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first or second chance <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception.
02372 
02373 Return Value:
02374 
02375     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled. Otherwise, a
02376     value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
02377 
02378 --*/
02379 
02380 {
02381     STRING MessageData;
02382     STRING MessageHeader;
02383     DBGKD_WAIT_STATE_CHANGE WaitStateChange;
02384     <a class="code" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02385 
02386 <span class="preprocessor">#if i386</span>
02387 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/4_2i386_2kdtrap_8c.html#a3">KdpCheckTracePoint</a>(ExceptionRecord,ContextRecord)) <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02388 <span class="preprocessor">#endif</span>
02389 <span class="preprocessor"></span>
02390     <span class="keywordflow">do</span> {
02391 
02392         <span class="comment">//</span>
02393         <span class="comment">// Construct the wait state change message and message descriptor.</span>
02394         <span class="comment">//</span>
02395 
02396         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a114">KdpSetStateChange</a>(&amp;WaitStateChange,
02397                             ExceptionRecord,
02398                             ContextRecord,
02399                             SecondChance
02400                             );
02401 
02402         MessageHeader.Length = <span class="keyword">sizeof</span>(DBGKD_WAIT_STATE_CHANGE);
02403         MessageHeader.Buffer = (PCHAR)&amp;WaitStateChange;
02404 
02405 <span class="preprocessor">#if i386</span>
02406 <span class="preprocessor"></span>        <span class="comment">//</span>
02407         <span class="comment">// Construct the wait state change data and data descriptor.</span>
02408         <span class="comment">//</span>
02409 
02410         DumpTraceData(&amp;MessageData);
02411 <span class="preprocessor">#else</span>
02412 <span class="preprocessor"></span>        MessageData.Length = 0;
02413 <span class="preprocessor">#endif</span>
02414 <span class="preprocessor"></span>
02415         <span class="comment">//</span>
02416         <span class="comment">// Send packet to the kernel debugger on the host machine,</span>
02417         <span class="comment">// wait for answer.</span>
02418         <span class="comment">//</span>
02419 
02420         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a122">KdpSendWaitContinue</a>(
02421                     PACKET_TYPE_KD_STATE_CHANGE,
02422                     &amp;MessageHeader,
02423                     &amp;MessageData,
02424                     ContextRecord
02425                     );
02426 
02427     } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d4/d9/ke_8h.html#a408a228">ContinueProcessorReselected</a>) ;
02428 
02429     <span class="keywordflow">return</span> (BOOLEAN) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02430 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="kdapi.c::KdpReportLoadSymbolsStateChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpReportLoadSymbolsStateChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>PathName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">PKD_SYMBOLS_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SymbolInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>UnloadSymbols</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02434">2434</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>02443                    :
02444 
02445     This routine sends a load symbols state change packet to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel
02446     debugger and waits <span class="keywordflow">for</span> a manipulate state message.
02447 
02448 Arguments:
02449 
02450     PathName - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pathname of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image whose
02451         symbols are to be loaded.
02452 
02453     BaseOfDll - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base address where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image was loaded.
02454 
02455     ProcessId - Unique 32-bit identifier <span class="keywordflow">for</span> process that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">using</span>
02456         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> symbols.  -1 <span class="keywordflow">for</span> system process.
02457 
02458     CheckSum - Unique 32-bit identifier from image header.
02459 
02460     UnloadSymbol - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> symbols that were previously loaded <span class="keywordflow">for</span>
02461         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> named image are to be unloaded from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger.
02462 
02463 Return Value:
02464 
02465     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled. Otherwise, a
02466     value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
02467 
02468 --*/
02469 
02470 {
02471 
02472     PSTRING AdditionalData;
02473     STRING MessageData;
02474     STRING MessageHeader;
02475     DBGKD_WAIT_STATE_CHANGE WaitStateChange;
02476     <a class="code" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02477 
02478     <span class="keywordflow">do</span> {
02479         <span class="comment">//</span>
02480         <span class="comment">// Construct the wait state change message and message descriptor.</span>
02481         <span class="comment">//</span>
02482 
02483         WaitStateChange.NewState = DbgKdLoadSymbolsStateChange;
02484         WaitStateChange.ProcessorLevel = <a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a>;
02485         WaitStateChange.Processor = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number;
02486         WaitStateChange.NumberProcessors = (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
02487         WaitStateChange.Thread = (PVOID)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
02488         WaitStateChange.ProgramCounter = (PVOID)CONTEXT_TO_PROGRAM_COUNTER(ContextRecord);
02489         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a113">KdpSetLoadState</a>(&amp;WaitStateChange, ContextRecord);
02490         WaitStateChange.u.LoadSymbols.UnloadSymbols = UnloadSymbols;
02491         WaitStateChange.u.LoadSymbols.BaseOfDll = SymbolInfo-&gt;BaseOfDll;
02492         WaitStateChange.u.LoadSymbols.ProcessId = (ULONG)SymbolInfo-&gt;ProcessId;
02493         WaitStateChange.u.LoadSymbols.CheckSum = SymbolInfo-&gt;CheckSum;
02494         WaitStateChange.u.LoadSymbols.SizeOfImage = SymbolInfo-&gt;SizeOfImage;
02495         <span class="keywordflow">if</span> (ARGUMENT_PRESENT( PathName )) {
02496             WaitStateChange.u.LoadSymbols.PathNameLength =
02497                 <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02498                     (PCHAR)KdpPathBuffer,
02499                     (PCHAR)PathName-&gt;Buffer,
02500                     PathName-&gt;Length
02501                     ) + 1;
02502 
02503             MessageData.Buffer = <a class="code" href="../../d8/d5/kddata_8c.html#a53">KdpPathBuffer</a>;
02504             MessageData.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)WaitStateChange.u.LoadSymbols.PathNameLength;
02505             MessageData.Buffer[MessageData.Length-1] = <span class="charliteral">'\0'</span>;
02506             AdditionalData = &amp;MessageData;
02507         } <span class="keywordflow">else</span> {
02508             WaitStateChange.u.LoadSymbols.PathNameLength = 0;
02509             AdditionalData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02510         }
02511 
02512         MessageHeader.Length = <span class="keyword">sizeof</span>(DBGKD_WAIT_STATE_CHANGE);
02513         MessageHeader.Buffer = (PCHAR)&amp;WaitStateChange;
02514 
02515         <span class="comment">//</span>
02516         <span class="comment">// Send packet to the kernel debugger on the host machine, wait</span>
02517         <span class="comment">// for the reply.</span>
02518         <span class="comment">//</span>
02519 
02520         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a122">KdpSendWaitContinue</a>(
02521                     PACKET_TYPE_KD_STATE_CHANGE,
02522                     &amp;MessageHeader,
02523                     AdditionalData,
02524                     ContextRecord
02525                     );
02526 
02527     } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d4/d9/ke_8h.html#a408a228">ContinueProcessorReselected</a>);
02528 
02529     <span class="keywordflow">return</span> (BOOLEAN) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02530 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="kdapi.c::KdpRestoreBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpRestoreBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01632">1632</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>01640                    :
01641 
01642     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a restore breakpoint state
01643     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to restore a breakpoint
01644     <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified handle.
01645 
01646 Arguments:
01647 
01648     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01649 
01650     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01651 
01652     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01653 
01654 Return Value:
01655 
01656     None.
01657 
01658 --*/
01659 
01660 {
01661     PDBGKD_RESTORE_BREAKPOINT a = &amp;m-&gt;u.RestoreBreakPoint;
01662     STRING MessageHeader;
01663 
01664     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01665     MessageHeader.Buffer = (PCHAR)m;
01666 
01667     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
01668     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(a-&gt;BreakPointHandle)) {
01669         m-&gt;ReturnStatus = STATUS_SUCCESS;
01670     } <span class="keywordflow">else</span> {
01671         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01672     }
01673     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01674                   PACKET_TYPE_KD_STATE_MANIPULATE,
01675                   &amp;MessageHeader,
01676                   NULL
01677                   );
01678     UNREFERENCED_PARAMETER(Context);
01679 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="kdapi.c::KdpRestoreBreakPointEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpRestoreBreakPointEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03157">3157</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, and <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>.
<p>
<pre class="fragment"><div>03165                    :
03166 
03167     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a restore breakpoint state 'ex'
03168     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to clear a list of breakpoints.
03169 
03170 Arguments:
03171 
03172     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
03173 
03174     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
03175 
03176     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
03177 
03178 Return Value:
03179 
03180     None.
03181 
03182 --*/
03183 
03184 {
03185     PDBGKD_BREAKPOINTEX         a = &amp;m-&gt;u.BreakPointEx;
03186     PDBGKD_RESTORE_BREAKPOINT   b;
03187     STRING                      MessageHeader;
03188     ULONG                       i;
03189     DBGKD_RESTORE_BREAKPOINT    BpBuf[BREAKPOINT_TABLE_SIZE];
03190 
03191 
03192     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
03193     MessageHeader.Buffer = (PCHAR)m;
03194 
03195     <span class="comment">//</span>
03196     <span class="comment">// verify that the packet size is correct</span>
03197     <span class="comment">//</span>
03198     <span class="keywordflow">if</span> (AdditionalData-&gt;Length !=
03199                        a-&gt;BreakPointCount*<span class="keyword">sizeof</span>(DBGKD_RESTORE_BREAKPOINT)) {
03200         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
03201         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
03202                       PACKET_TYPE_KD_STATE_MANIPULATE,
03203                       &amp;MessageHeader,
03204                       AdditionalData
03205                       );
03206         <span class="keywordflow">return</span>;
03207     }
03208 
03209     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PUCHAR)BpBuf,
03210                   AdditionalData-&gt;Buffer,
03211                   a-&gt;BreakPointCount*<span class="keyword">sizeof</span>(DBGKD_RESTORE_BREAKPOINT));
03212 
03213     <span class="comment">//</span>
03214     <span class="comment">// assume success</span>
03215     <span class="comment">//</span>
03216     m-&gt;ReturnStatus = STATUS_SUCCESS;
03217 
03218     <span class="comment">//</span>
03219     <span class="comment">// loop thru the breakpoint handles passed in from the debugger and</span>
03220     <span class="comment">// clear any breakpoint that has a non-zero handle</span>
03221     <span class="comment">//</span>
03222     b = BpBuf;
03223     <span class="keywordflow">for</span> (i=0; i&lt;a-&gt;BreakPointCount; i++,b++) {
03224         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(b-&gt;BreakPointHandle)) {
03225             m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
03226         }
03227     }
03228 
03229     <span class="comment">//</span>
03230     <span class="comment">// send back our response</span>
03231     <span class="comment">//</span>
03232     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
03233                   PACKET_TYPE_KD_STATE_MANIPULATE,
03234                   &amp;MessageHeader,
03235                   AdditionalData
03236                   );
03237 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="kdapi.c::KdpSearchMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSearchMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03328">3328</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00150">KdpQuickMoveMemory()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00028">MmDbgReadCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, and <a class="el" href="../../d0/d4/localrtl_8c-source.html#l00032">Pattern</a>.
<p>
<pre class="fragment"><div>03336                    :
03337 
03338     This function implements a memory pattern searcher.  This will
03339     find an instance of a pattern that begins in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range
03340     SearchAddress..SearchAddress+SearchLength.  The pattern may
03341     end outside of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range.
03342 
03343 Arguments:
03344 
03345     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
03346 
03347     AdditionalData - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pattern to search <span class="keywordflow">for</span>
03348 
03349     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
03350 
03351 Return Value:
03352 
03353     None.
03354 
03355 --*/
03356 
03357 {
03358     PUCHAR <a class="code" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a> = AdditionalData-&gt;Buffer;
03359     ULONG_PTR StartAddress = (ULONG_PTR)m-&gt;u.SearchMemory.SearchAddress;
03360     ULONG_PTR EndAddress = (ULONG_PTR)(StartAddress + m-&gt;u.SearchMemory.SearchLength);
03361     ULONG PatternLength = m-&gt;u.SearchMemory.PatternLength;
03362 
03363     STRING MessageHeader;
03364     ULONG MaskIndex;
03365     PUCHAR PatternTail;
03366     PUCHAR DataTail;
03367     ULONG TailLength;
03368     ULONG Data;
03369     ULONG FirstWordPattern[4];
03370     ULONG FirstWordMask[4];
03371 
03372 
03373     <span class="comment">//</span>
03374     <span class="comment">// On failure, return STATUS_NO_MORE_ENTRIES.  DON'T RETURN</span>
03375     <span class="comment">// STATUS_UNSUCCESSFUL!  That return status indicates that the</span>
03376     <span class="comment">// operation is not supported, and the debugger will fall back</span>
03377     <span class="comment">// to a debugger-side search.</span>
03378     <span class="comment">//</span>
03379 
03380     m-&gt;ReturnStatus = STATUS_NO_MORE_ENTRIES;
03381 
03382     <span class="comment">//</span>
03383     <span class="comment">// Do a fast search for the beginning of the pattern</span>
03384     <span class="comment">//</span>
03385 
03386     <span class="keywordflow">if</span> (PatternLength &gt; 3) {
03387         FirstWordMask[0] = 0xffffffff;
03388     } <span class="keywordflow">else</span> {
03389         FirstWordMask[0] = 0xffffffff &gt;&gt; (8*(4-PatternLength));
03390     }
03391 
03392     FirstWordMask[1] = FirstWordMask[0] &lt;&lt; 8;
03393     FirstWordMask[2] = FirstWordMask[1] &lt;&lt; 8;
03394     FirstWordMask[3] = FirstWordMask[2] &lt;&lt; 8;
03395 
03396     FirstWordPattern[0] = 0;
03397     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>((PVOID)FirstWordPattern,
03398                        Pattern,
03399                        PatternLength &lt; 5 ? PatternLength : 4);
03400 
03401     FirstWordPattern[1] = FirstWordPattern[0] &lt;&lt; 8;
03402     FirstWordPattern[2] = FirstWordPattern[1] &lt;&lt; 8;
03403     FirstWordPattern[3] = FirstWordPattern[2] &lt;&lt; 8;
03404 
03405 
03406 <span class="comment">/*</span>
03407 <span class="comment">{</span>
03408 <span class="comment">    int i;</span>
03409 <span class="comment">    for (i = 0; i &lt; (int)PatternLength; i++) {</span>
03410 <span class="comment">        KdpDprintf("%08x: %02x\n", &amp;Pattern[i], Pattern[i]);</span>
03411 <span class="comment">    }</span>
03412 <span class="comment">    for (i = 0; i &lt; 4; i++) {</span>
03413 <span class="comment">        KdpDprintf("%d: %08x %08x\n", i, FirstWordPattern[i], FirstWordMask[i]);</span>
03414 <span class="comment">    }</span>
03415 <span class="comment">}</span>
03416 <span class="comment">*/</span>
03417 
03418 
03419 
03420     <span class="comment">//</span>
03421     <span class="comment">// Get starting mask</span>
03422     <span class="comment">//</span>
03423 
03424     MaskIndex = StartAddress &amp; 3;
03425     StartAddress = StartAddress &amp; ~3;
03426 
03427     <span class="comment">//</span>
03428     <span class="comment">// check that the starting page is available</span>
03429     <span class="comment">//</span>
03430 
03431     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>((PVOID)StartAddress) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03432         StartAddress = (StartAddress + <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) &amp; ~(<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>-1);
03433         MaskIndex = 0;
03434     }
03435 
03436     <span class="keywordflow">while</span> (StartAddress &lt; EndAddress) {
03437 
03438         <span class="comment">//</span>
03439         <span class="comment">// check when starting a new page</span>
03440         <span class="comment">//</span>
03441         <span class="keywordflow">if</span> ((StartAddress &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>-1)) == 0) {
03442             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>((PVOID)StartAddress) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03443                 StartAddress = StartAddress + <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
03444                 <span class="keywordflow">continue</span>;
03445             }
03446         }
03447 
03448         <span class="comment">//</span>
03449         <span class="comment">// search for a match in each of the 4 starting positions</span>
03450         <span class="comment">//</span>
03451 
03452         Data = *(ULONG*)StartAddress;
03453 <span class="comment">//KdpDprintf("\n%08x: %08x ", StartAddress, Data);</span>
03454 
03455         <span class="keywordflow">for</span> ( ; MaskIndex &lt; 4; MaskIndex++) {
03456 <span class="comment">//KdpDprintf(" %d", MaskIndex);</span>
03457 
03458             <span class="keywordflow">if</span> ( (Data &amp; FirstWordMask[MaskIndex]) == FirstWordPattern[MaskIndex]) {
03459 
03460                 <span class="comment">//</span>
03461                 <span class="comment">// first word matched</span>
03462                 <span class="comment">//</span>
03463 
03464                 <span class="keywordflow">if</span> ( (4-MaskIndex) &gt;= PatternLength ) {
03465 
03466                     <span class="comment">//</span>
03467                     <span class="comment">// string is all in this word; good match</span>
03468                     <span class="comment">//</span>
03469 <span class="comment">//KdpDprintf(" %d hit, complete\n", MaskIndex);</span>
03470 
03471                     m-&gt;u.SearchMemory.FoundAddress = StartAddress + MaskIndex;
03472                     m-&gt;ReturnStatus = STATUS_SUCCESS;
03473                     <span class="keywordflow">goto</span> done;
03474 
03475                 } <span class="keywordflow">else</span> {
03476 
03477                     <span class="comment">//</span>
03478                     <span class="comment">// string is longer; see if tail matches</span>
03479                     <span class="comment">//</span>
03480 <span class="comment">//KdpDprintf(" %d hit, check tail\n", MaskIndex);</span>
03481 
03482                     PatternTail = <a class="code" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a> + 4 - MaskIndex;
03483                     DataTail = (PUCHAR)StartAddress + 4;
03484                     TailLength = PatternLength - 4 + MaskIndex;
03485 
03486 <span class="comment">//KdpDprintf("Pattern == %08x\n", Pattern);</span>
03487 <span class="comment">//KdpDprintf("PatternTail == %08x\n", PatternTail);</span>
03488 <span class="comment">//KdpDprintf("DataTail == %08x\n", DataTail);</span>
03489 
03490                     <span class="keywordflow">while</span> (TailLength) {
03491                         <span class="keywordflow">if</span> ( ((ULONG_PTR)DataTail &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>-1)) == 0 &amp;&amp;
03492                              <a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(DataTail) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03493 <span class="comment">//KdpDprintf("Tail failed: page not present at %08x\n", DataTail);</span>
03494                             <span class="keywordflow">break</span>;
03495                         } <span class="keywordflow">else</span>
03496 {
03497 <span class="comment">//KdpDprintf("D: %02x  P: %02x\n", *DataTail, *PatternTail);</span>
03498 
03499                         <span class="keywordflow">if</span> (*DataTail != *PatternTail) {
03500 <span class="comment">//KdpDprintf("Tail failed at %08x\n", DataTail);</span>
03501                             <span class="keywordflow">break</span>;
03502                         } <span class="keywordflow">else</span> {
03503                             DataTail++;
03504                             PatternTail++;
03505                             TailLength--;
03506                         }
03507 }
03508                     }
03509 
03510                     <span class="keywordflow">if</span> (TailLength == 0) {
03511 
03512                         <span class="comment">//</span>
03513                         <span class="comment">// A winner</span>
03514                         <span class="comment">//</span>
03515 
03516                         m-&gt;u.SearchMemory.FoundAddress = StartAddress + MaskIndex;
03517                         m-&gt;ReturnStatus = STATUS_SUCCESS;
03518                         <span class="keywordflow">goto</span> done;
03519 
03520                     }
03521                 }
03522             }
03523         }
03524 
03525         StartAddress += 4;
03526         MaskIndex = 0;
03527     }
03528 
03529 done:
03530 <span class="comment">//KdpDprintf("\n");</span>
03531     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
03532     MessageHeader.Buffer = (PCHAR)m;
03533 
03534     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
03535         PACKET_TYPE_KD_STATE_MANIPULATE,
03536         &amp;MessageHeader,
03537         NULL
03538         );
03539 
03540 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="kdapi.c::KdpSendWaitContinue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a> KdpSendWaitContinue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>OutPacketType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>OutMessageHeader</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING OutMessageData&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">847</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a408a226">ContinueError</a>, <a class="el" href="../../d4/d9/ke_8h.html#a408a227">ContinueSuccess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00353">KCONTINUE_STATUS</a>, <a class="el" href="../../d1/d7/4_2kdp_8h.html#a109">KdClearSpecialCalls()</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00133">KdDebuggerNotPresent</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00432">KDP_MESSAGE_BUFFER_SIZE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00064">KDP_PACKET_RESEND</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00063">KDP_PACKET_TIMEOUT</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l03097">KdpCauseBugCheck()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l01569">KdpGetContext()</a>, <a class="el" href="../../d6/d4/4_2alpha_2kdcpuapi_8c-source.html#l00189">KdpGetStateChange()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l02945">KdpGetVersion()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00202">KdpMessageBuffer</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l03049">KdpNotSupported()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a203">KdPortRestore()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a204">KdPortSave()</a>, <a class="el" href="../../d6/d4/4_2alpha_2kdcpuapi_8c-source.html#l00218">KdpReadControlSpace()</a>, <a class="el" href="../../d6/d4/4_2alpha_2kdcpuapi_8c-source.html#l00505">KdpReadIoSpace()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00623">KdpReadIoSpaceExtended()</a>, <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l01098">KdpReadMachineSpecificRegister()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l02643">KdpReadPhysicalMemory()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l01126">KdpReadVirtualMemory()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01215">KdpReadVirtualMemory64()</a>, <a class="el" href="../../d1/d7/alpha_2kdreboot_8c-source.html#l00025">KdpReboot()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00342">KdpReceivePacket()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l01740">KdpRestoreBreakpoint()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l03247">KdpRestoreBreakPointEx()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l03417">KdpSearchMemory()</a>, <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l01629">KdpSetContext()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l01688">KdpWriteBreakpoint()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l03125">KdpWriteBreakPointEx()</a>, <a class="el" href="../../d6/d4/4_2alpha_2kdcpuapi_8c-source.html#l00457">KdpWriteControlSpace()</a>, <a class="el" href="../../d6/d4/4_2alpha_2kdcpuapi_8c-source.html#l00785">KdpWriteIoSpace()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00899">KdpWriteIoSpaceExtended()</a>, <a class="el" href="../../d7/d4/4_2i386_2kdcpuapi_8c-source.html#l01156">KdpWriteMachineSpecificRegister()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l02779">KdpWritePhysicalMemory()</a>, <a class="el" href="../../d0/d3/4_2kdapi_8c-source.html#l01345">KdpWriteVirtualMemory()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01375">KdpWriteVirtualMemory64()</a>, <a class="el" href="../../d1/d7/4_2kdp_8h.html#a108">KdSetSpecialCall()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00334">KeSwitchFrozenProcessor()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00856                    :
00857 
00858     This function sends a packet, and then waits <span class="keywordflow">for</span> a <span class="keywordflow">continue</span> message.
00859     BreakIns received <span class="keywordflow">while</span> waiting will always cause a resend of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00860     packet originally sent <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a>.  While waiting, manipulate messages
00861     will be serviced.
00862 
00863     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> resend always resends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original event sent to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger,
00864     not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last response to some debugger command.
00865 
00866 Arguments:
00867 
00868     OutPacketType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of packet to send.
00869 
00870     OutMessageHeader - Supplies a pointer to a string descriptor that describes
00871         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message information.
00872 
00873     OutMessageData - Supplies a pointer to a string descriptor that describes
00874         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> optional message data.
00875 
00876     ContextRecord - Exception context
00877 
00878 Return Value:
00879 
00880     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">continue</span> message indicates
00881     success, Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00882 
00883 --*/
00884 
00885 {
00886 
00887     ULONG Length;
00888     STRING MessageData;
00889     STRING MessageHeader;
00890     DBGKD_MANIPULATE_STATE ManipulateState;
00891     ULONG ReturnCode;
00892     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00893     <a class="code" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a> ContinueStatus;
00894 
00895     <span class="comment">//</span>
00896     <span class="comment">// Loop servicing state manipulation message until a continue message</span>
00897     <span class="comment">// is received.</span>
00898     <span class="comment">//</span>
00899 
00900     MessageHeader.MaximumLength = <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
00901     MessageHeader.Buffer = (PCHAR)&amp;ManipulateState;
00902     MessageData.MaximumLength = <a class="code" href="../../d0/d7/kdp_8h.html#a14">KDP_MESSAGE_BUFFER_SIZE</a>;
00903     MessageData.Buffer = (PCHAR)<a class="code" href="../../d8/d5/kddata_8c.html#a52">KdpMessageBuffer</a>;
00904 
00905 ResendPacket:
00906 
00907     <span class="comment">//</span>
00908     <span class="comment">// Send event notification packet to debugger on host.  Come back</span>
00909     <span class="comment">// here any time we see a breakin sequence.</span>
00910     <span class="comment">//</span>
00911 
00912     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00913                   OutPacketType,
00914                   OutMessageHeader,
00915                   OutMessageData
00916                   );
00917 
00918     <span class="comment">//</span>
00919     <span class="comment">// After sending packet, if there is no response from debugger</span>
00920     <span class="comment">// AND the packet is for reporting symbol (un)load, the debugger</span>
00921     <span class="comment">// will be declared to be not present.  Note If the packet is for</span>
00922     <span class="comment">// reporting exception, the KdpSendPacket will never stop.</span>
00923     <span class="comment">//</span>
00924 
00925     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a12">KdDebuggerNotPresent</a>) {
00926         <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a408a227">ContinueSuccess</a>;
00927     }
00928 
00929     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00930 
00931         <span class="comment">//</span>
00932         <span class="comment">// Wait for State Manipulate Packet without timeout.</span>
00933         <span class="comment">//</span>
00934 
00935         <span class="keywordflow">do</span> {
00936 
00937             ReturnCode = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a112">KdpReceivePacket</a>(
00938                             PACKET_TYPE_KD_STATE_MANIPULATE,
00939                             &amp;MessageHeader,
00940                             &amp;MessageData,
00941                             &amp;Length
00942                             );
00943             <span class="keywordflow">if</span> (ReturnCode == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d0/d7/kdp_8h.html#a11">KDP_PACKET_RESEND</a>) {
00944                 <span class="keywordflow">goto</span> ResendPacket;
00945             }
00946         } <span class="keywordflow">while</span> (ReturnCode == <a class="code" href="../../d0/d7/kdp_8h.html#a10">KDP_PACKET_TIMEOUT</a>);
00947 
00948         <span class="comment">//</span>
00949         <span class="comment">// Switch on the return message API number.</span>
00950         <span class="comment">//</span>
00951 
00952         <span class="keywordflow">switch</span> (ManipulateState.ApiNumber) {
00953 
00954         <span class="keywordflow">case</span> DbgKdReadVirtualMemoryApi:
00955             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a123">KdpReadVirtualMemory</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00956             <span class="keywordflow">break</span>;
00957 
00958         <span class="keywordflow">case</span> DbgKdReadVirtualMemory64Api:
00959             <a class="code" href="../../d0/d7/kdp_8h.html#a110">KdpReadVirtualMemory64</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00960             <span class="keywordflow">break</span>;
00961 
00962         <span class="keywordflow">case</span> DbgKdWriteVirtualMemoryApi:
00963             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a124">KdpWriteVirtualMemory</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00964             <span class="keywordflow">break</span>;
00965 
00966         <span class="keywordflow">case</span> DbgKdWriteVirtualMemory64Api:
00967             <a class="code" href="../../d0/d7/kdp_8h.html#a112">KdpWriteVirtualMemory64</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00968             <span class="keywordflow">break</span>;
00969 
00970         <span class="keywordflow">case</span> DbgKdReadPhysicalMemoryApi:
00971             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a125">KdpReadPhysicalMemory</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00972             <span class="keywordflow">break</span>;
00973 
00974         <span class="keywordflow">case</span> DbgKdWritePhysicalMemoryApi:
00975             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a126">KdpWritePhysicalMemory</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00976             <span class="keywordflow">break</span>;
00977 
00978         <span class="keywordflow">case</span> DbgKdGetContextApi:
00979             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a128">KdpGetContext</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00980             <span class="keywordflow">break</span>;
00981 
00982         <span class="keywordflow">case</span> DbgKdSetContextApi:
00983             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a129">KdpSetContext</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00984             <span class="keywordflow">break</span>;
00985 
00986         <span class="keywordflow">case</span> DbgKdWriteBreakPointApi:
00987             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a130">KdpWriteBreakpoint</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00988             <span class="keywordflow">break</span>;
00989 
00990         <span class="keywordflow">case</span> DbgKdRestoreBreakPointApi:
00991             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a131">KdpRestoreBreakpoint</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00992             <span class="keywordflow">break</span>;
00993 
00994         <span class="keywordflow">case</span> DbgKdReadControlSpaceApi:
00995             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a132">KdpReadControlSpace</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
00996             <span class="keywordflow">break</span>;
00997 
00998         <span class="keywordflow">case</span> DbgKdWriteControlSpaceApi:
00999             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a133">KdpWriteControlSpace</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01000             <span class="keywordflow">break</span>;
01001 
01002         <span class="keywordflow">case</span> DbgKdReadIoSpaceApi:
01003             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a134">KdpReadIoSpace</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01004             <span class="keywordflow">break</span>;
01005 
01006         <span class="keywordflow">case</span> DbgKdWriteIoSpaceApi:
01007             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a136">KdpWriteIoSpace</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01008             <span class="keywordflow">break</span>;
01009 
01010 <span class="preprocessor">#ifdef _ALPHA_</span>
01011 <span class="preprocessor"></span>
01012         <span class="keywordflow">case</span> DbgKdReadIoSpaceExtendedApi:
01013             <a class="code" href="../../d7/d7/4_2axp64_2kdpcpu_8h.html#a10">KdpReadIoSpaceExtended</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01014             <span class="keywordflow">break</span>;
01015 
01016         <span class="keywordflow">case</span> DbgKdWriteIoSpaceExtendedApi:
01017             <a class="code" href="../../d7/d7/4_2axp64_2kdpcpu_8h.html#a11">KdpWriteIoSpaceExtended</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01018             <span class="keywordflow">break</span>;
01019 
01020 <span class="preprocessor">#endif // _ALPHA_</span>
01021 <span class="preprocessor"></span>
01022         <span class="keywordflow">case</span> DbgKdContinueApi:
01023             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ManipulateState.u.Continue.ContinueStatus) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01024                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a408a227">ContinueSuccess</a>;
01025             } <span class="keywordflow">else</span> {
01026                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a408a226">ContinueError</a>;
01027             }
01028             <span class="keywordflow">break</span>;
01029 
01030         <span class="keywordflow">case</span> DbgKdContinueApi2:
01031             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ManipulateState.u.Continue2.ContinueStatus) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01032                 <a class="code" href="../../d1/d7/4_2kdp_8h.html#a115">KdpGetStateChange</a>(&amp;ManipulateState,ContextRecord);
01033                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a408a227">ContinueSuccess</a>;
01034             } <span class="keywordflow">else</span> {
01035                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a408a226">ContinueError</a>;
01036             }
01037             <span class="keywordflow">break</span>;
01038 
01039         <span class="keywordflow">case</span> DbgKdRebootApi:
01040             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a101">KdpReboot</a>();
01041             <span class="keywordflow">break</span>;
01042 
01043 <span class="preprocessor">#if i386</span>
01044 <span class="preprocessor"></span>        <span class="keywordflow">case</span> DbgKdReadMachineSpecificRegister:
01045             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a135">KdpReadMachineSpecificRegister</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01046             <span class="keywordflow">break</span>;
01047 
01048         <span class="keywordflow">case</span> DbgKdWriteMachineSpecificRegister:
01049             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a137">KdpWriteMachineSpecificRegister</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01050             <span class="keywordflow">break</span>;
01051 
01052         <span class="keywordflow">case</span> DbgKdSetSpecialCallApi:
01053             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a108">KdSetSpecialCall</a>(&amp;ManipulateState,ContextRecord);
01054             <span class="keywordflow">break</span>;
01055 
01056         <span class="keywordflow">case</span> DbgKdClearSpecialCallsApi:
01057             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a109">KdClearSpecialCalls</a>();
01058             <span class="keywordflow">break</span>;
01059 
01060         <span class="keywordflow">case</span> DbgKdSetInternalBreakPointApi:
01061             KdSetInternalBreakpoint(&amp;ManipulateState);
01062             <span class="keywordflow">break</span>;
01063 
01064         <span class="keywordflow">case</span> DbgKdGetInternalBreakPointApi:
01065             KdGetInternalBreakpoint(&amp;ManipulateState);
01066             <span class="keywordflow">break</span>;
01067 <span class="preprocessor">#endif</span>
01068 <span class="preprocessor"></span>
01069         <span class="keywordflow">case</span> DbgKdGetVersionApi:
01070             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a7">KdpGetVersion</a>(&amp;ManipulateState);
01071             <span class="keywordflow">break</span>;
01072 
01073         <span class="keywordflow">case</span> DbgKdCauseBugCheckApi:
01074             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a9">KdpCauseBugCheck</a>(&amp;ManipulateState);
01075             <span class="keywordflow">break</span>;
01076 
01077         <span class="keywordflow">case</span> DbgKdPageInApi:
01078             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a8">KdpNotSupported</a>(&amp;ManipulateState);
01079             <span class="keywordflow">break</span>;
01080 
01081         <span class="keywordflow">case</span> DbgKdWriteBreakPointExApi:
01082             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a10">KdpWriteBreakPointEx</a>(&amp;ManipulateState,
01083                                           &amp;MessageData,
01084                                           ContextRecord);
01085             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) {
01086                 ManipulateState.ApiNumber = DbgKdContinueApi;
01087                 ManipulateState.u.Continue.ContinueStatus = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01088                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a408a226">ContinueError</a>;
01089             }
01090             <span class="keywordflow">break</span>;
01091 
01092         <span class="keywordflow">case</span> DbgKdRestoreBreakPointExApi:
01093             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a11">KdpRestoreBreakPointEx</a>(&amp;ManipulateState,&amp;MessageData,ContextRecord);
01094             <span class="keywordflow">break</span>;
01095 
01096         <span class="keywordflow">case</span> DbgKdSwitchProcessor:
01097             <a class="code" href="../../d2/d7/hal_8h.html#a203">KdPortRestore</a> ();
01098             ContinueStatus = <a class="code" href="../../d9/d4/ke_2debug_8c.html#a11">KeSwitchFrozenProcessor</a>(ManipulateState.Processor);
01099             <a class="code" href="../../d2/d7/hal_8h.html#a204">KdPortSave</a> ();
01100             <span class="keywordflow">return</span> ContinueStatus;
01101 
01102         <span class="keywordflow">case</span> DbgKdSearchMemoryApi:
01103             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a12">KdpSearchMemory</a>(&amp;ManipulateState, &amp;MessageData, ContextRecord);
01104             <span class="keywordflow">break</span>;
01105 
01106             <span class="comment">//</span>
01107             <span class="comment">// Invalid message.</span>
01108             <span class="comment">//</span>
01109 
01110         <span class="keywordflow">default</span>:
01111             MessageData.Length = 0;
01112             ManipulateState.ReturnStatus = STATUS_UNSUCCESSFUL;
01113             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(PACKET_TYPE_KD_STATE_MANIPULATE, &amp;MessageHeader, &amp;MessageData);
01114             <span class="keywordflow">break</span>;
01115         }
01116 
01117 <span class="preprocessor">#ifdef _ALPHA_</span>
01118 <span class="preprocessor"></span>
01119         <span class="comment">//</span>
01120         <span class="comment">//jnfix</span>
01121         <span class="comment">// this is embarrasing, we have an icache coherency problem that</span>
01122         <span class="comment">// the following imb fixes, later we must track this down to the</span>
01123         <span class="comment">// exact offending API but for now this statement allows the stub</span>
01124         <span class="comment">// work to appropriately for Alpha.</span>
01125         <span class="comment">//</span>
01126 
01127 <span class="preprocessor">#if defined(_MSC_VER)</span>
01128 <span class="preprocessor"></span>        __PAL_IMB();
01129 <span class="preprocessor">#else</span>
01130 <span class="preprocessor"></span>        <span class="keyword">asm</span>( <span class="stringliteral">"call_pal 0x86"</span> );   <span class="comment">// x86 = imb</span>
01131 <span class="preprocessor">#endif</span>
01132 <span class="preprocessor"></span>
01133 <span class="preprocessor">#endif</span>
01134 <span class="preprocessor"></span>
01135     }
01136 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="kdapi.c::KdpSetContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSetContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01521">1521</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>01529                    :
01530 
01531     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a set context state
01532     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
01533     context.
01534 
01535 Arguments:
01536 
01537     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01538 
01539     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01540 
01541     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01542 
01543 Return Value:
01544 
01545     None.
01546 
01547 --*/
01548 
01549 {
01550     PDBGKD_SET_CONTEXT a = &amp;m-&gt;u.SetContext;
01551     STRING MessageHeader;
01552 
01553     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01554     MessageHeader.Buffer = (PCHAR)m;
01555 
01556     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == <span class="keyword">sizeof</span>(CONTEXT));
01557 
01558     <span class="keywordflow">if</span> (m-&gt;Processor &gt;= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>) {
01559         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01560     } <span class="keywordflow">else</span> {
01561         m-&gt;ReturnStatus = STATUS_SUCCESS;
01562         <span class="keywordflow">if</span> (m-&gt;Processor == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number) {
01563             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>((PCHAR)Context, AdditionalData-&gt;Buffer, <span class="keyword">sizeof</span>(CONTEXT));
01564         } <span class="keywordflow">else</span> {
01565             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>((PCHAR)&amp;KiProcessorBlock[m-&gt;Processor]-&gt;ProcessorState.ContextFrame,
01566                           AdditionalData-&gt;Buffer,
01567                           <span class="keyword">sizeof</span>(CONTEXT)
01568                          );
01569         }
01570     }
01571 
01572     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01573                   PACKET_TYPE_KD_STATE_MANIPULATE,
01574                   &amp;MessageHeader,
01575                   NULL
01576                   );
01577 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="kdapi.c::KdpSwitchProcessor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpSwitchProcessor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SecondChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02318">2318</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>.
<p>
<pre class="fragment"><div>02323 {
02324     BOOLEAN <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02325 
02326     <span class="comment">//</span>
02327     <span class="comment">// Save port state</span>
02328     <span class="comment">//</span>
02329 
02330     <a class="code" href="../../d2/d7/hal_8h.html#a204">KdPortSave</a> ();
02331 
02332     <span class="comment">//</span>
02333     <span class="comment">// Process state change for this processor</span>
02334     <span class="comment">//</span>
02335 
02336     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a120">KdpReportExceptionStateChange</a> (
02337                 ExceptionRecord,
02338                 ContextRecord,
02339                 SecondChance
02340                 );
02341 
02342     <span class="comment">//</span>
02343     <span class="comment">// Restore port state and return status</span>
02344     <span class="comment">//</span>
02345 
02346     <a class="code" href="../../d2/d7/hal_8h.html#a203">KdPortRestore</a> ();
02347     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02348 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="kdapi.c::KdpTimeSlipDpcRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpTimeSlipDpcRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d6/struct__KDPC.html">PKDPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00494">494</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>.
<p>
<pre class="fragment"><div>00500 {
00501     LONG OldCount, NewCount, j;
00502 
00503     <span class="comment">//</span>
00504     <span class="comment">// Reset pending count.  If the current count is 1, then clear</span>
00505     <span class="comment">// the pending count.  if the current count is greater then 1,</span>
00506     <span class="comment">// then set to one and update the time now.</span>
00507     <span class="comment">//</span>
00508 
00509     j = <a class="code" href="../../d8/d5/kddata_8c.html#a103">KdpTimeSlipPending</a>;
00510     <span class="keywordflow">do</span> {
00511         OldCount = j;
00512         NewCount = OldCount &gt; 1 ? 1 : 0;
00513 
00514         j = InterlockedCompareExchange(&amp;KdpTimeSlipPending, NewCount, OldCount);
00515 
00516     } <span class="keywordflow">while</span> (j != OldCount);
00517 
00518     <span class="comment">//</span>
00519     <span class="comment">// If new count is non-zero, then process a time slip now</span>
00520     <span class="comment">//</span>
00521 
00522     <span class="keywordflow">if</span> (NewCount) {
00523         <a class="code" href="../../d5/d8/ex_8h.html#a261">ExQueueWorkItem</a>(&amp;KdpTimeSlipWorkItem, DelayedWorkQueue);
00524     }
00525 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="kdapi.c::KdpTimeSlipWork" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpTimeSlipWork           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Context</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00528">528</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>.
<p>
<pre class="fragment"><div>00531 {
00532     KIRQL               OldIrql;
00533     LARGE_INTEGER       DueTime;
00534 
00535     <span class="comment">//</span>
00536     <span class="comment">// Update time from the real time clock</span>
00537     <span class="comment">//</span>
00538 
00539     <a class="code" href="../../d5/d8/ex_8h.html#a312">ExAcquireTimeRefreshLock</a>();
00540     <a class="code" href="../../d5/d8/ex_8h.html#a314">ExUpdateSystemTimeFromCmos</a> (FALSE, 0);
00541     <a class="code" href="../../d5/d8/ex_8h.html#a313">ExReleaseTimeRefreshLock</a>();
00542 
00543     <span class="comment">//</span>
00544     <span class="comment">// If there's a time service installed, signal it's time slip event</span>
00545     <span class="comment">//</span>
00546 
00547     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>(&amp;KdpTimeSlipEventLock, &amp;OldIrql);
00548     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a99">KdpTimeSlipEvent</a>) {
00549         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a> (KdpTimeSlipEvent, 0, FALSE);
00550     }
00551     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KdpTimeSlipEventLock, OldIrql);
00552 
00553     <span class="comment">//</span>
00554     <span class="comment">// Insert a forced delay between time slip operations</span>
00555     <span class="comment">//</span>
00556 
00557     DueTime.QuadPart = -1800000000;
00558     <a class="code" href="../../d3/d2/timerobj_8c.html#a6">KeSetTimer</a> (&amp;KdpTimeSlipTimer, DueTime, &amp;KdpTimeSlipDpc);
00559 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="kdapi.c::KdpWriteBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01580">1580</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>01588                    :
01589 
01590     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write breakpoint state
01591     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write a breakpoint
01592     and <span class="keywordflow">return</span> a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint.
01593 
01594 Arguments:
01595 
01596     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01597 
01598     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
01599 
01600     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01601 
01602 Return Value:
01603 
01604     None.
01605 
01606 --*/
01607 
01608 {
01609     PDBGKD_WRITE_BREAKPOINT a = &amp;m-&gt;u.WriteBreakPoint;
01610     STRING MessageHeader;
01611 
01612     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
01613     MessageHeader.Buffer = (PCHAR)m;
01614 
01615     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
01616 
01617     a-&gt;BreakPointHandle = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a104">KdpAddBreakpoint</a>(a-&gt;BreakPointAddress);
01618     <span class="keywordflow">if</span> (a-&gt;BreakPointHandle != 0) {
01619         m-&gt;ReturnStatus = STATUS_SUCCESS;
01620     } <span class="keywordflow">else</span> {
01621         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01622     }
01623     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
01624                   PACKET_TYPE_KD_STATE_MANIPULATE,
01625                   &amp;MessageHeader,
01626                   NULL
01627                   );
01628     UNREFERENCED_PARAMETER(Context);
01629 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="kdapi.c::KdpWriteBreakPointEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KdpWriteBreakPointEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03035">3035</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00060">KdpAddBreakpoint()</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, and <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>.
<p>
<pre class="fragment"><div>03043                    :
03044 
03045     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write breakpoint state 'ex'
03046     manipulation message.  Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to clear breakpoints, write
03047     <span class="keyword">new</span> breakpoints, and <span class="keywordflow">continue</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target system.  The clearing of
03048     breakpoints <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> conditional based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> presence of breakpoint handles.
03049     The setting of breakpoints <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> conditional based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> presence of
03050     valid, non-zero, addresses.  The continueing of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target system
03051     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> conditional based on a non-zero continuestatus.
03052 
03053     This api allows a debugger to clear breakpoints, add <span class="keyword">new</span> breakpoint,
03054     and <span class="keywordflow">continue</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target system all in one api packet.  This reduces <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03055     amount of traffic across <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wire and greatly improves source stepping.
03056 
03057 
03058 Arguments:
03059 
03060     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
03061 
03062     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
03063 
03064     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
03065 
03066 Return Value:
03067 
03068     None.
03069 
03070 --*/
03071 
03072 {
03073     PDBGKD_BREAKPOINTEX       a = &amp;m-&gt;u.BreakPointEx;
03074     PDBGKD_WRITE_BREAKPOINT   b;
03075     STRING                    MessageHeader;
03076     ULONG                     i;
03077     DBGKD_WRITE_BREAKPOINT    BpBuf[BREAKPOINT_TABLE_SIZE];
03078 
03079 
03080     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
03081     MessageHeader.Buffer = (PCHAR)m;
03082 
03083     <span class="comment">//</span>
03084     <span class="comment">// verify that the packet size is correct</span>
03085     <span class="comment">//</span>
03086     <span class="keywordflow">if</span> (AdditionalData-&gt;Length !=
03087                          a-&gt;BreakPointCount*<span class="keyword">sizeof</span>(DBGKD_WRITE_BREAKPOINT)) {
03088         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
03089         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
03090                       PACKET_TYPE_KD_STATE_MANIPULATE,
03091                       &amp;MessageHeader,
03092                       AdditionalData
03093                       );
03094         <span class="keywordflow">return</span> m-&gt;ReturnStatus;
03095     }
03096 
03097     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PUCHAR)BpBuf,
03098                   AdditionalData-&gt;Buffer,
03099                   a-&gt;BreakPointCount*<span class="keyword">sizeof</span>(DBGKD_WRITE_BREAKPOINT));
03100 
03101     <span class="comment">//</span>
03102     <span class="comment">// assume success</span>
03103     <span class="comment">//</span>
03104     m-&gt;ReturnStatus = STATUS_SUCCESS;
03105 
03106     <span class="comment">//</span>
03107     <span class="comment">// loop thru the breakpoint handles passed in from the debugger and</span>
03108     <span class="comment">// clear any breakpoint that has a non-zero handle</span>
03109     <span class="comment">//</span>
03110     b = BpBuf;
03111     <span class="keywordflow">for</span> (i=0; i&lt;a-&gt;BreakPointCount; i++,b++) {
03112         <span class="keywordflow">if</span> (b-&gt;BreakPointHandle) {
03113             <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(b-&gt;BreakPointHandle)) {
03114                 m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
03115             }
03116             b-&gt;BreakPointHandle = 0;
03117         }
03118     }
03119 
03120     <span class="comment">//</span>
03121     <span class="comment">// loop thru the breakpoint addesses passed in from the debugger and</span>
03122     <span class="comment">// add any new breakpoints that have a non-zero address</span>
03123     <span class="comment">//</span>
03124     b = BpBuf;
03125     <span class="keywordflow">for</span> (i=0; i&lt;a-&gt;BreakPointCount; i++,b++) {
03126         <span class="keywordflow">if</span> (b-&gt;BreakPointAddress) {
03127             b-&gt;BreakPointHandle = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a104">KdpAddBreakpoint</a>( b-&gt;BreakPointAddress );
03128             <span class="keywordflow">if</span> (!b-&gt;BreakPointHandle) {
03129                 m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
03130             }
03131         }
03132     }
03133 
03134     <span class="comment">//</span>
03135     <span class="comment">// send back our response</span>
03136     <span class="comment">//</span>
03137 
03138     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(AdditionalData-&gt;Buffer,
03139                   (PUCHAR)BpBuf,
03140                   a-&gt;BreakPointCount*<span class="keyword">sizeof</span>(DBGKD_WRITE_BREAKPOINT));
03141 
03142     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
03143                   PACKET_TYPE_KD_STATE_MANIPULATE,
03144                   &amp;MessageHeader,
03145                   AdditionalData
03146                   );
03147 
03148     <span class="comment">//</span>
03149     <span class="comment">// return the caller's continue status value.  if this is a non-zero</span>
03150     <span class="comment">// value the system is continued using this value as the continuestatus.</span>
03151     <span class="comment">//</span>
03152     <span class="keywordflow">return</span> a-&gt;ContinueStatus;
03153 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="kdapi.c::KdpWritePhysicalMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWritePhysicalMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02680">2680</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>02688                    :
02689 
02690     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response to a write physical memory
02691     state manipulation message. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write physical memory
02692     and <span class="keywordflow">return</span>.
02693 
02694 Arguments:
02695 
02696     m - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
02697 
02698     AdditionalData - Supplies any additional data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message.
02699 
02700     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
02701 
02702 Return Value:
02703 
02704     None.
02705 
02706 --*/
02707 
02708 {
02709     PDBGKD_WRITE_MEMORY a = &amp;m-&gt;u.WriteMemory;
02710     ULONG Length;
02711     STRING MessageHeader;
02712     PVOID VirtualAddress;
02713     PHYSICAL_ADDRESS Destination;
02714     PUCHAR Source;
02715     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> NumberBytes;
02716     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> BytesLeft;
02717 
02718     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
02719     MessageHeader.Buffer = (PCHAR)m;
02720 
02721 
02722     <span class="comment">//</span>
02723     <span class="comment">// Since the MmDbgTranslatePhysicalAddress only maps in one physical</span>
02724     <span class="comment">// page at a time, we need to break the memory move up into smaller</span>
02725     <span class="comment">// moves which don't cross page boundaries.  There are two cases we</span>
02726     <span class="comment">// need to deal with.  The area to be moved may start and end on the</span>
02727     <span class="comment">// same page, or it may start and end on different pages (with an</span>
02728     <span class="comment">// arbitrary number of pages in between)</span>
02729     <span class="comment">//</span>
02730     Destination.QuadPart = (ULONG_PTR)a-&gt;TargetBaseAddress;
02731     Source = AdditionalData-&gt;Buffer;
02732     BytesLeft = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) a-&gt;TransferCount;
02733     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d1/mm_8h.html#a7">PAGE_ALIGN</a>((PUCHAR)Destination.LowPart) ==
02734        <a class="code" href="../../d2/d1/mm_8h.html#a7">PAGE_ALIGN</a>((PUCHAR)(Destination.LowPart)+BytesLeft)) {
02735         <span class="comment">//</span>
02736         <span class="comment">// Memory move starts and ends on the same page.</span>
02737         <span class="comment">//</span>
02738         VirtualAddress=<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a4">MmDbgTranslatePhysicalAddress</a>(Destination);
02739         Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02740                                        VirtualAddress,
02741                                        Source,
02742                                        BytesLeft
02743                                       );
02744         BytesLeft -= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) Length;
02745     } <span class="keywordflow">else</span> {
02746         <span class="comment">//</span>
02747         <span class="comment">// Memory move spans page boundaries</span>
02748         <span class="comment">//</span>
02749         VirtualAddress=<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a4">MmDbgTranslatePhysicalAddress</a>(Destination);
02750         NumberBytes = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - <a class="code" href="../../d2/d1/mm_8h.html#a6">BYTE_OFFSET</a>(VirtualAddress));
02751         Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02752                                        VirtualAddress,
02753                                        Source,
02754                                        NumberBytes
02755                                       );
02756         Source += NumberBytes;
02757         Destination.LowPart += NumberBytes;
02758         BytesLeft -= NumberBytes;
02759         <span class="keywordflow">while</span>(BytesLeft &gt; 0) {
02760             <span class="comment">//</span>
02761             <span class="comment">// Transfer a full page or the last bit,</span>
02762             <span class="comment">// whichever is smaller.</span>
02763             <span class="comment">//</span>
02764             VirtualAddress = <a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a4">MmDbgTranslatePhysicalAddress</a>(Destination);
02765             NumberBytes = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) ((<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> &lt; BytesLeft) ? <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> : BytesLeft);
02766             Length += (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
02767                                             VirtualAddress,
02768                                             Source,
02769                                             NumberBytes
02770                                            );
02771             Source += NumberBytes;
02772             Destination.LowPart += NumberBytes;
02773             BytesLeft -= NumberBytes;
02774         }
02775     }
02776 
02777 
02778     <span class="keywordflow">if</span> (Length == AdditionalData-&gt;Length) {
02779         m-&gt;ReturnStatus = STATUS_SUCCESS;
02780     } <span class="keywordflow">else</span> {
02781         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
02782     }
02783 
02784     a-&gt;ActualBytesWritten = Length;
02785 
02786     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
02787                   PACKET_TYPE_KD_STATE_MANIPULATE,
02788                   &amp;MessageHeader,
02789                   NULL
02790                   );
02791     UNREFERENCED_PARAMETER(Context);
02792 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="kdapi.c::KdpWriteVirtualMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteVirtualMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01308">1308</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
<pre class="fragment"><div>01316                    :
01317 
01318     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write <span class="keyword">virtual</span> memory 32-bit
01319     state manipulation message. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write <span class="keyword">virtual</span> memory
01320     and <span class="keywordflow">return</span>.
01321 
01322 Arguments:
01323 
01324     m - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01325 
01326     AdditionalData - Supplies a pointer to a descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to write.
01327 
01328     Context - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01329 
01330 Return Value:
01331 
01332     None.
01333 
01334 --*/
01335 
01336 {
01337 
01338     ULONG Length;
01339     STRING MessageHeader;
01340 
01341     <span class="comment">//</span>
01342     <span class="comment">// Move the data to the destination buffer.</span>
01343     <span class="comment">//</span>
01344 
01345     Length = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(m-&gt;u.WriteMemory.TargetBaseAddress,
01346                            AdditionalData-&gt;Buffer,
01347                            AdditionalData-&gt;Length);
01348 
01349     <span class="comment">//</span>
01350     <span class="comment">// If all the data is written, then return a success status. Otherwise,</span>
01351     <span class="comment">// return an unsuccessful status.</span>
01352     <span class="comment">//</span>
01353 
01354     m-&gt;ReturnStatus = STATUS_SUCCESS;
01355     <span class="keywordflow">if</span> (Length != AdditionalData-&gt;Length) {
01356         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01357     }
01358 
01359     <span class="comment">//</span>
01360     <span class="comment">// Set the actual number of bytes written, initialize the message header,</span>
01361     <span class="comment">// and send the reply packet to the host debugger.</span>
01362     <span class="comment">//</span>
01363 
01364     m-&gt;u.WriteMemory.ActualBytesWritten = Length;
01365     MessageHeader.Length = <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
01366     MessageHeader.Buffer = (PCHAR)m;
01367     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(PACKET_TYPE_KD_STATE_MANIPULATE,
01368                   &amp;MessageHeader,
01369                   NULL);
01370 
01371     <span class="keywordflow">return</span>;
01372 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="kdapi.c::KdpWriteVirtualMemory64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpWriteVirtualMemory64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AdditionalData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l01375">1375</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d0/d4/kdcomio_8c-source.html#l00683">KdpSendPacket()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00194">MmDbgWriteCheck64()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00847">KdpSendWaitContinue()</a>.
<p>
<pre class="fragment"><div>01383                    :
01384 
01385     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in response of a write <span class="keyword">virtual</span> memory 64-bit
01386     state manipulation message. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to write <span class="keyword">virtual</span> memory
01387     and <span class="keywordflow">return</span>.
01388 
01389 Arguments:
01390 
01391     m - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> state manipulation message.
01392 
01393     AdditionalData - Supplies a pointer to a descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to write.
01394 
01395     Context - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current context.
01396 
01397 Return Value:
01398 
01399     None.
01400 
01401 --*/
01402 
01403 {
01404 
01405     UCHAR * POINTER_64 Address;
01406     UCHAR * POINTER_64 Destination;
01407     ULONG Length;
01408     STRING MessageHeader;
01409     PUCHAR Source;
01410     ULONG_PTR Opaque;
01411 
01412     <span class="comment">//</span>
01413     <span class="comment">// Move the data to the destination buffer.</span>
01414     <span class="comment">//</span>
01415 
01416     Length = AdditionalData-&gt;Length;
01417 
01418 <span class="preprocessor">#if defined(_MIPS_) || defined(_ALPHA_)</span>
01419 <span class="preprocessor"></span>
01420     Destination = (UCHAR * POINTER_64)m-&gt;u.WriteMemory64.TargetBaseAddress;
01421     Source = AdditionalData-&gt;Buffer;
01422     <span class="keywordflow">while</span> (Length &gt; 0) {
01423         <span class="keywordflow">if</span> ((Address = <a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a3">MmDbgWriteCheck64</a>(Destination)) == NULL64) {
01424             <span class="keywordflow">break</span>;
01425         }
01426 
01427         *Address = *Source++;
01428         Destination += 1;
01429         Length -= 1;
01430     }
01431 
01432 <span class="preprocessor">#endif</span>
01433 <span class="preprocessor"></span>
01434     <span class="comment">//</span>
01435     <span class="comment">// If all the data is written, then return a success status. Otherwise,</span>
01436     <span class="comment">// return an unsuccessful status.</span>
01437     <span class="comment">//</span>
01438 
01439     m-&gt;ReturnStatus = STATUS_SUCCESS;
01440     <span class="keywordflow">if</span> (Length != 0) {
01441         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
01442     }
01443 
01444     <span class="comment">//</span>
01445     <span class="comment">// Set the actual number of bytes written, initialize the message header,</span>
01446     <span class="comment">// and send the reply packet to the host debugger.</span>
01447     <span class="comment">//</span>
01448 
01449     m-&gt;u.WriteMemory64.ActualBytesWritten = AdditionalData-&gt;Length - Length;
01450     MessageHeader.Length = <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
01451     MessageHeader.Buffer = (PCHAR)m;
01452     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(PACKET_TYPE_KD_STATE_MANIPULATE,
01453                   &amp;MessageHeader,
01454                   NULL);
01455 
01456     <span class="keywordflow">return</span>;
01457 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="kdapi.c::KdQuerySpecialCalls" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KdQuerySpecialCalls           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RequiredLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="kdapi.c::KdSetSpecialCall" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdSetSpecialCall           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PDBGKD_MANIPULATE_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="kdapi.c::KdUpdateTimeSlipEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdUpdateTimeSlipEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00453">453</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
References <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">Event()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00289">KdpTimeSlipEvent</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00288">KdpTimeSlipEventLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>.
<p>
<pre class="fragment"><div>00459                    :
00460 
00461     Update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference to an event object which will be signalled when
00462     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger has caused <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system clock to skew.
00463 
00464 Arguments:
00465 
00466     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> - Supplies a pointer to an event object
00467 
00468 Return Value:
00469 
00470     None
00471 
00472 --*/
00473 
00474 {
00475     KIRQL OldIrql;
00476 
00477     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>(&amp;KdpTimeSlipEventLock, &amp;OldIrql);
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">// Dereference the old event and forget about it.</span>
00481     <span class="comment">// Remember the new event if there is one.</span>
00482     <span class="comment">//</span>
00483 
00484     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a99">KdpTimeSlipEvent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00485         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(KdpTimeSlipEvent);
00486     }
00487 
00488     <a class="code" href="../../d8/d5/kddata_8c.html#a99">KdpTimeSlipEvent</a> = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>;
00489 
00490     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KdpTimeSlipEventLock, OldIrql);
00491 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="kdapi.c::KdDisableCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG <a class="el" href="../../d9/d3/4_2kdapi_8c.html#a3">KdDisableCount</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00243">243</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>, and <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">KdEnableDebugger()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="kdapi.c::KdPreviouslyEnabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d9/d3/4_2kdapi_8c.html#a4">KdPreviouslyEnabled</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00244">244</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>, and <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">KdEnableDebugger()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="kdapi.c::Magic10000" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d1/d2/time_8c.html#a20">Magic10000</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00046">46</a> of file <a class="el" href="../../d9/d2/kdapi_8c-source.html">kdapi.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
