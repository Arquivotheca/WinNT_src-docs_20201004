<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dwp.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dwp.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d9/d2/dwp_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a0">DWP_DrawItem</a> (LPDRAWITEMSTRUCT lpdis)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a1">xxxDWP_SetRedraw</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fRedraw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a2">DWP_GetEnabledPopup</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndStart)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a3">xxxDWP_ProcessVirtKey</a> (UINT wKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a4">xxxDWP_Paint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a5">xxxDWP_EraseBkgnd</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, HDC hdc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a6">xxxDWP_SetCursor</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HWND hwndHit, int codeHT, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a7">xxxDWP_NCMouse</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, UINT ht, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a8">AreNonClientAreasToBePainted</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a9">xxxDWP_DoNCActivate</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, HRGN hrgnClip)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a10">xxxRedrawTitle</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT wFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a11">xxxDWP_DoCancelMode</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a12">xxxDWPPrint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdc, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HICON&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a13">DWP_GetIcon</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT uType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a14">DestroyWindowSmIcon</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HICON&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a15">xxxDWP_SetIcon</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, WPARAM wType, HICON hicoNew)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HICON&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a16">xxxCreateWindowSmIcon</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HICON hIconBig, BOOL fNotQueryDrag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/dwp_8c.html#a17">xxxDefWindowProc</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT message, WPARAM wParam, LPARAM lParam)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a8" doxytag="dwp.c::AreNonClientAreasToBePainted" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT AreNonClientAreasToBePainted           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00662">662</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00204">SYSRGB</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l00696">xxxDWP_DoNCActivate()</a>.
<p>
<pre class="fragment"><div>00664 {
00665     WORD wRetValue = 0;
00666 
00667     <span class="comment">/*</span>
00668 <span class="comment">     * Check if Active and Inactive captions have same color</span>
00669 <span class="comment">     */</span>
00670     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(ACTIVECAPTION) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(INACTIVECAPTION) ||
00671             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(CAPTIONTEXT) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(INACTIVECAPTIONTEXT)) {
00672         wRetValue = DC_CAPTION;
00673     }
00674 
00675     <span class="comment">/*</span>
00676 <span class="comment">     * We want to repaint the borders if we're not minimized and</span>
00677 <span class="comment">     * we have a sizing border and the active/inactive colors are</span>
00678 <span class="comment">     * different.</span>
00679 <span class="comment">     */</span>
00680     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX) &amp;&amp;
00681         (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(ACTIVEBORDER) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(INACTIVEBORDER))) {
00682         <span class="comment">// We need to redraw the sizing border.</span>
00683         wRetValue |= DC_FRAME;
00684     }
00685 
00686     <span class="keywordflow">return</span> wRetValue;
00687 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="dwp.c::DestroyWindowSmIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DestroyWindowSmIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l01067">1067</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d8/d3/loadbits_8c-source.html#l00539">_DestroyCursor()</a>, <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01311">tagSERVERINFO::atomIconSmProp</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02169">CURSOR_ALWAYSDESTROY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02179">CURSORF_SECRET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00353">HMValidateHandleNoRip()</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00098">InternalRemoveProp()</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00908">TYPE_CURSOR</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02382">WFSMQUERYDRAGICON</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, <a class="el" href="../../d3/d7/metrics_8c-source.html#l00075">xxxRecreateSmallIcons()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00026">xxxSetClassIconEnum()</a>.
<p>
<pre class="fragment"><div>01069 {
01070     HCURSOR hcursor;
01071     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcursor;
01072 
01073     <span class="comment">//</span>
01074     <span class="comment">// Get the small icon property first...</span>
01075     <span class="comment">//</span>
01076     hcursor = (HCURSOR)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), PROPF_INTERNAL);
01077     <span class="keywordflow">if</span> (hcursor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01078         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01079 
01080     pcursor = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>(hcursor, TYPE_CURSOR);
01081     <span class="keywordflow">if</span> (pcursor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01082         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01083 
01084     <span class="comment">//</span>
01085     <span class="comment">// Remove it if it's a secretly created one</span>
01086     <span class="comment">//</span>
01087 
01088     <span class="keywordflow">if</span> (pcursor-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a540">CURSORF_SECRET</a>)
01089     {
01090         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSMQUERYDRAGICON);
01091         <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a1">InternalRemoveProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), PROPF_INTERNAL);
01092         <a class="code" href="../../d4/d1/userk_8h.html#a1782">_DestroyCursor</a>(pcursor, CURSOR_ALWAYSDESTROY);
01093         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01094     }
01095     <span class="keywordflow">else</span>
01096         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01097 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="dwp.c::DWP_DrawItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void DWP_DrawItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPDRAWITEMSTRUCT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpdis</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00024">24</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l01289">ClientFrame()</a>, and <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00026 {
00027     <span class="keywordflow">if</span> (lpdis-&gt;CtlType == ODT_LISTBOX) {
00028         <span class="comment">/*</span>
00029 <span class="comment">         * Default OwnerDraw Listbox Item Drawing</span>
00030 <span class="comment">         */</span>
00031         <span class="keywordflow">if</span> (   (lpdis-&gt;itemAction == ODA_FOCUS)
00032             || (   lpdis-&gt;itemAction == ODA_DRAWENTIRE
00033                 &amp;&amp; lpdis-&gt;itemState &amp; ODS_FOCUS)
00034            ) {
00035             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a19">ClientFrame</a>(lpdis-&gt;hDC, &amp;lpdis-&gt;rcItem, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray, PATINVERT);
00036         }
00037     }
00038 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="dwp.c::DWP_GetEnabledPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> DWP_GetEnabledPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwndStart</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00125">125</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01747">tagWND::spwndOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02827">TIF_16BIT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02418">WFDISABLED</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02251">GetActiveTrackPwnd()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00402">xxxDWP_SetCursor()</a>.
<p>
<pre class="fragment"><div>00127 {
00128     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT, pwnd;
00129     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiStart;
00130 
00131     ptiStart = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndStart);
00132     pwnd = pwndStart-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
00133 
00134 <span class="preprocessor">#ifdef SYSMODALWINDOWS</span>
00135 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (gspwndSysModal)
00136         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00137 <span class="preprocessor">#endif</span>
00138 <span class="preprocessor"></span>
00139     <span class="comment">/*</span>
00140 <span class="comment">     * The user clicked on a window that is disabled. That window is pwndStart.</span>
00141 <span class="comment">     * This loop is designed to evaluate what application this window is</span>
00142 <span class="comment">     * associated with, and activate that "application", by finding what window</span>
00143 <span class="comment">     * associated with that application can be activated. This is done by</span>
00144 <span class="comment">     * enumerating top level windows, searching for a top level enabled</span>
00145 <span class="comment">     * and visible ownee associated with this application.</span>
00146 <span class="comment">     */</span>
00147     <span class="keywordflow">while</span> (pwnd != pwndStart) {
00148         <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00149 
00150         <span class="comment">/*</span>
00151 <span class="comment">         * Warning! Win 3.1 had PWNDDESKTOP(pwndStart)-&gt;spwndChild</span>
00152 <span class="comment">         * which could loop forever if pwndStart was a child window</span>
00153 <span class="comment">         */</span>
00154             pwnd = pwndStart-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
00155             <span class="keywordflow">continue</span>;
00156         }
00157 
00158         <span class="comment">/*</span>
00159 <span class="comment">         * We have two cases we need to watch out for here.  The first is when</span>
00160 <span class="comment">         * applications call AssociateThreadInput() to tie two threads</span>
00161 <span class="comment">         * together to share input state.  If the threads own the same queue,</span>
00162 <span class="comment">         * then associate them together: this way, when two threads call</span>
00163 <span class="comment">         * AttachThreadInput(), one created the main window, one created the</span>
00164 <span class="comment">         * dialog window, when you click on the main window, they'll both</span>
00165 <span class="comment">         * come to the top (rather than beeping).  In this case we want to</span>
00166 <span class="comment">         * compare queues.  When Control Panel starts Setup in the Network</span>
00167 <span class="comment">         * applet is one type of example of attached input.</span>
00168 <span class="comment">         *</span>
00169 <span class="comment">         * The second case is WOW apps.  All wow apps have the same queue</span>
00170 <span class="comment">         * so to retain Win 3.1 compatibility, we want to treat each app</span>
00171 <span class="comment">         * as an individual task (Win 3.1 tests hqs), so we will compare</span>
00172 <span class="comment">         * PTI's for WOW apps.</span>
00173 <span class="comment">         *</span>
00174 <span class="comment">         * To see this case start 16 bit notepad and 16 bit write.  Do file</span>
00175 <span class="comment">         * open on write and then give notepad the focus now click on write's</span>
00176 <span class="comment">         * main window and the write file open dialog should activate.</span>
00177 <span class="comment">         *</span>
00178 <span class="comment">         * Another related case is powerpnt.  This case is interesting because</span>
00179 <span class="comment">         * it tests that we do not find another window to activate when nested</span>
00180 <span class="comment">         * windows are up and you click on a owner's owner.  Run Powerpnt, do</span>
00181 <span class="comment">         * Edit-Insert-Picture and Object-Recolor Picture will bring up a</span>
00182 <span class="comment">         * dialog with combos, drop down one of the color combo and then click</span>
00183 <span class="comment">         * on powerpnt's main window - focus should stay with the dialogs</span>
00184 <span class="comment">         * combo and it should stay dropped down.</span>
00185 <span class="comment">         */</span>
00186         <span class="keywordflow">if</span> (((ptiStart-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd) == ptiStart)) ||
00187                 (!(ptiStart-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;pq == ptiStart-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>))) {
00188 
00189             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDISABLED) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00190                 pwndT = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>;
00191 
00192                 <span class="comment">/*</span>
00193 <span class="comment">                 * If this window is the parent of a popup window,</span>
00194 <span class="comment">                 * bring up only one.</span>
00195 <span class="comment">                 */</span>
00196                 <span class="keywordflow">while</span> (pwndT) {
00197                     <span class="keywordflow">if</span> (pwndT == pwndStart)
00198                         <span class="keywordflow">return</span> pwnd;
00199 
00200                     pwndT = pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>;
00201                 }
00202 
00203                 <span class="comment">/*</span>
00204 <span class="comment">                 * Win9x continues looping only if pwnd is WEFTOPMOST. NT4 just returns, like Win3.1</span>
00205 <span class="comment">                 * As soon as we find a window on the queue, we stop. So if the queue owns</span>
00206 <span class="comment">                 * multiple top level unowned windows, then this code will probably not find</span>
00207 <span class="comment">                 * the enabled popup. Note that owned windows are supposed to be on top of the</span>
00208 <span class="comment">                 * owner, usally right on top of it (ie, pwnd-&gt;spwndNext == pwnd-&gt;spwndOwner)</span>
00209 <span class="comment">                 * so this code used to find any other top level unowned windows before the enabled</span>
00210 <span class="comment">                 * popup and bail. Odd.</span>
00211 <span class="comment">                 * So let's continue looping. Hopefully this won't cause any compatibility problems</span>
00212 <span class="comment">                 */</span>
00213                 <span class="comment">// return NULL;</span>
00214             }
00215         }
00216         pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
00217     }
00218 
00219     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00220 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="dwp.c::DWP_GetIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HICON DWP_GetIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l01022">1022</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01312">tagSERVERINFO::atomIconProp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01311">tagSERVERINFO::atomIconSmProp</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02179">CURSORF_SECRET</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00353">HMValidateHandleNoRip()</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00908">TYPE_CURSOR</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>01025 {
01026     HICON   hicoTemp;
01027 
01028     <span class="keywordflow">if</span> (uType &lt; ICON_SMALL || uType &gt; ICON_BIG)
01029     {
01030         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"WM_GETICON: Invalid wParam value (0x%X)"</span>, uType);
01031         <span class="keywordflow">return</span> (HICON)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01032     }
01033 
01034     <span class="comment">/*</span>
01035 <span class="comment">     *  Get the icon from the window</span>
01036 <span class="comment">     */</span>
01037     hicoTemp = (HICON)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd,
01038                               <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(uType == ICON_SMALL ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a> : <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o29">atomIconProp</a>),
01039                               PROPF_INTERNAL);
01040 
01041     <span class="comment">/*</span>
01042 <span class="comment">     *  If it's a USER created small icon don't return it.</span>
01043 <span class="comment">     */</span>
01044     <span class="keywordflow">if</span> (uType == ICON_SMALL &amp;&amp; hicoTemp) {
01045         <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcurTemp;
01046 
01047         pcurTemp = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>((HCURSOR)hicoTemp, TYPE_CURSOR);
01048         <span class="keywordflow">if</span> (pcurTemp != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; (pcurTemp-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a540">CURSORF_SECRET</a>)) {
01049             hicoTemp = (HICON)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01050         }
01051     }
01052 
01053     <span class="keywordflow">return</span> hicoTemp;
01054 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="dwp.c::xxxCreateWindowSmIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HICON xxxCreateWindowSmIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HICON&nbsp;</td>
          <td class="mdname" nowrap> <em>hIconBig</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fNotQueryDrag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l01223">1223</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01311">tagSERVERINFO::atomIconSmProp</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02179">CURSORF_SECRET</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00353">HMValidateHandleNoRip()</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00039">InternalSetProp()</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01724">PROPF_NOPOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00908">TYPE_CURSOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02382">WFSMQUERYDRAGICON</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a1997">xxxClientCopyImage()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01109">xxxDWP_SetIcon()</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00306">xxxGetWindowSmIcon()</a>, and <a class="el" href="../../d3/d7/metrics_8c-source.html#l00075">xxxRecreateSmallIcons()</a>.
<p>
<pre class="fragment"><div>01227 {
01228     HICON   hIconSm = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01229     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcurs = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,pcursBig;
01230 
01231     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01232     UserAssert(hIconBig);
01233 
01234     pcursBig = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>(hIconBig, TYPE_CURSOR);
01235 
01236     <span class="keywordflow">if</span> (pcursBig) {
01237         pcurs = <a class="code" href="../../d4/d1/userk_8h.html#a1997">xxxClientCopyImage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pcursBig),
01238                         pcursBig-&gt;rt == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(RT_ICON) ? IMAGE_ICON : IMAGE_CURSOR,
01239                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON),
01240                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON),
01241                         LR_DEFAULTCOLOR | (fNotQueryDrag ? LR_COPYFROMRESOURCE : 0));
01242         <span class="keywordflow">if</span> (pcurs != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01243             hIconSm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pcurs);
01244     }
01245     <span class="keywordflow">if</span> (hIconSm) {
01246         pcurs-&gt;CURSORF_flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a540">CURSORF_SECRET</a>;
01247         <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a0">InternalSetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), (HANDLE)hIconSm, PROPF_INTERNAL | PROPF_NOPOOL);
01248         <span class="keywordflow">if</span> (!fNotQueryDrag)
01249             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSMQUERYDRAGICON);
01250     }
01251 
01252     <span class="keywordflow">return</span>(hIconSm);
01253 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="dwp.c::xxxDefWindowProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT xxxDefWindowProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">1264</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00107">_GetDesktopWindow()</a>, <a class="el" href="../../d8/d8/keyboard_8c-source.html#l00027">_GetKeyState()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01240">_GetProcessWindowStation()</a>, <a class="el" href="../../d0/d0/miscutil_8c-source.html#l00183">_InitPwSB()</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00513">_IsDescendant()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00567">_SetMenuDefaultItem()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01738">tagCLS::atomClassName</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01297">tagSERVERINFO::atomSysClass</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00451">_LARGE_STRING::bAnsi</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00421">_LARGE_STRING::Buffer</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00435">_LARGE_UNICODE_STRING::Buffer</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00091">BuildHwndList()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03634">BWL_ENUMLIST</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00028">DefSetText()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03470">DO_DROPFILE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00024">DWP_DrawItem()</a>, <a class="el" href="../../d8/d6/winhtky_8c-source.html#l00242">DWP_GetHotKey()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01022">DWP_GetIcon()</a>, <a class="el" href="../../d8/d6/winhtky_8c-source.html#l00096">DWP_SetHotKey()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05830">FDoTray</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00019">FindNCHit()</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00417">FreeHwndList()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00143">GET_X_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00147">GET_Y_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02568">GetChildParent</a>, <a class="el" href="../../d5/d9/rtl_2help_8c-source.html#l00028">GetContextHelpId()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l03267">GetMouseKeyFlags()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00061">gspwndFullScreen</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00349">ICLS_DIALOG</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01266">IsHooked</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03842">KEYBOARD_MENU</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00463">_LARGE_UNICODE_STRING::Length</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00449">_LARGE_STRING::Length</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00450">_LARGE_STRING::MaximumLength</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02756">MENUSYSMENU</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05035">NCA_ACTIVE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d4/d1/userk_8h.html#a886">PCREATESTRUCTEX</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03719">PostShellHookMessages()</a>, <a class="el" href="../../d0/d9/clmsg_8c.html#a8">ppos</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06584">PUDF_ANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03001">QF_FF10STATUS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03129">tagQ::QF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03000">QF_FMENUSTATUS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02999">QF_FMENUSTATUSBREAK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03012">QF_TABSWITCHING</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03624">tagBWL::rghwnd</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00839">RtlUnicodeToMultiByteSize()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03111">tagQ::spwndActive</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03109">tagQ::spwndCapture</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01855">tagWND::strName</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00021">SYS_ALTERNATE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02527">SYS_PREVKEYSTATE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00236">SYSHBRUSH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00204">SYSRGB</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01174">TEST_KbdCuesPUSIF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02565">TestwndPopup</a>, <a class="el" href="../../d2/d4/w32_2ntuser_2rtl_2random_8c-source.html#l00108">TextCopy()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00364">ThreadLockWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02361">WEFACCEPTFILES</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02524">WEFPUIACCELHIDDEN</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02523">WEFPUIFOCUSHIDDEN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02302">WFANSICREATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02418">WFDISABLED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02267">WFFRAMEON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02275">WFHIDDENPOPUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02406">WFHSCROLL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02276">WFMENUDRAW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02290">WFSYNCPAINTPENDING</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02284">WFTITLESET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02407">WFVSCROLL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02042">WHF_SHELL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02070">WINDOW</a>, <a class="el" href="../../d7/d1/kbdlyout_8c-source.html#l00916">xxxActivateKeyboardLayout()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01401">xxxAdjustSize()</a>, <a class="el" href="../../d0/d2/calcclrc_8c-source.html#l00021">xxxCalcClientRect()</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01246">xxxCallHook()</a>, <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00521">xxxClientShutdown()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l02489">xxxDoScrollMenu()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l02082">xxxDrawMenuBarUnderlines()</a>, <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00076">xxxDrawWindowFrame()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00802">xxxDWP_DoCancelMode()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00696">xxxDWP_DoNCActivate()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00340">xxxDWP_EraseBkgnd()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00601">xxxDWP_NCMouse()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00286">xxxDWP_Paint()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00228">xxxDWP_ProcessVirtKey()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00402">xxxDWP_SetCursor()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01109">xxxDWP_SetIcon()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00055">xxxDWP_SetRedraw()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00846">xxxDWPPrint()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00189">xxxGetSysMenu()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l03381">xxxHandleWindowPosChanged()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00885">xxxInternalDoSyncPaint()</a>, <a class="el" href="../../d5/d3/kernel_2msgbeep_8c-source.html#l00052">xxxMessageBeep()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05553">xxxPeekMessage</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">xxxRedrawTitle()</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00078">xxxReleaseCapture()</a>, <a class="el" href="../../d3/d9/kernel_2help_8c-source.html#l00043">xxxSendHelpMessage()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03675">xxxSendMinRectMessages()</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00023">xxxSetCapture()</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l01815">xxxSetFocus()</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l01235">xxxSetForegroundWindow()</a>, <a class="el" href="../../d1/d8/showwin_8c-source.html#l00085">xxxShowWindow()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03797">xxxSimulateShiftF10()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04382">xxxSleepThread()</a>, <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00193">xxxSysCommand()</a>, <a class="el" href="../../d3/d2/mnpopup_8c-source.html#l00052">xxxTrackPopupMenuEx()</a>, and <a class="el" href="../../d6/d6/kernel_2winable_8c-source.html#l00274">xxxWindowEvent()</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l00975">InitFunctionTables()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01863">LW_RegisterWindows()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02972">PatchThreadWindows()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00883">xxxDesktopWndProc()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00232">xxxDoSend()</a>, <a class="el" href="../../d2/d7/w32_2ntuser_2kernel_2event_8c-source.html#l00224">xxxEventWndProc()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l00540">xxxGetColorObjects()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00193">xxxGetControlColor()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l02582">xxxSBWndProc()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00764">xxxSendMessageTimeout()</a>, <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00568">xxxSetWindowData()</a>, <a class="el" href="../../d2/d2/tmswitch_8c-source.html#l01564">xxxSwitchWndProc()</a>, and <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00570">xxxTooltipWndProc()</a>.
<p>
<pre class="fragment"><div>01269 {
01270     LRESULT     lt;
01271     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwndT;
01272     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>          tlpwndParent;
01273     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>          tlpwndT;
01274     <span class="keywordtype">int</span>         icolBack;
01275     <span class="keywordtype">int</span>         icolFore;
01276     <span class="keywordtype">int</span>         i;
01277 
01278     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01279 
01280     <span class="keywordflow">if</span> (pwnd == (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)-1) {
01281         <span class="keywordflow">return</span> 0;
01282     }
01283 
01284     <span class="keywordflow">if</span> (message &gt; WM_USER) {
01285         <span class="keywordflow">return</span> 0;
01286     }
01287 
01288     <span class="comment">/*</span>
01289 <span class="comment">     * Important:  If you add cases to the switch statement below,</span>
01290 <span class="comment">     *             and those messages can originate on the client</span>
01291 <span class="comment">     *             side, add the messages to server.c's gawDefWindowMsgs</span>
01292 <span class="comment">     *             array or else the client will short-circuit the call</span>
01293 <span class="comment">     *             and return 0.</span>
01294 <span class="comment">     */</span>
01295 
01296     <span class="keywordflow">switch</span> (message) {
01297     <span class="keywordflow">case</span> WM_CLIENTSHUTDOWN:
01298         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1833">xxxClientShutdown</a>(pwnd, wParam);
01299 
01300     <span class="keywordflow">case</span> WM_NCACTIVATE:
01301         <a class="code" href="../../d4/d1/userk_8h.html#a1453">xxxDWP_DoNCActivate</a>(pwnd, (LOWORD(wParam) ? NCA_ACTIVE : 0), (HRGN)lParam);
01302         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01303 
01304     <span class="keywordflow">case</span> WM_NCHITTEST:
01305         <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a0">FindNCHit</a>(pwnd, (LONG)lParam);
01306 
01307     <span class="keywordflow">case</span> WM_NCCALCSIZE:
01308 
01309         <span class="comment">/*</span>
01310 <span class="comment">         * wParam = fCalcValidRects</span>
01311 <span class="comment">         * lParam = LPRECT rgrc[3]:</span>
01312 <span class="comment">         *        lprc[0] = rcWindowNew = New window rectangle</span>
01313 <span class="comment">         *    if fCalcValidRects:</span>
01314 <span class="comment">         *        lprc[1] = rcWindowOld = Old window rectangle</span>
01315 <span class="comment">         *        lprc[2] = rcClientOld = Old client rectangle</span>
01316 <span class="comment">         *</span>
01317 <span class="comment">         * On return:</span>
01318 <span class="comment">         *        rgrc[0] = rcClientNew = New client rect</span>
01319 <span class="comment">         *    if fCalcValidRects:</span>
01320 <span class="comment">         *        rgrc[1] = rcValidDst  = Destination valid rectangle</span>
01321 <span class="comment">         *        rgrc[2] = rcValidSrc  = Source valid rectangle</span>
01322 <span class="comment">         */</span>
01323         <a class="code" href="../../d4/d1/userk_8h.html#a1531">xxxCalcClientRect</a>(pwnd, (LPRECT)lParam, FALSE);
01324         <span class="keywordflow">break</span>;
01325 
01326     <span class="keywordflow">case</span> WM_NCLBUTTONDOWN:
01327     <span class="keywordflow">case</span> WM_NCLBUTTONUP:
01328     <span class="keywordflow">case</span> WM_NCLBUTTONDBLCLK:
01329         <a class="code" href="../../d8/d3/dwp_8c.html#a7">xxxDWP_NCMouse</a>(pwnd, message, (UINT)wParam, lParam);
01330         <span class="keywordflow">break</span>;
01331 
01332     <span class="keywordflow">case</span> WM_CANCELMODE:
01333         {
01334             <span class="comment">/*</span>
01335 <span class="comment">             * Terminate any modes the system might</span>
01336 <span class="comment">             * be in, such as scrollbar tracking, menu mode,</span>
01337 <span class="comment">             * button capture, etc.</span>
01338 <span class="comment">             */</span>
01339             <a class="code" href="../../d8/d3/dwp_8c.html#a11">xxxDWP_DoCancelMode</a>(pwnd);
01340         }
01341         <span class="keywordflow">break</span>;
01342 
01343     <span class="keywordflow">case</span> WM_NCCREATE:
01344         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, (WFHSCROLL | WFVSCROLL))) {
01345             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1566">_InitPwSB</a>(pwnd) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01346                 <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01347         }
01348 
01349 <span class="preprocessor">#ifdef FE_SB // xxxDefWindowProc()</span>
01350 <span class="preprocessor"></span>        <span class="comment">/*</span>
01351 <span class="comment">         * If CREATESTRUCTEX.strName contains resource id, we don't</span>
01352 <span class="comment">         * need to call DefSetText(). because it is a numeric number,</span>
01353 <span class="comment">         * it does not need Ansi &lt;-&gt; Unicode translation.</span>
01354 <span class="comment">         */</span>
01355         <span class="keywordflow">if</span> (lParam) {
01356             <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = &amp;((<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">PCREATESTRUCTEX</a>)lParam)-&gt;strName;
01357 
01358             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pstr == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01359                 pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> = 0;
01360                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01361             }
01362 
01363             <span class="keywordflow">if</span> ((pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> &amp;&amp; (pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)) &amp;&amp;
01364                                 (*(<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>) == 0xff)) ||
01365                 (!pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> &amp;&amp; (pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> &gt;= <span class="keyword">sizeof</span>(WCHAR)) &amp;&amp;
01366                                 (*(PWCHAR)(pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>) == 0xffff))) {
01367                <span class="comment">/*</span>
01368 <span class="comment">                * This is Resource ID, we just return here with TRUE.</span>
01369 <span class="comment">                */</span>
01370                <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01371             }
01372         }
01373 <span class="preprocessor">#endif // FE_SB</span>
01374 <span class="preprocessor"></span>
01375         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFTITLESET);
01376 
01377         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d4/d1/userk_8h.html#a1529">DefSetText</a>(pwnd, &amp;((<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">PCREATESTRUCTEX</a>)lParam)-&gt;strName);
01378 
01379     <span class="keywordflow">case</span> WM_PRINT:
01380             <span class="keywordflow">return</span>((LRESULT)<a class="code" href="../../d8/d3/dwp_8c.html#a12">xxxDWPPrint</a>(pwnd, (HDC) wParam, lParam));
01381 
01382     <span class="keywordflow">case</span> WM_NCPAINT:
01383         {
01384             HDC hdc;
01385             <span class="comment">/*</span>
01386 <span class="comment">             * Force the drawing of the menu.</span>
01387 <span class="comment">             */</span>
01388             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFMENUDRAW);
01389 
01390             <span class="comment">/*</span>
01391 <span class="comment">             * Get a window DC intersected with hrgnClip,</span>
01392 <span class="comment">             * but make sure that hrgnClip doesn't get deleted.</span>
01393 <span class="comment">             */</span>
01394             hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd,
01395                            (HRGN)wParam,
01396                            DCX_USESTYLE         |
01397                                DCX_WINDOW       |
01398                                DCX_INTERSECTRGN |
01399                                DCX_NODELETERGN  |
01400                                DCX_LOCKWINDOWUPDATE);
01401 
01402             <a class="code" href="../../d4/d1/userk_8h.html#a1443">xxxDrawWindowFrame</a>(pwnd,
01403                                hdc,
01404                                FALSE,
01405                                (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFFRAMEON) &amp;&amp;
01406                                    (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;pq == gpqForeground)));
01407 
01408             <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
01409             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFMENUDRAW);
01410         }
01411         <span class="keywordflow">break</span>;
01412 
01413     <span class="keywordflow">case</span> WM_ISACTIVEICON:
01414         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFFRAMEON) != 0;
01415 
01416     <span class="keywordflow">case</span> WM_SETTEXT:
01417         <span class="comment">/*</span>
01418 <span class="comment">         * At one time we added an optimization to do nothing if the new</span>
01419 <span class="comment">         * text was the same as the old text but found that QCcase does not work</span>
01420 <span class="comment">         * because it calls SetWindowText not to change the text but</span>
01421 <span class="comment">         * cause the title bar to redraw after it had added the sysmenu</span>
01422 <span class="comment">         * through SetWindowLong</span>
01423 <span class="comment">         */</span>
01424         <span class="keywordflow">if</span> (lt = <a class="code" href="../../d4/d1/userk_8h.html#a1529">DefSetText</a>(pwnd, (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam)) {
01425             <span class="comment">/*</span>
01426 <span class="comment">             * Text was set, so redraw title bar</span>
01427 <span class="comment">             */</span>
01428             <a class="code" href="../../d4/d1/userk_8h.html#a1995">xxxRedrawTitle</a>(pwnd, DC_TEXT);
01429             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01430                 <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_NAMECHANGE, pwnd, OBJID_WINDOW, INDEXID_CONTAINER, 0);
01431             }
01432         }
01433         <span class="keywordflow">return</span> lt;
01434 
01435     <span class="keywordflow">case</span> WM_GETTEXT:
01436         <span class="keywordflow">if</span> (wParam != 0) {
01437             <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam;
01438 
01439             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
01440                 <span class="keywordflow">if</span> (pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
01441                     i = WCSToMB(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a>,
01442                             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> / <span class="keyword">sizeof</span>(WCHAR),
01443                             (LPSTR *)&amp;pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>, pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a> - 1, FALSE);
01444                     ((LPSTR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>)[i] = 0;
01445                     pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> = i;
01446                 } <span class="keywordflow">else</span> {
01447                     i = <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a2">TextCopy</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>, pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>, (UINT)wParam);
01448                     pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> = i * <span class="keyword">sizeof</span>(WCHAR);
01449                 }
01450                 <span class="keywordflow">return</span> i;
01451             }
01452 
01453             <span class="comment">/*</span>
01454 <span class="comment">             * else Null terminate the text buffer since there is no text.</span>
01455 <span class="comment">             */</span>
01456             <span class="keywordflow">if</span> (pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
01457                 *(LPSTR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = 0;
01458             } <span class="keywordflow">else</span> {
01459                 *(LPWSTR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = 0;
01460             }
01461         }
01462         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01463 
01464     <span class="keywordflow">case</span> WM_GETTEXTLENGTH:
01465         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
01466             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cch;
01467             <span class="keywordflow">if</span> (lParam) {
01468                 <a class="code" href="../../d9/d6/nlsxlat_8c.html#a36">RtlUnicodeToMultiByteSize</a>(&amp;cch,
01469                                           pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a>,
01470                                           pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>);
01471             } <span class="keywordflow">else</span> {
01472                 cch = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> / <span class="keyword">sizeof</span>(WCHAR);
01473             }
01474             <span class="keywordflow">return</span> cch;
01475         }
01476         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01477 
01478     <span class="keywordflow">case</span> WM_CLOSE:
01479         <a class="code" href="../../d4/d1/userk_8h.html#a1575">xxxDestroyWindow</a>(pwnd);
01480         <span class="keywordflow">break</span>;
01481 
01482     <span class="keywordflow">case</span> WM_PAINT:
01483     <span class="keywordflow">case</span> WM_PAINTICON:
01484         <a class="code" href="../../d8/d3/dwp_8c.html#a4">xxxDWP_Paint</a>(pwnd);
01485         <span class="keywordflow">break</span>;
01486 
01487     <span class="keywordflow">case</span> WM_ERASEBKGND:
01488     <span class="keywordflow">case</span> WM_ICONERASEBKGND:
01489         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d4/d1/userk_8h.html#a1455">xxxDWP_EraseBkgnd</a>(pwnd, message, (HDC)wParam);
01490 
01491     <span class="keywordflow">case</span> WM_SYNCPAINT:
01492 
01493         <span class="comment">/*</span>
01494 <span class="comment">         * Clear our sync-paint pending flag.</span>
01495 <span class="comment">         */</span>
01496         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSYNCPAINTPENDING);
01497 
01498         <span class="comment">/*</span>
01499 <span class="comment">         * This message is sent when SetWindowPos() is trying</span>
01500 <span class="comment">         * to get the screen looking nice after window rearrangement,</span>
01501 <span class="comment">         * and one of the windows involved is of another task.</span>
01502 <span class="comment">         * This message avoids lots of inter-app message traffic</span>
01503 <span class="comment">         * by switching to the other task and continuing the</span>
01504 <span class="comment">         * recursion there.</span>
01505 <span class="comment">         *</span>
01506 <span class="comment">         * wParam         = flags</span>
01507 <span class="comment">         * LOWORD(lParam) = hrgnClip</span>
01508 <span class="comment">         * HIWORD(lParam) = pwndSkip  (not used; always NULL)</span>
01509 <span class="comment">         *</span>
01510 <span class="comment">         * pwndSkip is now always NULL.</span>
01511 <span class="comment">         *</span>
01512 <span class="comment">         * NOTE: THIS MESSAGE IS FOR INTERNAL USE ONLY! ITS BEHAVIOR</span>
01513 <span class="comment">         * IS DIFFERENT IN 3.1 THAN IN 3.0!!</span>
01514 <span class="comment">         */</span>
01515         <a class="code" href="../../d4/d1/userk_8h.html#a1042">xxxInternalDoSyncPaint</a>(pwnd, (DWORD)wParam);
01516         <span class="keywordflow">break</span>;
01517 
01518     <span class="keywordflow">case</span> WM_QUERYOPEN:
01519     <span class="keywordflow">case</span> WM_QUERYENDSESSION:
01520     <span class="keywordflow">case</span> WM_DEVICECHANGE:
01521     <span class="keywordflow">case</span> WM_POWERBROADCAST:
01522         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01523 
01524     <span class="comment">// Default handling for WM_CONTEXTMENU support</span>
01525     <span class="keywordflow">case</span> WM_RBUTTONUP:
01526 <span class="preprocessor">#ifdef USE_MIRRORING</span>
01527 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
01528             lParam = MAKELPARAM(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lParam), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lParam) + pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
01529         } <span class="keywordflow">else</span>
01530 <span class="preprocessor">#endif</span>
01531 <span class="preprocessor"></span>        {
01532                         lParam = MAKELONG(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lParam) + pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lParam) + pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
01533         }
01534         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_CONTEXTMENU, (WPARAM) <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), lParam);
01535         <span class="keywordflow">break</span>;
01536 
01537     <span class="keywordflow">case</span> WM_NCRBUTTONDOWN:
01538         {
01539             <span class="keywordtype">int</span>         nHit;
01540             MSG         <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01541             LONG        spt;
01542             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01543 
01544             nHit = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a0">FindNCHit</a>(pwnd, (LONG)lParam);
01545             <span class="keywordflow">if</span> (nHit == HTVSCROLL || nHit == HTHSCROLL) {
01546                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a5">_IsDescendant</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, pwnd)) {
01547                     <span class="keywordflow">break</span>;
01548                 }
01549             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nHit == HTCAPTION || nHit == HTSYSMENU) {
01550                 <span class="keywordflow">if</span> (pwnd != pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>) {
01551                     <span class="keywordflow">break</span>;
01552                 }
01553             } <span class="keywordflow">else</span> {
01554                 <span class="keywordflow">break</span>;
01555             }
01556 
01557             <a class="code" href="../../d4/d1/userk_8h.html#a1712">xxxSetCapture</a>(pwnd);
01558 
01559             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
01560             {
01561                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a576">xxxPeekMessage</a>(&amp;msg, NULL, WM_MOUSEFIRST, WM_MOUSELAST, PM_REMOVE))
01562                 {
01563                     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.message == WM_RBUTTONUP)
01564                     {
01565                         <a class="code" href="../../d4/d1/userk_8h.html#a1713">xxxReleaseCapture</a>();
01566                         spt = POINTTOPOINTS(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.pt);
01567                         nHit = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a0">FindNCHit</a>(pwnd, spt);
01568                         <span class="keywordflow">if</span> ((nHit == HTCAPTION) || (nHit == HTSYSMENU) ||
01569                             (nHit == HTVSCROLL) || (nHit == HTHSCROLL)) {
01570                             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_CONTEXTMENU, (WPARAM) <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), spt);
01571                         }
01572                         <span class="keywordflow">break</span>;
01573                     }
01574                 }
01575                 <span class="keywordflow">if</span> (pwnd != pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>)
01576                 <span class="comment">// Someone else grabbed the capture.  Bail out.</span>
01577                     <span class="keywordflow">break</span>;
01578 <span class="comment">//                xxxWaitMessage();</span>
01579                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1196">xxxSleepThread</a>(QS_MOUSE, 0, TRUE))
01580                     <span class="keywordflow">break</span>;
01581             }
01582         }
01583         <span class="keywordflow">break</span>;
01584 
01585     <span class="comment">/*</span>
01586 <span class="comment">     * Default handling for WM_APPCOMMAND support</span>
01587 <span class="comment">     */</span>
01588     <span class="keywordflow">case</span> WM_NCXBUTTONUP:
01589     <span class="keywordflow">case</span> WM_XBUTTONUP:
01590         {
01591             WORD cmd;
01592             WORD keystate;
01593             LPARAM lParamAppCommand;
01594 
01595             cmd = 0;
01596             <span class="keywordflow">switch</span> (GET_XBUTTON_WPARAM(wParam)) {
01597             <span class="keywordflow">case</span> XBUTTON1:
01598                 cmd = APPCOMMAND_BROWSER_BACKWARD;
01599                 <span class="keywordflow">break</span>;
01600 
01601             <span class="keywordflow">case</span> XBUTTON2:
01602                 cmd = APPCOMMAND_BROWSER_FORWARD;
01603                 <span class="keywordflow">break</span>;
01604 
01605             <span class="keywordflow">default</span>:
01606                 <span class="keywordflow">break</span>;
01607             }
01608 
01609             <span class="keywordflow">if</span> (cmd == 0) {
01610                 <span class="keywordflow">break</span>;
01611             }
01612 
01613             cmd |= FAPPCOMMAND_MOUSE;
01614             <span class="keywordflow">if</span> (message == WM_XBUTTONUP) {
01615                 keystate = GET_KEYSTATE_WPARAM(wParam);
01616             } <span class="keywordflow">else</span> {
01617                 keystate = (WORD)<a class="code" href="../../d4/d1/userk_8h.html#a1641">GetMouseKeyFlags</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq);
01618             }
01619 
01620             lParamAppCommand = MAKELPARAM(keystate, cmd);
01621             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_APPCOMMAND, (WPARAM) <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), lParamAppCommand);
01622             <span class="keywordflow">break</span>;
01623         }
01624 
01625     <span class="keywordflow">case</span> WM_MOUSEWHEEL:
01626         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
01627             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01628             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, WM_MOUSEWHEEL, wParam, lParam);
01629             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01630         }
01631         <span class="keywordflow">break</span>;
01632 
01633     <span class="keywordflow">case</span> WM_CONTEXTMENU:
01634         {
01635             <span class="keywordtype">int</span> nHit;
01636 
01637             nHit = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a0">FindNCHit</a>(pwnd, (LONG)lParam);
01638 
01639             <span class="comment">/*</span>
01640 <span class="comment">             * Put up a context menu if we clicked on a scroll bar</span>
01641 <span class="comment">             */</span>
01642             <span class="keywordflow">if</span> ((nHit == HTVSCROLL) || (nHit == HTHSCROLL)) {
01643                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a5">_IsDescendant</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndActive, pwnd)) {
01644                     <a class="code" href="../../d4/d1/userk_8h.html#a1427">xxxDoScrollMenu</a>(pwnd, NULL, nHit - HTHSCROLL, lParam);
01645                 }
01646                 <span class="keywordflow">break</span>;
01647             }
01648 
01649             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
01650                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01651                 <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, WM_CONTEXTMENU, (WPARAM) <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), lParam);
01652                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01653             } <span class="keywordflow">else</span> {
01654                 <span class="comment">/*</span>
01655 <span class="comment">                 *  Do default context menu if right clicked on caption</span>
01656 <span class="comment">                 */</span>
01657                 <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndActive)
01658                 {
01659                     <span class="keywordflow">if</span> (nHit == HTCAPTION)
01660                         <span class="keywordflow">goto</span> DoTheDefaultThang;
01661                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nHit == HTSYSMENU)
01662                     {
01663                         i = SC_CLOSE;
01664                         <span class="keywordflow">goto</span> DoTheSysMenuThang;
01665                     }
01666 
01667                     <span class="comment">/*</span>
01668 <span class="comment">                     *  If this was generated by the keyboard (apps key), then simulate a shift-f10</span>
01669 <span class="comment">                     *  for old apps so they get a crack at putting up their context menu.</span>
01670 <span class="comment">                     */</span>
01671                     <span class="keywordflow">if</span> (lParam == <a class="code" href="../../d4/d1/userk_8h.html#a461">KEYBOARD_MENU</a> &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT))
01672                         <a class="code" href="../../d4/d1/userk_8h.html#a1869">xxxSimulateShiftF10</a>();
01673                 }
01674             }
01675         }
01676         <span class="keywordflow">break</span>;
01677 
01678     <span class="keywordflow">case</span> WM_APPCOMMAND:
01679         <span class="comment">/*</span>
01680 <span class="comment">         * Bubble the message to the parent</span>
01681 <span class="comment">         */</span>
01682         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
01683             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01684             lt = <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, WM_APPCOMMAND, wParam, lParam);
01685             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01686             <span class="keywordflow">return</span> lt;
01687         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd) ) {
01688             <span class="comment">/*</span>
01689 <span class="comment">             * Notify listeners on the SHELLHOOK that a WM_APPCOMMAND message was not handled</span>
01690 <span class="comment">             * We also post this message to the shell queue so they don't need to load themselves </span>
01691 <span class="comment">             * into every process with a hook.</span>
01692 <span class="comment">             * We don't bother about the desktop since csrss services it and it doesn't accept </span>
01693 <span class="comment">             * shell hooks so there is no point.</span>
01694 <span class="comment">             */</span>
01695             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a208">IsHooked</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), WHF_SHELL)) 
01696                 <a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HSHELL_APPCOMMAND, wParam, lParam, WH_SHELL);
01697             
01698             <span class="comment">/*</span>
01699 <span class="comment">             * Still post messages to the shell window even if there isn't a hook installed </span>
01700 <span class="comment">             */</span>
01701             <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_APPCOMMAND, lParam);
01702         }
01703         <span class="keywordflow">break</span>;
01704 
01705     <span class="keywordflow">case</span> WM_KEYF1:
01706         <a class="code" href="../../d4/d1/userk_8h.html#a1102">xxxSendHelpMessage</a>(pwnd, HELPINFO_WINDOW,
01707                 (<span class="keywordtype">int</span>) (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;spmenu) : 0),
01708                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), <a class="code" href="../../d4/d0/rtl_2help_8c.html#a1">GetContextHelpId</a>(pwnd));
01709         <span class="keywordflow">break</span>;
01710 
01711     <span class="keywordflow">case</span> WM_SYSCOMMAND:
01712         <a class="code" href="../../d4/d1/userk_8h.html#a1445">xxxSysCommand</a>(pwnd, (UINT)wParam, lParam);
01713         <span class="keywordflow">break</span>;
01714 
01715     <span class="keywordflow">case</span> WM_KEYDOWN:
01716         <span class="keywordflow">if</span> (wParam == VK_F10) {
01717             <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;QF_flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a859">QF_FF10STATUS</a>;
01718 HandleF10:
01719          <span class="comment">/*</span>
01720 <span class="comment">          *  Generate a WM_CONTEXTMENU for new apps for shift-f10.</span>
01721 <span class="comment">          */</span>
01722              <span class="keywordflow">if</span> (<a class="code" href="../../d7/d9/keyboard_8c.html#a1">_GetKeyState</a>(VK_SHIFT) &lt; 0 &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT)) {
01723                  <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_CONTEXTMENU, (WPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), KEYBOARD_MENU);
01724              }
01725         }
01726         <span class="keywordflow">break</span>;
01727 
01728     <span class="keywordflow">case</span> WM_HELP:
01729         <span class="comment">// If this window is a child window, Help message must be passed on</span>
01730         <span class="comment">// to it's parent; Else, this must be passed on to the owner window.</span>
01731         pwndT = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)? pwnd-&gt;spwndParent : pwnd-&gt;spwndOwner);
01732         <span class="keywordflow">if</span> (pwndT &amp;&amp; (pwndT != <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>())) {
01733             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndT, &amp;tlpwndT);
01734             lt = <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndT, WM_HELP, wParam, lParam);
01735             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
01736             <span class="keywordflow">return</span> lt;
01737         }
01738         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01739 
01740     <span class="keywordflow">case</span> WM_SYSKEYDOWN:
01741         {
01742             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01743 
01744             <span class="comment">/*</span>
01745 <span class="comment">             * Is the ALT key down?</span>
01746 <span class="comment">             */</span>
01747             <span class="keywordflow">if</span> (HIWORD(lParam) &amp; <a class="code" href="../../d3/d5/editsl_8c.html#a0">SYS_ALTERNATE</a>) {
01748                 <span class="comment">/*</span>
01749 <span class="comment">                 * Toggle QF_FMENUSTATUS iff this is NOT a repeat KEYDOWN</span>
01750 <span class="comment">                 * message; Only if the prev key state was 0, then this is the</span>
01751 <span class="comment">                 * first KEYDOWN message and then we consider toggling menu</span>
01752 <span class="comment">                 * status; Fix for Bugs #4531 &amp; #4566 --SANKAR-- 10-02-89.</span>
01753 <span class="comment">                 */</span>
01754                 <span class="keywordflow">if</span> ((HIWORD(lParam) &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a728">SYS_PREVKEYSTATE</a>) == 0) {
01755 
01756                     <span class="comment">/*</span>
01757 <span class="comment">                     * Don't have to lock pwndActive because it's</span>
01758 <span class="comment">                     * processing this key.</span>
01759 <span class="comment">                     */</span>
01760                     <span class="keywordflow">if</span> ((wParam == VK_MENU) &amp;&amp;
01761                             !(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a>)) {
01762                         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a>;
01763                         <a class="code" href="../../d4/d1/userk_8h.html#a1317">xxxDrawMenuBarUnderlines</a>(pwnd, TRUE);
01764                     } <span class="keywordflow">else</span> {
01765                         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp;= ~(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a>|<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a857">QF_FMENUSTATUSBREAK</a>);
01766                     }
01767                 }
01768 
01769                 pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a859">QF_FF10STATUS</a>;
01770 
01771                 <a class="code" href="../../d4/d1/userk_8h.html#a1454">xxxDWP_ProcessVirtKey</a>((UINT)wParam);
01772 
01773             } <span class="keywordflow">else</span> {
01774                 <span class="keywordflow">if</span> (wParam == VK_F10) {
01775                     pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a859">QF_FF10STATUS</a>;
01776                     <span class="keywordflow">goto</span> HandleF10;
01777                 }
01778             }
01779         }
01780         <span class="keywordflow">break</span>;
01781 
01782     <span class="keywordflow">case</span> WM_SYSKEYUP:
01783     <span class="keywordflow">case</span> WM_KEYUP:
01784         {
01785             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01786 
01787             <span class="comment">/*</span>
01788 <span class="comment">             * press and release F10 or ALT.  Send this only to top-level windows,</span>
01789 <span class="comment">             * otherwise MDI gets confused.  The fix in which DefMDIChildProc()</span>
01790 <span class="comment">             * passed up the message was insufficient in the case a child window</span>
01791 <span class="comment">             * of the MDI child had the focus.</span>
01792 <span class="comment">             * Also make sure the sys-menu activation wasn't broken by a mouse</span>
01793 <span class="comment">             * up or down when the Alt was down (QF_MENUSTATUSBREAK).</span>
01794 <span class="comment">             */</span>
01795             <span class="keywordflow">if</span> ((wParam == VK_MENU &amp;&amp; !(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a862">QF_TABSWITCHING</a>) &amp;&amp; ((pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp;
01796                     (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a857">QF_FMENUSTATUSBREAK</a>)) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a>)) ||
01797                     (wParam == VK_F10 &amp;&amp; (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a859">QF_FF10STATUS</a> ))) {
01798                 pwndT = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pwnd);
01799                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a15">gspwndFullScreen</a> != pwndT) {
01800 
01801                     <a class="code" href="../../d6/d0/usercli_8h.html#a38">ThreadLockWithPti</a>(pti, pwndT, &amp;tlpwndT);
01802                     <span class="comment">/*</span>
01803 <span class="comment">                     * Draw the underlines for F10. This was already down for ALT</span>
01804 <span class="comment">                     *  when the key went down.</span>
01805 <span class="comment">                     */</span>
01806                     <span class="keywordflow">if</span> (wParam == VK_F10) {
01807                         <a class="code" href="../../d4/d1/userk_8h.html#a1317">xxxDrawMenuBarUnderlines</a>(pwnd, TRUE);
01808                     }
01809                     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndT, WM_SYSCOMMAND, SC_KEYMENU, 0);
01810                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
01811                 }
01812             }
01813 
01814             <span class="comment">/*</span>
01815 <span class="comment">             * Turn off bit for tab-switching.  This is set in the _KeyEvent()</span>
01816 <span class="comment">             * routine when it's been determined we're doing switching.  This</span>
01817 <span class="comment">             * is necessary for cases where the ALT-KEY is release before the</span>
01818 <span class="comment">             * TAB-KEY.  In which case, the FMENUSTATUS bit would be cleared</span>
01819 <span class="comment">             * by the ALT-KEY-UP and would have forced us into a syscommand</span>
01820 <span class="comment">             * loop.  This guarentees that we don't enter that condition.</span>
01821 <span class="comment">             */</span>
01822             <span class="keywordflow">if</span> (wParam == VK_MENU) {
01823                 pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a862">QF_TABSWITCHING</a>;
01824                 <a class="code" href="../../d4/d1/userk_8h.html#a1317">xxxDrawMenuBarUnderlines</a>(pwnd, FALSE);
01825             }
01826 
01827             pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp;= ~(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a857">QF_FMENUSTATUSBREAK</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a859">QF_FF10STATUS</a>);
01828         }
01829         <span class="keywordflow">break</span>;
01830 
01831     <span class="keywordflow">case</span> WM_SYSCHAR:
01832         {
01833             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01834 
01835             <span class="comment">/*</span>
01836 <span class="comment">             * If syskey is down and we have a char...</span>
01837 <span class="comment">             */</span>
01838             pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> &amp;= ~(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a858">QF_FMENUSTATUS</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a857">QF_FMENUSTATUSBREAK</a>);
01839 
01840             <span class="keywordflow">if</span> (wParam == VK_RETURN &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
01841 
01842                 <span class="comment">/*</span>
01843 <span class="comment">                 * If the window is iconic and user hits RETURN, we want to</span>
01844 <span class="comment">                 * restore this window.</span>
01845 <span class="comment">                 */</span>
01846                 <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwnd, WM_SYSCOMMAND, SC_RESTORE, 0L);
01847                 <span class="keywordflow">break</span>;
01848             }
01849 
01850             <span class="keywordflow">if</span> ((HIWORD(lParam) &amp; <a class="code" href="../../d3/d5/editsl_8c.html#a0">SYS_ALTERNATE</a>) &amp;&amp; wParam) {
01851                 <span class="keywordflow">if</span> (wParam == VK_TAB || wParam == VK_ESCAPE)
01852                     <span class="keywordflow">break</span>;
01853 
01854                 <span class="comment">/*</span>
01855 <span class="comment">                 * Send ALT-SPACE only to top-level windows.</span>
01856 <span class="comment">                 */</span>
01857                 <span class="keywordflow">if</span> ((wParam == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a772">MENUSYSMENU</a>) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd))) {
01858                     <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pwnd-&gt;spwndParent, &amp;tlpwndParent);
01859                     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;spwndParent, message, wParam, lParam);
01860                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01861                 } <span class="keywordflow">else</span> {
01862                     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_SYSCOMMAND, SC_KEYMENU, (DWORD)wParam);
01863                 }
01864             } <span class="keywordflow">else</span> {
01865 
01866                 <span class="comment">/*</span>
01867 <span class="comment">                 * Ctrl-Esc produces a WM_SYSCHAR, But should not beep;</span>
01868 <span class="comment">                 */</span>
01869                 <span class="keywordflow">if</span> (wParam != VK_ESCAPE)
01870                     <a class="code" href="../../d4/d1/userk_8h.html#a1730">xxxMessageBeep</a>(0);
01871             }
01872         }
01873         <span class="keywordflow">break</span>;
01874 
01875     <span class="keywordflow">case</span> WM_CHARTOITEM:
01876     <span class="keywordflow">case</span> WM_VKEYTOITEM:
01877 
01878         <span class="comment">/*</span>
01879 <span class="comment">         * Do default processing for keystrokes into owner draw listboxes.</span>
01880 <span class="comment">         */</span>
01881         <span class="keywordflow">return</span> -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01882 
01883     <span class="keywordflow">case</span> WM_ACTIVATE:
01884         <span class="keywordflow">if</span> (wParam)
01885             <a class="code" href="../../d4/d1/userk_8h.html#a1662">xxxSetFocus</a>(pwnd);
01886         <span class="keywordflow">break</span>;
01887 
01888     <span class="keywordflow">case</span> WM_INPUTLANGCHANGEREQUEST:
01889     {
01890         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndFocus = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndFocus;
01891 
01892         <span class="comment">/*</span>
01893 <span class="comment">         * #115190</span>
01894 <span class="comment">         * Dialog does not forward I.L.Reqest to the focused window.</span>
01895 <span class="comment">         * (Memphis compatible issue)</span>
01896 <span class="comment">         */</span>
01897         <span class="keywordflow">if</span> (pwndFocus &amp;&amp; (pwndFocus != pwnd) &amp;&amp;
01898                 pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a76">ICLS_DIALOG</a>]) {
01899             <span class="comment">/*</span>
01900 <span class="comment">             * pass message to focus'ed window. Old app, pass on to</span>
01901 <span class="comment">             * focus'ed window which may be ML aware.  (edit class</span>
01902 <span class="comment">             * for example).</span>
01903 <span class="comment">             */</span>
01904             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndFocus, &amp;tlpwndT);
01905             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndFocus, message, wParam, lParam);
01906             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
01907         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1303">xxxActivateKeyboardLayout</a>(<a class="code" href="../../d8/d8/winsta_8c.html#a11">_GetProcessWindowStation</a>(NULL),
01908                 (HKL)lParam, KLF_SETFORPROCESS, pwnd)) {
01909             RIPERR1(ERROR_INVALID_KEYBOARD_HANDLE, RIP_WARNING, <span class="stringliteral">"WM_INPUTLANGCHANGEREQUEST: Invalid keyboard handle (0x%08lx)"</span>, lParam);
01910         }
01911         <span class="keywordflow">break</span>;
01912     }
01913 
01914     <span class="keywordflow">case</span> WM_INPUTLANGCHANGE:
01915     {
01916         <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a> pbwl;
01917         HWND *phwnd;
01918         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
01919 
01920         pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(pwnd-&gt;spwndChild, BWL_ENUMLIST, NULL);
01921         <span class="keywordflow">if</span> (pbwl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01922             <span class="keywordflow">return</span> 0;
01923 
01924         <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
01925             <span class="comment">/*</span>
01926 <span class="comment">             * Make sure this hwnd is still around.</span>
01927 <span class="comment">             */</span>
01928             <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01929                 <span class="keywordflow">continue</span>;
01930 
01931             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd, &amp;tlpwnd);
01932             RIPMSG1(RIP_VERBOSE, <span class="stringliteral">"WM_INPUTLANGCHANGE: Sending message to pwnd %#p"</span>, pwnd);
01933             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, message, wParam, lParam);
01934             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01935         }
01936         <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
01937 
01938         <span class="keywordflow">break</span>;
01939     }
01940 
01941     <span class="keywordflow">case</span> WM_SETREDRAW:
01942         <a class="code" href="../../d8/d3/dwp_8c.html#a1">xxxDWP_SetRedraw</a>(pwnd, wParam != 0);
01943         <span class="keywordflow">break</span>;
01944 
01945     <span class="keywordflow">case</span> WM_WINDOWPOSCHANGING:
01946         {
01947             <span class="comment">/*</span>
01948 <span class="comment">             * If the window's size is changing, adjust the passed-in size</span>
01949 <span class="comment">             */</span>
01950             WINDOWPOS *<a class="code" href="../../d0/d9/clmsg_8c.html#a8">ppos</a> = ((WINDOWPOS *)lParam);
01951             <span class="keywordflow">if</span> (!(<a class="code" href="../../d0/d9/clmsg_8c.html#a8">ppos</a>-&gt;flags &amp; SWP_NOSIZE)) {
01952                 <a class="code" href="../../d4/d1/userk_8h.html#a1510">xxxAdjustSize</a>(pwnd, &amp;<a class="code" href="../../d0/d9/clmsg_8c.html#a8">ppos</a>-&gt;cx, &amp;<a class="code" href="../../d0/d9/clmsg_8c.html#a8">ppos</a>-&gt;cy);
01953             }
01954         }
01955         <span class="keywordflow">break</span>;
01956 
01957     <span class="keywordflow">case</span> WM_WINDOWPOSCHANGED:
01958         <a class="code" href="../../d4/d1/userk_8h.html#a1622">xxxHandleWindowPosChanged</a>(pwnd, (PWINDOWPOS)lParam);
01959         <span class="keywordflow">break</span>;
01960 
01961     <span class="keywordflow">case</span> WM_CTLCOLORSCROLLBAR:
01962         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount &lt; 8 ||
01963                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(SCROLLBAR) ||
01964                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(WINDOW))
01965         {
01966             <span class="comment">/*</span>
01967 <span class="comment">             * Remove call to UnrealizeObject.  GDI handles this</span>
01968 <span class="comment">             * for brushes on NT.</span>
01969 <span class="comment">             *</span>
01970 <span class="comment">             * GreUnrealizeObject(ghbrGray);</span>
01971 <span class="comment">             */</span>
01972 
01973             GreSetBkColor((HDC)wParam, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT));
01974             GreSetTextColor((HDC)wParam, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DFACE));
01975             <span class="keywordflow">return</span>((LRESULT)<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray);
01976         }
01977 
01978         icolBack = COLOR_3DHILIGHT;
01979         icolFore = COLOR_BTNTEXT;
01980         <span class="keywordflow">goto</span> SetColor;
01981 
01982     <span class="keywordflow">case</span> WM_CTLCOLORBTN:
01983         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT)) {
01984             icolBack = COLOR_3DFACE;
01985             icolFore = COLOR_BTNTEXT;
01986         } <span class="keywordflow">else</span> {
01987             <span class="keywordflow">goto</span> ColorDefault;
01988         }
01989         <span class="keywordflow">goto</span> SetColor;
01990 
01991     <span class="keywordflow">case</span> WM_CTLCOLORSTATIC:
01992     <span class="keywordflow">case</span> WM_CTLCOLORDLG:
01993     <span class="keywordflow">case</span> WM_CTLCOLORMSGBOX:
01994         <span class="comment">// We want static controls in dialogs to have the 3D</span>
01995         <span class="comment">// background color, but statics in windows to inherit</span>
01996         <span class="comment">// their parents' background.</span>
01997         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT)
01998            ) {
01999             icolBack = COLOR_3DFACE;
02000             icolFore = COLOR_WINDOWTEXT;
02001             <span class="keywordflow">goto</span> SetColor;
02002         }
02003         <span class="comment">// ELSE FALL THRU...</span>
02004 
02005     <span class="keywordflow">case</span> WM_CTLCOLOR:              <span class="comment">// here for WOW only</span>
02006     <span class="keywordflow">case</span> WM_CTLCOLORLISTBOX:
02007     <span class="keywordflow">case</span> WM_CTLCOLOREDIT:
02008 ColorDefault:
02009         icolBack = COLOR_WINDOW;
02010         icolFore = COLOR_WINDOWTEXT;
02011 
02012 SetColor:
02013         GreSetBkColor((HDC)wParam, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[icolBack]);
02014         GreSetTextColor((HDC)wParam, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[icolFore]);
02015         <span class="keywordflow">return</span> (LRESULT)(<a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icolBack));
02016 
02017     <span class="keywordflow">case</span> WM_SETCURSOR:
02018 
02019         <span class="comment">/*</span>
02020 <span class="comment">         * wParam  == pwndHit == pwnd that cursor is over</span>
02021 <span class="comment">         * lParamL == ht  == Hit test area code (result of WM_NCHITTEST)</span>
02022 <span class="comment">         * lParamH == msg     == Mouse message number</span>
02023 <span class="comment">         */</span>
02024         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d8/d3/dwp_8c.html#a6">xxxDWP_SetCursor</a>(pwnd, (HWND)wParam, (<span class="keywordtype">int</span>)(SHORT)lParam,
02025                 HIWORD(lParam));
02026 
02027     <span class="keywordflow">case</span> WM_MOUSEACTIVATE:
02028         pwndT = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a741">GetChildParent</a>(pwnd);
02029         <span class="keywordflow">if</span> (pwndT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02030             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndT, &amp;tlpwndT);
02031             lt = <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndT, WM_MOUSEACTIVATE, wParam, lParam);
02032             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
02033             <span class="keywordflow">if</span> (lt != 0)
02034                 <span class="keywordflow">return</span> lt;
02035         }
02036 
02037         <span class="comment">/*</span>
02038 <span class="comment">         * Moving, sizing or minimizing? Activate AFTER we take action.</span>
02039 <span class="comment">         * If the user LEFT clicked in the title bar, don't activate now:</span>
02040 <span class="comment">         */</span>
02041         <span class="keywordflow">return</span>  (   (LOWORD(lParam) == HTCAPTION)
02042                  &amp;&amp; (HIWORD(lParam) == WM_LBUTTONDOWN)
02043                 )
02044               ? (LONG)MA_NOACTIVATE
02045               : (LONG)MA_ACTIVATE;
02046 
02047     <span class="keywordflow">case</span> WM_SHOWWINDOW:
02048 
02049         <span class="comment">/*</span>
02050 <span class="comment">         * If we are being called because our owner window is being shown,</span>
02051 <span class="comment">         * hidden, minimized, or un-minimized, then we must hide or show</span>
02052 <span class="comment">         * show ourself as appropriate.</span>
02053 <span class="comment">         *</span>
02054 <span class="comment">         * This behavior occurs for popup windows or owned windows only.</span>
02055 <span class="comment">         * It's not designed for use with child windows.</span>
02056 <span class="comment">         */</span>
02057         <span class="keywordflow">if</span> (LOWORD(lParam) != 0 &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a739">TestwndPopup</a>(pwnd) || pwnd-&gt;spwndOwner)) {
02058 
02059             <span class="comment">/*</span>
02060 <span class="comment">             * The WFHIDDENPOPUP flag is an internal flag that indicates</span>
02061 <span class="comment">             * that the window was hidden because its owner was hidden.</span>
02062 <span class="comment">             * This way we only show windows that were hidden by this code,</span>
02063 <span class="comment">             * not intentionally by the application.</span>
02064 <span class="comment">             *</span>
02065 <span class="comment">             * Go ahead and hide or show this window, but only if:</span>
02066 <span class="comment">             *</span>
02067 <span class="comment">             * a) we need to be hidden, or</span>
02068 <span class="comment">             * b) we need to be shown, and we were hidden by</span>
02069 <span class="comment">             *    an earlier WM_SHOWWINDOW message</span>
02070 <span class="comment">             */</span>
02071             <span class="keywordflow">if</span> ((!wParam &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) ||
02072                     (wParam &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE) &amp;&amp;
02073                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFHIDDENPOPUP))) {
02074 
02075                 <span class="comment">/*</span>
02076 <span class="comment">                 * Remember that we were hidden by WM_SHOWWINDOW processing</span>
02077 <span class="comment">                 */</span>
02078                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFHIDDENPOPUP);
02079                 <span class="keywordflow">if</span> (!wParam)
02080                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFHIDDENPOPUP);
02081 
02082                 <a class="code" href="../../d4/d1/userk_8h.html#a1607">xxxShowWindow</a>(
02083                         pwnd,
02084                         (wParam ? SW_SHOWNOACTIVATE : SW_HIDE) | <a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_ANIMATE));
02085             }
02086         }
02087         <span class="keywordflow">break</span>;
02088 
02089     <span class="keywordflow">case</span> WM_SYSMENU:
02090         <span class="keywordflow">if</span> (   !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDISABLED)
02091             &amp;&amp; (   (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;pq == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>)
02092                 || <a class="code" href="../../d4/d1/userk_8h.html#a1665">xxxSetForegroundWindow</a>(pwnd, FALSE))
02093            )
02094         {
02095             <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
02096             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tpmenu;
02097 DoTheDefaultThang:
02098             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED))
02099                 i = SC_RESTORE;
02100             <span class="keywordflow">else</span>
02101                 i = SC_MAXIMIZE;
02102 
02103 DoTheSysMenuThang:
02104             <span class="keywordflow">if</span> ((pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1404">xxxGetSysMenu</a>(pwnd, TRUE)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02105             {
02106                 <a class="code" href="../../d4/d1/userk_8h.html#a1599">_SetMenuDefaultItem</a>(pMenu, i, MF_BYCOMMAND);
02107 
02108                 <span class="comment">// Tell the shell we are bringing it up the system menu</span>
02109                 <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_SYSMENU, (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
02110 
02111                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pMenu, &amp;tpmenu);
02112                 <span class="keywordflow">if</span> (lParam == 0xFFFFFFFF)
02113                 {
02114                     <span class="comment">// this is a keyboard generated WM_SYSMENU</span>
02115                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a592">FDoTray</a>())
02116                     {
02117                         TPMPARAMS tpm;
02118 
02119                         tpm.cbSize = <span class="keyword">sizeof</span>(TPMPARAMS);
02120 
02121                         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1866">xxxSendMinRectMessages</a>(pwnd, &amp;tpm.rcExclude)) {
02122                             <a class="code" href="../../d4/d1/userk_8h.html#a1597">xxxTrackPopupMenuEx</a>(pMenu, TPM_SYSMENU | TPM_VERTICAL,
02123                                 tpm.rcExclude.left, tpm.rcExclude.top, pwnd, &amp;tpm);
02124                         }
02125                     }
02126                 }
02127                 <span class="keywordflow">else</span>
02128                 {
02129                     <a class="code" href="../../d4/d1/userk_8h.html#a1597">xxxTrackPopupMenuEx</a>(pMenu, TPM_RIGHTBUTTON | TPM_SYSMENU,
02130                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lParam), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lParam), pwnd, NULL);
02131                 }
02132                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tpmenu);
02133             }
02134         }
02135         <span class="keywordflow">break</span>;
02136 
02137     <span class="keywordflow">case</span> WM_DRAWITEM:
02138         <a class="code" href="../../d8/d3/dwp_8c.html#a0">DWP_DrawItem</a>((LPDRAWITEMSTRUCT)lParam);
02139         <span class="keywordflow">break</span>;
02140 
02141     <span class="keywordflow">case</span> WM_GETHOTKEY:
02142         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d7/d7/winhtky_8c.html#a3">DWP_GetHotKey</a>(pwnd);
02143         <span class="keywordflow">break</span>;
02144 
02145     <span class="keywordflow">case</span> WM_SETHOTKEY:
02146         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d7/d7/winhtky_8c.html#a2">DWP_SetHotKey</a>(pwnd, (DWORD)wParam);
02147         <span class="keywordflow">break</span>;
02148 
02149     <span class="keywordflow">case</span> WM_GETICON:
02150         <span class="keywordflow">return</span> (LRESULT)<a class="code" href="../../d4/d1/userk_8h.html#a1994">DWP_GetIcon</a>(pwnd, (BOOL)wParam);
02151 
02152     <span class="keywordflow">case</span> WM_SETICON:
02153         <span class="keywordflow">return</span> (LRESULT)<a class="code" href="../../d8/d3/dwp_8c.html#a15">xxxDWP_SetIcon</a>(pwnd, wParam, (HICON)lParam);
02154 
02155     <span class="keywordflow">case</span> WM_COPYGLOBALDATA:
02156         <span class="comment">/*</span>
02157 <span class="comment">         * This message is used to thunk WM_DROPFILES messages along</span>
02158 <span class="comment">         * with other things.  If we end up here with it, directly</span>
02159 <span class="comment">         * call the client back to finish processing of this message.</span>
02160 <span class="comment">         * This assumes that the ultimate destination of the</span>
02161 <span class="comment">         * WM_DROPFILES message is in the client side's process context.</span>
02162 <span class="comment">         */</span>
02163         <span class="keywordflow">return</span>(SfnCOPYGLOBALDATA(NULL, 0, wParam, lParam, 0, 0, 0, NULL));
02164 
02165     <span class="keywordflow">case</span> WM_QUERYDROPOBJECT:
02166         <span class="comment">/*</span>
02167 <span class="comment">         * if the app has registered interest in drops, return TRUE</span>
02168 <span class="comment">         */</span>
02169         <span class="keywordflow">return</span> (LRESULT)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFACCEPTFILES) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02170 
02171     <span class="keywordflow">case</span> WM_DROPOBJECT:
02172         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a910">DO_DROPFILE</a>;
02173 
02174     <span class="keywordflow">case</span> WM_ACCESS_WINDOW:
02175         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>((HWND)wParam)) {
02176             <span class="comment">// SECURITY: set ACL for this window to no-access</span>
02177             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02178         }
02179         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02180 
02181     <span class="keywordflow">case</span> WM_NOTIFYFORMAT:
02182         <span class="keywordflow">if</span>(lParam == NF_QUERY)
02183             <span class="keywordflow">return</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFANSICREATOR) ? NFR_ANSI : NFR_UNICODE);
02184         <span class="keywordflow">break</span>;
02185 
02186     <span class="keywordflow">case</span> WM_CHANGEUISTATE:
02187         {
02188             WORD wAction = LOWORD(wParam);
02189             WORD wFlags = HIWORD(wParam);
02190             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRealChange = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02191 
02192             <span class="keywordflow">if</span> (wFlags &amp; ~UISF_VALID || wAction &gt; UIS_LASTVALID ||
02193                 lParam || !<a class="code" href="../../d1/d0/inc_2user_8h.html#a384">TEST_KbdCuesPUSIF</a>) {
02194                     <span class="keywordflow">return</span> 0;
02195             }
02196 
02197             <span class="keywordflow">if</span> (wAction == UIS_INITIALIZE) {
02198                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;bLastRITWasKeyboard) {
02199                     wAction = UIS_CLEAR;
02200                 } <span class="keywordflow">else</span> {
02201                     wAction = UIS_SET;
02202                 }
02203                 wFlags = UISF_HIDEFOCUS | UISF_HIDEACCEL;
02204                 wParam = MAKEWPARAM(wAction, wFlags);
02205             }
02206 
02207             UserAssert(wAction == UIS_SET || wAction == UIS_CLEAR);
02208             <span class="comment">/*</span>
02209 <span class="comment">             * If the state is not going to change, there's nothing to do here</span>
02210 <span class="comment">             */</span>
02211             <span class="keywordflow">if</span> (wFlags &amp; UISF_HIDEFOCUS) {
02212                 bRealChange = (!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFPUIFOCUSHIDDEN)) ^ (wAction == UIS_SET);
02213             }
02214             <span class="keywordflow">if</span> (wFlags &amp; UISF_HIDEACCEL) {
02215                 bRealChange |= (!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFPUIACCELHIDDEN)) ^ (wAction == UIS_SET);
02216             }
02217 
02218             <span class="keywordflow">if</span> (!bRealChange) {
02219                 <span class="keywordflow">break</span>;
02220             }
02221 
02222             <span class="comment">/*</span>
02223 <span class="comment">             * Children pass this message up</span>
02224 <span class="comment">             * Top level windows update their children's state and</span>
02225 <span class="comment">             * send down to their imediate children WM_UPDATEUISTATE.</span>
02226 <span class="comment">             */</span>
02227             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
02228                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd-&gt;spwndParent, &amp;tlpwndParent);
02229                 lt = <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;spwndParent, WM_CHANGEUISTATE, wParam, lParam);
02230                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
02231                 <span class="keywordflow">return</span> lt;
02232             } <span class="keywordflow">else</span> {
02233                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_UPDATEUISTATE, wParam, lParam);
02234             }
02235 
02236         }
02237         <span class="keywordflow">break</span>;
02238 
02239     <span class="keywordflow">case</span> WM_QUERYUISTATE:
02240         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFPUIFOCUSHIDDEN) ? UISF_HIDEFOCUS : 0) |
02241                (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFPUIACCELHIDDEN) ? UISF_HIDEACCEL : 0);
02242         <span class="keywordflow">break</span>;
02243 
02244     <span class="keywordflow">case</span> WM_UPDATEUISTATE:
02245         {
02246             WORD wAction = LOWORD(wParam);
02247             WORD wFlags = HIWORD(wParam);
02248 
02249             <span class="keywordflow">if</span> (wFlags &amp; ~UISF_VALID || wAction &gt; UIS_LASTVALID ||
02250                 lParam || !<a class="code" href="../../d1/d0/inc_2user_8h.html#a384">TEST_KbdCuesPUSIF</a>) {
02251                     <span class="keywordflow">return</span> 0;
02252             }
02253 
02254             <span class="keywordflow">switch</span> (wAction) {
02255                 <span class="keywordflow">case</span> UIS_INITIALIZE:
02256                     <span class="comment">/*</span>
02257 <span class="comment">                     * UISTATE: UIS_INITIALIZE sets the UIState bits</span>
02258 <span class="comment">                     * based on the last input type</span>
02259 <span class="comment">                     */</span>
02260                     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;bLastRITWasKeyboard) {
02261                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFPUIFOCUSHIDDEN);
02262                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFPUIACCELHIDDEN);
02263                         wParam = MAKEWPARAM(UIS_SET, UISF_HIDEACCEL | UISF_HIDEFOCUS);
02264                     } <span class="keywordflow">else</span> {
02265                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFPUIFOCUSHIDDEN);
02266                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFPUIACCELHIDDEN);
02267                         wParam = MAKEWPARAM(UIS_CLEAR, UISF_HIDEACCEL | UISF_HIDEFOCUS);
02268                     }
02269                     <span class="keywordflow">break</span>;
02270 
02271                 <span class="keywordflow">case</span> UIS_SET:
02272                     <span class="keywordflow">if</span> (wFlags &amp; UISF_HIDEACCEL) {
02273                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFPUIACCELHIDDEN);
02274                     }
02275                     <span class="keywordflow">if</span> (wFlags &amp; UISF_HIDEFOCUS) {
02276                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFPUIFOCUSHIDDEN);
02277                     }
02278                     <span class="keywordflow">break</span>;
02279 
02280                 <span class="keywordflow">case</span> UIS_CLEAR:
02281                     <span class="keywordflow">if</span> (wFlags &amp; UISF_HIDEACCEL) {
02282                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFPUIACCELHIDDEN);
02283                     }
02284                     <span class="keywordflow">if</span> (wFlags &amp; UISF_HIDEFOCUS) {
02285                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFPUIFOCUSHIDDEN);
02286                     }
02287                     <span class="keywordflow">break</span>;
02288 
02289                 <span class="keywordflow">default</span>:
02290                     <span class="keywordflow">break</span>;
02291              }
02292 
02293             <span class="comment">/*</span>
02294 <span class="comment">             * Send it down to its immediate children if any</span>
02295 <span class="comment">             */</span>
02296              <span class="keywordflow">if</span> (pwnd-&gt;spwndChild) {
02297 
02298                 <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a> pbwl;
02299                 HWND *phwnd;
02300                 <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
02301 
02302                 pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(pwnd-&gt;spwndChild, BWL_ENUMLIST, NULL);
02303                 <span class="keywordflow">if</span> (pbwl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02304                     <span class="keywordflow">return</span> 0;
02305 
02306                 <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
02307                     <span class="comment">/*</span>
02308 <span class="comment">                     * Make sure this hwnd is still around.</span>
02309 <span class="comment">                     */</span>
02310                     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02311                         <span class="keywordflow">continue</span>;
02312 
02313                     <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd, &amp;tlpwnd);
02314                     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, message, wParam, lParam);
02315                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
02316                 }
02317                 <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
02318             }
02319         }
02320         <span class="keywordflow">break</span>;
02321 
02322 <span class="preprocessor">#ifdef PENWIN20</span>
02323 <span class="preprocessor"></span>    <span class="comment">// LATER mikeke</span>
02324     <span class="keywordflow">default</span>:
02325         <span class="comment">// BOGUS</span>
02326         <span class="comment">// 32-bit ize DefPenWindowProc</span>
02327         <span class="comment">//</span>
02328         <span class="comment">// call DefPenWindowProc if penwin is loaded</span>
02329         <span class="keywordflow">if</span> (   (message &gt;= WM_HANDHELDFIRST)
02330             &amp;&amp; (message &lt;= WM_HANDHELDLAST)
02331            ) {
02332             <span class="keywordflow">if</span> (lpfnHandHeld != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02333                 <span class="keywordflow">return</span> (*lpfnHandHeld)(HW16(pwnd), message, wParamLo, lParam);
02334         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (   (message &gt;= WM_PENWINFIRST)
02335                    &amp;&amp; (message &lt;= WM_PENWINLAST)
02336                   ) {
02337             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(PENWINDOWS))
02338                 <span class="keywordflow">return</span> DefPenWindowProc(pwnd, message, wParamLo, lParam);
02339         }
02340 
02341 <span class="preprocessor">#endif // PENWIN20</span>
02342 <span class="preprocessor"></span>    }
02343 
02344     <span class="keywordflow">return</span> 0;
02345 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="dwp.c::xxxDWP_DoCancelMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDWP_DoCancelMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00802">802</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03210">tagMENUSTATE::fModelessMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03037">_MOVESIZEDATA::fTrackCancelled</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04727">GetpMenuState()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03201">tagMENUSTATE::pGlobalPopupMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03366">tagTHREADINFO::pmsd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1084">PSBTRACK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03397">PWNDTOPSBTRACK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03109">tagQ::spwndCapture</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02863">tagPOPUPMENU::spwndNotify</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02841">TIF_MOVESIZETRACKING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d1/mnapi_8c-source.html#l00124">xxxEndMenu()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l01782">xxxEndScroll()</a>, <a class="el" href="../../d6/d5/structtagSBTRACK.html#o8">tagSBTRACK::xxxpfnSB</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00078">xxxReleaseCapture()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00216">zzzClipCursor()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00804 {
00805     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00806     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndCapture = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>;
00807     <a class="code" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a> pMenuState;
00808 
00809     <span class="comment">/*</span>
00810 <span class="comment">     * If the below menu lines are changed in any way, then SQLWin</span>
00811 <span class="comment">     * won't work if in design mode you drop some text, double click on</span>
00812 <span class="comment">     * it, then try to use the heirarchical menus.</span>
00813 <span class="comment">     */</span>
00814     pMenuState = <a class="code" href="../../d4/d1/userk_8h.html#a1320">GetpMenuState</a>(pwnd);
00815     <span class="keywordflow">if</span> ((pMenuState != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00816             &amp;&amp; (pwnd == pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a>)
00817             &amp;&amp; !pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o9">fModelessMenu</a>) {
00818 
00819         <a class="code" href="../../d4/d1/userk_8h.html#a1397">xxxEndMenu</a>(pMenuState);
00820     }
00821 
00822     <span class="keywordflow">if</span> (pwndCapture == pwnd) {
00823         <a class="code" href="../../d6/d5/structtagSBTRACK.html">PSBTRACK</a> pSBTrack = <a class="code" href="../../d4/d1/userk_8h.html#a384">PWNDTOPSBTRACK</a>(pwnd);
00824         <span class="keywordflow">if</span> (pSBTrack &amp;&amp; (pSBTrack-&gt;<a class="code" href="../../d6/d5/structtagSBTRACK.html#o8">xxxpfnSB</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
00825             <a class="code" href="../../d4/d1/userk_8h.html#a1442">xxxEndScroll</a>(pwnd, TRUE);
00826 
00827         <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o30">pmsd</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00828             pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o30">pmsd</a>-&gt;<a class="code" href="../../d4/d9/struct__MOVESIZEDATA.html#o16">fTrackCancelled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00829             pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a809">TIF_MOVESIZETRACKING</a>;
00830 
00831             <span class="comment">/*</span>
00832 <span class="comment">             * Also clip the cursor back to the whole screen</span>
00833 <span class="comment">             * so we don't get confused in xxxMoveSize.</span>
00834 <span class="comment">             * This fix bug 64166.</span>
00835 <span class="comment">             */</span>
00836             <a class="code" href="../../d4/d1/userk_8h.html#a1788">zzzClipCursor</a>((LPRECT)NULL);
00837         }
00838 
00839         <span class="comment">/*</span>
00840 <span class="comment">         * If the capture is still set, just release at this point.</span>
00841 <span class="comment">         */</span>
00842         <a class="code" href="../../d4/d1/userk_8h.html#a1713">xxxReleaseCapture</a>();
00843     }
00844 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="dwp.c::xxxDWP_DoNCActivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxDWP_DoNCActivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HRGN&nbsp;</td>
          <td class="mdname" nowrap> <em>hrgnClip</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00696">696</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00662">AreNonClientAreasToBePainted()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00582">GetWindowBorders()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04760">IsModelessMenuNotificationWindow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05035">NCA_ACTIVE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05036">NCA_FORCEFRAMEOFF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00151">UserValidateCopyRgn()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02267">WFFRAMEON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02259">WFMPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02269">WFNONCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01373">xxxMenuBarDraw()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d2/d2/mnloop_8c-source.html#l00584">xxxEndMenuLoop()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>.
<p>
<pre class="fragment"><div>00700 {
00701     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wFlags = DC_CAPTION;
00702 
00703     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00704 
00705    <span class="comment">/*</span>
00706 <span class="comment">    * Later5.0 Gerardob. Since activation must follow focus, modeless</span>
00707 <span class="comment">    *  menu windows are activated so they can receive keyboard input;</span>
00708 <span class="comment">    *  however, we want the notification frame on, even when inactive.</span>
00709 <span class="comment">    * (so it looks just like regular menus).</span>
00710 <span class="comment">    * There are other scenarios when we want focus and activation on</span>
00711 <span class="comment">    *  different parent-child chains so we should consider allowing this.</span>
00712 <span class="comment">    */</span>
00713     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a552">NCA_ACTIVE</a>)
00714             || (!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a553">NCA_FORCEFRAMEOFF</a>)
00715                 &amp;&amp; <a class="code" href="../../d4/d1/userk_8h.html#a1328">IsModelessMenuNotificationWindow</a>(pwnd))) {
00716 
00717         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFFRAMEON);
00718         wFlags |= DC_ACTIVE;
00719     } <span class="keywordflow">else</span> {
00720 
00721         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFFRAMEON);
00722     }
00723 
00724     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFNONCPAINT)) {
00725 
00726         HDC  hdc;
00727         WORD wBorderOrCap = (WORD)<a class="code" href="../../d8/d3/dwp_8c.html#a8">AreNonClientAreasToBePainted</a>(pwnd);
00728 
00729         <span class="keywordflow">if</span> (wBorderOrCap) {
00730 
00731             <span class="comment">/*</span>
00732 <span class="comment">             * Validate and Copy the region for our use.  Since we</span>
00733 <span class="comment">             * hand this off to GetWindowDC() we won't have to delete</span>
00734 <span class="comment">             * the region (done in ReleaseDC()).  Regardless, the region</span>
00735 <span class="comment">             * passed in from the user is its responsibility to delete.</span>
00736 <span class="comment">             */</span>
00737             hrgnClip = <a class="code" href="../../d7/d3/validate_8c.html#a8">UserValidateCopyRgn</a>(hrgnClip);
00738 
00739             <span class="keywordflow">if</span> (hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, hrgnClip, DCX_WINDOW | DCX_USESTYLE)) {
00740                  <span class="comment">/*</span>
00741 <span class="comment">                  * Draw the menu for grayout and underlines</span>
00742 <span class="comment">                  */</span>
00743                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMPRESENT)) {
00744                     <span class="keywordtype">int</span> cxFrame, cyFrame;
00745                     cxFrame = cyFrame = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style,
00746                          pwnd-&gt;ExStyle, TRUE, FALSE);
00747                     cxFrame *= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00748                     cyFrame *= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00749                     <a class="code" href="../../d4/d1/userk_8h.html#a1588">xxxMenuBarDraw</a>(pwnd, hdc, cxFrame, cyFrame);
00750                 }
00751                 <a class="code" href="../../d4/d1/userk_8h.html#a1438">xxxDrawCaptionBar</a>(pwnd, hdc, wBorderOrCap | wFlags);
00752                 <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00753             } <span class="keywordflow">else</span> {
00754                 GreDeleteObject(hrgnClip);
00755             }
00756         }
00757     }
00758 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="dwp.c::xxxDWP_EraseBkgnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDWP_EraseBkgnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00340">340</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00236">SYSHBRUSH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00033">xxxFillWindow()</a>, and <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01615">xxxInternalPaintDesktop()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00344 {
00345     HBRUSH hbr;
00346 
00347     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00348 
00349     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00350     <span class="keywordflow">case</span> WM_ICONERASEBKGND:
00351         <span class="comment">//</span>
00352         <span class="comment">// Old compatibility:  Many hack apps use this to paint the</span>
00353         <span class="comment">// desktop wallpaper.  We never send WM_ICONERASEBKGND anymore</span>
00354         <span class="comment">// because we don't have client areas in our minimized windows.</span>
00355         <span class="comment">//</span>
00356         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD)) {
00357             <a class="code" href="../../d4/d1/userk_8h.html#a1444">xxxInternalPaintDesktop</a>(pwnd, hdc, TRUE);
00358         } <span class="keywordflow">else</span> {
00359             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00360         }
00361         <span class="keywordflow">break</span>;
00362 
00363     <span class="keywordflow">case</span> WM_ERASEBKGND:
00364         <span class="keywordflow">if</span> (hbr = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;hbrBackground) {
00365             <span class="comment">// Convert sys colors to proper brush</span>
00366             <span class="keywordflow">if</span> (hbr &lt;= (HBRUSH)COLOR_MAX)
00367                 hbr = <a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>((ULONG_PTR)hbr - 1);
00368 
00369             <span class="comment">/*</span>
00370 <span class="comment">             * Remove call to UnrealizeObject.  GDI handles this</span>
00371 <span class="comment">             * for brushes on NT.</span>
00372 <span class="comment">             *</span>
00373 <span class="comment">             * if (hbr != SYSHBR(DESKTOP))</span>
00374 <span class="comment">             *     GreUnrealizeObject(hbr);</span>
00375 <span class="comment">             */</span>
00376 
00377             <a class="code" href="../../d4/d1/userk_8h.html#a1563">xxxFillWindow</a>(pwnd, pwnd, hdc, hbr);
00378         } <span class="keywordflow">else</span> {
00379             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00380         }
00381     }
00382     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00383 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="dwp.c::xxxDWP_NCMouse" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDWP_NCMouse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>ht</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00601">601</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00583">_GetMenuState()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00189">xxxGetSysMenu()</a>, <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00023">xxxHandleNCMouseGuys()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, and <a class="el" href="../../d2/d4/caption_8c-source.html#l00158">xxxTrackCaptionButton()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00606 {
00607     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cmd;
00608 
00609     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00610 
00611     cmd = 0;
00612     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00613     <span class="keywordflow">case</span> WM_NCLBUTTONDOWN:
00614 
00615         <span class="keywordflow">switch</span> (ht) {
00616         <span class="keywordflow">case</span> HTZOOM:
00617         <span class="keywordflow">case</span> HTREDUCE:
00618         <span class="keywordflow">case</span> HTCLOSE:
00619         <span class="keywordflow">case</span> HTHELP:
00620             cmd = <a class="code" href="../../d4/d1/userk_8h.html#a1936">xxxTrackCaptionButton</a>(pwnd, ht);
00621             <span class="keywordflow">break</span>;
00622 
00623         <span class="keywordflow">default</span>:
00624             <span class="comment">// Change into a MV/SZ command</span>
00625             <span class="keywordflow">if</span> (ht &gt;= HTSIZEFIRST &amp;&amp; ht &lt;= HTSIZELAST)
00626                 cmd = SC_SIZE + (ht - HTSIZEFIRST + WMSZ_SIZEFIRST);
00627             <span class="keywordflow">break</span>;
00628         }
00629 
00630         <span class="keywordflow">if</span> (cmd != 0) {
00631             <span class="comment">//</span>
00632             <span class="comment">// For SysCommands on system menu, don't do if menu item is</span>
00633             <span class="comment">// disabled.</span>
00634             <span class="comment">//</span>
00635             <span class="keywordflow">if</span> (   cmd != SC_CONTEXTHELP
00636                 &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSYSMENU)
00637                 &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)
00638                ) {
00639                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a11">_GetMenuState</a>(<a class="code" href="../../d4/d1/userk_8h.html#a1404">xxxGetSysMenu</a>(pwnd, TRUE), cmd &amp; 0xFFF0,
00640                     MF_BYCOMMAND) &amp; MFS_GRAYED)
00641                     <span class="keywordflow">break</span>;
00642             }
00643 
00644             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_SYSCOMMAND, cmd, lParam);
00645             <span class="keywordflow">break</span>;
00646         }
00647         <span class="comment">// FALL THRU</span>
00648 
00649     <span class="keywordflow">case</span> WM_NCLBUTTONUP:
00650     <span class="keywordflow">case</span> WM_NCLBUTTONDBLCLK:
00651         <a class="code" href="../../d4/d1/userk_8h.html#a1446">xxxHandleNCMouseGuys</a>(pwnd, msg, ht, lParam);
00652         <span class="keywordflow">break</span>;
00653     }
00654 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="dwp.c::xxxDWP_Paint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDWP_Paint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00286">286</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00101">IsRectEmpty()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02307">WFSTARTPAINT</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1710">xxxBeginPaint()</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a1711">xxxEndPaint()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00288 {
00289     PAINTSTRUCT ps;
00290 
00291     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00292 
00293     <span class="comment">/*</span>
00294 <span class="comment">     * Bad handling of a WM_PAINT message, the application called</span>
00295 <span class="comment">     * BeginPaint/EndPaint and is now calling DefWindowProc for the same</span>
00296 <span class="comment">     * WM_PAINT message. Just return so we don't get full drag problems.</span>
00297 <span class="comment">     * (Word and Excel do this).</span>
00298 <span class="comment">     *</span>
00299 <span class="comment">     * Added the check for empty-client-rects.  ObjectVision has a problem</span>
00300 <span class="comment">     * with empty-windows being invalidated during a full-drag.  They used</span>
00301 <span class="comment">     * to get blocked at the STARTPAINT and couldn't get through to</span>
00302 <span class="comment">     * xxxBeginPaint to validate their update-rgn.</span>
00303 <span class="comment">     *</span>
00304 <span class="comment">     * i.e.</span>
00305 <span class="comment">     *      a) Parent has a child-window with an empty rect.  On a full</span>
00306 <span class="comment">     *         drag of the parent, we process SetWindowPos() to paint</span>
00307 <span class="comment">     *         the new position.</span>
00308 <span class="comment">     *</span>
00309 <span class="comment">     *      b) During the parents processing of WM_PAINT, it calls</span>
00310 <span class="comment">     *         GetUpdateRect() on the empty-child, which sets the STARTPAINT</span>
00311 <span class="comment">     *         on its window.</span>
00312 <span class="comment">     *</span>
00313 <span class="comment">     *      c) On return to the parent WM_PAINT handler, it calls</span>
00314 <span class="comment">     *         UpdateWindow() on the child, and used to get blocked here</span>
00315 <span class="comment">     *         because the STARTPAINT bit was set.  The Child never gets</span>
00316 <span class="comment">     *         updated, causing an infinite loop.</span>
00317 <span class="comment">     *</span>
00318 <span class="comment">     *      *) By checking for an empty-rectangle, we will let it through</span>
00319 <span class="comment">     *         to validate.</span>
00320 <span class="comment">     *</span>
00321 <span class="comment">     */</span>
00322     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSTARTPAINT) &amp;&amp; !<a class="code" href="../../d3/d6/rect_8c.html#a4">IsRectEmpty</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>))) {
00323         <span class="keywordflow">return</span>;
00324     }
00325 
00326     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1710">xxxBeginPaint</a>(pwnd, &amp;ps)) {
00327         <a class="code" href="../../d4/d1/userk_8h.html#a1711">xxxEndPaint</a>(pwnd, &amp;ps);
00328     }
00329 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="dwp.c::xxxDWP_ProcessVirtKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDWP_ProcessVirtKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>wKey</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00228">228</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d8/d8/keyboard_8c-source.html#l00027">_GetKeyState()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01596">CFNOCLOSE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03111">tagQ::spwndActive</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03110">tagQ::spwndFocus</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, and <a class="el" href="../../d4/d5/focusact_8c-source.html#l01815">xxxSetFocus()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00230 {
00231     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
00232     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndActive;
00233 
00234     pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00235     <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00236         <span class="keywordflow">return</span>;
00237 
00238     <span class="keywordflow">switch</span> (wKey) {
00239 
00240     <span class="keywordflow">case</span> VK_F4:
00241         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, CFNOCLOSE))
00242             <span class="keywordflow">break</span>;
00243 
00244         <span class="comment">/*</span>
00245 <span class="comment">         * Don't change the focus if the child window has it.</span>
00246 <span class="comment">         */</span>
00247         <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00248                 <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>) !=
00249                 pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>) {
00250             <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, &amp;tlpwndActive);
00251             <a class="code" href="../../d4/d1/userk_8h.html#a1662">xxxSetFocus</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>);
00252             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndActive);
00253         }
00254         <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, WM_SYSCOMMAND, SC_CLOSE, 0L);
00255         <span class="keywordflow">break</span>;
00256 
00257     <span class="keywordflow">case</span> VK_TAB:
00258         <span class="comment">/*</span>
00259 <span class="comment">         * If alt-tab is reserved by console, don't bring up the alt-tab</span>
00260 <span class="comment">         * window.</span>
00261 <span class="comment">         */</span>
00262         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>)-&gt;fsReserveKeys &amp; CONSOLE_ALTTAB)
00263             <span class="keywordflow">break</span>;
00264 
00265     <span class="keywordflow">case</span> VK_ESCAPE:
00266     <span class="keywordflow">case</span> VK_F6:
00267         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, &amp;tlpwndActive);
00268         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, WM_SYSCOMMAND,
00269                 (UINT)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1226">_GetKeyState</a>(VK_SHIFT) &lt; 0 ? SC_NEXTWINDOW : SC_PREVWINDOW),
00270                         (LONG)(DWORD)(WORD)wKey);
00271         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndActive);
00272        <span class="keywordflow">break</span>;
00273     }
00274 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="dwp.c::xxxDWP_SetCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDWP_SetCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndHit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codeHT</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00402">402</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00583">_GetMenuState()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00125">DWP_GetEnabledPopup()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02568">GetChildParent</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02773">SYSCUR</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05262">TestUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l07066">UP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02327">xxxActiveWindowTracking()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00027">xxxFlashWindow()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00189">xxxGetSysMenu()</a>, <a class="el" href="../../d5/d3/kernel_2msgbeep_8c-source.html#l00052">xxxMessageBeep()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l01990">xxxSetActiveWindow()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l01468">xxxSetWindowPos()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00028">zzzSetCursor()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00407 {
00408     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent, pwndPopup, pwndHit;
00409     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcur;
00410     LRESULT lt;
00411     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
00412     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndPopup;
00413 
00414     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00415     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00416 
00417     <span class="comment">/*</span>
00418 <span class="comment">     * wParam  == pwndHit == pwnd that cursor is over</span>
00419 <span class="comment">     * lParamL == ht  == Hit test area code (result of WM_NCHITTEST)</span>
00420 <span class="comment">     * lParamH == msg     == Mouse message number</span>
00421 <span class="comment">     */</span>
00422     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>)
00423     {
00424         <span class="keywordflow">switch</span> (codeHT)
00425         {
00426         <span class="keywordflow">case</span> HTLEFT:
00427         <span class="keywordflow">case</span> HTRIGHT:
00428             pcur = <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(SIZEWE);
00429             <span class="keywordflow">break</span>;
00430         <span class="keywordflow">case</span> HTTOP:
00431         <span class="keywordflow">case</span> HTBOTTOM:
00432             pcur = <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(SIZENS);
00433             <span class="keywordflow">break</span>;
00434         <span class="keywordflow">case</span> HTTOPLEFT:
00435         <span class="keywordflow">case</span> HTBOTTOMRIGHT:
00436             pcur = <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(SIZENWSE);
00437             <span class="keywordflow">break</span>;
00438         <span class="keywordflow">case</span> HTTOPRIGHT:
00439         <span class="keywordflow">case</span> HTBOTTOMLEFT:
00440             pcur = <a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(SIZENESW);
00441             <span class="keywordflow">break</span>;
00442 
00443         <span class="keywordflow">default</span>:
00444             <span class="keywordflow">goto</span> NotSize;
00445         }
00446 
00447         pwndHit = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwndHit);
00448         <span class="keywordflow">if</span> (pwndHit == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00449             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00450 
00451         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndHit, WFSYSMENU)) {
00452             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndHit;
00453             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwState;
00454 
00455             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndHit, &amp;tlpwndHit);
00456             dwState = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a11">_GetMenuState</a>(
00457                     <a class="code" href="../../d4/d1/userk_8h.html#a1404">xxxGetSysMenu</a>(pwndHit, TRUE), SC_SIZE, MF_BYCOMMAND);
00458             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndHit);
00459 
00460             <span class="keywordflow">if</span> ((dwState != (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) -1) &amp;&amp; (dwState &amp; MFS_GRAYED))
00461                 <span class="keywordflow">goto</span> UseNormalCursor;
00462         }
00463         <span class="comment">/*</span>
00464 <span class="comment">         * No need to DeferWinEventNotify() - we're about to return</span>
00465 <span class="comment">         */</span>
00466         <a class="code" href="../../d4/d1/userk_8h.html#a1785">zzzSetCursor</a>(pcur);
00467         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00468     }
00469 
00470 NotSize:
00471 
00472     pwndParent = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a741">GetChildParent</a>(pwnd);
00473 
00474     <span class="comment">/*</span>
00475 <span class="comment">     * Some windows (like the list boxes of comboboxes), are marked with</span>
00476 <span class="comment">     * the child bit but are actually child of the desktop (can happen</span>
00477 <span class="comment">     * if you call SetParent()). Make this special case check for</span>
00478 <span class="comment">     * the desktop here.</span>
00479 <span class="comment">     */</span>
00480     <span class="keywordflow">if</span> (pwndParent == <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd))
00481         pwndParent = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00482 
00483     <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00484         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndParent, &amp;tlpwndParent);
00485         lt = <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndParent, WM_SETCURSOR, (WPARAM)hwndHit,
00486             MAKELONG(codeHT, msg));
00487         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00488         <span class="keywordflow">if</span> (lt != 0)
00489             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00490     }
00491 
00492     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == 0) {
00493         <span class="comment">/*</span>
00494 <span class="comment">         * No need to DeferWinEventNotify() - we're about to return</span>
00495 <span class="comment">         */</span>
00496         <a class="code" href="../../d4/d1/userk_8h.html#a1785">zzzSetCursor</a>(<a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(ARROW));
00497 
00498     } <span class="keywordflow">else</span> {
00499         pwndHit = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwndHit);
00500         <span class="keywordflow">if</span> (pwndHit == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00501             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00502 
00503         <span class="keywordflow">switch</span> (codeHT) {
00504         <span class="keywordflow">case</span> HTCLIENT:
00505             <span class="keywordflow">if</span> (pwndHit-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;spcur != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00506                 <span class="comment">/*</span>
00507 <span class="comment">                 * No need to DeferWinEventNotify() - we're about to return</span>
00508 <span class="comment">                 */</span>
00509                 <a class="code" href="../../d4/d1/userk_8h.html#a1785">zzzSetCursor</a>(pwndHit-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;spcur);
00510             }
00511             <span class="keywordflow">break</span>;
00512 
00513         <span class="keywordflow">case</span> HTERROR:
00514             <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00515             <span class="keywordflow">case</span> WM_MOUSEMOVE:
00516                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a563">TestUP</a>(ACTIVEWINDOWTRACKING)) {
00517                     <a class="code" href="../../d4/d1/userk_8h.html#a1655">xxxActiveWindowTracking</a>(pwnd, WM_SETCURSOR, codeHT);
00518                 }
00519                 <span class="keywordflow">break</span>;
00520 
00521             <span class="keywordflow">case</span> WM_LBUTTONDOWN:
00522                 <span class="keywordflow">if</span> ((pwndPopup = <a class="code" href="../../d4/d1/userk_8h.html#a1633">DWP_GetEnabledPopup</a>(pwnd)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00523                     <span class="keywordflow">if</span> (pwndPopup != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)-&gt;spwndChild) {
00524                         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndActiveOld;
00525 
00526                         pwndActiveOld = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndActive;
00527 
00528                         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndPopup, &amp;tlpwndPopup);
00529 
00530                         <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pwnd, NULL, 0, 0, 0, 0,
00531                                 SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);
00532 
00533                         <a class="code" href="../../d4/d1/userk_8h.html#a1666">xxxSetActiveWindow</a>(pwndPopup);
00534 
00535                         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndPopup);
00536 
00537                         <span class="keywordflow">if</span> (pwndActiveOld != <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndActive)
00538                             <span class="keywordflow">break</span>;
00539 
00540                         <span class="comment">/*</span>
00541 <span class="comment">                         *** ELSE FALL THRU **</span>
00542 <span class="comment">                         */</span>
00543                     }
00544                 }
00545 
00546                 <span class="comment">/*</span>
00547 <span class="comment">                 *** FALL THRU **</span>
00548 <span class="comment">                 */</span>
00549 
00550             <span class="keywordflow">case</span> WM_RBUTTONDOWN:
00551             <span class="keywordflow">case</span> WM_MBUTTONDOWN:
00552             <span class="keywordflow">case</span> WM_XBUTTONDOWN:
00553                 {
00554                     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDlg;
00555 
00556                     pwndDlg = <a class="code" href="../../d4/d1/userk_8h.html#a1633">DWP_GetEnabledPopup</a>(pwnd);
00557 
00558                     <span class="keywordflow">if</span> (pwndDlg != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00559 
00560                         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndDlg, &amp;tlpwndPopup);
00561 
00562                         <a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a2">xxxFlashWindow</a>(pwndDlg,
00563                                        MAKELONG(FLASHW_ALL, <a class="code" href="../../d4/d1/userk_8h.html#a743">UP</a>(FOREGROUNDFLASHCOUNT)),
00564                                        (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtCaretBlink &gt;&gt; 3));
00565 
00566                         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndPopup);
00567                     }
00568 
00569                     <a class="code" href="../../d4/d1/userk_8h.html#a1730">xxxMessageBeep</a>(0);
00570 
00571                     <span class="keywordflow">break</span>;
00572                 }
00573             }
00574 
00575             <span class="comment">/*</span>
00576 <span class="comment">             *** FALL THRU **</span>
00577 <span class="comment">             */</span>
00578 
00579         <span class="keywordflow">default</span>:
00580 UseNormalCursor:
00581             <span class="comment">/*</span>
00582 <span class="comment">             * No need to DeferWinEventNotify() - we're about to return</span>
00583 <span class="comment">             */</span>
00584             <a class="code" href="../../d4/d1/userk_8h.html#a1785">zzzSetCursor</a>(<a class="code" href="../../d4/d1/userk_8h.html#a321">SYSCUR</a>(ARROW));
00585             <span class="keywordflow">break</span>;
00586         }
00587     }
00588 
00589     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00590 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="dwp.c::xxxDWP_SetIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HICON xxxDWP_SetIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HICON&nbsp;</td>
          <td class="mdname" nowrap> <em>hicoNew</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l01109">1109</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d8/d3/loadbits_8c-source.html#l00539">_DestroyCursor()</a>, <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01312">tagSERVERINFO::atomIconProp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01311">tagSERVERINFO::atomIconSmProp</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02169">CURSOR_ALWAYSDESTROY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02179">CURSORF_SECRET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00353">HMValidateHandleNoRip()</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00039">InternalSetProp()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01724">PROPF_NOPOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00908">TYPE_CURSOR</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01223">xxxCreateWindowSmIcon()</a>, <a class="el" href="../../d3/d7/metrics_8c-source.html#l00075">xxxRecreateSmallIcons()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">xxxRedrawTitle()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>01113 {
01114     HICON   hIcon;
01115     HICON   hIconSm;
01116     HICON   hOld;
01117     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fRedraw;
01118 
01119     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01120 
01121 <span class="preprocessor">#if DBG</span>
01122 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (hicoNew &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(hicoNew)) {
01123         RIPMSG1(RIP_WARNING, <span class="stringliteral">"WM_SETICON: Icon handle missing HIWORD (0x%08X)"</span>, hicoNew);
01124     }
01125 <span class="preprocessor">#endif</span>
01126 <span class="preprocessor"></span>
01127     <span class="keywordflow">if</span> (wType &lt; ICON_SMALL || wType &gt; ICON_RECREATE)
01128     {
01129         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"WM_SETICON: Invalid wParam value (0x%0X)"</span>, wType);
01130         <span class="keywordflow">return</span> (HICON)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01131     }
01132 
01133     <span class="comment">/*</span>
01134 <span class="comment">     *  Regenerate small icons if requested.</span>
01135 <span class="comment">     */</span>
01136     <span class="keywordflow">if</span> (wType == ICON_RECREATE) {
01137         <a class="code" href="../../d4/d1/userk_8h.html#a1472">xxxRecreateSmallIcons</a>(pwnd);
01138         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01139     }
01140 
01141     <span class="comment">/*</span>
01142 <span class="comment">     *  Save old icon</span>
01143 <span class="comment">     */</span>
01144     hIcon = (HICON)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o29">atomIconProp</a>), PROPF_INTERNAL);
01145     hIconSm = (HICON)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), PROPF_INTERNAL);
01146     hOld = ((wType == ICON_SMALL) ? hIconSm : hIcon);
01147 
01148     <span class="comment">/*</span>
01149 <span class="comment">     * Only update the icons if they have changed</span>
01150 <span class="comment">     */</span>
01151     <span class="keywordflow">if</span> (hOld != hicoNew)
01152     {
01153         <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcursor;
01154         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWasCache = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01155 
01156         fRedraw = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01157 
01158         <span class="comment">/*</span>
01159 <span class="comment">         *  Always remove the small icon because it is either being replaced or</span>
01160 <span class="comment">         *  will be recreated if the big icon is being set.</span>
01161 <span class="comment">         */</span>
01162         pcursor = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>(hIconSm, TYPE_CURSOR);
01163         <span class="keywordflow">if</span> (pcursor &amp;&amp; (pcursor-&gt;CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a540">CURSORF_SECRET</a>)) {
01164             fWasCache = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01165             <a class="code" href="../../d4/d1/userk_8h.html#a1782">_DestroyCursor</a>(pcursor, CURSOR_ALWAYSDESTROY);
01166         }
01167 
01168         <span class="keywordflow">if</span> (wType == ICON_SMALL) {
01169             <span class="comment">/*</span>
01170 <span class="comment">             *  Apps never see the icons that USER creates behind their backs</span>
01171 <span class="comment">             *  from big icons.</span>
01172 <span class="comment">             */</span>
01173             <span class="keywordflow">if</span> (fWasCache)
01174                 hOld = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01175 
01176             hIconSm = hicoNew;
01177         } <span class="keywordflow">else</span> {
01178             <span class="keywordflow">if</span> (fWasCache) {
01179                 <span class="comment">/*</span>
01180 <span class="comment">                 * Force us to recalc the small icon to match the new big icon</span>
01181 <span class="comment">                 */</span>
01182                 hIconSm = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01183             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hIconSm) {
01184                 <span class="comment">/*</span>
01185 <span class="comment">                 * Redraw of the caption isn't needed because the small icon</span>
01186 <span class="comment">                 * didn't change.</span>
01187 <span class="comment">                 */</span>
01188                 fRedraw = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01189             }
01190 
01191             hIcon = hicoNew;
01192         }
01193 
01194 
01195         <span class="comment">/*</span>
01196 <span class="comment">         *  Store the icons off the window as properties</span>
01197 <span class="comment">         */</span>
01198         <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a0">InternalSetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o29">atomIconProp</a>), (HANDLE)hIcon, PROPF_INTERNAL | PROPF_NOPOOL);
01199         <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a0">InternalSetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), (HANDLE)hIconSm, PROPF_INTERNAL | PROPF_NOPOOL);
01200 
01201         <span class="comment">/*</span>
01202 <span class="comment">         *  Create the small icon if it doesn't exist.</span>
01203 <span class="comment">         */</span>
01204         <span class="keywordflow">if</span> (hIcon &amp;&amp; !hIconSm)
01205             <a class="code" href="../../d4/d1/userk_8h.html#a1448">xxxCreateWindowSmIcon</a>(pwnd, hIcon, TRUE);
01206 
01207         <span class="comment">/*</span>
01208 <span class="comment">         * Redraw caption if the small icon has changed</span>
01209 <span class="comment">         */</span>
01210         <span class="keywordflow">if</span> (fRedraw)
01211             <a class="code" href="../../d4/d1/userk_8h.html#a1995">xxxRedrawTitle</a>(pwnd, DC_ICON);
01212     }
01213     <span class="keywordflow">return</span> hOld;
01214 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="dwp.c::xxxDWP_SetRedraw" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDWP_SetRedraw           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRedraw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00055">55</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03657">AnySpbs</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02232">IDC_DEFAULT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05237">SetVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l01126">SpbCheckPwnd()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02587">SV_CLRFTRUEVIS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02586">SV_SET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02585">SV_UNSET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02318">WFWIN31COMPAT</a>, and <a class="el" href="../../d9/d2/dc_8c-source.html#l01812">zzzInvalidateDCCache()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00058 {
00059     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00060     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00061 
00062     <span class="keywordflow">if</span> (fRedraw) {
00063         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00064             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwnd, SV_SET);
00065 
00066             <span class="comment">/*</span>
00067 <span class="comment">             * We made this window visible - if it is behind any SPBs,</span>
00068 <span class="comment">             * then we need to go invalidate them.</span>
00069 <span class="comment">             *</span>
00070 <span class="comment">             * We do this AFTER we make the window visible, so that</span>
00071 <span class="comment">             * SpbCheckHwnd won't ignore it.</span>
00072 <span class="comment">             */</span>
00073             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a417">AnySpbs</a>())
00074                 <a class="code" href="../../d4/d1/userk_8h.html#a1770">SpbCheckPwnd</a>(pwnd);
00075 
00076             <span class="comment">/*</span>
00077 <span class="comment">             * Now we need to invalidate/recalculate any affected cache entries</span>
00078 <span class="comment">             * This call must be AFTER the window state change</span>
00079 <span class="comment">             * No need to DeferWinEventNotify() since pwnd is threadlocked.</span>
00080 <span class="comment">             */</span>
00081             <a class="code" href="../../d4/d1/userk_8h.html#a1004">zzzInvalidateDCCache</a>(pwnd, IDC_DEFAULT);
00082 
00083             <span class="comment">/*</span>
00084 <span class="comment">             * Because 3.1 sometimes doesn't draw window frames when 3.0 did,</span>
00085 <span class="comment">             * we need to ensure that the frame gets drawn if the window is</span>
00086 <span class="comment">             * later invalidated after a WM_SETREDRAW(TRUE)</span>
00087 <span class="comment">             */</span>
00088             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSENDNCPAINT);
00089         }
00090     } <span class="keywordflow">else</span> {
00091         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00092 
00093             <span class="comment">/*</span>
00094 <span class="comment">             * Invalidate any SPBs.</span>
00095 <span class="comment">             *</span>
00096 <span class="comment">             * We do this BEFORE we make the window invisible, so</span>
00097 <span class="comment">             * SpbCheckHwnd() won't ignore it.</span>
00098 <span class="comment">             */</span>
00099             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a417">AnySpbs</a>())
00100                 <a class="code" href="../../d4/d1/userk_8h.html#a1770">SpbCheckPwnd</a>(pwnd);
00101 
00102             <span class="comment">/*</span>
00103 <span class="comment">             * Clear WFVISIBLE and delete any update regions lying around.</span>
00104 <span class="comment">             */</span>
00105             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwnd, SV_UNSET | (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN31COMPAT) ? SV_CLRFTRUEVIS : 0));
00106 
00107             <span class="comment">/*</span>
00108 <span class="comment">             * Now we need to invalidate/recalc affected cache entries</span>
00109 <span class="comment">             * This call must be AFTER the window state change</span>
00110 <span class="comment">             * No need to DeferWinEventNotify() since we're about to return.</span>
00111 <span class="comment">             */</span>
00112             <a class="code" href="../../d4/d1/userk_8h.html#a1004">zzzInvalidateDCCache</a>(pwnd, IDC_DEFAULT);
00113         }
00114     }
00115 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="dwp.c::xxxDWPPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDWPPrint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00846">846</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00091">BuildHwndList()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03634">BWL_ENUMLIST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01594">CFPARENTDC</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00417">FreeHwndList()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03624">tagBWL::rghwnd</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05237">SetVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01747">tagWND::spwndOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02586">SV_SET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02585">SV_UNSET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02267">WFFRAMEON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02276">WFMENUDRAW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00076">xxxDrawWindowFrame()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>00850 {
00851     POINT  pt;
00852     <span class="keywordtype">int</span>    iDC;
00853     LPRECT lprc;
00854     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>   pwndSave = pwnd;
00855     LPARAM lParamSave = lParam;
00856     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fNotVisible;
00857     <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a>   pbwl;
00858     HWND   *phwnd;
00859     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>     tlpwnd;
00860 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00861 <span class="preprocessor"></span>    <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  dwOldLayout;
00862     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   bMirrorDC;
00863 <span class="preprocessor">#endif</span>
00864 <span class="preprocessor"></span>    <span class="keywordtype">int</span>    iMirrorOffset=0;
00865 
00866     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00867 
00868     <span class="keywordflow">if</span> ((lParam &amp; PRF_CHECKVISIBLE) &amp;&amp; !<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(pwnd))
00869         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00870 
00871 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00872 <span class="preprocessor"></span>    bMirrorDC = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL) &amp;&amp; !MIRRORED_HDC(hdc));
00873     <span class="comment">/*</span>
00874 <span class="comment">     * If the DC will be mirrored then we shift the clip rect by one</span>
00875 <span class="comment">     * to include the right most pixel</span>
00876 <span class="comment">     */</span>
00877     <span class="keywordflow">if</span> (bMirrorDC)
00878         iMirrorOffset=1;
00879 <span class="preprocessor">#endif</span>
00880 <span class="preprocessor"></span>
00881     <span class="keywordflow">if</span> (lParam &amp; PRF_NONCLIENT) {
00882 
00883         <span class="comment">/*</span>
00884 <span class="comment">         * draw non-client area first</span>
00885 <span class="comment">         */</span>
00886         <span class="keywordflow">if</span> (fNotVisible = !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE))
00887             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwnd, SV_SET);
00888 
00889         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFMENUDRAW);
00890 
00891 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00892 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (bMirrorDC) {
00893             dwOldLayout = GreSetLayout(hdc, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left, LAYOUT_RTL);
00894             <a class="code" href="../../d4/d1/userk_8h.html#a1443">xxxDrawWindowFrame</a>(pwnd, hdc, FALSE, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFFRAMEON));
00895             GreSetLayout(hdc, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left, dwOldLayout);
00896         } <span class="keywordflow">else</span>
00897 <span class="preprocessor">#endif</span>
00898 <span class="preprocessor"></span>        {
00899             <a class="code" href="../../d4/d1/userk_8h.html#a1443">xxxDrawWindowFrame</a>(pwnd, hdc, FALSE, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFFRAMEON));
00900         }
00901 
00902         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFMENUDRAW);
00903 
00904         <span class="keywordflow">if</span> (fNotVisible)
00905             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwnd, SV_UNSET);
00906     }
00907 
00908     <span class="keywordflow">if</span> (lParam &amp; PRF_CLIENT) {
00909 
00910         <span class="comment">/*</span>
00911 <span class="comment">         * draw client area second</span>
00912 <span class="comment">         */</span>
00913         iDC = GreSaveDC(hdc);
00914         GreGetWindowOrg(hdc, &amp;pt);
00915 
00916         <span class="keywordflow">if</span> (lParam &amp; PRF_NONCLIENT) {
00917             <span class="keywordtype">int</span> xBorders, yBorders;
00918 
00919             <span class="comment">/*</span>
00920 <span class="comment">             * adjust for non-client area</span>
00921 <span class="comment">             */</span>
00922             xBorders = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00923             yBorders = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00924             GreSetWindowOrg(hdc, pt.x - xBorders, pt.y - yBorders, NULL);
00925         }
00926 
00927         lprc = &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00928         GreIntersectClipRect(hdc, iMirrorOffset, 0, lprc-&gt;right - lprc-&gt;left + iMirrorOffset, lprc-&gt;bottom - lprc-&gt;top);
00929 
00930 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00931 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (bMirrorDC) {
00932             dwOldLayout = GreSetLayout(hdc, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left, LAYOUT_RTL);
00933             <span class="keywordflow">if</span> (lParam &amp; PRF_ERASEBKGND)
00934                 <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_ERASEBKGND, (WPARAM) hdc, 0L);
00935             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_PRINTCLIENT, (WPARAM) hdc, lParam);
00936             GreSetLayout(hdc, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left, dwOldLayout);
00937         } <span class="keywordflow">else</span>
00938 <span class="preprocessor">#endif</span>
00939 <span class="preprocessor"></span>        {
00940 
00941             <span class="keywordflow">if</span> (lParam &amp; PRF_ERASEBKGND)
00942                 <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_ERASEBKGND, (WPARAM) hdc, 0L);
00943             <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_PRINTCLIENT, (WPARAM) hdc, lParam);
00944         }
00945 
00946         GreRestoreDC(hdc, iDC);
00947 
00948         pt.x += pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00949         pt.y += pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00950 
00951         <span class="keywordflow">if</span> (lParam &amp; PRF_CHILDREN) {
00952 
00953             <span class="comment">/*</span>
00954 <span class="comment">             * when drawing children, always include nonclient area</span>
00955 <span class="comment">             */</span>
00956             lParam |= PRF_NONCLIENT | PRF_ERASEBKGND;
00957 
00958             lParam &amp;= ~PRF_CHECKVISIBLE;
00959 
00960             <span class="comment">/*</span>
00961 <span class="comment">             * draw children last</span>
00962 <span class="comment">             */</span>
00963             pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, BWL_ENUMLIST, NULL);
00964             <span class="keywordflow">if</span> (pbwl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00965                 <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
00966                     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00967                         <span class="keywordflow">continue</span>;
00968 
00969                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00970                         lprc = &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>;
00971                         iDC = GreSaveDC(hdc);
00972                         GreSetWindowOrg(hdc, pt.x - lprc-&gt;left, pt.y - lprc-&gt;top, NULL);
00973                         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFPARENTDC)) {
00974                             GreIntersectClipRect(hdc, 0, 0, lprc-&gt;right - lprc-&gt;left, lprc-&gt;bottom - lprc-&gt;top);
00975                         }
00976                         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd, &amp;tlpwnd);
00977                         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_PRINT, (WPARAM) hdc, lParam);
00978                         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00979                         GreRestoreDC(hdc, iDC);
00980                     }
00981                 }
00982                 <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
00983             }
00984         }
00985 
00986         <span class="keywordflow">if</span> (lParam &amp; PRF_OWNED) {
00987             pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>((<a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd))-&gt;spwndChild, BWL_ENUMLIST, NULL);
00988             <span class="keywordflow">if</span> (pbwl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00989                 <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
00990 
00991                     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00992                         <span class="keywordflow">continue</span>;
00993 
00994                     <span class="keywordflow">if</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> == pwndSave) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00995                         iDC = GreSaveDC(hdc);
00996                         GreSetWindowOrg(hdc, pt.x - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left, pt.y - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top, NULL);
00997                         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd, &amp;tlpwnd);
00998                         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_PRINT, (WPARAM) hdc, lParamSave);
00999                         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01000                         GreRestoreDC(hdc, iDC);
01001                     }
01002                 }
01003                 <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
01004             }
01005         }
01006     }
01007 
01008     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01009 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="dwp.c::xxxRedrawTitle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxRedrawTitle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">766</a> of file <a class="el" href="../../d9/d2/dwp_8c-source.html">dwp.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00201">_GetWindowDC()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d9/d6/winloop2_8c-source.html#l00062">IsTrayWindow()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03719">PostShellHookMessages()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02571">TestwndFrameOn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02411">WFBORDERMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02412">WFCAPTION</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01246">xxxCallHook()</a>, and <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01109">xxxDWP_SetIcon()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00494">xxxEnableMenuItem()</a>, <a class="el" href="../../d3/d9/kernel_2help_8c-source.html#l00073">xxxHelpLoop()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00026">xxxSetClassIconEnum()</a>.
<p>
<pre class="fragment"><div>00768 {
00769     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDrawn = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00770 
00771     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00772 
00773     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00774 
00775         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFBORDERMASK) == (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(WFCAPTION)) {
00776 
00777             HDC hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1696">_GetWindowDC</a>(pwnd);
00778             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a743">TestwndFrameOn</a>(pwnd))
00779                 wFlags |= DC_ACTIVE;
00780             <a class="code" href="../../d4/d1/userk_8h.html#a1438">xxxDrawCaptionBar</a>(pwnd, hdc, wFlags);
00781             <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00782         }
00783         <span class="keywordflow">else</span>
00784             fDrawn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00785     }
00786 
00787     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d7/winloop2_8c.html#a2">IsTrayWindow</a>(pwnd) &amp;&amp; (wFlags &amp; (DC_ICON | DC_TEXT)) ) {
00788         HWND hw = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00789         <a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HSHELL_REDRAW, (WPARAM)hw, 0L, WH_SHELL);
00790         <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_REDRAW, (LPARAM)hw);
00791 
00792     }
00793     <span class="keywordflow">return</span>(fDrawn);
00794 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:31 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
