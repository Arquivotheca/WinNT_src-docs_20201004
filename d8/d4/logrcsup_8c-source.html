<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: logrcsup.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>logrcsup.c</h1><a href="../../d7/d5/logrcsup_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    LogRcSup.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements support for dealing with log records, both</span>
00012 <span class="comment">    writing and recovering them.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Brian Andrew    [BrianAn]   20-June-1991</span>
00017 <span class="comment"></span>
00018 <span class="comment">Revision History:</span>
00019 <span class="comment"></span>
00020 <span class="comment">--*/</span>
00021 
00022 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/lfsprocs_8h.html">lfsprocs.h</a>"</span>
00023 
00024 <span class="comment">//</span>
00025 <span class="comment">//  The debug trace level</span>
00026 <span class="comment">//</span>
00027 
<a name="l00028"></a><a class="code" href="../../d7/d5/logrcsup_8c.html#a0">00028</a> <span class="preprocessor">#define Dbg                              (DEBUG_TRACE_LOG_RECORD_SUP)</span>
00029 <span class="preprocessor"></span>
00030 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00031 <a class="code" href="../../d7/d5/logrcsup_8c.html#a1">LfsPrepareLfcbForLogRecord</a> (
00032     IN OUT <a class="code" href="../../d1/d0/struct__LFCB.html">PLFCB</a> Lfcb,
00033     IN ULONG RemainingLogBytes
00034     );
00035 
00036 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00037 <a class="code" href="../../d7/d5/logrcsup_8c.html#a2">LfsTransferLogBytes</a> (
00038     IN <a class="code" href="../../d4/d9/struct__LBCB.html">PLBCB</a> Lbcb,
00039     IN OUT <a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html">PLFS_WRITE_ENTRY</a> *ThisWriteEntry,
00040     IN OUT PCHAR *CurrentBuffer,
00041     IN OUT PULONG CurrentByteCount,
00042     IN OUT PULONG PadBytes,
00043     IN OUT PULONG RemainingPageBytes,
00044     IN OUT PULONG RemainingLogBytes
00045     );
00046 
00047 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, LfsPrepareLfcbForLogRecord)</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, LfsTransferLogBytes)</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, LfsWriteLogRecordIntoLogPage)</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>
00053 
00054 BOOLEAN
<a name="l00055"></a><a class="code" href="../../d7/d5/logrcsup_8c.html#a3">00055</a> <a class="code" href="../../d7/d5/logrcsup_8c.html#a3">LfsWriteLogRecordIntoLogPage</a> (
00056     IN <a class="code" href="../../d1/d0/struct__LFCB.html">PLFCB</a> Lfcb,
00057     IN <a class="code" href="../../d6/d9/struct__LCH.html">PLCH</a> Lch,
00058     IN ULONG NumberOfWriteEntries,
00059     IN <a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html">PLFS_WRITE_ENTRY</a> WriteEntries,
00060     IN LFS_RECORD_TYPE RecordType,
00061     IN TRANSACTION_ID *TransactionId OPTIONAL,
00062     IN LSN ClientUndoNextLsn OPTIONAL,
00063     IN LSN ClientPreviousLsn OPTIONAL,
00064     IN LONG UndoRequirement,
00065     IN BOOLEAN ForceToDisk,
00066     OUT PLSN Lsn
00067     )
00068 
00069 <span class="comment">/*++</span>
00070 <span class="comment"></span>
00071 <span class="comment">Routine Description:</span>
00072 <span class="comment"></span>
00073 <span class="comment">    This routine is called to write a log record into the log file</span>
00074 <span class="comment">    using the cache manager.  If there is room in the current log</span>
00075 <span class="comment">    page it is added to that.  Otherwise we allocate a new log page</span>
00076 <span class="comment">    and write the log record header for this log page.  We then</span>
00077 <span class="comment">    write the log record into the remaining bytes of this page and</span>
00078 <span class="comment">    into any subsequent pages if needed.</span>
00079 <span class="comment"></span>
00080 <span class="comment">Arguments:</span>
00081 <span class="comment"></span>
00082 <span class="comment">    Lfcb - File control block for this log file.</span>
00083 <span class="comment"></span>
00084 <span class="comment">    Lch - This is the client handle, we may update the undo space for this</span>
00085 <span class="comment">          client.</span>
00086 <span class="comment"></span>
00087 <span class="comment">    NumberOfWriteEntries - Number of components of the log record.</span>
00088 <span class="comment"></span>
00089 <span class="comment">    WriteEntries - Pointer to an array of write entries.</span>
00090 <span class="comment"></span>
00091 <span class="comment">    UndoRequirement - Signed value indicating the requirement to write</span>
00092 <span class="comment">                      an abort log record for this log record.  A negative</span>
00093 <span class="comment">                      value indicates that this is the abort record.</span>
00094 <span class="comment"></span>
00095 <span class="comment">    RecordType - The Lfs-defined type of this log record.</span>
00096 <span class="comment"></span>
00097 <span class="comment">    TransactionId - Pointer to the transaction structure containing the</span>
00098 <span class="comment">                    Id for transaction containing this operation.</span>
00099 <span class="comment"></span>
00100 <span class="comment">    ClientUndoNextLsn - This is the Lsn provided by the client for use</span>
00101 <span class="comment">                        in his restart.  Will be the zero Lsn for</span>
00102 <span class="comment">                        a restart log record.</span>
00103 <span class="comment"></span>
00104 <span class="comment">    ClientPreviousLsn - This is the Lsn provided by the client for use</span>
00105 <span class="comment">                        in his restart.  Will the the zero Lsn for a</span>
00106 <span class="comment">                        restart log record.</span>
00107 <span class="comment"></span>
00108 <span class="comment">    UndoRequirement - This is the data size for the undo record for</span>
00109 <span class="comment">                      this log record.</span>
00110 <span class="comment"></span>
00111 <span class="comment">    ForceToDisk - Indicates if this log record will be flushed immediately</span>
00112 <span class="comment">                  to disk.</span>
00113 <span class="comment"></span>
00114 <span class="comment">    Lsn - A pointer to store the Lsn for this log record.</span>
00115 <span class="comment"></span>
00116 <span class="comment">Return Value:</span>
00117 <span class="comment"></span>
00118 <span class="comment">    BOOLEAN - Advisory, TRUE indicates that less than 1/4 of the log file is</span>
00119 <span class="comment">        available.</span>
00120 <span class="comment"></span>
00121 <span class="comment">--*/</span>
00122 
00123 {
00124     <a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html">PLFS_WRITE_ENTRY</a> ThisWriteEntry;
00125 
00126     ULONG RemainingLogBytes;
00127     ULONG OriginalLogBytes;
00128 
00129     ULONG RemainingPageBytes;
00130     ULONG HeaderAdjust;
00131 
00132     <a class="code" href="../../d4/d9/struct__LBCB.html">PLBCB</a> ThisLbcb;
00133 
00134     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> NextLsn;
00135 
00136     <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">PLFS_RECORD_HEADER</a> RecordHeader;
00137 
00138     PCHAR CurrentBuffer;
00139     ULONG CurrentByteCount;
00140     ULONG PadBytes;
00141 
00142     BOOLEAN LogFileFull = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00143 
00144     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00145 
00146     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( +1, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"LfsWriteLogRecordIntoLogPage:  Entered\n"</span>, 0 );
00147     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Lfcb                      -&gt; %08lx\n"</span>, Lfcb );
00148     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Lch                       -&gt; %08lx\n"</span>, Lch );
00149     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Number of Write Entries   -&gt; %08lx\n"</span>, NumberOfWriteEntries );
00150     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Write Entries             -&gt; %08lx\n"</span>, WriteEntries );
00151     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Record Type               -&gt; %08lx\n"</span>, RecordType );
00152     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Transaction Id            -&gt; %08lx\n"</span>, TransactionId );
00153     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"ClientUndoNextLsn (Low)   -&gt; %08lx\n"</span>, ClientUndoNextLsn.LowPart );
00154     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"ClientUndoNextLsn (High)  -&gt; %08lx\n"</span>, ClientUndoNextLsn.HighPart );
00155     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"ClientPreviousLsn (Low)   -&gt; %08lx\n"</span>, ClientPreviousLsn.LowPart );
00156     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"ClientPreviousLsn (High)  -&gt; %08lx\n"</span>, ClientPreviousLsn.HighPart );
00157     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"UndoRequirement           -&gt; %08lx\n"</span>, UndoRequirement );
00158     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"ForceToDisk               -&gt; %04x\n"</span>, ForceToDisk );
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">//  We compute the size of this log record.</span>
00162     <span class="comment">//</span>
00163 
00164     ThisWriteEntry = WriteEntries;
00165 
00166     RemainingLogBytes = 0;
00167 
00168     <span class="keywordflow">while</span> (NumberOfWriteEntries--) {
00169 
00170         RemainingLogBytes += <a class="code" href="../../d5/d5/cc_8h.html#a62">QuadAlign</a>( ThisWriteEntry-&gt;<a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html#o1">ByteLength</a> );
00171 
00172         ThisWriteEntry++;
00173     }
00174 
00175     OriginalLogBytes = RemainingLogBytes;
00176 
00177     ThisWriteEntry = WriteEntries;
00178 
00179     <span class="comment">//</span>
00180     <span class="comment">//  Loop until we have the Lbcb and we know it is not part of</span>
00181     <span class="comment">//  a partial page transfer.  We need to make sure we have</span>
00182     <span class="comment">//  a Bcb for this page.</span>
00183     <span class="comment">//</span>
00184 
00185     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00186 
00187         LogFileFull = <a class="code" href="../../d7/d5/lfs_2verfysup_8c.html#a1">LfsVerifyLogSpaceAvail</a>( Lfcb,
00188                                               Lch,
00189                                               RemainingLogBytes,
00190                                               UndoRequirement,
00191                                               ForceToDisk );
00192 
00193         <span class="comment">//</span>
00194         <span class="comment">//  We update the Lfcb so that we can start putting the log record into</span>
00195         <span class="comment">//  the top of the Lbcb active list.</span>
00196         <span class="comment">//</span>
00197 
00198         <a class="code" href="../../d7/d5/logrcsup_8c.html#a1">LfsPrepareLfcbForLogRecord</a>( Lfcb,
00199                                     RemainingLogBytes + Lfcb-&gt;RecordHeaderLength );
00200 
00201         ThisLbcb = CONTAINING_RECORD( Lfcb-&gt;LbcbActive.Flink,
00202                                       <a class="code" href="../../d4/d9/struct__LBCB.html">LBCB</a>,
00203                                       ActiveLinks );
00204 
00205         <span class="comment">//</span>
00206         <span class="comment">//  If there is a Bcb then we are golden.</span>
00207         <span class="comment">//</span>
00208 
00209         <span class="keywordflow">if</span> (ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o9">LogPageBcb</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) { <span class="keywordflow">break</span>; }
00210 
00211         <span class="comment">//</span>
00212         <span class="comment">//  Otherwise we want to drop the Lfcb and wait for the IO to complete.</span>
00213         <span class="comment">//</span>
00214 
00215         Lfcb-&gt;Waiters += 1;
00216 
00217         <a class="code" href="../../d0/d4/lfsprocs_8h.html#a29">LfsReleaseLfcb</a>( Lfcb );
00218 
00219         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>( &amp;Lfcb-&gt;Sync-&gt;Event,
00220                                <a class="code" href="../../d6/d7/halmips_8h.html#a455">Executive</a>,
00221                                <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>,
00222                                <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00223                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00224 
00225         <a class="code" href="../../d0/d4/lfsprocs_8h.html#a28">LfsAcquireLfcb</a>( Lfcb );
00226         Lfcb-&gt;Waiters -= 1;
00227     }
00228 
00229     RemainingPageBytes = (ULONG)Lfcb-&gt;LogPageSize - (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>;
00230 
00231     <span class="comment">//</span>
00232     <span class="comment">//  Compute the Lsn starting in the next log buffer.</span>
00233     <span class="comment">//</span>
00234 
00235     NextLsn.QuadPart = <a class="code" href="../../d0/d4/lfsprocs_8h.html#a10">LfsComputeLsnFromLbcb</a>( Lfcb, ThisLbcb );
00236 
00237     <span class="comment">//</span>
00238     <span class="comment">//  We get a pointer to the log record header and the start of the</span>
00239     <span class="comment">//  log record in the pinned buffer.</span>
00240     <span class="comment">//</span>
00241 
00242     RecordHeader = <a class="code" href="../../d2/d7/notify_8c.html#a7">Add2Ptr</a>( ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o8">PageHeader</a>,
00243                             (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>,
00244                             <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">PLFS_RECORD_HEADER</a> );
00245 
00246     <span class="comment">//</span>
00247     <span class="comment">//  We update the record header.</span>
00248     <span class="comment">//</span>
00249 
00250     <span class="comment">//</span>
00251     <span class="comment">//  Zero out the structure initially.</span>
00252     <span class="comment">//</span>
00253 
00254     RtlZeroMemory( RecordHeader, Lfcb-&gt;RecordHeaderLength );
00255 
00256     <span class="comment">//</span>
00257     <span class="comment">//  Update all the fields.</span>
00258     <span class="comment">//</span>
00259 
00260     RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o0">ThisLsn</a> = NextLsn;
00261     RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o1">ClientPreviousLsn</a> = ClientPreviousLsn;
00262     RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o2">ClientUndoNextLsn</a> = ClientUndoNextLsn;
00263 
00264     <span class="keywordflow">if</span> (TransactionId != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00265         RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o6">TransactionId</a> = *TransactionId;
00266     }
00267 
00268     RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o3">ClientDataLength</a> = RemainingLogBytes;
00269     RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o4">ClientId</a> = Lch-&gt;ClientId;
00270     RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o5">RecordType</a> = RecordType;
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">//  Check if this is a multi-page record.</span>
00274     <span class="comment">//</span>
00275 
00276     <span class="keywordflow">if</span> (RemainingLogBytes + Lfcb-&gt;RecordHeaderLength &gt; RemainingPageBytes) {
00277 
00278         <a class="code" href="../../d5/d5/cc_8h.html#a60">SetFlag</a>( RecordHeader-&gt;<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o7">Flags</a>, <a class="code" href="../../d9/d3/lfsdisk_8h.html#a5">LOG_RECORD_MULTI_PAGE</a> );
00279     }
00280 
00281     RemainingPageBytes -= Lfcb-&gt;RecordHeaderLength;
00282 
00283     <span class="comment">//</span>
00284     <span class="comment">//  Update the buffer position in the Lbcb</span>
00285     <span class="comment">//</span>
00286 
00287     (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a> += Lfcb-&gt;RecordHeaderLength;
00288     HeaderAdjust = Lfcb-&gt;RecordHeaderLength;
00289 
00290     <span class="comment">//</span>
00291     <span class="comment">//  Remember the values in the current write entry.</span>
00292     <span class="comment">//</span>
00293 
00294     CurrentBuffer = ThisWriteEntry-&gt;<a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html#o0">Buffer</a>;
00295     CurrentByteCount = ThisWriteEntry-&gt;<a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html#o1">ByteLength</a>;
00296 
00297     PadBytes = (8 - (CurrentByteCount &amp; ~(0xfffffff8))) &amp; ~(0xfffffff8);
00298 
00299     <span class="comment">//</span>
00300     <span class="comment">//  Continue to transfer bytes until all the client's data has</span>
00301     <span class="comment">//  been transferred.</span>
00302     <span class="comment">//</span>
00303 
00304     <span class="keywordflow">while</span> (RemainingLogBytes != 0) {
00305 
00306         <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html">PLFS_RECORD_PAGE_HEADER</a> PageHeader;
00307 
00308         PageHeader = (<a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html">PLFS_RECORD_PAGE_HEADER</a>) ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o8">PageHeader</a>;
00309 
00310         <span class="comment">//</span>
00311         <span class="comment">//  If the Lbcb is empty and we are about to store data into it we</span>
00312         <span class="comment">//  subtract the data size of the page from the available space.</span>
00313         <span class="comment">//  Update all the information we want to put in the header.</span>
00314         <span class="comment">//</span>
00315 
00316         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o13">LbcbFlags</a>, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a2">LBCB_NOT_EMPTY</a> )) {
00317 
00318             <span class="comment">//</span>
00319             <span class="comment">//  We subtract this page from the available pages only if</span>
00320             <span class="comment">//  we are at the beginning of the page.  Otherwise this</span>
00321             <span class="comment">//  could be a reuse page.  In that case it has already</span>
00322             <span class="comment">//  been subtracted.</span>
00323             <span class="comment">//</span>
00324 
00325             <span class="keywordflow">if</span> ((ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a> - HeaderAdjust == (ULONG)Lfcb-&gt;LogPageDataOffset) {
00326 
00327 
00328                 Lfcb-&gt;CurrentAvailable = Lfcb-&gt;CurrentAvailable - Lfcb-&gt;ReservedLogPageSize;                           <span class="comment">//**** xxSub( Lfcb-&gt;CurrentAvailable, Lfcb-&gt;ReservedLogPageSize );</span>
00329             }
00330 
00331             InsertTailList( &amp;Lfcb-&gt;LbcbWorkque, &amp;ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o2">WorkqueLinks</a> );
00332             <a class="code" href="../../d5/d5/cc_8h.html#a60">SetFlag</a>( ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o13">LbcbFlags</a>, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a2">LBCB_NOT_EMPTY</a> );
00333         }
00334 
00335         HeaderAdjust = 0;
00336 
00337         <span class="comment">//</span>
00338         <span class="comment">//  Compute the number of transfer bytes.  Update the remaining</span>
00339         <span class="comment">//  page bytes, remaining log bytes and position in the write</span>
00340         <span class="comment">//  buffer array.  This routine also copies the bytes into the buffer.</span>
00341         <span class="comment">//</span>
00342 
00343         <a class="code" href="../../d7/d5/logrcsup_8c.html#a2">LfsTransferLogBytes</a>( ThisLbcb,
00344                              &amp;ThisWriteEntry,
00345                              &amp;CurrentBuffer,
00346                              &amp;CurrentByteCount,
00347                              &amp;PadBytes,
00348                              &amp;RemainingPageBytes,
00349                              &amp;RemainingLogBytes );
00350 
00351         <span class="comment">//</span>
00352         <span class="comment">//  This log record ends on this page.  Update the fields for the</span>
00353         <span class="comment">//  ending Lsn.</span>
00354         <span class="comment">//</span>
00355 
00356         <span class="keywordflow">if</span> (RemainingLogBytes == 0) {
00357 
00358             <a class="code" href="../../d5/d5/cc_8h.html#a60">SetFlag</a>( ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o12">Flags</a>, <a class="code" href="../../d9/d3/lfsdisk_8h.html#a7">LOG_PAGE_LOG_RECORD_END</a> );
00359             ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o11">LastEndLsn</a> = NextLsn;
00360 
00361             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Lfcb-&gt;Flags, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a8">LFCB_PACK_LOG</a> )) {
00362 
00363                 PageHeader-&gt;<a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o9">Header</a>.Packed.LastEndLsn = NextLsn;
00364                 PageHeader-&gt;<a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o9">Header</a>.Packed.NextRecordOffset = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>;
00365             }
00366         }
00367 
00368         <span class="comment">//</span>
00369         <span class="comment">//  We are done with this page, update the fields in the page header.</span>
00370         <span class="comment">//</span>
00371 
00372         <span class="keywordflow">if</span> (RemainingPageBytes == 0
00373             || RemainingLogBytes == 0) {
00374 
00375             <span class="comment">//</span>
00376             <span class="comment">//  We are done with this page.  Update the Lbcb and page header.</span>
00377             <span class="comment">//</span>
00378 
00379             ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o10">LastLsn</a> = NextLsn;
00380             PageHeader-&gt;<a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o3">Copy</a>.LastLsn = NextLsn;
00381             PageHeader-&gt;<a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o4">Flags</a> = ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o12">Flags</a>;
00382 
00383             <span class="comment">//</span>
00384             <span class="comment">//  We can't put any more log records on this page.  Remove</span>
00385             <span class="comment">//  it from the active queue.</span>
00386             <span class="comment">//</span>
00387 
00388             <span class="keywordflow">if</span> (RemainingPageBytes &lt; Lfcb-&gt;RecordHeaderLength) {
00389 
00390                 RemoveHeadList( &amp;Lfcb-&gt;LbcbActive );
00391                 <a class="code" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>( ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o13">LbcbFlags</a>, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a1">LBCB_ON_ACTIVE_QUEUE</a> );
00392 
00393                 <span class="comment">//</span>
00394                 <span class="comment">//  If there are more log bytes then get the next Lbcb.</span>
00395                 <span class="comment">//</span>
00396 
00397                 <span class="keywordflow">if</span> (RemainingLogBytes != 0) {
00398 
00399                     ThisLbcb = CONTAINING_RECORD( Lfcb-&gt;LbcbActive.Flink,
00400                                                   <a class="code" href="../../d4/d9/struct__LBCB.html">LBCB</a>,
00401                                                   ActiveLinks );
00402 
00403                     RemainingPageBytes = (ULONG)Lfcb-&gt;LogPageSize
00404                                          - (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>;
00405                 }
00406             }
00407         }
00408     }
00409 
00410     *Lsn = NextLsn;
00411 
00412     Lfcb-&gt;RestartArea-&gt;CurrentLsn = NextLsn;
00413 
00414     Lfcb-&gt;RestartArea-&gt;LastLsnDataLength = OriginalLogBytes;
00415 
00416     <a class="code" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>( Lfcb-&gt;Flags, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a7">LFCB_NO_LAST_LSN</a> );
00417 
00418     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Lsn (Low)   -&gt; %08lx\n"</span>, Lsn-&gt;LowPart );
00419     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Lsn (High)  -&gt; %08lx\n"</span>, Lsn-&gt;HighPart );
00420     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( -1, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"LfsWriteLogRecordIntoLogPage:  Exit\n"</span>, 0 );
00421 
00422     <span class="keywordflow">return</span> LogFileFull;
00423 }
00424 
00425 
00426 <span class="comment">//</span>
00427 <span class="comment">//  Local support routine.</span>
00428 <span class="comment">//</span>
00429 
00430 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00431"></a><a class="code" href="../../d7/d5/logrcsup_8c.html#a1">00431</a> <a class="code" href="../../d7/d5/logrcsup_8c.html#a1">LfsPrepareLfcbForLogRecord</a> (
00432     IN OUT <a class="code" href="../../d1/d0/struct__LFCB.html">PLFCB</a> Lfcb,
00433     IN ULONG RemainingLogBytes
00434     )
00435 
00436 <span class="comment">/*++</span>
00437 <span class="comment"></span>
00438 <span class="comment">Routine Description:</span>
00439 <span class="comment"></span>
00440 <span class="comment">    This routine is called to insure that the Lfcb has a Lbcb in the</span>
00441 <span class="comment">    active queue to perform the next log record transfer.</span>
00442 <span class="comment">    This condition is met when there is a least one buffer block and</span>
00443 <span class="comment">    the log record data will fit entirely on this page or this buffer</span>
00444 <span class="comment">    block contains no other data in the unpacked case.  For the packed</span>
00445 <span class="comment">    case we just need to make sure that there are sufficient Lbcb's.</span>
00446 <span class="comment"></span>
00447 <span class="comment">Arguments:</span>
00448 <span class="comment"></span>
00449 <span class="comment">    Lfcb - File control block for this log file.</span>
00450 <span class="comment"></span>
00451 <span class="comment">    RemainingLogBytes - The number of bytes remaining for this log record.</span>
00452 <span class="comment"></span>
00453 <span class="comment">Return Value:</span>
00454 <span class="comment"></span>
00455 <span class="comment">    None</span>
00456 <span class="comment"></span>
00457 <span class="comment">--*/</span>
00458 
00459 {
00460     <a class="code" href="../../d4/d9/struct__LBCB.html">PLBCB</a> ThisLbcb;
00461     ULONG RemainingPageBytes;
00462     PLIST_ENTRY LbcbLinks;
00463 
00464     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00465 
00466     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( +1, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"LfsPrepareLfcbForLogRecord:  Entered\n"</span>, 0 );
00467     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Lfcb              -&gt; %08lx\n"</span>, Lfcb );
00468     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"RemainingLogBytes -&gt; %08lx\n"</span>, RemainingLogBytes );
00469 
00470     <span class="comment">//</span>
00471     <span class="comment">//  If there is no Lbcb in the active queue, we don't check it for size.</span>
00472     <span class="comment">//</span>
00473 
00474     <span class="keywordflow">if</span> (!IsListEmpty( &amp;Lfcb-&gt;LbcbActive )) {
00475 
00476         <span class="comment">//</span>
00477         <span class="comment">//  If the log record won't fit in the remaining bytes of this page,</span>
00478         <span class="comment">//  we queue this log buffer.</span>
00479         <span class="comment">//</span>
00480 
00481         ThisLbcb = CONTAINING_RECORD( Lfcb-&gt;LbcbActive.Flink,
00482                                       <a class="code" href="../../d4/d9/struct__LBCB.html">LBCB</a>,
00483                                       ActiveLinks );
00484 
00485         RemainingPageBytes = (ULONG)Lfcb-&gt;LogPageSize
00486                              - (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>;
00487 
00488         <span class="comment">//</span>
00489         <span class="comment">//  This log page won't do if the remaining bytes won't hold the data</span>
00490         <span class="comment">//  unless this is the first log record in the page or we are packing</span>
00491         <span class="comment">//  the log file.</span>
00492         <span class="comment">//</span>
00493 
00494         <span class="keywordflow">if</span> (RemainingLogBytes &gt; RemainingPageBytes
00495             &amp;&amp; !<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Lfcb-&gt;Flags, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a8">LFCB_PACK_LOG</a> )
00496             &amp;&amp; (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a> != (ULONG)Lfcb-&gt;LogPageDataOffset) {
00497 
00498             RemoveHeadList( &amp;Lfcb-&gt;LbcbActive );
00499             <a class="code" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>( ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o13">LbcbFlags</a>, <a class="code" href="../../d1/d4/lfsstruc_8h.html#a1">LBCB_ON_ACTIVE_QUEUE</a> );
00500         }
00501     }
00502 
00503     <span class="comment">//</span>
00504     <span class="comment">//  We now make sure we can allocate enough Lbcb's for all of the log pages</span>
00505     <span class="comment">//  we will need.  We now include the bytes for the log record reader.</span>
00506     <span class="comment">//</span>
00507 
00508     LbcbLinks = Lfcb-&gt;LbcbActive.Flink;
00509 
00510     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00511 
00512         <span class="comment">//</span>
00513         <span class="comment">//  If the Lbcb link we have is the head of the list, we will need another</span>
00514         <span class="comment">//  Lbcb.</span>
00515         <span class="comment">//</span>
00516 
00517         <span class="keywordflow">if</span> (LbcbLinks == &amp;Lfcb-&gt;LbcbActive) {
00518 
00519             ThisLbcb = <a class="code" href="../../d0/d4/lfsprocs_8h.html#a55">LfsGetLbcb</a>( Lfcb );
00520 
00521         } <span class="keywordflow">else</span> {
00522 
00523             ThisLbcb = CONTAINING_RECORD( LbcbLinks,
00524                                           <a class="code" href="../../d4/d9/struct__LBCB.html">LBCB</a>,
00525                                           ActiveLinks );
00526         }
00527 
00528         <span class="comment">//</span>
00529         <span class="comment">//  Remember the bytes remaining on this page.  This will always be quad</span>
00530         <span class="comment">//  aligned.</span>
00531         <span class="comment">//</span>
00532 
00533         RemainingPageBytes = (ULONG)Lfcb-&gt;LogPageSize - (ULONG)ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>;
00534 
00535         <span class="keywordflow">if</span> (RemainingPageBytes &gt;= RemainingLogBytes) {
00536 
00537             <span class="keywordflow">break</span>;
00538         }
00539 
00540         <span class="comment">//</span>
00541         <span class="comment">//  Move to the next log record.</span>
00542         <span class="comment">//</span>
00543 
00544         RemainingLogBytes -= RemainingPageBytes;
00545 
00546         LbcbLinks = ThisLbcb-&gt;<a class="code" href="../../d4/d9/struct__LBCB.html#o3">ActiveLinks</a>.Flink;
00547     }
00548 
00549     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( -1, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"LfsPrepareLfcbForLogRecord:  Exit\n"</span>, 0 );
00550 
00551     <span class="keywordflow">return</span>;
00552 }
00553 
00554 
00555 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00556"></a><a class="code" href="../../d7/d5/logrcsup_8c.html#a2">00556</a> <a class="code" href="../../d7/d5/logrcsup_8c.html#a2">LfsTransferLogBytes</a> (
00557     IN <a class="code" href="../../d4/d9/struct__LBCB.html">PLBCB</a> Lbcb,
00558     IN OUT <a class="code" href="../../d6/d1/struct__LFS__WRITE__ENTRY.html">PLFS_WRITE_ENTRY</a> *ThisWriteEntry,
00559     IN OUT PCHAR *CurrentBuffer,
00560     IN OUT PULONG CurrentByteCount,
00561     IN OUT PULONG PadBytes,
00562     IN OUT PULONG RemainingPageBytes,
00563     IN OUT PULONG RemainingLogBytes
00564     )
00565 
00566 <span class="comment">/*++</span>
00567 <span class="comment"></span>
00568 <span class="comment">Routine Description:</span>
00569 <span class="comment"></span>
00570 <span class="comment">    This routine is called to transfer the next block of bytes into</span>
00571 <span class="comment">    a log page.  It is given a pointer to the current position in the</span>
00572 <span class="comment">    current Lfs write entry and the number of bytes remaining on that</span>
00573 <span class="comment">    log page.  It will transfer as many of the client's bytes from the</span>
00574 <span class="comment">    current buffer that will fit and update various pointers.</span>
00575 <span class="comment"></span>
00576 <span class="comment">Arguments:</span>
00577 <span class="comment"></span>
00578 <span class="comment">    Lbcb - This is the buffer block for this log page.</span>
00579 <span class="comment"></span>
00580 <span class="comment">    ThisWriteEntry - This is a pointer to a pointer to the current Lfs</span>
00581 <span class="comment">                     write entry.</span>
00582 <span class="comment"></span>
00583 <span class="comment">    CurrentBuffer - This is a pointer to a pointer to the current position</span>
00584 <span class="comment">                    in the current write entry buffer.  If this points to a NULL</span>
00585 <span class="comment">                    value it means to put zero bytes into the log.</span>
00586 <span class="comment"></span>
00587 <span class="comment">    CurrentByteCount - This is a pointer to the number of bytes remaining</span>
00588 <span class="comment">                       in the current buffer.</span>
00589 <span class="comment"></span>
00590 <span class="comment">    PadBytes - This is a pointer to the number of padding byes for</span>
00591 <span class="comment">        this write entry.</span>
00592 <span class="comment"></span>
00593 <span class="comment">    RemainingPageBytes - This is pointer to the number of bytes remaining</span>
00594 <span class="comment">                         in this page.</span>
00595 <span class="comment"></span>
00596 <span class="comment">    RemainingLogBytes - This is the number of bytes remaining to transfer</span>
00597 <span class="comment">                        for this log record.</span>
00598 <span class="comment"></span>
00599 <span class="comment">Return Value:</span>
00600 <span class="comment"></span>
00601 <span class="comment">    None</span>
00602 <span class="comment"></span>
00603 <span class="comment">--*/</span>
00604 
00605 {
00606     PCHAR CurrentLogPagePosition;
00607     PCHAR CurrentClientPosition;
00608 
00609     ULONG TransferBytes;
00610     ULONG ThisPadBytes;
00611 
00612     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00613 
00614     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( +1, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"LfsTransferLogBytes:  Entered\n"</span>, 0 );
00615     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"Lbcb                      -&gt; %08lx\n"</span>, Lbcb );
00616     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"ThisWriteEntry            -&gt; %08lx\n"</span>, *ThisWriteEntry );
00617     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"CurrentBuffer             -&gt; %08lx\n"</span>, *CurrentBuffer );
00618     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"CurrentByteCount          -&gt; %08lx\n"</span>, *CurrentByteCount );
00619     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"RemainingPageBytes        -&gt; %08lx\n"</span>, *RemainingPageBytes );
00620     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(  0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"RemainingLogBytes         -&gt; %08lx\n"</span>, *RemainingLogBytes );
00621 
00622     <span class="comment">//</span>
00623     <span class="comment">//  Remember the current client buffer position and current position</span>
00624     <span class="comment">//  in log page.</span>
00625     <span class="comment">//</span>
00626 
00627     CurrentLogPagePosition = <a class="code" href="../../d2/d7/notify_8c.html#a7">Add2Ptr</a>( Lbcb-&gt;PageHeader, (ULONG)Lbcb-&gt;BufferOffset, PCHAR );
00628     CurrentClientPosition = *CurrentBuffer;
00629 
00630     <span class="comment">//</span>
00631     <span class="comment">//  The limiting factor is either the number of bytes remaining in a</span>
00632     <span class="comment">//  write entry or the number remaining in the log page.</span>
00633     <span class="comment">//</span>
00634 
00635     <span class="keywordflow">if</span> (*CurrentByteCount &lt;= *RemainingPageBytes) {
00636 
00637         TransferBytes = *CurrentByteCount;
00638 
00639         ThisPadBytes = *PadBytes;
00640 
00641         <span class="keywordflow">if</span> (*RemainingLogBytes != (*CurrentByteCount + *PadBytes) ) {
00642 
00643             (*ThisWriteEntry)++;
00644 
00645             *CurrentBuffer = (*ThisWriteEntry)-&gt;Buffer;
00646             *CurrentByteCount = (*ThisWriteEntry)-&gt;ByteLength;
00647 
00648             *PadBytes = (8 - (*CurrentByteCount &amp; ~(0xfffffff8))) &amp; ~(0xfffffff8);
00649         }
00650 
00651     } <span class="keywordflow">else</span> {
00652 
00653         TransferBytes = *RemainingPageBytes;
00654 
00655         ThisPadBytes = 0;
00656 
00657         *CurrentByteCount -= TransferBytes;
00658 
00659         <span class="keywordflow">if</span> (*CurrentBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00660 
00661             *CurrentBuffer += TransferBytes;
00662         }
00663     }
00664 
00665     <span class="comment">//</span>
00666     <span class="comment">//  Transfer the requested bytes.</span>
00667     <span class="comment">//</span>
00668 
00669     <span class="keywordflow">if</span> (CurrentClientPosition != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00670 
00671         RtlCopyMemory( CurrentLogPagePosition, CurrentClientPosition, TransferBytes );
00672 
00673     } <span class="keywordflow">else</span> {
00674 
00675         RtlZeroMemory( CurrentLogPagePosition, TransferBytes );
00676     }
00677 
00678     <span class="comment">//</span>
00679     <span class="comment">//  Reduce the remaining page and log bytes by the transfer amount and</span>
00680     <span class="comment">//  move forward in the log page.</span>
00681     <span class="comment">//</span>
00682 
00683     *RemainingLogBytes -= (TransferBytes + ThisPadBytes);
00684     *RemainingPageBytes -= (TransferBytes + ThisPadBytes);
00685 
00686     (ULONG)Lbcb-&gt;BufferOffset += (TransferBytes + ThisPadBytes);
00687 
00688     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( -1, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"LfsTransferLogBytes:  Exit\n"</span>, 0 );
00689 
00690     <span class="keywordflow">return</span>;
00691 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:39 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
