<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: sprite.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>sprite.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d9/d3/sprite_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a0">ALPHASTART</a>&nbsp;&nbsp;&nbsp;40</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a1">IncrementRedirectedCount</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a2">DecrementRedirectedCount</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HBITMAP&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a3">CreateRedirectionBitmap</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a4">ConvertRedirectionDCs</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HBITMAP hbm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a5">UpdateLayeredSprite</a> (<a class="el" href="../../d3/d2/structtagDCE.html">PDCE</a> pdce)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a6">DeleteRedirectionBitmap</a> (HBITMAP hbm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a7">RemoveRedirectionBitmap</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a8">_SetLayeredWindowAttributes</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, COLORREF crKey, <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bAlpha, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a9">UserRecreateRedirectionBitmap</a> (HWND hwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a10">UserRemoveRedirectionBitmap</a> (HWND hwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a11">RecreateRedirectionBitmap</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a12">UnsetLayeredWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a13">xxxSetLayeredWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fRepaintBehind)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a14">UserVisrgnFromHwnd</a> (HRGN *phrgn, HWND hwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a15">SetRectRelative</a> (PRECT prc, int dx, int dy, int dcx, int dcy)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a16">_UpdateLayeredWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdcDst, POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, COLORREF crKey, BLENDFUNCTION *pblend, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a17">DeleteFadeSprite</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a18">UpdateFade</a> (POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, BLENDFUNCTION *pblend)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HDC&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a19">CreateFade</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, RECT *prc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTime, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a20">ShowFade</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a21">StartFade</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a22">StopFade</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a23">AnimateFade</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a24">GetLayeredWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/sprite_8c.html#a25">TrackLayeredZorder</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="sprite.c::ALPHASTART" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ALPHASTART&nbsp;&nbsp;&nbsp;40          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00848">848</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a8" doxytag="sprite.c::_SetLayeredWindowAttributes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _SetLayeredWindowAttributes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORREF&nbsp;</td>
          <td class="mdname" nowrap> <em>crKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>bAlpha</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00230">230</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00104">ConvertRedirectionDCs()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00054">CreateRedirectionBitmap()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00493">ghdcMem</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03898">PROP_LAYER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l13435">NtUserSetLayeredWindowAttributes()</a>.
<p>
<pre class="fragment"><div>00232 {
00233     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet;
00234     BLENDFUNCTION blend;
00235     HBITMAP hbm;
00236 
00237     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED)) {
00238         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING,
00239                 <span class="stringliteral">"SetLayeredWindowAttributes: not a sprite %X"</span>, pwnd);
00240         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00241     }
00242 
00243     <span class="keywordflow">if</span> ((hbm = <a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_LAYER, TRUE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00244         HBITMAP hbmNew;
00245 
00246         <span class="keywordflow">if</span> ((hbmNew = <a class="code" href="../../d8/d4/sprite_8c.html#a3">CreateRedirectionBitmap</a>(pwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00247             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00248         }
00249 
00250         <a class="code" href="../../d8/d4/sprite_8c.html#a4">ConvertRedirectionDCs</a>(pwnd, hbmNew);
00251     }
00252 
00253     blend.BlendOp = AC_SRC_OVER;
00254     blend.BlendFlags = 0;
00255     blend.AlphaFormat = 0;
00256     blend.SourceConstantAlpha = bAlpha;
00257 
00258     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= ULW_NEW_ATTRIBUTES; <span class="comment">// Notify gdi that these are new attributes</span>
00259 
00260     <span class="keywordflow">if</span> (hbm != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00261         HBITMAP hbmOld;
00262         SIZE size;
00263         POINT ptSrc = {0,0};
00264         
00265         hbmOld = GreSelectBitmap(ghdcMem, hbm);
00266     
00267         size.cx = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00268         size.cy = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00269     
00270         bRet =  GreUpdateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), NULL, NULL,
00271             NULL, &amp;size, ghdcMem, &amp;ptSrc, crKey, &amp;blend, dwFlags, NULL);
00272     
00273         GreSelectBitmap(ghdcMem, hbmOld);
00274     } <span class="keywordflow">else</span> {
00275         bRet =  GreUpdateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), NULL, NULL,
00276             NULL, NULL, NULL, NULL, crKey, &amp;blend, dwFlags, NULL);
00277     }
00278 
00279     <span class="keywordflow">return</span> bRet;
00280 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="sprite.c::_UpdateLayeredWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _UpdateLayeredWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcDst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>POINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pptDst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SIZE *&nbsp;</td>
          <td class="mdname" nowrap> <em>psize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>POINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pptSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORREF&nbsp;</td>
          <td class="mdname" nowrap> <em>crKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BLENDFUNCTION *&nbsp;</td>
          <td class="mdname" nowrap> <em>pblend</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00625">625</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03898">PROP_LAYER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00611">SetRectRelative()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l13366">NtUserUpdateLayeredWindow()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00739">UpdateFade()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00467">xxxSetLayeredWindow()</a>.
<p>
<pre class="fragment"><div>00635 {
00636     <span class="keywordtype">int</span> dx, dy, dcx, dcy;
00637     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fMove = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, fSize = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00638 
00639     <span class="comment">/*</span>
00640 <span class="comment">     * Verify that we're called with a real layered window.</span>
00641 <span class="comment">     */</span>
00642     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED) ||
00643             <a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_LAYER, TRUE) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00644         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING,
00645                 <span class="stringliteral">"_UpdateLayeredWindow: can't call on window %X"</span>, pwnd);
00646         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00647     }
00648 
00649     <span class="keywordflow">if</span> (!GreUpdateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), NULL, hdcDst, pptDst,
00650             psize, hdcSrc, pptSrc, crKey, pblend, dwFlags, NULL)) {
00651         RIPMSG1(RIP_WARNING, <span class="stringliteral">"_UpdateLayeredWindow: !UpdateSprite %X"</span>, pwnd);
00652         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00653     }
00654 
00655     <span class="comment">/*</span>
00656 <span class="comment">     * Figure out relative adjustments in position and size.</span>
00657 <span class="comment">     */</span>
00658     <span class="keywordflow">if</span> (pptDst != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00659         dx = pptDst-&gt;x - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00660         dy = pptDst-&gt;y - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00661         <span class="keywordflow">if</span> (dx != 0 || dy != 0) {
00662             fMove = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00663         }
00664     } <span class="keywordflow">else</span> {
00665         dx = 0;
00666         dy = 0;
00667     }
00668     <span class="keywordflow">if</span> (psize != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00669         dcx = psize-&gt;cx - (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left);
00670         dcy = psize-&gt;cy - (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top);
00671         <span class="keywordflow">if</span> (dcx != 0 || dcy != 0) {
00672             fSize = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00673         }
00674     } <span class="keywordflow">else</span> {
00675         dcx = 0;
00676         dcy = 0;
00677     }
00678 
00679     <span class="keywordflow">if</span> (fMove || fSize) {
00680         <span class="comment">/*</span>
00681 <span class="comment">         * Adjust the client rect position and size relative to </span>
00682 <span class="comment">         * the window rect.</span>
00683 <span class="comment">         */</span>
00684         <a class="code" href="../../d8/d4/sprite_8c.html#a15">SetRectRelative</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, dx, dy, dcx, dcy);
00685         <a class="code" href="../../d8/d4/sprite_8c.html#a15">SetRectRelative</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>, dx, dy, dcx, dcy);
00686 
00687         <span class="comment">/*</span>
00688 <span class="comment">         * Since the client rect could be smaller than the window</span>
00689 <span class="comment">         * rect make sure the client rect doesn't underflow!</span>
00690 <span class="comment">         */</span>
00691         <span class="keywordflow">if</span> ((dcx &lt; 0) &amp;&amp; (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left &lt; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left)) {
00692             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00693             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00694         }
00695         <span class="keywordflow">if</span> ((dcy &lt; 0) &amp;&amp; (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top &lt; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top)) {
00696             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00697             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00698         }
00699        <span class="comment">/*</span>
00700 <span class="comment">        * BUGBUG: should jiggle the mouse, do this when SetFMouseMoved </span>
00701 <span class="comment">        * doesn't leave crit.</span>
00702 <span class="comment">        * </span>
00703 <span class="comment">        * SetFMouseMoved();</span>
00704 <span class="comment">        */</span>
00705     }
00706 
00707     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00708 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="sprite.c::AnimateFade" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void AnimateFade           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00984">984</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06650">tagFADE::dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06649">tagFADE::dwStart</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06648">tagFADE::dwTime</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06743">FADE_COMPLETED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06742">FADE_SHOW</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06645">tagFADE::hbm</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06644">tagFADE::hdc</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00918">StopFade()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00739">UpdateFade()</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00882">xxxSystemTimerProc()</a>.
<p>
<pre class="fragment"><div>00985 {
00986     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTimeElapsed;
00987     BLENDFUNCTION blend;
00988     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bAlpha;
00989     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fShow;
00990 
00991     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> != NULL);
00992     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> != NULL);
00993 
00994     dwTimeElapsed = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>() - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o6">dwStart</a>;
00995 
00996     <span class="comment">/*</span>
00997 <span class="comment">     * If exceeding the allowed time, stop the animation now.</span>
00998 <span class="comment">     */</span>
00999     <span class="keywordflow">if</span> (dwTimeElapsed &gt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o5">dwTime</a>) {
01000         <a class="code" href="../../d8/d4/sprite_8c.html#a22">StopFade</a>();
01001         <span class="keywordflow">return</span>;
01002     }
01003 
01004     fShow = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a684">FADE_SHOW</a>);
01005 
01006     <span class="comment">/*</span>
01007 <span class="comment">     * Calculate new alpha value based on time elapsed.</span>
01008 <span class="comment">     */</span>
01009     <span class="keywordflow">if</span> (fShow) {
01010         bAlpha = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((255 * dwTimeElapsed) / <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o5">dwTime</a>);
01011     } <span class="keywordflow">else</span> {
01012         bAlpha = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(255 * (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o5">dwTime</a> - dwTimeElapsed) / <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o5">dwTime</a>);
01013     }
01014 
01015     blend.BlendOp = AC_SRC_OVER;
01016     blend.BlendFlags = 0;
01017     blend.AlphaFormat = 0;
01018     blend.SourceConstantAlpha = bAlpha;
01019     <a class="code" href="../../d8/d4/sprite_8c.html#a18">UpdateFade</a>(NULL, NULL, NULL, NULL, &amp;blend);
01020 
01021     <span class="comment">/*</span>
01022 <span class="comment">     * Check if finished animating the fade.</span>
01023 <span class="comment">     */</span>
01024     <span class="keywordflow">if</span> ((fShow &amp;&amp; bAlpha == 255) || (!fShow &amp;&amp; bAlpha == 0)) {
01025         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a685">FADE_COMPLETED</a>;
01026         <a class="code" href="../../d8/d4/sprite_8c.html#a22">StopFade</a>();
01027     }
01028 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="sprite.c::ConvertRedirectionDCs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ConvertRedirectionDCs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBITMAP&nbsp;</td>
          <td class="mdname" nowrap> <em>hbm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00104">104</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03592">tagDCE::DCX_flags</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03586">tagDCE::hdc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00470">InvalidateDce()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02197">tagDISPLAYINFO::pdceFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03585">tagDCE::pdceNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03594">tagDCE::pMonitor</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03587">tagDCE::pwndOrg</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00186">SET_OR_CLEAR_FLAG</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00230">_SetLayeredWindowAttributes()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00207">RemoveRedirectionBitmap()</a>.
<p>
<pre class="fragment"><div>00105 {
00106     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> pdce;
00107 
00108     GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
00109 
00110     <span class="keywordflow">for</span> (pdce = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o9">pdceFirst</a>; pdce != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pdce = pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o0">pdceNext</a>) {
00111 
00112         <span class="keywordflow">if</span> (!(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_INUSE))
00113             <span class="keywordflow">continue</span>;
00114 
00115         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a>) != pwnd)
00116             <span class="keywordflow">continue</span>;
00117 
00118         <span class="comment">/*</span>
00119 <span class="comment">         * Only normal DCs can be redirected. Redirection on monitor</span>
00120 <span class="comment">         * specific DCs is not supported.</span>
00121 <span class="comment">         */</span>
00122         <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o9">pMonitor</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00123             <span class="keywordflow">continue</span>;
00124 
00125         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a15">SET_OR_CLEAR_FLAG</a>(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a>, DCX_LAYERED, (hbm != NULL));
00126 
00127         UserVerify(GreSelectRedirectionBitmap(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, hbm));
00128 
00129         <a class="code" href="../../d4/d1/userk_8h.html#a1701">InvalidateDce</a>(pdce);
00130     }
00131 
00132     GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
00133 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="sprite.c::CreateFade" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDC CreateFade           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>RECT *&nbsp;</td>
          <td class="mdname" nowrap> <em>prc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwTime</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00761">761</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01838">BEGINATOMICCHECK</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00714">DeleteFadeSprite()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06650">tagFADE::dwFlags</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06648">tagFADE::dwTime</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01842">ENDATOMICCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06745">FADE_WINDOW</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06645">tagFADE::hbm</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06644">tagFADE::hdc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06643">tagFADE::hsprite</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06646">tagFADE::ptDst</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06647">tagFADE::size</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00467">xxxSetLayeredWindow()</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00047">MNFadeSelection()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, and <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00570">xxxTooltipWndProc()</a>.
<p>
<pre class="fragment"><div>00762 {
00763     SIZE size;
00764 
00765     <span class="comment">/*</span>
00766 <span class="comment">     * Bail if there is a fade animation going on already.</span>
00767 <span class="comment">     */</span>
00768     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00769         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateFade: failed, fade not available"</span>);
00770         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00771     }
00772 
00773     <span class="comment">/*</span>
00774 <span class="comment">     * Create a cached compatible DC.</span>
00775 <span class="comment">     */</span>
00776     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00777         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> = GreCreateCompatibleDC(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>);
00778         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00779             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00780         }
00781     }
00782 
00783     <span class="comment">/*</span>
00784 <span class="comment">     * A windowed fade must have window position and size, so </span>
00785 <span class="comment">     * prc passed in is disregarded.</span>
00786 <span class="comment">     */</span>
00787     UserAssert((pwnd == NULL) || (prc == NULL));
00788 
00789     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00790         prc = &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>;
00791     }
00792 
00793     size.cx = prc-&gt;right - prc-&gt;left;
00794     size.cy = prc-&gt;bottom - prc-&gt;top;
00795 
00796     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00797         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a> = GreCreateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, NULL, prc);
00798     } <span class="keywordflow">else</span> {
00799         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a687">FADE_WINDOW</a>;
00800         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00801 
00802         <a class="code" href="../../d4/d1/userk_8h.html#a159">BEGINATOMICCHECK</a>();
00803         <a class="code" href="../../d4/d1/userk_8h.html#a1983">xxxSetLayeredWindow</a>(pwnd, FALSE);
00804         <a class="code" href="../../d4/d1/userk_8h.html#a163">ENDATOMICCHECK</a>();
00805     }
00806 
00807     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00808         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00809 
00810     <span class="comment">/*</span>
00811 <span class="comment">     * Create a compatible bitmap for this size animation.</span>
00812 <span class="comment">     */</span>
00813     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> = GreCreateCompatibleBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, size.cx, size.cy);
00814     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00815         <a class="code" href="../../d8/d4/sprite_8c.html#a17">DeleteFadeSprite</a>();
00816         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00817     }
00818 
00819     GreSelectBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a>);
00820 
00821     <span class="comment">/*</span>
00822 <span class="comment">     * Since this isn't necessarily the first animation and the hdc could</span>
00823 <span class="comment">     * be set to public, make sure the owner is the current process. This</span>
00824 <span class="comment">     * way this process will be able to draw into it.</span>
00825 <span class="comment">     */</span>
00826     GreSetDCOwner(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>, OBJECT_OWNER_CURRENT);
00827 
00828     <span class="comment">/*</span>
00829 <span class="comment">     * Initialize all other fade animation data.</span>
00830 <span class="comment">     */</span>
00831     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o3">ptDst</a>.x = prc-&gt;left;
00832     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o3">ptDst</a>.y = prc-&gt;top;
00833     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o4">size</a>.cx = size.cx;
00834     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o4">size</a>.cy = size.cy;
00835     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o5">dwTime</a> = dwTime;
00836     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> |= <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00837 
00838     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>;
00839 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="sprite.c::CreateRedirectionBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HBITMAP CreateRedirectionBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00054">54</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01838">BEGINATOMICCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01842">ENDATOMICCHECK</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00020">IncrementRedirectedCount()</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00039">InternalSetProp()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03898">PROP_LAYER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01724">PROPF_NOPOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l01302">xxxInternalInvalidate()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00230">_SetLayeredWindowAttributes()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00337">RecreateRedirectionBitmap()</a>.
<p>
<pre class="fragment"><div>00055 {
00056     HBITMAP hbm;
00057 
00058     UserAssert(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right &gt;= pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left);
00059     UserAssert(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom &gt;= pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top);
00060 
00061     <span class="comment">/*</span>
00062 <span class="comment">     * Make sure the (0,0) case doesn't fail, since the window really</span>
00063 <span class="comment">     * can be sized this way.</span>
00064 <span class="comment">     */</span>
00065     <span class="keywordflow">if</span> ((hbm = GreCreateCompatibleBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>,
00066             <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left, 1),
00067             <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top, 1) |
00068             CCB_NOVIDEOMEMORY)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00069         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateRedirectionBitmap: bitmap create failed"</span>);
00070         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00071     }
00072 
00073     <span class="keywordflow">if</span> (!GreSetBitmapOwner(hbm, OBJECT_OWNER_PUBLIC) ||
00074             !GreMarkUndeletableBitmap(hbm) ||
00075             !<a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a0">InternalSetProp</a>(pwnd, PROP_LAYER, hbm, PROPF_INTERNAL |
00076             PROPF_NOPOOL)) {
00077         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateRedirectionBitmap: bitmap set failed"</span>);
00078         GreMarkDeletableBitmap(hbm);
00079         GreDeleteObject(hbm);
00080         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00081     }
00082 
00083     <span class="comment">/*</span>
00084 <span class="comment">     * Force the window to redraw if we could recreate the bitmap since</span>
00085 <span class="comment">     * the redirection bitmap we just allocated doesn't contain anything</span>
00086 <span class="comment">     * yet.</span>
00087 <span class="comment">     */</span>
00088     <a class="code" href="../../d4/d1/userk_8h.html#a159">BEGINATOMICCHECK</a>();
00089     <a class="code" href="../../d4/d1/userk_8h.html#a1681">xxxInternalInvalidate</a>(pwnd, HRGN_FULL, RDW_INVALIDATE | RDW_ERASE |
00090             RDW_FRAME | RDW_ALLCHILDREN);
00091     <a class="code" href="../../d4/d1/userk_8h.html#a163">ENDATOMICCHECK</a>();    
00092 
00093     <a class="code" href="../../d8/d4/sprite_8c.html#a1">IncrementRedirectedCount</a>();
00094 
00095     <span class="keywordflow">return</span> hbm;
00096 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="sprite.c::DecrementRedirectedCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DecrementRedirectedCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00037">37</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d1/timers_8c-source.html#l00431">_KillSystemTimer()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00472">gnRedirectedCount</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00645">gTermIO</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00327">IDSYS_LAYER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02020">tagTERMINAL::spwndDesktopOwner</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00194">DeleteRedirectionBitmap()</a>.
<p>
<pre class="fragment"><div>00038 {
00039     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a181">gnRedirectedCount</a>--;
00040 
00041     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a181">gnRedirectedCount</a> == 0) {
00042         <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a239">gTermIO</a>.<a class="code" href="../../d1/d8/structtagTERMINAL.html#o1">spwndDesktopOwner</a>, IDSYS_LAYER);
00043     }
00044 
00045     UserAssert(gnRedirectedCount &gt;= 0);
00046 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="sprite.c::DeleteFadeSprite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> DeleteFadeSprite           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00714">714</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06650">tagFADE::dwFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06745">FADE_WINDOW</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06643">tagFADE::hsprite</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00417">UnsetLayeredWindow()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00761">CreateFade()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00918">StopFade()</a>.
<p>
<pre class="fragment"><div>00715 {
00716     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00717 
00718     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a687">FADE_WINDOW</a>) {
00719         <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a>)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00720             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED)) {
00721                 <a class="code" href="../../d4/d1/userk_8h.html#a1984">UnsetLayeredWindow</a>(pwnd);
00722             }
00723         } <span class="keywordflow">else</span> {
00724             RIPMSG0(RIP_WARNING, <span class="stringliteral">"DeleteFadeSprite: hwnd no longer valid"</span>);
00725         }
00726     } <span class="keywordflow">else</span> {
00727         GreDeleteSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, NULL, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a>);
00728     }
00729     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00730     <span class="keywordflow">return</span> pwnd;
00731 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="sprite.c::DeleteRedirectionBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DeleteRedirectionBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HBITMAP&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hbm</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00194">194</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d9/d3/sprite_8c-source.html#l00037">DecrementRedirectedCount()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00337">RecreateRedirectionBitmap()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00207">RemoveRedirectionBitmap()</a>.
<p>
<pre class="fragment"><div>00195 {
00196     GreMarkDeletableBitmap(hbm);
00197     GreDeleteObject(hbm);
00198     <a class="code" href="../../d8/d4/sprite_8c.html#a2">DecrementRedirectedCount</a>();
00199 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="sprite.c::GetLayeredWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> GetLayeredWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l01166">1166</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00073">ResetOrg()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00141">UpdateLayeredSprite()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l02096">UserGetRedirectedWindowOrigin()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l00821">xxxCalcValidRects()</a>.
<p>
<pre class="fragment"><div>01167 {
01168     pwnd = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pwnd);
01169 
01170     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED))
01171         <span class="keywordflow">return</span> pwnd;
01172 
01173     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01174 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="sprite.c::IncrementRedirectedCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IncrementRedirectedCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00020">20</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00472">gnRedirectedCount</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00645">gTermIO</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00327">IDSYS_LAYER</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02020">tagTERMINAL::spwndDesktopOwner</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d5/d1/timers_8c-source.html#l00882">xxxSystemTimerProc()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00054">CreateRedirectionBitmap()</a>.
<p>
<pre class="fragment"><div>00021 {
00022     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a181">gnRedirectedCount</a>++;
00023 
00024     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a181">gnRedirectedCount</a> == 1) {
00025         <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a239">gTermIO</a>.<a class="code" href="../../d1/d8/structtagTERMINAL.html#o1">spwndDesktopOwner</a>, IDSYS_LAYER, 100,
00026                 xxxSystemTimerProc, TMRF_SYSTEM | TMRF_PTIWINDOW);
00027     }
00028 
00029     UserAssert(gnRedirectedCount &gt;= 0);
00030 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="sprite.c::RecreateRedirectionBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL RecreateRedirectionBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00337">337</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00054">CreateRedirectionBitmap()</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03592">tagDCE::DCX_flags</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00194">DeleteRedirectionBitmap()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06776">FLayeredOrRedirected()</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00493">ghdcMem</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00494">ghdcMem2</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03586">tagDCE::hdc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02197">tagDISPLAYINFO::pdceFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03585">tagDCE::pdceNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03898">PROP_LAYER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03587">tagDCE::pwndOrg</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00207">RemoveRedirectionBitmap()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00290">UserRecreateRedirectionBitmap()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l01955">zzzChangeStates()</a>.
<p>
<pre class="fragment"><div>00338 {
00339     HBITMAP hbm, hbmNew, hbmMem, hbmMem2;
00340     BITMAP bm, bmNew;
00341     <span class="keywordtype">int</span> cx, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00342     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> pdce;
00343 
00344     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a1991">FLayeredOrRedirected</a>(pwnd));
00345 
00346     <span class="comment">/*</span>
00347 <span class="comment">     * No need to do anything if this layered window doesn't have</span>
00348 <span class="comment">     * a redirection bitmap.</span>
00349 <span class="comment">     */</span>
00350     <span class="keywordflow">if</span> ((hbm = (HBITMAP)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_LAYER, TRUE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00351         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00352 
00353     <span class="comment">/*</span>
00354 <span class="comment">     * Try to create a new redirection bitmap with the new size. If failed,</span>
00355 <span class="comment">     * delete the old one and remove it from the window property list.</span>
00356 <span class="comment">     */</span>
00357     <span class="keywordflow">if</span> ((hbmNew = <a class="code" href="../../d8/d4/sprite_8c.html#a3">CreateRedirectionBitmap</a>(pwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00358         <a class="code" href="../../d8/d4/sprite_8c.html#a7">RemoveRedirectionBitmap</a>(pwnd);
00359         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00360     }
00361 
00362     <span class="comment">/*</span>
00363 <span class="comment">     * Make sure that the display is locked, so that nobody can be drawing</span>
00364 <span class="comment">     * into the redirection DCs while we're switching bitmaps under them.</span>
00365 <span class="comment">     */</span>
00366     UserAssert(GreIsDisplayLocked(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>));
00367 
00368     <span class="comment">/*</span>
00369 <span class="comment">     * Get the size of the old bitmap to know how much to copy.</span>
00370 <span class="comment">     */</span>
00371     GreExtGetObjectW(hbm, <span class="keyword">sizeof</span>(bm), (LPSTR)&amp;bm);
00372     GreExtGetObjectW(hbmNew, <span class="keyword">sizeof</span>(bmNew), (LPSTR)&amp;bmNew);
00373 
00374     <span class="comment">/*</span>
00375 <span class="comment">     * Copy the bitmap from the old bitmap into the new one.</span>
00376 <span class="comment">     */</span>
00377     hbmMem = GreSelectBitmap(ghdcMem, hbm);
00378     hbmMem2 = GreSelectBitmap(ghdcMem2, hbmNew);
00379 
00380     cx = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(bm.bmWidth, bmNew.bmWidth);
00381     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(bm.bmHeight, bmNew.bmHeight);
00382 
00383     GreBitBlt(ghdcMem2, 0, 0, cx, cy, ghdcMem, 0, 0, SRCCOPY | NOMIRRORBITMAP, 0);
00384 
00385     <span class="comment">/*</span>
00386 <span class="comment">     * Find layered DCs that are in use corresponding to this window and</span>
00387 <span class="comment">     * replace the old redirection bitmap by the new one.</span>
00388 <span class="comment">     */</span>
00389     <span class="keywordflow">for</span> (pdce = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o9">pdceFirst</a>; pdce != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pdce = pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o0">pdceNext</a>) {
00390 
00391         <span class="keywordflow">if</span> (!(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_LAYERED) || !(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_INUSE))
00392             <span class="keywordflow">continue</span>;
00393 
00394         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a>) != pwnd)
00395             <span class="keywordflow">continue</span>;
00396 
00397         UserVerify(GreSelectRedirectionBitmap(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, hbmNew));
00398     }
00399 
00400     GreSelectBitmap(ghdcMem, hbmMem);
00401     GreSelectBitmap(ghdcMem2, hbmMem2);
00402 
00403     <span class="comment">/*</span>
00404 <span class="comment">     * Finally, delete the old redirection bitmap.</span>
00405 <span class="comment">     */</span>
00406     <a class="code" href="../../d8/d4/sprite_8c.html#a6">DeleteRedirectionBitmap</a>(hbm);
00407 
00408     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00409 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="sprite.c::RemoveRedirectionBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RemoveRedirectionBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00207">207</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00104">ConvertRedirectionDCs()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00194">DeleteRedirectionBitmap()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06776">FLayeredOrRedirected()</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00098">InternalRemoveProp()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03898">PROP_LAYER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00337">RecreateRedirectionBitmap()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00417">UnsetLayeredWindow()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00310">UserRemoveRedirectionBitmap()</a>.
<p>
<pre class="fragment"><div>00208 {
00209     HBITMAP hbm;
00210 
00211     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a1991">FLayeredOrRedirected</a>(pwnd));
00212 
00213     <span class="comment">/*</span>
00214 <span class="comment">     * Delete the backing bitmap for this layered window.</span>
00215 <span class="comment">     */</span>
00216     <span class="keywordflow">if</span> ((hbm = (HBITMAP)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_LAYER, TRUE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00217         <span class="keywordflow">return</span>;
00218 
00219     <a class="code" href="../../d8/d4/sprite_8c.html#a4">ConvertRedirectionDCs</a>(pwnd, NULL);
00220     UserVerify(<a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a1">InternalRemoveProp</a>(pwnd, PROP_LAYER, TRUE));
00221     <a class="code" href="../../d8/d4/sprite_8c.html#a6">DeleteRedirectionBitmap</a>(hbm);
00222 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="sprite.c::SetRectRelative" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetRectRelative           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>prc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dcx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dcy</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00611">611</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00625">_UpdateLayeredWindow()</a>.
<p>
<pre class="fragment"><div>00612 {
00613     prc-&gt;left += dx;
00614     prc-&gt;top += dy;
00615     prc-&gt;right += (dx + dcx);
00616     prc-&gt;bottom += (dy + dcy);
00617 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="sprite.c::ShowFade" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ShowFade           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00850">850</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00677">ALPHASTART</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06650">tagFADE::dwFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06742">FADE_SHOW</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06744">FADE_SHOWN</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06645">tagFADE::hbm</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06644">tagFADE::hdc</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06646">tagFADE::ptDst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06647">tagFADE::size</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00739">UpdateFade()</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00047">MNFadeSelection()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00879">StartFade()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>.
<p>
<pre class="fragment"><div>00851 {
00852     BLENDFUNCTION blend;
00853     POINT ptSrc;
00854     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fShow;
00855 
00856     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> != NULL);
00857     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> != NULL);
00858 
00859     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a686">FADE_SHOWN</a>)
00860         <span class="keywordflow">return</span>;
00861     
00862     fShow = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a684">FADE_SHOW</a>);
00863     ptSrc.x = ptSrc.y = 0;
00864     blend.BlendOp = AC_SRC_OVER;
00865     blend.BlendFlags = 0;
00866     blend.AlphaFormat = 0;
00867     blend.SourceConstantAlpha = fShow ? <a class="code" href="../../d3/d8/winmgrc_8c.html#a1">ALPHASTART</a> : (255 - <a class="code" href="../../d3/d8/winmgrc_8c.html#a1">ALPHASTART</a>);
00868     <a class="code" href="../../d8/d4/sprite_8c.html#a18">UpdateFade</a>(&amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o3">ptDst</a>, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o4">size</a>, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>, &amp;ptSrc, &amp;blend);
00869 
00870     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a686">FADE_SHOWN</a>;
00871 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="sprite.c::StartFade" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void StartFade           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00879">879</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00677">ALPHASTART</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06649">tagFADE::dwStart</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06648">tagFADE::dwTime</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00645">gTermIO</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06645">tagFADE::hbm</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06644">tagFADE::hdc</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00328">IDSYS_FADE</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00850">ShowFade()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02020">tagTERMINAL::spwndDesktopOwner</a>, and <a class="el" href="../../d5/d1/timers_8c-source.html#l00882">xxxSystemTimerProc()</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00098">xxxMNDismissWithNotify()</a>, and <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00570">xxxTooltipWndProc()</a>.
<p>
<pre class="fragment"><div>00880 {
00881     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwElapsed;
00882 
00883     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> != NULL);
00884     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> != NULL);
00885 
00886     <span class="comment">/*</span>
00887 <span class="comment">     * Set dc and bitmap to public so the desktop thread can use them.</span>
00888 <span class="comment">     */</span>
00889     GreSetDCOwner(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>, OBJECT_OWNER_PUBLIC);
00890     GreSetBitmapOwner(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a>, OBJECT_OWNER_PUBLIC);
00891 
00892     <span class="comment">/*</span>
00893 <span class="comment">     * If it's not already shown, do the initial update that makes copy of</span>
00894 <span class="comment">     * the source. All other updates will only need to change the alpha value.</span>
00895 <span class="comment">     */</span>
00896     <a class="code" href="../../d8/d4/sprite_8c.html#a20">ShowFade</a>();
00897 
00898     <span class="comment">/*</span>
00899 <span class="comment">     * Get the start time for the fade animation.</span>
00900 <span class="comment">     */</span>
00901     dwElapsed = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o5">dwTime</a> * <a class="code" href="../../d3/d8/winmgrc_8c.html#a1">ALPHASTART</a> + 255) / 255;
00902     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o6">dwStart</a> = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>() - dwElapsed;
00903 
00904     <span class="comment">/*</span>
00905 <span class="comment">     * Set the timer in the desktop thread. This will insure that the</span>
00906 <span class="comment">     * animation is smooth and won't get stuck if the current thread hangs.</span>
00907 <span class="comment">     */</span>
00908     <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a239">gTermIO</a>.<a class="code" href="../../d1/d8/structtagTERMINAL.html#o1">spwndDesktopOwner</a>, IDSYS_FADE, 10,
00909             xxxSystemTimerProc, TMRF_SYSTEM | TMRF_PTIWINDOW);
00910 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="sprite.c::StopFade" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void StopFade           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00918">918</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00431">_KillSystemTimer()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00714">DeleteFadeSprite()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06650">tagFADE::dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06743">FADE_COMPLETED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06742">FADE_SHOW</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00645">gTermIO</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06645">tagFADE::hbm</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06644">tagFADE::hdc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00328">IDSYS_FADE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06646">tagFADE::ptDst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06647">tagFADE::size</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02020">tagTERMINAL::spwndDesktopOwner</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00984">AnimateFade()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00290">MNAnimate()</a>, <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00570">xxxTooltipWndProc()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>.
<p>
<pre class="fragment"><div>00919 {
00920     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRop=SRCCOPY;
00921     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00922 
00923     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a> != NULL);
00924     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> != NULL);
00925 
00926     <span class="comment">/*</span>
00927 <span class="comment">     * Stop the fade animation timer.</span>
00928 <span class="comment">     */</span>
00929     <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a239">gTermIO</a>.<a class="code" href="../../d1/d8/structtagTERMINAL.html#o1">spwndDesktopOwner</a>, IDSYS_FADE);
00930 
00931     pwnd = <a class="code" href="../../d8/d4/sprite_8c.html#a17">DeleteFadeSprite</a>();
00932 
00933     <span class="comment">/*</span>
00934 <span class="comment">     * If showing and the animation isn't completed, blt the last frame.</span>
00935 <span class="comment">     */</span>
00936     <span class="keywordflow">if</span> (!(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a685">FADE_COMPLETED</a>) &amp;&amp; (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a684">FADE_SHOW</a>)) {
00937         <span class="keywordtype">int</span> x, y;
00938         HDC hdc;
00939 
00940         <span class="comment">/*</span>
00941 <span class="comment">         * For a windowed fade, make sure we observe the current visrgn.</span>
00942 <span class="comment">         */</span>
00943         <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00944             hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_WINDOW | DCX_CACHE);
00945             x = 0;
00946             y = 0;
00947         } <span class="keywordflow">else</span> {
00948             hdc = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>;
00949             x = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o3">ptDst</a>.x;
00950             y = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o3">ptDst</a>.y;
00951         }
00952         
00953 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00954 <span class="preprocessor"></span>        <span class="comment">/*</span>
00955 <span class="comment">         * If the destination DC is RTL mirrored, then BitBlt call should mirror the</span>
00956 <span class="comment">         * content, since we want the menu to preserve it text (i.e. not to</span>
00957 <span class="comment">         * be flipped). [samera]</span>
00958 <span class="comment">         */</span>
00959         <span class="keywordflow">if</span> (GreGetLayout(hdc) &amp; LAYOUT_RTL) {
00960             dwRop |= NOMIRRORBITMAP;
00961         }
00962 <span class="preprocessor">#endif</span>
00963 <span class="preprocessor"></span>
00964         GreBitBlt(hdc, x, y, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o4">size</a>.cx, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o4">size</a>.cy, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>, 0, 0, dwRop, 0);
00965         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00966     }
00967 
00968     <span class="comment">/*</span>
00969 <span class="comment">     * Clean up the animation data.</span>
00970 <span class="comment">     */</span>
00971     GreSelectBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o1">hdc</a>, GreGetStockObject(PRIV_STOCK_BITMAP));
00972     GreDeleteObject(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a>);
00973 
00974     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00975     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> = 0;
00976 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="sprite.c::TrackLayeredZorder" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void TrackLayeredZorder           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l01184">1184</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l01478">LinkWindow()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00467">xxxSetLayeredWindow()</a>.
<p>
<pre class="fragment"><div>01185 {
01186 <span class="preprocessor">#ifdef CHILD_LAYERING</span>
01187 <span class="preprocessor"></span>
01188     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT = GetNextLayeredWindow(pwnd);
01189 
01190 <span class="preprocessor">#else // CHILD_LAYERING</span>
01191 <span class="preprocessor"></span>
01192     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
01193 
01194     <span class="keywordflow">while</span> (pwndT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01195 
01196         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, WEFLAYERED))
01197             <span class="keywordflow">break</span>;
01198 
01199         pwndT = pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
01200     }
01201 
01202 <span class="preprocessor">#endif // CHILD_LAYERING</span>
01203 <span class="preprocessor"></span>
01204     GreZorderSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pwndT));
01205 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="sprite.c::UnsetLayeredWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UnsetLayeredWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00417">417</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01838">BEGINATOMICCHECK</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01842">ENDATOMICCHECK</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02232">IDC_DEFAULT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02236">IDC_NOMOUSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00207">RemoveRedirectionBitmap()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, and <a class="el" href="../../d9/d2/dc_8c-source.html#l01812">zzzInvalidateDCCache()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00714">DeleteFadeSprite()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00203">xxxSetWindowStyle()</a>.
<p>
<pre class="fragment"><div>00418 {
00419     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd);
00420 
00421     <span class="comment">/*</span>
00422 <span class="comment">     * Remove the layered redirection bitmap.</span>
00423 <span class="comment">     */</span>
00424     <a class="code" href="../../d8/d4/sprite_8c.html#a7">RemoveRedirectionBitmap</a>(pwnd);
00425 
00426     <span class="comment">/*</span>
00427 <span class="comment">     * If the window is still visible, leave the sprite bits on the screen.</span>
00428 <span class="comment">     */</span>
00429     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00430         GreUpdateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, hwnd, NULL, NULL, NULL, NULL,
00431                 NULL, NULL, 0, NULL, ULW_NOREPAINT, NULL);
00432     }
00433 
00434     <span class="comment">/*</span>
00435 <span class="comment">     * Delete the sprite object.</span>
00436 <span class="comment">     */</span>
00437     <span class="keywordflow">if</span> (!GreDeleteSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), NULL)) {
00438         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxSetLayeredWindow failed %X"</span>, pwnd);
00439         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00440     }
00441     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFLAYERED);
00442 
00443     <span class="comment">/*</span>
00444 <span class="comment">     * No need to jiggle the mouse when the sprite is removed. As an</span>
00445 <span class="comment">     * added bonus that means that zzzInvalidateDCCache won't leave</span>
00446 <span class="comment">     * the critical section.</span>
00447 <span class="comment">     *</span>
00448 <span class="comment">     * Make sure the window gets painted if visible.</span>
00449 <span class="comment">     *</span>
00450 <span class="comment">     * BUGBUG: should jiggle the mouse. Remove IDC_NOMOUSE when</span>
00451 <span class="comment">     * SetFMouseMoved and thus InvalidateDCCache don't leave crit.</span>
00452 <span class="comment">     */</span>
00453     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00454         <a class="code" href="../../d4/d1/userk_8h.html#a159">BEGINATOMICCHECK</a>();
00455         <a class="code" href="../../d4/d1/userk_8h.html#a1004">zzzInvalidateDCCache</a>(pwnd, IDC_DEFAULT | IDC_NOMOUSE);
00456         <a class="code" href="../../d4/d1/userk_8h.html#a163">ENDATOMICCHECK</a>();
00457     }
00458     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00459 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="sprite.c::UpdateFade" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void UpdateFade           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">POINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pptDst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SIZE *&nbsp;</td>
          <td class="mdname" nowrap> <em>psize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>POINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pptSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BLENDFUNCTION *&nbsp;</td>
          <td class="mdname" nowrap> <em>pblend</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00739">739</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d9/d3/sprite_8c-source.html#l00625">_UpdateLayeredWindow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06650">tagFADE::dwFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06745">FADE_WINDOW</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06643">tagFADE::hsprite</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00984">AnimateFade()</a>, and <a class="el" href="../../d9/d3/sprite_8c-source.html#l00850">ShowFade()</a>.
<p>
<pre class="fragment"><div>00741 {
00742     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00743 
00744     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o7">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a687">FADE_WINDOW</a>) {
00745         <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a>)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00746             <a class="code" href="../../d4/d1/userk_8h.html#a1987">_UpdateLayeredWindow</a>(pwnd, NULL, pptDst, psize, hdcSrc, 
00747                      pptSrc, 0, pblend, ULW_ALPHA);
00748         }
00749     } <span class="keywordflow">else</span> {
00750         GreUpdateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, NULL, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o0">hsprite</a>, NULL, 
00751                 pptDst, psize, hdcSrc, pptSrc, 0, pblend, ULW_ALPHA, NULL);
00752     }
00753 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="sprite.c::UpdateLayeredSprite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UpdateLayeredSprite           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d2/structtagDCE.html">PDCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pdce</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00141">141</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01838">BEGINATOMICCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01842">ENDATOMICCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06776">FLayeredOrRedirected()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l01166">GetLayeredWindow()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00493">ghdcMem</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03586">tagDCE::hdc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03898">PROP_LAYER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03587">tagDCE::pwndOrg</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06466">WEF_ASYNC</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>, and <a class="el" href="../../d6/d6/kernel_2winable_8c-source.html#l00274">xxxWindowEvent()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01337">ReleaseCacheDC()</a>, and <a class="el" href="../../d5/d1/timers_8c-source.html#l00882">xxxSystemTimerProc()</a>.
<p>
<pre class="fragment"><div>00142 {
00143     RECT rcBounds;
00144     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00145     SIZE size;
00146     POINT pt;
00147     HBITMAP hbm, hbmOld;
00148 
00149     <span class="comment">/*</span>
00150 <span class="comment">     * Check to see if any drawing has been done into this DC</span>
00151 <span class="comment">     * that should be transferred to the sprite.</span>
00152 <span class="comment">     */</span>
00153     <span class="keywordflow">if</span> (!GreGetBounds(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, &amp;rcBounds, 0))
00154         <span class="keywordflow">return</span>;
00155 
00156     pwnd = <a class="code" href="../../d4/d1/userk_8h.html#a1990">GetLayeredWindow</a>(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a>);
00157 
00158     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a1991">FLayeredOrRedirected</a>(pwnd));
00159 
00160     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED)) {
00161         hbm = (HBITMAP)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_LAYER, TRUE);
00162     
00163         UserAssert(hbm != NULL);
00164     
00165         hbmOld = GreSelectBitmap(ghdcMem, hbm);
00166     
00167         size.cx = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00168         size.cy = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00169     
00170         pt.x = pt.y = 0;
00171         GreUpdateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), NULL, NULL, NULL,
00172                 &amp;size, ghdcMem, &amp;pt, 0, NULL, ULW_DEFAULT_ATTRIBUTES, &amp;rcBounds);
00173     
00174         GreSelectBitmap(ghdcMem, hbmOld);
00175     }
00176 
00177 <span class="preprocessor">#ifdef REDIRECTION</span>
00178 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00179         <a class="code" href="../../d4/d1/userk_8h.html#a159">BEGINATOMICCHECK</a>();
00180         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_SYSTEM_REDIRECTEDPAINT, pwnd,
00181                 MAKELONG(rcBounds.left, rcBounds.top),
00182                 MAKELONG(rcBounds.right, rcBounds.bottom),
00183                 WEF_ASYNC);
00184         <a class="code" href="../../d4/d1/userk_8h.html#a163">ENDATOMICCHECK</a>();
00185     }
00186 <span class="preprocessor">#endif // REDIRECTION</span>
00187 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="sprite.c::UserRecreateRedirectionBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UserRecreateRedirectionBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00290">290</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00337">RecreateRedirectionBitmap()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>.
<p>
<pre class="fragment"><div>00291 {
00292     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00293 
00294     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00295         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UserRecreateRedirectionBitmap: invalid hwnd"</span>);
00296         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00297     }
00298 
00299     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1989">RecreateRedirectionBitmap</a>(pwnd);
00300 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="sprite.c::UserRemoveRedirectionBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserRemoveRedirectionBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00310">310</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00207">RemoveRedirectionBitmap()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>.
<p>
<pre class="fragment"><div>00311 {
00312     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00313 
00314     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00315         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UserRemoveRedirectionBitmap: invalid hwnd"</span>);
00316         <span class="keywordflow">return</span>;
00317     }
00318 
00319     <a class="code" href="../../d8/d4/sprite_8c.html#a7">RemoveRedirectionBitmap</a>(pwnd);
00320 
00321     <span class="comment">/*</span>
00322 <span class="comment">     * Clear the layered window flag.  This is because GDI is unable to</span>
00323 <span class="comment">     * transfer the sprite to the new PDEV, and so if we keep this flag</span>
00324 <span class="comment">     * we will have a layered window without a corresponding sprite which</span>
00325 <span class="comment">     * can lead to all sort of nasty problems (such as redirection bitmap</span>
00326 <span class="comment">     * not getting recreated in subsequent mode changes).</span>
00327 <span class="comment">     */</span>
00328     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFLAYERED);
00329 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="sprite.c::UserVisrgnFromHwnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UserVisrgnFromHwnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HRGN *&nbsp;</td>
          <td class="mdname" nowrap> <em>phrgn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00570">570</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00523">CalcVisRgn()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02417">WFCLIPSIBLINGS</a>.
<p>
<pre class="fragment"><div>00571 {
00572     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00573     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00574     RECT rcWindow;
00575     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet;
00576 
00577     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00578 
00579     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00580         RIPMSG0(RIP_WARNING, <span class="stringliteral">"VisrgnFromHwnd: invalid hwnd"</span>);
00581         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00582     }
00583 
00584     <span class="comment">/*</span>
00585 <span class="comment">     * So that we don't have to recompute the layered window's visrgn</span>
00586 <span class="comment">     * every time the layered window is moved, we compute the visrgn once </span>
00587 <span class="comment">     * as if the layered window covered the entire screen.  GDI will </span>
00588 <span class="comment">     * automatically intersect with this region whenever the sprite moves.</span>
00589 <span class="comment">     */</span>
00590     rcWindow = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>;
00591     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>;
00592 
00593     <span class="comment">/*</span>
00594 <span class="comment">     * Since we use DCX_WINDOW, only rcWindow needs to be faked and saved.</span>
00595 <span class="comment">     */</span>
00596     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = DCX_WINDOW;
00597     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCLIPSIBLINGS))
00598         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= DCX_CLIPSIBLINGS;
00599 
00600     fRet = <a class="code" href="../../d3/d6/visrgn_8c.html#a17">CalcVisRgn</a>(phrgn, pwnd, pwnd, dwFlags);
00601 
00602     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a> = rcWindow;
00603 
00604     <span class="keywordflow">return</span> fRet;
00605 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="sprite.c::xxxSetLayeredWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE xxxSetLayeredWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRepaintBehind</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/sprite_8c-source.html#l00467">467</a> of file <a class="el" href="../../d9/d3/sprite_8c-source.html">sprite.c</a>.
<p>
References <a class="el" href="../../d9/d3/sprite_8c-source.html#l00625">_UpdateLayeredWindow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01838">BEGINATOMICCHECK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01842">ENDATOMICCHECK</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05844">FTopLevel</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02232">IDC_DEFAULT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02236">IDC_NOMOUSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l01184">TrackLayeredZorder()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l00299">xxxRedrawWindow()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00025">xxxUpdateWindows()</a>, and <a class="el" href="../../d9/d2/dc_8c-source.html#l01812">zzzInvalidateDCCache()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00761">CreateFade()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>, and <a class="el" href="../../d7/d6/classchg_8c-source.html#l00203">xxxSetWindowStyle()</a>.
<p>
<pre class="fragment"><div>00468 {
00469     HANDLE hsprite;
00470     SIZE size;
00471 
00472     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00473 
00474 <span class="preprocessor">#ifndef CHILD_LAYERING</span>
00475 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a596">FTopLevel</a>(pwnd)) {
00476         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxSetLayeredWindow: not top-level %X"</span>, pwnd);
00477         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00478     }
00479 <span class="preprocessor">#endif // CHILD_LAYERING</span>
00480 <span class="preprocessor"></span>
00481 <span class="preprocessor">#ifdef REDIRECTION</span>
00482 <span class="preprocessor"></span>    <span class="comment">/*</span>
00483 <span class="comment">     * For now disallow making a layered window redirected and vice versa.</span>
00484 <span class="comment">     * This is because we need to come up with a clear way to expose</span>
00485 <span class="comment">     * layered attributes for redirected windows and also because we don't</span>
00486 <span class="comment">     * know if the redirected bitmap was created for layered redirection</span>
00487 <span class="comment">     * or redirection in itself. We would need to store a struct with</span>
00488 <span class="comment">     * flags and the bitmap in the window property to keep track of that.</span>
00489 <span class="comment">     */</span>
00490     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFREDIRECTED))
00491         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00492 <span class="preprocessor">#endif // REDIRECTION</span>
00493 <span class="preprocessor"></span>
00494 <span class="preprocessor">#if DBG</span>
00495 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED)) {
00496         RIPMSG1(RIP_ERROR, <span class="stringliteral">"xxxSetLayeredWindow: already layered %X"</span>, pwnd);
00497     }
00498 <span class="preprocessor">#endif</span>
00499 <span class="preprocessor"></span>    
00500     size.cx = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00501     size.cy = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00502 
00503     hsprite = GreCreateSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>);
00504     <span class="keywordflow">if</span> (hsprite == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00505         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxSetLayeredWindow failed %X"</span>, pwnd);
00506         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00507     }
00508 
00509     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFLAYERED);
00510     <a class="code" href="../../d4/d1/userk_8h.html#a1985">TrackLayeredZorder</a>(pwnd);
00511 
00512     <span class="comment">/*</span>
00513 <span class="comment">     * Invalidate the DC cache because changing the sprite status</span>
00514 <span class="comment">     * may change the visrgn for some windows.</span>
00515 <span class="comment">     *</span>
00516 <span class="comment">     * BUGBUG: should jiggle the mouse. Remove IDC_NOMOUSE when</span>
00517 <span class="comment">     * SetFMouseMoved and thus InvalidateDCCache don't leave crit.</span>
00518 <span class="comment">     */</span>
00519     <a class="code" href="../../d4/d1/userk_8h.html#a159">BEGINATOMICCHECK</a>();
00520     <a class="code" href="../../d4/d1/userk_8h.html#a1004">zzzInvalidateDCCache</a>(pwnd, IDC_DEFAULT | IDC_NOMOUSE);
00521     <a class="code" href="../../d4/d1/userk_8h.html#a163">ENDATOMICCHECK</a>();
00522 
00523     <span class="comment">/*</span>
00524 <span class="comment">     * For the dynamic promotion to a sprite, put the proper bits into</span>
00525 <span class="comment">     * the sprite itself by doing ULW with the current screen content</span>
00526 <span class="comment">     * and into the background by invalidating windows behind.  There</span>
00527 <span class="comment">     * might be some dirty bits if the window is partially obscured, but</span>
00528 <span class="comment">     * they will be refreshed as soon as the app calls ULW on its own.</span>
00529 <span class="comment">     */</span>
00530     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00531         <span class="keywordflow">if</span> (fRepaintBehind) {
00532             POINT pt;
00533     
00534             pt.x = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00535             pt.y = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00536     
00537             <a class="code" href="../../d4/d1/userk_8h.html#a1987">_UpdateLayeredWindow</a>(pwnd, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, &amp;pt, &amp;size,
00538                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, &amp;pt, 0, NULL, ULW_OPAQUE);
00539         }
00540     } <span class="keywordflow">else</span> {
00541         <span class="comment">/*</span>
00542 <span class="comment">         * No need to repaint behind if the window is still invisible.</span>
00543 <span class="comment">         */</span>
00544         fRepaintBehind = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00545     }
00546 
00547     <span class="comment">/*</span>
00548 <span class="comment">     * This must be done after the DC cache is invalidated, because</span>
00549 <span class="comment">     * the xxxUpdateWindows call will redraw some stuff.</span>
00550 <span class="comment">     */</span>
00551     <span class="keywordflow">if</span> (fRepaintBehind) {
00552         HRGN hrgn = GreCreateRectRgnIndirect(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>);
00553         <a class="code" href="../../d4/d1/userk_8h.html#a1679">xxxRedrawWindow</a>(NULL, NULL, hrgn, RDW_INVALIDATE | RDW_FRAME |
00554                 RDW_ERASE | RDW_ALLCHILDREN);
00555         <a class="code" href="../../d4/d1/userk_8h.html#a1630">xxxUpdateWindows</a>(pwnd, hrgn);
00556         GreDeleteObject(hrgn);
00557     }
00558     <span class="keywordflow">return</span> hsprite;
00559 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:39 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
