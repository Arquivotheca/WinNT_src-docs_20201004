<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kdtrap.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdtrap.c</h1><a href="../../d7/d8/alpha_2kdtrap_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment">Copyright (c) 1992-1993  Digital Equipment Corporation</span>
00005 <span class="comment"></span>
00006 <span class="comment">Module Name:</span>
00007 <span class="comment"></span>
00008 <span class="comment">    kdtrap.c</span>
00009 <span class="comment"></span>
00010 <span class="comment">Abstract:</span>
00011 <span class="comment"></span>
00012 <span class="comment">    This module contains code to implement the target side of the portable</span>
00013 <span class="comment">    kernel debugger.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    David N. Cutler 27-July-1990</span>
00018 <span class="comment">    Joe Notarangelo 24-June-1992  (ALPHA version)</span>
00019 <span class="comment"></span>
00020 <span class="comment">Revision History:</span>
00021 <span class="comment"></span>
00022 <span class="comment">--*/</span>
00023 
00024 <span class="preprocessor">#include "<a class="code" href="../../d1/d7/4_2kdp_8h.html">kdp.h</a>"</span>
00025 
00026 
00027 BOOLEAN
<a name="l00028"></a><a class="code" href="../../d1/d7/4_2kdp_8h.html#a118">00028</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a118">KdpTrap</a> (
00029     IN PKTRAP_FRAME TrapFrame,
00030     IN PKEXCEPTION_FRAME ExceptionFrame,
00031     IN PEXCEPTION_RECORD ExceptionRecord,
00032     IN PCONTEXT ContextRecord,
00033     IN KPROCESSOR_MODE PreviousMode,
00034     IN BOOLEAN SecondChance
00035     )
00036 
00037 <span class="comment">/*++</span>
00038 <span class="comment"></span>
00039 <span class="comment">Routine Description:</span>
00040 <span class="comment"></span>
00041 <span class="comment">    This routine is called whenever a exception is dispatched and the kernel</span>
00042 <span class="comment">    debugger is active.</span>
00043 <span class="comment"></span>
00044 <span class="comment">Arguments:</span>
00045 <span class="comment"></span>
00046 <span class="comment">    TrapFrame - Supplies a pointer to a trap frame that describes the</span>
00047 <span class="comment">        trap.</span>
00048 <span class="comment"></span>
00049 <span class="comment">    ExceptionFrame - Supplies a pointer to a exception frame that describes</span>
00050 <span class="comment">        the trap.</span>
00051 <span class="comment"></span>
00052 <span class="comment">    ExceptionRecord - Supplies a pointer to an exception record that</span>
00053 <span class="comment">        describes the exception.</span>
00054 <span class="comment"></span>
00055 <span class="comment">    ContextRecord - Supplies the context at the time of the exception.</span>
00056 <span class="comment"></span>
00057 <span class="comment">    PreviousMode - Supplies the previous processor mode.</span>
00058 <span class="comment"></span>
00059 <span class="comment">    SecondChance - Supplies a boolean value that determines whether this is</span>
00060 <span class="comment">        the second chance (TRUE) that the exception has been raised.</span>
00061 <span class="comment"></span>
00062 <span class="comment">Return Value:</span>
00063 <span class="comment"></span>
00064 <span class="comment">    A value of TRUE is returned if the exception is handled. Otherwise a</span>
00065 <span class="comment">    value of FALSE is returned.</span>
00066 <span class="comment"></span>
00067 <span class="comment">--*/</span>
00068 
00069 {
00070 
00071     BOOLEAN Completion;
00072     BOOLEAN Enable;
00073     BOOLEAN UnloadSymbols = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00074     STRING Input;
00075     ULONGLONG OldFir;
00076     STRING Output;
00077     PKPRCB Prcb;
00078 
00079     <span class="comment">//</span>
00080     <span class="comment">// Enter debugger and synchronize processor execution.</span>
00081     <span class="comment">//</span>
00082 
00083     <span class="comment">//</span>
00084     <span class="comment">// If this is a breakpoint instruction, then check to determine if is</span>
00085     <span class="comment">// an internal command.</span>
00086     <span class="comment">//</span>
00087 
00088     <span class="keywordflow">if</span> ((ExceptionRecord-&gt;ExceptionCode == STATUS_BREAKPOINT) &amp;&amp;
00089         (ExceptionRecord-&gt;ExceptionInformation[0] &gt;= DEBUG_PRINT_BREAKPOINT)){
00090 
00091         <span class="comment">//</span>
00092         <span class="comment">// Switch on the breakpoint code.</span>
00093         <span class="comment">//</span>
00094 
00095         <span class="keywordflow">switch</span> (ExceptionRecord-&gt;ExceptionInformation[0]) {
00096 
00097             <span class="comment">//</span>
00098             <span class="comment">// Print a debug string.</span>
00099             <span class="comment">//</span>
00100             <span class="comment">// Arguments:</span>
00101             <span class="comment">//</span>
00102             <span class="comment">//   a0 - Supplies a pointer to an output string buffer.</span>
00103             <span class="comment">//   a1 - Supplies the length of the output string buffer.</span>
00104             <span class="comment">//</span>
00105 
00106         <span class="keywordflow">case</span> DEBUG_PRINT_BREAKPOINT:
00107             ContextRecord-&gt;Fir += 4;
00108             Output.Buffer = (PCHAR)ContextRecord-&gt;IntA0;
00109             Output.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ContextRecord-&gt;IntA1;
00110 
00111             <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a7">KdLogDbgPrint</a>(&amp;Output);
00112 
00113             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a12">KdDebuggerNotPresent</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00114 
00115                 Enable = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a17">KdEnterDebugger</a>(TrapFrame, ExceptionFrame);
00116                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a102">KdpPrintString</a>(&amp;Output)) {
00117                     ContextRecord-&gt;IntV0 = (ULONG)STATUS_BREAKPOINT;
00118                 } <span class="keywordflow">else</span> {
00119                     ContextRecord-&gt;IntV0 = (ULONG)STATUS_SUCCESS;
00120                 }
00121                 <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a18">KdExitDebugger</a>(Enable);
00122 
00123             } <span class="keywordflow">else</span> {
00124                 ContextRecord-&gt;IntV0 = (ULONG)STATUS_DEVICE_NOT_CONNECTED;
00125             }
00126 
00127             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00128 
00129 
00130             <span class="comment">//</span>
00131             <span class="comment">// Stop in the debugger</span>
00132             <span class="comment">//</span>
00133             <span class="comment">// As this is not a normal breakpoint we must increment the</span>
00134             <span class="comment">// context past the breakpoint instruction</span>
00135             <span class="comment">//</span>
00136 
00137         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a454">BREAKIN_BREAKPOINT</a>:
00138             ContextRecord-&gt;Fir += 4;
00139             <span class="keywordflow">break</span>;
00140 
00141             <span class="comment">//</span>
00142             <span class="comment">// Print a debug prompt string, then input a string.</span>
00143             <span class="comment">//</span>
00144             <span class="comment">//   a0 - Supplies a pointer to an output string buffer.</span>
00145             <span class="comment">//   a1 - Supplies the length of the output string buffer..</span>
00146             <span class="comment">//   a2 - supplies a pointer to an input string buffer.</span>
00147             <span class="comment">//   a3 - Supplies the length of the input string bufffer.</span>
00148             <span class="comment">//</span>
00149 
00150         <span class="keywordflow">case</span> DEBUG_PROMPT_BREAKPOINT:
00151             ContextRecord-&gt;Fir += 4;
00152             Output.Buffer = (PCHAR)ContextRecord-&gt;IntA0;
00153             Output.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ContextRecord-&gt;IntA1;
00154             Input.Buffer = (PCHAR)ContextRecord-&gt;IntA2;
00155             Input.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ContextRecord-&gt;IntA3;
00156 
00157             <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a7">KdLogDbgPrint</a>(&amp;Output);
00158 
00159             Enable = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a17">KdEnterDebugger</a>(TrapFrame, ExceptionFrame);
00160 
00161             <a class="code" href="../../d1/d7/4_2kdp_8h.html#a103">KdpPromptString</a>(&amp;Output, &amp;Input);
00162 
00163             ContextRecord-&gt;IntV0 = Input.Length;
00164 
00165             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a18">KdExitDebugger</a>(Enable);
00166             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00167 
00168             <span class="comment">//</span>
00169             <span class="comment">// Load the symbolic information for an image.</span>
00170             <span class="comment">//</span>
00171             <span class="comment">// Arguments:</span>
00172             <span class="comment">//</span>
00173             <span class="comment">//    a0 - Supplies a pointer to an output string descriptor.</span>
00174             <span class="comment">//    a1 - Supplies a the base address of the image.</span>
00175             <span class="comment">//    a2 - Supplies the current process id.</span>
00176             <span class="comment">//</span>
00177 
00178         <span class="keywordflow">case</span> DEBUG_UNLOAD_SYMBOLS_BREAKPOINT:
00179             UnloadSymbols = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00180 
00181             <span class="comment">//</span>
00182             <span class="comment">// Fall through</span>
00183             <span class="comment">//</span>
00184 
00185         <span class="keywordflow">case</span> DEBUG_LOAD_SYMBOLS_BREAKPOINT:
00186             Enable = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a17">KdEnterDebugger</a>(TrapFrame, ExceptionFrame);
00187             Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00188             OldFir = ContextRecord-&gt;Fir;
00189             RtlCopyMemory(&amp;Prcb-&gt;ProcessorState.ContextFrame,
00190                           ContextRecord,
00191                           <span class="keyword">sizeof</span>(CONTEXT));
00192 
00193             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a12">KdDebuggerNotPresent</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00194                 <a class="code" href="../../d1/d7/4_2kdp_8h.html#a121">KdpReportLoadSymbolsStateChange</a>((PSTRING)ContextRecord-&gt;IntA0,
00195                                                 (<a class="code" href="../../d6/d5/struct__KD__SYMBOLS__INFO.html">PKD_SYMBOLS_INFO</a>) ContextRecord-&gt;IntA1,
00196                                                 UnloadSymbols,
00197                                                 &amp;Prcb-&gt;ProcessorState.ContextFrame);
00198 
00199             }
00200 
00201             RtlCopyMemory(ContextRecord,
00202                           &amp;Prcb-&gt;ProcessorState.ContextFrame,
00203                           <span class="keyword">sizeof</span>(CONTEXT));
00204 
00205             <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a18">KdExitDebugger</a>(Enable);
00206 
00207             <span class="comment">//</span>
00208             <span class="comment">// If the kernel debugger did not update the FIR, then increment</span>
00209             <span class="comment">// past the breakpoint instruction.</span>
00210             <span class="comment">//</span>
00211 
00212             <span class="keywordflow">if</span> (ContextRecord-&gt;Fir == OldFir) {
00213                 ContextRecord-&gt;Fir += 4;
00214             }
00215 
00216             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00217 
00218             <span class="comment">//</span>
00219             <span class="comment">// Unknown internal command.</span>
00220             <span class="comment">//</span>
00221 
00222         <span class="keywordflow">default</span>:
00223             <span class="keywordflow">break</span>;
00224         }
00225     }
00226 
00227     <span class="comment">//</span>
00228     <span class="comment">// Report state change to kernel debugger on host machine.</span>
00229     <span class="comment">//</span>
00230 
00231     Enable = <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a17">KdEnterDebugger</a>(TrapFrame, ExceptionFrame);
00232     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00233 
00234     RtlCopyMemory(&amp;Prcb-&gt;ProcessorState.ContextFrame,
00235                     ContextRecord,
00236                     sizeof (CONTEXT));
00237 
00238     Completion = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a120">KdpReportExceptionStateChange</a>(ExceptionRecord,
00239                                                &amp;Prcb-&gt;ProcessorState.ContextFrame,
00240                                                SecondChance);
00241 
00242     RtlCopyMemory(ContextRecord,
00243                   &amp;Prcb-&gt;ProcessorState.ContextFrame,
00244                   <span class="keyword">sizeof</span>(CONTEXT));
00245 
00246     <a class="code" href="../../d9/d3/4_2kdapi_8c.html#a18">KdExitDebugger</a>(Enable);
00247 
00248     <a class="code" href="../../d8/d5/kddata_8c.html#a90">KdpControlCPressed</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00249 
00250     <span class="comment">//</span>
00251     <span class="comment">// Always return TRUE if this is the first chance to handle the</span>
00252     <span class="comment">// exception.  Otherwise, return the completion status of the</span>
00253     <span class="comment">// state change reporting.</span>
00254     <span class="comment">//</span>
00255 
00256     <span class="keywordflow">if</span>( SecondChance ){
00257         <span class="keywordflow">return</span> Completion;
00258     } <span class="keywordflow">else</span> {
00259         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00260     }
00261 }
00262 
00263 BOOLEAN
<a name="l00264"></a><a class="code" href="../../d7/d8/alpha_2kdtrap_8c.html#a1">00264</a> <a class="code" href="../../d3/d9/4_2ia64_2kdtrap_8c.html#a1">KdIsThisAKdTrap</a> (
00265     IN PEXCEPTION_RECORD ExceptionRecord,
00266     IN PCONTEXT ContextRecord,
00267     IN KPROCESSOR_MODE PreviousMode
00268     )
00269 
00270 <span class="comment">/*++</span>
00271 <span class="comment"></span>
00272 <span class="comment">Routine Description:</span>
00273 <span class="comment"></span>
00274 <span class="comment">    This routine is called whenever a user-mode exception occurs and</span>
00275 <span class="comment">    it might be a kernel debugger exception (Like DbgPrint/DbgPrompt ).</span>
00276 <span class="comment"></span>
00277 <span class="comment">Arguments:</span>
00278 <span class="comment"></span>
00279 <span class="comment">    ExceptionRecord - Supplies a pointer to an exception record that</span>
00280 <span class="comment">        describes the exception.</span>
00281 <span class="comment"></span>
00282 <span class="comment">    ContextRecord - Supplies the context at the time of the exception.</span>
00283 <span class="comment"></span>
00284 <span class="comment">    PreviousMode - Supplies the previous processor mode.</span>
00285 <span class="comment"></span>
00286 <span class="comment">Return Value:</span>
00287 <span class="comment"></span>
00288 <span class="comment">    A value of TRUE is returned if this is for the kernel debugger.</span>
00289 <span class="comment">    Otherwise, a value of FALSE is returned.</span>
00290 <span class="comment"></span>
00291 <span class="comment">--*/</span>
00292 
00293 {
00294 
00295     <span class="comment">//</span>
00296     <span class="comment">// Isolate the breakpoint code from the breakpoint instruction which</span>
00297     <span class="comment">// is stored by the exception dispatch code in the information field</span>
00298     <span class="comment">// of the exception record.</span>
00299     <span class="comment">//</span>
00300 
00301     <span class="comment">//</span>
00302     <span class="comment">// Switch on the breakpoint code.</span>
00303     <span class="comment">//</span>
00304 
00305     <span class="keywordflow">switch</span> (ExceptionRecord-&gt;ExceptionInformation[0]) {
00306 
00307         <span class="comment">//</span>
00308         <span class="comment">// Kernel breakpoint code.</span>
00309         <span class="comment">//</span>
00310 
00311     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a453">KERNEL_BREAKPOINT</a>:
00312     <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a454">BREAKIN_BREAKPOINT</a>:
00313 <span class="preprocessor">#if DEVL</span>
00314 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00315 <span class="preprocessor">#else</span>
00316 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00317             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00318 
00319         } <span class="keywordflow">else</span> {
00320             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00321         }
00322 <span class="preprocessor">#endif</span>
00323 <span class="preprocessor"></span>
00324         <span class="comment">//</span>
00325         <span class="comment">// Debug print code.</span>
00326         <span class="comment">//</span>
00327 
00328     <span class="keywordflow">case</span> DEBUG_PRINT_BREAKPOINT:
00329         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00330 
00331         <span class="comment">//</span>
00332         <span class="comment">// Debug prompt code.</span>
00333         <span class="comment">//</span>
00334     <span class="keywordflow">case</span> DEBUG_PROMPT_BREAKPOINT:
00335         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00336 
00337         <span class="comment">//</span>
00338         <span class="comment">// Debug stop code.</span>
00339         <span class="comment">//</span>
00340 
00341     <span class="keywordflow">case</span> DEBUG_STOP_BREAKPOINT:
00342 <span class="preprocessor">#if DEVL</span>
00343 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00344 <span class="preprocessor">#else</span>
00345 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00346             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00347 
00348         } <span class="keywordflow">else</span> {
00349             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00350         }
00351 <span class="preprocessor">#endif</span>
00352 <span class="preprocessor"></span>
00353         <span class="comment">//</span>
00354         <span class="comment">// Debug load symbols code.</span>
00355         <span class="comment">//</span>
00356 
00357     <span class="keywordflow">case</span> DEBUG_LOAD_SYMBOLS_BREAKPOINT:
00358         <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00359             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00360 
00361         } <span class="keywordflow">else</span> {
00362             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00363         }
00364 
00365         <span class="comment">//</span>
00366         <span class="comment">// Debug unload symbols code.</span>
00367         <span class="comment">//</span>
00368 
00369     <span class="keywordflow">case</span> DEBUG_UNLOAD_SYMBOLS_BREAKPOINT:
00370         <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00371             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00372 
00373         } <span class="keywordflow">else</span> {
00374             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00375         }
00376         <span class="comment">//</span>
00377         <span class="comment">// All other codes.</span>
00378         <span class="comment">//</span>
00379 
00380     <span class="keywordflow">default</span>:
00381         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00382     }
00383 }
00384 
00385 BOOLEAN
<a name="l00386"></a><a class="code" href="../../d1/d7/4_2kdp_8h.html#a117">00386</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a117">KdpStub</a> (
00387     IN PKTRAP_FRAME TrapFrame,
00388     IN PKEXCEPTION_FRAME ExceptionFrame,
00389     IN PEXCEPTION_RECORD ExceptionRecord,
00390     IN PCONTEXT ContextRecord,
00391     IN KPROCESSOR_MODE PreviousMode,
00392     IN BOOLEAN SecondChance
00393     )
00394 
00395 <span class="comment">/*++</span>
00396 <span class="comment"></span>
00397 <span class="comment">Routine Description:</span>
00398 <span class="comment"></span>
00399 <span class="comment">    This routine provides a kernel debugger stub routine that catchs debug</span>
00400 <span class="comment">    prints in checked systems when the kernel debugger is not active.</span>
00401 <span class="comment"></span>
00402 <span class="comment">Arguments:</span>
00403 <span class="comment"></span>
00404 <span class="comment">    TrapFrame - Supplies a pointer to a trap frame that describes the</span>
00405 <span class="comment">        trap.</span>
00406 <span class="comment"></span>
00407 <span class="comment">    ExceptionFrame - Supplies a pointer to a exception frame that describes</span>
00408 <span class="comment">        the trap.</span>
00409 <span class="comment"></span>
00410 <span class="comment">    ExceptionRecord - Supplies a pointer to an exception record that</span>
00411 <span class="comment">        describes the exception.</span>
00412 <span class="comment"></span>
00413 <span class="comment">    ContextRecord - Supplies the context at the time of the exception.</span>
00414 <span class="comment"></span>
00415 <span class="comment">    PreviousMode - Supplies the previous processor mode.</span>
00416 <span class="comment"></span>
00417 <span class="comment">    SecondChance - Supplies a boolean value that determines whether this is</span>
00418 <span class="comment">        the second chance (TRUE) that the exception has been raised.</span>
00419 <span class="comment"></span>
00420 <span class="comment">Return Value:</span>
00421 <span class="comment"></span>
00422 <span class="comment">    A value of TRUE is returned if the exception is handled. Otherwise a</span>
00423 <span class="comment">    value of FALSE is returned.</span>
00424 <span class="comment"></span>
00425 <span class="comment">--*/</span>
00426 
00427 {
00428 
00429     ULONG_PTR BreakpointCode;
00430 
00431     <span class="comment">//</span>
00432     <span class="comment">// Isolate the breakpoint code from the breakpoint instruction which</span>
00433     <span class="comment">// is stored by the exception dispatch code in the information field</span>
00434     <span class="comment">// of the exception record.</span>
00435     <span class="comment">//</span>
00436 
00437     BreakpointCode = ExceptionRecord-&gt;ExceptionInformation[0];
00438 
00439     <span class="comment">//</span>
00440     <span class="comment">// If the breakpoint is a debug print, debug load symbols, or debug</span>
00441     <span class="comment">// unload symbols, then return TRUE. Otherwise, return FALSE;</span>
00442     <span class="comment">//</span>
00443 
00444     <span class="keywordflow">if</span> ((BreakpointCode == DEBUG_PRINT_BREAKPOINT) ||
00445         (BreakpointCode == DEBUG_LOAD_SYMBOLS_BREAKPOINT) ||
00446         (BreakpointCode == DEBUG_UNLOAD_SYMBOLS_BREAKPOINT) ||
00447         (BreakpointCode == <a class="code" href="../../d6/d7/halmips_8h.html#a453">KERNEL_BREAKPOINT</a>)) {
00448         ContextRecord-&gt;Fir += 4;
00449         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00450     } <span class="keywordflow">else</span> {
00451         <span class="keywordflow">if</span> ( (BreakpointCode == DEBUG_STOP_BREAKPOINT) &amp;&amp;
00452              (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) ){
00453              ContextRecord-&gt;Fir += 4;
00454              <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00455         } <span class="keywordflow">else</span> {
00456             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00457         }
00458     }
00459 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:34 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
