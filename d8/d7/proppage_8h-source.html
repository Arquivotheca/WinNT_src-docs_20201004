<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: proppage.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>proppage.h</h1><a href="../../d7/d8/proppage_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/******************************************************************************</span>
00002 <span class="comment"></span>
00003 <span class="comment">  Header File:  Property Page.H</span>
00004 <span class="comment"></span>
00005 <span class="comment">  This defines the C++ class used to encapsulate property pages.  This class</span>
00006 <span class="comment">  has a static method for the dialog procedure, which automatically caches the</span>
00007 <span class="comment">  "this" pointer for the class in the DWL_USER field of the windows internal</span>
00008 <span class="comment">  structure for the dialog used for the property page.  This hand-off is</span>
00009 <span class="comment">  accomplished by setting the lParam field of the PROPSHEETPAGE structure to</span>
00010 <span class="comment">  the "this" pointer.  It also saves the dialog handle in a protected member</span>
00011 <span class="comment">  for easy access from derived classes.</span>
00012 <span class="comment"></span>
00013 <span class="comment">  To create a C++ class for any specific property sheet, derive the class</span>
00014 <span class="comment">  from this class, providing the dialog ID and instance handle needed to get</span>
00015 <span class="comment">  the resource in the m_psp member.</span>
00016 <span class="comment"></span>
00017 <span class="comment">  The dialog procedure then provides virtual functions for Windows messages</span>
00018 <span class="comment">  of interest.  I've added these as needed.  If I were going to a truly </span>
00019 <span class="comment">  universal class of this sort, I'd just as well go to MFC, and save the </span>
00020 <span class="comment">  debugging time, so this approach seems reasonable to me.</span>
00021 <span class="comment"></span>
00022 <span class="comment">  Copyright (c) 1996 by Microsoft Corporation</span>
00023 <span class="comment"></span>
00024 <span class="comment">  A Pretty Penny Enterprises Production</span>
00025 <span class="comment"></span>
00026 <span class="comment">  Change History:</span>
00027 <span class="comment"></span>
00028 <span class="comment">  11-01-96  a-robkj@microsoft.com- original version</span>
00029 <span class="comment"></span>
00030 <span class="comment">******************************************************************************/</span>
00031 
00032 <span class="preprocessor">#if !defined(PROPERTY_PAGE)</span>
00033 <span class="preprocessor"></span>
<a name="l00034"></a><a class="code" href="../../d7/d8/proppage_8h.html#a0">00034</a> <span class="preprocessor">#define PROPERTY_PAGE</span>
00035 <span class="preprocessor"></span>
00036 <span class="comment">//  CPropertyPage class- abstracts a property page for us</span>
00037 
<a name="l00038"></a><a class="code" href="../../d2/d6/classCPropertyPage.html">00038</a> <span class="keyword">class </span><a class="code" href="../../d2/d6/classCPropertyPage.html">CPropertyPage</a> {
00039 
00040     <span class="comment">//  Basic dialog procedure for all derived classes</span>
00041 
00042     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> CALLBACK    <a class="code" href="../../d2/d6/classCPropertyPage.html#h0">DialogProc</a>(HWND hwndPage, <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uMsg, WPARAM wp,
00043                                        LPARAM lp);
00044 
00045     <span class="comment">//  These elements should be protected (only available to derived classes)</span>
00046 
00047 <span class="keyword">protected</span>:
<a name="l00048"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#p0">00048</a>     PROPSHEETPAGE   <a class="code" href="../../d2/d6/classCPropertyPage.html#p0">m_psp</a>;
<a name="l00049"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#p2">00049</a>     HWND            <a class="code" href="../../d2/d6/classCPropertyPage.html#p1">m_hwnd</a>, <a class="code" href="../../d2/d6/classCPropertyPage.html#p2">m_hwndSheet</a>;
<a name="l00050"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#p3">00050</a>     HPROPSHEETPAGE  <a class="code" href="../../d2/d6/classCPropertyPage.html#p3">m_hpsp</a>;
00051 
<a name="l00052"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#p4">00052</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            <a class="code" href="../../d2/d6/classCPropertyPage.html#p4">m_bChanged</a>;
00053 
00054 <span class="keyword">public</span>:
00055 
00056     <a class="code" href="../../d2/d6/classCPropertyPage.html#a0">CPropertyPage</a>();    <span class="comment">//  Default Constructor</span>
<a name="l00057"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a1">00057</a>     <span class="keyword">virtual</span> <a class="code" href="../../d2/d6/classCPropertyPage.html#a1">~CPropertyPage</a>() {}
00058 
00059     HPROPSHEETPAGE  <a class="code" href="../../d2/d6/classCPropertyPage.html#a2">Handle</a>();   <span class="comment">//  Calls CreatePropertySheetPage, if needed</span>
00060 
<a name="l00061"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a3">00061</a>     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>            <a class="code" href="../../d2/d6/classCPropertyPage.html#a3">EnableApplyButton</a>() {
00062         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d2/d6/classCPropertyPage.html#p2">m_hwndSheet</a>, PSM_CHANGED, (WPARAM) <a class="code" href="../../d2/d6/classCPropertyPage.html#p1">m_hwnd</a>, 0);
00063     }
00064 
<a name="l00065"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a4">00065</a>     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>            <a class="code" href="../../d2/d6/classCPropertyPage.html#a4">DisableApplyButton</a>() {
00066         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d2/d6/classCPropertyPage.html#p2">m_hwndSheet</a>, PSM_UNCHANGED, (WPARAM) <a class="code" href="../../d2/d6/classCPropertyPage.html#p1">m_hwnd</a>, 0);
00067     }
00068 
<a name="l00069"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a5">00069</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            <a class="code" href="../../d2/d6/classCPropertyPage.html#a5">SettingChanged</a>()    {
00070         <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/classCPropertyPage.html#p4">m_bChanged</a>;
00071     }
00072 
<a name="l00073"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a6">00073</a>     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>            <a class="code" href="../../d2/d6/classCPropertyPage.html#a5">SettingChanged</a>(BOOL b) {
00074         <a class="code" href="../../d2/d6/classCPropertyPage.html#p4">m_bChanged</a> = b;
00075     }
00076 
00077     <span class="comment">//  virtual functions- these get redefined on an as needed basis for</span>
00078     <span class="comment">//  any specialized handling desired by any derived classes.</span>
00079 
00080     <span class="comment">//  The default handling allows one to initially display the sheet with</span>
00081     <span class="comment">//  no coding beyond the constructor for the derived class</span>
00082 
<a name="l00083"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a7">00083</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d2/d6/classCPropertyPage.html#a7">OnCommand</a>(WORD wNotifyCode, WORD wid, HWND hwndCtl) {
00084         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00085     }
00086 
<a name="l00087"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a8">00087</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d2/d6/classCPropertyPage.html#a8">OnNotify</a>(<span class="keywordtype">int</span> idCtrl, LPNMHDR pnmh) {
00088         <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00089     }
00090 
<a name="l00091"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a9">00091</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d2/d6/classCPropertyPage.html#a9">OnInit</a>() { <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; }
00092 
<a name="l00093"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a10">00093</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d2/d6/classCPropertyPage.html#a10">OnDestroy</a>() { <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; }
00094 
<a name="l00095"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a11">00095</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d2/d6/classCPropertyPage.html#a11">OnHelp</a>(LPHELPINFO pHelp) { <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; }
<a name="l00096"></a><a class="code" href="../../d2/d6/classCPropertyPage.html#a12">00096</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d2/d6/classCPropertyPage.html#a12">OnContextMenu</a>(HWND hwnd) { <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; }
00097 };
00098 
00099 <span class="comment">/******************************************************************************</span>
00100 <span class="comment"></span>
00101 <span class="comment">  Shell Extension property page class</span>
00102 <span class="comment"></span>
00103 <span class="comment">  Noteworthy details:</span>
00104 <span class="comment"></span>
00105 <span class="comment">  These pages are displayed by the shell.  The thread of execution is such that</span>
00106 <span class="comment">  we create the page, then return to the shell.  The shell will then attempt to</span>
00107 <span class="comment">  unload the extension.  It will query CanDllUnloadNow to do this.  Since</span>
00108 <span class="comment">  freeing the library frees the page template and dialog procedure, we can't</span>
00109 <span class="comment">  allow this to happen while any instances of this class exist.</span>
00110 <span class="comment"></span>
00111 <span class="comment">  However, the shell doesn't know this is a class, so it won't destroy it.</span>
00112 <span class="comment"></span>
00113 <span class="comment">  What I've done is build a circular chain of all of the instances of this</span>
00114 <span class="comment">  class, anchored in a private static class member.  A public static method</span>
00115 <span class="comment">  (OKToClose) then walks the chain.  If an instance's window handle is no</span>
00116 <span class="comment">  longer valid, then the shell has finished with it, and we delete it.  The</span>
00117 <span class="comment">  criterion for closing then becomes not finding a valid handle (so we don't</span>
00118 <span class="comment">  delay unloading by any lazy evaluation, such as requiring an empty chain</span>
00119 <span class="comment">  on entry).</span>
00120 <span class="comment"></span>
00121 <span class="comment">  All Property pages displayed by a property sheet extension should be derived</span>
00122 <span class="comment">  from this class.</span>
00123 <span class="comment"></span>
00124 <span class="comment">  While a mechanism is provided by property sheets for a reference count</span>
00125 <span class="comment">  maintenance mechanism, this mechanism will not call any class destructor-</span>
00126 <span class="comment">  this could lead to memory leaks, which is why I've chosen this method.</span>
00127 <span class="comment"></span>
00128 <span class="comment">******************************************************************************/</span>
00129 
<a name="l00130"></a><a class="code" href="../../d9/d6/classCShellExtensionPage.html">00130</a> <span class="keyword">class </span><a class="code" href="../../d9/d6/classCShellExtensionPage.html">CShellExtensionPage</a>: <span class="keyword">public</span> <a class="code" href="../../d2/d6/classCPropertyPage.html">CPropertyPage</a> {
00131 
00132     <span class="keyword">static</span>  <a class="code" href="../../d9/d6/classCShellExtensionPage.html">CShellExtensionPage</a> *<a class="code" href="../../d9/d6/classCShellExtensionPage.html#v0">m_pcsepAnchor</a>; <span class="comment">//  Anchor the chain of these</span>
00133 
<a name="l00134"></a><a class="code" href="../../d9/d6/classCShellExtensionPage.html#r0">00134</a>     <a class="code" href="../../d9/d6/classCShellExtensionPage.html">CShellExtensionPage</a> *<a class="code" href="../../d9/d6/classCShellExtensionPage.html#r0">m_pcsepPrevious</a>, *<a class="code" href="../../d9/d6/classCShellExtensionPage.html#r1">m_pcsepNext</a>;
00135 
00136 <span class="keyword">public</span>:
00137 
00138     <a class="code" href="../../d9/d6/classCShellExtensionPage.html#a0">CShellExtensionPage</a>();
00139     <a class="code" href="../../d9/d6/classCShellExtensionPage.html#a1">~CShellExtensionPage</a>();
00140 
00141     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d6/classCShellExtensionPage.html#e0">OKToClose</a>();
00142 };
00143 
00144 
00145 <span class="preprocessor">#endif  //  Keep us from getting multiply defined</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:30 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
