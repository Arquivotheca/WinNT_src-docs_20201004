<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: appui.cpp Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>appui.cpp</h1><a href="../../d7/d8/appui_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/******************************************************************************</span>
00002 <span class="comment"></span>
00003 <span class="comment">  Source File:  AppUI.CPP</span>
00004 <span class="comment"></span>
00005 <span class="comment">  This file implements the Application UI.  This consists of two (ANSI/UNICODE)</span>
00006 <span class="comment">  functions that allow an application to specify profiles to be used, and so</span>
00007 <span class="comment">  forth.</span>
00008 <span class="comment"></span>
00009 <span class="comment">  Copyright (c) 1996 by Microsoft Corporation</span>
00010 <span class="comment"></span>
00011 <span class="comment">  A Pretty Penny Enterprises Production</span>
00012 <span class="comment"></span>
00013 <span class="comment">  Change History:</span>
00014 <span class="comment">  12-11-96  a-robkj@microsoft.com   Created it</span>
00015 <span class="comment"></span>
00016 <span class="comment">******************************************************************************/</span>
00017 
00018 <span class="preprocessor">#include    "ICMUI.H"</span>
00019 
<a name="l00020"></a><a class="code" href="../../d7/d8/appui_8cpp.html#a1">00020</a> CONST <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d8/appui_8cpp.html#a1">ApplicationUIHelpIds</a>[] = {
00021     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a78">ApplyButton</a>,          <a class="code" href="../../d3/d9/icmuihlp_8h.html#a32">IDH_ICMUI_APPLY</a>,
00022     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a80">EnableICM</a>,            <a class="code" href="../../d3/d9/icmuihlp_8h.html#a35">IDH_APPUI_ICM</a>,
00023     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a81">EnableBasic</a>,          <a class="code" href="../../d3/d9/icmuihlp_8h.html#a45">IDH_APPUI_BASIC</a>,
00024     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a82">EnableProofing</a>,       <a class="code" href="../../d3/d9/icmuihlp_8h.html#a47">IDH_APPUI_PROOF</a>,
00025     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a90">MonitorProfile</a>,       <a class="code" href="../../d3/d9/icmuihlp_8h.html#a37">IDH_APPUI_MONITOR</a>,
00026     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a83">MonitorProfileLabel</a>,  <a class="code" href="../../d3/d9/icmuihlp_8h.html#a37">IDH_APPUI_MONITOR</a>,
00027     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a91">PrinterProfile</a>,       <a class="code" href="../../d3/d9/icmuihlp_8h.html#a39">IDH_APPUI_PRINTER</a>,
00028     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a84">PrinterProfileLabel</a>,  <a class="code" href="../../d3/d9/icmuihlp_8h.html#a39">IDH_APPUI_PRINTER</a>,
00029     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a92">RenderingIntent</a>,      <a class="code" href="../../d3/d9/icmuihlp_8h.html#a41">IDH_APPUI_INTENT</a>,
00030     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a85">RenderingIntentLabel</a>, <a class="code" href="../../d3/d9/icmuihlp_8h.html#a41">IDH_APPUI_INTENT</a>,
00031     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a93">TargetProfile</a>,        <a class="code" href="../../d3/d9/icmuihlp_8h.html#a43">IDH_APPUI_EMULATE</a>,
00032     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a86">TargetProfileLabel</a>,   <a class="code" href="../../d3/d9/icmuihlp_8h.html#a43">IDH_APPUI_EMULATE</a>,
00033     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a94">TargetIntent</a>,         <a class="code" href="../../d3/d9/icmuihlp_8h.html#a41">IDH_APPUI_INTENT</a>,
00034     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a87">TargetIntentLabel</a>,    <a class="code" href="../../d3/d9/icmuihlp_8h.html#a41">IDH_APPUI_INTENT</a>,
00035 <span class="preprocessor">#if !defined(_WIN95_) // context-sentitive help</span>
00036 <span class="preprocessor"></span><span class="comment">//  SourceProfile,        IDH_APPUI_SOURCE,</span>
00037     <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a89">SourceProfileLabel</a>,   <a class="code" href="../../d3/d9/icmuihlp_8h.html#a51">IDH_APPUI_SOURCE</a>,
00038 <span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>    0, 0
00040 };
00041 
<a name="l00042"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html">00042</a> <span class="keyword">class   </span><a class="code" href="../../d9/d1/classCColorMatchDialog.html">CColorMatchDialog</a> : <span class="keyword">public</span> <a class="code" href="../../d3/d2/classCDialog.html">CDialog</a> {
00043 
<a name="l00044"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">00044</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a>;
00045 
<a name="l00046"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">00046</a>     <a class="code" href="../../d1/d7/classCString.html">CString</a>         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>,
00047                     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>;
00048 
<a name="l00049"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r10">00049</a>     <a class="code" href="../../d1/d7/classCString.html">CString</a>         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r10">m_csMonitorDisplayName</a>; <span class="comment">// since displayName != deviceName for monitor.</span>
00050 
<a name="l00051"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">00051</a>     <a class="code" href="../../d2/d7/classCStringArray.html">CStringArray</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>;
<a name="l00052"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r16">00052</a>     <a class="code" href="../../d2/d7/classCStringArray.html">CStringArray</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r14">m_csaMonitorDesc</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r15">m_csaPrinterDesc</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r16">m_csaTargetDesc</a>;
00053 
00054     <span class="comment">//  For handy reference (from Setup structure)</span>
00055 
<a name="l00056"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">00056</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>;
00057 
00058     <span class="comment">//  To reduce stack usage and code size</span>
00059 
<a name="l00060"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r26">00060</a>     HWND    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>,
00061             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r24">m_hwndIntentText1</a>,
00062             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r25">m_hwndIntentLabel</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r26">m_hwndTargetProfileLabel</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r27">m_hwndTargetIntentLabel</a>,
00063             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r28">m_hwndMonitorProfileLabel</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r29">m_hwndPrinterProfileLabel</a>;
00064 
00065     <span class="comment">//  For Apply callback</span>
00066 
<a name="l00067"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">00067</a>     PCMSCALLBACK <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a>;
<a name="l00068"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r31">00068</a>     LPARAM       <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r31">m_lpApplyCallback</a>;
00069 
00070     <span class="comment">//  To identify callee</span>
00071 
<a name="l00072"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r32">00072</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r32">m_bAnsiCall</a>;
00073 
00074     <span class="comment">//  Display profile description or filename</span>
00075 
<a name="l00076"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r33">00076</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r33">m_bUseProfileDescription</a>;
00077 
00078     <span class="comment">//  Intent control</span>
00079 
<a name="l00080"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r35">00080</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r34">m_bDisableIntent</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r35">m_bDisableRenderIntent</a>;
00081 
00082     <span class="comment">// Pointer to COLORMATCHSETUP[A|W]</span>
00083 
<a name="l00084"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#r36">00084</a>     PVOID   <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r36">m_pvCMS</a>;
00085 
00086     <span class="keywordtype">void</span>    <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(DWORD dwError);
00087     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d1">GoodParms</a>(PCOLORMATCHSETUP pcms);
00088     <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d2">CompleteInitialization</a>();
00089     <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">UpdateControls</a>(BOOL bChanged = FALSE);
00090 
00091     <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">FillStructure</a>(COLORMATCHSETUPA *pcms);
00092     <span class="keywordtype">void</span>    FillStructure(COLORMATCHSETUPW *pcms);
00093 
00094     <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>(BOOL bEnable = TRUE);
00095 
00096 <span class="keyword">public</span>:
00097 
00098     <a class="code" href="../../d9/d1/classCColorMatchDialog.html">CColorMatchDialog</a>(COLORMATCHSETUPA *pcms);
00099     <a class="code" href="../../d9/d1/classCColorMatchDialog.html">CColorMatchDialog</a>(COLORMATCHSETUPW *pcms);
00100 
<a name="l00101"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a2">00101</a>     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a2">~CColorMatchDialog</a>() {
00102         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00103         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00104         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00105         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r14">m_csaMonitorDesc</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00106         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r15">m_csaPrinterDesc</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00107         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r16">m_csaTargetDesc</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00108         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00109         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00110         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00111         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00112         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00113         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00114         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r10">m_csMonitorDisplayName</a>.<a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00115     }
00116 
<a name="l00117"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a3">00117</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a3">Results</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a>; }
00118 
00119     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a4">OnInit</a>();
00120 
00121     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> OnCommand(WORD wNotifyCode, WORD wid, HWND hwndCtl);
00122 
00123     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> OnHelp(LPHELPINFO pHelp);
00124     <span class="keyword">virtual</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> OnContextMenu(HWND hwnd);
00125 };
00126 
00127 <span class="comment">//  Record a failure</span>
00128 
<a name="l00129"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d0">00129</a> <span class="keywordtype">void</span>    <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">CColorMatchDialog::Fail</a>(DWORD dwError) {
00130     SetLastError(dwError);
00131     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00132 }
00133 
00134 <span class="comment">//  Report input parameter validity</span>
00135 
<a name="l00136"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d1">00136</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d1">CColorMatchDialog::GoodParms</a>(PCOLORMATCHSETUP pcms) {
00137 
00138     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00139 
00140     <span class="keywordflow">if</span>  (!pcms || pcms -&gt; dwVersion != COLOR_MATCH_VERSION ||
00141          pcms -&gt; dwSize != <span class="keyword">sizeof</span> *pcms || !pcms -&gt; pMonitorProfile ||
00142          !pcms -&gt; pPrinterProfile || !pcms -&gt; pTargetProfile ||
00143          !pcms -&gt; ccMonitorProfile || !pcms -&gt; ccPrinterProfile ||
00144          !pcms -&gt; ccTargetProfile) {
00145         <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INVALID_PARAMETER);
00146         <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00147     }
00148 
00149     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_USEHOOK &amp;&amp; !pcms -&gt; lpfnHook)
00150         <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INVALID_PARAMETER);
00151 
00152     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_USEAPPLYCALLBACK &amp;&amp; !pcms -&gt; lpfnApplyCallback)
00153         <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INVALID_PARAMETER);
00154 
00155     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETRENDERINTENT &amp;&amp;
00156          pcms -&gt; dwRenderIntent &gt; INTENT_ABSOLUTE_COLORIMETRIC)
00157          <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INVALID_PARAMETER);
00158 
00159     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETPROOFINTENT &amp;&amp;
00160          pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_ENABLEPROOFING &amp;&amp;
00161          pcms -&gt; dwProofingIntent &gt; INTENT_ABSOLUTE_COLORIMETRIC)
00162          <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INVALID_PARAMETER);
00163 
00164     <span class="comment">//  Setup the hooking, if needed</span>
00165 
00166     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_USEHOOK) {
00167         m_dpHook = pcms -&gt; lpfnHook;
00168         m_lpHook = pcms -&gt; lParam;
00169     }
00170 
00171     <span class="comment">//  Setup the callback for apply, if needed</span>
00172 
00173     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_USEAPPLYCALLBACK) {
00174         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a> = pcms -&gt; lpfnApplyCallback;
00175         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r31">m_lpApplyCallback</a> = pcms -&gt; lParamApplyCallback;
00176     } <span class="keywordflow">else</span> {
00177         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00178         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r31">m_lpApplyCallback</a> = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00179     }
00180 
00181     <span class="comment">//  Cache the flags...</span>
00182 
00183     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00184 
00185     <span class="comment">//  Init the intents</span>
00186 
00187     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a> = (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETRENDERINTENT) ?
00188         pcms -&gt; dwRenderIntent : INTENT_PERCEPTUAL;
00189 
00190     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a> = (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETPROOFINTENT) &amp;&amp; (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_ENABLEPROOFING) ?
00191         pcms -&gt; dwProofingIntent : <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>;
00192 
00193     <span class="comment">//  Init the flags</span>
00194 
00195     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a> = !(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_DISABLEICM);
00196     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> = !!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_ENABLEPROOFING);
00197 
00198     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r33">m_bUseProfileDescription</a> = !!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_USEDESCRIPTION);
00199 
00200     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r34">m_bDisableIntent</a> = !!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_DISABLEINTENT);
00201     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r35">m_bDisableRenderIntent</a> = !!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_DISABLERENDERINTENT);
00202 
00203     <span class="comment">//  Init the pointer to buffer</span>
00204 
00205     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r36">m_pvCMS</a> = (PVOID) pcms;
00206 
00207     <span class="keywordflow">return</span>  <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a>;
00208 }
00209 
00210 <span class="comment">//  Encoding-independent construction actions</span>
00211 
<a name="l00212"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d2">00212</a> <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d2">CColorMatchDialog::CompleteInitialization</a>() {
00213 
00214     <span class="comment">//  Determine the appropriate source, monitor and printer names</span>
00215 
00216     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>())
00217         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a11">DefaultSourceString</a>);
00218 
00219     <span class="comment">//  Check the validation for monitor name.</span>
00220 
00221     <a class="code" href="../../d2/d4/classCMonitorList.html">CMonitorList</a>    cml;
00222     cml.<a class="code" href="../../d2/d4/classCMonitorList.html#a6">Enumerate</a>();
00223 
00224     <span class="keywordflow">if</span>  (!cml.<a class="code" href="../../d2/d4/classCMonitorList.html#a7">IsValidDeviceName</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a>)) {
00225 
00226         <span class="comment">// Get primary device.</span>
00227 
00228         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a> = cml.<a class="code" href="../../d2/d4/classCMonitorList.html#a5">PrimaryDeviceName</a>();
00229     }
00230 
00231     <span class="comment">//  Map display name from device name</span>
00232 
00233     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r10">m_csMonitorDisplayName</a> = cml.<a class="code" href="../../d2/d4/classCMonitorList.html#a8">DeviceNameToDisplayName</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a>);
00234 
00235     <span class="comment">//  Check the validation for printer name.</span>
00236 
00237     HANDLE hPrinter;
00238 
00239     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>() &amp;&amp; OpenPrinter(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>,&amp;hPrinter,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00240 
00241         <span class="comment">// The specified printer has been found.</span>
00242 
00243         ClosePrinter(hPrinter);
00244 
00245     } <span class="keywordflow">else</span> {
00246 
00247         <span class="comment">//  The specified printer has not been found,</span>
00248         <span class="comment">//  Get the default printer name- do it the old, slimy way...</span>
00249 
00250         TCHAR   acBuffer[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00251 
00252         GetProfileString(_TEXT(<span class="stringliteral">"Windows"</span>), _TEXT(<span class="stringliteral">"Device"</span>), _TEXT(<span class="stringliteral">""</span>),
00253             acBuffer, <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>);
00254 
00255         <span class="comment">//  The buffer will contains "PrinterName,DriverName,Port".</span>
00256         <span class="comment">//  What we need is only printer name.</span>
00257 
00258         TCHAR *pTmp = acBuffer;
00259 
00260         <span class="keywordflow">while</span> (*pTmp) {
00261             <span class="keywordflow">if</span> (*pTmp == __TEXT(<span class="charliteral">','</span>)) {
00262                 *pTmp = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00263                 <span class="keywordflow">break</span>;
00264             }
00265             pTmp++;
00266         }
00267 
00268         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a> = acBuffer;
00269     }
00270 
00271     <span class="keywordflow">if</span>  (CGlobals::ThisIsAColorPrinter(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>))
00272         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00273      <span class="keywordflow">else</span>
00274         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00275 
00276     <span class="comment">//  Now, we collect the names</span>
00277 
00278     ENUMTYPE et = { <span class="keyword">sizeof</span> et, ENUM_TYPE_VERSION, (ET_DEVICENAME|ET_DEVICECLASS) };
00279 
00280     <span class="comment">//  Enumrate monitor.</span>
00281 
00282     et.pDeviceName   = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a>;
00283     et.dwDeviceClass = CLASS_MONITOR;
00284     CProfile::Enumerate(et, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r14">m_csaMonitorDesc</a>);
00285 
00286     <span class="comment">//  Enumrate only for Color Printer.</span>
00287 
00288     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a>) {
00289         et.pDeviceName   = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>;
00290         et.dwDeviceClass = CLASS_PRINTER;
00291         CProfile::Enumerate(et, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r15">m_csaPrinterDesc</a>);
00292     } <span class="keywordflow">else</span> {
00293         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00294         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r15">m_csaPrinterDesc</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00295     }
00296 
00297     et.dwFields = 0;
00298 
00299     CProfile::Enumerate(et, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r16">m_csaTargetDesc</a>);
00300 
00301     <span class="comment">//  Fix up the default names for the profiles</span>
00302 
00303     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a7">Map</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>) == <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00304     {
00305         _RPTF2(_CRT_WARN, <span class="stringliteral">"Printer Profile %s isn't associated with "</span>
00306             <span class="stringliteral">"the monitor (%s)"</span>, (LPCTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>,
00307             (LPCTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>);
00308         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00309         {
00310             m_csPrinterProfile = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>[0];
00311         }
00312         <span class="keywordflow">else</span>
00313         {
00314             m_csPrinterProfile = (LPCTSTR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00315         }
00316     }
00317 
00318     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a7">Map</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>) == <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00319     {
00320         _RPTF2(_CRT_WARN, <span class="stringliteral">"Monitor Profile %s isn't associated with "</span>
00321             <span class="stringliteral">"the monitor (%s)"</span>, (LPCTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>,
00322             (LPCTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a>);
00323         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00324         {
00325             m_csMonitorProfile = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>[0];
00326         }
00327         <span class="keywordflow">else</span>
00328         {
00329             m_csMonitorProfile = (LPCTSTR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00330         }
00331     }
00332 
00333     <span class="comment">//  If the target profile name is invalid, use the printer profile</span>
00334 
00335     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a7">Map</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>) == <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00336     {
00337         _RPTF1(_CRT_WARN, <span class="stringliteral">"Target Profile %s isn't installed"</span>,
00338             (LPCTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>);
00339         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00340         {
00341             m_csTargetProfile = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>[0];
00342         }
00343         <span class="keywordflow">else</span>
00344         {
00345             <span class="comment">// And then, there is no printer profile, it will</span>
00346             <span class="comment">// be Windows color space profile.</span>
00347 
00348             TCHAR TargetProfileName[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00349             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
00350 
00351             <span class="keywordflow">if</span> (GetStandardColorSpaceProfile(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,LCS_WINDOWS_COLOR_SPACE,TargetProfileName,&amp;dwSize)) {
00352                 m_csTargetProfile = (LPCTSTR) TargetProfileName;
00353                 m_csTargetProfile = (LPCTSTR) m_csTargetProfile.NameAndExtension();
00354             } <span class="keywordflow">else</span> {
00355                 m_csTargetProfile = (LPCTSTR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00356             }
00357         }
00358     }
00359 }
00360 
00361 <span class="comment">//  Update the controls</span>
00362 
<a name="l00363"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">00363</a> <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">CColorMatchDialog::UpdateControls</a>(BOOL bChanged) {
00364 
00365     <span class="comment">//  Switch Proofing Controls based on setting</span>
00366 
00367     <a class="code" href="../../d3/d0/user32_8def.html#a32">ShowWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r24">m_hwndIntentText1</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> &amp;&amp; <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a> ? SW_SHOWNORMAL : SW_HIDE);
00368 
00369     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r26">m_hwndTargetProfileLabel</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> &amp;&amp; <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a>);
00370     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> &amp;&amp; m_bEnableICM);
00371 
00372     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r27">m_hwndTargetIntentLabel</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> &amp;&amp; m_bEnableICM &amp;&amp; !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r34">m_bDisableIntent</a>);
00373     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> &amp;&amp; m_bEnableICM &amp;&amp; !m_bDisableIntent);
00374 
00375     <span class="comment">//  Switch the other Controls, as well...</span>
00376 
00377     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r28">m_hwndMonitorProfileLabel</a>, m_bEnableICM);
00378     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, m_bEnableICM);
00379 
00380     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r29">m_hwndPrinterProfileLabel</a>, m_bEnableICM &amp;&amp; !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>());
00381     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, m_bEnableICM &amp;&amp; <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a> &amp;&amp; !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>());
00382 
00383     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a>) {
00384         <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r25">m_hwndIntentLabel</a>, m_bEnableICM &amp;&amp; !m_bDisableIntent &amp;&amp; !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r35">m_bDisableRenderIntent</a>);
00385         <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, m_bEnableICM &amp;&amp; !m_bDisableIntent &amp;&amp; !m_bDisableRenderIntent);
00386     } <span class="keywordflow">else</span> {
00387         <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r25">m_hwndIntentLabel</a>, m_bEnableICM &amp;&amp; !m_bDisableIntent);
00388         <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, m_bEnableICM &amp;&amp; !m_bDisableIntent);
00389     }
00390 
00391     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a81">EnableBasic</a>), m_bEnableICM);
00392     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a82">EnableProofing</a>), m_bEnableICM);
00393 
00394     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>(bChanged);
00395 }
00396 
00397 <span class="comment">//  Update the Apply buttom</span>
00398 
<a name="l00399"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">00399</a> <span class="keywordtype">void</span>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">CColorMatchDialog::EnableApplyButton</a>(BOOL bEnable) {
00400 
00401     <a class="code" href="../../d3/d8/client_8c.html#a98">EnableWindow</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a78">ApplyButton</a>), bEnable);
00402 
00403 }
00404 
00405 <span class="comment">//  Flags for buffer overflow (combined)</span>
00406 
<a name="l00407"></a><a class="code" href="../../d7/d8/appui_8cpp.html#a0">00407</a> <span class="preprocessor">#define BAD_BUFFER_FLAGS    (CMS_MONITOROVERFLOW | CMS_PRINTEROVERFLOW | \</span>
00408 <span class="preprocessor">                             CMS_TARGETOVERFLOW)</span>
00409 <span class="preprocessor"></span>
00410 <span class="comment">//  By moving the ANSI / Unicode issues into the CString class</span>
00411 <span class="comment">//  it becomes feasible to code these two versions so they look</span>
00412 <span class="comment">//  encoding-independent.  In other words, the code for both</span>
00413 <span class="comment">//  of these versions is written identically, and the compiler</span>
00414 <span class="comment">//  does all the work, just like it ought to...</span>
00415 
<a name="l00416"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">00416</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">CColorMatchDialog::FillStructure</a>(COLORMATCHSETUPA *pcms) {
00417 
00418     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a>) {
00419 
00420         pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = CMS_SETRENDERINTENT | CMS_SETPRINTERPROFILE |
00421                           CMS_SETMONITORPROFILE;
00422 
00423         pcms -&gt; dwRenderIntent = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>;
00424 
00425         <span class="comment">//  03-20-1997  Bob_Kjelgaard@Prodigy.Net   RAID 21091 (Memphis)</span>
00426         <span class="comment">//  Don't fail if there is no monitor or printer profile.  Set</span>
00427         <span class="comment">//  them to an empty string and succeed, instead.</span>
00428         <span class="comment">//  We can always do this, because 0 counts and empty pointers</span>
00429         <span class="comment">//  have already been screened out.</span>
00430 
00431         <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>())
00432             pcms -&gt; pMonitorProfile[0] = <span class="charliteral">'\0'</span>;
00433         <span class="keywordflow">else</span> {
00434             lstrcpynA(pcms -&gt; pMonitorProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>,
00435                 pcms -&gt; ccMonitorProfile);
00436             <span class="keywordflow">if</span>  (lstrcmpA(pcms -&gt; pMonitorProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>))
00437                 pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= CMS_MONITOROVERFLOW;
00438         }
00439 
00440         <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>() || !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a>)
00441             pcms -&gt; pPrinterProfile[0] = <span class="charliteral">'\0'</span>;
00442         <span class="keywordflow">else</span> {
00443             lstrcpynA(pcms -&gt; pPrinterProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>,
00444                 pcms -&gt; ccPrinterProfile);
00445 
00446             <span class="keywordflow">if</span>  (lstrcmpA(pcms -&gt; pPrinterProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>))
00447                 pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= CMS_PRINTEROVERFLOW;
00448         }
00449 
00450         <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a>) {
00451             pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |=
00452                 CMS_ENABLEPROOFING | CMS_SETTARGETPROFILE;
00453             pcms -&gt; dwProofingIntent = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>;
00454             lstrcpynA(pcms -&gt; pTargetProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>,
00455                 pcms -&gt; ccTargetProfile);
00456             <span class="keywordflow">if</span>  (lstrcmpA(pcms -&gt; pTargetProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>))
00457                 pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= CMS_TARGETOVERFLOW;
00458         } <span class="keywordflow">else</span> {
00459             pcms -&gt; pTargetProfile[0] = <span class="charliteral">'\0'</span>;
00460         }
00461 
00462         <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d7/d8/appui_8cpp.html#a0">BAD_BUFFER_FLAGS</a>)
00463             <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INSUFFICIENT_BUFFER);
00464     }
00465     <span class="keywordflow">else</span>
00466     {
00467         pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = CMS_DISABLEICM;   <span class="comment">//  No other flags are valid!</span>
00468         pcms -&gt; pMonitorProfile[0] = <span class="charliteral">'\0'</span>;  <span class="comment">//  No color profiles are choosed</span>
00469         pcms -&gt; pPrinterProfile[0] = <span class="charliteral">'\0'</span>;
00470         pcms -&gt; pTargetProfile[0]  = <span class="charliteral">'\0'</span>;
00471     }
00472 }
00473 
<a name="l00474"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#d5">00474</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">CColorMatchDialog::FillStructure</a>(COLORMATCHSETUPW *pcms) {
00475 
00476     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a>) {
00477 
00478         pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = CMS_SETRENDERINTENT | CMS_SETPRINTERPROFILE |
00479                           CMS_SETMONITORPROFILE;
00480 
00481         pcms -&gt; dwRenderIntent = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>;
00482 
00483         <span class="comment">//  03-20-1997  Bob_Kjelgaard@Prodigy.Net   RAID 21091 (Memphis)</span>
00484         <span class="comment">//  Don't fail if there is no monitor or printer profile.  Set</span>
00485         <span class="comment">//  them to an empty string and succeed, instead.</span>
00486         <span class="comment">//  We can always do this, because 0 counts and empty pointers</span>
00487         <span class="comment">//  have already been screened out.</span>
00488 
00489         <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>())
00490             pcms -&gt; pMonitorProfile[0] = <span class="charliteral">'\0'</span>;
00491         <span class="keywordflow">else</span> {
00492             lstrcpynW(pcms -&gt; pMonitorProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>,
00493                 pcms -&gt; ccMonitorProfile);
00494             <span class="keywordflow">if</span>  (lstrcmpW(pcms -&gt; pMonitorProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>))
00495                 pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= CMS_MONITOROVERFLOW;
00496         }
00497 
00498         <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>() || !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a>)
00499             pcms -&gt; pPrinterProfile[0] = <span class="charliteral">'\0'</span>;
00500         <span class="keywordflow">else</span> {
00501             lstrcpynW(pcms -&gt; pPrinterProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>,
00502                 pcms -&gt; ccPrinterProfile);
00503 
00504             <span class="keywordflow">if</span>  (lstrcmpW(pcms -&gt; pPrinterProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>))
00505                 pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= CMS_PRINTEROVERFLOW;
00506         }
00507 
00508         <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a>) {
00509             pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |=
00510                 CMS_ENABLEPROOFING | CMS_SETTARGETPROFILE | CMS_SETPROOFINTENT;
00511             pcms -&gt; dwProofingIntent = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>;
00512             lstrcpynW(pcms -&gt; pTargetProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>,
00513                 pcms -&gt; ccTargetProfile);
00514             <span class="keywordflow">if</span>  (lstrcmpW(pcms -&gt; pTargetProfile, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>))
00515                 pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= CMS_TARGETOVERFLOW;
00516         } <span class="keywordflow">else</span> {
00517             pcms -&gt; pTargetProfile[0] = <span class="charliteral">'\0'</span>;
00518         }
00519 
00520         <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d7/d8/appui_8cpp.html#a0">BAD_BUFFER_FLAGS</a>)
00521             <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_INSUFFICIENT_BUFFER);
00522     }
00523     <span class="keywordflow">else</span>
00524     {
00525         pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = CMS_DISABLEICM;   <span class="comment">//  No other flags are valid!</span>
00526         pcms -&gt; pMonitorProfile[0] = <span class="charliteral">'\0'</span>;  <span class="comment">//  No color profiles are choosed</span>
00527         pcms -&gt; pPrinterProfile[0] = <span class="charliteral">'\0'</span>;
00528         pcms -&gt; pTargetProfile[0]  = <span class="charliteral">'\0'</span>;
00529     }
00530 }
00531 
<a name="l00532"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a0">00532</a> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a0">CColorMatchDialog::CColorMatchDialog</a>(COLORMATCHSETUPA *pcms) :
00533     <a class="code" href="../../d3/d2/classCDialog.html">CDialog</a>(<a class="code" href="../../d0/d3/classCGlobals.html">CGlobals</a>::Instance(), <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a95">ApplicationUI</a>, pcms -&gt; hwndOwner) {
00534 
00535     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#d1">GoodParms</a>((PCOLORMATCHSETUP) pcms))
00536         <span class="keywordflow">return</span>;
00537 
00538     <span class="comment">//  Make sure we've initialized these, if we have to.</span>
00539 
00540     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETMONITORPROFILE)
00541         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a> = pcms -&gt; pMonitorProfile;
00542 
00543     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETPRINTERPROFILE)
00544         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a> = pcms -&gt; pPrinterProfile;
00545 
00546     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETTARGETPROFILE)
00547         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a> = pcms -&gt; pTargetProfile;
00548 
00549     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>  = pcms -&gt; pSourceName;
00550     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a> = pcms -&gt; pDisplayName;
00551     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a> = pcms -&gt; pPrinterName;
00552 
00553     <span class="comment">//  Ansi version call</span>
00554 
00555     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r32">m_bAnsiCall</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00556 
00557     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d2">CompleteInitialization</a>();
00558 
00559     <span class="comment">//  Display the UI, and watch what happens...</span>
00560 
00561     <span class="keywordflow">switch</span>  (<a class="code" href="../../d3/d2/classCDialog.html#a3">DoModal</a>()) {
00562 
00563         <span class="keywordflow">case</span>    IDOK:
00564             <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a>)
00565                 <span class="keywordflow">return</span>;
00566 
00567             <span class="comment">// Fill up return buffer.</span>
00568 
00569             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">FillStructure</a>(pcms);
00570             <span class="keywordflow">return</span>;
00571 
00572         <span class="keywordflow">case</span>    IDCANCEL:
00573             <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_SUCCESS);
00574             <span class="keywordflow">return</span>;
00575 
00576         <span class="keywordflow">default</span>:
00577             <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(GetLastError());
00578     }
00579 }
00580 
<a name="l00581"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a1">00581</a> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a0">CColorMatchDialog::CColorMatchDialog</a>(COLORMATCHSETUPW *pcms) :
00582     <a class="code" href="../../d3/d2/classCDialog.html">CDialog</a>(<a class="code" href="../../d0/d3/classCGlobals.html">CGlobals</a>::Instance(), <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a95">ApplicationUI</a>, pcms -&gt; hwndOwner) {
00583 
00584     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#d1">GoodParms</a>((PCOLORMATCHSETUP) pcms))
00585         <span class="keywordflow">return</span>;
00586 
00587     <span class="comment">//  Make sure we've initialized these, if we have to.</span>
00588 
00589     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETMONITORPROFILE) {
00590         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a> = pcms -&gt; pMonitorProfile;
00591         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a15">NameAndExtension</a>();
00592     }
00593 
00594     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETPRINTERPROFILE) {
00595         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a> = pcms -&gt; pPrinterProfile;
00596         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a15">NameAndExtension</a>();
00597     }
00598 
00599     <span class="keywordflow">if</span>  (pcms -&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CMS_SETTARGETPROFILE) {
00600         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a> = pcms -&gt; pTargetProfile;
00601         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a15">NameAndExtension</a>();
00602     }
00603 
00604     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>  = pcms -&gt; pSourceName;
00605     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r5">m_csMonitor</a> = pcms -&gt; pDisplayName;
00606     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a> = pcms -&gt; pPrinterName;
00607 
00608     <span class="comment">//  Unicode version call</span>
00609 
00610     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r32">m_bAnsiCall</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00611 
00612     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d2">CompleteInitialization</a>();
00613 
00614     <span class="comment">//  Display the UI, and watch what happens...</span>
00615 
00616     <span class="keywordflow">switch</span>  (<a class="code" href="../../d3/d2/classCDialog.html#a3">DoModal</a>()) {
00617 
00618         <span class="keywordflow">case</span>    IDOK:
00619             <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r0">m_bSuccess</a>)
00620                 <span class="keywordflow">return</span>;
00621 
00622             <span class="comment">// Fill up return buffer.</span>
00623 
00624             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">FillStructure</a>(pcms);
00625             <span class="keywordflow">return</span>;
00626 
00627         <span class="keywordflow">case</span>    IDCANCEL:
00628             <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(ERROR_SUCCESS);
00629             <span class="keywordflow">return</span>;
00630 
00631         <span class="keywordflow">default</span>:
00632             <a class="code" href="../../d6/d1/hiveload_8c.html#a20a9">Fail</a>(GetLastError());
00633     }
00634 }
00635 
00636 <span class="comment">//  Dialog initialization function</span>
00637 
<a name="l00638"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a4">00638</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a4">CColorMatchDialog::OnInit</a>() {
00639 
00640     <span class="comment">//  Collect the common handles</span>
00641 
00642     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a92">RenderingIntent</a>);
00643     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a94">TargetIntent</a>);
00644     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a91">PrinterProfile</a>);
00645     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a90">MonitorProfile</a>);
00646     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a93">TargetProfile</a>);
00647 
00648     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r28">m_hwndMonitorProfileLabel</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a83">MonitorProfileLabel</a>);
00649     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r29">m_hwndPrinterProfileLabel</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a84">PrinterProfileLabel</a>);
00650     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r25">m_hwndIntentLabel</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a85">RenderingIntentLabel</a>);
00651     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r26">m_hwndTargetProfileLabel</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a86">TargetProfileLabel</a>);
00652     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r27">m_hwndTargetIntentLabel</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a87">TargetIntentLabel</a>);
00653 
00654     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r24">m_hwndIntentText1</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a88">RenderingIntentText1</a>);
00655 
00656     <span class="comment">//  Fill in the source name</span>
00657     <a class="code" href="../../d5/d9/cltxt_8h.html#a20">SetDlgItemText</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a79">SourceProfile</a>, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r4">m_csSource</a>);
00658 
00659     <span class="comment">//  Set the Check Boxes</span>
00660 
00661     <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a15">CheckDlgButton</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a80">EnableICM</a>,
00662         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a> ? BST_CHECKED : BST_UNCHECKED);
00663 
00664     <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a15">CheckDlgButton</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a81">EnableBasic</a>,
00665         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> ? BST_UNCHECKED : BST_CHECKED);
00666     <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a15">CheckDlgButton</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a82">EnableProofing</a>,
00667         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> ? BST_CHECKED : BST_UNCHECKED);
00668 
00669     <span class="comment">//  Fill in the list(s) of Rendering Intents</span>
00670 
00671     <a class="code" href="../../d1/d7/classCString.html">CString</a> csWork; <span class="comment">//  There's plenty of it to do...</span>
00672 
00673     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = INTENT_PERCEPTUAL; i &lt;= INTENT_ABSOLUTE_COLORIMETRIC; i++) {
00674         csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(i + <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a12">PerceptualString</a>);
00675         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, CB_ADDSTRING, 0,
00676             (LPARAM) (LPCTSTR) csWork);
00677         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, CB_ADDSTRING, 0,
00678             (LPARAM) (LPCTSTR) csWork);
00679     }
00680 
00681     <span class="comment">//  Init the rendering intents</span>
00682 
00683     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, CB_SETCURSEL, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>, 0);
00684     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, CB_SETCURSEL, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>, 0);
00685 
00686     <span class="comment">//  Init the profile lists</span>
00687 
00688     <span class="comment">//  03-20-1997    Bob_Kjelgaard@Prodigy.Net   RAID Memphis:22213</span>
00689     <span class="comment">//  The algorithm used to determine which profile to select was incorrect.</span>
00690     <span class="comment">//  There's a much simpler and direct way, anyway.</span>
00691 
00692     LRESULT <span class="keywordtype">id</span>;
00693 
00694     <span class="comment">//  Target Profiles</span>
00695 
00696     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> u = 0; u &lt; <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>(); u++) {
00697         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r33">m_bUseProfileDescription</a>) {
00698             <span class="keywordtype">id</span> = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_ADDSTRING,
00699                              0, (LPARAM)((LPTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r16">m_csaTargetDesc</a>[u]));
00700         } <span class="keywordflow">else</span> {
00701             <span class="keywordtype">id</span> = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_ADDSTRING,
00702                              0, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>[u].NameOnly());
00703         }
00704         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_SETITEMDATA, <span class="keywordtype">id</span>, u);
00705 
00706         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>[u].IsEqualString(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>)) {
00707             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_SETCURSEL, <span class="keywordtype">id</span>, 0);
00708         }
00709     }
00710 
00711     <span class="comment">//  Set Target profile if specified, otherwise the default</span>
00712 
00713     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>()) {
00714         <a class="code" href="../../d1/d7/classCString.html">CString</a> csWork;
00715         csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a24">NoProfileString</a>);
00716 
00717         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_ADDSTRING, 0, csWork);
00718         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_SETITEMDATA, 0, -1);
00719         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r23">m_hwndTargetList</a>, CB_SETCURSEL, 0, 0);
00720     }
00721 
00722     <span class="comment">//  Monitor Profiles</span>
00723 
00724     <span class="comment">//  03-20-1997  Bob_Kjelgaard@Prodigy.Net   Memphis RAID #22289</span>
00725 
00726     csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a83">MonitorProfileLabel</a>));
00727     csWork = csWork + <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r10">m_csMonitorDisplayName</a> + _TEXT(<span class="stringliteral">")"</span>);
00728     <a class="code" href="../../d5/d9/cltxt_8h.html#a20">SetDlgItemText</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a83">MonitorProfileLabel</a>, csWork);
00729 
00730     <span class="keywordflow">for</span> (u = 0; u &lt; <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>(); u++) {
00731         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r33">m_bUseProfileDescription</a>) {
00732             <span class="keywordtype">id</span> = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_ADDSTRING,
00733                              0, (LPARAM)((LPTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r14">m_csaMonitorDesc</a>[u]));
00734         } <span class="keywordflow">else</span> {
00735             <span class="keywordtype">id</span> = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_ADDSTRING,
00736                              0, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>[u].NameOnly());
00737         }
00738         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_SETITEMDATA, <span class="keywordtype">id</span>, u);
00739 
00740         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>[u].IsEqualString(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>)) {
00741             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_SETCURSEL, <span class="keywordtype">id</span>, 0);
00742         }
00743     }
00744 
00745     <span class="comment">//  Set Monitor profile if specified</span>
00746 
00747     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>()) {
00748         <a class="code" href="../../d1/d7/classCString.html">CString</a> csWork;
00749         csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a24">NoProfileString</a>);
00750 
00751         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_ADDSTRING, 0, csWork);
00752         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_SETITEMDATA, 0, -1);
00753         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r21">m_hwndMonitorList</a>, CB_SETCURSEL, 0, 0);
00754     }
00755 
00756     <span class="comment">//  Printer Profiles</span>
00757 
00758     <span class="comment">//  03-20-1997  Bob_Kjelgaard@Prodigy.Net   RAID Memphis:22290</span>
00759     <span class="comment">//  If there's no printer, then we should disable all of the related</span>
00760     <span class="comment">//  controls.</span>
00761 
00762     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>()) {
00763         csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a25">NoPrintersInstalled</a>);
00764     } <span class="keywordflow">else</span> {
00765         csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a84">PrinterProfileLabel</a>));
00766         csWork = csWork + <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a> + _TEXT(<span class="stringliteral">")"</span>);
00767     }
00768 
00769     <a class="code" href="../../d5/d9/cltxt_8h.html#a20">SetDlgItemText</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a84">PrinterProfileLabel</a>, csWork);
00770 
00771     <span class="keywordflow">for</span> (u = 0; u &lt; <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>(); u++) {
00772         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r33">m_bUseProfileDescription</a>) {
00773             <span class="keywordtype">id</span> = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_ADDSTRING,
00774                              0, (LPARAM)((LPTSTR) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r15">m_csaPrinterDesc</a>[u]));
00775         } <span class="keywordflow">else</span> {
00776             <span class="keywordtype">id</span> = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_ADDSTRING,
00777                              0, <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>[u].NameOnly());
00778         }
00779         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_SETITEMDATA, <span class="keywordtype">id</span>, u);
00780 
00781         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>[u].IsEqualString(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>)) {
00782             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_SETCURSEL, <span class="keywordtype">id</span>, 0);
00783         }
00784     }
00785 
00786     <span class="comment">//  Set Printer profile if specified</span>
00787 
00788     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>()) {
00789         <a class="code" href="../../d1/d7/classCString.html">CString</a> csWork;
00790 
00791         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r6">m_csPrinter</a>.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>() &amp;&amp; !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r3">m_bColorPrinter</a>) {
00792             <span class="comment">// Printer are specified, but it is not color printer.</span>
00793             csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a27">NotColorPrinter</a>);
00794         } <span class="keywordflow">else</span> {
00795             csWork.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a24">NoProfileString</a>);
00796         }
00797 
00798         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_ADDSTRING, 0, csWork);
00799         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_SETITEMDATA, 0, -1);
00800         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r22">m_hwndPrinterList</a>, CB_SETCURSEL, 0, 0);
00801     }
00802 
00803     <span class="comment">//  End RAID Memphis:22213, 22289, 22290 03-20-1997</span>
00804 
00805     <span class="comment">//  If Apply callback does not provided, disable apply button.</span>
00806 
00807     <span class="keywordflow">if</span>  (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00808         RECT  rcApply, rcCancel;
00809         POINT ptApply, ptCancel;
00810 
00811         <span class="comment">// Get current "Apply" and "Cancel" buttom position</span>
00812 
00813         <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a78">ApplyButton</a>), &amp;rcApply);
00814         <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, IDCANCEL), &amp;rcCancel);
00815 
00816         <span class="comment">// Convert the buttom coordinate to parent dialog coord from screen coord.</span>
00817 
00818         ptApply.x = rcApply.left;   ptApply.y = rcApply.top;
00819         ptCancel.x = rcCancel.left; ptCancel.y = rcCancel.top;
00820 
00821         <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(m_hwnd,&amp;ptApply);
00822         <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(m_hwnd,&amp;ptCancel);
00823 
00824         <span class="comment">// Move "Apply" button away... and shift "Cancel" and "OK"</span>
00825 
00826         MoveWindow(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a78">ApplyButton</a>),0,0,0,0,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00827         MoveWindow(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, IDCANCEL),
00828                    ptApply.x,ptApply.y,
00829                    rcApply.right - rcApply.left,
00830                    rcApply.bottom - rcApply.top,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00831         MoveWindow(<a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(m_hwnd, IDOK),
00832                    ptCancel.x,ptCancel.y,
00833                    rcCancel.right - rcCancel.left,
00834                    rcCancel.bottom - rcCancel.top,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00835     }
00836 
00837     <span class="comment">//  Enable/Disable controls based upon settings</span>
00838 
00839     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">UpdateControls</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00840 
00841     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">//  Because we've probably moved it...</span>
00842 }
00843 
00844 <span class="comment">//  Command Processing override</span>
00845 
<a name="l00846"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a5">00846</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a5">CColorMatchDialog::OnCommand</a>(WORD wNotifyCode, WORD wid, HWND hwndCtl) {
00847 
00848     <span class="keywordflow">switch</span>  (wNotifyCode) {
00849 
00850         <span class="keywordflow">case</span>    BN_CLICKED:
00851 
00852             <span class="keywordflow">switch</span>  (wid) {
00853 
00854                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a80">EnableICM</a>:
00855                     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a> = !<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r1">m_bEnableICM</a>;
00856                     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">UpdateControls</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00857                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00858 
00859                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a81">EnableBasic</a>:
00860 
00861                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a>)
00862                     {
00863                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00864 
00865                         <span class="comment">// Copy proof intent to rendering intent</span>
00866                         <span class="comment">//</span>
00867                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>;
00868 
00869                         <span class="comment">// Update UI</span>
00870                         <span class="comment">//</span>
00871                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, CB_SETCURSEL,
00872                             m_dwProofIntent, 0);
00873                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, CB_SETCURSEL,
00874                             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>, 0);
00875                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">UpdateControls</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00876                     }
00877                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00878 
00879                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a82">EnableProofing</a>:
00880 
00881                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
00882                     {
00883                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00884 
00885                         <span class="comment">//  Copy the original rendering intent to the proofing</span>
00886                         <span class="comment">//  intent, and set original to Absolute Colorimetric</span>
00887 
00888                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a>;
00889                         m_dwRenderIntent = INTENT_ABSOLUTE_COLORIMETRIC;
00890 
00891                         <span class="comment">// Update UI</span>
00892                         <span class="comment">//</span>
00893                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, CB_SETCURSEL,
00894                             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>, 0);
00895                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r19">m_hwndRenderIntent</a>, CB_SETCURSEL,
00896                             m_dwRenderIntent, 0);
00897                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d3">UpdateControls</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00898                     }
00899                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00900 
00901                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a78">ApplyButton</a>: {
00902 
00903                     <span class="comment">// Disable apply button</span>
00904 
00905                     <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00906 
00907                     <span class="comment">// Callback supplied function</span>
00908 
00909                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a>) {
00910 
00911                         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r32">m_bAnsiCall</a>) {
00912                             PCOLORMATCHSETUPA pcms = (PCOLORMATCHSETUPA) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r36">m_pvCMS</a>;
00913 
00914                             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">FillStructure</a>(pcms);
00915                             (*(PCMSCALLBACKA)<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a>)(pcms,<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r31">m_lpApplyCallback</a>);
00916                         } <span class="keywordflow">else</span> {
00917                             PCOLORMATCHSETUPW pcms = (PCOLORMATCHSETUPW) <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r36">m_pvCMS</a>;
00918 
00919                             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d4">FillStructure</a>(pcms);
00920                             (*(PCMSCALLBACKW)<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r30">m_dpApplyCallback</a>)(pcms,<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r31">m_lpApplyCallback</a>);
00921                         }
00922                     }
00923 
00924                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00925                 }
00926             }
00927 
00928             <span class="keywordflow">break</span>;
00929 
00930         <span class="keywordflow">case</span>    CBN_SELCHANGE: {
00931 
00932             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idItem = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndCtl, CB_GETCURSEL, 0, 0);
00933             <span class="keywordtype">unsigned</span> uItem = (<span class="keywordtype">unsigned</span>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndCtl, CB_GETITEMDATA, idItem, 0);
00934 
00935             <span class="keywordflow">switch</span>  (wid) {
00936 
00937                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a92">RenderingIntent</a>:
00938 
00939                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a> != idItem)
00940                     {
00941                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r17">m_dwRenderIntent</a> = idItem;
00942 
00943                         <span class="comment">// If proofing is disabled, proof intent follows</span>
00944                         <span class="comment">// render intent</span>
00945 
00946                         <span class="keywordflow">if</span> (! <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r2">m_bEnableProofing</a>)
00947                         {
00948                             <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a> = idItem;
00949                             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r20">m_hwndTargetIntent</a>, CB_SETCURSEL,
00950                                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a>, 0);
00951                         }
00952 
00953                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>();
00954                     }
00955 
00956                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00957 
00958                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a94">TargetIntent</a>:
00959 
00960                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a> != idItem)
00961                     {
00962                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r18">m_dwProofIntent</a> = idItem;
00963 
00964                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>();
00965                     }
00966 
00967                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00968 
00969                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a93">TargetProfile</a>:
00970 
00971                     <span class="comment">//  If there are no installed profiles, don't bother</span>
00972 
00973                     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00974                         <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00975 
00976                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a19">IsEqualString</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>[uItem]) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
00977                     {
00978                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r9">m_csTargetProfile</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r13">m_csaTarget</a>[uItem];
00979 
00980                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>();
00981                     }
00982 
00983                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00984 
00985                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a90">MonitorProfile</a>:
00986 
00987                     <span class="comment">//  If there are no installed profiles, don't bother</span>
00988 
00989                     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
00990                         <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00991 
00992                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a19">IsEqualString</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>[uItem]) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
00993                     {
00994                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r7">m_csMonitorProfile</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r11">m_csaMonitor</a>[uItem];
00995 
00996                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>();
00997                     }
00998 
00999                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01000 
01001                 <span class="keywordflow">case</span>    <a class="code" href="../../d2/d9/ntgdi_2icm_2icmui_2resource_8h.html#a91">PrinterProfile</a>:
01002 
01003                     <span class="comment">//  If there are no installed profiles, don't bother</span>
01004 
01005                     <span class="keywordflow">if</span>  (!<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>.<a class="code" href="../../d2/d7/classCStringArray.html#a2">Count</a>())
01006                         <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01007 
01008                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a>.<a class="code" href="../../d1/d7/classCString.html#a19">IsEqualString</a>(<a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>[uItem]) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
01009                     {
01010                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r8">m_csPrinterProfile</a> = <a class="code" href="../../d9/d1/classCColorMatchDialog.html#r12">m_csaPrinter</a>[uItem];
01011 
01012                         <a class="code" href="../../d9/d1/classCColorMatchDialog.html#d6">EnableApplyButton</a>();
01013                     }
01014 
01015                     <span class="keywordflow">return</span>  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01016             }
01017 
01018         }
01019 
01020     }
01021 
01022     <span class="comment">//  Pass anything we didn't handle above to the base class</span>
01023 
01024     <span class="keywordflow">return</span>  CDialog::OnCommand(wNotifyCode, wid, hwndCtl);
01025 
01026 }
01027 
01028 <span class="comment">//  Context-sensitive help handler</span>
01029 
<a name="l01030"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a6">01030</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a6">CColorMatchDialog::OnHelp</a>(LPHELPINFO pHelp) {
01031 
01032     <span class="keywordflow">if</span> (pHelp-&gt;iContextType == HELPINFO_WINDOW) {
01033         WinHelp((HWND) pHelp-&gt;hItemHandle, <a class="code" href="../../d3/d9/icmuihlp_8h.html#a0">WINDOWS_HELP_FILE</a>,
01034                 HELP_WM_HELP, (ULONG_PTR) (LPSTR) <a class="code" href="../../d7/d8/appui_8cpp.html#a1">ApplicationUIHelpIds</a>);
01035     }
01036 
01037     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01038 }
01039 
<a name="l01040"></a><a class="code" href="../../d9/d1/classCColorMatchDialog.html#a7">01040</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d1/classCColorMatchDialog.html#a7">CColorMatchDialog::OnContextMenu</a>(HWND hwnd) {
01041 
01042     WinHelp(hwnd, <a class="code" href="../../d3/d9/icmuihlp_8h.html#a0">WINDOWS_HELP_FILE</a>,
01043             HELP_CONTEXTMENU, (ULONG_PTR) (LPSTR) <a class="code" href="../../d7/d8/appui_8cpp.html#a1">ApplicationUIHelpIds</a>);
01044 
01045     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01046 }
01047 
01048 <span class="comment">//  This are the real honest-to-goodness API!</span>
01049 
<a name="l01050"></a><a class="code" href="../../d7/d8/appui_8cpp.html#a2">01050</a> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI  <a class="code" href="../../d7/d8/appui_8cpp.html#a2">SetupColorMatchingA</a>(PCOLORMATCHSETUPA pcms) {
01051 
01052     <a class="code" href="../../d9/d1/classCColorMatchDialog.html">CColorMatchDialog</a>   ccmd(pcms);
01053 
01054     <span class="keywordflow">return</span>  ccmd.<a class="code" href="../../d9/d1/classCColorMatchDialog.html#a3">Results</a>();
01055 }
01056 
<a name="l01057"></a><a class="code" href="../../d7/d8/appui_8cpp.html#a3">01057</a> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI  <a class="code" href="../../d7/d8/appui_8cpp.html#a3">SetupColorMatchingW</a>(PCOLORMATCHSETUPW pcms) {
01058 
01059     <a class="code" href="../../d9/d1/classCColorMatchDialog.html">CColorMatchDialog</a>   ccmd(pcms);
01060 
01061     <span class="keywordflow">return</span>  ccmd.<a class="code" href="../../d9/d1/classCColorMatchDialog.html#a3">Results</a>();
01062 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:16 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
