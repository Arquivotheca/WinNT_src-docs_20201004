<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kbd.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kbd.c</h1><a href="../../d7/d8/kbd_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\,</span>
00002 <span class="comment">* Module Name: kbd.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* OEM-specific tables and routines for IBM Extended 101/102 style keyboards</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 30-04-91 IanJa       Created.</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 
00016 <span class="comment">/***************************************************************************\</span>
00017 <span class="comment">* aVkToVsc[] - table associating Virtual Key codes with Virtual Scancodes</span>
00018 <span class="comment">*</span>
00019 <span class="comment">* Ordered, 0-terminated.</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* This is used for those Virtual Keys that do not appear in ausVK_???[]</span>
00022 <span class="comment">* These are not the base Virtual Keys.  They require some modifier key</span>
00023 <span class="comment">* depression (CTRL, ALT, SHIFT) or NumLock On to be generated.</span>
00024 <span class="comment">*</span>
00025 <span class="comment">* All the scancodes listed below should be marked KBDMULTIVK or KBDNUMPAD in</span>
00026 <span class="comment">* ausVK_???[].</span>
00027 <span class="comment">*</span>
00028 <span class="comment">* This table is used by MapVirtualKey(wVk, 0).</span>
00029 <span class="comment">\***************************************************************************/</span>
<a name="l00030"></a><a class="code" href="../../d7/d8/kbd_8c.html#a1">00030</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d7/d8/kbd_8c.html#a1">aVkNumpad</a>[] = {
00031     VK_NUMPAD7,  VK_NUMPAD8,  VK_NUMPAD9, 0xFF, <span class="comment">// 0x47 0x48 0x49 (0x4A)</span>
00032     VK_NUMPAD4,  VK_NUMPAD5,  VK_NUMPAD6, 0xFF, <span class="comment">// 0x4B 0x4C 0x4D (0x4E)</span>
00033     VK_NUMPAD1,  VK_NUMPAD2,  VK_NUMPAD3,       <span class="comment">// 0x4F 0x50 0x51</span>
00034     VK_NUMPAD0,  VK_DECIMAL,  0                 <span class="comment">// 0x50 0x51</span>
00035 };
00036 
00037 <span class="comment">/***************************************************************************\</span>
00038 <span class="comment">* How some Virtual Key values change when a SHIFT key is held down.</span>
00039 <span class="comment">\***************************************************************************/</span>
<a name="l00040"></a><a class="code" href="../../d7/d8/kbd_8c.html#a2">00040</a> ULONG <a class="code" href="../../d7/d8/kbd_8c.html#a2">aulShiftCvt_VK</a>[] = {
00041     MAKELONG(VK_MULTIPLY, VK_SNAPSHOT),
00042     MAKELONG(0,0)
00043 };
00044 
00045 <span class="comment">// JPN IMB02</span>
<a name="l00046"></a><a class="code" href="../../d7/d8/kbd_8c.html#a3">00046</a> ULONG <a class="code" href="../../d7/d8/kbd_8c.html#a3">aulShiftControlCvt_VK_IBM02</a>[] = {
00047     MAKELONG(VK_SCROLL, VK_CANCEL | KBDEXT),
00048     MAKELONG(VK_NUMLOCK, VK_PAUSE | KBDEXT),
00049     MAKELONG(0,0)
00050 };
00051 
00052 <span class="comment">/***************************************************************************\</span>
00053 <span class="comment">* How some Virtual Key values change when a CONTROL key is held down.</span>
00054 <span class="comment">\***************************************************************************/</span>
<a name="l00055"></a><a class="code" href="../../d7/d8/kbd_8c.html#a4">00055</a> ULONG <a class="code" href="../../d7/d8/kbd_8c.html#a4">aulControlCvt_VK</a>[] = {
00056     MAKELONG(VK_NUMLOCK,  VK_PAUSE | KBDEXT),
00057     MAKELONG(VK_SCROLL,   VK_CANCEL),
00058     MAKELONG(0,0)
00059 };
00060 
00061 <span class="comment">// JPN IBM02</span>
<a name="l00062"></a><a class="code" href="../../d7/d8/kbd_8c.html#a5">00062</a> ULONG <a class="code" href="../../d7/d8/kbd_8c.html#a5">aulControlCvt_VK_IBM02</a>[] = {
00063     MAKELONG(VK_PAUSE, VK_CANCEL | KBDEXT),
00064     MAKELONG(VK_SCROLL, VK_CANCEL | KBDEXT),
00065     MAKELONG(0,0)
00066 };
00067 
00068 <span class="comment">/***************************************************************************\</span>
00069 <span class="comment">* How some Virtual Key values change when an ALT key is held down.</span>
00070 <span class="comment">* The SHIFT and ALT keys both alter VK values the same way!!</span>
00071 <span class="comment">\***************************************************************************/</span>
<a name="l00072"></a><a class="code" href="../../d7/d8/kbd_8c.html#a0">00072</a> <span class="preprocessor">#define aulAltCvt_VK aulShiftCvt_VK</span>
00073 <span class="preprocessor"></span>
00074 
00075 <span class="comment">/***************************************************************************\</span>
00076 <span class="comment">* This table list keys that may affect Virtual Key values when held down.</span>
00077 <span class="comment">*</span>
00078 <span class="comment">* See kbd.h for a full description.</span>
00079 <span class="comment">*</span>
00080 <span class="comment">* 101/102key keyboard (type 4):</span>
00081 <span class="comment">*    Virtual Key values vary only if CTRL is held down.</span>
00082 <span class="comment">* 84-86 key keyboards (type 3):</span>
00083 <span class="comment">*    Virtual Key values vary if one of SHIFT, CTRL or ALT is held down.</span>
00084 <span class="comment">\***************************************************************************/</span>
00085 
<a name="l00086"></a><a class="code" href="../../d7/d8/kbd_8c.html#a6">00086</a> VK_TO_BIT <a class="code" href="../../d7/d8/kbd_8c.html#a6">aVkToBits_VK</a>[] = {
00087     { VK_SHIFT,   KBDSHIFT }, <span class="comment">// 0x01</span>
00088     { VK_CONTROL, KBDCTRL  }, <span class="comment">// 0x02</span>
00089     { VK_MENU,    KBDALT   }, <span class="comment">// 0x04</span>
00090     { 0,          0        }
00091 };
00092 
00093 <span class="comment">// JPN IBM02</span>
<a name="l00094"></a><a class="code" href="../../d7/d8/kbd_8c.html#a7">00094</a> VK_TO_BIT <a class="code" href="../../d7/d8/kbd_8c.html#a7">aVkToBits_VK_IBM02</a>[] = {
00095     { VK_SHIFT,   KBDSHIFT }, <span class="comment">// 0x01</span>
00096     { VK_CONTROL, KBDCTRL  }, <span class="comment">// 0x02</span>
00097     { 0,          0        }
00098 };
00099 
00100 <span class="comment">/***************************************************************************\</span>
00101 <span class="comment">* Tables defining how some Virtual Key values are modified when other keys</span>
00102 <span class="comment">* are held down.</span>
00103 <span class="comment">* Translates key combinations into indices for gapulCvt_VK_101[] or for</span>
00104 <span class="comment">* gapulCvt_VK_84[] or for</span>
00105 <span class="comment">*</span>
00106 <span class="comment">* See kbd.h for a full description.</span>
00107 <span class="comment">*</span>
00108 <span class="comment">\***************************************************************************/</span>
00109 
<a name="l00110"></a><a class="code" href="../../d7/d8/kbd_8c.html#a8">00110</a> MODIFIERS <a class="code" href="../../d7/d8/kbd_8c.html#a8">Modifiers_VK_STANDARD</a> = {
00111     &amp;<a class="code" href="../../d7/d8/kbd_8c.html#a6">aVkToBits_VK</a>[0],
00112     4,                 <span class="comment">// Maximum modifier bitmask/index</span>
00113     {
00114         SHFT_INVALID,  <span class="comment">// no keys held down    (no VKs are modified)</span>
00115         0,             <span class="comment">// SHIFT held down      84-86 key kbd</span>
00116         1,             <span class="comment">// CTRL held down       101/102 key kbd</span>
00117         SHFT_INVALID,  <span class="comment">// CTRL-SHIFT held down (no VKs are modified)</span>
00118         2              <span class="comment">// ALT held down        84-86 key kbd</span>
00119     }
00120 };
00121 
<a name="l00122"></a><a class="code" href="../../d7/d8/kbd_8c.html#a9">00122</a> MODIFIERS <a class="code" href="../../d7/d8/kbd_8c.html#a9">Modifiers_VK_IBM02</a> = {
00123     &amp;<a class="code" href="../../d7/d8/kbd_8c.html#a7">aVkToBits_VK_IBM02</a>[0],
00124     3,                   <span class="comment">// Maximum modifier bitmask/index</span>
00125     {
00126         SHFT_INVALID,  <span class="comment">// no modifier keys (no VK modification)</span>
00127         SHFT_INVALID,  <span class="comment">// Shift            (no VK modification)</span>
00128         0,             <span class="comment">// Control          (VK modification number 0)</span>
00129         1              <span class="comment">// Control Shift    (VK modification number 1)</span>
00130     }
00131 };
00132 
00133 <span class="comment">/***************************************************************************\</span>
00134 <span class="comment">* A tables of pointers indexed by the number obtained from Modify_VK.</span>
00135 <span class="comment">* If a pointer is non-NULL then the table it points to is searched for</span>
00136 <span class="comment">* Virtual Key that should have their values changed.</span>
00137 <span class="comment">* There are two versions: one for 84-86 key kbds, one for 101/102 key kbds.</span>
00138 <span class="comment">* gapulCvt_VK is initialized with the default (101/102 key kbd).</span>
00139 <span class="comment">\***************************************************************************/</span>
<a name="l00140"></a><a class="code" href="../../d7/d8/kbd_8c.html#a10">00140</a> ULONG *<a class="code" href="../../d7/d8/kbd_8c.html#a10">gapulCvt_VK_101</a>[] = {
00141     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,                 <span class="comment">// No VKs are changed by SHIFT being held down</span>
00142     <a class="code" href="../../d7/d8/kbd_8c.html#a4">aulControlCvt_VK</a>,     <span class="comment">// Some VKs are changed by CTRL being held down</span>
00143     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                  <span class="comment">// No VKs are changed by ALT being held down</span>
00144 };
00145 
<a name="l00146"></a><a class="code" href="../../d7/d8/kbd_8c.html#a11">00146</a> ULONG *<a class="code" href="../../d7/d8/kbd_8c.html#a11">gapulCvt_VK_84</a>[] = {
00147     <a class="code" href="../../d7/d8/kbd_8c.html#a2">aulShiftCvt_VK</a>,       <span class="comment">// Some VKs are changed by SHIFT being held down</span>
00148     <a class="code" href="../../d7/d8/kbd_8c.html#a4">aulControlCvt_VK</a>,     <span class="comment">// Some VKs are changed by CTRL being held down</span>
00149     <a class="code" href="../../d7/d8/kbd_8c.html#a0">aulAltCvt_VK</a>          <span class="comment">// Some VKs are changed by ALT being held down</span>
00150 };
00151 
<a name="l00152"></a><a class="code" href="../../d7/d8/kbd_8c.html#a12">00152</a> ULONG *<a class="code" href="../../d7/d8/kbd_8c.html#a12">gapulCvt_VK_IBM02</a>[] = {
00153     <a class="code" href="../../d7/d8/kbd_8c.html#a5">aulControlCvt_VK_IBM02</a>,     <span class="comment">// VK modification number 0 (Control key)</span>
00154     <a class="code" href="../../d7/d8/kbd_8c.html#a3">aulShiftControlCvt_VK_IBM02</a>,<span class="comment">// VK modification number 1 (Shift Control key)</span>
00155 };
00156 
<a name="l00157"></a><a class="code" href="../../d7/d8/kbd_8c.html#a13">00157</a> PULONG *<a class="code" href="../../d7/d8/kbd_8c.html#a13">gapulCvt_VK</a> = <a class="code" href="../../d7/d8/kbd_8c.html#a10">gapulCvt_VK_101</a>;
00158 
<a name="l00159"></a><a class="code" href="../../d7/d8/kbd_8c.html#a14">00159</a> PMODIFIERS <a class="code" href="../../d7/d8/kbd_8c.html#a14">gpModifiers_VK</a> = &amp;<a class="code" href="../../d7/d8/kbd_8c.html#a8">Modifiers_VK_STANDARD</a>;
00160 
00161 <span class="comment">/***************************************************************************\</span>
00162 <span class="comment">* The table ausNumPadCvt is used to convert a cursor movement</span>
00163 <span class="comment">* virtual key value (obtained from ausVK_???[]) into a VK_NUMPAD</span>
00164 <span class="comment">* virtual key value.  This translation is done when NumLock is</span>
00165 <span class="comment">* on and no shift keys are pressed.</span>
00166 <span class="comment">\***************************************************************************/</span>
<a name="l00167"></a><a class="code" href="../../d7/d8/kbd_8c.html#a15">00167</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a74">ausNumPadCvt</a>[] =
00168 {
00169     MAKEWORD(VK_INSERT, VK_NUMPAD0),
00170     MAKEWORD(VK_END, VK_NUMPAD1),
00171     MAKEWORD(VK_DOWN, VK_NUMPAD2),
00172     MAKEWORD(VK_NEXT, VK_NUMPAD3),
00173     MAKEWORD(VK_LEFT, VK_NUMPAD4),
00174     MAKEWORD(VK_CLEAR, VK_NUMPAD5),
00175     MAKEWORD(VK_RIGHT, VK_NUMPAD6),
00176     MAKEWORD(VK_HOME, VK_NUMPAD7),
00177     MAKEWORD(VK_UP, VK_NUMPAD8),
00178     MAKEWORD(VK_PRIOR, VK_NUMPAD9),
00179     MAKEWORD(VK_DELETE, VK_DECIMAL),
00180     MAKEWORD(0, 0)
00181 };
00182 
00183 <span class="comment">/***************************************************************************\</span>
00184 <span class="comment">* xxxNumpadCursor() - handle special case Numpad Cursor-movement Keys</span>
00185 <span class="comment">*</span>
00186 <span class="comment">* If NumLock is on, and Shift is up then:</span>
00187 <span class="comment">*      VK_INSERT  -&gt; VK_NUMPAD0</span>
00188 <span class="comment">*      VK_END     -&gt; VK_NUMPAD1</span>
00189 <span class="comment">*      VK_DOWN    -&gt; VK_NUMPAD2</span>
00190 <span class="comment">*      VK_NEXT    -&gt; VK_NUMPAD3</span>
00191 <span class="comment">*      VK_LEFT    -&gt; VK_NUMPAD4</span>
00192 <span class="comment">*      VK_CLEAR   -&gt; VK_NUMPAD5</span>
00193 <span class="comment">*      VK_RIGHT   -&gt; VK_NUMPAD6</span>
00194 <span class="comment">*      VK_HOME    -&gt; VK_NUMPAD7</span>
00195 <span class="comment">*      VK_UP      -&gt; VK_NUMPAD8</span>
00196 <span class="comment">*      VK_PRIOR   -&gt; VK_NUMPAD9</span>
00197 <span class="comment">*      VK_DELETE  -&gt; VK_DECIMAL (unless CTRL-ALT-DEL)</span>
00198 <span class="comment">* If Numlock is on, and Shift is down then precede first Numpad Cursor key</span>
00199 <span class="comment">* going down with a fake Shift key coming up &amp; follow the Numpad Cursor key</span>
00200 <span class="comment">* coming up with with a fake Shift key going down.</span>
00201 <span class="comment">*</span>
00202 <span class="comment">* Return value:</span>
00203 <span class="comment">*   TRUE: keep this routine active: continue passing Key Events through here</span>
00204 <span class="comment">*  FALSE: deactivet this routine: stop sending Key Events through here.</span>
00205 <span class="comment">*</span>
00206 <span class="comment">* This function will leave the critical section only if low level hooks</span>
00207 <span class="comment">* are installed and the call to xxxKeyEvent is made</span>
00208 <span class="comment">*</span>
00209 <span class="comment">\***************************************************************************/</span>
00210 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00211"></a><a class="code" href="../../d7/d8/kbd_8c.html#a17">00211</a> <a class="code" href="../../d7/d8/kbd_8c.html#a17">xxxNumpadCursor</a>(
00212     PKE pKe)
00213 {
00214     <span class="keyword">static</span> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bLastNumpadCursor = 0;
00215     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> VkFakedShiftUp;  <span class="comment">// VK_LSHIFT or VK_RSHIFT</span>
00216     <span class="keyword">static</span> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> VscFakedShiftUp;   <span class="comment">// 0x2A or 0x36 resp.</span>
00217     <span class="keywordtype">int</span> i;
00218 
00219     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00220 
00221     <span class="keywordflow">if</span> (bLastNumpadCursor) {
00222         <span class="keywordflow">if</span> (bLastNumpadCursor == (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(pKe-&gt;usFlaggedVk)) {
00223             <span class="comment">/*</span>
00224 <span class="comment">             * Same key as last one: if coming up, or going down?</span>
00225 <span class="comment">             */</span>
00226             <span class="keywordflow">if</span> (pKe-&gt;usFlaggedVk &amp; KBDBREAK) {
00227                 <span class="comment">/*</span>
00228 <span class="comment">                 * Numpad Cursor key came back up. Send this key now, and make</span>
00229 <span class="comment">                 * sure that the Shift key will then appear to go back down</span>
00230 <span class="comment">                 * again.</span>
00231 <span class="comment">                 */</span>
00232                 <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(pKe-&gt;usFlaggedVk, pKe-&gt;bScanCode,
00233                             pKe-&gt;dwTime, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00234                 bLastNumpadCursor = 0;
00235                 pKe-&gt;usFlaggedVk = VkFakedShiftUp;
00236                 pKe-&gt;bScanCode = VscFakedShiftUp;
00237             }
00238             <span class="comment">/*</span>
00239 <span class="comment">             * Going down: this key is repeating, so just pass it on</span>
00240 <span class="comment">             * unaltered and keep the KEProc active</span>
00241 <span class="comment">             */</span>
00242             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00243         } <span class="keywordflow">else</span> {
00244             <span class="comment">/*</span>
00245 <span class="comment">             * It is a different key.  Fake the Shift key back down again,</span>
00246 <span class="comment">             * and continue (it may be another Numpad Cursor key)</span>
00247 <span class="comment">             */</span>
00248             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VkFakedShiftUp,
00249                     (WORD)(VscFakedShiftUp | SCANCODE_SIMULATED),
00250                      pKe-&gt;dwTime, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00251             bLastNumpadCursor = 0;
00252         }
00253     }
00254 
00255     <span class="keywordflow">if</span> (pKe-&gt;usFlaggedVk &amp; KBDNUMPAD) {
00256 
00257         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fsModifiers;
00258         <span class="comment">/*</span>
00259 <span class="comment">         * This is the numeric pad.</span>
00260 <span class="comment">         * Here, if NumLock is set, we change the virtual keycodes to</span>
00261 <span class="comment">         * numeric VK_NUMPAD codes, so the keys will be translated</span>
00262 <span class="comment">         * as numbers etc.  But if a shift key is down, we handle</span>
00263 <span class="comment">         * these as cursor keys, but we need to make sure that these</span>
00264 <span class="comment">         * are seen as UNSHIFTED</span>
00265 <span class="comment">         */</span>
00266 
00267         <span class="comment">/*</span>
00268 <span class="comment">         * Check for SAS.</span>
00269 <span class="comment">         */</span>
00270         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1260">IsSAS</a>((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(pKe-&gt;usFlaggedVk), &amp;fsModifiers)) {
00271             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00272         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a582">TestRawKeyToggle</a>(VK_NUMLOCK)) {
00273             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a579">TestRawKeyDown</a>(VK_SHIFT)) {
00274                 <span class="comment">/*</span>
00275 <span class="comment">                 * key is down (bit(s) set in BIOS key state), so we are going</span>
00276 <span class="comment">                 * to keep this as a cursor key.  To do this, we need to</span>
00277 <span class="comment">                 * make sure that Windows' state vector entry for VK_SHIFT is</span>
00278 <span class="comment">                 * OFF even though a shift key is actually down.</span>
00279 <span class="comment">                 */</span>
00280                 bLastNumpadCursor = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(pKe-&gt;usFlaggedVk);
00281                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a579">TestRawKeyDown</a>(VK_RSHIFT)) {
00282                     VkFakedShiftUp = VK_RSHIFT | KBDEXT;
00283                     VscFakedShiftUp = 0x36;
00284                 } <span class="keywordflow">else</span> {
00285                     VkFakedShiftUp = VK_LSHIFT;
00286                     VscFakedShiftUp = 0x2A;
00287                 }
00288                 <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(VkFakedShiftUp | KBDBREAK),
00289                         (WORD)(VscFakedShiftUp | SCANCODE_SIMULATED),
00290                          pKe-&gt;dwTime, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00291                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00292             }
00293 
00294             <span class="comment">/*</span>
00295 <span class="comment">             * NumLock ON but Shift key up: Alter the Virtual Key event,</span>
00296 <span class="comment">             * but not for injected virtual keys.</span>
00297 <span class="comment">             */</span>
00298             <span class="keywordflow">if</span> ((pKe-&gt;usFlaggedVk &amp; KBDINJECTEDVK) == 0) {
00299                 <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a74">ausNumPadCvt</a>[i] != 0; i++) {
00300                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a74">ausNumPadCvt</a>[i]) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pKe-&gt;usFlaggedVk)) {
00301                         <span class="comment">/*</span>
00302 <span class="comment">                         * keep extra bits, but change VK value</span>
00303 <span class="comment">                         */</span>
00304                         pKe-&gt;usFlaggedVk &amp;= ~0xFF;
00305                         pKe-&gt;usFlaggedVk |= (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a74">ausNumPadCvt</a>[i]));
00306                         <span class="keywordflow">break</span>;
00307 
00308                     }
00309                 }
00310             }
00311         }
00312     }
00313     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00314 }
00315 
00316 <span class="comment">/***************************************************************************\</span>
00317 <span class="comment">*</span>
00318 <span class="comment">* xxxICO_00() - handle special case '00' key</span>
00319 <span class="comment">*</span>
00320 <span class="comment">* LATER IanJa: should only be in ICO OEM file for kbd with '00' key</span>
00321 <span class="comment">*</span>
00322 <span class="comment">* This function will leave the critical section only if low level hooks</span>
00323 <span class="comment">* are installed ant the call to xxxKeyEvent is made</span>
00324 <span class="comment">*</span>
00325 <span class="comment">\***************************************************************************/</span>
00326 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00327"></a><a class="code" href="../../d7/d8/kbd_8c.html#a18">00327</a> <a class="code" href="../../d7/d8/kbd_8c.html#a18">xxxICO_00</a>(
00328     PKE pKe)
00329 {
00330     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00331 
00332     <span class="keywordflow">if</span> ((pKe-&gt;usFlaggedVk &amp; 0xFF) != VK_ICO_00) {
00333         <span class="comment">/*</span>
00334 <span class="comment">         * Pass the keystroke on unaltered</span>
00335 <span class="comment">         */</span>
00336         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00337     }
00338 
00339     <span class="keywordflow">if</span> (pKe-&gt;usFlaggedVk &amp; KBDBREAK) {
00340         <span class="comment">/*</span>
00341 <span class="comment">         * '0' key comes up</span>
00342 <span class="comment">         */</span>
00343         pKe-&gt;usFlaggedVk = <span class="charliteral">'0'</span> | KBDEXT | KBDBREAK;
00344     } <span class="keywordflow">else</span> {
00345         <span class="comment">/*</span>
00346 <span class="comment">         * '0' down, up, down</span>
00347 <span class="comment">         */</span>
00348         <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(<span class="charliteral">'0'</span>, pKe-&gt;bScanCode, pKe-&gt;dwTime, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00349         <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(<span class="charliteral">'0'</span> | KBDBREAK, pKe-&gt;bScanCode, pKe-&gt;dwTime, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00350         pKe-&gt;usFlaggedVk = <span class="charliteral">'0'</span> | KBDEXT;
00351     }
00352 
00353     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00354 }
00355 
<a name="l00356"></a><a class="code" href="../../d7/d8/kbd_8c.html#a16">00356</a> KEPROC <a class="code" href="../../d7/d8/kbd_8c.html#a16">aKEProcOEM</a>[] = {
00357     <a class="code" href="../../d7/d8/kbd_8c.html#a18">xxxICO_00</a>,       <span class="comment">// Bitmask 0x01</span>
00358     <a class="code" href="../../d7/d8/kbd_8c.html#a17">xxxNumpadCursor</a>, <span class="comment">// Bitmask 0x02</span>
00359     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00360 };
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
