<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: obsdata.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>obsdata.c File Reference</h1><code>#include "<a class="el" href="../../d6/d0/obp_8h-source.html">obp.h</a>"</code><br>

<p>
<a href="../../d9/d0/obsdata_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a0">IF_OB_GLOBAL</a>(FlagName)&nbsp;&nbsp;&nbsp;if (FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>(FlagName, _Text_)&nbsp;&nbsp;&nbsp;;</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a2">OBS_DEBUG_ALLOC_TRACKING</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000001L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a3">OBS_DEBUG_CACHE_FREES</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000002L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a4">OBS_DEBUG_BREAK_ON_INIT</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000004L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a5">OBS_DEBUG_SHOW_COLLISIONS</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000008L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a6">OBS_DEBUG_SHOW_STATISTICS</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000010L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a7">OBS_DEBUG_SHOW_REFERENCES</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000020L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a8">OBS_DEBUG_SHOW_DEASSIGN</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000040L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a9">OBS_DEBUG_STOP_INVALID_DESCRIPTOR</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000080L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a10">OBS_DEBUG_SHOW_HEADER_FREE</a>&nbsp;&nbsp;&nbsp;((ULONG) 0x00000100L)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a13">ObpInitSecurityDescriptorCache</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a14">ObpHashSecurityDescriptor</a> (PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a15">ObpHashBuffer</a> (PVOID Data, ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a16">ObpLogSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR InputSecurityDescriptor, OUT PSECURITY_DESCRIPTOR *OutputSecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a17">ObpCreateCacheEntry</a> (PSECURITY_DESCRIPTOR InputSecurityDescriptor, ULONG FullHash)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a18">ObpReferenceSecurityDescriptor</a> (PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a19">ObDeassignSecurity</a> (IN OUT PSECURITY_DESCRIPTOR *SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a20">ObpDereferenceSecurityDescriptor</a> (PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a21">ObpDestroySecurityDescriptorHeader</a> (IN <a class="el" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> <a class="el" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a22">ObpCompareSecurityDescriptors</a> (IN PSECURITY_DESCRIPTOR SD1, IN PSECURITY_DESCRIPTOR SD2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a23">ObpAcquireDescriptorCacheWriteLock</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a24">ObpAcquireDescriptorCacheReadLock</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PLIST_ENTRY *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d1/obsdata_8c.html#a12">ObsSecurityDescriptorCacheLock</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="obsdata.c::IF_OB_GLOBAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IF_OB_GLOBAL          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FlagName&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;if (FALSE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00058">58</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00118">ObpInitSecurityDescriptorCache()</a>, and <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">ObpReferenceSecurityDescriptor()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="obsdata.c::ObPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ObPrint          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FlagName,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Text_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;;</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00064">64</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00637">ObDeassignSecurity()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">ObpDereferenceSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00759">ObpDestroySecurityDescriptorHeader()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>, and <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">ObpReferenceSecurityDescriptor()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="obsdata.c::OBS_DEBUG_ALLOC_TRACKING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_ALLOC_TRACKING&nbsp;&nbsp;&nbsp;((ULONG) 0x00000001L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00082">82</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="obsdata.c::OBS_DEBUG_BREAK_ON_INIT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_BREAK_ON_INIT&nbsp;&nbsp;&nbsp;((ULONG) 0x00000004L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00084">84</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="obsdata.c::OBS_DEBUG_CACHE_FREES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_CACHE_FREES&nbsp;&nbsp;&nbsp;((ULONG) 0x00000002L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00083">83</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="obsdata.c::OBS_DEBUG_SHOW_COLLISIONS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_SHOW_COLLISIONS&nbsp;&nbsp;&nbsp;((ULONG) 0x00000008L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00085">85</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="obsdata.c::OBS_DEBUG_SHOW_DEASSIGN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_SHOW_DEASSIGN&nbsp;&nbsp;&nbsp;((ULONG) 0x00000040L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00088">88</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="obsdata.c::OBS_DEBUG_SHOW_HEADER_FREE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_SHOW_HEADER_FREE&nbsp;&nbsp;&nbsp;((ULONG) 0x00000100L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00090">90</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="obsdata.c::OBS_DEBUG_SHOW_REFERENCES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_SHOW_REFERENCES&nbsp;&nbsp;&nbsp;((ULONG) 0x00000020L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00087">87</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="obsdata.c::OBS_DEBUG_SHOW_STATISTICS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_SHOW_STATISTICS&nbsp;&nbsp;&nbsp;((ULONG) 0x00000010L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00086">86</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="obsdata.c::OBS_DEBUG_STOP_INVALID_DESCRIPTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBS_DEBUG_STOP_INVALID_DESCRIPTOR&nbsp;&nbsp;&nbsp;((ULONG) 0x00000080L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00089">89</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a19" doxytag="obsdata.c::ObDeassignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObDeassignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00637">637</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d4/d2/dumpuser_8c-source.html#l00048">Header</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00886">ObpAcquireDescriptorCacheWriteLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">ObpDereferenceSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00942">ObpReleaseDescriptorCacheLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00064">ObPrint</a>, and <a class="el" href="../../d6/d0/obp_8h-source.html#l00311">SD_TO_SD_HEADER</a>.
<p>
Referenced by <a class="el" href="../../d1/d5/semethod_8c-source.html#l00920">SepDefaultDeleteMethod()</a>.
<p>
<pre class="fragment"><div>00643                    :
00644 
00645     This routine dereferences <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input security descriptor
00646 
00647 Arguments:
00648 
00649     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor
00650         being modified
00651 
00652 Return Value:
00653 
00654     Only returns STATUS_SUCCESS
00655 
00656 --*/
00657 
00658 {
00659     <a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>;
00660 
00661     <span class="comment">//</span>
00662     <span class="comment">//  Lock the security descriptor cache and get a pointer</span>
00663     <span class="comment">//  to the security descriptor header</span>
00664     <span class="comment">//</span>
00665 
00666     <a class="code" href="../../d8/d1/obsdata_8c.html#a23">ObpAcquireDescriptorCacheWriteLock</a>();
00667 
00668     <span class="comment">//</span>
00669     <span class="comment">//  **** the following diagnostic code should really be done only on</span>
00670     <span class="comment">//  a checked build</span>
00671     <span class="comment">//</span>
00672 
00673     <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> = <a class="code" href="../../d5/d1/obp_8h.html#a18">SD_TO_SD_HEADER</a>( *SecurityDescriptor );
00674     <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_DEASSIGN,(<span class="stringliteral">"Deassigning security descriptor %x, hash = %lX\n"</span>,*SecurityDescriptor, <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;FullHash));
00675 
00676     <span class="comment">//</span>
00677     <span class="comment">//  Call the actual routine to dereference the security descriptor</span>
00678     <span class="comment">//</span>
00679 
00680     <a class="code" href="../../d8/d1/obsdata_8c.html#a20">ObpDereferenceSecurityDescriptor</a>( *SecurityDescriptor );
00681 
00682     <span class="comment">//</span>
00683     <span class="comment">//  NULL out the SecurityDescriptor in the object's</span>
00684     <span class="comment">//  header so we don't try to free it again.</span>
00685     <span class="comment">//</span>
00686 
00687     *SecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00688 
00689     <span class="comment">//</span>
00690     <span class="comment">//  Unlock the security descriptor cache and return to our caller</span>
00691     <span class="comment">//</span>
00692 
00693     <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00694     
00695     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00696 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="obsdata.c::ObpAcquireDescriptorCacheReadLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObpAcquireDescriptorCacheReadLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00914">914</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l02474">ExAcquireResourceShared</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00103">ObsSecurityDescriptorCacheLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01679">ObQuerySecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00920                    :
00921 
00922     Takes a read lock on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor cache.
00923 
00924 Arguments:
00925 
00926     none
00927 
00928 Return Value:
00929 
00930     None.
00931 
00932 --*/
00933 
00934 {
00935     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00936     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>( &amp;ObsSecurityDescriptorCacheLock,TRUE );
00937 
00938     <span class="keywordflow">return</span>;
00939 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="obsdata.c::ObpAcquireDescriptorCacheWriteLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObpAcquireDescriptorCacheWriteLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00886">886</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l02475">ExAcquireResourceExclusive</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00103">ObsSecurityDescriptorCacheLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00637">ObDeassignSecurity()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">ObpDereferenceSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">ObpReferenceSecurityDescriptor()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00892                    :
00893 
00894     Takes a write lock on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor cache.
00895 
00896 Arguments:
00897 
00898     none
00899 
00900 Return Value:
00901 
00902     None.
00903 
00904 --*/
00905 
00906 {
00907     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00908     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>( &amp;ObsSecurityDescriptorCacheLock, TRUE );
00909 
00910     <span class="keywordflow">return</span>;
00911 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="obsdata.c::ObpCompareSecurityDescriptors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ObpCompareSecurityDescriptors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SD1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SD2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00839">839</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d0/d1/lboxctl2_8c-source.html#l02757">Compare()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l02165">RtlLengthSecurityDescriptor()</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00846                    :
00847 
00848     Performs a byte by byte comparison of two <span class="keyword">self</span> relative security
00849     descriptors to determine <span class="keywordflow">if</span> they are identical.
00850 
00851 Arguments:
00852 
00853     SD1, SD2 - Security descriptors to be compared.
00854 
00855 Return Value:
00856 
00857     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - They are <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same.
00858 
00859     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - They are different.
00860 
00861 --*/
00862 
00863 {
00864     ULONG Length1;
00865     ULONG Length2;
00866     ULONG <a class="code" href="../../d9/d1/lboxctl2_8c.html#a38">Compare</a>;
00867 
00868     <span class="comment">//</span>
00869     <span class="comment">//  Calculating the length is pretty fast, see if we</span>
00870     <span class="comment">//  can get away with doing only that.</span>
00871     <span class="comment">//</span>
00872 
00873     Length1 =  <a class="code" href="../../d8/d6/sertl_8c.html#a56">RtlLengthSecurityDescriptor</a> ( SD1 );
00874     Length2 =  <a class="code" href="../../d8/d6/sertl_8c.html#a56">RtlLengthSecurityDescriptor</a> ( SD2 );
00875 
00876     <span class="keywordflow">if</span> (Length1 != Length2) {
00877 
00878         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00879     }
00880 
00881     <span class="keywordflow">return</span> (BOOLEAN)RtlEqualMemory ( SD1, SD2, Length1 );
00882 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="obsdata.c::ObpCreateCacheEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> ObpCreateCacheEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>InputSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FullHash</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00491">491</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00302">_SECURITY_DESCRIPTOR_HEADER::FullHash</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00300">_SECURITY_DESCRIPTOR_HEADER::Link</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00301">_SECURITY_DESCRIPTOR_HEADER::RefCount</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02165">RtlLengthSecurityDescriptor()</a>, and <a class="el" href="../../d6/d0/obp_8h-source.html#l00303">_SECURITY_DESCRIPTOR_HEADER::SecurityDescriptor</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00498                    :
00499 
00500     Allocates and initializes a <span class="keyword">new</span> cache entry.
00501 
00502 Arguments:
00503 
00504     InputSecurityDescriptor - The security descriptor to be cached.
00505 
00506     FullHash - Full 32 bit hash of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor.
00507 
00508 Return Value:
00509 
00510     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly allocated cache entry, or <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00511 
00512 --*/
00513 
00514 {
00515 
00516     ULONG SecurityDescriptorLength;
00517     ULONG CacheEntrySize;
00518     <a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> NewDescriptor;
00519 
00520     <span class="comment">//</span>
00521     <span class="comment">//  Compute the size that we'll need to allocate.  We need space for</span>
00522     <span class="comment">//  the security descriptor cache minus the funny quad at the end and the</span>
00523     <span class="comment">//  security descriptor itself.</span>
00524     <span class="comment">//</span>
00525 
00526     SecurityDescriptorLength = <a class="code" href="../../d8/d6/sertl_8c.html#a56">RtlLengthSecurityDescriptor</a> ( InputSecurityDescriptor );
00527     CacheEntrySize = SecurityDescriptorLength + (<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">SECURITY_DESCRIPTOR_HEADER</a>) - <span class="keyword">sizeof</span>( QUAD ));
00528 
00529     <span class="comment">//</span>
00530     <span class="comment">//  Now allocate space for the cached entry</span>
00531     <span class="comment">//</span>
00532 
00533     NewDescriptor = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, CacheEntrySize, 'dSeS');
00534 
00535     <span class="keywordflow">if</span> ( NewDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00536 
00537         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00538     }
00539 
00540     <span class="comment">//</span>
00541     <span class="comment">//  Fill the header, copy over the descriptor data, and return to our</span>
00542     <span class="comment">//  caller</span>
00543     <span class="comment">//</span>
00544 
00545     NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o1">RefCount</a>   = 1;
00546     NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o2">FullHash</a>   = FullHash;
00547     NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Flink = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00548     NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Blink = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00549 
00550     RtlCopyMemory( &amp;NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o3">SecurityDescriptor</a>,
00551                    InputSecurityDescriptor,
00552                    SecurityDescriptorLength );
00553 
00554     <span class="keywordflow">return</span>( NewDescriptor );
00555 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="obsdata.c::ObpDereferenceSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObpDereferenceSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">700</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00302">_SECURITY_DESCRIPTOR_HEADER::FullHash</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00886">ObpAcquireDescriptorCacheWriteLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00759">ObpDestroySecurityDescriptorHeader()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00942">ObpReleaseDescriptorCacheLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00064">ObPrint</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00301">_SECURITY_DESCRIPTOR_HEADER::RefCount</a>, and <a class="el" href="../../d6/d0/obp_8h-source.html#l00311">SD_TO_SD_HEADER</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00637">ObDeassignSecurity()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01418">ObReleaseObjectSecurity()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00706                    :
00707 
00708     Decrements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> refcount of a cached security descriptor
00709 
00710 Arguments:
00711 
00712     SecurityDescriptor - Points to a cached security descriptor
00713 
00714 Return Value:
00715 
00716     None.
00717 
00718 --*/
00719 
00720 {
00721     <a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a>  SecurityDescriptorHeader;
00722 
00723     <span class="comment">//</span>
00724     <span class="comment">//  Lock the security descriptor cache and get a pointer</span>
00725     <span class="comment">//  to the security descriptor header</span>
00726     <span class="comment">//</span>
00727 
00728     <a class="code" href="../../d8/d1/obsdata_8c.html#a23">ObpAcquireDescriptorCacheWriteLock</a>();
00729 
00730     SecurityDescriptorHeader = <a class="code" href="../../d5/d1/obp_8h.html#a18">SD_TO_SD_HEADER</a>( SecurityDescriptor );
00731 
00732     <span class="comment">//</span>
00733     <span class="comment">//  Do some debug work</span>
00734     <span class="comment">//</span>
00735 
00736     <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_REFERENCES, (<span class="stringliteral">"Dereferencing SecurityDescriptor %x, hash %lx, refcount = %d \n"</span>, SecurityDescriptor, SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o2">FullHash</a>,SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o1">RefCount</a>));
00737 
00738     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o1">RefCount</a> != 0);
00739 
00740     <span class="comment">//</span>
00741     <span class="comment">//  Decrement the ref count and if it is now zero then</span>
00742     <span class="comment">//  we can completely remove this entry from the cache</span>
00743     <span class="comment">//</span>
00744 
00745     <span class="keywordflow">if</span> (--SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o1">RefCount</a> == 0) {
00746 
00747         <a class="code" href="../../d8/d1/obsdata_8c.html#a21">ObpDestroySecurityDescriptorHeader</a>( SecurityDescriptorHeader );
00748     }
00749 
00750     <span class="comment">//</span>
00751     <span class="comment">//  Unlock the security descriptor cache and return to our caller</span>
00752     <span class="comment">//</span>
00753 
00754     <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00755 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="obsdata.c::ObpDestroySecurityDescriptorHeader" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObpDestroySecurityDescriptorHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Header</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00759">759</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d4/d2/dumpuser_8c-source.html#l00048">Header</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00064">ObPrint</a>, and <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00096">ObsSecurityDescriptorCache</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">ObpDereferenceSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00765                    :
00766 
00767     Frees a cached security descriptor and unlinks <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> chain.
00768 
00769 Arguments:
00770 
00771     <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> - Pointer to a security descriptor header (cached security
00772         descriptor)
00773 
00774 Return Value:
00775 
00776     None.
00777 
00778 --*/
00779 
00780 {
00781     PLIST_ENTRY Forward;
00782     PLIST_ENTRY Rear;
00783     UCHAR SmallHash;
00784 
00785     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> ( <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;RefCount == 0 );
00786 
00787 <span class="preprocessor">#if OB_DIAGNOSTICS_ENABLED</span>
00788 <span class="preprocessor"></span>
00789     ObsTotalCacheEntries--;
00790 
00791 <span class="preprocessor">#endif</span>
00792 <span class="preprocessor"></span>
00793     <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_STATISTICS, (<span class="stringliteral">"ObsTotalCacheEntries = %d \n"</span>,ObsTotalCacheEntries));
00794 
00795     <span class="comment">//</span>
00796     <span class="comment">//  Unlink the cached security descriptor from its linked list and</span>
00797     <span class="comment">//  from the small hash table if it was at the head of the list</span>
00798     <span class="comment">//</span>
00799     <span class="comment">//  **** this should all be rewritten to use the regular set of</span>
00800     <span class="comment">//  link list macros</span>
00801     <span class="comment">//</span>
00802 
00803     SmallHash = (UCHAR)<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;FullHash;
00804 
00805     Forward = <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;Link.Flink;
00806     Rear = <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;Link.Blink;
00807 
00808     <span class="keywordflow">if</span> ( Forward != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00809 
00810         Forward-&gt;Blink = Rear;
00811     }
00812 
00813     <span class="keywordflow">if</span> ( Rear != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00814 
00815         Rear-&gt;Flink = Forward;
00816 
00817     } <span class="keywordflow">else</span> {
00818 
00819         <span class="comment">//</span>
00820         <span class="comment">//  if Rear is NULL, we're deleting the head of the list</span>
00821         <span class="comment">//</span>
00822 
00823         <a class="code" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a>[SmallHash] = Forward;
00824     }
00825 
00826     <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_HEADER_FREE, (<span class="stringliteral">"Freeing memory at %x \n"</span>,Header));
00827 
00828     <span class="comment">//</span>
00829     <span class="comment">//  Now return the cached descriptor to pool and return to our caller</span>
00830     <span class="comment">//</span>
00831 
00832     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Header );
00833 
00834     <span class="keywordflow">return</span>;
00835 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="obsdata.c::ObpHashBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG ObpHashBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00253">253</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00182">ObpHashSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00260                    :
00261 
00262     Hashes a buffer into a 32 bit value
00263 
00264 Arguments:
00265 
00266     Data - <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to be hashed.
00267 
00268     Length - The length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer
00269 
00270 
00271 Return Value:
00272 
00273     ULONG - a 32 bit hash value.
00274 
00275 --*/
00276 
00277 {
00278     PCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00279     ULONG Result = 0;
00280     LONG i;
00281 
00282     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = (PCHAR)Data;
00283 
00284     <span class="keywordflow">for</span> (i = 0; i &lt;= (LONG)((Length-3)-<span class="keyword">sizeof</span>(ULONG)); i++) {
00285 
00286         ULONG Tmp;
00287 
00288         Tmp = *((ULONG UNALIGNED *)(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> + i));
00289         Result += Tmp;
00290     }
00291 
00292     <span class="keywordflow">return</span>( Result );
00293 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="obsdata.c::ObpHashSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG ObpHashSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00182">182</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00160">Group</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00253">ObpHashBuffer()</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02665">RtlGetDaclSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03232">RtlGetGroupSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03059">RtlGetOwnerSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02871">RtlGetSaclSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01350">RtlLengthSid()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00188                    :
00189 
00190     Hashes a security descriptor to a 32 bit value
00191 
00192 Arguments:
00193 
00194     SecurityDescriptor - Provides <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor to be hashed
00195 
00196 Return Value:
00197 
00198     ULONG - a 32 bit hash value.
00199 
00200 --*/
00201 
00202 {
00203     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00204     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00205 
00206     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
00207     PACL Sacl;
00208 
00209     ULONG Hash = 0;
00210     BOOLEAN Junk;
00211     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00212     BOOLEAN DaclPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00213     BOOLEAN SaclPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00214     PISECURITY_DESCRIPTOR sd;
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">//  Cast the actually opaque security descriptor into something</span>
00218     <span class="comment">//  that we can decipher</span>
00219     <span class="comment">//</span>
00220 
00221     sd = (PISECURITY_DESCRIPTOR)SecurityDescriptor;
00222 
00223     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a65">RtlGetOwnerSecurityDescriptor</a>( sd, &amp;Owner, &amp;Junk );
00224     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a67">RtlGetGroupSecurityDescriptor</a>( sd, &amp;Group, &amp;Junk );
00225     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a61">RtlGetDaclSecurityDescriptor</a>( sd, &amp;DaclPresent, &amp;Dacl, &amp;Junk );
00226     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a63">RtlGetSaclSecurityDescriptor</a>( sd, &amp;SaclPresent, &amp;Sacl, &amp;Junk );
00227 
00228     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00229 
00230         Hash = <a class="code" href="../../d8/d1/obsdata_8c.html#a15">ObpHashBuffer</a>( Owner, <a class="code" href="../../d8/d6/sertl_8c.html#a45">RtlLengthSid</a>( Owner ));
00231     }
00232 
00233     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00234 
00235         Hash += <a class="code" href="../../d8/d1/obsdata_8c.html#a15">ObpHashBuffer</a>( Group, <a class="code" href="../../d8/d6/sertl_8c.html#a45">RtlLengthSid</a>( Group));
00236     }
00237 
00238     <span class="keywordflow">if</span> ( DaclPresent &amp;&amp; (<a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00239 
00240         Hash += <a class="code" href="../../d8/d1/obsdata_8c.html#a15">ObpHashBuffer</a>( Dacl, <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>-&gt;AclSize);
00241     }
00242 
00243     <span class="keywordflow">if</span> ( SaclPresent &amp;&amp; (Sacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00244 
00245         Hash += <a class="code" href="../../d8/d1/obsdata_8c.html#a15">ObpHashBuffer</a>( Sacl, Sacl-&gt;AclSize);
00246     }
00247 
00248     <span class="keywordflow">return</span>( Hash );
00249 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="obsdata.c::ObpInitSecurityDescriptorCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObpInitSecurityDescriptorCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00118">118</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02473">ExInitializeResource</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00058">IF_OB_GLOBAL</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00096">ObsSecurityDescriptorCache</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00103">ObsSecurityDescriptorCacheLock</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00339">SECURITY_DESCRIPTOR_CACHE_ENTRIES</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>.
<p>
<pre class="fragment"><div>00124                    :
00125 
00126     Allocates and initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> globalSecurity Descriptor Cache
00127 
00128 Arguments:
00129 
00130     None
00131 
00132 Return Value:
00133 
00134     STATUS_SUCCESS on success, <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> on <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>.
00135 
00136 --*/
00137 
00138 {
00139     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00140     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00141 
00142     <a class="code" href="../../d8/d1/obsdata_8c.html#a0">IF_OB_GLOBAL</a>( BREAK_ON_INIT ) {
00143 
00144         DbgBreakPoint();
00145     }
00146 
00147     <span class="comment">//</span>
00148     <span class="comment">//  Allocate the cache of pointers and zero it out</span>
00149     <span class="comment">//</span>
00150 
00151     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <a class="code" href="../../d5/d1/obp_8h.html#a22">SECURITY_DESCRIPTOR_CACHE_ENTRIES</a> * <span class="keyword">sizeof</span>(PLIST_ENTRY);
00152     <a class="code" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a> = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, Size, 'cCdS' );
00153 
00154     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00155 
00156         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00157     }
00158 
00159     RtlZeroMemory( ObsSecurityDescriptorCache, Size );
00160 
00161     <span class="comment">//</span>
00162     <span class="comment">//  Initialize the resource used to protect the security cache</span>
00163     <span class="comment">//</span>
00164 
00165     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d8/ex_8h.html#a68">ExInitializeResource</a> ( &amp;ObsSecurityDescriptorCacheLock );
00166 
00167     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00168 
00169         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ObsSecurityDescriptorCache );
00170         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00171     }
00172 
00173     <span class="comment">//</span>
00174     <span class="comment">//  And return to our caller</span>
00175     <span class="comment">//</span>
00176 
00177     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00178 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="obsdata.c::ObpLogSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObpLogSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>InputSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputSecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">297</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/dumpuser_8c-source.html#l00048">Header</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00300">_SECURITY_DESCRIPTOR_HEADER::Link</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00318">LINK_TO_SD_HEADER</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00886">ObpAcquireDescriptorCacheWriteLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00839">ObpCompareSecurityDescriptors()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00491">ObpCreateCacheEntry()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00182">ObpHashSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00942">ObpReleaseDescriptorCacheLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00064">ObPrint</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00096">ObsSecurityDescriptorCache</a>, and <a class="el" href="../../d6/d0/obp_8h-source.html#l00303">_SECURITY_DESCRIPTOR_HEADER::SecurityDescriptor</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/obse_8c-source.html#l01183">ObAssignObjectSecurityDescriptor()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00304                    :
00305 
00306     Takes a passed security descriptor and registers <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00307     security descriptor database.
00308 
00309 Arguments:
00310 
00311     InputSecurityDescriptor - The <span class="keyword">new</span> security descriptor to be logged into
00312         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> database. On a successful <span class="keywordflow">return</span> <span class="keyword">this</span> memory will have been
00313         freed back to <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
00314 
00315     OutputSecurityDescriptor - Output security descriptor to be used by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00316         caller.
00317 
00318 Return Value:
00319 
00320     An appropriate status value
00321 
00322 --*/
00323 
00324 {
00325     ULONG FullHash;
00326     UCHAR  SmallHash;
00327     <a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> NewDescriptor;
00328     PLIST_ENTRY Front;
00329     PLIST_ENTRY Back;
00330     <a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>;
00331     BOOLEAN Match;
00332 
00333     FullHash = <a class="code" href="../../d8/d1/obsdata_8c.html#a14">ObpHashSecurityDescriptor</a>( InputSecurityDescriptor );
00334     SmallHash = (UCHAR)FullHash;
00335 
00336     <span class="comment">//</span>
00337     <span class="comment">//  See if the entry matching SmallHash is in use.</span>
00338     <span class="comment">//  Lock the table first, unlock if if we don't need it.</span>
00339     <span class="comment">//</span>
00340 
00341     <a class="code" href="../../d8/d1/obsdata_8c.html#a23">ObpAcquireDescriptorCacheWriteLock</a>();
00342 
00343     Front = <a class="code" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a>[SmallHash];
00344     Back  = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00345     Match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00346 
00347     <span class="comment">//</span>
00348     <span class="comment">//  Zoom down the hash bucket looking for a full hash match</span>
00349     <span class="comment">//</span>
00350 
00351     <span class="keywordflow">while</span> ( Front != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00352 
00353         <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> = <a class="code" href="../../d5/d1/obp_8h.html#a19">LINK_TO_SD_HEADER</a>( Front );
00354 
00355         <span class="comment">//</span>
00356         <span class="comment">//  **** is this test really right?  Is the full hash value really</span>
00357         <span class="comment">//  ordered like this?</span>
00358         <span class="comment">//</span>
00359 
00360         <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;FullHash &gt; FullHash ) {
00361 
00362             <span class="keywordflow">break</span>;
00363         }
00364 
00365         <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;FullHash == FullHash ) {
00366 
00367             Match = <a class="code" href="../../d8/d1/obsdata_8c.html#a22">ObpCompareSecurityDescriptors</a>( InputSecurityDescriptor,
00368                                                    &amp;<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;SecurityDescriptor );
00369 
00370             <span class="keywordflow">if</span> ( Match ) {
00371 
00372                 <span class="keywordflow">break</span>;
00373             }
00374 
00375             <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_COLLISIONS,(<span class="stringliteral">"Got a collision on %d, no match\n"</span>,SmallHash));
00376         }
00377 
00378         Back = Front;
00379         Front = Front-&gt;Flink;
00380     }
00381 
00382     <span class="comment">//</span>
00383     <span class="comment">//  If we have a match then we'll get the caller to use the old</span>
00384     <span class="comment">//  cached descriptor, but bumping its ref count, freeing what</span>
00385     <span class="comment">//  the caller supplied and returning the old one to our caller</span>
00386     <span class="comment">//</span>
00387 
00388     <span class="keywordflow">if</span> ( Match ) {
00389 
00390         <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;RefCount++;
00391 
00392         <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_REFERENCES, (<span class="stringliteral">"Reference Hash = 0x%lX, New RefCount = %d\n"</span>,<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;FullHash,<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;RefCount));
00393 
00394         *OutputSecurityDescriptor = &amp;<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;SecurityDescriptor;
00395 
00396         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( InputSecurityDescriptor );
00397 
00398         <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00399 
00400         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00401     }
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">//  Can't use an existing one, create a new entry</span>
00405     <span class="comment">//  and insert it into the list.</span>
00406     <span class="comment">//</span>
00407 
00408     NewDescriptor = <a class="code" href="../../d8/d1/obsdata_8c.html#a17">ObpCreateCacheEntry</a>( InputSecurityDescriptor,
00409                                          FullHash );
00410 
00411     <span class="keywordflow">if</span> ( NewDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00412 
00413         <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00414 
00415         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00416     }
00417 
00418 <span class="preprocessor">#if OB_DIAGNOSTICS_ENABLED</span>
00419 <span class="preprocessor"></span>
00420     ObsTotalCacheEntries++;
00421 
00422 <span class="preprocessor">#endif</span>
00423 <span class="preprocessor"></span>
00424     <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_STATISTICS, (<span class="stringliteral">"ObsTotalCacheEntries = %d \n"</span>,ObsTotalCacheEntries));
00425     <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_COLLISIONS, (<span class="stringliteral">"Adding new entry for index #%d \n"</span>,SmallHash));
00426 
00427     <span class="comment">//</span>
00428     <span class="comment">//  We don't need the old security descriptor any more.</span>
00429     <span class="comment">//</span>
00430 
00431     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( InputSecurityDescriptor );
00432 
00433     <span class="comment">//</span>
00434     <span class="comment">//  The following logic inserts the new security descriptor into the</span>
00435     <span class="comment">//  small hash list.  We need to first decide if the we're adding</span>
00436     <span class="comment">//  the entry to the beginning of the list (back is null) or if we're</span>
00437     <span class="comment">//  further in the list.</span>
00438     <span class="comment">//</span>
00439     <span class="comment">//  **** This logic is plain bizzare because (1) the small hash</span>
00440     <span class="comment">//  should probably just be an array of list heads and not single</span>
00441     <span class="comment">//  pointer value and (2) the doubly linked list of security descriptors</span>
00442     <span class="comment">//  is not circular!  This should be fixed to use the regular set</span>
00443     <span class="comment">//  of link list macros</span>
00444     <span class="comment">//</span>
00445 
00446     <span class="keywordflow">if</span> ( Back == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00447 
00448         <span class="comment">//</span>
00449         <span class="comment">//  We're inserting at the beginning of the list for this</span>
00450         <span class="comment">//  minor index</span>
00451         <span class="comment">//</span>
00452 
00453         NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Flink = <a class="code" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a>[SmallHash];
00454         <a class="code" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a>[SmallHash] = &amp;NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>;
00455 
00456         <span class="keywordflow">if</span> ( NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Flink != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00457 
00458             NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Flink-&gt;Blink = &amp;NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>;
00459         }
00460 
00461     } <span class="keywordflow">else</span> {
00462 
00463         <span class="comment">//</span>
00464         <span class="comment">//  Hook new descriptor entry into list.</span>
00465         <span class="comment">//</span>
00466 
00467         NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Flink = Front;
00468 
00469         NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>.Blink = Back;
00470 
00471         Back-&gt;Flink = &amp;NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>;
00472 
00473         <span class="keywordflow">if</span> (Front != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00474 
00475             Front-&gt;Blink = &amp;NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o0">Link</a>;
00476         }
00477     }
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">//  Set the output security descriptor and return to our caller</span>
00481     <span class="comment">//</span>
00482 
00483     *OutputSecurityDescriptor = &amp;NewDescriptor-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o3">SecurityDescriptor</a>;
00484     <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00485 
00486     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00487 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="obsdata.c::ObpReferenceSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR ObpReferenceSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">559</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00302">_SECURITY_DESCRIPTOR_HEADER::FullHash</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00058">IF_OB_GLOBAL</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00886">ObpAcquireDescriptorCacheWriteLock()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00221">ObpCentralizedSecurity</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00942">ObpReleaseDescriptorCacheLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00064">ObPrint</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00301">_SECURITY_DESCRIPTOR_HEADER::RefCount</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02066">RtlValidSecurityDescriptor()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00311">SD_TO_SD_HEADER</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/obse_8c-source.html#l01258">ObGetObjectSecurity()</a>.
<p>
<pre class="fragment"><div>00565                    :
00566 
00567     References <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed object.
00568 
00569 Arguments:
00570 
00571     Object - Object being access validated.
00572 
00573 Return Value:
00574 
00575     The security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
00576 
00577 --*/
00578 
00579 {
00580     <a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html">PSECURITY_DESCRIPTOR_HEADER</a> SecurityDescriptorHeader;
00581     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00582     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
00583     PSECURITY_DESCRIPTOR SecurityDescriptor;
00584 
00585     <span class="comment">//</span>
00586     <span class="comment">//  Make sure the sure that the object in question is being</span>
00587     <span class="comment">//  maintained by the system and doesn't have it own security</span>
00588     <span class="comment">//  management routines.</span>
00589     <span class="comment">//</span>
00590     <span class="comment">//  **** the first two lines should probably be only done on</span>
00591     <span class="comment">//  a checked build</span>
00592     <span class="comment">//</span>
00593 
00594     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00595     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
00596     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d1/obp_8h.html#a13">ObpCentralizedSecurity</a>(ObjectType) );
00597 
00598     <span class="comment">//</span>
00599     <span class="comment">//  Lock the security descriptor cache and get the objects</span>
00600     <span class="comment">//  security descriptor</span>
00601     <span class="comment">//</span>
00602 
00603     <a class="code" href="../../d8/d1/obsdata_8c.html#a23">ObpAcquireDescriptorCacheWriteLock</a>();
00604 
00605     SecurityDescriptor = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object )-&gt;SecurityDescriptor;
00606 
00607     <a class="code" href="../../d8/d1/obsdata_8c.html#a0">IF_OB_GLOBAL</a>( STOP_INVALID_DESCRIPTOR ) {
00608 
00609         <span class="keywordflow">if</span>((SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00610            (!<a class="code" href="../../d8/d6/sertl_8c.html#a55">RtlValidSecurityDescriptor</a> ( SecurityDescriptor ))) {
00611 
00612             DbgBreakPoint();
00613         }
00614     }
00615 
00616     <span class="comment">//</span>
00617     <span class="comment">//  If the object has a security descriptor then we need to</span>
00618     <span class="comment">//  get the security descriptor header and increment its</span>
00619     <span class="comment">//  ref count before releasing the lock and returning to</span>
00620     <span class="comment">//  our caller</span>
00621     <span class="comment">//</span>
00622 
00623     <span class="keywordflow">if</span> ( SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00624 
00625         SecurityDescriptorHeader = <a class="code" href="../../d5/d1/obp_8h.html#a18">SD_TO_SD_HEADER</a>( SecurityDescriptor );
00626         <a class="code" href="../../d8/d1/obsdata_8c.html#a1">ObPrint</a>( SHOW_REFERENCES, (<span class="stringliteral">"Referencing Hash %lX, Refcount = %d \n"</span>,SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o2">FullHash</a>,SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o1">RefCount</a>));
00627         SecurityDescriptorHeader-&gt;<a class="code" href="../../d9/d0/struct__SECURITY__DESCRIPTOR__HEADER.html#o1">RefCount</a>++;
00628     }
00629 
00630     <a class="code" href="../../d8/d1/obsdata_8c.html#a25">ObpReleaseDescriptorCacheLock</a>();
00631 
00632     <span class="keywordflow">return</span>( SecurityDescriptor );
00633 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="obsdata.c::ObpReleaseDescriptorCacheLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObpReleaseDescriptorCacheLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00942">942</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00103">ObsSecurityDescriptorCacheLock</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00637">ObDeassignSecurity()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">ObpDereferenceSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">ObpReferenceSecurityDescriptor()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01679">ObQuerySecurityDescriptorInfo()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00948                    :
00949 
00950     Releases a lock on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor cache.
00951 
00952 Arguments:
00953 
00954     none
00955 
00956 Return Value:
00957 
00958     None.
00959 
00960 --*/
00961 
00962 {
00963     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( &amp;ObsSecurityDescriptorCacheLock );
00964     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a> ();
00965 
00966     <span class="keywordflow">return</span>;
00967 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a11" doxytag="obsdata.c::ObsSecurityDescriptorCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PLIST_ENTRY* <a class="el" href="../../d8/d1/obsdata_8c.html#a11">ObsSecurityDescriptorCache</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00096">96</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00759">ObpDestroySecurityDescriptorHeader()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00118">ObpInitSecurityDescriptorCache()</a>, and <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="obsdata.c::ObsSecurityDescriptorCacheLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="el" href="../../d8/d1/obsdata_8c.html#a12">ObsSecurityDescriptorCacheLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00103">103</a> of file <a class="el" href="../../d9/d0/obsdata_8c-source.html">obsdata.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00914">ObpAcquireDescriptorCacheReadLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00886">ObpAcquireDescriptorCacheWriteLock()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00118">ObpInitSecurityDescriptorCache()</a>, and <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00942">ObpReleaseDescriptorCacheLock()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:59 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
