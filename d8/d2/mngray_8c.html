<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mngray.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mngray.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d9/d1/mngray_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d2/mngray_8c.html#a0">PATOR</a>&nbsp;&nbsp;&nbsp;0x00FA0089L</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d2/mngray_8c.html#a1">SRCSTENCIL</a>&nbsp;&nbsp;&nbsp;0x00B8074AL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d2/mngray_8c.html#a2">SRCINVSTENCIL</a>&nbsp;&nbsp;&nbsp;0x00E20746L</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HDC&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d2/mngray_8c.html#a3">CreateCompatiblePublicDC</a> (HDC hdcPublic, HBITMAP *pbmPublicDC)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d2/mngray_8c.html#a4">xxxDrawState</a> (HDC hdcDraw, HBRUSH hbrFore, LPARAM lData, int x, int y, int cx, int <a class="el" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>, UINT uFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d2/mngray_8c.html#a5">BltColor</a> (HDC hdc, HBRUSH hbr, HDC hdcSrce, int xO, int yO, int cx, int <a class="el" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>, int xO1, int yO1, UINT uBltFlags)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="mngray.c::PATOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PATOR&nbsp;&nbsp;&nbsp;0x00FA0089L          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d1/mngray_8c-source.html#l00015">15</a> of file <a class="el" href="../../d9/d1/mngray_8c-source.html">mngray.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mngray.c::SRCINVSTENCIL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SRCINVSTENCIL&nbsp;&nbsp;&nbsp;0x00E20746L          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d1/mngray_8c-source.html#l00017">17</a> of file <a class="el" href="../../d9/d1/mngray_8c-source.html">mngray.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mngray.c::SRCSTENCIL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SRCSTENCIL&nbsp;&nbsp;&nbsp;0x00B8074AL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d1/mngray_8c-source.html#l00016">16</a> of file <a class="el" href="../../d9/d1/mngray_8c-source.html">mngray.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="mngray.c::BltColor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID BltColor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBRUSH&nbsp;</td>
          <td class="mdname" nowrap> <em>hbr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcSrce</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xO</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>yO</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xO1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>yO1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uBltFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d1/mngray_8c-source.html#l00448">448</a> of file <a class="el" href="../../d9/d1/mngray_8c-source.html">mngray.c</a>.
<p>
References <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00019">BC_INVERT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00029">BC_NOMIRROR</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02103">tagDISPLAYINFO::hdcGray</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00409">DrawMenuItemCheckMark()</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00075">DrawStateW()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>, <a class="el" href="../../d9/d1/mngray_8c-source.html#l00169">xxxDrawState()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00459 {
00460     HBRUSH hbrSave;
00461     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  textColorSave;
00462     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  bkColorSave;
00463     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  ROP;
00464 
00465     <span class="comment">/*</span>
00466 <span class="comment">     * Set the Text and Background colors so that bltColor handles the</span>
00467 <span class="comment">     * background of buttons (and other bitmaps) properly.</span>
00468 <span class="comment">     * Save the HDC's old Text and Background colors.  This causes problems</span>
00469 <span class="comment">     * with Omega (and probably other apps) when calling GrayString which</span>
00470 <span class="comment">     * uses this routine...</span>
00471 <span class="comment">     */</span>
00472     textColorSave = GreSetTextColor(hdc, 0x00000000L);
00473     bkColorSave = GreSetBkColor(hdc, 0x00FFFFFFL);
00474 
00475     <span class="keywordflow">if</span> (hbr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00476         hbrSave = GreSelectBrush(hdc, hbr);
00477     <span class="keywordflow">if</span> (uBltFlags &amp; <a class="code" href="../../d9/d2/mngrayc_8c.html#a3">BC_INVERT</a>)
00478         ROP = 0xB8074A<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00479     <span class="keywordflow">else</span>
00480         ROP = 0xE20746<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00481 
00482     <span class="keywordflow">if</span> (uBltFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a3">BC_NOMIRROR</a>)
00483         ROP |= NOMIRRORBITMAP;
00484 
00485     GreBitBlt(hdc,
00486               xO,
00487               yO,
00488               cx,
00489               cy,
00490               hdcSrce ? hdcSrce : <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00491               xO1,
00492               yO1,
00493               ROP,
00494               0x00FFFFFF);
00495 
00496     <span class="keywordflow">if</span> (hbr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00497         GreSelectBrush(hdc, hbrSave);
00498 
00499     <span class="comment">/*</span>
00500 <span class="comment">     * Restore saved colors</span>
00501 <span class="comment">     */</span>
00502     GreSetTextColor(hdc, textColorSave);
00503     GreSetBkColor(hdc, bkColorSave);
00504 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mngray.c::CreateCompatiblePublicDC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDC CreateCompatiblePublicDC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcPublic</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBITMAP *&nbsp;</td>
          <td class="mdname" nowrap> <em>pbmPublicDC</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d1/mngray_8c-source.html#l00040">40</a> of file <a class="el" href="../../d9/d1/mngray_8c-source.html">mngray.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02193">tagDISPLAYINFO::cxGray</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00298">ghbmBits</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00103">ghFontSys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02103">tagDISPLAYINFO::hdcGray</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00043 {
00044     HDC     hdcCompatible = 0;
00045     HBITMAP hbmCompatible;
00046     HFONT   hFont;
00047     <span class="keywordtype">int</span>     cx,<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00048 
00049     <span class="keywordflow">if</span> ((hdcPublic != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>) &amp;&amp; (hdcPublic != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>())) {
00050         <span class="keywordflow">return</span> hdcPublic;
00051     }
00052 
00053     <span class="keywordflow">if</span> ((hdcCompatible = GreCreateCompatibleDC(hdcPublic)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00054         RIPMSG1(RIP_WARNING, <span class="stringliteral">"CreateCompatiblePublicDC: GreCreateCompatibleDC Failed %lX"</span>, hdcPublic);
00055         <span class="keywordflow">return</span> (HDC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00056     }
00057     <span class="keywordflow">if</span> (!GreSetDCOwner(hdcCompatible, OBJECT_OWNER_CURRENT)) {
00058         RIPMSG1(RIP_WARNING, <span class="stringliteral">"CreateCompatiblePublicDC: SetDCOwner Failed %lX"</span>, hdcCompatible);
00059         GreDeleteDC(hdcCompatible);
00060         <span class="keywordflow">return</span> (HDC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00061     }
00062 
00063     <span class="keywordflow">if</span> (hdcPublic == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>) {
00064         cx = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a>;
00065         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a>;
00066     } <span class="keywordflow">else</span> {
00067         <span class="keywordflow">if</span> (hdcPublic == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>()) {
00068             BITMAP bmBits;
00069 
00070             GreExtGetObjectW(ghbmBits, <span class="keyword">sizeof</span>(BITMAP), &amp;bmBits);
00071             cx = bmBits.bmWidth;
00072             <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = bmBits.bmHeight;
00073         } <span class="keywordflow">else</span> {
00074 
00075           <span class="comment">//</span>
00076           <span class="comment">// We should not reach here.</span>
00077           <span class="comment">//</span>
00078           RIPMSG1(RIP_ERROR, <span class="stringliteral">"CreateCompatiblePublicDC: GreCreateCompatibleDC Failed %lX"</span>, hdcPublic);
00079         }
00080 
00081     }
00082 
00083     hbmCompatible = GreCreateCompatibleBitmap(hdcPublic,
00084                                               cx,
00085                                               cy);
00086 
00087     <span class="comment">//</span>
00088     <span class="comment">// Check whether bitmap couldn't be created or can't</span>
00089     <span class="comment">// be set to OBJECT_OWNER_CURRENT, then fail and</span>
00090     <span class="comment">// do necessary cleanup now!</span>
00091     <span class="comment">//</span>
00092 
00093     <span class="keywordflow">if</span>( (hbmCompatible == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00094         (!GreSetBitmapOwner(hbmCompatible, OBJECT_OWNER_CURRENT)) ) {
00095 
00096         RIPMSG1(RIP_WARNING, <span class="stringliteral">"CreateCompatiblePublicDC: GreCreateCompatibleBitmap Failed %lX"</span>, hbmCompatible);
00097         GreDeleteDC( hdcCompatible );
00098 
00099         <span class="keywordflow">if</span>( hbmCompatible ) {
00100             GreDeleteObject( hbmCompatible );
00101         }
00102 
00103         <span class="keywordflow">return</span> (HDC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00104     }
00105 
00106     GreSelectBitmap(hdcCompatible, hbmCompatible);
00107     <span class="comment">/*</span>
00108 <span class="comment">     * Make sure we use the same font and text alignment.</span>
00109 <span class="comment">     */</span>
00110     hFont = GreSelectFont(hdcPublic, ghFontSys);
00111     GreSelectFont(hdcPublic, hFont);
00112     GreSelectFont(hdcCompatible, hFont);
00113     <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdcCompatible, <a class="code" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign</a>(hdcPublic));
00114     <span class="comment">/*</span>
00115 <span class="comment">     * Copy any information already written into G_TERM(pDispInfo)-&gt;hdcGray.</span>
00116 <span class="comment">     */</span>
00117 
00118 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00119 <span class="preprocessor"></span>    <span class="comment">//</span>
00120     <span class="comment">// Mirror the created DC if the hdcGray is currently mirrored,</span>
00121     <span class="comment">// so that TextOut won't get mirrored on User Client DCs</span>
00122     <span class="comment">//</span>
00123     <span class="keywordflow">if</span> (GreGetLayout(hdcPublic) &amp; LAYOUT_RTL)
00124         GreSetLayout(hdcCompatible, cx - 1, LAYOUT_RTL);
00125 <span class="preprocessor">#endif</span>
00126 <span class="preprocessor"></span>    GreBitBlt(hdcCompatible, 0, 0, cx, cy, hdcPublic, 0, 0, SRCCOPY, 0);
00127 
00128     *pbmPublicDC = hbmCompatible ;      <span class="comment">// for later deletion, by the server side</span>
00129 
00130     <span class="keywordflow">return</span> hdcCompatible;
00131 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mngray.c::xxxDrawState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDrawState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcDraw</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBRUSH&nbsp;</td>
          <td class="mdname" nowrap> <em>hbrFore</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d1/mngray_8c-source.html#l00169">169</a> of file <a class="el" href="../../d9/d1/mngray_8c-source.html">mngray.c</a>.
<p>
References <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00019">BC_INVERT</a>, <a class="el" href="../../d9/d1/mngray_8c-source.html#l00448">BltColor()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02193">tagDISPLAYINFO::cxGray</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02194">tagDISPLAYINFO::cyGray</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03362">ghbrBlack</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00103">ghFontSys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02103">tagDISPLAYINFO::hdcGray</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00015">PATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00178 {
00179     HFONT   hFont;
00180     HFONT   hFontSave = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00181     HDC     hdcT;
00182     HBITMAP hbmpT;
00183     POINT   ptOrg;
00184     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fResult;
00185     <span class="keywordtype">int</span>     oldAlign;
00186 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00187 <span class="preprocessor"></span>    <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwOldLayout=0;
00188 <span class="preprocessor">#endif</span>
00189 <span class="preprocessor"></span>
00190     <span class="comment">/*</span>
00191 <span class="comment">     * These require monochrome conversion</span>
00192 <span class="comment">     *</span>
00193 <span class="comment">     * Enforce monochrome: embossed doesn't look great with 2 color displays</span>
00194 <span class="comment">     */</span>
00195     <span class="keywordflow">if</span> ((uFlags &amp; DSS_DISABLED) &amp;&amp;
00196         ((<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount == 1) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SLOWMACHINE))) {
00197 
00198         uFlags &amp;= ~DSS_DISABLED;
00199         uFlags |= DSS_UNION;
00200     }
00201 
00202     <span class="keywordflow">if</span> (uFlags &amp; (DSS_INACTIVE | DSS_DISABLED | DSS_DEFAULT | DSS_UNION))
00203         uFlags |= DSS_MONO;
00204 
00205     <span class="comment">/*</span>
00206 <span class="comment">     * Validate flags - we only support DST_COMPLEX in kernel</span>
00207 <span class="comment">     */</span>
00208     <span class="keywordflow">if</span> ((uFlags &amp; DST_TYPEMASK) != DST_COMPLEX) {
00209         RIPMSG1(RIP_ERROR, <span class="stringliteral">"xxxDrawState: invalid DST_ type %x"</span>, (uFlags &amp; DST_TYPEMASK));
00210         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00211     }
00212 
00213     <span class="comment">/*</span>
00214 <span class="comment">     * Optimize:  nothing to draw</span>
00215 <span class="comment">     */</span>
00216     <span class="keywordflow">if</span> (!cx || !<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>) {
00217         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00218     }
00219 
00220     <span class="comment">/*</span>
00221 <span class="comment">     * Setup drawing dc</span>
00222 <span class="comment">     */</span>
00223     <span class="keywordflow">if</span> (uFlags &amp; DSS_MONO) {
00224 
00225         hdcT = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>;
00226 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00227 <span class="preprocessor"></span>        <span class="comment">/*</span>
00228 <span class="comment">         * First turn off mirroring on hdcGray if any.</span>
00229 <span class="comment">         */</span>
00230         GreSetLayout(hdcT, -1, 0);
00231         <span class="comment">/*</span>
00232 <span class="comment">         * Set the hdcGray layout to be equal to the screen hdcDraw layout.</span>
00233 <span class="comment">         */</span>
00234         dwOldLayout = GreGetLayout(hdcDraw);
00235         <span class="keywordflow">if</span> (dwOldLayout != GDI_ERROR) {
00236             GreSetLayout(hdcT, cx, dwOldLayout);
00237         }
00238 <span class="preprocessor">#endif</span>
00239 <span class="preprocessor"></span>
00240         <span class="comment">/*</span>
00241 <span class="comment">         * Is our scratch bitmap big enough?  We need potentially</span>
00242 <span class="comment">         * cx+1 by cy pixels for default etc.</span>
00243 <span class="comment">         */</span>
00244         <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a> &lt; cx + 1) || (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o8">cyGray</a> &lt; <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>)) {
00245 
00246             <span class="keywordflow">if</span> (hbmpT = GreCreateBitmap(<a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a>, cx + 1), <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o8">cyGray</a>, cy), 1, 1, 0L)) {
00247 
00248                 HBITMAP hbmGray;
00249 
00250                 hbmGray = GreSelectBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, hbmpT);
00251                 GreDeleteObject(hbmGray);
00252 
00253                 GreSetBitmapOwner(hbmpT, OBJECT_OWNER_PUBLIC);
00254 
00255                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a>, cx + 1);
00256                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o8">cyGray</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o8">cyGray</a>, cy);
00257 
00258             } <span class="keywordflow">else</span> {
00259                 cx = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a> - 1;
00260                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o8">cyGray</a>;
00261             }
00262         }
00263 
00264         GrePatBlt(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00265                   0,
00266                   0,
00267                   <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o7">cxGray</a>,
00268                   <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o8">cyGray</a>,
00269                   WHITENESS);
00270 
00271         GreSetTextCharacterExtra(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00272                                  GreGetTextCharacterExtra(hdcDraw));
00273 
00274         oldAlign = <a class="code" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign</a>(hdcT);
00275         <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdcT, (oldAlign &amp; ~(TA_RTLREADING |TA_CENTER |TA_RIGHT))
00276                      | (<a class="code" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign</a>(hdcDraw) &amp; (TA_RTLREADING |TA_CENTER |TA_RIGHT)));
00277         <span class="comment">/*</span>
00278 <span class="comment">         * Setup font</span>
00279 <span class="comment">         */</span>
00280         <span class="keywordflow">if</span> (GreGetHFONT(hdcDraw) != <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>) {
00281             hFont = GreSelectFont(hdcDraw, ghFontSys);
00282             GreSelectFont(hdcDraw, hFont);
00283             hFontSave = GreSelectFont(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, hFont);
00284         }
00285     } <span class="keywordflow">else</span> {
00286         hdcT = hdcDraw;
00287         <span class="comment">/*</span>
00288 <span class="comment">         * Adjust viewport</span>
00289 <span class="comment">         */</span>
00290         GreGetViewportOrg(hdcT, &amp;ptOrg);
00291         GreSetViewportOrg(hdcT, ptOrg.x+x, ptOrg.y+y, NULL);
00292 
00293     }
00294 
00295     <span class="comment">/*</span>
00296 <span class="comment">     * Now, draw original image</span>
00297 <span class="comment">     */</span>
00298     fResult = <a class="code" href="../../d4/d1/userk_8h.html#a1316">xxxRealDrawMenuItem</a>(hdcT, (<a class="code" href="../../d3/d0/structGRAYMENU.html">PGRAYMENU</a>)lData, cx, cy);
00299 
00300     <span class="comment">/*</span>
00301 <span class="comment">     * The callbacks could have altered the attributes of hdcGray</span>
00302 <span class="comment">     */</span>
00303     <span class="keywordflow">if</span> (hdcT == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>) {
00304         GreSetBkColor(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, RGB(255, 255, 255));
00305         GreSetTextColor(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, RGB(0, 0, 0));
00306         GreSelectBrush(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, ghbrBlack);
00307         GreSetBkMode(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, OPAQUE);
00308     }
00309 
00310     <span class="comment">/*</span>
00311 <span class="comment">     * Clean up</span>
00312 <span class="comment">     */</span>
00313     <span class="keywordflow">if</span> (uFlags &amp; DSS_MONO) {
00314 
00315         <span class="comment">/*</span>
00316 <span class="comment">         * Reset font</span>
00317 <span class="comment">         */</span>
00318         <span class="keywordflow">if</span> (hFontSave)
00319             GreSelectFont(hdcT, hFontSave);
00320         <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdcT, oldAlign);
00321     } <span class="keywordflow">else</span> {
00322         <span class="comment">/*</span>
00323 <span class="comment">         * Reset DC.</span>
00324 <span class="comment">         */</span>
00325         GreSetViewportOrg(hdcT, ptOrg.x, ptOrg.y, NULL);
00326         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00327     }
00328 
00329     <span class="comment">/*</span>
00330 <span class="comment">     * UNION state</span>
00331 <span class="comment">     * Dither over image</span>
00332 <span class="comment">     * We want white pixels to stay white, in either dest or pattern.</span>
00333 <span class="comment">     */</span>
00334     <span class="keywordflow">if</span> (uFlags &amp; DSS_UNION) {
00335 
00336          POLYPATBLT PolyData;
00337 
00338          PolyData.x         = 0;
00339          PolyData.y         = 0;
00340          PolyData.cx        = cx;
00341          PolyData.cy        = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00342          PolyData.BrClr.hbr = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray;
00343 
00344          GrePolyPatBlt(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>, PATOR, &amp;PolyData, 1, PPB_BRUSH);
00345     }
00346 
00347     <span class="keywordflow">if</span> (uFlags &amp; DSS_INACTIVE) {
00348 
00349         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdcDraw,
00350                  <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DSHADOW),
00351                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00352                  x,
00353                  y,
00354                  cx,
00355                  cy,
00356                  0,
00357                  0,
00358                  BC_INVERT);
00359 
00360     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uFlags &amp; DSS_DISABLED) {
00361 
00362         <span class="comment">/*</span>
00363 <span class="comment">         * Emboss</span>
00364 <span class="comment">         * Draw over-1/down-1 in hilight color, and in same position in shadow.</span>
00365 <span class="comment">         */</span>
00366 
00367         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdcDraw,
00368                  <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DHILIGHT),
00369                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00370                  x+1,
00371                  y+1,
00372                  cx,
00373                  cy,
00374                  0,
00375                  0,
00376                  BC_INVERT);
00377 
00378         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdcDraw,
00379                  <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DSHADOW),
00380                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00381                  x,
00382                  y,
00383                  cx,
00384                  cy,
00385                  0,
00386                  0,
00387                  BC_INVERT);
00388 
00389     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uFlags &amp; DSS_DEFAULT) {
00390 
00391         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdcDraw,
00392                  hbrFore,
00393                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00394                  x,
00395                  y,
00396                  cx,
00397                  cy,
00398                  0,
00399                  0,
00400                  BC_INVERT);
00401 
00402         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdcDraw,
00403                  hbrFore,
00404                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00405                  x+1,
00406                  y,
00407                  cx,
00408                  cy,
00409                  0,
00410                  0,
00411                  BC_INVERT);
00412 
00413     } <span class="keywordflow">else</span> {
00414 
00415         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdcDraw,
00416                  hbrFore,
00417                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>,
00418                  x,
00419                  y,
00420                  cx,
00421                  cy,
00422                  0,
00423                  0,
00424                  BC_INVERT);
00425     }
00426 
00427 
00428 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00429 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((uFlags &amp; DSS_MONO)){
00430         <span class="comment">/*</span>
00431 <span class="comment">         * Set the hdcGray layout to 0, it is a public DC.</span>
00432 <span class="comment">         */</span>
00433        GreSetLayout(hdcT, -1, 0);
00434     }
00435 <span class="preprocessor">#endif</span>
00436 <span class="preprocessor"></span>    <span class="keywordflow">return</span> fResult;
00437 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:47 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
