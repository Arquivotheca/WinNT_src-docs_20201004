<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: input.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>input.c</h1><a href="../../d7/d3/ntuser_2rtl_2input_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: input.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains common input functions.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 09-12-95 JerrySh      Created.</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 
00013 <span class="comment">/***************************************************************************\</span>
00014 <span class="comment">* CheckMsgRange</span>
00015 <span class="comment">*</span>
00016 <span class="comment">* Checks to see if a message range is within a message filter</span>
00017 <span class="comment">*</span>
00018 <span class="comment">* History:</span>
00019 <span class="comment">* 11-13-90 DavidPe      Created.</span>
00020 <span class="comment">* 11-Oct-1993 mikeke    Macroized</span>
00021 <span class="comment">\***************************************************************************/</span>
00022 
<a name="l00023"></a><a class="code" href="../../d7/d3/ntuser_2rtl_2input_8c.html#a0">00023</a> <span class="preprocessor">#define CheckMsgRange(wMsgRangeMin, wMsgRangeMax, wMsgFilterMin, wMsgFilterMax) \</span>
00024 <span class="preprocessor">    (  ((wMsgFilterMin) &gt; (wMsgFilterMax))      \</span>
00025 <span class="preprocessor">     ? (  ((wMsgRangeMax) &gt;  (wMsgFilterMax))   \</span>
00026 <span class="preprocessor">        &amp;&amp;((wMsgRangeMin) &lt;  (wMsgFilterMin)))  \</span>
00027 <span class="preprocessor">     : (  ((wMsgRangeMax) &gt;= (wMsgFilterMin))   \</span>
00028 <span class="preprocessor">        &amp;&amp;((wMsgRangeMin) &lt;= (wMsgFilterMax)))  \</span>
00029 <span class="preprocessor">    )</span>
00030 <span class="preprocessor"></span>
00031 <span class="comment">/***************************************************************************\</span>
00032 <span class="comment">* CalcWakeMask</span>
00033 <span class="comment">*</span>
00034 <span class="comment">* Calculates which wakebits to check for based on the message</span>
00035 <span class="comment">* range specified by wMsgFilterMin/Max.  This basically means</span>
00036 <span class="comment">* if the filter range didn't input WM_KEYUP and WM_KEYDOWN,</span>
00037 <span class="comment">* QS_KEY wouldn't be included.</span>
00038 <span class="comment">*</span>
00039 <span class="comment">* History:</span>
00040 <span class="comment">* 10-28-90 DavidPe      Created.</span>
00041 <span class="comment">\***************************************************************************/</span>
00042 
<a name="l00043"></a><a class="code" href="../../d7/d3/ntuser_2rtl_2input_8c.html#a1">00043</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d7/d3/ntuser_2rtl_2input_8c.html#a1">CalcWakeMask</a>(
00044     UINT wMsgFilterMin,
00045     UINT wMsgFilterMax,
00046     UINT fsWakeMaskFilter)
00047 {
00048     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fsWakeMask;
00049 
00050     <span class="comment">/*</span>
00051 <span class="comment">     * New for NT5: wake mask filter.</span>
00052 <span class="comment">     * In addition to the message filter, the application can also provide</span>
00053 <span class="comment">     *      a wake mask directly.</span>
00054 <span class="comment">     * If none is provided, default to NT4 mask (plus QS_SENDMESSAGE).</span>
00055 <span class="comment">     */</span>
00056     <span class="keywordflow">if</span> (fsWakeMaskFilter == 0) {
00057         fsWakeMask = (QS_ALLINPUT | QS_EVENT | QS_ALLPOSTMESSAGE);
00058     } <span class="keywordflow">else</span> {
00059         <span class="comment">/*</span>
00060 <span class="comment">         * If the caller wants input, we force all input events. The</span>
00061 <span class="comment">         *  same goes for posted messages. We do this to keep NT4</span>
00062 <span class="comment">         *  compatibility as much as possible.</span>
00063 <span class="comment">         */</span>
00064         <span class="keywordflow">if</span> (fsWakeMaskFilter &amp; QS_INPUT) {
00065             fsWakeMaskFilter |= (QS_INPUT | QS_EVENT);
00066         }
00067         <span class="keywordflow">if</span> (fsWakeMaskFilter &amp; (QS_POSTMESSAGE | QS_TIMER | QS_HOTKEY)) {
00068             fsWakeMaskFilter |= (QS_POSTMESSAGE | QS_TIMER | QS_HOTKEY);
00069         }
00070         fsWakeMask = fsWakeMaskFilter;
00071     }
00072 
00073 <span class="preprocessor">#ifndef _USERK_</span>
00074 <span class="preprocessor"></span>    <span class="comment">/*</span>
00075 <span class="comment">     * The client PeekMessage in client\cltxt.h didn't used to</span>
00076 <span class="comment">     *  call CalcWakeMask if wMsgFilterMax was 0. We call it now</span>
00077 <span class="comment">     *  to take care of fsWakeMaskFilter but still bail before</span>
00078 <span class="comment">     *  messing with the message filter.</span>
00079 <span class="comment">     */</span>
00080     <span class="keywordflow">if</span> (wMsgFilterMax == 0) {
00081         <span class="keywordflow">return</span> fsWakeMask;
00082     }
00083 <span class="preprocessor">#endif</span>
00084 <span class="preprocessor"></span>
00085     <span class="comment">/*</span>
00086 <span class="comment">     * Message filter.</span>
00087 <span class="comment">     * If the filter doesn't match certain ranges, we take out bits one by one.</span>
00088 <span class="comment">     * First check for a 0, 0 filter which means we want all input.</span>
00089 <span class="comment">     */</span>
00090     <span class="keywordflow">if</span> (wMsgFilterMin == 0 &amp;&amp; wMsgFilterMax == ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1)) {
00091         <span class="keywordflow">return</span> fsWakeMask;
00092     }
00093 
00094     <span class="comment">/*</span>
00095 <span class="comment">     * We're not looking at all posted messages.</span>
00096 <span class="comment">     */</span>
00097     fsWakeMask &amp;= ~QS_ALLPOSTMESSAGE;
00098 
00099     <span class="comment">/*</span>
00100 <span class="comment">     * Check for mouse move messages.</span>
00101 <span class="comment">     */</span>
00102     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a823">CheckMsgFilter</a>(WM_NCMOUSEMOVE, wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00103             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a823">CheckMsgFilter</a>(WM_MOUSEMOVE, wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00104         fsWakeMask &amp;= ~QS_MOUSEMOVE;
00105     }
00106 
00107     <span class="comment">/*</span>
00108 <span class="comment">     * First check to see if mouse buttons messages are in the filter range.</span>
00109 <span class="comment">     */</span>
00110     <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d3/ntuser_2rtl_2input_8c.html#a0">CheckMsgRange</a>(WM_NCLBUTTONDOWN, WM_NCMBUTTONDBLCLK, wMsgFilterMin,
00111             wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp; (<a class="code" href="../../d7/d3/ntuser_2rtl_2input_8c.html#a0">CheckMsgRange</a>(WM_MOUSEFIRST + 1,
00112             WM_MOUSELAST, wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00113         fsWakeMask &amp;= ~QS_MOUSEBUTTON;
00114     }
00115 
00116     <span class="comment">/*</span>
00117 <span class="comment">     * Check for key messages.</span>
00118 <span class="comment">     */</span>
00119     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/ntuser_2rtl_2input_8c.html#a0">CheckMsgRange</a>(WM_KEYFIRST, WM_KEYLAST,
00120             wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00121         fsWakeMask &amp;= ~QS_KEY;
00122     }
00123 
00124     <span class="comment">/*</span>
00125 <span class="comment">     * Check for paint messages.</span>
00126 <span class="comment">     */</span>
00127     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a823">CheckMsgFilter</a>(WM_PAINT, wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00128         fsWakeMask &amp;= ~QS_PAINT;
00129     }
00130 
00131     <span class="comment">/*</span>
00132 <span class="comment">     * Check for timer messages.</span>
00133 <span class="comment">     */</span>
00134     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a823">CheckMsgFilter</a>(WM_TIMER, wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00135             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a823">CheckMsgFilter</a>(<a class="code" href="../../d1/d1/bench_8c.html#a4">WM_SYSTIMER</a>,
00136             wMsgFilterMin, wMsgFilterMax) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00137         fsWakeMask &amp;= ~QS_TIMER;
00138     }
00139 
00140     <span class="comment">/*</span>
00141 <span class="comment">     * Check also for WM_QUEUESYNC which maps to all input bits.</span>
00142 <span class="comment">     * This was added for CBT/EXCEL processing.  Without it, a</span>
00143 <span class="comment">     * xxxPeekMessage(....  WM_QUEUESYNC, WM_QUEUESYNC, FALSE) would</span>
00144 <span class="comment">     * not see the message. (bobgu 4/7/87)</span>
00145 <span class="comment">     * Since the user can provide a wake mask now (fsWakeMaskFilter),</span>
00146 <span class="comment">     *  we also add QS_EVENT in this case (it was always set on NT4).</span>
00147 <span class="comment">     */</span>
00148     <span class="keywordflow">if</span> (wMsgFilterMin == WM_QUEUESYNC) {
00149         fsWakeMask |= (QS_INPUT | QS_EVENT);
00150     }
00151 
00152     <span class="keywordflow">return</span> fsWakeMask;
00153 }
00154 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
