<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: menuc.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>menuc.c</h1><a href="../../d7/d7/menuc_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: menuc.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 01-11-93  DavidPe     Created</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
<a name="l00015"></a><a class="code" href="../../d7/d7/menuc_8c.html#a0">00015</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d7/menuc_8c.html#a0">CheckMenuItem</a>(
00016     HMENU hMenu,
00017     UINT uIDCheckItem,
00018     UINT uCheck)
00019 {
00020     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00021     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00022 
00023     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00024     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00025         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1;
00026     }
00027 
00028     <span class="comment">/*</span>
00029 <span class="comment">     * Get a pointer the the menu item</span>
00030 <span class="comment">     */</span>
00031     <span class="keywordflow">if</span> ((pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, uIDCheckItem, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) (uCheck &amp; MF_BYPOSITION), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00032         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1;
00033 
00034     <span class="comment">/*</span>
00035 <span class="comment">     * If the item is already in the state we're</span>
00036 <span class="comment">     * trying to set, just return.</span>
00037 <span class="comment">     */</span>
00038     <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_CHECKED) == (uCheck &amp; MFS_CHECKED)) {
00039         <span class="keywordflow">return</span> pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MF_CHECKED;
00040     }
00041 
00042     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a150">NtUserCheckMenuItem</a>(hMenu, uIDCheckItem, uCheck);
00043 }
00044 
<a name="l00045"></a><a class="code" href="../../d7/d7/menuc_8c.html#a1">00045</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d7/d7/menuc_8c.html#a1">GetMenuDefaultItem</a>(HMENU hMenu, UINT fByPosition, UINT uFlags) {
00046     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00047 
00048     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00049     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00050         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1;
00051     }
00052 
00053     <span class="keywordflow">return</span> <a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a0">_GetMenuDefaultItem</a>(pMenu, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)fByPosition, uFlags);
00054 }
00055 
00056 <span class="comment">/***************************************************************************\</span>
00057 <span class="comment">* SetMenuItemInfoStruct</span>
00058 <span class="comment">*</span>
00059 <span class="comment">* History:</span>
00060 <span class="comment">*  07-22-96 GerardoB - Added header and Fixed up for 5.0</span>
00061 <span class="comment">\***************************************************************************/</span>
<a name="l00062"></a><a class="code" href="../../d7/d7/menuc_8c.html#a2">00062</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a772">SetMenuItemInfoStruct</a>(HMENU hMenu, UINT wFlags, UINT_PTR wIDNew, LPWSTR pwszNew, LPMENUITEMINFO pmii)
00063 {
00064     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00065     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00066 
00067     UserAssert(<span class="keyword">sizeof</span>(MENUITEMINFOW) == <span class="keyword">sizeof</span>(MENUITEMINFOA));
00068 
00069     RtlZeroMemory(pmii, <span class="keyword">sizeof</span>(*pmii));
00070 
00071     pmii-&gt;fMask = MIIM_STATE | MIIM_ID | MIIM_FTYPE;
00072 
00073     <span class="comment">/*</span>
00074 <span class="comment">     * For compatibility, setting the bitmap drops the string and</span>
00075 <span class="comment">     *  viceversa; new apps that want to have sting and bitmaps</span>
00076 <span class="comment">     *  must use the MENUITEMINFO APIs</span>
00077 <span class="comment">     */</span>
00078     <span class="keywordflow">if</span> (wFlags &amp; MFT_BITMAP) {
00079         pmii-&gt;fMask |= MIIM_BITMAP | MIIM_STRING;
00080         pmii-&gt;hbmpItem = (HBITMAP)pwszNew;
00081         pmii-&gt;dwTypeData  = 0;
00082     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(wFlags &amp; MFT_NONSTRING)) {
00083         pmii-&gt;fMask |= MIIM_BITMAP | MIIM_STRING;
00084         pmii-&gt;dwTypeData  = pwszNew;
00085         pmii-&gt;hbmpItem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00086     }
00087 
00088     <span class="keywordflow">if</span> (wFlags &amp; MF_POPUP) {
00089         pmii-&gt;fMask |= MIIM_SUBMENU;
00090         pmii-&gt;hSubMenu = (HMENU)wIDNew;
00091     }
00092 
00093     <span class="keywordflow">if</span> (wFlags &amp; MF_OWNERDRAW) {
00094         pmii-&gt;fMask |= MIIM_DATA;
00095         pmii-&gt;dwItemData = (ULONG_PTR) pwszNew;
00096     }
00097 
00098     pmii-&gt;fState = wFlags &amp; MFS_OLDAPI_MASK;
00099     pmii-&gt;fType  = wFlags &amp; MFT_OLDAPI_MASK;
00100     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00101     <span class="keywordflow">if</span> (pMenu &amp;&amp; pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>) {
00102         pItem = &amp;((<a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pMenu, rgItems))[0];
00103         <span class="keywordflow">if</span> (pItem &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)) {
00104             pmii-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o0">fType</a> |= MFT_RIGHTORDER;
00105         }
00106     }
00107     pmii-&gt;wID    = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wIDNew;
00108 }
00109 <span class="comment">/***************************************************************************\</span>
00110 <span class="comment">* SetMenuItemInfo</span>
00111 <span class="comment">*</span>
00112 <span class="comment">* History:</span>
00113 <span class="comment">*  07-22-96 GerardoB - Added header</span>
00114 <span class="comment">\***************************************************************************/</span>
<a name="l00115"></a><a class="code" href="../../d7/d7/menuc_8c.html#a3">00115</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d7/menuc_8c.html#a3">SetMenuInfo</a>(HMENU hMenu, LPCMENUINFO lpmi)
00116 {
00117     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a770">ValidateMENUINFO</a>(lpmi, <a class="code" href="../../d6/d0/usercli_8h.html#a256">MENUAPI_SET</a>)) {
00118         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00119     }
00120 
00121     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a182">NtUserThunkedMenuInfo</a>(hMenu, (LPCMENUINFO)lpmi);
00122 }
00123 <span class="comment">/***************************************************************************\</span>
00124 <span class="comment">* ChangeMenu</span>
00125 <span class="comment">*</span>
00126 <span class="comment">* Stub routine for compatibility with version &lt; 3.0</span>
00127 <span class="comment">*</span>
00128 <span class="comment">* History:</span>
00129 <span class="comment">\***************************************************************************/</span>
00130 
<a name="l00131"></a><a class="code" href="../../d7/d7/menuc_8c.html#a4">00131</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d7/menuc_8c.html#a4">ChangeMenuW</a>(
00132     HMENU hMenu,
00133     UINT cmd,
00134     LPCWSTR lpNewItem,
00135     UINT IdItem,
00136     UINT flags)
00137 {
00138     <span class="comment">/*</span>
00139 <span class="comment">     * These next two statements take care of sleazyness needed for</span>
00140 <span class="comment">     * compatability with old changemenu.</span>
00141 <span class="comment">     */</span>
00142     <span class="keywordflow">if</span> ((flags &amp; MF_SEPARATOR) &amp;&amp; cmd == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a776">MFMWFP_OFFMENU</a> &amp;&amp; !(flags &amp; MF_CHANGE))
00143         flags |= MF_APPEND;
00144 
00145     <span class="keywordflow">if</span> (lpNewItem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00146         flags |= MF_SEPARATOR;
00147 
00148 
00149 
00150     <span class="comment">/*</span>
00151 <span class="comment">     * MUST be MF_BYPOSITION for Win2.x compatability.</span>
00152 <span class="comment">     */</span>
00153     <span class="keywordflow">if</span> (flags &amp; MF_REMOVE)
00154         <span class="keywordflow">return</span>(<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenu, cmd,
00155                 (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((flags &amp; ~MF_REMOVE) | MF_BYPOSITION)));
00156 
00157     <span class="keywordflow">if</span> (flags &amp; MF_DELETE)
00158         <span class="keywordflow">return</span>(<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a154">NtUserDeleteMenu</a>(hMenu, cmd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(flags &amp; ~MF_DELETE)));
00159 
00160     <span class="keywordflow">if</span> (flags &amp; MF_CHANGE)
00161         <span class="keywordflow">return</span>(ModifyMenuW(hMenu, cmd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((flags &amp; ~MF_CHANGE) &amp;
00162                 (0x07F | MF_HELP | MF_BYPOSITION | MF_BYCOMMAND |
00163                 MF_SEPARATOR)), IdItem, lpNewItem));
00164 
00165     <span class="keywordflow">if</span> (flags &amp; MF_APPEND)
00166         <span class="keywordflow">return</span>(AppendMenuW(hMenu, (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(flags &amp; ~MF_APPEND),
00167             IdItem, lpNewItem));
00168 
00169     <span class="comment">/*</span>
00170 <span class="comment">     * Default is insert</span>
00171 <span class="comment">     */</span>
00172     <span class="keywordflow">return</span>(InsertMenuW(hMenu, cmd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(flags &amp; ~MF_INSERT),
00173             IdItem, lpNewItem));
00174 }
00175 
<a name="l00176"></a><a class="code" href="../../d7/d7/menuc_8c.html#a5">00176</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d7/menuc_8c.html#a5">ChangeMenuA</a>(
00177     HMENU hMenu,
00178     UINT cmd,
00179     LPCSTR lpNewItem,
00180     UINT IdItem,
00181     UINT flags)
00182 {
00183     <span class="comment">/*</span>
00184 <span class="comment">     * These next two statements take care of sleazyness needed for</span>
00185 <span class="comment">     * compatability with old changemenu.</span>
00186 <span class="comment">     */</span>
00187     <span class="keywordflow">if</span> ((flags &amp; MF_SEPARATOR) &amp;&amp; cmd == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a776">MFMWFP_OFFMENU</a> &amp;&amp; !(flags &amp; MF_CHANGE))
00188         flags |= MF_APPEND;
00189 
00190     <span class="keywordflow">if</span> (lpNewItem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00191         flags |= MF_SEPARATOR;
00192 
00193 
00194 
00195     <span class="comment">/*</span>
00196 <span class="comment">     * MUST be MF_BYPOSITION for Win2.x compatability.</span>
00197 <span class="comment">     */</span>
00198     <span class="keywordflow">if</span> (flags &amp; MF_REMOVE)
00199         <span class="keywordflow">return</span>(<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenu, cmd,
00200                 (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((flags &amp; ~MF_REMOVE) | MF_BYPOSITION)));
00201 
00202     <span class="keywordflow">if</span> (flags &amp; MF_DELETE)
00203         <span class="keywordflow">return</span>(<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a154">NtUserDeleteMenu</a>(hMenu, cmd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(flags &amp; ~MF_DELETE)));
00204 
00205     <span class="keywordflow">if</span> (flags &amp; MF_CHANGE)
00206         <span class="keywordflow">return</span>(ModifyMenuA(hMenu, cmd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((flags &amp; ~MF_CHANGE) &amp;
00207                 (0x07F | MF_HELP | MF_BYPOSITION | MF_BYCOMMAND |
00208                 MF_SEPARATOR)), IdItem, lpNewItem));
00209 
00210     <span class="keywordflow">if</span> (flags &amp; MF_APPEND)
00211         <span class="keywordflow">return</span>(AppendMenuA(hMenu, (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(flags &amp; ~MF_APPEND),
00212             IdItem, lpNewItem));
00213 
00214     <span class="comment">/*</span>
00215 <span class="comment">     * Default is insert</span>
00216 <span class="comment">     */</span>
00217     <span class="keywordflow">return</span>(InsertMenuA(hMenu, cmd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(flags &amp; ~MF_INSERT),
00218             IdItem, lpNewItem));
00219 }
00220 
<a name="l00221"></a><a class="code" href="../../d7/d7/menuc_8c.html#a6">00221</a> LONG <a class="code" href="../../d7/d7/menuc_8c.html#a6">GetMenuCheckMarkDimensions</a>()
00222 {
00223     <span class="keywordflow">return</span>((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)MAKELONG(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMENUCHECK), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUCHECK)));
00224 }
00225 
00226 <span class="comment">/***************************************************************************\</span>
00227 <span class="comment">* GetMenuContextHelpId</span>
00228 <span class="comment">*</span>
00229 <span class="comment">* Return the help id of a menu.</span>
00230 <span class="comment">*</span>
00231 <span class="comment">\***************************************************************************/</span>
00232 
<a name="l00233"></a><a class="code" href="../../d7/d7/menuc_8c.html#a7">00233</a> WINUSERAPI <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> WINAPI <a class="code" href="../../d7/d7/menuc_8c.html#a7">GetMenuContextHelpId</a>(
00234     HMENU hMenu)
00235 {
00236     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00237 
00238     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00239 
00240     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00241         <span class="keywordflow">return</span> 0;
00242 
00243     <span class="keywordflow">return</span> pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o10">dwContextHelpId</a>;
00244 }
00245 
<a name="l00246"></a><a class="code" href="../../d7/d7/menuc_8c.html#a8">00246</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d7/menuc_8c.html#a8">TrackPopupMenu</a>(
00247     HMENU hMenu,
00248     UINT fuFlags,
00249     <span class="keywordtype">int</span> x,
00250     <span class="keywordtype">int</span> y,
00251     <span class="keywordtype">int</span> nReserved,
00252     HWND hwnd,
00253     CONST RECT *prcRect)
00254 {
00255     UNREFERENCED_PARAMETER(nReserved);
00256     UNREFERENCED_PARAMETER(prcRect);
00257 
00258     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a239">NtUserTrackPopupMenuEx</a>(hMenu, fuFlags, x, y, hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00259 }
00260 
00261 <span class="comment">/***************************************************************************\</span>
00262 <span class="comment">* GetSysMenuHandle</span>
00263 <span class="comment">*</span>
00264 <span class="comment">* Returns a handle to the system menu of the given window. NULL if</span>
00265 <span class="comment">* the window doesn't have a system menu.</span>
00266 <span class="comment">*</span>
00267 <span class="comment">* History:</span>
00268 <span class="comment">\***************************************************************************/</span>
00269 
<a name="l00270"></a><a class="code" href="../../d4/d1/userk_8h.html#a1403">00270</a> <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> <a class="code" href="../../d4/d1/userk_8h.html#a1403">xxxGetSysMenuHandle</a>(
00271     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00272 {
00273     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00274 
00275     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>)) {
00276         pMenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>;
00277 
00278         <span class="comment">/*</span>
00279 <span class="comment">         * If the window doesn't have a System Menu, use the default one.</span>
00280 <span class="comment">         */</span>
00281         <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00282 
00283             <span class="comment">/*</span>
00284 <span class="comment">             * Change owner so this app can access this menu.</span>
00285 <span class="comment">             */</span>
00286             pMenu = (<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a176">NtUserCallHwndLock</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), SFI_XXXGETSYSMENUHANDLE);
00287         }
00288     } <span class="keywordflow">else</span> {
00289         pMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00290     }
00291 
00292     <span class="keywordflow">return</span> pMenu;
00293 }
00294 
00295 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d7/d7/menuc_8c.html#a10">SetMenuItemBitmaps</a>
<a name="l00296"></a><a class="code" href="../../d7/d7/menuc_8c.html#a10">00296</a> (
00297     HMENU hMenu,
00298     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> nPosition,
00299     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uFlags,
00300     HBITMAP hbmpUnchecked,
00301     HBITMAP hbmpChecked
00302 )
00303 {
00304     MENUITEMINFO    mii;
00305     mii.cbSize          = <span class="keyword">sizeof</span>(MENUITEMINFO);
00306     mii.fMask           = MIIM_CHECKMARKS;
00307     mii.hbmpChecked     = hbmpChecked;
00308     mii.hbmpUnchecked   = hbmpUnchecked;
00309 
00310     <span class="keywordflow">return</span>(<a class="code" href="../../d5/d9/cltxt_8h.html#a30">SetMenuItemInfo</a>(hMenu, nPosition, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) (uFlags &amp; MF_BYPOSITION), &amp;mii));
00311 }
00312 
<a name="l00313"></a><a class="code" href="../../d7/d7/menuc_8c.html#a11">00313</a> <span class="keywordtype">int</span> WINAPI <a class="code" href="../../d7/d7/menuc_8c.html#a11">DrawMenuBarTemp</a>(
00314     HWND hwnd,
00315     HDC hdc,
00316     LPCRECT lprc,
00317     HMENU hMenu,
00318     HFONT hFont)
00319 {
00320     HDC hdcr;
00321 
00322     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a547">IsMetaFile</a>(hdc))
00323         <span class="keywordflow">return</span> -1;
00324 
00325     hdcr = GdiConvertAndCheckDC(hdc);
00326     <span class="keywordflow">if</span> (hdcr == (HDC)0)
00327         <span class="keywordflow">return</span> -1;
00328 
00329     <span class="keywordflow">if</span> (!hMenu)
00330         <span class="keywordflow">return</span> -1;
00331 
00332     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a324">NtUserDrawMenuBarTemp</a>(
00333             hwnd,
00334             hdc,
00335             lprc,
00336             hMenu,
00337             hFont);
00338 }
00339 
00340 <span class="comment">/***************************************************************************\</span>
00341 <span class="comment">*</span>
00342 <span class="comment">*  CheckMenuRadioItem() -</span>
00343 <span class="comment">*</span>
00344 <span class="comment">*  Checks one menu item in a range, unchecking the others.  This can be</span>
00345 <span class="comment">*  done either MF_BYCOMMAND or MF_BYPOSITION.  It works similarly to</span>
00346 <span class="comment">*  CheckRadioButton().</span>
00347 <span class="comment">*</span>
00348 <span class="comment">*  The return value is TRUE if the given item was checked, FALSE if not.</span>
00349 <span class="comment">*</span>
00350 <span class="comment">* History</span>
00351 <span class="comment">* 04/04/97 GerardoB     Moved to the client side</span>
00352 <span class="comment">\***************************************************************************/</span>
00353 
<a name="l00354"></a><a class="code" href="../../d7/d7/menuc_8c.html#a12">00354</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d7/menuc_8c.html#a12">CheckMenuRadioItem</a>(HMENU hMenu, UINT wIDFirst, UINT wIDLast,
00355         UINT wIDCheck, UINT flags)
00356 {
00357     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fByPosition = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) (flags &amp; MF_BYPOSITION);
00358     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>   pMenu, pMenuItemIsOn;
00359     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>   pItem;
00360     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    wIDCur;
00361     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fChecked = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00362     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fFirst  = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00363     MENUITEMINFO mii;
00364 
00365     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00366     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00367         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00368     }
00369 
00370     mii.cbSize = <span class="keyword">sizeof</span>(mii);
00371     <span class="comment">/*</span>
00372 <span class="comment">     * Make sure we won't loop for ever</span>
00373 <span class="comment">     */</span>
00374     wIDLast = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(wIDLast, (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)0xFFFFFFFE);
00375 
00376     <span class="keywordflow">for</span> (wIDCur = wIDFirst; wIDCur &lt;= wIDLast; wIDCur++) {
00377         pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, wIDCur, fByPosition, &amp;pMenuItemIsOn);
00378         <span class="comment">/*</span>
00379 <span class="comment">         * Continue searching if it didn't find the item or it's a separator</span>
00380 <span class="comment">         */</span>
00381         <span class="keywordflow">if</span> ((pItem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_SEPARATOR)) {
00382             <span class="keywordflow">continue</span>;
00383         }
00384         <span class="comment">/*</span>
00385 <span class="comment">         * If this is the first one, rememeber what menu it's on because</span>
00386 <span class="comment">         *  all items are supposed to be in the same menu.</span>
00387 <span class="comment">         */</span>
00388         <span class="keywordflow">if</span> (fFirst) {
00389             pMenu = pMenuItemIsOn;
00390             hMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pMenu);
00391             fFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00392         }
00393         <span class="comment">/*</span>
00394 <span class="comment">         * If this item is on a different menu, don't touch it</span>
00395 <span class="comment">         */</span>
00396         <span class="keywordflow">if</span> (pMenu != pMenuItemIsOn) {
00397             <span class="keywordflow">continue</span>;
00398         }
00399         <span class="comment">/*</span>
00400 <span class="comment">         * Set the new check state. Avoid the trip to the kernel if possible</span>
00401 <span class="comment">         */</span>
00402         <span class="keywordflow">if</span> (wIDCur == wIDCheck) {
00403             <span class="comment">/*</span>
00404 <span class="comment">             * Check it.</span>
00405 <span class="comment">             */</span>
00406             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RADIOCHECK) || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_CHECKED)) {
00407                 mii.fMask = MIIM_FTYPE | MIIM_STATE;
00408                 mii.fType = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o0">fType</a> &amp; MFT_MASK) | MFT_RADIOCHECK;
00409                 mii.fState = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_MASK) | MFS_CHECKED;
00410                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a181">NtUserThunkedMenuItemInfo</a>(hMenu, wIDCheck, fByPosition, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;mii, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00411             }
00412             fChecked = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00413         } <span class="keywordflow">else</span> {
00414             <span class="comment">/*</span>
00415 <span class="comment">             * Uncheck it</span>
00416 <span class="comment">             * NOTE:  don't remove MFT_RADIOCHECK type</span>
00417 <span class="comment">             */</span>
00418             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_CHECKED)) {
00419                 mii.fMask = MIIM_STATE;
00420                 mii.fState = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_MASK) &amp; ~MFS_CHECKED;
00421                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a181">NtUserThunkedMenuItemInfo</a>(hMenu, wIDCur, fByPosition, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;mii, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00422             }
00423         }
00424     } <span class="comment">/* for */</span>
00425 
00426     <span class="keywordflow">if</span> (fFirst) {
00427         <span class="comment">/*</span>
00428 <span class="comment">         * No item was ever found.</span>
00429 <span class="comment">         */</span>
00430         RIPERR0(ERROR_MENU_ITEM_NOT_FOUND, RIP_VERBOSE, <span class="stringliteral">"CheckMenuRadioItem, no items found\n"</span>);
00431 
00432     }
00433     <span class="keywordflow">return</span>(fChecked);
00434 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
