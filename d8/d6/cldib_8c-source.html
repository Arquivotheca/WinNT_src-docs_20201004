<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cldib.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cldib.c</h1><a href="../../d7/d7/cldib_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: cldib.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">*</span>
00007 <span class="comment">* 09-26-95 ChrisWil  Ported dib-scale code.</span>
00008 <span class="comment">\***************************************************************************/</span>
00009 
00010 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00011 <span class="preprocessor">#pragma hdrstop</span>
00012 <span class="preprocessor"></span>
00013 <span class="comment">/*</span>
00014 <span class="comment"> * Constants.</span>
00015 <span class="comment"> */</span>
<a name="l00016"></a><a class="code" href="../../d7/d7/cldib_8c.html#a0">00016</a> <span class="preprocessor">#define FX1  65536   // 1.0 in fixed point</span>
00017 <span class="preprocessor"></span>
00018 
00019 <span class="comment">/*</span>
00020 <span class="comment"> * Local Macros.</span>
00021 <span class="comment"> */</span>
<a name="l00022"></a><a class="code" href="../../d7/d7/cldib_8c.html#a1">00022</a> <span class="preprocessor">#define BPPTOINDEX(bpp) ((UINT)(bpp) &gt;&gt; 3)</span>
00023 <span class="preprocessor"></span>
<a name="l00024"></a><a class="code" href="../../d7/d7/cldib_8c.html#a2">00024</a> <span class="preprocessor">#define RGBQ(r,g,b) RGB(b, g, r)</span>
<a name="l00025"></a><a class="code" href="../../d7/d7/cldib_8c.html#a3">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define RGBQR(rgb)  GetBValue(rgb)</span>
<a name="l00026"></a><a class="code" href="../../d7/d7/cldib_8c.html#a4">00026</a> <span class="preprocessor"></span><span class="preprocessor">#define RGBQG(rgb)  GetGValue(rgb)</span>
<a name="l00027"></a><a class="code" href="../../d7/d7/cldib_8c.html#a5">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define RGBQB(rgb)  GetRValue(rgb)</span>
00028 <span class="preprocessor"></span>
<a name="l00029"></a><a class="code" href="../../d7/d7/cldib_8c.html#a6">00029</a> <span class="preprocessor">#define Pel4(p,x)  (BYTE)(((x) &amp; 1) ? (((LPBYTE)(p))[(x)/2] &amp; 15) : (((LPBYTE)(p))[(x)/2] &gt;&gt; 4))</span>
<a name="l00030"></a><a class="code" href="../../d7/d7/cldib_8c.html#a7">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define Pel8(p,x)  (BYTE)(((LPBYTE)(p))[(x)])</span>
<a name="l00031"></a><a class="code" href="../../d7/d7/cldib_8c.html#a8">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define Pel16(p,x) (((WORD UNALIGNED *)(p))[(x)])</span>
<a name="l00032"></a><a class="code" href="../../d7/d7/cldib_8c.html#a9">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define Pel24(p,x) (*(DWORD UNALIGNED *)((LPBYTE)(p) + (x) * 3))</span>
00033 <span class="preprocessor"></span>
00034 <span class="comment">/*</span>
00035 <span class="comment"> * Function Typedefs.</span>
00036 <span class="comment"> */</span>
<a name="l00037"></a><a class="code" href="../../d7/d7/cldib_8c.html#a10">00037</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d6/iop_8h.html#a145">VOID</a> (*<a class="code" href="../../d7/d7/cldib_8c.html#a10">SCALEPROC</a>)(LPDWORD, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
<a name="l00038"></a><a class="code" href="../../d7/d7/cldib_8c.html#a11">00038</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d6/iop_8h.html#a145">VOID</a> (*<a class="code" href="../../d7/d7/cldib_8c.html#a11">INITPROC</a>)(LPBITMAPINFOHEADER);
00039 
00040 <span class="comment">/*</span>
00041 <span class="comment"> * Local Routines.</span>
00042 <span class="comment"> */</span>
00043 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a17">ScaleDIB</a>(LPBITMAPINFOHEADER, LPVOID, LPBITMAPINFOHEADER, LPVOID);
00044 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a18">InitDst8</a>(LPBITMAPINFOHEADER);
00045 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a28">Scale48</a>(LPDWORD, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00046 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a29">Scale88</a>(LPDWORD, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00047 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a30">Scale424</a>(LPDWORD, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00048 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a31">Scale824</a>(LPDWORD, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00049 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a32">Scale2424</a>(LPDWORD, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, LPBYTE, <span class="keywordtype">long</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00050 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     <a class="code" href="../../d7/d7/cldib_8c.html#a24">Map8</a>(COLORREF);
00051 COLORREF <a class="code" href="../../d7/d7/cldib_8c.html#a25">MixRGBI</a>(LPDWORD, BYTE, BYTE,BYTE, BYTE, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00052 COLORREF <a class="code" href="../../d7/d7/cldib_8c.html#a26">MixRGB</a>(DWORD, DWORD, DWORD, DWORD, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00053 
00054 <span class="comment">/*</span>
00055 <span class="comment"> * Globals needed for color-mapping of resources.</span>
00056 <span class="comment"> */</span>
<a name="l00057"></a><a class="code" href="../../d7/d7/cldib_8c.html#a12">00057</a> <a class="code" href="../../d7/d7/cldib_8c.html#a10">SCALEPROC</a>  <a class="code" href="../../d7/d7/cldib_8c.html#a12">ScaleProc</a>[4][4] = {
00058     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,  <a class="code" href="../../d7/d7/cldib_8c.html#a19">Scale48</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d7/d7/cldib_8c.html#a21">Scale424</a>,
00059     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,  <a class="code" href="../../d7/d7/cldib_8c.html#a20">Scale88</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d7/d7/cldib_8c.html#a22">Scale824</a>,
00060     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>   , <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00061     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>   , <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d7/d7/cldib_8c.html#a23">Scale2424</a>
00062 };
00063 
<a name="l00064"></a><a class="code" href="../../d7/d7/cldib_8c.html#a13">00064</a> <a class="code" href="../../d7/d7/cldib_8c.html#a11">INITPROC</a> <a class="code" href="../../d7/d7/cldib_8c.html#a13">InitDst</a>[] = {
00065     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d7/d7/cldib_8c.html#a18">InitDst8</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00066 };
00067 
<a name="l00068"></a><a class="code" href="../../d7/d7/cldib_8c.html#a14">00068</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d7/d7/cldib_8c.html#a14">rmap</a>[256], <a class="code" href="../../d7/d7/cldib_8c.html#a15">gmap</a>[256], <a class="code" href="../../d7/d7/cldib_8c.html#a16">bmap</a>[256];
00069 
00070 
00071 <span class="comment">/***************************************************************************\</span>
00072 <span class="comment">* SmartStretchDIBits</span>
00073 <span class="comment">*</span>
00074 <span class="comment">* calls GDI StretchDIBits, unless the stretch is 2:1 and the source</span>
00075 <span class="comment">* is 4bpp, then is does it itself in a nice way.</span>
00076 <span class="comment">*</span>
00077 <span class="comment">* this optimization should just be put into GDI.</span>
00078 <span class="comment">*</span>
00079 <span class="comment">* can we change the passed bits? I assume we cant, could avoid a alloc</span>
00080 <span class="comment">* if so.</span>
00081 <span class="comment">*</span>
00082 <span class="comment">\***************************************************************************/</span>
00083 
<a name="l00084"></a><a class="code" href="../../d6/d0/usercli_8h.html#a661">00084</a> <span class="keywordtype">int</span> <a class="code" href="../../d6/d0/usercli_8h.html#a661">SmartStretchDIBits</a>(
00085     HDC          hdc,
00086     <span class="keywordtype">int</span>          xD,
00087     <span class="keywordtype">int</span>          yD,
00088     <span class="keywordtype">int</span>          dxD,
00089     <span class="keywordtype">int</span>          dyD,
00090     <span class="keywordtype">int</span>          xS,
00091     <span class="keywordtype">int</span>          yS,
00092     <span class="keywordtype">int</span>          dxS,
00093     <span class="keywordtype">int</span>          dyS,
00094     LPVOID       lpBits,
00095     LPBITMAPINFO lpbi,
00096     UINT         wUsage,
00097     DWORD        rop)
00098 {
00099     LPBYTE             lpBitsNew;
00100     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>               bpp;
00101     RGBQUAD            rgb;
00102     LPBITMAPINFOHEADER lpbiNew = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00103 
00104     <span class="keywordtype">int</span> i;
00105 
00106     <span class="comment">/*</span>
00107 <span class="comment">     * thunk to USER32</span>
00108 <span class="comment">     */</span>
00109     UserAssert(rop == SRCCOPY);
00110     UserAssert(wUsage == DIB_RGB_COLORS);
00111     UserAssert(xS == 0 &amp;&amp; yS == 0);
00112 
00113     <span class="keywordflow">if</span> ((GetDIBColorTable(hdc, 0, 1, &amp;rgb) != 1) &amp;&amp;
00114         (dxD != dxS || dyD != dyS) &amp;&amp;           <span class="comment">// 1:1 stretch just call GDI</span>
00115         (dxD &gt;= dxS/2) &amp;&amp; (dyD &gt;= dyS/2) &amp;&amp;     <span class="comment">// less than 1:2 shrink call GDI</span>
00116         (lpbi-&gt;bmiHeader.biCompression == 0) &amp;&amp; <span class="comment">// must be un-compressed</span>
00117         (lpbi-&gt;bmiHeader.biBitCount == 4 ||     <span class="comment">// input must be 4,8,24</span>
00118          lpbi-&gt;bmiHeader.biBitCount == 8 ||
00119          lpbi-&gt;bmiHeader.biBitCount == 24)) {
00120 
00121         bpp = GetDeviceCaps(hdc, BITSPIXEL) * GetDeviceCaps(hdc, PLANES);
00122 
00123         bpp = (bpp &gt; 8 ? 24 : 8);
00124 
00125         lpbiNew = (LPBITMAPINFOHEADER)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0,
00126                  <span class="keyword">sizeof</span>(BITMAPINFOHEADER) + (256 * <span class="keyword">sizeof</span>(RGBQUAD)) +
00127                  (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((((dxD * bpp) / 8) + 3) &amp; ~3) * (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)dyD);
00128 
00129         <span class="keywordflow">if</span> (lpbiNew) {
00130 
00131             *lpbiNew            = lpbi-&gt;bmiHeader;
00132             lpbiNew-&gt;biWidth    = dxD;
00133             lpbiNew-&gt;biHeight   = dyD;
00134             lpbiNew-&gt;biBitCount = (WORD)bpp;
00135             lpBitsNew = (LPBYTE)lpbiNew          +
00136                         <span class="keyword">sizeof</span>(BITMAPINFOHEADER) +
00137                         (256 * <span class="keyword">sizeof</span>(RGBQUAD));
00138 
00139             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7/cldib_8c.html#a17">ScaleDIB</a>((LPBITMAPINFOHEADER)lpbi,
00140                          (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)lpBits,
00141                          lpbiNew,
00142                          lpBitsNew)) {
00143 
00144                 lpbi   = (LPBITMAPINFO)lpbiNew;
00145                 lpBits = lpBitsNew;
00146                 dxS    = dxD;
00147                 dyS    = dyD;
00148             }
00149         }
00150     }
00151 
00152     i = StretchDIBits(hdc,
00153                       xD,
00154                       yD,
00155                       dxD,
00156                       dyD,
00157                       xS,
00158                       yS,
00159                       dxS,
00160                       dyS,
00161                       lpBits,
00162                       lpbi,
00163                       wUsage,
00164                       rop);
00165 
00166     <span class="keywordflow">if</span> (lpbiNew)
00167         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(lpbiNew);
00168 
00169     <span class="keywordflow">return</span> i;
00170 }
00171 
00172 <span class="comment">/***************************************************************************\</span>
00173 <span class="comment">* ScaleDIB</span>
00174 <span class="comment">*</span>
00175 <span class="comment">*   Parameters</span>
00176 <span class="comment">*   ----------</span>
00177 <span class="comment">*   lpbiSrc - BITMAPINFO of source.</span>
00178 <span class="comment">*   lpSrc   - Input bits to crunch.</span>
00179 <span class="comment">*   lpbiDst - BITMAPINFO of destination.</span>
00180 <span class="comment">*   lpDst   - Output bits to crunch.</span>
00181 <span class="comment">*</span>
00182 <span class="comment">*</span>
00183 <span class="comment">\***************************************************************************/</span>
00184 
<a name="l00185"></a><a class="code" href="../../d7/d7/cldib_8c.html#a17">00185</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d7/d7/cldib_8c.html#a17">ScaleDIB</a>(
00186     LPBITMAPINFOHEADER lpbiSrc,
00187     LPVOID             lpSrc,
00188     LPBITMAPINFOHEADER lpbiDst,
00189     LPVOID             lpDst)
00190 {
00191     LPBYTE  pbSrc;
00192     LPBYTE  pbDst;
00193     LPDWORD pal;
00194     <span class="keywordtype">int</span>     dxSrc;
00195     <span class="keywordtype">int</span>     dySrc;
00196     <span class="keywordtype">int</span>     dxDst;
00197     <span class="keywordtype">int</span>     dyDst;
00198     <span class="keywordtype">int</span>     iSrc;
00199     <span class="keywordtype">int</span>     iDst;
00200     <span class="keywordtype">int</span>     x0;
00201     <span class="keywordtype">int</span>     y0;
00202     <span class="keywordtype">int</span>     sdx;
00203     <span class="keywordtype">int</span>     sdy;
00204     LONG    WidthBytesSrc;
00205     LONG    WidthBytesDst;
00206 
00207     <span class="keywordflow">if</span> ((lpbiSrc-&gt;biCompression != BI_RGB) ||
00208         (lpbiDst-&gt;biCompression != BI_RGB)) {
00209         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00210     }
00211 
00212     iSrc = <a class="code" href="../../d7/d7/cldib_8c.html#a1">BPPTOINDEX</a>(lpbiSrc-&gt;biBitCount);
00213     iDst = <a class="code" href="../../d7/d7/cldib_8c.html#a1">BPPTOINDEX</a>(lpbiDst-&gt;biBitCount);
00214 
00215     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7/cldib_8c.html#a12">ScaleProc</a>[iSrc][iDst] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00216         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00217 
00218     dxSrc = (<span class="keywordtype">int</span>)lpbiSrc-&gt;biWidth;
00219     dySrc = (<span class="keywordtype">int</span>)lpbiSrc-&gt;biHeight;
00220 
00221     dxDst = (<span class="keywordtype">int</span>)lpbiDst-&gt;biWidth;
00222     dyDst = (<span class="keywordtype">int</span>)lpbiDst-&gt;biHeight;
00223 
00224     WidthBytesDst = <a class="code" href="../../d6/d0/usercli_8h.html#a33">BitmapWidth</a>(lpbiDst-&gt;biWidth, lpbiDst-&gt;biBitCount);
00225     WidthBytesSrc = <a class="code" href="../../d6/d0/usercli_8h.html#a33">BitmapWidth</a>(lpbiSrc-&gt;biWidth, lpbiSrc-&gt;biBitCount);
00226 
00227     lpbiDst-&gt;biSizeImage = (WidthBytesDst * dyDst);
00228 
00229     pbSrc = (LPBYTE)lpSrc;
00230     pbDst = (LPBYTE)lpDst;
00231 
00232     pal = (LPDWORD)(lpbiSrc + 1);
00233 
00234     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7/cldib_8c.html#a13">InitDst</a>[iDst])
00235         <a class="code" href="../../d7/d7/cldib_8c.html#a13">InitDst</a>[iDst](lpbiDst);
00236 
00237     <span class="keywordflow">if</span> ((dxSrc == (dxDst * 2)) &amp;&amp; (dySrc == (dyDst * 2))) {
00238 
00239         sdx = <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * 2;
00240         sdy = <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * 2;
00241         y0  = <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> / 2;
00242         x0  = <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> / 2;
00243 
00244     } <span class="keywordflow">else</span> {
00245 
00246         sdx = (dxSrc - 1) * <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> / (dxDst - 1);
00247         sdy = (dySrc - 1) * <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> / (dyDst - 1);
00248         y0  = 0;
00249         x0  = 0;
00250     }
00251 
00252     <span class="comment">/*</span>
00253 <span class="comment">     * Make sure we don't croak on a bad bitmap since this can hose winlogon</span>
00254 <span class="comment">     * if it's the desktop wallpaper.</span>
00255 <span class="comment">     */</span>
00256     <span class="keywordflow">try</span> {
00257         <a class="code" href="../../d7/d7/cldib_8c.html#a12">ScaleProc</a>[iSrc][iDst](pal,
00258                               pbSrc,
00259                               WidthBytesSrc,
00260                               x0,
00261                               y0,
00262                               sdx,
00263                               sdy,
00264                               pbDst,
00265                               WidthBytesDst,
00266                               dxDst,
00267                               dyDst);
00268     } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00269         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00270     }
00271 
00272     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00273 }
00274 
00275 <span class="comment">/***************************************************************************\</span>
00276 <span class="comment">* Scale48</span>
00277 <span class="comment">*</span>
00278 <span class="comment">*</span>
00279 <span class="comment">\***************************************************************************/</span>
00280 
<a name="l00281"></a><a class="code" href="../../d7/d7/cldib_8c.html#a28">00281</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d7/cldib_8c.html#a28">Scale48</a>(
00282     LPDWORD pal,
00283     LPBYTE  pbSrc,
00284     LONG    WidthBytesSrc,
00285     <span class="keywordtype">int</span>     x0,
00286     <span class="keywordtype">int</span>     y0,
00287     <span class="keywordtype">int</span>     sdx,
00288     <span class="keywordtype">int</span>     sdy,
00289     LPBYTE  pbDst,
00290     LONG    WidthBytesDst,
00291     <span class="keywordtype">int</span>     dxDst,
00292     <span class="keywordtype">int</span>     dyDst)
00293 {
00294     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>    b0;
00295     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>    b1;
00296     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>    b2;
00297     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>    b3;
00298     LPBYTE  pb;
00299     <span class="keywordtype">int</span>     x;
00300     <span class="keywordtype">int</span>     y;
00301     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    sx;
00302     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    sy;
00303 
00304     <span class="keywordflow">for</span> (sy=y0, y=0; y &lt; dyDst; y++, sy+=sdy) {
00305 
00306         pb = pbSrc + (WidthBytesSrc * (sy / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00307 
00308         <span class="keywordflow">for</span> (sx=x0, x=0; x &lt; dxDst; x++, sx+=sdx) {
00309 
00310             b0 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00311             b1 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00312             b2 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00313             b3 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00314 
00315             pbDst[x] = <a class="code" href="../../d7/d7/cldib_8c.html#a24">Map8</a>(<a class="code" href="../../d7/d7/cldib_8c.html#a25">MixRGBI</a>(pal, b0, b1, b2, b3, sx % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>, sy % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00316         }
00317 
00318         pbDst += WidthBytesDst;
00319     }
00320 }
00321 
00322 <span class="comment">/***************************************************************************\</span>
00323 <span class="comment">* Scale88</span>
00324 <span class="comment">*</span>
00325 <span class="comment">*</span>
00326 <span class="comment">\***************************************************************************/</span>
00327 
<a name="l00328"></a><a class="code" href="../../d7/d7/cldib_8c.html#a29">00328</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d7/cldib_8c.html#a29">Scale88</a>(
00329     LPDWORD pal,
00330     LPBYTE  pbSrc,
00331     LONG    WidthBytesSrc,
00332     <span class="keywordtype">int</span>     x0,
00333     <span class="keywordtype">int</span>     y0,
00334     <span class="keywordtype">int</span>     sdx,
00335     <span class="keywordtype">int</span>     sdy,
00336     LPBYTE  pbDst,
00337     LONG    WidthBytesDst,
00338     <span class="keywordtype">int</span>     dxDst,
00339     <span class="keywordtype">int</span>     dyDst)
00340 {
00341     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   b0;
00342     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   b1;
00343     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   b2;
00344     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   b3;
00345     LPBYTE pb;
00346     <span class="keywordtype">int</span>    x;
00347     <span class="keywordtype">int</span>    y;
00348     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   sx;
00349     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   sy;
00350 
00351     <span class="keywordflow">for</span> (sy=y0, y=0; y &lt; dyDst; y++, sy+=sdy) {
00352 
00353         pb = pbSrc + (WidthBytesSrc * (sy / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00354 
00355         <span class="keywordflow">for</span> (sx=x0, x=0; x &lt; dxDst; x++, sx+=sdx) {
00356 
00357             b0 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00358             b1 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00359             b2 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00360             b3 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00361 
00362             pbDst[x] = <a class="code" href="../../d7/d7/cldib_8c.html#a24">Map8</a>(<a class="code" href="../../d7/d7/cldib_8c.html#a25">MixRGBI</a>(pal, b0, b1, b2, b3, sx % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>, sy % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00363         }
00364 
00365         pbDst += WidthBytesDst;
00366     }
00367 }
00368 
00369 <span class="comment">/***************************************************************************\</span>
00370 <span class="comment">* Scale424</span>
00371 <span class="comment">*</span>
00372 <span class="comment">*</span>
00373 <span class="comment">\***************************************************************************/</span>
00374 
<a name="l00375"></a><a class="code" href="../../d7/d7/cldib_8c.html#a30">00375</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d7/cldib_8c.html#a30">Scale424</a>(
00376     LPDWORD pal,
00377     LPBYTE  pbSrc,
00378     LONG    WidthBytesSrc,
00379     <span class="keywordtype">int</span>     x0,
00380     <span class="keywordtype">int</span>     y0,
00381     <span class="keywordtype">int</span>     sdx,
00382     <span class="keywordtype">int</span>     sdy,
00383     LPBYTE  pbDst,
00384     LONG    WidthBytesDst,
00385     <span class="keywordtype">int</span>     dxDst,
00386     <span class="keywordtype">int</span>     dyDst)
00387 {
00388     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b0;
00389     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b1;
00390     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b2;
00391     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b3;
00392     LPBYTE   pb;
00393     <span class="keywordtype">int</span>      x;
00394     <span class="keywordtype">int</span>      y;
00395     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     sx;
00396     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     sy;
00397     COLORREF rgb;
00398 
00399     <span class="keywordflow">for</span> (sy=y0, y=0; y &lt; dyDst; y++, sy+=sdy) {
00400 
00401         pb = pbSrc + (WidthBytesSrc * (sy / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00402 
00403         <span class="keywordflow">for</span> (sx=x0, x=0; x &lt; dxDst; x++, sx+=sdx) {
00404 
00405             b0 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00406             b1 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00407             b2 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00408             b3 = <a class="code" href="../../d7/d7/cldib_8c.html#a6">Pel4</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00409 
00410             rgb = <a class="code" href="../../d7/d7/cldib_8c.html#a25">MixRGBI</a>(pal, b0, b1, b2, b3, sx % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>, sy % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>);
00411 
00412             *pbDst++ = GetBValue(rgb);
00413             *pbDst++ = GetGValue(rgb);
00414             *pbDst++ = GetRValue(rgb);
00415         }
00416 
00417         pbDst += (WidthBytesDst - (dxDst * 3));
00418     }
00419 }
00420 
00421 <span class="comment">/***************************************************************************\</span>
00422 <span class="comment">* Scale824</span>
00423 <span class="comment">*</span>
00424 <span class="comment">*</span>
00425 <span class="comment">\***************************************************************************/</span>
00426 
<a name="l00427"></a><a class="code" href="../../d7/d7/cldib_8c.html#a31">00427</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d7/cldib_8c.html#a31">Scale824</a>(
00428     LPDWORD pal,
00429     LPBYTE  pbSrc,
00430     LONG    WidthBytesSrc,
00431     <span class="keywordtype">int</span>     x0,
00432     <span class="keywordtype">int</span>     y0,
00433     <span class="keywordtype">int</span>     sdx,
00434     <span class="keywordtype">int</span>     sdy,
00435     LPBYTE  pbDst,
00436     LONG    WidthBytesDst,
00437     <span class="keywordtype">int</span>     dxDst,
00438     <span class="keywordtype">int</span>     dyDst)
00439 {
00440     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b0;
00441     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b1;
00442     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b2;
00443     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     b3;
00444     LPBYTE   pb;
00445     <span class="keywordtype">int</span>      x;
00446     <span class="keywordtype">int</span>      y;
00447     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     sx;
00448     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     sy;
00449     COLORREF rgb;
00450 
00451     <span class="keywordflow">for</span> (sy=y0, y=0; y &lt; dyDst; y++, sy+=sdy) {
00452 
00453         pb = pbSrc + (WidthBytesSrc * (sy / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00454 
00455         <span class="keywordflow">for</span> (sx=x0, x=0; x &lt; dxDst; x++, sx+=sdx) {
00456 
00457             b0 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00458             b1 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00459             b2 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00460             b3 = <a class="code" href="../../d7/d7/cldib_8c.html#a7">Pel8</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00461 
00462             rgb = <a class="code" href="../../d7/d7/cldib_8c.html#a25">MixRGBI</a>(pal, b0, b1, b2, b3, sx % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>, sy % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>);
00463 
00464             *pbDst++ = GetBValue(rgb);
00465             *pbDst++ = GetGValue(rgb);
00466             *pbDst++ = GetRValue(rgb);
00467         }
00468 
00469         pbDst += (WidthBytesDst - (dxDst * 3));
00470     }
00471 }
00472 
00473 <span class="comment">/***************************************************************************\</span>
00474 <span class="comment">* Scale2424</span>
00475 <span class="comment">*</span>
00476 <span class="comment">*</span>
00477 <span class="comment">\***************************************************************************/</span>
00478 
<a name="l00479"></a><a class="code" href="../../d7/d7/cldib_8c.html#a32">00479</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d7/cldib_8c.html#a32">Scale2424</a>(
00480     LPDWORD pal,
00481     LPBYTE  pbSrc,
00482     LONG    WidthBytesSrc,
00483     <span class="keywordtype">int</span>     x0,
00484     <span class="keywordtype">int</span>     y0,
00485     <span class="keywordtype">int</span>     sdx,
00486     <span class="keywordtype">int</span>     sdy,
00487     LPBYTE  pbDst,
00488     LONG    WidthBytesDst,
00489     <span class="keywordtype">int</span>     dxDst,
00490     <span class="keywordtype">int</span>     dyDst)
00491 {
00492     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    bgr0;
00493     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    bgr1;
00494     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    bgr2;
00495     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    bgr3;
00496     LPBYTE   pb;
00497     <span class="keywordtype">int</span>      x;
00498     <span class="keywordtype">int</span>      y;
00499     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     sx;
00500     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     sy;
00501     COLORREF rgb;
00502 
00503     UNREFERENCED_PARAMETER(pal);
00504 
00505     <span class="keywordflow">for</span> (sy=y0, y=0; y &lt; dyDst; y++, sy+=sdy) {
00506 
00507         pb = pbSrc + (WidthBytesSrc * (sy / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00508 
00509         <span class="keywordflow">for</span> (sx=x0, x=0; x &lt; dxDst; x++, sx+=sdx) {
00510 
00511             bgr0 = <a class="code" href="../../d7/d7/cldib_8c.html#a9">Pel24</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00512             bgr1 = <a class="code" href="../../d7/d7/cldib_8c.html#a9">Pel24</a>(pb, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00513             bgr2 = <a class="code" href="../../d7/d7/cldib_8c.html#a9">Pel24</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>));
00514             bgr3 = <a class="code" href="../../d7/d7/cldib_8c.html#a9">Pel24</a>(pb + WidthBytesSrc, (sx / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>) + 1);
00515 
00516             rgb = <a class="code" href="../../d7/d7/cldib_8c.html#a26">MixRGB</a>(bgr0, bgr1, bgr2, bgr3, sx % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>, sy % <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>);
00517 
00518             *pbDst++ = GetBValue(rgb);
00519             *pbDst++ = GetGValue(rgb);
00520             *pbDst++ = GetRValue(rgb);
00521         }
00522 
00523         pbDst += (WidthBytesDst - (dxDst * 3));
00524     }
00525 }
00526 
00527 <span class="comment">/***************************************************************************\</span>
00528 <span class="comment">* MixRGB</span>
00529 <span class="comment">*</span>
00530 <span class="comment">*   r0  x   r1</span>
00531 <span class="comment">*   y   *</span>
00532 <span class="comment">*   r2  r3</span>
00533 <span class="comment">*</span>
00534 <span class="comment">* Note: inputs are RGBQUADs, output is a COLORREF.</span>
00535 <span class="comment">*</span>
00536 <span class="comment">\***************************************************************************/</span>
00537 
<a name="l00538"></a><a class="code" href="../../d7/d7/cldib_8c.html#a26">00538</a> COLORREF <a class="code" href="../../d7/d7/cldib_8c.html#a26">MixRGB</a>(
00539     DWORD r0,
00540     DWORD r1,
00541     DWORD r2,
00542     DWORD r3,
00543     <span class="keywordtype">int</span>   x,
00544     <span class="keywordtype">int</span>   y)
00545 {
00546     <span class="keywordtype">int</span> r;
00547     <span class="keywordtype">int</span> <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>;
00548     <span class="keywordtype">int</span> b;
00549 
00550     <span class="keywordflow">if</span> (x == 0 &amp;&amp; y == 0) {
00551 
00552         r = <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r0);
00553         <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> = <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r0);
00554         b = <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r0);
00555 
00556     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x == 0) {
00557 
00558         r = ((<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) * <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r0) + y * <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r2))/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00559         <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> = ((<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) * <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r0) + y * <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r2))/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00560         b = ((<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) * <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r0) + y * <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r2))/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00561     }
00562     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (y == 0)
00563     {
00564         r = ((<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) * <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r0) + x * <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r1))/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00565         <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> = ((<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) * <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r0) + x * <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r1))/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00566         b = ((<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) * <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r0) + x * <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r1))/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00567     }
00568     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x == <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>/2 &amp;&amp; y == <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>/2)
00569     {
00570         r = (<a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r0) + <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r1) + <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r2) + <a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r3))/4;
00571         <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> = (<a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r0) + <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r1) + <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r2) + <a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r3))/4;
00572         b = (<a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r0) + <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r1) + <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r2) + <a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r3))/4;
00573     }
00574     <span class="keywordflow">else</span>
00575     {
00576         r =((ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r0) * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) + (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r1) * x / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) +
00577             (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r2) * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * y       + (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a3">RGBQR</a>(r3) * x / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * y       )/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00578 
00579         <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> =((ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r0) * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) + (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r1) * x / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) +
00580             (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r2) * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * y       + (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a4">RGBQG</a>(r3) * x / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * y       )/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00581 
00582         b =((ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r0) * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) + (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r1) * x / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-y) +
00583             (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r2) * (<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>-x) / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * y       + (ULONG)<a class="code" href="../../d7/d7/cldib_8c.html#a5">RGBQB</a>(r3) * x / <a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a> * y       )/<a class="code" href="../../d7/d7/cldib_8c.html#a0">FX1</a>;
00584     }
00585 
00586     <span class="keywordflow">return</span> RGB(r,<a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>,b);
00587 }
00588 
00589 <span class="comment">/***************************************************************************\</span>
00590 <span class="comment">* MixRGBI</span>
00591 <span class="comment">*</span>
00592 <span class="comment">*</span>
00593 <span class="comment">\***************************************************************************/</span>
00594 
<a name="l00595"></a><a class="code" href="../../d7/d7/cldib_8c.html#a25">00595</a> _inline COLORREF <a class="code" href="../../d7/d7/cldib_8c.html#a25">MixRGBI</a>(
00596     LPDWORD pal,
00597     BYTE    b0,
00598     BYTE    b1,
00599     BYTE    b2,
00600     BYTE    b3,
00601     <span class="keywordtype">int</span>     x,
00602     <span class="keywordtype">int</span>     y)
00603 {
00604     <span class="keywordflow">if</span> (((b0 == b1) &amp;&amp; (b1 == b2) &amp;&amp; (b2 == b3)) || ((x == 0) &amp;&amp; (y == 0)))
00605         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a34">RGBX</a>(pal[b0]);
00606     <span class="keywordflow">else</span>
00607         <span class="keywordflow">return</span> <a class="code" href="../../d7/d7/cldib_8c.html#a26">MixRGB</a>(pal[b0], pal[b1], pal[b2], pal[b3], x, y);
00608 }
00609 
00610 <span class="comment">/***************************************************************************\</span>
00611 <span class="comment">* InitDst8</span>
00612 <span class="comment">*</span>
00613 <span class="comment">*</span>
00614 <span class="comment">\***************************************************************************/</span>
00615 
<a name="l00616"></a><a class="code" href="../../d7/d7/cldib_8c.html#a18">00616</a> _inline <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d7/d7/cldib_8c.html#a18">InitDst8</a>(
00617     LPBITMAPINFOHEADER lpbi)
00618 {
00619     <span class="keywordtype">int</span>     r;
00620     <span class="keywordtype">int</span>     <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>;
00621     <span class="keywordtype">int</span>     b;
00622     LPDWORD pdw;
00623 
00624     pdw = (LPDWORD)(lpbi + 1);
00625     lpbi-&gt;biClrUsed = 6*6*6;
00626 
00627     <span class="keywordflow">for</span> (r=0; r &lt; 6; r++) {
00628 
00629         <span class="keywordflow">for</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>=0; <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> &lt; 6; <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>++) {
00630 
00631             <span class="keywordflow">for</span> (b=0; b &lt; 6; b++) {
00632                 *pdw++ = <a class="code" href="../../d7/d7/cldib_8c.html#a2">RGBQ</a>((r * 255) / 5, (<a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a> * 255) / 5, (b * 255) / 5);
00633             }
00634         }
00635     }
00636 
00637     <span class="keywordflow">for</span> (b=0; b &lt; 256; b++) {
00638         <a class="code" href="../../d7/d7/cldib_8c.html#a16">bmap</a>[b] = (b * 5 + 128) / 255;
00639         <a class="code" href="../../d7/d7/cldib_8c.html#a15">gmap</a>[b] = 6 * <a class="code" href="../../d7/d7/cldib_8c.html#a16">bmap</a>[b];
00640         <a class="code" href="../../d7/d7/cldib_8c.html#a14">rmap</a>[b] = 36 * <a class="code" href="../../d7/d7/cldib_8c.html#a16">bmap</a>[b];
00641     }
00642 }
00643 
00644 <span class="comment">/***************************************************************************\</span>
00645 <span class="comment">* Map8</span>
00646 <span class="comment">*</span>
00647 <span class="comment">*</span>
00648 <span class="comment">\***************************************************************************/</span>
00649 
<a name="l00650"></a><a class="code" href="../../d7/d7/cldib_8c.html#a24">00650</a> _inline <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d7/d7/cldib_8c.html#a24">Map8</a>(
00651     COLORREF rgb)
00652 {
00653     <span class="keywordflow">return</span> <a class="code" href="../../d7/d7/cldib_8c.html#a14">rmap</a>[GetRValue(rgb)] +
00654            <a class="code" href="../../d7/d7/cldib_8c.html#a15">gmap</a>[GetGValue(rgb)] +
00655            <a class="code" href="../../d7/d7/cldib_8c.html#a16">bmap</a>[GetBValue(rgb)];
00656 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
