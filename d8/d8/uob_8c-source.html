<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: uob.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>uob.c</h1><a href="../../d7/d9/uob_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    uob.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Object Manager User Mode Test Program</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Steve Wood (stevewo) 03-Aug-1989</span>
00016 <span class="comment"></span>
00017 <span class="comment">Environment:</span>
00018 <span class="comment"></span>
00019 <span class="comment">    User Mode</span>
00020 <span class="comment"></span>
00021 <span class="comment">Revision History:</span>
00022 <span class="comment"></span>
00023 <span class="comment">--*/</span>
00024 
00025 <span class="preprocessor">#include &lt;nt.h&gt;</span>
00026 <span class="preprocessor">#include &lt;ntrtl.h&gt;</span>
00027 <span class="preprocessor">#include &lt;string.h&gt;</span>
00028 
<a name="l00029"></a><a class="code" href="../../d7/d9/uob_8c.html#a0">00029</a> STRING  <a class="code" href="../../d7/d9/uob_8c.html#a0">DirTypeName</a>;
<a name="l00030"></a><a class="code" href="../../d7/d9/uob_8c.html#a1">00030</a> STRING  <a class="code" href="../../d7/d9/uob_8c.html#a1">LinkTypeName</a>;
00031 
00032 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00033 <a class="code" href="../../d7/d9/uob_8c.html#a3">TestParent</a>( VOID );
00034 
00035 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00036 <a class="code" href="../../d7/d9/uob_8c.html#a4">TestChild</a>( VOID );
00037 
00038 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00039"></a><a class="code" href="../../d7/d9/uob_8c.html#a5">00039</a> <a class="code" href="../../d7/d9/uob_8c.html#a5">DumpObjectDirs</a>(
00040     IN PCH DirName,
00041     IN ULONG Level
00042     )
00043 {
00044     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00045     STRING <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>;
00046     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00047     ULONG Context, Length;
00048     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00049     BOOLEAN RestartScan;
00050     POBJECT_DIRECTORY_INFORMATION DirInfo;
00051     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> DirInfoBuffer[ 256 ];
00052     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> SubDirName[ 128 ];
00053     STRING LinkName;
00054     STRING LinkTarget;
00055     HANDLE LinkHandle;
00056 
00057     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>, DirName );
00058     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00059                                 &amp;<a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>,
00060                                 OBJ_OPENIF | OBJ_CASE_INSENSITIVE,
00061                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00062                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00063                               );
00064     <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
00065                              DIRECTORY_ALL_ACCESS,
00066                              &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00067                            );
00068 
00069     DirInfo = (POBJECT_DIRECTORY_INFORMATION)&amp;DirInfoBuffer;
00070     RestartScan = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00071     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00072         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a2">NtQueryDirectoryObject</a>( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
00073                                          (PVOID)DirInfo,
00074                                          <span class="keyword">sizeof</span>( DirInfoBuffer ),
00075                                          <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00076                                          RestartScan,
00077                                          &amp;Context,
00078                                          &amp;Length
00079                                        );
00080         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00081             <span class="keywordflow">break</span>;
00082             }
00083 
00084         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"%s%s%Z - %Z"</span>,
00085                  DirName,
00086                  Level ? <span class="stringliteral">"\\"</span> : <span class="stringliteral">""</span>,
00087                  &amp;DirInfo-&gt;Name,
00088                  &amp;DirInfo-&gt;TypeName
00089                  );
00090         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/string_8c.html#a11">RtlEqualString</a>( &amp;DirInfo-&gt;TypeName, &amp;<a class="code" href="../../d7/d9/uob_8c.html#a0">DirTypeName</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
00091             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"\n"</span> );
00092             strcpy( SubDirName, DirName );
00093             <span class="keywordflow">if</span> (Level) {
00094                 strcat( SubDirName, <span class="stringliteral">"\\"</span> );
00095                 }
00096             strcat( SubDirName, DirInfo-&gt;Name.Buffer );
00097             <a class="code" href="../../d7/d9/uob_8c.html#a5">DumpObjectDirs</a>( SubDirName, Level+1 );
00098             }
00099         <span class="keywordflow">else</span>
00100         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/string_8c.html#a11">RtlEqualString</a>( &amp;DirInfo-&gt;TypeName, &amp;<a class="code" href="../../d7/d9/uob_8c.html#a1">LinkTypeName</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
00101             strcpy( SubDirName, DirName );
00102             <span class="keywordflow">if</span> (Level) {
00103                 strcat( SubDirName, <span class="stringliteral">"\\"</span> );
00104                 }
00105             strcat( SubDirName, DirInfo-&gt;Name.Buffer );
00106             <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkName, SubDirName );
00107             InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00108                                         &amp;LinkName,
00109                                         0,
00110                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00111                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00112                                       );
00113             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a6">NtOpenSymbolicLinkObject</a>( &amp;LinkHandle,
00114                                                SYMBOLIC_LINK_ALL_ACCESS,
00115                                                &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00116                                              );
00117             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00118                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">" - unable to open symbolic link (%X)\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>  );
00119                 }
00120             <span class="keywordflow">else</span> {
00121                 LinkTarget.MaximumLength = <span class="keyword">sizeof</span>( SubDirName );
00122                 LinkTarget.Length = 0;
00123                 LinkTarget.Buffer = SubDirName;
00124                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a7">NtQuerySymbolicLinkObject</a>( LinkHandle,
00125                                                     &amp;LinkTarget
00126                                                   );
00127                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00128                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">" - unable to query symbolic link target (%X)\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00129                     }
00130                 <span class="keywordflow">else</span> {
00131                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">" =&gt; %Z\n"</span>, &amp;LinkTarget );
00132                     }
00133 
00134                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( LinkHandle );
00135                 }
00136             }
00137         <span class="keywordflow">else</span> {
00138             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"\n"</span> );
00139             }
00140 
00141         RestartScan = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00142         }
00143 
00144     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> );
00145 }
00146 
<a name="l00147"></a><a class="code" href="../../d7/d9/uob_8c.html#a2">00147</a> <span class="keywordtype">char</span> <a class="code" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a>[ 4096 ];
00148 
<a name="l00149"></a><a class="code" href="../../d7/d9/uob_8c.html#a6">00149</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00150     <span class="keywordtype">int</span> argc,
00151     <span class="keywordtype">char</span> **argv,
00152     <span class="keywordtype">char</span> **envp,
00153     <span class="keywordtype">int</span> DebugFlag
00154     )
00155 {
00156     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00157     STRING ImageName;
00158     PRTL_USER_PROCESS_PARAMETERS ProcessParameters;
00159     RTL_USER_PROCESS_INFORMATION ProcessInformation;
00160 
00161     <span class="keywordflow">if</span> (argc == 1) {
00162         <a class="code" href="../../d7/d9/uob_8c.html#a3">TestParent</a>();
00163 
00164         Parameters[ RTL_USER_PROC_PARAMS_IMAGEFILE ] = argv[ 0 ];
00165 
00166         Parameters[ RTL_USER_PROC_PARAMS_CMDLINE ] = <span class="stringliteral">" CHILD"</span>;
00167 
00168         Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG ] =
00169              DebugFlag ? <span class="stringliteral">"1"</span> : <span class="stringliteral">"0"</span>;
00170 
00171         Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG+1 ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00172 
00173         Arguments[ 0 ] = argv[ 0 ];
00174         Arguments[ 1 ] = <span class="stringliteral">"CHILD"</span>;
00175         Arguments[ 2 ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00176 
00177         ProcessParameters = (PRTL_USER_PROCESS_PARAMETERS)<a class="code" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a>;
00178         ProcessParameters-&gt;Length = 0;
00179         ProcessParameters-&gt;MaximumLength = <span class="keyword">sizeof</span>( <a class="code" href="../../d7/d9/uob_8c.html#a2">ParameterBuffer</a> );
00180 
00181         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RtlVectorsToProcessParameters( Arguments,
00182                                                 envp,
00183                                                 Parameters,
00184                                                 ProcessParameters
00185                                               );
00186         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00187             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"RtlVectorToProcessParameters failed - Status = %X\n"</span>,
00188                       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00189                     );
00190             }
00191         <span class="keywordflow">else</span> {
00192             <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;ImageName, <span class="stringliteral">"\\C:\\TMP\\UOB.EXE"</span> );
00193             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a12">RtlCreateUserProcess</a>( &amp;ImageName,
00194                                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00195                                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00196                                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00197                                            <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00198                                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00199                                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00200                                            ProcessParameters,
00201                                            &amp;ProcessInformation,
00202                                            <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00203                                          );
00204             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00205                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"RtlCreateUserProcess( %Z ) failed - Status = %X\n"</span>,
00206                           &amp;ImageName, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00207                         );
00208                 }
00209             <span class="keywordflow">else</span> {
00210                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>( ProcessInformation.Thread, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00211                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>( ProcessInformation.Process,
00212                                                 <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00213                                                 (PLARGE_INTEGER)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00214                                               );
00215                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00216                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtWaitForSingleObject failed - Status = %X\n"</span>,
00217                               <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00218                             );
00219                     }
00220                 }
00221             }
00222         }
00223     <span class="keywordflow">else</span> {
00224         <a class="code" href="../../d7/d9/uob_8c.html#a4">TestChild</a>();
00225         }
00226 
00227     <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00228 }
00229 
00230 
00231 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00232"></a><a class="code" href="../../d7/d9/uob_8c.html#a3">00232</a> <a class="code" href="../../d7/d9/uob_8c.html#a3">TestParent</a>( VOID )
00233 {
00234     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00235     STRING <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>;
00236     STRING LinkName;
00237     STRING LinkTarget;
00238     STRING SectionName;
00239     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00240     HANDLE <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>, LinkHandle, SectionHandle;
00241     ULONG ReturnedLength;
00242     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> ObjectInfoBuffer[ 512 ];
00243     OBJECT_BASIC_INFORMATION ObjectBasicInfo;
00244     POBJECT_NAME_INFORMATION ObjectNameInfo;
00245     POBJECT_TYPE_INFORMATION ObjectTypeInfo;
00246     LARGE_INTEGER SectionSize;
00247 
00248     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00249 
00250     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Entering Object Manager User Mode Test Program\n"</span> );
00251 
00252     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;SectionName, <span class="stringliteral">"\\A:\\OSO001.MSG"</span> );
00253     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00254                                 &amp;SectionName,
00255                                 OBJ_OPENIF | OBJ_CASE_INSENSITIVE,
00256                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00257                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00258                               );
00259 
00260     SectionSize.LowPart = 0x1000;
00261     SectiinSize.HighPart = 0;
00262     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/creasect_8c.html#a19">NtCreateSection</a>( &amp;SectionHandle,
00263                               GENERIC_READ,
00264                               &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00265                               &amp;SectionSize,
00266                               PAGE_READONLY,
00267                               SEC_RESERVE,
00268                               <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00269                             );
00270     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00271         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z section object (%X) [OK]\n"</span>, &amp;SectionName, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00272         }
00273 
00274     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <span class="stringliteral">"\\Drives"</span> );
00275     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00276                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00277                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00278                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00279                                 (PSECURITY_DESCRIPTOR)1
00280 
00281                               );
00282     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Length = 0;
00283     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00284                                       -1,
00285                                       &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00286                                     );
00287     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00288         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00289                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00290         }
00291 
00292     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <span class="stringliteral">"\\Drives"</span> );
00293     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00294                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00295                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00296                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00297                                 (PSECURITY_DESCRIPTOR)1
00298 
00299                               );
00300     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Length = 0;
00301     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00302                                       DIRECTORY_ALL_ACCESS,
00303                                       &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00304                                     );
00305     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00306         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00307                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00308         }
00309 
00310     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00311                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00312                                 -1,
00313                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00314                                 (PSECURITY_DESCRIPTOR)1
00315 
00316                               );
00317     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00318                                       DIRECTORY_ALL_ACCESS,
00319                                       &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00320                                     );
00321     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00322         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00323                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00324         }
00325 
00326     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00327                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00328                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00329                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00330                                 (PSECURITY_DESCRIPTOR)1
00331 
00332                               );
00333     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00334                                       DIRECTORY_ALL_ACCESS,
00335                                       &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00336                                     );
00337     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00338         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X) [OK]\n"</span>,
00339                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00340         }
00341 
00342     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00343                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00344                                 OBJ_CASE_INSENSITIVE | OBJ_PERMANENT,
00345                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00346                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00347 
00348                               );
00349     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00350                                       DIRECTORY_ALL_ACCESS,
00351                                       &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00352                                     );
00353     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00354         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X)\n"</span>,
00355                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00356         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00357         }
00358 
00359     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a> );
00360     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00361         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z directory object handle - %lx (%X)\n"</span>,
00362                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00363                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00364                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00365                  );
00366         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00367         }
00368 
00369     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00370                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00371                                 OBJ_CASE_INSENSITIVE,
00372                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00373                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00374                               );
00375     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00376                                     DIRECTORY_ALL_ACCESS,
00377                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00378                                   );
00379     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00380         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X)\n"</span>,
00381                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00382         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00383         }
00384 
00385     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00386                             ObjectBasicInformation,
00387                             &amp;ObjectBasicInfo,
00388                             <span class="keyword">sizeof</span>( ObjectBasicInfo ),
00389                             &amp;ReturnedLength
00390                           );
00391     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00392         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectBasicInfo ) failed - Status == %X\n"</span>,
00393                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00394                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00395                  );
00396         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00397         }
00398     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectBasicInfo ) returned %lx bytes\n"</span>,
00399              <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00400              ReturnedLength
00401              );
00402     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Attributes = %lx\n"</span>,          ObjectBasicInfo.Attributes );
00403     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    GrantedAccess = %lx\n"</span>,       ObjectBasicInfo.GrantedAccess );
00404     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    HandleCount = %lx\n"</span>,         ObjectBasicInfo.HandleCount );
00405     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    PointerCount = %lx\n"</span>,        ObjectBasicInfo.PointerCount );
00406     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    PagedPoolCharge = %lx\n"</span>,     ObjectBasicInfo.PagedPoolCharge );
00407     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    NonPagedPoolCharge = %lx\n"</span>,  ObjectBasicInfo.NonPagedPoolCharge );
00408     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    NameInfoSize = %lx\n"</span>,        ObjectBasicInfo.NameInfoSize );
00409     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    TypeInfoSize = %lx\n"</span>,        ObjectBasicInfo.TypeInfoSize );
00410     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    SecurityDescriptorSize = %lx\n"</span>, ObjectBasicInfo.SecurityDescriptorSize );
00411 
00412     ObjectNameInfo = (POBJECT_NAME_INFORMATION)ObjectInfoBuffer;
00413     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00414                             ObjectNameInformation,
00415                             ObjectNameInfo,
00416                             <span class="keyword">sizeof</span>( ObjectInfoBuffer ),
00417                             &amp;ReturnedLength
00418                           );
00419     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00420         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectNameInfo ) failed - Status == %X\n"</span>,
00421                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00422                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00423                  );
00424         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00425         }
00426     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectNameInfo ) returned %lx bytes\n"</span>,
00427              <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00428              ReturnedLength
00429              );
00430     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Name = (%ld,%ld) '%Z'\n"</span>,
00431              ObjectNameInfo-&gt;Name.MaximumLength,
00432              ObjectNameInfo-&gt;Name.Length,
00433              &amp;ObjectNameInfo-&gt;Name
00434            );
00435 
00436 
00437     ObjectTypeInfo = (POBJECT_TYPE_INFORMATION)ObjectInfoBuffer;
00438     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/obquery_8c.html#a5">NtQueryObject</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00439                             ObjectTypeInformation,
00440                             ObjectTypeInfo,
00441                             <span class="keyword">sizeof</span>( ObjectInfoBuffer ),
00442                             &amp;ReturnedLength
00443                           );
00444     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00445         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectTypeInfo ) failed - Status == %X\n"</span>,
00446                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00447                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00448                  );
00449         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00450         }
00451     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQueryObject( %lx, ObjectTypeInfo ) returned %lx bytes\n"</span>,
00452              <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00453              ReturnedLength
00454              );
00455     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    TypeName = (%ld,%ld) '%Z'\n"</span>,
00456              ObjectTypeInfo-&gt;TypeName.MaximumLength,
00457              ObjectTypeInfo-&gt;TypeName.Length,
00458              &amp;ObjectTypeInfo-&gt;TypeName
00459            );
00460 
00461     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkName, <span class="stringliteral">"TestSymbolicLink"</span> );
00462     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00463                                 &amp;LinkName,
00464                                 OBJ_CASE_INSENSITIVE,
00465                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00466                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00467                               );
00468     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.RootDirectory = <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>;
00469     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkTarget, <span class="stringliteral">"\\Device\\FileSystem"</span> );
00470     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a5">NtCreateSymbolicLinkObject</a>( &amp;LinkHandle,
00471                                          SYMBOLIC_LINK_ALL_ACCESS,
00472                                          &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00473                                          &amp;LinkTarget
00474                                        );
00475 
00476     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00477         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z =&gt; %Z symbolic link object (%X)\n"</span>,
00478                  &amp;LinkName, &amp;LinkTarget, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00479         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00480         }
00481 
00482     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a> );
00483     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00484         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z directory object handle - %lx (%X)\n"</span>,
00485                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00486                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00487                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00488                  );
00489         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00490         }
00491 
00492     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d7/d9/uob_8c.html#a0">DirTypeName</a>, <span class="stringliteral">"Directory"</span> );
00493     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d7/d9/uob_8c.html#a1">LinkTypeName</a>, <span class="stringliteral">"SymbolicLink"</span> );
00494     <a class="code" href="../../d7/d9/uob_8c.html#a5">DumpObjectDirs</a>( <span class="stringliteral">"\\"</span>, 0 );
00495 
00496     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LinkName, <span class="stringliteral">"TestSymbolicLink"</span> );
00497     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00498                                 &amp;LinkName,
00499                                 OBJ_CASE_INSENSITIVE,
00500                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00501                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00502                               );
00503     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.RootDirectory = LinkHandle;
00504     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00505                                     DIRECTORY_ALL_ACCESS,
00506                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00507                                   );
00508     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00509         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>, &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00510         }
00511 
00512     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( LinkHandle );
00513     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00514         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z symbolic link handle - %lx (%X)\n"</span>,
00515                  &amp;LinkName,
00516                  LinkHandle,
00517                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00518                  );
00519         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00520         }
00521 
00522     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00523                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00524                                 OBJ_CASE_INSENSITIVE,
00525                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00526                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00527                               );
00528     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00529                                     DIRECTORY_ALL_ACCESS,
00530                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00531                                   );
00532     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00533         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X)\n"</span>, &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00534         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00535         }
00536 
00537     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a2">NtMakeTemporaryObject</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a> );
00538     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00539         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtMakeTemporaryObject( %lx ) failed - Status == %X\n"</span>,
00540                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00541                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00542                );
00543         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00544         }
00545 
00546     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a> );
00547     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00548         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to close %Z directory object handle - %lx (%X)\n"</span>,
00549                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00550                  <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00551                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00552                  );
00553         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00554         }
00555 
00556     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00557                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00558                                 OBJ_CASE_INSENSITIVE,
00559                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00560                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00561                               );
00562     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00563                                     DIRECTORY_ALL_ACCESS,
00564                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00565                                   );
00566     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00567         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>, &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00568         }
00569 
00570     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <span class="stringliteral">"\\ExclusiveDir"</span> );
00571     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00572                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00573                                 OBJ_CASE_INSENSITIVE | OBJ_EXCLUSIVE,
00574                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00575                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00576 
00577                               );
00578     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00579                                       DIRECTORY_ALL_ACCESS,
00580                                       &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00581                                     );
00582     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00583         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to create %Z directory object (%X)\n"</span>,
00584                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00585         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00586         }
00587 
00588     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00589                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00590                                 OBJ_CASE_INSENSITIVE | OBJ_EXCLUSIVE,
00591                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00592                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00593                               );
00594     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00595                                     DIRECTORY_ALL_ACCESS,
00596                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00597                                   );
00598     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00599         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X)\n"</span>,
00600                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00601         <a class="code" href="../../d8/d0/psdelete_8c.html#a4">NtTerminateProcess</a>( NtCurrentProcess(), <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00602         }
00603 
00604     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00605                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00606                                 OBJ_CASE_INSENSITIVE,
00607                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00608                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00609                               );
00610     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00611                                     DIRECTORY_ALL_ACCESS,
00612                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00613                                   );
00614     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00615         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>,
00616                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00617         }
00618 
00619     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Exiting Object Manager User Mode Test Program with Status = %X\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00620 }
00621 
00622 
00623 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00624"></a><a class="code" href="../../d7/d9/uob_8c.html#a4">00624</a> <a class="code" href="../../d7/d9/uob_8c.html#a4">TestChild</a>( VOID )
00625 {
00626     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00627     STRING <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>;
00628     HANDLE <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>;
00629     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00630 
00631     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00632 
00633     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Entering Object Manager User Mode Child Test Program\n"</span> );
00634 
00635     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <span class="stringliteral">"\\ExclusiveDir"</span> );
00636     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00637                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00638                                 OBJ_CASE_INSENSITIVE,
00639                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00640                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00641                               );
00642     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00643                                     DIRECTORY_ALL_ACCESS,
00644                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00645                                   );
00646     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00647         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>,
00648                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00649         }
00650 
00651     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00652                                 &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>,
00653                                 OBJ_CASE_INSENSITIVE | OBJ_EXCLUSIVE,
00654                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00655                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00656                               );
00657     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>( &amp;<a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>,
00658                                     DIRECTORY_ALL_ACCESS,
00659                                     &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00660                                   );
00661     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00662         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Unable to open %Z directory object (%X) [OK]\n"</span>,
00663                  &amp;<a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00664         }
00665 
00666     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Exiting Object Manager User Mode Child Test Program with Status = %X\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00667 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:11 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
