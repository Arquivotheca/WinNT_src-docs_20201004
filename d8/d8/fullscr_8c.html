<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: fullscr.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>fullscr.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d9/d7/fullscr_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>&nbsp;&nbsp;&nbsp;((HANDLE)-1)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a7">SetVDMCursorBounds</a> (LPRECT lprc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a8">UserSetDelayedChangeBroadcastForAllDesktops</a> (<a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pCurrentDesktop)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a9">FullScreenCleanup</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a10">xxxMakeWindowForegroundWithState</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> NewState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a11">MonitorFromHdev</a> (HANDLE hdev)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a12">HdevFromMonitor</a> (<a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a13">CreateMonitor</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a14">CreateCachedMonitor</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a15">SetMonitorData</a> (<a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor, ULONG iDev)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a16">UpdateUserScreen</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a17">InitUserScreen</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a18">ResetSharedDesktops</a> (<a class="el" href="../../d9/d3/structtagDISPLAYINFO.html">PDISPLAYINFO</a> pDIChanged, <a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdeskChanged)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a19">DestroyMonitorDCs</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a20">ResetSystemColors</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a21">xxxResetDisplayDevice</a> (<a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk, <a class="el" href="../../d9/d3/structtagDISPLAYINFO.html">PDISPLAYINFO</a> pDI, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CDS_Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a22">TrackFullscreenMode</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a23">xxxUserChangeDisplaySettings</a> (IN PUNICODE_STRING pstrDeviceName, IN LPDEVMODEW pDevMode, IN HWND hwnd, IN <a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, IN PVOID lParam, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a40">MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a24">xxxbFullscreenSwitch</a> (BOOL bFullscreenSwitch, HWND hwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a25">RemoteRedrawRectangle</a> (WORD Left, WORD Top, WORD Right, WORD Bottom)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a26">RemoteRedrawScreen</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a27">RemoteDisableScreen</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a28">xxxBroadcastDisplaySettingsChange</a> (<a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk, BOOL bBroadcastColorChange)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a1">TraceFullscreenSwitch</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> = NOSWITCHER</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a3">fRedoFullScreenSwitch</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a4">fGdiEnabled</a> = TRUE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>POINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a5">gptCursorFullScreen</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d8/fullscr_8c.html#a6">InitSafeBootMode</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="fullscr.c::NOSWITCHER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOSWITCHER&nbsp;&nbsp;&nbsp;((HANDLE)-1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00041">41</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00101">FullScreenCleanup()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01545">xxxbFullscreenSwitch()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a14" doxytag="fullscr.c::CreateCachedMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> CreateCachedMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00466">466</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00449">CreateMonitor()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00066">gpMonitorCached</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00775">InitUserScreen()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>.
<p>
<pre class="fragment"><div>00467 {
00468     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a16">gpMonitorCached</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00469         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a16">gpMonitorCached</a> = <a class="code" href="../../d8/d8/fullscr_8c.html#a13">CreateMonitor</a>();
00470     }
00471 
00472     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a16">gpMonitorCached</a>;
00473 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="fullscr.c::CreateMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> CreateMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00449">449</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d7/handtabl_8c-source.html#l00828">HMAllocObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00917">TYPE_MONITOR</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00466">CreateCachedMonitor()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00479">SetMonitorData()</a>.
<p>
<pre class="fragment"><div>00450 {
00451     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor;
00452 
00453     pMonitor = (<a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>)<a class="code" href="../../d4/d1/userk_8h.html#a969">HMAllocObject</a>(NULL, NULL, TYPE_MONITOR, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/structtagMONITOR.html">MONITOR</a>));
00454 
00455     <span class="keywordflow">if</span> (pMonitor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00456         RIPERR0(ERROR_NOT_ENOUGH_MEMORY, RIP_WARNING, <span class="stringliteral">"CreateMonitor failed"</span>);
00457     }
00458 
00459     <span class="keywordflow">return</span> pMonitor;
00460 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="fullscr.c::DestroyMonitorDCs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void DestroyMonitorDCs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01095">1095</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l01638">DestroyCacheDC()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03586">tagDCE::hdc</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02197">tagDISPLAYINFO::pdceFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03585">tagDCE::pdceNext</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03594">tagDCE::pMonitor</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>.
<p>
<pre class="fragment"><div>01096 {
01097     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> pdce;
01098     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> *ppdce;
01099 
01100     <span class="comment">/*</span>
01101 <span class="comment">     * Scan the DC cache to find any monitor DC's that need to be destroyed.</span>
01102 <span class="comment">     */</span>
01103     <span class="keywordflow">for</span> (ppdce = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o9">pdceFirst</a>; *ppdce != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ) {
01104 
01105         pdce = *ppdce;
01106 
01107         <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o9">pMonitor</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01108             <a class="code" href="../../d4/d1/userk_8h.html#a1700">DestroyCacheDC</a>(ppdce, pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>);
01109         }
01110 
01111         <span class="comment">/*</span>
01112 <span class="comment">         * Step to the next DC.  If the DC was deleted, there</span>
01113 <span class="comment">         * is no need to calculate address of the next entry.</span>
01114 <span class="comment">         */</span>
01115         <span class="keywordflow">if</span> (pdce == *ppdce)
01116             ppdce = &amp;pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o0">pdceNext</a>;
01117     }
01118 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="fullscr.c::FullScreenCleanup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void FullScreenCleanup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00101">101</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06611">CLEAR_PUDF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00023">fGdiEnabled</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00044">fRedoFullScreenSwitch</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00463">gbFullScreen</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00061">gspwndFullScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01514">HW</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00043">idSwitcher</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l00802">LockWindowUpdate2()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00041">NOSWITCHER</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06598">PUDF_LOCKFULLSCREEN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01117">TRACE_SWITCH</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l01069">xxxSendNotifyMessage()</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02595">UserThreadCallout()</a>.
<p>
<pre class="fragment"><div>00102 {
00103     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueThread == <a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a>) {
00104 
00105         <span class="comment">/*</span>
00106 <span class="comment">         * correct the full screen state</span>
00107 <span class="comment">         */</span>
00108 
00109         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d6/desktop_8c.html#a3">fGdiEnabled</a>) {
00110 
00111             <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"Switching: FullScreenCleanup: Gdi Enabled\n"</span>));
00112 
00113             <span class="comment">/*</span>
00114 <span class="comment">             * gdi is enabled, we are switching away from gdi the only thing we</span>
00115 <span class="comment">             * could have done so far is locking the screen so unlock it.</span>
00116 <span class="comment">             */</span>
00117             <a class="code" href="../../d4/d1/userk_8h.html#a660">CLEAR_PUDF</a>(PUDF_LOCKFULLSCREEN);
00118             <a class="code" href="../../d4/d1/userk_8h.html#a1772">LockWindowUpdate2</a>(NULL, TRUE);
00119 
00120         } <span class="keywordflow">else</span> {
00121 
00122             <span class="comment">/*</span>
00123 <span class="comment">             * GDI is not enabled .  This means we were switching from a full</span>
00124 <span class="comment">             * screen to another fullscreen or back to GDI.  Or we could have</span>
00125 <span class="comment">             * disabled gdi and sent a message to the new full screen which</span>
00126 <span class="comment">             * never got completed.</span>
00127 <span class="comment">             *</span>
00128 <span class="comment">             * In any case this probably means the fullscreen guy is gone so</span>
00129 <span class="comment">             * we will switch back to gdi.</span>
00130 <span class="comment">             *</span>
00131 <span class="comment">             * delete any left over saved screen state stuff</span>
00132 <span class="comment">             * set the fullscreen to nothing and then send a message that will</span>
00133 <span class="comment">             * cause us to switch back to the gdi desktop</span>
00134 <span class="comment">             */</span>
00135             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndT;
00136 
00137             <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"Switching: FullScreenCleanup: Gdi Disabled\n"</span>));
00138 
00139             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;gspwndFullScreen);
00140             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a178">gbFullScreen</a> = FULLSCREEN;
00141 
00142             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>, &amp;tlpwndT);
00143             <a class="code" href="../../d4/d1/userk_8h.html#a1581">xxxSendNotifyMessage</a>(
00144                                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>, WM_FULLSCREEN,
00145                                 GDIFULLSCREEN, (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>));
00146             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00147         }
00148 
00149         <a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> = <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>;
00150         <a class="code" href="../../d8/d8/fullscr_8c.html#a3">fRedoFullScreenSwitch</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00151     }
00152 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="fullscr.c::HdevFromMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG HdevFromMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMonitor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00432">432</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02074">tagMONITOR::hDev</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00040">SnapshotMonitorRects()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>.
<p>
<pre class="fragment"><div>00433 {
00434     PMDEV pmdev = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>;
00435     ULONG i;
00436 
00437     <span class="keywordflow">for</span> (i = 0; i &lt; pmdev-&gt;chdev; i++) {
00438         <span class="keywordflow">if</span> (pmdev-&gt;Dev[i].hdev == pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o8">hDev</a>) {
00439             <span class="keywordflow">return</span> i;
00440         }
00441     }
00442     <span class="keywordflow">return</span> -1;
00443 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="fullscr.c::InitUserScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InitUserScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00775">775</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01463">CreateCacheDC()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00466">CreateCachedMonitor()</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00074">CreateEmptyRgnPublic()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">CreateProfileUserName()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03597">DCE_SIZE_CACHEINIT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00174">FreeProfileUserName()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00493">ghdcMem</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00494">ghdcMem2</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00103">ghFontSys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00499">ghrgnGDC</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00489">ghrgnInv0</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00490">ghrgnInv1</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00491">ghrgnInv2</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00487">ghrgnInvalid</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00482">ghrgnInvalidSum</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00504">ghrgnSCR</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00512">ghrgnScrl1</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00513">ghrgnScrl2</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00516">ghrgnScrlDst</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00515">ghrgnScrlSrc</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00517">ghrgnScrlValid</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00514">ghrgnScrlVis</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00505">ghrgnSPB1</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00506">ghrgnSPB2</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00511">ghrgnSW</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00484">ghrgnSWP1</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00485">ghrgnValid</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00486">ghrgnValidSum</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00483">ghrgnVisNew</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d9/d0/init_8h-source.html#l00044">InitSafeBootMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01116">TRACE_INIT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01508">xxxODI_ColorInit()</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01893">InitVideo()</a>.
<p>
<pre class="fragment"><div>00776 {
00777     <span class="keywordtype">int</span> i;
00778     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlName;
00779     PUNICODE_STRING pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
00780     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00781 
00782     <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"UserInit: Initialize Screen\n"</span>));
00783 
00784     <span class="comment">/*</span>
00785 <span class="comment">     * Create screen and memory dcs.</span>
00786 <span class="comment">     */</span>
00787     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a> = GreCreateDisplayDC(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, DCTYPE_DIRECT, FALSE);
00788 
00789     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00790         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Fail to create gpDispInfo-&gt;hdcScreen"</span>);
00791         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00792         <span class="keywordflow">goto</span> Exit;
00793     }
00794 
00795     GreSelectFont(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, GreGetStockObject(SYSTEM_FONT));
00796     GreSetDCOwner(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, OBJECT_OWNER_PUBLIC);
00797 
00798     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>() = GreCreateCompatibleDC(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>);
00799 
00800     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00801         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Fail to create HDCBITS()"</span>);
00802         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00803         <span class="keywordflow">goto</span> Exit;
00804     }
00805 
00806     GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), GreGetStockObject(SYSTEM_FONT));
00807     GreSetDCOwner(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), OBJECT_OWNER_PUBLIC);
00808 
00809     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a192">ghdcMem</a> = GreCreateCompatibleDC(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>);
00810     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a192">ghdcMem</a>;
00811 
00812     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a193">ghdcMem2</a> = GreCreateCompatibleDC(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>);
00813     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a193">ghdcMem2</a>;
00814 
00815     <span class="keywordflow">if</span> (!fSuccess) {
00816         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Fail to create ghdcMem or ghdcMem2"</span>);
00817         <span class="keywordflow">goto</span> Exit;
00818     }
00819 
00820     GreSetDCOwner(ghdcMem, OBJECT_OWNER_PUBLIC);
00821     GreSetDCOwner(ghdcMem2, OBJECT_OWNER_PUBLIC);
00822 
00823     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8/fullscr_8c.html#a14">CreateCachedMonitor</a>() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00824         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00825         <span class="keywordflow">goto</span> Exit;
00826     }
00827 
00828     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d8/fullscr_8c.html#a16">UpdateUserScreen</a>()) {
00829         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UpdateUserScreen failed"</span>);
00830         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00831         <span class="keywordflow">goto</span> Exit;
00832     }
00833 
00834     <span class="comment">/*</span>
00835 <span class="comment">     * Do some initialization so we create the system colors.</span>
00836 <span class="comment">     */</span>
00837 
00838     <span class="comment">/*</span>
00839 <span class="comment">     * Set the window sizing border width to something reasonable.</span>
00840 <span class="comment">     */</span>
00841     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder = 1;
00842 
00843     <span class="comment">/*</span>
00844 <span class="comment">     * Init InternalInvalidate globals</span>
00845 <span class="comment">     */</span>
00846     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a189">ghrgnInv0</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();    <span class="comment">// For InternalInvalidate()</span>
00847     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a189">ghrgnInv0</a>;
00848 
00849     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a190">ghrgnInv1</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();    <span class="comment">// For InternalInvalidate()</span>
00850     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a190">ghrgnInv1</a>;
00851 
00852     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a191">ghrgnInv2</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();    <span class="comment">// For InternalInvalidate()</span>
00853     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a191">ghrgnInv2</a>;
00854 
00855     <span class="comment">/*</span>
00856 <span class="comment">     * Initialize SPB globals</span>
00857 <span class="comment">     */</span>
00858     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a196">ghrgnSPB1</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00859     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a196">ghrgnSPB1</a>;
00860 
00861     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a197">ghrgnSPB2</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00862     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a197">ghrgnSPB2</a>;
00863 
00864     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a195">ghrgnSCR</a>  = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00865     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a195">ghrgnSCR</a>;
00866 
00867     <span class="comment">/*</span>
00868 <span class="comment">     * Initialize ScrollWindow/ScrollDC globals</span>
00869 <span class="comment">     */</span>
00870     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a198">ghrgnSW</a>        = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00871     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a198">ghrgnSW</a>;
00872 
00873     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a199">ghrgnScrl1</a>     = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00874     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a199">ghrgnScrl1</a>;
00875 
00876     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a200">ghrgnScrl2</a>     = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00877     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a200">ghrgnScrl2</a>;
00878 
00879     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a201">ghrgnScrlVis</a>   = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00880     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a201">ghrgnScrlVis</a>;
00881 
00882     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a202">ghrgnScrlSrc</a>   = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00883     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a202">ghrgnScrlSrc</a>;
00884 
00885     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a203">ghrgnScrlDst</a>   = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00886     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a203">ghrgnScrlDst</a>;
00887 
00888     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a204">ghrgnScrlValid</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00889     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a204">ghrgnScrlValid</a>;
00890 
00891     <span class="comment">/*</span>
00892 <span class="comment">     * Initialize SetWindowPos()</span>
00893 <span class="comment">     */</span>
00894     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a183">ghrgnInvalidSum</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00895     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a183">ghrgnInvalidSum</a>;
00896 
00897     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a184">ghrgnVisNew</a>     = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00898     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a184">ghrgnVisNew</a>;
00899 
00900     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a185">ghrgnSWP1</a>       = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00901     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a185">ghrgnSWP1</a>;
00902 
00903     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a186">ghrgnValid</a>      = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00904     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a186">ghrgnValid</a>;
00905 
00906     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a187">ghrgnValidSum</a>   = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00907     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a187">ghrgnValidSum</a>;
00908 
00909     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a188">ghrgnInvalid</a>    = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00910     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a188">ghrgnInvalid</a>;
00911 
00912     <span class="comment">/*</span>
00913 <span class="comment">     * Initialize DC cache</span>
00914 <span class="comment">     */</span>
00915     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a194">ghrgnGDC</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00916     fSuccess &amp;= !!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a194">ghrgnGDC</a>;
00917 
00918     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d4/d1/userk_8h.html#a394">DCE_SIZE_CACHEINIT</a>; i++) {
00919         fSuccess &amp;= !!<a class="code" href="../../d4/d1/userk_8h.html#a1699">CreateCacheDC</a>(NULL, DCX_INVALID | DCX_CACHE, NULL);
00920     }
00921 
00922     <span class="keywordflow">if</span> (!fSuccess) {
00923         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateCacheDC failed"</span>);
00924         <span class="keywordflow">goto</span> Exit;
00925     }
00926 
00927     <span class="comment">/*</span>
00928 <span class="comment">     * Let engine know that the display must be secure.</span>
00929 <span class="comment">     */</span>
00930 
00931     GreMarkDCUnreadable(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>);
00932 
00933     <span class="comment">/*</span>
00934 <span class="comment">     * LATER mikeke - if ghfontsys is changed anywhere but here</span>
00935 <span class="comment">     * we need to fix SetNCFont()</span>
00936 <span class="comment">     */</span>
00937     <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a> = (HFONT)GreGetStockObject(SYSTEM_FONT);
00938 
00939 <span class="preprocessor">#if DBG</span>
00940 <span class="preprocessor"></span>    <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(DEBUG) = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00941 <span class="preprocessor">#else</span>
00942 <span class="preprocessor"></span>    <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(DEBUG) = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00943 <span class="preprocessor">#endif</span>
00944 <span class="preprocessor"></span>
00945     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CLEANBOOT) = **((PULONG *)&amp;<a class="code" href="../../d8/d1/init_8h.html#a18">InitSafeBootMode</a>);
00946 
00947     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SLOWMACHINE) = 0;
00948 
00949     <span class="comment">/*</span>
00950 <span class="comment">     * Initialize system colors from registry.</span>
00951 <span class="comment">     */</span>
00952     <a class="code" href="../../d4/d1/userk_8h.html#a1838">xxxODI_ColorInit</a>(pProfileUserName);
00953 
00954     <span class="comment">/*</span>
00955 <span class="comment">     * Paint the screen background.</span>
00956 <span class="comment">     */</span>
00957     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d0/d3/structtagDESKTOP.html">DESKTOP</a>));
00958 
00959     UserAssert(fSuccess);
00960 
00961 Exit:
00962     <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
00963 
00964     <span class="keywordflow">return</span> fSuccess;
00965 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="fullscr.c::MonitorFromHdev" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> MonitorFromHdev           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hdev</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00415">415</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02074">tagMONITOR::hDev</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02203">tagDISPLAYINFO::pMonitorFirst</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02067">tagMONITOR::pMonitorNext</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>.
<p>
<pre class="fragment"><div>00416 {
00417     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor;
00418 
00419     <span class="keywordflow">for</span> (pMonitor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>; pMonitor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00420             pMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>) {
00421         <span class="keywordflow">if</span> (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o8">hDev</a> == hdev) {
00422             <span class="keywordflow">return</span> pMonitor;
00423         }
00424     }
00425     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00426 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="fullscr.c::RemoteDisableScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoteDisableScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01733">1733</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02718">tagWINDOWSTATION::dwWSF_Flags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00937">gbDesktopLocked</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00934">gspdeskDisconnect</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00936">gspdeskShouldBeForeground</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01640">LockDesktop</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02648">tagDESKTOP::rpwinstaParent</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01652">ThreadLockDesktop</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01664">ThreadUnlockDesktop</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l07427">TRACE_HYDAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02702">WSF_SWITCHLOCK</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>, and <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00446">xxxRemoteStopScreenUpdates()</a>.
<p>
<pre class="fragment"><div>01735 {
01736     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpdesk;
01737     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dwFlagsPrev;
01738     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>    ptiCurrent;
01739     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
01740     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01741 
01742     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
01743 
01744     <a class="code" href="../../d4/d1/userk_8h.html#a777">TRACE_HYDAPI</a>((<span class="stringliteral">"RemoteDisableScreen\n"</span>));
01745 
01746 
01747     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
01748 
01749     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a> != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a329">gspdeskDisconnect</a> &amp;&amp;
01750         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a329">gspdeskDisconnect</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01751 
01752         pwinsta = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a329">gspdeskDisconnect</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a>;
01753 
01754         <span class="comment">/*</span>
01755 <span class="comment">         * Save current desktop</span>
01756 <span class="comment">         */</span>
01757         UserAssert(grpdeskRitInput == pwinsta-&gt;pdeskCurrent);
01758 
01759         <a class="code" href="../../d4/d1/userk_8h.html#a126">LockDesktop</a>(&amp;gspdeskShouldBeForeground,
01760                     grpdeskRitInput,
01761                     LDL_DESKSHOULDBEFOREGROUND3, 0);
01762 
01763         <span class="comment">/*</span>
01764 <span class="comment">         * Set desktop switch lock</span>
01765 <span class="comment">         * (WSF_SWITCHLOCK must be clear for xxxSwitchDesktop to succeed)</span>
01766 <span class="comment">         */</span>
01767         dwFlagsPrev = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a>;
01768         pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a314">WSF_SWITCHLOCK</a>;
01769         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a331">gbDesktopLocked</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01770 
01771         <span class="comment">/*</span>
01772 <span class="comment">         * Switch to Disconnected desktop</span>
01773 <span class="comment">         */</span>
01774         <a class="code" href="../../d4/d1/userk_8h.html#a128">ThreadLockDesktop</a>(ptiCurrent, gspdeskDisconnect, &amp;tlpdesk, LDLT_FN_CTXDISABLESCREEN);
01775         <a class="code" href="../../d4/d1/userk_8h.html#a1798">xxxSwitchDesktop</a>(pwinsta, gspdeskDisconnect, FALSE);
01776         <a class="code" href="../../d4/d1/userk_8h.html#a130">ThreadUnlockDesktop</a>(ptiCurrent, &amp;tlpdesk, LDUT_FN_CTXDISABLESCREEN);
01777 
01778         pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> = dwFlagsPrev;
01779 
01780         <span class="comment">/*</span>
01781 <span class="comment">         * Disable screen updates</span>
01782 <span class="comment">         */</span>
01783         DrvDisableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
01784 
01785     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a329">gspdeskDisconnect</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01786         <span class="comment">/*</span>
01787 <span class="comment">         * For some reason the disconnected desktop was the current desktop.</span>
01788 <span class="comment">         * Now prevent switching from it.</span>
01789 <span class="comment">         */</span>
01790         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a331">gbDesktopLocked</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01791     }
01792 
01793     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01794 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="fullscr.c::RemoteRedrawRectangle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoteRedrawRectangle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Left</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Top</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Right</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Bottom</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01634">1634</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00936">gspdeskShouldBeForeground</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00061">gspwndFullScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00095">ISCSRSS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l07427">TRACE_HYDAPI</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l00299">xxxRedrawWindow()</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00814">CtxDisplayIOCtl()</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00552">NtUserRemoteRedrawRectangle()</a>.
<p>
<pre class="fragment"><div>01639 {
01640     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwnd;
01641     RECT rcl;
01642 
01643     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
01644 
01645     <a class="code" href="../../d4/d1/userk_8h.html#a777">TRACE_HYDAPI</a>((<span class="stringliteral">"RemoteRedrawRectangle\n"</span>));
01646 
01647     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a20">ISCSRSS</a>());
01648     <span class="comment">/*</span>
01649 <span class="comment">     * If xxxRemoteStopScreenUpdates has not been called,</span>
01650 <span class="comment">     * then just repaint the current foreground window.</span>
01651 <span class="comment">     */</span>
01652     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a330">gspdeskShouldBeForeground</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01653         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a15">gspwndFullScreen</a>) {
01654 
01655             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(gspwndFullScreen, &amp;tlpwnd);
01656 
01657             rcl.left   = Left;
01658             rcl.top    = Top;
01659             rcl.right  = Right;
01660             rcl.bottom = Bottom;
01661 
01662             vDrvInvalidateRect(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, &amp;rcl);
01663 
01664             <a class="code" href="../../d4/d1/userk_8h.html#a1679">xxxRedrawWindow</a>(gspwndFullScreen, &amp;rcl, NULL,
01665                             RDW_INVALIDATE | RDW_ALLCHILDREN |
01666                             RDW_ERASE | RDW_ERASENOW);
01667             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01668         }
01669     }
01670 
01671     <span class="keywordflow">return</span> STATUS_SUCCESS;
01672 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="fullscr.c::RemoteRedrawScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoteRedrawScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01675">1675</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02580">DF_DESTROYED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02650">tagDESKTOP::dwDTFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02718">tagWINDOWSTATION::dwWSF_Flags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00937">gbDesktopLocked</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00950">gbFreezeScreenUpdates</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00936">gspdeskShouldBeForeground</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01640">LockDesktop</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02648">tagDESKTOP::rpwinstaParent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01652">ThreadLockDesktop</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01664">ThreadUnlockDesktop</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l07427">TRACE_HYDAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02702">WSF_SWITCHLOCK</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00576">NtUserRemoteRedrawScreen()</a>, <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00781">RemotePassthruDisable()</a>, <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00700">RemoteShadowCleanup()</a>, <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00635">RemoteShadowStart()</a>, <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00188">xxxRemoteDisconnect()</a>, and <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00273">xxxRemoteReconnect()</a>.
<p>
<pre class="fragment"><div>01677 {
01678     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpdesk;
01679     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
01680     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dwFlagsPrev;
01681     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>    ptiCurrent;
01682 
01683     <a class="code" href="../../d4/d1/userk_8h.html#a777">TRACE_HYDAPI</a>((<span class="stringliteral">"RemoteRedrawScreen\n"</span>));
01684 
01685     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
01686 
01687     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a341">gbFreezeScreenUpdates</a>)
01688         <span class="keywordflow">return</span> STATUS_SUCCESS;
01689 
01690     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
01691 
01692     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a341">gbFreezeScreenUpdates</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01693 
01694     <span class="comment">/*</span>
01695 <span class="comment">     * Switch back to the previous desktop</span>
01696 <span class="comment">     */</span>
01697     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a330">gspdeskShouldBeForeground</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01698         RIPMSG0(RIP_WARNING, <span class="stringliteral">"RemoteRedrawScreen called with no gspdeskShouldBeForeground"</span>);
01699         <span class="keywordflow">return</span> STATUS_SUCCESS;
01700     }
01701 
01702     <span class="comment">/*</span>
01703 <span class="comment">     * Clear desktop switch lock</span>
01704 <span class="comment">     * (WSF_SWITCHLOCK must be clear for xxxSwitchDesktop to succeed)</span>
01705 <span class="comment">     */</span>
01706     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a331">gbDesktopLocked</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01707 
01708     pwinsta = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a330">gspdeskShouldBeForeground</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a>;
01709 
01710     dwFlagsPrev = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a>;
01711     pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a314">WSF_SWITCHLOCK</a>;
01712 
01713     <span class="comment">/*</span>
01714 <span class="comment">     * Switch back to previous desktop</span>
01715 <span class="comment">     */</span>
01716     <span class="keywordflow">if</span> (!(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a330">gspdeskShouldBeForeground</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o4">dwDTFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a287">DF_DESTROYED</a>)) {
01717         <a class="code" href="../../d4/d1/userk_8h.html#a128">ThreadLockDesktop</a>(ptiCurrent, gspdeskShouldBeForeground, &amp;tlpdesk, LDLT_FN_CTXREDRAWSCREEN);
01718         <a class="code" href="../../d4/d1/userk_8h.html#a1798">xxxSwitchDesktop</a>(pwinsta, gspdeskShouldBeForeground, FALSE);
01719         <a class="code" href="../../d4/d1/userk_8h.html#a130">ThreadUnlockDesktop</a>(ptiCurrent, &amp;tlpdesk, LDUT_FN_CTXREDRAWSCREEN);
01720         
01721         <span class="comment">/*</span>
01722 <span class="comment">         * Enable screen updates</span>
01723 <span class="comment">         */</span>
01724         DrvEnableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
01725     }
01726     pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> = dwFlagsPrev;
01727     <a class="code" href="../../d4/d1/userk_8h.html#a126">LockDesktop</a>(&amp;gspdeskShouldBeForeground, NULL, LDL_DESKSHOULDBEFOREGROUND2, 0 );
01728 
01729     <span class="keywordflow">return</span> STATUS_SUCCESS;
01730 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="fullscr.c::ResetSharedDesktops" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ResetSharedDesktops           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d3/structtagDISPLAYINFO.html">PDISPLAYINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pDIChanged</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pdeskChanged</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00985">985</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d9/d7/winsta_8c-source.html#l01240">_GetProcessWindowStation()</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00523">CalcVisRgn()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00057">CreateEmptyRgn()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00424">gptSSCursor</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00648">grpWinStaList</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02645">tagDESKTOP::pDispInfo</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02202">tagDISPLAYINFO::pMonitorPrimary</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03828">PWND_TOP</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02648">tagDESKTOP::rpwinstaParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02829">TIF_CSRSSTHREAD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02828">TIF_SYSTEMTHREAD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01117">TRACE_SWITCH</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l01468">xxxSetWindowPos()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00114">zzzInternalSetCursorPos()</a>, and <a class="el" href="../../d9/d2/dc_8c-source.html#l01812">zzzInvalidateDCCache()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>.
<p>
<pre class="fragment"><div>00988 {
00989     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta = <a class="code" href="../../d8/d8/winsta_8c.html#a11">_GetProcessWindowStation</a>(NULL);
00990     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>       pdesk;
00991     HRGN           hrgn;
00992     POINT          pt;
00993     PRECT          prc;
00994     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00995 
00996     <span class="comment">/*</span>
00997 <span class="comment">     * If this is CSRSS doing the dynamic resolution change then use</span>
00998 <span class="comment">     * WinSta0 since the process windowstation is NULL for CSRSS.</span>
00999 <span class="comment">     */</span>
01000     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a> &amp;&amp; pwinsta == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a>) {
01001         pwinsta = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a241">grpWinStaList</a>;
01002     }
01003 
01004     <span class="keywordflow">if</span> (pwinsta == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01005 
01006         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a798">TIF_CSRSSTHREAD</a>|<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a797">TIF_SYSTEMTHREAD</a>))
01007         {
01008             pwinsta =  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a>;
01009         }
01010         <span class="keywordflow">else</span>
01011         {
01012             <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"ResetSharedDesktops - NULL window station !\n"</span>));
01013             <span class="keywordflow">return</span>;
01014         }
01015     }
01016 
01017     <span class="keywordflow">for</span> (pdesk = pwinsta-&gt;rpdeskList; pdesk; pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>) {
01018 
01019         <span class="comment">/*</span>
01020 <span class="comment">         * Make sure this is a shared DISPINFO.</span>
01021 <span class="comment">         */</span>
01022         <span class="keywordflow">if</span> (pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o1">pDispInfo</a> == pDIChanged) {
01023 
01024 <span class="preprocessor">#if 0</span>
01025 <span class="preprocessor"></span>            <span class="comment">/*</span>
01026 <span class="comment">             * This is the preferable method to set the desktop-window.</span>
01027 <span class="comment">             * However, this causes synchronization problems where we</span>
01028 <span class="comment">             * leave the critical-section allowing other apps to call</span>
01029 <span class="comment">             * ChangeDisplaySettings() and thus mucking up the works.</span>
01030 <span class="comment">             *</span>
01031 <span class="comment">             * By calculating the vis-rgn ourselves, we can assure that</span>
01032 <span class="comment">             * the clipping is current for the desktop even when we leave</span>
01033 <span class="comment">             * the section.</span>
01034 <span class="comment">             */</span>
01035             {
01036                 <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
01037 
01038                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>, &amp;tlpwnd);
01039                 <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01040                                 PWND_TOP,
01041                                 pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.left,
01042                                 pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.top,
01043                                 pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.right - pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.left,
01044                                 pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.bottom - pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.top,
01045                                 SWP_NOZORDER | SWP_NOACTIVATE);
01046                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01047             }
01048 <span class="preprocessor">#else</span>
01049 <span class="preprocessor"></span>            <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, &amp;pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>);
01050             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>, &amp;pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>);
01051 <span class="preprocessor">#endif</span>
01052 <span class="preprocessor"></span>        }
01053     }
01054 
01055     <span class="comment">/*</span>
01056 <span class="comment">     * Recalc the desktop visrgn.  Since the hdcScreen is shared amoungts</span>
01057 <span class="comment">     * all the</span>
01058 <span class="comment">     */</span>
01059     hrgn = <a class="code" href="../../d4/d1/userk_8h.html#a1162">CreateEmptyRgn</a>();
01060     <a class="code" href="../../d3/d6/visrgn_8c.html#a17">CalcVisRgn</a>(&amp;hrgn,
01061                pdeskChanged-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01062                pdeskChanged-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01063                DCX_WINDOW);
01064 
01065     GreSelectVisRgn(pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, hrgn, SVR_DELETEOLD);
01066 
01067     <span class="comment">/*</span>
01068 <span class="comment">     * Invalidate all DCE's visrgns.</span>
01069 <span class="comment">     */</span>
01070     <a class="code" href="../../d4/d1/userk_8h.html#a1004">zzzInvalidateDCCache</a>(pdeskChanged-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>, 0);
01071 
01072     <span class="comment">/*</span>
01073 <span class="comment">     * Position mouse so that it is within the new visrgn, once we</span>
01074 <span class="comment">     * recalc it.</span>
01075 <span class="comment">     */</span>
01076     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o1">pDispInfo</a> == pDIChanged) {
01077         prc = &amp;pDIChanged-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a>-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>;
01078         pt.x = (prc-&gt;right - prc-&gt;left) / 2;
01079         pt.y = (prc-&gt;bottom - prc-&gt;top) / 2;
01080 
01081         <span class="comment">/*</span>
01082 <span class="comment">         * Remember new mouse pos. Makes sure we don't wake the screensaver.</span>
01083 <span class="comment">         */</span>
01084         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a159">gptSSCursor</a> = pt;
01085         <a class="code" href="../../d4/d1/userk_8h.html#a1179">zzzInternalSetCursorPos</a>(pt.x, pt.y);
01086     }
01087 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="fullscr.c::ResetSystemColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ResetSystemColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01127">1127</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01838">BEGINATOMICCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01842">ENDATOMICCHECK</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01311">SSCF_FORCESOLIDCOLOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01312">SSCF_SETMAGICCOLORS</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a1774">xxxSetSysColors()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>.
<p>
<pre class="fragment"><div>01128 {
01129     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>         i;
01130     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>         colorIndex[COLOR_MAX];
01131     COLORREF    colorValue[COLOR_MAX];
01132 
01133     <span class="keywordflow">for</span> (i = 0; i &lt; COLOR_MAX; i++) {
01134         colorIndex[i] = i;
01135         colorValue[i] = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[i];
01136     }
01137 
01138     <a class="code" href="../../d4/d1/userk_8h.html#a159">BEGINATOMICCHECK</a>();
01139     <a class="code" href="../../d4/d1/userk_8h.html#a1774">xxxSetSysColors</a>(NULL, i, colorIndex, colorValue, SSCF_FORCESOLIDCOLOR |
01140             SSCF_SETMAGICCOLORS);
01141     <a class="code" href="../../d4/d1/userk_8h.html#a163">ENDATOMICCHECK</a>();
01142 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="fullscr.c::SetMonitorData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> SetMonitorData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMonitor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>iDev</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00479">479</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00449">CreateMonitor()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02156">tagMONITOR::dwMONFlags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00244">EqualRect</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00066">gpMonitorCached</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02074">tagMONITOR::hDev</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02054">MONF_VISIBLE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02202">tagDISPLAYINFO::pMonitorPrimary</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00186">SET_OR_CLEAR_FLAG</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>.
<p>
<pre class="fragment"><div>00480 {
00481     PMDEV pmdev = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>;
00482     HDEV hdev = pmdev-&gt;Dev[iDev].hdev;
00483     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fVisible = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00484     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fPrimary = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00485     HDC hdcTmp;
00486 
00487     UserAssert(iDev &lt; pmdev-&gt;chdev);
00488 
00489     <span class="keywordflow">if</span> (hdcTmp = GreCreateDisplayDC(hdev, DCTYPE_DIRECT, FALSE)) {
00490         <span class="keywordflow">if</span> (GreGetDeviceCaps(hdcTmp, CAPS1) &amp; C1_MIRROR_DEVICE) {
00491             fVisible = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00492         }
00493         GreDeleteDC(hdcTmp);
00494     }
00495 
00496     <span class="keywordflow">if</span> (fVisible &amp;&amp; (pmdev-&gt;Dev[iDev].rect.top == 0) &amp;&amp;
00497             (pmdev-&gt;Dev[iDev].rect.left == 0)) {
00498         fPrimary = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00499     }
00500 
00501     <span class="keywordflow">if</span> (pMonitor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00502         <span class="keywordflow">if</span> (fPrimary) {
00503             UserAssert(gpMonitorCached != NULL);
00504             pMonitor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a16">gpMonitorCached</a>;
00505             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a16">gpMonitorCached</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00506         } <span class="keywordflow">else</span> {
00507             pMonitor = <a class="code" href="../../d8/d8/fullscr_8c.html#a13">CreateMonitor</a>();
00508         }
00509     }
00510 
00511     <span class="keywordflow">if</span> (pMonitor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00512         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00513     }
00514 
00515     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a15">SET_OR_CLEAR_FLAG</a>(pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a>, MONF_VISIBLE, fVisible);
00516 
00517     <span class="comment">/*</span>
00518 <span class="comment">     * When the monitor rect is changing, size the work area so the same</span>
00519 <span class="comment">     * amount as before is clipped off each edge.</span>
00520 <span class="comment">     */</span>
00521     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a34">EqualRect</a>(&amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>, &amp;pmdev-&gt;Dev[iDev].rect)) {
00522         pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.left = pmdev-&gt;Dev[iDev].rect.left -
00523                 (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.left);
00524         pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.top = pmdev-&gt;Dev[iDev].rect.top -
00525                 (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.top);
00526         pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.right = pmdev-&gt;Dev[iDev].rect.right -
00527                 (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.right);
00528         pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.bottom = pmdev-&gt;Dev[iDev].rect.bottom -
00529                 (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.bottom);
00530     }
00531     pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a> = pmdev-&gt;Dev[iDev].rect;
00532     pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o8">hDev</a> = hdev;
00533 
00534     <span class="keywordflow">if</span> (fPrimary) {
00535         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a> = pMonitor;
00536     }
00537 
00538     <span class="keywordflow">return</span> pMonitor;
00539 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="fullscr.c::SetVDMCursorBounds" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetVDMCursorBounds           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPRECT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lprc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00351">351</a> of file <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html">ntuser/kernel/cursor.c</a>.
<p>
<pre class="fragment"><div>00353 {
00354     <span class="keywordflow">if</span> (lprc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00355 
00356         <span class="comment">/*</span>
00357 <span class="comment">         * Set grcVDMCursorBounds before TEST_PUDF(PUDF_VDMBOUNDSACTIVE), because</span>
00358 <span class="comment">         * MoveEvent() calls BoundCursor() from outside the USER CritSect!</span>
00359 <span class="comment">         */</span>
00360         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a85">grcVDMCursorBounds</a> = *lprc;
00361         <a class="code" href="../../d4/d1/userk_8h.html#a659">SET_PUDF</a>(PUDF_VDMBOUNDSACTIVE);
00362 
00363     } <span class="keywordflow">else</span> {
00364 
00365         <span class="comment">/*</span>
00366 <span class="comment">         * Turn vdm bounds off.</span>
00367 <span class="comment">         */</span>
00368         <a class="code" href="../../d4/d1/userk_8h.html#a660">CLEAR_PUDF</a>(PUDF_VDMBOUNDSACTIVE);
00369     }
00370 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="fullscr.c::TrackFullscreenMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID TrackFullscreenMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwFlags</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01251">1251</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00429">gppiFullscreen</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>.
<p>
<pre class="fragment"><div>01252 {
01253     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_FULLSCREEN) {
01254         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a160">gppiFullscreen</a> = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;ppi;
01255     } <span class="keywordflow">else</span> {
01256         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a160">gppiFullscreen</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01257     }
01258 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="fullscr.c::UpdateUserScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UpdateUserScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">564</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02209">tagDISPLAYINFO::BitCountMax</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02201">tagDISPLAYINFO::cMonitors</a>, <a class="el" href="../../d2/d4/multimon_8c-source.html#l00249">DestroyMonitor()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02208">tagDISPLAYINFO::dmLogPixels</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02156">tagMONITOR::dwMONFlags</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02782">EnforceColorDependentSettings()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02212">tagDISPLAYINFO::fAnyPalette</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02211">tagDISPLAYINFO::fDesktopIsRect</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00622">gaptMouse</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01829">GetCharDimensions()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00066">gpMonitorCached</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00648">grpWinStaList</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02074">tagMONITOR::hDev</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00432">HdevFromMonitor()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01768">tagWND::hrgnClip</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02071">tagMONITOR::hrgnMonitor</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02119">tagDISPLAYINFO::hrgnScreen</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01758">MAX_MOUSEPOINTS</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02055">MONF_PALETTEDISPLAY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02054">MONF_VISIBLE</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00415">MonitorFromHdev()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02645">tagDESKTOP::pDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02203">tagDISPLAYINFO::pMonitorFirst</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02067">tagMONITOR::pMonitorNext</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02202">tagDISPLAYINFO::pMonitorPrimary</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01071">PUSIF_PALETTEDISPLAY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00116">PZERO</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02712">tagWINDOWSTATION::rpdeskList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02711">tagWINDOWSTATION::rpwinstaNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00186">SET_OR_CLEAR_FLAG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01080">SET_OR_CLEAR_PUSIF</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00336">SetDesktopMetrics()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00479">SetMonitorData()</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00115">SetOrCreateRectRgnIndirectPublic()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00245">SetRectEmpty</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01116">TRACE_INIT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02223">UnionRgn</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00775">InitUserScreen()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>.
<p>
<pre class="fragment"><div>00565 {
00566     PMDEV           pmdev = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>;
00567     ULONG           i;
00568     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>        pMonitor;
00569     TEXTMETRIC      tm;
00570     <span class="keywordtype">int</span>             iRgn;
00571     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a>  pwinsta;
00572     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>        pdesk;
00573     HRGN            hrgn;
00574     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            fPaletteDisplay;
00575     RECT            rc;
00576     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitorNext = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>;
00577     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> *ppMonitorLast = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>;
00578 
00579 
00580     <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"UpdateUserScreen\n"</span>));
00581 
00582     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>);
00583     UserAssert(gpMonitorCached != NULL);
00584 
00585     <span class="comment">/*</span>
00586 <span class="comment">     * Keep HMONITOR for the hdev that is the same.  Delete the</span>
00587 <span class="comment">     * monitors that weren't found in the new hdev list.</span>
00588 <span class="comment">     */</span>
00589     <span class="keywordflow">while</span> (pMonitorNext != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00590         pMonitor = pMonitorNext;
00591         pMonitorNext = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>;
00592 
00593         <span class="keywordflow">if</span> ((i = <a class="code" href="../../d4/d1/userk_8h.html#a2081">HdevFromMonitor</a>(pMonitor)) == -1) {
00594             <a class="code" href="../../d4/d1/userk_8h.html#a2079">DestroyMonitor</a>(pMonitor);
00595         } <span class="keywordflow">else</span> {
00596             <a class="code" href="../../d8/d8/fullscr_8c.html#a15">SetMonitorData</a>(pMonitor, i);
00597             ppMonitorLast = &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>;
00598         }
00599     }
00600 
00601     <span class="comment">/*</span>
00602 <span class="comment">     * Create monitors for the hdevs that aren't yet on the monitor list.</span>
00603 <span class="comment">     */</span>
00604     <span class="keywordflow">for</span> (i = 0; i &lt; pmdev-&gt;chdev; i++) {
00605         <span class="keywordflow">if</span> ((pMonitor = <a class="code" href="../../d8/d8/fullscr_8c.html#a11">MonitorFromHdev</a>(pmdev-&gt;Dev[i].hdev)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00606 
00607             <span class="comment">/*</span>
00608 <span class="comment">             * Try to create a new monitor.</span>
00609 <span class="comment">             */</span>
00610             pMonitor = <a class="code" href="../../d8/d8/fullscr_8c.html#a15">SetMonitorData</a>(NULL, i);
00611 
00612             <span class="keywordflow">if</span> (pMonitor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00613                 *ppMonitorLast = pMonitor;
00614                 ppMonitorLast = &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>;
00615             }
00616         }
00617     }
00618 
00619     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a> != NULL);
00620     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a> != NULL);
00621 
00622     <span class="comment">/*</span>
00623 <span class="comment">     * For now, all monitors have the same display format.</span>
00624 <span class="comment">     */</span>
00625     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SAMEDISPLAYFORMAT) = (pmdev-&gt;ulFlags &amp; MDEV_MISMATCH_COLORDEPTH) ? <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00626     fPaletteDisplay = GreGetDeviceCaps(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, RASTERCAPS) &amp; RC_PALETTE;
00627     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o19">fAnyPalette</a> = !!fPaletteDisplay;
00628 
00629     <span class="comment">/*</span>
00630 <span class="comment">     * Determine the coordinates of the virtual desktop.</span>
00631 <span class="comment">     * Compute cMonitors as the number of visible monitors.</span>
00632 <span class="comment">     */</span>
00633     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(&amp;rc);
00634 
00635     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o11">cMonitors</a> = 0;
00636     <span class="keywordflow">for</span> (pMonitor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>;
00637         pMonitor;
00638         pMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>) {
00639 
00640         <span class="comment">/*</span>
00641 <span class="comment">         * Only visible monitors contribute to the desktop area</span>
00642 <span class="comment">         */</span>
00643         <span class="keywordflow">if</span> (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a525">MONF_VISIBLE</a>) {
00644             rc.left = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(rc.left, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left);
00645             rc.top = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(rc.top, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top);
00646             rc.right = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(rc.right, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right);
00647             rc.bottom = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(rc.bottom, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom);
00648 
00649             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o11">cMonitors</a>++;
00650         }
00651 
00652         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SAMEDISPLAYFORMAT)) {
00653             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a15">SET_OR_CLEAR_FLAG</a>(pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a>, MONF_PALETTEDISPLAY, fPaletteDisplay);
00654         } <span class="keywordflow">else</span> {
00655             <span class="keywordflow">if</span> (GreIsPaletteDisplay(pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o8">hDev</a>)) {
00656                 pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a526">MONF_PALETTEDISPLAY</a>;
00657                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o19">fAnyPalette</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00658             }
00659         }
00660     }
00661     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a> != NULL);
00662     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a> = rc;
00663 
00664     <span class="comment">/*</span>
00665 <span class="comment">     * Update system metrics</span>
00666 <span class="comment">     */</span>
00667     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSCREEN)        = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a>-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right;
00668     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSCREEN)        = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a>-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom;
00669     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(XVIRTUALSCREEN)  = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.left;
00670     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(YVIRTUALSCREEN)  = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.top;
00671     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVIRTUALSCREEN) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.right - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.left;
00672     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVIRTUALSCREEN) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.bottom - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>.top;
00673     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMAXTRACK)      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVIRTUALSCREEN) + (2 * (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZEFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE)));
00674     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMAXTRACK)      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVIRTUALSCREEN) + (2 * (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE)));
00675     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CMONITORS)       = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o11">cMonitors</a>;
00676 
00677     <span class="comment">/*</span>
00678 <span class="comment">     * Bug 281219: flush out the mouse move points if a mode change occured</span>
00679 <span class="comment">     */</span>
00680     RtlZeroMemory(gaptMouse, MAX_MOUSEPOINTS * <span class="keyword">sizeof</span>(MOUSEMOVEPOINT));
00681 
00682     <a class="code" href="../../d4/d5/rare_8c.html#a14">SetDesktopMetrics</a>();
00683 
00684     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o16">dmLogPixels</a> = (WORD)GreGetDeviceCaps(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, LOGPIXELSY);
00685 
00686     UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o16">dmLogPixels</a> != 0);
00687 
00688     <span class="comment">/*</span>
00689 <span class="comment">     * Get per-monitor or sum of monitor information, including:</span>
00690 <span class="comment">     *     The desktop region.</span>
00691 <span class="comment">     *     The region of each monitor.</span>
00692 <span class="comment">     *     Min bit counts - Not for NT SP2.</span>
00693 <span class="comment">     *     Same color format - Not for NT SP2.</span>
00694 <span class="comment">     */</span>
00695 
00696     <a class="code" href="../../d3/d6/visrgn_8c.html#a13">SetOrCreateRectRgnIndirectPublic</a>(&amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o15">hrgnScreen</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a6">PZERO</a>(RECT));
00697 
00698     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o15">hrgnScreen</a>) {
00699 
00700         <span class="keywordflow">for</span> (pMonitor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>;
00701             pMonitor;
00702             pMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>) {
00703 
00704             <span class="comment">/*</span>
00705 <span class="comment">             *  We want to set up hrgnMonitor for all monitors, visible or not</span>
00706 <span class="comment">             */</span>
00707             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/visrgn_8c.html#a13">SetOrCreateRectRgnIndirectPublic</a>(&amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>,
00708                                                  &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>)) {
00709 
00710                 <span class="comment">/*</span>
00711 <span class="comment">                 *  But we want only visible monitors to contribute to hrgnScreen</span>
00712 <span class="comment">                 */</span>
00713                 <span class="keywordflow">if</span> (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a525">MONF_VISIBLE</a>) {
00714                     iRgn = <a class="code" href="../../d4/d1/userk_8h.html#a230">UnionRgn</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o15">hrgnScreen</a>,
00715                                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o15">hrgnScreen</a>,
00716                                     pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>);
00717                 }
00718 
00719             }
00720         }
00721 
00722         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o18">fDesktopIsRect</a> = (iRgn == SIMPLEREGION);
00723     }
00724 
00725 
00726     <span class="comment">/*</span>
00727 <span class="comment">     * Reset the window region of desktop windows.</span>
00728 <span class="comment">     */</span>
00729     hrgn = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o18">fDesktopIsRect</a>) ? <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o15">hrgnScreen</a>;
00730     <span class="keywordflow">for</span> (pwinsta = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a241">grpWinStaList</a>; pwinsta; pwinsta = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o0">rpwinstaNext</a>) {
00731         <span class="keywordflow">for</span> (pdesk = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>; pdesk; pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>) {
00732             <span class="keywordflow">if</span> (pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o1">pDispInfo</a> == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>) {
00733                 pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> = hrgn;
00734             }
00735         }
00736     }
00737 
00738     <span class="comment">/*</span>
00739 <span class="comment">     * Updated information stored in gpsi.</span>
00740 <span class="comment">     */</span>
00741     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;Planes        = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)GreGetDeviceCaps(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, PLANES);
00742     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitsPixel     = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)GreGetDeviceCaps(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, BITSPIXEL);
00743     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount      = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;Planes * <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitsPixel;
00744     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o17">BitCountMax</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount;
00745     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a372">SET_OR_CLEAR_PUSIF</a>(PUSIF_PALETTEDISPLAY, fPaletteDisplay);
00746     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dmLogPixels   = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o16">dmLogPixels</a>;
00747     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;rcScreen      = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>;
00748     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a72">GetCharDimensions</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), &amp;tm, &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cySysFontChar);
00749     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;tmSysFont     = tm;
00750 
00751     <a class="code" href="../../d7/d1/w32_2ntuser_2kernel_2init_8c.html#a61">EnforceColorDependentSettings</a>();
00752 
00753 <span class="preprocessor">#if DBG</span>
00754 <span class="preprocessor"></span>    VerifyVisibleMonitorCount();
00755 <span class="preprocessor">#endif</span>
00756 <span class="preprocessor"></span>
00757     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00758 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="fullscr.c::UserSetDelayedChangeBroadcastForAllDesktops" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserSetDelayedChangeBroadcastForAllDesktops           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pCurrentDesktop</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00056">56</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l02590">DF_NEWDISPLAYSETTINGS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02650">tagDESKTOP::dwDTFlags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00648">grpWinStaList</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02712">tagWINDOWSTATION::rpdeskList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>.
<p>
<pre class="fragment"><div>00058 {
00059     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
00060     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>       pdesk;
00061 
00062     <span class="comment">/*</span>
00063 <span class="comment">     * Get a pointer to the windowstation so we can change display</span>
00064 <span class="comment">     * setting for all of its destops.</span>
00065 <span class="comment">     */</span>
00066     <span class="keywordflow">if</span> ((pwinsta = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a241">grpWinStaList</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00067         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UserSaveCurrentModeForAllDesktops - No interactive WindowStation!!!\n"</span>);
00068         <span class="keywordflow">return</span>;
00069     }
00070 
00071     <span class="comment">/*</span>
00072 <span class="comment">     * Walk all the desktops of the winstation and, for each of them,</span>
00073 <span class="comment">     * just set its delayed Broadcast indicator to TRUE so that</span>
00074 <span class="comment">     * next switch to that destop will force Display Settings change</span>
00075 <span class="comment">     * messages to be broadcasted to windows of that desktop.</span>
00076 <span class="comment">     */</span>
00077     pdesk = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>;
00078 
00079     <span class="keywordflow">while</span> (pdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00080         <span class="keywordflow">if</span> (pdesk != pCurrentDesktop) {
00081             pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o4">dwDTFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a297">DF_NEWDISPLAYSETTINGS</a>;
00082         }
00083         pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>;
00084     }
00085 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="fullscr.c::xxxbFullscreenSwitch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxbFullscreenSwitch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bFullscreenSwitch</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01545">1545</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00463">gbFullScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02573">GetFullScreen</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00043">idSwitcher</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00041">NOSWITCHER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06584">PUDF_ANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01116">TRACE_INIT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>, <a class="el" href="../../d1/d8/showwin_8c-source.html#l00085">xxxShowWindow()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04382">xxxSleepThread()</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l01430">xxxUpdateWindow()</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l06445">xxxConsoleControl()</a>.
<p>
<pre class="fragment"><div>01548 {
01549 
01550     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
01551     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwnd;
01552     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bStat = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01553 
01554     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
01555 
01556     <span class="keywordflow">if</span> (!pwnd) {
01557         <span class="keywordflow">return</span> DISP_CHANGE_BADPARAM;
01558     }
01559 
01560     <span class="comment">/*</span>
01561 <span class="comment">     * Lock the PWND, if it is provided</span>
01562 <span class="comment">     */</span>
01563 
01564     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
01565 
01566     <span class="comment">/*</span>
01567 <span class="comment">     * We don't want our mode switch to be posted on the looping thread.</span>
01568 <span class="comment">     * So let's loop until the system has settled down and no mode switch</span>
01569 <span class="comment">     * is currently occuring.</span>
01570 <span class="comment">     */</span>
01571 
01572     <span class="keywordflow">while</span> (<a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> != <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>) {
01573         <span class="comment">/*</span>
01574 <span class="comment">         * Make sure we aren't blocking anyone who's sending us a message.</span>
01575 <span class="comment">         * They can have idSwitcher and never release it because they are</span>
01576 <span class="comment">         * waiting on us to process the sent message. And we're waiting on</span>
01577 <span class="comment">         * idSwitcher, hence a deadlock.</span>
01578 <span class="comment">         */</span>
01579         <a class="code" href="../../d4/d1/userk_8h.html#a1196">xxxSleepThread</a>(0, 1, FALSE);
01580     }
01581 
01582     <span class="comment">/*</span>
01583 <span class="comment">     * If there is a window, we want to check the state of the window.</span>
01584 <span class="comment">     * For most calls, we want to ensure we are in windowed mode.</span>
01585 <span class="comment">     * However, for Console, we want to make sure we are in fullscreen mode.</span>
01586 <span class="comment">     * So differentiate between the two.  We will check if the TEXTMODE</span>
01587 <span class="comment">     * flag is passed in the DEVMODE.</span>
01588 <span class="comment">     */</span>
01589 
01590     <span class="keywordflow">if</span> (bFullscreenSwitch) {
01591 
01592         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a744">GetFullScreen</a>(pwnd) != FULLSCREEN) {
01593 
01594             <a class="code" href="../../d4/d1/userk_8h.html#a1607">xxxShowWindow</a>(pwnd, SW_SHOWMINIMIZED | <a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_ANIMATE));
01595 
01596             <a class="code" href="../../d4/d1/userk_8h.html#a1673">xxxUpdateWindow</a>(pwnd);
01597         }
01598 
01599         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1756">xxxMakeWindowForegroundWithState</a>(pwnd, FULLSCREEN)) {
01600             <span class="keywordflow">goto</span> FullscreenSwitchFailed;
01601         }
01602 
01603         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> != <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>) ||
01604             (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a178">gbFullScreen</a> != FULLSCREEN)) {
01605             <span class="keywordflow">goto</span> FullscreenSwitchFailed;
01606         }
01607 
01608     } <span class="keywordflow">else</span> {
01609 
01610         <span class="comment">/*</span>
01611 <span class="comment">         * For the console windows, we want to call with WINDOWED</span>
01612 <span class="comment">         */</span>
01613 
01614         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1756">xxxMakeWindowForegroundWithState</a>(pwnd, WINDOWED)) {
01615             <span class="keywordflow">goto</span> FullscreenSwitchFailed;
01616         }
01617 
01618         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> != <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>) ||
01619             (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a178">gbFullScreen</a> != GDIFULLSCREEN)) {
01620 
01621             FullscreenSwitchFailed:
01622             <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"ChangeDisplaySettings: Can not switch out of fullscreen\n"</span>));
01623             bStat = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01624         }
01625     }
01626 
01627     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01628 
01629     <span class="keywordflow">return</span> bStat;
01630 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="fullscr.c::xxxBroadcastDisplaySettingsChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxBroadcastDisplaySettingsChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pdesk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bBroadcastColorChange</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01797">1797</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03790">BMSG_SENDNOTIFYMSG</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l02937">xxxBroadcastMessage()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>.
<p>
<pre class="fragment"><div>01800 {
01801 
01802     <span class="comment">/*</span>
01803 <span class="comment">     * Broadcast that the display has changed resolution.  We are going</span>
01804 <span class="comment">     * to specify the desktop for the changing-desktop.  That way we</span>
01805 <span class="comment">     * don't get confused as to what desktop to broadcast to.</span>
01806 <span class="comment">     */</span>
01807     <a class="code" href="../../d4/d1/userk_8h.html#a1475">xxxBroadcastMessage</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01808                        WM_DISPLAYCHANGE,
01809                        <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount,
01810                        MAKELONG(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSCREEN), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSCREEN)),
01811                        BMSG_SENDNOTIFYMSG,
01812                        NULL);
01813 
01814     <span class="comment">/*</span>
01815 <span class="comment">     * Broadcast a color-change if requested to do so.</span>
01816 <span class="comment">     */</span>
01817 
01818     <span class="keywordflow">if</span> (bBroadcastColorChange){
01819 <span class="preprocessor">#if 1 // We might want to remove this call, since color-change seems</span>
01820 <span class="preprocessor"></span>       <span class="comment">// to provide apps the notification.  Need to review</span>
01821        <span class="comment">// chriswil - 06/11/96</span>
01822 
01823        <a class="code" href="../../d4/d1/userk_8h.html#a1475">xxxBroadcastMessage</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01824                           WM_SETTINGCHANGE,
01825                           0,
01826                           0,
01827                           BMSG_SENDNOTIFYMSG,
01828                           NULL);
01829 <span class="preprocessor">#endif</span>
01830 <span class="preprocessor"></span>
01831        <a class="code" href="../../d4/d1/userk_8h.html#a1475">xxxBroadcastMessage</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01832                           WM_SYSCOLORCHANGE,
01833                           0,
01834                           0,
01835                           BMSG_SENDNOTIFYMSG,
01836                           NULL);
01837     }
01838 
01839 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="fullscr.c::xxxMakeWindowForegroundWithState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxMakeWindowForegroundWithState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NewState</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">166</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06611">CLEAR_PUDF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00023">fGdiEnabled</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00044">fRedoFullScreenSwitch</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03852">FULLSCREEN_CAPTURE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00463">gbFullScreen</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02573">GetFullScreen</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00210">gpcurLogCurrent</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00211">gpcurPhysCurrent</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00101">gpqCursor</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00046">gptCursorFullScreen</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00424">gptSSCursor</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00061">gspwndFullScreen</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00054">gspwndShouldBeForeground</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01477">HMIsMarkDestroy</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00043">idSwitcher</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03600">ISTS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l00802">LockWindowUpdate2()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00041">NOSWITCHER</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06598">PUDF_LOCKFULLSCREEN</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06610">SET_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02574">SetFullScreen</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00676">SetPointer()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00351">SetVDMCursorBounds()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03111">tagQ::spwndActive</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01117">TRACE_SWITCH</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00124">xxxCapture()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l00299">xxxRedrawWindow()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00114">zzzInternalSetCursorPos()</a>.
<p>
Referenced by <a class="el" href="../../d4/d5/focusact_8c-source.html#l00472">xxxActivateThisWindow()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01545">xxxbFullscreenSwitch()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00883">xxxDesktopWndProc()</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l01342">xxxSetForegroundWindow2()</a>, <a class="el" href="../../d1/d8/showwin_8c-source.html#l00085">xxxShowWindow()</a>, and <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00193">xxxSysCommand()</a>.
<p>
<pre class="fragment"><div>00169 {
00170     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNewFG;
00171     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndNewFG;
00172 
00173     <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"Switching: xxxMakeWindowForeground: Enter\n"</span>));
00174     <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"\t \t pwnd     = %08lx\n"</span>, pwnd));
00175     <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"\t \t NewState = %d\n"</span>, NewState));
00176 
00177     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00178     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00179 
00180     <span class="comment">/*</span>
00181 <span class="comment">     * If we should switch to a specific window save that window</span>
00182 <span class="comment">     */</span>
00183 
00184     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00185 
00186         <span class="keywordflow">if</span> (NewState == GDIFULLSCREEN) {
00187             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;gspwndShouldBeForeground, pwnd);
00188         }
00189 
00190         <span class="comment">/*</span>
00191 <span class="comment">         * Change to the new state</span>
00192 <span class="comment">         */</span>
00193 
00194         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a745">SetFullScreen</a>(pwnd, NewState);
00195 
00196         <span class="keywordflow">if</span> (NewState == FULLSCREEN &amp;&amp;
00197             (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00198              <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a> != pwnd)) {
00199 
00200             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a745">SetFullScreen</a>(pwnd, FULLSCREENMIN);
00201         }
00202     }
00203 
00204     <span class="comment">//</span>
00205     <span class="comment">// Since we leave the critical section during the switch, some other</span>
00206     <span class="comment">// thread could come into this routine and request a switch.  The global</span>
00207     <span class="comment">// will be reset, and we will use the loop to perform the next switch.</span>
00208     <span class="comment">//</span>
00209 
00210     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> != <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>) {
00211         <a class="code" href="../../d8/d8/fullscr_8c.html#a3">fRedoFullScreenSwitch</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00212         <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"Switching: xxxMakeWindowForeground was posted: Exit\n"</span>));
00213 
00214         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00215     }
00216 
00217     UserAssert(!fRedoFullScreenSwitch);
00218     <a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueThread;
00219 
00220     <span class="comment">/*</span>
00221 <span class="comment">     * We loop, switching full screens until all states have stabilized</span>
00222 <span class="comment">     */</span>
00223 
00224     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00225         <span class="comment">/*</span>
00226 <span class="comment">         * figure out who should be foreground</span>
00227 <span class="comment">         */</span>
00228         <a class="code" href="../../d8/d8/fullscr_8c.html#a3">fRedoFullScreenSwitch</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00229 
00230         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a12">gspwndShouldBeForeground</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00231             pwndNewFG = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a12">gspwndShouldBeForeground</a>;
00232             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;gspwndShouldBeForeground);
00233         } <span class="keywordflow">else</span> {
00234             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00235                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00236 
00237                 pwndNewFG = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>;
00238 
00239                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a744">GetFullScreen</a>(pwndNewFG) == WINDOWED ||
00240                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a744">GetFullScreen</a>(pwndNewFG) == FULLSCREENMIN) {
00241 
00242                     pwndNewFG = <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwndNewFG);
00243                 }
00244             } <span class="keywordflow">else</span> {
00245                 <span class="comment">/*</span>
00246 <span class="comment">                 * No active window, switch to current desktop</span>
00247 <span class="comment">                 */</span>
00248                 pwndNewFG = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>;
00249             }
00250         }
00251 
00252         <span class="comment">/*</span>
00253 <span class="comment">         * We don't need to switch if the right window is already foreground</span>
00254 <span class="comment">         */</span>
00255         <span class="keywordflow">if</span> (pwndNewFG == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a15">gspwndFullScreen</a>) {
00256             <span class="keywordflow">break</span>;
00257         }
00258 
00259         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndNewFG, &amp;tlpwndNewFG);
00260 
00261         {
00262             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bStateNew = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a744">GetFullScreen</a>(pwndNewFG);
00263             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndOldFG;
00264             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndOldFG = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a15">gspwndFullScreen</a>;
00265             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bStateOld = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a178">gbFullScreen</a>;
00266 
00267             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndOldFG, &amp;tlpwndOldFG);
00268 
00269             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;gspwndFullScreen, pwndNewFG);
00270             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a178">gbFullScreen</a> = bStateNew;
00271 
00272             UserAssert(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a438">HMIsMarkDestroy</a>(gspwndFullScreen));
00273 
00274             <span class="comment">/*</span>
00275 <span class="comment">             * If the old screen was GDIFULLSCREEN and we are switching to</span>
00276 <span class="comment">             * GDIFULLSCREEN then just repaint</span>
00277 <span class="comment">             */</span>
00278             
00279             <span class="comment">/*</span>
00280 <span class="comment">             * BUG 231647: For remote sessions it can happen that</span>
00281 <span class="comment">             * pwndOldFG is NULL but the display is enabled therefore a</span>
00282 <span class="comment">             * call to DrvEnableMDEV would confuse the Drv* code. The way</span>
00283 <span class="comment">             * this happens is when gspwndFullScreen was the desktop window</span>
00284 <span class="comment">             * of a desktop that got destroyed after we switched away from it.</span>
00285 <span class="comment">             */</span>
00286             
00287             <span class="keywordflow">if</span> ((pwndOldFG != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a>) &amp;&amp;
00288                 bStateOld == GDIFULLSCREEN &amp;&amp;
00289                 bStateNew == GDIFULLSCREEN) {
00290 
00291                 <a class="code" href="../../d4/d1/userk_8h.html#a1679">xxxRedrawWindow</a>(pwndNewFG, NULL, NULL,
00292                                 RDW_INVALIDATE | RDW_ALLCHILDREN | RDW_ERASE | RDW_ERASENOW);
00293 
00294                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndOldFG);
00295 
00296             } <span class="keywordflow">else</span> {
00297 
00298                 <span class="comment">/*</span>
00299 <span class="comment">                 * tell old 'foreground' window it is losing control of the screen</span>
00300 <span class="comment">                 */</span>
00301                 <span class="keywordflow">if</span> (pwndOldFG != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00302                     <span class="keywordflow">switch</span> (bStateOld) {
00303                     <span class="keywordflow">case</span> FULLSCREEN:
00304                         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a744">GetFullScreen</a>(pwndOldFG) == FULLSCREEN) {
00305                             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a745">SetFullScreen</a>(pwndOldFG, FULLSCREENMIN);
00306                         }
00307                         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndOldFG, WM_FULLSCREEN, FALSE, 0);
00308                         <a class="code" href="../../d4/d1/userk_8h.html#a1516">xxxCapture</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndOldFG), NULL, FULLSCREEN_CAPTURE);
00309                         <a class="code" href="../../d6/d3/queue_8c.html#a23">SetVDMCursorBounds</a>(NULL);
00310                         <span class="keywordflow">break</span>;
00311 
00312                     <span class="keywordflow">case</span> GDIFULLSCREEN:
00313                         <span class="comment">/*</span>
00314 <span class="comment">                         * Lock out other windows from drawing while we are fullscreen</span>
00315 <span class="comment">                         */</span>
00316                         <a class="code" href="../../d4/d1/userk_8h.html#a1772">LockWindowUpdate2</a>(pwndOldFG, TRUE);
00317                         <a class="code" href="../../d4/d1/userk_8h.html#a659">SET_PUDF</a>(PUDF_LOCKFULLSCREEN);
00318 
00319                         UserAssert(fGdiEnabled == TRUE);
00320 
00321                         <span class="keywordflow">if</span> (!DrvDisableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE)) {
00322                             <span class="comment">/*</span>
00323 <span class="comment">                             * Restore the previous state before bailing.</span>
00324 <span class="comment">                             */</span>
00325                             <a class="code" href="../../d4/d1/userk_8h.html#a660">CLEAR_PUDF</a>(PUDF_LOCKFULLSCREEN);
00326                             <a class="code" href="../../d4/d1/userk_8h.html#a1772">LockWindowUpdate2</a>(NULL, TRUE);
00327 
00328                             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;gspwndFullScreen, pwndOldFG);
00329                             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a178">gbFullScreen</a> = bStateOld;
00330 
00331                             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndOldFG);
00332                             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndNewFG);
00333 
00334                             <a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> = <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>;
00335 
00336                             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337                         }
00338 
00339                         <a class="code" href="../../d8/d8/fullscr_8c.html#a5">gptCursorFullScreen</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor;
00340                         <a class="code" href="../../d9/d6/desktop_8c.html#a3">fGdiEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00341                         <span class="keywordflow">break</span>;
00342 
00343                     <span class="keywordflow">default</span>:
00344                         RIPMSG0(RIP_ERROR, <span class="stringliteral">"xxxDoFullScreenSwitch: bad screen state"</span>);
00345                         <span class="keywordflow">break</span>;
00346 
00347                     }
00348                 }
00349 
00350                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndOldFG);
00351 
00352                 <span class="keywordflow">switch</span> (bStateNew) {
00353                 <span class="keywordflow">case</span> FULLSCREEN:
00354                     <a class="code" href="../../d4/d1/userk_8h.html#a1516">xxxCapture</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndNewFG), pwndNewFG, FULLSCREEN_CAPTURE);
00355                     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwndNewFG, WM_FULLSCREEN, TRUE, 0);
00356                     <span class="keywordflow">break</span>;
00357 
00358                 <span class="keywordflow">case</span> GDIFULLSCREEN:
00359                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a882">ISTS</a>() &amp;&amp; pwndOldFG != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00360                         UserAssert(fGdiEnabled == FALSE);
00361                     }
00362 
00363                     DrvEnableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
00364                     <a class="code" href="../../d9/d6/desktop_8c.html#a3">fGdiEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00365 
00366                     <span class="comment">/*</span>
00367 <span class="comment">                     * Return the cursor to it's old state. Reset the screen saver mouse</span>
00368 <span class="comment">                     * position or it'll go away by accident.</span>
00369 <span class="comment">                     */</span>
00370                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a31">gpqCursor</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00371                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a84">gpcurPhysCurrent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00372                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a83">gpcurLogCurrent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00373                     <a class="code" href="../../d4/d1/userk_8h.html#a1790">SetPointer</a>(FALSE);
00374                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a159">gptSSCursor</a> = <a class="code" href="../../d8/d8/fullscr_8c.html#a5">gptCursorFullScreen</a>;
00375 
00376                     <span class="comment">/*</span>
00377 <span class="comment">                     * No need to DeferWinEventNotify() - we use only globals,</span>
00378 <span class="comment">                     * then make an xxx call below.</span>
00379 <span class="comment">                     */</span>
00380                     <a class="code" href="../../d4/d1/userk_8h.html#a1179">zzzInternalSetCursorPos</a>(<a class="code" href="../../d8/d8/fullscr_8c.html#a5">gptCursorFullScreen</a>.x,
00381                                             <a class="code" href="../../d8/d8/fullscr_8c.html#a5">gptCursorFullScreen</a>.y
00382                                            );
00383 
00384                     <a class="code" href="../../d4/d1/userk_8h.html#a660">CLEAR_PUDF</a>(PUDF_LOCKFULLSCREEN);
00385                     <a class="code" href="../../d4/d1/userk_8h.html#a1772">LockWindowUpdate2</a>(NULL, TRUE);
00386 
00387                     <a class="code" href="../../d4/d1/userk_8h.html#a1679">xxxRedrawWindow</a>(pwndNewFG, NULL, NULL,
00388                                     RDW_INVALIDATE | RDW_ALLCHILDREN | RDW_ERASE | RDW_ERASENOW);
00389                     <span class="keywordflow">break</span>;
00390 
00391                 <span class="keywordflow">default</span>:
00392                     RIPMSG0(RIP_ERROR, <span class="stringliteral">"xxxDoFullScreenSwitch: bad screen state\n"</span>);
00393                     <span class="keywordflow">break</span>;
00394                 }
00395             }
00396         }
00397 
00398         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndNewFG);
00399 
00400         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d8/fullscr_8c.html#a3">fRedoFullScreenSwitch</a>) {
00401             <span class="keywordflow">break</span>;
00402         }
00403     }
00404 
00405     <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"Switching: xxxMakeWindowForeground: Exit\n"</span>));
00406 
00407     <a class="code" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> = <a class="code" href="../../d8/d8/fullscr_8c.html#a0">NOSWITCHER</a>;
00408     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00409 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="fullscr.c::xxxResetDisplayDevice" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxResetDisplayDevice           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pdesk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structtagDISPLAYINFO.html">PDISPLAYINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pDI</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CDS_Flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">1152</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00494">CreateBitmapStrip()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1843">CreateCaptionStrip()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">CreateProfileUserName()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01095">DestroyMonitorDCs()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00174">FreeProfileUserName()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00299">ghbmCaption</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00025">ghbmWallpaper</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a938">PMONITORRECTS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00969">QueueNotifyMessage()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02206">tagDISPLAYINFO::rcScreen</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00985">ResetSharedDesktops()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01127">ResetSystemColors()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00040">SnapshotMonitorRects()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03109">tagQ::spwndCapture</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01704">ThreadLockPool</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01710">ThreadUnlockAndFreePool</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02826">TIF_INCLEANUP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01797">xxxBroadcastDisplaySettingsChange()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01079">xxxSetDeskWallpaper()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00216">zzzClipCursor()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">xxxUserChangeDisplaySettings()</a>.
<p>
<pre class="fragment"><div>01156 {
01157     WORD            wOldBpp;
01158     <a class="code" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>   pmr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01159     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>              tlPool;
01160     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01161 
01162     <span class="comment">/*</span>
01163 <span class="comment">     * BUGBUG: Correctly update work area for each monitor.</span>
01164 <span class="comment">     */</span>
01165     wOldBpp = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount;
01166 
01167     <span class="keywordflow">if</span> (!(CDS_Flags &amp; CDS_FULLSCREEN)) {
01168 
01169         pmr = <a class="code" href="../../d4/d5/rare_8c.html#a9">SnapshotMonitorRects</a>();
01170 
01171         <span class="keywordflow">if</span> (pmr) {
01172             <a class="code" href="../../d4/d1/userk_8h.html#a137">ThreadLockPool</a>(ptiCurrent, pmr, &amp;tlPool);
01173         }
01174     }
01175 
01176     <span class="comment">/*</span>
01177 <span class="comment">     * Cleanup any monitor specific DCs we gave out.</span>
01178 <span class="comment">     */</span>
01179     <a class="code" href="../../d8/d8/fullscr_8c.html#a19">DestroyMonitorDCs</a>();
01180 
01181     <a class="code" href="../../d8/d8/fullscr_8c.html#a16">UpdateUserScreen</a>();
01182     <a class="code" href="../../d8/d8/fullscr_8c.html#a18">ResetSharedDesktops</a>(pDI, pdesk);
01183 
01184     <a class="code" href="../../d8/d8/fullscr_8c.html#a20">ResetSystemColors</a>();
01185 
01186     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a131">ghbmCaption</a>) {
01187         GreDeleteObject(ghbmCaption);
01188         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a131">ghbmCaption</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1843">CreateCaptionStrip</a>();
01189     }
01190 
01191     <a class="code" href="../../d4/d1/userk_8h.html#a1788">zzzClipCursor</a>(&amp;pDI-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o14">rcScreen</a>);
01192 
01193     <span class="comment">/*</span>
01194 <span class="comment">     * Adjust window positions to fit new resolutions and</span>
01195 <span class="comment">     * positions of monitors.</span>
01196 <span class="comment">     */</span>
01197     <span class="keywordflow">if</span> (pmr) {
01198         <a class="code" href="../../d4/d1/userk_8h.html#a1882">xxxDesktopRecalc</a>(pmr);
01199         <a class="code" href="../../d4/d1/userk_8h.html#a139">ThreadUnlockAndFreePool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), &amp;tlPool);
01200     }
01201 
01202     <span class="comment">/*</span>
01203 <span class="comment">     * Change the wallpaper metrics.</span>
01204 <span class="comment">     * Don't reload the wallpaper when in cleanup since that may</span>
01205 <span class="comment">     * go to the client for and we can't do that.</span>
01206 <span class="comment">     */</span>
01207     <span class="keywordflow">if</span> (!(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a795">TIF_INCLEANUP</a>) &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a1">ghbmWallpaper</a>) {
01208         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlName;
01209         PUNICODE_STRING pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
01210         <a class="code" href="../../d4/d1/userk_8h.html#a1186">xxxSetDeskWallpaper</a>(pProfileUserName, SETWALLPAPER_METRICS);
01211         <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
01212     }
01213 
01214     <span class="comment">/*</span>
01215 <span class="comment">     * Recreate cached bitmaps.</span>
01216 <span class="comment">     */</span>
01217     <a class="code" href="../../d4/d1/userk_8h.html#a1860">CreateBitmapStrip</a>();
01218 
01219     <span class="comment">/*</span>
01220 <span class="comment">     * Broadcast that the display has changed resolution.</span>
01221 <span class="comment">     * Also broadcast a color-change if we were not in fullscreen, and a</span>
01222 <span class="comment">     * color-change took effect.</span>
01223 <span class="comment">     */</span>
01224     <span class="keywordflow">if</span> (!(CDS_Flags &amp; CDS_FULLSCREEN) &amp;&amp; (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount != wOldBpp)) {
01225        <a class="code" href="../../d4/d1/userk_8h.html#a1537">xxxBroadcastDisplaySettingsChange</a>(pdesk, TRUE);
01226 
01227     } <span class="keywordflow">else</span> {
01228        <a class="code" href="../../d4/d1/userk_8h.html#a1537">xxxBroadcastDisplaySettingsChange</a>(pdesk, FALSE);
01229     }
01230 
01231     <span class="comment">/*</span>
01232 <span class="comment">     * If the user performed a CTL-ESC, it is possible that the</span>
01233 <span class="comment">     * tray-window is then in the menu-loop.  We want to clear this</span>
01234 <span class="comment">     * out so that we don't leave improper menu positioning.</span>
01235 <span class="comment">     */</span>
01236     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>)
01237         <a class="code" href="../../d4/d1/userk_8h.html#a1582">QueueNotifyMessage</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>, WM_CANCELMODE, 0, 0l);
01238 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="fullscr.c::xxxUserChangeDisplaySettings" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG xxxUserChangeDisplaySettings           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pstrDeviceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPDEVMODEW&nbsp;</td>
          <td class="mdname" nowrap> <em>pDevMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pdesk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a40">MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01273">1273</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00466">CreateCachedMonitor()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02651">tagDESKTOP::dwDesktopId</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l01252">FreeAllSpbs()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00932">gbRemoteSession</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00119">gfade</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06645">tagFADE::hbm</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02074">tagMONITOR::hDev</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00095">ISCSRSS</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02202">tagDISPLAYINFO::pMonitorPrimary</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06598">PUDF_LOCKFULLSCREEN</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00676">SetPointer()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00918">StopFade()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01116">TRACE_INIT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01117">TRACE_SWITCH</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01251">TrackFullscreenMode()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00056">UserSetDelayedChangeBroadcastForAllDesktops()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l01302">xxxInternalInvalidate()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03136">xxxUserResetDisplayDevice()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
<pre class="fragment"><div>01281 {
01282     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     bSwitchMode;
01283     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesktop;
01284     LONG     status;
01285     PMDEV    pmdev;
01286 
01287     <span class="comment">/*</span>
01288 <span class="comment">     * BUGBUG: Has lParam been properly captured?</span>
01289 <span class="comment">     */</span>
01290 
01291     lParam;
01292 
01293     <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"ChangeDisplaySettings - Entering\n"</span>));
01294     <a class="code" href="../../d4/d1/userk_8h.html#a92">TRACE_SWITCH</a>((<span class="stringliteral">"ChangeDisplaySettings - Entering\n"</span>));
01295 
01296     <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"    Flags -"</span>));
01297 
01298     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_UPDATEREGISTRY) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_UPDATEREGISTRY - "</span>));
01299     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_TEST) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_TEST - "</span>));
01300     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_FULLSCREEN) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_FULLSCREEN - "</span>));
01301     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_GLOBAL) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_GLOBAL - "</span>));
01302     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_SET_PRIMARY) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_SET_PRIMARY - "</span>));
01303     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_RESET) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_RESET - "</span>));
01304     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_NORESET) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_NORESET - "</span>));
01305     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_VIDEOPARAMETERS) <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">" CDS_VIDEOPARAMETERS - "</span>));
01306     <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"\n"</span>));
01307 
01308 <span class="preprocessor">#if ((DISP_CHANGE_SUCCESSFUL != GRE_DISP_CHANGE_SUCCESSFUL)  ||  \</span>
01309 <span class="preprocessor">     (DISP_CHANGE_RESTART    != GRE_DISP_CHANGE_RESTART)     ||  \</span>
01310 <span class="preprocessor">     (DISP_CHANGE_FAILED     != GRE_DISP_CHANGE_FAILED)      ||  \</span>
01311 <span class="preprocessor">     (DISP_CHANGE_BADMODE    != GRE_DISP_CHANGE_BADMODE)     ||  \</span>
01312 <span class="preprocessor">     (DISP_CHANGE_NOTUPDATED != GRE_DISP_CHANGE_NOTUPDATED)  ||  \</span>
01313 <span class="preprocessor">     (DISP_CHANGE_BADFLAGS   != GRE_DISP_CHANGE_BADFLAGS)    ||  \</span>
01314 <span class="preprocessor">     (DISP_CHANGE_BADPARAM   != GRE_DISP_CHANGE_BADPARAM))</span>
01315 <span class="preprocessor"></span><span class="preprocessor">    #error "inconsistent header files"</span>
01316 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01317 <span class="preprocessor"></span>
01318     <span class="comment">/*</span>
01319 <span class="comment">     * Perform Error Checking to verify flag combinations are valid.</span>
01320 <span class="comment">     */</span>
01321     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; (~CDS_VALID)) {
01322 
01323         <span class="comment">//BUGBUG</span>
01324         <span class="comment">//RIPMSG0(RIP_ERROR, "ChangeDisplaySettings: invalid flags specified\n");</span>
01325         <span class="keywordflow">return</span> DISP_CHANGE_BADFLAGS;
01326     }
01327 
01328     <span class="comment">/*</span>
01329 <span class="comment">     * CDS_GLOBAL and CDS_NORESET can only be specified if UPDAREREGISTRY</span>
01330 <span class="comment">     * is specified.</span>
01331 <span class="comment">     */</span>
01332 
01333     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; (CDS_GLOBAL | CDS_NORESET))  &amp;&amp;
01334         (!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_UPDATEREGISTRY))) {
01335 
01336         <span class="comment">//BUGBUG</span>
01337         <span class="comment">//RIPMSG0(RIP_ERROR, "ChangeDisplaySettings: invalid registry flags specified\n");</span>
01338         <span class="keywordflow">return</span> DISP_CHANGE_BADFLAGS;
01339     }
01340 
01341     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_NORESET)  &amp;&amp;
01342         (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_RESET)) {
01343 
01344         <span class="comment">//BUGBUG</span>
01345         <span class="comment">//RIPMSG0(RIP_ERROR, "ChangeDisplaySettings: RESET and NORESET can not be put together\n");</span>
01346         <span class="keywordflow">return</span> DISP_CHANGE_BADFLAGS;
01347     }
01348 
01349     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_EXCLUSIVE) &amp;&amp; (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_FULLSCREEN) &amp;&amp; (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_RESET)) {
01350 
01351         <span class="comment">//BUGBUG</span>
01352         <span class="comment">//RIPMSG0(RIP_ERROR, "ChangeDisplaySettings: invalid flags specified\n");</span>
01353         <span class="keywordflow">return</span> DISP_CHANGE_BADFLAGS;
01354     }
01355 
01356     <span class="keywordflow">if</span> (hwnd) {
01357         <span class="keywordflow">return</span> DISP_CHANGE_BADPARAM;
01358     }
01359 
01360     <span class="comment">/*</span>
01361 <span class="comment">     * For now, don't allow dynamic-resolution changes to occur</span>
01362 <span class="comment">     * when GDI is in fullscreen.  We should almost never hit this</span>
01363 <span class="comment">     * condition, except for rare stress cases.</span>
01364 <span class="comment">     */</span>
01365 
01366 
01367     <span class="comment">/*</span>
01368 <span class="comment">     * Allow mode change if this is a CSRSS of a remote</span>
01369 <span class="comment">     * session. This means we are changing display settings when</span>
01370 <span class="comment">     * reconnecting a session with a diferent resolution.</span>
01371 <span class="comment">     */</span>
01372     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_LOCKFULLSCREEN)) {
01373         <span class="keywordflow">if</span> (!(<a class="code" href="../../d4/d1/userk_8h.html#a20">ISCSRSS</a>() &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a>)) {
01374             <span class="keywordflow">return</span> DISP_CHANGE_FAILED;
01375         }
01376     }
01377 
01378 
01379     <span class="comment">/*</span>
01380 <span class="comment">     * If the modeset is being done on a non-active desktop, we don't want</span>
01381 <span class="comment">     * it too happen.</span>
01382 <span class="comment">     *</span>
01383 <span class="comment">     * PtiCurrent()-&gt;rpdesk can be NULL !!! (in the case of thread shutdown).</span>
01384 <span class="comment">     */</span>
01385 
01386     <span class="keywordflow">if</span> (pdesk) {
01387         pdesktop = pdesk;
01388     } <span class="keywordflow">else</span> {
01389         pdesktop = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;rpdesk;
01390     }
01391 
01392     <span class="keywordflow">if</span> (pdesktop != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>) {
01393         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ChangeDisplaySettings on wrong desktop pdesk\n"</span>);
01394         <span class="keywordflow">return</span> DISP_CHANGE_FAILED;
01395     }
01396 
01397     bSwitchMode = !(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; (CDS_NORESET | CDS_TEST));
01398 
01399     <span class="comment">/*</span>
01400 <span class="comment">     * Turn off cursor and free the spb's prior to calling the mode-change.</span>
01401 <span class="comment">     * This will make sure off-screen memory is cleaned up for gdi.</span>
01402 <span class="comment">     * while mucking with the resolution changes.</span>
01403 <span class="comment">     */</span>
01404     <span class="keywordflow">if</span> (bSwitchMode) {
01405 
01406         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8/fullscr_8c.html#a14">CreateCachedMonitor</a>() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01407             <span class="keywordflow">return</span> DISP_CHANGE_FAILED;
01408         }
01409 
01410         <a class="code" href="../../d4/d1/userk_8h.html#a1790">SetPointer</a>(FALSE);
01411         <a class="code" href="../../d1/d4/spb_8c.html#a12">FreeAllSpbs</a>();
01412     }
01413 
01414     <span class="comment">/*</span>
01415 <span class="comment">     * Before calling gdi to change the mode, we should kill the fade sprite.  This is</span>
01416 <span class="comment">     * so that we won't keep pointers to gdi sprites during the mode change because</span>
01417 <span class="comment">     * the sprites could be reallocated.</span>
01418 <span class="comment">     */</span>
01419     
01420     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a40">gfade</a>.<a class="code" href="../../d0/d5/structtagFADE.html#o2">hbm</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01421         <a class="code" href="../../d8/d4/sprite_8c.html#a22">StopFade</a>();
01422     }
01423 
01424     <span class="comment">/*</span>
01425 <span class="comment">     * Similarly, we should kill the sprites associated with the drag rect (if any</span>
01426 <span class="comment">     * exist) before the mode change.</span>
01427 <span class="comment">     */</span>
01428     
01429     bSetDevDragRect(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, NULL, NULL);
01430 
01431     <span class="comment">/*</span>
01432 <span class="comment">     * Lets capture our parameters.  They are both required.</span>
01433 <span class="comment">     *</span>
01434 <span class="comment">     * If the input string is not NULL, then we are trying to affect another</span>
01435 <span class="comment">     * Device. The device name is the same as for EnumDisplaySettings.</span>
01436 <span class="comment">     */</span>
01437 
01438     status = DrvChangeDisplaySettings(pstrDeviceName,
01439                                       <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a>-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o8">hDev</a>,
01440                                       pDevMode,
01441                                       LongToPtr( pdesktop-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o5">dwDesktopId</a> ),
01442                                       PreviousMode,
01443                                       (dwFlags &amp; CDS_UPDATEREGISTRY),
01444                                       bSwitchMode,
01445                                       <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>,
01446                                       &amp;pmdev,
01447                                       (dwFlags &amp; CDS_RAWMODE) ? GRE_RAWMODE : GRE_DEFAULT,
01448                                       (dwFlags &amp; CDS_TRYCLOSEST));
01449 
01450 
01451     <span class="keywordflow">if</span> (bSwitchMode) {
01452 
01453         <span class="comment">/*</span>
01454 <span class="comment">         * If the caller wanted a reset, but the mode is identical, just</span>
01455 <span class="comment">         * reset the current mode.</span>
01456 <span class="comment">         */</span>
01457 
01458         <span class="keywordflow">if</span> (status == GRE_DISP_CHANGE_NO_CHANGE) {
01459 
01460             <a class="code" href="../../d8/d8/fullscr_8c.html#a22">TrackFullscreenMode</a>(dwFlags);
01461 
01462             <span class="keywordflow">if</span> (pmdev != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01463                 GreFreePool(pmdev);
01464             }
01465 
01466             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_RESET) {
01467 
01468                 <span class="keywordflow">if</span> (DrvDisableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE)) {
01469                     DrvEnableMDEV(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, TRUE);
01470                 }
01471 
01472                 <a class="code" href="../../d9/d6/desktop_8c.html#a26">xxxUserResetDisplayDevice</a>();
01473             }
01474 
01475             status = DISP_CHANGE_SUCCESSFUL;
01476 
01477         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == DISP_CHANGE_SUCCESSFUL) {
01478 
01479             <a class="code" href="../../d8/d8/fullscr_8c.html#a22">TrackFullscreenMode</a>(dwFlags);
01480 
01481             <span class="comment">/*</span>
01482 <span class="comment">             * ChangeDisplaySettings automatically destroys the old MDEV.</span>
01483 <span class="comment">             * We only have to delete it here.</span>
01484 <span class="comment">             */</span>
01485             GreFreePool(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>);
01486             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a> = pmdev;
01487             <a class="code" href="../../d8/d8/fullscr_8c.html#a21">xxxResetDisplayDevice</a>(pdesktop, gpDispInfo, dwFlags);
01488 
01489             <span class="comment">/*</span>
01490 <span class="comment">             * set delayed change indicator for</span>
01491 <span class="comment">             * currently background desktops.</span>
01492 <span class="comment">             */</span>
01493             <a class="code" href="../../d8/d8/fullscr_8c.html#a8">UserSetDelayedChangeBroadcastForAllDesktops</a>(pdesktop);
01494 
01495         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status &lt; DISP_CHANGE_SUCCESSFUL) {
01496             UserAssert(pmdev == NULL);
01497             <a class="code" href="../../d9/d6/desktop_8c.html#a26">xxxUserResetDisplayDevice</a>();
01498         }
01499 
01500         <span class="comment">/*</span>
01501 <span class="comment">         * Inline so we can specify which desktop this should happen on.</span>
01502 <span class="comment">         * xxxRedrawScreen();</span>
01503 <span class="comment">         */</span>
01504         <a class="code" href="../../d4/d1/userk_8h.html#a1681">xxxInternalInvalidate</a>(pdesktop-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
01505                               HRGN_FULL, RDW_INVALIDATE | RDW_ERASE | RDW_FRAME | RDW_ALLCHILDREN);
01506 
01507         <span class="comment">/*</span>
01508 <span class="comment">         * Bring back the cursor-shape.</span>
01509 <span class="comment">         */</span>
01510         <a class="code" href="../../d4/d1/userk_8h.html#a1790">SetPointer</a>(TRUE);
01511         <a class="code" href="../../d7/d1/ntuser_2kernel_2cursor_8c.html#a11">zzzUpdateCursorImage</a>();
01512     }
01513 
01514     <span class="comment">/*</span>
01515 <span class="comment">     * TV-Out Support</span>
01516 <span class="comment">     */</span>
01517 
01518     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CDS_VIDEOPARAMETERS))
01519     {
01520         <span class="keywordflow">if</span> (lParam == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01521             status = DISP_CHANGE_BADPARAM;
01522         } <span class="keywordflow">else</span> {
01523             status = DrvSetVideoParameters(pstrDeviceName,
01524                                            <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o12">pMonitorPrimary</a>-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o8">hDev</a>,
01525                                            PreviousMode,
01526                                            lParam);
01527         }
01528     }
01529 
01530     <a class="code" href="../../d4/d1/userk_8h.html#a91">TRACE_INIT</a>((<span class="stringliteral">"ChangeDisplaySettings - Leaving, Status = %d\n"</span>, status));
01531 
01532     <span class="keywordflow">return</span> status;
01533 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="fullscr.c::fGdiEnabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d7/d2/power_8c.html#a1">fGdiEnabled</a> = TRUE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00045">45</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="fullscr.c::fRedoFullScreenSwitch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d8/d8/fullscr_8c.html#a3">fRedoFullScreenSwitch</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00044">44</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00101">FullScreenCleanup()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="fullscr.c::gptCursorFullScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> POINT <a class="el" href="../../d8/d8/fullscr_8c.html#a5">gptCursorFullScreen</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00046">46</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="fullscr.c::idSwitcher" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d8/d8/fullscr_8c.html#a2">idSwitcher</a> = NOSWITCHER          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00043">43</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00101">FullScreenCleanup()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01545">xxxbFullscreenSwitch()</a>, and <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="fullscr.c::InitSafeBootMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d8/d8/fullscr_8c.html#a6">InitSafeBootMode</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00048">48</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="fullscr.c::TraceFullscreenSwitch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG <a class="el" href="../../d8/d8/fullscr_8c.html#a1">TraceFullscreenSwitch</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00039">39</a> of file <a class="el" href="../../d9/d7/fullscr_8c-source.html">fullscr.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:48 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
