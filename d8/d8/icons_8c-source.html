<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: icons.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>icons.c</h1><a href="../../d7/d9/icons_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: icons.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains routines having to do with icons.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 11-14-90 DarrinM      Created.</span>
00010 <span class="comment">* 13-Feb-1991 mikeke    Added Revalidation code</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
<a name="l00016"></a><a class="code" href="../../d7/d9/icons_8c.html#a0">00016</a> <span class="preprocessor">#define DX_GAP      (SYSMET(CXMINSPACING) - SYSMET(CXMINIMIZED))</span>
<a name="l00017"></a><a class="code" href="../../d7/d9/icons_8c.html#a1">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define DY_GAP      (SYSMET(CYMINSPACING) - SYSMET(CYMINIMIZED))</span>
00018 <span class="preprocessor"></span>
00019 <span class="comment">/***************************************************************************\</span>
00020 <span class="comment">* xxxArrangeIconicWindows</span>
00021 <span class="comment">*</span>
00022 <span class="comment">* Function to arrange all icons for a particular window.  Does this by</span>
00023 <span class="comment">* Returns 0 if no icons or the height of one</span>
00024 <span class="comment">* icon row if there are any icons.</span>
00025 <span class="comment">*</span>
00026 <span class="comment">* History:</span>
00027 <span class="comment">* 11-14-90 darrinm      Ported from Win 3.0 sources.</span>
00028 <span class="comment">*  4-17-91 mikehar      Win31 Merge</span>
00029 <span class="comment">\***************************************************************************/</span>
00030 
<a name="l00031"></a><a class="code" href="../../d4/d1/userk_8h.html#a1776">00031</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d4/d1/userk_8h.html#a1776">xxxArrangeIconicWindows</a>(
00032     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00033 {
00034     <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a> pbwl;
00035     <a class="code" href="../../d8/d6/structtagSMWP.html">PSMWP</a> psmwp;
00036     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndTest, pwndSort, pwndSwitch;
00037     HWND *phwnd, *phwndSort;
00038     <a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *pcp, *pcpSort;
00039     POINT ptSort, ptSrc;
00040     WORD  nIcons = 0;
00041     RECT  rc;
00042     POINT ptMin;
00043     <span class="keywordtype">int</span>   xOrg, yOrg;
00044     <span class="keywordtype">int</span>   dx, dy;
00045     <span class="keywordtype">int</span>   dxSlot, dySlot;
00046     <span class="keywordtype">int</span>   cIconsPerPass, iIconPass;
00047     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fHorizontal, fBreak;
00048     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndTest;
00049     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fHideMe;
00050 
00051     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00052 
00053     <span class="comment">/*</span>
00054 <span class="comment">     * Create a window list of all children of pwnd</span>
00055 <span class="comment">     */</span>
00056     <span class="keywordflow">if</span> ((pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, <a class="code" href="../../d4/d1/userk_8h.html#a410">BWL_ENUMLIST</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00057         <span class="keywordflow">return</span> 0;
00058 
00059     fHideMe = <a class="code" href="../../d8/d7/winloop2_8c.html#a2">IsTrayWindow</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>);
00060 
00061     <span class="comment">//</span>
00062     <span class="comment">// Put these into local vars for efficiency (see ParkIcon())</span>
00063     <span class="comment">//</span>
00064     dxSlot = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINSPACING);
00065     dySlot = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINSPACING);
00066 
00067     <span class="comment">//</span>
00068     <span class="comment">// We need to adjust the client rectangle if the parent has scrollbars.</span>
00069     <span class="comment">//</span>
00070     <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a3">GetRealClientRect</a>(pwnd, &amp;rc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a873">GRC_SCROLLS</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00071 
00072     <span class="comment">/*</span>
00073 <span class="comment">     * find all icons</span>
00074 <span class="comment">     */</span>
00075     pwndSwitch = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a91">ghwndSwitch</a>);
00076     <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
00077         <span class="keywordflow">if</span> (((pwndTest = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00078                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndTest , <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>) ||
00079                 pwndTest == pwndSwitch ||
00080                 (pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwndTest, <a class="code" href="../../d4/d1/userk_8h.html#a475">PROP_CHECKPOINT</a>,
00081                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00082             *phwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00083             <span class="keywordflow">continue</span>;
00084         }
00085 
00086         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndTest, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>)) {
00087             pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o6">fMinInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00088             pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x = pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y = -1;
00089             *phwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00090             <span class="keywordflow">continue</span>;
00091         }
00092 
00093         <span class="comment">/*</span>
00094 <span class="comment">         * inc count of icons</span>
00095 <span class="comment">         */</span>
00096         nIcons++;
00097 
00098         <span class="comment">/*</span>
00099 <span class="comment">         * we will park in default position again...</span>
00100 <span class="comment">         */</span>
00101         pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o3">fDragged</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00102 
00103         <span class="comment">/*</span>
00104 <span class="comment">         * ensure the original position is up to date</span>
00105 <span class="comment">         */</span>
00106         pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x = pwndTest-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00107         pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y = pwndTest-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00108         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a21">_ScreenToClient</a>(pwnd, &amp;pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>);
00109 
00110         <span class="comment">// Slide into the nearest row or column</span>
00111         <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE) &amp; ~ARW_HIDE) {
00112             <span class="keywordflow">case</span> ARW_TOPLEFT | ARW_RIGHT:
00113             <span class="keywordflow">case</span> ARW_TOPRIGHT | ARW_LEFT:
00114                 <span class="comment">// Slide into top row</span>
00115                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y += dySlot / 2;
00116                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y -= pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y % dySlot;
00117                 <span class="keywordflow">break</span>;
00118 
00119             <span class="keywordflow">case</span> ARW_TOPLEFT | ARW_DOWN:
00120             <span class="keywordflow">case</span> ARW_BOTTOMLEFT | ARW_UP:
00121                 <span class="comment">// Slide into left column</span>
00122                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x += dxSlot / 2;
00123                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x -= pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x % dxSlot;
00124                 <span class="keywordflow">break</span>;
00125 
00126             <span class="keywordflow">case</span> ARW_BOTTOMLEFT | ARW_RIGHT:
00127             <span class="keywordflow">case</span> ARW_BOTTOMRIGHT | ARW_LEFT:
00128                 <span class="comment">// Slide into bottom row</span>
00129                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y = rc.bottom - pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y;
00130                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y += dySlot / 2;
00131                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y -= pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y % dySlot;
00132                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y = rc.bottom - pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y;
00133                 <span class="keywordflow">break</span>;
00134 
00135             <span class="keywordflow">case</span> ARW_BOTTOMRIGHT | ARW_UP:
00136             <span class="keywordflow">case</span> ARW_TOPRIGHT | ARW_DOWN:
00137                 <span class="comment">// Slide into right column</span>
00138                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x = rc.right - pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x;
00139                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x += dxSlot / 2;
00140                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x -= pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x % dxSlot;
00141                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x = rc.right - pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x;
00142                 <span class="keywordflow">break</span>;
00143         }
00144     }
00145 
00146     <span class="keywordflow">if</span> (nIcons == 0) {
00147 
00148         <span class="comment">/*</span>
00149 <span class="comment">         * no icons were found...  break out</span>
00150 <span class="comment">         */</span>
00151         <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
00152         <span class="keywordflow">return</span> 0;
00153     }
00154 
00155     <span class="keywordflow">if</span> (fHideMe) {
00156         ptMin.x = <a class="code" href="../../d4/d1/userk_8h.html#a608">WHERE_NOONE_CAN_SEE_ME</a>;
00157         ptMin.y = <a class="code" href="../../d4/d1/userk_8h.html#a608">WHERE_NOONE_CAN_SEE_ME</a>;
00158         <span class="keywordflow">goto</span> JustParkEm;
00159     }
00160 
00161     <span class="comment">//</span>
00162     <span class="comment">// Get gravity &amp;&amp; move vars</span>
00163     <span class="comment">//</span>
00164     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE) &amp; ARW_STARTRIGHT) {
00165         <span class="comment">// Starting on right side</span>
00166         ptMin.x = xOrg = rc.right - dxSlot;
00167         dx = -dxSlot;
00168     } <span class="keywordflow">else</span> {
00169         <span class="comment">// Starting on left</span>
00170         ptMin.x = xOrg = rc.left + <a class="code" href="../../d7/d9/icons_8c.html#a0">DX_GAP</a>;
00171         dx = dxSlot;
00172     }
00173 
00174     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE) &amp; ARW_STARTTOP) {
00175         <span class="comment">// Starting on top</span>
00176         ptMin.y = yOrg = rc.top + <a class="code" href="../../d7/d9/icons_8c.html#a1">DY_GAP</a>;
00177         dy = dySlot;
00178     } <span class="keywordflow">else</span> {
00179         <span class="comment">// Starting on bottom</span>
00180         ptMin.y = yOrg = rc.bottom - dySlot;
00181         dy = -dySlot;
00182     }
00183 
00184     <span class="comment">//</span>
00185     <span class="comment">// Get arrange dir</span>
00186     <span class="comment">//</span>
00187     fHorizontal = ( (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE) &amp; ARW_DOWN) ? <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00188 
00189     iIconPass = fHorizontal ? (rc.right / dxSlot) : (rc.bottom / dySlot);
00190     cIconsPerPass = iIconPass = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(1, iIconPass);
00191 
00192     <span class="comment">/*</span>
00193 <span class="comment">     * insertion sort of windows by y, and by x within a row.</span>
00194 <span class="comment">     */</span>
00195     <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
00196 
00197         <span class="comment">/*</span>
00198 <span class="comment">         * Check for 0 (window was not icon) and</span>
00199 <span class="comment">         * Check for invalid HWND (window has been destroyed)</span>
00200 <span class="comment">         */</span>
00201         <span class="keywordflow">if</span> (*phwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || (pwndTest = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00202             <span class="keywordflow">continue</span>;
00203 
00204         pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwndTest, <a class="code" href="../../d4/d1/userk_8h.html#a475">PROP_CHECKPOINT</a>,
00205                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>);
00206         ptSrc = pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>;
00207 
00208         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00209         <span class="keywordflow">for</span> (phwndSort = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; phwndSort &lt; phwnd; phwndSort++) {
00210             <span class="keywordflow">if</span> (*phwndSort == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00211                     (pwndSort = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwndSort)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00212                 <span class="keywordflow">continue</span>;
00213 
00214             pcpSort = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a>*)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwndSort, <a class="code" href="../../d4/d1/userk_8h.html#a475">PROP_CHECKPOINT</a>,
00215                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>);
00216 
00217             ptSort = pcpSort-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>;
00218 
00219             <span class="comment">//</span>
00220             <span class="comment">// Is this the position in which to sort this min window?</span>
00221             <span class="comment">//</span>
00222             <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE) &amp; ~ARW_HIDE) {
00223                 <span class="keywordflow">case</span> ARW_BOTTOMLEFT | ARW_RIGHT:
00224                     <span class="comment">// Lower left, moving horizontally</span>
00225                     <span class="keywordflow">if</span> (((ptSort.y == ptSrc.y) &amp;&amp; (ptSort.x &gt; ptSrc.x)) ||
00226                         (ptSort.y &lt; ptSrc.y))
00227                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00228                     <span class="keywordflow">break</span>;
00229 
00230                 <span class="keywordflow">case</span> ARW_BOTTOMLEFT | ARW_UP:
00231                     <span class="comment">// Lower left, moving vertically</span>
00232                     <span class="keywordflow">if</span> (((ptSort.x == ptSrc.x) &amp;&amp; (ptSort.y &lt; ptSrc.y)) ||
00233                         (ptSort.x &gt; ptSrc.x))
00234                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00235                     <span class="keywordflow">break</span>;
00236 
00237                 <span class="keywordflow">case</span> ARW_BOTTOMRIGHT | ARW_LEFT:
00238                     <span class="comment">// Lower right, moving horizontally</span>
00239                     <span class="keywordflow">if</span> (((ptSort.y == ptSrc.y) &amp;&amp; (ptSort.x &lt; ptSrc.x)) ||
00240                         (ptSort.y &lt; ptSrc.y))
00241                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00242                     <span class="keywordflow">break</span>;
00243 
00244                 <span class="keywordflow">case</span> ARW_BOTTOMRIGHT | ARW_UP:
00245                     <span class="comment">// Lower right, moving vertically</span>
00246                     <span class="keywordflow">if</span> (((ptSort.x == ptSrc.x) &amp;&amp; (ptSort.y &lt; ptSrc.y)) ||
00247                         (ptSort.x &lt; ptSrc.x))
00248                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00249                     <span class="keywordflow">break</span>;
00250 
00251                 <span class="keywordflow">case</span> ARW_TOPLEFT | ARW_RIGHT:
00252                     <span class="comment">// Top left, moving horizontally</span>
00253                     <span class="keywordflow">if</span> (((ptSort.y == ptSrc.y) &amp;&amp; (ptSort.x &gt; ptSrc.x)) ||
00254                         (ptSort.y &gt; ptSrc.y))
00255                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00256                     <span class="keywordflow">break</span>;
00257 
00258                 <span class="keywordflow">case</span> ARW_TOPLEFT | ARW_DOWN:
00259                     <span class="comment">// Top left, moving vertically</span>
00260                     <span class="keywordflow">if</span> (((ptSort.x == ptSrc.x) &amp;&amp; (ptSort.y &gt; ptSrc.y)) ||
00261                         (ptSort.x &gt; ptSrc.x))
00262                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00263                     <span class="keywordflow">break</span>;
00264 
00265                 <span class="keywordflow">case</span> ARW_TOPRIGHT | ARW_LEFT:
00266                     <span class="comment">// Top right, moving horizontally</span>
00267                     <span class="keywordflow">if</span> (((ptSort.y == ptSrc.y) &amp;&amp; (ptSort.x &lt; ptSrc.x)) ||
00268                         (ptSort.y &gt; ptSrc.y))
00269                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00270                     <span class="keywordflow">break</span>;
00271 
00272                 <span class="keywordflow">case</span> ARW_TOPRIGHT | ARW_DOWN:
00273                     <span class="comment">// Top right, moving vertically</span>
00274                     <span class="keywordflow">if</span> (((ptSort.x == ptSrc.x) &amp;&amp; (ptSort.y &gt; ptSrc.y)) ||
00275                         (ptSort.x &lt; ptSrc.x))
00276                         fBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00277                     <span class="keywordflow">break</span>;
00278             }
00279 
00280             <span class="keywordflow">if</span> (fBreak)
00281                 <span class="keywordflow">break</span>;
00282         }
00283 
00284         <span class="comment">/*</span>
00285 <span class="comment">         * insert the window at this position by sliding the rest up.</span>
00286 <span class="comment">         * LATER IanJa, use hwnd intermediate variables, avoid PW() &amp; HW()</span>
00287 <span class="comment">         */</span>
00288         <span class="keywordflow">while</span> (phwndSort &lt; phwnd) {
00289             pwndSort = <a class="code" href="../../d4/d1/userk_8h.html#a104">PW</a>(*phwndSort);
00290             *phwndSort = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndTest);
00291             pwndTest = pwndSort;
00292             phwndSort++;
00293         }
00294 
00295         <span class="comment">/*</span>
00296 <span class="comment">         * replace the window handle in the original position</span>
00297 <span class="comment">         */</span>
00298         *phwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndTest);
00299     }
00300 
00301     <span class="comment">//</span>
00302     <span class="comment">// Now park the icons.</span>
00303     <span class="comment">//</span>
00304 
00305 JustParkEm:
00306 
00307     <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
00308         <span class="keywordflow">if</span> (*phwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || (pwndTest = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00309             <span class="keywordflow">continue</span>;
00310 
00311         pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwndTest, <a class="code" href="../../d4/d1/userk_8h.html#a475">PROP_CHECKPOINT</a>,
00312                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>);
00313         <span class="keywordflow">if</span> (pcp != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00314             pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o6">fMinInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00315             pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a> = ptMin;
00316         }
00317 
00318         <span class="keywordflow">if</span> (fHideMe) {
00319             <span class="keywordflow">continue</span>;
00320         }
00321 
00322         <span class="comment">// Setup to process the next position</span>
00323         <span class="keywordflow">if</span> (--iIconPass &lt;= 0) {
00324             <span class="comment">// Need to setup next pass</span>
00325             iIconPass = cIconsPerPass;
00326 
00327             <span class="keywordflow">if</span> (fHorizontal) {
00328                 ptMin.x = xOrg;
00329                 ptMin.y += dy;
00330             } <span class="keywordflow">else</span> {
00331                 ptMin.x += dx;
00332                 ptMin.y = yOrg;
00333             }
00334         } <span class="keywordflow">else</span> {
00335             <span class="comment">// Same pass</span>
00336             <span class="keywordflow">if</span> (fHorizontal)
00337                 ptMin.x += dx;
00338             <span class="keywordflow">else</span>
00339                 ptMin.y += dy;
00340         }
00341     }
00342 
00343     psmwp = <a class="code" href="../../d4/d1/userk_8h.html#a1616">InternalBeginDeferWindowPos</a>(2 * nIcons);
00344     <span class="keywordflow">if</span> (psmwp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00345         <span class="keywordflow">goto</span> ParkExit;
00346 
00347     <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1; phwnd++) {
00348 
00349         <span class="comment">/*</span>
00350 <span class="comment">         * Check for a NULL (window has gone away)</span>
00351 <span class="comment">         */</span>
00352         <span class="keywordflow">if</span> (*phwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || (pwndTest = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00353             <span class="keywordflow">continue</span>;
00354 
00355         pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwndTest, <a class="code" href="../../d4/d1/userk_8h.html#a475">PROP_CHECKPOINT</a>,
00356                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>);
00357 
00358 
00359         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndTest, &amp;tlpwndTest);
00360 
00361         psmwp = <a class="code" href="../../d4/d1/userk_8h.html#a1619">_DeferWindowPos</a>(
00362                 psmwp,
00363                 pwndTest,
00364                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00365                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x,
00366                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y,
00367                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED),
00368                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED),
00369                 SWP_NOZORDER | SWP_NOACTIVATE | SWP_NOCOPYBITS);
00370 
00371         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndTest);
00372 
00373         <span class="keywordflow">if</span> (psmwp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00374             <span class="keywordflow">break</span>;
00375     }
00376     <span class="keywordflow">if</span> (psmwp != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00377         <span class="comment">/*</span>
00378 <span class="comment">         * Make the swp async so we don't hang waiting for hung apps.</span>
00379 <span class="comment">         */</span>
00380         <a class="code" href="../../d4/d1/userk_8h.html#a1620">xxxEndDeferWindowPosEx</a>(psmwp, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00381     }
00382 
00383 ParkExit:
00384     <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
00385     <span class="keywordflow">return</span> nIcons;
00386 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:20 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
