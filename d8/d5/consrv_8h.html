<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: consrv.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>consrv.h File Reference</h1>
<p>
<a href="../../d9/d4/consrv_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/structtagFACENODE.html">tagFACENODE</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>(_params_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a1">DBGFONTS2</a>(_params_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>(_params_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>(_params_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a4">DBGFULLSCR</a>(_params_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a5">DBGPRINT</a>(_params_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a6">CONSOLE_MAX_FONT_NAME_LENGTH</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a7">DATA_CHUNK_SIZE</a>&nbsp;&nbsp;&nbsp;8192</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a8">MAKE_TAG</a>(t)&nbsp;&nbsp;&nbsp;(RTL_HEAP_MAKE_TAG( <a class="el" href="../../d0/d5/srvinit_8c.html#a18">dwConBaseTag</a>, t ))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a9">TMP_TAG</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a10">BMP_TAG</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a11">ALIAS_TAG</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a12">HISTORY_TAG</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a13">TITLE_TAG</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a14">HANDLE_TAG</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a15">CONSOLE_TAG</a>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a16">ICON_TAG</a>&nbsp;&nbsp;&nbsp;7</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a17">BUFFER_TAG</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a18">WAIT_TAG</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a19">FONT_TAG</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a20">SCREEN_TAG</a>&nbsp;&nbsp;&nbsp;11</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a21">GetWindowConsole</a>(<a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>)&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)GetWindowLongPtr((<a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>), GWLP_USERDATA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a22">SetConsoleBkColor</a>(hw, clr)&nbsp;&nbsp;&nbsp;SetWindowLong(hw, GWL_CONSOLE_BKCOLOR, clr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a23">SetConsolePid</a>(hw, pid)&nbsp;&nbsp;&nbsp;SetWindowLong(hw, GWL_CONSOLE_PID, pid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a24">SetConsoleTid</a>(hw, tid)&nbsp;&nbsp;&nbsp;SetWindowLong(hw, GWL_CONSOLE_TID, tid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a25">NELEM</a>(array)&nbsp;&nbsp;&nbsp;(sizeof(array)/sizeof(array[0]))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a26">CON_FAMILY</a>(pCon)&nbsp;&nbsp;&nbsp;SCR_FAMILY((pCon)-&gt;CurrentScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a27">CON_FONTNUMBER</a>(pCon)&nbsp;&nbsp;&nbsp;SCR_FONTNUMBER((pCon)-&gt;CurrentScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a28">CON_FACENAME</a>(pCon)&nbsp;&nbsp;&nbsp;SCR_FACENAME((pCon)-&gt;CurrentScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a29">CON_FONTSIZE</a>(pCon)&nbsp;&nbsp;&nbsp;SCR_FONTSIZE((pCon)-&gt;CurrentScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a30">CON_FONTWEIGHT</a>(pCon)&nbsp;&nbsp;&nbsp;SCR_FONTWEIGHT((pCon)-&gt;CurrentScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a31">CON_FONTCODEPAGE</a>(pCon)&nbsp;&nbsp;&nbsp;SCR_FONTCODEPAGE((pCon)-&gt;CurrentScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()&nbsp;&nbsp;&nbsp;(FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()&nbsp;&nbsp;&nbsp;(FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a34">LoadStringEx</a>&nbsp;&nbsp;&nbsp;LoadStringExA</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a35">ValidateConsoleHeap</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(Flags, <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)&nbsp;&nbsp;&nbsp;Win32HeapAlloc(<a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>, <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, Flags, Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a37">ConsoleHeapReAlloc</a>(Flags, Address, <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)&nbsp;&nbsp;&nbsp;Win32HeapReAlloc(<a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>, Address, <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Address)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a39">ConsoleHeapSize</a>(Address)&nbsp;&nbsp;&nbsp;Win32HeapSize(<a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>, Address)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a40">LockConsoleHandleTable</a>()&nbsp;&nbsp;&nbsp;RtlEnterCriticalSection(&amp;<a class="el" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a6">ConsoleHandleLock</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a41">UnlockConsoleHandleTable</a>()&nbsp;&nbsp;&nbsp;RtlLeaveCriticalSection(&amp;<a class="el" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a6">ConsoleHandleLock</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a42">LockConsole</a>(Con)&nbsp;&nbsp;&nbsp;RtlEnterCriticalSection(&amp;(Con)-&gt;ConsoleLock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(Con, Attr)&nbsp;&nbsp;&nbsp;((Con)-&gt;<a class="el" href="../../d1/d5/structColorTable.html">ColorTable</a>[(Attr) &amp; 0x0F])</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a44">CONSOLE_SHUTDOWN_FAILED</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a45">CONSOLE_SHUTDOWN_SUCCEEDED</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a46">CONSOLE_SHUTDOWN_SYSTEM</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a47">LINK_NOINFO</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a48">LINK_SIMPLEINFO</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a49">LINK_FULLINFO</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a50">EF_NEW</a>&nbsp;&nbsp;&nbsp;0x0001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a51">EF_OLD</a>&nbsp;&nbsp;&nbsp;0x0002</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a52">EF_ENUMERATED</a>&nbsp;&nbsp;&nbsp;0x0004</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>&nbsp;&nbsp;&nbsp;0x0008</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a54">EF_TTFONT</a>&nbsp;&nbsp;&nbsp;0x0010</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a>&nbsp;&nbsp;&nbsp;0x0020</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a56">SCREEN_BUFFER_POINTER</a>(X, Y, XSIZE, CELLSIZE)&nbsp;&nbsp;&nbsp;(((XSIZE * (Y)) + (X)) * (ULONG)CELLSIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a57">W32PF_ALLOWSETFOREGROUND</a>&nbsp;&nbsp;&nbsp;0x00080000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a58">W32PF_CONSOLEHASFOCUS</a>&nbsp;&nbsp;&nbsp;0x04000000</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d4/structtagFACENODE.html">tagFACENODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a61">FACENODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d4/structtagFACENODE.html">tagFACENODE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a62">PFACENODE</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>__inline <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a63">SCR_FAMILY</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline LPWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a65">SCR_FACENAME</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline COORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a67">SCR_FONTWEIGHT</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a68">SCR_FONTCODEPAGE</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> pScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a69">ConsoleAddProcessRoutine</a> (IN PCSR_PROCESS ParentProcess, IN PCSR_PROCESS Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a70">DereferenceConsoleHandle</a> (IN HANDLE ConsoleHandle, OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a71">AllocateConsoleHandle</a> (OUT PHANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a72">FreeConsoleHandle</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a73">ValidateConsole</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a74">ApiPreamble</a> (IN HANDLE ConsoleHandle, OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a75">RevalidateConsole</a> (IN HANDLE ConsoleHandle, OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a76">InitializeConsoleHandleTable</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a77">UnProtectHandle</a> (HANDLE hObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a78">AllocateConsole</a> (IN HANDLE ConsoleHandle, IN LPWSTR Title, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> TitleLength, IN HANDLE ClientProcessHandle, OUT PHANDLE StdIn, OUT PHANDLE StdOut, OUT PHANDLE StdErr, OUT <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN OUT <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a> ConsoleInfo, IN BOOLEAN WindowVisible, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ConsoleThreadId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a79">DestroyConsole</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a80">FreeCon</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a81">InsertScreenBuffer</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a82">RemoveScreenBuffer</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a83">FreeProcessData</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a84">AllocateIoHandle</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN ULONG HandleType, OUT PHANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a85">GrowIoHandleTable</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a86">FreeIoHandle</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a87">DereferenceIoHandleNoCheck</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> *HandleData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a88">DereferenceIoHandle</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN ULONG HandleType, IN ACCESS_MASK Access, OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> *HandleData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a89">InitializeInputHandle</a> (<a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData, <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a90">InitializeOutputHandle</a> (<a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a91">SrvVerifyConsoleIoHandle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a92">ConsoleAddShare</a> (IN ACCESS_MASK DesiredAccess, IN ULONG DesiredShareAccess, IN OUT <a class="el" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a> ShareAccess, IN OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a93">ConsoleDupShare</a> (IN ACCESS_MASK DesiredAccess, IN ULONG DesiredShareAccess, IN OUT <a class="el" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a> ShareAccess, IN OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> TargetHandleData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a94">ConsoleRemoveShare</a> (IN ULONG DesiredAccess, IN ULONG DesiredShareAccess, IN OUT <a class="el" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a> ShareAccess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a95">DoFind</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a96">ScrollScreen</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN PSMALL_RECT ScrollRect, IN PSMALL_RECT MergeRect, IN COORD TargetPoint)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a97">SetProcessForegroundRights</a> (IN PCSR_PROCESS Process, IN BOOL Foreground)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a98">SetProcessFocus</a> (IN PCSR_PROCESS Process, IN BOOL Foreground)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a99">ModifyConsoleProcessFocus</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN BOOL Foreground)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a100">InitializeSystemMetrics</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a101">InitializeScreenInfo</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a102">ReadScreenBuffer</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInformation, OUT PCHAR_INFO <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PSMALL_RECT ReadRegion)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a103">WriteScreenBuffer</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInformation, OUT PCHAR_INFO <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PSMALL_RECT WriteRegion)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a104">DoCreateScreenBuffer</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a> ConsoleInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a105">CreateScreenBuffer</a> (OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> *ScreenInformation, IN COORD dwWindowSize OPTIONAL, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nFont OPTIONAL, IN COORD dwScreenBufferSize OPTIONAL, IN CHAR_INFO Fill, IN CHAR_INFO PopupFill, IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Flags, IN PCONSOLE_GRAPHICS_BUFFER_INFO GraphicsBufferInfo OPTIONAL, OUT PVOID *lpBitmap, OUT HANDLE *hMutex, IN UINT CursorSize, IN LPWSTR FaceName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a106">AbortCreateConsole</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a107">CreateWindowsWindow</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a108">DestroyWindowsWindow</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a109">FreeScreenBuffer</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a110">ReadOutputString</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, OUT PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN COORD ReadCoord, IN ULONG StringType, IN OUT PULONG NumRecords)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a111">InitializeScrollBuffer</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a112">GetScreenBufferInformation</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, OUT PCOORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, OUT PCOORD CursorPosition, OUT PCOORD ScrollPosition, OUT PWORD Attributes, OUT PCOORD CurrentWindowSize, OUT PCOORD MaximumWindowSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a113">GetWindowLimits</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, OUT <a class="el" href="../../d0/d9/struct__WINDOW__LIMITS.html">PWINDOW_LIMITS</a> WindowLimits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a114">ResizeWindow</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN PSMALL_RECT WindowDimensions, IN BOOL DoScrollBarUpdate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a115">ResizeScreenBuffer</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN COORD NewScreenSize, IN BOOL DoScrollBarUpdate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a116">ScrollRegion</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN PSMALL_RECT ScrollRectangle, IN PSMALL_RECT ClipRectangle OPTIONAL, IN COORD DestinationOrigin, IN CHAR_INFO Fill)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a117">SetWindowOrigin</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN BOOLEAN Absolute, IN OUT COORD WindowOrigin)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a118">SetWindowSize</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a119">SetActiveScreenBuffer</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a120">QueueConsoleMessage</a> (<a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, UINT Message, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a121">ConsoleWindowProc</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, UINT Message, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a122">VerticalScroll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN WORD ScrollCommand, IN WORD AbsoluteChange)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a123">HorizontalScroll</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN WORD ScrollCommand, IN WORD AbsoluteChange)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a124">StreamScrollRegion</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a125">ReadRectFromScreenBuffer</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN COORD SourcePoint, IN PCHAR_INFO Target, IN COORD TargetSize, IN PSMALL_RECT TargetRect)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a126">InitializeThreadMessages</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a127">QueueThreadMessage</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId, UINT Message, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a128">UnqueueThreadMessage</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId, UINT *pMessage, WPARAM *pwParam, LPARAM *plParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a129">ConsoleDragQueryFile</a> (IN HANDLE hDrop, IN PVOID lpFile, IN UINT cb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a130">DoDrop</a> (IN WPARAM wParam, IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a131">ReadBuffer</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInformation, OUT PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN ULONG Length, OUT PULONG EventsRead, IN BOOL Peek, IN BOOL StreamRead, OUT PBOOL ResetWaitEvent, IN BOOLEAN <a class="el" href="../../d3/d0/user32_8def.html#a97">Unicode</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a132">ConsoleInputThread</a> (IN <a class="el" href="../../d0/d3/struct__INPUT__THREAD__INIT__INFO.html">PINPUT_THREAD_INIT_INFO</a> pInputThreadInitInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a133">StoreKeyInfo</a> (IN PMSG <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a134">RetrieveKeyInfo</a> (IN HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, OUT PWORD pwVirtualKeyCode, OUT PWORD pwVirtualScanCode, IN BOOL FreeKeyInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a135">ClearKeyInfo</a> (IN HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a136">ReadInputBuffer</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInformation, OUT PINPUT_RECORD lpBuffer, IN OUT PDWORD nLength, IN BOOL Peek, IN BOOL WaitForData, IN BOOL StreamRead, IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData OPTIONAL, IN PCSR_API_MSG Message OPTIONAL, IN CSR_WAIT_ROUTINE WaitRoutine OPTIONAL, IN PVOID WaitParameter OPTIONAL, IN ULONG WaitParameterLength OPTIONAL, IN BOOLEAN WaitBlockExists OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a137">WriteInputBuffer</a> (<a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputBufferInformation, PINPUT_RECORD lpBuffer, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a138">PrependInputBuffer</a> (<a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputBufferInformation, PINPUT_RECORD lpBuffer, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a139">CreateInputBuffer</a> (IN ULONG NumberOfEvents OPTIONAL, IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputBufferInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a140">ReinitializeInputBuffer</a> (OUT <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputBufferInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a141">FreeInputBuffer</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputBufferInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a142">GetNumberOfReadyEvents</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInformation, OUT PULONG NumberOfEvents)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a143">FlushInputBuffer</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a144">FlushAllButKeys</a> (<a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a145">SetInputBufferSize</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInformation, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a146">HandleSysKeyEvent</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, IN UINT Message, IN WPARAM wParam, IN LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a147">HandleKeyEvent</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, IN UINT Message, IN WPARAM wParam, IN LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a148">HandleMouseEvent</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN UINT Message, IN WPARAM wParam, IN LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a149">HandleMenuEvent</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> wParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a150">HandleFocusEvent</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN BOOL bSetFocus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a151">HandleCtrlEvent</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> EventType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a152">CreateCtrlThread</a> (IN <a class="el" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html">PCONSOLE_PROCESS_TERMINATION_RECORD</a> ProcessHandleList, IN ULONG ProcessHandleListLength, IN PWCHAR Title, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> EventType, IN BOOL fForce)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a153">UnlockConsole</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a154">ShutdownConsole</a> (IN HANDLE ConsoleHandle, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a155">GetLinkProperties</a> (LPWSTR pszLinkName, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpvBuffer, UINT cb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a156">GetTitleFromLinkName</a> (IN LPWSTR szLinkName, OUT LPWSTR <a class="el" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a157">InitializeFonts</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a158">InitializeCustomCP</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a159">EnumerateFonts</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a160">InitializeMouseButtons</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a161">GetMouseButtons</a> (PULONG NumButtons)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a162">FindTextBufferFontInfo</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN UINT CodePage, OUT <a class="el" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> TextFontInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a163">StoreTextBufferFontInfo</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN ULONG FontIndex, IN COORD FontSize, IN <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> FontFamily, IN LONG FontWeight, IN LPWSTR FaceName, IN UINT CodePage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a164">RemoveTextBufferFontInfo</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a165">GetNumFonts</a> (OUT PULONG <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a8">NumberOfFonts</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a166">GetAvailableFonts</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN BOOLEAN MaximumWindow, OUT PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG NumFonts)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a167">GetFontSize</a> (IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FontIndex, OUT PCOORD FontSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a168">GetCurrentFont</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN BOOLEAN MaximumWindow, OUT PULONG FontIndex, OUT PCOORD FontSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a169">SetFont</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a170">SetScreenBufferFont</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN ULONG FontIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a171">ConvertToOem</a> (IN UINT Codepage, IN LPWSTR Source, IN int SourceLength, OUT LPSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a172">ConvertInputToUnicode</a> (IN UINT Codepage, IN LPSTR Source, IN int SourceLength, OUT LPWSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a173">CharToWcharGlyph</a> (IN UINT Codepage, IN char Ch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a174">CharToWchar</a> (IN UINT Codepage, IN char Ch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a175">WcharToChar</a> (IN UINT Codepage, IN WCHAR Wchar)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a176">ConvertOutputToUnicode</a> (IN UINT Codepage, IN LPSTR Source, IN int SourceLength, OUT LPWSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a177">ConvertOutputToOem</a> (IN UINT Codepage, IN LPWSTR Source, IN int SourceLength, OUT LPSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a178">RealUnicodeToFalseUnicode</a> (IN OUT LPWSTR Source, IN int SourceLength, IN UINT Codepage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a179">FalseUnicodeToRealUnicode</a> (IN OUT LPWSTR Source, IN int SourceLength, IN UINT Codepage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a180">InitializeSubst</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a181">ShutdownSubst</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a182">SrvConsoleSubst</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a183">DoFontEnum</a> (IN HDC hDC OPTIONAL, IN LPWSTR pwszFace OPTIONAL, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> TTPointSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a184">SrvGetConsoleInput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a185">SrvWriteConsoleInput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a186">SrvReadConsoleOutput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a187">SrvWriteConsoleOutput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a188">SrvReadConsoleOutputString</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a189">SrvWriteConsoleOutputString</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a190">SrvFillConsoleOutput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a191">SrvCreateConsoleScreenBuffer</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a192">TranslateOutputToPaddingUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN OUT PCHAR_INFO OutputBufferR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a193">SrvGetConsoleMode</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a194">SrvGetConsoleNumberOfFonts</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a195">SrvGetConsoleNumberOfInputEvents</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a196">SrvGetLargestConsoleWindowSize</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a197">SrvGetConsoleScreenBufferInfo</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a198">SrvGetConsoleCursorInfo</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a199">SrvGetConsoleMouseInfo</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a200">SrvGetConsoleFontInfo</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a201">SrvGetConsoleFontSize</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a202">SrvGetConsoleCurrentFont</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a203">SrvSetConsoleMode</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a204">SrvGenerateConsoleCtrlEvent</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a205">SrvSetConsoleActiveScreenBuffer</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a206">SrvFlushConsoleInputBuffer</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a207">SrvSetConsoleScreenBufferSize</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a208">SrvSetConsoleCursorPosition</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a209">SrvSetConsoleCursorInfo</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a210">SrvSetConsoleWindowInfo</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a211">SrvScrollConsoleScreenBuffer</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a212">SrvSetConsoleTextAttribute</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a213">SrvSetConsoleFont</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a214">SrvSetConsoleIcon</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a215">SetScreenColors</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN WORD Attributes, IN WORD PopupAttributes, IN BOOL UpdateWholeScreen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a216">SrvSetConsoleCP</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a217">SrvGetConsoleCP</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a218">SrvGetConsoleKeyboardLayoutName</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a219">SrvGetConsoleWindow</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a220">CookedRead</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a221">ReadChars</a> (IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a> InputInfo, IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN OUT PWCHAR lpBuffer, IN OUT PDWORD NumBytes, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> InitialNumBytes, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CtrlWakeupMask, IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData, IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN PCSR_API_MSG Message OPTIONAL, IN HANDLE HandleIndex, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d8/d9/dllinit_8c.html#a5">ExeNameLength</a>, IN PWCHAR ExeName, IN BOOLEAN <a class="el" href="../../d3/d0/user32_8def.html#a97">Unicode</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a222">SrvOpenConsole</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a223">SrvReadConsole</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a224">SrvWriteConsole</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a225">SrvDuplicateHandle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a226">SrvGetHandleInformation</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a227">SrvSetHandleInformation</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a228">UnblockWriteConsole</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Reason)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a229">CloseInputHandle</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a230">CloseOutputHandle</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN BOOLEAN FreeHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a231">SrvCloseHandle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a232">MakeCursorVisible</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN COORD CursorPosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a233">SetCursorInformation</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, BOOLEAN Visible)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a234">SetCursorPosition</a> (IN OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN COORD Position, IN BOOL TurnOn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a235">SetCursorMode</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, BOOLEAN DoubleCursor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a236">CursorTimerRoutine</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a237">ConsoleHideCursor</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a238">ConsoleShowCursor</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a239">InitializeConsoleCommandData</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a240">SrvAddConsoleAlias</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a241">SrvGetConsoleAlias</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a242">SrvGetConsoleAliasesLength</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a243">SrvGetConsoleAliasExesLength</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a244">SrvGetConsoleAliases</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a245">SrvGetConsoleAliasExes</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a246">SrvExpungeConsoleCommandHistory</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a247">SrvSetConsoleNumberOfCommands</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a248">SrvGetConsoleCommandHistoryLength</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a249">SrvGetConsoleCommandHistory</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a250">SrvSetConsoleCommandHistoryMode</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a251">MatchandCopyAlias</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PWCHAR Source, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> SourceLength, OUT PWCHAR TargetBuffer, IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a> TargetLength, IN LPWSTR Exe, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> ExeLength, OUT PDWORD LineCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a252">AddCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN PWCHAR Command, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Length, IN BOOL HistoryNoDup)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a253">RetrieveCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN WORD VirtualKeyCode, IN PWCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN ULONG <a class="el" href="../../d7/d2/rtqval_8c.html#a7">BufferSize</a>, OUT PULONG CommandSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a254">AllocateCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AppNameLength, IN PWCHAR AppName, IN HANDLE ProcessHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a255">ResetCommandHistory</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a256">SrvGetConsoleTitle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a257">SrvSetConsoleTitle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a258">FreeAliasBuffers</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a259">FreeCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN HANDLE ProcessHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a260">FreeCommandHistoryBuffers</a> (IN OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a261">ResizeCommandHistoryBuffers</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN UINT NumCommands)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a262">MyStringCompareW</a> (IN LPWSTR Str1, IN LPWSTR Str2, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Length, IN BOOLEAN bCaseInsensitive)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a263">LoadStringExW</a> (IN HINSTANCE hModule, IN UINT wID, OUT LPWSTR lpBuffer, IN int cchBufferMax, IN WORD wLangId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a264">SrvAllocConsole</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a265">SrvFreeConsole</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a266">RemoveConsole</a> (IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, IN HANDLE ProcessHandle, IN HANDLE ProcessId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a267">MapHandle</a> (IN HANDLE ClientProcessHandle, IN HANDLE ServerHandle, OUT PHANDLE ClientHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a268">InitializeConsoleAttributes</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a269">GetRegistryValues</a> (IN LPWSTR ConsoleTitle, OUT <a class="el" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html">PCONSOLE_REGISTRY_INFO</a> RegInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LPWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a270">TranslateConsoleTitle</a> (LPWSTR ConsoleTitle, <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a> pcbTranslatedLength, BOOL Unexpand, BOOL Substitute)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a271">GetConsoleLangId</a> (IN UINT OutputCP, OUT LANGID *pLangId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a272">SrvGetConsoleLangId</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a273">CreateConsoleBitmap</a> (IN OUT PCONSOLE_GRAPHICS_BUFFER_INFO GraphicsInfo, IN OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, OUT PVOID *lpBitmap, OUT HANDLE *hMutex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a274">WriteRegionToScreenBitMap</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN PSMALL_RECT Region)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a275">SrvInvalidateBitMapRect</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a276">SrvVDMConsoleOperation</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a277">UpdateMousePosition</a> (<a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, COORD Position)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a278">SrvSetConsoleCursor</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a279">SrvShowConsoleCursor</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a280">SrvConsoleMenuControl</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a281">SrvSetConsolePalette</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a282">SrvSetConsoleDisplayMode</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a283">SetActivePalette</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a284">UnsetActivePalette</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a285">SrvRegisterConsoleVDM</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a286">SrvConsoleNotifyLastClose</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a287">SrvGetConsoleHardwareState</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a288">SrvSetConsoleHardwareState</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a289">SrvGetConsoleDisplayMode</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a290">SrvSetConsoleMenuClose</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a291">SrvSetConsoleKeyShortcuts</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a292">InitializeFullScreen</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a> (<a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, HWND hwnd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a294">InitSystemMenu</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a295">InitializeMenu</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a296">SetWinText</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN UINT wID, IN BOOL Add)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a297">PropertiesDlgShow</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN BOOL fCurrent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a298">PropertiesUpdate</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN HANDLE hClientSection)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a299">FindCreateFont</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Family, LPWSTR pwszTTFace, COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, LONG Weight, UINT CodePage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a300">DoCopy</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a301">DoMark</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a302">DoSelectAll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a303">DoStringPaste</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PWCHAR pwStr, IN UINT DataSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a304">DoPaste</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN COORD CursorPosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a307">StoreSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a308">InvertSelection</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, BOOL Inverting)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PSMALL_RECT SmallRect)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a310">ConvertToMouseSelect</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN COORD MousePosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a311">DoScroll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a312">ClearScroll</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a313">SetConsoleReserveKeys</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fsReserveKeys)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a314">GreGetDIBitsInternal</a> (HDC hdc, HBITMAP hBitmap, UINT iStartScan, UINT cNumScan, LPBYTE pjBits, LPBITMAPINFO pBitsInfo, UINT iUsage, UINT cjMaxBits, UINT cjMaxInfo)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PWIN32HEAP&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a59">pConHeap</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/consrv_8h.html#a60">dwConBaseTag</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a11" doxytag="consrv.h::ALIAS_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ALIAS_TAG&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00064">64</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00483">AddAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00524">ReplaceAlias()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="consrv.h::BMP_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BMP_TAG&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00063">63</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00027">CreateConsoleBitmap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="consrv.h::BUFFER_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BUFFER_TAG&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00070">70</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00103">CreateInputBuffer()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01410">PrependInputBuffer()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00516">SetInputBufferSize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="consrv.h::CON_FACENAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CON_FACENAME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">pCon&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SCR_FACENAME((pCon)-&gt;CurrentScreenBuffer)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00132">132</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="consrv.h::CON_FAMILY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CON_FAMILY          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">pCon&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SCR_FAMILY((pCon)-&gt;CurrentScreenBuffer)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00130">130</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="consrv.h::CON_FONTCODEPAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CON_FONTCODEPAGE          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">pCon&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SCR_FONTCODEPAGE((pCon)-&gt;CurrentScreenBuffer)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00135">135</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="consrv.h::CON_FONTNUMBER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CON_FONTNUMBER          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">pCon&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SCR_FONTNUMBER((pCon)-&gt;CurrentScreenBuffer)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00131">131</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="consrv.h::CON_FONTSIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CON_FONTSIZE          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">pCon&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SCR_FONTSIZE((pCon)-&gt;CurrentScreenBuffer)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00133">133</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="consrv.h::CON_FONTWEIGHT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CON_FONTWEIGHT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">pCon&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SCR_FONTWEIGHT((pCon)-&gt;CurrentScreenBuffer)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00134">134</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="consrv.h::CONSOLE_IS_DBCS_ENABLED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_IS_DBCS_ENABLED          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(FALSE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">149</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00270">DoCreateScreenBuffer()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">GetConsoleLangId()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00801">SB_TranslateOutputToOem()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00976">SB_TranslateOutputToUnicode()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00168">SrvInvalidateBitMapRect()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01229">SrvSetConsoleCP()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="consrv.h::CONSOLE_IS_IME_ENABLED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_IS_IME_ENABLED          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(FALSE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00150">150</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01726">DialogHookProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="consrv.h::CONSOLE_MAX_FONT_NAME_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_MAX_FONT_NAME_LENGTH&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00055">55</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00109">InitializeFonts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="consrv.h::CONSOLE_SHUTDOWN_FAILED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_SHUTDOWN_FAILED&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00870">870</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03502">CreateCtrlThread()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="consrv.h::CONSOLE_SHUTDOWN_SUCCEEDED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_SHUTDOWN_SUCCEEDED&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00871">871</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03502">CreateCtrlThread()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="consrv.h::CONSOLE_SHUTDOWN_SYSTEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_SHUTDOWN_SYSTEM&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00872">872</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03502">CreateCtrlThread()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="consrv.h::CONSOLE_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONSOLE_TAG&nbsp;&nbsp;&nbsp;6          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00068">68</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="consrv.h::ConsoleHeapAlloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ConsoleHeapAlloc          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flags,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;Win32HeapAlloc(<a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>, <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, Flags, Flags)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">180</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00483">AddAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00080">AddFaceNode()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">AllocateCommandHistory()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02609">AllocateScrollBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00705">ConsoleAddProcessRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">ConvertOutputToOem()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">ConvertOutputToUnicode()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00027">CreateConsoleBitmap()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05870">CreateDbcsScreenBuffer()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00103">CreateInputBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">DrawCommandListPopup()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d0/d2/__priv_8h-source.html#l00041">FE_WriteRegionToScreenHW()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00401">FlushAllButKeys()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00223">GrowConsoleHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01234">GrowIoHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00561">InheritIoHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01335">InitializeInputHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02631">InitializeScrollBuffer()</a>, <a class="el" href="../../d4/d3/link_8c-source.html#l00129">LoadLink()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01124">MergeAttrStrings()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01670">MyRegQueryValue()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01410">PrependInputBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04267">QueueConsoleMessage()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01860">QueueThreadMessage()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d4/d3/link_8c-source.html#l00092">ReadString()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05985">ReCreateDbcsScreenBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00524">ReplaceAlias()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00516">SetInputBufferSize()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03336">SetRAMFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03175">SetRAMFontCodePage()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>, <a class="el" href="../../d3/d4/srvvdm_8c-source.html#l00024">SrvVDMConsoleOperation()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00881">StoreTextBufferFontInfo()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">TranslateConsoleTitle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02674">UpdateComplexRegion()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00248">WaitForMoreToRead()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="consrv.h::ConsoleHeapFree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ConsoleHeapFree          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Address&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                                       \
    Win32HeapFree(pConHeap, Address);                   \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">193</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00483">AddAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">AllocateCommandHistory()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00705">ConsoleAddProcessRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">ConvertOutputToOem()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">ConvertOutputToUnicode()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00027">CreateConsoleBitmap()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05870">CreateDbcsScreenBuffer()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00103">CreateInputBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05926">DeleteDbcsScreenBuffer()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">DrawCommandListPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03227">EmptyCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00061">FE_StreamWriteToScreenBuffer()</a>, <a class="el" href="../../d0/d2/__priv_8h-source.html#l00041">FE_WriteRegionToScreenHW()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00401">FlushAllButKeys()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00571">FreeAliasList()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04640">FreeCommandHistoryBuffers()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00353">FreeConsoleBitmap()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00221">FreeInputBuffer()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01378">FreeInputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01280">FreeProcessData()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02623">FreeScrollBuffer()</a>, <a class="el" href="../../d4/d3/link_8c-source.html#l00264">GetLinkProperties()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00223">GrowConsoleHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01234">GrowIoHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00561">InheritIoHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01335">InitializeInputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02631">InitializeScrollBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01124">MergeAttrStrings()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01670">MyRegQueryValue()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01410">PrependInputBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04267">QueueConsoleMessage()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01860">QueueThreadMessage()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05985">ReCreateDbcsScreenBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00552">RemoveAlias()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00932">RemoveProcessFromList()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00952">RemoveTextBufferFontInfo()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00524">ReplaceAlias()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00516">SetInputBufferSize()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03336">SetRAMFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03175">SetRAMFontCodePage()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>, <a class="el" href="../../d3/d4/srvvdm_8c-source.html#l00024">SrvVDMConsoleOperation()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02998">StreamScrollRegion()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04323">UnqueueConsoleMessage()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01906">UnqueueThreadMessage()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02674">UpdateComplexRegion()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00248">WaitForMoreToRead()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02529">WriteConsoleWaitRoutine()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01918">WWSB_FillRectangle()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="consrv.h::ConsoleHeapReAlloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ConsoleHeapReAlloc          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flags,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Address,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;Win32HeapReAlloc(<a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>, Address, <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, Flags)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00183">183</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, <a class="el" href="../../d4/d3/link_8c-source.html#l00129">LoadLink()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="consrv.h::ConsoleHeapSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ConsoleHeapSize          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Address&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;Win32HeapSize(<a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>, Address)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00199">199</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03336">SetRAMFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03175">SetRAMFontCodePage()</a>, <a class="el" href="../../d3/d4/srvvdm_8c-source.html#l00024">SrvVDMConsoleOperation()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="consrv.h::ConvertAttrToRGB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ConvertAttrToRGB          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Con,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Attr&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((Con)-&gt;<a class="el" href="../../d1/d5/structColorTable.html">ColorTable</a>[(Attr) &amp; 0x0F])</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00264">264</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l02145">WWSB_ConsolePolyTextOut()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="consrv.h::DATA_CHUNK_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DATA_CHUNK_SIZE&nbsp;&nbsp;&nbsp;8192          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00057">57</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="consrv.h::DBGCHARS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DBGCHARS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_params_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">40</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01469">CharToWchar()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01443">CharToWcharGlyph()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">ConvertOutputToOem()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">ConvertOutputToUnicode()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02089">InitializeFullScreen()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01093">SB_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00801">SB_TranslateOutputToOem()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00924">SB_TranslateOutputToOemUnicode()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00976">SB_TranslateOutputToUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00045">TranslateInputToOem()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00165">TranslateInputToUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01489">WcharToChar()</a>, and <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="consrv.h::DBGFONTS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DBGFONTS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_params_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">38</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="consrv.h::DBGFONTS2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DBGFONTS2          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_params_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00039">39</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="consrv.h::DBGFULLSCR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DBGFULLSCR          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_params_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00042">42</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01519">ConnectToEmulator()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="consrv.h::DBGOUTPUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DBGOUTPUT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_params_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">41</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l01551">CopyRectangle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00061">FE_StreamWriteToScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01415">ReadRectFromScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01623">ReadScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02737">ScrollScreen()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">SrvReadConsoleOutput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01706">WriteScreenBuffer()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01918">WWSB_FillRectangle()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00918">WWSB_WriteToScreen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="consrv.h::DBGPRINT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DBGPRINT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_params_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00043">43</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="consrv.h::EF_DEFFACE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EF_DEFFACE&nbsp;&nbsp;&nbsp;0x0020          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00930">930</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="consrv.h::EF_ENUMERATED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EF_ENUMERATED&nbsp;&nbsp;&nbsp;0x0004          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00927">927</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="consrv.h::EF_NEW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EF_NEW&nbsp;&nbsp;&nbsp;0x0001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00925">925</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="consrv.h::EF_OEMFONT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EF_OEMFONT&nbsp;&nbsp;&nbsp;0x0008          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00928">928</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="consrv.h::EF_OLD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EF_OLD&nbsp;&nbsp;&nbsp;0x0002          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00926">926</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="consrv.h::EF_TTFONT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EF_TTFONT&nbsp;&nbsp;&nbsp;0x0010          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00929">929</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="consrv.h::FONT_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FONT_TAG&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">72</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00080">AddFaceNode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00881">StoreTextBufferFontInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="consrv.h::GetWindowConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetWindowConsole          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)GetWindowLongPtr((<a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>), GWLP_USERDATA)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00083">83</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="consrv.h::HANDLE_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HANDLE_TAG&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00067">67</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00705">ConsoleAddProcessRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00223">GrowConsoleHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01234">GrowIoHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00561">InheritIoHandleTable()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01335">InitializeInputHandle()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="consrv.h::HISTORY_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HISTORY_TAG&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">65</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">AllocateCommandHistory()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="consrv.h::ICON_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ICON_TAG&nbsp;&nbsp;&nbsp;7          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00069">69</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="consrv.h::LINK_FULLINFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LINK_FULLINFO&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00900">900</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/link_8c-source.html#l00264">GetLinkProperties()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="consrv.h::LINK_NOINFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LINK_NOINFO&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00898">898</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/link_8c-source.html#l00264">GetLinkProperties()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00360">LoadLinkInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="consrv.h::LINK_SIMPLEINFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LINK_SIMPLEINFO&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00899">899</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/link_8c-source.html#l00264">GetLinkProperties()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00360">LoadLinkInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="consrv.h::LoadStringEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LoadStringEx&nbsp;&nbsp;&nbsp;LoadStringExA          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00157">157</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03040">CopyFromCharPopup()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03096">CopyToCharPopup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="consrv.h::LockConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LockConsole          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Con&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;RtlEnterCriticalSection(&amp;(Con)-&gt;ConsoleLock)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00260">260</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00959">ReadInputBuffer()</a>, and <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="consrv.h::LockConsoleHandleTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LockConsoleHandleTable          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;RtlEnterCriticalSection(&amp;<a class="el" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a6">ConsoleHandleLock</a>)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00258">258</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02529">WriteConsoleWaitRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="consrv.h::MAKE_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAKE_TAG          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">t&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(RTL_HEAP_MAKE_TAG( <a class="el" href="../../d0/d5/srvinit_8c.html#a18">dwConBaseTag</a>, t ))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00060">60</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="consrv.h::NELEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NELEM          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">array&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(sizeof(array)/sizeof(array[0]))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00101">101</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="consrv.h::SCREEN_BUFFER_POINTER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SCREEN_BUFFER_POINTER          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">X,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Y,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>XSIZE,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CELLSIZE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((XSIZE * (Y)) + (X)) * (ULONG)CELLSIZE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l02003">2003</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="consrv.h::SCREEN_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SCREEN_TAG&nbsp;&nbsp;&nbsp;11          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00073">73</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l02609">AllocateScrollBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02631">InitializeScrollBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01124">MergeAttrStrings()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="consrv.h::SetConsoleBkColor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SetConsoleBkColor          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">hw,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>clr&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SetWindowLong(hw, GWL_CONSOLE_BKCOLOR, clr)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00093">93</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="consrv.h::SetConsolePid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SetConsolePid          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">hw,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>pid&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SetWindowLong(hw, GWL_CONSOLE_PID, pid)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00094">94</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="consrv.h::SetConsoleTid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SetConsoleTid          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">hw,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>tid&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SetWindowLong(hw, GWL_CONSOLE_TID, tid)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00095">95</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="consrv.h::TITLE_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TITLE_TAG&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00066">66</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">TranslateConsoleTitle()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="consrv.h::TMP_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TMP_TAG&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">62</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">ConvertOutputToOem()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">ConvertOutputToUnicode()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d0/d2/__priv_8h-source.html#l00041">FE_WriteRegionToScreenHW()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00401">FlushAllButKeys()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01670">MyRegQueryValue()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04267">QueueConsoleMessage()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01860">QueueThreadMessage()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02674">UpdateComplexRegion()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="consrv.h::UnlockConsoleHandleTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UnlockConsoleHandleTable          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;RtlLeaveCriticalSection(&amp;<a class="el" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a6">ConsoleHandleLock</a>)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00259">259</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02529">WriteConsoleWaitRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="consrv.h::ValidateConsoleHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ValidateConsoleHeap          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keywordflow">if</span> (NtCurrentPeb()-&gt;BeingDebugged) {    \
        <a class="code" href="../../d5/d9/heapdll_8c.html#a32">RtlValidateHeap</a>(Win32HeapGetHandle(pConHeap), 0, NULL); \
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00171">171</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="consrv.h::W32PF_ALLOWSETFOREGROUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define W32PF_ALLOWSETFOREGROUND&nbsp;&nbsp;&nbsp;0x00080000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l02268">2268</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d5/focusact_8c-source.html#l01056">CanForceForeground()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00222">CheckAllowForeground()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04213">SetProcessForegroundRights()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="consrv.h::W32PF_CONSOLEHASFOCUS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define W32PF_CONSOLEHASFOCUS&nbsp;&nbsp;&nbsp;0x04000000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l02269">2269</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/winable2_8c-source.html#l00036">_GetGUIThreadInfo()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04213">SetProcessForegroundRights()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="consrv.h::WAIT_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WAIT_TAG&nbsp;&nbsp;&nbsp;9          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00071">71</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00248">WaitForMoreToRead()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a61" doxytag="consrv.h::FACENODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d4/structtagFACENODE.html">tagFACENODE</a>  <a class="el" href="../../d9/d4/structtagFACENODE.html">FACENODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="consrv.h::PFACENODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d4/structtagFACENODE.html">tagFACENODE</a> * <a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a106" doxytag="consrv.h::AbortCreateConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID AbortCreateConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04423">4423</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, <a class="el" href="../../d6/d6/foncache_8h.html#a24">DestroyFontCache()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00591">FreeAliasBuffers()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04640">FreeCommandHistoryBuffers()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00221">FreeInputBuffer()</a>, <a class="el" href="../../d9/d7/eudc_8h.html#a6">FreeLocalEUDC()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00034">INITIALIZATION_FAILED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00033">INITIALIZATION_SUCCEEDED</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01110">FreeCon()</a>.
<p>
<pre class="fragment"><div>04426 {
04427     <span class="comment">//</span>
04428     <span class="comment">// Signal any process waiting for us that initialization failed</span>
04429     <span class="comment">//</span>
04430 
04431     <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(Console-&gt;InitEvents[INITIALIZATION_FAILED],NULL);
04432 
04433     <span class="comment">//</span>
04434     <span class="comment">// Now clean up the console structure</span>
04435     <span class="comment">//</span>
04436 
04437     CloseHandle(Console-&gt;ClientThreadHandle);
04438     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a18">FreeInputBuffer</a>(&amp;Console-&gt;InputBuffer);
04439     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;Title);
04440     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;OriginalTitle);
04441     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;InitEvents[INITIALIZATION_SUCCEEDED]);
04442     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;InitEvents[INITIALIZATION_FAILED]);
04443     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;TerminationEvent);
04444     <a class="code" href="../../d8/d5/consrv_8h.html#a258">FreeAliasBuffers</a>(Console);
04445     <a class="code" href="../../d8/d5/consrv_8h.html#a260">FreeCommandHistoryBuffers</a>(Console);
04446 <span class="preprocessor">#if defined(FE_SB)</span>
04447 <span class="preprocessor"></span>    <a class="code" href="../../d9/d7/eudc_8h.html#a6">FreeLocalEUDC</a>(Console);
04448     <a class="code" href="../../d6/d6/foncache_8h.html#a24">DestroyFontCache</a>(Console-&gt;FontCacheInformation);
04449 <span class="preprocessor">#endif</span>
04450 <span class="preprocessor"></span>    <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a20">DestroyConsole</a>(Console);
04451 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a252" doxytag="consrv.h::AddCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS AddCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Command</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>HistoryNoDup</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">4744</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a25">COMMAND</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00146">COMMAND_IND_INC</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00122">COMMAND_IND_PREV</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04078">FindMatchingCommand()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00306">FMCFL_EXACT_MATCH</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">HISTORY_TAG</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04026">RemoveCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04726">ResetCommandHistory()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>.
<p>
<pre class="fragment"><div>04750 {
04751     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> *ppCmd;
04752     <span class="comment">//PWCHAR LastChar;</span>
04753 
04754     <span class="comment">// only add if doesn't match current command</span>
04755 
04756     <span class="keywordflow">if</span> (CommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || CommandHistory-&gt;MaximumNumberOfCommands == 0) {
04757         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
04758     }
04759     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CommandHistory-&gt;Flags &amp; CLE_ALLOCATED);
04760 
04761     <span class="comment">//</span>
04762     <span class="comment">// don't remove trailing blanks - prompt "asdf  " won't work.</span>
04763     <span class="comment">//</span>
04764     <span class="comment">//LastChar=Command+(Length/sizeof(WCHAR))-1;</span>
04765     <span class="comment">//while (Length &amp;&amp; *LastChar--==(WCHAR)' ') Length-=2;</span>
04766 
04767     <span class="keywordflow">if</span> (Length == 0) {
04768         <span class="keywordflow">return</span> STATUS_SUCCESS;
04769     }
04770 
04771     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0 ||
04772         CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded]-&gt;CommandLength != Length ||
04773         memcmp(CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded]-&gt;Command,Command,Length)) {
04774 
04775         <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> pCmdReuse = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04776 
04777         <span class="keywordflow">if</span> (HistoryNoDup) {
04778             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04779             i = <a class="code" href="../../d4/d1/cmdline_8h.html#a56">FindMatchingCommand</a>(CommandHistory, Command, Length,
04780                     CommandHistory-&gt;LastDisplayed, FMCFL_EXACT_MATCH);
04781             <span class="keywordflow">if</span> (i != -1) {
04782                 pCmdReuse = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a68">RemoveCommand</a>(CommandHistory, i);
04783             }
04784         }
04785 
04786 
04787         <span class="comment">//</span>
04788         <span class="comment">// find free record.  if all records are used, free the lru one.</span>
04789         <span class="comment">//</span>
04790 
04791         <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands &lt; CommandHistory-&gt;MaximumNumberOfCommands) {
04792             CommandHistory-&gt;LastAdded += 1;
04793             CommandHistory-&gt;NumberOfCommands++;
04794         }
04795         <span class="keywordflow">else</span> {
04796             <a class="code" href="../../d4/d1/cmdline_8h.html#a13">COMMAND_IND_INC</a>(CommandHistory-&gt;LastAdded, CommandHistory);
04797             <a class="code" href="../../d4/d1/cmdline_8h.html#a13">COMMAND_IND_INC</a>(CommandHistory-&gt;FirstCommand, CommandHistory);
04798             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded]);
04799             <span class="keywordflow">if</span> (CommandHistory-&gt;LastDisplayed == CommandHistory-&gt;LastAdded) {
04800                 CommandHistory-&gt;LastDisplayed = -1;
04801             }
04802         }
04803 
04804         <span class="keywordflow">if</span> (CommandHistory-&gt;LastDisplayed == -1 ||
04805             CommandHistory-&gt;Commands[CommandHistory-&gt;LastDisplayed]-&gt;CommandLength != Length ||
04806                 memcmp(CommandHistory-&gt;Commands[CommandHistory-&gt;LastDisplayed]-&gt;Command,Command,Length)) {
04807             <a class="code" href="../../d8/d5/consrv_8h.html#a255">ResetCommandHistory</a>(CommandHistory);
04808         }
04809 
04810         <span class="comment">//</span>
04811         <span class="comment">// add command to array</span>
04812         <span class="comment">//</span>
04813 
04814         ppCmd = &amp;CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded];
04815         <span class="keywordflow">if</span> (pCmdReuse) {
04816             *ppCmd = pCmdReuse;
04817         } <span class="keywordflow">else</span> {
04818             *ppCmd = (<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>( <a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>(HISTORY_TAG),
04819                     Length - <span class="keyword">sizeof</span>(WCHAR) + <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">COMMAND</a>));
04820             <span class="keywordflow">if</span> (*ppCmd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04821                 <a class="code" href="../../d4/d1/cmdline_8h.html#a10">COMMAND_IND_PREV</a>(CommandHistory-&gt;LastAdded, CommandHistory);
04822                 CommandHistory-&gt;NumberOfCommands -= 1;
04823                 <span class="keywordflow">return</span> STATUS_NO_MEMORY;
04824             }
04825             (*ppCmd)-&gt;CommandLength = Length;
04826             RtlCopyMemory((*ppCmd)-&gt;Command,Command,Length);
04827         }
04828     }
04829     CommandHistory-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>; <span class="comment">// remember that we've returned a cmd</span>
04830     <span class="keywordflow">return</span> STATUS_SUCCESS;
04831 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a254" doxytag="consrv.h::AllocateCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> AllocateCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AppNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>AppName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">1683</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00154">CLE_NO_POPUPS</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d4/ioep_8h-source.html#l00067">DBGPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">HISTORY_TAG</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00390">my_wcsncmpi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>.
<p>
<pre class="fragment"><div>01692                    :
01693 
01694     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LRU command history buffer, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command history
01695     buffer that corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> app name.
01696 
01697 Arguments:
01698 
01699     Console - pointer to console.
01700 
01701 Return Value:
01702 
01703     Pointer to command history buffer.  <span class="keywordflow">if</span> none are available, returns <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
01704 
01705 --*/
01706 
01707 {
01708     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>,BestCandidate;
01709     PLIST_ENTRY ListHead, ListNext;
01710     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> SameApp;
01711 
01712     <span class="comment">//</span>
01713     <span class="comment">// Reuse a history buffer.  The buffer must be !CLE_ALLOCATED.</span>
01714     <span class="comment">// If possible, the buffer should have the same app name.</span>
01715     <span class="comment">//</span>
01716 
01717     ListHead = &amp;Console-&gt;CommandHistoryList;
01718     ListNext = ListHead-&gt;Blink;
01719     BestCandidate = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01720     SameApp = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01721     <span class="keywordflow">while</span> (ListNext != ListHead) {
01722         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
01723         ListNext = ListNext-&gt;Blink;
01724 
01725         <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>) == 0) {
01726 
01727             <span class="comment">//</span>
01728             <span class="comment">// use LRU history buffer with same app name</span>
01729             <span class="comment">//</span>
01730 
01731             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName &amp;&amp; !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a9">my_wcsncmpi</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppName,(USHORT)AppNameLength)) {
01732                 BestCandidate = <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01733                 SameApp = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01734                 <span class="keywordflow">break</span>;
01735             }
01736 
01737             <span class="comment">//</span>
01738             <span class="comment">// second best choice is LRU history buffer</span>
01739             <span class="comment">//</span>
01740 
01741             <span class="keywordflow">if</span> (BestCandidate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01742                 BestCandidate = <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01743             }
01744         }
01745     }
01746 
01747     <span class="comment">//</span>
01748     <span class="comment">// if there isn't a free buffer for the app name and the maximum number of</span>
01749     <span class="comment">// command history buffers hasn't been allocated, allocate a new one.</span>
01750     <span class="comment">//</span>
01751 
01752     <span class="keywordflow">if</span> (!SameApp &amp;&amp; Console-&gt;NumCommandHistories &lt; Console-&gt;MaxCommandHistories) {
01753         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = (<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>) + ((Console-&gt;CommandHistorySize-1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>)));
01754         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01755             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01756         }
01757         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),AppNameLength);
01758         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01759             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(History);
01760             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01761         }
01762         RtlCopyMemory(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppName,AppNameLength);
01763         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags = <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
01764         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands = 0;
01765         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastAdded = -1;
01766         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastDisplayed = -1;
01767         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;FirstCommand = 0;
01768         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;MaximumNumberOfCommands = Console-&gt;CommandHistorySize;
01769         InsertHeadList(&amp;Console-&gt;CommandHistoryList,&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ListLink);
01770         Console-&gt;NumCommandHistories+=1;
01771         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle = ProcessHandle;
01772         InitializeListHead(&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;PopupList);
01773         <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01774     }
01775 
01776     <span class="comment">//</span>
01777     <span class="comment">// if the app name doesn't match, copy in the new app name and free the old commands.</span>
01778     <span class="comment">//</span>
01779 
01780     <span class="keywordflow">if</span> (BestCandidate) {
01781         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = BestCandidate;
01782         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(History));
01783         <span class="keywordflow">if</span> (!SameApp) {
01784             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
01785             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName) {
01786                 <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"Reusing %ls command history\n"</span>, <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName));
01787                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName);
01788             }
01789             <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands;i++) {
01790                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Commands[i]);
01791             }
01792             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands = 0;
01793             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastAdded = -1;
01794             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastDisplayed = -1;
01795             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;FirstCommand = 0;
01796             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),AppNameLength);
01797             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01798                 <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
01799                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01800             }
01801             RtlCopyMemory(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppName,AppNameLength);
01802         }
01803         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle = ProcessHandle;
01804         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
01805 
01806         <span class="comment">//</span>
01807         <span class="comment">// move to the front of the list</span>
01808         <span class="comment">//</span>
01809 
01810         RemoveEntryList(&amp;BestCandidate-&gt;ListLink);
01811         InsertHeadList(&amp;Console-&gt;CommandHistoryList,&amp;BestCandidate-&gt;ListLink);
01812     }
01813     <span class="keywordflow">return</span> BestCandidate;
01814 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="consrv.h::AllocateConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS AllocateConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Title</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TitleLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientProcessHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>StdIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>StdOut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>StdErr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WindowVisible</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleThreadId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">789</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00354">CM_CREATE_CONSOLE_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00378">CONSOLE_CLIENTTHREADHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00068">CONSOLE_TAG</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00051">ConsoleOutputCP</a>, <a class="el" href="../../d9/d7/eudc_8h.html#a3">CreateEUDC()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00103">CreateInputBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00270">DoCreateScreenBuffer()</a>, <a class="el" href="../../d1/d4/ntcon_2conime_2conime_8c-source.html#l00040">dwConsoleThreadId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00221">FreeInputBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00049">HorizontalClientToWindow</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00041">IndexFromHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00034">INITIALIZATION_FAILED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00033">INITIALIZATION_SUCCEEDED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04700">InitializeConsoleCommandData()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00874">MapHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00481">PostThreadMessage()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01474">RtlDeleteCriticalSection()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01210">RtlInitializeCriticalSection()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00066">TITLE_TAG</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">TranslateConsoleTitle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a77">UnProtectHandle()</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00048">VerticalClientToWindow</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>.
<p>
<pre class="fragment"><div>00805                    :
00806 
00807     This routine allocates and initialized a console and its associated
00808     data - input buffer and screen buffer.
00809 
00810 Arguments:
00811 
00812     ConsoleHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of console to allocate.
00813 
00814     dwWindowSize - Initial size of screen buffer window, in rows and columns.
00815 
00816     nFont - Initial number of font <a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> displayed in.
00817 
00818     dwScreenBufferSize - Initial size of screen buffer, in rows and columns.
00819 
00820     nInputBufferSize - Initial size of input buffer, in events.
00821 
00822     dwWindowFlags -
00823 
00824     StdIn - On <span class="keywordflow">return</span>, contains handle to stdin.
00825 
00826     StdOut - On <span class="keywordflow">return</span>, contains handle to stdout.
00827 
00828     StdErr - On <span class="keywordflow">return</span>, contains handle to stderr.
00829 
00830     ProcessData - On <span class="keywordflow">return</span>, contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initialized per-process data.
00831 
00832 Return Value:
00833 
00834 Note:
00835 
00836     The console handle table lock must be held when calling <span class="keyword">this</span> routine.
00837 
00838 --*/
00839 
00840 {
00841     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00842     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00843     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
00844 
00845     <span class="comment">//</span>
00846     <span class="comment">// allocate console data</span>
00847     <span class="comment">//</span>
00848 
00849     Console = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>( <a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( CONSOLE_TAG ) | HEAP_ZERO_MEMORY,
00850                                               <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">CONSOLE_INFORMATION</a>));
00851     <span class="keywordflow">if</span> (Console == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00852         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00853     }
00854     <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a1">IndexFromHandle</a>(ConsoleHandle)] = Console;
00855 
00856     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> = WindowVisible ? 0 : <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>;
00857     Console-&gt;hIcon = ConsoleInfo-&gt;hIcon;
00858     Console-&gt;hSmIcon = ConsoleInfo-&gt;hSmIcon;
00859     Console-&gt;iIconId = ConsoleInfo-&gt;iIconId;
00860     Console-&gt;dwHotKey = ConsoleInfo-&gt;dwHotKey;
00861 <span class="preprocessor">#if !defined(FE_SB)</span>
00862 <span class="preprocessor"></span>    Console-&gt;CP = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>;
00863     Console-&gt;OutputCP = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a22">ConsoleOutputCP</a>;
00864 <span class="preprocessor">#endif</span>
00865 <span class="preprocessor"></span>    Console-&gt;ReserveKeys = CONSOLE_NOSHORTCUTKEY;
00866     Console-&gt;ConsoleHandle = ConsoleHandle;
00867     Console-&gt;bIconInit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00868     Console-&gt;VerticalClientToWindow = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a>;
00869     Console-&gt;HorizontalClientToWindow = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a20">HorizontalClientToWindow</a>;
00870 <span class="preprocessor">#if defined(FE_SB)</span>
00871 <span class="preprocessor"></span>    SetConsoleCPInfo(Console,TRUE);
00872     SetConsoleCPInfo(Console,FALSE);
00873 <span class="preprocessor">#endif</span>
00874 <span class="preprocessor"></span>
00875     <span class="comment">//</span>
00876     <span class="comment">// must wait for window to be destroyed or client impersonation won't</span>
00877     <span class="comment">// work.</span>
00878     <span class="comment">//</span>
00879 
00880     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(NtCurrentProcess(),
00881                               <a class="code" href="../../d1/d7/server_8h.html#a78">CONSOLE_CLIENTTHREADHANDLE</a>(CSR_SERVER_QUERYCLIENTTHREAD()),
00882                               NtCurrentProcess(),
00883                               &amp;Console-&gt;ClientThreadHandle,
00884                               0,
00885                               FALSE,
00886                               DUPLICATE_SAME_ACCESS
00887                              );
00888     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00889         <span class="keywordflow">goto</span> ErrorExit5;
00890     }
00891 
00892 <span class="preprocessor">#if DBG</span>
00893 <span class="preprocessor"></span>    <span class="comment">//</span>
00894     <span class="comment">// Make sure the handle isn't protected so we can close it later</span>
00895     <span class="comment">//</span>
00896     <a class="code" href="../../d8/d5/consrv_8h.html#a77">UnProtectHandle</a>(Console-&gt;ClientThreadHandle);
00897 <span class="preprocessor">#endif // DBG</span>
00898 <span class="preprocessor"></span>
00899     InitializeListHead(&amp;Console-&gt;OutputQueue);
00900     InitializeListHead(&amp;Console-&gt;ProcessHandleList);
00901     InitializeListHead(&amp;Console-&gt;ExeAliasList);
00902     InitializeListHead(&amp;Console-&gt;MessageQueue);
00903 
00904     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;Console-&gt;InitEvents[INITIALIZATION_SUCCEEDED],
00905                            EVENT_ALL_ACCESS, NULL, NotificationEvent, FALSE);
00906     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00907         <span class="keywordflow">goto</span> ErrorExit4a;
00908     }
00909     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;Console-&gt;InitEvents[INITIALIZATION_FAILED],
00910                            EVENT_ALL_ACCESS, NULL, NotificationEvent, FALSE);
00911     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00912         <span class="keywordflow">goto</span> ErrorExit4;
00913     }
00914     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;Console-&gt;ConsoleLock);
00915     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00916         <span class="keywordflow">goto</span> ErrorExit3a;
00917     }
00918     <a class="code" href="../../d8/d5/consrv_8h.html#a239">InitializeConsoleCommandData</a>(Console);
00919 
00920     <span class="comment">//</span>
00921     <span class="comment">// initialize input buffer</span>
00922     <span class="comment">//</span>
00923 
00924 <span class="preprocessor">#if defined(FE_SB)</span>
00925 <span class="preprocessor"></span>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a16">CreateInputBuffer</a>(ConsoleInfo-&gt;nInputBufferSize,
00926                                &amp;Console-&gt;InputBuffer,
00927                                Console);
00928 <span class="preprocessor">#else</span>
00929 <span class="preprocessor"></span>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a16">CreateInputBuffer</a>(ConsoleInfo-&gt;nInputBufferSize,
00930                                &amp;Console-&gt;InputBuffer);
00931 <span class="preprocessor">#endif</span>
00932 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00933         <span class="keywordflow">goto</span> ErrorExit3;
00934     }
00935 
00936     Console-&gt;Title = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TITLE_TAG ),TitleLength+<span class="keyword">sizeof</span>(WCHAR));
00937     <span class="keywordflow">if</span> (Console-&gt;Title == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00938         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00939         <span class="keywordflow">goto</span> ErrorExit2;
00940     }
00941     RtlCopyMemory(Console-&gt;Title,Title,TitleLength);
00942     Console-&gt;Title[TitleLength/<span class="keyword">sizeof</span>(WCHAR)] = (WCHAR)0;   <span class="comment">// NULL terminate</span>
00943     Console-&gt;TitleLength = TitleLength;
00944 
00945     Console-&gt;OriginalTitle = <a class="code" href="../../d0/d5/srvinit_8c.html#a42">TranslateConsoleTitle</a>(Console-&gt;Title, &amp;Console-&gt;OriginalTitleLength, TRUE, FALSE);
00946     <span class="keywordflow">if</span> (Console-&gt;OriginalTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00947         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00948         <span class="keywordflow">goto</span> ErrorExit1;
00949     }
00950 
00951     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;Console-&gt;TerminationEvent,
00952                            EVENT_ALL_ACCESS, NULL, NotificationEvent, FALSE);
00953     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00954         <span class="keywordflow">goto</span> ErrorExit1a;
00955     }
00956 
00957     <span class="comment">//</span>
00958     <span class="comment">// initialize screen buffer. we don't call OpenConsole to do this</span>
00959     <span class="comment">// because we need to specify the font, windowsize, etc.</span>
00960     <span class="comment">//</span>
00961 
00962     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a41">DoCreateScreenBuffer</a>(Console,
00963                                   ConsoleInfo);
00964     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)){
00965         <span class="keywordflow">goto</span> ErrorExit1b;
00966     }
00967 
00968 
00969     Console-&gt;CurrentScreenBuffer = Console-&gt;ScreenBuffers;
00970 <span class="preprocessor">#if defined(FE_SB)</span>
00971 <span class="preprocessor"></span><span class="preprocessor">#if defined(FE_IME)</span>
00972 <span class="preprocessor"></span>    SetUndetermineAttribute(Console) ;
00973 <span class="preprocessor">#endif</span>
00974 <span class="preprocessor"></span>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d7/eudc_8h.html#a3">CreateEUDC</a>(Console);
00975     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)){
00976         <span class="keywordflow">goto</span> ErrorExit1c;
00977     }
00978 <span class="preprocessor">#endif</span>
00979 <span class="preprocessor"></span>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a16">InitializeIoHandleTable</a>(Console,
00980                                      ProcessData,
00981                                      StdIn,
00982                                      StdOut,
00983                                      StdErr
00984                                     );
00985     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00986         <span class="keywordflow">goto</span> ErrorExit0;
00987     }
00988 
00989     <span class="comment">//</span>
00990     <span class="comment">// map event handles</span>
00991     <span class="comment">//</span>
00992 
00993     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d5/srvinit_8c.html#a32">MapHandle</a>(ClientProcessHandle,
00994                    Console-&gt;InitEvents[INITIALIZATION_SUCCEEDED],
00995                    &amp;ConsoleInfo-&gt;InitEvents[INITIALIZATION_SUCCEEDED]
00996                   )) {
00997         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00998         <span class="keywordflow">goto</span> ErrorExit0;
00999     }
01000     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d5/srvinit_8c.html#a32">MapHandle</a>(ClientProcessHandle,
01001                    Console-&gt;InitEvents[INITIALIZATION_FAILED],
01002                    &amp;ConsoleInfo-&gt;InitEvents[INITIALIZATION_FAILED]
01003                   )) {
01004         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
01005         <span class="keywordflow">goto</span> ErrorExit0;
01006     }
01007     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d5/srvinit_8c.html#a32">MapHandle</a>(ClientProcessHandle,
01008                    Console-&gt;InputBuffer.InputWaitEvent,
01009                    &amp;ConsoleInfo-&gt;InputWaitHandle
01010                   )) {
01011         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
01012         <span class="keywordflow">goto</span> ErrorExit0;
01013     }
01014 
01015     Success = <a class="code" href="../../d0/d8/ntcftxt_8h.html#a21">PostThreadMessage</a>(dwConsoleThreadId,
01016                                 CM_CREATE_CONSOLE_WINDOW,
01017                                 (WPARAM)ConsoleHandle,
01018                                 (LPARAM)ClientProcessHandle
01019                                );
01020     <span class="keywordflow">if</span> (!Success) {
01021         KdPrint((<span class="stringliteral">"CONSRV: PostThreadMessage failed %d\n"</span>,GetLastError()));
01022         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
01023         <span class="keywordflow">goto</span> ErrorExit0;
01024     }
01025 
01026     <span class="keywordflow">return</span> STATUS_SUCCESS;
01027 
01028 ErrorExit0: Console-&gt;ScreenBuffers-&gt;RefCount = 0;
01029 <span class="preprocessor">#if defined(FE_SB)</span>
01030 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (Console-&gt;EudcInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01031                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;EudcInformation);
01032             }
01033 ErrorExit1c:
01034 <span class="preprocessor">#endif</span>
01035 <span class="preprocessor"></span>            <a class="code" href="../../d6/d2/output_8c.html#a46">FreeScreenBuffer</a>(Console-&gt;ScreenBuffers);
01036 ErrorExit1b: <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;TerminationEvent);
01037 ErrorExit1a: <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;OriginalTitle);
01038 ErrorExit1: <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;Title);
01039 ErrorExit2: Console-&gt;InputBuffer.RefCount = 0;
01040             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a18">FreeInputBuffer</a>(&amp;Console-&gt;InputBuffer);
01041 ErrorExit3: <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;Console-&gt;ConsoleLock);
01042 
01043 ErrorExit3a: <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;InitEvents[INITIALIZATION_FAILED]);
01044 ErrorExit4: <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;InitEvents[INITIALIZATION_SUCCEEDED]);
01045 ErrorExit4a: <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;ClientThreadHandle);
01046 ErrorExit5:  <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console);
01047     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01048 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="consrv.h::AllocateConsoleHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS AllocateConsoleHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00269">269</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00337">CONSOLE_HANDLE_ALLOCATED</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00042">ConsoleHandleTableLocked</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00223">GrowConsoleHandleTable()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00040">HandleFromIndex</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00030">NumberOfConsoleHandles</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>.
<p>
<pre class="fragment"><div>00275                    :
00276 
00277     This routine allocates a console handle from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global table.
00278 
00279 Arguments:
00280 
00281     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Pointer to store handle in.
00282 
00283 Return Value:
00284 
00285 Note:
00286 
00287     The console handle table lock must be held when calling <span class="keyword">this</span> routine.
00288 
00289 --*/
00290 
00291 {
00292     ULONG i;
00293     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00294 
00295     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a2">ConsoleHandleTableLocked</a>());
00296 
00297     <span class="comment">//</span>
00298     <span class="comment">// have to start allocation at 1 because 0 indicates no console handle</span>
00299     <span class="comment">// in ConDllInitialize.</span>
00300     <span class="comment">//</span>
00301 
00302     <span class="keywordflow">for</span> (i=1;i&lt;<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>;i++) {
00303         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00304             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>) <a class="code" href="../../d1/d7/server_8h.html#a56">CONSOLE_HANDLE_ALLOCATED</a>;
00305             *<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a0">HandleFromIndex</a>(i);
00306             <span class="keywordflow">return</span> STATUS_SUCCESS;
00307         }
00308     }
00309 
00310     <span class="comment">//</span>
00311     <span class="comment">// grow console handle table</span>
00312     <span class="comment">//</span>
00313 
00314     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a12">GrowConsoleHandleTable</a>();
00315     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
00316         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00317     <span class="keywordflow">for</span> ( ;i&lt;<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>;i++) {
00318         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00319             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>) <a class="code" href="../../d1/d7/server_8h.html#a56">CONSOLE_HANDLE_ALLOCATED</a>;
00320             *<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a0">HandleFromIndex</a>(i);
00321             <span class="keywordflow">return</span> STATUS_SUCCESS;
00322         }
00323     }
00324     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (FALSE);
00325     <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00326 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="consrv.h::AllocateIoHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS AllocateIoHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01390">1390</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01234">GrowIoHandleTable()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>.
<p>
<pre class="fragment"><div>01398                    :
01399 
01400     This routine allocates an input or output handle from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process's
01401     handle table.
01402 
01403     This routine initializes all non-<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> specific fields in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle
01404     data structure.
01405 
01406 Arguments:
01407 
01408     ProcessData - Pointer to per process data structure.
01409 
01410     HandleType - Flag indicating input or output handle.
01411 
01412     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - On <span class="keywordflow">return</span>, contains allocated handle.  <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an index
01413     internally.  When returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> API caller, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> translated into
01414     a handle.
01415 
01416 Return Value:
01417 
01418 Note:
01419 
01420     The console lock must be held when calling <span class="keyword">this</span> routine.  The handle
01421     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-process handle table.  Holding <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console
01422     lock serializes both threads within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling process and any other
01423     process that shares <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console.
01424 
01425 --*/
01426 
01427 {
01428     ULONG i;
01429     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01430 
01431     <span class="keywordflow">for</span> (i=0;i&lt;ProcessData-&gt;HandleTableSize;i++) {
01432         <span class="keywordflow">if</span> (ProcessData-&gt;HandleTablePtr[i].HandleType == <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>) {
01433             ProcessData-&gt;HandleTablePtr[i].HandleType = HandleType;
01434             *<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = (HANDLE) i;
01435 
01436             <span class="keywordflow">return</span> STATUS_SUCCESS;
01437         }
01438     }
01439     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a24">GrowIoHandleTable</a>(ProcessData);
01440     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
01441         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01442     <span class="keywordflow">for</span> ( ;i&lt;ProcessData-&gt;HandleTableSize;i++) {
01443         <span class="keywordflow">if</span> (ProcessData-&gt;HandleTablePtr[i].HandleType == <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>) {
01444             ProcessData-&gt;HandleTablePtr[i].HandleType = HandleType;
01445             *<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = (HANDLE) i;
01446             <span class="keywordflow">return</span> STATUS_SUCCESS;
01447         }
01448     }
01449     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (FALSE);
01450     <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01451 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="consrv.h::ApiPreamble" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ApiPreamble           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">1627</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00383">CONSOLE_CLIENTPROCESSID</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00403">CONSOLE_GETCONSOLEHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00097">CONSOLE_TERMINATING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00221">_CONSOLE_INFORMATION::ConsoleHandle</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00040">ConsoleVDMCriticalSection</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00041">ConsoleVDMOnSwitching</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00196">_CONSOLE_INFORMATION::VDMProcessId</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02997">SrvCloseHandle()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00373">SrvConsoleMenuControl()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01346">SrvConsoleNotifyLastClose()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01393">SrvExpungeConsoleCommandHistory()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01568">SrvFillConsoleOutput()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00524">SrvFlushConsoleInputBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00444">SrvGenerateConsoleCtrlEvent()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">SrvGetConsoleAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00834">SrvGetConsoleAliasesLength()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">SrvGetConsoleAliasExes()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00994">SrvGetConsoleAliasExesLength()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">SrvGetConsoleCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01458">SrvGetConsoleCommandHistoryLength()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01359">SrvGetConsoleCP()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00315">SrvGetConsoleCurrentFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00179">SrvGetConsoleCursorInfo()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02355">SrvGetConsoleDisplayMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00233">SrvGetConsoleFontInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00278">SrvGetConsoleFontSize()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02232">SrvGetConsoleHardwareState()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">SrvGetConsoleInput()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01385">SrvGetConsoleKeyboardLayoutName()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02680">SrvGetConsoleLangId()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00033">SrvGetConsoleMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00211">SrvGetConsoleMouseInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00082">SrvGetConsoleNumberOfFonts()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00108">SrvGetConsoleNumberOfInputEvents()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00141">SrvGetConsoleScreenBufferInfo()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04879">SrvGetConsoleTitle()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01424">SrvGetConsoleWindow()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02747">SrvGetHandleInformation()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00555">SrvGetLargestConsoleWindowSize()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00168">SrvInvalidateBitMapRect()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02263">SrvReadConsole()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">SrvReadConsoleOutput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01448">SrvReadConsoleOutputString()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01094">SrvRegisterConsoleVDM()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00492">SrvSetConsoleActiveScreenBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01575">SrvSetConsoleCommandHistoryMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01229">SrvSetConsoleCP()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00213">SrvSetConsoleCursor()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00738">SrvSetConsoleCursorInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00662">SrvSetConsoleCursorPosition()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00853">SrvSetConsoleDisplayMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01118">SrvSetConsoleFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02280">SrvSetConsoleHardwareState()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01164">SrvSetConsoleIcon()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02423">SrvSetConsoleKeyShortcuts()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02376">SrvSetConsoleMenuClose()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00354">SrvSetConsoleMode()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01424">SrvSetConsoleNumberOfCommands()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00432">SrvSetConsolePalette()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00608">SrvSetConsoleScreenBufferSize()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01078">SrvSetConsoleTextAttribute()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">SrvSetConsoleWindowInfo()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02794">SrvSetHandleInformation()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00298">SrvShowConsoleCursor()</a>, <a class="el" href="../../d3/d4/srvvdm_8c-source.html#l00024">SrvVDMConsoleOperation()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01582">SrvVerifyConsoleIoHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02463">SrvWriteConsole()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00730">SrvWriteConsoleInput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01508">SrvWriteConsoleOutputString()</a>.
<p>
<pre class="fragment"><div>01631 {
01632     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01633 
01634     <span class="comment">//</span>
01635     <span class="comment">// If this process doesn't have a console handle, bail immediately.</span>
01636     <span class="comment">//</span>
01637 
01638     <span class="keywordflow">if</span> (ConsoleHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || ConsoleHandle != <a class="code" href="../../d1/d7/server_8h.html#a89">CONSOLE_GETCONSOLEHANDLE</a>()) {
01639         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
01640     }
01641 
01642 <span class="preprocessor">#ifdef i386</span>
01643 <span class="preprocessor"></span>    <span class="comment">//Do not lock the console if we are in the special case:</span>
01644     <span class="comment">//(1). we are in the middle of handshaking with ntvdm doing</span>
01645     <span class="comment">//     full-screen to windowed mode transition</span>
01646     <span class="comment">//(2). the calling process is THE ntvdm process(this implies that the</span>
01647     <span class="comment">//     the console has vdm registered.</span>
01648     <span class="comment">//(3). the console handle is the same one.</span>
01649     <span class="comment">// if (1), (2) and (3) are true then the console is already locked</span>
01650     <span class="comment">// (locked by the windowproc while processing the WM_FULLSCREEN</span>
01651     <span class="comment">// message)</span>
01652 
01653     RtlEnterCriticalSection(&amp;ConsoleVDMCriticalSection);
01654     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a14">ConsoleVDMOnSwitching</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01655         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a14">ConsoleVDMOnSwitching</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a> == ConsoleHandle &amp;&amp;
01656         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a14">ConsoleVDMOnSwitching</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a> == <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>())
01657     {
01658         KdPrint((<span class="stringliteral">"    ApiPreamble - Thread %lx Entered VDM CritSec\n"</span>, GetCurrentThreadId()));
01659         *Console = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a14">ConsoleVDMOnSwitching</a>;
01660         <span class="keywordflow">return</span> STATUS_SUCCESS;
01661     }
01662     RtlLeaveCriticalSection(&amp;ConsoleVDMCriticalSection);
01663 <span class="preprocessor">#endif</span>
01664 <span class="preprocessor"></span>
01665     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(ConsoleHandle,
01666                                Console
01667                               );
01668     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01669         <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01670     }
01671 
01672     <span class="comment">//</span>
01673     <span class="comment">// Make sure the console has been initialized and the window is valid</span>
01674     <span class="comment">//</span>
01675 
01676     <span class="keywordflow">if</span> ((*Console)-&gt;hWnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || ((*Console)-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a12">CONSOLE_TERMINATING</a>)) {
01677         KdPrint((<span class="stringliteral">"CONSRV: bogus window for console %lx\n"</span>, *Console));
01678         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(*Console);
01679         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
01680     }
01681 
01682     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01683 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a293" doxytag="consrv.h::ChangeDispSettings" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ChangeDispSettings           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02272">HandleSysKeyEvent()</a>, and <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a174" doxytag="consrv.h::CharToWchar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR CharToWchar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN char&nbsp;</td>
          <td class="mdname" nowrap> <em>Ch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01469">1469</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, and <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00576">RtlOemToUnicodeN()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00976">SB_TranslateOutputToUnicode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l00165">TranslateInputToUnicode()</a>.
<p>
<pre class="fragment"><div>01473 {
01474     WCHAR wch;
01475     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01476         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a34">RtlOemToUnicodeN</a>(&amp;wch, <span class="keyword">sizeof</span>(wch), NULL, &amp;Ch, <span class="keyword">sizeof</span>(Ch));
01477     } <span class="keywordflow">else</span> {
01478         MultiByteToWideChar(Codepage, 0, &amp;Ch, 1, &amp;wch, 1);
01479     }
01480 <span class="preprocessor">#ifdef DEBUG_PRINT</span>
01481 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Ch &gt; 0x7F) {
01482         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"CharToWchar %d 0x%02x -&gt; 0x%04x\n"</span>,Codepage,(UCHAR)Ch,wch));
01483     }
01484 <span class="preprocessor">#endif</span>
01485 <span class="preprocessor"></span>    <span class="keywordflow">return</span> wch;
01486 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a173" doxytag="consrv.h::CharToWcharGlyph" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR CharToWcharGlyph           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN char&nbsp;</td>
          <td class="mdname" nowrap> <em>Ch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01443">1443</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, and <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01757">RtlCustomCPToUnicodeN()</a>.
<p>
<pre class="fragment"><div>01447 {
01448     WCHAR wch;
01449     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01450         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a42">RtlCustomCPToUnicodeN</a>(&amp;GlyphCP, &amp;wch, <span class="keyword">sizeof</span>(wch), NULL, &amp;Ch, <span class="keyword">sizeof</span>(Ch));
01451     } <span class="keywordflow">else</span> {
01452         MultiByteToWideChar(Codepage, MB_USEGLYPHCHARS, &amp;Ch, 1, &amp;wch, 1);
01453     }
01454 <span class="preprocessor">#ifdef DEBUG_PRINT</span>
01455 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Ch &gt; 0x7F) {
01456         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"CharToWcharGlyph %d 0x%02x -&gt; 0x%04x\n"</span>,Codepage,(UCHAR)Ch,wch));
01457     }
01458 <span class="preprocessor">#endif</span>
01459 <span class="preprocessor"></span>    <span class="keywordflow">return</span> wch;
01460 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a135" doxytag="consrv.h::ClearKeyInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ClearKeyInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hWnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01634">1634</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00071">CONSOLE_FREE_KEY_INFO</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00072">CONSOLE_MAX_KEY_INFO</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00080">ConsoleKeyInfo</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00075">_CONSOLE_KEY_INFO::hWnd</a>, and <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>.
<p>
<pre class="fragment"><div>01637 {
01638     <span class="keywordtype">int</span> i;
01639 
01640     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a3">CONSOLE_MAX_KEY_INFO</a>;i++) {
01641         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> == <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>) {
01642             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a2">CONSOLE_FREE_KEY_INFO</a>;
01643         }
01644     }
01645 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a312" doxytag="consrv.h::ClearScroll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ClearScroll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01222">1222</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00033">msgScrollMode</a>, and <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>01225 {
01226     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgScrollMode,FALSE);
01227     Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>;
01228 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a306" doxytag="consrv.h::ClearSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ClearSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">437</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">CancelMouseSelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02442">UnblockWriteConsole()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>00440 {
00441     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
00442         <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a>) {
00443             <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a3">CancelMouseSelection</a>(Console);
00444         } <span class="keywordflow">else</span> {
00445             <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a4">CancelKeySelection</a>(Console,FALSE);
00446         }
00447         <a class="code" href="../../d0/d7/server_2stream_8c.html#a30">UnblockWriteConsole</a>(Console, CONSOLE_SELECTING);
00448     }
00449 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a229" doxytag="consrv.h::CloseInputHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CloseInputHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">2844</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00138">ConsoleRemoveShare()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00306">HANDLE_CLOSING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00307">HANDLE_INPUT_PENDING</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00112">LockReadCount</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00184">ReinitializeInputBuffer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d3/input_8h-source.html#l00113">UnlockReadCount</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02997">SrvCloseHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>.
<p>
<pre class="fragment"><div>02853                    :
02854 
02855     This routine closes an input handle.  It decrements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer's
02856     reference count.  If <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> goes to zero, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reinitialized.
02857     Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> removed from sharing.
02858 
02859 Arguments:
02860 
02861     ProcessData - Pointer to per process data.
02862 
02863     HandleData - Pointer to handle data structure.
02864 
02865     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to close.
02866 
02867 Return Value:
02868 
02869 Note:
02870 
02871     The console lock must be held when calling <span class="keyword">this</span> routine.
02872 
02873 --*/
02874 
02875 {
02876     BOOLEAN WaitSatisfied = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02877 
02878     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;Foo == 0xF00);
02879     <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a>) {
02880         HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a>;
02881         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(HandleData-&gt;InputReadData-&gt;BufPtr);
02882     }
02883 
02884     <span class="comment">//</span>
02885     <span class="comment">// see if there are any reads waiting for data via this handle.  if</span>
02886     <span class="comment">// there are, wake them up.  there aren't any other outstanding i/o</span>
02887     <span class="comment">// operations via this handle because the console lock is held.</span>
02888     <span class="comment">//</span>
02889 
02890     <a class="code" href="../../d9/d3/input_8h.html#a25">LockReadCount</a>(HandleData);
02891     <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;ReadCount != 0) {
02892         <a class="code" href="../../d9/d3/input_8h.html#a26">UnlockReadCount</a>(HandleData);
02893         HandleData-&gt;InputReadData-&gt;InputHandleFlags |= <a class="code" href="../../d1/d7/server_8h.html#a51">HANDLE_CLOSING</a>;
02894 
02895         WaitSatisfied |= CsrNotifyWait(&amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadWaitQueue,
02896                       TRUE,
02897                       (PVOID) HandleData,
02898                       NULL
02899                      );
02900         <a class="code" href="../../d9/d3/input_8h.html#a25">LockReadCount</a>(HandleData);
02901     }
02902     <span class="keywordflow">if</span> (WaitSatisfied) {
02903         <span class="comment">// #334370 under stress, WaitQueue may already hold the satisfied waits</span>
02904         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> ((Console-&gt;WaitQueue == NULL) ||
02905                 (Console-&gt;WaitQueue == &amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadWaitQueue));
02906         Console-&gt;WaitQueue = &amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadWaitQueue;
02907     }
02908     <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;ReadCount != 0) {
02909         KdPrint((<span class="stringliteral">"ReadCount is %lX\n"</span>,HandleData-&gt;InputReadData-&gt;ReadCount));
02910     }
02911     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (HandleData-&gt;InputReadData-&gt;ReadCount == 0);
02912     <a class="code" href="../../d9/d3/input_8h.html#a26">UnlockReadCount</a>(HandleData);
02913 
02914     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (HandleData-&gt;Buffer.InputBuffer-&gt;RefCount);
02915     HandleData-&gt;Buffer.InputBuffer-&gt;RefCount--;
02916     <span class="keywordflow">if</span> (HandleData-&gt;Buffer.InputBuffer-&gt;RefCount == 0) {
02917         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a17">ReinitializeInputBuffer</a>(HandleData-&gt;Buffer.InputBuffer);
02918     }
02919     <span class="keywordflow">else</span> {
02920         <a class="code" href="../../d7/d8/share_8c.html#a2">ConsoleRemoveShare</a>(HandleData-&gt;Access,
02921                            HandleData-&gt;ShareAccess,
02922                            &amp;HandleData-&gt;Buffer.InputBuffer-&gt;ShareAccess
02923                           );
02924     }
02925     <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,Handle);
02926 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a230" doxytag="consrv.h::CloseOutputHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CloseOutputHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>FreeHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">2929</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00138">ConsoleRemoveShare()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01187">RemoveScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02997">SrvCloseHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>.
<p>
<pre class="fragment"><div>02939                    :
02940 
02941     This routine closes an output handle.  It decrements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer's
02942     reference count.  If <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> goes to zero, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> freed.  Otherwise,
02943     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> removed from sharing.
02944 
02945 Arguments:
02946 
02947     ProcessData - Pointer to per process data.
02948 
02949     Console - Pointer to console information structure.
02950 
02951     HandleData - Pointer to handle data structure.
02952 
02953     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to close.
02954 
02955     FreeHandle - <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, free handle.  used by <a class="code" href="../../d8/d5/consrv_8h.html#a221">ReadChars</a> in echo mode
02956     and by process cleanup.
02957 
02958 Return Value:
02959 
02960 Note:
02961 
02962     The console lock must be held when calling <span class="keyword">this</span> routine.
02963 
02964 --*/
02965 
02966 {
02967     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02968 
02969     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;Foo == 0xF00);
02970     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (HandleData-&gt;Buffer.ScreenBuffer-&gt;RefCount);
02971     HandleData-&gt;Buffer.ScreenBuffer-&gt;RefCount--;
02972     <span class="keywordflow">if</span> (HandleData-&gt;Buffer.ScreenBuffer-&gt;RefCount == 0) {
02973         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a23">RemoveScreenBuffer</a>(Console,HandleData-&gt;Buffer.ScreenBuffer);
02974         <span class="keywordflow">if</span> (HandleData-&gt;Buffer.ScreenBuffer == Console-&gt;CurrentScreenBuffer &amp;&amp;
02975             Console-&gt;ScreenBuffers != Console-&gt;CurrentScreenBuffer) {
02976             <span class="keywordflow">if</span> (Console-&gt;ScreenBuffers != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02977                 <a class="code" href="../../d6/d2/output_8c.html#a71">SetActiveScreenBuffer</a>(Console-&gt;ScreenBuffers);
02978             } <span class="keywordflow">else</span> {
02979                 Console-&gt;CurrentScreenBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02980             }
02981         }
02982         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a46">FreeScreenBuffer</a>(HandleData-&gt;Buffer.ScreenBuffer);
02983     }
02984     <span class="keywordflow">else</span> {
02985         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a2">ConsoleRemoveShare</a>(HandleData-&gt;Access,
02986                                     HandleData-&gt;ShareAccess,
02987                                     &amp;HandleData-&gt;Buffer.ScreenBuffer-&gt;ShareAccess
02988                                    );
02989     }
02990     <span class="keywordflow">if</span> (FreeHandle)
02991         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,Handle);
02992     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02993 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="consrv.h::ConsoleAddProcessRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ConsoleAddProcessRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCSR_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00705">705</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00895">AddProcessToList()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00389">CONSOLE_FROMPROCESSPERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00292">CONSOLE_INITIAL_IO_HANDLES</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00401">CONSOLE_SETCONSOLEAPPFROMPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00100">CONSOLE_SHUTTING_DOWN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00322">_CONSOLE_PER_PROCESS_DATA::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00050">_CONSOLE_PROCESS_HANDLE::CtrlRoutine</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00325">_CONSOLE_PER_PROCESS_DATA::Foo</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00067">HANDLE_TAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00323">_CONSOLE_PER_PROCESS_DATA::HandleTable</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00326">_CONSOLE_PER_PROCESS_DATA::HandleTablePtr</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00324">_CONSOLE_PER_PROCESS_DATA::HandleTableSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00561">InheritIoHandleTable()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00048">_CONSOLE_PROCESS_HANDLE::Process</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00047">_CONSOLE_PROCESS_HANDLE::ProcessHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00051">_CONSOLE_PROCESS_HANDLE::PropRoutine</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00130">_CONSOLE_INFORMATION::RefCount</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00328">_CONSOLE_PER_PROCESS_DATA::RootProcess</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00737">ConServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00709 {
00710     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData, ParentProcessData;
00711     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00712     <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
00713     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00714     ULONG i;
00715 
00716     ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a82">CONSOLE_FROMPROCESSPERPROCESSDATA</a>(Process);
00717     ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o4">HandleTablePtr</a> = ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o1">HandleTable</a>;
00718     ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o2">HandleTableSize</a> = <a class="code" href="../../d1/d7/server_8h.html#a45">CONSOLE_INITIAL_IO_HANDLES</a>;
00719     <a class="code" href="../../d1/d7/server_8h.html#a88">CONSOLE_SETCONSOLEAPPFROMPROCESSDATA</a>(ProcessData,FALSE);
00720 
00721     <span class="keywordflow">if</span> (ParentProcess) {
00722 
00723         ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o6">RootProcess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00724         ParentProcessData = <a class="code" href="../../d1/d7/server_8h.html#a82">CONSOLE_FROMPROCESSPERPROCESSDATA</a>(ParentProcess);
00725 
00726         <span class="comment">//</span>
00727         <span class="comment">// If both the parent and new processes are console apps,</span>
00728         <span class="comment">// inherit handles from the parent process.</span>
00729         <span class="comment">//</span>
00730 
00731         <span class="keywordflow">if</span> (ParentProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00732                 (Process-&gt;Flags &amp; CSR_PROCESS_CONSOLEAPP)) {
00733             <span class="keywordflow">if</span> (!(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(ParentProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a>,
00734                                                &amp;Console)))) {
00735                 ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00736                 <span class="keywordflow">return</span> STATUS_PROCESS_IS_TERMINATING;
00737             }
00738 
00739             <span class="comment">//</span>
00740             <span class="comment">// Don't add the process if the console is being shutdown.</span>
00741             <span class="comment">//</span>
00742 
00743             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a15">CONSOLE_SHUTTING_DOWN</a>) {
00744                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PROCESS_IS_TERMINATING;
00745             } <span class="keywordflow">else</span> {
00746                 ProcessHandleRecord = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HANDLE_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>));
00747                 <span class="keywordflow">if</span> (ProcessHandleRecord == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00748                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00749                 } <span class="keywordflow">else</span> {
00750 
00751                     <span class="comment">//</span>
00752                     <span class="comment">// duplicate parent's handle table</span>
00753                     <span class="comment">//</span>
00754 
00755                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o3">Foo</a> == 0xF00);
00756                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a17">InheritIoHandleTable</a>(Console, ProcessData, ParentProcessData);
00757                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00758                         ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o2">Process</a> = Process;
00759                         ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o4">CtrlRoutine</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00760                         ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o5">PropRoutine</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00761                         <a class="code" href="../../d0/d5/srvinit_8c.html#a33">AddProcessToList</a>(Console,ProcessHandleRecord,Process-&gt;ProcessHandle);
00762 
00763                         <span class="comment">//</span>
00764                         <span class="comment">// increment console reference count</span>
00765                         <span class="comment">//</span>
00766 
00767                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o1">RefCount</a>++;
00768                     } <span class="keywordflow">else</span> {
00769                         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ProcessHandleRecord);
00770                     }
00771                 }
00772             }
00773             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00774                 ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00775                 <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d7/server_8h.html#a45">CONSOLE_INITIAL_IO_HANDLES</a>;i++) {
00776                     ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o1">HandleTable</a>[i].<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> = <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>;
00777                 }
00778             }
00779             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00780         } <span class="keywordflow">else</span>
00781             ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00782     } <span class="keywordflow">else</span> {
00783         ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00784     }
00785     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00786 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a92" doxytag="consrv.h::ConsoleAddShare" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ConsoleAddShare           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/share_8c-source.html#l00025">25</a> of file <a class="el" href="../../d8/d7/share_8c-source.html">share.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>.
<p>
<pre class="fragment"><div>00032 {
00033     ULONG Ocount;
00034     ULONG ReadAccess;
00035     ULONG WriteAccess;
00036     ULONG SharedRead;
00037     ULONG SharedWrite;
00038 
00039     <span class="comment">//</span>
00040     <span class="comment">// Set the access type in the file object for the current accessor.</span>
00041     <span class="comment">//</span>
00042 
00043     ReadAccess = (DesiredAccess &amp; GENERIC_READ) != 0;
00044     WriteAccess = (DesiredAccess &amp; GENERIC_WRITE) != 0;
00045 
00046     SharedRead = (DesiredShareAccess &amp; FILE_SHARE_READ) != 0;
00047     SharedWrite = (DesiredShareAccess &amp; FILE_SHARE_WRITE) != 0;
00048 
00049     <span class="comment">//</span>
00050     <span class="comment">// Now check to see whether or not the desired accesses are compatible</span>
00051     <span class="comment">// with the way that the file is currently open.</span>
00052     <span class="comment">//</span>
00053 
00054     Ocount = ShareAccess-&gt;OpenCount;
00055 
00056     <span class="keywordflow">if</span> ( (ReadAccess &amp;&amp; (ShareAccess-&gt;SharedRead &lt; Ocount))
00057          ||
00058          (WriteAccess &amp;&amp; (ShareAccess-&gt;SharedWrite &lt; Ocount))
00059          ||
00060          ((ShareAccess-&gt;Readers != 0) &amp;&amp; !SharedRead)
00061          ||
00062          ((ShareAccess-&gt;Writers != 0) &amp;&amp; !SharedWrite)
00063        ) {
00064 
00065         <span class="comment">//</span>
00066         <span class="comment">// The check failed.  Simply return to the caller indicating that the</span>
00067         <span class="comment">// current open cannot access the file.</span>
00068         <span class="comment">//</span>
00069 
00070         <span class="keywordflow">return</span> STATUS_SHARING_VIOLATION;
00071 
00072     } <span class="keywordflow">else</span> {
00073 
00074         <span class="comment">//</span>
00075         <span class="comment">// The check was successful.  Update the counter information in the</span>
00076         <span class="comment">// shared access structure for this open request if the caller</span>
00077         <span class="comment">// specified that it should be updated.</span>
00078         <span class="comment">//</span>
00079 
00080         ShareAccess-&gt;OpenCount++;
00081 
00082         ShareAccess-&gt;Readers += ReadAccess;
00083         ShareAccess-&gt;Writers += WriteAccess;
00084 
00085         ShareAccess-&gt;SharedRead += SharedRead;
00086         ShareAccess-&gt;SharedWrite += SharedWrite;
00087         HandleData-&gt;Access = DesiredAccess;
00088         HandleData-&gt;ShareAccess = DesiredShareAccess;
00089 
00090         <span class="keywordflow">return</span> STATUS_SUCCESS;
00091     }
00092 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a129" doxytag="consrv.h::ConsoleDragQueryFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT ConsoleDragQueryFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDrop</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>lpFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l05750">5750</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l05853">DoDrop()</a>.
<p>
<pre class="fragment"><div>05755 {
05756     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i = 0;
05757     LPDROPFILESTRUCT lpdfs;
05758     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWide;
05759 
05760     lpdfs = (LPDROPFILESTRUCT)GlobalLock(hDrop);
05761 
05762     <span class="keywordflow">if</span> (lpdfs &amp;&amp; lpdfs != hDrop)
05763     {
05764         <span class="keywordflow">try</span> {
05765             fWide = (LOWORD(lpdfs-&gt;pFiles) == <span class="keyword">sizeof</span>(DROPFILES));
05766             <span class="keywordflow">if</span> (fWide)
05767             {
05768                 <span class="comment">//</span>
05769                 <span class="comment">// This is a new (NT-compatible) HDROP</span>
05770                 <span class="comment">//</span>
05771                 fWide = lpdfs-&gt;fWide;       <span class="comment">// Redetermine fWide from struct</span>
05772                                             <span class="comment">// since it is present.</span>
05773             }
05774 
05775             <span class="keywordflow">if</span> (fWide)
05776             {
05777                 LPWSTR lpList;
05778 
05779                 <span class="comment">//</span>
05780                 <span class="comment">// UNICODE HDROP</span>
05781                 <span class="comment">//</span>
05782 
05783                 lpList = (LPWSTR)((LPBYTE)lpdfs + lpdfs-&gt;pFiles);
05784 
05785                 i = lstrlenW(lpList);
05786 
05787                 <span class="keywordflow">if</span> (!i)
05788                     <span class="keywordflow">goto</span> Exit;
05789 
05790                 cb--;
05791                 <span class="keywordflow">if</span> (cb &lt; i)
05792                     i = cb;
05793 
05794                 lstrcpynW((LPWSTR)lpFile, lpList, i + 1);
05795             }
05796             <span class="keywordflow">else</span>
05797             {
05798                 LPSTR lpList;
05799 
05800                 <span class="comment">//</span>
05801                 <span class="comment">// This is Win31-style HDROP or an ANSI NT Style HDROP</span>
05802                 <span class="comment">//</span>
05803                 lpList = (LPSTR)((LPBYTE)lpdfs + lpdfs-&gt;pFiles);
05804 
05805                 i = lstrlenA(lpList);
05806 
05807                 <span class="keywordflow">if</span> (!i)
05808                     <span class="keywordflow">goto</span> Exit;
05809 
05810                 cb--;
05811                 <span class="keywordflow">if</span> (cb &lt; i)
05812                     i = cb;
05813 
05814                 MultiByteToWideChar(CP_ACP, 0, lpList, -1, (LPWSTR)lpFile, cb);
05815 
05816             }
05817         } except( EXCEPTION_EXECUTE_HANDLER ) {
05818            KdPrint((<span class="stringliteral">"CONSRV: WM_DROPFILES raised exception\n"</span>));
05819            i = 0;
05820         }
05821 Exit:
05822         GlobalUnlock(hDrop);
05823         GlobalFree(hDrop);
05824     }
05825 
05826     <span class="keywordflow">return</span>(i);
05827 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a93" doxytag="consrv.h::ConsoleDupShare" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ConsoleDupShare           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetHandleData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/share_8c-source.html#l00095">95</a> of file <a class="el" href="../../d8/d7/share_8c-source.html">share.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00561">InheritIoHandleTable()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>.
<p>
<pre class="fragment"><div>00102 {
00103     ULONG ReadAccess;
00104     ULONG WriteAccess;
00105     ULONG SharedRead;
00106     ULONG SharedWrite;
00107 
00108     <span class="comment">//</span>
00109     <span class="comment">// Set the access type in the file object for the current accessor.</span>
00110     <span class="comment">//</span>
00111 
00112     ReadAccess = (DesiredAccess &amp; GENERIC_READ) != 0;
00113     WriteAccess = (DesiredAccess &amp; GENERIC_WRITE) != 0;
00114 
00115     SharedRead = (DesiredShareAccess &amp; FILE_SHARE_READ) != 0;
00116     SharedWrite = (DesiredShareAccess &amp; FILE_SHARE_WRITE) != 0;
00117 
00118     <span class="keywordflow">if</span> (ShareAccess-&gt;OpenCount == 0) {
00119         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (FALSE);
00120         <span class="keywordflow">return</span> STATUS_SHARING_VIOLATION;
00121     }
00122 
00123     ShareAccess-&gt;OpenCount++;
00124 
00125     ShareAccess-&gt;Readers += ReadAccess;
00126     ShareAccess-&gt;Writers += WriteAccess;
00127 
00128     ShareAccess-&gt;SharedRead += SharedRead;
00129     ShareAccess-&gt;SharedWrite += SharedWrite;
00130 
00131     TargetHandleData-&gt;Access = DesiredAccess;
00132     TargetHandleData-&gt;ShareAccess = DesiredShareAccess;
00133 
00134     <span class="keywordflow">return</span> STATUS_SUCCESS;
00135 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a237" doxytag="consrv.h::ConsoleHideCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ConsoleHideCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">207</a> of file <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html">ntcon/server/cursor.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00033">InvertPixels()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03226">ScrollRegion()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00288">SetCursorMode()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02998">StreamScrollRegion()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00918">WWSB_WriteToScreen()</a>.
<p>
<pre class="fragment"><div>00213                    :
00214 
00215     This routine makes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cursor invisible both in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data structures
00216     and on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen.
00217 
00218 Arguments:
00219 
00220     ScreenInfo - pointer to screen info structure.
00221 
00222 Return Value:
00223 
00224     none.
00225 
00226 --*/
00227 
00228 {
00229     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00230         <span class="keywordflow">if</span> (++ScreenInfo-&gt;BufferInfo.TextInfo.UpdatingScreen == 1) {
00231             <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.CursorVisible &amp;&amp;
00232                 ScreenInfo-&gt;BufferInfo.TextInfo.CursorOn &amp;&amp;
00233                 ScreenInfo-&gt;Console-&gt;CurrentScreenBuffer == ScreenInfo &amp;&amp;
00234                 !(ScreenInfo-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>)) {
00235                 <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a1">InvertPixels</a>(ScreenInfo);
00236                 ScreenInfo-&gt;BufferInfo.TextInfo.CursorOn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00237             }
00238         }
00239     }
00240 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a132" doxytag="consrv.h::ConsoleInputThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ConsoleInputThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__INPUT__THREAD__INIT__INFO.html">PINPUT_THREAD_INIT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pInputThreadInitInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00626">InitWindowsStuff()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a94" doxytag="consrv.h::ConsoleRemoveShare" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ConsoleRemoveShare           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ShareAccess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/share_8c-source.html#l00138">138</a> of file <a class="el" href="../../d8/d7/share_8c-source.html">share.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>.
<p>
<pre class="fragment"><div>00144 {
00145     ULONG ReadAccess;
00146     ULONG WriteAccess;
00147     ULONG SharedRead;
00148     ULONG SharedWrite;
00149 
00150     <span class="comment">//</span>
00151     <span class="comment">// Set the access type in the file object for the current accessor.</span>
00152     <span class="comment">//</span>
00153 
00154     ReadAccess = (DesiredAccess &amp; GENERIC_READ) != 0;
00155     WriteAccess = (DesiredAccess &amp; GENERIC_WRITE) != 0;
00156 
00157     SharedRead = (DesiredShareAccess &amp; FILE_SHARE_READ) != 0;
00158     SharedWrite = (DesiredShareAccess &amp; FILE_SHARE_WRITE) != 0;
00159 
00160     <span class="keywordflow">if</span> (ShareAccess-&gt;OpenCount == 0) {
00161         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (FALSE);
00162         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00163     }
00164 
00165     ShareAccess-&gt;OpenCount--;
00166 
00167     ShareAccess-&gt;Readers -= ReadAccess;
00168     ShareAccess-&gt;Writers -= WriteAccess;
00169 
00170     ShareAccess-&gt;SharedRead -= SharedRead;
00171     ShareAccess-&gt;SharedWrite -= SharedWrite;
00172 
00173     <span class="keywordflow">return</span> STATUS_SUCCESS;
00174 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a238" doxytag="consrv.h::ConsoleShowCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ConsoleShowCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">176</a> of file <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html">ntcon/server/cursor.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03226">ScrollRegion()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00288">SetCursorMode()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02998">StreamScrollRegion()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00918">WWSB_WriteToScreen()</a>.
<p>
<pre class="fragment"><div>00182                    :
00183 
00184     This routine makes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cursor visible both in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data structures
00185     and on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen.
00186 
00187 Arguments:
00188 
00189     ScreenInfo - pointer to screen info structure.
00190 
00191 Return Value:
00192 
00193     none.
00194 
00195 --*/
00196 
00197 {
00198     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00199         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;BufferInfo.TextInfo.UpdatingScreen&gt;0);
00200         <span class="keywordflow">if</span> (--ScreenInfo-&gt;BufferInfo.TextInfo.UpdatingScreen == 0) {
00201             ScreenInfo-&gt;BufferInfo.TextInfo.CursorOn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00202         }
00203     }
00204 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a121" doxytag="consrv.h::ConsoleWindowProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT APIENTRY ConsoleWindowProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04700">4700</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l02354">abs</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00369">ActivateKeyboardLayout</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00161">_SCREEN_INFORMATION::Attributes</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00327">BeginPaint</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00219">_CONSOLE_INFORMATION::bIconInit</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings()</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00147">_CONSOLE_INFORMATION::ClientThreadHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00357">CM_BEEP</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00095">CM_CONIME_KL_ACTIVATE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00375">CM_CONSOLE_MSG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00365">CM_HIDE_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00363">CM_MODE_TRANSITION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00356">CM_SET_WINDOW_SIZE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00358">CM_UPDATE_SCROLL_BARS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00359">CM_UPDATE_TITLE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00043">cmControl</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00036">cmCopy</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00044">cmDefaults</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00040">cmFind</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00038">cmMark</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00037">cmPaste</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00039">cmScroll</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00041">cmSelectAll</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00167">_SCREEN_INFORMATION::CommandIdHigh</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00166">_SCREEN_INFORMATION::CommandIdLow</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00078">CONIME_INPUTLANGCHANGE</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00080">CONIME_INPUTLANGCHANGEREQUEST</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00082">CONIME_INPUTLANGCHANGEREQUESTBACKWARD</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00081">CONIME_INPUTLANGCHANGEREQUESTFORWARD</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00083">CONIME_KEYDATA</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00072">CONIME_KILLFOCUS</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00071">CONIME_SETFOCUS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00153">_SCREEN_INFORMATION::Console</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00149">CONSOLE_GRAPHICS_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00088">CONSOLE_IGNORE_NEXT_MOUSE_INPUT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00150">CONSOLE_IS_IME_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00097">CONSOLE_TERMINATING</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00103">CONSOLE_WOW_REGISTERED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00221">_CONSOLE_INFORMATION::ConsoleHandle</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l01627">CreateIconFromResourceEx()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00249">CURSOR_TIMER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00171">_SCREEN_INFORMATION::CursorDisplayCount</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00168">_SCREEN_INFORMATION::CursorHandle</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00332">CursorTimerRoutine()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00629">DefWindowProc()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00535">DestroyIcon</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01567">DisplayModeTransition()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05853">DoDrop()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00268">DoFind()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01167">DoMark()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">DoPaste()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01211">DoScroll()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01204">DrawIcon()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00205">_WINDOW_LIMITS::FullScreenSize</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00143">GET_X_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00147">GET_Y_LPARAM</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00096">GetCapture()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00608">GetClientRect()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00624">GetCursorPos()</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00196">GetLastActivePopup()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l06099">GetNonBiDiKeyboardLayout()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00401">GetSystemMetrics()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00083">GetWindowConsole</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00104">gfInitSystemMetrics</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00028">ghDefaultIcon</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00029">ghDefaultSmIcon</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00113">guCaretBlinkTime</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00111">gucWheelScrollLines</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03430">HandleCtrlEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03369">HandleFocusEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03407">HandleMenuEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02272">HandleSysKeyEvent()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00139">_CONSOLE_INFORMATION::hDC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00141">_CONSOLE_INFORMATION::hHeirMenu</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00159">_CONSOLE_INFORMATION::hIcon</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00138">_CONSOLE_INFORMATION::hklActive</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00049">HorizontalClientToWindow</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04653">HorizontalScroll()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00047">HorizontalScrollSize</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00169">_SCREEN_INFORMATION::hPalette</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00160">_CONSOLE_INFORMATION::hSmIcon</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00142">_CONSOLE_INFORMATION::hSysPalette</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00218">_CONSOLE_INFORMATION::hWndProgMan</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00233">_CONSOLE_INFORMATION::hWndProperties</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00161">_CONSOLE_INFORMATION::iIconId</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a55">ImmConversionFromConsole()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00124">InitializeMenu()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00177">InitializeSystemMetrics()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00132">_CONSOLE_INFORMATION::InputBuffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00235">_CONSOLE_INFORMATION::InputThreadInfo</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04004">InternalSetWindowSize()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02181">InternalUpdateScrollBars()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00077">_PMIconData::iResource</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00149">IS_IME_KBDLAYOUT</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00525">IsIconic()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00071">ITEM_MAX_SIZE</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00102">KEY_PRESSED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00260">LockConsole</a>, <a class="el" href="../../d6/d2/output_8c.html#a10">LPPMICONDATA</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00204">_WINDOW_LIMITS::MaxWindow</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00202">_WINDOW_LIMITS::MinimumWindowSize</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04227">ModifyConsoleProcessFocus()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d0/client_2draw_8c-source.html#l00025">PaintRect()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00483">PeekMessage()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00059">Point</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00162">_SCREEN_INFORMATION::PopupAttributes</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00765">PositionConsoleWindow()</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d5/d7/resize_8c-source.html#l00040">ProcessResizeWindow()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00052">ProgmanHandleMessage</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04267">QueueConsoleMessage()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03414">ReleaseCapture()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00163">_CONSOLE_INFORMATION::ReserveKeys</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00144">_CONSOLE_INFORMATION::ResizeFlags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00160">_SCREEN_INFORMATION::ResizingWindow</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00775">ReuseDDElParam</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00290">SCREEN_BUFFER_CHANGE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00288">SCROLL_BAR_CHANGE</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01231">ScrollIfNecessary()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00718">SelectPalette</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00544">SetActivePalette()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00361">SetCapture</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a313">SetConsoleReserveKeys()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00547">SetCursor</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03499">SetForegroundWindow()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00442">SetTimer</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00848">SetWindowText()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00180">ShowWindow</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00959">SystemParametersInfo()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00157">_CONSOLE_INFORMATION::Title</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04248">TrimConsoleWorkingSet()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04323">UnqueueConsoleMessage()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00573">UnsetActivePalette()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03972">UpdateWindowSize()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00370">ValidateConsole()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00048">VerticalClientToWindow</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04575">VerticalScroll()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00046">VerticalScrollSize</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00172">_SCREEN_INFORMATION::WheelDelta</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00576">WindowFromPoint</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00165">_SCREEN_INFORMATION::WindowMaximized</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00163">_SCREEN_INFORMATION::WindowMaximizedX</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00164">_SCREEN_INFORMATION::WindowMaximizedY</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00143">_CONSOLE_INFORMATION::WindowRect</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00293">WriteRegionToScreenBitMap()</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00590">InitWindowClass()</a>.
<p>
<pre class="fragment"><div>04706 {
04707     HDC hDC;
04708     PAINTSTRUCT ps;
04709     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
04710     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
04711     SMALL_RECT <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>;
04712     LRESULT <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04713 
04714     Console = <a class="code" href="../../d8/d5/consrv_8h.html#a21">GetWindowConsole</a>(hWnd);
04715     <span class="keywordflow">if</span> (Console != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04716 
04717         <span class="comment">//</span>
04718         <span class="comment">// Set up our thread so we can impersonate the client</span>
04719         <span class="comment">// while processing the message.</span>
04720         <span class="comment">//</span>
04721 
04722         CSR_SERVER_QUERYCLIENTTHREAD()-&gt;ThreadHandle =
04723                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o18">ClientThreadHandle</a>;
04724 
04725         <span class="comment">//</span>
04726         <span class="comment">// If the console is terminating, don't bother processing messages</span>
04727         <span class="comment">// other than CM_DESTROY_WINDOW.</span>
04728         <span class="comment">//</span>
04729         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a12">CONSOLE_TERMINATING</a>) {
04730             <a class="code" href="../../d8/d5/consrv_8h.html#a42">LockConsole</a>(Console);
04731             <a class="code" href="../../d6/d2/output_8c.html#a80">DestroyWindowsWindow</a>(Console);
04732             <span class="keywordflow">return</span> 0;
04733         }
04734 
04735         <span class="comment">//</span>
04736         <span class="comment">// Make sure the console pointer is still valid</span>
04737         <span class="comment">//</span>
04738         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a15">ValidateConsole</a>(Console)));
04739 
04740         <a class="code" href="../../d8/d5/consrv_8h.html#a42">LockConsole</a>(Console);
04741 
04742         ScreenInfo = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>;
04743     }
04744     <span class="keywordflow">try</span> {
04745         <span class="keywordflow">if</span> (Console == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || ScreenInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04746             <span class="keywordflow">switch</span> (Message) {
04747             <span class="keywordflow">case</span> WM_GETMINMAXINFO:
04748                 {
04749                 <span class="comment">//</span>
04750                 <span class="comment">// createwindow issues a WM_GETMINMAXINFO</span>
04751                 <span class="comment">// message before we have the windowlong set up</span>
04752                 <span class="comment">// with the console pointer.  we need to allow</span>
04753                 <span class="comment">// the created window to be bigger than the</span>
04754                 <span class="comment">// default size by the scroll size.</span>
04755                 <span class="comment">//</span>
04756 
04757                 LPMINMAXINFO lpmmi = (LPMINMAXINFO)lParam;
04758                 lpmmi-&gt;ptMaxTrackSize.y += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a18">HorizontalScrollSize</a>;
04759                 lpmmi-&gt;ptMaxTrackSize.x += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a17">VerticalScrollSize</a>;
04760                 }
04761                 <span class="keywordflow">break</span>;
04762 
04763             <span class="keywordflow">default</span>:
04764                 <span class="keywordflow">goto</span> CallDefWin;
04765             }
04766         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Message == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a23">ProgmanHandleMessage</a> &amp;&amp; lParam==0) {
04767             <span class="comment">// NOTE: lParam will be 0 if progman is sending it and</span>
04768             <span class="comment">// 1 if console is sending it.</span>
04769             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = 0;
04770             <span class="comment">// this is a workaround for a progman bug.  progman</span>
04771             <span class="comment">// sends a progmanhandlemessage twice for each window</span>
04772             <span class="comment">// in the system each time one is requested (for one window).</span>
04773             <span class="keywordflow">if</span> ((HWND)wParam != <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o64">bIconInit</a>) {
04774                 ATOM App,Topic;
04775                 <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> szItem[<a class="code" href="../../d6/d2/output_8c.html#a3">ITEM_MAX_SIZE</a>+1];
04776                 PCHAR lpItem;
04777                 ATOM aItem;
04778                 HANDLE ConsoleHandle;
04779 
04780                 <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a12">CONSOLE_TERMINATING</a>)) {
04781                     ConsoleHandle = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>;
04782                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a> = (HWND)wParam;
04783                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04784                     App = GlobalAddAtomA(<span class="stringliteral">"Shell"</span>);
04785                     Topic = GlobalAddAtomA(<span class="stringliteral">"AppIcon"</span>);
04786                     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a>,
04787                                 WM_DDE_INITIATE,
04788                                 (WPARAM)hWnd,
04789                                 MAKELONG(App,Topic)
04790                                );
04791 
04792                     <span class="comment">// if console is still valid, continue getting icon.</span>
04793                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(ConsoleHandle, &amp;Console);
04794                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
04795                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o64">bIconInit</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04796                         lpItem = _itoa((<span class="keywordtype">int</span>)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o32">iIconId</a>,szItem,10);
04797                         aItem = GlobalAddAtomA(lpItem);
04798                         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a>,
04799                           WM_DDE_REQUEST,
04800                           (WPARAM)hWnd,
04801                           MAKELONG(CF_TEXT,aItem)
04802                          );
04803                     }
04804                 }
04805             }
04806         } <span class="keywordflow">else</span> {
04807             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = 0;
04808             <span class="keywordflow">switch</span> (Message) {
04809             <span class="keywordflow">case</span> WM_DROPFILES:
04810                 <a class="code" href="../../d6/d2/output_8c.html#a85">DoDrop</a> (wParam,Console);
04811                 <span class="keywordflow">break</span>;
04812             <span class="keywordflow">case</span> WM_MOVE:
04813                 <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a19">IsIconic</a>(hWnd)) {
04814                     <a class="code" href="../../d6/d2/output_8c.html#a43">PositionConsoleWindow</a>(Console, (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.left == CW_USEDEFAULT));
04815 <span class="preprocessor">#if defined(FE_IME)</span>
04816 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
04817                     {
04818                         ConsoleImeResizeModeSystemView(Console,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
04819                         ConsoleImeResizeCompStrView(Console,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
04820                     }
04821 <span class="preprocessor">#endif // FE_IME</span>
04822 <span class="preprocessor"></span>                }
04823                 <span class="keywordflow">break</span>;
04824             <span class="keywordflow">case</span> WM_SIZE:
04825 
04826                 <span class="keywordflow">if</span> (wParam != SIZE_MINIMIZED) {
04827 
04828                     <span class="comment">//</span>
04829                     <span class="comment">// both SetWindowPos and SetScrollRange cause WM_SIZE</span>
04830                     <span class="comment">// messages to be issued.  ignore them if we have already</span>
04831                     <span class="comment">// figured out what size the window should be.</span>
04832                     <span class="comment">//</span>
04833 
04834                     <span class="keywordflow">if</span> (!ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o7">ResizingWindow</a>) {
04835 <span class="preprocessor">#ifdef THERESES_DEBUG</span>
04836 <span class="preprocessor"></span><a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"WM_SIZE message "</span>);
04837 <span class="keywordflow">if</span> (wParam == SIZEFULLSCREEN)
04838    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SIZEFULLSCREEN\n"</span>);
04839 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == SIZENORMAL)
04840    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SIZENORMAL\n"</span>);
04841 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"  WindowSize is %d %d\n"</span>,<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo),<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo));
04842 <span class="preprocessor">#endif</span>
04843 <span class="preprocessor"></span>                        ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o12">WindowMaximized</a> = (wParam == SIZE_MAXIMIZED);
04844 
04845                         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o15">ResizeFlags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a44">SCREEN_BUFFER_CHANGE</a>) {
04846                             <a class="code" href="../../d6/d2/output_8c.html#a69">UpdateWindowSize</a>(Console,ScreenInfo);
04847                         }
04848                         <a class="code" href="../../d6/d2/output_8c.html#a43">PositionConsoleWindow</a>(Console, (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.left == CW_USEDEFAULT));
04849 <span class="preprocessor">#if defined(FE_IME)</span>
04850 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
04851                         {
04852                             ConsoleImeResizeModeSystemView(Console,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
04853                             ConsoleImeResizeCompStrView(Console,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
04854                         }
04855 <span class="preprocessor">#endif // FE_IME</span>
04856 <span class="preprocessor"></span><span class="preprocessor">#ifdef THERESES_DEBUG</span>
04857 <span class="preprocessor"></span><a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"  WindowRect is now %d %d %d %d\n"</span>,Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.left,
04858                                          Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.top,
04859                                          Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.right,
04860                                          Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o14">WindowRect</a>.bottom);
04861 <span class="preprocessor">#endif</span>
04862 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o15">ResizeFlags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a42">SCROLL_BAR_CHANGE</a>) {
04863                             <a class="code" href="../../d6/d2/output_8c.html#a37">InternalUpdateScrollBars</a>(ScreenInfo);
04864                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o15">ResizeFlags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a42">SCROLL_BAR_CHANGE</a>;
04865                         }
04866                     }
04867                 } <span class="keywordflow">else</span> {
04868 
04869                     <span class="comment">//</span>
04870                     <span class="comment">// Console is going iconic. Trim working set of all</span>
04871                     <span class="comment">// processes in the console</span>
04872                     <span class="comment">//</span>
04873 
04874                     <a class="code" href="../../d6/d2/output_8c.html#a75">TrimConsoleWorkingSet</a>(Console);
04875 
04876                 }
04877 
04878                 <span class="keywordflow">break</span>;
04879             <span class="keywordflow">case</span> WM_DDE_ACK:
04880                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o64">bIconInit</a>) {
04881                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a> = (HWND)wParam;
04882                 }
04883                 <span class="keywordflow">break</span>;
04884             <span class="keywordflow">case</span> WM_DDE_DATA:
04885                 {
04886                 DDEDATA *lpDDEData;
04887                 <a class="code" href="../../d3/d6/struct__PMIconData.html">LPPMICONDATA</a> lpIconData;
04888                 HICON hIcon;
04889                 HANDLE hDdeData;
04890                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRelease;
04891                 WPARAM atomTemp;
04892 
04893                 <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_DATA, lParam, (WPARAM *)&amp;hDdeData, &amp;atomTemp);
04894 
04895                 <span class="keywordflow">if</span> (hDdeData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04896                     <span class="keywordflow">break</span>;
04897                 }
04898                 lpDDEData = (DDEDATA *)GlobalLock(hDdeData);
04899                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(lpDDEData-&gt;cfFormat == CF_TEXT);
04900                 lpIconData = (<a class="code" href="../../d3/d6/struct__PMIconData.html">LPPMICONDATA</a>)lpDDEData-&gt;Value;
04901                 hIcon = <a class="code" href="../../d4/d9/clres_8c.html#a70">CreateIconFromResourceEx</a>(&amp;lpIconData-&gt;<a class="code" href="../../d3/d6/struct__PMIconData.html#o2">iResource</a>,
04902                         0, TRUE, 0x30000, 0, 0, LR_DEFAULTSIZE);
04903                 <span class="keywordflow">if</span> (hIcon) {
04904                     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
04905                         <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>);
04906                     }
04907                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> = hIcon;
04908                     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_SETICON, ICON_BIG, (LPARAM)hIcon);
04909 
04910                     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04911                         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>) {
04912                             <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a>);
04913                         }
04914                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04915                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_SETICON, ICON_SMALL, (LPARAM)NULL);
04916                     }
04917                 }
04918 
04919                 <span class="keywordflow">if</span> (lpDDEData-&gt;fAckReq) {
04920 
04921                     <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a>,
04922                                 WM_DDE_ACK,
04923                                 (WPARAM)hWnd,
04924                                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a89">ReuseDDElParam</a>(lParam, WM_DDE_DATA, WM_DDE_ACK, 0x8000, atomTemp));
04925                 }
04926 
04927                 bRelease = lpDDEData-&gt;fRelease;
04928                 GlobalUnlock(hDdeData);
04929                 <span class="keywordflow">if</span> (bRelease){
04930                     GlobalFree(hDdeData);
04931                 }
04932                 <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o63">hWndProgMan</a>,
04933                             WM_DDE_TERMINATE,
04934                             (WPARAM)hWnd,
04935                             0
04936                            );
04937                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) {
04938                     <span class="comment">// force repaint of icon</span>
04939                     InvalidateRect(hWnd, NULL, TRUE);
04940                 }
04941                 }
04942                 <span class="keywordflow">break</span>;
04943             <span class="keywordflow">case</span> WM_ACTIVATE:
04944 
04945                 <span class="comment">//</span>
04946                 <span class="comment">// if we're activated by a mouse click, remember it so</span>
04947                 <span class="comment">// we don't pass the click on to the app.</span>
04948                 <span class="comment">//</span>
04949 
04950                 <span class="keywordflow">if</span> (LOWORD(wParam) == WA_CLICKACTIVE) {
04951                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a3">CONSOLE_IGNORE_NEXT_MOUSE_INPUT</a>;
04952                 }
04953                 <span class="keywordflow">goto</span> CallDefWin;
04954                 <span class="keywordflow">break</span>;
04955             <span class="keywordflow">case</span> WM_DDE_TERMINATE:
04956                 <span class="keywordflow">break</span>;
04957                 <span class="comment">// FE_IME</span>
04958             <span class="keywordflow">case</span> <a class="code" href="../../d3/d5/conime_8h.html#a27">CM_CONIME_KL_ACTIVATE</a>:
04959                 <a class="code" href="../../d3/d0/user32_8def.html#a45">ActivateKeyboardLayout</a>((HKL)wParam, KLF_SETFORPROCESS);
04960                 <span class="keywordflow">break</span>;
04961             <span class="keywordflow">case</span> WM_INPUTLANGCHANGEREQUEST:
04962                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
04963                     ULONG ConimeMessage;
04964                     LRESULT lResult;
04965 
04966                     <span class="keywordflow">if</span> (wParam &amp; INPUTLANGCHANGE_BACKWARD) {
04967                         ConimeMessage = <a class="code" href="../../d3/d5/conime_8h.html#a22">CONIME_INPUTLANGCHANGEREQUESTBACKWARD</a>;
04968                     }
04969                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam &amp; INPUTLANGCHANGE_FORWARD) {
04970                         ConimeMessage = <a class="code" href="../../d3/d5/conime_8h.html#a21">CONIME_INPUTLANGCHANGEREQUESTFORWARD</a>;
04971                     }
04972                     <span class="keywordflow">else</span> {
04973                         ConimeMessage = <a class="code" href="../../d3/d5/conime_8h.html#a20">CONIME_INPUTLANGCHANGEREQUEST</a>;
04974                     }
04975 
04976                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePumpWorker(Console,
04977                                               ConimeMessage,
04978                                               (WPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
04979                                               (LPARAM)lParam,
04980                                               &amp;lResult)) ||
04981                             !lResult) {
04982 
04983                         <span class="keywordflow">break</span>;
04984                     }
04985                 }
04986 <span class="preprocessor">#ifdef LATER</span>
04987 <span class="preprocessor"></span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(lParam)) {
04988                     <span class="comment">// IME keyboard layout should be avoided</span>
04989                     <span class="comment">// if the console is not IME enabled.</span>
04990                     <span class="keywordflow">break</span>;
04991                 }
04992                 <span class="comment">// Call the default window proc and let it handle</span>
04993                 <span class="comment">// the keyboard layout activation.</span>
04994 <span class="preprocessor">#endif</span>
04995 <span class="preprocessor"></span>                <span class="keywordflow">goto</span> CallDefWin;
04996 
04997                 <span class="keywordflow">break</span>;
04998                 <span class="comment">// end FE_IME</span>
04999 
05000             <span class="keywordflow">case</span> WM_INPUTLANGCHANGE:
05001                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a> = (HKL)lParam;
05002                 <span class="comment">// FE_IME</span>
05003                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
05004                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
05005                                           CONIME_INPUTLANGCHANGE,
05006                                           (WPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
05007                                           (LPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>
05008                                          ))) {
05009                         <span class="keywordflow">break</span>;
05010                     }
05011                     <span class="keywordflow">else</span>{
05012                         GetImeKeyState(Console, NULL) ;
05013                     }
05014                 }
05015                 <span class="comment">// end FE_IME</span>
05016                 <span class="keywordflow">goto</span> CallDefWin;
05017 
05018                 <span class="keywordflow">break</span>;
05019 
05020             <span class="keywordflow">case</span> WM_SETFOCUS:
05021                 <a class="code" href="../../d6/d2/output_8c.html#a74">ModifyConsoleProcessFocus</a>(Console, TRUE);
05022                 <a class="code" href="../../d8/d5/consrv_8h.html#a313">SetConsoleReserveKeys</a>(hWnd, Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o34">ReserveKeys</a>);
05023                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>;
05024 
05025                 <a class="code" href="../../d3/d0/user32_8def.html#a56">SetTimer</a>(hWnd, CURSOR_TIMER, guCaretBlinkTime, NULL);
05026                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a48">HandleFocusEvent</a>(Console,TRUE);
05027                 <span class="keywordflow">if</span> (!Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>) {
05028                     <a class="code" href="../../d5/d9/cltxt_8h.html#a26">SystemParametersInfo</a>(SPI_GETDEFAULTINPUTLANG, 0, &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>, FALSE);
05029                     <a class="code" href="../../d6/d2/output_8c.html#a31">GetNonBiDiKeyboardLayout</a>(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>);
05030                 }
05031                 <a class="code" href="../../d3/d0/user32_8def.html#a45">ActivateKeyboardLayout</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>, 0);
05032                 <span class="comment">// FE_IME</span>
05033                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
05034                     <span class="comment">// v-HirShi Sep.15.1995 Support Console IME</span>
05035                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
05036                                           CONIME_SETFOCUS,
05037                                           (WPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
05038                                           (LPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>
05039                                          ))) {
05040                         <span class="keywordflow">break</span>;
05041                     }
05042 
05043                     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.hWndConsoleIME)
05044                     {
05045                         <span class="comment">/*</span>
05046 <span class="comment">                         * open property window by ImmConfigureIME</span>
05047 <span class="comment">                         * never set focus on console window</span>
05048 <span class="comment">                         * so, set focus to property window</span>
05049 <span class="comment">                         */</span>
05050                         HWND hwnd = <a class="code" href="../../d3/d8/winmgrc_8c.html#a16">GetLastActivePopup</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.hWndConsoleIME);
05051                         <span class="keywordflow">if</span> (hwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
05052                             <a class="code" href="../../d3/d8/client_8c.html#a131">SetForegroundWindow</a>(hwnd);
05053                     }
05054                 }
05055                 <span class="comment">// FE_IME</span>
05056                 <span class="keywordflow">break</span>;
05057             <span class="keywordflow">case</span> WM_KILLFOCUS:
05058                 <a class="code" href="../../d6/d2/output_8c.html#a74">ModifyConsoleProcessFocus</a>(Console, FALSE);
05059                 <a class="code" href="../../d8/d5/consrv_8h.html#a313">SetConsoleReserveKeys</a>(hWnd, CONSOLE_NOSHORTCUTKEY);
05060                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>;
05061 
05062                 <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
05063                     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
05064                     ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.UpdatingScreen -= 1; <span class="comment">// counteract HideCursor</span>
05065                 }
05066                 KillTimer(hWnd, CURSOR_TIMER);
05067                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a48">HandleFocusEvent</a>(Console,FALSE);
05068 
05069                 <span class="comment">// FE_IME</span>
05070                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
05071                     <span class="comment">// v-HirShi Sep.16.1995 Support Console IME</span>
05072                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
05073                                           CONIME_KILLFOCUS,
05074                                           (WPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
05075                                           (LPARAM)NULL
05076                                          ))) {
05077                         <span class="keywordflow">break</span>;
05078                     }
05079                 }
05080                 <span class="comment">// end FE_IME</span>
05081                 <span class="keywordflow">break</span>;
05082             <span class="keywordflow">case</span> WM_PAINT:
05083 
05084                 <span class="comment">// ICONIC bit is not set if we're fullscreen and don't</span>
05085                 <span class="comment">// have the hardware</span>
05086 
05087                 <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
05088                 hDC = <a class="code" href="../../d3/d0/user32_8def.html#a41">BeginPaint</a>(hWnd, &amp;ps);
05089                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a> ||
05090                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == CONSOLE_FULLSCREEN) {
05091                     RECT rc;
05092                     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cxIcon, cyIcon;
05093                     <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hWnd, &amp;rc);
05094                     cxIcon = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CXICON);
05095                     cyIcon = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CYICON);
05096 
05097                     rc.left = (rc.right - cxIcon) &gt;&gt; 1;
05098                     rc.top = (rc.bottom - cyIcon) &gt;&gt; 1;
05099 
05100                     <a class="code" href="../../d3/d8/client_8c.html#a49">DrawIcon</a>(hDC, rc.left, rc.top, Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>);
05101                 } <span class="keywordflow">else</span> {
05102                     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
05103                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Left = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((ps.rcPaint.left/<a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X)+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left);
05104                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((ps.rcPaint.right/<a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X)+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left);
05105                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Top = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((ps.rcPaint.top/<a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y)+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top);
05106                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((ps.rcPaint.bottom/<a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y)+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top);
05107                     } <span class="keywordflow">else</span> {
05108                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Left = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ps.rcPaint.left+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left);
05109                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ps.rcPaint.right+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left);
05110                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Top = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ps.rcPaint.top+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top);
05111                         <a class="code" href="../../d7/d1/client_2draw_8c.html#a0">PaintRect</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ps.rcPaint.bottom+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top);
05112                     }
05113                     ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
05114                     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;PaintRect);
05115                 }
05116                 EndPaint(hWnd,&amp;ps);
05117                 <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
05118                 <span class="keywordflow">break</span>;
05119             <span class="keywordflow">case</span> WM_CLOSE:
05120                 <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>) ||
05121                     !(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a18">CONSOLE_WOW_REGISTERED</a>)) {
05122                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a50">HandleCtrlEvent</a>(Console,CTRL_CLOSE_EVENT);
05123                 }
05124                 <span class="keywordflow">break</span>;
05125             <span class="keywordflow">case</span> WM_ERASEBKGND:
05126 
05127                 <span class="comment">// ICONIC bit is not set if we're fullscreen and don't</span>
05128                 <span class="comment">// have the hardware</span>
05129 
05130                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a> ||
05131                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == CONSOLE_FULLSCREEN) {
05132                     Message = WM_ICONERASEBKGND;
05133                     <span class="keywordflow">goto</span> CallDefWin;
05134                 }
05135                 <span class="keywordflow">break</span>;
05136             <span class="keywordflow">case</span> WM_SETTINGCHANGE:
05137                 <span class="comment">/*</span>
05138 <span class="comment">                 * See if the caret blink time was changed. If so, reset the</span>
05139 <span class="comment">                 * timer.</span>
05140 <span class="comment">                 */</span>
05141                 <span class="keywordflow">if</span> (wParam == SPI_SETKEYBOARDDELAY) {
05142                     <a class="code" href="../../d6/d2/output_8c.html#a28">guCaretBlinkTime</a> = GetCaretBlinkTime();
05143                     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
05144                         KillTimer(hWnd, CURSOR_TIMER);
05145                         <a class="code" href="../../d3/d0/user32_8def.html#a56">SetTimer</a>(hWnd, CURSOR_TIMER, guCaretBlinkTime, NULL);
05146                     }
05147                 } <span class="keywordflow">else</span> {
05148                     <a class="code" href="../../d6/d2/output_8c.html#a23">gfInitSystemMetrics</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05149                 }
05150                 <span class="keywordflow">break</span>;
05151             <span class="keywordflow">case</span> WM_DISPLAYCHANGE:
05152                 <a class="code" href="../../d6/d2/output_8c.html#a23">gfInitSystemMetrics</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05153                 <span class="keywordflow">break</span>;
05154             <span class="keywordflow">case</span> WM_SETCURSOR:
05155                 <span class="keywordflow">if</span> (lParam == -1) {
05156 
05157                     <span class="comment">//</span>
05158                     <span class="comment">// the app changed the cursor visibility or shape.</span>
05159                     <span class="comment">// see if the cursor is in the client area.</span>
05160                     <span class="comment">//</span>
05161 
05162                     POINT <a class="code" href="../../d7/d5/structPoint.html">Point</a>;
05163                     HWND hWndTmp;
05164                     <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(&amp;Point);
05165                     hWndTmp = <a class="code" href="../../d3/d0/user32_8def.html#a68">WindowFromPoint</a>(Point);
05166                     <span class="keywordflow">if</span> (hWndTmp == <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>) {
05167                         lParam = <a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hWnd,WM_NCHITTEST,0,MAKELONG((WORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a30">Point</a>.x, (WORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a30">Point</a>.y));
05168                     }
05169                 }
05170                 <span class="keywordflow">if</span> ((WORD)lParam == HTCLIENT) {
05171                     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o18">CursorDisplayCount</a> &lt; 0) {
05172                         <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(NULL);
05173                     } <span class="keywordflow">else</span> {
05174                         <a class="code" href="../../d3/d0/user32_8def.html#a65">SetCursor</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o15">CursorHandle</a>);
05175                     }
05176                 } <span class="keywordflow">else</span> {
05177                     <span class="keywordflow">goto</span> CallDefWin;
05178                 }
05179                 <span class="keywordflow">break</span>;
05180             <span class="keywordflow">case</span> WM_GETMINMAXINFO:
05181                 {
05182                 LPMINMAXINFO lpmmi = (LPMINMAXINFO)lParam;
05183                 COORD FontSize;
05184                 <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
05185 
05186                 <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
05187                 <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
05188                     FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
05189                 } <span class="keywordflow">else</span> {
05190                     FontSize.X = 1;
05191                     FontSize.Y = 1;
05192                 }
05193                 lpmmi-&gt;ptMaxSize.x = lpmmi-&gt;ptMaxTrackSize.x = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o2">MaxWindow</a>.X;
05194                 <span class="keywordflow">if</span> (!ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o11">WindowMaximizedY</a>) {
05195                     lpmmi-&gt;ptMaxTrackSize.x += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a17">VerticalScrollSize</a>;
05196                     lpmmi-&gt;ptMaxSize.x += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a17">VerticalScrollSize</a>;
05197                 }
05198                 <span class="keywordflow">while</span> (lpmmi-&gt;ptMaxSize.x &gt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o3">FullScreenSize</a>.X + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a>) {
05199                     lpmmi-&gt;ptMaxSize.x -= FontSize.X;
05200                 }
05201                 lpmmi-&gt;ptMaxSize.y = lpmmi-&gt;ptMaxTrackSize.y = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o2">MaxWindow</a>.Y;
05202                 <span class="keywordflow">if</span> (!ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o10">WindowMaximizedX</a>) {
05203                     lpmmi-&gt;ptMaxTrackSize.y += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a18">HorizontalScrollSize</a>;
05204                     lpmmi-&gt;ptMaxSize.y += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a18">HorizontalScrollSize</a>;
05205                 }
05206                 <span class="keywordflow">while</span> (lpmmi-&gt;ptMaxSize.y &gt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o3">FullScreenSize</a>.Y + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a20">HorizontalClientToWindow</a>) {
05207                     lpmmi-&gt;ptMaxSize.y -= FontSize.Y;
05208                 }
05209                 lpmmi-&gt;ptMinTrackSize.x = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X * FontSize.X + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a>;
05210                 lpmmi-&gt;ptMinTrackSize.y = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a20">HorizontalClientToWindow</a>;
05211                 }
05212                 <span class="keywordflow">break</span>;
05213             <span class="keywordflow">case</span> WM_QUERYDRAGICON:
05214                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (LRESULT)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>;
05215                 <span class="keywordflow">break</span>;
05216             <span class="keywordflow">case</span> WM_WINDOWPOSCHANGING:
05217                 <span class="comment">// ignore window pos changes if going fullscreen</span>
05218                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> || (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0)) {
05219                     LPWINDOWPOS WindowPos = (LPWINDOWPOS)lParam;
05220                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fMinimized;
05221 
05222                     <span class="comment">/*</span>
05223 <span class="comment">                     * This message is sent before a SetWindowPos() operation</span>
05224 <span class="comment">                     * occurs. We use it here to set/clear the CONSOLE_IS_ICONIC</span>
05225 <span class="comment">                     * bit appropriately... doing so in the WM_SIZE handler</span>
05226 <span class="comment">                     * is incorrect because the WM_SIZE comes after the</span>
05227 <span class="comment">                     * WM_ERASEBKGND during SetWindowPos() processing, and the</span>
05228 <span class="comment">                     * WM_ERASEBKGND needs to know if the console window is</span>
05229 <span class="comment">                     * iconic or not.</span>
05230 <span class="comment">                     */</span>
05231                     fMinimized = <a class="code" href="../../d3/d9/client_2wow_8c.html#a19">IsIconic</a>(hWnd);
05232 
05233                     <span class="keywordflow">if</span> (fMinimized) {
05234                         <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>)) {
05235                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>;
05236 
05237                             <span class="comment">//</span>
05238                             <span class="comment">// if the palette is something other than default,</span>
05239                             <span class="comment">// select the default palette in.  otherwise, the</span>
05240                             <span class="comment">// screen will repaint twice each time the icon</span>
05241                             <span class="comment">// is painted.</span>
05242                             <span class="comment">//</span>
05243 
05244                             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
05245                                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
05246                                 <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>,
05247                                               Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o13">hSysPalette</a>,
05248                                               FALSE);
05249                                 <a class="code" href="../../d7/d4/server_2private_8c.html#a47">UnsetActivePalette</a>(ScreenInfo);
05250                             }
05251                         }
05252                     } <span class="keywordflow">else</span> {
05253                         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) {
05254                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>;
05255 
05256                             <span class="comment">//</span>
05257                             <span class="comment">// if the palette is something other than default,</span>
05258                             <span class="comment">// select the default palette in.  otherwise, the</span>
05259                             <span class="comment">// screen will repaint twice each time the icon</span>
05260                             <span class="comment">// is painted.</span>
05261                             <span class="comment">//</span>
05262 
05263                             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
05264                                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
05265                                 <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>,
05266                                               ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>,
05267                                               FALSE);
05268                                 <a class="code" href="../../d7/d4/server_2private_8c.html#a46">SetActivePalette</a>(ScreenInfo);
05269                             }
05270                         }
05271                     }
05272                     <span class="keywordflow">if</span> (!ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o7">ResizingWindow</a> &amp;&amp;
05273                         (WindowPos-&gt;cx || WindowPos-&gt;cy) &amp;&amp;
05274                         !fMinimized) {
05275                         <a class="code" href="../../d4/d8/resize_8c.html#a1">ProcessResizeWindow</a>(ScreenInfo,Console,WindowPos);
05276                     }
05277                 }
05278                 <span class="keywordflow">break</span>;
05279             <span class="keywordflow">case</span> WM_CONTEXTMENU:
05280                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hWnd, WM_NCHITTEST, 0, lParam) == HTCLIENT) {
05281                     TrackPopupMenuEx(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o12">hHeirMenu</a>,
05282                                      TPM_RIGHTBUTTON,
05283                                      <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lParam),
05284                                      <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lParam),
05285                                      hWnd,
05286                                      NULL);
05287                 } <span class="keywordflow">else</span> {
05288                     <span class="keywordflow">goto</span> CallDefWin;
05289                 }
05290                 <span class="keywordflow">break</span>;
05291             <span class="keywordflow">case</span> WM_NCLBUTTONDOWN:
05292                 <span class="comment">// allow user to move window even when bigger than the screen</span>
05293                 <span class="keywordflow">switch</span> (wParam &amp; 0x00FF) {
05294                     <span class="keywordflow">case</span> HTCAPTION:
05295                         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
05296                         Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05297                         SetActiveWindow(hWnd);
05298                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_SYSCOMMAND,
05299                                        SC_MOVE | wParam, lParam);
05300                         <span class="keywordflow">break</span>;
05301                     <span class="keywordflow">default</span>:
05302                         <span class="keywordflow">goto</span> CallDefWin;
05303                 }
05304                 <span class="keywordflow">break</span>;
05305 <span class="preprocessor">#if defined (FE_IME)</span>
05306 <span class="preprocessor"></span><span class="comment">// Sep.16.1995 Support Console IME</span>
05307             <span class="keywordflow">case</span> WM_KEYDOWN    +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05308             <span class="keywordflow">case</span> WM_KEYUP      +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05309             <span class="keywordflow">case</span> WM_CHAR       +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05310             <span class="keywordflow">case</span> WM_DEADCHAR   +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05311 
05312             <span class="keywordflow">case</span> WM_SYSKEYDOWN +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05313             <span class="keywordflow">case</span> WM_SYSKEYUP   +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05314             <span class="keywordflow">case</span> WM_SYSCHAR    +<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05315             <span class="keywordflow">case</span> WM_SYSDEADCHAR+<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>:
05316 <span class="preprocessor">#endif</span>
05317 <span class="preprocessor"></span>            <span class="keywordflow">case</span> WM_KEYDOWN:
05318             <span class="keywordflow">case</span> WM_KEYUP:
05319             <span class="keywordflow">case</span> WM_CHAR:
05320             <span class="keywordflow">case</span> WM_DEADCHAR:
05321                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a46">HandleKeyEvent</a>(Console,hWnd,Message,wParam,lParam);
05322                 <span class="keywordflow">break</span>;
05323             <span class="keywordflow">case</span> WM_SYSKEYDOWN:
05324             <span class="keywordflow">case</span> WM_SYSKEYUP:
05325             <span class="keywordflow">case</span> WM_SYSCHAR:
05326             <span class="keywordflow">case</span> WM_SYSDEADCHAR:
05327                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a45">HandleSysKeyEvent</a>(Console,hWnd,Message,wParam,lParam) &amp;&amp; Console != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05328                     <span class="keywordflow">goto</span> CallDefWin;
05329                 }
05330                 <span class="keywordflow">break</span>;
05331             <span class="keywordflow">case</span> WM_COMMAND:
05332                 <span class="comment">//</span>
05333                 <span class="comment">// If this is an edit command from the context menu, treat</span>
05334                 <span class="comment">// it like a sys command.</span>
05335                 <span class="comment">//</span>
05336                 <span class="keywordflow">if</span> ((wParam &lt; cmCopy) || (wParam &gt; <a class="code" href="../../d6/d7/menu_8h.html#a13">cmSelectAll</a>)) {
05337                     <span class="keywordflow">break</span>;
05338                 }
05339                 <span class="comment">// FALL THRU</span>
05340             <span class="keywordflow">case</span> WM_SYSCOMMAND:
05341                 <span class="keywordflow">if</span> (wParam &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o13">CommandIdLow</a> &amp;&amp;
05342                     wParam &lt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o14">CommandIdHigh</a>) {
05343                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a49">HandleMenuEvent</a>(Console,(DWORD)wParam);
05344                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a10">cmMark</a>) {
05345                     <a class="code" href="../../d8/d5/consrv_8h.html#a301">DoMark</a>(Console);
05346                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a8">cmCopy</a>) {
05347                     <a class="code" href="../../d8/d5/consrv_8h.html#a300">DoCopy</a>(Console);
05348                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a9">cmPaste</a>) {
05349                     <a class="code" href="../../d8/d5/consrv_8h.html#a304">DoPaste</a>(Console);
05350                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a11">cmScroll</a>) {
05351                     <a class="code" href="../../d8/d5/consrv_8h.html#a311">DoScroll</a>(Console);
05352                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a12">cmFind</a>) {
05353                     <a class="code" href="../../d0/d4/find_8c.html#a3">DoFind</a>(Console);
05354                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a13">cmSelectAll</a>) {
05355                     <a class="code" href="../../d8/d5/consrv_8h.html#a302">DoSelectAll</a>(Console);
05356                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a15">cmControl</a>) {
05357                     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a4">PropertiesDlgShow</a>(Console, TRUE);
05358                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d6/d7/menu_8h.html#a16">cmDefaults</a>) {
05359                     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a4">PropertiesDlgShow</a>(Console, FALSE);
05360                 } <span class="keywordflow">else</span> {
05361 
05362                     <span class="comment">// if we're restoring, remove any</span>
05363                     <span class="comment">// mouse events so app doesn't get them.</span>
05364 
05365                     <span class="keywordflow">if</span> (wParam == SC_RESTORE) {
05366                         MSG RestoreMsg;
05367                         <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(hWnd);
05368                         <span class="keywordflow">while</span> (<a class="code" href="../../d3/d8/winmgrc_8c.html#a12">GetCapture</a>() != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
05369                                (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_LBUTTON) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>)) {
05370                             <a class="code" href="../../d5/d9/cltxt_8h.html#a14">PeekMessage</a>(&amp;RestoreMsg,
05371                                         hWnd,
05372                                         WM_MOUSEFIRST,
05373                                         WM_MOUSELAST,
05374                                         PM_REMOVE
05375                                        );
05376                         }
05377                         <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
05378                     }
05379 
05380                     <span class="keywordflow">goto</span> CallDefWin;
05381                 }
05382                 <span class="keywordflow">break</span>;
05383             <span class="keywordflow">case</span> WM_TIMER:
05384 <span class="preprocessor">#if defined(FE_IME)</span>
05385 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (wParam == SCROLL_WAIT_TIMER)
05386                 {
05387                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>());
05388                     <span class="keywordflow">if</span> ((ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;ConsoleIme.ScrollFlag &amp; (HIDE_FOR_SCROLL)) &amp;&amp;
05389                         (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;ConsoleIme.ScrollWaitCountDown &gt; 0)
05390                        ) {
05391                         <span class="keywordflow">if</span> ((ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;ConsoleIme.ScrollWaitCountDown -= <a class="code" href="../../d6/d2/output_8c.html#a28">guCaretBlinkTime</a>) &lt;= 0) {
05392                             ConsoleImeBottomLineInUse(ScreenInfo);
05393                         }
05394                     }
05395                     <span class="keywordflow">break</span>;
05396                 }
05397 <span class="preprocessor">#endif // FE_IME</span>
05398 <span class="preprocessor"></span>                <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a6">CursorTimerRoutine</a>(ScreenInfo);
05399                 <a class="code" href="../../d6/d2/output_8c.html#a33">ScrollIfNecessary</a>(Console,ScreenInfo);
05400                 <span class="keywordflow">break</span>;
05401             <span class="keywordflow">case</span> WM_HSCROLL:
05402                 <a class="code" href="../../d6/d2/output_8c.html#a82">HorizontalScroll</a>(ScreenInfo, LOWORD(wParam), HIWORD(wParam));
05403                 <span class="keywordflow">break</span>;
05404             <span class="keywordflow">case</span> WM_VSCROLL:
05405                 <a class="code" href="../../d6/d2/output_8c.html#a81">VerticalScroll</a>(Console, ScreenInfo,LOWORD(wParam),HIWORD(wParam));
05406                 <span class="keywordflow">break</span>;
05407             <span class="keywordflow">case</span> WM_INITMENU:
05408                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a49">HandleMenuEvent</a>(Console,WM_INITMENU);
05409                 <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a2">InitializeMenu</a>(Console);
05410                 <span class="keywordflow">break</span>;
05411             <span class="keywordflow">case</span> WM_MENUSELECT:
05412                 <span class="keywordflow">if</span> (HIWORD(wParam) == 0xffff) {
05413                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a49">HandleMenuEvent</a>(Console,WM_MENUSELECT);
05414                 }
05415                 <span class="keywordflow">break</span>;
05416             <span class="keywordflow">case</span> WM_MOUSEMOVE:
05417             <span class="keywordflow">case</span> WM_LBUTTONDOWN:
05418             <span class="keywordflow">case</span> WM_LBUTTONUP:
05419             <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
05420             <span class="keywordflow">case</span> WM_RBUTTONDOWN:
05421             <span class="keywordflow">case</span> WM_RBUTTONUP:
05422             <span class="keywordflow">case</span> WM_RBUTTONDBLCLK:
05423             <span class="keywordflow">case</span> WM_MBUTTONDOWN:
05424             <span class="keywordflow">case</span> WM_MBUTTONUP:
05425             <span class="keywordflow">case</span> WM_MBUTTONDBLCLK:
05426             <span class="keywordflow">case</span> WM_MOUSEWHEEL:
05427                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a47">HandleMouseEvent</a>(Console,ScreenInfo,Message,wParam,lParam)) {
05428                     <span class="keywordflow">if</span> (Message != WM_MOUSEWHEEL) {
05429                         <span class="keywordflow">goto</span> CallDefWin;
05430                     }
05431                 } <span class="keywordflow">else</span> {
05432                     <span class="keywordflow">break</span>;
05433                 }
05434 
05435                 <span class="comment">/*</span>
05436 <span class="comment">                 * Don't handle zoom</span>
05437 <span class="comment">                 */</span>
05438                 <span class="keywordflow">if</span> (wParam &amp; (MK_CONTROL)) {
05439                     <span class="keywordflow">goto</span> CallDefWin;
05440                 }
05441 
05442                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = 1;
05443                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a23">gfInitSystemMetrics</a>) {
05444                     <a class="code" href="../../d6/d2/output_8c.html#a38">InitializeSystemMetrics</a>();
05445                 }
05446 
05447                 ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o19">WheelDelta</a> -= (<span class="keywordtype">short</span>)HIWORD(wParam);
05448                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a259">abs</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o19">WheelDelta</a>) &gt;= WHEEL_DELTA &amp;&amp;
05449                         <a class="code" href="../../d6/d2/output_8c.html#a27">gucWheelScrollLines</a> &gt; 0) {
05450 
05451                     COORD   NewOrigin;
05452                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>   dy;
05453 
05454                     NewOrigin.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
05455                     NewOrigin.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
05456 
05457                     <span class="comment">/*</span>
05458 <span class="comment">                     * Limit a roll of one (1) WHEEL_DELTA to scroll one (1) page.</span>
05459 <span class="comment">                     * If in shift scroll mode then scroll one page at a time regardless.</span>
05460 <span class="comment">                     */</span>
05461 
05462                     <span class="keywordflow">if</span> (!(wParam &amp; MK_SHIFT))
05463                         dy = (<span class="keywordtype">int</span>) <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(
05464                                 (UINT) <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) - 1,
05465                                 gucWheelScrollLines);
05466                     <span class="keywordflow">else</span>
05467                         dy = <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) - 1;
05468 
05469                     <span class="keywordflow">if</span> (dy == 0) {
05470                         dy++;
05471                     }
05472 
05473                     dy *= (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o19">WheelDelta</a> / WHEEL_DELTA);
05474                     ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o19">WheelDelta</a> %= WHEEL_DELTA;
05475 
05476                     NewOrigin.Y += dy;
05477                     <span class="keywordflow">if</span> (NewOrigin.Y &lt; 0) {
05478                         NewOrigin.Y = 0;
05479                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewOrigin.Y + <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) &gt;
05480                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
05481                         NewOrigin.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y -
05482                                 <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
05483                     }
05484 
05485                     <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo, TRUE, NewOrigin);
05486                 }
05487                 <span class="keywordflow">break</span>;
05488 
05489             <span class="keywordflow">case</span> WM_PALETTECHANGED:
05490                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
05491                     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05492                         <a class="code" href="../../d7/d4/server_2private_8c.html#a46">SetActivePalette</a>(ScreenInfo);
05493                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) {
05494                             <a class="code" href="../../d8/d5/consrv_8h.html#a274">WriteRegionToScreenBitMap</a>(ScreenInfo,
05495                                                       &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
05496                         }
05497                     } <span class="keywordflow">else</span> {
05498                         <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(ScreenInfo, ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>,
05499                                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o9">PopupAttributes</a>, TRUE);
05500                     }
05501                 }
05502                 <span class="keywordflow">break</span>;
05503 <span class="preprocessor">#if defined(_X86_)</span>
05504 <span class="preprocessor"></span>            <span class="keywordflow">case</span> WM_FULLSCREEN:
05505 
05506                 <span class="comment">//</span>
05507                 <span class="comment">// This message is sent by the system to tell console that</span>
05508                 <span class="comment">// the fullscreen state of a window has changed.</span>
05509                 <span class="comment">// In some cases, this message will be sent in response to</span>
05510                 <span class="comment">// a call from console to change to fullscreen (Atl-Enter)</span>
05511                 <span class="comment">// or may also come directly from the system (switch of</span>
05512                 <span class="comment">// focus from a windowed app to a fullscreen app).</span>
05513                 <span class="comment">//</span>
05514 
05515                 KdPrint((<span class="stringliteral">"CONSRV: WindowProc - WM_FULLSCREEN\n"</span>));
05516 
05517                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d4/server_2private_8c.html#a54">DisplayModeTransition</a>(wParam,Console,ScreenInfo);
05518 <span class="preprocessor">#if defined(FE_IME)</span>
05519 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
05520                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ImeWmFullScreen(wParam,Console,ScreenInfo);
05521                 }
05522 <span class="preprocessor">#endif // FE_IME</span>
05523 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
05524 <span class="preprocessor">#endif</span>
05525 <span class="preprocessor"></span>            <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a69">CM_SET_WINDOW_SIZE</a>:
05526                 <span class="keywordflow">if</span> (lParam == 0x47474747) {
05527                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a70">InternalSetWindowSize</a>(Console,
05528                                                    (<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>)wParam,
05529                                                    &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>
05530                                                    );
05531                 }
05532                 <span class="keywordflow">break</span>;
05533             <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a70">CM_BEEP</a>:
05534                 <span class="keywordflow">if</span> (lParam == 0x47474747) {
05535                     Beep(800, 200);
05536                 }
05537                 <span class="keywordflow">break</span>;
05538             <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a71">CM_UPDATE_SCROLL_BARS</a>:
05539                 <a class="code" href="../../d6/d2/output_8c.html#a37">InternalUpdateScrollBars</a>(ScreenInfo);
05540                 <span class="keywordflow">break</span>;
05541             <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a72">CM_UPDATE_TITLE</a>:
05542                 <a class="code" href="../../d5/d9/cltxt_8h.html#a23">SetWindowText</a>(hWnd,Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>);
05543                 <span class="keywordflow">break</span>;
05544             <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a76">CM_CONSOLE_MSG</a>:
05545                 <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d2/output_8c.html#a77">UnqueueConsoleMessage</a>(Console, &amp;Message, &amp;wParam, &amp;lParam)) {
05546                     <span class="keywordflow">break</span>;
05547                 }
05548                 <span class="keywordflow">switch</span> (Message) {
05549 <span class="preprocessor">#if defined(_X86_)</span>
05550 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a73">CM_MODE_TRANSITION</a>:
05551 
05552                     KdPrint((<span class="stringliteral">"CONSRV: WindowProc - CM_MODE_TRANSITION\n"</span>));
05553 
05554                     <span class="keywordflow">if</span> (wParam == FULLSCREEN) {
05555                         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
05556                             <a class="code" href="../../d7/d4/server_2private_8c.html#a48">ConvertToFullScreen</a>(Console);
05557                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> |= CONSOLE_FULLSCREEN;
05558                             <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, hWnd, CDS_FULLSCREEN);
05559                         }
05560                     } <span class="keywordflow">else</span> {
05561                         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
05562                             <a class="code" href="../../d7/d4/server_2private_8c.html#a49">ConvertToWindowed</a>(Console);
05563                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp;= ~CONSOLE_FULLSCREEN;
05564                             <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, hWnd, 0);
05565 
05566                             <a class="code" href="../../d3/d0/user32_8def.html#a32">ShowWindow</a>(hWnd, SW_RESTORE);
05567                         }
05568                     }
05569 
05570                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
05571                     Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05572 
05573                     <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)lParam, NULL);
05574                     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)lParam);
05575                     <span class="keywordflow">break</span>;
05576 <span class="preprocessor">#endif</span>
05577 <span class="preprocessor"></span><span class="preprocessor">#if defined (FE_IME)</span>
05578 <span class="preprocessor"></span>                <span class="keywordflow">case</span> CM_SET_IME_CODEPAGE: {
05579                     <span class="keywordflow">if</span> (! LOWORD(lParam))
05580                     {
05581                         <span class="comment">// Input code page</span>
05582                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = SetImeCodePage(Console);
05583                     }
05584                     <span class="keywordflow">else</span>
05585                     {
05586                         <span class="comment">// Output code page</span>
05587                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = SetImeOutputCodePage(Console, ScreenInfo, HIWORD(lParam));
05588                     }
05589 
05590                     <span class="keywordflow">if</span> (wParam) {
05591                         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)wParam, NULL);
05592                         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)wParam);
05593                     }
05594                     <span class="keywordflow">break</span>;
05595                 }
05596                 <span class="keywordflow">case</span> CM_SET_NLSMODE:
05597                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = SetImeKeyState(Console, <a class="code" href="../../d0/d3/dbcs_8h.html#a55">ImmConversionFromConsole</a>((DWORD)lParam));
05598                     <span class="keywordflow">if</span> (wParam) {
05599                         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)wParam, NULL);
05600                         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)wParam);
05601                     }
05602                     <span class="keywordflow">break</span>;
05603                 <span class="keywordflow">case</span> CM_GET_NLSMODE:
05604                     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o75">InputThreadInfo</a>-&gt;hWndConsoleIME)
05605                     {
05606                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>());
05607 
05608                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(GetImeKeyState(Console, NULL))) {
05609                             <span class="keywordflow">if</span> (wParam) {
05610                                 <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)wParam, NULL);
05611                                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)wParam);
05612                             }
05613                             <span class="keywordflow">break</span>;
05614                         }
05615                         <span class="keywordflow">if</span> (wParam) {
05616                             <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)wParam, NULL);
05617                             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)wParam);
05618                         }
05619                     }
05620                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lParam &lt; 10)
05621                     {
05622                         <span class="comment">/*</span>
05623 <span class="comment">                         * try get conversion mode until ready ConIME.</span>
05624 <span class="comment">                         */</span>
05625                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a76">QueueConsoleMessage</a>(Console,
05626                                     CM_GET_NLSMODE,
05627                                     wParam,
05628                                     lParam+1
05629                                    );
05630                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
05631                             <span class="keywordflow">if</span> (wParam) {
05632                                 <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)wParam, NULL);
05633                                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)wParam);
05634                             }
05635                         }
05636                     }
05637                     <span class="keywordflow">else</span>
05638                     {
05639                         <span class="keywordflow">if</span> (wParam) {
05640                             <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>((HANDLE)wParam, NULL);
05641                             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>((HANDLE)wParam);
05642                         }
05643                     }
05644                     <span class="keywordflow">break</span>;
05645 <span class="preprocessor">#endif // FE_IME</span>
05646 <span class="preprocessor"></span>                }
05647                 <span class="keywordflow">break</span>;
05648 
05649             <span class="keywordflow">case</span> <a class="code" href="../../d1/d7/server_8h.html#a75">CM_HIDE_WINDOW</a>:
05650                 ShowWindowAsync(hWnd, SW_MINIMIZE);
05651                 <span class="keywordflow">break</span>;
05652             <span class="keywordflow">case</span> CM_PROPERTIES_START:
05653                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o74">hWndProperties</a> = (HWND)wParam;
05654                 <span class="keywordflow">break</span>;
05655             <span class="keywordflow">case</span> CM_PROPERTIES_UPDATE:
05656                 <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a5">PropertiesUpdate</a>(Console, (HANDLE)wParam);
05657                 <span class="keywordflow">break</span>;
05658             <span class="keywordflow">case</span> CM_PROPERTIES_END:
05659                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o74">hWndProperties</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05660                 <span class="keywordflow">break</span>;
05661 <span class="preprocessor">#if defined(FE_IME)</span>
05662 <span class="preprocessor"></span>            <span class="keywordflow">case</span> WM_COPYDATA:
05663                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>() &amp;&amp; CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
05664                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ImeControl(Console,(HWND)wParam,(PCOPYDATASTRUCT)lParam);
05665                 }
05666                 <span class="keywordflow">break</span>;
05667 <span class="comment">// v-HirShi Sep.18.1995 Support Console IME</span>
05668             <span class="keywordflow">case</span> WM_ENTERMENULOOP:
05669                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
05670                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.ImeMode.Unavailable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05671                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
05672                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
05673                                               CONIME_KILLFOCUS,
05674                                               (WPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
05675                                               (LPARAM)NULL
05676                                              ))) {
05677                             <span class="keywordflow">break</span>;
05678                         }
05679                     }
05680                 }
05681                 <span class="keywordflow">break</span>;
05682 
05683             <span class="keywordflow">case</span> WM_EXITMENULOOP:
05684                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
05685                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
05686                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
05687                                               CONIME_SETFOCUS,
05688                                               (WPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>,
05689                                               (LPARAM)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>
05690                                              ))) {
05691                             <span class="keywordflow">break</span>;
05692                         }
05693                     }
05694                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.ImeMode.Unavailable = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05695                 }
05696                 <span class="keywordflow">break</span>;
05697 
05698             <span class="keywordflow">case</span> WM_ENTERSIZEMOVE:
05699                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
05700                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.ImeMode.Unavailable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05701                 }
05702                 <span class="keywordflow">break</span>;
05703 
05704             <span class="keywordflow">case</span> WM_EXITSIZEMOVE:
05705                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
05706                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.ImeMode.Unavailable = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05707                 }
05708                 <span class="keywordflow">break</span>;
05709 <span class="preprocessor">#endif // FE_IME</span>
05710 <span class="preprocessor"></span>CallDefWin:
05711             <span class="keywordflow">default</span>:
05712                 <span class="keywordflow">if</span> (Console != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05713                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
05714                     Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05715                 }
05716                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d5/d9/cltxt_8h.html#a15">DefWindowProc</a>(hWnd,Message,wParam,lParam));
05717                 <span class="keywordflow">break</span>;
05718             }
05719         }
05720     } finally {
05721         <span class="keywordflow">if</span> (Console != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05722             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
05723             Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05724         }
05725     }
05726 
05727     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
05728 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a172" doxytag="consrv.h::ConvertInputToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertInputToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">1345</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00576">RtlOemToUnicodeN()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>.
<p>
<pre class="fragment"><div>01355 {
01356     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertInputToUnicode %d-&gt;U %.*s\n"</span>, Codepage,
01357             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01358     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01359         ULONG Length;
01360         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01361 
01362         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a34">RtlOemToUnicodeN</a>(Target,
01363                                   TargetLength * <span class="keyword">sizeof</span>(WCHAR),
01364                                   &amp;Length,
01365                                   Source,
01366                                   SourceLength
01367                                  );
01368         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01369             <span class="keywordflow">return</span> 0;
01370         } <span class="keywordflow">else</span> {
01371             <span class="keywordflow">return</span> Length / <span class="keyword">sizeof</span>(WCHAR);
01372         }
01373     } <span class="keywordflow">else</span> {
01374         <span class="keywordflow">return</span> MultiByteToWideChar(Codepage,
01375                                    0,
01376                                    Source,
01377                                    SourceLength,
01378                                    Target,
01379                                    TargetLength);
01380     }
01381 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a177" doxytag="consrv.h::ConvertOutputToOem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertOutputToOem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">1508</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, and <a class="el" href="../../d4/d9/w32_2ntcon_2fullscr_2vga_2misc_8c-source.html#l00086">TranslateOutputToOem()</a>.
<p>
<pre class="fragment"><div>01521 {
01522     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01523         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01524         ULONG Length;
01525         <span class="comment">// Can do this in place</span>
01526         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(Target,
01527                                   TargetLength,
01528                                   &amp;Length,
01529                                   Source,
01530                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01531                                  );
01532         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01533             <span class="keywordflow">return</span> Length;
01534         } <span class="keywordflow">else</span> {
01535             <span class="keywordflow">return</span> 0;
01536         }
01537     } <span class="keywordflow">else</span> {
01538         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Source != (LPWSTR)Target);
01539 <span class="preprocessor">#ifdef SOURCE_EQ_TARGET</span>
01540 <span class="preprocessor"></span>        LPSTR pszDestTmp;
01541         <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01542 
01543         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertOutputToOem U-&gt;%d %.*ls\n"</span>, Codepage,
01544                 SourceLength &gt; 10 ? 10 : SourceLength, Source));
01545 
01546         <span class="keywordflow">if</span> (TargetLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01547             pszDestTmp = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TargetLength);
01548             <span class="keywordflow">if</span> (pszDestTmp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01549                 <span class="keywordflow">return</span> 0;
01550             }
01551         } <span class="keywordflow">else</span> {
01552             pszDestTmp = StackBuffer;
01553         }
01554         TargetLength = WideCharToMultiByte(Codepage, 0,
01555                 Source, SourceLength,
01556                 pszDestTmp, TargetLength, NULL, NULL);
01557 
01558         RtlCopyMemory(Target, pszDestTmp, TargetLength);
01559         <span class="keywordflow">if</span> (pszDestTmp != StackBuffer) {
01560             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pszDestTmp);
01561         }
01562         <span class="keywordflow">return</span> TargetLength;
01563 <span class="preprocessor">#else</span>
01564 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertOutputToOem U-&gt;%d %.*ls\n"</span>, Codepage,
01565                 SourceLength &gt; 10 ? 10 : SourceLength, Source));
01566         <span class="keywordflow">return</span> WideCharToMultiByte(Codepage, 0,
01567                 Source, SourceLength, Target, TargetLength, NULL, NULL);
01568 <span class="preprocessor">#endif</span>
01569 <span class="preprocessor"></span>    }
01570 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a176" doxytag="consrv.h::ConvertOutputToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertOutputToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">1384</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01757">RtlCustomCPToUnicodeN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>.
<p>
<pre class="fragment"><div>01396 {
01397     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01398     ULONG Length;
01399     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01400     LPSTR pszT;
01401 
01402     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertOutputToUnicode %d-&gt;U %.*s\n"</span>, Codepage,
01403             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01404     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01405         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a42">RtlCustomCPToUnicodeN</a>(&amp;GlyphCP,
01406                            Target,
01407                            TargetLength * <span class="keyword">sizeof</span>(WCHAR),
01408                            &amp;Length,
01409                            Source,
01410                            SourceLength
01411                           );
01412         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01413             <span class="keywordflow">return</span> 0;
01414         } <span class="keywordflow">else</span> {
01415             <span class="keywordflow">return</span> Length / <span class="keyword">sizeof</span>(WCHAR);
01416         }
01417     }
01418 
01419     <span class="keywordflow">if</span> (TargetLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01420         pszT = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),SourceLength);
01421         <span class="keywordflow">if</span> (pszT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01422             <span class="keywordflow">return</span> 0;
01423         }
01424     } <span class="keywordflow">else</span> {
01425         pszT = StackBuffer;
01426     }
01427     RtlCopyMemory(pszT, Source, SourceLength);
01428     Length = MultiByteToWideChar(Codepage, MB_USEGLYPHCHARS,
01429             pszT, SourceLength, Target, TargetLength);
01430     <span class="keywordflow">if</span> (pszT != StackBuffer) {
01431         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pszT);
01432     }
01433     <span class="keywordflow">return</span> Length;
01434 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a310" doxytag="consrv.h::ConvertToMouseSelect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ConvertToMouseSelect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>MousePosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">390</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00125">CONSOLE_MOUSE_DOWN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00032">msgMarkMode</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00361">SetCapture</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.
<p>
<pre class="fragment"><div>00401 {
00402     Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a> | <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>;
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// undo key selection</span>
00406     <span class="comment">//</span>
00407 
00408     <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a4">CancelKeySelection</a>(Console,TRUE);
00409 
00410     Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
00411 
00412     <span class="comment">//</span>
00413     <span class="comment">// invert new selection</span>
00414     <span class="comment">//</span>
00415 
00416     Console-&gt;SelectionAnchor = MousePosition;
00417     Console-&gt;SelectionRect.Left =Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
00418     Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
00419     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00420 
00421     <span class="comment">//</span>
00422     <span class="comment">// update title bar</span>
00423     <span class="comment">//</span>
00424 
00425     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgMarkMode,FALSE);
00426     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,TRUE);
00427 
00428     <span class="comment">//</span>
00429     <span class="comment">// capture mouse movement</span>
00430     <span class="comment">//</span>
00431 
00432     <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
00433 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a171" doxytag="consrv.h::ConvertToOem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertToOem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">1307</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">SrvGetConsoleAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">SrvGetConsoleAliasExes()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">SrvGetConsoleCommandHistory()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04879">SrvGetConsoleTitle()</a>.
<p>
<pre class="fragment"><div>01314 {
01315     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertToOem U-&gt;%d %.*ls\n"</span>, Codepage,
01316             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01317     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01318         ULONG Length;
01319         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01320 
01321         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(Target,
01322                                   TargetLength,
01323                                   &amp;Length,
01324                                   Source,
01325                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01326                                  );
01327         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01328             <span class="keywordflow">return</span> 0;
01329         } <span class="keywordflow">else</span> {
01330             <span class="keywordflow">return</span> Length;
01331         }
01332     } <span class="keywordflow">else</span> {
01333         <span class="keywordflow">return</span> WideCharToMultiByte(Codepage,
01334                                    0,
01335                                    Source,
01336                                    SourceLength,
01337                                    Target,
01338                                    TargetLength,
01339                                    NULL,
01340                                    NULL);
01341     }
01342 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a220" doxytag="consrv.h::CookedRead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CookedRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">1237</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00079">_INPUT_READ_HANDLE_DATA::BufPtr</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00077">_INPUT_READ_HANDLE_DATA::BytesAvailable</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00392">CONSOLE_FROMTHREADPERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00105">CONSOLE_HISTORY_NODUP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00102">CONSOLE_IGNORE_NEXT_KEYUP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00351">CONSOLE_STATUS_READ_COMPLETE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00352">CONSOLE_STATUS_WAIT_NO_BLOCK</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00446">_CONSOLE_READCONSOLE_MSG::ControlKeyState</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00078">_INPUT_READ_HANDLE_DATA::CurrentBufPtr</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00307">HANDLE_INPUT_PENDING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00308">HANDLE_MULTI_LINE_INPUT</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00066">_INPUT_READ_HANDLE_DATA::InputHandleFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00442">_CONSOLE_READCONSOLE_MSG::NumBytes</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00876">ProcessCookedReadInput()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a53">TranslateUnicodeToOem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00447">_CONSOLE_READCONSOLE_MSG::Unicode</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00248">WaitForMoreToRead()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>.
<p>
<pre class="fragment"><div>01243 {
01244     WCHAR Char;
01245     BOOLEAN CommandLineEditingKeys,EnableScrollMode;
01246     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> KeyState;
01247     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>=STATUS_SUCCESS;
01248     <a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a> a;
01249     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01250 <span class="preprocessor">#ifdef FE_SB</span>
01251 <span class="preprocessor"></span>    <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumBytes;
01252     ULONG NumToWrite;
01253     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01254 <span class="preprocessor">#endif</span>
01255 <span class="preprocessor"></span>
01256     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(CookedReadData-&gt;ProcessData,
01257                                         CookedReadData-&gt;HandleIndex,
01258                                         &amp;HandleData
01259                                        );
01260     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01261     a = (<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a>)&amp;WaitReplyMessage-&gt;u.ApiMessageData;
01262     <span class="keywordflow">while</span> (CookedReadData-&gt;BytesRead &lt; CookedReadData-&gt;BufferSize) {
01263 
01264         <span class="comment">//</span>
01265         <span class="comment">// this call to GetChar may block.</span>
01266         <span class="comment">//</span>
01267 
01268         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(CookedReadData-&gt;InputInfo,
01269                          &amp;Char,
01270                          TRUE,
01271                          CookedReadData-&gt;Console,
01272                          HandleData,
01273                          WaitReplyMessage,
01274                          CookedReadWaitRoutine,
01275                          CookedReadData,
01276                          <span class="keyword">sizeof</span>(*CookedReadData),
01277                          WaitRoutine,
01278                          &amp;CommandLineEditingKeys,
01279                          NULL,
01280                          &amp;EnableScrollMode,
01281                          &amp;KeyState
01282                         );
01283         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01284             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
01285                 CookedReadData-&gt;BytesRead = 0;
01286             }
01287             <span class="keywordflow">break</span>;
01288         }
01289 
01290         <span class="comment">//</span>
01291         <span class="comment">// we should probably set these up in GetChars, but we set them</span>
01292         <span class="comment">// up here because the debugger is multi-threaded and calls</span>
01293         <span class="comment">// read before outputting the prompt.</span>
01294         <span class="comment">//</span>
01295 
01296         <span class="keywordflow">if</span> (CookedReadData-&gt;OriginalCursorPosition.X == -1) {
01297             CookedReadData-&gt;OriginalCursorPosition = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
01298         }
01299 
01300         <span class="keywordflow">if</span> (CommandLineEditingKeys) {
01301             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a40">ProcessCommandLine</a>(CookedReadData,Char,KeyState,WaitReplyMessage,WaitingThread,WaitRoutine);
01302             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a> ||
01303                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
01304                 <span class="keywordflow">break</span>;
01305             }
01306             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01307                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a66">CONSOLE_STATUS_WAIT_NO_BLOCK</a>) {
01308                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>;
01309                     <span class="keywordflow">if</span> (!WaitRoutine) {
01310                         <span class="comment">//</span>
01311                         <span class="comment">// we have no wait block, so create one.</span>
01312                         <span class="comment">//</span>
01313                         <a class="code" href="../../d0/d7/server_2stream_8c.html#a14">WaitForMoreToRead</a>(CookedReadData-&gt;InputInfo,
01314                                           WaitReplyMessage,
01315                                           CookedReadWaitRoutine,
01316                                           CookedReadData,
01317                                           <span class="keyword">sizeof</span>(*CookedReadData),
01318                                           FALSE
01319                                          );
01320                     }
01321                 } <span class="keywordflow">else</span> {
01322                     CookedReadData-&gt;BytesRead = 0;
01323                 }
01324                 <span class="keywordflow">break</span>;
01325             }
01326         } <span class="keywordflow">else</span> {
01327             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/server_2stream_8c.html#a23">ProcessCookedReadInput</a>(CookedReadData,
01328                                        Char,
01329                                        KeyState,
01330                                        &amp;Status
01331                                       )) {
01332                 CookedReadData-&gt;Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a17">CONSOLE_IGNORE_NEXT_KEYUP</a>;
01333                 <span class="keywordflow">break</span>;
01334             }
01335         }
01336     }
01337 
01338     <span class="comment">//</span>
01339     <span class="comment">// if the read was completed (status != wait), free the cooked read</span>
01340     <span class="comment">// data.  also, close the temporary output handle that was opened to</span>
01341     <span class="comment">// echo the characters read.</span>
01342     <span class="comment">//</span>
01343 
01344     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
01345 
01346         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LineCount=1;
01347         <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
01348             BOOLEAN FoundCR;
01349             ULONG i,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
01350             PWCHAR StringPtr;
01351 
01352             <span class="comment">// figure out where real string ends (at carriage return</span>
01353             <span class="comment">// or end of buffer)</span>
01354 
01355             StringPtr = CookedReadData-&gt;BackupLimit;
01356             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = CookedReadData-&gt;BytesRead;
01357             FoundCR = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01358             <span class="keywordflow">for</span> (i=0;i&lt;(CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR));i++) {
01359                 <span class="keywordflow">if</span> (*StringPtr++ == <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>) {
01360                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = i*<span class="keyword">sizeof</span>(WCHAR);
01361                     FoundCR = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01362                     <span class="keywordflow">break</span>;
01363                 }
01364             }
01365 
01366             <span class="keywordflow">if</span> (FoundCR) {
01367                 <span class="comment">//</span>
01368                 <span class="comment">// add to command line recall list</span>
01369                 <span class="comment">//</span>
01370 
01371                 <a class="code" href="../../d8/d5/consrv_8h.html#a252">AddCommand</a>(CookedReadData-&gt;CommandHistory,CookedReadData-&gt;BackupLimit,(USHORT)StringLength,CookedReadData-&gt;Console-&gt;Flags &amp; CONSOLE_HISTORY_NODUP);
01372 
01373                 <span class="comment">//</span>
01374                 <span class="comment">// check for alias</span>
01375                 <span class="comment">//</span>
01376 
01377                 i = CookedReadData-&gt;BufferSize;
01378                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a251">MatchandCopyAlias</a>(CookedReadData-&gt;Console,
01379                                                  CookedReadData-&gt;BackupLimit,
01380                                                  (USHORT)StringLength,
01381                                                  CookedReadData-&gt;BackupLimit,
01382                                                  (PUSHORT)&amp;i,
01383                                                  CookedReadData-&gt;ExeName,
01384                                                  CookedReadData-&gt;ExeNameLength,
01385                                                  &amp;LineCount
01386                                                 ))) {
01387                   CookedReadData-&gt;BytesRead = i;
01388                 }
01389             }
01390 
01391             <a class="code" href="../../d0/d7/server_2stream_8c.html#a36">CloseOutputHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a83">CONSOLE_FROMTHREADPERPROCESSDATA</a>(WaitingThread),
01392                               CookedReadData-&gt;Console,
01393                               &amp;CookedReadData-&gt;TempHandle,
01394                               NULL,
01395                               FALSE
01396                              );
01397         }
01398         WaitReplyMessage-&gt;ReturnValue = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01399 
01400         <span class="comment">//</span>
01401         <span class="comment">// at this point, a-&gt;NumBytes contains the number of bytes in</span>
01402         <span class="comment">// the UNICODE string read.  UserBufferSize contains the converted</span>
01403         <span class="comment">// size of the app's buffer.</span>
01404         <span class="comment">//</span>
01405 
01406         <span class="keywordflow">if</span> (CookedReadData-&gt;BytesRead &gt; CookedReadData-&gt;UserBufferSize || LineCount &gt; 1) {
01407             <span class="keywordflow">if</span> (LineCount &gt; 1) {
01408                 PWSTR Tmp;
01409                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o2">InputHandleFlags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a53">HANDLE_MULTI_LINE_INPUT</a>;
01410 <span class="preprocessor">#ifdef FE_SB</span>
01411 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a> &amp;&amp; CONSOLE_IS_DBCS_CP(CookedReadData-&gt;Console)) {
01412                     <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
01413                         fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01414                         *CookedReadData-&gt;UserBuffer++ = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar;
01415                         CookedReadData-&gt;UserBufferSize-=<span class="keyword">sizeof</span>(WCHAR);
01416                         RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
01417                     }
01418                     NumBytes = 0;
01419                     <span class="keywordflow">for</span> (Tmp=CookedReadData-&gt;BackupLimit;
01420                          *Tmp!=<a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a> &amp;&amp; CookedReadData-&gt;UserBufferSize/<span class="keyword">sizeof</span>(WCHAR) &gt; NumBytes;
01421                          (IsConsoleFullWidth(CookedReadData-&gt;Console-&gt;hDC,
01422                                              CookedReadData-&gt;Console-&gt;CP,*Tmp) ? NumBytes+=2 : NumBytes++),Tmp++) ;
01423                 }
01424 <span class="preprocessor">#endif</span>
01425 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (Tmp=CookedReadData-&gt;BackupLimit;*Tmp!=<a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;Tmp++)
01426                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Tmp&lt;(CookedReadData-&gt;BackupLimit+CookedReadData-&gt;BytesRead));
01427                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = (ULONG)(Tmp-CookedReadData-&gt;BackupLimit+1)*<span class="keyword">sizeof</span>(*Tmp);
01428             } <span class="keywordflow">else</span> {
01429 <span class="preprocessor">#ifdef FE_SB</span>
01430 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a> &amp;&amp; CONSOLE_IS_DBCS_CP(CookedReadData-&gt;Console)) {
01431                     PWSTR Tmp;
01432 
01433                     <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
01434                         fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01435                         *CookedReadData-&gt;UserBuffer++ = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar;
01436                         CookedReadData-&gt;UserBufferSize-=<span class="keyword">sizeof</span>(WCHAR);
01437                         RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
01438                     }
01439                     NumBytes = 0;
01440                     NumToWrite = CookedReadData-&gt;BytesRead;
01441                     <span class="keywordflow">for</span> (Tmp=CookedReadData-&gt;BackupLimit;
01442                          NumToWrite &amp;&amp; CookedReadData-&gt;UserBufferSize/<span class="keyword">sizeof</span>(WCHAR) &gt; NumBytes;
01443                          (IsConsoleFullWidth(CookedReadData-&gt;Console-&gt;hDC,
01444                                              CookedReadData-&gt;Console-&gt;CP,*Tmp) ? NumBytes+=2 : NumBytes++),Tmp++,NumToWrite-=<span class="keyword">sizeof</span>(WCHAR)) ;
01445                 }
01446 <span class="preprocessor">#endif</span>
01447 <span class="preprocessor"></span>                a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = CookedReadData-&gt;UserBufferSize;
01448             }
01449             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o2">InputHandleFlags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a>;
01450             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o5">BufPtr</a> = CookedReadData-&gt;BackupLimit;
01451             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o3">BytesAvailable</a> = CookedReadData-&gt;BytesRead - a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>;
01452             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o4">CurrentBufPtr</a>=(PWCHAR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)CookedReadData-&gt;BackupLimit+a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
01453             RtlCopyMemory(CookedReadData-&gt;UserBuffer,CookedReadData-&gt;BackupLimit,a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
01454         }
01455         <span class="keywordflow">else</span> {
01456 <span class="preprocessor">#ifdef FE_SB</span>
01457 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a> &amp;&amp; CONSOLE_IS_DBCS_CP(CookedReadData-&gt;Console)) {
01458                 PWSTR Tmp;
01459 
01460                 <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
01461                     fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01462                     *CookedReadData-&gt;UserBuffer++ = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar;
01463                     CookedReadData-&gt;UserBufferSize-=<span class="keyword">sizeof</span>(WCHAR);
01464                     RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
01465 
01466                     <span class="keywordflow">if</span> (CookedReadData-&gt;UserBufferSize == 0) {
01467                         a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = 1;
01468                         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CookedReadData-&gt;BackupLimit);
01469                         <span class="keywordflow">return</span> STATUS_SUCCESS;
01470                     }
01471                 }
01472                 NumBytes = 0;
01473                 NumToWrite = CookedReadData-&gt;BytesRead;
01474                 <span class="keywordflow">for</span> (Tmp=CookedReadData-&gt;BackupLimit;
01475                      NumToWrite &amp;&amp; CookedReadData-&gt;UserBufferSize/<span class="keyword">sizeof</span>(WCHAR) &gt; NumBytes;
01476                      (IsConsoleFullWidth(CookedReadData-&gt;Console-&gt;hDC,
01477                                          CookedReadData-&gt;Console-&gt;CP,*Tmp) ? NumBytes+=2 : NumBytes++),Tmp++,NumToWrite-=<span class="keyword">sizeof</span>(WCHAR)) ;
01478             }
01479 <span class="preprocessor">#endif</span>
01480 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = CookedReadData-&gt;BytesRead;
01481             RtlCopyMemory(CookedReadData-&gt;UserBuffer,CookedReadData-&gt;BackupLimit,a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
01482             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CookedReadData-&gt;BackupLimit);
01483         }
01484         a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o9">ControlKeyState</a> = CookedReadData-&gt;ControlKeyState;
01485 
01486         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a>) {
01487 
01488             <span class="comment">//</span>
01489             <span class="comment">// if ansi, translate string.</span>
01490             <span class="comment">//</span>
01491 
01492             PCHAR TransBuffer;
01493 
01494 <span class="preprocessor">#ifdef FE_SB</span>
01495 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(CookedReadData-&gt;Console))
01496                 TransBuffer = (PCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),NumBytes);
01497             <span class="keywordflow">else</span>
01498 <span class="preprocessor">#endif</span>
01499 <span class="preprocessor"></span>            TransBuffer = (PCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> / <span class="keyword">sizeof</span>(WCHAR));
01500             <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01501                 <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01502             }
01503 
01504 <span class="preprocessor">#ifdef FE_SB</span>
01505 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(CookedReadData-&gt;Console))
01506             {
01507                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = <a class="code" href="../../d0/d3/dbcs_8h.html#a53">TranslateUnicodeToOem</a>(CookedReadData-&gt;Console,
01508                                                     CookedReadData-&gt;UserBuffer,
01509                                                     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> / sizeof (WCHAR),
01510                                                     TransBuffer,
01511                                                     NumBytes,
01512                                                     &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte);
01513             }
01514             <span class="keywordflow">else</span>
01515 <span class="preprocessor">#endif</span>
01516 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(CookedReadData-&gt;Console-&gt;CP,
01517                                  CookedReadData-&gt;UserBuffer,
01518                                  a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> / sizeof (WCHAR),
01519                                  TransBuffer,
01520                                  a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> / sizeof (WCHAR)
01521                                  );
01522             RtlCopyMemory(CookedReadData-&gt;UserBuffer,TransBuffer,a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
01523 <span class="preprocessor">#ifdef FE_SB</span>
01524 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (fAddDbcsLead)
01525                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>++;
01526 <span class="preprocessor">#endif</span>
01527 <span class="preprocessor"></span>            <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
01528         }
01529         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CookedReadData-&gt;ExeName);
01530         <span class="keywordflow">if</span> (WaitRoutine) {
01531 <span class="preprocessor">#ifdef FE_SB</span>
01532 <span class="preprocessor"></span>            CookedReadData-&gt;Console-&gt;lpCookedReadData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01533 <span class="preprocessor">#endif</span>
01534 <span class="preprocessor"></span>            <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CookedReadData);
01535         }
01536     }
01537     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01538 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a273" doxytag="consrv.h::CreateConsoleBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CreateConsoleBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCONSOLE_GRAPHICS_BUFFER_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>GraphicsInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBitmap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>hMutex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00027">27</a> of file <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html">w32/ntcon/server/bitmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00063">BMP_TAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00874">MapHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00156">NtCreateMutant()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00134">NtCreateSection()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00199">NtMapViewOfSection()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00033">NtUnmapViewOfSection()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00033 {
00034     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00035     LARGE_INTEGER MaximumSize;
00036     SIZE_T ViewSize;
00037 
00038     <span class="comment">//</span>
00039     <span class="comment">// adjust bitmap info</span>
00040     <span class="comment">//</span>
00041 
00042 
00043     <span class="keywordflow">if</span> (GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biHeight &gt; 0)
00044     {
00045 <span class="preprocessor">#if DBG</span>
00046 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"*************** Negating biHeight\n"</span>);
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>        GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biHeight =
00049             -GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biHeight;
00050     }
00051 
00052     <span class="keywordflow">if</span> (GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biCompression != BI_RGB)
00053     {
00054 <span class="preprocessor">#if DBG</span>
00055 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"*************** setting Compression to BI_RGB)\n"</span>);
00056 <span class="preprocessor">#endif</span>
00057 <span class="preprocessor"></span>        GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biCompression = BI_RGB;
00058     }
00059 
00060     <span class="comment">//</span>
00061     <span class="comment">// allocate screeninfo buffer data and copy it</span>
00062     <span class="comment">//</span>
00063 
00064     ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo = (LPBITMAPINFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( BMP_TAG ),GraphicsInfo-&gt;dwBitMapInfoLength);
00065     <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00066         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00067     }
00068     ScreenInfo-&gt;BufferInfo.GraphicsInfo.BitMapInfoLength = GraphicsInfo-&gt;dwBitMapInfoLength;
00069     RtlCopyMemory(ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo,
00070            GraphicsInfo-&gt;lpBitMapInfo,
00071            GraphicsInfo-&gt;dwBitMapInfoLength
00072           );
00073     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biWidth *
00074             -GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biHeight / 8 *
00075             GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biBitCount) ==
00076            (LONG)GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biSizeImage);
00077 
00078     <span class="comment">//</span>
00079     <span class="comment">// create bitmap section</span>
00080     <span class="comment">//</span>
00081 
00082     MaximumSize.QuadPart = GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biSizeImage;
00083     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/creasect_8c.html#a19">NtCreateSection</a>(&amp;ScreenInfo-&gt;BufferInfo.GraphicsInfo.hSection,
00084                              SECTION_ALL_ACCESS,
00085                              NULL,
00086                              &amp;MaximumSize,
00087                              PAGE_READWRITE,
00088                              SEC_COMMIT,
00089                              NULL
00090                             );
00091     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00092         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo);
00093         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00094     }
00095 
00096     <span class="comment">//</span>
00097     <span class="comment">// map server view of section</span>
00098     <span class="comment">//</span>
00099 
00100     ViewSize = GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biSizeImage;
00101     ScreenInfo-&gt;BufferInfo.GraphicsInfo.BitMap = 0;
00102     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d5/mapview_8c.html#a20">NtMapViewOfSection</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.hSection,
00103                                 NtCurrentProcess(),
00104                                 &amp;ScreenInfo-&gt;BufferInfo.GraphicsInfo.BitMap,
00105                                 0L,
00106                                 GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biSizeImage,
00107                                 NULL,
00108                                 &amp;ViewSize,
00109                                 ViewUnmap,
00110                                 0L,
00111                                 PAGE_READWRITE
00112                                );
00113     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00114         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo);
00115         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.hSection);
00116         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00117     }
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// map client view of section</span>
00121     <span class="comment">//</span>
00122 
00123     ViewSize = GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biSizeImage;
00124     *lpBitmap = 0;
00125     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d5/mapview_8c.html#a20">NtMapViewOfSection</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.hSection,
00126                                 <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
00127                                 lpBitmap,
00128                                 0L,
00129                                 GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biSizeImage,
00130                                 NULL,
00131                                 &amp;ViewSize,
00132                                 ViewUnmap,
00133                                 0L,
00134                                 PAGE_READWRITE
00135                                );
00136     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00137         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo);
00138         <a class="code" href="../../d4/d9/umapview_8c.html#a0">NtUnmapViewOfSection</a>(NtCurrentProcess(),ScreenInfo-&gt;BufferInfo.GraphicsInfo.BitMap);
00139         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.hSection);
00140         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00141     }
00142     ScreenInfo-&gt;BufferInfo.GraphicsInfo.ClientProcess = <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>();
00143     ScreenInfo-&gt;BufferInfo.GraphicsInfo.ClientBitMap = *lpBitmap;
00144 
00145     <span class="comment">//</span>
00146     <span class="comment">// create mutex to serialize access to bitmap, then map handle to mutex to client side</span>
00147     <span class="comment">//</span>
00148 
00149     <a class="code" href="../../d2/d5/mutant_8c.html#a5">NtCreateMutant</a>(&amp;ScreenInfo-&gt;BufferInfo.GraphicsInfo.hMutex,
00150                    MUTANT_ALL_ACCESS, NULL, FALSE);
00151     <a class="code" href="../../d0/d5/srvinit_8c.html#a32">MapHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
00152               ScreenInfo-&gt;BufferInfo.GraphicsInfo.hMutex,
00153               hMutex
00154              );
00155 
00156     ScreenInfo-&gt;BufferInfo.GraphicsInfo.dwUsage = GraphicsInfo-&gt;dwUsage;
00157     ScreenInfo-&gt;ScreenBufferSize.X = (WORD)GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biWidth;
00158     ScreenInfo-&gt;ScreenBufferSize.Y = (WORD)-GraphicsInfo-&gt;lpBitMapInfo-&gt;bmiHeader.biHeight;
00159     ScreenInfo-&gt;Window.Left = 0;
00160     ScreenInfo-&gt;Window.Top = 0;
00161     ScreenInfo-&gt;Window.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;Window.Left+ScreenInfo-&gt;ScreenBufferSize.X-1);
00162     ScreenInfo-&gt;Window.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;Window.Top+ScreenInfo-&gt;ScreenBufferSize.Y-1);
00163     <span class="keywordflow">return</span> STATUS_SUCCESS;
00164 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a152" doxytag="consrv.h::CreateCtrlThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int CreateCtrlThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html">PCONSOLE_PROCESS_TERMINATION_RECORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandleList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandleListLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Title</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>EventType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fForce</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03502">3502</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00090">Action</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00161">BHE_ACTIVATE</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00162">BHE_FORCE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01906">BoostHardError()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00870">CONSOLE_SHUTDOWN_FAILED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00871">CONSOLE_SHUTDOWN_SUCCEEDED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00872">CONSOLE_SHUTDOWN_SYSTEM</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00033">CtrlRoutine</a>, <a class="el" href="../../d9/d6/udbgk_8c-source.html#l00026">DebugPort</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00032">DialogBoxCount</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00020">gCmsHungAppTimeout</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00021">gCmsWaitToKillTimeout</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00031">gdwServicesProcessId</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00032">gdwServicesWaitToKillTimeout</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l01865">InternalCreateCallbackThread()</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l01842">InternalWaitCancel()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03451">KillProcess()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00531">NtQueryInformationProcess()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00757">ThreadShutdownNotify()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00121">TSN_USERSAYSCANCEL</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00608">WMCS_CONSOLE</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02088">NonConsoleProcessShutdown()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>.
<p>
<pre class="fragment"><div>03513 {
03514     HANDLE Thread;
03515     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03516     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
03517     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ShutdownFlags;
03518     <span class="keywordtype">int</span> Success=<a class="code" href="../../d8/d5/consrv_8h.html#a45">CONSOLE_SHUTDOWN_SUCCEEDED</a>;
03519     ULONG i;
03520     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> EventFlags;
03521     PROCESS_BASIC_INFORMATION BasicInfo;
03522     PCSR_PROCESS Process;
03523     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fForceProcess;
03524     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fExitProcess;
03525     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirstPass=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03526     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSecondPassNeeded=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03527     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fHasError;
03528     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirstWait;
03529     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fEventProcessed;
03530     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fBreakEvent;
03531 
03532 BigLoop:
03533     <span class="keywordflow">for</span> (i=0;i&lt;ProcessHandleListLength;i++) {
03534 
03535         <span class="comment">//</span>
03536         <span class="comment">// If the user has already cancelled shutdown, don't try to kill</span>
03537         <span class="comment">// any more processes.</span>
03538         <span class="comment">//</span>
03539 
03540         <span class="keywordflow">if</span> (Success == <a class="code" href="../../d8/d5/consrv_8h.html#a44">CONSOLE_SHUTDOWN_FAILED</a>) {
03541             <span class="keywordflow">break</span>;
03542         }
03543 
03544         <span class="comment">//</span>
03545         <span class="comment">// Get the process shutdown parameters here. First get the process</span>
03546         <span class="comment">// id so we can get the csr process structure pointer.</span>
03547         <span class="comment">//</span>
03548 
03549         status = <a class="code" href="../../d9/d1/psquery_8c.html#a18">NtQueryInformationProcess</a>(
03550                 ProcessHandleList[i].ProcessHandle,
03551                 ProcessBasicInformation,
03552                 &amp;BasicInfo,
03553                 <span class="keyword">sizeof</span>(BasicInfo),
03554                 NULL);
03555 
03556         <span class="comment">//</span>
03557         <span class="comment">// Grab the shutdown flags from the csr process structure.  If</span>
03558         <span class="comment">// the structure cannot be found, terminate the process.</span>
03559         <span class="comment">//</span>
03560 
03561         ProcessHandleList[i].bDebugee = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03562         ShutdownFlags = 0;
03563         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
03564             CsrLockProcessByClientId(
03565                     (HANDLE)BasicInfo.UniqueProcessId, &amp;Process);
03566             <span class="keywordflow">if</span> (Process == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03567                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a51">KillProcess</a>(&amp;ProcessHandleList[i],
03568                         BasicInfo.UniqueProcessId);
03569                 <span class="keywordflow">continue</span>;
03570             }
03571         } <span class="keywordflow">else</span> {
03572             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a51">KillProcess</a>(&amp;ProcessHandleList[i], 0);
03573             <span class="keywordflow">continue</span>;
03574         }
03575         ShutdownFlags = Process-&gt;ShutdownFlags;
03576         ProcessHandleList[i].bDebugee = Process-&gt;DebugUserInterface.UniqueProcess!=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03577         CsrUnlockProcess(Process);
03578 
03579         <span class="keywordflow">if</span> (!ProcessHandleList[i].bDebugee) {
03580             HANDLE <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>;
03581 
03582             <span class="comment">// see if we're a OS/2 app that's being debugged</span>
03583             <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a> = (HANDLE)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03584             status = <a class="code" href="../../d9/d1/psquery_8c.html#a18">NtQueryInformationProcess</a>(
03585                         ProcessHandleList[i].ProcessHandle,
03586                         ProcessDebugPort,
03587                         (PVOID)&amp;DebugPort,
03588                         <span class="keyword">sizeof</span>(DebugPort),
03589                         NULL
03590                         );
03591             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a> ) {
03592                 ProcessHandleList[i].bDebugee = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03593             }
03594         }
03595         <span class="keywordflow">if</span> (EventType != CTRL_C_EVENT &amp;&amp; EventType != CTRL_BREAK_EVENT) {
03596             fBreakEvent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03597             <span class="keywordflow">if</span> (fFirstPass) {
03598                 <span class="keywordflow">if</span> (ProcessHandleList[i].bDebugee) {
03599                     fSecondPassNeeded = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03600                     <span class="keywordflow">continue</span>;
03601                 }
03602             } <span class="keywordflow">else</span> {
03603                 <span class="keywordflow">if</span> (!ProcessHandleList[i].bDebugee) {
03604                     <span class="keywordflow">continue</span>;
03605                 }
03606             }
03607         } <span class="keywordflow">else</span> {
03608             fBreakEvent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03609             fFirstPass=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03610         }
03611 
03612         <span class="comment">//</span>
03613         <span class="comment">// fForce is whether ExitWindowsEx was called with EWX_FORCE.</span>
03614         <span class="comment">// ShutdownFlags are the shutdown flags for this process. If</span>
03615         <span class="comment">// either are force (noretry is the same as force), then force:</span>
03616         <span class="comment">// which means if the app doesn't exit, don't bring up the retry</span>
03617         <span class="comment">// dialog - just force it to exit right away.</span>
03618         <span class="comment">//</span>
03619 
03620         fForceProcess = fForce || (ShutdownFlags &amp; SHUTDOWN_NORETRY);
03621 
03622         <span class="comment">//</span>
03623         <span class="comment">// Only notify system security and service context processes.</span>
03624         <span class="comment">// Don't bring up retry dialogs for them.</span>
03625         <span class="comment">//</span>
03626 
03627         fExitProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03628         EventFlags = 0;
03629         <span class="keywordflow">if</span> (ShutdownFlags &amp; (SHUTDOWN_SYSTEMCONTEXT | SHUTDOWN_OTHERCONTEXT)) {
03630 
03631             <span class="comment">//</span>
03632             <span class="comment">// System context - make sure we don't cause it to exit, make</span>
03633             <span class="comment">// sure we don't bring up retry dialogs.</span>
03634             <span class="comment">//</span>
03635 
03636             fExitProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03637             fForceProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03638 
03639             <span class="comment">//</span>
03640             <span class="comment">// This EventFlag will be passed on down to the CtrlRoutine()</span>
03641             <span class="comment">// on the client side. That way that side knows not to exit</span>
03642             <span class="comment">// this process.</span>
03643             <span class="comment">//</span>
03644 
03645             EventFlags = 0x80000000;
03646         }
03647 
03648         <span class="comment">//</span>
03649         <span class="comment">// Is this the first time we're waiting for this process to die?</span>
03650         <span class="comment">//</span>
03651 
03652         fFirstWait = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03653         fEventProcessed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03654 
03655         <span class="keywordflow">while</span> (!fEventProcessed) {
03656             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ThreadExitCode;
03657             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ProcessExitCode;
03658             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cMsTimeout;
03659 
03660             Thread = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a19">InternalCreateCallbackThread</a>(
03661                     ProcessHandleList[i].ProcessHandle,
03662                     (ULONG_PTR)ProcessHandleList[i].CtrlRoutine,
03663                     EventType | EventFlags);
03664 
03665             <span class="comment">//</span>
03666             <span class="comment">// If the thread cannot be created, terminate the process.</span>
03667             <span class="comment">//</span>
03668 
03669             <span class="keywordflow">if</span> (Thread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03670                 KdPrint((<span class="stringliteral">"CONSRV: CreateRemoteThread failed %x\n"</span>,GetLastError()));
03671                 <span class="keywordflow">break</span>;
03672             }
03673 
03674             <span class="comment">//</span>
03675             <span class="comment">// Mark the event as processed.</span>
03676             <span class="comment">//</span>
03677 
03678             fEventProcessed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03679 
03680             <span class="comment">/*</span>
03681 <span class="comment">             * if it's a ctrl-c or ctrl-break event, just close our</span>
03682 <span class="comment">             * handle to the thread.  otherwise it's a close.  wait</span>
03683 <span class="comment">             * for client-side thread to terminate.</span>
03684 <span class="comment">             */</span>
03685 
03686             <span class="keywordflow">if</span> (EventType == CTRL_CLOSE_EVENT) {
03687                 cMsTimeout = <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a2">gCmsHungAppTimeout</a>;
03688             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (EventType == CTRL_LOGOFF_EVENT) {
03689                 cMsTimeout = <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a3">gCmsWaitToKillTimeout</a>;
03690             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (EventType == CTRL_SHUTDOWN_EVENT) {
03691 
03692                 <span class="comment">//</span>
03693                 <span class="comment">// If we are shutting down services.exe, we need to look in the</span>
03694                 <span class="comment">// registry to see how long to wait.</span>
03695                 <span class="comment">//</span>
03696 
03697                 <span class="keywordflow">if</span> (fFirstWait &amp;&amp; BasicInfo.UniqueProcessId == <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a7">gdwServicesProcessId</a>) {
03698                     cMsTimeout = <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a8">gdwServicesWaitToKillTimeout</a>;
03699                 } <span class="keywordflow">else</span> {
03700                     cMsTimeout = <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a3">gCmsWaitToKillTimeout</a>;
03701                 }
03702             } <span class="keywordflow">else</span> {
03703                 CloseHandle(Thread);
03704                 fExitProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03705                 <span class="keywordflow">break</span>;
03706             }
03707 
03708             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03709                 fHasError = <a class="code" href="../../d7/d1/usersrv_8h.html#a53">BoostHardError</a>(BasicInfo.UniqueProcessId,
03710                         (fForceProcess ? BHE_FORCE : BHE_ACTIVATE));
03711 
03712                 <span class="comment">//</span>
03713                 <span class="comment">// Use a 1 second wait if there was a hard error, otherwise</span>
03714                 <span class="comment">// wait cMsTimeout ms.</span>
03715                 <span class="comment">//</span>
03716 
03717                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a18">InternalWaitCancel</a>(Thread,
03718                         (fHasError &amp;&amp; fForceProcess) ? 1000 : cMsTimeout);
03719                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == WAIT_TIMEOUT) {
03720                     <span class="keywordtype">int</span> <a class="code" href="../../d7/d0/cmdat2_8c.html#a18">Action</a>;
03721 
03722                     <span class="comment">//</span>
03723                     <span class="comment">// If there was a hard error, see if there is another one.</span>
03724                     <span class="comment">//</span>
03725 
03726                     <span class="keywordflow">if</span> (fHasError &amp;&amp; fForceProcess) {
03727                         <span class="keywordflow">continue</span>;
03728                     }
03729 
03730                     <span class="keywordflow">if</span> (!fForceProcess) {
03731 
03732                         <span class="comment">//</span>
03733                         <span class="comment">// we timed out in the handler.  ask the user what</span>
03734                         <span class="comment">// to do.</span>
03735                         <span class="comment">//</span>
03736 
03737                         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a9">DialogBoxCount</a>++;
03738                         <a class="code" href="../../d7/d0/cmdat2_8c.html#a18">Action</a> = <a class="code" href="../../d7/d1/usersrv_8h.html#a54">ThreadShutdownNotify</a>(WMCS_CONSOLE, (ULONG_PTR)Thread, (LPARAM)Title);
03739                         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a9">DialogBoxCount</a>--;
03740 
03741                         <span class="comment">//</span>
03742                         <span class="comment">// If the response is Cancel or EndTask, exit the loop.</span>
03743                         <span class="comment">// Otherwise retry the wait.</span>
03744                         <span class="comment">//</span>
03745 
03746                         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a18">Action</a> == <a class="code" href="../../d7/d1/usersrv_8h.html#a19">TSN_USERSAYSCANCEL</a>) {
03747                             Success = <a class="code" href="../../d8/d5/consrv_8h.html#a44">CONSOLE_SHUTDOWN_FAILED</a>;
03748                         }
03749                     }
03750                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == 0) {
03751                     ThreadExitCode = 0;
03752                     GetExitCodeThread(Thread,&amp;ThreadExitCode);
03753                     GetExitCodeProcess(ProcessHandleList[i].ProcessHandle,
03754                             &amp;ProcessExitCode);
03755 
03756                     <span class="comment">//</span>
03757                     <span class="comment">// if the app returned TRUE (event handled)</span>
03758                     <span class="comment">// notify the user and see if the app should</span>
03759                     <span class="comment">// be terminated anyway.</span>
03760                     <span class="comment">//</span>
03761 
03762                     <span class="keywordflow">if</span> (fHasError || (ThreadExitCode == EventType &amp;&amp;
03763                             ProcessExitCode == STILL_ACTIVE)) {
03764                         <span class="keywordtype">int</span> <a class="code" href="../../d7/d0/cmdat2_8c.html#a18">Action</a>;
03765 
03766                         <span class="keywordflow">if</span> (!fForceProcess) {
03767 
03768                             <span class="comment">//</span>
03769                             <span class="comment">// Wait for the process to exit.  If it does exit,</span>
03770                             <span class="comment">// don't bring up the end task dialog.</span>
03771                             <span class="comment">//</span>
03772 
03773                             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a18">InternalWaitCancel</a>(ProcessHandleList[i].ProcessHandle,
03774                                     (fHasError || fFirstWait) ? 1000 : cMsTimeout);
03775                             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == 0) {
03776 
03777                                 <span class="comment">//</span>
03778                                 <span class="comment">// The process exited.</span>
03779                                 <span class="comment">//</span>
03780 
03781                                 fExitProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03782                             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == WAIT_TIMEOUT) {
03783                                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a9">DialogBoxCount</a>++;
03784                                 <a class="code" href="../../d7/d0/cmdat2_8c.html#a18">Action</a> = <a class="code" href="../../d7/d1/usersrv_8h.html#a54">ThreadShutdownNotify</a>(WMCS_CONSOLE,
03785                                                               (ULONG_PTR)ProcessHandleList[i].ProcessHandle,
03786                                                                (LPARAM)Title);
03787                                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a9">DialogBoxCount</a>--;
03788 
03789                                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a18">Action</a> == <a class="code" href="../../d7/d1/usersrv_8h.html#a19">TSN_USERSAYSCANCEL</a>) {
03790                                     Success = <a class="code" href="../../d8/d5/consrv_8h.html#a44">CONSOLE_SHUTDOWN_FAILED</a>;
03791                                 }
03792                             }
03793                         }
03794                     } <span class="keywordflow">else</span> {
03795 
03796                         <span class="comment">//</span>
03797                         <span class="comment">// The process exited.</span>
03798                         <span class="comment">//</span>
03799 
03800                         fExitProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03801                     }
03802                 }
03803 
03804                 <span class="comment">//</span>
03805                 <span class="comment">// If we get here, we know that all wait conditions have</span>
03806                 <span class="comment">// been satisfied.  Time to finish with the process.</span>
03807                 <span class="comment">//</span>
03808 
03809                 <span class="keywordflow">break</span>;
03810             }
03811 
03812             CloseHandle(Thread);
03813         }
03814 
03815         <span class="comment">//</span>
03816         <span class="comment">// If the process is shutting down, mark it as terminated.</span>
03817         <span class="comment">// This prevents the process from raising any hard error popups</span>
03818         <span class="comment">// after we're done shutting it down.</span>
03819         <span class="comment">//</span>
03820 
03821         <span class="keywordflow">if</span> (!fBreakEvent &amp;&amp;
03822                 !(ShutdownFlags &amp; (SHUTDOWN_SYSTEMCONTEXT | SHUTDOWN_OTHERCONTEXT)) &amp;&amp;
03823                 Success == <a class="code" href="../../d8/d5/consrv_8h.html#a45">CONSOLE_SHUTDOWN_SUCCEEDED</a>) {
03824             CsrLockProcessByClientId(
03825                     (HANDLE)BasicInfo.UniqueProcessId, &amp;Process);
03826             <span class="keywordflow">if</span> (Process) {
03827                 Process-&gt;Flags |= CSR_PROCESS_TERMINATED;
03828                 CsrUnlockProcess(Process);
03829             }
03830 
03831             <span class="comment">//</span>
03832             <span class="comment">// Force the termination of the process if needed.  Otherwise,</span>
03833             <span class="comment">// acknowledge any remaining hard errors.</span>
03834             <span class="comment">//</span>
03835             <span class="keywordflow">if</span> (fExitProcess) {
03836                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a51">KillProcess</a>(&amp;ProcessHandleList[i],
03837                         BasicInfo.UniqueProcessId);
03838             } <span class="keywordflow">else</span> {
03839                 <a class="code" href="../../d7/d1/usersrv_8h.html#a53">BoostHardError</a>(BasicInfo.UniqueProcessId, BHE_FORCE);
03840             }
03841         }
03842     }
03843 
03844     <span class="comment">//</span>
03845     <span class="comment">// If this was our first time through and we skipped one of the</span>
03846     <span class="comment">// processes because it was being debugged, we'll go back for a</span>
03847     <span class="comment">// second pass.</span>
03848     <span class="comment">//</span>
03849 
03850     <span class="keywordflow">if</span> (fFirstPass &amp;&amp; fSecondPassNeeded) {
03851         fFirstPass = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03852         <span class="keywordflow">goto</span> BigLoop;
03853     }
03854 
03855     <span class="comment">// if we're shutting down a system or service security context</span>
03856     <span class="comment">// thread, don't wait for the process to terminate</span>
03857 
03858     <span class="keywordflow">if</span> (ShutdownFlags &amp; (SHUTDOWN_SYSTEMCONTEXT | SHUTDOWN_OTHERCONTEXT)) {
03859         <span class="keywordflow">return</span> <a class="code" href="../../d8/d5/consrv_8h.html#a46">CONSOLE_SHUTDOWN_SYSTEM</a>;
03860     }
03861     <span class="keywordflow">return</span> Success;
03862 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a139" doxytag="consrv.h::CreateInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CreateInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG NumberOfEvents&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputBufferInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00103">103</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00070">BUFFER_TAG</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00022">DEFAULT_NUMBER_OF_EVENTS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>.
<p>
<pre class="fragment"><div>00114                    :
00115 
00116     This routine creates an input buffer.  It allocates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> circular
00117     buffer and initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information fields.
00118 
00119 Arguments:
00120 
00121     NumberOfEvents - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> of input buffer in events.
00122 
00123     InputBufferInformation - Pointer to input buffer information structure.
00124 
00125 Return Value:
00126 
00127 
00128 --*/
00129 
00130 {
00131     ULONG <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00132     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00133 
00134     <span class="keywordflow">if</span> (NumberOfEvents == 0) {
00135         NumberOfEvents = <a class="code" href="../../d9/d3/input_8h.html#a0">DEFAULT_NUMBER_OF_EVENTS</a>;
00136     }
00137 
00138     <span class="comment">// allocate memory for circular buffer</span>
00139 
00140     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> =  <span class="keyword">sizeof</span>(INPUT_RECORD) * (NumberOfEvents+1);
00141     InputBufferInformation-&gt;InputBuffer = (PINPUT_RECORD)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( BUFFER_TAG ),BufferSize);
00142     <span class="keywordflow">if</span> (InputBufferInformation-&gt;InputBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00143         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00144     }
00145     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;InputBufferInformation-&gt;InputWaitEvent,
00146                            EVENT_ALL_ACCESS, NULL, NotificationEvent, FALSE);
00147     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00148         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(InputBufferInformation-&gt;InputBuffer);
00149         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00150     }
00151     InitializeListHead(&amp;InputBufferInformation-&gt;ReadWaitQueue);
00152 
00153     <span class="comment">// initialize buffer header</span>
00154 
00155     InputBufferInformation-&gt;InputBufferSize = NumberOfEvents;
00156     InputBufferInformation-&gt;ShareAccess.OpenCount = 0;
00157     InputBufferInformation-&gt;ShareAccess.Readers = 0;
00158     InputBufferInformation-&gt;ShareAccess.Writers = 0;
00159     InputBufferInformation-&gt;ShareAccess.SharedRead = 0;
00160     InputBufferInformation-&gt;ShareAccess.SharedWrite = 0;
00161     InputBufferInformation-&gt;InputMode = ENABLE_LINE_INPUT | ENABLE_PROCESSED_INPUT | ENABLE_ECHO_INPUT | ENABLE_MOUSE_INPUT;
00162     InputBufferInformation-&gt;AllocatedBufferSize = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00163     InputBufferInformation-&gt;RefCount = 0;
00164     InputBufferInformation-&gt;First = (ULONG_PTR) InputBufferInformation-&gt;InputBuffer;
00165     InputBufferInformation-&gt;In = (ULONG_PTR) InputBufferInformation-&gt;InputBuffer;
00166     InputBufferInformation-&gt;Out = (ULONG_PTR) InputBufferInformation-&gt;InputBuffer;
00167     InputBufferInformation-&gt;Last = (ULONG_PTR) InputBufferInformation-&gt;InputBuffer + <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00168 <span class="preprocessor">#if defined(FE_SB)</span>
00169 <span class="preprocessor"></span><span class="preprocessor">#if defined(FE_IME)</span>
00170 <span class="preprocessor"></span>    InputBufferInformation-&gt;ImeMode.Disable     = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00171     InputBufferInformation-&gt;ImeMode.Unavailable = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00172     InputBufferInformation-&gt;ImeMode.Open        = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00173     InputBufferInformation-&gt;ImeMode.ReadyConversion = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00174 <span class="preprocessor">#endif // FE_IME</span>
00175 <span class="preprocessor"></span>    InputBufferInformation-&gt;Console = Console;
00176     RtlZeroMemory(&amp;InputBufferInformation-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
00177     RtlZeroMemory(&amp;InputBufferInformation-&gt;WriteConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
00178 <span class="preprocessor">#endif</span>
00179 <span class="preprocessor"></span>
00180     <span class="keywordflow">return</span> STATUS_SUCCESS;
00181 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a105" doxytag="consrv.h::CreateScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CreateScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD dwWindowSize&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nFont&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD dwScreenBufferSize&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>Fill</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>PopupFill</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONSOLE_GRAPHICS_BUFFER_INFO GraphicsBufferInfo&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBitmap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>hMutex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CursorSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>FaceName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a107" doxytag="consrv.h::CreateWindowsWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CreateWindowsWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l00834">834</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00161">_SCREEN_INFORMATION::Attributes</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00150">CONSOLE_IS_IME_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00444">CONSOLE_WINDOW_CLASS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00265">CONSOLE_WINDOW_EX_FLAGS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00264">CONSOLE_WINDOW_FLAGS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00821">ConsoleSetActiveWindow()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00038">CreateWindowEx()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d4/d3/w32_2ntuser_2client_2nt6_2pch_8h-source.html#l00039">DestroyWindow</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d4/d3/w32_2ntuser_2client_2nt6_2pch_8h-source.html#l00021">GetDC</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00028">ghDefaultIcon</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00029">ghDefaultSmIcon</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00102">gnConsoleWindows</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00113">guCaretBlinkTime</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00049">HorizontalClientToWindow</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00047">HorizontalScrollSize</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00034">INITIALIZATION_FAILED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00033">INITIALIZATION_SUCCEEDED</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00061">InitSystemMenu()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02181">InternalUpdateScrollBars()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00162">_SCREEN_INFORMATION::PopupAttributes</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00765">PositionConsoleWindow()</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00052">ProgmanHandleMessage</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a52">RegisterKeisenOfTTFont()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00094">SetConsolePid</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00095">SetConsoleTid</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00442">SetTimer</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00122">SetWindowConsole</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00048">VerticalClientToWindow</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00046">VerticalScrollSize</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00163">_SCREEN_INFORMATION::WindowMaximizedX</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00164">_SCREEN_INFORMATION::WindowMaximizedY</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01657">ProcessCreateConsoleWindow()</a>.
<p>
<pre class="fragment"><div>00837 {
00838     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00839     SIZE WindowSize;
00840     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Style;
00841     THREAD_BASIC_INFORMATION ThreadInfo;
00842     HWND <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>;
00843 
00844     ScreenInfo = Console-&gt;ScreenBuffers;
00845 
00846     <span class="comment">//</span>
00847     <span class="comment">// figure out how big to make the window, given the desired client area</span>
00848     <span class="comment">// size.  window is always created in textmode.</span>
00849     <span class="comment">//</span>
00850 
00851     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; CONSOLE_TEXTMODE_BUFFER);
00852     WindowSize.cx = <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)*<a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a>;
00853     WindowSize.cy = <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)*<a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a20">HorizontalClientToWindow</a>;
00854     Style = <a class="code" href="../../d7/d2/output_8h.html#a13">CONSOLE_WINDOW_FLAGS</a> &amp; ~WS_VISIBLE;
00855     <span class="keywordflow">if</span> (!ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o10">WindowMaximizedX</a>) {
00856         WindowSize.cy += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a18">HorizontalScrollSize</a>;
00857     } <span class="keywordflow">else</span> {
00858         Style &amp;= ~WS_HSCROLL;
00859     }
00860     <span class="keywordflow">if</span> (!ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o11">WindowMaximizedY</a>) {
00861         WindowSize.cx += <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a17">VerticalScrollSize</a>;
00862     } <span class="keywordflow">else</span> {
00863         Style &amp;= ~WS_VSCROLL;
00864     }
00865 <span class="preprocessor">#ifdef THERESES_DEBUG</span>
00866 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"creating window with char size %d %d\n"</span>,<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo),<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo));
00867     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                     pixel size %d %d\n"</span>,WindowSize.cx,WindowSize.cy);
00868 <span class="preprocessor">#endif</span>
00869 <span class="preprocessor"></span>
00870     <span class="comment">//</span>
00871     <span class="comment">// create the window.</span>
00872     <span class="comment">//</span>
00873 
00874     Console-&gt;WindowRect.left = Console-&gt;dwWindowOriginX;
00875     Console-&gt;WindowRect.top = Console-&gt;dwWindowOriginY;
00876     Console-&gt;WindowRect.right = WindowSize.cx + Console-&gt;dwWindowOriginX;
00877     Console-&gt;WindowRect.bottom = WindowSize.cy + Console-&gt;dwWindowOriginY;
00878     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> = <a class="code" href="../../d5/d9/cltxt_8h.html#a10">CreateWindowEx</a>(CONSOLE_WINDOW_EX_FLAGS,
00879                           CONSOLE_WINDOW_CLASS,
00880                           Console-&gt;Title,
00881                           Style,
00882                           Console-&gt;dwWindowOriginX,
00883                           Console-&gt;dwWindowOriginY,
00884                           WindowSize.cx,
00885                           WindowSize.cy,
00886                           (Console-&gt;Flags &amp; CONSOLE_NO_WINDOW) ? HWND_MESSAGE : HWND_DESKTOP,
00887                           NULL,
00888                           ghInstance,
00889                           NULL);
00890     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00891         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(Console-&gt;InitEvents[INITIALIZATION_FAILED],NULL);
00892         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00893     }
00894     Console-&gt;hWnd = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>;
00895 
00896     <a class="code" href="../../d6/d2/output_8c.html#a8">SetWindowConsole</a>(hWnd, Console);
00897 
00898     <span class="comment">//</span>
00899     <span class="comment">// Stuff the client id into the window so USER can find it.</span>
00900     <span class="comment">//</span>
00901 
00902     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d9/d1/psquery_8c.html#a20">NtQueryInformationThread</a>(Console-&gt;ClientThreadHandle,
00903             ThreadBasicInformation, &amp;ThreadInfo,
00904             <span class="keyword">sizeof</span>(ThreadInfo), NULL))) {
00905 
00906         <a class="code" href="../../d8/d5/consrv_8h.html#a23">SetConsolePid</a>(Console-&gt;hWnd, HandleToUlong(ThreadInfo.ClientId.UniqueProcess));
00907         <a class="code" href="../../d8/d5/consrv_8h.html#a24">SetConsoleTid</a>(Console-&gt;hWnd, HandleToUlong(ThreadInfo.ClientId.UniqueThread));
00908     }
00909 
00910     <span class="comment">//</span>
00911     <span class="comment">// Get the dc.</span>
00912     <span class="comment">//</span>
00913 
00914     Console-&gt;hDC = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>(Console-&gt;hWnd);
00915 
00916     <span class="keywordflow">if</span> (Console-&gt;hDC == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00917         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(Console-&gt;InitEvents[INITIALIZATION_FAILED],NULL);
00918         <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a3">DestroyWindow</a>(Console-&gt;hWnd);
00919         Console-&gt;hWnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00920         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00921     }
00922     Console-&gt;hMenu = GetSystemMenu(Console-&gt;hWnd,FALSE);
00923 
00924     <span class="comment">//</span>
00925     <span class="comment">// modify system menu to our liking.</span>
00926     <span class="comment">//</span>
00927 
00928     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a1">InitSystemMenu</a>(Console);
00929 
00930     <a class="code" href="../../d6/d2/output_8c.html#a22">gnConsoleWindows</a>++;
00931     Console-&gt;InputThreadInfo-&gt;WindowCount++;
00932 
00933 <span class="preprocessor">#if defined(FE_IME)</span>
00934 <span class="preprocessor"></span>    SetUndetermineAttribute(Console);
00935 <span class="preprocessor">#endif</span>
00936 <span class="preprocessor"></span><span class="preprocessor">#if defined(FE_SB)</span>
00937 <span class="preprocessor"></span>    <a class="code" href="../../d0/d3/dbcs_8h.html#a52">RegisterKeisenOfTTFont</a>(ScreenInfo);
00938 <span class="preprocessor">#endif</span>
00939 <span class="preprocessor"></span>
00940     <span class="comment">//</span>
00941     <span class="comment">// Set up the hot key for this window</span>
00942     <span class="comment">//</span>
00943     <span class="keywordflow">if</span> ((Console-&gt;dwHotKey != 0) &amp;&amp; !(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>)) {
00944         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(Console-&gt;hWnd, WM_SETHOTKEY, Console-&gt;dwHotKey, 0L);
00945     }
00946 
00947     <span class="comment">//</span>
00948     <span class="comment">// create icon</span>
00949     <span class="comment">//</span>
00950 
00951     <span class="keywordflow">if</span> (Console-&gt;iIconId) {
00952 
00953         <span class="comment">// We have no icon, try and get one from progman.</span>
00954 
00955         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(HWND_BROADCAST,
00956                     ProgmanHandleMessage,
00957                     (WPARAM)Console-&gt;hWnd,
00958                     1);
00959     }
00960     <span class="keywordflow">if</span> (Console-&gt;hIcon == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00961         Console-&gt;hIcon = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>;
00962         Console-&gt;hSmIcon = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>;
00963     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;hIcon != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
00964         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(Console-&gt;hWnd, WM_SETICON, ICON_BIG, (LPARAM)Console-&gt;hIcon);
00965         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(Console-&gt;hWnd, WM_SETICON, ICON_SMALL, (LPARAM)Console-&gt;hSmIcon);
00966     }
00967 
00968     SetBkMode(Console-&gt;hDC,OPAQUE);
00969     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a34">SetFont</a>(ScreenInfo);
00970     SelectObject(Console-&gt;hDC, GetStockObject(DC_BRUSH));
00971     <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(ScreenInfo, ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>,
00972                     ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o9">PopupAttributes</a>, FALSE);
00973     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>) {
00974         ShowWindowAsync(Console-&gt;hWnd, SW_HIDE);
00975 <span class="preprocessor">#ifdef i386</span>
00976 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags != 0) {
00977         <span class="keywordflow">if</span> (Console-&gt;wShowWindow == SW_SHOWMINNOACTIVE) {
00978             ShowWindowAsync(Console-&gt;hWnd, Console-&gt;wShowWindow);
00979             Console-&gt;FullScreenFlags = 0;
00980             Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>;
00981         } <span class="keywordflow">else</span> {
00982             <a class="code" href="../../d7/d4/server_2private_8c.html#a48">ConvertToFullScreen</a>(Console);
00983             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d6/d2/output_8c.html#a44">ConsoleSetActiveWindow</a>(Console))) {
00984                 <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
00985             }
00986 
00987             <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd,CDS_FULLSCREEN);
00988         }
00989 <span class="preprocessor">#endif</span>
00990 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
00991         <span class="keywordflow">if</span> (Console-&gt;wShowWindow != SW_SHOWNOACTIVATE &amp;&amp;
00992             Console-&gt;wShowWindow != SW_SHOWMINNOACTIVE &amp;&amp;
00993             Console-&gt;wShowWindow != SW_HIDE) {
00994             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d6/d2/output_8c.html#a44">ConsoleSetActiveWindow</a>(Console))) {
00995                 <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
00996             }
00997         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;wShowWindow == SW_SHOWMINNOACTIVE) {
00998             Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>;
00999         }
01000         ShowWindowAsync(Console-&gt;hWnd, Console-&gt;wShowWindow);
01001     }
01002 
01003     <span class="comment">//UpdateWindow(Console-&gt;hWnd);</span>
01004     <a class="code" href="../../d6/d2/output_8c.html#a37">InternalUpdateScrollBars</a>(ScreenInfo);
01005     <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) &amp;&amp;
01006          (Console-&gt;FullScreenFlags == 0) ) {
01007 
01008         <a class="code" href="../../d6/d2/output_8c.html#a43">PositionConsoleWindow</a>(Console, TRUE);
01009     }
01010 
01011 <span class="preprocessor">#if defined(FE_IME)</span>
01012 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>() &amp;&amp; !(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>)) {
01013         <a class="code" href="../../d3/d0/user32_8def.html#a56">SetTimer</a>(Console-&gt;hWnd, SCROLL_WAIT_TIMER, guCaretBlinkTime, NULL);
01014     }
01015 <span class="preprocessor">#endif</span>
01016 <span class="preprocessor"></span>    <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(Console-&gt;InitEvents[INITIALIZATION_SUCCEEDED],NULL);
01017     <span class="keywordflow">return</span> STATUS_SUCCESS;
01018 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a236" doxytag="consrv.h::CursorTimerRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CursorTimerRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00332">332</a> of file <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html">ntcon/server/cursor.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00033">InvertPixels()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00870">NtUserConsoleControl()</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>.
<p>
<pre class="fragment"><div>00338                    :
00339 
00340     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> focus
00341     goes off.  It blinks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cursor.
00342 
00343 Arguments:
00344 
00345     ScreenInfo - pointer to screen info structure.
00346 
00347 Return Value:
00348 
00349     none.
00350 
00351 --*/
00352 
00353 {
00354     <span class="keywordflow">if</span> (!(ScreenInfo-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>))
00355         <span class="keywordflow">return</span>;
00356 
00357     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00358 
00359         <span class="comment">//</span>
00360         <span class="comment">// Update the cursor pos in USER so accessibility will work</span>
00361         <span class="comment">//</span>
00362 
00363         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.CursorMoved) {
00364 
00365             CONSOLE_CARET_INFO ConsoleCaretInfo;
00366 
00367             ScreenInfo-&gt;BufferInfo.TextInfo.CursorMoved = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00368             ConsoleCaretInfo.hwnd = ScreenInfo-&gt;Console-&gt;hWnd;
00369             ConsoleCaretInfo.rc.left = (ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.X - ScreenInfo-&gt;Window.Left) * <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00370             ConsoleCaretInfo.rc.top = (ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y - ScreenInfo-&gt;Window.Top) * <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00371             ConsoleCaretInfo.rc.right = ConsoleCaretInfo.rc.left + <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00372             ConsoleCaretInfo.rc.bottom = ConsoleCaretInfo.rc.top + <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00373             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a86">NtUserConsoleControl</a>(ConsoleSetCaretInfo,
00374                                  &amp;ConsoleCaretInfo,
00375                                  <span class="keyword">sizeof</span>(ConsoleCaretInfo));
00376         }
00377 
00378         <span class="comment">// if the DelayCursor flag has been set, wait one more tick before toggle.</span>
00379         <span class="comment">// This is used to guarantee the cursor is on for a finite period of time</span>
00380         <span class="comment">// after a move and off for a finite period of time after a WriteString</span>
00381 
00382         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.DelayCursor) {
00383             ScreenInfo-&gt;BufferInfo.TextInfo.DelayCursor = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00384             <span class="keywordflow">return</span>;
00385         }
00386 
00387         <span class="comment">// don't blink the cursor for remote sessions</span>
00388         <span class="keywordflow">if</span> (NtCurrentPeb()-&gt;SessionId &gt; 0 &amp;&amp;
00389             ScreenInfo-&gt;BufferInfo.TextInfo.CursorOn) {
00390 
00391             <span class="keywordflow">return</span>;
00392         }
00393 
00394         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.CursorVisible &amp;&amp;
00395             !ScreenInfo-&gt;BufferInfo.TextInfo.UpdatingScreen) {
00396             <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a1">InvertPixels</a>(ScreenInfo);
00397             ScreenInfo-&gt;BufferInfo.TextInfo.CursorOn = !ScreenInfo-&gt;BufferInfo.TextInfo.CursorOn;
00398         }
00399     }
00400 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="consrv.h::DereferenceConsoleHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DereferenceConsoleHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00175">175</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00097">CONSOLE_TERMINATING</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00042">ConsoleHandleTableLocked</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00041">IndexFromHandle</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00030">NumberOfConsoleHandles</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02529">WriteConsoleWaitRoutine()</a>.
<p>
<pre class="fragment"><div>00182                    :
00183 
00184     This routine converts a console handle value into a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00185     console data structure.
00186 
00187 Arguments:
00188 
00189     ConsoleHandle - console handle to convert.
00190 
00191     Console - On output, contains pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console data structure.
00192 
00193 Return Value:
00194 
00195     none.
00196 
00197 Note:
00198 
00199     The console handle table lock must be held when calling <span class="keyword">this</span> routine.
00200 
00201 --*/
00202 
00203 {
00204     ULONG i;
00205 
00206     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a2">ConsoleHandleTableLocked</a>());
00207 
00208     i = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a1">IndexFromHandle</a>(ConsoleHandle);
00209     <span class="keywordflow">if</span> ((i &gt;= <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>) ||
00210         ((*Console = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i]) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00211         ((*Console)-&gt;ConsoleHandle != ConsoleHandle)) {
00212         *Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00213         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
00214     }
00215     <span class="keywordflow">if</span> ((*Console)-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a12">CONSOLE_TERMINATING</a>) {
00216         *Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00217         <span class="keywordflow">return</span> STATUS_PROCESS_IS_TERMINATING;
00218     }
00219     <span class="keywordflow">return</span> STATUS_SUCCESS;
00220 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="consrv.h::DereferenceIoHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DereferenceIoHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>Access</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">1536</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, <a class="el" href="../../d6/d4/rdwr_8c-source.html#l00044">CONSOLE_HANDLE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, and <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00373">SrvConsoleMenuControl()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01568">SrvFillConsoleOutput()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00524">SrvFlushConsoleInputBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00315">SrvGetConsoleCurrentFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00179">SrvGetConsoleCursorInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00233">SrvGetConsoleFontInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00278">SrvGetConsoleFontSize()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02232">SrvGetConsoleHardwareState()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">SrvGetConsoleInput()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00033">SrvGetConsoleMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00108">SrvGetConsoleNumberOfInputEvents()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00141">SrvGetConsoleScreenBufferInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00555">SrvGetLargestConsoleWindowSize()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00168">SrvInvalidateBitMapRect()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02263">SrvReadConsole()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">SrvReadConsoleOutput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01448">SrvReadConsoleOutputString()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00492">SrvSetConsoleActiveScreenBuffer()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00213">SrvSetConsoleCursor()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00738">SrvSetConsoleCursorInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00662">SrvSetConsoleCursorPosition()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00853">SrvSetConsoleDisplayMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01118">SrvSetConsoleFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02280">SrvSetConsoleHardwareState()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00354">SrvSetConsoleMode()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00432">SrvSetConsolePalette()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00608">SrvSetConsoleScreenBufferSize()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01078">SrvSetConsoleTextAttribute()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">SrvSetConsoleWindowInfo()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00298">SrvShowConsoleCursor()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02463">SrvWriteConsole()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00730">SrvWriteConsoleInput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01508">SrvWriteConsoleOutputString()</a>, and <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>.
<p>
<pre class="fragment"><div>01546                    :
01547 
01548     This routine verifies a handle's validity, then returns a pointer to
01549     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle data structure.
01550 
01551 Arguments:
01552 
01553     ProcessData - Pointer to per process data structure.
01554 
01555     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to dereference.
01556 
01557     HandleData - On <span class="keywordflow">return</span>, pointer to handle data structure.
01558 
01559 Return Value:
01560 
01561 --*/
01562 
01563 {
01564     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01565 
01566     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/rdwr_8c.html#a8">CONSOLE_HANDLE</a>(Handle)) {
01567         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
01568     }
01569     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = (ULONG_PTR)<a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(Handle);
01570     <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &gt;= ProcessData-&gt;HandleTableSize) ||
01571         (ProcessData-&gt;HandleTablePtr[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].HandleType == <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>) ||
01572         !(ProcessData-&gt;HandleTablePtr[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].HandleType &amp; HandleType) ||
01573         !(ProcessData-&gt;HandleTablePtr[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Access &amp; Access) ) {
01574         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
01575     }
01576     *HandleData = &amp;ProcessData-&gt;HandleTablePtr[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
01577     <span class="keywordflow">return</span> STATUS_SUCCESS;
01578 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="consrv.h::DereferenceIoHandleNoCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DereferenceIoHandleNoCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">1501</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, and <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00053">FindActiveScreenBufferHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02793">ProcessCommandNumberInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02546">ProcessCopyFromCharInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02677">ProcessCopyToCharInput()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02997">SrvCloseHandle()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02747">SrvGetHandleInformation()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02794">SrvSetHandleInformation()</a>, and <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01582">SrvVerifyConsoleIoHandle()</a>.
<p>
<pre class="fragment"><div>01509                    :
01510 
01511     This routine verifies a handle's validity, then returns a pointer to
01512     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle data structure.
01513 
01514 Arguments:
01515 
01516     ProcessData - Pointer to per process data structure.
01517 
01518     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to dereference.
01519 
01520     HandleData - On <span class="keywordflow">return</span>, pointer to handle data structure.
01521 
01522 Return Value:
01523 
01524 --*/
01525 
01526 {
01527     <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &gt;= ProcessData-&gt;HandleTableSize) ||
01528         (ProcessData-&gt;HandleTablePtr[(ULONG_PTR)<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>].HandleType == <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>) ) {
01529         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
01530     }
01531     *HandleData = &amp;ProcessData-&gt;HandleTablePtr[(ULONG_PTR)<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>];
01532     <span class="keywordflow">return</span> STATUS_SUCCESS;
01533 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="consrv.h::DestroyConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">1051</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00107">CONSOLE_IN_DESTRUCTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00221">_CONSOLE_INFORMATION::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00348">ConsoleLocked</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00331">FreeConsoleHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00041">IndexFromHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00258">LockConsoleHandleTable</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01474">RtlDeleteCriticalSection()</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00259">UnlockConsoleHandleTable</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, and <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>.
<p>
<pre class="fragment"><div>01057                    :
01058 
01059     This routine frees a console structure <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>'s not being referenced.
01060 
01061 Arguments:
01062 
01063     Console - Console to free.
01064 
01065 Return Value:
01066 
01067 
01068 --*/
01069 
01070 {
01071     HANDLE ConsoleHandle = Console-&gt;ConsoleHandle;
01072 
01073     <span class="comment">//</span>
01074     <span class="comment">// Make sure we have the console locked and it really is going away.</span>
01075     <span class="comment">//</span>
01076 
01077     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d1/d7/server_8h.html#a63">ConsoleLocked</a>(Console));
01078     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Console-&gt;hWnd == NULL);
01079 
01080     <span class="comment">//</span>
01081     <span class="comment">// Mark this console as being destroyed.</span>
01082     <span class="comment">//</span>
01083 
01084     Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a22">CONSOLE_IN_DESTRUCTION</a>;
01085 
01086     <span class="comment">//</span>
01087     <span class="comment">// Unlock this console.</span>
01088     <span class="comment">//</span>
01089 
01090     RtlLeaveCriticalSection(&amp;Console-&gt;ConsoleLock);
01091 
01092     <span class="comment">//</span>
01093     <span class="comment">// If the console still exists and no one is waiting on it, free it.</span>
01094     <span class="comment">//</span>
01095 
01096     <a class="code" href="../../d8/d5/consrv_8h.html#a40">LockConsoleHandleTable</a>();
01097     <span class="keywordflow">if</span> (Console == <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a1">IndexFromHandle</a>(ConsoleHandle)] &amp;&amp;
01098         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a> == ConsoleHandle &amp;&amp;
01099         Console-&gt;ConsoleLock.OwningThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01100         Console-&gt;WaitCount == 0) {
01101 
01102         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a14">FreeConsoleHandle</a>(ConsoleHandle);
01103         <a class="code" href="../../d7/d8/dll_2resource_8c.html#a29">RtlDeleteCriticalSection</a>(&amp;Console-&gt;ConsoleLock);
01104         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console);
01105     }
01106     <a class="code" href="../../d8/d5/consrv_8h.html#a41">UnlockConsoleHandleTable</a>();
01107 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a108" doxytag="consrv.h::DestroyWindowsWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyWindowsWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04454">4454</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04375">CleanupConsoleMessages()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01634">ClearKeyInfo()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00631">CloseWindowStation</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00070">CONIME_DESTROY</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00150">CONSOLE_IS_IME_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00249">CURSOR_TIMER</a>, <a class="el" href="../../d9/d7/eudc_8h.html#a4">DeleteEUDC()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, <a class="el" href="../../d6/d6/foncache_8h.html#a24">DestroyFontCache()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00535">DestroyIcon</a>, <a class="el" href="../../d4/d3/w32_2ntuser_2client_2nt6_2pch_8h-source.html#l00039">DestroyWindow</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00591">FreeAliasBuffers()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04640">FreeCommandHistoryBuffers()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00221">FreeInputBuffer()</a>, <a class="el" href="../../d9/d7/eudc_8h.html#a6">FreeLocalEUDC()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00028">ghDefaultIcon</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00029">ghDefaultSmIcon</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00102">gnConsoleWindows</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00034">INITIALIZATION_FAILED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00033">INITIALIZATION_SUCCEEDED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00177">_SCREEN_INFORMATION::Next</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01052">ReleaseDC()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l00122">SetWindowConsole</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>04457 {
04458     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> Cur,Next;
04459     HWND <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> = Console-&gt;hWnd;
04460 
04461     <a class="code" href="../../d6/d2/output_8c.html#a22">gnConsoleWindows</a>--;
04462     Console-&gt;InputThreadInfo-&gt;WindowCount--;
04463 
04464     <a class="code" href="../../d6/d2/output_8c.html#a8">SetWindowConsole</a>(hWnd, NULL);
04465 
04466     KillTimer(Console-&gt;hWnd,CURSOR_TIMER);
04467 
04468     <span class="keywordflow">if</span> (Console-&gt;hWndProperties) {
04469         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(Console-&gt;hWndProperties, WM_CLOSE, 0, 0);
04470     }
04471 
04472     <span class="comment">// FE_SB</span>
04473     <span class="keywordflow">if</span> (Console-&gt;FonthDC) {
04474         <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(NULL, Console-&gt;FonthDC);
04475         DeleteObject(Console-&gt;hBitmap);
04476     }
04477     <a class="code" href="../../d9/d7/eudc_8h.html#a4">DeleteEUDC</a>(Console);
04478 
04479     <span class="comment">// FE_IME</span>
04480     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
04481         <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>)) {
04482             <span class="comment">// v-HirShi Jul.4.1995 For console IME</span>
04483             KillTimer(Console-&gt;hWnd, SCROLL_WAIT_TIMER);
04484         }
04485         ConsoleImeMessagePump(Console,
04486                               CONIME_DESTROY,
04487                               (WPARAM)Console-&gt;ConsoleHandle,
04488                               (LPARAM)NULL
04489                              );
04490     }
04491     <span class="comment">// end FE_IME</span>
04492     <span class="comment">// end FE_SB</span>
04493 
04494     <a class="code" href="../../d6/d2/output_8c.html#a78">CleanupConsoleMessages</a>(Console);
04495 
04496     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(NULL, Console-&gt;hDC);
04497     Console-&gt;hDC = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04498 
04499     <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a3">DestroyWindow</a>(Console-&gt;hWnd);
04500     Console-&gt;hWnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04501 
04502     <span class="comment">//</span>
04503     <span class="comment">// Tell the worker thread that the window is destroyed.</span>
04504     <span class="comment">//</span>
04505 
04506     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>(0);
04507 
04508     <span class="comment">//</span>
04509     <span class="comment">// Clear out any keyboard messages we have stored away.</span>
04510     <span class="comment">//</span>
04511 
04512     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a33">ClearKeyInfo</a>(hWnd);
04513 
04514     <span class="keywordflow">if</span> (Console-&gt;hIcon != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Console-&gt;hIcon != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
04515         <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;hIcon);
04516     }
04517     <span class="keywordflow">if</span> (Console-&gt;hSmIcon != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Console-&gt;hSmIcon != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>) {
04518         <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;hSmIcon);
04519     }
04520 
04521     <span class="comment">//</span>
04522     <span class="comment">// must keep this thread handle around until after the destroywindow</span>
04523     <span class="comment">// call so that impersonation will work.</span>
04524     <span class="comment">//</span>
04525 
04526     CloseHandle(Console-&gt;ClientThreadHandle);
04527 
04528     <span class="comment">//</span>
04529     <span class="comment">// once the sendmessage returns, there will be no more input to</span>
04530     <span class="comment">// the console so we don't need to lock it.</span>
04531     <span class="comment">// also, we've freed the console handle, so no apis may access the console.</span>
04532     <span class="comment">//</span>
04533 
04534     <span class="comment">//</span>
04535     <span class="comment">// free screen buffers</span>
04536     <span class="comment">//</span>
04537 
04538     <span class="keywordflow">for</span> (Cur=Console-&gt;ScreenBuffers;Cur!=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;Cur=Next) {
04539         Next = Cur-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o23">Next</a>;
04540         <a class="code" href="../../d6/d2/output_8c.html#a46">FreeScreenBuffer</a>(Cur);
04541     }
04542 
04543     <a class="code" href="../../d8/d5/consrv_8h.html#a258">FreeAliasBuffers</a>(Console);
04544     <a class="code" href="../../d8/d5/consrv_8h.html#a260">FreeCommandHistoryBuffers</a>(Console);
04545 
04546     <span class="comment">//</span>
04547     <span class="comment">// free input buffer</span>
04548     <span class="comment">//</span>
04549 
04550     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a18">FreeInputBuffer</a>(&amp;Console-&gt;InputBuffer);
04551     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;Title);
04552     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;OriginalTitle);
04553     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;InitEvents[INITIALIZATION_SUCCEEDED]);
04554     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;InitEvents[INITIALIZATION_FAILED]);
04555     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;TerminationEvent);
04556     <span class="keywordflow">if</span> (Console-&gt;hWinSta != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04557         CloseDesktop(Console-&gt;hDesk);
04558         <a class="code" href="../../d3/d0/user32_8def.html#a72">CloseWindowStation</a>(Console-&gt;hWinSta);
04559     }
04560     <span class="keywordflow">if</span> (Console-&gt;VDMProcessHandle)
04561         CloseHandle(Console-&gt;VDMProcessHandle);
04562     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;Flags &amp; CONSOLE_VDM_REGISTERED));
04563     <span class="comment">/*if (Console-&gt;VDMBuffer != NULL) {</span>
04564 <span class="comment">        NtUnmapViewOfSection(NtCurrentProcess(),Console-&gt;VDMBuffer);</span>
04565 <span class="comment">        NtClose(Console-&gt;VDMBufferSectionHandle);</span>
04566 <span class="comment">    }*/</span>
04567 <span class="preprocessor">#if defined(FE_SB)</span>
04568 <span class="preprocessor"></span>    <a class="code" href="../../d9/d7/eudc_8h.html#a6">FreeLocalEUDC</a>(Console);
04569     <a class="code" href="../../d6/d6/foncache_8h.html#a24">DestroyFontCache</a>(Console-&gt;FontCacheInformation);
04570 <span class="preprocessor">#endif</span>
04571 <span class="preprocessor"></span>    <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a20">DestroyConsole</a>(Console);
04572 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a300" doxytag="consrv.h::DoCopy" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoCopy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">807</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.
<p>
<pre class="fragment"><div>00810 {
00811     <a class="code" href="../../d8/d5/consrv_8h.html#a307">StoreSelection</a>(Console);        <span class="comment">// store selection in clipboard</span>
00812     <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);        <span class="comment">// clear selection in console</span>
00813 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a104" doxytag="consrv.h::DoCreateScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DoCreateScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l00270">270</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00101">CONSOLE_AUTO_POSITION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00109">CONSOLE_DEFAULT_BUFFER_SIZE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00105">CONSOLE_HISTORY_NODUP</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00096">CONSOLE_QUICK_EDIT_MODE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00104">CONSOLE_USE_PRIVATE_FLAGS</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00039">FullScreenInitialized</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00113">guCaretBlinkTime</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>.
<p>
<pre class="fragment"><div>00283 {
00284     CHAR_INFO Fill,PopupFill;
00285     COORD dwScreenBufferSize, dwWindowSize;
00286     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00287     <span class="keywordtype">int</span> FontIndexWant;
00288 
00289     <span class="keywordflow">if</span> (ConsoleInfo-&gt;dwStartupFlags &amp; STARTF_USESHOWWINDOW) {
00290         Console-&gt;wShowWindow = ConsoleInfo-&gt;wShowWindow;
00291     } <span class="keywordflow">else</span> {
00292         Console-&gt;wShowWindow = SW_SHOWNORMAL;
00293     }
00294 
00295 <span class="preprocessor">#if 0</span>
00296 <span class="preprocessor"></span>    {
00297 
00298             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> i;
00299 
00300             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"[Link Server Properties for %ws]\n"</span>, ConsoleTitle );
00301             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    wFillAttribute      = 0x%04X\n"</span>, ConsoleInfo-&gt;wFillAttribute );
00302             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    wPopupFillAttribute = 0x%04X\n"</span>, ConsoleInfo-&gt;wPopupFillAttribute );
00303             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    dwScreenBufferSize  = (%d , %d)\n"</span>, ConsoleInfo-&gt;dwScreenBufferSize.X, ConsoleInfo-&gt;dwScreenBufferSize.Y );
00304             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    dwWindowSize        = (%d , %d)\n"</span>, ConsoleInfo-&gt;dwWindowSize.X, ConsoleInfo-&gt;dwWindowSize.Y );
00305             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    dwWindowOrigin      = (%d , %d)\n"</span>, ConsoleInfo-&gt;dwWindowOrigin.X, ConsoleInfo-&gt;dwWindowOrigin.Y );
00306             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    nFont               = %d\n"</span>, ConsoleInfo-&gt;nFont );
00307             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    nInputBufferSize    = %d\n"</span>, ConsoleInfo-&gt;nInputBufferSize );
00308             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    dwFontSize          = (%d , %d)\n"</span>, ConsoleInfo-&gt;dwFontSize.X, ConsoleInfo-&gt;dwFontSize.Y );
00309             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    uFontFamily         = 0x%08X\n"</span>, ConsoleInfo-&gt;uFontFamily );
00310             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    uFontWeight         = 0x%08X\n"</span>, ConsoleInfo-&gt;uFontWeight );
00311             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    FaceName            = %ws\n"</span>, ConsoleInfo-&gt;FaceName );
00312             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    uCursorSize         = %d\n"</span>, ConsoleInfo-&gt;uCursorSize );
00313             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    bFullScreen         = %s\n"</span>, ConsoleInfo-&gt;bFullScreen ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span> );
00314             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    bQuickEdit          = %s\n"</span>, ConsoleInfo-&gt;bQuickEdit  ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span> );
00315             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    bInsertMode         = %s\n"</span>, ConsoleInfo-&gt;bInsertMode ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span> );
00316             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    bAutoPosition       = %s\n"</span>, ConsoleInfo-&gt;bAutoPosition ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span> );
00317             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    uHistoryBufferSize  = %d\n"</span>, ConsoleInfo-&gt;uHistoryBufferSize );
00318             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    uNumHistoryBuffers  = %d\n"</span>, ConsoleInfo-&gt;uNumberOfHistoryBuffers );
00319             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    bHistoryNoDup       = %s\n"</span>, ConsoleInfo-&gt;bHistoryNoDup ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span> );
00320             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"    ColorTable = ["</span> );
00321             i=0;
00322             <span class="keywordflow">while</span>( i &lt; 16 )
00323             {
00324                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n         "</span>);
00325                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%08X "</span>, ConsoleInfo-&gt;ColorTable[i++]);
00326                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%08X "</span>, ConsoleInfo-&gt;ColorTable[i++]);
00327                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%08X "</span>, ConsoleInfo-&gt;ColorTable[i++]);
00328                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%08X "</span>, ConsoleInfo-&gt;ColorTable[i++]);
00329             }
00330             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"]\n\n"</span> );
00331         }
00332 <span class="preprocessor">#endif</span>
00333 <span class="preprocessor"></span>
00334     <span class="comment">//</span>
00335     <span class="comment">// Get values from consoleinfo (which was initialized through link)</span>
00336     <span class="comment">//</span>
00337 
00338     Fill.Attributes = ConsoleInfo-&gt;wFillAttribute;
00339     Fill.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
00340     PopupFill.Attributes = ConsoleInfo-&gt;wPopupFillAttribute;
00341     PopupFill.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
00342 
00343     dwScreenBufferSize = ConsoleInfo-&gt;dwScreenBufferSize;
00344     <span class="keywordflow">if</span> (!(ConsoleInfo-&gt;dwStartupFlags &amp; STARTF_USECOUNTCHARS)) {
00345         <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>) {
00346             dwScreenBufferSize.X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwScreenBufferSize.X, 80);
00347             dwScreenBufferSize.Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwScreenBufferSize.Y, 25);
00348         }
00349     }
00350     <span class="keywordflow">if</span> (dwScreenBufferSize.X == 0)
00351         dwScreenBufferSize.X = 1;
00352     <span class="keywordflow">if</span> (dwScreenBufferSize.Y == 0)
00353         dwScreenBufferSize.Y = 1;
00354 
00355     <span class="comment">//</span>
00356     <span class="comment">// Grab font</span>
00357     <span class="comment">//</span>
00358 <span class="preprocessor">#if defined(FE_SB)</span>
00359 <span class="preprocessor"></span>    FontIndexWant = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(ConsoleInfo-&gt;uFontFamily,
00360                                    ConsoleInfo-&gt;FaceName,
00361                                    ConsoleInfo-&gt;dwFontSize,
00362                                    ConsoleInfo-&gt;uFontWeight,
00363                                    ConsoleInfo-&gt;uCodePage
00364                                   );
00365 <span class="preprocessor">#else</span>
00366 <span class="preprocessor"></span>    FontIndexWant = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(ConsoleInfo-&gt;uFontFamily,
00367                                    ConsoleInfo-&gt;FaceName,
00368                                    ConsoleInfo-&gt;dwFontSize,
00369                                    ConsoleInfo-&gt;uFontWeight);
00370 <span class="preprocessor">#endif</span>
00371 <span class="preprocessor"></span>
00372     <span class="comment">//</span>
00373     <span class="comment">// grab window size information</span>
00374     <span class="comment">//</span>
00375 
00376     dwWindowSize = ConsoleInfo-&gt;dwWindowSize;
00377     <span class="keywordflow">if</span> (ConsoleInfo-&gt;dwStartupFlags &amp; STARTF_USESIZE) {
00378         dwWindowSize.X /= <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndexWant].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
00379         dwWindowSize.Y /= <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndexWant].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
00380     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>) {
00381         dwWindowSize.X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwWindowSize.X, 80);
00382         dwWindowSize.Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwWindowSize.Y, 25);
00383     }
00384     <span class="keywordflow">if</span> (dwWindowSize.X == 0)
00385         dwWindowSize.X = 1;
00386     <span class="keywordflow">if</span> (dwWindowSize.Y == 0)
00387         dwWindowSize.Y = 1;
00388 
00389     <span class="keywordflow">if</span> (dwScreenBufferSize.X &lt; dwWindowSize.X)
00390         dwScreenBufferSize.X = dwWindowSize.X;
00391     <span class="keywordflow">if</span> (dwScreenBufferSize.Y &lt; dwWindowSize.Y)
00392         dwScreenBufferSize.Y = dwWindowSize.Y;
00393 
00394     Console-&gt;dwWindowOriginX = ConsoleInfo-&gt;dwWindowOrigin.X;
00395     Console-&gt;dwWindowOriginY = ConsoleInfo-&gt;dwWindowOrigin.Y;
00396 
00397     <span class="keywordflow">if</span> (ConsoleInfo-&gt;bAutoPosition) {
00398         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a16">CONSOLE_AUTO_POSITION</a>;
00399         Console-&gt;dwWindowOriginX = CW_USEDEFAULT;
00400     } <span class="keywordflow">else</span> {
00401         Console-&gt;WindowRect.left = Console-&gt;dwWindowOriginX;
00402         Console-&gt;WindowRect.top = Console-&gt;dwWindowOriginY;
00403         Console-&gt;WindowRect.right = Console-&gt;dwWindowOriginX + dwWindowSize.X * <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndexWant].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
00404         Console-&gt;WindowRect.bottom = Console-&gt;dwWindowOriginY + dwWindowSize.Y * <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndexWant].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
00405     }
00406 
00407 <span class="preprocessor">#ifdef i386</span>
00408 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a12">FullScreenInitialized</a>) {
00409         <span class="keywordflow">if</span> (ConsoleInfo-&gt;bFullScreen) {
00410             Console-&gt;FullScreenFlags = CONSOLE_FULLSCREEN;
00411         }
00412     }
00413 <span class="preprocessor">#endif</span>
00414 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ConsoleInfo-&gt;bQuickEdit) {
00415         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00416     }
00417     Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>;
00418 
00419     Console-&gt;InsertMode = (ConsoleInfo-&gt;bInsertMode != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00420     Console-&gt;CommandHistorySize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)ConsoleInfo-&gt;uHistoryBufferSize;
00421     Console-&gt;MaxCommandHistories = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)ConsoleInfo-&gt;uNumberOfHistoryBuffers;
00422     <span class="keywordflow">if</span> (ConsoleInfo-&gt;bHistoryNoDup) {
00423         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a20">CONSOLE_HISTORY_NODUP</a>;
00424     } <span class="keywordflow">else</span> {
00425         Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a20">CONSOLE_HISTORY_NODUP</a>;
00426     }
00427     RtlCopyMemory(Console-&gt;ColorTable, ConsoleInfo-&gt;ColorTable, <span class="keyword">sizeof</span>( Console-&gt;ColorTable ));
00428 
00429 <span class="preprocessor">#if defined(FE_SB)</span>
00430 <span class="preprocessor"></span>    <span class="comment">// for FarEast version, we want get the code page from registry or shell32,</span>
00431     <span class="comment">// so we can specify console codepage by console.cpl or shell32</span>
00432     <span class="comment">// default codepage is OEMCP. scotthsu</span>
00433     Console-&gt;CP = ConsoleInfo-&gt;uCodePage;
00434     Console-&gt;OutputCP = ConsoleInfo-&gt;uCodePage;
00435 <span class="preprocessor">#if 0</span>
00436 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()){
00437         Console-&gt;fIsDBCSCP = !!<a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;CP);
00438         Console-&gt;fIsDBCSOutputCP = !!<a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;OutputCP);
00439     }
00440     <span class="keywordflow">else</span> {
00441         Console-&gt;fIsDBCSCP = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00442         Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00443     }
00444 <span class="preprocessor">#else</span>
00445 <span class="preprocessor"></span>    Console-&gt;fIsDBCSCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;CP);
00446     Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;OutputCP);
00447 <span class="preprocessor">#endif</span>
00448 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00449 <span class="preprocessor"></span><span class="preprocessor">#if defined(FE_IME)</span>
00450 <span class="preprocessor"></span>    Console-&gt;ConsoleIme.ScrollWaitTimeout = <a class="code" href="../../d6/d2/output_8c.html#a28">guCaretBlinkTime</a> * 2;
00451 <span class="preprocessor">#endif</span>
00452 <span class="preprocessor"></span>TryNewSize:
00453     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a42">CreateScreenBuffer</a>(&amp;Console-&gt;ScreenBuffers,
00454                                 dwWindowSize,
00455                                 FontIndexWant,
00456                                 dwScreenBufferSize,
00457                                 Fill,
00458                                 PopupFill,
00459                                 Console,
00460                                 CONSOLE_TEXTMODE_BUFFER,
00461                                 NULL,
00462                                 NULL,
00463                                 NULL,
00464                                 ConsoleInfo-&gt;uCursorSize,
00465                                 ConsoleInfo-&gt;FaceName
00466                                );
00467     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MEMORY) {
00468         <span class="comment">//</span>
00469         <span class="comment">// If we failed to create a large buffer, try again with a small one.</span>
00470         <span class="comment">//</span>
00471         <span class="keywordflow">if</span> (dwScreenBufferSize.X &gt; 80 || dwScreenBufferSize.Y &gt; 50) {
00472             dwScreenBufferSize.X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwScreenBufferSize.X, 80);
00473             dwScreenBufferSize.Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwScreenBufferSize.Y, 50);
00474             dwWindowSize.X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwWindowSize.X, dwScreenBufferSize.X);
00475             dwWindowSize.Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwWindowSize.Y, dwScreenBufferSize.Y);
00476             Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a24">CONSOLE_DEFAULT_BUFFER_SIZE</a>;
00477             <span class="keywordflow">goto</span> TryNewSize;
00478         }
00479     }
00480 
00481     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00482 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a130" doxytag="consrv.h::DoDrop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoDrop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a95" doxytag="consrv.h::DoFind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoFind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/find_8c-source.html#l00268">268</a> of file <a class="el" href="../../d1/d3/find_8c-source.html">find.c</a>.
<p>
References <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, and <a class="el" href="../../d7/d6/menu_8h-source.html#l00055">ID_FINDDLG</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>00271 {
00272     DialogBoxParam(ghInstance,
00273                    MAKEINTRESOURCE(ID_FINDDLG),
00274                    Console-&gt;hWnd,
00275                    FindDialogProc,
00276                    (LPARAM)Console);
00277 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a183" doxytag="consrv.h::DoFontEnum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DoFontEnum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HDC hDC&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR pwszFace&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TTPointSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a301" doxytag="consrv.h::DoMark" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoMark           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01167">1167</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01170 {
01171     <a class="code" href="../../d7/d8/ntcon_2server_2clipbrd_8c.html#a11">InitSelection</a>(Console);        <span class="comment">// initialize selection</span>
01172 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a304" doxytag="consrv.h::DoPaste" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoPaste           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">1008</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00306">CloseClipboard</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00390">GetClipboardData()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00540">OpenClipboard()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.
<p>
<pre class="fragment"><div>01019 {
01020     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
01021     HANDLE ClipboardDataHandle;
01022 
01023     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>) {
01024         <span class="keywordflow">return</span>;
01025     }
01026 
01027     <span class="comment">//</span>
01028     <span class="comment">// Get paste data from clipboard</span>
01029     <span class="comment">//</span>
01030 
01031     Success = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(Console-&gt;hWnd);
01032     <span class="keywordflow">if</span> (!Success)
01033         <span class="keywordflow">return</span>;
01034 
01035     <span class="keywordflow">if</span> (Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01036         PWCHAR pwstr;
01037 
01038         ClipboardDataHandle = <a class="code" href="../../d3/d8/client_8c.html#a42">GetClipboardData</a>(CF_UNICODETEXT);
01039         <span class="keywordflow">if</span> (ClipboardDataHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01040             <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();   <span class="comment">// Close clipboard</span>
01041             <span class="keywordflow">return</span>;
01042         }
01043         pwstr = GlobalLock(ClipboardDataHandle);
01044         <a class="code" href="../../d8/d5/consrv_8h.html#a303">DoStringPaste</a>(Console,pwstr,(ULONG)GlobalSize(ClipboardDataHandle)/<span class="keyword">sizeof</span>(WCHAR));
01045         GlobalUnlock(ClipboardDataHandle);
01046 
01047     } <span class="keywordflow">else</span> {
01048         HBITMAP hBitmapSource,hBitmapTarget;
01049         HDC hDCMemSource,hDCMemTarget;
01050         BITMAP bm;
01051         <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01052 
01053         hBitmapSource = <a class="code" href="../../d3/d8/client_8c.html#a42">GetClipboardData</a>(CF_BITMAP);
01054         <span class="keywordflow">if</span> (hBitmapSource) {
01055 
01056             ScreenInfo = Console-&gt;CurrentScreenBuffer;
01057             <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex,
01058                                   FALSE, NULL);
01059 
01060             hBitmapTarget = CreateDIBitmap(Console-&gt;hDC,
01061                                      &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo-&gt;bmiHeader,
01062                                      CBM_INIT,
01063                                      ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
01064                                      ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
01065                                      ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage
01066                                     );
01067             <span class="keywordflow">if</span> (hBitmapTarget) {
01068                 hDCMemTarget = CreateCompatibleDC ( Console-&gt;hDC );
01069                 hDCMemSource = CreateCompatibleDC ( Console-&gt;hDC );
01070                 SelectObject( hDCMemTarget, hBitmapTarget );
01071                 SelectObject( hDCMemSource, hBitmapSource );
01072                 GetObjectW(hBitmapSource, <span class="keyword">sizeof</span> (BITMAP), (LPSTR) &amp;bm);
01073                 BitBlt ( hDCMemTarget, 0, 0, bm.bmWidth, bm.bmHeight,
01074                      hDCMemSource, 0, 0, SRCCOPY);
01075                 GetObjectW(hBitmapTarget, <span class="keyword">sizeof</span> (BITMAP), (LPSTR) &amp;bm);
01076 
01077                 <span class="comment">// copy the bits from the DC to memory</span>
01078 
01079                 GetDIBits(hDCMemTarget, hBitmapTarget, 0, bm.bmHeight,
01080                           ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
01081                           ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
01082                           ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage);
01083                 DeleteDC(hDCMemSource);
01084                 DeleteDC(hDCMemTarget);
01085                 DeleteObject(hBitmapTarget);
01086                 InvalidateRect(Console-&gt;hWnd,NULL,FALSE); <span class="comment">// force repaint</span>
01087             }
01088             <a class="code" href="../../d2/d5/mutant_8c.html#a8">NtReleaseMutant</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex, NULL);
01089         }
01090     }
01091     <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();
01092     <span class="keywordflow">return</span>;
01093 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a311" doxytag="consrv.h::DoScroll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoScroll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01211">1211</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00033">msgScrollMode</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01214 {
01215     <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>)) {
01216         <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgScrollMode,TRUE);
01217         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>;
01218     }
01219 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a302" doxytag="consrv.h::DoSelectAll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoSelectAll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">1175</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>01178 {
01179     COORD Position;
01180     COORD WindowOrigin;
01181     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01182 
01183     <span class="comment">// clear any old selections</span>
01184     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
01185         <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);
01186     }
01187 
01188     <span class="comment">// save the old window position</span>
01189     ScreenInfo = Console-&gt;CurrentScreenBuffer;
01190     WindowOrigin.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
01191     WindowOrigin.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
01192 
01193     <span class="comment">// initialize selection</span>
01194     Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
01195     Console-&gt;SelectionFlags = <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a> | <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
01196     Console-&gt;SelectionAnchor.X = Console-&gt;SelectionRect.Left = Console-&gt;SelectionRect.Right = 0;
01197     Console-&gt;SelectionAnchor.Y = Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = 0;
01198     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
01199     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,TRUE);
01200 
01201     <span class="comment">// extend selection</span>
01202     Position.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X - 1;
01203     Position.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y;
01204     <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console, Position);
01205 
01206     <span class="comment">// restore the old window position</span>
01207     <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo, TRUE, WindowOrigin);
01208 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a303" doxytag="consrv.h::DoStringPaste" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoStringPaste           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>DataSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">835</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00057">DATA_CHUNK_SIZE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00115">LoadKeyEvent</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00339">MapVirtualKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l01013">VkKeyScan()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l05853">DoDrop()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">DoPaste()</a>.
<p>
<pre class="fragment"><div>00840 {
00841     PINPUT_RECORD StringData,CurRecord;
00842     PWCHAR CurChar;
00843     WCHAR Char;
00844     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00845     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ChunkSize,j;
00846     ULONG EventsWritten;
00847 
00848 
00849     <span class="keywordflow">if</span>(!pwStr) {
00850        <span class="keywordflow">return</span>;
00851     }
00852 
00853     <span class="keywordflow">if</span> (DataSize &gt; <a class="code" href="../../d8/d5/consrv_8h.html#a7">DATA_CHUNK_SIZE</a>) {
00854         ChunkSize = <a class="code" href="../../d8/d5/consrv_8h.html#a7">DATA_CHUNK_SIZE</a>;
00855     } <span class="keywordflow">else</span> {
00856         ChunkSize = DataSize;
00857     }
00858 
00859     <span class="comment">//</span>
00860     <span class="comment">// allocate space to copy data.</span>
00861     <span class="comment">//</span>
00862 
00863     StringData = (PINPUT_RECORD)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),ChunkSize*<span class="keyword">sizeof</span>(INPUT_RECORD)*8); <span class="comment">// 8 is maximum number of events per char</span>
00864     <span class="keywordflow">if</span> (StringData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00865         <span class="keywordflow">return</span>;
00866     }
00867 
00868     <span class="comment">//</span>
00869     <span class="comment">// transfer data to the input buffer in chunks</span>
00870     <span class="comment">//</span>
00871 
00872     CurChar = pwStr;   <span class="comment">// LATER remove this</span>
00873     <span class="keywordflow">for</span> (j = 0; j &lt; DataSize; j += ChunkSize) {
00874         <span class="keywordflow">if</span> (ChunkSize &gt; DataSize - j) {
00875             ChunkSize = DataSize - j;
00876         }
00877         CurRecord = StringData;
00878         <span class="keywordflow">for</span> (i = 0, EventsWritten = 0; i &lt; ChunkSize; i++) {
00879             <span class="comment">// filter out LF if not first char and preceded by CR</span>
00880             Char = *CurChar;
00881             <span class="keywordflow">if</span> (Char != <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a> || (i==0 &amp;&amp; j==0) || (*(CurChar-1)) != <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>) {
00882                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> KeyState;
00883                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> KeyFlags;
00884                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> AltGr=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00885                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Shift=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00886 
00887                 <span class="keywordflow">if</span> (Char == 0) {
00888                     j = DataSize;
00889                     <span class="keywordflow">break</span>;
00890                 }
00891 
00892                 KeyState = <a class="code" href="../../d0/d8/ntcftxt_8h.html#a31">VkKeyScan</a>(Char);
00893 <span class="preprocessor">#if defined(FE_SB)</span>
00894 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00895                     (KeyState == -1)) {
00896                     WORD CharType;
00897                     <span class="comment">//</span>
00898                     <span class="comment">// Determine DBCS character because these character doesn't know by VkKeyScan.</span>
00899                     <span class="comment">// GetStringTypeW(CT_CTYPE3) &amp; C3_ALPHA can determine all linguistic characters.</span>
00900                     <span class="comment">// However, this is not include symbolic character for DBCS.</span>
00901                     <span class="comment">// IsConsoleFullWidth can help for DBCS symbolic character.</span>
00902                     <span class="comment">//</span>
00903                     GetStringTypeW(CT_CTYPE3,&amp;Char,1,&amp;CharType);
00904                     <span class="keywordflow">if</span> ((CharType &amp; C3_ALPHA) ||
00905                         IsConsoleFullWidth(Console-&gt;hDC,Console-&gt;OutputCP,Char)) {
00906                         KeyState = 0;
00907                     }
00908                 }
00909 <span class="preprocessor">#endif</span>
00910 <span class="preprocessor"></span>
00911                 <span class="comment">// if VkKeyScanW fails (char is not in kbd layout), we must</span>
00912                 <span class="comment">// emulate the key being input through the numpad</span>
00913 
00914                 <span class="keywordflow">if</span> (KeyState == -1) {
00915                     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> CharString[4];
00916                     UCHAR OemChar;
00917                     PCHAR pCharString;
00918 
00919                     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;OutputCP,
00920                                  &amp;Char,
00921                                  1,
00922                                  &amp;OemChar,
00923                                  1
00924                                 );
00925 
00926                     _itoa(OemChar, CharString, 10);
00927 
00928                     EventsWritten++;
00929                     <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,VK_MENU,0x38,LEFT_ALT_PRESSED);
00930                     CurRecord++;
00931 
00932                     <span class="keywordflow">for</span> (pCharString=CharString;*pCharString;pCharString++) {
00933                         WORD wVirtualKey, wScancode;
00934                         EventsWritten++;
00935                         wVirtualKey = *pCharString-<span class="charliteral">'0'</span>+VK_NUMPAD0;
00936                         wScancode = (WORD)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a18">MapVirtualKey</a>(wVirtualKey, 0);
00937                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,wVirtualKey,wScancode,LEFT_ALT_PRESSED);
00938                         CurRecord++;
00939                         EventsWritten++;
00940                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,0,wVirtualKey,wScancode,LEFT_ALT_PRESSED);
00941                         CurRecord++;
00942                     }
00943 
00944                     EventsWritten++;
00945                     <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,Char,VK_MENU,0x38,0);
00946                     CurRecord++;
00947                 } <span class="keywordflow">else</span> {
00948                     KeyFlags = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(KeyState);
00949 
00950                     <span class="comment">// handle yucky alt-gr keys</span>
00951                     <span class="keywordflow">if</span> ((KeyFlags &amp; 6) == 6) {
00952                         AltGr=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00953                         EventsWritten++;
00954                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,VK_MENU,0x38,ENHANCED_KEY | LEFT_CTRL_PRESSED | RIGHT_ALT_PRESSED);
00955                         CurRecord++;
00956                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (KeyFlags &amp; 1) {
00957                         Shift=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00958                         EventsWritten++;
00959                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,TRUE,0,VK_SHIFT,0x2a,SHIFT_PRESSED);
00960                         CurRecord++;
00961                     }
00962 
00963                     EventsWritten++;
00964                     <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,
00965                                  TRUE,
00966                                  Char,
00967                                  <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(KeyState),
00968                                  (WORD)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a18">MapVirtualKey</a>(CurRecord-&gt;Event.KeyEvent.wVirtualKeyCode,0),
00969                                  0);
00970                     <span class="keywordflow">if</span> (KeyFlags &amp; 1)
00971                         CurRecord-&gt;Event.KeyEvent.dwControlKeyState |= SHIFT_PRESSED;
00972                     <span class="keywordflow">if</span> (KeyFlags &amp; 2)
00973                         CurRecord-&gt;Event.KeyEvent.dwControlKeyState |= LEFT_CTRL_PRESSED;
00974                     <span class="keywordflow">if</span> (KeyFlags &amp; 4)
00975                         CurRecord-&gt;Event.KeyEvent.dwControlKeyState |= RIGHT_ALT_PRESSED;
00976                     CurRecord++;
00977 
00978                     EventsWritten++;
00979                     *CurRecord = *(CurRecord-1);
00980                     CurRecord-&gt;Event.KeyEvent.bKeyDown = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00981                     CurRecord++;
00982 
00983                     <span class="comment">// handle yucky alt-gr keys</span>
00984                     <span class="keywordflow">if</span> (AltGr) {
00985                         EventsWritten++;
00986                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,0,VK_MENU,0x38,ENHANCED_KEY);
00987                         CurRecord++;
00988                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Shift) {
00989                         EventsWritten++;
00990                         <a class="code" href="../../d9/d3/input_8h.html#a27">LoadKeyEvent</a>(CurRecord,FALSE,0,VK_SHIFT,0x2a,0);
00991                         CurRecord++;
00992                     }
00993                 }
00994             }
00995             CurChar++;
00996         }
00997         EventsWritten = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>(Console,
00998                                          &amp;Console-&gt;InputBuffer,
00999                                          StringData,
01000                                          EventsWritten
01001                                          );
01002     }
01003     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(StringData);
01004     <span class="keywordflow">return</span>;
01005 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a159" doxytag="consrv.h::EnumerateFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS EnumerateFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Flags</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">515</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00080">AddFaceNode()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01106">tagFACENODE::awch</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00035">DefaultFaceName</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00045">DefaultFontFamily</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00043">DefaultFontIndex</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00044">DefaultFontSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01105">tagFACENODE::dwFlag</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00930">EF_DEFFACE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00927">EF_ENUMERATED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00925">EF_NEW</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00928">EF_OEMFONT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00926">EF_OLD</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00929">EF_TTFONT</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00044">_FONT_INFO::Family</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">FONT_TAG</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00032">FontInfoLength</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00062">gpFaceNames</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00022">INITIAL_FONTS</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01104">tagFACENODE::pNext</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>.
<p>
<pre class="fragment"><div>00517 {
00518     TEXTMETRIC tmi;
00519     HDC hDC;
00520     <a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> pFN;
00521     ULONG ulOldEnumFilter;
00522     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FontIndex;
00523     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwFontType = 0;
00524 
00525     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"EnumerateFonts %lx\n"</span>, Flags));
00526 
00527     dwFontType = (<a class="code" href="../../d8/d5/consrv_8h.html#a54">EF_TTFONT</a>|<a class="code" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>|<a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a>) &amp; Flags;
00528 
00529     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00530         <span class="comment">//</span>
00531         <span class="comment">// allocate memory for the font array</span>
00532         <span class="comment">//</span>
00533         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> = 0;
00534 
00535         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> = (<a class="code" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( FONT_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/struct__FONT__INFO.html">FONT_INFO</a>) * INITIAL_FONTS);
00536         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00537             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00538         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a> = <a class="code" href="../../d7/d6/font_8h.html#a0">INITIAL_FONTS</a>;
00539     }
00540 
00541     hDC = CreateDCW(L<span class="stringliteral">"DISPLAY"</span>,NULL,NULL,NULL);
00542 
00543     <span class="comment">// Before enumeration, turn off font enumeration filters.</span>
00544     ulOldEnumFilter = SetFontEnumeration(0);
00545     <span class="comment">// restore all the other flags</span>
00546     SetFontEnumeration(ulOldEnumFilter &amp; ~FE_FILTER_TRUETYPE);
00547 
00548     <span class="keywordflow">if</span> (Flags &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a>) {
00549         SelectObject(hDC,GetStockObject(OEM_FIXED_FONT));
00550 
00551         <span class="keywordflow">if</span> (GetTextMetricsW(hDC, &amp;tmi)) {
00552             <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(tmi.tmMaxCharWidth);
00553             <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(tmi.tmHeight+tmi.tmExternalLeading);
00554             <a class="code" href="../../d0/d3/dbcs_8h.html#a15">DefaultFontFamily</a> = tmi.tmPitchAndFamily;
00555 <span class="preprocessor">#if defined(FE_SB)</span>
00556 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (IS_ANY_DBCS_CHARSET(tmi.tmCharSet))
00557                 <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X /= 2;
00558 <span class="preprocessor">#endif</span>
00559 <span class="preprocessor"></span>        }
00560         GetTextFaceW(hDC, LF_FACESIZE, DefaultFaceName);
00561 <span class="preprocessor">#if defined(FE_SB)</span>
00562 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"Default (OEM) Font %ls (%d,%d) CharSet 0x%02X\n"</span>, DefaultFaceName,
00563                 <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X, <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y,
00564                 tmi.tmCharSet));
00565 <span class="preprocessor">#else</span>
00566 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"Default (OEM) Font %ls (%d,%d)\n"</span>, DefaultFaceName,
00567                 <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X, <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y));
00568 <span class="preprocessor">#endif</span>
00569 <span class="preprocessor"></span>
00570         <span class="comment">// Make sure we are going to enumerate the OEM face.</span>
00571         pFN = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a20">AddFaceNode</a>(&amp;gpFaceNames, DefaultFaceName);
00572         pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> |= <a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a> | <a class="code" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>;
00573     }
00574 
00575     <span class="comment">// Use DoFontEnum to get all fonts from the system.  Our FontEnum</span>
00576     <span class="comment">// proc puts just the ones we want into an array</span>
00577     <span class="comment">//</span>
00578     <span class="keywordflow">for</span> (pFN = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a17">gpFaceNames</a>; pFN; pFN = pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o0">pNext</a>) {
00579         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"\"%ls\" is %s%s%s%s%s%s\n"</span>, pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>,
00580             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_NEW        ? <span class="stringliteral">"NEW "</span>        : <span class="stringliteral">" "</span>,
00581             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_OLD        ? <span class="stringliteral">"OLD "</span>        : <span class="stringliteral">" "</span>,
00582             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_ENUMERATED ? <span class="stringliteral">"ENUMERATED "</span> : <span class="stringliteral">" "</span>,
00583             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_OEMFONT    ? <span class="stringliteral">"OEMFONT "</span>    : <span class="stringliteral">" "</span>,
00584             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_TTFONT     ? <span class="stringliteral">"TTFONT "</span>     : <span class="stringliteral">" "</span>,
00585             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_DEFFACE    ? <span class="stringliteral">"DEFFACE "</span>    : <span class="stringliteral">" "</span>));
00586 
00587         <span class="keywordflow">if</span> ((pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; dwFontType) == 0) {
00588             <span class="comment">// not the kind of face we want</span>
00589             <span class="keywordflow">continue</span>;
00590         }
00591         <span class="keywordflow">if</span> (pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a52">EF_ENUMERATED</a>) {
00592             <span class="comment">// we already enumerated this face</span>
00593             <span class="keywordflow">continue</span>;
00594         }
00595 
00596         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a23">DoFontEnum</a>(hDC, pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>, <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y);
00597         pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> |= <a class="code" href="../../d8/d5/consrv_8h.html#a52">EF_ENUMERATED</a>;
00598     }
00599 
00600 
00601     <span class="comment">// After enumerating fonts, restore the font enumeration filter.</span>
00602     SetFontEnumeration(ulOldEnumFilter);
00603 
00604     DeleteDC(hDC);
00605 
00606     <span class="comment">// Make sure the default font is set correctly</span>
00607     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> &gt; 0 &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X == 0 &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y == 0) {
00608         <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[0].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
00609         <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[0].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
00610         <a class="code" href="../../d0/d3/dbcs_8h.html#a15">DefaultFontFamily</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[0].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>;
00611     }
00612 
00613     <span class="keywordflow">for</span> (FontIndex = 0; FontIndex &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; FontIndex++) {
00614         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X == <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X &amp;&amp;
00615             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y == <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y &amp;&amp;
00616             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a> == <a class="code" href="../../d0/d3/dbcs_8h.html#a15">DefaultFontFamily</a>) {
00617 <span class="preprocessor">#if defined(FE_SB)</span>
00618 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00619                 !IS_ANY_DBCS_CHARSET(FontInfo[FontIndex].tmCharSet))
00620             {
00621                 <span class="keywordflow">continue</span> ;
00622             }
00623 <span class="preprocessor">#endif</span>
00624 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
00625         }
00626     }
00627     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FontIndex &lt; NumberOfFonts);
00628     <span class="keywordflow">if</span> (FontIndex &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>) {
00629         <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a> = FontIndex;
00630     } <span class="keywordflow">else</span> {
00631         <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a> = 0;
00632     }
00633     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"EnumerateFonts : DefaultFontIndex = %ld\n"</span>, DefaultFontIndex));
00634 
00635     <span class="keywordflow">return</span> STATUS_SUCCESS;
00636 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a305" doxytag="consrv.h::ExtendSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExtendSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>CursorPosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">178</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00133">CON_FONTSIZE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02348">MakeCursorVisible()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01231">ScrollIfNecessary()</a>.
<p>
<pre class="fragment"><div>00189 {
00190     SMALL_RECT OldSelectionRect;
00191     HRGN OldRegion,NewRegion,CombineRegion;
00192     COORD FontSize;
00193     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo = Console-&gt;CurrentScreenBuffer;
00194 
00195     <span class="keywordflow">if</span> (CursorPosition.X &lt; 0) {
00196         CursorPosition.X = 0;
00197     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.X &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X) {
00198         CursorPosition.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X-1;
00199     }
00200 
00201     <span class="keywordflow">if</span> (CursorPosition.Y &lt; 0) {
00202         CursorPosition.Y = 0;
00203     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.Y &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00204         CursorPosition.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-1;
00205     }
00206 
00207     <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>)) {
00208 
00209         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00210             <span class="comment">// scroll if necessary to make cursor visible.</span>
00211             <a class="code" href="../../d0/d7/server_2stream_8c.html#a28">MakeCursorVisible</a>(ScreenInfo, CursorPosition);
00212             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;SelectionFlags &amp; CONSOLE_MOUSE_SELECTION));
00213 
00214             <span class="comment">//</span>
00215             <span class="comment">// if the selection rect hasn't actually been started,</span>
00216             <span class="comment">// the selection cursor is still blinking.  turn it off.</span>
00217             <span class="comment">//</span>
00218 
00219             <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
00220         }
00221         Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
00222         Console-&gt;SelectionRect.Left =Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
00223         Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
00224 
00225         <span class="comment">// invert the cursor corner</span>
00226 
00227 <span class="preprocessor">#ifdef FE_SB</span>
00228 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
00229                 ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00230 <span class="preprocessor">#else</span>
00231 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00232 <span class="preprocessor">#endif</span>
00233 <span class="preprocessor"></span>        {
00234             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00235         }
00236     } <span class="keywordflow">else</span> {
00237 
00238         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00239             <span class="comment">// scroll if necessary to make cursor visible.</span>
00240             <a class="code" href="../../d0/d7/server_2stream_8c.html#a28">MakeCursorVisible</a>(ScreenInfo,CursorPosition);
00241         }
00242 <span class="preprocessor">#ifdef FE_SB</span>
00243 <span class="preprocessor"></span>        <span class="comment">//</span>
00244         <span class="comment">// uninvert old selection</span>
00245         <span class="comment">//</span>
00246         <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
00247             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console, &amp;Console-&gt;SelectionRect);
00248         }
00249 <span class="preprocessor">#endif  // FE_SB</span>
00250 <span class="preprocessor"></span>    }
00251 
00252     <span class="comment">//</span>
00253     <span class="comment">// update selection rect</span>
00254     <span class="comment">//</span>
00255 
00256     OldSelectionRect = Console-&gt;SelectionRect;
00257     <span class="keywordflow">if</span> (CursorPosition.X &lt;= Console-&gt;SelectionAnchor.X) {
00258         Console-&gt;SelectionRect.Left = CursorPosition.X;
00259         Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
00260     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.X &gt; Console-&gt;SelectionAnchor.X) {
00261         Console-&gt;SelectionRect.Right = CursorPosition.X;
00262         Console-&gt;SelectionRect.Left = Console-&gt;SelectionAnchor.X;
00263     }
00264     <span class="keywordflow">if</span> (CursorPosition.Y &lt;= Console-&gt;SelectionAnchor.Y) {
00265         Console-&gt;SelectionRect.Top = CursorPosition.Y;
00266         Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
00267     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.Y &gt; Console-&gt;SelectionAnchor.Y) {
00268         Console-&gt;SelectionRect.Bottom = CursorPosition.Y;
00269         Console-&gt;SelectionRect.Top = Console-&gt;SelectionAnchor.Y;
00270     }
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">// change inverted selection</span>
00274     <span class="comment">//</span>
00275 <span class="preprocessor">#ifdef FE_SB</span>
00276 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
00277         <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console, &amp;Console-&gt;SelectionRect);
00278     } <span class="keywordflow">else</span>
00279 <span class="preprocessor">#endif</span>
00280 <span class="preprocessor"></span>    {
00281         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00282             FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a29">CON_FONTSIZE</a>(Console);
00283         } <span class="keywordflow">else</span> {
00284             FontSize.X = 1;
00285             FontSize.Y = 1;
00286         }
00287         CombineRegion = CreateRectRgn(0,0,0,0);
00288         OldRegion = CreateRectRgn((OldSelectionRect.Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left)*FontSize.X,
00289                                   (OldSelectionRect.Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top)*FontSize.Y,
00290                                   (OldSelectionRect.Right-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left+1)*FontSize.X,
00291                                   (OldSelectionRect.Bottom-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top+1)*FontSize.Y
00292                                  );
00293         NewRegion = CreateRectRgn((Console-&gt;SelectionRect.Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left)*FontSize.X,
00294                                   (Console-&gt;SelectionRect.Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top)*FontSize.Y,
00295                                   (Console-&gt;SelectionRect.Right-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left+1)*FontSize.X,
00296                                   (Console-&gt;SelectionRect.Bottom-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top+1)*FontSize.Y
00297                                  );
00298         CombineRgn(CombineRegion,OldRegion,NewRegion,RGN_XOR);
00299 
00300         InvertRgn(Console-&gt;hDC,CombineRegion);
00301         DeleteObject(OldRegion);
00302         DeleteObject(NewRegion);
00303         DeleteObject(CombineRegion);
00304     }
00305 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a179" doxytag="consrv.h::FalseUnicodeToRealUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FalseUnicodeToRealUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">1676</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01757">RtlCustomCPToUnicodeN()</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00905">RtlUnicodeToMultiByteN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">DrawCommandListPopup()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00924">SB_TranslateOutputToOemUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
<pre class="fragment"><div>01689 {
01690     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01691     LPSTR Temp;
01692     ULONG TempLength;
01693     ULONG Length;
01694     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01695     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> NormalChars;
01696     <span class="keywordtype">int</span> i;
01697 
01698     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"UnicodeAnsiToUnicodeAnsi U-&gt;ACP:%d-&gt;U %.*ls\n"</span>, Codepage,
01699             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01700 <span class="preprocessor">#if defined(FE_SB)</span>
01701 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a> &amp;&amp; Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>)
01702         <span class="keywordflow">return</span> STATUS_SUCCESS;
01703     <span class="keywordflow">if</span> (SourceLength == 0 )
01704         <span class="keywordflow">return</span> STATUS_SUCCESS;
01705 <span class="preprocessor">#endif</span>
01706 <span class="preprocessor"></span>    NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01707     <span class="comment">/*</span>
01708 <span class="comment">     * Test for characters &lt; 0x20 or &gt;= 0x7F.  If none are found, we don't have</span>
01709 <span class="comment">     * any conversion to do!</span>
01710 <span class="comment">     */</span>
01711     <span class="keywordflow">for</span> (i=0;i&lt;SourceLength;i++) {
01712         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Source[i] - 0x20) &gt; 0x5e) {
01713             NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01714             <span class="keywordflow">break</span>;
01715         }
01716     }
01717     <span class="keywordflow">if</span> (NormalChars) {
01718         <span class="keywordflow">return</span> STATUS_SUCCESS;
01719     }
01720 
01721     TempLength = SourceLength;
01722     <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01723         Temp = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TempLength);
01724         <span class="keywordflow">if</span> (Temp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01725             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01726         }
01727     } <span class="keywordflow">else</span> {
01728         Temp = StackBuffer;
01729     }
01730     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
01731         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = WideCharToMultiByte(USACP,
01732                                  0,
01733                                  Source,
01734                                  SourceLength,
01735                                  Temp,
01736                                  TempLength,
01737                                  NULL,
01738                                  NULL);
01739     } <span class="keywordflow">else</span> {
01740         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a37">RtlUnicodeToMultiByteN</a>(Temp,
01741                                     TempLength,
01742                                     &amp;Length,
01743                                     Source,
01744                                     SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01745                                    );
01746     }
01747 
01748     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01749         <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01750             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01751         }
01752         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01753     }
01754     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01755         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a42">RtlCustomCPToUnicodeN</a>(&amp;GlyphCP,
01756                                   Source,
01757                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR),
01758                                   &amp;Length,
01759                                   Temp,
01760                                   TempLength
01761                                  );
01762     } <span class="keywordflow">else</span> {
01763         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = MultiByteToWideChar(Codepage,
01764                                    MB_USEGLYPHCHARS,
01765                                    Temp,
01766                                    TempLength*<span class="keyword">sizeof</span>(WCHAR),
01767                                    Source,
01768                                    SourceLength);
01769     }
01770 <span class="preprocessor">#if defined(FE_SB)</span>
01771 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (SourceLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01772         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01773     }
01774 <span class="preprocessor">#else</span>
01775 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01776         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01777     }
01778 <span class="preprocessor">#endif</span>
01779 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01780         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01781     } <span class="keywordflow">else</span> {
01782         <span class="keywordflow">return</span> STATUS_SUCCESS;
01783     }
01784 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a299" doxytag="consrv.h::FindCreateFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FindCreateFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszTTFace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Weight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">650</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a45">CodePageToCharSet()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a4">CREATED_BUT_NOT_FOUND</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00035">DefaultFaceName</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00043">DefaultFontIndex</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00044">DefaultFontSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00044">_FONT_INFO::Family</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a50">GetAltFaceName()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a43">MakeAltRasterFont()</a>, <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00052">SIZE_EQUAL</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00041">_FONT_INFO::SizeWant</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00050">TM_IS_TT_FONT</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00042">_FONT_INFO::Weight</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00270">DoCreateScreenBuffer()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00656 {
00657 <span class="preprocessor">#define NOT_CREATED_NOR_FOUND -1</span>
00658 <span class="preprocessor"></span><span class="preprocessor">#define CREATED_BUT_NOT_FOUND -2</span>
00659 <span class="preprocessor"></span>
00660     <span class="keywordtype">int</span> i;
00661     <span class="keywordtype">int</span> FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>;
00662     <span class="keywordtype">int</span> BestMatch = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>;
00663     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bFontOK;
00664     WCHAR AltFaceName[LF_FACESIZE];
00665     COORD AltFontSize;
00666     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  AltFontFamily;
00667     ULONG AltFontIndex = 0;
00668     LPWSTR pwszAltFace = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00669 
00670     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CharSet = <a class="code" href="../../d0/d3/dbcs_8h.html#a45">CodePageToCharSet</a>(CodePage);
00671 
00672     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont Family=%x %ls (%d,%d) %d %d %x\n"</span>,
00673             Family, pwszFace, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y, Weight, CodePage, CharSet));
00674 
00675     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00676         !IS_ANY_DBCS_CHARSET(CharSet))
00677     {
00678         <a class="code" href="../../d0/d3/dbcs_8h.html#a43">MakeAltRasterFont</a>(CodePage, FontInfo[DefaultFontIndex].Size,
00679                           &amp;AltFontSize, &amp;AltFontFamily, &amp;AltFontIndex, AltFaceName);
00680 
00681         <span class="keywordflow">if</span> (pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || *pwszFace == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) {
00682             pwszFace = AltFaceName;
00683         }
00684         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y == 0) {
00685             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = AltFontSize.X;
00686             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = AltFontSize.Y;
00687         }
00688     }
00689     <span class="keywordflow">else</span> {
00690         <span class="keywordflow">if</span> (pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || *pwszFace == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) {
00691             pwszFace = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a9">DefaultFaceName</a>;
00692         }
00693         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y == 0) {
00694             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X;
00695             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y;
00696         }
00697     }
00698 
00699     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont</a>(pwszFace)) {
00700         pwszAltFace = <a class="code" href="../../d0/d3/dbcs_8h.html#a50">GetAltFaceName</a>(pwszFace);
00701     }
00702     <span class="keywordflow">else</span> {
00703         pwszAltFace = pwszFace;
00704     }
00705 
00706     <span class="comment">/*</span>
00707 <span class="comment">     * Try to find the exact font</span>
00708 <span class="comment">     */</span>
00709 TryFindExactFont:
00710     <span class="keywordflow">for</span> (i=0; i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; i++) {
00711         <span class="comment">/*</span>
00712 <span class="comment">         * If looking for a particular Family, skip non-matches</span>
00713 <span class="comment">         */</span>
00714         <span class="keywordflow">if</span> ((Family != 0) &amp;&amp;
00715                 ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Family != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>)) {
00716             <span class="keywordflow">continue</span>;
00717         }
00718 
00719         <span class="comment">/*</span>
00720 <span class="comment">         * Skip non-matching sizes</span>
00721 <span class="comment">         */</span>
00722         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y != <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y) &amp;&amp;
00723              !<a class="code" href="../../d7/d6/font_8h.html#a4">SIZE_EQUAL</a>(FontInfo[i].Size, Size)) {
00724             <span class="keywordflow">continue</span>;
00725         }
00726 
00727         <span class="comment">/*</span>
00728 <span class="comment">         * Skip non-matching weights</span>
00729 <span class="comment">         */</span>
00730         <span class="keywordflow">if</span> ((Weight != 0) &amp;&amp; (Weight != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o3">Weight</a>)) {
00731             <span class="keywordflow">continue</span>;
00732         }
00733 <span class="preprocessor">#if defined(FE_SB)</span>
00734 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[i].Family) &amp;&amp;
00735                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].tmCharSet != CharSet) {
00736             <span class="keywordflow">continue</span>;
00737         }
00738 <span class="preprocessor">#endif</span>
00739 <span class="preprocessor"></span>
00740         <span class="comment">/*</span>
00741 <span class="comment">         * Size (and maybe Family) match.</span>
00742 <span class="comment">         *  If we don't care about the name, or if it matches, use this font.</span>
00743 <span class="comment">         *  Else if name doesn't match and it is a raster font, consider it.</span>
00744 <span class="comment">         */</span>
00745         <span class="keywordflow">if</span> ((pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (pwszFace[0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) ||
00746                 wcscmp(FontInfo[i].FaceName, pwszFace) == 0 ||
00747                 wcscmp(FontInfo[i].FaceName, pwszAltFace) == 0
00748            ) {
00749             FontIndex = i;
00750             <span class="keywordflow">goto</span> FoundFont;
00751         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[i].Family)) {
00752             BestMatch = i;
00753         }
00754     }
00755 
00756     <span class="comment">/*</span>
00757 <span class="comment">     * Didn't find the exact font, so try to create it</span>
00758 <span class="comment">     */</span>
00759     <span class="keywordflow">if</span> (FontIndex == <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>) {
00760         ULONG ulOldEnumFilter;
00761         ulOldEnumFilter = SetFontEnumeration(0);
00762         <span class="comment">// restore all the other flags</span>
00763         SetFontEnumeration(ulOldEnumFilter &amp; ~FE_FILTER_TRUETYPE);
00764         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y &lt; 0) {
00765             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = -<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y;
00766         }
00767         bFontOK = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a23">DoFontEnum</a>(NULL, pwszFace, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y);
00768         SetFontEnumeration(ulOldEnumFilter);
00769         <span class="keywordflow">if</span> (bFontOK) {
00770             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont created font!\n"</span>));
00771             FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a4">CREATED_BUT_NOT_FOUND</a>;
00772             <span class="keywordflow">goto</span> TryFindExactFont;
00773         } <span class="keywordflow">else</span> {
00774             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont failed to create font!\n"</span>));
00775         }
00776     }
00777 
00778     <span class="comment">/*</span>
00779 <span class="comment">     * Failed to find exact match, but we have a close Raster Font</span>
00780 <span class="comment">     * fit - only the name doesn't match.</span>
00781 <span class="comment">     */</span>
00782     <span class="keywordflow">if</span> (BestMatch &gt;= 0) {
00783         FontIndex = BestMatch;
00784         <span class="keywordflow">goto</span> FoundFont;
00785     }
00786 
00787     <span class="comment">/*</span>
00788 <span class="comment">     * Failed to find exact match, even after enumeration, so now try</span>
00789 <span class="comment">     * to find a font of same family and same size or bigger</span>
00790 <span class="comment">     */</span>
00791     <span class="keywordflow">for</span> (i=0; i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; i++) {
00792 <span class="preprocessor">#if defined(FE_SB)</span>
00793 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
00794             <span class="keywordflow">if</span> ((Family != 0) &amp;&amp;
00795                     ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Family != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>)) {
00796                 <span class="keywordflow">continue</span>;
00797             }
00798 
00799             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[i].Family) &amp;&amp;
00800                     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].tmCharSet != CharSet) {
00801                 <span class="keywordflow">continue</span>;
00802             }
00803         }
00804         <span class="keywordflow">else</span> {
00805 <span class="preprocessor">#endif</span>
00806 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Family != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>) {
00807             <span class="keywordflow">continue</span>;
00808         }
00809 <span class="preprocessor">#if defined(FE_SB)</span>
00810 <span class="preprocessor"></span>        }
00811 <span class="preprocessor">#endif</span>
00812 <span class="preprocessor"></span>
00813         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y &gt;= <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y &amp;&amp;
00814                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X &gt;= <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X) {
00815             <span class="comment">// Same family, size &gt;= desired.</span>
00816             FontIndex = i;
00817             <span class="keywordflow">break</span>;
00818         }
00819     }
00820 
00821     <span class="keywordflow">if</span> (FontIndex &lt; 0) {
00822         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont defaults!\n"</span>));
00823 <span class="preprocessor">#if defined(FE_SB)</span>
00824 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00825             !<a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(CodePage))
00826         {
00827             FontIndex = AltFontIndex;
00828         }
00829         <span class="keywordflow">else</span>
00830 <span class="preprocessor">#endif</span>
00831 <span class="preprocessor"></span>        FontIndex = <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a>;
00832     }
00833 
00834 FoundFont:
00835     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont returns %x : %ls (%d,%d)\n"</span>, FontIndex,
00836             FontInfo[FontIndex].FaceName,
00837             FontInfo[FontIndex].<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X, FontInfo[FontIndex].Size.Y));
00838     <span class="keywordflow">return</span> FontIndex;
00839 
00840 <span class="preprocessor">#undef NOT_CREATED_NOR_FOUND</span>
00841 <span class="preprocessor"></span><span class="preprocessor">#undef CREATED_BUT_NOT_FOUND</span>
00842 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a162" doxytag="consrv.h::FindTextBufferFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FindTextBufferFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TextFontInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00846">846</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00102">_TEXT_BUFFER_FONT_INFO::FontCodePage</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00096">_TEXT_BUFFER_FONT_INFO::NextTextBufferFont</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00854                    :
00855 
00856     This routine find a font information which correspond to code page value.
00857 
00858 Arguments:
00859 
00860 Return Value:
00861 
00862 --*/
00863 
00864 {
00865     <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> CurrentFont;
00866 
00867     CurrentFont = ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont;
00868 
00869     <span class="keywordflow">while</span> (CurrentFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00870         <span class="keywordflow">if</span> (CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a> == CodePage) {
00871             *TextFontInfo = *CurrentFont;
00872             <span class="keywordflow">return</span> STATUS_SUCCESS;
00873         }
00874         CurrentFont = CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
00875     }
00876 
00877     <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00878 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a144" doxytag="consrv.h::FlushAllButKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FlushAllButKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InputInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00401">401</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00033">_INPUT_INFORMATION::In</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00026">_INPUT_INFORMATION::InputBuffer</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00027">_INPUT_INFORMATION::InputBufferSize</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00037">_INPUT_INFORMATION::InputWaitEvent</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00126">NtClearEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00034">_INPUT_INFORMATION::Out</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00616">ReadBuffer()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00407                    :
00408 
00409     This routine removes all but <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key events from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer.
00410 
00411 Arguments:
00412 
00413     InputInformation - Pointer to input buffer information structure.
00414 
00415 Return Value:
00416 
00417 Note:
00418 
00419     The console lock must be held when calling <span class="keyword">this</span> routine.
00420 
00421 --*/
00422 
00423 {
00424     ULONG NumberOfEventsRead,i;
00425     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00426     PINPUT_RECORD TmpInputBuffer,InPtr,TmpInputBufferPtr;
00427     ULONG <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00428     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Dummy;
00429 
00430     <span class="keywordflow">if</span> (InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o7">In</a> != InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o8">Out</a>)  {
00431 
00432         <span class="comment">//</span>
00433         <span class="comment">// allocate memory for temp buffer</span>
00434         <span class="comment">//</span>
00435 
00436         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> =  <span class="keyword">sizeof</span>(INPUT_RECORD) * (InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o1">InputBufferSize</a>+1);
00437         TmpInputBuffer = (PINPUT_RECORD)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),BufferSize);
00438         <span class="keywordflow">if</span> (TmpInputBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00439             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00440         }
00441         TmpInputBufferPtr = TmpInputBuffer;
00442 
00443         <span class="comment">//</span>
00444         <span class="comment">// copy input buffer.</span>
00445         <span class="comment">// let ReadBuffer do any compaction work.</span>
00446         <span class="comment">//</span>
00447 
00448         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a15">ReadBuffer</a>(InputInformation,
00449                             TmpInputBuffer,
00450                             InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o1">InputBufferSize</a>,
00451                             &amp;NumberOfEventsRead,
00452                             TRUE,
00453                             FALSE,
00454                             &amp;Dummy
00455 #<span class="keywordflow">if</span> defined(FE_SB)
00456                             ,
00457                             TRUE
00458 #endif
00459                            );
00460 
00461         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00462             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpInputBuffer);
00463             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00464         }
00465 
00466         InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o8">Out</a> = (ULONG_PTR) InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o0">InputBuffer</a>;
00467         InPtr = InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o0">InputBuffer</a>;
00468         <span class="keywordflow">for</span> (i=0;i&lt;NumberOfEventsRead;i++) {
00469             <span class="keywordflow">if</span> (TmpInputBuffer-&gt;EventType == KEY_EVENT) {
00470                 *InPtr = *TmpInputBuffer;
00471                 InPtr++;
00472             }
00473             TmpInputBuffer++;
00474         }
00475         InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o7">In</a> = (ULONG_PTR) InPtr;
00476         <span class="keywordflow">if</span> (InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o7">In</a> == InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o8">Out</a>) {
00477             <a class="code" href="../../d0/d8/ex_2event_8c.html#a4">NtClearEvent</a>(InputInformation-&gt;<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o11">InputWaitEvent</a>);
00478         }
00479         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpInputBufferPtr);
00480     }
00481     <span class="keywordflow">return</span> STATUS_SUCCESS;
00482 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a143" doxytag="consrv.h::FlushInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FlushInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InputInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a258" doxytag="consrv.h::FreeAliasBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeAliasBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00591">591</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00571">FreeAliasList()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>.
<p>
<pre class="fragment"><div>00594 {
00595     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
00596     PLIST_ENTRY ListHead, ListNext;
00597 
00598     ListHead = &amp;Console-&gt;ExeAliasList;
00599     ListNext = ListHead-&gt;Flink;
00600     <span class="keywordflow">while</span> (ListNext != ListHead) {
00601         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
00602         ListNext = ListNext-&gt;Flink;
00603         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a27">FreeAliasList</a>(AliasList);
00604     }
00605 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a259" doxytag="consrv.h::FreeCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04605">4605</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04564">FindCommandHistory()</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>.
<p>
<pre class="fragment"><div>04612                    :
04613 
04614     This routine marks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command history buffer freed.
04615 
04616 Arguments:
04617 
04618     Console - pointer to console.
04619 
04620     ProcessHandle - handle to client process.
04621 
04622 Return Value:
04623 
04624     none.
04625 
04626 --*/
04627 
04628 {
04629     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04630 
04631     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a46">FindCommandHistory</a>(Console,ProcessHandle);
04632     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>) {
04633         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
04634         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04635     }
04636 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a260" doxytag="consrv.h::FreeCommandHistoryBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeCommandHistoryBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04640">4640</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>.
<p>
<pre class="fragment"><div>04643 {
04644     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04645     PLIST_ENTRY ListHead, ListNext;
04646     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04647 
04648     ListHead = &amp;Console-&gt;CommandHistoryList;
04649     ListNext = ListHead-&gt;Flink;
04650     <span class="keywordflow">while</span> (ListNext != ListHead) {
04651         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
04652         ListNext = ListNext-&gt;Flink;
04653         RemoveEntryList(&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ListLink);
04654         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName) {
04655             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName);
04656         }
04657         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands;i++) {
04658             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Commands[i]);
04659         }
04660         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(History);
04661     }
04662 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="consrv.h::FreeCon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeCon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01110">1110</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00355">CM_DESTROY_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00097">CONSOLE_TERMINATING</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00697">SendMessageTimeout()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>.
<p>
<pre class="fragment"><div>01116                    :
01117 
01118     This routine frees a console and its associated
01119     data - input buffer and screen buffer.
01120 
01121 Arguments:
01122 
01123     ConsoleHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of console to free.
01124 
01125 Return Value:
01126 
01127 Note:
01128 
01129     The console handle table lock must be held when calling <span class="keyword">this</span> routine.
01130 
01131 --*/
01132 
01133 {
01134     HWND <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>;
01135 
01136     Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a12">CONSOLE_TERMINATING</a>;
01137     <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(Console-&gt;TerminationEvent,NULL);
01138     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> = Console-&gt;hWnd;
01139 
01140     <span class="comment">//</span>
01141     <span class="comment">// Wait 10 seconds or until the input thread replies</span>
01142     <span class="comment">// to synchronize the window destruction with</span>
01143     <span class="comment">// the termination of the thread</span>
01144     <span class="comment">//</span>
01145 
01146     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01147         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01148         <a class="code" href="../../d5/d9/cltxt_8h.html#a17">SendMessageTimeout</a>(hWnd, CM_DESTROY_WINDOW, 0, 0, SMTO_BLOCK, 10000, NULL);
01149     } <span class="keywordflow">else</span> {
01150         <a class="code" href="../../d6/d2/output_8c.html#a79">AbortCreateConsole</a>(Console);
01151     }
01152 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="consrv.h::FreeConsoleHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FreeConsoleHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00331">331</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00042">ConsoleHandleTableLocked</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00041">IndexFromHandle</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00030">NumberOfConsoleHandles</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>.
<p>
<pre class="fragment"><div>00337                    :
00338 
00339     This routine frees a console handle from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global table.
00340 
00341 Arguments:
00342 
00343     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to free.
00344 
00345 Return Value:
00346 
00347 Note:
00348 
00349     The console handle table lock must be held when calling <span class="keyword">this</span> routine.
00350 
00351 --*/
00352 
00353 {
00354     ULONG i;
00355 
00356     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a2">ConsoleHandleTableLocked</a>());
00357 
00358     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Handle != NULL);
00359     i = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a1">IndexFromHandle</a>(Handle);
00360     <span class="keywordflow">if</span> ((i &gt;= <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>) || (<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00361         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (FALSE);
00362     } <span class="keywordflow">else</span> {
00363         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00364     }
00365     <span class="keywordflow">return</span> STATUS_SUCCESS;
00366 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a141" doxytag="consrv.h::FreeInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InputBufferInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00221">221</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>.
<p>
<pre class="fragment"><div>00227                    :
00228 
00229     This routine frees <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resources associated with an input buffer.
00230 
00231 Arguments:
00232 
00233     InputBufferInformation - Pointer to input buffer information structure.
00234 
00235 Return Value:
00236 
00237 
00238 --*/
00239 
00240 {
00241     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(InputBufferInformation-&gt;RefCount == 0);
00242     CloseHandle(InputBufferInformation-&gt;InputWaitEvent);
00243     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(InputBufferInformation-&gt;InputBuffer);
00244 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a86" doxytag="consrv.h::FreeIoHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FreeIoHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">1455</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01378">FreeInputHandle()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>.
<p>
<pre class="fragment"><div>01462                    :
01463 
01464     This routine frees an input or output handle from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process's
01465     handle table.
01466 
01467 Arguments:
01468 
01469     ProcessData - Pointer to per process data structure.
01470 
01471     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to free.
01472 
01473 Return Value:
01474 
01475 Note:
01476 
01477     The console lock must be held when calling <span class="keyword">this</span> routine.  The handle
01478     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> freed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-process handle table.  Holding <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console
01479     lock serializes both threads within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling process and any other
01480     process that shares <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console.
01481 
01482 --*/
01483 
01484 {
01485     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01486     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01487 
01488     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
01489                                  Handle,
01490                                  &amp;HandleData
01491                                 );
01492     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01493     <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
01494         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a9">FreeInputHandle</a>(HandleData);
01495     }
01496     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> = <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>;
01497     <span class="keywordflow">return</span> STATUS_SUCCESS;
01498 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="consrv.h::FreeProcessData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeProcessData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ProcessData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01280">1280</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00292">CONSOLE_INITIAL_IO_HANDLES</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>.
<p>
<pre class="fragment"><div>01286                    :
01287 
01288     This routine frees any per-process data allocated by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console.
01289 
01290 Arguments:
01291 
01292     ProcessData - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-process data structure.
01293 
01294 Return Value:
01295 
01296 --*/
01297 
01298 {
01299     <span class="keywordflow">if</span> (ProcessData-&gt;HandleTableSize != <a class="code" href="../../d1/d7/server_8h.html#a45">CONSOLE_INITIAL_IO_HANDLES</a>) {
01300         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ProcessData-&gt;HandleTablePtr);
01301         ProcessData-&gt;HandleTablePtr = ProcessData-&gt;HandleTable;
01302         ProcessData-&gt;HandleTableSize = <a class="code" href="../../d1/d7/server_8h.html#a45">CONSOLE_INITIAL_IO_HANDLES</a>;
01303     }
01304 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a109" doxytag="consrv.h::FreeScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FreeScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l01021">1021</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05926">DeleteDbcsScreenBuffer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00353">FreeConsoleBitmap()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00139">_CONSOLE_INFORMATION::hDC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00142">_CONSOLE_INFORMATION::hSysPalette</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00952">RemoveTextBufferFontInfo()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00718">SelectPalette</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.
<p>
<pre class="fragment"><div>01027                    :
01028 
01029     This routine frees <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory associated with a screen buffer.
01030 
01031 Arguments:
01032 
01033     ScreenInfo - screen buffer data to free.
01034 
01035 Return Value:
01036 
01037 Note: console handle table lock must be held when calling <span class="keyword">this</span> routine
01038 
01039 --*/
01040 
01041 {
01042     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
01043     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
01044 
01045     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ScreenInfo-&gt;RefCount == 0);
01046     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01047         <span class="keywordflow">for</span> (i=0;i&lt;ScreenInfo-&gt;ScreenBufferSize.Y;i++) {
01048             <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length &gt; 1) {
01049                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs);
01050             }
01051         }
01052         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.TextRows);
01053         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows);
01054 <span class="preprocessor">#if defined(FE_SB)</span>
01055 <span class="preprocessor"></span>        <a class="code" href="../../d6/d2/output_8c.html#a87">DeleteDbcsScreenBuffer</a>(&amp;ScreenInfo-&gt;BufferInfo.TextInfo.DbcsScreenBuffer);
01056 <span class="preprocessor">#endif</span>
01057 <span class="preprocessor"></span>        <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a28">RemoveTextBufferFontInfo</a>(ScreenInfo);
01058     } <span class="keywordflow">else</span> {
01059         <span class="keywordflow">if</span> (ScreenInfo-&gt;hPalette != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01060             <span class="keywordflow">if</span> (GetCurrentObject(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, OBJ_PAL) == ScreenInfo-&gt;hPalette) {
01061                 <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o13">hSysPalette</a>, FALSE);
01062             }
01063             DeleteObject(ScreenInfo-&gt;hPalette);
01064         }
01065         <a class="code" href="../../d6/d2/output_8c.html#a32">FreeConsoleBitmap</a>(ScreenInfo);
01066     }
01067     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo);
01068     <span class="keywordflow">return</span> STATUS_SUCCESS;
01069 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a166" doxytag="consrv.h::GetAvailableFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetAvailableFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumWindow</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumFonts</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">998</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00233">SrvGetConsoleFontInfo()</a>.
<p>
<pre class="fragment"><div>01004 {
01005     PCONSOLE_FONT_INFO BufPtr;
01006     ULONG i;
01007     COORD WindowSize;
01008     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
01009 
01010     <span class="comment">//</span>
01011     <span class="comment">// if the buffer is too small to return all the fonts, return</span>
01012     <span class="comment">// the number that will fit.</span>
01013     <span class="comment">//</span>
01014 
01015     *NumFonts = (*NumFonts &gt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>) ? <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> : *NumFonts;
01016 
01017     <span class="comment">//</span>
01018     <span class="comment">// convert font size in pixels to font size in rows/columns</span>
01019     <span class="comment">//</span>
01020 
01021     BufPtr = (PCONSOLE_FONT_INFO)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01022 
01023     <span class="keywordflow">if</span> (MaximumWindow) {
01024         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
01025         WindowSize = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>;
01026     }
01027     <span class="keywordflow">else</span> {
01028         WindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
01029         WindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
01030     }
01031     <span class="keywordflow">for</span> (i=0;i&lt;*NumFonts;i++,BufPtr++) {
01032         BufPtr-&gt;nFont = i;
01033         BufPtr-&gt;dwFontSize.X = WindowSize.X * <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X / <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
01034         BufPtr-&gt;dwFontSize.Y = WindowSize.Y * <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y / <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
01035     }
01036 
01037     <span class="keywordflow">return</span> STATUS_SUCCESS;
01038 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a271" doxytag="consrv.h::GetConsoleLangId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetConsoleLangId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputCP</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LANGID *&nbsp;</td>
          <td class="mdname" nowrap> <em>pLangId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">2643</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03040">CopyFromCharPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03096">CopyToCharPopup()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00346">SetTEBLangID()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02680">SrvGetConsoleLangId()</a>.
<p>
<pre class="fragment"><div>02647 {
02648     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02649 
02650     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()){
02651         <span class="keywordflow">if</span> (pLangId != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02652             <span class="keywordflow">switch</span> (OutputCP) {
02653                 <span class="keywordflow">case</span> 932:
02654                     *pLangId = MAKELANGID( LANG_JAPANESE, SUBLANG_DEFAULT );
02655                     <span class="keywordflow">break</span>;
02656                 <span class="keywordflow">case</span> 949:
02657                     *pLangId = MAKELANGID( LANG_KOREAN, SUBLANG_KOREAN );
02658                     <span class="keywordflow">break</span>;
02659                 <span class="keywordflow">case</span> 936:
02660                     *pLangId = MAKELANGID( LANG_CHINESE, SUBLANG_CHINESE_SIMPLIFIED );
02661                     <span class="keywordflow">break</span>;
02662                 <span class="keywordflow">case</span> 950:
02663                     *pLangId = MAKELANGID( LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL );
02664                     <span class="keywordflow">break</span>;
02665                 <span class="keywordflow">default</span>:
02666                     *pLangId = MAKELANGID( LANG_ENGLISH, SUBLANG_ENGLISH_US );
02667                     <span class="keywordflow">break</span>;
02668             }
02669         }
02670         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
02671     }
02672     <span class="keywordflow">else</span> {
02673         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NOT_SUPPORTED;
02674     }
02675 
02676     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02677 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a168" doxytag="consrv.h::GetCurrentFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetCurrentFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumWindow</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01053">1053</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00108">SCR_FONTNUMBER()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00315">SrvGetConsoleCurrentFont()</a>.
<p>
<pre class="fragment"><div>01059 {
01060     COORD WindowSize;
01061     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
01062 
01063     <span class="keywordflow">if</span> (MaximumWindow) {
01064         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
01065         WindowSize = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>;
01066     }
01067     <span class="keywordflow">else</span> {
01068         WindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
01069         WindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
01070     }
01071     *FontIndex = <a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo);
01072     *FontSize = WindowSize;
01073     <span class="keywordflow">return</span> STATUS_SUCCESS;
01074 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a167" doxytag="consrv.h::GetFontSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetFontSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01041">1041</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00278">SrvGetConsoleFontSize()</a>.
<p>
<pre class="fragment"><div>01045 {
01046     <span class="keywordflow">if</span> (FontIndex &gt;= <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>)
01047         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01048     *FontSize = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>;
01049     <span class="keywordflow">return</span> STATUS_SUCCESS;
01050 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a155" doxytag="consrv.h::GetLinkProperties" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetLinkProperties           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszLinkName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpvBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/link_8c-source.html#l00264">264</a> of file <a class="el" href="../../d4/d3/link_8c-source.html">link.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00900">LINK_FULLINFO</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00898">LINK_NOINFO</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00899">LINK_SIMPLEINFO</a>, <a class="el" href="../../d4/d3/link_8c-source.html#l00129">LoadLink()</a>, and <a class="el" href="../../d1/d7/server_8h.html#a120">LPLNKPROPNTCONSOLE</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00360">LoadLinkInfo()</a>.
<p>
<pre class="fragment"><div>00265 {
00266     <a class="code" href="../../d0/d7/structCShellLink.html">CShellLink</a> mld;
00267     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fResult;
00268     LPNT_CONSOLE_PROPS lpExtraData;
00269     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize = 0;
00270 
00271 <span class="comment">/*</span>
00272 <span class="comment">    {</span>
00273 <span class="comment">        TCHAR szRick[ 1024 ];</span>
00274 <span class="comment">        STARTUPINFO si;</span>
00275 <span class="comment">        PROCESS_INFORMATION pi;</span>
00276 <span class="comment"></span>
00277 <span class="comment">        // HUGE, HUGE hack-o-rama to get NTSD started on this process!</span>
00278 <span class="comment">        wsprintf( szRick, TEXT("ntsd -d -p %d"), GetCurrentProcessId() );</span>
00279 <span class="comment">        GetStartupInfo( &amp;si );</span>
00280 <span class="comment">        CreateProcess( NULL, szRick, NULL, NULL, FALSE, 0, NULL, NULL, &amp;si, &amp;pi );</span>
00281 <span class="comment">        CloseHandle( pi.hProcess );</span>
00282 <span class="comment">        CloseHandle( pi.hThread );</span>
00283 <span class="comment">        Sleep( 5*1000 );</span>
00284 <span class="comment">        DebugBreak();</span>
00285 <span class="comment"></span>
00286 <span class="comment">    }</span>
00287 <span class="comment">*/</span>
00288 
00289 
00290 
00291     <span class="comment">// Zero out structure on the stack</span>
00292     RtlZeroMemory( &amp;mld, <span class="keyword">sizeof</span>(mld) );
00293 
00294     <span class="comment">// Load link data</span>
00295     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/link_8c.html#a2">LoadLink</a>( pszLinkName, &amp;mld )) {
00296         RIPMSG1(RIP_WARNING, <span class="stringliteral">"LoadLink %ws failed"</span>, pszLinkName);
00297         fResult = <a class="code" href="../../d8/d5/consrv_8h.html#a47">LINK_NOINFO</a>;
00298         <span class="keywordflow">goto</span> Cleanup;
00299     }
00300 
00301     <span class="comment">// Check return buffer -- is it big enough?</span>
00302     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(cb &gt;= <span class="keyword">sizeof</span>( <a class="code" href="../../d2/d9/structLNKPROPNTCONSOLE.html">LNKPROPNTCONSOLE</a>));
00303 
00304     <span class="comment">// Zero out callers buffer</span>
00305     RtlZeroMemory( lpvBuffer, cb );
00306 
00307     <span class="comment">// Copy relevant shell link data into caller's buffer</span>
00308     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o2">pszName</a>)
00309         lstrcpy( ((<a class="code" href="../../d1/d7/server_8h.html#a120">LPLNKPROPNTCONSOLE</a>)lpvBuffer)-&gt;pszName, mld.<a class="code" href="../../d0/d7/structCShellLink.html#o2">pszName</a> );
00310     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o6">pszIconLocation</a>)
00311         lstrcpy( ((LPLNKPROPNTCONSOLE)lpvBuffer)-&gt;pszIconLocation, mld.<a class="code" href="../../d0/d7/structCShellLink.html#o6">pszIconLocation</a> );
00312     ((<a class="code" href="../../d1/d7/server_8h.html#a120">LPLNKPROPNTCONSOLE</a>)lpvBuffer)-&gt;uIcon = mld.<a class="code" href="../../d0/d7/structCShellLink.html#o8">sld</a>.iIcon;
00313     ((<a class="code" href="../../d1/d7/server_8h.html#a120">LPLNKPROPNTCONSOLE</a>)lpvBuffer)-&gt;uShowCmd = mld.<a class="code" href="../../d0/d7/structCShellLink.html#o8">sld</a>.iShowCmd;
00314     ((<a class="code" href="../../d1/d7/server_8h.html#a120">LPLNKPROPNTCONSOLE</a>)lpvBuffer)-&gt;uHotKey = mld.<a class="code" href="../../d0/d7/structCShellLink.html#o8">sld</a>.wHotkey;
00315     fResult = <a class="code" href="../../d8/d5/consrv_8h.html#a48">LINK_SIMPLEINFO</a>;
00316 
00317     <span class="comment">// Find console properties in extra data section</span>
00318     <span class="keywordflow">for</span>( lpExtraData = (LPNT_CONSOLE_PROPS)mld.<a class="code" href="../../d0/d7/structCShellLink.html#o7">pExtraData</a>;
00319          lpExtraData &amp;&amp; lpExtraData-&gt;cbSize;
00320          (LPBYTE)lpExtraData += dwSize
00321         )
00322     {
00323         dwSize = lpExtraData-&gt;cbSize;
00324         <span class="keywordflow">if</span> (dwSize)
00325         {
00326             <span class="keywordflow">if</span> (lpExtraData-&gt;dwSignature == NT_CONSOLE_PROPS_SIG)
00327             {
00328 
00329                 RtlCopyMemory( &amp;((LPLNKPROPNTCONSOLE)lpvBuffer)-&gt;console_props,
00330                                lpExtraData,
00331                                <span class="keyword">sizeof</span>( NT_CONSOLE_PROPS )
00332                              );
00333                 fResult = <a class="code" href="../../d8/d5/consrv_8h.html#a49">LINK_FULLINFO</a>;
00334 <span class="preprocessor">#if !defined(FE_SB)</span>
00335 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
00336 <span class="preprocessor">#endif</span>
00337 <span class="preprocessor"></span>            }
00338 <span class="preprocessor">#if defined(FE_SB)</span>
00339 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (lpExtraData-&gt;dwSignature == NT_FE_CONSOLE_PROPS_SIG)
00340             {
00341                 LPNT_FE_CONSOLE_PROPS lpFEExtraData = (LPNT_FE_CONSOLE_PROPS)lpExtraData;
00342 
00343                 RtlCopyMemory( &amp;((LPLNKPROPNTCONSOLE)lpvBuffer)-&gt;fe_console_props,
00344                                lpFEExtraData,
00345                                <span class="keyword">sizeof</span>( NT_FE_CONSOLE_PROPS )
00346                              );
00347             }
00348 <span class="preprocessor">#endif</span>
00349 <span class="preprocessor"></span>        }
00350     }
00351 
00352 <span class="preprocessor">#if 0</span>
00353 <span class="preprocessor"></span><span class="preprocessor">#define ConsoleInfo ((LPLNKPROPNTCONSOLE)lpvBuffer)</span>
00354 <span class="preprocessor"></span>    {
00355         TCHAR szTemp[ 256 ];
00356         <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> i;
00357 
00358         wsprintf( szTemp, TEXT(<span class="stringliteral">"[GetLinkProperties -- Link Properties for %s]\n"</span>), pszLinkName );
00359         OutputDebugString( szTemp );
00360         wsprintf( szTemp, TEXT(<span class="stringliteral">"    wFillAttribute      = 0x%04X\n"</span>), ConsoleInfo-&gt;console_props.wFillAttribute );
00361         OutputDebugString( szTemp );
00362         wsprintf( szTemp, TEXT(<span class="stringliteral">"    wPopupFillAttribute = 0x%04X\n"</span>), ConsoleInfo-&gt;console_props.wPopupFillAttribute );
00363         OutputDebugString( szTemp );
00364         wsprintf( szTemp, TEXT(<span class="stringliteral">"    dwScreenBufferSize  = (%d , %d)\n"</span>), ConsoleInfo-&gt;console_props.dwScreenBufferSize.X, ConsoleInfo-&gt;console_props.dwScreenBufferSize.Y );
00365         OutputDebugString( szTemp );
00366         wsprintf( szTemp, TEXT(<span class="stringliteral">"    dwWindowSize        = (%d , %d)\n"</span>), ConsoleInfo-&gt;console_props.dwWindowSize.X, ConsoleInfo-&gt;console_props.dwWindowSize.Y );
00367         OutputDebugString( szTemp );
00368         wsprintf( szTemp, TEXT(<span class="stringliteral">"    dwWindowOrigin      = (%d , %d)\n"</span>), ConsoleInfo-&gt;console_props.dwWindowOrigin.X, ConsoleInfo-&gt;console_props.dwWindowOrigin.Y );
00369         OutputDebugString( szTemp );
00370         wsprintf( szTemp, TEXT(<span class="stringliteral">"    nFont               = 0x%X\n"</span>), ConsoleInfo-&gt;console_props.nFont );
00371         OutputDebugString( szTemp );
00372         wsprintf( szTemp, TEXT(<span class="stringliteral">"    nInputBufferSize    = 0x%X\n"</span>), ConsoleInfo-&gt;console_props.nInputBufferSize );
00373         OutputDebugString( szTemp );
00374         wsprintf( szTemp, TEXT(<span class="stringliteral">"    dwFontSize          = (%d , %d)\n"</span>), ConsoleInfo-&gt;console_props.dwFontSize.X, ConsoleInfo-&gt;console_props.dwFontSize.Y );
00375         OutputDebugString( szTemp );
00376         wsprintf( szTemp, TEXT(<span class="stringliteral">"    uFontFamily         = 0x%08X\n"</span>), ConsoleInfo-&gt;console_props.uFontFamily );
00377         OutputDebugString( szTemp );
00378         wsprintf( szTemp, TEXT(<span class="stringliteral">"    uFontWeight         = 0x%08X\n"</span>), ConsoleInfo-&gt;console_props.uFontWeight );
00379         OutputDebugString( szTemp );
00380         wsprintf( szTemp, TEXT(<span class="stringliteral">"    FaceName            = %ws\n"</span>), ConsoleInfo-&gt;console_props.FaceName );
00381         OutputDebugString( szTemp );
00382         wsprintf( szTemp, TEXT(<span class="stringliteral">"    uCursorSize         = %d\n"</span>), ConsoleInfo-&gt;console_props.uCursorSize );
00383         OutputDebugString( szTemp );
00384         wsprintf( szTemp, TEXT(<span class="stringliteral">"    bFullScreen         = %s\n"</span>), ConsoleInfo-&gt;console_props.bFullScreen ? TEXT(<span class="stringliteral">"TRUE"</span>) : TEXT(<span class="stringliteral">"FALSE"</span>) );
00385         OutputDebugString( szTemp );
00386         wsprintf( szTemp, TEXT(<span class="stringliteral">"    bQuickEdit          = %s\n"</span>), ConsoleInfo-&gt;console_props.bQuickEdit  ? TEXT(<span class="stringliteral">"TRUE"</span>) : TEXT(<span class="stringliteral">"FALSE"</span>) );
00387         OutputDebugString( szTemp );
00388         wsprintf( szTemp, TEXT(<span class="stringliteral">"    bInsertMode         = %s\n"</span>), ConsoleInfo-&gt;console_props.bInsertMode ? TEXT(<span class="stringliteral">"TRUE"</span>) : TEXT(<span class="stringliteral">"FALSE"</span>) );
00389         OutputDebugString( szTemp );
00390         wsprintf( szTemp, TEXT(<span class="stringliteral">"    bAutoPosition       = %s\n"</span>), ConsoleInfo-&gt;console_props.bAutoPosition ? TEXT(<span class="stringliteral">"TRUE"</span>) : TEXT(<span class="stringliteral">"FALSE"</span>) );
00391         OutputDebugString( szTemp );
00392         wsprintf( szTemp, TEXT(<span class="stringliteral">"    uHistoryBufferSize  = %d\n"</span>), ConsoleInfo-&gt;console_props.uHistoryBufferSize );
00393         OutputDebugString( szTemp );
00394         wsprintf( szTemp, TEXT(<span class="stringliteral">"    uNumHistoryBuffers  = %d\n"</span>), ConsoleInfo-&gt;console_props.uNumberOfHistoryBuffers );
00395         OutputDebugString( szTemp );
00396         wsprintf( szTemp, TEXT(<span class="stringliteral">"    bHistoryNoDup       = %s\n"</span>), ConsoleInfo-&gt;console_props.bHistoryNoDup ? TEXT(<span class="stringliteral">"TRUE"</span>) : TEXT(<span class="stringliteral">"FALSE"</span>) );
00397         OutputDebugString( szTemp );
00398         OutputDebugString( TEXT(<span class="stringliteral">"    ColorTable = ["</span>) );
00399         i=0;
00400         <span class="keywordflow">while</span>( i &lt; 16 )
00401         {
00402             OutputDebugString( TEXT(<span class="stringliteral">"\n         "</span>) );
00403             wsprintf( szTemp, TEXT(<span class="stringliteral">"0x%08X "</span>), ConsoleInfo-&gt;console_props.ColorTable[i++]);
00404             OutputDebugString( szTemp );
00405             wsprintf( szTemp, TEXT(<span class="stringliteral">"0x%08X "</span>), ConsoleInfo-&gt;console_props.ColorTable[i++]);
00406             OutputDebugString( szTemp );
00407             wsprintf( szTemp, TEXT(<span class="stringliteral">"0x%08X "</span>), ConsoleInfo-&gt;console_props.ColorTable[i++]);
00408             OutputDebugString( szTemp );
00409             wsprintf( szTemp, TEXT(<span class="stringliteral">"0x%08X "</span>), ConsoleInfo-&gt;console_props.ColorTable[i++]);
00410             OutputDebugString( szTemp );
00411         }
00412         OutputDebugString( TEXT(<span class="stringliteral">"]\n\n"</span>) );
00413     }
00414 <span class="preprocessor">#undef ConsoleInfo</span>
00415 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00416 <span class="preprocessor"></span>
00417 Cleanup:
00418     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o2">pszName</a>)
00419         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>( mld.<a class="code" href="../../d0/d7/structCShellLink.html#o2">pszName</a> );
00420     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o3">pszRelPath</a>)
00421         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>( mld.<a class="code" href="../../d0/d7/structCShellLink.html#o3">pszRelPath</a> );
00422     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o4">pszWorkingDir</a>)
00423         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>( mld.<a class="code" href="../../d0/d7/structCShellLink.html#o4">pszWorkingDir</a> );
00424     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o5">pszArgs</a>)
00425         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>( mld.<a class="code" href="../../d0/d7/structCShellLink.html#o5">pszArgs</a> );
00426     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o6">pszIconLocation</a>)
00427         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>( mld.<a class="code" href="../../d0/d7/structCShellLink.html#o6">pszIconLocation</a> );
00428     <span class="keywordflow">if</span> (mld.<a class="code" href="../../d0/d7/structCShellLink.html#o7">pExtraData</a>)
00429         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>( mld.<a class="code" href="../../d0/d7/structCShellLink.html#o7">pExtraData</a> );
00430 
00431     <span class="keywordflow">return</span> fResult;
00432 
00433 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a161" doxytag="consrv.h::GetMouseButtons" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetMouseButtons           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NumButtons</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00066">66</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00029">NumberOfMouseButtons</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00211">SrvGetConsoleMouseInfo()</a>.
<p>
<pre class="fragment"><div>00069 {
00070     *NumButtons = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a5">NumberOfMouseButtons</a>;
00071     <span class="keywordflow">return</span> STATUS_SUCCESS;
00072 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a142" doxytag="consrv.h::GetNumberOfReadyEvents" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetNumberOfReadyEvents           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfEvents</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00362">362</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01410">PrependInputBuffer()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00108">SrvGetConsoleNumberOfInputEvents()</a>.
<p>
<pre class="fragment"><div>00369                    :
00370 
00371     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of events in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
00372 
00373 Arguments:
00374 
00375     InputInformation - Pointer to input buffer information structure.
00376 
00377     NumberOfEvents - On output contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of events.
00378 
00379 Return Value:
00380 
00381 Note:
00382 
00383     The console lock must be held when calling <span class="keyword">this</span> routine.
00384 
00385 --*/
00386 
00387 {
00388     <span class="keywordflow">if</span> (InputInformation-&gt;In &lt; InputInformation-&gt;Out) {
00389         *NumberOfEvents = (ULONG)(InputInformation-&gt;Last - InputInformation-&gt;Out);
00390         *NumberOfEvents += (ULONG)(InputInformation-&gt;In - InputInformation-&gt;First);
00391     }
00392     <span class="keywordflow">else</span> {
00393         *NumberOfEvents = (ULONG)(InputInformation-&gt;In - InputInformation-&gt;Out);
00394     }
00395     *NumberOfEvents /= <span class="keyword">sizeof</span>(INPUT_RECORD);
00396 
00397     <span class="keywordflow">return</span> STATUS_SUCCESS;
00398 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a165" doxytag="consrv.h::GetNumFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetNumFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NumberOfFonts</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00988">988</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00082">SrvGetConsoleNumberOfFonts()</a>.
<p>
<pre class="fragment"><div>00991 {
00992     *NumFonts = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>;
00993     <span class="keywordflow">return</span> STATUS_SUCCESS;
00994 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a269" doxytag="consrv.h::GetRegistryValues" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID GetRegistryValues           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleTitle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html">PCONSOLE_REGISTRY_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RegInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">2210</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d4/ioep_8h-source.html#l00067">DBGPRINT</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00022">DefaultRegInfo</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00306">gaWordDelimChars</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00307">gaWordDelimCharsDefault</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00054">gExtendedEditKey</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00057">gfLoadConIme</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00055">gfTrimLeadingZeros</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00186">InitExtendedEditKeys()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00433">_CONSOLE_REGISTRY_INFO::LastWriteTime</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01635">MyRegOpenKey()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01670">MyRegQueryValue()</a>, <a class="el" href="../../d3/d2/tnlsxlat_8c-source.html#l00026">NELEM</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00048">NT_ERROR</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02018">NtQueryKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01564">RtlOpenCurrentUser()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">TranslateConsoleTitle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00405">WORD_DELIM_MAX</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00626">InitWindowsStuff()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00360">LoadLinkInfo()</a>.
<p>
<pre class="fragment"><div>02217                    :
02218 
02219     This routine reads in values from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry and places them
02220     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied structure.
02221 
02222 Arguments:
02223 
02224     ConsoleTitle - name of subkey to open
02225 
02226     RegInfo - pointer to structure to receive information
02227 
02228 Return Value:
02229 
02230     none
02231 
02232 --*/
02233 
02234 {
02235     HANDLE hCurrentUserKey;
02236     HANDLE hConsoleKey;
02237     HANDLE hTitleKey;
02238     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02239     LPWSTR TranslatedConsoleTitle;
02240     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwValue;
02241     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
02242     WCHAR awchFaceName[LF_FACESIZE];
02243     WCHAR awchBuffer[64];
02244     KEY_BASIC_INFORMATION KeyInfo;
02245     ULONG ResultLength;
02246 
02247     <span class="comment">//</span>
02248     <span class="comment">// Impersonate the client process</span>
02249     <span class="comment">//</span>
02250 
02251     <span class="keywordflow">if</span> (!CsrImpersonateClient(NULL)) {
02252         KdPrint((<span class="stringliteral">"CONSRV: GetRegistryValues Impersonate failed\n"</span>));
02253         <span class="keywordflow">return</span>;
02254     }
02255 
02256     <span class="comment">//</span>
02257     <span class="comment">// Open the current user registry key</span>
02258     <span class="comment">//</span>
02259 
02260     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a27">RtlOpenCurrentUser</a>(MAXIMUM_ALLOWED, &amp;hCurrentUserKey);
02261     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02262         CsrRevertToSelf();
02263         <span class="keywordflow">return</span>;
02264     }
02265 
02266     <span class="comment">//</span>
02267     <span class="comment">// Open the console registry key</span>
02268     <span class="comment">//</span>
02269 
02270     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a44">MyRegOpenKey</a>(hCurrentUserKey,
02271                           CONSOLE_REGISTRY_STRING,
02272                           &amp;hConsoleKey);
02273     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02274         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hCurrentUserKey);
02275         CsrRevertToSelf();
02276         <span class="keywordflow">return</span>;
02277     }
02278 
02279     <span class="comment">//</span>
02280     <span class="comment">// If we're not reading the default key, check if the default values</span>
02281     <span class="comment">// need to be updated</span>
02282     <span class="comment">//</span>
02283 
02284     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a24">NtQueryKey</a>(hConsoleKey,
02285                         KeyBasicInformation,
02286                         &amp;KeyInfo,
02287                         <span class="keyword">sizeof</span>(KeyInfo),
02288                         &amp;ResultLength);
02289     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a3">NT_ERROR</a>(Status)) {
02290         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o18">LastWriteTime</a> != KeyInfo.LastWriteTime.QuadPart) {
02291             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o18">LastWriteTime</a> = KeyInfo.LastWriteTime.QuadPart;
02292             <span class="keywordflow">if</span> (RegInfo != &amp;<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>) {
02293                 <a class="code" href="../../d0/d5/srvinit_8c.html#a44">GetRegistryValues</a>(L<span class="stringliteral">""</span>, &amp;DefaultRegInfo);
02294                 *RegInfo = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>;
02295             }
02296         }
02297     }
02298 
02299     <span class="comment">//</span>
02300     <span class="comment">// Open the console title subkey</span>
02301     <span class="comment">//</span>
02302 
02303     TranslatedConsoleTitle = <a class="code" href="../../d0/d5/srvinit_8c.html#a42">TranslateConsoleTitle</a>(ConsoleTitle, NULL, TRUE, TRUE);
02304     <span class="keywordflow">if</span> (TranslatedConsoleTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02305         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hConsoleKey);
02306         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hCurrentUserKey);
02307         CsrRevertToSelf();
02308         <span class="keywordflow">return</span>;
02309     }
02310     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a44">MyRegOpenKey</a>(hConsoleKey,
02311                          TranslatedConsoleTitle,
02312                          &amp;hTitleKey);
02313     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TranslatedConsoleTitle);
02314     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02315         TranslatedConsoleTitle = <a class="code" href="../../d0/d5/srvinit_8c.html#a42">TranslateConsoleTitle</a>(ConsoleTitle, NULL, FALSE, TRUE);
02316         <span class="keywordflow">if</span> (TranslatedConsoleTitle) {
02317             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a44">MyRegOpenKey</a>(hConsoleKey,
02318                                  TranslatedConsoleTitle,
02319                                  &amp;hTitleKey);
02320             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TranslatedConsoleTitle);
02321         }
02322     }
02323     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02324         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hConsoleKey);
02325         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hCurrentUserKey);
02326         CsrRevertToSelf();
02327         <span class="keywordflow">return</span>;
02328     }
02329 
02330     <span class="comment">//</span>
02331     <span class="comment">// Initial screen fill</span>
02332     <span class="comment">//</span>
02333 
02334     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02335                        CONSOLE_REGISTRY_FILLATTR,
02336                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02337         RegInfo-&gt;ScreenFill.Attributes = (WORD)dwValue;
02338     }
02339 
02340     <span class="comment">//</span>
02341     <span class="comment">// Initial popup fill</span>
02342     <span class="comment">//</span>
02343 
02344     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02345                        CONSOLE_REGISTRY_POPUPATTR,
02346                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02347         RegInfo-&gt;PopupFill.Attributes = (WORD)dwValue;
02348     }
02349 
02350     <span class="comment">//</span>
02351     <span class="comment">// Initial insert mode</span>
02352     <span class="comment">//</span>
02353 
02354     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02355                        CONSOLE_REGISTRY_INSERTMODE,
02356                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02357         RegInfo-&gt;InsertMode = !!dwValue;
02358     }
02359 
02360     <span class="comment">//</span>
02361     <span class="comment">// Initial quick edit mode</span>
02362     <span class="comment">//</span>
02363 
02364     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02365                        CONSOLE_REGISTRY_QUICKEDIT,
02366                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02367         RegInfo-&gt;QuickEdit = !!dwValue;
02368     }
02369 
02370 <span class="preprocessor">#ifdef i386</span>
02371 <span class="preprocessor"></span>    <span class="comment">//</span>
02372     <span class="comment">// Initial full screen mode</span>
02373     <span class="comment">//</span>
02374 
02375     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02376                        CONSOLE_REGISTRY_FULLSCR,
02377                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02378         RegInfo-&gt;FullScreen = !!dwValue;
02379     }
02380 <span class="preprocessor">#endif</span>
02381 <span class="preprocessor"></span>
02382 <span class="preprocessor">#if defined(FE_SB) // scotthsu</span>
02383 <span class="preprocessor"></span>    <span class="comment">//</span>
02384     <span class="comment">// Code Page</span>
02385     <span class="comment">//</span>
02386 
02387     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02388                        CONSOLE_REGISTRY_CODEPAGE,
02389                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02390         RegInfo-&gt;CodePage = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)dwValue;
02391 
02392         <span class="comment">// If this routine specified default settings for console property,</span>
02393         <span class="comment">// then make sure code page value when Fae East environment.</span>
02394         <span class="comment">// If code page value does not the same to OEMCP and any FE's code page then</span>
02395         <span class="comment">// we are override code page value to OEMCP on default console property.</span>
02396         <span class="comment">// Because, Far East environment has limitation that doesn not switch to</span>
02397         <span class="comment">// another FE's code page by the SetConsoleCP/SetConsoleOutputCP.</span>
02398         <span class="comment">//</span>
02399         <span class="comment">// Compare of ConsoleTitle and L"" has limit to default property of console.</span>
02400         <span class="comment">// It means, this code doesn't care user defined property.</span>
02401         <span class="comment">// Content of user defined property has responsibility to themselves.</span>
02402 
02403         <span class="keywordflow">if</span> ( wcscmp(ConsoleTitle,L<span class="stringliteral">""</span>) == 0 &amp;&amp;
02404              <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>( RegInfo-&gt;CodePage ) &amp;&amp;
02405              <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> != RegInfo-&gt;CodePage ) {
02406             RegInfo-&gt;CodePage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>;
02407         }
02408     }
02409 <span class="preprocessor">#endif</span>
02410 <span class="preprocessor"></span>
02411     <span class="comment">//</span>
02412     <span class="comment">// Initial screen buffer size</span>
02413     <span class="comment">//</span>
02414 
02415     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02416                        CONSOLE_REGISTRY_BUFFERSIZE,
02417                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02418         RegInfo-&gt;ScreenBufferSize.X = LOWORD(dwValue);
02419         RegInfo-&gt;ScreenBufferSize.Y = HIWORD(dwValue);
02420         <span class="keywordflow">if</span> (RegInfo-&gt;ScreenBufferSize.X &lt;= 0)
02421             RegInfo-&gt;ScreenBufferSize.X = 1;
02422         <span class="keywordflow">if</span> (RegInfo-&gt;ScreenBufferSize.Y &lt;= 0)
02423             RegInfo-&gt;ScreenBufferSize.Y = 1;
02424     }
02425 
02426     <span class="comment">//</span>
02427     <span class="comment">// Initial window size</span>
02428     <span class="comment">//</span>
02429 
02430     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02431                        CONSOLE_REGISTRY_WINDOWSIZE,
02432                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02433         RegInfo-&gt;WindowSize.X = LOWORD(dwValue);
02434         RegInfo-&gt;WindowSize.Y = HIWORD(dwValue);
02435         <span class="keywordflow">if</span> (RegInfo-&gt;WindowSize.X &lt;= 0)
02436             RegInfo-&gt;WindowSize.X = 1;
02437         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RegInfo-&gt;WindowSize.X &gt; RegInfo-&gt;ScreenBufferSize.X)
02438             RegInfo-&gt;WindowSize.X = RegInfo-&gt;ScreenBufferSize.X;
02439         <span class="keywordflow">if</span> (RegInfo-&gt;WindowSize.Y &lt;= 0)
02440             RegInfo-&gt;WindowSize.Y = 1;
02441         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RegInfo-&gt;WindowSize.Y &gt; RegInfo-&gt;ScreenBufferSize.Y)
02442             RegInfo-&gt;WindowSize.Y = RegInfo-&gt;ScreenBufferSize.Y;
02443     }
02444 
02445     <span class="comment">//</span>
02446     <span class="comment">// Initial window position</span>
02447     <span class="comment">//</span>
02448 
02449     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02450                        CONSOLE_REGISTRY_WINDOWPOS,
02451                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02452         RegInfo-&gt;WindowOrigin.X = LOWORD(dwValue);
02453         RegInfo-&gt;WindowOrigin.Y = HIWORD(dwValue);
02454         RegInfo-&gt;AutoPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02455     }
02456 
02457     <span class="comment">//</span>
02458     <span class="comment">// Initial font size</span>
02459     <span class="comment">//</span>
02460 
02461     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02462                        CONSOLE_REGISTRY_FONTSIZE,
02463                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02464         RegInfo-&gt;FontSize.X = LOWORD(dwValue);
02465         RegInfo-&gt;FontSize.Y = HIWORD(dwValue);
02466     }
02467 
02468     <span class="comment">//</span>
02469     <span class="comment">// Initial font family</span>
02470     <span class="comment">//</span>
02471 
02472     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02473                        CONSOLE_REGISTRY_FONTFAMILY,
02474                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02475         RegInfo-&gt;FontFamily = dwValue;
02476     }
02477 
02478     <span class="comment">//</span>
02479     <span class="comment">// Initial font weight</span>
02480     <span class="comment">//</span>
02481 
02482     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02483                        CONSOLE_REGISTRY_FONTWEIGHT,
02484                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02485         RegInfo-&gt;FontWeight = dwValue;
02486     }
02487 
02488     <span class="comment">//</span>
02489     <span class="comment">// Initial font face name</span>
02490     <span class="comment">//</span>
02491 
02492     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02493                        CONSOLE_REGISTRY_FACENAME,
02494                        <span class="keyword">sizeof</span>(awchFaceName), (PBYTE)awchFaceName))) {
02495         RtlCopyMemory(RegInfo-&gt;FaceName, awchFaceName, <span class="keyword">sizeof</span>(awchFaceName));
02496         RegInfo-&gt;FaceName[<a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(RegInfo-&gt;FaceName) - 1] = 0;
02497     }
02498 
02499     <span class="comment">//</span>
02500     <span class="comment">// Initial cursor size</span>
02501     <span class="comment">//</span>
02502 
02503     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02504                        CONSOLE_REGISTRY_CURSORSIZE,
02505                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02506         RegInfo-&gt;CursorSize = dwValue;
02507     }
02508 
02509     <span class="comment">//</span>
02510     <span class="comment">// Initial history buffer size</span>
02511     <span class="comment">//</span>
02512 
02513     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02514                        CONSOLE_REGISTRY_HISTORYSIZE,
02515                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02516         RegInfo-&gt;HistoryBufferSize = dwValue;
02517     }
02518 
02519     <span class="comment">//</span>
02520     <span class="comment">// Initial number of history buffers</span>
02521     <span class="comment">//</span>
02522 
02523     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02524                        CONSOLE_REGISTRY_HISTORYBUFS,
02525                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02526         RegInfo-&gt;NumberOfHistoryBuffers = dwValue;
02527     }
02528 
02529     <span class="comment">//</span>
02530     <span class="comment">// Initial history duplication mode</span>
02531     <span class="comment">//</span>
02532 
02533     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02534                        CONSOLE_REGISTRY_HISTORYNODUP,
02535                        <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02536         RegInfo-&gt;HistoryNoDup = dwValue;
02537     }
02538 
02539     <span class="keywordflow">for</span> (i=0; i&lt;16; i++) {
02540         wsprintf(awchBuffer, CONSOLE_REGISTRY_COLORTABLE, i);
02541         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey, awchBuffer,
02542                            <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02543             RegInfo-&gt;ColorTable[ i ] = dwValue;
02544         }
02545     }
02546 
02547     <span class="keywordflow">if</span> (RegInfo == &amp;<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>) {
02548         <span class="comment">//</span>
02549         <span class="comment">// If the common (default) setting has been changed,</span>
02550         <span class="comment">//</span>
02551 
02552         <span class="comment">//</span>
02553         <span class="comment">// Get registry for conime flag</span>
02554         <span class="comment">//</span>
02555         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hConsoleKey, CONSOLE_REGISTRY_LOAD_CONIME, <span class="keyword">sizeof</span> dwValue, (PBYTE)&amp;dwValue))) {
02556             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a26">gfLoadConIme</a> = (dwValue != 0);
02557         } <span class="keywordflow">else</span> {
02558             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a26">gfLoadConIme</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02559         }
02560 
02561         <span class="comment">//</span>
02562         <span class="comment">// get extended edit mode and keys from registry.</span>
02563         <span class="comment">//</span>
02564         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hConsoleKey,
02565                 CONSOLE_REGISTRY_EXTENDEDEDITKEY,
02566                 <span class="keyword">sizeof</span> dwValue,
02567                 (PBYTE)&amp;dwValue)) &amp;&amp;
02568                 dwValue &lt;= 1) {
02569 
02570             ExtKeyDefBuf buf;
02571 
02572             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a> = dwValue;
02573 
02574             <span class="comment">//</span>
02575             <span class="comment">// Initialize Extended Edit keys</span>
02576             <span class="comment">//</span>
02577             <a class="code" href="../../d4/d1/cmdline_8h.html#a63">InitExtendedEditKeys</a>(NULL);
02578 
02579             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hConsoleKey,
02580                         CONSOLE_REGISTRY_EXTENDEDEDITKEY_CUSTOM,
02581                         <span class="keyword">sizeof</span> buf,
02582                         (PBYTE)&amp;buf))) {
02583                 <a class="code" href="../../d4/d1/cmdline_8h.html#a63">InitExtendedEditKeys</a>(&amp;buf);
02584             }
02585 <span class="preprocessor">    #if DBG</span>
02586 <span class="preprocessor"></span>            <span class="keywordflow">else</span> {
02587                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Error reading ExtendedEditkeyCustom.\n"</span>);
02588             }
02589 <span class="preprocessor">    #endif</span>
02590 <span class="preprocessor"></span>        }
02591         <span class="keywordflow">else</span> {
02592             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a> = 0;
02593             <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"Error reading ExtendedEditkey.\n"</span>));
02594         }
02595 
02596         <span class="comment">//</span>
02597         <span class="comment">// Word delimiters</span>
02598         <span class="comment">//</span>
02599         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a>) {
02600             <span class="comment">// If extended edit key is given, provide extended word delimiters</span>
02601             <span class="comment">// by default.</span>
02602             memcpy((LPBYTE)gaWordDelimChars, (LPBYTE)gaWordDelimCharsDefault,
02603                     <span class="keyword">sizeof</span> gaWordDelimChars[0] * WORD_DELIM_MAX);
02604         } <span class="keywordflow">else</span> {
02605             <span class="comment">// Otherwise, stick to the original word delimiter.</span>
02606             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a14">gaWordDelimChars</a>[0] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
02607         }
02608 
02609         <span class="comment">// Read word delimiters from registry</span>
02610         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hConsoleKey,
02611                     CONSOLE_REGISTRY_WORD_DELIM,
02612                     <span class="keyword">sizeof</span> awchBuffer,
02613                     (PBYTE)awchBuffer))) {
02614             <span class="comment">// OK, copy it to the word delimiter array.</span>
02615             wcsncpy(gaWordDelimChars, awchBuffer, WORD_DELIM_MAX);
02616             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a14">gaWordDelimChars</a>[<a class="code" href="../../d4/d1/cmdline_8h.html#a24">WORD_DELIM_MAX</a> - 1] = 0;
02617         }
02618 
02619         <span class="comment">//</span>
02620         <span class="comment">// Read Trim Zero Heading flag</span>
02621         <span class="comment">//</span>
02622         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d5/srvinit_8c.html#a41">MyRegQueryValue</a>(hTitleKey,
02623                            CONSOLE_REGISTRY_TRIMZEROHEADINGS,
02624                            <span class="keyword">sizeof</span>(dwValue), (PBYTE)&amp;dwValue))) {
02625             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a25">gfTrimLeadingZeros</a> = dwValue;
02626         } <span class="keywordflow">else</span> {
02627             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a25">gfTrimLeadingZeros</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02628         }
02629     }
02630 
02631 
02632     <span class="comment">//</span>
02633     <span class="comment">// Close the registry keys</span>
02634     <span class="comment">//</span>
02635 
02636     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hTitleKey);
02637     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hConsoleKey);
02638     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hCurrentUserKey);
02639     CsrRevertToSelf();
02640 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a112" doxytag="consrv.h::GetScreenBufferInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetScreenBufferInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>CursorPosition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ScrollPosition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Attributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentWindowSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumWindowSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l02093">2093</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00141">SrvGetConsoleScreenBufferInfo()</a>.
<p>
<pre class="fragment"><div>02105                    :
02106 
02107     This routine returns data about <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer.
02108 
02109 Arguments:
02110 
02111     ScreenInfo - Pointer to screen buffer information.
02112 
02113     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - Pointer to location in which to store screen buffer size.
02114 
02115     CursorPosition - Pointer to location in which to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cursor position.
02116 
02117     ScrollPosition - Pointer to location in which to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scroll position.
02118 
02119     Attributes - Pointer to location in which to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> attributes.
02120 
02121     CurrentWindowSize - Pointer to location in which to store current window size.
02122 
02123     MaximumWindowSize - Pointer to location in which to store maximum window size.
02124 
02125 Return Value:
02126 
02127 --*/
02128 
02129 {
02130     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
02131 
02132     *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = ScreenInfo-&gt;ScreenBufferSize;
02133     *CursorPosition = ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
02134     ScrollPosition-&gt;X = ScreenInfo-&gt;Window.Left;
02135     ScrollPosition-&gt;Y = ScreenInfo-&gt;Window.Top;
02136     *Attributes = ScreenInfo-&gt;Attributes;
02137     CurrentWindowSize-&gt;X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
02138     CurrentWindowSize-&gt;Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
02139     <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
02140         MaximumWindowSize-&gt;X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(80,ScreenInfo-&gt;ScreenBufferSize.X);
02141 <span class="preprocessor">#if defined(FE_SB)</span>
02142 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console))
02143         {
02144             MaximumWindowSize-&gt;Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(25,ScreenInfo-&gt;ScreenBufferSize.Y);
02145         }
02146         <span class="keywordflow">else</span>
02147         {
02148             MaximumWindowSize-&gt;Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(50,ScreenInfo-&gt;ScreenBufferSize.Y);
02149         }
02150 <span class="preprocessor">#else</span>
02151 <span class="preprocessor"></span>        MaximumWindowSize-&gt;Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(50,ScreenInfo-&gt;ScreenBufferSize.Y);
02152 <span class="preprocessor">#endif</span>
02153 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
02154         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
02155         *MaximumWindowSize = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>;
02156     }
02157     <span class="keywordflow">return</span> STATUS_SUCCESS;
02158 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a156" doxytag="consrv.h::GetTitleFromLinkName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetTitleFromLinkName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>szLinkName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>szTitle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/link_8c-source.html#l00016">16</a> of file <a class="el" href="../../d4/d3/link_8c-source.html">link.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00030">MAX_TITLE_LENGTH</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d5/ntcon_2conime_2globals_8h-source.html#l00024">szTitle</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00360">LoadLinkInfo()</a>.
<p>
<pre class="fragment"><div>00022                    :
00023 
00024     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> title (i.e., display name of the link) in <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>,
00025     and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes (not chars) in <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>.
00026 
00027 Arguments:
00028 
00029     szLinkName - fully qualified <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> to link <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>
00030     <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>    - pointer to buffer to contain title (display name) of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> link
00031 
00032     i.e.:
00033     <span class="stringliteral">"C:\nt\desktop\A Link File Name.lnk"</span> --&gt; <span class="stringliteral">"A Link File Name"</span>
00034 
00035 Return Value:
00036 
00037     number of bytes copied to <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>
00038 
00039 --*/
00040 {
00041     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLen;
00042     LPWSTR pLnk, pDot;
00043     LPWSTR pPath = szLinkName;
00044 
00045     <span class="comment">// Error checking</span>
00046     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(szLinkName);
00047 
00048     <span class="comment">// find filename at end of fully qualified link name and point pLnk to it</span>
00049     <span class="keywordflow">for</span> (pLnk = pPath; *pPath; pPath++)
00050     {
00051         <span class="keywordflow">if</span> ( (pPath[0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span> || pPath[0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">':'</span>) &amp;&amp;
00052               pPath[1] &amp;&amp;
00053              (pPath[1] != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>)
00054             )
00055             pLnk = pPath + 1;
00056     }
00057 
00058     <span class="comment">// find extension (.lnk)</span>
00059     pPath = pLnk;
00060     <span class="keywordflow">for</span> (pDot = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; *pPath; pPath++)
00061     {
00062         <span class="keywordflow">switch</span> (*pPath) {
00063         <span class="keywordflow">case</span> <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'.'</span>:
00064             pDot = pPath;       <span class="comment">// remember the last dot</span>
00065             <span class="keywordflow">break</span>;
00066         <span class="keywordflow">case</span> <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>:
00067         <span class="keywordflow">case</span> <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>:              <span class="comment">// extensions can't have spaces</span>
00068             pDot = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;        <span class="comment">// forget last dot, it was in a directory</span>
00069             <span class="keywordflow">break</span>;
00070         }
00071     }
00072 
00073     <span class="comment">// if we found the extension, pDot points to it, if not, pDot</span>
00074     <span class="comment">// is NULL.</span>
00075 
00076     <span class="keywordflow">if</span> (pDot)
00077     {
00078         dwLen = (ULONG)((pDot - pLnk) * <span class="keyword">sizeof</span>(WCHAR));
00079     }
00080     <span class="keywordflow">else</span>
00081     {
00082         dwLen = lstrlenW(pLnk) * <span class="keyword">sizeof</span>(WCHAR);
00083     }
00084     dwLen = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwLen, MAX_TITLE_LENGTH);
00085 
00086     RtlCopyMemory(szTitle, pLnk, dwLen);
00087 
00088     <span class="keywordflow">return</span> dwLen;
00089 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a113" doxytag="consrv.h::GetWindowLimits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID GetWindowLimits           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d9/struct__WINDOW__LIMITS.html">PWINDOW_LIMITS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WindowLimits</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l00207">207</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00101">CONSOLE_AUTO_POSITION</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00086">ConsoleCaptionY</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00084">ConsoleFullScreenX</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00085">ConsoleFullScreenY</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01824">GetMonitorInfo()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00104">gfInitSystemMetrics</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00102">gnConsoleWindows</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00049">HorizontalClientToWindow</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00177">InitializeSystemMetrics()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00045">MinimumWidthX</a>, <a class="el" href="../../d4/d0/mmcl_8c-source.html#l00042">MonitorFromRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d2/output_8h.html#a38">PWINDOW_LIMITS</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00048">VerticalClientToWindow</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">GetAvailableFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01053">GetCurrentFont()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02093">GetScreenBufferInformation()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00555">SrvGetLargestConsoleWindowSize()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00608">SrvSetConsoleScreenBufferSize()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">SrvSetConsoleWindowInfo()</a>.
<p>
<pre class="fragment"><div>00211 {
00212     HMONITOR hMonitor;
00213     MONITORINFO MonitorInfo = {<span class="keyword">sizeof</span>(MonitorInfo)};
00214     COORD FontSize;
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">// If the system metrics have changed or there aren't any console</span>
00218     <span class="comment">// windows around, reinitialize the global valeus.</span>
00219     <span class="comment">//</span>
00220 
00221     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a23">gfInitSystemMetrics</a> || <a class="code" href="../../d6/d2/output_8c.html#a22">gnConsoleWindows</a> == 0) {
00222         <a class="code" href="../../d6/d2/output_8c.html#a38">InitializeSystemMetrics</a>();
00223     }
00224 
00225     <span class="keywordflow">if</span> (ScreenInfo-&gt;Console &amp;&amp;
00226             (ScreenInfo-&gt;Console-&gt;hWnd || !(ScreenInfo-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a16">CONSOLE_AUTO_POSITION</a>)) &amp;&amp;
00227             ((hMonitor = <a class="code" href="../../d3/d1/mmcl_8c.html#a1">MonitorFromRect</a>(&amp;ScreenInfo-&gt;Console-&gt;WindowRect, MONITOR_DEFAULTTOPRIMARY)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00228             <a class="code" href="../../d5/d9/cltxt_8h.html#a38">GetMonitorInfo</a>(hMonitor, &amp;MonitorInfo)) {
00229         WindowLimits-&gt;FullScreenSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(MonitorInfo.rcWork.right - MonitorInfo.rcWork.left);
00230         WindowLimits-&gt;FullScreenSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(MonitorInfo.rcWork.bottom - MonitorInfo.rcWork.top - <a class="code" href="../../d6/d2/output_8c.html#a13">ConsoleCaptionY</a>);
00231     } <span class="keywordflow">else</span> {
00232         WindowLimits-&gt;FullScreenSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d2/output_8c.html#a11">ConsoleFullScreenX</a>;
00233         WindowLimits-&gt;FullScreenSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d2/output_8c.html#a12">ConsoleFullScreenY</a>;
00234     }
00235 
00236     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00237         FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
00238     } <span class="keywordflow">else</span> {
00239         FontSize.X = 1;
00240         FontSize.Y = 1;
00241     }
00242 
00243     WindowLimits-&gt;MinimumWindowSize.X = ((<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a16">MinimumWidthX</a> - <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a> + FontSize.X - 1) / FontSize.X);
00244     WindowLimits-&gt;MinimumWindowSize.Y = 1;
00245     WindowLimits-&gt;MaximumWindowSize.X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(WindowLimits-&gt;FullScreenSize.X/FontSize.X, ScreenInfo-&gt;ScreenBufferSize.X);
00246     WindowLimits-&gt;MaximumWindowSize.X = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(WindowLimits-&gt;MaximumWindowSize.X, WindowLimits-&gt;MinimumWindowSize.X);
00247     WindowLimits-&gt;MaximumWindowSize.Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(WindowLimits-&gt;FullScreenSize.Y/FontSize.Y, ScreenInfo-&gt;ScreenBufferSize.Y);
00248     WindowLimits-&gt;MaxWindow.X = WindowLimits-&gt;MaximumWindowSize.X*FontSize.X + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a>;
00249     WindowLimits-&gt;MaxWindow.Y = WindowLimits-&gt;MaximumWindowSize.Y*FontSize.Y + <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a20">HorizontalClientToWindow</a>;
00250 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a314" doxytag="consrv.h::GreGetDIBitsInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int APIENTRY GreGetDIBitsInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBITMAP&nbsp;</td>
          <td class="mdname" nowrap> <em>hBitmap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>iStartScan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cNumScan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pjBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBITMAPINFO&nbsp;</td>
          <td class="mdname" nowrap> <em>pBitsInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>iUsage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cjMaxBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cjMaxInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l01286">BMPtoDIB()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="consrv.h::GrowIoHandleTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GrowIoHandleTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ProcessData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01234">1234</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00292">CONSOLE_INITIAL_IO_HANDLES</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00293">CONSOLE_IO_HANDLE_INCREMENT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d1/d7/server_8h.html#a112">HANDLE_DATA</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00067">HANDLE_TAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01390">AllocateIoHandle()</a>.
<p>
<pre class="fragment"><div>01240                    :
01241 
01242     This routine grows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-process io handle table.
01243 
01244 Arguments:
01245 
01246     ProcessData - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-process data structure.
01247 
01248 Return Value:
01249 
01250 --*/
01251 
01252 {
01253     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> NewTable;
01254     ULONG i;
01255     ULONG MaxFileHandles;
01256 
01257     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;Foo == 0xF00);
01258     MaxFileHandles = ProcessData-&gt;HandleTableSize + <a class="code" href="../../d1/d7/server_8h.html#a46">CONSOLE_IO_HANDLE_INCREMENT</a>;
01259     NewTable = (<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HANDLE_TAG ),MaxFileHandles * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">HANDLE_DATA</a>));
01260     <span class="keywordflow">if</span> (NewTable == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01261         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01262     }
01263     RtlCopyMemory(NewTable, ProcessData-&gt;HandleTablePtr,
01264                   ProcessData-&gt;HandleTableSize * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">HANDLE_DATA</a>));
01265     <span class="keywordflow">for</span> (i=ProcessData-&gt;HandleTableSize;i&lt;MaxFileHandles;i++) {
01266         NewTable[i].<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> = <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>;
01267     }
01268     <span class="keywordflow">if</span> (ProcessData-&gt;HandleTableSize != <a class="code" href="../../d1/d7/server_8h.html#a45">CONSOLE_INITIAL_IO_HANDLES</a>) {
01269         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ProcessData-&gt;HandleTablePtr);
01270     }
01271     ProcessData-&gt;HandleTablePtr = NewTable;
01272     ProcessData-&gt;HandleTableSize = MaxFileHandles;
01273     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;Foo == 0xF00);
01274     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;HandleTableSize != 0);
01275     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ProcessData-&gt;HandleTableSize &lt;= 0x0000FFFF);
01276     <span class="keywordflow">return</span> STATUS_SUCCESS;
01277 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a151" doxytag="consrv.h::HandleCtrlEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HandleCtrlEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>EventType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03430">3430</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00277">CONSOLE_CTRL_BREAK_FLAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00276">CONSOLE_CTRL_C_FLAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00278">CONSOLE_CTRL_CLOSE_FLAG</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00444">SrvGenerateConsoleCtrlEvent()</a>.
<p>
<pre class="fragment"><div>03434 {
03435     <span class="keywordflow">switch</span> (EventType) {
03436         <span class="keywordflow">case</span> CTRL_C_EVENT:
03437             Console-&gt;CtrlFlags |= <a class="code" href="../../d1/d7/server_8h.html#a31">CONSOLE_CTRL_C_FLAG</a>;
03438             <span class="keywordflow">break</span>;
03439         <span class="keywordflow">case</span> CTRL_BREAK_EVENT:
03440             Console-&gt;CtrlFlags |= <a class="code" href="../../d1/d7/server_8h.html#a32">CONSOLE_CTRL_BREAK_FLAG</a>;
03441             <span class="keywordflow">break</span>;
03442         <span class="keywordflow">case</span> CTRL_CLOSE_EVENT:
03443             Console-&gt;CtrlFlags |= <a class="code" href="../../d1/d7/server_8h.html#a33">CONSOLE_CTRL_CLOSE_FLAG</a>;
03444             <span class="keywordflow">break</span>;
03445         <span class="keywordflow">default</span>:
03446             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (FALSE);
03447     }
03448 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a150" doxytag="consrv.h::HandleFocusEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HandleFocusEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bSetFocus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03369">3369</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00098">CONSOLE_CONNECTED_TO_EMULATOR</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02843">TIF_DOSEMULATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02842">TIF_VDMAPP</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01567">DisplayModeTransition()</a>.
<p>
<pre class="fragment"><div>03373 {
03374     INPUT_RECORD InputEvent;
03375     ULONG EventsWritten;
03376     USERTHREAD_FLAGS Flags;
03377 
03378     InputEvent.EventType = FOCUS_EVENT;
03379     InputEvent.Event.FocusEvent.bSetFocus = bSetFocus;
03380 
03381     Flags.dwFlags = 0;
03382     <span class="keywordflow">if</span> (bSetFocus) {
03383         <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>) {
03384             Flags.dwFlags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a810">TIF_VDMAPP</a>;
03385         }
03386         <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a13">CONSOLE_CONNECTED_TO_EMULATOR</a>) {
03387             Flags.dwFlags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a811">TIF_DOSEMULATOR</a>;
03388         }
03389     }
03390 
03391     Flags.dwMask = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a810">TIF_VDMAPP</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a811">TIF_DOSEMULATOR</a>);
03392     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(Console-&gt;InputThreadInfo-&gt;ThreadHandle,
03393             UserThreadFlags, &amp;Flags, <span class="keyword">sizeof</span>(Flags));
03394     EventsWritten = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>( Console,
03395                                       &amp;Console-&gt;InputBuffer,
03396                                       &amp;InputEvent,
03397                                       1
03398                                      );
03399 <span class="preprocessor">#if DBG</span>
03400 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (EventsWritten != 1) {
03401         OutputDebugStringA(<span class="stringliteral">"PutInputInBuffer: EventsWritten != 1, 1 expected\n"</span>);
03402     }
03403 <span class="preprocessor">#endif</span>
03404 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a147" doxytag="consrv.h::HandleKeyEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HandleKeyEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">2397</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00067">_ROW::CharRow</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01222">ClearScroll()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a45">CodePageToCharSet()</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00073">CONIME_HOTKEY</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00083">CONIME_KEYDATA</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00077">CONIME_NOTIFY_VK_KANA</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00110">CONSOLE_CTRL_BREAK_SEEN</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00109">CONSOLE_CTRL_C_SEEN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00102">CONSOLE_IGNORE_NEXT_KEYUP</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00150">CONSOLE_IS_IME_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00125">CONSOLE_MOUSE_DOWN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00106">CONSOLE_SCROLLBAR_TRACKING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00118">CONSOLE_SUSPENDED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00078">CTRL_BUT_NOT_ALT</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00032">DialogBoxCount</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00485">FlushInputBuffer()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02179">GetControlKeyState()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00381">GetKeyboardState</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03430">HandleCtrlEvent()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04653">HorizontalScroll()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a54">ImmConversionToConsole()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01320">IsSystemKey()</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00102">KEY_PRESSED</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00107">KEY_TRANSITION_UP</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02348">MakeCursorVisible()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00060">MAX_CHARS_FROM_1_KEYSTROKE</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12932">NtUserCheckImeHotKey()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12826">NtUserGetImeHotKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01609">RetrieveKeyInfo()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02235">TerminateRead()</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00973">ToUnicodeEx()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04575">VerticalScroll()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02272">HandleSysKeyEvent()</a>.
<p>
<pre class="fragment"><div>02404 {
02405     INPUT_RECORD InputEvent;
02406     BOOLEAN ContinueProcessing;
02407     ULONG EventsWritten;
02408     WORD VirtualKeyCode;
02409     ULONG ControlKeyState;
02410     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bKeyDown;
02411     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bGenerateBreak=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02412 <span class="preprocessor">#ifdef FE_SB</span>
02413 <span class="preprocessor"></span>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> KeyMessageFromConsoleIME;
02414 <span class="preprocessor">#endif</span>
02415 <span class="preprocessor"></span>
02416 <span class="preprocessor">#ifdef FE_SB</span>
02417 <span class="preprocessor"></span>    <span class="comment">// v-HirShi Sep.21.1995 For Console IME</span>
02418     <span class="keywordflow">if</span> ((WM_KEYFIRST+<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>) &lt;= Message &amp;&amp; Message &lt;= (WM_KEYLAST+<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>)) {
02419         Message -= <a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a> ;
02420         KeyMessageFromConsoleIME = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
02421     }
02422     <span class="keywordflow">else</span> {
02423         KeyMessageFromConsoleIME = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
02424     }
02425 <span class="preprocessor">#endif</span>
02426 <span class="preprocessor"></span>    <span class="comment">/*</span>
02427 <span class="comment">     * BOGUS for WM_CHAR/WM_DEADCHAR, in which LOWORD(lParam) is a character</span>
02428 <span class="comment">     */</span>
02429     VirtualKeyCode = LOWORD(wParam);
02430     ControlKeyState = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a42">GetControlKeyState</a>(lParam);
02431     bKeyDown = !(lParam &amp; <a class="code" href="../../d9/d3/input_8h.html#a22">KEY_TRANSITION_UP</a>);
02432 
02433     <span class="comment">//</span>
02434     <span class="comment">// Make sure we retrieve the key info first, or we could chew up</span>
02435     <span class="comment">// unneeded space in the key info table if we bail out early.</span>
02436     <span class="comment">//</span>
02437 
02438     InputEvent.Event.KeyEvent.wVirtualKeyCode = VirtualKeyCode;
02439     InputEvent.Event.KeyEvent.wVirtualScanCode = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(HIWORD(lParam));
02440     <span class="keywordflow">if</span> (Message == WM_CHAR || Message == WM_SYSCHAR ||
02441         Message == WM_DEADCHAR || Message == WM_SYSDEADCHAR) {
02442         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a32">RetrieveKeyInfo</a>(hWnd,
02443                         &amp;InputEvent.Event.KeyEvent.wVirtualKeyCode,
02444                         &amp;InputEvent.Event.KeyEvent.wVirtualScanCode,
02445                         !(Console-&gt;InputBuffer.ImeMode.Open ^ KeyMessageFromConsoleIME));
02446         VirtualKeyCode = InputEvent.Event.KeyEvent.wVirtualKeyCode;
02447     }
02448 
02449     <span class="comment">//</span>
02450     <span class="comment">// If this is a key up message, should we ignore it? We do this</span>
02451     <span class="comment">// so that if a process reads a line from the input buffer, the</span>
02452     <span class="comment">// key up event won't get put in the buffer after the read</span>
02453     <span class="comment">// completes.</span>
02454     <span class="comment">//</span>
02455 
02456     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a17">CONSOLE_IGNORE_NEXT_KEYUP</a>) {
02457         Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a17">CONSOLE_IGNORE_NEXT_KEYUP</a>;
02458         <span class="keywordflow">if</span> (!bKeyDown)
02459             <span class="keywordflow">return</span>;
02460     }
02461 
02462 <span class="preprocessor">#ifdef FE_SB</span>
02463 <span class="preprocessor"></span>    <span class="comment">// v-HirShi Sep.21.1995 For Console IME</span>
02464     <span class="keywordflow">if</span> (KeyMessageFromConsoleIME) {
02465         <span class="keywordflow">goto</span> FromConsoleIME ;
02466     }
02467 <span class="preprocessor">#endif</span>
02468 <span class="preprocessor"></span>
02469     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
02470 
02471         <span class="keywordflow">if</span> (!bKeyDown) {
02472             <span class="keywordflow">return</span>;
02473         }
02474 
02475         <span class="comment">//</span>
02476         <span class="comment">// if escape or ctrl-c, cancel selection</span>
02477         <span class="comment">//</span>
02478 
02479         <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>) ) {
02480             <span class="keywordflow">if</span> (VirtualKeyCode == VK_ESCAPE ||
02481                 (VirtualKeyCode == <span class="charliteral">'C'</span> &amp;&amp;
02482                  (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_CONTROL) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) )) {
02483                 <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);
02484                 <span class="keywordflow">return</span>;
02485             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VirtualKeyCode == VK_RETURN) {
02486 
02487                 <span class="comment">// if return, copy selection</span>
02488 
02489                 <a class="code" href="../../d8/d5/consrv_8h.html#a300">DoCopy</a>(Console);
02490                 <span class="keywordflow">return</span>;
02491             }
02492         }
02493         <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a>)) {
02494             <span class="keywordflow">if</span> ((Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) &amp;&amp;
02495                 (VirtualKeyCode == VK_RIGHT ||
02496                  VirtualKeyCode == VK_LEFT ||
02497                  VirtualKeyCode == VK_UP ||
02498                  VirtualKeyCode == VK_DOWN ||
02499                  VirtualKeyCode == VK_NEXT ||
02500                  VirtualKeyCode == VK_PRIOR ||
02501                  VirtualKeyCode == VK_END ||
02502                  VirtualKeyCode == VK_HOME
02503                 ) ) {
02504                 <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
02505 <span class="preprocessor">#ifdef FE_SB</span>
02506 <span class="preprocessor"></span>                <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RowIndex;
02507                 <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
02508                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> KAttrs;
02509                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> NextRightX;
02510                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> NextLeftX;
02511 <span class="preprocessor">#endif</span>
02512 <span class="preprocessor"></span>
02513                 ScreenInfo = Console-&gt;CurrentScreenBuffer;
02514 
02515                 <span class="comment">//</span>
02516                 <span class="comment">// see if shift is down.  if so, we're extending</span>
02517                 <span class="comment">// the selection.  otherwise, we're resetting the</span>
02518                 <span class="comment">// anchor</span>
02519                 <span class="comment">//</span>
02520 
02521                 <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
02522 <span class="preprocessor">#ifdef FE_SB</span>
02523 <span class="preprocessor"></span>                RowIndex = (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.FirstRow+ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y) % ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y;
02524                 Row = &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Rows[RowIndex];
02525 
02526                <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
02527                {
02528                     KAttrs = Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X];
02529                     <span class="keywordflow">if</span> (KAttrs &amp; ATTR_LEADING_BYTE)
02530                         NextRightX = 2;
02531                     <span class="keywordflow">else</span>
02532                         NextRightX = 1;
02533                 }
02534                 <span class="keywordflow">else</span>
02535                 {
02536                     NextRightX = 1;
02537                 }
02538                 <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X &gt; 0) {
02539                     <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
02540                         KAttrs = Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X-1];
02541                         <span class="keywordflow">if</span> (KAttrs &amp; ATTR_TRAILING_BYTE)
02542                             NextLeftX = 2;
02543                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (KAttrs &amp; ATTR_LEADING_BYTE) {
02544                             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X-1 &gt; 0) {
02545                                 KAttrs = Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X-2];
02546                                 <span class="keywordflow">if</span> (KAttrs &amp; ATTR_TRAILING_BYTE)
02547                                     NextLeftX = 3;
02548                                 <span class="keywordflow">else</span>
02549                                     NextLeftX = 2;
02550                             }
02551                             <span class="keywordflow">else</span>
02552                                 NextLeftX = 1;
02553                         }
02554                         <span class="keywordflow">else</span>
02555                             NextLeftX = 1;
02556                     }
02557                     <span class="keywordflow">else</span>
02558                         NextLeftX = 1;
02559                 }
02560 
02561                 <span class="keywordflow">switch</span> (VirtualKeyCode) {
02562                     <span class="keywordflow">case</span> VK_RIGHT:
02563                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X+NextRightX &lt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X) {
02564                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X+=NextRightX;
02565                         }
02566                         <span class="keywordflow">break</span>;
02567                     <span class="keywordflow">case</span> VK_LEFT:
02568                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X &gt; 0) {
02569                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X-=NextLeftX;
02570                         }
02571                         <span class="keywordflow">break</span>;
02572                     <span class="keywordflow">case</span> VK_UP:
02573                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y &gt; 0) {
02574                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y-=1;
02575                         }
02576                         <span class="keywordflow">break</span>;
02577                     <span class="keywordflow">case</span> VK_DOWN:
02578                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y+1 &lt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
02579                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y+=1;
02580                         }
02581                         <span class="keywordflow">break</span>;
02582                     <span class="keywordflow">case</span> VK_NEXT:
02583                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y += <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-1;
02584                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
02585                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-1;
02586                         }
02587                         <span class="keywordflow">break</span>;
02588                     <span class="keywordflow">case</span> VK_PRIOR:
02589                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y -= <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-1;
02590                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y &lt; 0) {
02591                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = 0;
02592                         }
02593                         <span class="keywordflow">break</span>;
02594                     <span class="keywordflow">case</span> VK_END:
02595                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
02596                         <span class="keywordflow">break</span>;
02597                     <span class="keywordflow">case</span> VK_HOME:
02598                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X = 0;
02599                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = 0;
02600                         <span class="keywordflow">break</span>;
02601                     <span class="keywordflow">default</span>:
02602                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
02603                 }
02604 <span class="preprocessor">#else   // FE_SB</span>
02605 <span class="preprocessor"></span>                <span class="keywordflow">switch</span> (VirtualKeyCode) {
02606                     <span class="keywordflow">case</span> VK_RIGHT:
02607                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X+1 &lt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X) {
02608                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X+=1;
02609                         }
02610                         <span class="keywordflow">break</span>;
02611                     <span class="keywordflow">case</span> VK_LEFT:
02612                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X &gt; 0) {
02613                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X-=1;
02614                         }
02615                         <span class="keywordflow">break</span>;
02616                     <span class="keywordflow">case</span> VK_UP:
02617                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y &gt; 0) {
02618                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y-=1;
02619                         }
02620                         <span class="keywordflow">break</span>;
02621                     <span class="keywordflow">case</span> VK_DOWN:
02622                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y+1 &lt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
02623                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y+=1;
02624                         }
02625                         <span class="keywordflow">break</span>;
02626                     <span class="keywordflow">case</span> VK_NEXT:
02627                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y += <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-1;
02628                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
02629                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-1;
02630                         }
02631                         <span class="keywordflow">break</span>;
02632                     <span class="keywordflow">case</span> VK_PRIOR:
02633                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y -= <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-1;
02634                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y &lt; 0) {
02635                             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = 0;
02636                         }
02637                         <span class="keywordflow">break</span>;
02638                     <span class="keywordflow">case</span> VK_END:
02639                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
02640                         <span class="keywordflow">break</span>;
02641                     <span class="keywordflow">case</span> VK_HOME:
02642                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.X = 0;
02643                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition.Y = 0;
02644                         <span class="keywordflow">break</span>;
02645                     <span class="keywordflow">default</span>:
02646                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
02647                 }
02648 <span class="preprocessor">#endif  // FE_SB</span>
02649 <span class="preprocessor"></span>                <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
02650                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) {
02651                     {
02652                         <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition);
02653                     }
02654                 } <span class="keywordflow">else</span> {
02655                     <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>) {
02656                         <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
02657                         Console-&gt;SelectionFlags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
02658                         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
02659                     }
02660                     Console-&gt;SelectionAnchor = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition;
02661                     <a class="code" href="../../d0/d7/server_2stream_8c.html#a28">MakeCursorVisible</a>(ScreenInfo,Console-&gt;SelectionAnchor);
02662                     Console-&gt;SelectionRect.Left = Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
02663                     Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
02664                 }
02665                 <span class="keywordflow">return</span>;
02666             }
02667         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>)) {
02668 
02669             <span class="comment">//</span>
02670             <span class="comment">// if in mouse selection mode and user hits a key, cancel selection</span>
02671             <span class="comment">//</span>
02672 
02673             <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a27">IsSystemKey</a>(VirtualKeyCode)) {
02674                 <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);
02675             }
02676         }
02677     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>) {
02678 
02679         <span class="keywordflow">if</span> (!bKeyDown) {
02680             <span class="keywordflow">return</span>;
02681         }
02682 
02683         <span class="comment">//</span>
02684         <span class="comment">// if escape, enter or ctrl-c, cancel scroll</span>
02685         <span class="comment">//</span>
02686 
02687         <span class="keywordflow">if</span> (VirtualKeyCode == VK_ESCAPE ||
02688             VirtualKeyCode == VK_RETURN ||
02689             (VirtualKeyCode == <span class="charliteral">'C'</span> &amp;&amp;
02690              (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_CONTROL) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) )) {
02691             <a class="code" href="../../d8/d5/consrv_8h.html#a312">ClearScroll</a>(Console);
02692         } <span class="keywordflow">else</span> {
02693             WORD ScrollCommand;
02694             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Horizontal=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02695             <span class="keywordflow">switch</span> (VirtualKeyCode) {
02696                 <span class="keywordflow">case</span> VK_UP:
02697                     ScrollCommand = SB_LINEUP;
02698                     <span class="keywordflow">break</span>;
02699                 <span class="keywordflow">case</span> VK_DOWN:
02700                     ScrollCommand = SB_LINEDOWN;
02701                     <span class="keywordflow">break</span>;
02702                 <span class="keywordflow">case</span> VK_LEFT:
02703                     ScrollCommand = SB_LINEUP;
02704                     Horizontal=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02705                     <span class="keywordflow">break</span>;
02706                 <span class="keywordflow">case</span> VK_RIGHT:
02707                     ScrollCommand = SB_LINEDOWN;
02708                     Horizontal=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02709                     <span class="keywordflow">break</span>;
02710                 <span class="keywordflow">case</span> VK_NEXT:
02711                     ScrollCommand = SB_PAGEDOWN;
02712                     <span class="keywordflow">break</span>;
02713                 <span class="keywordflow">case</span> VK_PRIOR:
02714                     ScrollCommand = SB_PAGEUP;
02715                     <span class="keywordflow">break</span>;
02716                 <span class="keywordflow">case</span> VK_END:
02717                     ScrollCommand = SB_PAGEDOWN;
02718                     Horizontal=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02719                     <span class="keywordflow">break</span>;
02720                 <span class="keywordflow">case</span> VK_HOME:
02721                     ScrollCommand = SB_PAGEUP;
02722                     Horizontal=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02723                     <span class="keywordflow">break</span>;
02724                 <span class="keywordflow">case</span> VK_SHIFT:
02725                 <span class="keywordflow">case</span> VK_CONTROL:
02726                 <span class="keywordflow">case</span> VK_MENU:
02727                     <span class="keywordflow">return</span>;
02728                 <span class="keywordflow">default</span>:
02729                     Beep(800, 200);
02730                     <span class="keywordflow">return</span>;
02731             }
02732             <span class="keywordflow">if</span> (Horizontal)
02733                 <a class="code" href="../../d6/d2/output_8c.html#a82">HorizontalScroll</a>(Console-&gt;CurrentScreenBuffer, ScrollCommand, 0);
02734             <span class="keywordflow">else</span>
02735                 <a class="code" href="../../d6/d2/output_8c.html#a81">VerticalScroll</a>(Console, Console-&gt;CurrentScreenBuffer,ScrollCommand,0);
02736         }
02737         <span class="keywordflow">return</span>;
02738     }
02739 
02740     <span class="comment">//</span>
02741     <span class="comment">// if the user is inputting chars at an inappropriate time, beep.</span>
02742     <span class="comment">//</span>
02743 
02744     <span class="keywordflow">if</span> ((Console-&gt;Flags &amp; (<a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> | <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a> | <a class="code" href="../../d1/d7/server_8h.html#a21">CONSOLE_SCROLLBAR_TRACKING</a>)) &amp;&amp;
02745         bKeyDown &amp;&amp;
02746         !<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a27">IsSystemKey</a>(VirtualKeyCode)) {
02747         Beep(800, 200);
02748         <span class="keywordflow">return</span>;
02749     }
02750 
02751     <span class="comment">//</span>
02752     <span class="comment">// if in fullscreen mode, process PrintScreen</span>
02753     <span class="comment">//</span>
02754 
02755 <span class="preprocessor">#ifdef LATER</span>
02756 <span class="preprocessor"></span><span class="comment">//</span>
02757 <span class="comment">// Changed this code to get commas to work (build 485).</span>
02758 <span class="comment">//</span>
02759 <span class="comment">// Therese, the problem is that WM_CHAR/WM_SYSCHAR messages come through</span>
02760 <span class="comment">// here - in this case, LOWORD(wParam) is a character value and not a virtual</span>
02761 <span class="comment">// key. It happens that VK_SNAPSHOT == 0x2c, and the character value for a</span>
02762 <span class="comment">// comma is also == 0x2c, so execution enters this conditional when a comma</span>
02763 <span class="comment">// is hit. Commas aren't coming out because of the newly entered return</span>
02764 <span class="comment">// statement.</span>
02765 <span class="comment">//</span>
02766 <span class="comment">// HandleKeyEvent() is making many virtual key comparisons - need to make</span>
02767 <span class="comment">// sure that for each one, there is either no corresponding character value,</span>
02768 <span class="comment">// or that you check before you compare so that you are comparing two values</span>
02769 <span class="comment">// that have the same data type.</span>
02770 <span class="comment">//</span>
02771 <span class="comment">// I added the message comparison so that we know we're checking virtual</span>
02772 <span class="comment">// keys against virtual keys and not characters.</span>
02773 <span class="comment">//</span>
02774 <span class="comment">// - scottlu</span>
02775 <span class="comment">//</span>
02776 
02777 <span class="preprocessor">#endif</span>
02778 <span class="preprocessor"></span>
02779     <span class="keywordflow">if</span> (Message != WM_CHAR &amp;&amp; Message != WM_SYSCHAR &amp;&amp;
02780         VirtualKeyCode == VK_SNAPSHOT &amp;&amp;
02781         !(Console-&gt;ReserveKeys &amp; (CONSOLE_ALTPRTSC | CONSOLE_PRTSC )) ) {
02782         <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
02783             Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
02784             Console-&gt;SelectionRect = Console-&gt;CurrentScreenBuffer-&gt;Window;
02785             <a class="code" href="../../d8/d5/consrv_8h.html#a307">StoreSelection</a>(Console);
02786             Console-&gt;SelectionFlags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
02787         }
02788         <span class="keywordflow">return</span>;
02789     }
02790 
02791     <span class="comment">//</span>
02792     <span class="comment">// IME stuff</span>
02793     <span class="comment">//</span>
02794     <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) {
02795         LPARAM lParamForHotKey ;
02796         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> HotkeyID ;
02797         lParamForHotKey = lParam ;
02798 
02799         HotkeyID = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a397">NtUserCheckImeHotKey</a>( (VirtualKeyCode &amp; 0x00ff),lParamForHotKey) ;
02800         <span class="comment">//</span>
02801         <span class="comment">// If it's direct KL switching hokey, handle it here</span>
02802         <span class="comment">// regardless the system is IME enabled or not.</span>
02803         <span class="comment">//</span>
02804         <span class="keywordflow">if</span> (HotkeyID &gt;= IME_HOTKEY_DSWITCH_FIRST &amp;&amp; HotkeyID &lt;= IME_HOTKEY_DSWITCH_LAST) {
02805             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uModifier, uVkey;
02806             HKL hkl;
02807 
02808             RIPMSG1(RIP_VERBOSE, <span class="stringliteral">"HandleKeyEvent: handling IME HOTKEY id=%x"</span>, HotkeyID);
02809             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a393">NtUserGetImeHotKey</a>(HotkeyID, &amp;uModifier, &amp;uVkey, &amp;hkl) &amp;&amp; hkl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02810                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bCharSetSys = <a class="code" href="../../d0/d3/dbcs_8h.html#a45">CodePageToCharSet</a>(GetACP());
02811                 WPARAM wpSysChar = 0;
02812                 CHARSETINFO cs;
02813 
02814                 <span class="keywordflow">if</span> (TranslateCharsetInfo((LPDWORD)LOWORD(hkl), &amp;cs, TCI_SRCLOCALE)) {
02815                     <span class="keywordflow">if</span> (bCharSetSys == cs.ciCharset) {
02816                         wpSysChar = INPUTLANGCHANGE_SYSCHARSET;
02817                     }
02818                 }
02819                 <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(hWnd, WM_INPUTLANGCHANGEREQUEST, wpSysChar, (LPARAM)hkl);
02820             }
02821             <span class="keywordflow">return</span>;
02822         }
02823 
02824         <span class="keywordflow">if</span> (!(Console-&gt;InputBuffer.ImeMode.Disable) &amp;&amp; <a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
02825 
02826             <span class="keywordflow">if</span> (HotkeyID != IME_INVALID_HOTKEY) {
02827                 <span class="keywordflow">switch</span>(HotkeyID) {
02828                 <span class="keywordflow">case</span> IME_JHOTKEY_CLOSE_OPEN:
02829                     {
02830                         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fOpen = Console-&gt;InputBuffer.ImeMode.Open;
02831                         <span class="keywordflow">if</span> (!bKeyDown)
02832                             <span class="keywordflow">break</span> ;
02833 
02834                         Console-&gt;InputBuffer.ImeMode.Open = !fOpen ;
02835                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
02836                                               CONIME_HOTKEY,
02837                                               (WPARAM)Console-&gt;ConsoleHandle,
02838                                               HotkeyID))) {
02839                             <span class="keywordflow">break</span>;
02840                         }
02841 
02842                         <span class="comment">// Update in the system conversion mode buffer.</span>
02843                         GetImeKeyState(Console, NULL);
02844 
02845                         <span class="keywordflow">break</span> ;
02846                     }
02847                 <span class="keywordflow">case</span> IME_CHOTKEY_IME_NONIME_TOGGLE:
02848                 <span class="keywordflow">case</span> IME_THOTKEY_IME_NONIME_TOGGLE:
02849                 <span class="keywordflow">case</span> IME_CHOTKEY_SHAPE_TOGGLE:
02850                 <span class="keywordflow">case</span> IME_THOTKEY_SHAPE_TOGGLE:
02851                 <span class="keywordflow">case</span> IME_CHOTKEY_SYMBOL_TOGGLE:
02852                 <span class="keywordflow">case</span> IME_THOTKEY_SYMBOL_TOGGLE:
02853                 <span class="keywordflow">case</span> IME_KHOTKEY_SHAPE_TOGGLE:
02854                 <span class="keywordflow">case</span> IME_KHOTKEY_HANJACONVERT:
02855                 <span class="keywordflow">case</span> IME_KHOTKEY_ENGLISH:
02856                 <span class="keywordflow">case</span> IME_ITHOTKEY_RESEND_RESULTSTR:
02857                 <span class="keywordflow">case</span> IME_ITHOTKEY_PREVIOUS_COMPOSITION:
02858                 <span class="keywordflow">case</span> IME_ITHOTKEY_UISTYLE_TOGGLE:
02859                 <span class="keywordflow">default</span>:
02860                     {
02861                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
02862                                               CONIME_HOTKEY,
02863                                               (WPARAM)Console-&gt;ConsoleHandle,
02864                                               HotkeyID))) {
02865                             <span class="keywordflow">break</span>;
02866                         }
02867 
02868                         <span class="comment">// Update in the system conversion mode buffer.</span>
02869                         GetImeKeyState(Console, NULL);
02870 
02871                         <span class="keywordflow">break</span> ;
02872                     }
02873                 }
02874                 <span class="keywordflow">return</span> ;
02875             }
02876 
02877             <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a8">CTRL_BUT_NOT_ALT</a>(ControlKeyState) &amp;&amp;
02878                     (bKeyDown) ) {
02879                 <span class="keywordflow">if</span> (VirtualKeyCode == <span class="charliteral">'C'</span> &amp;&amp;
02880                         Console-&gt;InputBuffer.InputMode &amp; ENABLE_PROCESSED_INPUT) {
02881                     <span class="keywordflow">goto</span> FromConsoleIME ;
02882                 }
02883                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VirtualKeyCode == VK_CANCEL) {
02884                     <span class="keywordflow">goto</span> FromConsoleIME ;
02885                 }
02886                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VirtualKeyCode == <span class="charliteral">'S'</span>){
02887                     <span class="keywordflow">goto</span> FromConsoleIME ;
02888                 }
02889             }
02890             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VirtualKeyCode == VK_PAUSE ){
02891                 <span class="keywordflow">goto</span> FromConsoleIME ;
02892             }
02893             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ((VirtualKeyCode == VK_SHIFT)   ||
02894                        (VirtualKeyCode == VK_CONTROL) ||
02895                        (VirtualKeyCode == VK_CAPITAL) ||
02896                        (VirtualKeyCode == VK_KANA)    ||    <span class="comment">// VK_KANA == VK_HANGUL</span>
02897                        (VirtualKeyCode == VK_JUNJA)   ||
02898                        (VirtualKeyCode == VK_HANJA)   ||
02899                        (VirtualKeyCode == VK_NUMLOCK) ||
02900                        (VirtualKeyCode == VK_SCROLL)     )
02901                       &amp;&amp;
02902                       !(Console-&gt;InputBuffer.ImeMode.Unavailable) &amp;&amp;
02903                       !(Console-&gt;InputBuffer.ImeMode.Open)
02904                     )
02905             {
02906                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
02907                                       Message+CONIME_KEYDATA,
02908                                       (WPARAM)LOWORD(wParam)&lt;&lt;16|LOWORD(VirtualKeyCode),
02909                                       lParam
02910                                      ))) {
02911                     <span class="keywordflow">return</span>;
02912                 }
02913                 <span class="keywordflow">goto</span> FromConsoleIME ;
02914             }
02915 
02916             <span class="keywordflow">if</span> (!Console-&gt;InputBuffer.ImeMode.Unavailable &amp;&amp; Console-&gt;InputBuffer.ImeMode.Open) {
02917                 <span class="keywordflow">if</span> (! (HIWORD(lParam) &amp; KF_REPEAT))
02918                 {
02919                     <span class="keywordflow">if</span> (PRIMARYLANGID(LOWORD(Console-&gt;hklActive)) == LANG_JAPANESE &amp;&amp;
02920                             (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)wParam == VK_KANA) {
02921                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(Console,
02922                                               CONIME_NOTIFY_VK_KANA,
02923                                               0,
02924                                               0
02925                                              ))) {
02926                             <span class="keywordflow">return</span>;
02927                         }
02928                     }
02929                 }
02930 
02931                 ConsoleImeMessagePump(Console,
02932                                       Message+CONIME_KEYDATA,
02933                                       LOWORD(wParam)&lt;&lt;16|LOWORD(VirtualKeyCode),
02934                                       lParam
02935                                      );
02936                 <span class="keywordflow">return</span> ;
02937             }
02938         }
02939     }
02940 FromConsoleIME:
02941 
02942     <span class="comment">//</span>
02943     <span class="comment">// ignore key strokes that will generate CHAR messages.  this is only</span>
02944     <span class="comment">// necessary while a dialog box is up.</span>
02945     <span class="comment">//</span>
02946 
02947     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a9">DialogBoxCount</a> &gt; 0) {
02948         <span class="keywordflow">if</span> (Message != WM_CHAR &amp;&amp; Message != WM_SYSCHAR &amp;&amp; Message != WM_DEADCHAR &amp;&amp; Message != WM_SYSDEADCHAR) {
02949             WCHAR awch[<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a1">MAX_CHARS_FROM_1_KEYSTROKE</a>];
02950             <span class="keywordtype">int</span> cwch;
02951             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> KeyState[256];
02952 
02953             <a class="code" href="../../d3/d0/user32_8def.html#a46">GetKeyboardState</a>(KeyState);
02954             cwch = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a25">ToUnicodeEx</a>((UINT)wParam,HIWORD(lParam),KeyState,awch,
02955                                MAX_CHARS_FROM_1_KEYSTROKE,
02956                                <span class="comment">//TM_POSTCHARBREAKS | (KeyState(VK_MENU) &amp; 1));</span>
02957                                TM_POSTCHARBREAKS,
02958                                (HKL)NULL);
02959             <span class="keywordflow">if</span> (cwch != 0) {
02960                 <span class="keywordflow">return</span>;
02961             }
02962         } <span class="keywordflow">else</span> {
02963             <span class="comment">// remember to generate break</span>
02964             <span class="keywordflow">if</span> (Message == WM_CHAR) {
02965                 bGenerateBreak=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02966             }
02967         }
02968     }
02969 
02970 <span class="preprocessor">#ifdef FE_IME</span>
02971 <span class="preprocessor"></span>    <span class="comment">// ignore key stroke while IME property is up.</span>
02972     <span class="keywordflow">if</span> (Console-&gt;InputBuffer.hWndConsoleIME)
02973         <span class="keywordflow">return</span>;
02974 <span class="preprocessor">#endif</span>
02975 <span class="preprocessor"></span>
02976     InputEvent.EventType = KEY_EVENT;
02977     InputEvent.Event.KeyEvent.bKeyDown = bKeyDown;
02978     InputEvent.Event.KeyEvent.wRepeatCount = LOWORD(lParam);
02979 
02980     <span class="keywordflow">if</span> (Message == WM_CHAR || Message == WM_SYSCHAR || Message == WM_DEADCHAR || Message == WM_SYSDEADCHAR) {
02981         <span class="comment">// If this is a fake character, zero the scancode.</span>
02982         <span class="keywordflow">if</span> (lParam &amp; 0x02000000) {
02983             InputEvent.Event.KeyEvent.wVirtualScanCode = 0;
02984         }
02985         InputEvent.Event.KeyEvent.dwControlKeyState = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a42">GetControlKeyState</a>(lParam);
02986         <span class="keywordflow">if</span> (Message == WM_CHAR || Message == WM_SYSCHAR) {
02987             InputEvent.Event.KeyEvent.uChar.UnicodeChar = (WCHAR)wParam;
02988         } <span class="keywordflow">else</span> {
02989             InputEvent.Event.KeyEvent.uChar.UnicodeChar = (WCHAR)0;
02990         }
02991     } <span class="keywordflow">else</span> {
02992         <span class="comment">// if alt-gr, ignore</span>
02993         <span class="keywordflow">if</span> (lParam &amp; 0x02000000) {
02994             <span class="keywordflow">return</span>;
02995         }
02996         InputEvent.Event.KeyEvent.dwControlKeyState = ControlKeyState;
02997         InputEvent.Event.KeyEvent.uChar.UnicodeChar = 0;
02998     }
02999 
03000 <span class="preprocessor">#ifdef FE_IME</span>
03001 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
03002         <span class="comment">// MSKK August.22.1993 KazuM</span>
03003         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwConversion;
03004 
03005         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(GetImeKeyState(Console, &amp;dwConversion))) {
03006             <span class="keywordflow">return</span>;
03007         }
03008 
03009         InputEvent.Event.KeyEvent.dwControlKeyState |= <a class="code" href="../../d0/d3/dbcs_8h.html#a54">ImmConversionToConsole</a>(dwConversion);
03010     }
03011 <span class="preprocessor">#endif</span>
03012 <span class="preprocessor"></span>
03013     ContinueProcessing=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03014 
03015     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a8">CTRL_BUT_NOT_ALT</a>(InputEvent.Event.KeyEvent.dwControlKeyState) &amp;&amp;
03016         InputEvent.Event.KeyEvent.bKeyDown) {
03017 
03018         <span class="comment">//</span>
03019         <span class="comment">// check for ctrl-c, if in line input mode.</span>
03020         <span class="comment">//</span>
03021 
03022         <span class="keywordflow">if</span> (InputEvent.Event.KeyEvent.wVirtualKeyCode == <span class="charliteral">'C'</span> &amp;&amp;
03023             Console-&gt;InputBuffer.InputMode &amp; ENABLE_PROCESSED_INPUT) {
03024             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a50">HandleCtrlEvent</a>(Console,CTRL_C_EVENT);
03025             <span class="keywordflow">if</span> (!Console-&gt;PopupCount)
03026                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a44">TerminateRead</a>(Console,&amp;Console-&gt;InputBuffer,CONSOLE_CTRL_C_SEEN);
03027             <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a25">CONSOLE_SUSPENDED</a>)) {
03028                 ContinueProcessing=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03029             }
03030         }
03031 
03032         <span class="comment">//</span>
03033         <span class="comment">// check for ctrl-break.</span>
03034         <span class="comment">//</span>
03035 
03036         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (InputEvent.Event.KeyEvent.wVirtualKeyCode == VK_CANCEL) {
03037             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a23">FlushInputBuffer</a>(&amp;Console-&gt;InputBuffer);
03038             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a50">HandleCtrlEvent</a>(Console,CTRL_BREAK_EVENT);
03039             <span class="keywordflow">if</span> (!Console-&gt;PopupCount)
03040                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a44">TerminateRead</a>(Console,&amp;Console-&gt;InputBuffer,CONSOLE_CTRL_BREAK_SEEN);
03041             <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a25">CONSOLE_SUSPENDED</a>)) {
03042                 ContinueProcessing=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03043             }
03044         }
03045 
03046         <span class="comment">//</span>
03047         <span class="comment">// don't write ctrl-esc to the input buffer</span>
03048         <span class="comment">//</span>
03049 
03050         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (InputEvent.Event.KeyEvent.wVirtualKeyCode == VK_ESCAPE &amp;&amp;
03051                  !(Console-&gt;ReserveKeys &amp; CONSOLE_CTRLESC)) {
03052             ContinueProcessing=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03053         }
03054     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (InputEvent.Event.KeyEvent.dwControlKeyState &amp; (RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED) &amp;&amp;
03055                InputEvent.Event.KeyEvent.bKeyDown &amp;&amp;
03056                InputEvent.Event.KeyEvent.wVirtualKeyCode == VK_ESCAPE &amp;&amp;
03057                !(Console-&gt;ReserveKeys &amp; CONSOLE_ALTESC)) {
03058         ContinueProcessing=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03059     }
03060 
03061     <span class="keywordflow">if</span> (ContinueProcessing) {
03062         EventsWritten = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>( Console,
03063                                           &amp;Console-&gt;InputBuffer,
03064                                           &amp;InputEvent,
03065                                           1
03066                                          );
03067         <span class="keywordflow">if</span> (EventsWritten &amp;&amp; bGenerateBreak) {
03068             InputEvent.Event.KeyEvent.bKeyDown = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03069             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>( Console,
03070                               &amp;Console-&gt;InputBuffer,
03071                               &amp;InputEvent,
03072                               1
03073                              );
03074         }
03075     }
03076     <span class="keywordflow">return</span>;
03077 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a149" doxytag="consrv.h::HandleMenuEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HandleMenuEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03407">3407</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>03411 {
03412     INPUT_RECORD InputEvent;
03413     ULONG EventsWritten;
03414 
03415     InputEvent.EventType = MENU_EVENT;
03416     InputEvent.Event.MenuEvent.dwCommandId = wParam;
03417     EventsWritten = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>( Console,
03418                                       &amp;Console-&gt;InputBuffer,
03419                                       &amp;InputEvent,
03420                                       1
03421                                      );
03422 <span class="preprocessor">#if DBG</span>
03423 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (EventsWritten != 1) {
03424         OutputDebugStringA(<span class="stringliteral">"PutInputInBuffer: EventsWritten != 1, 1 expected\n"</span>);
03425     }
03426 <span class="preprocessor">#endif</span>
03427 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a148" doxytag="consrv.h::HandleMouseEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL HandleMouseEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">3080</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00067">_ROW::CharRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00038">_CHAR_ROW::Chars</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00088">CONSOLE_IGNORE_NEXT_MOUSE_INPUT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00125">CONSOLE_MOUSE_DOWN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00096">CONSOLE_QUICK_EDIT_MODE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02217">ConvertMouseButtonState()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">ConvertToMouseSelect()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">DoPaste()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02179">GetControlKeyState()</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00055">gfTrimLeadingZeros</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00399">IS_WORD_DELIM</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00102">KEY_PRESSED</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03414">ReleaseCapture()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00361">SetCapture</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a277">UpdateMousePosition()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>03093 {
03094     ULONG ButtonFlags,EventFlags;
03095     INPUT_RECORD InputEvent;
03096     ULONG EventsWritten;
03097     COORD MousePosition;
03098     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RowIndex;
03099     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
03100 
03101     <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) &amp;&amp;
03102         !(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) &amp;&amp;
03103         !(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>)) {
03104         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03105     }
03106 
03107     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a3">CONSOLE_IGNORE_NEXT_MOUSE_INPUT</a>) {
03108         <span class="comment">// only reset on up transition</span>
03109         <span class="keywordflow">if</span> (Message != WM_LBUTTONDOWN &amp;&amp;
03110             Message != WM_MBUTTONDOWN &amp;&amp;
03111             Message != WM_RBUTTONDOWN) {
03112             Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a3">CONSOLE_IGNORE_NEXT_MOUSE_INPUT</a>;
03113             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03114         }
03115         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03116     }
03117 
03118     <span class="comment">//</span>
03119     <span class="comment">// translate mouse position into characters, if necessary.</span>
03120     <span class="comment">//</span>
03121 
03122     MousePosition.X = LOWORD(lParam);
03123     MousePosition.Y = HIWORD(lParam);
03124     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
03125         MousePosition.X /= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
03126         MousePosition.Y /= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
03127     }
03128     MousePosition.X += ScreenInfo-&gt;Window.Left;
03129     MousePosition.Y += ScreenInfo-&gt;Window.Top;
03130 
03131     <span class="comment">//</span>
03132     <span class="comment">// make sure mouse position is clipped to screen buffer</span>
03133     <span class="comment">//</span>
03134 
03135     <span class="keywordflow">if</span> (MousePosition.X &lt; 0) {
03136         MousePosition.X = 0;
03137     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (MousePosition.X &gt;= ScreenInfo-&gt;ScreenBufferSize.X) {
03138         MousePosition.X = ScreenInfo-&gt;ScreenBufferSize.X-1;
03139     }
03140     <span class="keywordflow">if</span> (MousePosition.Y &lt; 0) {
03141         MousePosition.Y = 0;
03142     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (MousePosition.Y &gt;= ScreenInfo-&gt;ScreenBufferSize.Y) {
03143         MousePosition.Y = ScreenInfo-&gt;ScreenBufferSize.Y-1;
03144     }
03145 
03146     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> ||
03147         ((Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>) &amp;&amp;
03148          (Console-&gt;FullScreenFlags == 0)) ) {
03149         <span class="keywordflow">if</span> (Message == WM_LBUTTONDOWN) {
03150 
03151             <span class="comment">//</span>
03152             <span class="comment">// make sure message matches button state</span>
03153             <span class="comment">//</span>
03154 
03155             <span class="keywordflow">if</span> (!(<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_LBUTTON) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>)) {
03156                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03157             }
03158 
03159             <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a> &amp;&amp;
03160                 !(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>)) {
03161                 Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
03162                 Console-&gt;SelectionFlags = <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a> | <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a> | <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
03163 
03164                 <span class="comment">//</span>
03165                 <span class="comment">// invert selection</span>
03166                 <span class="comment">//</span>
03167 
03168                 Console-&gt;SelectionAnchor = MousePosition;
03169                 Console-&gt;SelectionRect.Left =Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
03170                 Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
03171                 <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
03172                 <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,TRUE);
03173                 <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
03174             } <span class="keywordflow">else</span> {
03175 
03176             <span class="comment">//</span>
03177             <span class="comment">// We now capture the mouse to our Window. We do this so that the user can</span>
03178             <span class="comment">//  "scroll" the selection endpoint to an off screen position by moving the</span>
03179             <span class="comment">//  mouse off the client area.</span>
03180             <span class="comment">//</span>
03181 
03182             <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a>) {
03183 
03184                 <span class="comment">//</span>
03185                 <span class="comment">// Check for SHIFT-Mouse Down "continue previous selection" command</span>
03186                 <span class="comment">//</span>
03187 
03188                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) {
03189                     Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>; <span class="comment">// BUGBUG necessary flag?</span>
03190                     <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
03191                     <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console,
03192                                     MousePosition
03193                                    );
03194                 } <span class="keywordflow">else</span> {
03195 
03196                     <span class="comment">//</span>
03197                     <span class="comment">// invert old selection, reset anchor, and invert</span>
03198                     <span class="comment">// new selection.</span>
03199                     <span class="comment">//</span>
03200 
03201                     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
03202                     Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>; <span class="comment">// BUGBUG necessary flag?</span>
03203                     <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
03204                     Console-&gt;SelectionAnchor = MousePosition;
03205                     Console-&gt;SelectionRect.Left =Console-&gt;SelectionRect.Right = Console-&gt;SelectionAnchor.X;
03206                     Console-&gt;SelectionRect.Top = Console-&gt;SelectionRect.Bottom = Console-&gt;SelectionAnchor.Y;
03207                     <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
03208                 }
03209             } <span class="keywordflow">else</span> {
03210                 <a class="code" href="../../d8/d5/consrv_8h.html#a310">ConvertToMouseSelect</a>(Console,
03211                                      MousePosition
03212                                     );
03213             }
03214             }
03215         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Message == WM_LBUTTONUP) {
03216             <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a>) {
03217                 Console-&gt;SelectionFlags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>;
03218                 <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
03219             }
03220         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Message == WM_LBUTTONDBLCLK) {
03221             <span class="keywordflow">if</span> ((MousePosition.X == Console-&gt;SelectionAnchor.X) &amp;&amp;
03222                 (MousePosition.Y == Console-&gt;SelectionAnchor.Y)) {
03223                 RowIndex = (ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow+MousePosition.Y) % ScreenInfo-&gt;ScreenBufferSize.Y;
03224                 Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
03225                 <span class="keywordflow">while</span> (Console-&gt;SelectionAnchor.X &gt; 0) {
03226                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[Console-&gt;SelectionAnchor.X - 1]))
03227                         <span class="keywordflow">break</span>;
03228                     Console-&gt;SelectionAnchor.X--;
03229                 }
03230                 <span class="keywordflow">while</span> (MousePosition.X &lt; ScreenInfo-&gt;ScreenBufferSize.X) {
03231                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[MousePosition.X]))
03232                         <span class="keywordflow">break</span>;
03233                     MousePosition.X++;
03234                 }
03235                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a25">gfTrimLeadingZeros</a>) {
03236                     <span class="comment">//</span>
03237                     <span class="comment">// Trim the leading zeros: 000fe12 -&gt; fe12</span>
03238                     <span class="comment">// Usefull for debugging</span>
03239                     <span class="comment">//</span>
03240                     <span class="keywordflow">if</span> (MousePosition.X &gt; Console-&gt;SelectionAnchor.X + 2 &amp;&amp;
03241                             Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[Console-&gt;SelectionAnchor.X + 1] != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'x'</span> &amp;&amp;
03242                             Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[Console-&gt;SelectionAnchor.X + 1] != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'X'</span>) {
03243                         <span class="comment">// Don't touch the selection begins with 0x</span>
03244                         <span class="keywordflow">while</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[Console-&gt;SelectionAnchor.X] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span> &amp;&amp; Console-&gt;SelectionAnchor.X &lt; MousePosition.X - 1) {
03245                             Console-&gt;SelectionAnchor.X++;
03246                         }
03247                     }
03248                 }
03249                 <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console, MousePosition);
03250             }
03251         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Message == WM_RBUTTONDOWN) || (Message == WM_RBUTTONDBLCLK)) {
03252             <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>)) {
03253                 <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
03254                     <a class="code" href="../../d8/d5/consrv_8h.html#a300">DoCopy</a>(Console);
03255                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>) {
03256                     <a class="code" href="../../d8/d5/consrv_8h.html#a304">DoPaste</a>(Console);
03257                 }
03258                 Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a3">CONSOLE_IGNORE_NEXT_MOUSE_INPUT</a>;
03259             }
03260         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Message == WM_MOUSEMOVE) {
03261             <span class="keywordflow">if</span> (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a29">CONSOLE_MOUSE_DOWN</a>) {
03262                 <a class="code" href="../../d8/d5/consrv_8h.html#a305">ExtendSelection</a>(Console,
03263                                 MousePosition
03264                                );
03265             }
03266         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Message == WM_MOUSEWHEEL) {
03267             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03268         }
03269         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03270     }
03271 
03272     <span class="keywordflow">if</span> (!(Console-&gt;InputBuffer.InputMode &amp; ENABLE_MOUSE_INPUT)) {
03273         <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
03274         <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags == 0) {
03275             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03276         }
03277         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03278     }
03279 
03280     <span class="comment">// BUGBUG alt is not set correctly</span>
03281     InputEvent.Event.MouseEvent.dwControlKeyState = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a42">GetControlKeyState</a>(0);
03282 
03283     <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
03284         <span class="keywordflow">if</span> (MousePosition.X &gt; ScreenInfo-&gt;Window.Right) {
03285             MousePosition.X = ScreenInfo-&gt;Window.Right;
03286         }
03287         <span class="keywordflow">if</span> (MousePosition.Y &gt; ScreenInfo-&gt;Window.Bottom) {
03288             MousePosition.Y = ScreenInfo-&gt;Window.Bottom;
03289         }
03290     }
03291     <span class="keywordflow">switch</span> (Message) {
03292         <span class="keywordflow">case</span> WM_LBUTTONDOWN:
03293             <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
03294             ButtonFlags = FROM_LEFT_1ST_BUTTON_PRESSED;
03295             EventFlags = 0;
03296             <span class="keywordflow">break</span>;
03297         <span class="keywordflow">case</span> WM_LBUTTONUP:
03298             <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
03299             ButtonFlags = 0;
03300             EventFlags = 0;
03301             <span class="keywordflow">break</span>;
03302         <span class="keywordflow">case</span> WM_RBUTTONDOWN:
03303             <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
03304             ButtonFlags = RIGHTMOST_BUTTON_PRESSED;
03305             EventFlags = 0;
03306             <span class="keywordflow">break</span>;
03307         <span class="keywordflow">case</span> WM_RBUTTONUP:
03308             <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
03309             ButtonFlags = 0;
03310             EventFlags = 0;
03311             <span class="keywordflow">break</span>;
03312         <span class="keywordflow">case</span> WM_MBUTTONDOWN:
03313             <a class="code" href="../../d3/d0/user32_8def.html#a44">SetCapture</a>(Console-&gt;hWnd);
03314             ButtonFlags = FROM_LEFT_2ND_BUTTON_PRESSED;
03315             EventFlags = 0;
03316             <span class="keywordflow">break</span>;
03317         <span class="keywordflow">case</span> WM_MBUTTONUP:
03318             <a class="code" href="../../d3/d8/client_8c.html#a124">ReleaseCapture</a>();
03319             ButtonFlags = 0;
03320             EventFlags = 0;
03321             <span class="keywordflow">break</span>;
03322         <span class="keywordflow">case</span> WM_MOUSEMOVE:
03323             ButtonFlags = 0;
03324             EventFlags = MOUSE_MOVED;
03325             <span class="keywordflow">break</span>;
03326         <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
03327             ButtonFlags = FROM_LEFT_1ST_BUTTON_PRESSED;
03328             EventFlags = DOUBLE_CLICK;
03329             <span class="keywordflow">break</span>;
03330         <span class="keywordflow">case</span> WM_RBUTTONDBLCLK:
03331             ButtonFlags = RIGHTMOST_BUTTON_PRESSED;
03332             EventFlags = DOUBLE_CLICK;
03333             <span class="keywordflow">break</span>;
03334         <span class="keywordflow">case</span> WM_MBUTTONDBLCLK:
03335             ButtonFlags = FROM_LEFT_2ND_BUTTON_PRESSED;
03336             EventFlags = DOUBLE_CLICK;
03337             <span class="keywordflow">break</span>;
03338         <span class="keywordflow">case</span> WM_MOUSEWHEEL:
03339             ButtonFlags = ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam &amp; 0xFFFF0000);
03340             EventFlags = MOUSE_WHEELED;
03341             <span class="keywordflow">break</span>;
03342         <span class="keywordflow">default</span>:
03343             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
03344     }
03345     InputEvent.EventType = MOUSE_EVENT;
03346     InputEvent.Event.MouseEvent.dwMousePosition = MousePosition;
03347     InputEvent.Event.MouseEvent.dwEventFlags = EventFlags;
03348     InputEvent.Event.MouseEvent.dwButtonState =
03349         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a43">ConvertMouseButtonState</a>(ButtonFlags,(UINT)wParam);
03350     EventsWritten = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>( Console,
03351                                       &amp;Console-&gt;InputBuffer,
03352                                       &amp;InputEvent,
03353                                       1
03354                                      );
03355 <span class="preprocessor">#if DBG</span>
03356 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (EventsWritten != 1) {
03357         OutputDebugStringA(<span class="stringliteral">"PutInputInBuffer: EventsWritten != 1, 1 expected\n"</span>);
03358     }
03359 <span class="preprocessor">#endif</span>
03360 <span class="preprocessor"></span><span class="preprocessor">#ifdef i386</span>
03361 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
03362         <a class="code" href="../../d8/d5/consrv_8h.html#a277">UpdateMousePosition</a>(ScreenInfo,InputEvent.Event.MouseEvent.dwMousePosition);
03363     }
03364 <span class="preprocessor">#endif</span>
03365 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03366 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a146" doxytag="consrv.h::HandleSysKeyEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL HandleSysKeyEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02272">2272</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings()</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00083">CONIME_KEYDATA</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00039">FullScreenInitialized</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00102">KEY_PRESSED</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00105">KEY_UP_TRANSITION</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00339">MapVirtualKey()</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00027">msgNoFullScreen</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00180">ShowWindow</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>02286 {
02287     WORD VirtualKeyCode;
02288     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bCtrlDown;
02289 
02290 <span class="preprocessor">#if defined (FE_IME)</span>
02291 <span class="preprocessor"></span><span class="comment">// Sep.16.1995 Support Console IME by v-HirShi(Hirotoshi Shimizu)</span>
02292     <span class="keywordflow">if</span> (Message == WM_SYSCHAR || Message == WM_SYSDEADCHAR ||
02293         Message == WM_SYSCHAR+<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a> || Message == WM_SYSDEADCHAR+<a class="code" href="../../d3/d5/conime_8h.html#a23">CONIME_KEYDATA</a>)
02294 <span class="preprocessor">#else</span>
02295 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Message == WM_SYSCHAR || Message == WM_SYSDEADCHAR)
02296 <span class="preprocessor">#endif</span>
02297 <span class="preprocessor"></span>    {
02298         VirtualKeyCode = (WORD)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a18">MapVirtualKey</a>(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(HIWORD(lParam)), 1);
02299     } <span class="keywordflow">else</span> {
02300         VirtualKeyCode = LOWORD(wParam);
02301     }
02302 
02303     <span class="comment">//</span>
02304     <span class="comment">// check for ctrl-esc</span>
02305     <span class="comment">//</span>
02306     bCtrlDown = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_CONTROL) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>;
02307 
02308     <span class="keywordflow">if</span> (VirtualKeyCode == VK_ESCAPE &amp;&amp;
02309         bCtrlDown &amp;&amp;
02310         !(<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_MENU) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) &amp;&amp;
02311         !(<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) &amp;&amp;
02312         !(Console-&gt;ReserveKeys &amp; CONSOLE_CTRLESC) ) {
02313         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;    <span class="comment">// call DefWindowProc</span>
02314     }
02315 
02316     <span class="keywordflow">if</span> ((lParam &amp; 0x20000000) == 0) {   <span class="comment">// we're iconic</span>
02317 
02318 
02319         <span class="comment">//</span>
02320         <span class="comment">// Check for ENTER while ICONic (Restore accelerator)</span>
02321         <span class="comment">//</span>
02322 
02323         <span class="keywordflow">if</span> (VirtualKeyCode == VK_RETURN &amp;&amp; !(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE)) {
02324 
02325             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;    <span class="comment">// call DefWindowProc</span>
02326         } <span class="keywordflow">else</span> {
02327             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a46">HandleKeyEvent</a>(Console,
02328                            hWnd,
02329                            Message,
02330                            wParam,
02331                            lParam
02332                           );
02333             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02334         }
02335     }
02336 
02337     <span class="keywordflow">if</span> (VirtualKeyCode == VK_RETURN &amp;&amp; !bCtrlDown &amp;&amp;
02338             !(Console-&gt;ReserveKeys &amp; CONSOLE_ALTENTER)) {
02339 <span class="preprocessor">#ifdef i386</span>
02340 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!(Message &amp; <a class="code" href="../../d9/d3/input_8h.html#a20">KEY_UP_TRANSITION</a>)) {
02341             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a12">FullScreenInitialized</a>) {
02342                 <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags == 0) {
02343                     <a class="code" href="../../d7/d4/server_2private_8c.html#a48">ConvertToFullScreen</a>(Console);
02344                     Console-&gt;FullScreenFlags = CONSOLE_FULLSCREEN;
02345 
02346                     <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd,CDS_FULLSCREEN);
02347                 } <span class="keywordflow">else</span> {
02348                     <a class="code" href="../../d7/d4/server_2private_8c.html#a49">ConvertToWindowed</a>(Console);
02349                     Console-&gt;FullScreenFlags &amp;= ~CONSOLE_FULLSCREEN;
02350 
02351                     <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd,0);
02352 
02353                     <a class="code" href="../../d3/d0/user32_8def.html#a32">ShowWindow</a>(Console-&gt;hWnd, SW_RESTORE);
02354                 }
02355             } <span class="keywordflow">else</span> {
02356                 WCHAR ItemString[70];
02357                 LoadString(ghInstance,msgNoFullScreen,ItemString,70);
02358                 MessageBoxEx(Console-&gt;hWnd,
02359                             ItemString,
02360                             Console-&gt;Title,
02361                             MB_SYSTEMMODAL | MB_OK,
02362                             0L
02363                            );
02364             }
02365         }
02366 <span class="preprocessor">#endif</span>
02367 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02368     }
02369 
02370     <span class="comment">//</span>
02371     <span class="comment">// make sure alt-space gets translated so that the system</span>
02372     <span class="comment">// menu is displayed.</span>
02373     <span class="comment">//</span>
02374 
02375     <span class="keywordflow">if</span> (!(<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_CONTROL) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>)) {
02376         <span class="keywordflow">if</span> (VirtualKeyCode == VK_SPACE &amp;&amp; !(Console-&gt;ReserveKeys &amp; CONSOLE_ALTSPACE)) {
02377             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">// call DefWindowProc</span>
02378         }
02379 
02380         <span class="keywordflow">if</span> (VirtualKeyCode == VK_ESCAPE &amp;&amp; !(Console-&gt;ReserveKeys &amp; CONSOLE_ALTESC)) {
02381             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;  <span class="comment">// call DefWindowProc</span>
02382         }
02383         <span class="keywordflow">if</span> (VirtualKeyCode == VK_TAB &amp;&amp; !(Console-&gt;ReserveKeys &amp; CONSOLE_ALTTAB)) {
02384             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;  <span class="comment">// call DefWindowProc</span>
02385         }
02386     }
02387     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a46">HandleKeyEvent</a>(Console,
02388                    hWnd,
02389                    Message,
02390                    wParam,
02391                    lParam
02392                   );
02393     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02394 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a123" doxytag="consrv.h::HorizontalScroll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HorizontalScroll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ScrollCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>AbsoluteChange</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04653">4653</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>04658 {
04659     COORD NewOrigin;
04660 
04661     NewOrigin.X = ScreenInfo-&gt;Window.Left;
04662     NewOrigin.Y = ScreenInfo-&gt;Window.Top;
04663     <span class="keywordflow">switch</span> (ScrollCommand) {
04664         <span class="keywordflow">case</span> SB_LINEUP:
04665             NewOrigin.X--;
04666             <span class="keywordflow">break</span>;
04667         <span class="keywordflow">case</span> SB_LINEDOWN:
04668             NewOrigin.X++;
04669             <span class="keywordflow">break</span>;
04670         <span class="keywordflow">case</span> SB_PAGEUP:
04671             NewOrigin.X-=<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)-1;
04672             <span class="keywordflow">break</span>;
04673         <span class="keywordflow">case</span> SB_PAGEDOWN:
04674             NewOrigin.X+=<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)-1;
04675             <span class="keywordflow">break</span>;
04676         <span class="keywordflow">case</span> SB_THUMBTRACK:
04677         <span class="keywordflow">case</span> SB_THUMBPOSITION:
04678             NewOrigin.X= AbsoluteChange;
04679             <span class="keywordflow">break</span>;
04680         <span class="keywordflow">case</span> SB_TOP:
04681             NewOrigin.X=0;
04682             <span class="keywordflow">break</span>;
04683         <span class="keywordflow">case</span> SB_BOTTOM:
04684             NewOrigin.X=(WORD)(ScreenInfo-&gt;ScreenBufferSize.X-<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo));
04685             <span class="keywordflow">break</span>;
04686 
04687         <span class="keywordflow">default</span>:
04688             <span class="keywordflow">return</span>;
04689     }
04690 
04691     NewOrigin.X = (WORD)(<a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0,<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((SHORT)NewOrigin.X,
04692                             (SHORT)ScreenInfo-&gt;ScreenBufferSize.X-(SHORT)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo))));
04693     <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
04694                     (BOOLEAN)TRUE,
04695                     NewOrigin
04696                    );
04697 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a268" doxytag="consrv.h::InitializeConsoleAttributes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeConsoleAttributes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02132">2132</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
<pre class="fragment"><div>02136                    :
02137 
02138     This routine initializes <span class="keywordflow">default</span> attributes from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
02139     user's registry values. It gets called during logon/logoff.
02140 
02141 Arguments:
02142 
02143     none
02144 
02145 Return Value:
02146 
02147     none
02148 
02149 --*/
02150 
02151 {
02152     <span class="comment">//</span>
02153     <span class="comment">// Store default values in structure and mark it</span>
02154     <span class="comment">// as invalid (by resetting LastWriteTime).</span>
02155     <span class="comment">//</span>
02156 
02157     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o12">ScreenFill</a>.Attributes = 0x07;            <span class="comment">// white on black</span>
02158     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o12">ScreenFill</a>.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
02159     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o13">PopupFill</a>.Attributes = 0xf5;             <span class="comment">// purple on white</span>
02160     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o13">PopupFill</a>.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
02161     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o10">InsertMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02162     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o9">QuickEdit</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02163     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o11">AutoPosition</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02164     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o8">FullScreen</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02165     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o0">ScreenBufferSize</a>.X = 80;
02166     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o0">ScreenBufferSize</a>.Y = 25;
02167     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o1">WindowSize</a>.X = 80;
02168     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o1">WindowSize</a>.Y = 25;
02169     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o2">WindowOrigin</a>.X = 0;
02170     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o2">WindowOrigin</a>.Y = 0;
02171     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o3">FontSize</a>.X = 0;
02172     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o3">FontSize</a>.Y = 0;
02173     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o4">FontFamily</a> = 0;
02174     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o5">FontWeight</a> = 0;
02175     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o6">FaceName</a>[0] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
02176     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o7">CursorSize</a> = <a class="code" href="../../d7/d2/output_8h.html#a10">CURSOR_SMALL_SIZE</a>;
02177     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o14">HistoryBufferSize</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a6">DEFAULT_NUMBER_OF_COMMANDS</a>;
02178     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o15">NumberOfHistoryBuffers</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a7">DEFAULT_NUMBER_OF_BUFFERS</a>;
02179     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o16">HistoryNoDup</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02180     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 0] = RGB(0,   0,   0   );
02181     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 1] = RGB(0,   0,   0x80);
02182     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 2] = RGB(0,   0x80,0   );
02183     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 3] = RGB(0,   0x80,0x80);
02184     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 4] = RGB(0x80,0,   0   );
02185     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 5] = RGB(0x80,0,   0x80);
02186     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 6] = RGB(0x80,0x80,0   );
02187     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 7] = RGB(0xC0,0xC0,0xC0);
02188     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 8] = RGB(0x80,0x80,0x80);
02189     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 9] = RGB(0,   0,   0xFF);
02190     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[10] = RGB(0,   0xFF,0   );
02191     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[11] = RGB(0,   0xFF,0xFF);
02192     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[12] = RGB(0xFF,0,   0   );
02193     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[13] = RGB(0xFF,0,   0xFF);
02194     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[14] = RGB(0xFF,0xFF,0   );
02195     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[15] = RGB(0xFF,0xFF,0xFF);
02196 <span class="preprocessor">#if defined(FE_SB) // scotthsu</span>
02197 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.CodePage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>;
02198 <span class="preprocessor">#endif</span>
02199 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o18">LastWriteTime</a> = 0;
02200 
02201     <span class="comment">//</span>
02202     <span class="comment">// Get system metrics for this user</span>
02203     <span class="comment">//</span>
02204 
02205     <a class="code" href="../../d6/d2/output_8c.html#a38">InitializeSystemMetrics</a>();
02206 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a239" doxytag="consrv.h::InitializeConsoleCommandData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeConsoleCommandData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04700">4700</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>.
<p>
<pre class="fragment"><div>04706                    :
04707 
04708     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-console commandline recall data structures.
04709 
04710 Arguments:
04711 
04712     Console - pointer to console.
04713 
04714 Return Value:
04715 
04716     none
04717 
04718 --*/
04719 
04720 {
04721     Console-&gt;NumCommandHistories = 0;
04722     InitializeListHead(&amp;Console-&gt;CommandHistoryList);
04723 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="consrv.h::InitializeConsoleHandleTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS InitializeConsoleHandleTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00057">57</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00031">ConsoleHandleLock</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00028">InitialConsoleHandles</a>, <a class="el" href="../../d3/d2/tnlsxlat_8c-source.html#l00026">NELEM</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00030">NumberOfConsoleHandles</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01266">RtlInitializeCriticalSectionAndSpinCount()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00737">ConServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00061                    :
00062 
00063     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global console handle table.
00064 
00065 Arguments:
00066 
00067     none.
00068 
00069 Return Value:
00070 
00071     none.
00072 
00073 --*/
00074 
00075 {
00076     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00077 
00078     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a26">RtlInitializeCriticalSectionAndSpinCount</a>(&amp;ConsoleHandleLock,
00079                                                       0x80000000);
00080 
00081     RtlZeroMemory(InitialConsoleHandles, <span class="keyword">sizeof</span>(InitialConsoleHandles));
00082     <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a3">InitialConsoleHandles</a>;
00083     <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a> = <a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(InitialConsoleHandles);
00084 
00085     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00086 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a158" doxytag="consrv.h::InitializeCustomCP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InitializeCustomCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a157" doxytag="consrv.h::InitializeFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00109">109</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00055">CONSOLE_MAX_FONT_NAME_LENGTH</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d2/tnlsxlat_8c-source.html#l00026">NELEM</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00737">ConServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00110 {
00111     WCHAR FontName[<a class="code" href="../../d8/d5/consrv_8h.html#a6">CONSOLE_MAX_FONT_NAME_LENGTH</a>];
00112     <span class="keywordtype">int</span> i;
00113     <span class="keyword">static</span> CONST LPWSTR FontList[] = {<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"woafont"</span>,
00114                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ega80woa.fon"</span>,
00115                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ega40woa.fon"</span>,
00116                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"cga80woa.fon"</span>,
00117                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"cga40woa.fon"</span>};
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Read software.ini to get the values for "woafont",</span>
00121     <span class="comment">// "ega80woa.fon", "ega40woa.fon", "cga80woa.fon", and</span>
00122     <span class="comment">// "cga40woa.fon", respectively, to pass to AddFontResource.</span>
00123     <span class="comment">//</span>
00124     <span class="comment">// If any of the entries are empty or non-existent,</span>
00125     <span class="comment">// GetPrivateProfileString will return a NULL (empty) string.</span>
00126     <span class="comment">// If such is the case, the call to AddPermanentFontResource will</span>
00127     <span class="comment">// simply fail.</span>
00128     <span class="comment">//</span>
00129 
00130     OpenProfileUserMapping();
00131 
00132     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(FontList); i++) {
00133         GetPrivateProfileString(L<span class="stringliteral">"386enh"</span>, FontList[i], L<span class="stringliteral">""</span>,
00134                 FontName, <a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(FontName), L<span class="stringliteral">"system.ini"</span>);
00135         GdiAddFontResourceW(FontName, AFRW_ADD_LOCAL_FONT,NULL);
00136     }
00137 
00138     CloseProfileUserMapping();
00139 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a292" doxytag="consrv.h::InitializeFullScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InitializeFullScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02089">2089</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00172">CONSOLE_EGACPI</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00171">CONSOLE_EGACPI_LENGTH</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00170">CONSOLE_WINDOWS_DIR_LENGTH</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00052">FS_MODE_FIND</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00051">FS_MODE_GRAPHICS</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00050">FS_MODE_TEXT</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00130">hCPIFile</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00049">_MODE_FONT_PAIR::Mode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09357">NtUserEnumDisplaySettings()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00118">NUMBER_OF_MODE_FONT_PAIRS</a>, <a class="el" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00069">RegModeFontPairs</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00114">_MODE_FONT_PAIR::Resolution</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00626">InitWindowsStuff()</a>.
<p>
<pre class="fragment"><div>02090 {
02091     UNICODE_STRING vgaString;
02092     DEVMODEW devmode;
02093     ULONG   i;
02094 <span class="preprocessor">#if !defined(FE_SB)</span>
02095 <span class="preprocessor"></span>    BOOLEAN mode1 = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02096     BOOLEAN mode2 = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02097 <span class="preprocessor">#else</span>
02098 <span class="preprocessor"></span>    <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> mode1 = 0;
02099     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> mode2 = 0;
02100 <span class="preprocessor">#endif</span>
02101 <span class="preprocessor"></span>
02102     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> WindowsDir[<a class="code" href="../../d7/d4/server_2private_8c.html#a18">CONSOLE_WINDOWS_DIR_LENGTH</a>+<a class="code" href="../../d7/d4/server_2private_8c.html#a19">CONSOLE_EGACPI_LENGTH</a>];
02103     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> WindowsDirLength;
02104 
02105     <span class="comment">//</span>
02106     <span class="comment">// query number of available modes</span>
02107     <span class="comment">//</span>
02108 
02109     ZeroMemory(&amp;devmode, <span class="keyword">sizeof</span>(DEVMODEW));
02110     devmode.dmSize = <span class="keyword">sizeof</span>(DEVMODEW);
02111 
02112     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;vgaString, L<span class="stringliteral">"VGACOMPATIBLE"</span>);
02113 
02114     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"Number of modes = %d\n"</span>, NUMBER_OF_MODE_FONT_PAIRS));
02115 
02116     <span class="keywordflow">for</span> (i=0; ; i++)
02117     {
02118         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"EnumDisplaySettings %d\n"</span>, i));
02119 
02120         <span class="keywordflow">if</span> (!(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a321">NtUserEnumDisplaySettings</a>(&amp;vgaString,
02121                                                    i,
02122                                                    &amp;devmode,
02123                                                    0))))
02124         {
02125             <span class="keywordflow">break</span>;
02126         }
02127 
02128 <span class="preprocessor">#if defined(FE_SB)</span>
02129 <span class="preprocessor"></span>        {
02130             ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02131 
02132             <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"Mode X = %d, Y = %d\n"</span>,
02133                      devmode.dmPelsWidth, devmode.dmPelsHeight));
02134 
02135             <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>&lt;<a class="code" href="../../d7/d4/server_2private_8c.html#a17">NUMBER_OF_MODE_FONT_PAIRS</a>;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++)
02136             {
02137                 <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)devmode.dmPelsWidth == <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>.X &amp;&amp;
02138                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)devmode.dmPelsHeight == <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>.Y  )
02139                 {
02140                     <span class="keywordflow">if</span> (devmode.dmDisplayFlags &amp; DMDISPLAYFLAGS_TEXTMODE)
02141                     {
02142                         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o0">Mode</a> &amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a8">FS_MODE_TEXT</a>)
02143                         {
02144                             <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o0">Mode</a> |= <a class="code" href="../../d0/d3/dbcs_8h.html#a10">FS_MODE_FIND</a>;
02145                             mode1++;
02146                         }
02147                     }
02148                     <span class="keywordflow">else</span>
02149                     {
02150                         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o0">Mode</a> &amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a9">FS_MODE_GRAPHICS</a>)
02151                         {
02152                             <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o0">Mode</a> |= <a class="code" href="../../d0/d3/dbcs_8h.html#a10">FS_MODE_FIND</a>;
02153                             mode2++;
02154                         }
02155                     }
02156                 }
02157             }
02158 
02159             <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"mode1 = %d, mode2 = %d\n"</span>, mode1, mode2));
02160         }
02161 <span class="preprocessor">#else</span>
02162 <span class="preprocessor"></span>
02163         <span class="keywordflow">if</span> (devmode.dmPelsWidth == 720 &amp;&amp;
02164             devmode.dmPelsHeight == 400)
02165         {
02166             mode1 = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02167         }
02168         <span class="keywordflow">if</span> (devmode.dmPelsWidth == 640 &amp;&amp;
02169             devmode.dmPelsHeight == 350)
02170         {
02171             mode2 = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02172         }
02173 <span class="preprocessor">#endif</span>
02174 <span class="preprocessor"></span>    }
02175 
02176 <span class="preprocessor">#if !defined(FE_SB)</span>
02177 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!(mode1 &amp;&amp; mode2))
02178 <span class="preprocessor">#else</span>
02179 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (mode1 &lt; 2)
02180 <span class="preprocessor">#endif</span>
02181 <span class="preprocessor"></span>    {
02182         <span class="comment">//</span>
02183         <span class="comment">// One of the modes we expected to get was not returned.</span>
02184         <span class="comment">// lets just fail fullscreen initialization.</span>
02185         <span class="comment">//</span>
02186 
02187         KdPrint((<span class="stringliteral">"CONSRV: InitializeFullScreen Missing text mode\n"</span>));
02188         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02189     }
02190 
02191 <span class="preprocessor">#if defined(FE_SB)</span>
02192 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (mode2 &gt; 0)
02193     {
02194         <span class="comment">// Can do trun graphics mode.</span>
02195         fFullScreenGraphics = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02196     }
02197 <span class="preprocessor">#endif</span>
02198 <span class="preprocessor"></span>
02199     <span class="comment">//</span>
02200     <span class="comment">// open ega.cpi</span>
02201     <span class="comment">//</span>
02202 
02203     WindowsDirLength = GetSystemDirectoryA(WindowsDir,
02204                                            CONSOLE_WINDOWS_DIR_LENGTH);
02205     <span class="keywordflow">if</span> (WindowsDirLength == 0)
02206     {
02207         KdPrint((<span class="stringliteral">"CONSRV: InitializeFullScreen Finding Font file failed\n"</span>));
02208         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02209     }
02210 
02211     RtlCopyMemory(&amp;WindowsDir[WindowsDirLength],
02212                   CONSOLE_EGACPI,
02213                   CONSOLE_EGACPI_LENGTH);
02214 
02215     <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d4/server_2private_8c.html#a29">hCPIFile</a> = CreateFileA(WindowsDir,
02216                                 GENERIC_READ,
02217                                 FILE_SHARE_READ,
02218                                 NULL,
02219                                 OPEN_EXISTING,
02220                                 0,
02221                                 NULL)) == (HANDLE)-1)
02222     {
02223         KdPrint((<span class="stringliteral">"CONSRV: InitializeFullScreen Opening Font file failed\n"</span>));
02224         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02225     }
02226 
02227     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02228 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a89" doxytag="consrv.h::InitializeInputHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN InitializeInputHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01335">1335</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00067">HANDLE_TAG</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00066">_INPUT_READ_HANDLE_DATA::InputHandleFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00065">_INPUT_READ_HANDLE_DATA::ReadCount</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00064">_INPUT_READ_HANDLE_DATA::ReadCountLock</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01210">RtlInitializeCriticalSection()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>.
<p>
<pre class="fragment"><div>01342                    :
01343 
01344     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input-specific fields of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle data
01345     structure.
01346 
01347 Arguments:
01348 
01349     HandleData - Pointer to handle data structure.
01350 
01351     InputBuffer - Pointer to input buffer data structure.
01352 
01353 Return Value:
01354 
01355 --*/
01356 
01357 {
01358     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01359 
01360     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a> = (<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html">PINPUT_READ_HANDLE_DATA</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HANDLE_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html">INPUT_READ_HANDLE_DATA</a>));
01361     <span class="keywordflow">if</span> (!HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>) {
01362         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01363     }
01364     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o0">ReadCountLock</a>);
01365     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01366         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>);
01367         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01368         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01369     }
01370     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> = 0;
01371     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o2">InputHandleFlags</a> = 0;
01372     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer = InputBuffer;
01373     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;RefCount++;
01374     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01375 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a295" doxytag="consrv.h::InitializeMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00124">124</a> of file <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html">ntcon/server/menu.c</a>.
<p>
References <a class="el" href="../../d7/d6/menu_8h-source.html#l00043">cmControl</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00036">cmCopy</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00038">cmMark</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00037">cmPaste</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00039">cmScroll</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00091">CONSOLE_DISABLE_CLOSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00090">CONSOLE_SCROLLING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00685">EnableMenuItem()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>00134 {
00135     HMENU hMenu = Console-&gt;hMenu;
00136     HMENU hHeirMenu = Console-&gt;hHeirMenu;
00137 
00138     <span class="comment">//</span>
00139     <span class="comment">// if we're in graphics mode, disable size menu</span>
00140     <span class="comment">//</span>
00141 
00142     <span class="keywordflow">if</span> (!(Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)) {
00143         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,SC_SIZE,MF_GRAYED);
00144     }
00145 
00146     <span class="comment">//</span>
00147     <span class="comment">// if the console is iconic, disable Mark and Scroll.</span>
00148     <span class="comment">//</span>
00149 
00150     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) {
00151         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmMark,MF_GRAYED);
00152         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmScroll,MF_GRAYED);
00153     } <span class="keywordflow">else</span> {
00154 
00155         <span class="comment">//</span>
00156         <span class="comment">// if the console is not iconic</span>
00157         <span class="comment">//   if there are no scroll bars</span>
00158         <span class="comment">//       or we're in mark mode</span>
00159         <span class="comment">//       disable scroll</span>
00160         <span class="comment">//   else</span>
00161         <span class="comment">//       enable scroll</span>
00162         <span class="comment">//</span>
00163         <span class="comment">//   if we're in scroll mode</span>
00164         <span class="comment">//       disable mark</span>
00165         <span class="comment">//   else</span>
00166         <span class="comment">//       enable mark</span>
00167 
00168         <span class="keywordflow">if</span> ((Console-&gt;CurrentScreenBuffer-&gt;WindowMaximizedX &amp;&amp;
00169              Console-&gt;CurrentScreenBuffer-&gt;WindowMaximizedY) ||
00170              Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
00171             <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmScroll,MF_GRAYED);
00172         } <span class="keywordflow">else</span> {
00173             <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmScroll,MF_ENABLED);
00174         }
00175         <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>) {
00176             <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmMark,MF_GRAYED);
00177         } <span class="keywordflow">else</span> {
00178             <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmMark,MF_ENABLED);
00179         }
00180     }
00181 
00182     <span class="comment">//</span>
00183     <span class="comment">// if we're selecting or scrolling, disable Paste.</span>
00184     <span class="comment">// otherwise enable it.</span>
00185     <span class="comment">//</span>
00186 
00187     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; (<a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> | <a class="code" href="../../d1/d7/server_8h.html#a5">CONSOLE_SCROLLING</a>)) {
00188         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmPaste,MF_GRAYED);
00189     } <span class="keywordflow">else</span> {
00190         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmPaste,MF_ENABLED);
00191     }
00192 
00193     <span class="comment">//</span>
00194     <span class="comment">// if app has active selection, enable copy; else disabled</span>
00195     <span class="comment">//</span>
00196 
00197     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> &amp;&amp;
00198         Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>) {
00199         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmCopy,MF_ENABLED);
00200     } <span class="keywordflow">else</span> {
00201         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hHeirMenu,cmCopy,MF_GRAYED);
00202     }
00203 
00204     <span class="comment">//</span>
00205     <span class="comment">// disable close</span>
00206     <span class="comment">//</span>
00207 
00208     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a6">CONSOLE_DISABLE_CLOSE</a>)
00209         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,SC_CLOSE,MF_GRAYED);
00210     <span class="keywordflow">else</span>
00211         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,SC_CLOSE,MF_ENABLED);
00212 
00213     <span class="comment">//</span>
00214     <span class="comment">// enable Move if not iconic</span>
00215     <span class="comment">//</span>
00216 
00217     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) {
00218         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,SC_MOVE,MF_GRAYED);
00219     } <span class="keywordflow">else</span> {
00220         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,SC_MOVE,MF_ENABLED);
00221     }
00222 
00223     <span class="comment">//</span>
00224     <span class="comment">// enable Settings if not already doing it</span>
00225     <span class="comment">//</span>
00226 
00227     <span class="keywordflow">if</span> (Console-&gt;hWndProperties &amp;&amp; <a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(Console-&gt;hWndProperties)) {
00228         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,cmControl,MF_GRAYED);
00229     } <span class="keywordflow">else</span> {
00230         <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(hMenu,cmControl,MF_ENABLED);
00231         Console-&gt;hWndProperties = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00232     }
00233 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a160" doxytag="consrv.h::InitializeMouseButtons" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeMouseButtons           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00075">75</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00401">GetSystemMetrics()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00029">NumberOfMouseButtons</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00253">InitializeScreenInfo()</a>.
<p>
<pre class="fragment"><div>00076 {
00077     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a5">NumberOfMouseButtons</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CMOUSEBUTTONS);
00078 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a90" doxytag="consrv.h::InitializeOutputHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeOutputHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01307">1307</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00400">InitializeIoHandleTable()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>.
<p>
<pre class="fragment"><div>01314                    :
01315 
01316     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output-specific fields of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle data
01317     structure.
01318 
01319 Arguments:
01320 
01321     HandleData - Pointer to handle data structure.
01322 
01323     ScreenBuffer - Pointer to screen buffer data structure.
01324 
01325 Return Value:
01326 
01327 --*/
01328 
01329 {
01330     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer = ScreenBuffer;
01331     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;RefCount++;
01332 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a101" doxytag="consrv.h::InitializeScreenInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeScreenInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l00253">253</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00401">GetSystemMetrics()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00075">InitializeMouseButtons()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00177">InitializeSystemMetrics()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00045">MinimumWidthX</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l00106">UsePolyTextOut</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>.
<p>
<pre class="fragment"><div>00254 {
00255     HDC hDC;
00256 
00257     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a19">InitializeMouseButtons</a>();
00258     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a16">MinimumWidthX</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CXMIN);
00259 
00260     <a class="code" href="../../d6/d2/output_8c.html#a38">InitializeSystemMetrics</a>();
00261 
00262     hDC = CreateDCW(L<span class="stringliteral">"DISPLAY"</span>,NULL,NULL,NULL);
00263     <span class="keywordflow">if</span> (hDC != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00264         <a class="code" href="../../d6/d2/output_8c.html#a24">UsePolyTextOut</a> = GetDeviceCaps(hDC,TEXTCAPS) &amp; TC_SCROLLBLT;
00265         DeleteDC(hDC);
00266     }
00267 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a111" doxytag="consrv.h::InitializeScrollBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS InitializeScrollBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l02631">2631</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d1/output_8c-source.html#l02609">AllocateScrollBuffer()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00022">DefaultRegInfo</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00108">ghrgnScroll</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00109">gprgnData</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00115">GRGNDATASIZE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01266">RtlInitializeCriticalSectionAndSpinCount()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00073">SCREEN_TAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00415">_CONSOLE_REGISTRY_INFO::ScreenBufferSize</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00096">ScrollBufferLock</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00626">InitWindowsStuff()</a>.
<p>
<pre class="fragment"><div>02632 {
02633     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02634 
02635     <a class="code" href="../../d6/d2/output_8c.html#a25">ghrgnScroll</a> = CreateRectRgn(0,0,1,1);
02636     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a25">ghrgnScroll</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02637         RIPMSG0(RIP_WARNING, <span class="stringliteral">"InitializeScrollBuffer: cannot allocate ghrgnScroll."</span>);
02638         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
02639     }
02640     <a class="code" href="../../d6/d2/output_8c.html#a26">gprgnData</a> = (LPRGNDATA)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( SCREEN_TAG ),GRGNDATASIZE);
02641     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a26">gprgnData</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02642         RIPMSG0(RIP_WARNING, <span class="stringliteral">"InitializeScrollBuffer: allocate gprgnData."</span>);
02643         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
02644         <span class="keywordflow">goto</span> error;
02645     }
02646 
02647     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a35">AllocateScrollBuffer</a>(<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o0">ScreenBufferSize</a>.X *
02648                                   <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o0">ScreenBufferSize</a>.Y *
02649                                   <span class="keyword">sizeof</span>(CHAR_INFO));
02650     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02651         <span class="keywordflow">goto</span> error;
02652     }
02653 
02654     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a26">RtlInitializeCriticalSectionAndSpinCount</a>(&amp;ScrollBufferLock,
02655                                                       0x80000000);
02656 
02657 error:
02658     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02659         RIPMSG0(RIP_WARNING, <span class="stringliteral">"InitializeScrollBuffer failed, cleaning up"</span>);
02660         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a25">ghrgnScroll</a>) {
02661             DeleteObject(ghrgnScroll);
02662             <a class="code" href="../../d6/d2/output_8c.html#a25">ghrgnScroll</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02663         }
02664         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a26">gprgnData</a>) {
02665             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(gprgnData);
02666             <a class="code" href="../../d6/d2/output_8c.html#a26">gprgnData</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02667         }
02668     }
02669 
02670     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02671 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a180" doxytag="consrv.h::InitializeSubst" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeSubst           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a100" doxytag="consrv.h::InitializeSystemMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeSystemMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l00177">177</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00065">AdjustWindowRectEx()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00265">CONSOLE_WINDOW_EX_FLAGS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00264">CONSOLE_WINDOW_FLAGS</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00086">ConsoleCaptionY</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00084">ConsoleFullScreenX</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00085">ConsoleFullScreenY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00401">GetSystemMetrics()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00104">gfInitSystemMetrics</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00113">guCaretBlinkTime</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00111">gucWheelScrollLines</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00049">HorizontalClientToWindow</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00047">HorizontalScrollSize</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00959">SystemParametersInfo()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00048">VerticalClientToWindow</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00046">VerticalScrollSize</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02132">InitializeConsoleAttributes()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00253">InitializeScreenInfo()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04004">InternalSetWindowSize()</a>, and <a class="el" href="../../d5/d7/resize_8c-source.html#l00040">ProcessResizeWindow()</a>.
<p>
<pre class="fragment"><div>00178 {
00179     RECT WindowSize;
00180 
00181     <a class="code" href="../../d6/d2/output_8c.html#a23">gfInitSystemMetrics</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00182     <a class="code" href="../../d5/d9/cltxt_8h.html#a26">SystemParametersInfo</a>(SPI_GETWHEELSCROLLLINES, 0, &amp;gucWheelScrollLines, FALSE);
00183     <a class="code" href="../../d6/d2/output_8c.html#a11">ConsoleFullScreenX</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CXFULLSCREEN);
00184     <a class="code" href="../../d6/d2/output_8c.html#a12">ConsoleFullScreenY</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CYFULLSCREEN);
00185     <a class="code" href="../../d6/d2/output_8c.html#a13">ConsoleCaptionY</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CYCAPTION);
00186     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a17">VerticalScrollSize</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CXVSCROLL);
00187     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a18">HorizontalScrollSize</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CYHSCROLL);
00188     WindowSize.left = WindowSize.top = 0;
00189     WindowSize.right = WindowSize.bottom = 50;
00190     <a class="code" href="../../d3/d8/winmgrc_8c.html#a9">AdjustWindowRectEx</a>(&amp;WindowSize,
00191                         CONSOLE_WINDOW_FLAGS,
00192                         FALSE,
00193                         CONSOLE_WINDOW_EX_FLAGS
00194                        );
00195     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a19">VerticalClientToWindow</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WindowSize.right-WindowSize.left-50);
00196     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a20">HorizontalClientToWindow</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WindowSize.bottom-WindowSize.top-50);
00197 
00198 <span class="preprocessor">#ifdef LATER</span>
00199 <span class="preprocessor"></span>    gfIsIMEEnabled = !!<a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_IMMENABLED);
00200     RIPMSG1(RIP_VERBOSE, <span class="stringliteral">"InitializeSystemMetrics: gfIsIMEEnabled=%d"</span>, gfIsIMEEnabled);
00201 <span class="preprocessor">#endif</span>
00202 <span class="preprocessor"></span>
00203     <a class="code" href="../../d6/d2/output_8c.html#a28">guCaretBlinkTime</a> = GetCaretBlinkTime();
00204 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a126" doxytag="consrv.h::InitializeThreadMessages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeThreadMessages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a294" doxytag="consrv.h::InitSystemMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitSystemMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00061">61</a> of file <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html">ntcon/server/menu.c</a>.
<p>
References <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01734">AppendMenu()</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00043">cmControl</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00044">cmDefaults</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00042">cmEdit</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00050">ID_WOMENU</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00024">MyModifyMenuItem()</a>, and <a class="el" href="../../d3/d2/tnlsxlat_8c-source.html#l00026">NELEM</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>.
<p>
<pre class="fragment"><div>00064 {
00065     WCHAR ItemString[30];
00066     <span class="keywordtype">int</span> ItemLength;
00067 
00068     <span class="comment">//</span>
00069     <span class="comment">// load the clipboard menu.</span>
00070     <span class="comment">//</span>
00071 
00072     Console-&gt;hHeirMenu = LoadMenu(ghInstance, MAKEINTRESOURCE(ID_WOMENU));
00073     <span class="keywordflow">if</span> (Console-&gt;hHeirMenu) {
00074         ItemLength = LoadString(ghInstance,cmEdit,ItemString,<a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(ItemString));
00075         <span class="keywordflow">if</span> (ItemLength == 0)
00076             KdPrint((<span class="stringliteral">"LoadString 1 failed %d\n"</span>,GetLastError()));
00077     }
00078     <span class="keywordflow">else</span>
00079         KdPrint((<span class="stringliteral">"LoadMenu 1 failed %d\n"</span>,GetLastError()));
00080 
00081     <span class="comment">//</span>
00082     <span class="comment">// edit the accelerators off of the standard items.</span>
00083     <span class="comment">//</span>
00084 
00085     <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a0">MyModifyMenuItem</a>(Console,SC_CLOSE);
00086 
00087     <span class="comment">//</span>
00088     <span class="comment">// Append the clipboard menu to system menu</span>
00089     <span class="comment">//</span>
00090 
00091     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d9/cltxt_8h.html#a33">AppendMenu</a>(Console-&gt;hMenu,
00092                MF_POPUP | MF_STRING,
00093                (ULONG_PTR)Console-&gt;hHeirMenu,
00094                <span class="comment">//"Edit"</span>
00095                ItemString
00096               )) {
00097         KdPrint((<span class="stringliteral">"AppendMenu 1 failed %d\n"</span>,GetLastError()));
00098     }
00099 
00100     <span class="comment">//</span>
00101     <span class="comment">// Add other items to system menu</span>
00102     <span class="comment">//</span>
00103 
00104     ItemLength = LoadString(ghInstance,cmDefaults,ItemString,<a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(ItemString));
00105     <span class="keywordflow">if</span> (ItemLength == 0)
00106         KdPrint((<span class="stringliteral">"LoadString %d failed %d\n"</span>,cmDefaults,GetLastError()));
00107     <span class="keywordflow">if</span> (ItemLength) {
00108         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d9/cltxt_8h.html#a33">AppendMenu</a>(Console-&gt;hMenu, MF_STRING, cmDefaults, ItemString)) {
00109             KdPrint((<span class="stringliteral">"AppendMenu %d failed %d\n"</span>,cmDefaults,GetLastError()));
00110         }
00111     }
00112     ItemLength = LoadString(ghInstance,cmControl,ItemString,<a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(ItemString));
00113     <span class="keywordflow">if</span> (ItemLength == 0)
00114         KdPrint((<span class="stringliteral">"LoadString %d failed %d\n"</span>,cmControl,GetLastError()));
00115     <span class="keywordflow">if</span> (ItemLength) {
00116         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d9/cltxt_8h.html#a33">AppendMenu</a>(Console-&gt;hMenu, MF_STRING, cmControl, ItemString)) {
00117             KdPrint((<span class="stringliteral">"AppendMenu %d failed %d\n"</span>,cmControl,GetLastError()));
00118         }
00119     }
00120 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="consrv.h::InsertScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InsertScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01155">1155</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.
<p>
<pre class="fragment"><div>01162                    :
01163 
01164     This routine inserts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer pointer into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console's
01165     list of screen buffers.
01166 
01167 Arguments:
01168 
01169     Console - Pointer to console information structure.
01170 
01171     ScreenInfo - Pointer to screen information structure.
01172 
01173 Return Value:
01174 
01175 Note:
01176 
01177     The console lock must be held when calling <span class="keyword">this</span> routine.
01178 
01179 --*/
01180 
01181 {
01182     ScreenInfo-&gt;Next = Console-&gt;ScreenBuffers;
01183     Console-&gt;ScreenBuffers = ScreenInfo;
01184 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a308" doxytag="consrv.h::InvertSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InvertSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Inverting</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00155">155</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00126">CONSOLE_SELECTION_INVERTED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00293">WriteRegionToScreenBitMap()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.
<p>
<pre class="fragment"><div>00159 {
00160     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Inverted;
00161     <span class="keywordflow">if</span> (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> &amp;&amp;
00162         Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>) {
00163         Inverted = (Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a30">CONSOLE_SELECTION_INVERTED</a>) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00164         <span class="keywordflow">if</span> (Inverting == Inverted) {
00165             <span class="keywordflow">return</span>;
00166         }
00167         <span class="keywordflow">if</span> (Inverting) {
00168             Console-&gt;SelectionFlags |= <a class="code" href="../../d1/d7/server_8h.html#a30">CONSOLE_SELECTION_INVERTED</a>;
00169         } <span class="keywordflow">else</span> {
00170             Console-&gt;SelectionFlags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a30">CONSOLE_SELECTION_INVERTED</a>;
00171         }
00172         <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00173     }
00174 
00175 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a263" doxytag="consrv.h::LoadStringExW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int LoadStringExW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HINSTANCE&nbsp;</td>
          <td class="mdname" nowrap> <em>hModule</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cchBufferMax</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wLangId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04995">4995</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00041">UTCHAR</a>.
<p>
<pre class="fragment"><div>05002 {
05003     HANDLE hResInfo;
05004     HANDLE hStringSeg;
05005     LPTSTR lpsz;
05006     <span class="keywordtype">int</span> cch;
05007 
05008     <span class="comment">/*</span>
05009 <span class="comment">     * Make sure the parms are valid.</span>
05010 <span class="comment">     */</span>
05011     <span class="keywordflow">if</span> (lpBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05012         <span class="keywordflow">return</span> 0;
05013     }
05014 
05015     cch = 0;
05016 
05017     <span class="comment">/*</span>
05018 <span class="comment">     * String Tables are broken up into 16 string segments.  Find the segment</span>
05019 <span class="comment">     * containing the string we are interested in.</span>
05020 <span class="comment">     */</span>
05021     <span class="keywordflow">if</span> (hResInfo = FindResourceEx(hModule,
05022                                   RT_STRING,
05023                                   (LPTSTR)((LONG)(((USHORT)wID &gt;&gt; 4) + 1)),
05024                                   wLangId)) {
05025 
05026         <span class="comment">/*</span>
05027 <span class="comment">         * Load that segment.</span>
05028 <span class="comment">         */</span>
05029         hStringSeg = LoadResource(hModule, hResInfo);
05030 
05031         <span class="comment">/*</span>
05032 <span class="comment">         * Lock the resource.</span>
05033 <span class="comment">         */</span>
05034         <span class="keywordflow">if</span> (lpsz = (LPTSTR)LockResource(hStringSeg)) {
05035 
05036             <span class="comment">/*</span>
05037 <span class="comment">             * Move past the other strings in this segment.</span>
05038 <span class="comment">             * (16 strings in a segment -&gt; &amp; 0x0F)</span>
05039 <span class="comment">             */</span>
05040             wID &amp;= 0x0F;
05041             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
05042                 cch = *((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)lpsz++);      <span class="comment">// PASCAL like string count</span>
05043                                                 <span class="comment">// first UTCHAR is count if TCHARs</span>
05044                 <span class="keywordflow">if</span> (wID-- == 0) <span class="keywordflow">break</span>;
05045                 lpsz += cch;                    <span class="comment">// Step to start if next string</span>
05046             }
05047 
05048             <span class="comment">/*</span>
05049 <span class="comment">             * chhBufferMax == 0 means return a pointer to the read-only resource buffer.</span>
05050 <span class="comment">             */</span>
05051             <span class="keywordflow">if</span> (cchBufferMax == 0) {
05052                 *(LPTSTR *)lpBuffer = lpsz;
05053             } <span class="keywordflow">else</span> {
05054 
05055                 <span class="comment">/*</span>
05056 <span class="comment">                 * Account for the NULL</span>
05057 <span class="comment">                 */</span>
05058                 cchBufferMax--;
05059 
05060                 <span class="comment">/*</span>
05061 <span class="comment">                 * Don't copy more than the max allowed.</span>
05062 <span class="comment">                 */</span>
05063                 <span class="keywordflow">if</span> (cch &gt; cchBufferMax)
05064                     cch = cchBufferMax;
05065 
05066                 <span class="comment">/*</span>
05067 <span class="comment">                 * Copy the string into the buffer.</span>
05068 <span class="comment">                 */</span>
05069                 RtlCopyMemory(lpBuffer, lpsz, cch*<span class="keyword">sizeof</span>(WCHAR));
05070             }
05071         }
05072     }
05073 
05074     <span class="comment">/*</span>
05075 <span class="comment">     * Append a NULL.</span>
05076 <span class="comment">     */</span>
05077     <span class="keywordflow">if</span> (cchBufferMax != 0) {
05078         lpBuffer[cch] = 0;
05079     }
05080 
05081     <span class="keywordflow">return</span> cch;
05082 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a232" doxytag="consrv.h::MakeCursorVisible" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MakeCursorVisible           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>CursorPosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02348">2348</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, and <a class="el" href="../../d1/d2/__stream_8h-source.html#l00046">WWSB_AdjustCursorPosition()</a>.
<p>
<pre class="fragment"><div>02352 {
02353     COORD WindowOrigin;
02354     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02355 
02356     WindowOrigin.X = 0;
02357     WindowOrigin.Y = 0;
02358     <span class="keywordflow">if</span> (CursorPosition.X &gt; ScreenInfo-&gt;Window.Right) {
02359         WindowOrigin.X = CursorPosition.X - ScreenInfo-&gt;Window.Right;
02360     }
02361     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.X &lt; ScreenInfo-&gt;Window.Left) {
02362         WindowOrigin.X = CursorPosition.X - ScreenInfo-&gt;Window.Left;
02363     }
02364     <span class="keywordflow">if</span> (CursorPosition.Y &gt; ScreenInfo-&gt;Window.Bottom) {
02365         WindowOrigin.Y = CursorPosition.Y - ScreenInfo-&gt;Window.Bottom;
02366     }
02367     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CursorPosition.Y &lt; ScreenInfo-&gt;Window.Top) {
02368         WindowOrigin.Y = CursorPosition.Y - ScreenInfo-&gt;Window.Top;
02369     }
02370     <span class="keywordflow">if</span> (WindowOrigin.X != 0 || WindowOrigin.Y != 0) {
02371         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
02372                                FALSE,
02373                                WindowOrigin
02374                               );
02375         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02376             <span class="keywordflow">return</span>;
02377         }
02378     }
02379 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a267" doxytag="consrv.h::MapHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MapHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientProcessHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00874">874</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, and <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00027">CreateConsoleBitmap()</a>.
<p>
<pre class="fragment"><div>00879 {
00880     <span class="comment">//</span>
00881     <span class="comment">// map event handle into dll's handle space.</span>
00882     <span class="comment">//</span>
00883 
00884     <span class="keywordflow">return</span> DuplicateHandle(NtCurrentProcess(),
00885                            ServerHandle,
00886                            ClientProcessHandle,
00887                            ClientHandle,
00888                            0,
00889                            FALSE,
00890                            DUPLICATE_SAME_ACCESS
00891                           );
00892 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a251" doxytag="consrv.h::MatchandCopyAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MatchandCopyAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Exe</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>LineCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">1105</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01102">MAX_ARGS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.
<p>
<pre class="fragment"><div>01118                    :
01119 
01120     This routine matches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input string with an alias and copies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01121     alias to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
01122 
01123 Arguments:
01124 
01125     Source - string to match
01126 
01127     SourceLength - length of Source in bytes
01128 
01129     TargetBuffer - where to store matched string
01130 
01131     TargetLength - on input, contains size of TargetBuffer.  On output,
01132     contains length of alias stored in TargetBuffer.
01133 
01134     SourceIsCommandLine - <span class="keywordflow">if</span> <span class="keyword">true</span>, source buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a command line, where
01135         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first blank separate token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be check <span class="keywordflow">for</span> an alias, and <span class="keywordflow">if</span>
01136         <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> matches, replaced with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alias.  <span class="keywordflow">if</span> <span class="keyword">false</span>, then
01137         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a null terminated alias name.
01138 
01139     LineCount - aliases can contain multiple commands.  $T <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command
01140         separator
01141 
01142 Return Value:
01143 
01144     SUCCESS - match was found and alias was copied to buffer.
01145 
01146 --*/
01147 
01148 {
01149     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
01150     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01151     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> SourceUpToFirstBlank=0;  <span class="comment">// in chars</span>
01152     PWCHAR Tmp;
01153     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
01154     LPWSTR Args[<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a11">MAX_ARGS</a>];
01155     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgsLength[<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a11">MAX_ARGS</a>];    <span class="comment">// in bytes</span>
01156     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> NumSourceArgs;
01157     LPWSTR SourcePtr;
01158     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgCount,i,j,NewTargetLength;
01159     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> SourceRemainderLength;   <span class="comment">// in chars</span>
01160     PWCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>,TargetAlias;
01161     PWCHAR TmpBuffer;
01162 
01163     <span class="comment">//</span>
01164     <span class="comment">// alloc of exename may have failed.</span>
01165     <span class="comment">//</span>
01166 
01167     <span class="keywordflow">if</span> (Exe == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01168         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01169 
01170     <span class="comment">//</span>
01171     <span class="comment">// find exe</span>
01172     <span class="comment">//</span>
01173 
01174     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,Exe,ExeLength,TRUE);
01175     <span class="keywordflow">if</span> (!ExeAliasList) {
01176         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01177     }
01178 
01179     <span class="comment">//</span>
01180     <span class="comment">// find first blank</span>
01181     <span class="comment">//</span>
01182 
01183     <span class="keywordflow">for</span> (Tmp=Source,SourceUpToFirstBlank=0;
01184          *Tmp!=(WCHAR)<span class="charliteral">' '</span> &amp;&amp; SourceUpToFirstBlank&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(SourceLength/<span class="keyword">sizeof</span>(WCHAR));
01185          Tmp++,SourceUpToFirstBlank++) ;
01186 
01187     <span class="comment">//</span>
01188     <span class="comment">// find char past first blank</span>
01189     <span class="comment">//</span>
01190 
01191     j=SourceUpToFirstBlank;
01192     <span class="keywordflow">while</span> (j&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(SourceLength/<span class="keyword">sizeof</span>(WCHAR)) &amp;&amp; *Tmp==(WCHAR)<span class="charliteral">' '</span>) {
01193         Tmp++;
01194         j++;
01195     }
01196     SourcePtr = Tmp;
01197     SourceRemainderLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((SourceLength/<span class="keyword">sizeof</span>(WCHAR)) - j);
01198 
01199     <span class="comment">//</span>
01200     <span class="comment">// find alias</span>
01201     <span class="comment">//</span>
01202 
01203     Alias = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a>(ExeAliasList,Source,(USHORT)(SourceUpToFirstBlank*<span class="keyword">sizeof</span>(WCHAR)));
01204     <span class="keywordflow">if</span> (!Alias) {
01205         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01206     }
01207 
01208     TmpBuffer = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),*TargetLength);
01209     <span class="keywordflow">if</span> (!TmpBuffer)
01210         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01211 
01212     <span class="comment">//</span>
01213     <span class="comment">// count args in target</span>
01214     <span class="comment">//</span>
01215 
01216     ArgCount=0;
01217     *LineCount=1;
01218     Tmp=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>;
01219     <span class="keywordflow">for</span> (i=0;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(i+1)&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR));i++) {
01220         <span class="keywordflow">if</span> (*Tmp == (WCHAR)<span class="charliteral">'$'</span> &amp;&amp; *(Tmp+1) &gt;= (WCHAR)<span class="charliteral">'1'</span> &amp;&amp; *(Tmp+1) &lt;= (WCHAR)<span class="charliteral">'9'</span>) {
01221             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgNum = *(Tmp+1) - (WCHAR)<span class="charliteral">'0'</span>;
01222             <span class="keywordflow">if</span> (ArgNum &gt; ArgCount) {
01223                 ArgCount = ArgNum;
01224             }
01225             Tmp++;
01226             i++;
01227         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*Tmp == (WCHAR)<span class="charliteral">'$'</span> &amp;&amp; *(Tmp+1) == (WCHAR)<span class="charliteral">'*'</span>) {
01228             <span class="keywordflow">if</span> (ArgCount==0) {
01229                 ArgCount = 1;
01230             }
01231             Tmp++;
01232             i++;
01233         }
01234         Tmp++;
01235     }
01236 
01237     <span class="comment">//</span>
01238     <span class="comment">// package up space separated strings in source into array</span>
01239     <span class="comment">// of args</span>
01240     <span class="comment">//</span>
01241     <span class="comment">//</span>
01242 
01243     NumSourceArgs=0;
01244     Tmp = SourcePtr;
01245     <span class="keywordflow">for</span> (i=0,j=0;i&lt;ArgCount;i++) {
01246         <span class="keywordflow">if</span> (j&lt;SourceRemainderLength) {
01247             Args[NumSourceArgs] = Tmp;
01248             ArgsLength[NumSourceArgs] = 0;
01249             <span class="keywordflow">while</span> (j++&lt;SourceRemainderLength &amp;&amp; *Tmp++ != (WCHAR)<span class="charliteral">' '</span>) {
01250                 ArgsLength[NumSourceArgs] += <span class="keyword">sizeof</span>(WCHAR);
01251             }
01252             <span class="keywordflow">while</span> (j&lt;SourceRemainderLength &amp;&amp; *Tmp == (WCHAR)<span class="charliteral">' '</span>) {
01253                 j++;
01254                 Tmp++;
01255             }
01256             NumSourceArgs++;
01257         } <span class="keywordflow">else</span> {
01258             <span class="keywordflow">break</span>;
01259         }
01260     }
01261 
01262     <span class="comment">//</span>
01263     <span class="comment">// put together the target string</span>
01264     <span class="comment">//</span>
01265     <span class="comment">// while (target)</span>
01266     <span class="comment">//     if ($)</span>
01267     <span class="comment">//        if arg &amp;&amp; arg# &lt;= ArgCount</span>
01268     <span class="comment">//            copy arg</span>
01269     <span class="comment">//        else if *</span>
01270     <span class="comment">//            copy arg</span>
01271     <span class="comment">//        else</span>
01272     <span class="comment">//            replace with &lt; &gt; etc</span>
01273     <span class="comment">//     else</span>
01274     <span class="comment">//        copy text up to next ' '</span>
01275     <span class="comment">//</span>
01276 
01277     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = TmpBuffer;
01278     NewTargetLength = 2*<span class="keyword">sizeof</span>(WCHAR);    <span class="comment">// for CRLF</span>
01279     TargetAlias=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>;
01280     <span class="keywordflow">for</span> (i=0;i&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR));i++) {
01281         <span class="keywordflow">if</span> (NewTargetLength &gt;= *TargetLength) {
01282             *TargetLength = NewTargetLength;
01283             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01284             <span class="keywordflow">break</span>;
01285         }
01286         <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'$'</span> &amp;&amp; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(i+1)&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR))) {
01287             TargetAlias++;
01288             i++;
01289             <span class="keywordflow">if</span> (*TargetAlias &gt;= (WCHAR)<span class="charliteral">'1'</span> &amp;&amp; *TargetAlias &lt;= (WCHAR)<span class="charliteral">'9'</span>) {
01290 
01291                 <span class="comment">//</span>
01292                 <span class="comment">// do numbered parameter substitution</span>
01293                 <span class="comment">//</span>
01294 
01295                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgNumber;
01296 
01297                 ArgNumber = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(*TargetAlias - (WCHAR)<span class="charliteral">'1'</span>);
01298                 <span class="keywordflow">if</span> (ArgNumber &lt; NumSourceArgs) {
01299                     <span class="keywordflow">if</span> ((NewTargetLength+ArgsLength[ArgNumber])&lt;=*TargetLength) {
01300                         RtlCopyMemory(Buffer,Args[ArgNumber],ArgsLength[ArgNumber]);
01301                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>+=ArgsLength[ArgNumber]/<span class="keyword">sizeof</span>(WCHAR);
01302                         NewTargetLength+=ArgsLength[ArgNumber];
01303                     } <span class="keywordflow">else</span> {
01304                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01305                         <span class="keywordflow">break</span>;
01306                     }
01307                 }
01308             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'*'</span>) {
01309 
01310                 <span class="comment">//</span>
01311                 <span class="comment">// do * parameter substitution</span>
01312                 <span class="comment">//</span>
01313 
01314                 <span class="keywordflow">if</span> (NumSourceArgs) {
01315                     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NewTargetLength+(SourceRemainderLength*<span class="keyword">sizeof</span>(WCHAR)))&lt;=*TargetLength) {
01316                         RtlCopyMemory(Buffer,Args[0],SourceRemainderLength*<span class="keyword">sizeof</span>(WCHAR));
01317                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>+=SourceRemainderLength;
01318                         NewTargetLength+=SourceRemainderLength*<span class="keyword">sizeof</span>(WCHAR);
01319                     } <span class="keywordflow">else</span> {
01320                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01321                         <span class="keywordflow">break</span>;
01322                     }
01323                 }
01324             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'l'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'L'</span>) {
01325 
01326                 <span class="comment">//</span>
01327                 <span class="comment">// do &lt; substitution</span>
01328                 <span class="comment">//</span>
01329 
01330                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'&lt;'</span>;
01331                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01332             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'g'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'G'</span>) {
01333 
01334                 <span class="comment">//</span>
01335                 <span class="comment">// do &gt; substitution</span>
01336                 <span class="comment">//</span>
01337 
01338                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'&gt;'</span>;
01339                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01340             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'b'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'B'</span>) {
01341 
01342                 <span class="comment">//</span>
01343                 <span class="comment">// do | substitution</span>
01344                 <span class="comment">//</span>
01345 
01346                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'|'</span>;
01347                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01348             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'t'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'T'</span>) {
01349 
01350                 <span class="comment">//</span>
01351                 <span class="comment">// do newline substitution</span>
01352                 <span class="comment">//</span>
01353 
01354                 <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NewTargetLength+(<span class="keyword">sizeof</span>(WCHAR)*2))&gt;*TargetLength) {
01355                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01356                 }
01357 
01358                 *LineCount += 1;
01359                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
01360                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
01361                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR)*2;
01362             } <span class="keywordflow">else</span> {
01363 
01364                 <span class="comment">//</span>
01365                 <span class="comment">// copy $X</span>
01366                 <span class="comment">//</span>
01367 
01368                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'$'</span>;
01369                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01370                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = *TargetAlias;
01371                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01372             }
01373             TargetAlias++;
01374         } <span class="keywordflow">else</span> {
01375 
01376             <span class="comment">//</span>
01377             <span class="comment">// copy char</span>
01378             <span class="comment">//</span>
01379 
01380             *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = *TargetAlias++;
01381             NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01382         }
01383     }
01384     *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
01385     *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
01386     RtlCopyMemory(TargetBuffer,TmpBuffer,NewTargetLength);
01387     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpBuffer);
01388     *TargetLength = NewTargetLength;
01389     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01390 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a99" doxytag="consrv.h::ModifyConsoleProcessFocus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ModifyConsoleProcessFocus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Foreground</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04227">4227</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00048">_CONSOLE_PROCESS_HANDLE::Process</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04200">SetProcessFocus()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04213">SetProcessForegroundRights()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01567">DisplayModeTransition()</a>.
<p>
<pre class="fragment"><div>04231 {
04232     <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
04233     PLIST_ENTRY ListHead, ListNext;
04234 
04235     ListHead = &amp;Console-&gt;ProcessHandleList;
04236     ListNext = ListHead-&gt;Flink;
04237     <span class="keywordflow">while</span> (ListNext != ListHead) {
04238         ProcessHandleRecord = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>, ListLink );
04239         ListNext = ListNext-&gt;Flink;
04240         {
04241             <a class="code" href="../../d6/d2/output_8c.html#a72">SetProcessFocus</a>(ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o2">Process</a>, Foreground);
04242             <a class="code" href="../../d6/d2/output_8c.html#a73">SetProcessForegroundRights</a>(ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o2">Process</a>, Foreground);
04243         }
04244     }
04245 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a309" doxytag="consrv.h::MyInvert" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MyInvert           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>SmallRect</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">70</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd()</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00065">Rect::bottom</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00064">Rect::left</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00068">Rect</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00066">Rect::right</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00063">Rect::top</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">CancelMouseSelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">ConvertToMouseSelect()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00178">ExtendSelection()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00155">InvertSelection()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
<pre class="fragment"><div>00081 {
00082     RECT <a class="code" href="../../d5/d6/structRect.html">Rect</a>;
00083     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00084 <span class="preprocessor">#ifdef FE_SB</span>
00085 <span class="preprocessor"></span>    SMALL_RECT SmallRect2;
00086     COORD TargetPoint;
00087     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
00088 <span class="preprocessor">#endif  // FE_SB</span>
00089 <span class="preprocessor"></span>
00090     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00091 <span class="preprocessor">#ifdef FE_SB</span>
00092 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
00093             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00094         <span class="keywordflow">for</span> (SmallRect2.Top=SmallRect-&gt;Top; SmallRect2.Top &lt;= SmallRect-&gt;Bottom;SmallRect2.Top++) {
00095             SmallRect2.Bottom = SmallRect2.Top;
00096             SmallRect2.Left = SmallRect-&gt;Left;
00097             SmallRect2.Right = SmallRect-&gt;Right;
00098 
00099             TargetPoint.X = SmallRect2.Left;
00100             TargetPoint.Y = SmallRect2.Top;
00101             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = SmallRect2.Right - SmallRect2.Left + 1;
00102             <a class="code" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd</a>(StringLength,TargetPoint,ScreenInfo,&amp;SmallRect2);
00103 
00104             <span class="keywordflow">if</span> (SmallRect2.Left &lt;= SmallRect2.Right) {
00105                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> = SmallRect2.Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00106                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> = SmallRect2.Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00107                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> = SmallRect2.Right+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00108                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> = SmallRect2.Bottom+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00109                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00110                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00111                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00112                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00113                 PatBlt(Console-&gt;hDC,
00114                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00115                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00116                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a>  - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00117                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00118                        DSTINVERT
00119                       );
00120             }
00121         }
00122     } <span class="keywordflow">else</span>
00123 <span class="preprocessor">#endif  // FE_SB</span>
00124 <span class="preprocessor"></span>    {
00125         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> = SmallRect-&gt;Left-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00126         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> = SmallRect-&gt;Top-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00127         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> = SmallRect-&gt;Right+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00128         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> = SmallRect-&gt;Bottom+1-ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00129 <span class="preprocessor">#ifdef FE_SB</span>
00130 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
00131                 ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00132 <span class="preprocessor">#else</span>
00133 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)
00134 <span class="preprocessor">#endif</span>
00135 <span class="preprocessor"></span>        {
00136             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00137             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00138             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00139             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> *= <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00140         }
00141 
00142         PatBlt(Console-&gt;hDC,
00143                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00144                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00145                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a>  - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a>,
00146                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> - <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a>,
00147                   DSTINVERT
00148                  );
00149     }
00150 
00151     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00152 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a262" doxytag="consrv.h::MyStringCompareW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int MyStringCompareW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Str1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Str2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>bCaseInsensitive</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00369">369</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d5/nls_8c-source.html#l01520">RtlCompareUnicodeString()</a>, <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00037">String1</a>, and <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00038">String2</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/find_8c-source.html#l00028">SearchForString()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">TranslateConsoleTitle()</a>.
<p>
<pre class="fragment"><div>00375 {
00376     UNICODE_STRING <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>;
00377     UNICODE_STRING <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>;
00378 
00379     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>.Length = Length;
00380     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>.MaximumLength = Length;
00381     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>.Buffer = Str1;
00382     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>.Length = Length;
00383     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>.MaximumLength = Length;
00384     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>.Buffer = Str2;
00385     <span class="keywordflow">return</span> <a class="code" href="../../d6/d6/nls_8c.html#a41">RtlCompareUnicodeString</a>(&amp;String1,
00386                                    &amp;String2,
00387                                    bCaseInsensitive);
00388 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a138" doxytag="consrv.h::PrependInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> PrependInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputBufferInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PINPUT_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a297" doxytag="consrv.h::PropertiesDlgShow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PropertiesDlgShow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fCurrent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">287</a> of file <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html">ntcon/server/menu.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00161">_SCREEN_INFORMATION::Attributes</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00101">CONSOLE_AUTO_POSITION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00105">CONSOLE_HISTORY_NODUP</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00096">CONSOLE_QUICK_EDIT_MODE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l01865">InternalCreateCallbackThread()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00260">LockConsole</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00134">NtCreateSection()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00199">NtMapViewOfSection()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00033">NtUnmapViewOfSection()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00162">_SCREEN_INFORMATION::PopupAttributes</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00047">_CONSOLE_PROCESS_HANDLE::ProcessHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00051">_CONSOLE_PROCESS_HANDLE::PropRoutine</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00112">SCR_FACENAME()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00104">SCR_FAMILY()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00108">SCR_FONTNUMBER()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00120">SCR_FONTWEIGHT()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00041">_FONT_INFO::SizeWant</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00050">TM_IS_TT_FONT</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>00299 {
00300     HANDLE hSection = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00301     HANDLE hClientSection = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00302     HANDLE hThread;
00303     SIZE_T ulViewSize;
00304     LARGE_INTEGER li;
00305     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00306     PCONSOLE_STATE_INFO pStateInfo;
00307     <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
00308     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00309     LPTHREAD_START_ROUTINE MyPropRoutine;
00310 
00311     <span class="comment">/*</span>
00312 <span class="comment">     * Map the shared memory block handle into the client side process's</span>
00313 <span class="comment">     * address space.</span>
00314 <span class="comment">     */</span>
00315     ProcessHandleRecord = CONTAINING_RECORD(Console-&gt;ProcessHandleList.Blink,
00316                                             <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>,
00317                                             ListLink);
00318     <span class="comment">/*</span>
00319 <span class="comment">     * For global properties pass in hWnd for the hClientSection</span>
00320 <span class="comment">     */</span>
00321     <span class="keywordflow">if</span> (!fCurrent) {
00322         hClientSection = Console-&gt;hWnd;
00323         <span class="keywordflow">goto</span> PropCallback;
00324     }
00325 
00326     <span class="comment">/*</span>
00327 <span class="comment">     * Create a shared memory block.</span>
00328 <span class="comment">     */</span>
00329     li.QuadPart = <span class="keyword">sizeof</span>(CONSOLE_STATE_INFO) + Console-&gt;OriginalTitleLength;
00330     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/creasect_8c.html#a19">NtCreateSection</a>(&amp;hSection,
00331                              SECTION_ALL_ACCESS,
00332                              NULL,
00333                              &amp;li,
00334                              PAGE_READWRITE,
00335                              SEC_COMMIT,
00336                              NULL);
00337     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00338         KdPrint((<span class="stringliteral">"CONSRV: error %x creating file mapping\n"</span>, Status));
00339         <span class="keywordflow">return</span>;
00340     }
00341 
00342     <span class="comment">/*</span>
00343 <span class="comment">     * Get a pointer to the shared memory block.</span>
00344 <span class="comment">     */</span>
00345     pStateInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00346     ulViewSize = 0;
00347     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d5/mapview_8c.html#a20">NtMapViewOfSection</a>(hSection,
00348                                 NtCurrentProcess(),
00349                                 &amp;pStateInfo,
00350                                 0,
00351                                 0,
00352                                 NULL,
00353                                 &amp;ulViewSize,
00354                                 ViewUnmap,
00355                                 0,
00356                                 PAGE_READWRITE);
00357     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00358         KdPrint((<span class="stringliteral">"CONSRV: error %x mapping view of file\n"</span>, Status));
00359         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hSection);
00360         <span class="keywordflow">return</span>;
00361     }
00362 
00363     <span class="comment">/*</span>
00364 <span class="comment">     * Fill in the shared memory block with the current values.</span>
00365 <span class="comment">     */</span>
00366     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00367     pStateInfo-&gt;Length = li.LowPart;
00368     pStateInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a> = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>;
00369     pStateInfo-&gt;WindowSize.X = <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
00370     pStateInfo-&gt;WindowSize.Y = <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
00371     pStateInfo-&gt;WindowPosX = Console-&gt;WindowRect.left;
00372     pStateInfo-&gt;WindowPosY = Console-&gt;WindowRect.top;
00373     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00374         pStateInfo-&gt;FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
00375         pStateInfo-&gt;FontFamily = <a class="code" href="../../d8/d5/consrv_8h.html#a63">SCR_FAMILY</a>(ScreenInfo);
00376         pStateInfo-&gt;FontWeight = <a class="code" href="../../d8/d5/consrv_8h.html#a67">SCR_FONTWEIGHT</a>(ScreenInfo);
00377         wcscpy(pStateInfo-&gt;FaceName, <a class="code" href="../../d8/d5/consrv_8h.html#a65">SCR_FACENAME</a>(ScreenInfo));
00378 <span class="preprocessor">#if defined(FE_SB)</span>
00379 <span class="preprocessor"></span><span class="comment">// if TT font has external leading, the Size.Y &lt;&gt; SizeWant.Y</span>
00380 <span class="comment">// if we still pass actual Size.Y to console.cpl to query font,</span>
00381 <span class="comment">// it will be incorrect. Jun-26-1996</span>
00382 
00383         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00384             <a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a63">SCR_FAMILY</a>(ScreenInfo)))
00385         {
00386             <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo) &gt;= 0 ) &amp;&amp;
00387                 (<a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo) &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>)) {
00388 
00389                 pStateInfo-&gt;FontSize = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[<a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo)].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>;
00390             }
00391         }
00392 <span class="preprocessor">#endif</span>
00393 <span class="preprocessor"></span>        pStateInfo-&gt;CursorSize = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorSize;
00394     }
00395     pStateInfo-&gt;FullScreen = Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN;
00396     pStateInfo-&gt;QuickEdit = Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00397     pStateInfo-&gt;AutoPosition = Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a16">CONSOLE_AUTO_POSITION</a>;
00398     pStateInfo-&gt;InsertMode = Console-&gt;InsertMode;
00399     pStateInfo-&gt;ScreenAttributes = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>;
00400     pStateInfo-&gt;PopupAttributes = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o9">PopupAttributes</a>;
00401     pStateInfo-&gt;HistoryBufferSize = Console-&gt;CommandHistorySize;
00402     pStateInfo-&gt;NumberOfHistoryBuffers = Console-&gt;MaxCommandHistories;
00403     pStateInfo-&gt;HistoryNoDup = Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a20">CONSOLE_HISTORY_NODUP</a>;
00404     RtlCopyMemory(pStateInfo-&gt;ColorTable,
00405                   Console-&gt;ColorTable,
00406                   <span class="keyword">sizeof</span>(Console-&gt;ColorTable));
00407     pStateInfo-&gt;hWnd = Console-&gt;hWnd;
00408     wcscpy(pStateInfo-&gt;ConsoleTitle, Console-&gt;OriginalTitle);
00409 <span class="preprocessor">#if defined(FE_SB)</span>
00410 <span class="preprocessor"></span>    pStateInfo-&gt;CodePage = Console-&gt;OutputCP;
00411 <span class="preprocessor">#endif</span>
00412 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/umapview_8c.html#a0">NtUnmapViewOfSection</a>(NtCurrentProcess(), pStateInfo);
00413 
00414     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(NtCurrentProcess(),
00415                                hSection,
00416                                ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o1">ProcessHandle</a>,
00417                                &amp;hClientSection,
00418                                0,
00419                                0,
00420                                DUPLICATE_SAME_ACCESS);
00421     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00422         KdPrint((<span class="stringliteral">"CONSRV: error %x mapping handle to client\n"</span>, Status));
00423         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hSection);
00424         <span class="keywordflow">return</span>;
00425     }
00426 
00427 PropCallback:
00428     <span class="comment">/*</span>
00429 <span class="comment">     * Get a pointer to the client-side properties routine.</span>
00430 <span class="comment">     */</span>
00431     MyPropRoutine = ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o5">PropRoutine</a>;
00432     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(MyPropRoutine);
00433 
00434     <span class="comment">/*</span>
00435 <span class="comment">     * Call back into the client process to spawn the properties dialog.</span>
00436 <span class="comment">     */</span>
00437     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00438     hThread = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a19">InternalCreateCallbackThread</a>(ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o1">ProcessHandle</a>,
00439                                            (ULONG_PTR)MyPropRoutine,
00440                                            (ULONG_PTR)hClientSection);
00441     <span class="keywordflow">if</span> (!hThread) {
00442         KdPrint((<span class="stringliteral">"CONSRV: CreateRemoteThread failed %d\n"</span>, GetLastError()));
00443     }
00444     <a class="code" href="../../d8/d5/consrv_8h.html#a42">LockConsole</a>(Console);
00445 
00446     <span class="comment">/*</span>
00447 <span class="comment">     * Close any open handles and free allocated memory.</span>
00448 <span class="comment">     */</span>
00449     <span class="keywordflow">if</span> (hThread)
00450         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hThread);
00451     <span class="keywordflow">if</span> (hSection)
00452         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hSection);
00453 
00454     <span class="keywordflow">return</span>;
00455 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a298" doxytag="consrv.h::PropertiesUpdate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PropertiesUpdate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hClientSection</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">459</a> of file <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html">ntcon/server/menu.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00101">CONSOLE_AUTO_POSITION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00105">CONSOLE_HISTORY_NODUP</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00096">CONSOLE_QUICK_EDIT_MODE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">DeleteCommandLine()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00039">FullScreenInitialized</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01584">GetWindowPlacement</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00199">NtMapViewOfSection()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00033">NtUnmapViewOfSection()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00098">_COOKED_READ_DATA::NumberOfVisibleChars</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00162">_SCREEN_INFORMATION::PopupAttributes</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00047">_CONSOLE_PROCESS_HANDLE::ProcessHandle</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a42">RedrawCommandLine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04665">ResizeCommandHistoryBuffers()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00288">SetCursorMode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>, <a class="el" href="../../d4/d3/w32_2ntuser_2client_2nt6_2pch_8h-source.html#l00009">SetWindowPos</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>00471 {
00472     HANDLE hSection;
00473     SIZE_T ulViewSize;
00474     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00475     PCONSOLE_STATE_INFO pStateInfo;
00476     <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
00477     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00478     ULONG FontIndex;
00479     WINDOWPLACEMENT wp;
00480     COORD NewSize;
00481     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00482 
00483     <span class="comment">/*</span>
00484 <span class="comment">     * Map the shared memory block handle into our address space.</span>
00485 <span class="comment">     */</span>
00486     ProcessHandleRecord = CONTAINING_RECORD(Console-&gt;ProcessHandleList.Blink,
00487                                             <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>,
00488                                             ListLink);
00489     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o1">ProcessHandle</a>,
00490                                hClientSection,
00491                                NtCurrentProcess(),
00492                                &amp;hSection,
00493                                0,
00494                                0,
00495                                DUPLICATE_SAME_ACCESS);
00496     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00497         KdPrint((<span class="stringliteral">"CONSRV: error %x mapping client handle\n"</span>, Status));
00498         <span class="keywordflow">return</span>;
00499     }
00500 
00501     <span class="comment">/*</span>
00502 <span class="comment">     * Get a pointer to the shared memory block.</span>
00503 <span class="comment">     */</span>
00504     pStateInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00505     ulViewSize = 0;
00506     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d5/mapview_8c.html#a20">NtMapViewOfSection</a>(hSection,
00507                                 NtCurrentProcess(),
00508                                 &amp;pStateInfo,
00509                                 0,
00510                                 0,
00511                                 NULL,
00512                                 &amp;ulViewSize,
00513                                 ViewUnmap,
00514                                 0,
00515                                 PAGE_READONLY);
00516     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00517         KdPrint((<span class="stringliteral">"CONSRV: error %x mapping view of file\n"</span>, Status));
00518         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hSection);
00519         <span class="keywordflow">return</span>;
00520     }
00521 
00522     <span class="comment">/*</span>
00523 <span class="comment">     * Verify the size of the shared memory block.</span>
00524 <span class="comment">     */</span>
00525     <span class="keywordflow">if</span> (ulViewSize &lt; <span class="keyword">sizeof</span>(CONSOLE_STATE_INFO)) {
00526         KdPrint((<span class="stringliteral">"CONSRV: sizeof(hSection) &lt; sizeof(CONSOLE_STATE_INFO)\n"</span>));
00527         <a class="code" href="../../d4/d9/umapview_8c.html#a0">NtUnmapViewOfSection</a>(NtCurrentProcess(), pStateInfo);
00528         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hSection);
00529         <span class="keywordflow">return</span>;
00530     }
00531 
00532     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00533 <span class="preprocessor">#if defined(FE_SB)</span>
00534 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Console-&gt;OutputCP != pStateInfo-&gt;CodePage)
00535     {
00536         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> CodePage = Console-&gt;OutputCP;
00537 
00538         Console-&gt;OutputCP = pStateInfo-&gt;CodePage;
00539         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>())
00540             Console-&gt;fIsDBCSOutputCP = !!<a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;OutputCP);
00541         <span class="keywordflow">else</span>
00542             Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00543         SetConsoleCPInfo(Console,TRUE);
00544 <span class="preprocessor">#if defined(FE_IME)</span>
00545 <span class="preprocessor"></span>        SetImeOutputCodePage(Console, ScreenInfo, CodePage);
00546 <span class="preprocessor">#endif // FE_IME</span>
00547 <span class="preprocessor"></span>    }
00548     <span class="keywordflow">if</span> (Console-&gt;CP != pStateInfo-&gt;CodePage)
00549     {
00550         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> CodePage = Console-&gt;CP;
00551 
00552         Console-&gt;CP = pStateInfo-&gt;CodePage;
00553         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>())
00554             Console-&gt;fIsDBCSCP = !!<a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;CP);
00555         <span class="keywordflow">else</span>
00556             Console-&gt;fIsDBCSCP = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00557         SetConsoleCPInfo(Console,FALSE);
00558 <span class="preprocessor">#if defined(FE_IME)</span>
00559 <span class="preprocessor"></span>        SetImeCodePage(Console);
00560 <span class="preprocessor">#endif // FE_IME</span>
00561 <span class="preprocessor"></span>    }
00562 <span class="preprocessor">#endif // FE_SB</span>
00563 <span class="preprocessor"></span>
00564     <span class="comment">/*</span>
00565 <span class="comment">     * Update the console state from the supplied values.</span>
00566 <span class="comment">     */</span>
00567     <span class="keywordflow">if</span> (!(Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>) &amp;&amp;
00568         (pStateInfo-&gt;ScreenBufferSize.X != ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X ||
00569          pStateInfo-&gt;ScreenBufferSize.Y != ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y)) {
00570 
00571         <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData = Console-&gt;lpCookedReadData;
00572 
00573         <span class="keywordflow">if</span> (CookedReadData &amp;&amp; CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o12">NumberOfVisibleChars</a>) {
00574             <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData, FALSE);
00575         }
00576         <a class="code" href="../../d6/d2/output_8c.html#a58">ResizeScreenBuffer</a>(ScreenInfo,
00577                            pStateInfo-&gt;ScreenBufferSize,
00578                            TRUE);
00579         <span class="keywordflow">if</span> (CookedReadData &amp;&amp; CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o12">NumberOfVisibleChars</a>) {
00580             <a class="code" href="../../d4/d1/cmdline_8h.html#a42">RedrawCommandLine</a>(CookedReadData);
00581         }
00582     }
00583 <span class="preprocessor">#if !defined(FE_SB)</span>
00584 <span class="preprocessor"></span>    FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(pStateInfo-&gt;FontFamily,
00585                                pStateInfo-&gt;FaceName,
00586                                pStateInfo-&gt;FontSize,
00587                                pStateInfo-&gt;FontWeight);
00588 <span class="preprocessor">#else</span>
00589 <span class="preprocessor"></span>    FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(pStateInfo-&gt;FontFamily,
00590                                pStateInfo-&gt;FaceName,
00591                                pStateInfo-&gt;FontSize,
00592                                pStateInfo-&gt;FontWeight,
00593                                pStateInfo-&gt;CodePage);
00594 <span class="preprocessor">#endif</span>
00595 <span class="preprocessor"></span>
00596 <span class="preprocessor">#if defined(FE_SB)</span>
00597 <span class="preprocessor"></span><span class="preprocessor">#if defined(i386)</span>
00598 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (! (Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
00599         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo, FontIndex, pStateInfo-&gt;CodePage);
00600     }
00601     <span class="keywordflow">else</span> {
00602         <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd, 0);
00603         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo, FontIndex, pStateInfo-&gt;CodePage);
00604         <a class="code" href="../../d7/d4/server_2private_8c.html#a48">ConvertToFullScreen</a>(Console);
00605         <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd, CDS_FULLSCREEN);
00606     }
00607 <span class="preprocessor">#else // i386</span>
00608 <span class="preprocessor"></span>    <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo, FontIndex, pStateInfo-&gt;CodePage);
00609 <span class="preprocessor">#endif</span>
00610 <span class="preprocessor"></span><span class="preprocessor">#else // FE_SB</span>
00611 <span class="preprocessor"></span>    <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo, FontIndex);
00612 <span class="preprocessor">#endif // FE_SB</span>
00613 <span class="preprocessor"></span>    <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a4">SetCursorInformation</a>(ScreenInfo,
00614                          pStateInfo-&gt;CursorSize,
00615                          ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorVisible);
00616 
00617     <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00618     NewSize.X = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(pStateInfo-&gt;WindowSize.X, WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.X);
00619     NewSize.Y = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(pStateInfo-&gt;WindowSize.Y, WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.Y);
00620     <span class="keywordflow">if</span> (NewSize.X != <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) ||
00621         NewSize.Y != <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)) {
00622         wp.length = <span class="keyword">sizeof</span>(wp);
00623         <a class="code" href="../../d6/d0/usercli_8h.html#a238">GetWindowPlacement</a>(Console-&gt;hWnd, &amp;wp);
00624         wp.rcNormalPosition.right += (NewSize.X - <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)) *
00625                             <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X;
00626         wp.rcNormalPosition.bottom += (NewSize.Y - <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)) *
00627                              <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y;
00628         SetWindowPlacement(Console-&gt;hWnd, &amp;wp);
00629     }
00630 
00631 <span class="preprocessor">#ifdef i386</span>
00632 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a12">FullScreenInitialized</a>) {
00633         <span class="keywordflow">if</span> (pStateInfo-&gt;FullScreen == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00634             <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00635                 <a class="code" href="../../d7/d4/server_2private_8c.html#a49">ConvertToWindowed</a>(Console);
00636 <span class="preprocessor">#if defined(FE_SB)</span>
00637 <span class="preprocessor"></span>                <span class="comment">/*</span>
00638 <span class="comment">                 * Should not sets 0 always.</span>
00639 <span class="comment">                 * because exist CONSOLE_FULLSCREEN_HARDWARE bit by avobe</span>
00640 <span class="comment">                 *   else {</span>
00641 <span class="comment">                 *       ChangeDispSettings(Console, Console-&gt;hWnd, 0);</span>
00642 <span class="comment">                 *       SetScreenBufferFont(ScreenInfo, FontIndex, pStateInfo-&gt;CodePage);</span>
00643 <span class="comment">                 *       ConvertToFullScreen(Console);</span>
00644 <span class="comment">                 *       ChangeDispSettings(Console, Console-&gt;hWnd, CDS_FULLSCREEN);</span>
00645 <span class="comment">                 *   }</span>
00646 <span class="comment">                 * block.</span>
00647 <span class="comment">                 *</span>
00648 <span class="comment">                 * This block enable as follows:</span>
00649 <span class="comment">                 *   1. console window is full screen</span>
00650 <span class="comment">                 *   2. open property by ALT+SPACE</span>
00651 <span class="comment">                 *   3. changes window mode by settings.</span>
00652 <span class="comment">                 */</span>
00653                 Console-&gt;FullScreenFlags &amp;= ~CONSOLE_FULLSCREEN;
00654 <span class="preprocessor">#else</span>
00655 <span class="preprocessor"></span>                <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE));
00656                 Console-&gt;FullScreenFlags = 0;
00657 <span class="preprocessor">#endif</span>
00658 <span class="preprocessor"></span>
00659                 <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd, 0);
00660             }
00661         } <span class="keywordflow">else</span> {
00662             <span class="keywordflow">if</span> (Console-&gt;FullScreenFlags == 0) {
00663                 <a class="code" href="../../d7/d4/server_2private_8c.html#a48">ConvertToFullScreen</a>(Console);
00664                 Console-&gt;FullScreenFlags |= CONSOLE_FULLSCREEN;
00665 
00666                 <a class="code" href="../../d8/d5/consrv_8h.html#a293">ChangeDispSettings</a>(Console, Console-&gt;hWnd, CDS_FULLSCREEN);
00667             }
00668         }
00669     }
00670 <span class="preprocessor">#endif</span>
00671 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (pStateInfo-&gt;QuickEdit) {
00672         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00673     } <span class="keywordflow">else</span> {
00674         Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00675     }
00676     <span class="keywordflow">if</span> (pStateInfo-&gt;AutoPosition) {
00677         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a16">CONSOLE_AUTO_POSITION</a>;
00678     } <span class="keywordflow">else</span> {
00679         Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a16">CONSOLE_AUTO_POSITION</a>;
00680         <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a0">SetWindowPos</a>(Console-&gt;hWnd, NULL,
00681                         pStateInfo-&gt;WindowPosX,
00682                         pStateInfo-&gt;WindowPosY,
00683                         0, 0, SWP_NOZORDER | SWP_NOSIZE);
00684     }
00685     <span class="keywordflow">if</span> (Console-&gt;InsertMode != pStateInfo-&gt;InsertMode) {
00686         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a5">SetCursorMode</a>(ScreenInfo, FALSE);
00687         Console-&gt;InsertMode = (pStateInfo-&gt;InsertMode != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00688 <span class="preprocessor">#ifdef FE_SB</span>
00689 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (Console-&gt;lpCookedReadData) {
00690             ((<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>)Console-&gt;lpCookedReadData)-&gt;InsertMode = Console-&gt;InsertMode;
00691         }
00692 <span class="preprocessor">#endif</span>
00693 <span class="preprocessor"></span>    }
00694 
00695     RtlCopyMemory(Console-&gt;ColorTable,
00696                   pStateInfo-&gt;ColorTable,
00697                   <span class="keyword">sizeof</span>(Console-&gt;ColorTable));
00698     <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(ScreenInfo,
00699                     pStateInfo-&gt;ScreenAttributes,
00700                     pStateInfo-&gt;PopupAttributes,
00701                     TRUE);
00702 
00703     <a class="code" href="../../d8/d5/consrv_8h.html#a261">ResizeCommandHistoryBuffers</a>(Console, pStateInfo-&gt;HistoryBufferSize);
00704     Console-&gt;MaxCommandHistories = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)pStateInfo-&gt;NumberOfHistoryBuffers;
00705     <span class="keywordflow">if</span> (pStateInfo-&gt;HistoryNoDup) {
00706         Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a20">CONSOLE_HISTORY_NODUP</a>;
00707     } <span class="keywordflow">else</span> {
00708         Console-&gt;Flags &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a20">CONSOLE_HISTORY_NODUP</a>;
00709     }
00710 
00711 <span class="preprocessor">#if defined(FE_IME)</span>
00712 <span class="preprocessor"></span>    SetUndetermineAttribute(Console) ;
00713 <span class="preprocessor">#endif</span>
00714 <span class="preprocessor"></span>
00715     <a class="code" href="../../d4/d9/umapview_8c.html#a0">NtUnmapViewOfSection</a>(NtCurrentProcess(), pStateInfo);
00716     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hSection);
00717 
00718     <span class="keywordflow">return</span>;
00719 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a120" doxytag="consrv.h::QueueConsoleMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS QueueConsoleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04267">4267</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00375">CM_CONSOLE_MSG</a>, <a class="el" href="../../d1/d7/server_8h.html#a106">CONSOLE_MSG</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00348">ConsoleLocked</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00072">_CONSOLE_MSG::ListLink</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00075">_CONSOLE_MSG::lParam</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00073">_CONSOLE_MSG::Message</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00237">_CONSOLE_INFORMATION::MessageQueue</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/server_8h.html#a107">PCONSOLE_MSG</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00074">_CONSOLE_MSG::wParam</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01229">SrvSetConsoleCP()</a>, and <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00853">SrvSetConsoleDisplayMode()</a>.
<p>
<pre class="fragment"><div>04276                    :
04277 
04278     This inserts a message into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console's message queue and wakes up
04279     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console input thread to process <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
04280 
04281 Arguments:
04282 
04283     Console - Pointer to console information structure.
04284 
04285     Message - Message to store in queue.
04286 
04287     wParam - wParam to store in queue.
04288 
04289     lParam - lParam to store in queue.
04290 
04291 Return Value:
04292 
04293     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - STATUS_SUCCESS <span class="keywordflow">if</span> everything <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> OK.
04294 
04295 --*/
04296 
04297 {
04298     <a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html">PCONSOLE_MSG</a> pConMsg;
04299 
04300     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d1/d7/server_8h.html#a63">ConsoleLocked</a>(Console));
04301 
04302     pConMsg = (<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html">PCONSOLE_MSG</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ), <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html">CONSOLE_MSG</a>));
04303     <span class="keywordflow">if</span> (pConMsg == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04304         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
04305     }
04306 
04307     pConMsg-&gt;<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html#o1">Message</a> = Message;
04308     pConMsg-&gt;<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html#o2">wParam</a> = wParam;
04309     pConMsg-&gt;<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html#o3">lParam</a> = lParam;
04310 
04311     InsertHeadList(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o76">MessageQueue</a>, &amp;pConMsg-&gt;<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html#o0">ListLink</a>);
04312 
04313     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, CM_CONSOLE_MSG, 0, 0)) {
04314         RemoveEntryList(&amp;pConMsg-&gt;<a class="code" href="../../d7/d3/struct__CONSOLE__MSG.html#o0">ListLink</a>);
04315         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pConMsg);
04316         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
04317     }
04318 
04319     <span class="keywordflow">return</span> STATUS_SUCCESS;
04320 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a127" doxytag="consrv.h::QueueThreadMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS QueueThreadMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwThreadId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01860">1860</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00376">CM_CONSOLE_INPUT_THREAD_MSG</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01825">gInputThreadMsg</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00062">gInputThreadMsgLock</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/server_8h.html#a109">PCONSOLE_THREAD_MSG</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00481">PostThreadMessage()</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>.
<p>
<pre class="fragment"><div>01865 {
01866     <a class="code" href="../../d1/d7/struct__CONSOLE__THREAD__MSG.html">PCONSOLE_THREAD_MSG</a> pConMsg;
01867 
01868     <span class="comment">// NOTE HIROYAMA: change this to RIP_VERBOSE</span>
01869     RIPMSG4(RIP_VERBOSE, <span class="stringliteral">"QueueThreadMessage: TID=%08x msg:%04x (%08x, %08x)"</span>,
01870             dwThreadId, message, wParam, lParam);
01871 
01872     pConMsg = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>(TMP_TAG), <span class="keyword">sizeof</span> *pConMsg);
01873     <span class="keywordflow">if</span> (pConMsg == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01874         RIPMSG0(RIP_WARNING, <span class="stringliteral">"QueueThreadMessage: failed to allocate pConMsg"</span>);
01875         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01876     }
01877 
01878     pConMsg-&gt;<a class="code" href="../../d1/d7/struct__CONSOLE__THREAD__MSG.html#o1">dwThreadId</a> = dwThreadId;
01879     pConMsg-&gt;Message = message;
01880     pConMsg-&gt;wParam = wParam;
01881     pConMsg-&gt;lParam = lParam;
01882 
01883     RtlEnterCriticalSection(&amp;gInputThreadMsgLock);
01884     InsertHeadList(&amp;gInputThreadMsg, &amp;pConMsg-&gt;ListLink);
01885     RtlLeaveCriticalSection(&amp;gInputThreadMsgLock);
01886 
01887     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d8/ntcftxt_8h.html#a21">PostThreadMessage</a>(dwThreadId, CM_CONSOLE_INPUT_THREAD_MSG, 0, 0)) {
01888         RIPMSG1(RIP_WARNING, <span class="stringliteral">"QueueThreadMessage: failed to post thread msg(%04x)"</span>, message);
01889         RtlEnterCriticalSection(&amp;gInputThreadMsgLock);
01890         RemoveEntryList(&amp;pConMsg-&gt;ListLink);
01891         RtlLeaveCriticalSection(&amp;gInputThreadMsgLock);
01892         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pConMsg);
01893         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01894     }
01895 
01896     <span class="keywordflow">return</span> STATUS_SUCCESS;
01897 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a131" doxytag="consrv.h::ReadBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReadBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>EventsRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Peek</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>StreamRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>ResetWaitEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Unicode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a221" doxytag="consrv.h::ReadChars" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReadChars           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>NumBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InitialNumBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CtrlWakeupMask</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG Message&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Unicode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">1778</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00096">_COOKED_READ_DATA::BackupLimit</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00092">_COOKED_READ_DATA::BufferSize</a>, <a class="el" href="../../d2/d6/stream_8h-source.html#l00025">_RAW_READ_DATA::BufferSize</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00095">_COOKED_READ_DATA::BufPtr</a>, <a class="el" href="../../d2/d6/stream_8h-source.html#l00026">_RAW_READ_DATA::BufPtr</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00093">_COOKED_READ_DATA::BytesRead</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00099">_COOKED_READ_DATA::CommandHistory</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00088">_COOKED_READ_DATA::Console</a>, <a class="el" href="../../d2/d6/stream_8h-source.html#l00024">_RAW_READ_DATA::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00025">ConsoleAddShare()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a32">COOKED_READ_DATA</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00108">_COOKED_READ_DATA::CtrlWakeupMask</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00094">_COOKED_READ_DATA::CurrentPosition</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d0/xcpt4_8c-source.html#l02358">Echo()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00100">_COOKED_READ_DATA::Echo</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00106">_COOKED_READ_DATA::ExeName</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00034">ExeNameLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00107">_COOKED_READ_DATA::ExeNameLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00053">FindActiveScreenBufferHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00307">HANDLE_INPUT_PENDING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00308">HANDLE_MULTI_LINE_INPUT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00105">_COOKED_READ_DATA::HandleIndex</a>, <a class="el" href="../../d2/d6/stream_8h-source.html#l00028">_RAW_READ_DATA::HandleIndex</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">HISTORY_TAG</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00086">_COOKED_READ_DATA::InputInfo</a>, <a class="el" href="../../d2/d6/stream_8h-source.html#l00023">_RAW_READ_DATA::InputInfo</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00103">_COOKED_READ_DATA::InsertMode</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00102">_COOKED_READ_DATA::Line</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00027">LINE_INPUT_BUFFER_SIZE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00098">_COOKED_READ_DATA::NumberOfVisibleChars</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00097">_COOKED_READ_DATA::OriginalCursorPosition</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00104">_COOKED_READ_DATA::ProcessData</a>, <a class="el" href="../../d2/d6/stream_8h-source.html#l00027">_RAW_READ_DATA::ProcessData</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00101">_COOKED_READ_DATA::Processed</a>, <a class="el" href="../../d1/d7/stream_8h.html#a0">RAW_READ_DATA</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00087">_COOKED_READ_DATA::ScreenInfo</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00089">_COOKED_READ_DATA::TempHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a53">TranslateUnicodeToOem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00844">Unicode</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00091">_COOKED_READ_DATA::UserBuffer</a>, and <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00090">_COOKED_READ_DATA::UserBufferSize</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02263">SrvReadConsole()</a>.
<p>
<pre class="fragment"><div>01798                    :
01799 
01800     This routine reads in characters <span class="keywordflow">for</span> stream input and does <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01801     required processing based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input mode (line,<span class="keywordtype">char</span>,echo).
01802     This routine returns UNICODE characters.
01803 
01804 Arguments:
01805 
01806     InputInfo - Pointer to input buffer information.
01807 
01808     Console - Pointer to console buffer information.
01809 
01810     ScreenInfo - Pointer to screen buffer information.
01811 
01812     lpBuffer - Pointer to buffer to read into.
01813 
01814     NumBytes - On input, size of buffer.  On output, number of bytes
01815     read.
01816 
01817     HandleData - Pointer to handle data structure.
01818 
01819 Return Value:
01820 
01821 --*/
01822 
01823 {
01824     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01825     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01826     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">HANDLE_DATA</a> TempHandle;
01827     BOOLEAN <a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01828     ULONG NumToWrite;
01829 <span class="preprocessor">#ifdef FE_SB</span>
01830 <span class="preprocessor"></span>    <a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a> a = (<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a>)&amp;Message-&gt;u.ApiMessageData;
01831     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01832     ULONG NumToBytes;
01833 <span class="preprocessor">#endif</span>
01834 <span class="preprocessor"></span>
01835     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> = *NumBytes;
01836     *NumBytes = 0;
01837 
01838     <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a>) {
01839 
01840         <span class="comment">//</span>
01841         <span class="comment">// if we have leftover input, copy as much fits into the user's</span>
01842         <span class="comment">// buffer and return.  we may have multi line input, if a macro</span>
01843         <span class="comment">// has been defined that contains the $T character.</span>
01844         <span class="comment">//</span>
01845 
01846         <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a53">HANDLE_MULTI_LINE_INPUT</a>) {
01847             PWSTR Tmp;
01848 <span class="preprocessor">#ifdef FE_SB</span>
01849 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> &amp;&amp; CONSOLE_IS_DBCS_CP(Console)) {
01850 
01851                 <span class="keywordflow">if</span> (HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
01852                     fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01853                     *lpBuffer++ = HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar;
01854                     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>--;
01855                     HandleData-&gt;InputReadData-&gt;BytesAvailable--;
01856                     RtlZeroMemory(&amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
01857                 }
01858                 <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;BytesAvailable == 0 ||
01859                     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> == 0) {
01860                     HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp;= ~(<a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a> | <a class="code" href="../../d1/d7/server_8h.html#a53">HANDLE_MULTI_LINE_INPUT</a>);
01861                     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(HandleData-&gt;InputReadData-&gt;BufPtr);
01862                     *NumBytes = 1;
01863                     <span class="keywordflow">return</span> STATUS_SUCCESS;
01864                 }
01865                 <span class="keywordflow">else</span> {
01866                     <span class="keywordflow">for</span> (NumToWrite=0,Tmp=HandleData-&gt;InputReadData-&gt;CurrentBufPtr,NumToBytes=0;
01867                          NumToBytes &lt; HandleData-&gt;InputReadData-&gt;BytesAvailable &amp;&amp; NumToBytes &lt; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>/<span class="keyword">sizeof</span>(WCHAR) &amp;&amp; *Tmp!=<a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
01868                          (IsConsoleFullWidth(Console-&gt;hDC,
01869                                              Console-&gt;CP,*Tmp) ? NumToBytes+=2 : NumToBytes++),Tmp++,NumToWrite+=<span class="keyword">sizeof</span>(WCHAR)) ;
01870                 }
01871             }
01872 <span class="preprocessor">#endif</span>
01873 <span class="preprocessor"></span>            <span class="keywordflow">for</span> (NumToWrite=0,Tmp=HandleData-&gt;InputReadData-&gt;CurrentBufPtr;
01874                  NumToWrite &lt; HandleData-&gt;InputReadData-&gt;BytesAvailable &amp;&amp; *Tmp!=<a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
01875                  Tmp++,NumToWrite+=<span class="keyword">sizeof</span>(WCHAR)) ;
01876             NumToWrite += <span class="keyword">sizeof</span>(WCHAR);
01877             <span class="keywordflow">if</span> (NumToWrite &gt; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>) {
01878                 NumToWrite = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01879             }
01880         } <span class="keywordflow">else</span> {
01881 <span class="preprocessor">#ifdef FE_SB</span>
01882 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> &amp;&amp; CONSOLE_IS_DBCS_CP(Console)) {
01883                 PWSTR Tmp;
01884 
01885                 <span class="keywordflow">if</span> (HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
01886                     fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01887                     *lpBuffer++ = HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar;
01888                     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>-=<span class="keyword">sizeof</span>(WCHAR);
01889                     HandleData-&gt;InputReadData-&gt;BytesAvailable-=<span class="keyword">sizeof</span>(WCHAR);
01890                     RtlZeroMemory(&amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
01891                 }
01892                 <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;BytesAvailable == 0) {
01893                     HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp;= ~(<a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a> | <a class="code" href="../../d1/d7/server_8h.html#a53">HANDLE_MULTI_LINE_INPUT</a>);
01894                     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(HandleData-&gt;InputReadData-&gt;BufPtr);
01895                     *NumBytes = 1;
01896                     <span class="keywordflow">return</span> STATUS_SUCCESS;
01897                 }
01898                 <span class="keywordflow">else</span> {
01899                     <span class="keywordflow">for</span> (NumToWrite=0,Tmp=HandleData-&gt;InputReadData-&gt;CurrentBufPtr,NumToBytes=0;
01900                          NumToBytes &lt; HandleData-&gt;InputReadData-&gt;BytesAvailable &amp;&amp; NumToBytes &lt; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>/<span class="keyword">sizeof</span>(WCHAR);
01901                          (IsConsoleFullWidth(Console-&gt;hDC,
01902                                              Console-&gt;CP,*Tmp) ? NumToBytes+=2 : NumToBytes++),Tmp++,NumToWrite+=<span class="keyword">sizeof</span>(WCHAR)) ;
01903                 }
01904             }
01905 <span class="preprocessor">#endif</span>
01906 <span class="preprocessor"></span>            NumToWrite = (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> &lt; HandleData-&gt;InputReadData-&gt;BytesAvailable) ?
01907                           <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> : HandleData-&gt;InputReadData-&gt;BytesAvailable;
01908         }
01909         RtlCopyMemory(lpBuffer,HandleData-&gt;InputReadData-&gt;CurrentBufPtr,NumToWrite);
01910         HandleData-&gt;InputReadData-&gt;BytesAvailable-= NumToWrite;
01911         <span class="keywordflow">if</span> (HandleData-&gt;InputReadData-&gt;BytesAvailable == 0) {
01912             HandleData-&gt;InputReadData-&gt;InputHandleFlags &amp;= ~(<a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a> | <a class="code" href="../../d1/d7/server_8h.html#a53">HANDLE_MULTI_LINE_INPUT</a>);
01913             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(HandleData-&gt;InputReadData-&gt;BufPtr);
01914         }
01915         <span class="keywordflow">else</span> {
01916             HandleData-&gt;InputReadData-&gt;CurrentBufPtr=(PWCHAR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)HandleData-&gt;InputReadData-&gt;CurrentBufPtr+NumToWrite);
01917         }
01918         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
01919 
01920             <span class="comment">//</span>
01921             <span class="comment">// if ansi, translate string.  we allocated the capture buffer large</span>
01922             <span class="comment">// enough to handle the translated string.</span>
01923             <span class="comment">//</span>
01924 
01925             PCHAR TransBuffer;
01926 
01927 <span class="preprocessor">#ifdef FE_SB</span>
01928 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console))
01929                 TransBuffer = (PCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),NumToBytes);
01930             <span class="keywordflow">else</span>
01931 <span class="preprocessor">#endif</span>
01932 <span class="preprocessor"></span>            TransBuffer = (PCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),NumToWrite / <span class="keyword">sizeof</span>(WCHAR));
01933             <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01934                 <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01935             }
01936 
01937 <span class="preprocessor">#ifdef FE_SB</span>
01938 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console))
01939             {
01940                 NumToWrite = <a class="code" href="../../d0/d3/dbcs_8h.html#a53">TranslateUnicodeToOem</a>(Console,
01941                                                    lpBuffer,
01942                                                    NumToWrite / <span class="keyword">sizeof</span> (WCHAR),
01943                                                    TransBuffer,
01944                                                    NumToBytes,
01945                                                    &amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte);
01946             }
01947             <span class="keywordflow">else</span>
01948 <span class="preprocessor">#endif</span>
01949 <span class="preprocessor"></span>            NumToWrite = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;CP,
01950                                 lpBuffer,
01951                                 NumToWrite / sizeof (WCHAR),
01952                                 TransBuffer,
01953                                 NumToWrite / <span class="keyword">sizeof</span> (WCHAR)
01954                                 );
01955             RtlCopyMemory(lpBuffer,TransBuffer,NumToWrite);
01956 <span class="preprocessor">#ifdef FE_SB</span>
01957 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (fAddDbcsLead)
01958                 NumToWrite++;
01959 <span class="preprocessor">#endif</span>
01960 <span class="preprocessor"></span>            <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
01961         }
01962         *NumBytes = NumToWrite;
01963         <span class="keywordflow">return</span> STATUS_SUCCESS;
01964     }
01965 
01966     <span class="comment">//</span>
01967     <span class="comment">// we need to create a temporary handle to the current screen buffer</span>
01968     <span class="comment">// if echo is on.</span>
01969     <span class="comment">//</span>
01970 
01971     <span class="keywordflow">if</span> ((InputInfo-&gt;InputMode &amp; (ENABLE_LINE_INPUT | ENABLE_ECHO_INPUT)) ==
01972         (ENABLE_LINE_INPUT | ENABLE_ECHO_INPUT)) {
01973         HANDLE ActiveScreenHandle;
01974 
01975         <a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01976         ActiveScreenHandle = <a class="code" href="../../d0/d7/server_2stream_8c.html#a16">FindActiveScreenBufferHandle</a>(ProcessData,Console);
01977         <span class="keywordflow">if</span> (ActiveScreenHandle != <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>) {
01978             TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> = <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>;
01979             TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer = Console-&gt;CurrentScreenBuffer;
01980             <span class="keywordflow">if</span> (TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01981                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a0">ConsoleAddShare</a>(GENERIC_WRITE,
01982                                          FILE_SHARE_READ | FILE_SHARE_WRITE,
01983                                          &amp;TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ShareAccess,
01984                                          &amp;TempHandle
01985                                         );
01986                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01987                     <a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01988                     TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;RefCount++;
01989                 }
01990             }
01991         }
01992     }
01993 
01994     <span class="keywordflow">if</span> (InputInfo-&gt;InputMode &amp; ENABLE_LINE_INPUT) {
01995 
01996         <span class="comment">//</span>
01997         <span class="comment">// read in characters until the buffer is full or return is read.</span>
01998         <span class="comment">// since we may wait inside this loop, store all important variables</span>
01999         <span class="comment">// in the read data structure.  if we do wait, a read data structure</span>
02000         <span class="comment">// will be allocated from the heap and its pointer will be stored</span>
02001         <span class="comment">// in the wait block.  the CookedReadData will be copied into the</span>
02002         <span class="comment">// structure.  the data is freed when the read is completed.</span>
02003         <span class="comment">//</span>
02004 
02005         <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">COOKED_READ_DATA</a> CookedReadData;
02006         ULONG i;
02007         PWCHAR TempBuffer;
02008         ULONG TempBufferSize;
02009 
02010         <span class="comment">//</span>
02011         <span class="comment">// to emulate OS/2 KbdStringIn, we read into our own big buffer</span>
02012         <span class="comment">// (256 bytes) until the user types enter.  then return as many</span>
02013         <span class="comment">// chars as will fit in the user's buffer.</span>
02014         <span class="comment">//</span>
02015 
02016         TempBufferSize = (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> &lt; <a class="code" href="../../d0/d7/server_2stream_8c.html#a2">LINE_INPUT_BUFFER_SIZE</a>) ? <a class="code" href="../../d0/d7/server_2stream_8c.html#a2">LINE_INPUT_BUFFER_SIZE</a> : <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
02017         TempBuffer = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TempBufferSize);
02018         <span class="keywordflow">if</span> (TempBuffer==<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02019             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>) {
02020                 <a class="code" href="../../d0/d7/server_2stream_8c.html#a36">CloseOutputHandle</a>(ProcessData,
02021                                   Console,
02022                                   &amp;TempHandle,
02023                                   NULL,
02024                                   FALSE
02025                                  );
02026             }
02027             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
02028         }
02029 
02030         <span class="comment">//</span>
02031         <span class="comment">// initialize the user's buffer to spaces.  this is done so that</span>
02032         <span class="comment">// moving in the buffer via cursor doesn't do strange things.</span>
02033         <span class="comment">//</span>
02034 
02035         <span class="keywordflow">for</span> (i=0;i&lt;TempBufferSize/<span class="keyword">sizeof</span>(WCHAR);i++) {
02036             TempBuffer[i] = (WCHAR)<span class="charliteral">' '</span>;
02037         }
02038 
02039         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o0">InputInfo</a> = InputInfo;
02040         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a> = ScreenInfo;
02041         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a> = Console;
02042         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o3">TempHandle</a>.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> = TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a>;
02043         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o3">TempHandle</a>.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer = TempHandle.<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
02044         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o6">BufferSize</a> = TempBufferSize;
02045         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> = 0;
02046         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a> = 0;
02047         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a> = TempBuffer;
02048         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a> = TempBuffer;
02049         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o4">UserBufferSize</a> = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
02050         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o5">UserBuffer</a> = lpBuffer;
02051         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X = -1;
02052         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.Y = -1;
02053         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o12">NumberOfVisibleChars</a> = 0;
02054         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o22">CtrlWakeupMask</a> = CtrlWakeupMask;
02055         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a> = CommandHistory;
02056         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o14">Echo</a> = <a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>;
02057         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o17">InsertMode</a> = Console-&gt;InsertMode;
02058         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o15">Processed</a> = (InputInfo-&gt;InputMode &amp; ENABLE_PROCESSED_INPUT) != 0;
02059         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o16">Line</a> = (InputInfo-&gt;InputMode &amp; ENABLE_LINE_INPUT) != 0;
02060         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o18">ProcessData</a> = ProcessData;
02061         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o19">HandleIndex</a> = HandleIndex;
02062         CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o20">ExeName</a> = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),ExeNameLength);
02063         <span class="keywordflow">if</span> (InitialNumBytes != 0) {
02064             RtlCopyMemory(CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a>, CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o5">UserBuffer</a>, InitialNumBytes);
02065             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> += InitialNumBytes;
02066             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o12">NumberOfVisibleChars</a> = (InitialNumBytes / <span class="keyword">sizeof</span>(WCHAR));
02067             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a> += (InitialNumBytes / <span class="keyword">sizeof</span>(WCHAR));
02068             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a> = (InitialNumBytes / <span class="keyword">sizeof</span>(WCHAR));
02069             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a> = ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
02070             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X -= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>;
02071 
02072 
02073             <span class="keywordflow">while</span> (CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X &lt; 0) {
02074                 CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X += ScreenInfo-&gt;ScreenBufferSize.X;
02075                 CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.Y -= 1;
02076             }
02077         }
02078         <span class="keywordflow">if</span> (CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o20">ExeName</a>) {
02079             RtlCopyMemory(CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o20">ExeName</a>,ExeName,ExeNameLength);
02080             CookedReadData.<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o21">ExeNameLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>;
02081         }
02082 <span class="preprocessor">#ifdef FE_SB</span>
02083 <span class="preprocessor"></span>        Console-&gt;lpCookedReadData = (PVOID)&amp;CookedReadData;
02084 <span class="preprocessor">#endif</span>
02085 <span class="preprocessor"></span>
02086         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a24">CookedRead</a>(&amp;CookedReadData,
02087                             Message,
02088                             CSR_SERVER_QUERYCLIENTTHREAD(),
02089                             FALSE
02090                            );
02091 <span class="preprocessor">#ifdef FE_SB</span>
02092 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
02093             Console-&gt;lpCookedReadData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02094         }
02095 <span class="preprocessor">#endif</span>
02096 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02097     }
02098 
02099     <span class="comment">//</span>
02100     <span class="comment">// character (raw) mode</span>
02101     <span class="comment">//</span>
02102 
02103     <span class="keywordflow">else</span> {
02104 
02105         <span class="comment">//</span>
02106         <span class="comment">// read at least one character in.  after one character has been</span>
02107         <span class="comment">// read, get any more available characters and return.  the first</span>
02108         <span class="comment">//  call to GetChar may wait.   if we do wait, a read data structure</span>
02109         <span class="comment">// will be allocated from the heap and its pointer will be stored</span>
02110         <span class="comment">// in the wait block.  the RawReadData will be copied into the</span>
02111         <span class="comment">// structure.  the data is freed when the read is completed.</span>
02112         <span class="comment">//</span>
02113 
02114         <a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html">RAW_READ_DATA</a> RawReadData;
02115 
02116         RawReadData.<a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html#o0">InputInfo</a> = InputInfo;
02117         RawReadData.<a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html#o1">Console</a> = Console;
02118         RawReadData.<a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html#o2">BufferSize</a> = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
02119         RawReadData.<a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html#o3">BufPtr</a> = lpBuffer;
02120         RawReadData.<a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html#o4">ProcessData</a> = ProcessData;
02121         RawReadData.<a class="code" href="../../d6/d2/struct__RAW__READ__DATA.html#o5">HandleIndex</a> = HandleIndex;
02122         <span class="keywordflow">if</span> (*NumBytes &lt; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>) {
02123             PWCHAR pwchT;
02124 
02125 <span class="preprocessor">#ifdef FE_SB</span>
02126 <span class="preprocessor"></span>            PWCHAR lpBufferTmp = lpBuffer;
02127 
02128             NumToWrite = 0;
02129             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> &amp;&amp; CONSOLE_IS_DBCS_CP(Console)) {
02130                 <span class="keywordflow">if</span> (HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
02131                     fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02132                     *lpBuffer++ = HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar;
02133                     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>-=<span class="keyword">sizeof</span>(WCHAR);
02134                     RtlZeroMemory(&amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
02135                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
02136                     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> == 0) {
02137                         *NumBytes = 1;
02138                         <span class="keywordflow">return</span> STATUS_SUCCESS;
02139                     }
02140                 }
02141                 <span class="keywordflow">else</span>{
02142                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(InputInfo,
02143                              lpBuffer,
02144                              TRUE,
02145                              Console,
02146                              HandleData,
02147                              Message,
02148                              RawReadWaitRoutine,
02149                              &amp;RawReadData,
02150                              <span class="keyword">sizeof</span>(RawReadData),
02151                              FALSE,
02152                              NULL,
02153                              NULL,
02154                              NULL,
02155                              NULL
02156                             );
02157                 }
02158             }
02159             <span class="keywordflow">else</span>
02160 <span class="preprocessor">#endif</span>
02161 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(InputInfo,
02162                              lpBuffer,
02163                              TRUE,
02164                              Console,
02165                              HandleData,
02166                              Message,
02167                              RawReadWaitRoutine,
02168                              &amp;RawReadData,
02169                              <span class="keyword">sizeof</span>(RawReadData),
02170                              FALSE,
02171                              NULL,
02172                              NULL,
02173                              NULL,
02174                              NULL
02175                             );
02176 
02177             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02178                 *NumBytes = 0;
02179                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02180             }
02181 <span class="preprocessor">#ifdef FE_SB</span>
02182 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (! fAddDbcsLead) {
02183                 IsConsoleFullWidth(Console-&gt;hDC,
02184                                    Console-&gt;CP,*lpBuffer) ? *NumBytes+=2 : ++*NumBytes;
02185                 NumToWrite+=<span class="keyword">sizeof</span>(WCHAR);
02186                 lpBuffer++;
02187             }
02188             <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
02189                 <span class="keywordflow">while</span> (NumToWrite &lt; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>) {
02190                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(InputInfo,lpBuffer,FALSE,NULL,NULL,NULL,NULL,NULL,0,FALSE,NULL,NULL,NULL,NULL);
02191                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02192                         <span class="keywordflow">return</span> STATUS_SUCCESS;
02193                     }
02194                     IsConsoleFullWidth(Console-&gt;hDC,
02195                                        Console-&gt;CP,*lpBuffer) ? *NumBytes+=2 : ++*NumBytes;
02196                     lpBuffer++;
02197                     NumToWrite+=<span class="keyword">sizeof</span>(WCHAR);
02198                 }
02199             }
02200             <span class="keywordflow">else</span>{
02201 <span class="preprocessor">#endif</span>
02202 <span class="preprocessor"></span>            pwchT = lpBuffer + 1;
02203             *NumBytes += <span class="keyword">sizeof</span>(WCHAR);
02204             <span class="keywordflow">while</span> (*NumBytes &lt; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>) {
02205                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(InputInfo,pwchT,FALSE,NULL,NULL,NULL,NULL,NULL,0,FALSE,NULL,NULL,NULL,NULL);
02206                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02207                     <span class="keywordflow">break</span>;
02208                 }
02209                 pwchT++;
02210                 *NumBytes += <span class="keyword">sizeof</span>(WCHAR);
02211             }
02212 <span class="preprocessor">#ifdef FE_SB</span>
02213 <span class="preprocessor"></span>            }
02214 <span class="preprocessor">#endif</span>
02215 <span class="preprocessor"></span>
02216             <span class="comment">//</span>
02217             <span class="comment">// if ansi, translate string.  we allocated the capture buffer large</span>
02218             <span class="comment">// enough to handle the translated string.</span>
02219             <span class="comment">//</span>
02220 
02221             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
02222 
02223                 PCHAR TransBuffer;
02224 
02225                 TransBuffer = (PCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),*NumBytes / <span class="keyword">sizeof</span>(WCHAR));
02226                 <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02227                     <span class="keywordflow">return</span> STATUS_NO_MEMORY;
02228                 }
02229 
02230 <span class="preprocessor">#ifdef FE_SB</span>
02231 <span class="preprocessor"></span>                lpBuffer = lpBufferTmp;
02232                 <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console))
02233                 {
02234                     *NumBytes = <a class="code" href="../../d0/d3/dbcs_8h.html#a53">TranslateUnicodeToOem</a>(Console,
02235                                                       lpBuffer,
02236                                                       NumToWrite / <span class="keyword">sizeof</span> (WCHAR),
02237                                                       TransBuffer,
02238                                                       *NumBytes,
02239                                                       &amp;HandleData-&gt;Buffer.InputBuffer-&gt;ReadConInpDbcsLeadByte);
02240                 }
02241                 <span class="keywordflow">else</span>
02242 <span class="preprocessor">#endif</span>
02243 <span class="preprocessor"></span>                *NumBytes = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;CP,
02244                                    lpBuffer,
02245                                    *NumBytes / sizeof (WCHAR),
02246                                    TransBuffer,
02247                                    *NumBytes / <span class="keyword">sizeof</span> (WCHAR)
02248                                    );
02249                 RtlCopyMemory(lpBuffer,TransBuffer,*NumBytes);
02250 <span class="preprocessor">#ifdef FE_SB</span>
02251 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (fAddDbcsLead)
02252                     ++*NumBytes;
02253 <span class="preprocessor">#endif</span>
02254 <span class="preprocessor"></span>                <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
02255             }
02256         }
02257     }
02258     <span class="keywordflow">return</span> STATUS_SUCCESS;
02259 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a136" doxytag="consrv.h::ReadInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReadInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PINPUT_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>nLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Peek</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitForData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>StreamRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG Message&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CSR_WAIT_ROUTINE WaitRoutine&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID WaitParameter&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG WaitParameterLength&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN WaitBlockExists&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00959">959</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00260">LockConsole</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00112">LockReadCount</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00126">NtClearEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00616">ReadBuffer()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00844">Unicode</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00113">UnlockReadCount</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00248">WaitForMoreToRead()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">SrvGetConsoleInput()</a>.
<p>
<pre class="fragment"><div>00981                    :
00982 
00983     This routine reads from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
00984 
00985 Arguments:
00986 
00987     InputInformation - Pointer to input buffer information structure.
00988 
00989     lpBuffer - <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> to read into.
00990 
00991     nLength - On input, number of events to read.  On output, number of
00992     events read.
00993 
00994     Peek - If <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, copy events to lpBuffer but don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> remove them from
00995     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
00996 
00997     WaitForData - <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, wait until an event <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> input.  <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <span class="keywordflow">return</span>
00998         immediately
00999 
01000     StreamRead - <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, events with repeat counts &gt; 1 are returned
01001     as multiple events.  also, EventsRead == 1.
01002 
01003     Console - Pointer to console buffer information.
01004 
01005     HandleData - Pointer to handle data structure.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01006     optional <span class="keywordflow">if</span> WaitForData <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">false</span>.
01007 
01008     Message - <span class="keywordflow">if</span> called from dll (not InputThread), points to api
01009     message.  <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used <span class="keywordflow">for</span> wait block processing.
01010 
01011     WaitRoutine - Routine to call when wait <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> woken up.
01012 
01013     WaitParameter - Parameter to pass to wait routine.
01014 
01015     WaitParameterLength - Length of wait parameter.
01016 
01017     WaitBlockExists - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> wait block has already been created.
01018 
01019 Return Value:
01020 
01021 Note:
01022 
01023     The console lock must be held when calling <span class="keyword">this</span> routine.
01024 
01025 --*/
01026 
01027 {
01028     ULONG EventsRead;
01029     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01030     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> ResetWaitEvent;
01031 
01032     <span class="keywordflow">if</span> (InputInformation-&gt;In == InputInformation-&gt;Out)  {
01033         <span class="keywordflow">if</span> (!WaitForData) {
01034             *nLength = 0;
01035             <span class="keywordflow">return</span> STATUS_SUCCESS;
01036         }
01037         <a class="code" href="../../d9/d3/input_8h.html#a25">LockReadCount</a>(HandleData);
01038         HandleData-&gt;InputReadData-&gt;ReadCount += 1;
01039         <a class="code" href="../../d9/d3/input_8h.html#a26">UnlockReadCount</a>(HandleData);
01040         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a14">WaitForMoreToRead</a>(InputInformation,
01041                                    Message,
01042                                    WaitRoutine,
01043                                    WaitParameter,
01044                                    WaitParameterLength,
01045                                    WaitBlockExists
01046                                   );
01047 
01048         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01049             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
01050                 <span class="comment">/*</span>
01051 <span class="comment">                 * WaitForMoreToRead failed, restore ReadCount and bale out</span>
01052 <span class="comment">                 */</span>
01053                 <a class="code" href="../../d9/d3/input_8h.html#a25">LockReadCount</a>(HandleData);
01054                 HandleData-&gt;InputReadData-&gt;ReadCount -= 1;
01055                 <a class="code" href="../../d9/d3/input_8h.html#a26">UnlockReadCount</a>(HandleData);
01056             }
01057             *nLength = 0;
01058             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01059         }
01060 
01061         <span class="comment">//</span>
01062         <span class="comment">// we will only get to this point if we were called by GetInput.</span>
01063         <span class="comment">//</span>
01064         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE); <span class="comment">// I say we never get here !  IANJA</span>
01065 
01066         <a class="code" href="../../d8/d5/consrv_8h.html#a42">LockConsole</a>(Console);
01067     }
01068 
01069     <span class="comment">//</span>
01070     <span class="comment">// read from buffer</span>
01071     <span class="comment">//</span>
01072 
01073     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a15">ReadBuffer</a>(InputInformation,
01074                         lpBuffer,
01075                         *nLength,
01076                         &amp;EventsRead,
01077                         Peek,
01078                         StreamRead,
01079                         &amp;ResetWaitEvent
01080 #<span class="keywordflow">if</span> defined(FE_SB)
01081                         ,
01082                         Unicode
01083 #endif
01084                        );
01085     <span class="keywordflow">if</span> (ResetWaitEvent) {
01086         <a class="code" href="../../d0/d8/ex_2event_8c.html#a4">NtClearEvent</a>(InputInformation-&gt;InputWaitEvent);
01087     }
01088 
01089     *nLength = EventsRead;
01090     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01091 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a110" doxytag="consrv.h::ReadOutputString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReadOutputString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadCoord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>StringType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumRecords</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l01795">1795</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00053">_ATTR_PAIR::Attr</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00068">_ROW::AttrRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00061">_ATTR_ROW::Attrs</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00067">_ROW::CharRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00038">_CHAR_ROW::Chars</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00269">CONSOLE_ASCII</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00271">CONSOLE_ATTRIBUTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00272">CONSOLE_FALSE_UNICODE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00270">CONSOLE_REAL_UNICODE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">ConvertOutputToOem()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01072">FindAttrIndex()</a>, <a class="el" href="../../d9/d1/tmerge_8c-source.html#l00012">_ATTR_PAIR::Length</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03111">UNICODE_SPACE</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01489">WcharToChar()</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01448">SrvReadConsoleOutputString()</a>.
<p>
<pre class="fragment"><div>01805                    :
01806 
01807     This routine reads a string of characters or attributes from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01808     screen buffer.
01809 
01810 Arguments:
01811 
01812     ScreenInfo - Pointer to screen buffer information.
01813 
01814     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> to read into.
01815 
01816     ReadCoord - Screen buffer coordinate to begin reading from.
01817 
01818     StringType
01819 
01820         <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>         - read a string of ASCII characters.
01821         <a class="code" href="../../d5/d5/conmsg_8h.html#a10">CONSOLE_REAL_UNICODE</a>  - read a string of <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a3">Real</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> characters.
01822         <a class="code" href="../../d5/d5/conmsg_8h.html#a12">CONSOLE_FALSE_UNICODE</a> - read a string of False <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> characters.
01823         <a class="code" href="../../d5/d5/conmsg_8h.html#a11">CONSOLE_ATTRIBUTE</a>     - read a string of attributes.
01824 
01825     NumRecords - On input, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in elements.  On output,
01826     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of elements read.
01827 
01828 Return Value:
01829 
01830 
01831 --*/
01832 
01833 {
01834     ULONG NumRead;
01835     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> X,Y;
01836     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RowIndex;
01837     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CountOfAttr;
01838     <a class="code" href="../../d3/d2/struct__ATTR__PAIR.html">PATTR_PAIR</a> Attr;
01839     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
01840     PWCHAR Char;
01841     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> j,k;
01842     PWCHAR TransBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01843     PWCHAR BufPtr;
01844 <span class="preprocessor">#if defined(FE_SB)</span>
01845 <span class="preprocessor"></span>    <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> AttrP;
01846     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> TransBufferA,BufPtrA;
01847     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
01848 <span class="preprocessor">#endif</span>
01849 <span class="preprocessor"></span>
01850     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"ReadOutputString\n"</span>));
01851     <span class="keywordflow">if</span> (*NumRecords == 0)
01852         <span class="keywordflow">return</span> STATUS_SUCCESS;
01853     NumRead = 0;
01854     X=ReadCoord.X;
01855     Y=ReadCoord.Y;
01856     <span class="keywordflow">if</span> (X&gt;=ScreenInfo-&gt;ScreenBufferSize.X ||
01857         X&lt;0 ||
01858         Y&gt;=ScreenInfo-&gt;ScreenBufferSize.Y ||
01859         Y&lt;0) {
01860         *NumRecords = 0;
01861         <span class="keywordflow">return</span> STATUS_SUCCESS;
01862     }
01863 
01864     RowIndex = (ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow+ReadCoord.Y) % ScreenInfo-&gt;ScreenBufferSize.Y;
01865 
01866     <span class="keywordflow">if</span> (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>) {
01867         TransBuffer = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),*NumRecords * <span class="keyword">sizeof</span>(WCHAR));
01868         <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01869             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01870         }
01871         BufPtr = TransBuffer;
01872     } <span class="keywordflow">else</span> {
01873         BufPtr = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01874     }
01875 
01876 <span class="preprocessor">#if defined(FE_SB)</span>
01877 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
01878     {
01879         TransBufferA = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),*NumRecords * <span class="keyword">sizeof</span>(BYTE));
01880         <span class="keywordflow">if</span> (TransBufferA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01881             <span class="keywordflow">if</span> (TransBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01882                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
01883             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01884         }
01885         BufPtrA = TransBufferA;
01886     }
01887 <span class="preprocessor">#endif</span>
01888 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>) ||
01889             (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a10">CONSOLE_REAL_UNICODE</a>) ||
01890             (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a12">CONSOLE_FALSE_UNICODE</a>)) {
01891         <span class="keywordflow">while</span> (NumRead &lt; *NumRecords) {
01892 
01893             <span class="comment">//</span>
01894             <span class="comment">// copy the chars from its array</span>
01895             <span class="comment">//</span>
01896 
01897             Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
01898             Char = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[X];
01899 <span class="preprocessor">#if defined(FE_SB)</span>
01900 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
01901                 AttrP = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[X];
01902 <span class="preprocessor">#endif</span>
01903 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ((ULONG)(ScreenInfo-&gt;ScreenBufferSize.X - X) &gt; (*NumRecords - NumRead)) {
01904                 RtlCopyMemory(BufPtr,Char,(*NumRecords - NumRead) * <span class="keyword">sizeof</span>(WCHAR));
01905 <span class="preprocessor">#if defined(FE_SB)</span>
01906 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
01907                     RtlCopyMemory(BufPtrA,AttrP,(*NumRecords - NumRead) * <span class="keyword">sizeof</span>(CHAR));
01908 <span class="preprocessor">#endif</span>
01909 <span class="preprocessor"></span>                NumRead += *NumRecords - NumRead;
01910                 <span class="keywordflow">break</span>;
01911             }
01912             RtlCopyMemory(BufPtr,Char,(ScreenInfo-&gt;ScreenBufferSize.X - X) * <span class="keyword">sizeof</span>(WCHAR));
01913             BufPtr = (PVOID)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)BufPtr + ((ScreenInfo-&gt;ScreenBufferSize.X - X) * <span class="keyword">sizeof</span>(WCHAR)));
01914 <span class="preprocessor">#if defined(FE_SB)</span>
01915 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
01916                 RtlCopyMemory(BufPtrA,AttrP,(ScreenInfo-&gt;ScreenBufferSize.X - X) * <span class="keyword">sizeof</span>(CHAR));
01917                 BufPtrA = (PVOID)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)BufPtrA + ((ScreenInfo-&gt;ScreenBufferSize.X - X) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)));
01918             }
01919 <span class="preprocessor">#endif</span>
01920 <span class="preprocessor"></span>            NumRead += ScreenInfo-&gt;ScreenBufferSize.X - X;
01921             <span class="keywordflow">if</span> (++RowIndex == ScreenInfo-&gt;ScreenBufferSize.Y) {
01922                 RowIndex = 0;
01923             }
01924             X = 0;
01925             Y++;
01926             <span class="keywordflow">if</span> (Y&gt;=ScreenInfo-&gt;ScreenBufferSize.Y) {
01927                 <span class="keywordflow">break</span>;
01928             }
01929         }
01930 <span class="preprocessor">#if defined(FE_SB)</span>
01931 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp; (NumRead)) {
01932             <span class="keywordflow">if</span> (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>) {
01933                 Char = BufPtr = TransBuffer;
01934             } <span class="keywordflow">else</span> {
01935                 Char = BufPtr = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01936             }
01937             AttrP = BufPtrA = TransBufferA;
01938 
01939             <span class="keywordflow">if</span> (*BufPtrA &amp; ATTR_TRAILING_BYTE)
01940             {
01941                 j = k = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(NumRead - 1);
01942                 BufPtr++;
01943                 *Char++ = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
01944                 BufPtrA++;
01945                 NumRead = 1;
01946             }
01947             <span class="keywordflow">else</span> {
01948                 j = k = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)NumRead;
01949                 NumRead = 0;
01950             }
01951             <span class="keywordflow">while</span> (j--) {
01952                 <span class="keywordflow">if</span> (!(*BufPtrA &amp; ATTR_TRAILING_BYTE)) {
01953                     *Char++ = *BufPtr;
01954                     NumRead++;
01955                 }
01956                 BufPtr++;
01957                 BufPtrA++;
01958             }
01959             <span class="keywordflow">if</span> (k &amp;&amp; *(BufPtrA-1) &amp; ATTR_LEADING_BYTE)
01960             {
01961                 *(Char-1) = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
01962             }
01963         }
01964 <span class="preprocessor">#endif</span>
01965 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a11">CONSOLE_ATTRIBUTE</a>) {
01966         PWORD TargetPtr=BufPtr;
01967         <span class="keywordflow">while</span> (NumRead &lt; *NumRecords) {
01968 
01969             <span class="comment">//</span>
01970             <span class="comment">// copy the attrs from its array</span>
01971             <span class="comment">//</span>
01972 
01973             Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
01974 <span class="preprocessor">#if defined(FE_SB)</span>
01975 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
01976                 AttrP = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[X];
01977 <span class="preprocessor">#endif</span>
01978 <span class="preprocessor"></span>            <a class="code" href="../../d6/d2/output_8c.html#a47">FindAttrIndex</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>,
01979                           X,
01980                           &amp;Attr,
01981                           &amp;CountOfAttr
01982                          );
01983             k=0;
01984             <span class="keywordflow">for</span> (j=X;j&lt;ScreenInfo-&gt;ScreenBufferSize.X;TargetPtr++) {
01985 <span class="preprocessor">#if defined(FE_SB)</span>
01986 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_OUTPUTCP(Console) )
01987                     *TargetPtr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a>;
01988                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((j == X) &amp;&amp; (*AttrP &amp; ATTR_TRAILING_BYTE))
01989                     *TargetPtr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a>;
01990                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*AttrP &amp; ATTR_LEADING_BYTE){
01991                     <span class="keywordflow">if</span> ((NumRead == *NumRecords-1)||(j == ScreenInfo-&gt;ScreenBufferSize.X-1))
01992                         *TargetPtr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a>;
01993                     <span class="keywordflow">else</span>
01994                         *TargetPtr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> | (WCHAR)(*AttrP &amp; ATTR_DBCSSBCS_BYTE) &lt;&lt; 8;
01995                 }
01996                 <span class="keywordflow">else</span>
01997                     *TargetPtr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> | (WCHAR)(*AttrP &amp; ATTR_DBCSSBCS_BYTE) &lt;&lt; 8;
01998 <span class="preprocessor">#else</span>
01999 <span class="preprocessor"></span>                *TargetPtr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a>;
02000 <span class="preprocessor">#endif</span>
02001 <span class="preprocessor"></span>                NumRead++;
02002                 j+=1;
02003                 <span class="keywordflow">if</span> (++k==CountOfAttr &amp;&amp; j&lt;ScreenInfo-&gt;ScreenBufferSize.X) {
02004                     Attr++;
02005                     k=0;
02006                     CountOfAttr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a>;
02007                 }
02008                 <span class="keywordflow">if</span> (NumRead == *NumRecords) {
02009 <span class="preprocessor">#if defined(FE_SB)</span>
02010 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
02011                         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBufferA);
02012 <span class="preprocessor">#endif</span>
02013 <span class="preprocessor"></span>                    <span class="keywordflow">return</span> STATUS_SUCCESS;
02014                 }
02015 <span class="preprocessor">#if defined(FE_SB)</span>
02016 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
02017                     AttrP++;
02018 <span class="preprocessor">#endif</span>
02019 <span class="preprocessor"></span>            }
02020             <span class="keywordflow">if</span> (++RowIndex == ScreenInfo-&gt;ScreenBufferSize.Y) {
02021                 RowIndex = 0;
02022             }
02023             X = 0;
02024             Y++;
02025             <span class="keywordflow">if</span> (Y&gt;=ScreenInfo-&gt;ScreenBufferSize.Y) {
02026                 <span class="keywordflow">break</span>;
02027             }
02028         }
02029     } <span class="keywordflow">else</span> {
02030         *NumRecords = 0;
02031 <span class="preprocessor">#if defined(FE_SB)</span>
02032 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
02033             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBufferA);
02034 <span class="preprocessor">#endif</span>
02035 <span class="preprocessor"></span>        <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
02036     }
02037 
02038     <span class="keywordflow">if</span> (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>) {
02039         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> Codepage;
02040 <span class="preprocessor">#if defined(FE_SB)</span>
02041 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
02042                 !(ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
02043             <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;OutputCP != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>)
02044                 Codepage = <a class="code" href="../../d0/d3/dbcs_8h.html#a5">USACP</a>;
02045             <span class="keywordflow">else</span>
02046                 Codepage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>;
02047         } <span class="keywordflow">else</span> {
02048             Codepage = ScreenInfo-&gt;Console-&gt;OutputCP;
02049         }
02050 <span class="preprocessor">#else</span>
02051 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
02052                 !(ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
02053             Codepage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>;
02054         } <span class="keywordflow">else</span> {
02055             Codepage = ScreenInfo-&gt;Console-&gt;OutputCP;
02056         }
02057 <span class="preprocessor">#endif</span>
02058 <span class="preprocessor"></span><span class="preprocessor">#if defined(FE_SB)</span>
02059 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((NumRead == 1) &amp;&amp; !CONSOLE_IS_DBCS_OUTPUTCP(Console))
02060 <span class="preprocessor">#else</span>
02061 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (NumRead == 1)
02062 <span class="preprocessor">#endif</span>
02063 <span class="preprocessor"></span>        {
02064             *((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>) = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a40">WcharToChar</a>(Codepage, *TransBuffer);
02065         } <span class="keywordflow">else</span> {
02066             NumRead = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a41">ConvertOutputToOem</a>(Codepage, TransBuffer, NumRead, Buffer, *NumRecords);
02067         }
02068         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
02069     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (StringType == <a class="code" href="../../d5/d5/conmsg_8h.html#a10">CONSOLE_REAL_UNICODE</a> &amp;&amp;
02070             (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
02071             !(ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
02072         <span class="comment">/*</span>
02073 <span class="comment">         * Buffer contains false Unicode (UnicodeOem) only in Windowed</span>
02074 <span class="comment">         * RasterFont mode, so in this case, convert it to real Unicode.</span>
02075 <span class="comment">         */</span>
02076         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(Buffer,
02077                                 NumRead,
02078                                 ScreenInfo-&gt;Console-&gt;OutputCP
02079                                 );
02080     }
02081 
02082 <span class="preprocessor">#if defined(FE_SB)</span>
02083 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console))
02084         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBufferA);
02085 <span class="preprocessor">#endif</span>
02086 <span class="preprocessor"></span>    *NumRecords = NumRead;
02087     <span class="keywordflow">return</span> STATUS_SUCCESS;
02088 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a125" doxytag="consrv.h::ReadRectFromScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ReadRectFromScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>SourcePoint</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetRect</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l01415">1415</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00053">_ATTR_PAIR::Attr</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00068">_ROW::AttrRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00061">_ATTR_ROW::Attrs</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00067">_ROW::CharRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00038">_CHAR_ROW::Chars</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01072">FindAttrIndex()</a>, <a class="el" href="../../d9/d1/tmerge_8c-source.html#l00012">_ATTR_PAIR::Length</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03111">UNICODE_SPACE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l01551">CopyRectangle()</a>, <a class="el" href="../../d0/d2/__priv_8h-source.html#l00041">FE_WriteRegionToScreenHW()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01623">ReadScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03226">ScrollRegion()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
<pre class="fragment"><div>01425                    :
01426 
01427     This routine copies a rectangular region from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer.
01428     no clipping <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done.
01429 
01430 Arguments:
01431 
01432     ScreenInfo - pointer to screen info
01433 
01434     SourcePoint - upper left coordinates of source rectangle
01435 
01436     Target - pointer to target buffer
01437 
01438     TargetSize - dimensions of target buffer
01439 
01440     TargetRect - rectangle in source buffer to copy
01441 
01442 Return Value:
01443 
01444     none.
01445 
01446 --*/
01447 
01448 {
01449 
01450     PCHAR_INFO TargetPtr;
01451     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j,k;
01452     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> XSize,YSize;
01453     BOOLEAN WholeTarget;
01454     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RowIndex;
01455     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
01456     PWCHAR Char;
01457     <a class="code" href="../../d3/d2/struct__ATTR__PAIR.html">PATTR_PAIR</a> Attr;
01458     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CountOfAttr;
01459 
01460     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"ReadRectFromScreenBuffer\n"</span>));
01461 
01462     XSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetRect-&gt;Right - TargetRect-&gt;Left + 1);
01463     YSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetRect-&gt;Bottom - TargetRect-&gt;Top + 1);
01464 
01465     TargetPtr = Target;
01466     WholeTarget = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01467     <span class="keywordflow">if</span> (XSize == TargetSize.X) {
01468         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (TargetRect-&gt;Left == 0);
01469         <span class="keywordflow">if</span> (TargetRect-&gt;Top != 0) {
01470             TargetPtr = (PCHAR_INFO)
01471                 ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)Target + <a class="code" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>(TargetRect-&gt;Left,
01472                                                        TargetRect-&gt;Top,
01473                                                        TargetSize.X,
01474                                                        <span class="keyword">sizeof</span>(CHAR_INFO)));
01475         }
01476         WholeTarget = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01477     }
01478     RowIndex = (ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow+SourcePoint.Y) % ScreenInfo-&gt;ScreenBufferSize.Y;
01479     <span class="keywordflow">for</span> (i=0;i&lt;YSize;i++) {
01480         <span class="keywordflow">if</span> (!WholeTarget) {
01481             TargetPtr = (PCHAR_INFO)
01482                 ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)Target + <a class="code" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>(TargetRect-&gt;Left,
01483                                                        TargetRect-&gt;Top+i,
01484                                                        TargetSize.X,
01485                                                        <span class="keyword">sizeof</span>(CHAR_INFO)));
01486         }
01487 
01488         <span class="comment">//</span>
01489         <span class="comment">// copy the chars and attrs from their respective arrays</span>
01490         <span class="comment">//</span>
01491 
01492         Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
01493         Char = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[SourcePoint.X];
01494         <a class="code" href="../../d6/d2/output_8c.html#a47">FindAttrIndex</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>,
01495                       SourcePoint.X,
01496                       &amp;Attr,
01497                       &amp;CountOfAttr
01498                      );
01499         k=0;
01500 <span class="preprocessor">#if defined(FE_SB)</span>
01501 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console)) {
01502             <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> AttrP = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[SourcePoint.X];
01503             <span class="keywordflow">for</span> (j=0;j&lt;XSize;TargetPtr++) {
01504                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> AttrR;
01505                 AttrR = *AttrP++;
01506                 <span class="keywordflow">if</span> (j==0 &amp;&amp; AttrR &amp; ATTR_TRAILING_BYTE)
01507                 {
01508                     TargetPtr-&gt;Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
01509                     AttrR = 0;
01510                 }
01511                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j+1 &gt;= XSize &amp;&amp; AttrR &amp; ATTR_LEADING_BYTE)
01512                 {
01513                     TargetPtr-&gt;Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
01514                     AttrR = 0;
01515                 }
01516                 <span class="keywordflow">else</span>
01517                     TargetPtr-&gt;Char.UnicodeChar = *Char;
01518                 Char++;
01519                 TargetPtr-&gt;Attributes = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> | (WCHAR)(AttrR &amp; ATTR_DBCSSBCS_BYTE) &lt;&lt; 8;
01520                 j+=1;
01521                 <span class="keywordflow">if</span> (++k==CountOfAttr &amp;&amp; j&lt;XSize) {
01522                     Attr++;
01523                     k=0;
01524                     CountOfAttr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a>;
01525                 }
01526             }
01527         }
01528         <span class="keywordflow">else</span>{
01529 <span class="preprocessor">#endif</span>
01530 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (j=0;j&lt;XSize;TargetPtr++) {
01531             TargetPtr-&gt;Char.UnicodeChar = *Char++;
01532             TargetPtr-&gt;Attributes = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a>;
01533             j+=1;
01534             <span class="keywordflow">if</span> (++k==CountOfAttr &amp;&amp; j&lt;XSize) {
01535                 Attr++;
01536                 k=0;
01537                 CountOfAttr = Attr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a>;
01538             }
01539         }
01540 <span class="preprocessor">#if defined(FE_SB)</span>
01541 <span class="preprocessor"></span>        }
01542 <span class="preprocessor">#endif</span>
01543 <span class="preprocessor"></span>
01544         <span class="keywordflow">if</span> (++RowIndex == ScreenInfo-&gt;ScreenBufferSize.Y) {
01545             RowIndex = 0;
01546         }
01547     }
01548 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a102" doxytag="consrv.h::ReadScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReadScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadRegion</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l01623">1623</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01415">ReadRectFromScreenBuffer()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">SrvReadConsoleOutput()</a>.
<p>
<pre class="fragment"><div>01631                    :
01632 
01633     This routine reads a rectangular region from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer.
01634     The region <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> first clipped.
01635 
01636 Arguments:
01637 
01638     ScreenInformation - Screen buffer to read from.
01639 
01640     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> to read into.
01641 
01642     ReadRegion - Region to read.
01643 
01644 Return Value:
01645 
01646 
01647 --*/
01648 
01649 {
01650     COORD TargetSize;
01651     COORD TargetPoint,SourcePoint;
01652     SMALL_RECT Target;
01653 
01654     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"ReadScreenBuffer\n"</span>));
01655     <span class="comment">//</span>
01656     <span class="comment">// calculate dimensions of caller's buffer.  have to do this calculation</span>
01657     <span class="comment">// before clipping.</span>
01658     <span class="comment">//</span>
01659 
01660     TargetSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ReadRegion-&gt;Right - ReadRegion-&gt;Left + 1);
01661     TargetSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ReadRegion-&gt;Bottom - ReadRegion-&gt;Top + 1);
01662 
01663     <span class="keywordflow">if</span> (TargetSize.X &lt;= 0 || TargetSize.Y &lt;= 0) {
01664         <span class="keywordflow">return</span> STATUS_SUCCESS;
01665     }
01666 
01667     <span class="comment">// do clipping.</span>
01668 
01669     <span class="keywordflow">if</span> (ReadRegion-&gt;Right &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInformation-&gt;ScreenBufferSize.X-1)) {
01670         ReadRegion-&gt;Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInformation-&gt;ScreenBufferSize.X-1);
01671     }
01672     <span class="keywordflow">if</span> (ReadRegion-&gt;Bottom &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInformation-&gt;ScreenBufferSize.Y-1)) {
01673         ReadRegion-&gt;Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInformation-&gt;ScreenBufferSize.Y-1);
01674     }
01675     <span class="keywordflow">if</span> (ReadRegion-&gt;Left &lt; 0) {
01676         TargetPoint.X = -ReadRegion-&gt;Left;
01677         ReadRegion-&gt;Left = 0;
01678     }
01679     <span class="keywordflow">else</span> {
01680         TargetPoint.X = 0;
01681     }
01682     <span class="keywordflow">if</span> (ReadRegion-&gt;Top &lt; 0) {
01683         TargetPoint.Y = -ReadRegion-&gt;Top;
01684         ReadRegion-&gt;Top = 0;
01685     }
01686     <span class="keywordflow">else</span> {
01687         TargetPoint.Y = 0;
01688     }
01689 
01690     SourcePoint.X = ReadRegion-&gt;Left;
01691     SourcePoint.Y = ReadRegion-&gt;Top;
01692     Target.Left = TargetPoint.X;
01693     Target.Top = TargetPoint.Y;
01694     Target.Right = TargetPoint.X + (ReadRegion-&gt;Right - ReadRegion-&gt;Left);
01695     Target.Bottom = TargetPoint.Y + (ReadRegion-&gt;Bottom - ReadRegion-&gt;Top);
01696     <a class="code" href="../../d6/d2/output_8c.html#a50">ReadRectFromScreenBuffer</a>(ScreenInformation,
01697                              SourcePoint,
01698                              Buffer,
01699                              TargetSize,
01700                              &amp;Target
01701                             );
01702     <span class="keywordflow">return</span> STATUS_SUCCESS;
01703 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a178" doxytag="consrv.h::RealUnicodeToFalseUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RealUnicodeToFalseUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">1573</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00369">RtlMultiByteToUnicodeN()</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01093">SB_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>.
<p>
<pre class="fragment"><div>01588 {
01589     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01590     LPSTR Temp;
01591     ULONG TempLength;
01592     ULONG Length;
01593     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01594     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> NormalChars;
01595     <span class="keywordtype">int</span> i;
01596 
01597     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"RealUnicodeToFalseUnicode U-&gt;%d:ACP-&gt;U %.*ls\n"</span>, Codepage,
01598             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01599 <span class="preprocessor">#if defined(FE_SB)</span>
01600 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a> &amp;&amp; Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>)
01601         <span class="keywordflow">return</span> STATUS_SUCCESS;
01602     <span class="keywordflow">if</span> (SourceLength == 0 )
01603         <span class="keywordflow">return</span> STATUS_SUCCESS;
01604 <span class="preprocessor">#endif</span>
01605 <span class="preprocessor"></span>    NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01606     <span class="keywordflow">for</span> (i=0;i&lt;SourceLength;i++) {
01607         <span class="keywordflow">if</span> (Source[i] &gt; 0x7f) {
01608             NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01609             <span class="keywordflow">break</span>;
01610         }
01611     }
01612     <span class="keywordflow">if</span> (NormalChars) {
01613         <span class="keywordflow">return</span> STATUS_SUCCESS;
01614     }
01615     TempLength = SourceLength;
01616     <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01617         Temp = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TempLength);
01618         <span class="keywordflow">if</span> (Temp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01619             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01620         }
01621     } <span class="keywordflow">else</span> {
01622         Temp = StackBuffer;
01623     }
01624     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01625         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(Temp,
01626                                   TempLength,
01627                                   &amp;Length,
01628                                   Source,
01629                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01630                                  );
01631     } <span class="keywordflow">else</span> {
01632         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = WideCharToMultiByte(Codepage,
01633                                    0,
01634                                    Source,
01635                                    SourceLength,
01636                                    Temp,
01637                                    TempLength,
01638                                    NULL,
01639                                    NULL);
01640     }
01641     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01642         <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01643             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01644         }
01645         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01646     }
01647 
01648     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
01649         MultiByteToWideChar(USACP,
01650                         0,
01651                         Temp,
01652                         TempLength,
01653                         Source,
01654                         SourceLength
01655                        );
01656     } <span class="keywordflow">else</span> {
01657         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a33">RtlMultiByteToUnicodeN</a>(Source,
01658                            SourceLength * <span class="keyword">sizeof</span>(WCHAR),
01659                            &amp;Length,
01660                            Temp,
01661                            TempLength
01662                           );
01663     }
01664 
01665     <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01666         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01667     }
01668     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01669         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01670     } <span class="keywordflow">else</span> {
01671         <span class="keywordflow">return</span> STATUS_SUCCESS;
01672     }
01673 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a140" doxytag="consrv.h::ReinitializeInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReinitializeInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InputBufferInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00184">184</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00126">NtClearEvent()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>.
<p>
<pre class="fragment"><div>00190                    :
00191 
00192     This routine resets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer information fields to their
00193     initial values.
00194 
00195 Arguments:
00196 
00197     InputBufferInformation - Pointer to input buffer information structure.
00198 
00199 Return Value:
00200 
00201 Note:
00202 
00203     The console lock must be held when calling <span class="keyword">this</span> routine.
00204 
00205 --*/
00206 
00207 {
00208     <a class="code" href="../../d0/d8/ex_2event_8c.html#a4">NtClearEvent</a>(InputBufferInformation-&gt;InputWaitEvent);
00209     InputBufferInformation-&gt;ShareAccess.OpenCount = 0;
00210     InputBufferInformation-&gt;ShareAccess.Readers = 0;
00211     InputBufferInformation-&gt;ShareAccess.Writers = 0;
00212     InputBufferInformation-&gt;ShareAccess.SharedRead = 0;
00213     InputBufferInformation-&gt;ShareAccess.SharedWrite = 0;
00214     InputBufferInformation-&gt;InputMode = ENABLE_LINE_INPUT | ENABLE_PROCESSED_INPUT  | ENABLE_ECHO_INPUT | ENABLE_MOUSE_INPUT;
00215     InputBufferInformation-&gt;In = (ULONG_PTR) InputBufferInformation-&gt;InputBuffer;
00216     InputBufferInformation-&gt;Out = (ULONG_PTR) InputBufferInformation-&gt;InputBuffer;
00217     <span class="keywordflow">return</span> STATUS_SUCCESS;
00218 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a266" doxytag="consrv.h::RemoveConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoveConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">1355</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00295">CONSOLE_FREE_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00099">CONSOLE_FULLSCREEN_NOPAINT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00092">CONSOLE_NOTIFY_LAST_CLOSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00221">_CONSOLE_INFORMATION::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03502">CreateCtrlThread()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00458">_CONSOLE_PROCESS_TERMINATION_RECORD::CtrlRoutine</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00033">CtrlRoutine</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04605">FreeCommandHistory()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01110">FreeCon()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01280">FreeProcessData()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00231">_CONSOLE_INFORMATION::hProcessLastNotifyClose</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00455">_CONSOLE_PROCESS_TERMINATION_RECORD::ProcessHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00232">_CONSOLE_INFORMATION::ProcessIdLastNotifyClose</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00130">_CONSOLE_INFORMATION::RefCount</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00932">RemoveProcessFromList()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00456">_CONSOLE_PROCESS_TERMINATION_RECORD::TerminateCount</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00980">UnregisterVDM()</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00196">_CONSOLE_INFORMATION::VDMProcessId</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01482">ConsoleClientDisconnectRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01608">SrvFreeConsole()</a>, and <a class="el" href="../../d1/d4/ntcon_2conime_2conime_8c-source.html#l00288">WndProc()</a>.
<p>
<pre class="fragment"><div>01360 {
01361     ULONG i;
01362     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01363     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01364     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01365 
01366     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(ProcessData-&gt;ConsoleHandle, &amp;Console);
01367 
01368     <span class="comment">//</span>
01369     <span class="comment">// If this process isn't using the console, error.</span>
01370     <span class="comment">//</span>
01371 
01372     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01373         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
01374         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01375     }
01376 
01377     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a7">CONSOLE_NOTIFY_LAST_CLOSE</a>) {
01378         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o73">ProcessIdLastNotifyClose</a> == ProcessId) {
01379             <span class="comment">// if this process is the one who wants last close notification,</span>
01380             <span class="comment">// remove it.</span>
01381             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a7">CONSOLE_NOTIFY_LAST_CLOSE</a>;
01382             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o72">hProcessLastNotifyClose</a>);
01383         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ProcessData-&gt;RootProcess) {
01384             <span class="comment">// notify the ntvdm process to terminate if the console root</span>
01385             <span class="comment">// process is going away.</span>
01386             HANDLE ConsoleHandle;
01387             <a class="code" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html">CONSOLE_PROCESS_TERMINATION_RECORD</a> ProcessHandleList;
01388 
01389             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a7">CONSOLE_NOTIFY_LAST_CLOSE</a>;
01390             ConsoleHandle = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o65">ConsoleHandle</a>;
01391             ProcessHandleList.<a class="code" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html#o0">ProcessHandle</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o72">hProcessLastNotifyClose</a>;
01392             ProcessHandleList.<a class="code" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html#o1">TerminateCount</a> = 0;
01393             ProcessHandleList.<a class="code" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html#o3">CtrlRoutine</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a10">CtrlRoutine</a>;
01394             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01395             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a52">CreateCtrlThread</a>(&amp;ProcessHandleList,
01396                             1,
01397                             NULL,
01398                             SYSTEM_ROOT_CONSOLE_EVENT,
01399                             TRUE);
01400             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ProcessHandleList.<a class="code" href="../../d2/d4/struct__CONSOLE__PROCESS__TERMINATION__RECORD.html#o0">ProcessHandle</a>);
01401             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(ConsoleHandle, &amp;Console);
01402             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01403             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01404                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01405             }
01406         }
01407     }
01408 
01409     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a> == ProcessId &amp;&amp;
01410         (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) {
01411         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a14">CONSOLE_FULLSCREEN_NOPAINT</a>;
01412         <a class="code" href="../../d0/d5/srvinit_8c.html#a22">UnregisterVDM</a>(Console);
01413     }
01414 
01415     <span class="keywordflow">if</span> (ProcessHandle != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01416         <a class="code" href="../../d0/d5/srvinit_8c.html#a35">RemoveProcessFromList</a>(Console,ProcessHandle);
01417         <a class="code" href="../../d8/d5/consrv_8h.html#a259">FreeCommandHistory</a>(Console,ProcessHandle);
01418     }
01419 
01420     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o1">RefCount</a>);
01421 
01422     <span class="comment">//</span>
01423     <span class="comment">// close the process's handles.</span>
01424     <span class="comment">//</span>
01425 
01426     <span class="keywordflow">for</span> (i=0;i&lt;ProcessData-&gt;HandleTableSize;i++) {
01427         <span class="keywordflow">if</span> (ProcessData-&gt;HandleTablePtr[i].HandleType != <a class="code" href="../../d1/d7/server_8h.html#a47">CONSOLE_FREE_HANDLE</a>) {
01428             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
01429                                                 (HANDLE) i,
01430                                                 &amp;HandleData
01431                                                );
01432             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01433             <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
01434                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a35">CloseInputHandle</a>(ProcessData,Console,HandleData,(HANDLE) i);
01435             }
01436             <span class="keywordflow">else</span> {
01437                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a36">CloseOutputHandle</a>(ProcessData,Console,HandleData,(HANDLE) i,FALSE);
01438             }
01439         }
01440     }
01441     <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a25">FreeProcessData</a>(ProcessData);
01442     ProcessData-&gt;ConsoleHandle = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01443 
01444     <span class="comment">//</span>
01445     <span class="comment">// decrement the console reference count.  free the console if it goes to</span>
01446     <span class="comment">// zero.</span>
01447     <span class="comment">//</span>
01448 
01449     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o1">RefCount</a>--;
01450     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o1">RefCount</a> == 0) {
01451 
01452 <span class="preprocessor">#if defined(FE_IME)</span>
01453 <span class="preprocessor"></span>
01454         PCONVERSIONAREA_INFORMATION ConvAreaInfo;
01455         PCONVERSIONAREA_INFORMATION ConvAreaInfoNext;
01456 
01457         ConvAreaInfo = Console-&gt;ConsoleIme.ConvAreaRoot;
01458         <span class="keywordflow">while</span>(ConvAreaInfo) {
01459             ConvAreaInfoNext = ConvAreaInfo-&gt;ConvAreaNext;
01460             FreeConvAreaScreenBuffer(ConvAreaInfo-&gt;ScreenBuffer);
01461             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ConvAreaInfo);
01462             ConvAreaInfo = ConvAreaInfoNext;
01463         }
01464 
01465         <span class="keywordflow">if</span> (Console-&gt;ConsoleIme.NumberOfConvAreaCompStr) {
01466             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;ConsoleIme.ConvAreaCompStr);
01467         }
01468         <span class="keywordflow">if</span> (Console-&gt;ConsoleIme.CompStrData) {
01469             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;ConsoleIme.CompStrData);
01470         }
01471 <span class="preprocessor">#endif</span>
01472 <span class="preprocessor"></span>        <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a21">FreeCon</a>(Console);
01473     }
01474     <span class="keywordflow">else</span> {
01475         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01476     }
01477     <span class="keywordflow">return</span>( STATUS_SUCCESS );
01478 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="consrv.h::RemoveScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RemoveScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01187">1187</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00177">_SCREEN_INFORMATION::Next</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>.
<p>
<pre class="fragment"><div>01194                    :
01195 
01196     This routine removes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer pointer from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console's
01197     list of screen buffers.
01198 
01199 Arguments:
01200 
01201     Console - Pointer to console information structure.
01202 
01203     ScreenInfo - Pointer to screen information structure.
01204 
01205 Return Value:
01206 
01207 Note:
01208 
01209     The console lock must be held when calling <span class="keyword">this</span> routine.
01210 
01211 --*/
01212 
01213 {
01214     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> Prev,Cur;
01215 
01216     <span class="keywordflow">if</span> (ScreenInfo == Console-&gt;ScreenBuffers) {
01217         Console-&gt;ScreenBuffers = ScreenInfo-&gt;Next;
01218         <span class="keywordflow">return</span>;
01219     }
01220     Prev = Cur = Console-&gt;ScreenBuffers;
01221     <span class="keywordflow">while</span> (Cur != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01222         <span class="keywordflow">if</span> (ScreenInfo == Cur)
01223             <span class="keywordflow">break</span>;
01224         Prev = Cur;
01225         Cur = Cur-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o23">Next</a>;
01226     }
01227     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Cur != NULL);
01228     <span class="keywordflow">if</span> (Cur != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01229         Prev-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o23">Next</a> = Cur-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o23">Next</a>;
01230     }
01231 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a164" doxytag="consrv.h::RemoveTextBufferFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoveTextBufferFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00952">952</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00096">_TEXT_BUFFER_FONT_INFO::NextTextBufferFont</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00958                    :
00959 
00960     This routine all remove a font information in ListOfTextBufferFont.
00961 
00962 Arguments:
00963 
00964 Return Value:
00965 
00966 --*/
00967 
00968 {
00969     <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> CurrentFont;
00970 
00971     CurrentFont = ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont;
00972 
00973     <span class="keywordflow">while</span> (CurrentFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00974         <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> NextFont;
00975 
00976         NextFont = CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
00977         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CurrentFont);
00978 
00979         CurrentFont = NextFont;
00980     }
00981 
00982     ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00983 
00984     <span class="keywordflow">return</span> STATUS_SUCCESS;
00985 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a255" doxytag="consrv.h::ResetCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ResetCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CommandHistory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04726">4726</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>.
<p>
<pre class="fragment"><div>04735 {
04736     <span class="keywordflow">if</span> (CommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04737         <span class="keywordflow">return</span>;
04738     }
04739     CommandHistory-&gt;LastDisplayed = CommandHistory-&gt;LastAdded;
04740     CommandHistory-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
04741 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a261" doxytag="consrv.h::ResizeCommandHistoryBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ResizeCommandHistoryBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>NumCommands</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04665">4665</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00099">_COOKED_READ_DATA::CommandHistory</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>.
<p>
<pre class="fragment"><div>04669 {
04670     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04671     PLIST_ENTRY ListHead, ListNext;
04672 <span class="preprocessor">#if defined(FE_SB)</span>
04673 <span class="preprocessor"></span>    <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData;
04674     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> NewHistory;
04675 <span class="preprocessor">#endif</span>
04676 <span class="preprocessor"></span>
04677     Console-&gt;CommandHistorySize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)NumCommands;
04678 
04679     ListHead = &amp;Console-&gt;CommandHistoryList;
04680     ListNext = ListHead-&gt;Flink;
04681     <span class="keywordflow">while</span> (ListNext != ListHead) {
04682         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
04683         ListNext = ListNext-&gt;Flink;
04684 
04685 <span class="preprocessor">#if defined(FE_SB)</span>
04686 <span class="preprocessor"></span>        NewHistory = <a class="code" href="../../d4/d1/cmdline_8h.html#a44">ReallocCommandHistory</a>(Console, History, NumCommands);
04687         CookedReadData = Console-&gt;lpCookedReadData;
04688         <span class="keywordflow">if</span> (CookedReadData &amp;&amp; CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a> == <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>) {
04689             CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a> = NewHistory;
04690         }
04691 <span class="preprocessor">#else</span>
04692 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>)) {
04693             <a class="code" href="../../d4/d1/cmdline_8h.html#a44">ReallocCommandHistory</a>(Console, History, NumCommands);
04694          }
04695 <span class="preprocessor">#endif</span>
04696 <span class="preprocessor"></span>    }
04697 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a115" doxytag="consrv.h::ResizeScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ResizeScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>NewScreenSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>DoScrollBarUpdate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l02231">2231</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00053">_ATTR_PAIR::Attr</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00060">_ATTR_ROW::AttrPair</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00068">_ROW::AttrRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00061">_ATTR_ROW::Attrs</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d4/conime_8h-source.html#l00076">CONIME_NOTIFY_SCREENBUFFERSIZE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00150">CONSOLE_IS_IME_ENABLED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00183">ConsoleHeapReAlloc</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05870">CreateDbcsScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05926">DeleteDbcsScreenBuffer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01072">FindAttrIndex()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00223">INVALID_OLD_LENGTH</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00059">_ATTR_ROW::Length</a>, <a class="el" href="../../d9/d1/tmerge_8c-source.html#l00012">_ATTR_PAIR::Length</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01342">ResetTextFlags()</a>, <a class="el" href="../../d7/d2/output_8h.html#a27">ROW</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00073">SCREEN_TAG</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02214">ScreenBufferSizeChange()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03953">SetWindowSize()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02162">UpdateScrollBars()</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l03608">UpdateWindow()</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00608">SrvSetConsoleScreenBufferSize()</a>.
<p>
<pre class="fragment"><div>02239                    :
02240 
02241     This routine resizes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer.
02242 
02243 Arguments:
02244 
02245     ScreenInfo - pointer to screen buffer info.
02246 
02247     NewScreenSize - <span class="keyword">new</span> size of screen.
02248 
02249 Return Value:
02250 
02251 --*/
02252 
02253 {
02254     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
02255     BOOLEAN WindowMaximizedX,WindowMaximizedY;
02256     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> LimitX,LimitY;
02257     PWCHAR TextRows,TextRowPtr;
02258     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a>;
02259     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> TopRow,TopRowIndex; <span class="comment">// new top row of screen buffer</span>
02260     COORD CursorPosition;
02261 <span class="preprocessor">#if defined(FE_SB)</span>
02262 <span class="preprocessor"></span>    DBCS_SCREEN_BUFFER NewDbcsScreenBuffer;
02263     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> TextRowPtrA;
02264 <span class="preprocessor">#endif</span>
02265 <span class="preprocessor"></span>
02266     <span class="comment">//</span>
02267     <span class="comment">// Don't allow resize of graphics apps</span>
02268     <span class="comment">//</span>
02269 
02270     <span class="keywordflow">if</span> (!(ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)) {
02271         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
02272     }
02273 
02274     TextRows = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( SCREEN_TAG ),NewScreenSize.X*NewScreenSize.Y*<span class="keyword">sizeof</span>(WCHAR));
02275     <span class="keywordflow">if</span> (TextRows == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02276         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
02277     }
02278 <span class="preprocessor">#if defined(FE_SB)</span>
02279 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (! <a class="code" href="../../d6/d2/output_8c.html#a86">CreateDbcsScreenBuffer</a>(ScreenInfo-&gt;Console,NewScreenSize,&amp;NewDbcsScreenBuffer))
02280     {
02281         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TextRows);
02282         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
02283     }
02284 <span class="preprocessor">#endif</span>
02285 <span class="preprocessor"></span>    LimitX = (NewScreenSize.X &lt; ScreenInfo-&gt;ScreenBufferSize.X) ?
02286               NewScreenSize.X : ScreenInfo-&gt;ScreenBufferSize.X;
02287     LimitY = (NewScreenSize.Y &lt; ScreenInfo-&gt;ScreenBufferSize.Y) ?
02288               NewScreenSize.Y : ScreenInfo-&gt;ScreenBufferSize.Y;
02289     TopRow = 0;
02290     <span class="keywordflow">if</span> (NewScreenSize.Y &lt;= ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y) {
02291         TopRow += ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y - NewScreenSize.Y + 1;
02292     }
02293     TopRowIndex = (ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow+TopRow) % ScreenInfo-&gt;ScreenBufferSize.Y;
02294     <span class="keywordflow">if</span> (NewScreenSize.Y != ScreenInfo-&gt;ScreenBufferSize.Y) {
02295         <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Temp;
02296         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> NumToCopy,NumToCopy2;
02297 
02298         <span class="comment">//</span>
02299         <span class="comment">// resize ROWs array.  first alloc a new ROWs array. then copy the old</span>
02300         <span class="comment">// one over, resetting the FirstRow.</span>
02301         <span class="comment">//</span>
02302         <span class="comment">//</span>
02303 
02304         Temp = (<a class="code" href="../../d9/d4/struct__ROW.html">PROW</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( SCREEN_TAG ),NewScreenSize.Y*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/struct__ROW.html">ROW</a>));
02305         <span class="keywordflow">if</span> (Temp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02306             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TextRows);
02307 <span class="preprocessor">#if defined(FE_SB)</span>
02308 <span class="preprocessor"></span>            <a class="code" href="../../d6/d2/output_8c.html#a87">DeleteDbcsScreenBuffer</a>(&amp;NewDbcsScreenBuffer);
02309 <span class="preprocessor">#endif</span>
02310 <span class="preprocessor"></span>            <span class="keywordflow">return</span> STATUS_NO_MEMORY;
02311         }
02312         NumToCopy = ScreenInfo-&gt;ScreenBufferSize.Y-TopRowIndex;
02313         <span class="keywordflow">if</span> (NumToCopy &gt; NewScreenSize.Y)
02314             NumToCopy = NewScreenSize.Y;
02315         RtlCopyMemory(Temp,&amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[TopRowIndex],NumToCopy*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/struct__ROW.html">ROW</a>));
02316         <span class="keywordflow">if</span> (TopRowIndex!=0 &amp;&amp; NumToCopy != NewScreenSize.Y) {
02317             NumToCopy2 = TopRowIndex;
02318             <span class="keywordflow">if</span> (NumToCopy2 &gt; (NewScreenSize.Y-NumToCopy))
02319                 NumToCopy2 = NewScreenSize.Y-NumToCopy;
02320             RtlCopyMemory(&amp;Temp[NumToCopy],
02321                    ScreenInfo-&gt;BufferInfo.TextInfo.Rows,
02322                    NumToCopy2*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/struct__ROW.html">ROW</a>)
02323                   );
02324         }
02325         <span class="keywordflow">for</span> (i=0;i&lt;LimitY;i++) {
02326             <span class="keywordflow">if</span> (Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a> == 1) {
02327                 Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a> = &amp;Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>;
02328             }
02329         }
02330 
02331         <span class="comment">//</span>
02332         <span class="comment">// if the new screen buffer has fewer rows than the existing one,</span>
02333         <span class="comment">// free the extra rows.  if the new screen buffer has more rows</span>
02334         <span class="comment">// than the existing one, allocate new rows.</span>
02335         <span class="comment">//</span>
02336 
02337         <span class="keywordflow">if</span> (NewScreenSize.Y &lt; ScreenInfo-&gt;ScreenBufferSize.Y) {
02338             i = (TopRowIndex+NewScreenSize.Y) % ScreenInfo-&gt;ScreenBufferSize.Y;
02339             <span class="keywordflow">for</span> (j=NewScreenSize.Y;j&lt;ScreenInfo-&gt;ScreenBufferSize.Y;j++) {
02340                 <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length &gt; 1) {
02341                     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs);
02342                 }
02343                 <span class="keywordflow">if</span> (++i == ScreenInfo-&gt;ScreenBufferSize.Y) {
02344                     i = 0;
02345                 }
02346             }
02347         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewScreenSize.Y &gt; ScreenInfo-&gt;ScreenBufferSize.Y) {
02348             <span class="keywordflow">for</span> (i=ScreenInfo-&gt;ScreenBufferSize.Y;i&lt;NewScreenSize.Y;i++) {
02349                 Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a> = 1;
02350                 Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>.<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a> = NewScreenSize.X;
02351                 Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>.<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = ScreenInfo-&gt;Attributes;
02352                 Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a> = &amp;Temp[i].<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>;
02353             }
02354         }
02355         ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow = 0;
02356         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows);
02357         ScreenInfo-&gt;BufferInfo.TextInfo.Rows = Temp;
02358     }
02359 
02360     <span class="comment">//</span>
02361     <span class="comment">// Realloc each row.  any horizontal growth results in the last</span>
02362     <span class="comment">// attribute in a row getting extended.</span>
02363     <span class="comment">//</span>
02364 <span class="preprocessor">#if defined(FE_SB)</span>
02365 <span class="preprocessor"></span>    TextRowPtrA=NewDbcsScreenBuffer.KAttrRows;
02366 <span class="preprocessor">#endif</span>
02367 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (i=0,TextRowPtr=TextRows;i&lt;LimitY;i++,TextRowPtr+=NewScreenSize.X)
02368     {
02369         RtlCopyMemory(TextRowPtr,
02370                ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Chars,
02371                LimitX*<span class="keyword">sizeof</span>(WCHAR));
02372 <span class="preprocessor">#if defined(FE_SB)</span>
02373 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (TextRowPtrA) {
02374             RtlCopyMemory(TextRowPtrA,
02375                           ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.KAttrs,
02376                           LimitX*<span class="keyword">sizeof</span>(CHAR));
02377         }
02378 <span class="preprocessor">#endif</span>
02379 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (j=ScreenInfo-&gt;ScreenBufferSize.X;j&lt;NewScreenSize.X;j++) {
02380             TextRowPtr[j] = (WCHAR)<span class="charliteral">' '</span>;
02381         }
02382 
02383         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Right &gt; NewScreenSize.X) {
02384             ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.OldRight = <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>;
02385             ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Right = NewScreenSize.X;
02386         }
02387         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Chars = TextRowPtr;
02388 <span class="preprocessor">#if defined(FE_SB)</span>
02389 <span class="preprocessor"></span>        ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.KAttrs = TextRowPtrA;
02390         <span class="keywordflow">if</span> (TextRowPtrA) {
02391             <span class="keywordflow">if</span> (NewScreenSize.X &gt; ScreenInfo-&gt;ScreenBufferSize.X)
02392                 RtlZeroMemory(TextRowPtrA+ScreenInfo-&gt;ScreenBufferSize.X,
02393                               NewScreenSize.X-ScreenInfo-&gt;ScreenBufferSize.X);
02394             TextRowPtrA+=NewScreenSize.X;
02395         }
02396 <span class="preprocessor">#endif</span>
02397 <span class="preprocessor"></span>    }
02398     <span class="keywordflow">for</span> (;i&lt;NewScreenSize.Y;i++,TextRowPtr+=NewScreenSize.X)
02399     {
02400         <span class="keywordflow">for</span> (j=0;j&lt;NewScreenSize.X;j++) {
02401             TextRowPtr[j] = (WCHAR)<span class="charliteral">' '</span>;
02402         }
02403 <span class="preprocessor">#if defined(FE_SB)</span>
02404 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (TextRowPtrA) {
02405            RtlZeroMemory(TextRowPtrA, NewScreenSize.X);
02406         }
02407 <span class="preprocessor">#endif</span>
02408 <span class="preprocessor"></span>        ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Chars = TextRowPtr;
02409         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.OldLeft = <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>;
02410         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.OldRight = <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>;
02411         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Left = NewScreenSize.X;
02412         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.Right = 0;
02413 <span class="preprocessor">#if defined(FE_SB)</span>
02414 <span class="preprocessor"></span>        ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].CharRow.KAttrs = TextRowPtrA;
02415         <span class="keywordflow">if</span> (TextRowPtrA) {
02416             TextRowPtrA+=NewScreenSize.X;
02417         }
02418 <span class="preprocessor">#endif</span>
02419 <span class="preprocessor"></span>    }
02420     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.TextRows);
02421     ScreenInfo-&gt;BufferInfo.TextInfo.TextRows = TextRows;
02422 <span class="preprocessor">#if defined(FE_SB)</span>
02423 <span class="preprocessor"></span>    <a class="code" href="../../d6/d2/output_8c.html#a87">DeleteDbcsScreenBuffer</a>(&amp;ScreenInfo-&gt;BufferInfo.TextInfo.DbcsScreenBuffer);
02424     ScreenInfo-&gt;BufferInfo.TextInfo.DbcsScreenBuffer = NewDbcsScreenBuffer;
02425 <span class="preprocessor">#endif</span>
02426 <span class="preprocessor"></span>
02427     <span class="keywordflow">if</span> (NewScreenSize.X != ScreenInfo-&gt;ScreenBufferSize.X) {
02428         <span class="keywordflow">for</span> (i=0;i&lt;LimitY;i++) {
02429             <a class="code" href="../../d3/d2/struct__ATTR__PAIR.html">PATTR_PAIR</a> IndexedAttr;
02430             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CountOfAttr;
02431 
02432             <span class="keywordflow">if</span> (NewScreenSize.X &gt; ScreenInfo-&gt;ScreenBufferSize.X) {
02433                 <a class="code" href="../../d6/d2/output_8c.html#a47">FindAttrIndex</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs,
02434                               (SHORT)(ScreenInfo-&gt;ScreenBufferSize.X-1),
02435                               &amp;IndexedAttr,
02436                               &amp;CountOfAttr
02437                              );
02438   <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (IndexedAttr &lt;=
02439     &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs[ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length-1]);
02440                 IndexedAttr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a> += NewScreenSize.X - ScreenInfo-&gt;ScreenBufferSize.X;
02441             }
02442             <span class="keywordflow">else</span> {
02443 
02444                 <a class="code" href="../../d6/d2/output_8c.html#a47">FindAttrIndex</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs,
02445                               (SHORT)(NewScreenSize.X-1),
02446                               &amp;IndexedAttr,
02447                               &amp;CountOfAttr
02448                              );
02449                 IndexedAttr-&gt;<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a> -= CountOfAttr-1;
02450                 <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length != 1)  {
02451                     ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(IndexedAttr - ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs + 1);
02452                     <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length != 1) {
02453                         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs = (<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html">PATTR_PAIR</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a37">ConsoleHeapReAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( SCREEN_TAG ),ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs,
02454                                                                          ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Length * <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html">ATTR_PAIR</a>));
02455                     }
02456                     <span class="keywordflow">else</span> {
02457                         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.AttrPair = *IndexedAttr;
02458                         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs);
02459                         ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.Attrs = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i].AttrRow.AttrPair;
02460                     }
02461                 }
02462             }
02463         }
02464     }
02465 
02466     <span class="comment">//</span>
02467     <span class="comment">// if the screen buffer is resized smaller than the saved</span>
02468     <span class="comment">// window size, shrink the saved window size.</span>
02469     <span class="comment">//</span>
02470 <span class="preprocessor">#ifdef i386</span>
02471 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
02472         <span class="keywordflow">if</span> (NewScreenSize.X &lt; ScreenInfo-&gt;BufferInfo.TextInfo.WindowedWindowSize.X) {
02473             ScreenInfo-&gt;BufferInfo.TextInfo.WindowedWindowSize.X = NewScreenSize.X;
02474         }
02475         <span class="keywordflow">if</span> (NewScreenSize.Y &lt; ScreenInfo-&gt;BufferInfo.TextInfo.WindowedWindowSize.Y) {
02476             ScreenInfo-&gt;BufferInfo.TextInfo.WindowedWindowSize.Y = NewScreenSize.Y;
02477         }
02478         ScreenInfo-&gt;BufferInfo.TextInfo.WindowedScreenSize = NewScreenSize;
02479     }
02480 <span class="preprocessor">#endif</span>
02481 <span class="preprocessor"></span>
02482     <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02483 
02484     <span class="comment">//</span>
02485     <span class="comment">// if the screen buffer shrunk beyond the boundaries of the window,</span>
02486     <span class="comment">// adjust the window origin.</span>
02487     <span class="comment">//</span>
02488 
02489     <span class="keywordflow">if</span> (NewScreenSize.X &gt; <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)) {
02490         <span class="keywordflow">if</span> (ScreenInfo-&gt;Window.Right &gt;= NewScreenSize.X) {
02491             ScreenInfo-&gt;Window.Left -= ScreenInfo-&gt;Window.Right - NewScreenSize.X + 1;
02492             ScreenInfo-&gt;Window.Right -= ScreenInfo-&gt;Window.Right - NewScreenSize.X + 1;
02493             <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02494         }
02495     } <span class="keywordflow">else</span> {
02496         ScreenInfo-&gt;Window.Left = 0;
02497         ScreenInfo-&gt;Window.Right = NewScreenSize.X - 1;
02498         <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02499     }
02500     <span class="keywordflow">if</span> (NewScreenSize.Y &gt; <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)) {
02501         <span class="keywordflow">if</span> (ScreenInfo-&gt;Window.Bottom &gt;= NewScreenSize.Y) {
02502             ScreenInfo-&gt;Window.Top -= ScreenInfo-&gt;Window.Bottom - NewScreenSize.Y + 1;
02503             ScreenInfo-&gt;Window.Bottom -= ScreenInfo-&gt;Window.Bottom - NewScreenSize.Y + 1;
02504             <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02505         }
02506     } <span class="keywordflow">else</span> {
02507         ScreenInfo-&gt;Window.Top = 0;
02508         ScreenInfo-&gt;Window.Bottom = NewScreenSize.Y - 1;
02509         <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02510     }
02511 
02512 <span class="preprocessor">#if defined(FE_SB)</span>
02513 <span class="preprocessor"></span>    <span class="comment">// Should be sets ScreenBufferSize before calls SetCursorPosition</span>
02514     <span class="comment">// because SetCursorPosition refer ScreenBufferSize.</span>
02515     <span class="comment">// Also, FE version refer in InvertPixels.</span>
02516     <span class="comment">//</span>
02517     <span class="comment">// kkntbug:11311</span>
02518     ScreenInfo-&gt;ScreenBufferSize = NewScreenSize;
02519 <span class="preprocessor">#endif</span>
02520 <span class="preprocessor"></span>
02521     <span class="comment">//</span>
02522     <span class="comment">// adjust cursor position if it's no longer with screen buffer</span>
02523     <span class="comment">//</span>
02524 
02525     CursorPosition=ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
02526     <span class="keywordflow">if</span> (CursorPosition.X &gt;= NewScreenSize.X) {
02527         <span class="keywordflow">if</span> (ScreenInfo-&gt;OutputMode &amp; ENABLE_WRAP_AT_EOL_OUTPUT) {
02528             CursorPosition.X = 0;
02529             CursorPosition.Y += 1;
02530         } <span class="keywordflow">else</span> {
02531             CursorPosition.X = NewScreenSize.X-1;
02532         }
02533     }
02534     <span class="keywordflow">if</span> (CursorPosition.Y &gt;= NewScreenSize.Y) {
02535         CursorPosition.Y = NewScreenSize.Y-1;
02536     }
02537 <span class="preprocessor">#if defined(FE_SB)</span>
02538 <span class="preprocessor"></span>    <span class="comment">// set cursor position Y is ZERO when expand screen buffer with IME open mode</span>
02539     <span class="comment">// from screen buffer is one line mode.</span>
02540     <span class="comment">// Because, One line screen buffer mode and IME open mode is set -1 as cursor position Y.</span>
02541     <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;InputBuffer.ImeMode.Open &amp;&amp; CursorPosition.Y &lt; 0) {
02542         CursorPosition.Y = 0;
02543     }
02544 <span class="preprocessor">#endif</span>
02545 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CursorPosition.X != ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.X ||
02546         CursorPosition.Y != ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y) {
02547         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(ScreenInfo,
02548                           CursorPosition,
02549                           FALSE
02550                           );
02551     }
02552 
02553     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;Window.Left &gt;= 0);
02554     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;Window.Right &lt; NewScreenSize.X);
02555     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;Window.Top &gt;= 0);
02556     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;Window.Bottom &lt; NewScreenSize.Y);
02557 
02558     ScreenInfo-&gt;ScreenBufferSize = NewScreenSize;
02559     <a class="code" href="../../d6/d2/output_8c.html#a49">ResetTextFlags</a>(ScreenInfo,0,(SHORT)(ScreenInfo-&gt;ScreenBufferSize.Y-1));
02560     WindowMaximizedX = (<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) ==
02561                           ScreenInfo-&gt;ScreenBufferSize.X);
02562     WindowMaximizedY = (<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) ==
02563                           ScreenInfo-&gt;ScreenBufferSize.Y);
02564 
02565 <span class="preprocessor">#if defined(FE_IME)</span>
02566 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a33">CONSOLE_IS_IME_ENABLED</a>()) {
02567         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeMessagePump(ScreenInfo-&gt;Console,
02568                               CONIME_NOTIFY_SCREENBUFFERSIZE,
02569                               (WPARAM)ScreenInfo-&gt;Console-&gt;ConsoleHandle,
02570                               (LPARAM)MAKELPARAM(NewScreenSize.X, NewScreenSize.Y)
02571                              ))) {
02572             <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
02573         }
02574     }
02575 
02576     <span class="keywordflow">if</span> ( (! ScreenInfo-&gt;ConvScreenInfo) &amp;&amp;
02577          (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console)))
02578     {
02579         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeResizeModeSystemScreenBuffer(ScreenInfo-&gt;Console,NewScreenSize)) ||
02580                 !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(ConsoleImeResizeCompStrScreenBuffer(ScreenInfo-&gt;Console,NewScreenSize))) {
02581             <span class="comment">/*</span>
02582 <span class="comment">             * If something went wrong, just bail out.</span>
02583 <span class="comment">             */</span>
02584             <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
02585         }
02586     }
02587 <span class="preprocessor">#endif // FE_IME</span>
02588 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ScreenInfo-&gt;WindowMaximizedX != WindowMaximizedX ||
02589         ScreenInfo-&gt;WindowMaximizedY != WindowMaximizedY) {
02590         ScreenInfo-&gt;WindowMaximizedX = WindowMaximizedX;
02591         ScreenInfo-&gt;WindowMaximizedY = WindowMaximizedY;
02592         <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02593     }
02594     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a>) {
02595         <a class="code" href="../../d6/d2/output_8c.html#a68">SetWindowSize</a>(ScreenInfo);
02596     }
02597 
02598     <span class="keywordflow">if</span> (DoScrollBarUpdate) {
02599          <a class="code" href="../../d6/d2/output_8c.html#a56">UpdateScrollBars</a>(ScreenInfo);
02600     }
02601     <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;InputBuffer.InputMode &amp; ENABLE_WINDOW_INPUT) {
02602         <a class="code" href="../../d6/d2/output_8c.html#a57">ScreenBufferSizeChange</a>(ScreenInfo,ScreenInfo-&gt;ScreenBufferSize);
02603     }
02604 
02605     <span class="keywordflow">return</span> STATUS_SUCCESS;
02606 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a114" doxytag="consrv.h::ResizeWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ResizeWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>WindowDimensions</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>DoScrollBarUpdate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l03858">3858</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l02162">UpdateScrollBars()</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">SrvSetConsoleWindowInfo()</a>.
<p>
<pre class="fragment"><div>03866                    :
03867 
03868     This routine changes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console data structures to reflect <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
03869     window size change.  <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> does not call <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user component to update
03870     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen.
03871 
03872 Arguments:
03873 
03874     ScreenInformation - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> screen buffer.
03875 
03876     dwWindowSize - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial size of screen buffer's window.
03877 
03878     nFont - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial font to generate <a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a> with.
03879 
03880     dwScreenBufferSize - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer.
03881 
03882 Return Value:
03883 
03884 
03885 --*/
03886 
03887 {
03888     <span class="comment">//</span>
03889     <span class="comment">// make sure there's something to do</span>
03890     <span class="comment">//</span>
03891 
03892     <span class="keywordflow">if</span> (RtlEqualMemory(&amp;ScreenInfo-&gt;Window, WindowDimensions, <span class="keyword">sizeof</span>(SMALL_RECT))) {
03893         <span class="keywordflow">return</span> STATUS_SUCCESS;
03894     }
03895 
03896     <span class="keywordflow">if</span> (WindowDimensions-&gt;Left &lt; 0) {
03897         WindowDimensions-&gt;Right -= WindowDimensions-&gt;Left;
03898         WindowDimensions-&gt;Left = 0;
03899     }
03900     <span class="keywordflow">if</span> (WindowDimensions-&gt;Top &lt; 0) {
03901         WindowDimensions-&gt;Bottom -= WindowDimensions-&gt;Top;
03902         WindowDimensions-&gt;Top = 0;
03903     }
03904 
03905     <span class="keywordflow">if</span> (WindowDimensions-&gt;Right &gt;= ScreenInfo-&gt;ScreenBufferSize.X) {
03906         WindowDimensions-&gt;Right = ScreenInfo-&gt;ScreenBufferSize.X;
03907     }
03908     <span class="keywordflow">if</span> (WindowDimensions-&gt;Bottom &gt;= ScreenInfo-&gt;ScreenBufferSize.Y) {
03909         WindowDimensions-&gt;Bottom = ScreenInfo-&gt;ScreenBufferSize.Y;
03910     }
03911 
03912     ScreenInfo-&gt;Window = *WindowDimensions;
03913     ScreenInfo-&gt;WindowMaximizedX = (<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) == ScreenInfo-&gt;ScreenBufferSize.X);
03914     ScreenInfo-&gt;WindowMaximizedY = (<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) == ScreenInfo-&gt;ScreenBufferSize.Y);
03915 
03916     <span class="keywordflow">if</span> (DoScrollBarUpdate) {
03917         <a class="code" href="../../d6/d2/output_8c.html#a56">UpdateScrollBars</a>(ScreenInfo);
03918     }
03919 
03920     <span class="keywordflow">if</span> (!(ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)) {
03921         <span class="keywordflow">return</span> STATUS_SUCCESS;
03922     }
03923 
03924     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
03925         ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
03926     }
03927 
03928 <span class="preprocessor">#ifdef i386</span>
03929 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
03930 
03931         <span class="comment">//</span>
03932         <span class="comment">// keep mouse pointer on screen</span>
03933         <span class="comment">//</span>
03934 
03935         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.X &lt; WindowDimensions-&gt;Left) {
03936             ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.X = WindowDimensions-&gt;Left;
03937         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.X &gt; WindowDimensions-&gt;Right) {
03938             ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.X = WindowDimensions-&gt;Right;
03939         }
03940 
03941         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.Y &lt; WindowDimensions-&gt;Top) {
03942             ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.Y = WindowDimensions-&gt;Top;
03943         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.Y &gt; WindowDimensions-&gt;Bottom) {
03944             ScreenInfo-&gt;BufferInfo.TextInfo.MousePosition.Y = WindowDimensions-&gt;Bottom;
03945         }
03946     }
03947 <span class="preprocessor">#endif</span>
03948 <span class="preprocessor"></span>
03949     <span class="keywordflow">return</span>(STATUS_SUCCESS);
03950 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a253" doxytag="consrv.h::RetrieveCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RetrieveCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualKeyCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BufferSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04834">4834</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00130">COMMAND_IND_NEXT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00122">COMMAND_IND_PREV</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02111">RetrieveNthCommand()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>04841 {
04842 
04843     <span class="keywordflow">if</span> (CommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04844         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
04845     }
04846     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CommandHistory-&gt;Flags &amp; CLE_ALLOCATED);
04847     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0) {
04848         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
04849     }
04850     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 1) {
04851         CommandHistory-&gt;LastDisplayed = 0;
04852     }
04853     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VirtualKeyCode == VK_UP) {
04854 
04855         <span class="comment">//</span>
04856         <span class="comment">// if this is the first time for this read that a command has</span>
04857         <span class="comment">// been retrieved, return the current command.  otherwise, return</span>
04858         <span class="comment">// the previous command.</span>
04859         <span class="comment">//</span>
04860 
04861         <span class="keywordflow">if</span> (CommandHistory-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>) {
04862             CommandHistory-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
04863         } <span class="keywordflow">else</span> {
04864             <a class="code" href="../../d4/d1/cmdline_8h.html#a10">COMMAND_IND_PREV</a>(CommandHistory-&gt;LastDisplayed, CommandHistory);
04865         }
04866     }
04867     <span class="keywordflow">else</span> {
04868         <a class="code" href="../../d4/d1/cmdline_8h.html#a11">COMMAND_IND_NEXT</a>(CommandHistory-&gt;LastDisplayed, CommandHistory);
04869     }
04870     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a50">RetrieveNthCommand</a>(CommandHistory,
04871                               CommandHistory-&gt;LastDisplayed,
04872                               Buffer,
04873                               BufferSize,
04874                               CommandSize
04875                              );
04876 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a134" doxytag="consrv.h::RetrieveKeyInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RetrieveKeyInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pwVirtualKeyCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pwVirtualScanCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>FreeKeyInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01609">1609</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00071">CONSOLE_FREE_KEY_INFO</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00072">CONSOLE_MAX_KEY_INFO</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00080">ConsoleKeyInfo</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00075">_CONSOLE_KEY_INFO::hWnd</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00339">MapVirtualKey()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00076">_CONSOLE_KEY_INFO::wVirtualKeyCode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00077">_CONSOLE_KEY_INFO::wVirtualScanCode</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>01615 {
01616     <span class="keywordtype">int</span> i;
01617 
01618     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a3">CONSOLE_MAX_KEY_INFO</a>;i++) {
01619         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> == <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>) {
01620             <span class="keywordflow">break</span>;
01621         }
01622     }
01623     <span class="keywordflow">if</span> (i!=<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a3">CONSOLE_MAX_KEY_INFO</a>) {
01624         *pwVirtualKeyCode = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o1">wVirtualKeyCode</a>;
01625         *pwVirtualScanCode = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o2">wVirtualScanCode</a>;
01626         <span class="keywordflow">if</span> (FreeKeyInfo)
01627             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a2">CONSOLE_FREE_KEY_INFO</a>;
01628     } <span class="keywordflow">else</span> {
01629         *pwVirtualKeyCode = (WORD)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a18">MapVirtualKey</a>(*pwVirtualScanCode, 3);
01630     }
01631 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="consrv.h::RevalidateConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RevalidateConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">1686</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00107">CONSOLE_IN_DESTRUCTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00097">CONSOLE_TERMINATING</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00175">DereferenceConsoleHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01051">DestroyConsole()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00260">LockConsole</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00258">LockConsoleHandleTable</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00259">UnlockConsoleHandleTable</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00705">ConsoleAddProcessRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01912">ConsoleClientShutdown()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00821">ConsoleSetActiveWindow()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03139">GetThreadConsoleDesktop()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01657">ProcessCreateConsoleWindow()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01690 {
01691     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01692 
01693     <a class="code" href="../../d8/d5/consrv_8h.html#a40">LockConsoleHandleTable</a>();
01694     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a11">DereferenceConsoleHandle</a>(ConsoleHandle,
01695                                       Console
01696                                      );
01697     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01698         <a class="code" href="../../d8/d5/consrv_8h.html#a41">UnlockConsoleHandleTable</a>();
01699         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01700     }
01701 
01702     <span class="comment">//</span>
01703     <span class="comment">// The WaitCount ensures the console won't go away between the time</span>
01704     <span class="comment">// we unlock the console handle table and we lock the console.</span>
01705     <span class="comment">//</span>
01706 
01707     InterlockedIncrement(&amp;(*Console)-&gt;WaitCount);
01708     <a class="code" href="../../d8/d5/consrv_8h.html#a41">UnlockConsoleHandleTable</a>();
01709     <span class="keywordflow">try</span> {
01710         <a class="code" href="../../d8/d5/consrv_8h.html#a42">LockConsole</a>(*Console);
01711     } except (EXCEPTION_EXECUTE_HANDLER) {
01712         InterlockedDecrement(&amp;(*Console)-&gt;WaitCount);
01713         <span class="keywordflow">return</span> GetExceptionCode();
01714     }
01715     InterlockedDecrement(&amp;(*Console)-&gt;WaitCount);
01716 
01717     <span class="comment">//</span>
01718     <span class="comment">// If the console was marked for destruction while we were waiting to</span>
01719     <span class="comment">// lock it, try to destroy it and return.</span>
01720     <span class="comment">//</span>
01721 
01722     <span class="keywordflow">if</span> ((*Console)-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a22">CONSOLE_IN_DESTRUCTION</a>) {
01723         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a20">DestroyConsole</a>(*Console);
01724         *Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01725         <span class="keywordflow">return</span> STATUS_INVALID_HANDLE;
01726     }
01727 
01728     <span class="comment">//</span>
01729     <span class="comment">// If the console was marked for termination while we were waiting to</span>
01730     <span class="comment">// lock it, bail out.</span>
01731     <span class="comment">//</span>
01732 
01733     <span class="keywordflow">if</span> ((*Console)-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a12">CONSOLE_TERMINATING</a>) {
01734         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(*Console);
01735         *Console = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01736         <span class="keywordflow">return</span> STATUS_PROCESS_IS_TERMINATING;
01737     }
01738 
01739     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01740 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="consrv.h::SCR_FACENAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline LPWSTR SCR_FACENAME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pScreen</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00112">112</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00112                                                           {
00113     <span class="keywordflow">return</span> pScreen-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FaceName;
00114 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="consrv.h::SCR_FAMILY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> SCR_FAMILY           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pScreen</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00104">104</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, and <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00104                                                       {
00105     <span class="keywordflow">return</span> pScreen-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.Family;
00106 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="consrv.h::SCR_FONTCODEPAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline UINT SCR_FONTCODEPAGE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pScreen</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00124">124</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03175">SetRAMFontCodePage()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00124                                                             {
00125     <span class="keywordflow">return</span> pScreen-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontCodePage;
00126 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="consrv.h::SCR_FONTNUMBER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SCR_FONTNUMBER           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pScreen</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00108">108</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, and <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01053">GetCurrentFont()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00108                                                            {
00109     <span class="keywordflow">return</span> pScreen-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontNumber;
00110 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="consrv.h::SCR_FONTSIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline COORD SCR_FONTSIZE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pScreen</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">116</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00332">CursorTimerRoutine()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">GetAvailableFonts()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04004">InternalSetWindowSize()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00033">InvertPixels()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d5/d7/resize_8c-source.html#l00040">ProcessResizeWindow()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01231">ScrollIfNecessary()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02737">ScrollScreen()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00555">SrvGetLargestConsoleWindowSize()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02998">StreamScrollRegion()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l02145">WWSB_ConsolePolyTextOut()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.
<p>
<pre class="fragment"><div>00116                                                          {
00117     <span class="keywordflow">return</span> pScreen-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.FontSize;
00118 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="consrv.h::SCR_FONTWEIGHT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline LONG SCR_FONTWEIGHT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pScreen</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00120">120</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
References <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00120                                                           {
00121     <span class="keywordflow">return</span> pScreen-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CurrentTextBufferFont.Weight;
00122 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a116" doxytag="consrv.h::ScrollRegion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ScrollRegion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>ScrollRectangle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT ClipRectangle&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>DestinationOrigin</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>Fill</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a96" doxytag="consrv.h::ScrollScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ScrollScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>ScrollRect</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>MergeRect</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetPoint</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l02737">2737</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00108">ghrgnScroll</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00119">LockScrollBuffer</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01176">ScrollDC()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00066">SCROLLDC_CALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00120">UnlockScrollBuffer</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02674">UpdateComplexRegion()</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l03226">ScrollRegion()</a>.
<p>
<pre class="fragment"><div>02743 {
02744     RECT ScrollRectGdi;
02745     SMALL_RECT UpdateRegion;
02746     COORD FontSize;
02747     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
02748     RECT BoundingBox;
02749 <span class="preprocessor">#if defined(FE_SB)</span>
02750 <span class="preprocessor"></span>    <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> fBisect = 0;
02751     SMALL_RECT UpdateRect;
02752     SMALL_RECT TmpBisect;
02753 <span class="preprocessor">#endif</span>
02754 <span class="preprocessor"></span>
02755     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"ScrollScreen\n"</span>));
02756     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
02757         <span class="keywordflow">return</span>;
02758     }
02759     <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;FullScreenFlags == 0 &amp;&amp;
02760         !(ScreenInfo-&gt;Console-&gt;Flags &amp; (<a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a> | <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>))) {
02761 <span class="preprocessor">#if defined(FE_SB)</span>
02762 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ScreenInfo-&gt;BisectFlag){
02763             SMALL_RECT RedrawRect;
02764             <span class="keywordflow">if</span> (ScrollRect-&gt;Top &lt; TargetPoint.Y){
02765                 RedrawRect.Top = ScrollRect-&gt;Top;
02766                 RedrawRect.Bottom = TargetPoint.Y+(ScrollRect-&gt;Bottom-ScrollRect-&gt;Top);
02767             }
02768             <span class="keywordflow">else</span>{
02769                 RedrawRect.Top = TargetPoint.Y;
02770                 RedrawRect.Bottom = ScrollRect-&gt;Bottom;
02771             }
02772             <span class="keywordflow">if</span> (ScrollRect-&gt;Left &lt; TargetPoint.X){
02773                 RedrawRect.Left = ScrollRect-&gt;Left;
02774                 RedrawRect.Right = TargetPoint.X+(ScrollRect-&gt;Right-ScrollRect-&gt;Left);
02775             }
02776             <span class="keywordflow">else</span>{
02777                 RedrawRect.Left = TargetPoint.X;
02778                 RedrawRect.Right = ScrollRect-&gt;Right;
02779             }
02780             <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;RedrawRect);
02781         }
02782         <span class="keywordflow">else</span>{
02783 <span class="preprocessor">#endif</span>
02784 <span class="preprocessor"></span>        ScrollRectGdi.left = ScrollRect-&gt;Left-ScreenInfo-&gt;Window.Left;
02785         ScrollRectGdi.right = (ScrollRect-&gt;Right-ScreenInfo-&gt;Window.Left+1);
02786         ScrollRectGdi.top = ScrollRect-&gt;Top-ScreenInfo-&gt;Window.Top;
02787         ScrollRectGdi.bottom = (ScrollRect-&gt;Bottom-ScreenInfo-&gt;Window.Top+1);
02788         <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
02789             FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
02790             ScrollRectGdi.left *= FontSize.X;
02791             ScrollRectGdi.right *= FontSize.X;
02792             ScrollRectGdi.top *= FontSize.Y;
02793             ScrollRectGdi.bottom *= FontSize.Y;
02794             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;BufferInfo.TextInfo.UpdatingScreen&gt;0);
02795         } <span class="keywordflow">else</span> {
02796             FontSize.X = 1;
02797             FontSize.Y = 1;
02798         }
02799         <a class="code" href="../../d6/d2/output_8c.html#a0">SCROLLDC_CALL</a>;
02800         <a class="code" href="../../d6/d2/output_8c.html#a6">LockScrollBuffer</a>();
02801         Success = (<span class="keywordtype">int</span>)<a class="code" href="../../d3/d8/client_8c.html#a48">ScrollDC</a>(ScreenInfo-&gt;Console-&gt;hDC,
02802                              (TargetPoint.X-ScrollRect-&gt;Left)*FontSize.X,
02803                              (TargetPoint.Y-ScrollRect-&gt;Top)*FontSize.Y,
02804                              &amp;ScrollRectGdi,
02805                              NULL,
02806                              ghrgnScroll,
02807                              NULL);
02808         <span class="keywordflow">if</span> (Success) {
02809             <span class="comment">/*</span>
02810 <span class="comment">             * Fetch our rectangles. If this is a simple rect then</span>
02811 <span class="comment">             * we have already retrieved the rectangle. Otherwise</span>
02812 <span class="comment">             * we need to call gdi to get the rectangles. We are</span>
02813 <span class="comment">             * optimzied for speed rather than size.</span>
02814 <span class="comment">             */</span>
02815             <span class="keywordflow">switch</span> (GetRgnBox(ghrgnScroll, &amp;BoundingBox)) {
02816             <span class="keywordflow">case</span> SIMPLEREGION:
02817                 UpdateRegion.Left = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((BoundingBox.left / FontSize.X) + \
02818                                     ScreenInfo-&gt;Window.Left);
02819                 UpdateRegion.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(((BoundingBox.right-1) / FontSize.X) + \
02820                                     ScreenInfo-&gt;Window.Left);
02821                 UpdateRegion.Top = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((BoundingBox.top / FontSize.Y) + \
02822                                     ScreenInfo-&gt;Window.Top);
02823                 UpdateRegion.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(((BoundingBox.bottom-1) / FontSize.Y) + \
02824                                     ScreenInfo-&gt;Window.Top);
02825 <span class="preprocessor">#if defined(FE_SB)</span>
02826 <span class="preprocessor"></span>                fBisect = ScreenInfo-&gt;BisectFlag;
02827 <span class="preprocessor">#endif</span>
02828 <span class="preprocessor"></span>                <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo, &amp;UpdateRegion);
02829                 <span class="keywordflow">break</span>;
02830             <span class="keywordflow">case</span> COMPLEXREGION:
02831                 <a class="code" href="../../d6/d2/output_8c.html#a60">UpdateComplexRegion</a>(ScreenInfo, FontSize);
02832                 <span class="keywordflow">break</span>;
02833             }
02834 
02835             <span class="keywordflow">if</span> (MergeRect) {
02836 <span class="preprocessor">#if defined(FE_SB)</span>
02837 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (fBisect)
02838                     ScreenInfo-&gt;BisectFlag = fBisect;
02839                 <span class="keywordflow">else</span>
02840                     fBisect = ScreenInfo-&gt;BisectFlag;
02841 <span class="preprocessor">#endif</span>
02842 <span class="preprocessor"></span>                <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo, MergeRect);
02843             }
02844 <span class="preprocessor">#if defined(FE_SB)</span>
02845 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console)) {
02846                 UpdateRect.Left = TargetPoint.X;
02847                 UpdateRect.Right = ScrollRect-&gt;Right + (TargetPoint.X-ScrollRect-&gt;Left);
02848                 UpdateRect.Top = TargetPoint.Y;
02849                 UpdateRect.Bottom = ScrollRect-&gt;Bottom + (TargetPoint.Y-ScrollRect-&gt;Top);
02850                 <span class="keywordflow">if</span> (UpdateRect.Left &amp;&amp;
02851                     UpdateRect.Right+1 &lt; ScreenInfo-&gt;ScreenBufferSize.X &amp;&amp;
02852                     UpdateRect.Right-UpdateRect.Left &lt;= 2) {
02853                     TmpBisect.Left = UpdateRect.Left-1;
02854                     TmpBisect.Right = UpdateRect.Right+1;
02855                     TmpBisect.Top = UpdateRect.Top;
02856                     TmpBisect.Bottom = UpdateRect.Bottom;
02857                     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo, &amp;TmpBisect);
02858                 }
02859                 <span class="keywordflow">else</span> {
02860                     <span class="keywordflow">if</span> (UpdateRect.Left) {
02861                         TmpBisect.Left = UpdateRect.Left-1;
02862                         TmpBisect.Right = UpdateRect.Left;
02863                         TmpBisect.Top = UpdateRect.Top;
02864                         TmpBisect.Bottom = UpdateRect.Bottom;
02865                         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo, &amp;TmpBisect);
02866                     }
02867                     <span class="keywordflow">if</span> (UpdateRect.Right+1 &lt; ScreenInfo-&gt;ScreenBufferSize.X) {
02868                         TmpBisect.Left = UpdateRect.Right;
02869                         TmpBisect.Right = UpdateRect.Right+1;
02870                         TmpBisect.Top = UpdateRect.Top;
02871                         TmpBisect.Bottom = UpdateRect.Bottom;
02872                         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo, &amp;TmpBisect);
02873                     }
02874                 }
02875             }
02876 <span class="preprocessor">#endif</span>
02877 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
02878 <span class="preprocessor">#if defined(FE_SB)</span>
02879 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (fBisect)
02880                 ScreenInfo-&gt;BisectFlag = fBisect;
02881             <span class="keywordflow">else</span>
02882                 fBisect = ScreenInfo-&gt;BisectFlag;
02883 <span class="preprocessor">#endif</span>
02884 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo, &amp;ScreenInfo-&gt;Window);
02885         }
02886         <a class="code" href="../../d6/d2/output_8c.html#a7">UnlockScrollBuffer</a>();
02887 <span class="preprocessor">#if defined(FE_SB)</span>
02888 <span class="preprocessor"></span>        }
02889 <span class="preprocessor">#endif</span>
02890 <span class="preprocessor"></span>    }
02891 <span class="preprocessor">#ifdef i386</span>
02892 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
02893 <span class="preprocessor">#if defined(FE_SB)</span>
02894 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console)) {
02895             <span class="keywordflow">if</span> (! ScreenInfo-&gt;ConvScreenInfo) {
02896                 <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;CurrentScreenBuffer == ScreenInfo) {
02897                     ScrollHW(ScreenInfo,
02898                              ScrollRect,
02899                              MergeRect,
02900                              TargetPoint
02901                             );
02902                 }
02903             }
02904             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
02905                 ScrollHW(ScreenInfo,
02906                          ScrollRect,
02907                          MergeRect,
02908                          TargetPoint
02909                         );
02910             }
02911         }
02912         <span class="keywordflow">else</span>
02913 <span class="preprocessor">#endif</span>
02914 <span class="preprocessor"></span>        ScrollHW(ScreenInfo,
02915                  ScrollRect,
02916                  MergeRect,
02917                  TargetPoint
02918                 );
02919     }
02920 <span class="preprocessor">#endif</span>
02921 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a283" doxytag="consrv.h::SetActivePalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetActivePalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00544">544</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00720">RealizePalette</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01567">DisplayModeTransition()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00547 {
00548     USERTHREAD_USEDESKTOPINFO utudi;
00549     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00550 
00551     <span class="keywordflow">if</span> (GetCurrentThreadId() != ScreenInfo-&gt;Console-&gt;InputThreadInfo-&gt;ThreadId) {
00552         bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00553         utudi.hThread = ScreenInfo-&gt;Console-&gt;InputThreadInfo-&gt;ThreadHandle;
00554         utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00555         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00556                 UserThreadUseDesktop,
00557                 &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00558     }
00559 
00560     SetSystemPaletteUse(ScreenInfo-&gt;Console-&gt;hDC,
00561                         ScreenInfo-&gt;dwUsage
00562                        );
00563     <a class="code" href="../../d3/d0/user32_8def.html#a84">RealizePalette</a>(ScreenInfo-&gt;Console-&gt;hDC);
00564 
00565     <span class="keywordflow">if</span> (bReset == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00566         utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00567         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00568                 UserThreadUseDesktop, &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00569     }
00570 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a119" doxytag="consrv.h::SetActiveScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetActiveScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04072">4072</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00401">FlushAllButKeys()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00139">_CONSOLE_INFORMATION::hDC</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00169">_SCREEN_INFORMATION::hPalette</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00142">_CONSOLE_INFORMATION::hSysPalette</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00132">_CONSOLE_INFORMATION::InputBuffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00235">_CONSOLE_INFORMATION::InputThreadInfo</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00718">SelectPalette</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00544">SetActivePalette()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03953">SetWindowSize()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00055">_INPUT_THREAD_INFO::ThreadHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00056">_INPUT_THREAD_INFO::ThreadId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00492">SrvSetConsoleActiveScreenBuffer()</a>.
<p>
<pre class="fragment"><div>04075 {
04076     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> OldScreenInfo;
04077     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
04078 
04079     OldScreenInfo = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>;
04080     <span class="keywordflow">if</span> (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
04081 
04082 <span class="preprocessor">#if !defined(_X86_)</span>
04083 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
04084             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
04085         }
04086 <span class="preprocessor">#endif</span>
04087 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a> = ScreenInfo;
04088 
04089         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
04090 
04091             <span class="comment">//</span>
04092             <span class="comment">// initialize cursor</span>
04093             <span class="comment">//</span>
04094 
04095             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorOn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04096 
04097             <span class="comment">//</span>
04098             <span class="comment">// set font</span>
04099             <span class="comment">//</span>
04100 
04101             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a34">SetFont</a>(ScreenInfo);
04102         }
04103 <span class="preprocessor">#if defined(_X86_)</span>
04104 <span class="preprocessor"></span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
04105 
04106             <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) {
04107 
04108                 <span class="keywordflow">if</span> ( (!(OldScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)) ||
04109                      (OldScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex!=ScreenInfo-&gt;BufferInfo.TextInfo.ModeIndex)) {
04110 
04111                     <span class="comment">// set video mode and font</span>
04112                     SetVideoMode(ScreenInfo);
04113                 }
04114 
04115                 <span class="comment">//set up cursor</span>
04116 
04117                 SetCursorInformationHW(ScreenInfo,
04118                                        ScreenInfo-&gt;BufferInfo.TextInfo.CursorSize,
04119                                        ScreenInfo-&gt;BufferInfo.TextInfo.CursorVisible);
04120                 SetCursorPositionHW(ScreenInfo,
04121                                     ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition);
04122             }
04123 
04124         }
04125 <span class="preprocessor">#endif</span>
04126 <span class="preprocessor"></span>    }
04127     <span class="keywordflow">else</span> {
04128         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a> = ScreenInfo;
04129     }
04130 
04131     <span class="comment">//</span>
04132     <span class="comment">// empty input buffer</span>
04133     <span class="comment">//</span>
04134 
04135     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a22">FlushAllButKeys</a>(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>);
04136 
04137     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
04138 
04139         <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(ScreenInfo, ScreenInfo-&gt;Attributes,
04140                         ScreenInfo-&gt;PopupAttributes, FALSE);
04141 
04142         <span class="comment">//</span>
04143         <span class="comment">// set window size</span>
04144         <span class="comment">//</span>
04145 
04146         <a class="code" href="../../d6/d2/output_8c.html#a68">SetWindowSize</a>(ScreenInfo);
04147 
04148         <span class="comment">//</span>
04149         <span class="comment">// initialize the palette, if we have the focus and we're not fullscreen</span>
04150         <span class="comment">//</span>
04151 
04152         <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) &amp;&amp;
04153             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
04154             <span class="keywordflow">if</span> (ScreenInfo-&gt;hPalette != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || OldScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04155                 HPALETTE hPalette;
04156                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04157                 USERTHREAD_USEDESKTOPINFO utudi;
04158 
04159                 <span class="keywordflow">if</span> (GetCurrentThreadId() != Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o75">InputThreadInfo</a>-&gt;<a class="code" href="../../d9/d2/struct__INPUT__THREAD__INFO.html#o1">ThreadId</a>) {
04160                     bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04161                     utudi.hThread = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o75">InputThreadInfo</a>-&gt;<a class="code" href="../../d9/d2/struct__INPUT__THREAD__INFO.html#o0">ThreadHandle</a>;
04162                     utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04163                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
04164                             UserThreadUseDesktop,
04165                             &amp;utudi, <span class="keyword">sizeof</span>(utudi));
04166                 }
04167 
04168                 <span class="keywordflow">if</span> (ScreenInfo-&gt;hPalette == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04169                     hPalette = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o13">hSysPalette</a>;
04170                 } <span class="keywordflow">else</span> {
04171                     hPalette = ScreenInfo-&gt;hPalette;
04172                 }
04173                 <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>,
04174                                  hPalette,
04175                                  FALSE);
04176                 <a class="code" href="../../d7/d4/server_2private_8c.html#a46">SetActivePalette</a>(ScreenInfo);
04177 
04178                 <span class="keywordflow">if</span> (bReset == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
04179                     utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04180                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
04181                             UserThreadUseDesktop, &amp;utudi, <span class="keyword">sizeof</span>(utudi));
04182                 }
04183             }
04184         }
04185     }
04186 
04187 <span class="preprocessor">#if defined(FE_IME)</span>
04188 <span class="preprocessor"></span>    SetUndetermineAttribute(Console);
04189 <span class="preprocessor">#endif</span>
04190 <span class="preprocessor"></span>    <span class="comment">//</span>
04191     <span class="comment">// write data to screen</span>
04192     <span class="comment">//</span>
04193 
04194     ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
04195     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;Window);
04196     <span class="keywordflow">return</span> STATUS_SUCCESS;
04197 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a313" doxytag="consrv.h::SetConsoleReserveKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetConsoleReserveKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>fsReserveKeys</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01567">DisplayModeTransition()</a>, and <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02423">SrvSetConsoleKeyShortcuts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a233" doxytag="consrv.h::SetCursorInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetCursorInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Visible</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a235" doxytag="consrv.h::SetCursorMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetCursorMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DoubleCursor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a234" doxytag="consrv.h::SetCursorPosition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetCursorPosition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Position</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>TurnOn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">474</a> of file <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html">ntcon/server/cursor.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00332">CursorTimerRoutine()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">DeleteCommandLine()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02546">ProcessCopyFromCharInput()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00662">SrvSetConsoleCursorPosition()</a>, and <a class="el" href="../../d1/d2/__stream_8h-source.html#l00046">WWSB_AdjustCursorPosition()</a>.
<p>
<pre class="fragment"><div>00482                    :
00483 
00484     This routine sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cursor position in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data structures and on
00485     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen.
00486 
00487 Arguments:
00488 
00489     ScreenInfo - pointer to screen info structure.
00490 
00491     Position - <span class="keyword">new</span> position of cursor
00492 
00493     TurnOn - <span class="keyword">true</span> <span class="keywordflow">if</span> cursor should be left on, <span class="keyword">false</span> <span class="keywordflow">if</span> should be left off
00494 
00495 Return Value:
00496 
00497     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
00498 
00499 --*/
00500 
00501 {
00502     <span class="comment">//</span>
00503     <span class="comment">// don't let cursorposition be set beyond edge of screen buffer</span>
00504     <span class="comment">//</span>
00505 
00506     <span class="keywordflow">if</span> (Position.X &gt;= ScreenInfo-&gt;ScreenBufferSize.X ||
00507         Position.Y &gt;= ScreenInfo-&gt;ScreenBufferSize.Y) {
00508         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00509     }
00510     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
00511     ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition = Position;
00512 <span class="preprocessor">#ifdef i386</span>
00513 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((!(ScreenInfo-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) &amp;&amp;
00514         ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE) {
00515         SetCursorPositionHW(ScreenInfo,Position);
00516     }
00517 <span class="preprocessor">#endif</span>
00518 <span class="preprocessor"></span>    <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
00519 
00520 <span class="comment">// if we have the focus, adjust the cursor state</span>
00521 
00522     <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
00523 
00524         <span class="keywordflow">if</span> (TurnOn) {
00525             ScreenInfo-&gt;BufferInfo.TextInfo.DelayCursor = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00526             <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a6">CursorTimerRoutine</a>(ScreenInfo);
00527         } <span class="keywordflow">else</span> {
00528             ScreenInfo-&gt;BufferInfo.TextInfo.DelayCursor = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00529         }
00530         ScreenInfo-&gt;BufferInfo.TextInfo.CursorMoved = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00531     }
00532 
00533     <span class="keywordflow">return</span> STATUS_SUCCESS;
00534 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a169" doxytag="consrv.h::SetFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a145" doxytag="consrv.h::SetInputBufferSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetInputBufferSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00516">516</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00070">BUFFER_TAG</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00616">ReadBuffer()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01095">WriteBuffer()</a>.
<p>
<pre class="fragment"><div>00523                    :
00524 
00525     This routine resizes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
00526 
00527 Arguments:
00528 
00529     InputInformation - Pointer to input buffer information structure.
00530 
00531     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - New size in number of events.
00532 
00533 Return Value:
00534 
00535 Note:
00536 
00537     The console lock must be held when calling <span class="keyword">this</span> routine.
00538 
00539 --*/
00540 
00541 {
00542     ULONG NumberOfEventsRead;
00543     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00544     PINPUT_RECORD InputBuffer;
00545     ULONG <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00546     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Dummy;
00547 
00548 <span class="preprocessor">#if DBG</span>
00549 <span class="preprocessor"></span>    ULONG_PTR NumberOfEvents;
00550     <span class="keywordflow">if</span> (InputInformation-&gt;In &lt; InputInformation-&gt;Out) {
00551         NumberOfEvents = InputInformation-&gt;Last - InputInformation-&gt;Out;
00552         NumberOfEvents += InputInformation-&gt;In - InputInformation-&gt;First;
00553     }
00554     <span class="keywordflow">else</span> {
00555         NumberOfEvents = InputInformation-&gt;In - InputInformation-&gt;Out;
00556     }
00557     NumberOfEvents /= <span class="keyword">sizeof</span>(INPUT_RECORD);
00558 <span class="preprocessor">#endif</span>
00559 <span class="preprocessor"></span>    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Size &gt; InputInformation-&gt;InputBufferSize );
00560 
00561     <span class="comment">//</span>
00562     <span class="comment">// allocate memory for new input buffer</span>
00563     <span class="comment">//</span>
00564 
00565     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> =  <span class="keyword">sizeof</span>(INPUT_RECORD) * (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>+1);
00566     InputBuffer = (PINPUT_RECORD)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( BUFFER_TAG ),BufferSize);
00567     <span class="keywordflow">if</span> (InputBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00568         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00569     }
00570 
00571     <span class="comment">//</span>
00572     <span class="comment">// copy old input buffer.</span>
00573     <span class="comment">// let the ReadBuffer do any compaction work.</span>
00574     <span class="comment">//</span>
00575 
00576     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a15">ReadBuffer</a>(InputInformation,
00577                         InputBuffer,
00578                         Size,
00579                         &amp;NumberOfEventsRead,
00580                         TRUE,
00581                         FALSE,
00582                         &amp;Dummy
00583 #<span class="keywordflow">if</span> defined(FE_SB)
00584                         ,
00585                         TRUE
00586 #endif
00587                        );
00588 
00589     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00590         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(InputBuffer);
00591         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00592     }
00593     InputInformation-&gt;Out = (ULONG_PTR)InputBuffer;
00594     InputInformation-&gt;In = (ULONG_PTR)InputBuffer + <span class="keyword">sizeof</span>(INPUT_RECORD) * NumberOfEventsRead;
00595 
00596     <span class="comment">//</span>
00597     <span class="comment">// adjust pointers</span>
00598     <span class="comment">//</span>
00599 
00600     InputInformation-&gt;First = (ULONG_PTR) InputBuffer;
00601     InputInformation-&gt;Last = (ULONG_PTR) InputBuffer + <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00602 
00603     <span class="comment">//</span>
00604     <span class="comment">// free old input buffer</span>
00605     <span class="comment">//</span>
00606 
00607     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(InputInformation-&gt;InputBuffer);
00608     InputInformation-&gt;InputBufferSize = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00609     InputInformation-&gt;AllocatedBufferSize = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
00610     InputInformation-&gt;InputBuffer = InputBuffer;
00611     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00612 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a98" doxytag="consrv.h::SetProcessFocus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetProcessFocus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCSR_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Foreground</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04200">4200</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00895">AddProcessToList()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04227">ModifyConsoleProcessFocus()</a>.
<p>
<pre class="fragment"><div>04204 {
04205     <span class="keywordflow">if</span> (Foreground) {
04206         CsrSetForegroundPriority(Process);
04207     } <span class="keywordflow">else</span> {
04208         CsrSetBackgroundPriority(Process);
04209     }
04210 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a97" doxytag="consrv.h::SetProcessForegroundRights" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetProcessForegroundRights           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCSR_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Foreground</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04213">4213</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07606">NtUserSetInformationProcess()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l02268">W32PF_ALLOWSETFOREGROUND</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l02269">W32PF_CONSOLEHASFOCUS</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04227">ModifyConsoleProcessFocus()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>.
<p>
<pre class="fragment"><div>04217 {
04218     USERTHREAD_FLAGS Flags;
04219 
04220     Flags.dwMask  = (<a class="code" href="../../d8/d5/consrv_8h.html#a57">W32PF_ALLOWSETFOREGROUND</a> | <a class="code" href="../../d8/d5/consrv_8h.html#a58">W32PF_CONSOLEHASFOCUS</a>);
04221     Flags.dwFlags = (Foreground ? (<a class="code" href="../../d8/d5/consrv_8h.html#a57">W32PF_ALLOWSETFOREGROUND</a> | <a class="code" href="../../d8/d5/consrv_8h.html#a58">W32PF_CONSOLEHASFOCUS</a>) : 0);
04222 
04223     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a278">NtUserSetInformationProcess</a>(Process-&gt;ProcessHandle, UserProcessFlags, &amp;Flags, <span class="keyword">sizeof</span>(Flags));
04224 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a170" doxytag="consrv.h::SetScreenBufferFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetScreenBufferFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a215" doxytag="consrv.h::SetScreenColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetScreenColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Attributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>PopupAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>UpdateWholeScreen</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">1002</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00053">_ATTR_PAIR::Attr</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00068">_ROW::AttrRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00061">_ATTR_ROW::Attrs</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00264">ConvertAttrToRGB</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00139">_CONSOLE_INFORMATION::hDC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00162">_CONSOLE_INFORMATION::LastAttributes</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00059">_ATTR_ROW::Length</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00189">_CONSOLE_INFORMATION::PopupCount</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00093">SetConsoleBkColor</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00942">UpdatePopups()</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01078">SrvSetConsoleTextAttribute()</a>.
<p>
<pre class="fragment"><div>01008 {
01009     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
01010     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
01011     WORD DefaultAttributes,DefaultPopupAttributes;
01012     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01013     COLORREF rgbBk;
01014     COLORREF rgbText;
01015 
01016     Console = ScreenInfo-&gt;Console;
01017     rgbBk = <a class="code" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(Console, <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(Attributes &gt;&gt; 4));
01018     rgbBk = GetNearestColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbBk);
01019     rgbText = <a class="code" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(Console, <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(Attributes));
01020     rgbText = GetNearestColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbText);
01021     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
01022         SetDCBrushColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbBk);
01023         SetTextColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbText);
01024         SetBkColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbBk);
01025         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o33">LastAttributes</a> = Attributes;
01026         <a class="code" href="../../d8/d5/consrv_8h.html#a22">SetConsoleBkColor</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, rgbBk);
01027     }
01028 
01029     DefaultAttributes = ScreenInfo-&gt;Attributes;
01030     DefaultPopupAttributes = ScreenInfo-&gt;PopupAttributes;
01031     ScreenInfo-&gt;Attributes = Attributes;
01032     ScreenInfo-&gt;PopupAttributes = PopupAttributes;
01033 <span class="preprocessor">#if defined(FE_IME)</span>
01034 <span class="preprocessor"></span>    SetUndetermineAttribute( Console );
01035 <span class="preprocessor">#endif</span>
01036 <span class="preprocessor"></span>
01037     <span class="keywordflow">if</span> (UpdateWholeScreen &amp;&amp; ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01038         WORD InvertedOldPopupAttributes,InvertedNewPopupAttributes;
01039 
01040         InvertedOldPopupAttributes = (WORD)(((DefaultPopupAttributes &lt;&lt; 4) &amp; 0xf0) |
01041                                     ((DefaultPopupAttributes &gt;&gt; 4) &amp; 0x0f));
01042         InvertedNewPopupAttributes = (WORD)(((PopupAttributes &lt;&lt; 4) &amp; 0xf0) |
01043                                     ((PopupAttributes &gt;&gt; 4) &amp; 0x0f));
01044         <span class="comment">//</span>
01045         <span class="comment">// change all chars with default color</span>
01046         <span class="comment">//</span>
01047 
01048         <span class="keywordflow">for</span> (i=0;i&lt;ScreenInfo-&gt;ScreenBufferSize.Y;i++) {
01049             Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i];
01050             <span class="keywordflow">for</span> (j=0;j&lt;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a>;j++) {
01051                 <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> == DefaultAttributes) {
01052                     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = Attributes;
01053                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> == DefaultPopupAttributes) {
01054                     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = PopupAttributes;
01055                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> == InvertedOldPopupAttributes) {
01056                     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = InvertedNewPopupAttributes;
01057                 }
01058             }
01059         }
01060 
01061         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o48">PopupCount</a>)
01062             <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a19">UpdatePopups</a>(Console,
01063                          Attributes,
01064                          PopupAttributes,
01065                          DefaultAttributes,
01066                          DefaultPopupAttributes
01067                          );
01068         <span class="comment">// force repaint of entire line</span>
01069         ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01070         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;Window);
01071         ScreenInfo-&gt;BufferInfo.TextInfo.Flags |= <a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01072     }
01073 
01074     <span class="keywordflow">return</span> STATUS_SUCCESS;
01075 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a117" doxytag="consrv.h::SetWindowOrigin" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetWindowOrigin           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Absolute</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>WindowOrigin</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a118" doxytag="consrv.h::SetWindowSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetWindowSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l03953">3953</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00356">CM_SET_WINDOW_SIZE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00108">CONSOLE_SETTING_WINDOW_SIZE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">SrvSetConsoleWindowInfo()</a>.
<p>
<pre class="fragment"><div>03956 {
03957 <span class="preprocessor">#if defined(FE_IME)</span>
03958 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ScreenInfo-&gt;ConvScreenInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03959         <span class="keywordflow">return</span>;
03960 <span class="preprocessor">#endif</span>
03961 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a23">CONSOLE_SETTING_WINDOW_SIZE</a>)
03962         <span class="keywordflow">return</span>;
03963     ScreenInfo-&gt;Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a23">CONSOLE_SETTING_WINDOW_SIZE</a>;
03964     <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(ScreenInfo-&gt;Console-&gt;hWnd,
03965                  CM_SET_WINDOW_SIZE,
03966                  (WPARAM)ScreenInfo,
03967                  0x47474747
03968                 );
03969 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a296" doxytag="consrv.h::SetWinText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetWinText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Add</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">236</a> of file <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html">ntcon/server/menu.c</a>.
<p>
References <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00781">GetWindowText()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, and <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00848">SetWindowText()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00338">CancelKeySelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00308">CancelMouseSelection()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01222">ClearScroll()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00390">ConvertToMouseSelect()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01211">DoScroll()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01175">DoSelectAll()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01096">InitSelection()</a>.
<p>
<pre class="fragment"><div>00250 {
00251     WCHAR TextBuf[256];
00252     PWCHAR TextBufPtr;
00253     <span class="keywordtype">int</span> TextLength;
00254     <span class="keywordtype">int</span> NameLength;
00255     WCHAR NameString[20];
00256 
00257     NameLength = LoadString(ghInstance,wID,NameString,
00258                                   <span class="keyword">sizeof</span>(NameString)/<span class="keyword">sizeof</span>(WCHAR));
00259     <span class="keywordflow">if</span> (Add) {
00260         RtlCopyMemory(TextBuf,NameString,NameLength*<span class="keyword">sizeof</span>(WCHAR));
00261         TextBuf[NameLength] = <span class="charliteral">' '</span>;
00262         TextBufPtr = TextBuf + NameLength + 1;
00263     } <span class="keywordflow">else</span> {
00264         TextBufPtr = TextBuf;
00265     }
00266     TextLength = <a class="code" href="../../d5/d9/cltxt_8h.html#a21">GetWindowText</a>(Console-&gt;hWnd,
00267                                   TextBufPtr,
00268                                   <span class="keyword">sizeof</span>(TextBuf)/<span class="keyword">sizeof</span>(WCHAR)-NameLength-1);
00269     <span class="keywordflow">if</span> (TextLength == 0)
00270         <span class="keywordflow">return</span>;
00271     <span class="keywordflow">if</span> (Add) {
00272         TextBufPtr = TextBuf;
00273     } <span class="keywordflow">else</span> {
00274         <span class="comment">/*</span>
00275 <span class="comment">         * The window title might have already been reset, so make sure</span>
00276 <span class="comment">         * the name is there before trying to remove it.</span>
00277 <span class="comment">         */</span>
00278         <span class="keywordflow">if</span> (wcsncmp(NameString, TextBufPtr, NameLength) != 0)
00279             <span class="keywordflow">return</span>;
00280         TextBufPtr = TextBuf + NameLength + 1;
00281     }
00282     <a class="code" href="../../d5/d9/cltxt_8h.html#a23">SetWindowText</a>(Console-&gt;hWnd,TextBufPtr);
00283 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a154" doxytag="consrv.h::ShutdownConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG ShutdownConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01912">ConsoleClientShutdown()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a181" doxytag="consrv.h::ShutdownSubst" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ShutdownSubst           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a240" doxytag="consrv.h::SrvAddConsoleAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvAddConsoleAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">608</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00483">AddAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00491">_CONSOLE_ADDALIAS_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00497">_CONSOLE_ADDALIAS_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00494">_CONSOLE_ADDALIAS_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00552">RemoveAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00524">ReplaceAlias()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00495">_CONSOLE_ADDALIAS_MSG::Source</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00492">_CONSOLE_ADDALIAS_MSG::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00496">_CONSOLE_ADDALIAS_MSG::Target</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00493">_CONSOLE_ADDALIAS_MSG::TargetLength</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00498">_CONSOLE_ADDALIAS_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00499">_CONSOLE_ADDALIAS_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00615                    :
00616 
00617     This routine adds a command line alias to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global set.
00618 
00619 Arguments:
00620 
00621     m - message containing api parameters
00622 
00623     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00624 
00625 Return Value:
00626 
00627 --*/
00628 
00629 {
00630 
00631     <a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html">PCONSOLE_ADDALIAS_MSG</a> a = (<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html">PCONSOLE_ADDALIAS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00632     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00633     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00634     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00635     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00636     LPWSTR Source,Target;
00637 
00638     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o0">ConsoleHandle</a>,
00639                          &amp;Console
00640                         );
00641     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00642         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00643     }
00644 
00645     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>, a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00646         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00647         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>, a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00648 
00649         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00650         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00651     }
00652 
00653     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o7">Unicode</a>) {
00654         Source = a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>;
00655         Target = a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>;
00656     } <span class="keywordflow">else</span> {
00657         Source = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00658         <span class="keywordflow">if</span> (Source == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00659             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00660             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00661         }
00662         Target = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00663         <span class="keywordflow">if</span> (Target == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00664             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00665             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00666             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00667         }
00668         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00669                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>,
00670                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00671                                             Source,
00672                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>);
00673         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a> *= 2;
00674         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00675                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>,
00676                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>,
00677                                             Target,
00678                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00679         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> *= 2;
00680     }
00681 
00682     <span class="comment">//</span>
00683     <span class="comment">// find specified exe.  if it's not there, add it if we're not</span>
00684     <span class="comment">// removing an alias.</span>
00685     <span class="comment">//</span>
00686 
00687     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o8">UnicodeExe</a>);
00688     <span class="keywordflow">if</span> (ExeAliasList) {
00689         Alias = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a>(ExeAliasList,Source,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>);
00690         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>) {
00691             <span class="keywordflow">if</span> (Alias) {
00692                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a25">ReplaceAlias</a>(Alias,
00693                                       Target,
00694                                       a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00695             } <span class="keywordflow">else</span> {
00696                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a24">AddAlias</a>(ExeAliasList,
00697                                   Source,
00698                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00699                                   Target,
00700                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00701             }
00702         } <span class="keywordflow">else</span> {
00703             <span class="keywordflow">if</span> (Alias) {
00704                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a26">RemoveAlias</a>(Alias);
00705             }
00706         }
00707     } <span class="keywordflow">else</span> {
00708         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>) {
00709             ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a20">AddExeAliasList</a>(Console,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o8">UnicodeExe</a>);
00710             <span class="keywordflow">if</span> (ExeAliasList) {
00711                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a24">AddAlias</a>(ExeAliasList,
00712                                   Source,
00713                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00714                                   Target,
00715                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00716             } <span class="keywordflow">else</span> {
00717                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00718             }
00719         }
00720     }
00721     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00722     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o7">Unicode</a>) {
00723         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00724         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Target);
00725     }
00726     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00727     UNREFERENCED_PARAMETER(ReplyStatus);
00728 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a264" doxytag="consrv.h::SrvAllocConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvAllocConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">1537</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00895">AddProcessToList()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">AllocateCommandHistory()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00600">_CONSOLE_ALLOC_MSG::AppName</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00599">_CONSOLE_ALLOC_MSG::AppNameLength</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00399">CONSOLE_GETCONSOLEAPPFROMPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00400">CONSOLE_SETCONSOLEAPP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00100">CONSOLE_SHUTTING_DOWN</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00042">_CONSOLE_INFO::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00594">_CONSOLE_ALLOC_MSG::ConsoleInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00050">_CONSOLE_PROCESS_HANDLE::CtrlRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00603">_CONSOLE_ALLOC_MSG::CtrlRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00602">_CONSOLE_ALLOC_MSG::CurDir</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00601">_CONSOLE_ALLOC_MSG::CurDirLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00598">_CONSOLE_ALLOC_MSG::Desktop</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00597">_CONSOLE_ALLOC_MSG::DesktopLength</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00067">HANDLE_TAG</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a114">PCONSOLE_ALLOC_MSG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00048">_CONSOLE_PROCESS_HANDLE::Process</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00051">_CONSOLE_PROCESS_HANDLE::PropRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00604">_CONSOLE_ALLOC_MSG::PropRoutine</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04213">SetProcessForegroundRights()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00955">SetUpConsole()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00596">_CONSOLE_ALLOC_MSG::Title</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00595">_CONSOLE_ALLOC_MSG::TitleLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01541 {
01542     <a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html">PCONSOLE_ALLOC_MSG</a> a = (<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html">PCONSOLE_ALLOC_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01543     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
01544     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01545     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01546     <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
01547     PCSR_PROCESS Process;
01548     UNICODE_STRING strDesktopName;
01549 
01550     ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
01551     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!<a class="code" href="../../d1/d7/server_8h.html#a86">CONSOLE_GETCONSOLEAPPFROMPROCESSDATA</a>(ProcessData));
01552 
01553     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o2">Title</a>, a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o1">TitleLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01554         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o4">Desktop</a>, a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o3">DesktopLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01555         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o8">CurDir</a>, a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o7">CurDirLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01556         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o6">AppName</a>, a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o5">AppNameLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01557         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>, <span class="keyword">sizeof</span>(*a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>), <span class="keyword">sizeof</span>(BYTE))) {
01558 
01559         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01560     }
01561 
01562     Process = (PCSR_PROCESS)(CSR_SERVER_QUERYCLIENTTHREAD()-&gt;Process);
01563     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o3">DesktopLength</a>)
01564         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strDesktopName, a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o4">Desktop</a>);
01565     <span class="keywordflow">else</span>
01566         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strDesktopName, L<span class="stringliteral">"Default"</span>);
01567 
01568     ProcessHandleRecord = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HANDLE_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>));
01569     <span class="keywordflow">if</span> (ProcessHandleRecord == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01570         <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01571     }
01572 
01573     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/srvinit_8c.html#a36">SetUpConsole</a>(a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>,
01574                           a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o1">TitleLength</a>,
01575                           a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o2">Title</a>,
01576                           a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o8">CurDir</a>,
01577                           a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o6">AppName</a>,
01578                           ProcessData,
01579                           TRUE,
01580                           &amp;strDesktopName);
01581     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01582         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ProcessHandleRecord);
01583         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01584     }
01585     <a class="code" href="../../d1/d7/server_8h.html#a87">CONSOLE_SETCONSOLEAPP</a>(TRUE);
01586     Process-&gt;Flags |= CSR_PROCESS_CONSOLEAPP;
01587     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>-&gt;<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o0">ConsoleHandle</a>,&amp;Console);
01588     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01589     ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o2">Process</a> = CSR_SERVER_QUERYCLIENTTHREAD()-&gt;Process;
01590     ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o4">CtrlRoutine</a> = a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o9">CtrlRoutine</a>;
01591     ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o5">PropRoutine</a> = a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o10">PropRoutine</a>;
01592     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_SHUTTING_DOWN));
01593     <a class="code" href="../../d0/d5/srvinit_8c.html#a33">AddProcessToList</a>(Console,ProcessHandleRecord,<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>());
01594     <a class="code" href="../../d6/d2/output_8c.html#a73">SetProcessForegroundRights</a>(Process,
01595                                Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_HAS_FOCUS);
01596     (HANDLE) <a class="code" href="../../d8/d5/consrv_8h.html#a254">AllocateCommandHistory</a>(Console,
01597                            a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o5">AppNameLength</a>,
01598                            a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o6">AppName</a>,
01599                            <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>());
01600 
01601     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01602 
01603     <span class="keywordflow">return</span> STATUS_SUCCESS;
01604     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01605 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a231" doxytag="consrv.h::SrvCloseHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvCloseHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02997">2997</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00464">_CONSOLE_CLOSEHANDLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00465">_CONSOLE_CLOSEHANDLE_MSG::Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>03004                    :
03005 
03006     This routine closes an input or output handle.
03007 
03008 Arguments:
03009 
03010     ApiMessageData - Points to parameter structure.
03011 
03012 Return Value:
03013 
03014 --*/
03015 
03016 {
03017     <a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html">PCONSOLE_CLOSEHANDLE_MSG</a> a = (<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html">PCONSOLE_CLOSEHANDLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
03018     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
03019     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
03020     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03021     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
03022 
03023     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html#o0">ConsoleHandle</a>,
03024                          &amp;Console
03025                         );
03026     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03027         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03028     }
03029     ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
03030     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
03031                                  <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html#o1">Handle</a>),
03032                                  &amp;HandleData
03033                                 );
03034     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03035         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>)
03036             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a35">CloseInputHandle</a>(ProcessData,Console,HandleData,<a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html#o1">Handle</a>));
03037         <span class="keywordflow">else</span> {
03038             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a36">CloseOutputHandle</a>(ProcessData,Console,HandleData,<a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html#o1">Handle</a>),TRUE);
03039         }
03040     }
03041     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
03042     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
03043     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
03044 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a280" doxytag="consrv.h::SrvConsoleMenuControl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvConsoleMenuControl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00373">373</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00659">_CONSOLE_MENUCONTROL_MSG::CommandIdHigh</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00658">_CONSOLE_MENUCONTROL_MSG::CommandIdLow</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00656">_CONSOLE_MENUCONTROL_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00660">_CONSOLE_MENUCONTROL_MSG::hMenu</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00657">_CONSOLE_MENUCONTROL_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00380            :
00381 
00382     Sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command <span class="keywordtype">id</span> range <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current screen buffer and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00383     menu handle.
00384 
00385 Parameters:
00386 
00387     hConsoleOutput - Supplies a console output handle.
00388 
00389     dwCommandIdLow - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lowest command <span class="keywordtype">id</span> to store in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
00390 
00391     dwCommandIdHigh - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> highest command <span class="keywordtype">id</span> to store in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input
00392         buffer.
00393 
00394 Return value:
00395 
00396     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00397 
00398     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00399         <span class="keyword">using</span> GetLastError.
00400 
00401 --*/
00402 
00403 {
00404     <a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html">PCONSOLE_MENUCONTROL_MSG</a> a = (<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html">PCONSOLE_MENUCONTROL_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00405     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00406     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00407     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00408 
00409     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o0">ConsoleHandle</a>,
00410                          &amp;Console
00411                         );
00412     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00413         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00414     }
00415     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00416                                  a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o1">OutputHandle</a>,
00417                                  CONSOLE_OUTPUT_HANDLE | CONSOLE_GRAPHICS_OUTPUT_HANDLE,
00418                                  GENERIC_WRITE,
00419                                  &amp;HandleData
00420                                 );
00421     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00422         a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o4">hMenu</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hMenu;
00423         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CommandIdLow = a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o2">CommandIdLow</a>;
00424         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CommandIdHigh = a-&gt;<a class="code" href="../../d5/d3/struct__CONSOLE__MENUCONTROL__MSG.html#o3">CommandIdHigh</a>;
00425     }
00426     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00427     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00428     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00429 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a286" doxytag="consrv.h::SrvConsoleNotifyLastClose" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SrvConsoleNotifyLastClose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01346">1346</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00383">CONSOLE_CLIENTPROCESSID</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00092">CONSOLE_NOTIFY_LAST_CLOSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00750">_CONSOLE_NOTIFYLASTCLOSE_MSG::ConsoleHandle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00231">_CONSOLE_INFORMATION::hProcessLastNotifyClose</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a154">PCONSOLE_NOTIFYLASTCLOSE_MSG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00232">_CONSOLE_INFORMATION::ProcessIdLastNotifyClose</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00195">_CONSOLE_INFORMATION::VDMProcessHandle</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00196">_CONSOLE_INFORMATION::VDMProcessId</a>.
<p>
<pre class="fragment"><div>01350 {
01351     <a class="code" href="../../d8/d3/struct__CONSOLE__NOTIFYLASTCLOSE__MSG.html">PCONSOLE_NOTIFYLASTCLOSE_MSG</a> a = (<a class="code" href="../../d8/d3/struct__CONSOLE__NOTIFYLASTCLOSE__MSG.html">PCONSOLE_NOTIFYLASTCLOSE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01352     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01353     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01354 
01355     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d3/struct__CONSOLE__NOTIFYLASTCLOSE__MSG.html#o0">ConsoleHandle</a>,
01356                          &amp;Console
01357                         );
01358     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01359         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01360     }
01361 <span class="comment">// williamh, Feb 2 1994.</span>
01362 <span class="comment">// this non-X86 special case is not necessary. We expect</span>
01363 <span class="comment">// ntvdm to call RegisterConsoleVDM API and there we do duplicate</span>
01364 <span class="comment">// the vdm process handle and grab its process id.</span>
01365 <span class="comment">// If we continue to do this we may hit the assert below</span>
01366 <span class="comment">// because when RegisterConsoleVDM failed(short of memory, for example)</span>
01367 <span class="comment">// the VDMProcessHandle may have been set and next time a vdm application</span>
01368 <span class="comment">// was launched from the same console(ntvdm will do the NotifyLastClose</span>
01369 <span class="comment">// before RegisterConsoleVDM).</span>
01370 <span class="preprocessor">#if 0</span>
01371 <span class="preprocessor"></span><span class="preprocessor">#if !defined(_X86_)</span>
01372 <span class="preprocessor"></span>    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a> == NULL);
01373     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(NtCurrentProcess(), <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01374             NtCurrentProcess(), &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>,
01375             0, FALSE, DUPLICATE_SAME_ACCESS);
01376     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01377         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01378     }
01379     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a> = <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>();
01380 <span class="preprocessor">#endif</span>
01381 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01382 <span class="preprocessor"></span>    <span class="comment">// Doesn't allow two or more processes to have last-close notify on</span>
01383     <span class="comment">// the same console</span>
01384     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a7">CONSOLE_NOTIFY_LAST_CLOSE</a>) {
01385         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01386         <span class="keywordflow">return</span> (ULONG)STATUS_ACCESS_DENIED;
01387     }
01388 
01389     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(NtCurrentProcess(), <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01390                                NtCurrentProcess(),
01391                                &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o72">hProcessLastNotifyClose</a>,
01392                                0, FALSE, DUPLICATE_SAME_ACCESS
01393                                );
01394     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01395         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01396         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01397     }
01398 
01399     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a7">CONSOLE_NOTIFY_LAST_CLOSE</a>;
01400     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o73">ProcessIdLastNotifyClose</a> = <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>();
01401     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01402     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01403     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01404 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a182" doxytag="consrv.h::SrvConsoleSubst" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvConsoleSubst           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a191" doxytag="consrv.h::SrvCreateConsoleScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvCreateConsoleScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">1607</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01390">AllocateIoHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00161">_SCREEN_INFORMATION::Attributes</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00132">CON_FACENAME</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00130">CON_FAMILY</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00135">CON_FONTCODEPAGE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00133">CON_FONTSIZE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00134">CON_FONTWEIGHT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00149">CONSOLE_GRAPHICS_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00299">CONSOLE_INHERITABLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00025">ConsoleAddShare()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00203">_CONSOLE_CREATESCREENBUFFER_MSG::ConsoleHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00250">CURSOR_SMALL_SIZE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00204">_CONSOLE_CREATESCREENBUFFER_MSG::DesiredAccess</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00207">_CONSOLE_CREATESCREENBUFFER_MSG::Flags</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00208">_CONSOLE_CREATESCREENBUFFER_MSG::GraphicsBufferInfo</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00211">_CONSOLE_CREATESCREENBUFFER_MSG::Handle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00209">_CONSOLE_CREATESCREENBUFFER_MSG::hMutex</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00339">INDEX_TO_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00205">_CONSOLE_CREATESCREENBUFFER_MSG::InheritHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01307">InitializeOutputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01155">InsertScreenBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00210">_CONSOLE_CREATESCREENBUFFER_MSG::lpBitmap</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00157">_SCREEN_INFORMATION::ShareAccess</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00206">_CONSOLE_CREATESCREENBUFFER_MSG::ShareMode</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01614                    :
01615 
01616     This routine creates a screen buffer and returns a handle to <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
01617 
01618 Arguments:
01619 
01620     ApiMessageData - Points to parameter structure.
01621 
01622 Return Value:
01623 
01624 --*/
01625 
01626 {
01627     <a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html">PCONSOLE_CREATESCREENBUFFER_MSG</a> a = (<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html">PCONSOLE_CREATESCREENBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01628     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01629     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01630     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01631     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01632     <a class="code" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a> ShareAccess;
01633     CHAR_INFO Fill;
01634     COORD WindowSize;
01635     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01636     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
01637     ULONG HandleType;
01638     <span class="keywordtype">int</span> FontIndex;
01639 
01640     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"SrvCreateConsoleScreenBuffer\n"</span>));
01641     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o0">ConsoleHandle</a>,
01642                          &amp;Console
01643                         );
01644     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01645         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01646     }
01647 
01648     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) {
01649         <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.lpBitMapInfo, a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.dwBitMapInfoLength, <span class="keyword">sizeof</span>(BYTE))) {
01650             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01651             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01652         }
01653     }
01654 
01655     <span class="keywordflow">try</span> {
01656         <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = (HANDLE) -1;
01657         ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
01658         HandleType = (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) ?
01659                       <a class="code" href="../../d1/d7/server_8h.html#a48">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a> : <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>;
01660         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o2">InheritHandle</a>)
01661             HandleType |= <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
01662         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a28">AllocateIoHandle</a>(ProcessData,
01663                                   HandleType,
01664                                   &amp;Handle
01665                                  );
01666         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01667             leave;
01668         }
01669         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
01670                                      Handle,
01671                                      &amp;HandleData
01672                                     );
01673         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01674         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01675             leave;
01676         }
01677 
01678         <span class="comment">//</span>
01679         <span class="comment">// create new screen buffer</span>
01680         <span class="comment">//</span>
01681 
01682         Fill.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
01683         Fill.Attributes = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>;
01684         WindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>);
01685         WindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>);
01686         FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a26">CON_FAMILY</a>(Console),
01687                                    <a class="code" href="../../d8/d5/consrv_8h.html#a28">CON_FACENAME</a>(Console),
01688                                    <a class="code" href="../../d8/d5/consrv_8h.html#a29">CON_FONTSIZE</a>(Console),
01689                                    <a class="code" href="../../d8/d5/consrv_8h.html#a30">CON_FONTWEIGHT</a>(Console),
01690                                    <a class="code" href="../../d8/d5/consrv_8h.html#a31">CON_FONTCODEPAGE</a>(Console)
01691                                   );
01692         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a42">CreateScreenBuffer</a>(&amp;ScreenInfo,WindowSize,
01693                                     FontIndex,
01694                                     WindowSize,
01695                                     Fill,Fill,Console,
01696                                     a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a>,&amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>,
01697                                     &amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o7">lpBitmap</a>,&amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o6">hMutex</a>,
01698                                     CURSOR_SMALL_SIZE, 
01699                                     NULL);
01700         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01701             leave;
01702         }
01703         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a26">InitializeOutputHandle</a>(HandleData,ScreenInfo);
01704         ShareAccess = &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o4">ShareAccess</a>;
01705 
01706         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a0">ConsoleAddShare</a>(a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o1">DesiredAccess</a>,
01707                                  a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o3">ShareMode</a>,
01708                                  ShareAccess,
01709                                  HandleData
01710                                 );
01711         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01712             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;RefCount--;
01713             <a class="code" href="../../d6/d2/output_8c.html#a46">FreeScreenBuffer</a>(ScreenInfo);
01714             leave;
01715         }
01716         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a22">InsertScreenBuffer</a>(Console, ScreenInfo);
01717         a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o8">Handle</a> = <a class="code" href="../../d1/d7/server_8h.html#a57">INDEX_TO_HANDLE</a>(Handle);
01718     } finally {
01719         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> != (HANDLE)-1) {
01720             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,
01721                          Handle
01722                         );
01723         }
01724         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01725     }
01726     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01727     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01728 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a225" doxytag="consrv.h::SrvDuplicateHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvDuplicateHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">2603</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00312">_HANDLE_DATA::Access</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01390">AllocateIoHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02844">CloseInputHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00299">CONSOLE_INHERITABLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00095">ConsoleDupShare()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00469">_CONSOLE_DUPHANDLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00471">_CONSOLE_DUPHANDLE_MSG::DesiredAccess</a>, <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00339">INDEX_TO_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00472">_CONSOLE_DUPHANDLE_MSG::InheritHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01335">InitializeInputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01307">InitializeOutputHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00473">_CONSOLE_DUPHANDLE_MSG::Options</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00313">_HANDLE_DATA::ShareAccess</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00470">_CONSOLE_DUPHANDLE_MSG::SourceHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00474">_CONSOLE_DUPHANDLE_MSG::TargetHandle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02610                    :
02611 
02612     This routine duplicates an input or output handle.
02613 
02614 Arguments:
02615 
02616     ApiMessageData - Points to parameter structure.
02617 
02618 Return Value:
02619 
02620 --*/
02621 
02622 {
02623     <a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html">PCONSOLE_DUPHANDLE_MSG</a> a = (<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html">PCONSOLE_DUPHANDLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02624     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02625     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> SourceHandleData,TargetHandleData;
02626     <a class="code" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a> ShareAccess;
02627     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02628     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
02629 
02630     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o0">ConsoleHandle</a>,
02631                          &amp;Console
02632                         );
02633     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02634         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02635     }
02636     ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
02637     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
02638                                  <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o1">SourceHandle</a>),
02639                                  &amp;SourceHandleData
02640                                 );
02641     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02642         <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
02643     }
02644     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o4">Options</a> &amp; DUPLICATE_SAME_ACCESS) {
02645         a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o2">DesiredAccess</a> = SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o1">Access</a>;
02646     }
02647 
02648     <span class="comment">//</span>
02649     <span class="comment">// make sure that requested access is a subset of source handle's access</span>
02650     <span class="comment">//</span>
02651 
02652     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o2">DesiredAccess</a> &amp; SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o1">Access</a>) != a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o2">DesiredAccess</a>) {
02653         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
02654         <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
02655     }
02656     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a28">AllocateIoHandle</a>(ProcessData,
02657                               SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a>,
02658                               &amp;a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>
02659                              );
02660     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02661         <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
02662     }
02663 
02664     <span class="comment">//</span>
02665     <span class="comment">// it's possible that AllocateIoHandle realloced the handle table,</span>
02666     <span class="comment">// so deference SourceHandle again.</span>
02667     <span class="comment">//</span>
02668 
02669     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
02670                                  <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o1">SourceHandle</a>),
02671                                  &amp;SourceHandleData
02672                                 );
02673     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02674     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02675         <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
02676     }
02677     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
02678                                  a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>,
02679                                  &amp;TargetHandleData
02680                                 );
02681     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02682     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02683         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,
02684                      a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>
02685                     );
02686         <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
02687     }
02688     <span class="keywordflow">if</span> (SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
02689         <span class="comment">// grab input lock</span>
02690         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a27">InitializeInputHandle</a>(TargetHandleData,
02691                                    SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer)) {
02692             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,
02693                          a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>
02694                         );
02695             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
02696             <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
02697         }
02698         ShareAccess = &amp;SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ShareAccess;
02699     }
02700     <span class="keywordflow">else</span> {
02701         <span class="comment">// grab output lock</span>
02702         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a26">InitializeOutputHandle</a>(TargetHandleData,SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer);
02703         ShareAccess = &amp;SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ShareAccess;
02704     }
02705     TargetHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> = SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a>;
02706     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o3">InheritHandle</a>) {
02707         TargetHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> |= <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
02708     } <span class="keywordflow">else</span> {
02709         TargetHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
02710     }
02711 
02712     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a1">ConsoleDupShare</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o2">DesiredAccess</a>,
02713                              SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o2">ShareAccess</a>,
02714                              ShareAccess,
02715                              TargetHandleData
02716                             );
02717     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02718         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,
02719                      a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>
02720                     );
02721         <span class="keywordflow">if</span> (SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
02722             SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;RefCount--;
02723         }
02724         <span class="keywordflow">else</span> {
02725             SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;RefCount--;
02726         }
02727     }
02728     <span class="keywordflow">else</span> {
02729         a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a> = <a class="code" href="../../d1/d7/server_8h.html#a57">INDEX_TO_HANDLE</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>);
02730     }
02731 
02732     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o4">Options</a> &amp; DUPLICATE_CLOSE_SOURCE) {
02733         <span class="keywordflow">if</span> (SourceHandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>)
02734             <a class="code" href="../../d0/d7/server_2stream_8c.html#a35">CloseInputHandle</a>(ProcessData,Console,SourceHandleData,<a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o1">SourceHandle</a>));
02735         <span class="keywordflow">else</span> {
02736             <a class="code" href="../../d0/d7/server_2stream_8c.html#a36">CloseOutputHandle</a>(ProcessData,Console,SourceHandleData,<a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o1">SourceHandle</a>),TRUE);
02737         }
02738     }
02739 
02740 <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>:
02741     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02742     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02743     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02744 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a246" doxytag="consrv.h::SrvExpungeConsoleCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvExpungeConsoleCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01393">1393</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00547">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::ConsoleHandle</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03227">EmptyCommandHistory()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00549">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00548">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00551">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01397 {
01398     <a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html">PCONSOLE_EXPUNGECOMMANDHISTORY_MSG</a> a = (<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html">PCONSOLE_EXPUNGECOMMANDHISTORY_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01399     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01400     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01401 
01402     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o0">ConsoleHandle</a>,
01403                          &amp;Console
01404                         );
01405     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01406         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01407     }
01408 
01409     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o2">Exe</a>, a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01410         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01411         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01412     }
01413 
01414     <a class="code" href="../../d4/d1/cmdline_8h.html#a43">EmptyCommandHistory</a>(<a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01415                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o2">Exe</a>,
01416                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a>,
01417                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o4">UnicodeExe</a>));
01418     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01419     <span class="keywordflow">return</span> STATUS_SUCCESS;
01420     UNREFERENCED_PARAMETER(ReplyStatus);
01421 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a190" doxytag="consrv.h::SrvFillConsoleOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvFillConsoleOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01568">1568</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00295">_CONSOLE_FILLCONSOLEOUTPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00299">_CONSOLE_FILLCONSOLEOUTPUT_MSG::Element</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00298">_CONSOLE_FILLCONSOLEOUTPUT_MSG::ElementType</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00300">_CONSOLE_FILLCONSOLEOUTPUT_MSG::Length</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00296">_CONSOLE_FILLCONSOLEOUTPUT_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00297">_CONSOLE_FILLCONSOLEOUTPUT_MSG::WriteCoord</a>.
<p>
<pre class="fragment"><div>01572 {
01573     <a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html">PCONSOLE_FILLCONSOLEOUTPUT_MSG</a> a = (<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html">PCONSOLE_FILLCONSOLEOUTPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01574     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01575     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01576     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01577 
01578     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a>,
01579                          &amp;Console
01580                         );
01581     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01582         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01583     }
01584     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01585                                  a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o1">OutputHandle</a>,
01586                                  CONSOLE_OUTPUT_HANDLE,
01587                                  GENERIC_WRITE,
01588                                  &amp;HandleData
01589                                 );
01590     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01591         a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o5">Length</a> = 0;
01592     } <span class="keywordflow">else</span> {
01593         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01594                           a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o4">Element</a>,
01595                           a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o2">WriteCoord</a>,
01596                           a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o3">ElementType</a>,
01597                           &amp;a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o5">Length</a>
01598                          );
01599     }
01600     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01601     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01602     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01603 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a206" doxytag="consrv.h::SrvFlushConsoleInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvFlushConsoleInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00524">524</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00378">_CONSOLE_FLUSHINPUTBUFFER_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00485">FlushInputBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00379">_CONSOLE_FLUSHINPUTBUFFER_MSG::InputHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00528 {
00529     <a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html">PCONSOLE_FLUSHINPUTBUFFER_MSG</a> a = (<a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html">PCONSOLE_FLUSHINPUTBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00530     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00531     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00532     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00533 
00534     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html#o0">ConsoleHandle</a>,
00535                          &amp;Console
00536                         );
00537     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00538         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00539     }
00540     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00541                                  a-&gt;<a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html#o1">InputHandle</a>,
00542                                  CONSOLE_INPUT_HANDLE,
00543                                  GENERIC_WRITE,
00544                                  &amp;HandleData
00545                                 );
00546     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00547         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a23">FlushInputBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer);
00548     }
00549     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00550     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00551     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00552 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a265" doxytag="consrv.h::SrvFreeConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvFreeConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01608">1608</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00383">CONSOLE_CLIENTPROCESSID</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00399">CONSOLE_GETCONSOLEAPPFROMPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00405">CONSOLE_GETCONSOLEHANDLEFROMPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00400">CONSOLE_SETCONSOLEAPP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00608">_CONSOLE_FREE_MSG::ConsoleHandle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a116">PCONSOLE_FREE_MSG</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01612 {
01613     <a class="code" href="../../d4/d0/struct__CONSOLE__FREE__MSG.html">PCONSOLE_FREE_MSG</a> a = (<a class="code" href="../../d4/d0/struct__CONSOLE__FREE__MSG.html">PCONSOLE_FREE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01614     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
01615     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01616 
01617     ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
01618     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d1/d7/server_8h.html#a86">CONSOLE_GETCONSOLEAPPFROMPROCESSDATA</a>(ProcessData));
01619 
01620     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d1/d7/server_8h.html#a91">CONSOLE_GETCONSOLEHANDLEFROMPROCESSDATA</a>(ProcessData)==a-&gt;<a class="code" href="../../d4/d0/struct__CONSOLE__FREE__MSG.html#o0">ConsoleHandle</a>);
01621 
01622     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/srvinit_8c.html#a37">RemoveConsole</a>(ProcessData,
01623             <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01624             <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>());
01625 
01626     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01627         <a class="code" href="../../d1/d7/server_8h.html#a87">CONSOLE_SETCONSOLEAPP</a>(FALSE);
01628     }
01629 
01630     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01631     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01632 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a204" doxytag="consrv.h::SrvGenerateConsoleCtrlEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGenerateConsoleCtrlEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00444">444</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d1/d7/server_8h.html#a100">CONSOLE_PROCESS_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00754">_CONSOLE_CTRLEVENT_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00755">_CONSOLE_CTRLEVENT_MSG::CtrlEvent</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03430">HandleCtrlEvent()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00224">_CONSOLE_INFORMATION::LimitingProcessId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d7/server_8h.html#a101">PCONSOLE_PROCESS_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00048">_CONSOLE_PROCESS_HANDLE::Process</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00756">_CONSOLE_CTRLEVENT_MSG::ProcessGroupId</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00148">_CONSOLE_INFORMATION::ProcessHandleList</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00448 {
00449     <a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html">PCONSOLE_CTRLEVENT_MSG</a> a = (<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html">PCONSOLE_CTRLEVENT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00450     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00451     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00452 
00453     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o0">ConsoleHandle</a>,
00454                          &amp;Console
00455                         );
00456     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00457         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00458     }
00459     <span class="keywordflow">try</span> {
00460         <span class="comment">//</span>
00461         <span class="comment">// Make sure the process group id is valid</span>
00462         <span class="comment">//</span>
00463         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o2">ProcessGroupId</a>) {
00464             <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
00465             PLIST_ENTRY ListHead, ListNext;
00466 
00467             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00468             ListHead = &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o19">ProcessHandleList</a>;
00469             ListNext = ListHead-&gt;Flink;
00470             <span class="keywordflow">while</span> (ListNext != ListHead) {
00471                 ProcessHandleRecord = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>, ListLink );
00472                 ListNext = ListNext-&gt;Flink;
00473                 <span class="keywordflow">if</span> (ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o2">Process</a>-&gt;ProcessGroupId == a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o2">ProcessGroupId</a>) {
00474                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00475                     <span class="keywordflow">break</span>;
00476                 }
00477             }
00478         }
00479         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00480             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o67">LimitingProcessId</a> = a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o2">ProcessGroupId</a>;
00481             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a50">HandleCtrlEvent</a>(Console, a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o1">CtrlEvent</a>);
00482         }
00483 
00484     } finally {
00485         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00486     }
00487     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00488     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00489 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a241" doxytag="consrv.h::SrvGetConsoleAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">731</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00503">_CONSOLE_GETALIAS_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00509">_CONSOLE_GETALIAS_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00506">_CONSOLE_GETALIAS_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00507">_CONSOLE_GETALIAS_MSG::Source</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00504">_CONSOLE_GETALIAS_MSG::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00508">_CONSOLE_GETALIAS_MSG::Target</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00505">_CONSOLE_GETALIAS_MSG::TargetLength</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00510">_CONSOLE_GETALIAS_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00511">_CONSOLE_GETALIAS_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00738                    :
00739 
00740     This routine get a command line alias from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global set.
00741 
00742 Arguments:
00743 
00744     m - message containing api parameters
00745 
00746     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00747 
00748 Return Value:
00749 
00750 --*/
00751 
00752 {
00753 
00754     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00755     <a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html">PCONSOLE_GETALIAS_MSG</a> a = (<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html">PCONSOLE_GETALIAS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00756     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00757     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00758     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00759     LPWSTR Source,Target;
00760 
00761     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o0">ConsoleHandle</a>,
00762                          &amp;Console
00763                         );
00764     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00765         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00766     }
00767 
00768     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>, a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00769         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>, a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00770         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o6">Exe</a>, a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00771 
00772         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00773         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00774     }
00775 
00776     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o7">Unicode</a>) {
00777         Source = a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>;
00778         Target = a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>;
00779     } <span class="keywordflow">else</span> {
00780         Source = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00781         <span class="keywordflow">if</span> (Source == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00782             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00783             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00784         }
00785         Target = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00786         <span class="keywordflow">if</span> (Target == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00787             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00788             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00789             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00790         }
00791         a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> * <span class="keyword">sizeof</span>(WCHAR));
00792         a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00793                                             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>,
00794                                             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>,
00795                                             Source,
00796                                             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>);
00797         a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a> *= 2;
00798     }
00799     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o6">Exe</a>,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a>,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o8">UnicodeExe</a>);
00800     <span class="keywordflow">if</span> (ExeAliasList) {
00801         Alias = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a>(ExeAliasList,Source,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>);
00802         <span class="keywordflow">if</span> (Alias) {
00803             <span class="keywordflow">if</span> (Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + <span class="keyword">sizeof</span>(WCHAR) &gt; a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>) {
00804                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
00805             } <span class="keywordflow">else</span> {
00806                 a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + <span class="keyword">sizeof</span>(WCHAR);
00807                 RtlCopyMemory(Target,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>);
00808                 Target[Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR)] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00809             }
00810         } <span class="keywordflow">else</span> {
00811             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00812         }
00813     } <span class="keywordflow">else</span> {
00814         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00815     }
00816     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o7">Unicode</a>) {
00817         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00818             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00819                                              Target,
00820                                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> / <span class="keyword">sizeof</span>(WCHAR),
00821                                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>,
00822                                              <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>)
00823                                              );
00824         }
00825         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00826         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Target);
00827     }
00828     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00829     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00830     UNREFERENCED_PARAMETER(ReplyStatus);
00831 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a244" doxytag="consrv.h::SrvGetConsoleAliases" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliases           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">903</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00536">_CONSOLE_GETALIASES_MSG::AliasesBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00535">_CONSOLE_GETALIASES_MSG::AliasesBufferLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00172">_EXE_ALIAS_LIST::AliasList</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00530">_CONSOLE_GETALIASES_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00532">_CONSOLE_GETALIASES_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00531">_CONSOLE_GETALIASES_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00164">_ALIAS::Source</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00162">_ALIAS::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00533">_CONSOLE_GETALIASES_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00534">_CONSOLE_GETALIASES_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00907 {
00908     <a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html">PCONSOLE_GETALIASES_MSG</a> a = (<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html">PCONSOLE_GETALIASES_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00909     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00910     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00911     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00912     PLIST_ENTRY ListHead, ListNext;
00913     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AliasesBufferLength;
00914     LPWSTR AliasesBufferPtrW;
00915     LPSTR  AliasesBufferPtrA;
00916     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00917 
00918     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o0">ConsoleHandle</a>,
00919                          &amp;Console
00920                         );
00921     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00922         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00923     }
00924 
00925     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>, a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00926         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o2">Exe</a>, a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00927 
00928         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00929         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00930     }
00931 
00932     AliasesBufferLength = a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a>;
00933     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o3">Unicode</a>) {
00934         AliasesBufferPtrW = a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>;
00935     } <span class="keywordflow">else</span> {
00936         AliasesBufferPtrA = a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>;
00937     }
00938     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> = 0;
00939     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o2">Exe</a>,a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a>,a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o4">UnicodeExe</a>);
00940     <span class="keywordflow">if</span> (ExeAliasList) {
00941         ListHead = &amp;ExeAliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o3">AliasList</a>;
00942         ListNext = ListHead-&gt;Flink;
00943         <span class="keywordflow">while</span> (ListNext != ListHead) {
00944             Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00945             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o3">Unicode</a>) {
00946                 <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + (2*<span class="keyword">sizeof</span>(WCHAR)))
00947                     &lt;= AliasesBufferLength) {
00948                     RtlCopyMemory(AliasesBufferPtrW,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a>);
00949                     AliasesBufferPtrW+=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a>/<span class="keyword">sizeof</span>(WCHAR);
00950                     *AliasesBufferPtrW++= (WCHAR)<span class="charliteral">'='</span>;
00951                     RtlCopyMemory(AliasesBufferPtrW,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>);
00952                     AliasesBufferPtrW+=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR);
00953                     *AliasesBufferPtrW++= (WCHAR)<span class="charliteral">'\0'</span>;
00954                     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> += Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + (2*<span class="keyword">sizeof</span>(WCHAR));  <span class="comment">// +2 is for = and term null</span>
00955                 } <span class="keywordflow">else</span> {
00956                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00957                     <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
00958                 }
00959             } <span class="keywordflow">else</span> {
00960                 <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> + ((Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>)/<span class="keyword">sizeof</span>(WCHAR)) + (2*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)))
00961                     &lt;= AliasesBufferLength) {
00962                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> SourceLength,TargetLength;
00963                     SourceLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00964                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>,
00965                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> / <span class="keyword">sizeof</span>(WCHAR),
00966                                                  AliasesBufferPtrA,
00967                                                  <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a>)
00968                                                  );
00969                     AliasesBufferPtrA+=SourceLength;
00970                     *AliasesBufferPtrA++ = <span class="charliteral">'='</span>;
00971                     TargetLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00972                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,
00973                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> / <span class="keyword">sizeof</span>(WCHAR),
00974                                                  AliasesBufferPtrA,
00975                                                  <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>)
00976                                                  );
00977                     AliasesBufferPtrA+=TargetLength;
00978                     *AliasesBufferPtrA++= <span class="charliteral">'\0'</span>;
00979                     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> += SourceLength + TargetLength + (2*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));  <span class="comment">// +2 is for = and term null</span>
00980                 } <span class="keywordflow">else</span> {
00981                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00982                     <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
00983                 }
00984             }
00985             ListNext = ListNext-&gt;Flink;
00986         }
00987     }
00988     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00989     <span class="keywordflow">return</span> STATUS_SUCCESS;
00990     UNREFERENCED_PARAMETER(ReplyStatus);
00991 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a242" doxytag="consrv.h::SrvGetConsoleAliasesLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliasesLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00834">834</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00518">_CONSOLE_GETALIASESLENGTH_MSG::AliasesLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00172">_EXE_ALIAS_LIST::AliasList</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00515">_CONSOLE_GETALIASESLENGTH_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00517">_CONSOLE_GETALIASESLENGTH_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00516">_CONSOLE_GETALIASESLENGTH_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00162">_ALIAS::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00519">_CONSOLE_GETALIASESLENGTH_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00520">_CONSOLE_GETALIASESLENGTH_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00838 {
00839     <a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html">PCONSOLE_GETALIASESLENGTH_MSG</a> a = (<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html">PCONSOLE_GETALIASESLENGTH_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00840     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00841     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00842     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00843     PLIST_ENTRY ListHead, ListNext;
00844     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00845 
00846     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o0">ConsoleHandle</a>,
00847                          &amp;Console
00848                         );
00849     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00850         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00851     }
00852 
00853     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o2">Exe</a>, a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00854         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00855         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00856     }
00857 
00858     a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o3">AliasesLength</a> = 0;
00859     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o2">Exe</a>,a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a>,a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o5">UnicodeExe</a>);
00860     <span class="keywordflow">if</span> (ExeAliasList) {
00861         ListHead = &amp;ExeAliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o3">AliasList</a>;
00862         ListNext = ListHead-&gt;Flink;
00863         <span class="keywordflow">while</span> (ListNext != ListHead) {
00864             Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00865             a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o3">AliasesLength</a> += Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + (2*<span class="keyword">sizeof</span>(WCHAR));  <span class="comment">// +2 is for = and term null</span>
00866             ListNext = ListNext-&gt;Flink;
00867         }
00868     }
00869     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o4">Unicode</a>) {
00870         a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o3">AliasesLength</a> /= <span class="keyword">sizeof</span>(WCHAR);
00871     }
00872     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00873     <span class="keywordflow">return</span> STATUS_SUCCESS;
00874     UNREFERENCED_PARAMETER(ReplyStatus);
00875 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a245" doxytag="consrv.h::SrvGetConsoleAliasExes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliasExes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">1029</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00542">_CONSOLE_GETALIASEXES_MSG::AliasExesBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00541">_CONSOLE_GETALIASEXES_MSG::AliasExesBufferLength</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00540">_CONSOLE_GETALIASEXES_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00150">_CONSOLE_INFORMATION::ExeAliasList</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00170">_EXE_ALIAS_LIST::ExeLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00171">_EXE_ALIAS_LIST::ExeName</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00543">_CONSOLE_GETALIASEXES_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01033 {
01034     <a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html">PCONSOLE_GETALIASEXES_MSG</a> a = (<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html">PCONSOLE_GETALIASEXES_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01035     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01036     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
01037     PLIST_ENTRY ListHead, ListNext;
01038     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AliasExesBufferLength;
01039     LPWSTR AliasExesBufferPtrW;
01040     LPSTR  AliasExesBufferPtrA;
01041     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01042 
01043     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o0">ConsoleHandle</a>,
01044                          &amp;Console
01045                         );
01046     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01047         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01048     }
01049 
01050     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>, a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01051         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01052         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01053     }
01054 
01055     AliasExesBufferLength = a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a>;
01056     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o3">Unicode</a>) {
01057         AliasExesBufferPtrW = a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>;
01058     } <span class="keywordflow">else</span> {
01059         AliasExesBufferPtrA = a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>;
01060     }
01061     a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> = 0;
01062     ListHead = &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o21">ExeAliasList</a>;
01063     ListNext = ListHead-&gt;Flink;
01064     <span class="keywordflow">while</span> (ListNext != ListHead) {
01065         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
01066         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o3">Unicode</a>) {
01067             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> + AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> + (1*<span class="keyword">sizeof</span>(WCHAR)))
01068                 &lt;= AliasExesBufferLength) {
01069                 RtlCopyMemory(AliasExesBufferPtrW,AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>);
01070                 AliasExesBufferPtrW+=AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>/<span class="keyword">sizeof</span>(WCHAR);
01071                 *AliasExesBufferPtrW++= (WCHAR)<span class="charliteral">'\0'</span>;
01072                 a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> += AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> + (1*<span class="keyword">sizeof</span>(WCHAR));  <span class="comment">// +1 is term null</span>
01073             } <span class="keywordflow">else</span> {
01074                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01075                 <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
01076             }
01077         } <span class="keywordflow">else</span> {
01078             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> + (AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>/<span class="keyword">sizeof</span>(WCHAR)) + (1*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)))
01079                 &lt;= AliasExesBufferLength) {
01080                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> Length;
01081                 Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
01082                                         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,
01083                                         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> / <span class="keyword">sizeof</span>(WCHAR),
01084                                         AliasExesBufferPtrA,
01085                                         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>)
01086                                         );
01087                 AliasExesBufferPtrA+=Length;
01088                 *AliasExesBufferPtrA++= (WCHAR)<span class="charliteral">'\0'</span>;
01089                 a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> += Length + (1*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));  <span class="comment">// +1 is term null</span>
01090             } <span class="keywordflow">else</span> {
01091                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01092                 <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
01093             }
01094         }
01095         ListNext = ListNext-&gt;Flink;
01096     }
01097     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01098     <span class="keywordflow">return</span> STATUS_SUCCESS;
01099     UNREFERENCED_PARAMETER(ReplyStatus);
01100 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a243" doxytag="consrv.h::SrvGetConsoleAliasExesLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliasExesLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00994">994</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00525">_CONSOLE_GETALIASEXESLENGTH_MSG::AliasExesLength</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00524">_CONSOLE_GETALIASEXESLENGTH_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00150">_CONSOLE_INFORMATION::ExeAliasList</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00170">_EXE_ALIAS_LIST::ExeLength</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00526">_CONSOLE_GETALIASEXESLENGTH_MSG::Unicode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00998 {
00999     <a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html">PCONSOLE_GETALIASEXESLENGTH_MSG</a> a = (<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html">PCONSOLE_GETALIASEXESLENGTH_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01000     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01001     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
01002     PLIST_ENTRY ListHead, ListNext;
01003     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01004 
01005     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o0">ConsoleHandle</a>,
01006                          &amp;Console
01007                         );
01008     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01009         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01010     }
01011 
01012     a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o1">AliasExesLength</a> = 0;
01013     ListHead = &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o21">ExeAliasList</a>;
01014     ListNext = ListHead-&gt;Flink;
01015     <span class="keywordflow">while</span> (ListNext != ListHead) {
01016         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
01017         a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o1">AliasExesLength</a> += AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> + (1*<span class="keyword">sizeof</span>(WCHAR)); <span class="comment">// +1 for term null</span>
01018         ListNext = ListNext-&gt;Flink;
01019     }
01020     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o2">Unicode</a>) {
01021         a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o1">AliasExesLength</a> /= <span class="keyword">sizeof</span>(WCHAR);
01022     }
01023     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01024     <span class="keywordflow">return</span> STATUS_SUCCESS;
01025     UNREFERENCED_PARAMETER(ReplyStatus);
01026 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a249" doxytag="consrv.h::SrvGetConsoleCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">1500</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00024">_COMMAND::Command</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00575">_CONSOLE_GETCOMMANDHISTORY_MSG::CommandBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00574">_CONSOLE_GETCOMMANDHISTORY_MSG::CommandBufferLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00079">_COMMAND_HISTORY::Commands</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00573">_CONSOLE_GETCOMMANDHISTORY_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00577">_CONSOLE_GETCOMMANDHISTORY_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00576">_CONSOLE_GETCOMMANDHISTORY_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00072">_COMMAND_HISTORY::NumberOfCommands</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00578">_CONSOLE_GETCOMMANDHISTORY_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00579">_CONSOLE_GETCOMMANDHISTORY_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01504 {
01505     <a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html">PCONSOLE_GETCOMMANDHISTORY_MSG</a> a = (<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html">PCONSOLE_GETCOMMANDHISTORY_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01506     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01507     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01508     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,CommandHistoryLength;
01509     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
01510     PWCHAR CommandBufferW;
01511     PCHAR CommandBufferA;
01512 
01513     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o0">ConsoleHandle</a>,
01514                          &amp;Console
01515                         );
01516     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01517         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01518     }
01519 
01520     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>, a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01521         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o4">Exe</a>, a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01522 
01523         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01524         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01525     }
01526 
01527     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o5">Unicode</a>) {
01528         CommandBufferW=a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>;
01529     } <span class="keywordflow">else</span> {
01530         CommandBufferA=a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>;
01531     }
01532     CommandHistoryLength=0;
01533     CommandHistory=<a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01534                                          a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o4">Exe</a>,
01535                                          a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a>,
01536                                          a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o6">UnicodeExe</a>);
01537     <span class="keywordflow">if</span> (CommandHistory) {
01538         <span class="keywordflow">for</span> (i=0;i&lt;CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>;i++) {
01539             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o5">Unicode</a>) {
01540                 <span class="keywordflow">if</span> ((CommandHistoryLength+CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR)) &lt;= a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>) {
01541                     RtlCopyMemory(CommandBufferW,CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>,CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>);
01542                     CommandBufferW+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR);
01543                     *CommandBufferW++=(WCHAR)<span class="charliteral">'\0'</span>;
01544                     CommandHistoryLength+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR);
01545                 } <span class="keywordflow">else</span> {
01546                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
01547                     <span class="keywordflow">break</span>;
01548                 }
01549             } <span class="keywordflow">else</span> {
01550                 <span class="keywordflow">if</span> ((CommandHistoryLength+(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR))+<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) &lt;= a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>) {
01551                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> Length;
01552                     Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
01553                                             CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>,
01554                                             CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a> / <span class="keyword">sizeof</span>(WCHAR),
01555                                             CommandBufferA,
01556                                             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>)
01557                                             );
01558                     CommandBufferA+=Length;
01559                     *CommandBufferA++=(WCHAR)<span class="charliteral">'\0'</span>;
01560                     CommandHistoryLength+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR);
01561                 } <span class="keywordflow">else</span> {
01562                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
01563                     <span class="keywordflow">break</span>;
01564                 }
01565             }
01566         }
01567     }
01568     a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>=CommandHistoryLength;
01569     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01570     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01571     UNREFERENCED_PARAMETER(ReplyStatus);
01572 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a248" doxytag="consrv.h::SrvGetConsoleCommandHistoryLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleCommandHistoryLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01458">1458</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00565">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::CommandHistoryLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00079">_COMMAND_HISTORY::Commands</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00564">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00567">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00566">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00072">_COMMAND_HISTORY::NumberOfCommands</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00568">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00569">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01462 {
01463     <a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html">PCONSOLE_GETCOMMANDHISTORYLENGTH_MSG</a> a = (<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html">PCONSOLE_GETCOMMANDHISTORYLENGTH_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01464     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01465     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01466     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
01467     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
01468 
01469     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o0">ConsoleHandle</a>,
01470                          &amp;Console
01471                         );
01472     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01473         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01474     }
01475 
01476     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o3">Exe</a>, a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01477         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01478         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01479     }
01480 
01481     a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o1">CommandHistoryLength</a>=0;
01482     CommandHistory=<a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01483                                          a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o3">Exe</a>,
01484                                          a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a>,
01485                                          a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o5">UnicodeExe</a>);
01486     <span class="keywordflow">if</span> (CommandHistory) {
01487         <span class="keywordflow">for</span> (i=0;i&lt;CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>;i++) {
01488             a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o1">CommandHistoryLength</a>+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR);
01489         }
01490     }
01491     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o4">Unicode</a>) {
01492         a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o1">CommandHistoryLength</a> /= <span class="keyword">sizeof</span>(WCHAR);
01493     }
01494     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01495     <span class="keywordflow">return</span> STATUS_SUCCESS;
01496     UNREFERENCED_PARAMETER(ReplyStatus);
01497 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a217" doxytag="consrv.h::SrvGetConsoleCP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01359">1359</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00713">_CONSOLE_GETCP_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00715">_CONSOLE_GETCP_MSG::Output</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00714">_CONSOLE_GETCP_MSG::wCodePageID</a>.
<p>
<pre class="fragment"><div>01363 {
01364     <a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html">PCONSOLE_GETCP_MSG</a> a = (<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html">PCONSOLE_GETCP_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01365     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01366     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01367 
01368     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o0">ConsoleHandle</a>,
01369                          &amp;Console
01370                         );
01371     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01372         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01373     }
01374     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o2">Output</a>) {
01375         a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o1">wCodePageID</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>;
01376     } <span class="keywordflow">else</span> {
01377         a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o1">wCodePageID</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>;
01378     }
01379     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01380     <span class="keywordflow">return</span> STATUS_SUCCESS;
01381     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01382 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a202" doxytag="consrv.h::SrvGetConsoleCurrentFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleCurrentFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00315">315</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00365">_CONSOLE_GETCURRENTFONT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00368">_CONSOLE_GETCURRENTFONT_MSG::FontIndex</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00369">_CONSOLE_GETCURRENTFONT_MSG::FontSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01053">GetCurrentFont()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00367">_CONSOLE_GETCURRENTFONT_MSG::MaximumWindow</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00366">_CONSOLE_GETCURRENTFONT_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00319 {
00320     <a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html">PCONSOLE_GETCURRENTFONT_MSG</a> a = (<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html">PCONSOLE_GETCURRENTFONT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00321     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00322     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00323     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00324 
00325     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o0">ConsoleHandle</a>,
00326                          &amp;Console
00327                         );
00328     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00329         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00330     }
00331     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00332                                  a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o1">OutputHandle</a>,
00333                                  CONSOLE_OUTPUT_HANDLE,
00334                                  GENERIC_READ,
00335                                  &amp;HandleData
00336                                 );
00337     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00338         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00339             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00340         } <span class="keywordflow">else</span> {
00341             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a32">GetCurrentFont</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00342                                   a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o2">MaximumWindow</a>,
00343                                   &amp;a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o3">FontIndex</a>,
00344                                   &amp;a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o4">FontSize</a>
00345                                  );
00346         }
00347     }
00348     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00349     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00350     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00351 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a198" doxytag="consrv.h::SrvGetConsoleCursorInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleCursorInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00179">179</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00338">_CONSOLE_GETCURSORINFO_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00340">_CONSOLE_GETCURSORINFO_MSG::CursorSize</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00339">_CONSOLE_GETCURSORINFO_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00341">_CONSOLE_GETCURSORINFO_MSG::Visible</a>.
<p>
<pre class="fragment"><div>00183 {
00184     <a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html">PCONSOLE_GETCURSORINFO_MSG</a> a = (<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html">PCONSOLE_GETCURSORINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00185     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00186     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00187     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00188 
00189     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o0">ConsoleHandle</a>,
00190                          &amp;Console
00191                         );
00192     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00193         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00194     }
00195     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00196                                  a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o1">OutputHandle</a>,
00197                                  CONSOLE_OUTPUT_HANDLE,
00198                                  GENERIC_READ,
00199                                  &amp;HandleData
00200                                 );
00201     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00202         a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o2">CursorSize</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;BufferInfo.TextInfo.CursorSize;
00203         a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o3">Visible</a> = (BOOLEAN) HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;BufferInfo.TextInfo.CursorVisible;
00204     }
00205     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00206     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00207     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00208 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a289" doxytag="consrv.h::SrvGetConsoleDisplayMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleDisplayMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02355">2355</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00708">_CONSOLE_GETDISPLAYMODE_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00709">_CONSOLE_GETDISPLAYMODE_MSG::ModeFlags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02359 {
02360     <a class="code" href="../../d7/d1/struct__CONSOLE__GETDISPLAYMODE__MSG.html">PCONSOLE_GETDISPLAYMODE_MSG</a> a = (<a class="code" href="../../d7/d1/struct__CONSOLE__GETDISPLAYMODE__MSG.html">PCONSOLE_GETDISPLAYMODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02361     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02362     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02363 
02364     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d1/struct__CONSOLE__GETDISPLAYMODE__MSG.html#o0">ConsoleHandle</a>,
02365                          &amp;Console
02366                         );
02367     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02368         a-&gt;<a class="code" href="../../d7/d1/struct__CONSOLE__GETDISPLAYMODE__MSG.html#o1">ModeFlags</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a>;
02369         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02370     }
02371     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02372     UNREFERENCED_PARAMETER(ReplyStatus);
02373 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a200" doxytag="consrv.h::SrvGetConsoleFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00233">233</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00353">_CONSOLE_GETFONTINFO_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00350">_CONSOLE_GETFONTINFO_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">GetAvailableFonts()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00352">_CONSOLE_GETFONTINFO_MSG::MaximumWindow</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00354">_CONSOLE_GETFONTINFO_MSG::NumFonts</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00351">_CONSOLE_GETFONTINFO_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00237 {
00238     <a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html">PCONSOLE_GETFONTINFO_MSG</a> a = (<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html">PCONSOLE_GETFONTINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00239     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00240     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00241     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00242 
00243     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o0">ConsoleHandle</a>,
00244                          &amp;Console
00245                         );
00246     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00247         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00248     }
00249 
00250     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o4">NumFonts</a>, <span class="keyword">sizeof</span>(*a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o3">BufPtr</a>))) {
00251         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00252         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00253     }
00254 
00255     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00256                                  a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o1">OutputHandle</a>,
00257                                  CONSOLE_OUTPUT_HANDLE,
00258                                  GENERIC_READ,
00259                                  &amp;HandleData
00260                                 );
00261     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00262         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00263             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00264         } <span class="keywordflow">else</span> {
00265             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a30">GetAvailableFonts</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00266                                      a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o2">MaximumWindow</a>,
00267                                      a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o3">BufPtr</a>,
00268                                      &amp;a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o4">NumFonts</a>
00269                                     );
00270         }
00271     }
00272     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00273     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00274     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00275 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a201" doxytag="consrv.h::SrvGetConsoleFontSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleFontSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00278">278</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00358">_CONSOLE_GETFONTSIZE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00360">_CONSOLE_GETFONTSIZE_MSG::FontIndex</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00361">_CONSOLE_GETFONTSIZE_MSG::FontSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01041">GetFontSize()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00359">_CONSOLE_GETFONTSIZE_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00282 {
00283     <a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html">PCONSOLE_GETFONTSIZE_MSG</a> a = (<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html">PCONSOLE_GETFONTSIZE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00284     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00285     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00286     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00287 
00288     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o0">ConsoleHandle</a>,
00289                          &amp;Console
00290                         );
00291     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00292         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00293     }
00294     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00295                                  a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o1">OutputHandle</a>,
00296                                  CONSOLE_OUTPUT_HANDLE,
00297                                  GENERIC_READ,
00298                                  &amp;HandleData
00299                                 );
00300     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00301         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00302             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00303         } <span class="keywordflow">else</span> {
00304             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a31">GetFontSize</a>(a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o2">FontIndex</a>,
00305                                &amp;a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o3">FontSize</a>
00306                               );
00307         }
00308     }
00309     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00310     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00311     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00312 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a287" doxytag="consrv.h::SrvGetConsoleHardwareState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleHardwareState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02232">2232</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00694">_CONSOLE_GETHARDWARESTATE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00697">_CONSOLE_GETHARDWARESTATE_MSG::FontSize</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00115">_MODE_FONT_PAIR::FontSize</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00120">ModeFontPairs</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00695">_CONSOLE_GETHARDWARESTATE_MSG::OutputHandle</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00069">RegModeFontPairs</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00696">_CONSOLE_GETHARDWARESTATE_MSG::Resolution</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00114">_MODE_FONT_PAIR::Resolution</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02236 {
02237 <span class="preprocessor">#ifdef i386</span>
02238 <span class="preprocessor"></span>    <a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html">PCONSOLE_GETHARDWARESTATE_MSG</a> a = (<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html">PCONSOLE_GETHARDWARESTATE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02239     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02240     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02241     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02242     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
02243 
02244     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o0">ConsoleHandle</a>,
02245                          &amp;Console
02246                         );
02247     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02248         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02249     }
02250     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
02251                                  a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o1">OutputHandle</a>,
02252                                  CONSOLE_OUTPUT_HANDLE,
02253                                  GENERIC_READ,
02254                                  &amp;HandleData
02255                                 );
02256     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02257         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
02258         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex == -1) {
02259             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02260             <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
02261         }
02262 <span class="preprocessor">#if defined(FE_SB)</span>
02263 <span class="preprocessor"></span>        a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o2">Resolution</a> = <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>;
02264         a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o3">FontSize</a> = <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o3">FontSize</a>;
02265 <span class="preprocessor">#else</span>
02266 <span class="preprocessor"></span>        a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o2">Resolution</a> = <a class="code" href="../../d7/d4/server_2private_8c.html#a28">ModeFontPairs</a>[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>;
02267         a-&gt;<a class="code" href="../../d1/d2/struct__CONSOLE__GETHARDWARESTATE__MSG.html#o3">FontSize</a> = <a class="code" href="../../d7/d4/server_2private_8c.html#a28">ModeFontPairs</a>[ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o3">FontSize</a>;
02268 <span class="preprocessor">#endif</span>
02269 <span class="preprocessor"></span>    }
02270     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02271     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02272 <span class="preprocessor">#else</span>
02273 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
02274     UNREFERENCED_PARAMETER(m);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02275 <span class="preprocessor">#endif</span>
02276 <span class="preprocessor"></span>    UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02277 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a184" doxytag="consrv.h::SrvGetConsoleInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">556</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00229">_CONSOLE_GETCONSOLEINPUT_MSG::BufPtr</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00023">_DIRECT_READ_DATA::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00226">_CONSOLE_GETCONSOLEINPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d3/d8/directio_8h.html#a0">DIRECT_READ_DATA</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00231">_CONSOLE_GETCONSOLEINPUT_MSG::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00025">_DIRECT_READ_DATA::HandleIndex</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00223">INPUT_RECORD_BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00227">_CONSOLE_GETCONSOLEINPUT_MSG::InputHandle</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00022">_DIRECT_READ_DATA::InputInfo</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00230">_CONSOLE_GETCONSOLEINPUT_MSG::NumRecords</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00024">_DIRECT_READ_DATA::ProcessData</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00959">ReadInputBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00228">_CONSOLE_GETCONSOLEINPUT_MSG::Record</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00232">_CONSOLE_GETCONSOLEINPUT_MSG::Unicode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00563                    :
00564 
00565     This routine reads or peeks input events.  In both cases, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> events
00566     are copied to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user's buffer.  In <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read <span class="keywordflow">case</span> they are removed
00567     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer and in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> peek <span class="keywordflow">case</span> they are not.
00568 
00569 Arguments:
00570 
00571     m - message containing api parameters
00572 
00573     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00574 
00575 Return Value:
00576 
00577 --*/
00578 
00579 {
00580     <a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a> a = (<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00581     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00582     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00583     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00584     PINPUT_RECORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00585     <a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html">DIRECT_READ_DATA</a> DirectReadData;
00586 <span class="preprocessor">#ifdef FE_SB</span>
00587 <span class="preprocessor"></span>    BOOLEAN fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00588     PDWORD  nLength;
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>
00591     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; ~CONSOLE_READ_VALID) {
00592         <span class="keywordflow">return</span> (ULONG)STATUS_INVALID_PARAMETER;
00593     }
00594 
00595     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o0">ConsoleHandle</a>,
00596                          &amp;Console
00597                         );
00598     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00599         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00600     }
00601     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00602                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o1">InputHandle</a>,
00603                                  CONSOLE_INPUT_HANDLE,
00604                                  GENERIC_READ,
00605                                  &amp;HandleData
00606                                 );
00607     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00608         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> = 0;
00609     } <span class="keywordflow">else</span> {
00610 
00611         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> &lt;= <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00612             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o2">Record</a>;
00613         } <span class="keywordflow">else</span> {
00614             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a>;
00615             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>, <span class="keyword">sizeof</span>(*Buffer))) {
00616                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00617                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00618             }
00619         }
00620 
00621         <span class="comment">//</span>
00622         <span class="comment">// if we're reading, wait for data.  if we're peeking, don't.</span>
00623         <span class="comment">//</span>
00624 
00625         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o0">InputInfo</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer;
00626         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o1">Console</a> = Console;
00627         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o2">ProcessData</a> = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
00628         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o3">HandleIndex</a> = <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o1">InputHandle</a>);
00629 <span class="preprocessor">#if defined(FE_SB)</span>
00630 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console) ) {
00631             Console-&gt;ReadConInpNumBytesUnicode = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00632             <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00633                 <span class="comment">/*</span>
00634 <span class="comment">                 * ASCII : a-&gt;NumRecords is ASCII byte count</span>
00635 <span class="comment">                 */</span>
00636                 <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
00637                     <span class="comment">/*</span>
00638 <span class="comment">                     * Saved DBCS Traling byte</span>
00639 <span class="comment">                     */</span>
00640                     *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte;
00641                     <span class="keywordflow">if</span> (!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE))
00642                         RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
00643 
00644                     <span class="keywordflow">if</span> (Console-&gt;ReadConInpNumBytesUnicode == 1) {
00645                         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00646                         <span class="keywordflow">return</span> STATUS_SUCCESS;
00647                     }
00648                     <span class="keywordflow">else</span> {
00649                         Console-&gt;ReadConInpNumBytesUnicode--;
00650                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++;
00651                         fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00652                         nLength = &amp;Console-&gt;ReadConInpNumBytesUnicode;
00653                     }
00654                 }
00655                 <span class="keywordflow">else</span> {
00656                     nLength = &amp;Console-&gt;ReadConInpNumBytesUnicode;
00657                 }
00658             }
00659             <span class="keywordflow">else</span> {
00660                 nLength = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00661             }
00662         }
00663         <span class="keywordflow">else</span> {
00664             nLength = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00665         }
00666         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a25">ReadInputBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00667                                  Buffer,
00668                                  nLength,
00669                                  !!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE),
00670                                  !(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOWAIT),
00671                                  FALSE,
00672                                  Console,
00673                                  HandleData,
00674                                  m,
00675                                  DirectReadWaitRoutine,
00676                                  &amp;DirectReadData,
00677                                  <span class="keyword">sizeof</span>(DirectReadData),
00678                                  FALSE,
00679                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>
00680                                 );
00681         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
00682             *ReplyStatus = CsrReplyPending;
00683         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00684             a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(Console,
00685                                                 Buffer,
00686                                                 fAddDbcsLead ?
00687                                                     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>-1 :
00688                                                     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00689                                                 Console-&gt;ReadConInpNumBytesUnicode,
00690                                                 a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE ?
00691                                                     NULL :
00692                                                     &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte
00693                                                );
00694             <span class="keywordflow">if</span> (fAddDbcsLead)
00695             {
00696                 a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>++;
00697                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>--;
00698             }
00699         }
00700 <span class="preprocessor">#else</span>
00701 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a25">ReadInputBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00702                                  Buffer,
00703                                  &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00704                                  !!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE),
00705                                  !(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOWAIT),
00706                                  FALSE,
00707                                  Console,
00708                                  HandleData,
00709                                  m,
00710                                  DirectReadWaitRoutine,
00711                                  &amp;DirectReadData,
00712                                  <span class="keyword">sizeof</span>(DirectReadData),
00713                                  FALSE
00714                                 );
00715         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
00716             *ReplyStatus = CsrReplyPending;
00717         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00718             <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(Console,
00719                                  Buffer,
00720                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>
00721                                 );
00722         }
00723 <span class="preprocessor">#endif</span>
00724 <span class="preprocessor"></span>    }
00725     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00726     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00727 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a218" doxytag="consrv.h::SrvGetConsoleKeyboardLayoutName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleKeyboardLayoutName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01385">1385</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00731">_CONSOLE_GETKEYBOARDLAYOUTNAME_MSG::achLayout</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00369">ActivateKeyboardLayout</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00730">_CONSOLE_GETKEYBOARDLAYOUTNAME_MSG::awchLayout</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00733">_CONSOLE_GETKEYBOARDLAYOUTNAME_MSG::bAnsi</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00728">_CONSOLE_GETKEYBOARDLAYOUTNAME_MSG::ConsoleHandle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l06099">GetNonBiDiKeyboardLayout()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00138">_CONSOLE_INFORMATION::hklActive</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00959">SystemParametersInfo()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01389 {
01390     <a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html">PCONSOLE_GETKEYBOARDLAYOUTNAME_MSG</a> a = (<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html">PCONSOLE_GETKEYBOARDLAYOUTNAME_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01391     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01392     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01393 
01394     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o0">ConsoleHandle</a>,
01395                          &amp;Console
01396                         );
01397     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01398         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01399     }
01400     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01401         <span class="comment">//</span>
01402         <span class="comment">// hklActive is not set yet. Let's initialize it here.</span>
01403         <span class="comment">//</span>
01404         <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/d2/output_8c.html#a31">GetNonBiDiKeyboardLayout</a>(HKL * phklActive);
01405 
01406         RIPMSG1(RIP_WARNING, <span class="stringliteral">"SrvGetConsoleKeyboardLayoutName: hklActive is not initialized. pCon=%p"</span>, Console);
01407 
01408         <a class="code" href="../../d5/d9/cltxt_8h.html#a26">SystemParametersInfo</a>(SPI_GETDEFAULTINPUTLANG, 0, &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>, FALSE);
01409         <a class="code" href="../../d6/d2/output_8c.html#a31">GetNonBiDiKeyboardLayout</a>(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>);
01410     }
01411     <a class="code" href="../../d3/d0/user32_8def.html#a45">ActivateKeyboardLayout</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>, 0);
01412     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o3">bAnsi</a>) {
01413         GetKeyboardLayoutNameA(a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o2">achLayout</a>);
01414     } <span class="keywordflow">else</span> {
01415         GetKeyboardLayoutNameW(a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o1">awchLayout</a>);
01416     }
01417     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01418     <span class="keywordflow">return</span> STATUS_SUCCESS;
01419     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01420 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a272" doxytag="consrv.h::SrvGetConsoleLangId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleLangId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02680">2680</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00824">_CONSOLE_LANGID_MSG::ConsoleHandle</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">GetConsoleLangId()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00825">_CONSOLE_LANGID_MSG::LangId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a160">PCONSOLE_LANGID_MSG</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02684 {
02685     <a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html">PCONSOLE_LANGID_MSG</a> a = (<a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html">PCONSOLE_LANGID_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02686     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02687     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02688 
02689     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html#o0">ConsoleHandle</a>,
02690                          &amp;Console
02691                         );
02692     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02693         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02694     }
02695     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/srvinit_8c.html#a45">GetConsoleLangId</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>, &amp;a-&gt;<a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html#o1">LangId</a>);
02696 
02697     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02698     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
02699     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02700 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a193" doxytag="consrv.h::SrvGetConsoleMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00033">33</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00300">CONSOLE_ANY_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00096">CONSOLE_QUICK_EDIT_MODE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00104">CONSOLE_USE_PRIVATE_FLAGS</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00304">_CONSOLE_MODE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00305">_CONSOLE_MODE_MSG::Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00180">_CONSOLE_INFORMATION::InsertMode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00306">_CONSOLE_MODE_MSG::Mode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00037 {
00038     <a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a> a = (<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00039     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00040     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00041     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00042 
00043     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o0">ConsoleHandle</a>,
00044                          &amp;Console
00045                         );
00046     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00047         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00048     }
00049     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00050                                  a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o1">Handle</a>,
00051                                  CONSOLE_ANY_HANDLE,
00052                                  GENERIC_READ,
00053                                  &amp;HandleData
00054                                 );
00055     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00056 
00057         <span class="comment">//</span>
00058         <span class="comment">// check handle type and access</span>
00059         <span class="comment">//</span>
00060 
00061         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
00062             a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode;
00063             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>) {
00064                 a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> |= ENABLE_PRIVATE_FLAGS;
00065                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a>) {
00066                     a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> |= ENABLE_INSERT_MODE;
00067                 }
00068                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>) {
00069                     a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> |= ENABLE_QUICK_EDIT_MODE;
00070                 }
00071             }
00072         } <span class="keywordflow">else</span> {
00073             a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;OutputMode;
00074         }
00075     }
00076     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00077     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00078     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00079 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a199" doxytag="consrv.h::SrvGetConsoleMouseInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleMouseInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00211">211</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00345">_CONSOLE_GETMOUSEINFO_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00066">GetMouseButtons()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00346">_CONSOLE_GETMOUSEINFO_MSG::NumButtons</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00215 {
00216     <a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html">PCONSOLE_GETMOUSEINFO_MSG</a> a = (<a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html">PCONSOLE_GETMOUSEINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00217     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00218     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00219 
00220     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html#o0">ConsoleHandle</a>,
00221                          &amp;Console
00222                         );
00223     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00224         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00225     }
00226     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a18">GetMouseButtons</a>(&amp;a-&gt;<a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html#o1">NumButtons</a>);
00227     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00228     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00229     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00230 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a194" doxytag="consrv.h::SrvGetConsoleNumberOfFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleNumberOfFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00082">82</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00310">_CONSOLE_GETNUMBEROFFONTS_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00988">GetNumFonts()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00311">_CONSOLE_GETNUMBEROFFONTS_MSG::NumberOfFonts</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00086 {
00087     <a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html">PCONSOLE_GETNUMBEROFFONTS_MSG</a> a = (<a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html">PCONSOLE_GETNUMBEROFFONTS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00088     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00089     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00090 
00091     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html#o0">ConsoleHandle</a>,
00092                          &amp;Console
00093                         );
00094     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00095         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00096     }
00097     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
00098         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00099     } <span class="keywordflow">else</span> {
00100         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a29">GetNumFonts</a>(&amp;a-&gt;<a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html#o1">NumberOfFonts</a>);
00101     }
00102     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00103     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00104     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00105 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a195" doxytag="consrv.h::SrvGetConsoleNumberOfInputEvents" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleNumberOfInputEvents           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00108">108</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00315">_CONSOLE_GETNUMBEROFINPUTEVENTS_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00362">GetNumberOfReadyEvents()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00316">_CONSOLE_GETNUMBEROFINPUTEVENTS_MSG::InputHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00317">_CONSOLE_GETNUMBEROFINPUTEVENTS_MSG::ReadyEvents</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00112 {
00113     <a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html">PCONSOLE_GETNUMBEROFINPUTEVENTS_MSG</a> a = (<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html">PCONSOLE_GETNUMBEROFINPUTEVENTS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00114     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00115     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00116     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00117 
00118     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html#o0">ConsoleHandle</a>,
00119                          &amp;Console
00120                         );
00121     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00122         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00123     }
00124     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00125                                  a-&gt;<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html#o1">InputHandle</a>,
00126                                  CONSOLE_INPUT_HANDLE,
00127                                  GENERIC_READ,
00128                                  &amp;HandleData
00129                                 );
00130     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00131         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a21">GetNumberOfReadyEvents</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00132                                       &amp;a-&gt;<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html#o2">ReadyEvents</a>
00133                                      );
00134     }
00135     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00136     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00137     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00138 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a197" doxytag="consrv.h::SrvGetConsoleScreenBufferInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleScreenBufferInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00141">141</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00332">_CONSOLE_GETSCREENBUFFERINFO_MSG::Attributes</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00327">_CONSOLE_GETSCREENBUFFERINFO_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00333">_CONSOLE_GETSCREENBUFFERINFO_MSG::CurrentWindowSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00330">_CONSOLE_GETSCREENBUFFERINFO_MSG::CursorPosition</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02093">GetScreenBufferInformation()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00334">_CONSOLE_GETSCREENBUFFERINFO_MSG::MaximumWindowSize</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00328">_CONSOLE_GETSCREENBUFFERINFO_MSG::OutputHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00331">_CONSOLE_GETSCREENBUFFERINFO_MSG::ScrollPosition</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00329">_CONSOLE_GETSCREENBUFFERINFO_MSG::Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00145 {
00146     <a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html">PCONSOLE_GETSCREENBUFFERINFO_MSG</a> a = (<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html">PCONSOLE_GETSCREENBUFFERINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00147     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00148     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00149     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00150 
00151     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o0">ConsoleHandle</a>,
00152                          &amp;Console
00153                         );
00154     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00155         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00156     }
00157     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00158                                  a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o1">OutputHandle</a>,
00159                                  CONSOLE_OUTPUT_HANDLE,
00160                                  GENERIC_READ,
00161                                  &amp;HandleData
00162                                 );
00163     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00164         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a55">GetScreenBufferInformation</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00165                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o2">Size</a>,
00166                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o3">CursorPosition</a>,
00167                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o4">ScrollPosition</a>,
00168                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o5">Attributes</a>,
00169                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o6">CurrentWindowSize</a>,
00170                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o7">MaximumWindowSize</a>
00171                                          );
00172     }
00173     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00174     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00175     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00176 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a256" doxytag="consrv.h::SrvGetConsoleTitle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleTitle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04879">4879</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00612">_CONSOLE_GETTITLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00157">_CONSOLE_INFORMATION::Title</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00614">_CONSOLE_GETTITLE_MSG::Title</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00155">_CONSOLE_INFORMATION::TitleLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00613">_CONSOLE_GETTITLE_MSG::TitleLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00615">_CONSOLE_GETTITLE_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>04883 {
04884     <a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html">PCONSOLE_GETTITLE_MSG</a> a = (<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html">PCONSOLE_GETTITLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
04885     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04886     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
04887 
04888     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o0">ConsoleHandle</a>,
04889                          &amp;Console
04890                         );
04891     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
04892         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04893     }
04894 
04895     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>, a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
04896         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04897         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
04898     }
04899 
04900     <span class="comment">// a-&gt;TitleLength contains length in bytes</span>
04901     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o3">Unicode</a>) {
04902         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> &gt; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>) {
04903             a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>;
04904         }
04905         RtlCopyMemory(a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>,Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>);
04906     } <span class="keywordflow">else</span> {
04907 <span class="preprocessor">#if defined(FE_SB)</span>
04908 <span class="preprocessor"></span>        a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(OEMCP,
04909                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
04910                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> / <span class="keyword">sizeof</span>(WCHAR),
04911                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>,
04912                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>
04913                                         );
04914 <span class="preprocessor">#else</span>
04915 <span class="preprocessor"></span>        a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
04916                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
04917                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> / <span class="keyword">sizeof</span>(WCHAR),
04918                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>,
04919                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>
04920                                         );
04921 <span class="preprocessor">#endif</span>
04922 <span class="preprocessor"></span>    }
04923     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04924     <span class="keywordflow">return</span> STATUS_SUCCESS;
04925     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
04926 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a219" doxytag="consrv.h::SrvGetConsoleWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01424">1424</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00819">_CONSOLE_GETCONSOLEWINDOW_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00820">_CONSOLE_GETCONSOLEWINDOW_MSG::hwnd</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01428 {
01429     <a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html">PCONSOLE_GETCONSOLEWINDOW_MSG</a> a = (<a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html">PCONSOLE_GETCONSOLEWINDOW_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01430     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01431     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01432 
01433     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html#o0">ConsoleHandle</a>,
01434                          &amp;Console
01435                         );
01436     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01437         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01438     }
01439 
01440     a-&gt;<a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html#o1">hwnd</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>;
01441 
01442     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01443     <span class="keywordflow">return</span> STATUS_SUCCESS;
01444     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01445 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a226" doxytag="consrv.h::SrvGetHandleInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetHandleInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02747">2747</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00299">CONSOLE_INHERITABLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00478">_CONSOLE_GETHANDLEINFORMATION_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00480">_CONSOLE_GETHANDLEINFORMATION_MSG::Flags</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00479">_CONSOLE_GETHANDLEINFORMATION_MSG::Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02754                    :
02755 
02756     This gets information about an input or output handle.
02757 
02758 Arguments:
02759 
02760     ApiMessageData - Points to parameter structure.
02761 
02762 Return Value:
02763 
02764 --*/
02765 
02766 {
02767     <a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html">PCONSOLE_GETHANDLEINFORMATION_MSG</a> a = (<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html">PCONSOLE_GETHANDLEINFORMATION_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02768     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02769     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02770     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02771 
02772     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o0">ConsoleHandle</a>,
02773                          &amp;Console
02774                         );
02775     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02776         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02777     }
02778     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
02779                                  <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o1">Handle</a>),
02780                                  &amp;HandleData
02781                                 );
02782     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02783         a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o2">Flags</a> = 0;
02784         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>) {
02785             a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o2">Flags</a> |= HANDLE_FLAG_INHERIT;
02786         }
02787     }
02788     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02789     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02790     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02791 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a196" doxytag="consrv.h::SrvGetLargestConsoleWindowSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetLargestConsoleWindowSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00555">555</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00153">_SCREEN_INFORMATION::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00321">_CONSOLE_GETLARGESTWINDOWSIZE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00205">_WINDOW_LIMITS::FullScreenSize</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00322">_CONSOLE_GETLARGESTWINDOWSIZE_MSG::OutputHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00323">_CONSOLE_GETLARGESTWINDOWSIZE_MSG::Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d7/d2/output_8h.html#a37">WINDOW_LIMITS</a>.
<p>
<pre class="fragment"><div>00559 {
00560     <a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html">PCONSOLE_GETLARGESTWINDOWSIZE_MSG</a> a = (<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html">PCONSOLE_GETLARGESTWINDOWSIZE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00561     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00562     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00563     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00564     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00565     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00566 
00567     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o0">ConsoleHandle</a>,
00568                          &amp;Console
00569                         );
00570     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00571         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00572     }
00573     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00574                                  a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o1">OutputHandle</a>,
00575                                  CONSOLE_OUTPUT_HANDLE,
00576                                  GENERIC_WRITE,
00577                                  &amp;HandleData
00578                                 );
00579     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00580         COORD FontSize;
00581 
00582         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00583         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
00584             a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.X = 80;
00585 <span class="preprocessor">#if defined(FE_SB)</span>
00586 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.Y = CONSOLE_IS_DBCS_OUTPUTCP(Console)?25:50;
00587 <span class="preprocessor">#else</span>
00588 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.Y = 50;
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
00591             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00592                 FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
00593             } <span class="keywordflow">else</span> {
00594                 FontSize.X = 1;
00595                 FontSize.Y = 1;
00596             }
00597             <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00598             a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o3">FullScreenSize</a>.X / FontSize.X);
00599             a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o3">FullScreenSize</a>.Y / FontSize.Y);
00600         }
00601     }
00602     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00603     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00604     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00605 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a275" doxytag="consrv.h::SrvInvalidateBitMapRect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvInvalidateBitMapRect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00168">168</a> of file <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html">w32/ntcon/server/bitmap.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00626">_CONSOLE_INVALIDATERECT_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00627">_CONSOLE_INVALIDATERECT_MSG::OutputHandle</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a122">PCONSOLE_INVALIDATERECT_MSG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00628">_CONSOLE_INVALIDATERECT_MSG::Rect</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00199">_CONSOLE_INFORMATION::VDMBuffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00201">_CONSOLE_INFORMATION::VDMBufferSize</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00050">WriteRectToScreenBuffer</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
<pre class="fragment"><div>00175                    :
00176 
00177     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to indicate that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> application has modified a region
00178     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bitmap.  We update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> region to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen.
00179 
00180 Arguments:
00181 
00182     m - message containing api parameters
00183 
00184     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00185 
00186 Return Value:
00187 
00188 --*/
00189 
00190 {
00191     <a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html">PCONSOLE_INVALIDATERECT_MSG</a> a = (<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html">PCONSOLE_INVALIDATERECT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00192     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00193     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00194     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00195     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> Codepage;
00196 
00197     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o0">ConsoleHandle</a>,
00198                          &amp;Console
00199                         );
00200     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00201         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00202     }
00203 
00204     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00205                                  a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o1">OutputHandle</a>,
00206                                  CONSOLE_OUTPUT_HANDLE | CONSOLE_GRAPHICS_OUTPUT_HANDLE,
00207                                  GENERIC_WRITE,
00208                                  &amp;HandleData
00209                                 );
00210     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00211         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00212         <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00213     }
00214     <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>) {
00215         <span class="comment">//ASSERT(Console-&gt;Flags &amp; CONSOLE_VDM_REGISTERED);</span>
00216         <span class="comment">//ASSERT(!(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN_HARDWARE));</span>
00217         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a> != NULL);
00218         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00219             <span class="comment">//ASSERT(HandleData-&gt;Buffer.ScreenBuffer-&gt;ScreenBufferSize.X &lt;= Console-&gt;VDMBufferSize.X);</span>
00220             <span class="comment">//ASSERT(HandleData-&gt;Buffer.ScreenBuffer-&gt;ScreenBufferSize.Y &lt;= Console-&gt;VDMBufferSize.Y);</span>
00221             <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ScreenBufferSize.X &lt;= Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o56">VDMBufferSize</a>.X &amp;&amp;
00222                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ScreenBufferSize.Y &lt;= Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o56">VDMBufferSize</a>.Y) {
00223                 COORD TargetPoint;
00224 
00225                 TargetPoint.X = a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Left;
00226                 TargetPoint.Y = a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Top;
00227                 <span class="comment">// VDM can sometimes get out of sync with window size</span>
00228                 <span class="comment">//ASSERT(a-&gt;Rect.Left &gt;= 0);</span>
00229                 <span class="comment">//ASSERT(a-&gt;Rect.Top &gt;= 0);</span>
00230                 <span class="comment">//ASSERT(a-&gt;Rect.Right &lt; HandleData-&gt;Buffer.ScreenBuffer-&gt;ScreenBufferSize.X);</span>
00231                 <span class="comment">//ASSERT(a-&gt;Rect.Bottom &lt; HandleData-&gt;Buffer.ScreenBuffer-&gt;ScreenBufferSize.Y);</span>
00232                 <span class="comment">//ASSERT(a-&gt;Rect.Left &lt;= a-&gt;Rect.Right);</span>
00233                 <span class="comment">//ASSERT(a-&gt;Rect.Top &lt;= a-&gt;Rect.Bottom);</span>
00234                 <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Left &gt;= 0) &amp;&amp;
00235                     (a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Top &gt;= 0) &amp;&amp;
00236                     (a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Right &lt; HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ScreenBufferSize.X) &amp;&amp;
00237                     (a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Bottom &lt; HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ScreenBufferSize.Y) &amp;&amp;
00238                     (a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Left &lt;= a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Right) &amp;&amp;
00239                     (a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Top &lt;= a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>.Bottom) ) {
00240 
00241                     <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp; ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) == 0)) {
00242 <span class="preprocessor">#if defined(FE_SB)</span>
00243 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00244                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a> )
00245                         {
00246                             Codepage = <a class="code" href="../../d0/d3/dbcs_8h.html#a5">USACP</a>;
00247                         }
00248                         <span class="keywordflow">else</span>
00249 
00250 <span class="preprocessor">#endif</span>
00251 <span class="preprocessor"></span>                        <span class="comment">// we want UnicodeOem characters</span>
00252                         Codepage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>;
00253                     } <span class="keywordflow">else</span> {
00254 <span class="preprocessor">#if defined(FE_SB)</span>
00255 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
00256                             Codepage = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>;
00257                         }
00258                         <span class="keywordflow">else</span>
00259 <span class="preprocessor">#endif</span>
00260 <span class="preprocessor"></span>                        <span class="comment">// we want real Unicode characters</span>
00261                         Codepage = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>;
00262                     }
00263 
00264                     <a class="code" href="../../d6/d8/dispatch_8h.html#a3">WriteRectToScreenBuffer</a>((PBYTE)Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a>,
00265                             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o56">VDMBufferSize</a>, &amp;a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>,
00266                             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer, TargetPoint,
00267                             Codepage);
00268                     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,&amp;a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>);
00269                 } <span class="keywordflow">else</span> {
00270                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00271                 }
00272             } <span class="keywordflow">else</span> {
00273                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00274             }
00275         } <span class="keywordflow">else</span> {
00276             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00277         }
00278     } <span class="keywordflow">else</span> {
00279 
00280         <span class="comment">//</span>
00281         <span class="comment">// write data to screen</span>
00282         <span class="comment">//</span>
00283 
00284         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,&amp;a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a>);
00285     }
00286 
00287     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00288     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00289     UNREFERENCED_PARAMETER(ReplyStatus);
00290 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a222" doxytag="consrv.h::SrvOpenConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvOpenConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">80</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01390">AllocateIoHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00299">CONSOLE_INHERITABLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00025">ConsoleAddShare()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00215">_CONSOLE_OPENCONSOLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00217">_CONSOLE_OPENCONSOLE_MSG::DesiredAccess</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00220">_CONSOLE_OPENCONSOLE_MSG::Handle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00216">_CONSOLE_OPENCONSOLE_MSG::HandleType</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00339">INDEX_TO_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00218">_CONSOLE_OPENCONSOLE_MSG::InheritHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01335">InitializeInputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01307">InitializeOutputHandle()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00132">_CONSOLE_INFORMATION::InputBuffer</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00219">_CONSOLE_OPENCONSOLE_MSG::ShareMode</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00087                    :
00088 
00089     This routine returns a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer or active screen buffer.
00090 
00091 Arguments:
00092 
00093     ApiMessageData - Points to parameter structure.
00094 
00095 Return Value:
00096 
00097 --*/
00098 
00099 {
00100     <a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html">PCONSOLE_OPENCONSOLE_MSG</a> a = (<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html">PCONSOLE_OPENCONSOLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00101     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00102     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00103     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00104     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00105     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
00106 
00107     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o0">ConsoleHandle</a>,
00108                          &amp;Console
00109                         );
00110     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00111         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00112     }
00113 
00114     <span class="keywordflow">try</span> {
00115         <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = (HANDLE) -1;
00116         ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
00117         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o1">HandleType</a> == <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
00118 
00119             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a28">AllocateIoHandle</a>(ProcessData,
00120                                       a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o1">HandleType</a>,
00121                                       &amp;Handle
00122                                      );
00123             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00124                 leave;
00125             }
00126             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
00127                                          Handle,
00128                                          &amp;HandleData
00129                                         );
00130             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00131             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00132                 leave;
00133             }
00134             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a27">InitializeInputHandle</a>(HandleData,
00135                                        &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>)) {
00136                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00137                 leave;
00138             }
00139             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o3">InheritHandle</a>) {
00140                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> |= <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
00141             }
00142             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a0">ConsoleAddShare</a>(a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o2">DesiredAccess</a>,
00143                                      a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o4">ShareMode</a>,
00144                                      &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ShareAccess,
00145                                      HandleData
00146                                     );
00147             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00148                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;RefCount--;
00149                 leave;
00150             }
00151         }
00152         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o1">HandleType</a> == <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>){
00153             <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00154 
00155             <span class="comment">//</span>
00156             <span class="comment">// open a handle to the active screen buffer.</span>
00157             <span class="comment">//</span>
00158 
00159             ScreenInfo = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>;
00160             <span class="keywordflow">if</span> (ScreenInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00161                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_NAME_NOT_FOUND;
00162                 leave;
00163             }
00164             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a28">AllocateIoHandle</a>(ProcessData,
00165                                       a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o1">HandleType</a>,
00166                                       &amp;Handle
00167                                      );
00168             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00169                 leave;
00170             }
00171             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
00172                                          Handle,
00173                                          &amp;HandleData
00174                                         );
00175             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00176             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00177                 leave;
00178             }
00179             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a26">InitializeOutputHandle</a>(HandleData, ScreenInfo);
00180             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o3">InheritHandle</a>) {
00181                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> |= <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
00182             }
00183             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a0">ConsoleAddShare</a>(a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o2">DesiredAccess</a>,
00184                                      a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o4">ShareMode</a>,
00185                                      &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;ShareAccess,
00186                                      HandleData
00187                                     );
00188             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00189                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;RefCount--;
00190                 leave;
00191             }
00192         }
00193         <span class="keywordflow">else</span> {
00194             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00195             leave;
00196         }
00197         a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o5">Handle</a> = <a class="code" href="../../d1/d7/server_8h.html#a57">INDEX_TO_HANDLE</a>(Handle);
00198         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00199     } finally {
00200         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> != (HANDLE)-1) {
00201             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,
00202                          Handle
00203                         );
00204         }
00205         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00206     }
00207     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00208     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00209 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a223" doxytag="consrv.h::SrvReadConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvReadConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02263">2263</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00440">_CONSOLE_READCONSOLE_MSG::Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00035">BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00441">_CONSOLE_READCONSOLE_MSG::BufPtr</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00443">_CONSOLE_READCONSOLE_MSG::CaptureBufferSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00437">_CONSOLE_READCONSOLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00445">_CONSOLE_READCONSOLE_MSG::CtrlWakeupMask</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00439">_CONSOLE_READCONSOLE_MSG::ExeNameLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04564">FindCommandHistory()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00444">_CONSOLE_READCONSOLE_MSG::InitialNumBytes</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00438">_CONSOLE_READCONSOLE_MSG::InputHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00442">_CONSOLE_READCONSOLE_MSG::NumBytes</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00447">_CONSOLE_READCONSOLE_MSG::Unicode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02270                    :
02271 
02272     This routine reads characters from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input stream.
02273 
02274 Arguments:
02275 
02276     ApiMessageData - Points to parameter structure.
02277 
02278 Return Value:
02279 
02280 --*/
02281 
02282 {
02283     <a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a> a = (<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02284     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02285     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02286     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02287     PWCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
02288     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
02289 
02290     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o0">ConsoleHandle</a>,
02291                          &amp;Console
02292                         );
02293     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02294         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02295     }
02296 
02297     ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
02298     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(ProcessData,
02299                                  a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o1">InputHandle</a>,
02300                                  CONSOLE_INPUT_HANDLE,
02301                                  GENERIC_READ,
02302                                  &amp;HandleData
02303                                 );
02304     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02305         a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = 0;
02306     } <span class="keywordflow">else</span> {
02307 
02308         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o6">CaptureBufferSize</a> &lt;= <a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>) {
02309             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o3">Buffer</a>;
02310         }
02311         <span class="keywordflow">else</span> {
02312             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o4">BufPtr</a>;
02313             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o4">BufPtr</a>, a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o6">CaptureBufferSize</a>, <span class="keyword">sizeof</span>(BYTE))) {
02314                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02315                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
02316             }
02317         }
02318 
02319 <span class="preprocessor">#if defined(FE_SB)</span>
02320 <span class="preprocessor"></span>        Console-&gt;ReadConInpNumBytesTemp = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> / <span class="keyword">sizeof</span>(WCHAR);
02321 <span class="preprocessor">#endif</span>
02322 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a26">ReadChars</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
02323                            Console,
02324                            ProcessData,
02325                            Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
02326                            Buffer,
02327                            &amp;a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>,
02328                            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o7">InitialNumBytes</a>,
02329                            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o8">CtrlWakeupMask</a>,
02330                            HandleData,
02331                            <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a74">FindCommandHistory</a>(Console,<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>()),
02332                            m,
02333                            <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o1">InputHandle</a>),
02334                            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o2">ExeNameLength</a>,
02335                            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o3">Buffer</a>,
02336                            a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a>
02337                           );
02338         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
02339             *ReplyStatus = CsrReplyPending;
02340         }
02341     }
02342     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02343     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
02344 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a186" doxytag="consrv.h::SrvReadConsoleOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvReadConsoleOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">1207</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00249">_CONSOLE_READCONSOLEOUTPUT_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00248">_CONSOLE_READCONSOLEOUTPUT_MSG::Char</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00250">_CONSOLE_READCONSOLEOUTPUT_MSG::CharRegion</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00246">_CONSOLE_READCONSOLEOUTPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00247">_CONSOLE_READCONSOLEOUTPUT_MSG::OutputHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01623">ReadScreenBuffer()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d9/w32_2ntcon_2fullscr_2vga_2misc_8c-source.html#l00086">TranslateOutputToOem()</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00251">_CONSOLE_READCONSOLEOUTPUT_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01211 {
01212     <a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html">PCONSOLE_READCONSOLEOUTPUT_MSG</a> a = (<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html">PCONSOLE_READCONSOLEOUTPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01213     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01214     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01215     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01216     PCHAR_INFO <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01217 
01218     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"SrvReadConsoleOutput\n"</span>));
01219     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a>,
01220                          &amp;Console
01221                         );
01222     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01223         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01224     }
01225     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01226                                  a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o1">OutputHandle</a>,
01227                                  CONSOLE_OUTPUT_HANDLE,
01228                                  GENERIC_READ,
01229                                  &amp;HandleData
01230                                 );
01231     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01232         <span class="comment">//</span>
01233         <span class="comment">// a region of zero size is indicated by the right and bottom</span>
01234         <span class="comment">// coordinates being less than the left and top.</span>
01235         <span class="comment">//</span>
01236 
01237         a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left-1);
01238         a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top-1);
01239     }
01240     <span class="keywordflow">else</span> {
01241         COORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01242 
01243         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right - a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left + 1);
01244         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom - a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top + 1);
01245 
01246         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X == 1) &amp;&amp; (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y == 1)) {
01247             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o2">Char</a>;
01248         }
01249         <span class="keywordflow">else</span> {
01250             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o3">BufPtr</a>;
01251             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o3">BufPtr</a>, <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X * <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y, <span class="keyword">sizeof</span>(*Buffer))) {
01252                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01253                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01254             }
01255         }
01256 
01257         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a52">ReadScreenBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01258                                   Buffer,
01259                                   &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01260                                  );
01261         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o5">Unicode</a>) {
01262             <a class="code" href="../../d3/d0/w32_2ntcon_2fullscr_2vga_2misc_8c.html#a1">TranslateOutputToOem</a>(Console,
01263                                   Buffer,
01264                                   BufferSize
01265                                  );
01266         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
01267                 !(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN)) {
01268             <a class="code" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode</a>(Console,
01269                                         Buffer,
01270                                         BufferSize
01271 #<span class="keywordflow">if</span> defined(FE_SB)
01272                                         ,
01273                                         TRUE
01274 #endif
01275                                        );
01276         }
01277     }
01278     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01279     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01280     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a188" doxytag="consrv.h::SrvReadConsoleOutputString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvReadConsoleOutputString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01448">1448</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00280">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::BufPtr</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00269">CONSOLE_ASCII</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00275">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00281">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::NumRecords</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00276">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::OutputHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00277">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::ReadCoord</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00279">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::String</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00278">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::StringType</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01452 {
01453     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01454     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01455     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01456     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01457     <a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_READCONSOLEOUTPUTSTRING_MSG</a> a = (<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_READCONSOLEOUTPUTSTRING_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01458     ULONG nSize;
01459 
01460     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o0">ConsoleHandle</a>,
01461                          &amp;Console
01462                         );
01463     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01464         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01465     }
01466     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01467                                  a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o1">OutputHandle</a>,
01468                                  CONSOLE_OUTPUT_HANDLE,
01469                                  GENERIC_READ,
01470                                  &amp;HandleData
01471                                 );
01472     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01473 
01474         <span class="comment">//</span>
01475         <span class="comment">// a region of zero size is indicated by the right and bottom</span>
01476         <span class="comment">// coordinates being less than the left and top.</span>
01477         <span class="comment">//</span>
01478 
01479         a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a> = 0;
01480     } <span class="keywordflow">else</span> {
01481         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a> == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>)
01482             nSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
01483         <span class="keywordflow">else</span>
01484             nSize = <span class="keyword">sizeof</span>(WORD);
01485         <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>*nSize) &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o4">String</a>)) {
01486             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>;
01487             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>, a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>, nSize)) {
01488                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01489                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01490             }
01491         }
01492         <span class="keywordflow">else</span> {
01493             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o4">String</a>;
01494         }
01495         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a54">ReadOutputString</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01496                                 Buffer,
01497                                 a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o2">ReadCoord</a>,
01498                                 a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a>,
01499                                 &amp;a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>
01500                                );
01501     }
01502     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01503     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01504     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01505 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a285" doxytag="consrv.h::SrvRegisterConsoleVDM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvRegisterConsoleVDM           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01094">1094</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01519">ConnectToEmulator()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00383">CONSOLE_CLIENTPROCESSID</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00098">CONSOLE_CONNECTED_TO_EMULATOR</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00099">CONSOLE_FULLSCREEN_NOPAINT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00103">CONSOLE_WOW_REGISTERED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00679">_CONSOLE_REGISTERVDM_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00682">_CONSOLE_REGISTERVDM_MSG::EndEvent</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00039">FullScreenInitialized</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00235">_CONSOLE_INFORMATION::InputThreadInfo</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01407">MapViewOfSection()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00033">NtUnmapViewOfSection()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00870">NtUserConsoleControl()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00680">_CONSOLE_REGISTERVDM_MSG::RegisterFlags</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00681">_CONSOLE_REGISTERVDM_MSG::StartEvent</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00204">_CONSOLE_INFORMATION::StateBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00686">_CONSOLE_REGISTERVDM_MSG::StateBuffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00205">_CONSOLE_INFORMATION::StateBufferClient</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00685">_CONSOLE_REGISTERVDM_MSG::StateLength</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00206">_CONSOLE_INFORMATION::StateLength</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00203">_CONSOLE_INFORMATION::StateSectionHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00683">_CONSOLE_REGISTERVDM_MSG::StateSectionName</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00684">_CONSOLE_REGISTERVDM_MSG::StateSectionNameLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00055">_INPUT_THREAD_INFO::ThreadHandle</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02842">TIF_VDMAPP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00980">UnregisterVDM()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00199">_CONSOLE_INFORMATION::VDMBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00690">_CONSOLE_REGISTERVDM_MSG::VDMBuffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00200">_CONSOLE_INFORMATION::VDMBufferClient</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00198">_CONSOLE_INFORMATION::VDMBufferSectionHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00687">_CONSOLE_REGISTERVDM_MSG::VDMBufferSectionName</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00688">_CONSOLE_REGISTERVDM_MSG::VDMBufferSectionNameLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00689">_CONSOLE_REGISTERVDM_MSG::VDMBufferSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00201">_CONSOLE_INFORMATION::VDMBufferSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00194">_CONSOLE_INFORMATION::VDMEndHardwareEvent</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00195">_CONSOLE_INFORMATION::VDMProcessHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00196">_CONSOLE_INFORMATION::VDMProcessId</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00193">_CONSOLE_INFORMATION::VDMStartHardwareEvent</a>.
<p>
<pre class="fragment"><div>01098 {
01099     <a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html">PCONSOLE_REGISTERVDM_MSG</a> a = (<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html">PCONSOLE_REGISTERVDM_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01100     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01101     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01102     SIZE_T ViewSize;
01103 <span class="preprocessor">#ifdef i386</span>
01104 <span class="preprocessor"></span>    VIDEO_REGISTER_VDM RegisterVdm;
01105     ULONG RegisterVdmSize = <span class="keyword">sizeof</span>(RegisterVdm);
01106     VIDEO_VDM Vdm;
01107 <span class="preprocessor">#endif  //i386</span>
01108 <span class="preprocessor"></span>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o0">ConsoleHandle</a>,
01109                          &amp;Console
01110                         );
01111     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01112         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01113     }
01114 
01115 
01116     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o1">RegisterFlags</a>) {
01117 <span class="comment">//      williamh, Jan 28 1994</span>
01118 <span class="comment">//      do not do an assert here because we may have unregistered the ntvdm</span>
01119 <span class="comment">//      and the ntvdm doesn't necessarily know this(and it could post another</span>
01120 <span class="comment">//      unregistervdm). Return error here so NTVDM knows what to do</span>
01121 <span class="comment">//      ASSERT(Console-&gt;Flags &amp; CONSOLE_VDM_REGISTERED);</span>
01122 
01123         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>) {
01124             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_FULLSCREEN_NOPAINT));
01125             <a class="code" href="../../d0/d5/srvinit_8c.html#a22">UnregisterVDM</a>(Console);
01126 <span class="preprocessor">#ifdef i386</span>
01127 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE &amp;&amp;
01128                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01129             <span class="comment">//    SetVideoMode(Console-&gt;CurrentScreenBuffer);</span>
01130                 <span class="comment">//set up cursor</span>
01131                 SetCursorInformationHW(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
01132                                        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorSize,
01133                                        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorVisible);
01134                 SetCursorPositionHW(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
01135                                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition);
01136             }
01137 <span class="preprocessor">#endif</span>
01138 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01139         } <span class="keywordflow">else</span> {
01140             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
01141         }
01142         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01143         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01144     }
01145 
01146     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o4">StateSectionName</a>, a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o5">StateSectionNameLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01147         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o8">VDMBufferSectionName</a>, a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o9">VDMBufferSectionNameLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01148 
01149         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01150         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01151     }
01152 
01153     <span class="comment">// check it out. A console should have only one VDM registered.</span>
01154     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_VDM_REGISTERED));
01155 
01156     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>) {
01157         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01158         <span class="keywordflow">return</span> (ULONG) STATUS_ACCESS_DENIED;
01159     }
01160 
01161     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>);
01162 
01163     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(NtCurrentProcess(), <a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01164                                NtCurrentProcess(), &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>,
01165                                0, FALSE, DUPLICATE_SAME_ACCESS);
01166     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01167         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01168         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01169     }
01170     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a> = <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>();
01171 
01172 <span class="preprocessor">#ifdef i386</span>
01173 <span class="preprocessor"></span>
01174     Vdm.ProcessHandle = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>;
01175 
01176     <span class="comment">//</span>
01177     <span class="comment">// Assume fullscreen initialization will fail.</span>
01178     <span class="comment">// have state length set to zero so that NTVDM will know</span>
01179     <span class="comment">// full screen is disabled.</span>
01180     <span class="comment">//</span>
01181 
01182     a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o6">StateLength</a> = 0;
01183     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o60">StateLength</a> = 0;
01184     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o59">StateBufferClient</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01185 
01186     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a12">FullScreenInitialized</a>) {
01187 
01188     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01189                    a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o2">StartEvent</a>,
01190                    NtCurrentProcess(),
01191                    &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o49">VDMStartHardwareEvent</a>,
01192                    0,
01193                    FALSE,
01194                    DUPLICATE_SAME_ACCESS
01195                   );
01196     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01197         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01198                        a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o3">EndEvent</a>,
01199                        NtCurrentProcess(),
01200                        &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o50">VDMEndHardwareEvent</a>,
01201                        0,
01202                        FALSE,
01203                        DUPLICATE_SAME_ACCESS
01204                       );
01205         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01206                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GdiFullscreenControl(FullscreenControlRegisterVdm,
01207                                          &amp;Vdm,
01208                                          <span class="keyword">sizeof</span>(Vdm),
01209                                          &amp;RegisterVdm,
01210                                          &amp;RegisterVdmSize
01211                                         );
01212 
01213           <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01214 
01215                     <span class="comment">//</span>
01216                     <span class="comment">// create state section and map a view of it into server and vdm.</span>
01217                     <span class="comment">// this section is used to get/set video hardware state during</span>
01218                     <span class="comment">// the fullscreen&lt;-&gt;windowed transition.  we create the section</span>
01219                     <span class="comment">// instead of the vdm for security purposes.</span>
01220                     <span class="comment">//</span>
01221 
01222             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d4/server_2private_8c.html#a40">MapViewOfSection</a>(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o57">StateSectionHandle</a>,
01223                           RegisterVdm.MinimumStateSize,
01224                           &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o58">StateBuffer</a>,
01225                           &amp;ViewSize,
01226                           Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>,
01227                           &amp;a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o7">StateBuffer</a>
01228                          );
01229 
01230             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01231                         a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o6">StateLength</a> = RegisterVdm.MinimumStateSize;
01232                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o60">StateLength</a> = RegisterVdm.MinimumStateSize;
01233                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o59">StateBufferClient</a> = a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o7">StateBuffer</a>;
01234             }
01235 
01236           } <span class="keywordflow">else</span> {
01237 
01238             CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o49">VDMStartHardwareEvent</a>);
01239             CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o50">VDMEndHardwareEvent</a>);
01240           }
01241 
01242         } <span class="keywordflow">else</span> {
01243 
01244         <span class="comment">// ASSERT(FALSE);</span>
01245         CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o49">VDMStartHardwareEvent</a>);
01246         CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o50">VDMEndHardwareEvent</a>);
01247        }
01248 
01249     } <span class="keywordflow">else</span> {
01250         CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o49">VDMStartHardwareEvent</a>);
01251     }
01252     <span class="comment">//</span>
01253     <span class="comment">// if failed to duplicate screen switch events or  map view</span>
01254     <span class="comment">// to video state shared buffer, fails this API</span>
01255     <span class="comment">//</span>
01256     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01257         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01258         <span class="keywordflow">return</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01259     }
01260     }
01261 
01262 <span class="preprocessor">#endif</span>
01263 <span class="preprocessor"></span>    <span class="comment">//</span>
01264     <span class="comment">// create vdm char section and map a view of it into server and vdm.</span>
01265     <span class="comment">// this section is used by the vdm to update the screen when in a</span>
01266     <span class="comment">// charmode window.  this is a performance optimization.  we create</span>
01267     <span class="comment">// the section instead of the vdm for security purposes.</span>
01268     <span class="comment">//</span>
01269 
01270     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d4/server_2private_8c.html#a40">MapViewOfSection</a>(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o53">VDMBufferSectionHandle</a>,
01271 #ifdef i386
01272                               a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o10">VDMBufferSize</a>.X*a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o10">VDMBufferSize</a>.Y*2,
01273 #<span class="keywordflow">else</span> <span class="comment">//risc</span>
01274                               a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o10">VDMBufferSize</a>.X*a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o10">VDMBufferSize</a>.Y*4,
01275 #endif
01276                               &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a>,
01277                               &amp;ViewSize,
01278                               Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>,
01279                               &amp;a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o11">VDMBuffer</a>
01280                              );
01281     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01282 
01283         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o54">VDMBuffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01284 
01285 <span class="preprocessor">#ifdef i386</span>
01286 <span class="preprocessor"></span>
01287         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a12">FullScreenInitialized</a>) {
01288 
01289             <a class="code" href="../../d4/d9/umapview_8c.html#a0">NtUnmapViewOfSection</a>(NtCurrentProcess(),Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o58">StateBuffer</a>);
01290             <a class="code" href="../../d4/d9/umapview_8c.html#a0">NtUnmapViewOfSection</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>,Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o59">StateBufferClient</a>);
01291             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o57">StateSectionHandle</a>);
01292             CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o49">VDMStartHardwareEvent</a>);
01293             CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o50">VDMEndHardwareEvent</a>);
01294         }
01295 
01296 <span class="preprocessor">#endif</span>
01297 <span class="preprocessor"></span>        CloseHandle(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a>);
01298         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o51">VDMProcessHandle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01299         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01300         <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01301     }
01302     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o55">VDMBufferClient</a> = a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o11">VDMBuffer</a>;
01303 
01304     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>;
01305 
01306     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
01307         USERTHREAD_FLAGS Flags;
01308 
01309         Flags.dwFlags = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a810">TIF_VDMAPP</a>;
01310         Flags.dwMask = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a810">TIF_VDMAPP</a>;
01311         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o75">InputThreadInfo</a>-&gt;<a class="code" href="../../d9/d2/struct__INPUT__THREAD__INFO.html#o0">ThreadHandle</a>,
01312                 UserThreadFlags, &amp;Flags, <span class="keyword">sizeof</span>(Flags));
01313     }
01314     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o56">VDMBufferSize</a> = a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o10">VDMBufferSize</a>;
01315 
01316     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d4/struct__CONSOLE__REGISTERVDM__MSG.html#o1">RegisterFlags</a> &amp; CONSOLE_REGISTER_WOW)
01317         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a18">CONSOLE_WOW_REGISTERED</a>;
01318     <span class="keywordflow">else</span>
01319         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a18">CONSOLE_WOW_REGISTERED</a>;
01320 
01321     <span class="comment">//</span>
01322     <span class="comment">// if we're already in fullscreen and we run a DOS app for</span>
01323     <span class="comment">// the first time, connect the emulator.</span>
01324     <span class="comment">//</span>
01325 
01326 <span class="preprocessor">#ifdef i386</span>
01327 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
01328         RECT CursorRect;
01329         CursorRect.left = -32767;
01330         CursorRect.top = -32767;
01331         CursorRect.right = 32767;
01332         CursorRect.bottom = 32767;
01333         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a86">NtUserConsoleControl</a>(ConsoleSetVDMCursorBounds, &amp;CursorRect, <span class="keyword">sizeof</span>(RECT));
01334         <span class="comment">// connect emulator</span>
01335         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_CONNECTED_TO_EMULATOR));
01336         <a class="code" href="../../d7/d4/server_2private_8c.html#a41">ConnectToEmulator</a>(TRUE, Console);
01337     }
01338 <span class="preprocessor">#endif</span>
01339 <span class="preprocessor"></span>
01340     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01341     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01342     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01343 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a211" doxytag="consrv.h::SrvScrollConsoleScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvScrollConsoleScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">882</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01469">CharToWchar()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00413">_CONSOLE_SCROLLSCREENBUFFER_MSG::Clip</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00412">_CONSOLE_SCROLLSCREENBUFFER_MSG::ClipRectangle</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00409">_CONSOLE_SCROLLSCREENBUFFER_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00414">_CONSOLE_SCROLLSCREENBUFFER_MSG::DestinationOrigin</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00415">_CONSOLE_SCROLLSCREENBUFFER_MSG::Fill</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00410">_CONSOLE_SCROLLSCREENBUFFER_MSG::OutputHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00411">_CONSOLE_SCROLLSCREENBUFFER_MSG::ScrollRectangle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03226">ScrollRegion()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00416">_CONSOLE_SCROLLSCREENBUFFER_MSG::Unicode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00886 {
00887     <a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html">PCONSOLE_SCROLLSCREENBUFFER_MSG</a> a = (<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html">PCONSOLE_SCROLLSCREENBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00888     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00889     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00890     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00891     PSMALL_RECT ClipRect;
00892 
00893     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o0">ConsoleHandle</a>,
00894                          &amp;Console
00895                         );
00896     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00897         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00898     }
00899     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00900                                  a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o1">OutputHandle</a>,
00901                                  CONSOLE_OUTPUT_HANDLE,
00902                                  GENERIC_WRITE,
00903                                  &amp;HandleData
00904                                 );
00905     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00906 
00907         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o4">Clip</a>) {
00908             ClipRect = &amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o3">ClipRectangle</a>;
00909         }
00910         <span class="keywordflow">else</span> {
00911             ClipRect = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00912         }
00913         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o7">Unicode</a>) {
00914 <span class="preprocessor">#if defined(FE_SB)</span>
00915 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.UnicodeChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(Console,
00916                                                    Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,
00917                                                    &amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.AsciiChar);
00918 <span class="preprocessor">#else</span>
00919 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.UnicodeChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(
00920                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>, a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.AsciiChar);
00921 <span class="preprocessor">#endif</span>
00922 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00923                 !(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN)) {
00924             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a42">RealUnicodeToFalseUnicode</a>(&amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.UnicodeChar,
00925                                     1,
00926                                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>
00927                                     );
00928         }
00929         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a65">ScrollRegion</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00930                             &amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o2">ScrollRectangle</a>,
00931                             ClipRect,
00932                             a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o5">DestinationOrigin</a>,
00933                             a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>
00934                            );
00935     }
00936     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00937     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00938     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00939 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a205" doxytag="consrv.h::SrvSetConsoleActiveScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleActiveScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00492">492</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00373">_CONSOLE_SETACTIVESCREENBUFFER_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00374">_CONSOLE_SETACTIVESCREENBUFFER_MSG::OutputHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00496 {
00497     <a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html">PCONSOLE_SETACTIVESCREENBUFFER_MSG</a> a = (<a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html">PCONSOLE_SETACTIVESCREENBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00498     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00499     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00500     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00501 
00502     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html#o0">ConsoleHandle</a>,
00503                          &amp;Console
00504                         );
00505     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00506         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00507     }
00508     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00509                                  a-&gt;<a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html#o1">OutputHandle</a>,
00510                                  CONSOLE_GRAPHICS_OUTPUT_HANDLE | CONSOLE_OUTPUT_HANDLE,
00511                                  GENERIC_WRITE,
00512                                  &amp;HandleData
00513                                 );
00514     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00515         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a71">SetActiveScreenBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer);
00516     }
00517     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00518     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00519     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00520 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a250" doxytag="consrv.h::SrvSetConsoleCommandHistoryMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvSetConsoleCommandHistoryMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01575">1575</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00583">_CONSOLE_SETCOMMANDHISTORYMODE_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00584">_CONSOLE_SETCOMMANDHISTORYMODE_MSG::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00180">_CONSOLE_INFORMATION::InsertMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01579 {
01580     <a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html">PCONSOLE_SETCOMMANDHISTORYMODE_MSG</a> a = (<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html">PCONSOLE_SETCOMMANDHISTORYMODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01581     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01582     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01583 
01584     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html#o0">ConsoleHandle</a>,
01585                          &amp;Console
01586                         );
01587     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01588         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01589     }
01590     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a> = (BOOLEAN) (a-&gt;<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html#o1">Flags</a> != CONSOLE_OVERSTRIKE);
01591     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01592     <span class="keywordflow">return</span> STATUS_SUCCESS;
01593     UNREFERENCED_PARAMETER(ReplyStatus);
01594 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a216" doxytag="consrv.h::SrvSetConsoleCP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01229">1229</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00719">_CONSOLE_SETCP_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00721">_CONSOLE_SETCP_MSG::Output</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04267">QueueConsoleMessage()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l05985">ReCreateDbcsScreenBuffer()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00720">_CONSOLE_SETCP_MSG::wCodePageID</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
<pre class="fragment"><div>01233 {
01234     <a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html">PCONSOLE_SETCP_MSG</a> a = (<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html">PCONSOLE_SETCP_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01235     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01236     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01237     HANDLE hEvent = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01238 
01239     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o0">ConsoleHandle</a>,
01240                          &amp;Console
01241                         );
01242     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01243         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01244     }
01245     <span class="keywordflow">if</span> (a-&gt;hEvent) {
01246         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01247                        a-&gt;hEvent,
01248                        NtCurrentProcess(),
01249                        &amp;hEvent,
01250                        0,
01251                        FALSE,
01252                        DUPLICATE_SAME_ACCESS
01253                        );
01254         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01255             <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01256         }
01257     }
01258 
01259     <span class="keywordflow">if</span> (!IsValidCodePage(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>)) {
01260         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01261         <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01262     }
01263     <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>( a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a> ) &amp;&amp;
01264          <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> != a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a> )
01265     {
01266         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01267         <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01268     }
01269 
01270     <span class="keywordflow">if</span> ( (a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> != a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>) ||
01271          (!a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a> != a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>)         ) {
01272 
01273         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> CodePage;
01274 
01275         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>) {
01276 
01277             <span class="comment">// Backup old code page</span>
01278             CodePage = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>;
01279 
01280             <span class="comment">// Set new code page</span>
01281             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> = a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>;
01282 
01283             Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>);
01284 
01285             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d2/output_8c.html#a89">ReCreateDbcsScreenBuffer</a>(Console, CodePage) ) {
01286                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"SrvSetConsoleCP: ReCreateDbcsScreenBuffer failed. Restoring to CP=%d"</span>,
01287                         CodePage);
01288                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> = CodePage;
01289                 Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(CodePage);
01290                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
01291                 <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01292             }
01293             SetConsoleCPInfo(Console,a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>);
01294             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a76">QueueConsoleMessage</a>(Console,
01295                         CM_SET_IME_CODEPAGE,
01296                         (WPARAM)hEvent,
01297                         MAKELPARAM(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>,CodePage)
01298                        );
01299             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01300                 <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01301             }
01302 
01303             <span class="comment">// load special ROM font, if necessary</span>
01304 
01305 <span class="preprocessor">#ifdef i386</span>
01306 <span class="preprocessor"></span>
01307             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
01308                 SetROMFontCodePage(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,
01309                                    Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex);
01310                 WriteRegionToScreenHW(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
01311                         &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
01312             }
01313 <span class="preprocessor">#endif</span>
01314 <span class="preprocessor"></span>
01315 
01316         } <span class="keywordflow">else</span> {
01317 
01318             <span class="comment">// Backup old code page</span>
01319             CodePage = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>;
01320 
01321             <span class="comment">// Set new code page</span>
01322             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a> = a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>;
01323 
01324             Console-&gt;fIsDBCSCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>);
01325 
01326             SetConsoleCPInfo(Console,a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>);
01327             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a76">QueueConsoleMessage</a>(Console,
01328                         CM_SET_IME_CODEPAGE,
01329                         (WPARAM)hEvent,
01330                         MAKELPARAM(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>,CodePage)
01331                        );
01332             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01333                 <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01334             }
01335         }
01336     }
01337     <span class="keywordflow">else</span> {
01338         <span class="keywordflow">if</span> (hEvent) {
01339             <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(hEvent, NULL);
01340             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hEvent);
01341         }
01342     }
01343 
01344     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01345     <span class="keywordflow">return</span> STATUS_SUCCESS;
01346 
01347 SrvSetConsoleCPFailure:
01348     <span class="keywordflow">if</span> (hEvent) {
01349         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(hEvent, NULL);
01350         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hEvent);
01351     }
01352     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01353     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01354 
01355     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01356 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a278" doxytag="consrv.h::SrvSetConsoleCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00213">213</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00643">_CONSOLE_SETCURSOR_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00645">_CONSOLE_SETCURSOR_MSG::CursorHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00030">ghNormalCursor</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00644">_CONSOLE_SETCURSOR_MSG::OutputHandle</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00220            :
00221 
00222     Sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mouse pointer <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified screen buffer.
00223 
00224 Parameters:
00225 
00226     hConsoleOutput - Supplies a console output handle.
00227 
00228     hCursor - win32 cursor handle, should be <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span>
00229         cursor.
00230 
00231 Return value:
00232 
00233     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00234 
00235     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00236         <span class="keyword">using</span> GetLastError.
00237 
00238 --*/
00239 
00240 {
00241     <a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html">PCONSOLE_SETCURSOR_MSG</a> a = (<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html">PCONSOLE_SETCURSOR_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00242     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00243     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00244     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00245 
00246     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o0">ConsoleHandle</a>,
00247                          &amp;Console
00248                         );
00249     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00250         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00251     }
00252     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00253                                  a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o1">OutputHandle</a>,
00254                                  CONSOLE_GRAPHICS_OUTPUT_HANDLE,
00255                                  GENERIC_WRITE,
00256                                  &amp;HandleData
00257                                 );
00258     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00259         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o2">CursorHandle</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00260             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CursorHandle = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a7">ghNormalCursor</a>;
00261         } <span class="keywordflow">else</span> {
00262             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CursorHandle = a-&gt;<a class="code" href="../../d2/d5/struct__CONSOLE__SETCURSOR__MSG.html#o2">CursorHandle</a>;
00263         }
00264         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hWnd,
00265                      WM_SETCURSOR,
00266                      0,
00267                      -1
00268                     );
00269     }
00270     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00271     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00272     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00273 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a209" doxytag="consrv.h::SrvSetConsoleCursorInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleCursorInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00738">738</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00395">_CONSOLE_SETCURSORINFO_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00397">_CONSOLE_SETCURSORINFO_MSG::CursorSize</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00396">_CONSOLE_SETCURSORINFO_MSG::OutputHandle</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00398">_CONSOLE_SETCURSORINFO_MSG::Visible</a>.
<p>
<pre class="fragment"><div>00742 {
00743     <a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html">PCONSOLE_SETCURSORINFO_MSG</a> a = (<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html">PCONSOLE_SETCURSORINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00744     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00745     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00746     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00747 
00748     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o0">ConsoleHandle</a>,
00749                          &amp;Console
00750                         );
00751     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00752         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00753     }
00754     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00755                                  a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o1">OutputHandle</a>,
00756                                  CONSOLE_OUTPUT_HANDLE,
00757                                  GENERIC_WRITE,
00758                                  &amp;HandleData
00759                                 );
00760     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00761         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o2">CursorSize</a> &gt; 100 || a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o2">CursorSize</a> == 0) {
00762             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00763         } <span class="keywordflow">else</span> {
00764             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a4">SetCursorInformation</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o2">CursorSize</a>,a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o3">Visible</a>);
00765         }
00766     }
00767     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00768     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00769     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00770 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a208" doxytag="consrv.h::SrvSetConsoleCursorPosition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleCursorPosition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00662">662</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00115">AdjustCursorPosition</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00153">_SCREEN_INFORMATION::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00389">_CONSOLE_SETCURSORPOSITION_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00391">_CONSOLE_SETCURSORPOSITION_MSG::CursorPosition</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00132">_CONSOLE_INFORMATION::InputBuffer</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00390">_CONSOLE_SETCURSORPOSITION_MSG::OutputHandle</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
<pre class="fragment"><div>00666 {
00667     <a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html">PCONSOLE_SETCURSORPOSITION_MSG</a> a = (<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html">PCONSOLE_SETCURSORPOSITION_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00668     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00669     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00670     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00671     COORD WindowOrigin;
00672     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00673 
00674     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o0">ConsoleHandle</a>,
00675                          &amp;Console
00676                         );
00677     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00678         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00679     }
00680     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00681                                  a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o1">OutputHandle</a>,
00682                                  CONSOLE_OUTPUT_HANDLE,
00683                                  GENERIC_WRITE,
00684                                  &amp;HandleData
00685                                 );
00686     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00687 
00688         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00689 
00690         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X ||
00691             a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y ||
00692             a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X &lt; 0 ||
00693             a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y &lt; 0) {
00694             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00695         } <span class="keywordflow">else</span> {
00696             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(ScreenInfo,
00697                                        a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>,
00698                                        TRUE
00699                                       );
00700         }
00701         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00702 <span class="preprocessor">#if defined(FE_IME)</span>
00703 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_JUST_VDM_UNREGISTERED){
00704                 <span class="keywordflow">if</span>( ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.ImeMode.Open ){
00705                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> ScrollY = 0;
00706                     <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>(ScreenInfo,a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>,TRUE,&amp;ScrollY);
00707                     a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y += ScrollY;
00708                 }
00709                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~CONSOLE_JUST_VDM_UNREGISTERED;
00710             }
00711 <span class="preprocessor">#endif</span>
00712 <span class="preprocessor"></span>            WindowOrigin.X = 0;
00713             WindowOrigin.Y = 0;
00714             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left &gt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X) {
00715                 WindowOrigin.X = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00716             }
00717             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right &lt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X) {
00718                 WindowOrigin.X = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right;
00719             }
00720             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top &gt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y) {
00721                 WindowOrigin.Y = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00722             }
00723             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom &lt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y) {
00724                 WindowOrigin.Y = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom;
00725             }
00726             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
00727                                      FALSE,
00728                                      WindowOrigin
00729                                     );
00730         }
00731     }
00732     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00733     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00734     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00735 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a282" doxytag="consrv.h::SrvSetConsoleDisplayMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleDisplayMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00853">853</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00363">CM_MODE_TRANSITION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00671">_CONSOLE_SETDISPLAYMODE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00673">_CONSOLE_SETDISPLAYMODE_MSG::dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00039">FullScreenInitialized</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00675">_CONSOLE_SETDISPLAYMODE_MSG::hEvent</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00672">_CONSOLE_SETDISPLAYMODE_MSG::OutputHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04267">QueueConsoleMessage()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00860            :
00861 
00862     This routine sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console display mode <span class="keywordflow">for</span> an output buffer.
00863     This API <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> supported on x86 machines.  Jazz consoles are always
00864     windowed.
00865 
00866 Parameters:
00867 
00868     hConsoleOutput - Supplies a console output handle.
00869 
00870     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> display mode. Options are:
00871 
00872         CONSOLE_FULLSCREEN_MODE - data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> displayed fullscreen
00873 
00874         CONSOLE_WINDOWED_MODE - data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> displayed in a window
00875 
00876     lpNewScreenBufferDimensions - On output, contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> dimensions of
00877         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> screen buffer.  The dimensions are in rows and columns <span class="keywordflow">for</span>
00878         textmode screen buffers.
00879 
00880 Return value:
00881 
00882     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00883 
00884     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00885         <span class="keyword">using</span> GetLastError.
00886 
00887 --*/
00888 
00889 {
00890     <a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html">PCONSOLE_SETDISPLAYMODE_MSG</a> a = (<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html">PCONSOLE_SETDISPLAYMODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00891     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00892     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00893     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00894     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00895     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> State;
00896     HANDLE  hEvent = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00897 
00898     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o0">ConsoleHandle</a>,
00899                          &amp;Console
00900                         );
00901     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00902         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00903     }
00904 
00905     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
00906                                a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o4">hEvent</a>,
00907                                NtCurrentProcess(),
00908                                &amp;hEvent,
00909                                0,
00910                                FALSE,
00911                                DUPLICATE_SAME_ACCESS
00912                                );
00913     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00914         <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00915     }
00916     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00917                                  a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o1">OutputHandle</a>,
00918                                  CONSOLE_OUTPUT_HANDLE | CONSOLE_GRAPHICS_OUTPUT_HANDLE,
00919                                  GENERIC_WRITE,
00920                                  &amp;HandleData
00921                                 );
00922     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00923         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00924         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo))  {
00925             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00926             <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00927         }
00928         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d5/struct__CONSOLE__SETDISPLAYMODE__MSG.html#o2">dwFlags</a> == CONSOLE_FULLSCREEN_MODE) {
00929 <span class="preprocessor">#if !defined(_X86_)</span>
00930 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00931                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00932                 <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00933             }
00934 <span class="preprocessor">#else</span>
00935 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a12">FullScreenInitialized</a>) {
00936                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00937                 <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00938             }
00939 <span class="preprocessor">#endif</span>
00940 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
00941                 KdPrint((<span class="stringliteral">"CONSRV: VDM converting to fullscreen twice\n"</span>));
00942                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00943                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00944                 <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00945             }
00946             State = FULLSCREEN;
00947         } <span class="keywordflow">else</span> {
00948             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0) {
00949                 KdPrint((<span class="stringliteral">"CONSRV: VDM converting to windowed twice\n"</span>));
00950                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00951                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00952                 <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00953             }
00954             State = WINDOWED;
00955         }
00956         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a76">QueueConsoleMessage</a>(Console,
00957                     CM_MODE_TRANSITION,
00958                     State,
00959                     (LPARAM)hEvent
00960                     );
00961         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00962             <span class="keywordflow">goto</span> SrvSetConsoleDisplayModeFailure;
00963         }
00964     }
00965     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00966     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00967 
00968 SrvSetConsoleDisplayModeFailure:
00969     <span class="keywordflow">if</span> (hEvent) {
00970         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(hEvent, NULL);
00971         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hEvent);
00972     }
00973     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00974     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00975 
00976     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00977 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a213" doxytag="consrv.h::SrvSetConsoleFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01118">1118</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00153">_SCREEN_INFORMATION::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00426">_CONSOLE_SETFONT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00428">_CONSOLE_SETFONT_MSG::FontIndex</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00427">_CONSOLE_SETFONT_MSG::OutputHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01122 {
01123     <a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html">PCONSOLE_SETFONT_MSG</a> a = (<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html">PCONSOLE_SETFONT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01124     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01125     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01126     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01127     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01128 
01129     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o0">ConsoleHandle</a>,
01130                          &amp;Console
01131                         );
01132     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01133         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01134     }
01135     <span class="keywordflow">try</span> {
01136         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01137                                      a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o1">OutputHandle</a>,
01138                                      CONSOLE_OUTPUT_HANDLE,
01139                                      GENERIC_WRITE,
01140                                      &amp;HandleData
01141                                     );
01142         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01143             leave;
01144         }
01145 
01146         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
01147         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
01148             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
01149         } <span class="keywordflow">else</span> {
01150 <span class="preprocessor">#if defined(FE_SB)</span>
01151 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo,a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o2">FontIndex</a>,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>);
01152 <span class="preprocessor">#else</span>
01153 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo,a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o2">FontIndex</a>);
01154 <span class="preprocessor">#endif</span>
01155 <span class="preprocessor"></span>        }
01156     } finally {
01157         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01158     }
01159     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01160     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01161 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a288" doxytag="consrv.h::SrvSetConsoleHardwareState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleHardwareState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02280">2280</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00701">_CONSOLE_SETHARDWARESTATE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00704">_CONSOLE_SETHARDWARESTATE_MSG::FontSize</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00115">_MODE_FONT_PAIR::FontSize</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00054">FS_GRAPHICS</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00053">FS_TEXT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a51">IsAvailableFsCodePage()</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00049">_MODE_FONT_PAIR::Mode</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00120">ModeFontPairs</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00118">NUMBER_OF_MODE_FONT_PAIRS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00702">_CONSOLE_SETHARDWARESTATE_MSG::OutputHandle</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00069">RegModeFontPairs</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00703">_CONSOLE_SETHARDWARESTATE_MSG::Resolution</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00114">_MODE_FONT_PAIR::Resolution</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02284 {
02285 <span class="preprocessor">#ifdef i386</span>
02286 <span class="preprocessor"></span>    <a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html">PCONSOLE_SETHARDWARESTATE_MSG</a> a = (<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html">PCONSOLE_SETHARDWARESTATE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02287     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02288     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02289     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02290     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
02291     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02292 
02293     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o0">ConsoleHandle</a>,
02294                          &amp;Console
02295                         );
02296     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02297         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02298     }
02299     <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE)) {
02300         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02301         <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
02302     }
02303     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
02304                                  a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o1">OutputHandle</a>,
02305                                  CONSOLE_OUTPUT_HANDLE,
02306                                  GENERIC_READ,
02307                                  &amp;HandleData
02308                                 );
02309     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02310 <span class="preprocessor">#if defined(FE_SB)</span>
02311 <span class="preprocessor"></span>        <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fGraphics = fFullScreenGraphics ? <a class="code" href="../../d0/d3/dbcs_8h.html#a51">IsAvailableFsCodePage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>) : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02312 <span class="preprocessor">#endif</span>
02313 <span class="preprocessor"></span>        ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
02314 
02315         <span class="comment">// match requested mode</span>
02316 
02317         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>&lt;<a class="code" href="../../d7/d4/server_2private_8c.html#a17">NUMBER_OF_MODE_FONT_PAIRS</a>;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
02318 <span class="preprocessor">#if defined(FE_SB)</span>
02319 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o2">Resolution</a>.X == <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>.X &amp;&amp;
02320                 a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o2">Resolution</a>.Y == <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>.Y &amp;&amp;
02321                 a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o3">FontSize</a>.Y == <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o3">FontSize</a>.Y &amp;&amp;
02322                 a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o3">FontSize</a>.X == <a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o3">FontSize</a>.X &amp;&amp;
02323                 ( ( fGraphics &amp;&amp; (<a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o0">Mode</a> &amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a12">FS_GRAPHICS</a>)==<a class="code" href="../../d0/d3/dbcs_8h.html#a12">FS_GRAPHICS</a>) ||
02324                   (!fGraphics &amp;&amp; (<a class="code" href="../../d0/d3/dbcs_8h.html#a24">RegModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o0">Mode</a> &amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a11">FS_TEXT</a>)==<a class="code" href="../../d0/d3/dbcs_8h.html#a11">FS_TEXT</a>)           )
02325                ) {
02326                 <span class="keywordflow">break</span>;
02327             }
02328 <span class="preprocessor">#else</span>
02329 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o2">Resolution</a>.X == <a class="code" href="../../d7/d4/server_2private_8c.html#a28">ModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>.X &amp;&amp;
02330                 a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o2">Resolution</a>.Y == <a class="code" href="../../d7/d4/server_2private_8c.html#a28">ModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o2">Resolution</a>.Y &amp;&amp;
02331                 a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o3">FontSize</a>.Y == <a class="code" href="../../d7/d4/server_2private_8c.html#a28">ModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o3">FontSize</a>.Y &amp;&amp;
02332                 a-&gt;<a class="code" href="../../d8/d5/struct__CONSOLE__SETHARDWARESTATE__MSG.html#o3">FontSize</a>.X == <a class="code" href="../../d7/d4/server_2private_8c.html#a28">ModeFontPairs</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d8/struct__MODE__FONT__PAIR.html#o3">FontSize</a>.X) {
02333                 <span class="keywordflow">break</span>;
02334             }
02335 <span class="preprocessor">#endif</span>
02336 <span class="preprocessor"></span>        }
02337         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == <a class="code" href="../../d7/d4/server_2private_8c.html#a17">NUMBER_OF_MODE_FONT_PAIRS</a>) {
02338             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
02339         } <span class="keywordflow">else</span> {
02340             <span class="comment">// set requested mode</span>
02341             ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02342             SetVideoMode(ScreenInfo);
02343         }
02344     }
02345     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02346     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02347 <span class="preprocessor">#else</span>
02348 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
02349     UNREFERENCED_PARAMETER(m);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02350 <span class="preprocessor">#endif</span>
02351 <span class="preprocessor"></span>    UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02352 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a214" doxytag="consrv.h::SrvSetConsoleIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01164">1164</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00432">_CONSOLE_SETICON_MSG::ConsoleHandle</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00150">CopyIcon()</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00535">DestroyIcon</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00028">ghDefaultIcon</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00029">ghDefaultSmIcon</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00433">_CONSOLE_SETICON_MSG::hIcon</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00159">_CONSOLE_INFORMATION::hIcon</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00160">_CONSOLE_INFORMATION::hSmIcon</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01168 {
01169     <a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html">PCONSOLE_SETICON_MSG</a> a = (<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html">PCONSOLE_SETICON_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01170     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01171     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01172     HANDLE hIcon;
01173 
01174     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html#o0">ConsoleHandle</a>,
01175                          &amp;Console
01176                         );
01177     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01178         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01179     }
01180 
01181     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html#o1">hIcon</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01182         hIcon = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>;
01183     } <span class="keywordflow">else</span> {
01184         hIcon = <a class="code" href="../../d3/d8/client_8c.html#a36">CopyIcon</a>(a-&gt;<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html#o1">hIcon</a>);
01185     }
01186 
01187     <span class="keywordflow">if</span> (hIcon == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01188         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01189     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hIcon != Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>) {
01190         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, WM_SETICON, ICON_BIG, (LPARAM)hIcon);
01191         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
01192             <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>);
01193         }
01194         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> = hIcon;
01195 
01196         <span class="comment">/*</span>
01197 <span class="comment">         * Small icon now</span>
01198 <span class="comment">         */</span>
01199         <span class="keywordflow">if</span> (hIcon != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
01200             <span class="comment">/*</span>
01201 <span class="comment">             * The new one is not the default, clean-up</span>
01202 <span class="comment">             */</span>
01203             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>) {
01204                 <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a>);
01205             }
01206             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01207             <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, WM_SETICON, ICON_SMALL, (LPARAM)NULL);
01208         } <span class="keywordflow">else</span> {
01209             <span class="comment">/*</span>
01210 <span class="comment">             * Change to default, so we can use the default small icon</span>
01211 <span class="comment">             */</span>
01212             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>) {
01213                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01214                     <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a>);
01215                 }
01216                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>;
01217                 <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, WM_SETICON, ICON_SMALL, (LPARAM)ghDefaultSmIcon);
01218             }
01219         }
01220     }
01221     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01222 
01223     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01224     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01225 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a291" doxytag="consrv.h::SrvSetConsoleKeyShortcuts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleKeyShortcuts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02423">2423</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00741">_CONSOLE_SETKEYSHORTCUTS_MSG::AppKeys</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00087">CONSOLE_HAS_FOCUS</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00446">CONSOLE_MAX_APP_SHORTCUTS</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00737">_CONSOLE_SETKEYSHORTCUTS_MSG::ConsoleHandle</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02403">ConvertHotKey()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00740">_CONSOLE_SETKEYSHORTCUTS_MSG::NumAppKeys</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00163">_CONSOLE_INFORMATION::ReserveKeys</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00739">_CONSOLE_SETKEYSHORTCUTS_MSG::ReserveKeys</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a313">SetConsoleReserveKeys()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02427 {
02428     <a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html">PCONSOLE_SETKEYSHORTCUTS_MSG</a> a = (<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html">PCONSOLE_SETKEYSHORTCUTS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02429     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02430     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02431 
02432     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o0">ConsoleHandle</a>,
02433                          &amp;Console
02434                         );
02435     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02436         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02437     }
02438 
02439     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o4">AppKeys</a>, a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o3">NumAppKeys</a>, <span class="keyword">sizeof</span>(*a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o4">AppKeys</a>))) {
02440         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02441         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
02442     }
02443 
02444     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o3">NumAppKeys</a> &lt;= <a class="code" href="../../d1/d7/server_8h.html#a94">CONSOLE_MAX_APP_SHORTCUTS</a>) {
02445         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o34">ReserveKeys</a> = a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o2">ReserveKeys</a>;
02446         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a2">CONSOLE_HAS_FOCUS</a>) {
02447             <span class="keywordflow">if</span> (!(<a class="code" href="../../d8/d5/consrv_8h.html#a313">SetConsoleReserveKeys</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o2">ReserveKeys</a>))) {
02448                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
02449             }
02450         }
02451         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o3">NumAppKeys</a>) {
02452             <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,
02453                          WM_SETHOTKEY,
02454                          <a class="code" href="../../d7/d4/server_2private_8c.html#a60">ConvertHotKey</a>(a-&gt;<a class="code" href="../../d0/d6/struct__CONSOLE__SETKEYSHORTCUTS__MSG.html#o4">AppKeys</a>),
02455                          0
02456                         );
02457         }
02458     } <span class="keywordflow">else</span> {
02459         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
02460     }
02461     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02462     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02463     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02464 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a290" doxytag="consrv.h::SrvSetConsoleMenuClose" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleMenuClose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02376">2376</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00091">CONSOLE_DISABLE_CLOSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00745">_CONSOLE_SETMENUCLOSE_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00746">_CONSOLE_SETMENUCLOSE_MSG::Enable</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02380 {
02381     <a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html">PCONSOLE_SETMENUCLOSE_MSG</a> a = (<a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html">PCONSOLE_SETMENUCLOSE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02382     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02383     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02384 
02385     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html#o0">ConsoleHandle</a>,
02386                          &amp;Console
02387                         );
02388     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02389         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02390     }
02391     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d6/struct__CONSOLE__SETMENUCLOSE__MSG.html#o1">Enable</a>) {
02392         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a6">CONSOLE_DISABLE_CLOSE</a>;
02393     } <span class="keywordflow">else</span> {
02394         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a6">CONSOLE_DISABLE_CLOSE</a>;
02395     }
02396     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02397     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02398     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02399 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a203" doxytag="consrv.h::SrvSetConsoleMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00354">354</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00300">CONSOLE_ANY_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00096">CONSOLE_QUICK_EDIT_MODE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00104">CONSOLE_USE_PRIVATE_FLAGS</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00304">_CONSOLE_MODE_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00305">_CONSOLE_MODE_MSG::Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00342">INPUT_MODES</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00180">_CONSOLE_INFORMATION::InsertMode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00306">_CONSOLE_MODE_MSG::Mode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00343">OUTPUT_MODES</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00344">PRIVATE_MODES</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
<pre class="fragment"><div>00358 {
00359     <a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a> a = (<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00360     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00361     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00362     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00363 
00364     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o0">ConsoleHandle</a>,
00365                          &amp;Console
00366                         );
00367     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00368         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00369     }
00370     <span class="keywordflow">try</span> {
00371         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00372                                      a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o1">Handle</a>,
00373                                      CONSOLE_ANY_HANDLE,
00374                                      GENERIC_WRITE,
00375                                      &amp;HandleData
00376                                     );
00377         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00378             leave;
00379         }
00380 
00381         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
00382             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ~(<a class="code" href="../../d1/d7/server_8h.html#a59">INPUT_MODES</a> | <a class="code" href="../../d1/d7/server_8h.html#a61">PRIVATE_MODES</a>)) {
00383                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00384                 leave;
00385             }
00386             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; (ENABLE_LINE_INPUT | ENABLE_ECHO_INPUT)) == ENABLE_ECHO_INPUT) {
00387                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00388                 leave;
00389             }
00390             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a61">PRIVATE_MODES</a>) {
00391                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>;
00392                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_QUICK_EDIT_MODE) {
00393                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00394                 } <span class="keywordflow">else</span> {
00395                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00396                 }
00397                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_INSERT_MODE) {
00398                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00399                 } <span class="keywordflow">else</span> {
00400                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00401                 }
00402             } <span class="keywordflow">else</span> {
00403                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>;
00404             }
00405 
00406 <span class="preprocessor">#ifdef i386</span>
00407 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE &amp;&amp;
00408                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a> &amp;&amp;
00409                 (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_MOUSE_INPUT) != (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode &amp; ENABLE_MOUSE_INPUT)) {
00410                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_MOUSE_INPUT) {
00411                     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode |= ENABLE_MOUSE_INPUT;
00412                 }
00413 <span class="preprocessor">#if defined(FE_SB)</span>
00414 <span class="preprocessor"></span>                <span class="comment">// Korean HBIOS doesn't like to reverse mouse pointer.</span>
00415                 <span class="comment">// Because HBIOS will initialize full screen mode again.</span>
00416                 <span class="comment">// 949 = Korea WanSung Code Page.</span>
00417                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> != 949) {
00418                     ReverseMousePointer(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
00419                                         &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00420                 }
00421 <span class="preprocessor">#else</span>
00422 <span class="preprocessor"></span>                ReverseMousePointer(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
00423                                     &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00424 <span class="preprocessor">#endif</span>
00425 <span class="preprocessor"></span>            }
00426 <span class="preprocessor">#endif</span>
00427 <span class="preprocessor"></span>            HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode = a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ~<a class="code" href="../../d1/d7/server_8h.html#a61">PRIVATE_MODES</a>;
00428         }
00429         <span class="keywordflow">else</span> {
00430             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ~<a class="code" href="../../d1/d7/server_8h.html#a60">OUTPUT_MODES</a>) {
00431                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00432                 leave;
00433             }
00434             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;OutputMode = a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a>;
00435         }
00436     } finally {
00437         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00438     }
00439     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00440     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00441 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a247" doxytag="consrv.h::SrvSetConsoleNumberOfCommands" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvSetConsoleNumberOfCommands           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01424">1424</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00555">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00558">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00557">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00556">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::NumCommands</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00560">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01428 {
01429     <a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html">PCONSOLE_SETNUMBEROFCOMMANDS_MSG</a> a = (<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html">PCONSOLE_SETNUMBEROFCOMMANDS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01430     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01431     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01432 
01433     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o0">ConsoleHandle</a>,
01434                          &amp;Console
01435                         );
01436     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01437         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01438     }
01439 
01440     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o3">Exe</a>, a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01441         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01442         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01443     }
01444 
01445     <a class="code" href="../../d4/d1/cmdline_8h.html#a44">ReallocCommandHistory</a>(Console,
01446                           <a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01447                                                 a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o3">Exe</a>,
01448                                                 a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a>,
01449                                                 a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o5">UnicodeExe</a>),
01450                           a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o1">NumCommands</a>
01451                          );
01452     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01453     <span class="keywordflow">return</span> STATUS_SUCCESS;
01454     UNREFERENCED_PARAMETER(ReplyStatus);
01455 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a281" doxytag="consrv.h::SrvSetConsolePalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsolePalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00432">432</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00664">_CONSOLE_SETPALETTE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00667">_CONSOLE_SETPALETTE_MSG::dwUsage</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00666">_CONSOLE_SETPALETTE_MSG::hPalette</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00235">_CONSOLE_INFORMATION::InputThreadInfo</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00870">NtUserConsoleControl()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00665">_CONSOLE_SETPALETTE_MSG::OutputHandle</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00720">RealizePalette</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00718">SelectPalette</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00056">_INPUT_THREAD_INFO::ThreadId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00439            :
00440 
00441     Sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> palette <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console screen buffer.
00442 
00443 Parameters:
00444 
00445     hOutput - Supplies a console output handle.
00446 
00447     hPalette - Supplies a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> palette to set.
00448 
00449     dwUsage - Specifies use of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system palette.
00450 
00451         SYSPAL_NOSTATIC - System palette contains no <span class="keyword">static</span> colors
00452                           except black and white.
00453 
00454         SYSPAL_STATIC -   System palette contains <span class="keyword">static</span> colors
00455                           which will not change when an application
00456                           realizes its logical palette.
00457 
00458 Return value:
00459 
00460     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00461 
00462     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00463         <span class="keyword">using</span> GetLastError.
00464 
00465 --*/
00466 
00467 {
00468     <a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html">PCONSOLE_SETPALETTE_MSG</a> a = (<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html">PCONSOLE_SETPALETTE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00469     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00470     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00471     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00472     HPALETTE hOldPalette;
00473 
00474     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o0">ConsoleHandle</a>,
00475                          &amp;Console
00476                         );
00477     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00478         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00479     }
00480     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00481                                  a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o1">OutputHandle</a>,
00482                                  CONSOLE_GRAPHICS_OUTPUT_HANDLE,
00483                                  GENERIC_WRITE,
00484                                  &amp;HandleData
00485                                 );
00486     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00487         USERTHREAD_USEDESKTOPINFO utudi;
00488         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00489 
00490         <span class="comment">/*</span>
00491 <span class="comment">         * Palette handle was converted in the client.</span>
00492 <span class="comment">         */</span>
00493         <span class="keywordflow">if</span> (GetCurrentThreadId() != HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;
00494                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o75">InputThreadInfo</a>-&gt;<a class="code" href="../../d9/d2/struct__INPUT__THREAD__INFO.html#o1">ThreadId</a>) {
00495             bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00496             utudi.hThread = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;InputThreadInfo-&gt;ThreadHandle;
00497             utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00498             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00499                     UserThreadUseDesktop,
00500                     &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00501         }
00502 
00503         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a86">NtUserConsoleControl</a>(ConsolePublicPalette, &amp;(a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o2">hPalette</a>), <span class="keyword">sizeof</span>(HPALETTE));
00504 
00505         hOldPalette = <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(
00506                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hDC,
00507                 a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o2">hPalette</a>,
00508                 FALSE);
00509 
00510         <span class="keywordflow">if</span> (hOldPalette == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00511             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00512         } <span class="keywordflow">else</span> {
00513             <span class="keywordflow">if</span> ((HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;hPalette != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00514                     (a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o2">hPalette</a> != HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;hPalette)) {
00515                 DeleteObject(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;hPalette);
00516             }
00517             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;hPalette = a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o2">hPalette</a>;
00518             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;dwUsage = a-&gt;<a class="code" href="../../d3/d6/struct__CONSOLE__SETPALETTE__MSG.html#o3">dwUsage</a>;
00519             <span class="keywordflow">if</span> (!(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a>) &amp;&amp;
00520                     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags == 0) {
00521 
00522                 SetSystemPaletteUse(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hDC,
00523                         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;dwUsage);
00524                 <a class="code" href="../../d3/d0/user32_8def.html#a84">RealizePalette</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hDC);
00525             }
00526             <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hSysPalette == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00527                     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hSysPalette = hOldPalette;
00528             }
00529         }
00530 
00531         <span class="keywordflow">if</span> (bReset) {
00532             utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00533             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00534                     UserThreadUseDesktop, &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00535         }
00536     }
00537     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00538     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00539     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00540 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a207" doxytag="consrv.h::SrvSetConsoleScreenBufferSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleScreenBufferSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00608">608</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00383">_CONSOLE_SETSCREENBUFFERSIZE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00202">_WINDOW_LIMITS::MinimumWindowSize</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00384">_CONSOLE_SETSCREENBUFFERSIZE_MSG::OutputHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00385">_CONSOLE_SETSCREENBUFFERSIZE_MSG::Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00612 {
00613     <a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html">PCONSOLE_SETSCREENBUFFERSIZE_MSG</a> a = (<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html">PCONSOLE_SETSCREENBUFFERSIZE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00614     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00615     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00616     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00617     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00618     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00619 
00620     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o0">ConsoleHandle</a>,
00621                          &amp;Console
00622                         );
00623     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00624         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00625     }
00626     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00627                                  a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o1">OutputHandle</a>,
00628                                  CONSOLE_OUTPUT_HANDLE,
00629                                  GENERIC_WRITE,
00630                                  &amp;HandleData
00631                                 );
00632     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00633 
00634         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00635 
00636         <span class="comment">//</span>
00637         <span class="comment">// make sure requested screen buffer size isn't smaller than the window</span>
00638         <span class="comment">//</span>
00639 
00640         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00641         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.X &lt; <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) ||
00642             a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.Y &lt; <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) ||
00643             a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.Y &lt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.Y ||
00644             a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.X &lt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X) {
00645             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00646         }
00647         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.X == ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X &amp;&amp;
00648                  a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.Y == ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00649             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00650         } <span class="keywordflow">else</span> {
00651             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a58">ResizeScreenBuffer</a>(ScreenInfo,
00652                                   a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>,
00653                                   TRUE);
00654         }
00655     }
00656     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00657     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00658     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00659 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a212" doxytag="consrv.h::SrvSetConsoleTextAttribute" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleTextAttribute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01078">1078</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00422">_CONSOLE_SETTEXTATTRIBUTE_MSG::Attributes</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00420">_CONSOLE_SETTEXTATTRIBUTE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00421">_CONSOLE_SETTEXTATTRIBUTE_MSG::OutputHandle</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01002">SetScreenColors()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00233">VALID_TEXT_ATTRIBUTES</a>.
<p>
<pre class="fragment"><div>01082 {
01083     <a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html">PCONSOLE_SETTEXTATTRIBUTE_MSG</a> a = (<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html">PCONSOLE_SETTEXTATTRIBUTE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01084     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01085     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01086     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01087 
01088     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o0">ConsoleHandle</a>,
01089                          &amp;Console
01090                         );
01091     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01092         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01093     }
01094     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01095                                  a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o1">OutputHandle</a>,
01096                                  CONSOLE_OUTPUT_HANDLE,
01097                                  GENERIC_WRITE,
01098                                  &amp;HandleData
01099                                 );
01100     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01101 
01102         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o2">Attributes</a> &amp; ~<a class="code" href="../../d7/d2/output_8h.html#a6">VALID_TEXT_ATTRIBUTES</a>) {
01103             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01104         } <span class="keywordflow">else</span> {
01105             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01106                                      a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o2">Attributes</a>,
01107                                      HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;PopupAttributes,
01108                                      FALSE
01109                                     );
01110         }
01111     }
01112     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01113     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01114     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01115 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a257" doxytag="consrv.h::SrvSetConsoleTitle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleTitle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">4929</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00359">CM_UPDATE_TITLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00619">_CONSOLE_SETTITLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00157">_CONSOLE_INFORMATION::Title</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00621">_CONSOLE_SETTITLE_MSG::Title</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00066">TITLE_TAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00155">_CONSOLE_INFORMATION::TitleLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00620">_CONSOLE_SETTITLE_MSG::TitleLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00622">_CONSOLE_SETTITLE_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>04933 {
04934     <a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html">PCONSOLE_SETTITLE_MSG</a> a = (<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html">PCONSOLE_SETTITLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
04935     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04936     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
04937     LPWSTR NewTitle;
04938 
04939     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o0">ConsoleHandle</a>,
04940                          &amp;Console
04941                         );
04942     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
04943         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04944     }
04945 
04946     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>, a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
04947         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04948         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
04949     }
04950 
04951     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o3">Unicode</a>) {
04952         NewTitle = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TITLE_TAG ),a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>*<span class="keyword">sizeof</span>(WCHAR)+<span class="keyword">sizeof</span>(WCHAR));
04953         <span class="keywordflow">if</span> (NewTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04954             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04955             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
04956         }
04957 
04958         <span class="comment">// convert title to unicode</span>
04959 
04960 <span class="preprocessor">#if defined(FE_SB)</span>
04961 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(OEMCP,
04962                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>,
04963                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>,
04964                                                  NewTitle,
04965                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>);
04966 <span class="preprocessor">#else</span>
04967 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
04968                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>,
04969                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>,
04970                                                  NewTitle,
04971                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>);
04972 <span class="preprocessor">#endif</span>
04973 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> *= 2;
04974     } <span class="keywordflow">else</span> {
04975         <span class="comment">// a-&gt;TitleLength contains length in bytes</span>
04976 
04977         NewTitle = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TITLE_TAG ),a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>+<span class="keyword">sizeof</span>(WCHAR));
04978         <span class="keywordflow">if</span> (NewTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04979             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04980             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
04981         }
04982         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>;
04983         RtlCopyMemory(NewTitle,a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>,a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>);
04984     }
04985     NewTitle[Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>/<span class="keyword">sizeof</span>(WCHAR)] = 0;   <span class="comment">// NULL terminate</span>
04986     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>);
04987     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a> = NewTitle;
04988     <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, CM_UPDATE_TITLE, 0, 0);
04989     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04990     <span class="keywordflow">return</span> STATUS_SUCCESS;
04991     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
04992 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a210" doxytag="consrv.h::SrvSetConsoleWindowInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleWindowInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">773</a> of file <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html">ntcon/server/getset.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00404">_CONSOLE_SETWINDOWINFO_MSG::Absolute</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00153">_SCREEN_INFORMATION::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00402">_CONSOLE_SETWINDOWINFO_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00211">_CONSOLE_INFORMATION::OutputCP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00403">_CONSOLE_SETWINDOWINFO_MSG::OutputHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03858">ResizeWindow()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03953">SetWindowSize()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00405">_CONSOLE_SETWINDOWINFO_MSG::Window</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00267">WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00268">WINDOW_SIZE_Y</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
<pre class="fragment"><div>00777 {
00778     <a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html">PCONSOLE_SETWINDOWINFO_MSG</a> a = (<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html">PCONSOLE_SETWINDOWINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00779     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00780     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00781     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00782     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00783     COORD NewWindowSize;
00784     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00785 
00786     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o0">ConsoleHandle</a>,
00787                          &amp;Console
00788                         );
00789     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00790         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00791     }
00792     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00793                                  a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o1">OutputHandle</a>,
00794                                  CONSOLE_OUTPUT_HANDLE,
00795                                  GENERIC_WRITE,
00796                                  &amp;HandleData
00797                                 );
00798     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00799         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00800         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o2">Absolute</a>) {
00801             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Left += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00802             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Right += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right;
00803             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Top += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00804             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Bottom += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom;
00805         }
00806         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Right &lt; a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Left ||
00807             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Bottom &lt; a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Top) {
00808             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00809         } <span class="keywordflow">else</span> {
00810             NewWindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>));
00811             NewWindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>));
00812             <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00813             <span class="keywordflow">if</span> ((NewWindowSize.X &gt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.X ||
00814                  NewWindowSize.Y &gt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.Y) &amp;&amp;
00815                  !(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN)) {
00816                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00817             } <span class="keywordflow">else</span> {
00818 <span class="preprocessor">#ifdef i386</span>
00819 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
00820                     COORD NewOrigin;
00821 
00822                     <span class="keywordflow">if</span> (NewWindowSize.X != (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>)) ||
00823                         NewWindowSize.Y != (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>))) {
00824                         COORD WindowSize;
00825                         ULONG ModeIndex;
00826 
00827 <span class="preprocessor">#if defined(FE_SB)</span>
00828 <span class="preprocessor"></span>                        ModeIndex = MatchWindowSize(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,NewWindowSize,&amp;WindowSize);
00829 <span class="preprocessor">#else</span>
00830 <span class="preprocessor"></span>                        ModeIndex = MatchWindowSize(NewWindowSize,&amp;WindowSize);
00831 <span class="preprocessor">#endif</span>
00832 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (NewWindowSize.X != WindowSize.X ||
00833                             NewWindowSize.Y != WindowSize.Y ||
00834                             WindowSize.X &gt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X ||
00835                             WindowSize.Y &gt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00836                             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00837                             <span class="keywordflow">return</span> (ULONG) STATUS_FULLSCREEN_MODE;
00838                         }
00839                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex = ModeIndex;
00840                         <a class="code" href="../../d6/d2/output_8c.html#a67">ResizeWindow</a>(ScreenInfo,
00841                                      &amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>,
00842                                      FALSE
00843                                     );
00844                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedWindowSize.X =
00845                                 <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
00846                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedWindowSize.Y =
00847                                 <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
00848                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE &amp;&amp;
00849                             (!(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) ) {
00850                             SetVideoMode(ScreenInfo);
00851                             <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00852                         }
00853                     } <span class="keywordflow">else</span> {
00854                         NewOrigin.X = a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Left;
00855                         NewOrigin.Y = a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Top;
00856                         <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
00857                                         TRUE,
00858                                         NewOrigin
00859                                        );
00860                     }
00861                 } <span class="keywordflow">else</span>
00862 <span class="preprocessor">#endif</span>
00863 <span class="preprocessor"></span>                {
00864                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a67">ResizeWindow</a>(ScreenInfo,
00865                                           &amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>,
00866                                           TRUE
00867                                          );
00868                     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
00869                         <a class="code" href="../../d6/d2/output_8c.html#a68">SetWindowSize</a>(ScreenInfo);
00870                         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00871                     }
00872                 }
00873             }
00874         }
00875     }
00876     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00877     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00878     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00879 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a227" doxytag="consrv.h::SrvSetHandleInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetHandleInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02794">2794</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00299">CONSOLE_INHERITABLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00484">_CONSOLE_SETHANDLEINFORMATION_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00487">_CONSOLE_SETHANDLEINFORMATION_MSG::Flags</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00485">_CONSOLE_SETHANDLEINFORMATION_MSG::Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00486">_CONSOLE_SETHANDLEINFORMATION_MSG::Mask</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02801                    :
02802 
02803     This sets information about an input or output handle.
02804 
02805 Arguments:
02806 
02807     ApiMessageData - Points to parameter structure.
02808 
02809 Return Value:
02810 
02811 --*/
02812 
02813 {
02814     <a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html">PCONSOLE_SETHANDLEINFORMATION_MSG</a> a = (<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html">PCONSOLE_SETHANDLEINFORMATION_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02815     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02816     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02817     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02818 
02819     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o0">ConsoleHandle</a>,
02820                          &amp;Console
02821                         );
02822     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02823         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02824     }
02825     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
02826                                  <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o1">Handle</a>),
02827                                  &amp;HandleData
02828                                 );
02829     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02830         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o2">Mask</a> &amp; HANDLE_FLAG_INHERIT) {
02831             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o3">Flags</a> &amp; HANDLE_FLAG_INHERIT) {
02832                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> |= <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
02833             } <span class="keywordflow">else</span> {
02834                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
02835             }
02836         }
02837     }
02838     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02839     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02840     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
02841 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a279" doxytag="consrv.h::SrvShowConsoleCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvShowConsoleCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00298">298</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00651">_CONSOLE_SHOWCURSOR_MSG::bShow</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00649">_CONSOLE_SHOWCURSOR_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00652">_CONSOLE_SHOWCURSOR_MSG::DisplayCount</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00311">_HANDLE_DATA::HandleType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00650">_CONSOLE_SHOWCURSOR_MSG::OutputHandle</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00305            :
00306 
00307     Sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mouse pointer visibility counter.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> counter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> less than
00308     zero, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mouse pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not shown.
00309 
00310 Parameters:
00311 
00312     hOutput - Supplies a console output handle.
00313 
00314     bShow - <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> display count <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be increased. <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00315         decreased.
00316 
00317 Return value:
00318 
00319     The <span class="keywordflow">return</span> value specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> display count.
00320 
00321 --*/
00322 
00323 {
00324     <a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html">PCONSOLE_SHOWCURSOR_MSG</a> a = (<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html">PCONSOLE_SHOWCURSOR_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00325     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00326     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00327     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00328 
00329     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o0">ConsoleHandle</a>,
00330                          &amp;Console
00331                         );
00332     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00333         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00334     }
00335     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00336                                  a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o1">OutputHandle</a>,
00337                                  CONSOLE_OUTPUT_HANDLE | CONSOLE_GRAPHICS_OUTPUT_HANDLE,
00338                                  GENERIC_WRITE,
00339                                  &amp;HandleData
00340                                 );
00341     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00342         <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) ) {
00343             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o2">bShow</a>) {
00344                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CursorDisplayCount += 1;
00345             } <span class="keywordflow">else</span> {
00346                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CursorDisplayCount -= 1;
00347             }
00348             <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer == Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>) {
00349                 <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;hWnd,
00350                              WM_SETCURSOR,
00351                              0,
00352                              -1
00353                             );
00354             }
00355         } <span class="keywordflow">else</span> {
00356 <span class="preprocessor">#ifdef i386</span>
00357 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> != <a class="code" href="../../d1/d7/server_8h.html#a48">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a> &amp;&amp;
00358                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE &amp;&amp;
00359                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer == Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>) {
00360                 FullScreenCursor(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o2">bShow</a>);
00361             }
00362 <span class="preprocessor">#endif</span>
00363 <span class="preprocessor"></span>        }
00364         a-&gt;<a class="code" href="../../d9/d6/struct__CONSOLE__SHOWCURSOR__MSG.html#o3">DisplayCount</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;CursorDisplayCount;
00365     }
00366     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00367     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00368     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00369 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a276" doxytag="consrv.h::SrvVDMConsoleOperation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvVDMConsoleOperation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/srvvdm_8c-source.html#l00024">24</a> of file <a class="el" href="../../d3/d4/srvvdm_8c-source.html">srvvdm.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00634">_CONSOLE_VDM_MSG::Bool</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00593">ClientToScreen()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00365">CM_HIDE_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00383">CONSOLE_CLIENTPROCESSID</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00099">CONSOLE_FULLSCREEN_NOPAINT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00632">_CONSOLE_VDM_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00199">ConsoleHeapSize</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00608">GetClientRect()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00633">_CONSOLE_VDM_MSG::iFunction</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00525">IsIconic()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a124">PCONSOLE_VDM_MSG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00635">_CONSOLE_VDM_MSG::Point</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00636">_CONSOLE_VDM_MSG::Rect</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00670">ScreenToClient()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00204">_CONSOLE_INFORMATION::StateBuffer</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00206">_CONSOLE_INFORMATION::StateLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00196">_CONSOLE_INFORMATION::VDMProcessId</a>.
<p>
<pre class="fragment"><div>00028 {
00029     <a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html">PCONSOLE_VDM_MSG</a> a = (<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html">PCONSOLE_VDM_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00030     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00031     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00032 
00033     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o0">ConsoleHandle</a>,
00034                          &amp;Console
00035                         );
00036     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00037         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00038     }
00039     <span class="keywordflow">if</span> (!(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>) ||
00040         (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a> != <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>())) {
00041         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00042     } <span class="keywordflow">else</span> {
00043         <span class="keywordflow">switch</span> (a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o1">iFunction</a>) {
00044             <span class="keywordflow">case</span> VDM_HIDE_WINDOW:
00045                 <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,
00046                              CM_HIDE_WINDOW,
00047                              0,
00048                              0
00049                            );
00050                 <span class="keywordflow">break</span>;
00051             <span class="keywordflow">case</span> VDM_IS_ICONIC:
00052                 a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o2">Bool</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a19">IsIconic</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>);
00053                 <span class="keywordflow">break</span>;
00054             <span class="keywordflow">case</span> VDM_CLIENT_RECT:
00055                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,&amp;a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o4">Rect</a>);
00056                 <span class="keywordflow">break</span>;
00057             <span class="keywordflow">case</span> VDM_CLIENT_TO_SCREEN:
00058                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a23">ClientToScreen</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,&amp;a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o3">Point</a>);
00059                 <span class="keywordflow">break</span>;
00060             <span class="keywordflow">case</span> VDM_SCREEN_TO_CLIENT:
00061                 <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>,&amp;a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o3">Point</a>);
00062                 <span class="keywordflow">break</span>;
00063             <span class="keywordflow">case</span> VDM_IS_HIDDEN:
00064                 a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o2">Bool</a> = ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>) != 0);
00065                 <span class="keywordflow">break</span>;
00066             <span class="keywordflow">case</span> VDM_FULLSCREEN_NOPAINT:
00067                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o2">Bool</a>) {
00068                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a14">CONSOLE_FULLSCREEN_NOPAINT</a>;
00069                 } <span class="keywordflow">else</span> {
00070                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a14">CONSOLE_FULLSCREEN_NOPAINT</a>;
00071                 }
00072                 <span class="keywordflow">break</span>;
00073 <span class="preprocessor">#if defined(FE_SB)</span>
00074 <span class="preprocessor"></span>            <span class="keywordflow">case</span> VDM_SET_VIDEO_MODE:
00075                 Console-&gt;fVDMVideoMode = (a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o2">Bool</a> != 0);
00076                 <span class="keywordflow">break</span>;
00077 <span class="preprocessor">#if defined(i386)</span>
00078 <span class="preprocessor"></span>            <span class="keywordflow">case</span> VDM_SAVE_RESTORE_HW_STATE:
00079                 <span class="keywordflow">if</span> (ISNECPC98(gdwMachineId)) {
00080                     <span class="comment">// This function is used by MVDM to save/restore HW state</span>
00081                     <span class="comment">// when it executes DOS-AP on Fullscreen again.</span>
00082                     <span class="comment">// It is called from MVDM\SOFTPC\HOST\SRC\NT_FULSC.C.</span>
00083                     VIDEO_HARDWARE_STATE State;
00084                     ULONG StateSize = <span class="keyword">sizeof</span>(State);
00085 
00086                     State.StateHeader = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o58">StateBuffer</a>;
00087                     State.StateLength = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o60">StateLength</a>;
00088 
00089 
00090                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GdiFullscreenControl(a-&gt;<a class="code" href="../../d2/d7/struct__CONSOLE__VDM__MSG.html#o2">Bool</a> ? FullscreenControlRestoreHardwareState
00091                                                           : FullscreenControlSaveHardwareState,
00092                                                   &amp;State,
00093                                                   StateSize,
00094                                                   &amp;State,
00095                                                   &amp;StateSize);
00096                 }
00097                 <span class="keywordflow">break</span>;
00098             <span class="keywordflow">case</span> VDM_VIDEO_IOCTL:
00099                 <span class="keywordflow">if</span> (ISNECPC98(gdwMachineId)) {
00100                     <span class="comment">// This function is used by MVDM to access CG.</span>
00101                     <span class="comment">// It is called from MVDM\SOFTPC\HOST\SRC\NT_CGW.C.</span>
00102                     PVOID InBuffer;
00103 
00104                     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;VDMIoctlParam.lpvInBuffer, a-&gt;VDMIoctlParam.cbInBuffer, <span class="keyword">sizeof</span>(BYTE)) ||
00105                         !CsrValidateMessageBuffer(m, &amp;a-&gt;VDMIoctlParam.lpvOutBuffer, a-&gt;VDMIoctlParam.cbOutBuffer, <span class="keyword">sizeof</span>(BYTE))) {
00106                         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00107                         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00108                     }
00109                 
00110                     InBuffer = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(
00111                                          <a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),
00112                                          a-&gt;VDMIoctlParam.cbInBuffer + <span class="keyword">sizeof</span>(DWORD)
00113                                         );
00114                     <span class="keywordflow">if</span> (InBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00115                     {
00116                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00117                         <span class="keywordflow">break</span>;
00118                     }
00119 
00120                     *((PDWORD)InBuffer) = a-&gt;VDMIoctlParam.dwIoControlCode;
00121                     RtlCopyMemory((PBYTE)InBuffer + <span class="keyword">sizeof</span>(DWORD),
00122                                   a-&gt;VDMIoctlParam.lpvInBuffer,
00123                                   a-&gt;VDMIoctlParam.cbInBuffer
00124                                  );
00125 
00126                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GdiFullscreenControl(
00127                                  FullscreenControlSpecificVideoControl,
00128                                  InBuffer,
00129                                  <a class="code" href="../../d8/d5/consrv_8h.html#a39">ConsoleHeapSize</a>(InBuffer),
00130                                  a-&gt;VDMIoctlParam.lpvOutBuffer,
00131                                  a-&gt;VDMIoctlParam.lpvOutBuffer ?
00132                                      &amp;a-&gt;VDMIoctlParam.cbOutBuffer : 0
00133                                  );
00134 
00135                     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(InBuffer);
00136                 }
00137                 <span class="keywordflow">break</span>;
00138 <span class="preprocessor">#endif</span>
00139 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00140 <span class="preprocessor"></span>            <span class="keywordflow">default</span>:
00141                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00142         }
00143     }
00144 
00145     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00146     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00147     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00148 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a91" doxytag="consrv.h::SrvVerifyConsoleIoHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvVerifyConsoleIoHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01582">1582</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00589">_CONSOLE_VERIFYIOHANDLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00590">_CONSOLE_VERIFYIOHANDLE_MSG::Handle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00588">_CONSOLE_VERIFYIOHANDLE_MSG::Valid</a>.
<p>
<pre class="fragment"><div>01589                    :
01590 
01591     This routine verifies that a console io handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid.
01592 
01593 Arguments:
01594 
01595     ApiMessageData - Points to parameter structure.
01596 
01597 Return Value:
01598 
01599 --*/
01600 
01601 {
01602     <a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html">PCONSOLE_VERIFYIOHANDLE_MSG</a> a = (<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html">PCONSOLE_VERIFYIOHANDLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01603     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01604     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01605     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01606     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
01607 
01608     UNREFERENCED_PARAMETER(ReplyStatus);
01609 
01610     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o1">ConsoleHandle</a>,
01611                          &amp;Console
01612                         );
01613     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01614         ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
01615         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
01616                                      <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o2">Handle</a>),
01617                                      &amp;HandleData
01618                                     );
01619         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01620     }
01621     a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o0">Valid</a> = (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01622     <span class="keywordflow">return</span> STATUS_SUCCESS;
01623 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a224" doxytag="consrv.h::SrvWriteConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02463">2463</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00453">_CONSOLE_WRITECONSOLE_MSG::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00457">_CONSOLE_WRITECONSOLE_MSG::BufferInMessage</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00454">_CONSOLE_WRITECONSOLE_MSG::BufPtr</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00451">_CONSOLE_WRITECONSOLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00030">DoSrvWriteConsole</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00455">_CONSOLE_WRITECONSOLE_MSG::NumBytes</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00452">_CONSOLE_WRITECONSOLE_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>02470                    :
02471 
02472     This routine writes characters to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output stream.
02473 
02474 Arguments:
02475 
02476     ApiMessageData - Points to parameter structure.
02477 
02478 Return Value:
02479 
02480 --*/
02481 
02482 {
02483     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02484     <a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html">PCONSOLE_WRITECONSOLE_MSG</a> a = (<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html">PCONSOLE_WRITECONSOLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
02485     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
02486     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02487 
02488     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o0">ConsoleHandle</a>,
02489                          &amp;Console
02490                         );
02491     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02492         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02493     }
02494 
02495     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o6">BufferInMessage</a>) {
02496         <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a>, <span class="keyword">sizeof</span>(BYTE))) {
02497             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02498             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
02499         }
02500     }
02501     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a> &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o2">Buffer</a>)) {
02502         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02503         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
02504     }
02505 
02506 
02507     <span class="comment">//</span>
02508     <span class="comment">// Make sure we have a valid screen buffer.</span>
02509     <span class="comment">//</span>
02510 
02511     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
02512                                  a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o1">OutputHandle</a>,
02513                                  CONSOLE_OUTPUT_HANDLE,
02514                                  GENERIC_WRITE,
02515                                  &amp;HandleData
02516                                 );
02517     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02518         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02519         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02520     }
02521 
02522     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a1">DoSrvWriteConsole</a>(m,ReplyStatus,Console,HandleData);
02523 
02524     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
02525     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02526 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a185" doxytag="consrv.h::SrvWriteConsoleInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsoleInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00730">730</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00242">_CONSOLE_WRITECONSOLEINPUT_MSG::Append</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00239">_CONSOLE_WRITECONSOLEINPUT_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00236">_CONSOLE_WRITECONSOLEINPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00223">INPUT_RECORD_BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00237">_CONSOLE_WRITECONSOLEINPUT_MSG::InputHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00240">_CONSOLE_WRITECONSOLEINPUT_MSG::NumRecords</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01410">PrependInputBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00238">_CONSOLE_WRITECONSOLEINPUT_MSG::Record</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00241">_CONSOLE_WRITECONSOLEINPUT_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
<pre class="fragment"><div>00734 {
00735     <a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html">PCONSOLE_WRITECONSOLEINPUT_MSG</a> a = (<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html">PCONSOLE_WRITECONSOLEINPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00736     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00737     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00738     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00739     PINPUT_RECORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00740 
00741     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o0">ConsoleHandle</a>,
00742                          &amp;Console
00743                         );
00744     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00745         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00746     }
00747     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00748                                  a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o1">InputHandle</a>,
00749                                  CONSOLE_INPUT_HANDLE,
00750                                  GENERIC_WRITE,
00751                                  &amp;HandleData
00752                                 );
00753     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00754         a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = 0;
00755     } <span class="keywordflow">else</span> {
00756         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> &lt;= <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00757             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o2">Record</a>;
00758         } <span class="keywordflow">else</span> {
00759             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a>;
00760             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>, <span class="keyword">sizeof</span>(*Buffer))) {
00761                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00762                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00763             }
00764         }
00765         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o5">Unicode</a>) {
00766 <span class="preprocessor">#if defined(FE_SB)</span>
00767 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode</a>(Console,
00768                                     Buffer,
00769                                     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00770                                     &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;WriteConInpDbcsLeadByte[0]
00771                                    );
00772 <span class="preprocessor">#else</span>
00773 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode</a>(Console,
00774                                     Buffer,
00775                                     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>
00776                                    );
00777 <span class="preprocessor">#endif</span>
00778 <span class="preprocessor"></span>        }
00779         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o6">Append</a>) {
00780             a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>(Console,
00781                                              HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00782                                              Buffer,
00783                                              a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>
00784                                             );
00785         } <span class="keywordflow">else</span> {
00786             a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a29">PrependInputBuffer</a>(Console,
00787                                              HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00788                                              Buffer,
00789                                              a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>
00790                                             );
00791 
00792         }
00793     }
00794     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00795     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00796     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00797 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a187" doxytag="consrv.h::SrvWriteConsoleOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsoleOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">1284</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00258">_CONSOLE_WRITECONSOLEOUTPUT_MSG::BufPtr</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00257">_CONSOLE_WRITECONSOLEOUTPUT_MSG::Char</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00259">_CONSOLE_WRITECONSOLEOUTPUT_MSG::CharRegion</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00255">_CONSOLE_WRITECONSOLEOUTPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01174">FE_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00132">_CONSOLE_INFORMATION::InputBuffer</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00030">_INPUT_INFORMATION::InputMode</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00102">NtReadVirtualMemory()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00256">_CONSOLE_WRITECONSOLEOUTPUT_MSG::OutputHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00261">_CONSOLE_WRITECONSOLEOUTPUT_MSG::ReadVM</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01093">SB_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00146">TranslateOutputToUnicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00260">_CONSOLE_WRITECONSOLEOUTPUT_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01706">WriteScreenBuffer()</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
<pre class="fragment"><div>01288 {
01289     <a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html">PCONSOLE_WRITECONSOLEOUTPUT_MSG</a> a = (<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html">PCONSOLE_WRITECONSOLEOUTPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01290     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenBufferInformation;
01291     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01292     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01293     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01294     PCHAR_INFO <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01295 <span class="preprocessor">#if defined(FE_SB)</span>
01296 <span class="preprocessor"></span>    PCHAR_INFO TransBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01297 <span class="preprocessor">#endif</span>
01298 <span class="preprocessor"></span>
01299     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"SrvWriteConsoleOutput\n"</span>));
01300     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a>,
01301                          &amp;Console
01302                         );
01303     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01304         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01305     }
01306     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01307                                  a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o1">OutputHandle</a>,
01308                                  CONSOLE_OUTPUT_HANDLE,
01309                                  GENERIC_WRITE,
01310                                  &amp;HandleData
01311                                 );
01312     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01313 
01314         <span class="comment">//</span>
01315         <span class="comment">// a region of zero size is indicated by the right and bottom</span>
01316         <span class="comment">// coordinates being less than the left and top.</span>
01317         <span class="comment">//</span>
01318 
01319         a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left-1);
01320         a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top-1);
01321     } <span class="keywordflow">else</span> {
01322 
01323         COORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01324         ULONG NumBytes;
01325 
01326         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right - a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left + 1);
01327         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom - a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top + 1);
01328         NumBytes = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X * <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y * <span class="keyword">sizeof</span>(*Buffer);
01329 
01330         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X == 1) &amp;&amp; (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y == 1)) {
01331             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o2">Char</a>;
01332         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>) {
01333             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),NumBytes);
01334             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01335                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01336                 <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01337             }
01338             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d5/readwrt_8c.html#a9">NtReadVirtualMemory</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01339                                          a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>,
01340                                          Buffer,
01341                                          NumBytes,
01342                                          NULL
01343                                         );
01344             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01345                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Buffer);
01346                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01347                 <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01348             }
01349         } <span class="keywordflow">else</span> {
01350             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>;
01351             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>, NumBytes, <span class="keyword">sizeof</span>(BYTE))) {
01352                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01353                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01354             }
01355         }
01356         ScreenBufferInformation = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
01357 
01358         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o5">Unicode</a>) {
01359             <a class="code" href="../../d6/d8/dispatch_8h.html#a11">TranslateOutputToUnicode</a>(Console,
01360                                      Buffer,
01361                                      BufferSize
01362                                     );
01363 <span class="preprocessor">#if defined(FE_SB)</span>
01364 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01365                                        Buffer,
01366                                        &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01367                                       );
01368 <span class="preprocessor">#endif</span>
01369 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
01370                 ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) == 0)) {
01371 <span class="preprocessor">#if defined(FE_SB)</span>
01372 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
01373                 TransBuffer = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),(<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y * <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X) * 2 * <span class="keyword">sizeof</span>(CHAR_INFO));
01374                 <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01375                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01376                     <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01377                 }
01378                 <a class="code" href="../../d6/d8/dispatch_8h.html#a14">FE_TranslateOutputToAnsiUnicode</a>(Console,
01379                                             Buffer,
01380                                             BufferSize,
01381                                             &amp;TransBuffer[0]
01382                                            );
01383                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01384                                             &amp;TransBuffer[0],
01385                                             &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01386                                            );
01387                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
01388             }
01389             <span class="keywordflow">else</span> {
01390                 <a class="code" href="../../d6/d8/dispatch_8h.html#a15">SB_TranslateOutputToAnsiUnicode</a>(Console,
01391                                                 Buffer,
01392                                                 BufferSize
01393                                                );
01394                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01395                                             Buffer,
01396                                             &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01397                                            );
01398             }
01399 <span class="preprocessor">#else</span>
01400 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode</a>(Console,
01401                                         Buffer,
01402                                         BufferSize
01403                                        );
01404 <span class="preprocessor">#endif</span>
01405 <span class="preprocessor"></span>        }
01406 <span class="preprocessor">#if defined(FE_SB)</span>
01407 <span class="preprocessor"></span>        <span class="keywordflow">else</span>
01408 <span class="preprocessor">#endif</span>
01409 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01410                                     Buffer,
01411                                     &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01412                                    );
01413 
01414         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>) {
01415             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Buffer);
01416         }
01417         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01418 
01419             <span class="comment">//</span>
01420             <span class="comment">// cause screen to be updated</span>
01421             <span class="comment">//</span>
01422 
01423 <span class="preprocessor">#if defined(FE_SB)</span>
01424 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
01425                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_JUST_VDM_UNREGISTERED ){
01426                 <span class="keywordtype">int</span> MouseRec;
01427                 MouseRec = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a>;
01428                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a> &amp;= ~ENABLE_MOUSE_INPUT;
01429                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01430                 <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenBufferInformation,&amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a> );
01431                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Flags |= <a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01432                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a> = MouseRec;
01433             }
01434             <span class="keywordflow">else</span>
01435 <span class="preprocessor">#endif</span>
01436 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenBufferInformation,
01437                           &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01438                          );
01439         }
01440     }
01441     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01442     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01443     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01444 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a189" doxytag="consrv.h::SrvWriteConsoleOutputString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsoleOutputString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01508">1508</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00290">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::BufPtr</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00269">CONSOLE_ASCII</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00285">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00291">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::NumRecords</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00286">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00289">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::String</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00288">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::StringType</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00287">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::WriteCoord</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00039">WriteOutputString</a>.
<p>
<pre class="fragment"><div>01512 {
01513     <a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_WRITECONSOLEOUTPUTSTRING_MSG</a> a = (<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_WRITECONSOLEOUTPUTSTRING_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01514     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01515     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01516     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01517     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01518     ULONG nSize;
01519 
01520     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o0">ConsoleHandle</a>,
01521                          &amp;Console
01522                         );
01523     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01524         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01525     }
01526     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01527                                  a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o1">OutputHandle</a>,
01528                                  CONSOLE_OUTPUT_HANDLE,
01529                                  GENERIC_WRITE,
01530                                  &amp;HandleData
01531                                 );
01532     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01533         a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a> = 0;
01534     } <span class="keywordflow">else</span> {
01535         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a>.X &lt; 0 ||
01536             a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a>.Y &lt; 0) {
01537             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01538         } <span class="keywordflow">else</span> {
01539             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a> == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>)
01540                 nSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
01541             <span class="keywordflow">else</span>
01542                 nSize = <span class="keyword">sizeof</span>(WORD);
01543             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>*nSize) &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o4">String</a>)) {
01544                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>;
01545                 <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>, a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>, nSize)) {
01546                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01547                     <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01548                 }
01549             }
01550             <span class="keywordflow">else</span> {
01551                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o4">String</a>;
01552             }
01553             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01554                                      Buffer,
01555                                      a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a>,
01556                                      a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a>,
01557                                      &amp;a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>,
01558                                      NULL
01559                                     );
01560         }
01561     }
01562     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01563     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01564     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01565 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a133" doxytag="consrv.h::StoreKeyInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID StoreKeyInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01587">1587</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00071">CONSOLE_FREE_KEY_INFO</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00072">CONSOLE_MAX_KEY_INFO</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00080">ConsoleKeyInfo</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00075">_CONSOLE_KEY_INFO::hWnd</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00076">_CONSOLE_KEY_INFO::wVirtualKeyCode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00077">_CONSOLE_KEY_INFO::wVirtualScanCode</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01726">DialogHookProc()</a>.
<p>
<pre class="fragment"><div>01590 {
01591     <span class="keywordtype">int</span> i;
01592 
01593     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a3">CONSOLE_MAX_KEY_INFO</a>;i++) {
01594         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> == <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a2">CONSOLE_FREE_KEY_INFO</a> ||
01595             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> == <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>-&gt;hwnd) {
01596             <span class="keywordflow">break</span>;
01597         }
01598     }
01599     <span class="keywordflow">if</span> (i!=<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a3">CONSOLE_MAX_KEY_INFO</a>) {
01600         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o0">hWnd</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>-&gt;hwnd;
01601         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o1">wVirtualKeyCode</a> = LOWORD(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>-&gt;wParam);
01602         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a10">ConsoleKeyInfo</a>[i].<a class="code" href="../../d3/d3/struct__CONSOLE__KEY__INFO.html#o2">wVirtualScanCode</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(HIWORD(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>-&gt;lParam));
01603     } <span class="keywordflow">else</span> {
01604         KdPrint((<span class="stringliteral">"CONSRV: ConsoleKeyInfo buffer is full\n"</span>));
01605     }
01606 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a307" doxytag="consrv.h::StoreSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID StoreSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">452</a> of file <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html">ntcon/server/clipbrd.c</a>.
<p>
References <a class="el" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00306">CloseClipboard</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00094">CONSOLE_VDM_REGISTERED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00199">ConsoleHeapSize</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00169">_SCREEN_INFORMATION::hPalette</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00102">KEY_PRESSED</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00540">OpenClipboard()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01415">ReadRectFromScreenBuffer()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00158">_SCREEN_INFORMATION::ScreenBufferSize</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00718">SelectPalette</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00876">SetClipboardData()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03111">UNICODE_SPACE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00267">WINDOW_SIZE_X</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00268">WINDOW_SIZE_Y</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00807">DoCopy()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>00462 {
00463     PCHAR_INFO Selection,CurCharInfo;
00464     COORD SourcePoint;
00465     COORD TargetSize;
00466     SMALL_RECT TargetRect;
00467     PWCHAR CurChar,CharBuf;
00468     HANDLE ClipboardDataHandle;
00469     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00470     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
00471     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00472     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bFalseUnicode;
00473     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMungeData;
00474 <span class="preprocessor">#if defined(FE_SB)</span>
00475 <span class="preprocessor"></span>    COORD TargetSize2;
00476     PWCHAR TmpClipboardData;
00477     SMALL_RECT SmallRect2;
00478     COORD TargetPoint;
00479     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
00480     WCHAR wchCARRIAGERETURN;
00481     WCHAR wchLINEFEED;
00482     <span class="keywordtype">int</span> iExtra = 0;
00483     <span class="keywordtype">int</span> iFeReserve = 1;
00484 <span class="preprocessor">#endif</span>
00485 <span class="preprocessor"></span>
00486     <span class="comment">//</span>
00487     <span class="comment">// See if there is a selection to get</span>
00488     <span class="comment">//</span>
00489 
00490     <span class="keywordflow">if</span> (!(Console-&gt;SelectionFlags &amp; <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>)) {
00491         <span class="keywordflow">return</span>;
00492     }
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">// read selection rectangle.  clip it first.</span>
00496     <span class="comment">//</span>
00497 
00498     ScreenInfo = Console-&gt;CurrentScreenBuffer;
00499     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Left &lt; 0) {
00500         Console-&gt;SelectionRect.Left = 0;
00501     }
00502     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Top &lt; 0) {
00503         Console-&gt;SelectionRect.Top = 0;
00504     }
00505     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Right &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X) {
00506         Console-&gt;SelectionRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X-1);
00507     }
00508     <span class="keywordflow">if</span> (Console-&gt;SelectionRect.Bottom &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00509         Console-&gt;SelectionRect.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y-1);
00510     }
00511 
00512     TargetSize.X = <a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;Console-&gt;SelectionRect);
00513     TargetSize.Y = <a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;Console-&gt;SelectionRect);
00514     <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00515 <span class="preprocessor">#if defined(FE_SB)</span>
00516 <span class="preprocessor"></span>
00517         <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
00518             iExtra = 4 ;     <span class="comment">// 4 is for DBCS lead or tail extra</span>
00519             iFeReserve = 2 ; <span class="comment">// FE does this for safety</span>
00520             TmpClipboardData = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),(<span class="keyword">sizeof</span>(WCHAR) * TargetSize.Y * (TargetSize.X + iExtra) + <span class="keyword">sizeof</span>(WCHAR)));
00521             <span class="keywordflow">if</span> (TmpClipboardData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00522                 <span class="keywordflow">return</span>;
00523             }
00524         } <span class="keywordflow">else</span> {
00525             TmpClipboardData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00526         }
00527 
00528         Selection = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),<span class="keyword">sizeof</span>(CHAR_INFO) * (TargetSize.X + iExtra) * TargetSize.Y * iFeReserve);
00529         <span class="keywordflow">if</span> (Selection == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00530         {
00531             <span class="keywordflow">if</span> (TmpClipboardData)
00532                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpClipboardData);
00533             <span class="keywordflow">return</span>;
00534         }
00535 <span class="preprocessor">#else</span>
00536 <span class="preprocessor"></span>        Selection = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),<span class="keyword">sizeof</span>(CHAR_INFO) * TargetSize.X * TargetSize.Y);
00537         <span class="keywordflow">if</span> (Selection == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00538             <span class="keywordflow">return</span>;
00539 <span class="preprocessor">#endif</span>
00540 <span class="preprocessor"></span>
00541 <span class="preprocessor">#if defined(FE_SB)</span>
00542 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!CONSOLE_IS_DBCS_CP(Console)) {
00543 <span class="preprocessor">#endif</span>
00544 <span class="preprocessor"></span>
00545 <span class="preprocessor">#ifdef i386</span>
00546 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) &amp;&amp;
00547             (Console-&gt;Flags &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) {
00548             ReadRegionFromScreenHW(ScreenInfo,
00549                                    &amp;Console-&gt;SelectionRect,
00550                                    Selection);
00551             CurCharInfo = Selection;
00552             <span class="keywordflow">for</span> (i=0; i&lt;TargetSize.Y; i++) {
00553                 <span class="keywordflow">for</span> (j=0; j&lt;TargetSize.X; j++,CurCharInfo++) {
00554                     CurCharInfo-&gt;Char.UnicodeChar = SB_CharToWcharGlyph(Console-&gt;OutputCP, CurCharInfo-&gt;Char.AsciiChar);
00555                 }
00556             }
00557         } <span class="keywordflow">else</span> {
00558 <span class="preprocessor">#endif</span>
00559 <span class="preprocessor"></span>            SourcePoint.X = Console-&gt;SelectionRect.Left;
00560             SourcePoint.Y = Console-&gt;SelectionRect.Top;
00561             TargetRect.Left = TargetRect.Top = 0;
00562             TargetRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.X-1);
00563             TargetRect.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.Y-1);
00564             <a class="code" href="../../d6/d2/output_8c.html#a50">ReadRectFromScreenBuffer</a>(ScreenInfo,
00565                                      SourcePoint,
00566                                      Selection,
00567                                      TargetSize,
00568                                      &amp;TargetRect);
00569 <span class="preprocessor">#ifdef i386</span>
00570 <span class="preprocessor"></span>        }
00571 <span class="preprocessor">#endif</span>
00572 <span class="preprocessor"></span>
00573         <span class="comment">// extra 2 per line is for CRLF, extra 1 is for null</span>
00574         ClipboardDataHandle = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE,
00575                 (TargetSize.Y * (TargetSize.X + 2) + 1) * <span class="keyword">sizeof</span>(WCHAR));
00576         <span class="keywordflow">if</span> (ClipboardDataHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00577             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Selection);
00578             <span class="keywordflow">return</span>;
00579         }
00580 <span class="preprocessor">#if defined(FE_SB)</span>
00581 <span class="preprocessor"></span>    }
00582 <span class="preprocessor">#endif</span>
00583 <span class="preprocessor"></span>
00584         <span class="comment">//</span>
00585         <span class="comment">// convert to clipboard form</span>
00586         <span class="comment">//</span>
00587 
00588 <span class="preprocessor">#if defined(FE_SB)</span>
00589 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
00590             <span class="keywordflow">if</span> ((ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00591                     !(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
00592                 <span class="comment">/*</span>
00593 <span class="comment">                 * False Unicode is obtained, so we will have to convert it to</span>
00594 <span class="comment">                 * Real Unicode, in which case we can't put CR or LF in now, since</span>
00595 <span class="comment">                 * they will be converted into 0x266A and 0x25d9.  Temporarily</span>
00596 <span class="comment">                 * mark the CR/LF positions with 0x0000 instead.</span>
00597 <span class="comment">                 */</span>
00598                 wchCARRIAGERETURN = 0x0000;
00599                 wchLINEFEED = 0x0000;
00600             } <span class="keywordflow">else</span> {
00601                 wchCARRIAGERETURN = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
00602                 wchLINEFEED = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
00603             }
00604 
00605             CurChar = TmpClipboardData;
00606             bMungeData = (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) == 0;
00607             <span class="keywordflow">for</span> (i=0;i&lt;TargetSize.Y;i++) {
00608                 PWCHAR pwchLineStart = CurChar;
00609 
00610                 SourcePoint.X = Console-&gt;SelectionRect.Left;
00611                 SourcePoint.Y = Console-&gt;SelectionRect.Top + i;
00612                 TargetSize2.X = TargetSize.X;
00613                 TargetSize2.Y = 1;
00614 
00615                 SmallRect2.Left = SourcePoint.X;
00616                 SmallRect2.Top = SourcePoint.Y;
00617                 SmallRect2.Right = SourcePoint.X + TargetSize2.X - 1;
00618                 SmallRect2.Bottom = SourcePoint.Y;
00619                 TargetPoint = SourcePoint;
00620                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = TargetSize2.X;
00621                 <a class="code" href="../../d0/d3/dbcs_8h.html#a32">BisectClipbrd</a>(StringLength,TargetPoint,ScreenInfo,&amp;SmallRect2);
00622 
00623                 SourcePoint.X = SmallRect2.Left;
00624                 SourcePoint.Y = SmallRect2.Top;
00625                 TargetSize2.X = SmallRect2.Right - SmallRect2.Left + 1;
00626                 TargetSize2.Y = 1;
00627                 TargetRect.Left = TargetRect.Top = TargetRect.Bottom = 0;
00628                 TargetRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize2.X-1);
00629 
00630                 <a class="code" href="../../d6/d2/output_8c.html#a50">ReadRectFromScreenBuffer</a>(ScreenInfo,
00631                                          SourcePoint,
00632                                          Selection,
00633                                          TargetSize2,
00634                                          &amp;TargetRect);
00635 
00636                 CurCharInfo = Selection;
00637                 <span class="keywordflow">for</span> (j=0;j&lt;TargetSize2.X;j++,CurCharInfo++) {
00638                     <span class="keywordflow">if</span> (!(CurCharInfo-&gt;Attributes &amp; COMMON_LVB_TRAILING_BYTE))
00639                         *CurChar++ = CurCharInfo-&gt;Char.UnicodeChar;
00640                 }
00641                 <span class="comment">// trim trailing spaces</span>
00642                 <span class="keywordflow">if</span> (bMungeData) {
00643                     CurChar--;
00644                     <span class="keywordflow">while</span> ((CurChar &gt;= pwchLineStart) &amp;&amp; (*CurChar == <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>))
00645                         CurChar--;
00646                     CurChar++;
00647                     *CurChar++ = wchCARRIAGERETURN;
00648                     *CurChar++ = wchLINEFEED;
00649                 }
00650             }
00651         }
00652         <span class="keywordflow">else</span> {
00653 <span class="preprocessor">#endif</span>
00654 <span class="preprocessor"></span>        CurCharInfo = Selection;
00655         CurChar = CharBuf = GlobalLock(ClipboardDataHandle);
00656         bFalseUnicode = ((ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00657                 !(Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN));
00658         bMungeData = (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_SHIFT) &amp; <a class="code" href="../../d9/d3/input_8h.html#a17">KEY_PRESSED</a>) == 0;
00659         <span class="keywordflow">for</span> (i=0;i&lt;TargetSize.Y;i++) {
00660             PWCHAR pwchLineStart = CurChar;
00661 
00662             <span class="keywordflow">for</span> (j=0;j&lt;TargetSize.X;j++,CurCharInfo++,CurChar++) {
00663                 *CurChar = CurCharInfo-&gt;Char.UnicodeChar;
00664                 <span class="keywordflow">if</span> (*CurChar == 0) {
00665                     *CurChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
00666                 }
00667             }
00668             <span class="comment">// trim trailing spaces</span>
00669             <span class="keywordflow">if</span> (bMungeData) {
00670                 CurChar--;
00671                 <span class="keywordflow">while</span> ((CurChar &gt;= pwchLineStart) &amp;&amp; (*CurChar == <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>))
00672                     CurChar--;
00673                 CurChar++;
00674             }
00675 
00676             <span class="keywordflow">if</span> (bFalseUnicode) {
00677                 <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(pwchLineStart,
00678                         (ULONG)(CurChar - pwchLineStart), Console-&gt;OutputCP);
00679             }
00680             <span class="keywordflow">if</span> (bMungeData) {
00681                 *CurChar++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
00682                 *CurChar++ = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
00683             }
00684         }
00685 <span class="preprocessor">#if defined(FE_SB)</span>
00686 <span class="preprocessor"></span>        }
00687 <span class="preprocessor">#endif</span>
00688 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (bMungeData) {
00689             <span class="keywordflow">if</span> (TargetSize.Y)
00690                 CurChar -= 2;   <span class="comment">// don't put CRLF on last line</span>
00691         }
00692         *CurChar = <span class="charliteral">'\0'</span>;    <span class="comment">// null terminate</span>
00693 
00694 <span class="preprocessor">#if defined(FE_SB)</span>
00695 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console)) {
00696             <span class="comment">// extra 4 is for CRLF and DBCS Reserved, extra 1 is for null</span>
00697             ClipboardDataHandle = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE,
00698                     (<span class="keyword">sizeof</span>(WCHAR) * TargetSize.Y * (TargetSize.X+(4*<span class="keyword">sizeof</span>(WCHAR)))) +
00699                                                         (1*<span class="keyword">sizeof</span>(WCHAR)));
00700             <span class="keywordflow">if</span> (ClipboardDataHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00701                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Selection);
00702                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpClipboardData);
00703                 <span class="keywordflow">return</span>;
00704             }
00705 
00706             CharBuf = GlobalLock(ClipboardDataHandle);
00707             RtlCopyMemory(CharBuf,TmpClipboardData,<a class="code" href="../../d8/d5/consrv_8h.html#a39">ConsoleHeapSize</a>(TmpClipboardData));
00708             CurChar = CharBuf + (CurChar - TmpClipboardData);
00709 
00710             <span class="keywordflow">if</span> (wchCARRIAGERETURN == 0x0000) {
00711                 <span class="comment">/*</span>
00712 <span class="comment">                 * We have False Unicode, so we temporarily represented CRLFs with</span>
00713 <span class="comment">                 * 0x0000s to avoid undesirable conversions (above).</span>
00714 <span class="comment">                 * Convert to Real Unicode and restore real CRLFs.</span>
00715 <span class="comment">                 */</span>
00716                 PWCHAR pwch;
00717                 <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(CharBuf,
00718                                     (ULONG)(CurChar - CharBuf),
00719                                     Console-&gt;OutputCP
00720                                    );
00721                 <span class="keywordflow">for</span> (pwch = CharBuf; pwch &lt; CurChar; pwch++) {
00722                     <span class="keywordflow">if</span> ((*pwch == 0x0000) &amp;&amp; (pwch[1] == 0x0000)) {
00723                         *pwch++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
00724                         *pwch = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
00725                     }
00726                 }
00727             }
00728         }
00729 <span class="preprocessor">#endif</span>
00730 <span class="preprocessor"></span>
00731         GlobalUnlock(ClipboardDataHandle);
00732 <span class="preprocessor">#if defined(FE_SB)</span>
00733 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (TmpClipboardData)
00734             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpClipboardData);
00735 <span class="preprocessor">#endif</span>
00736 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Selection);
00737         Success = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(Console-&gt;hWnd);
00738         <span class="keywordflow">if</span> (!Success) {
00739             GlobalFree(ClipboardDataHandle);
00740             <span class="keywordflow">return</span>;
00741         }
00742 
00743         Success = EmptyClipboard();
00744         <span class="keywordflow">if</span> (!Success) {
00745             GlobalFree(ClipboardDataHandle);
00746             <span class="keywordflow">return</span>;
00747         }
00748 
00749         <a class="code" href="../../d3/d8/client_8c.html#a43">SetClipboardData</a>(CF_UNICODETEXT,ClipboardDataHandle);
00750         <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();   <span class="comment">// Close clipboard</span>
00751     } <span class="keywordflow">else</span> {
00752         HBITMAP hBitmapTarget, hBitmapOld;
00753         HDC hDCMem;
00754         HPALETTE hPaletteOld;
00755         <span class="keywordtype">int</span> Height;
00756 
00757         <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex,
00758                               FALSE, NULL);
00759 
00760         hDCMem = CreateCompatibleDC(Console-&gt;hDC);
00761         hBitmapTarget = CreateCompatibleBitmap(Console-&gt;hDC,
00762                                                   TargetSize.X,
00763                                                   TargetSize.Y);
00764         <span class="keywordflow">if</span> (hBitmapTarget) {
00765             hBitmapOld = SelectObject(hDCMem, hBitmapTarget);
00766             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>) {
00767                 hPaletteOld = <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(hDCMem,
00768                                              ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>,
00769                                              FALSE);
00770             }
00771             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00772 
00773             <span class="comment">// if (DIB is a top-down)</span>
00774             <span class="comment">//      ySrc = abs(height) - rect.bottom - 1;</span>
00775             <span class="comment">// else</span>
00776             <span class="comment">//      ySrc = rect.Bottom.</span>
00777             <span class="comment">//</span>
00778             Height = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo-&gt;bmiHeader.biHeight;
00779 
00780             StretchDIBits(hDCMem, 0, 0,
00781                         TargetSize.X, TargetSize.Y,
00782                         Console-&gt;SelectionRect.Left + ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left,
00783                         (Height &lt; 0) ? -Height - (Console-&gt;SelectionRect.Bottom + ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top) -  1
00784                         : Console-&gt;SelectionRect.Bottom + ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top,
00785                         TargetSize.X, TargetSize.Y,
00786                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.BitMap,
00787                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.lpBitMapInfo,
00788                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.dwUsage,
00789                         SRCCOPY);
00790             <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;SelectionRect);
00791             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o16">hPalette</a>) {
00792                 <a class="code" href="../../d3/d0/user32_8def.html#a83">SelectPalette</a>(hDCMem, hPaletteOld, FALSE);
00793             }
00794             SelectObject(hDCMem, hBitmapOld);
00795             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(Console-&gt;hWnd);
00796             EmptyClipboard();
00797             <a class="code" href="../../d3/d8/client_8c.html#a43">SetClipboardData</a>(CF_BITMAP,hBitmapTarget);
00798             <a class="code" href="../../d3/d0/user32_8def.html#a40">CloseClipboard</a>();
00799         }
00800         DeleteDC(hDCMem);
00801         <a class="code" href="../../d2/d5/mutant_8c.html#a8">NtReleaseMutant</a>(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.GraphicsInfo.hMutex, NULL);
00802     }
00803 
00804 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a163" doxytag="consrv.h::StoreTextBufferFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS StoreTextBufferFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FontFamily</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontWeight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>FaceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00881">881</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00099">_TEXT_BUFFER_FONT_INFO::FaceName</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00101">_TEXT_BUFFER_FONT_INFO::Family</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">FONT_TAG</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00102">_TEXT_BUFFER_FONT_INFO::FontCodePage</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00098">_TEXT_BUFFER_FONT_INFO::FontNumber</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00097">_TEXT_BUFFER_FONT_INFO::FontSize</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00096">_TEXT_BUFFER_FONT_INFO::NextTextBufferFont</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00100">_TEXT_BUFFER_FONT_INFO::Weight</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00893                    :
00894 
00895     This routine store a font information in CurrentTextBufferFont and ListOfTextBufferFont.
00896     If specified code page does not exist in ListOfTextBufferFont, then create <span class="keyword">new</span> list.
00897 
00898 Arguments:
00899 
00900 Return Value:
00901 
00902 --*/
00903 
00904 {
00905     <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> CurrentFont, PrevFont;
00906 
00907     CurrentFont = ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont;
00908 
00909     <span class="keywordflow">while</span> (CurrentFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00910         <span class="keywordflow">if</span> (CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a> == CodePage) {
00911             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o2">FontNumber</a>   = FontIndex;
00912             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o1">FontSize</a>     = FontSize;
00913             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o5">Family</a>       = FontFamily;
00914             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o4">Weight</a>       = FontWeight;
00915             <span class="comment">// CurrentFont-&gt;FontCodePage = CodePage; // Redundant</span>
00916             wcscpy(CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o3">FaceName</a>, FaceName);
00917             <span class="keywordflow">break</span>;
00918         }
00919         PrevFont    = CurrentFont;
00920         CurrentFont = CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
00921     }
00922 
00923     <span class="keywordflow">if</span> (CurrentFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00924         CurrentFont = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( FONT_TAG ), <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">TEXT_BUFFER_FONT_INFO</a>));
00925         <span class="keywordflow">if</span> (CurrentFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00926             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00927         }
00928 
00929         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00930         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o2">FontNumber</a>   = FontIndex;
00931         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o1">FontSize</a>     = FontSize;
00932         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o5">Family</a>       = FontFamily;
00933         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o4">Weight</a>       = FontWeight;
00934         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a> = CodePage;
00935         wcscpy(CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o3">FaceName</a>, FaceName);
00936 
00937         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00938             ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont = CurrentFont;
00939         }
00940         <span class="keywordflow">else</span> {
00941             PrevFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a> = CurrentFont;
00942         }
00943     }
00944 
00945     ScreenInfo-&gt;BufferInfo.TextInfo.CurrentTextBufferFont = *CurrentFont;
00946     ScreenInfo-&gt;BufferInfo.TextInfo.CurrentTextBufferFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00947 
00948     <span class="keywordflow">return</span> STATUS_SUCCESS;
00949 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a124" doxytag="consrv.h::StreamScrollRegion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID StreamScrollRegion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l02998">2998</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00053">_ATTR_PAIR::Attr</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00060">_ATTR_ROW::AttrPair</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00068">_ROW::AttrRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00061">_ATTR_ROW::Attrs</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00065">Rect::bottom</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00067">_ROW::CharRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00038">_CHAR_ROW::Chars</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00085">CONSOLE_IS_ICONIC</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00093">CONSOLE_NO_WINDOW</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00108">ghrgnScroll</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00139">_CONSOLE_INFORMATION::hDC</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00223">INVALID_OLD_LENGTH</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00036">_CHAR_ROW::Left</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00064">Rect::left</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00059">_ATTR_ROW::Length</a>, <a class="el" href="../../d9/d1/tmerge_8c-source.html#l00012">_ATTR_PAIR::Length</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00119">LockScrollBuffer</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00037">_CHAR_ROW::OldLeft</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00035">_CHAR_ROW::OldRight</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00068">Rect</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00034">_CHAR_ROW::Right</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00066">Rect::right</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01176">ScrollDC()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02940">ScrollEntireScreen()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d6/d5/w98_2lh__open_2pi__basic_8h-source.html#l00063">Rect::top</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00120">UnlockScrollBuffer</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02674">UpdateComplexRegion()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00106">UsePolyTextOut</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00267">WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00268">WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00068">WriteRegionToScreen</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/__stream_8h-source.html#l00046">WWSB_AdjustCursorPosition()</a>.
<p>
<pre class="fragment"><div>03004                    :
03005 
03006     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a special-purpose scroll <span class="keywordflow">for</span> use by
03007     <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>.
03008 
03009 Arguments:
03010 
03011     ScreenInfo - pointer to screen buffer info.
03012 
03013 Return Value:
03014 
03015 --*/
03016 
03017 {
03018     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RowIndex;
03019     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
03020     PWCHAR Char;
03021     RECT <a class="code" href="../../d5/d6/structRect.html">Rect</a>;
03022     RECT BoundingBox;
03023     <span class="keywordtype">int</span> ScreenWidth,ScrollHeight,ScreenHeight;
03024     COORD FontSize;
03025     SMALL_RECT UpdateRegion;
03026     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
03027     <span class="keywordtype">int</span> i;
03028 <span class="preprocessor">#if defined(FE_SB)</span>
03029 <span class="preprocessor"></span>    <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> AttrP;
03030 <span class="preprocessor">#endif</span>
03031 <span class="preprocessor"></span>    <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console = ScreenInfo-&gt;Console;
03032 
03033     RowIndex = <a class="code" href="../../d6/d2/output_8c.html#a63">ScrollEntireScreen</a>(ScreenInfo,1,TRUE);
03034 
03035     Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
03036 
03037     <span class="comment">//</span>
03038     <span class="comment">// fill line with blanks</span>
03039     <span class="comment">//</span>
03040 
03041     Char = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>];
03042     <span class="keywordflow">for</span> (i=Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>;i&lt;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o0">Right</a>;i++) {
03043         *Char = (WCHAR)<span class="charliteral">' '</span>;
03044         Char++;
03045     }
03046 <span class="preprocessor">#if defined(FE_SB)</span>
03047 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)){
03048         <span class="keywordtype">int</span> LineWidth = Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o0">Right</a> - Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>;
03049         AttrP = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>];
03050         <span class="keywordflow">if</span> ( LineWidth &gt; 0 )
03051             RtlZeroMemory(AttrP, LineWidth);
03052         AttrP += LineWidth;
03053         Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o1">OldRight</a> = <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>;
03054         Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o3">OldLeft</a> = <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>;
03055         Console-&gt;ConsoleIme.ScrollWaitCountDown = Console-&gt;ConsoleIme.ScrollWaitTimeout;
03056     }
03057 <span class="preprocessor">#endif</span>
03058 <span class="preprocessor"></span>    Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o0">Right</a> = 0;
03059     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a> = ScreenInfo-&gt;ScreenBufferSize.X;
03060 
03061     <span class="comment">//</span>
03062     <span class="comment">// set up attributes</span>
03063     <span class="comment">//</span>
03064 
03065     <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a> != 1) {
03066         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>);
03067         Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a> = &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>;
03068         Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>.<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o0">Length</a> = ScreenInfo-&gt;ScreenBufferSize.X;
03069         Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a> = 1;
03070     }
03071     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o1">AttrPair</a>.<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = ScreenInfo-&gt;Attributes;
03072 
03073     <span class="comment">//</span>
03074     <span class="comment">// update screen</span>
03075     <span class="comment">//</span>
03076 
03077     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo) &amp;&amp;
03078         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> == 0 &amp;&amp;
03079         !(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; (<a class="code" href="../../d1/d7/server_8h.html#a0">CONSOLE_IS_ICONIC</a> | <a class="code" href="../../d1/d7/server_8h.html#a8">CONSOLE_NO_WINDOW</a>))) {
03080 
03081         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
03082         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/output_8c.html#a24">UsePolyTextOut</a>) {
03083             <a class="code" href="../../d6/d8/dispatch_8h.html#a5">WriteRegionToScreen</a>(ScreenInfo, &amp;ScreenInfo-&gt;Window);
03084         } <span class="keywordflow">else</span> {
03085             FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
03086             ScreenWidth = <a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;ScreenInfo-&gt;Window) * FontSize.X;
03087             ScreenHeight = <a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;ScreenInfo-&gt;Window) * FontSize.Y;
03088             ScrollHeight = ScreenHeight - FontSize.Y;
03089 
03090             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> = 0;
03091             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> = ScreenWidth;
03092             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o0">top</a> = FontSize.Y;
03093             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o2">bottom</a> = ScreenHeight;
03094 
03095             <span class="comment">//</span>
03096             <span class="comment">// find smallest bounding rectangle</span>
03097             <span class="comment">//</span>
03098 
03099             <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>) {
03100                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> MinLeft,MaxRight;
03101                 MinLeft = ScreenInfo-&gt;ScreenBufferSize.X;
03102                 MaxRight = 0;
03103                 RowIndex = (ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow+ScreenInfo-&gt;Window.Top) % ScreenInfo-&gt;ScreenBufferSize.Y;
03104                 <span class="keywordflow">for</span> (i=ScreenInfo-&gt;Window.Top+1;i&lt;=ScreenInfo-&gt;Window.Bottom;i++) {
03105                     Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
03106                     <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o3">OldLeft</a> == <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>) {
03107                         MinLeft = 0;
03108                     } <span class="keywordflow">else</span> {
03109                         <span class="keywordflow">if</span> (MinLeft &gt; <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>,Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o3">OldLeft</a>)) {
03110                             MinLeft = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o2">Left</a>,Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o3">OldLeft</a>);
03111                         }
03112                     }
03113                     <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o1">OldRight</a> == <a class="code" href="../../d7/d2/output_8h.html#a5">INVALID_OLD_LENGTH</a>) {
03114                         MaxRight = ScreenInfo-&gt;ScreenBufferSize.X-1;
03115                     } <span class="keywordflow">else</span> {
03116                         <span class="keywordflow">if</span> (MaxRight &lt; <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o0">Right</a>,Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o1">OldRight</a>)) {
03117                             MaxRight = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o0">Right</a>,Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o1">OldRight</a>);
03118                         }
03119                     }
03120                     <span class="keywordflow">if</span> (++RowIndex == ScreenInfo-&gt;ScreenBufferSize.Y) {
03121                         RowIndex = 0;
03122                     }
03123                 }
03124                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o1">left</a> = MinLeft*FontSize.X;
03125                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.<a class="code" href="../../d5/d6/structRect.html#o3">right</a> = (MaxRight+1)*FontSize.X;
03126             }
03127 
03128             <a class="code" href="../../d6/d2/output_8c.html#a6">LockScrollBuffer</a>();
03129             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (ScreenInfo-&gt;BufferInfo.TextInfo.UpdatingScreen&gt;0);
03130             Success = (<span class="keywordtype">int</span>)<a class="code" href="../../d3/d8/client_8c.html#a48">ScrollDC</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>,
03131                                 0,
03132                                 -FontSize.Y,
03133                                 &amp;Rect,
03134                                 NULL,
03135                                 ghrgnScroll,
03136                                 NULL
03137                                );
03138             <span class="keywordflow">if</span> (Success &amp;&amp; ScreenInfo-&gt;Window.Top!=ScreenInfo-&gt;Window.Bottom) {
03139 <span class="preprocessor">#if defined(FE_SB)</span>
03140 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
03141                     ScreenInfo-&gt;Attributes &amp; (COMMON_LVB_GRID_HORIZONTAL +
03142                                                COMMON_LVB_GRID_LVERTICAL +
03143                                                COMMON_LVB_GRID_RVERTICAL +
03144                                                COMMON_LVB_REVERSE_VIDEO  +
03145                                                COMMON_LVB_UNDERSCORE     )){
03146                     UpdateRegion = ScreenInfo-&gt;Window;
03147                     UpdateRegion.Top = UpdateRegion.Bottom;
03148                     ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
03149                     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;UpdateRegion);
03150                 }
03151                 <span class="keywordflow">else</span>{
03152 <span class="preprocessor">#endif</span>
03153 <span class="preprocessor"></span>                <span class="keywordflow">switch</span> (GetRgnBox(ghrgnScroll, &amp;BoundingBox)) {
03154                 <span class="keywordflow">case</span> SIMPLEREGION:
03155                     <span class="keywordflow">if</span> (BoundingBox.left == 0 &amp;&amp;
03156                         BoundingBox.right == ScreenWidth &amp;&amp;
03157                         BoundingBox.top == ScrollHeight &amp;&amp;
03158                         BoundingBox.bottom == ScreenHeight) {
03159 
03160                         PatBlt(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>,0,ScrollHeight,ScreenWidth,FontSize.Y,PATCOPY);
03161                         GdiFlush();
03162                     } <span class="keywordflow">else</span> {
03163                         UpdateRegion.Left = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((BoundingBox.left/FontSize.X)+ScreenInfo-&gt;Window.Left);
03164                         UpdateRegion.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(((BoundingBox.right-1)/FontSize.X)+ScreenInfo-&gt;Window.Left);
03165                         UpdateRegion.Top = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((BoundingBox.top/FontSize.Y)+ScreenInfo-&gt;Window.Top);
03166                         UpdateRegion.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(((BoundingBox.bottom-1)/FontSize.Y)+ScreenInfo-&gt;Window.Top);
03167                         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;UpdateRegion);
03168                     }
03169                     <span class="keywordflow">break</span>;
03170                 <span class="keywordflow">case</span> COMPLEXREGION:
03171                     <a class="code" href="../../d6/d2/output_8c.html#a60">UpdateComplexRegion</a>(ScreenInfo,FontSize);
03172                     <span class="keywordflow">break</span>;
03173                 }
03174 <span class="preprocessor">#if defined(FE_SB)</span>
03175 <span class="preprocessor"></span>                }
03176 <span class="preprocessor">#endif</span>
03177 <span class="preprocessor"></span>            } <span class="keywordflow">else</span>  {
03178                 <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;Window);
03179             }
03180             <a class="code" href="../../d6/d2/output_8c.html#a7">UnlockScrollBuffer</a>();
03181         }
03182         <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
03183     }
03184 <span class="preprocessor">#ifdef i386</span>
03185 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
03186         SMALL_RECT ScrollRect;
03187         COORD TargetPoint;
03188 
03189         ScrollRect = ScreenInfo-&gt;Window;
03190         TargetPoint.Y = ScrollRect.Top;
03191         ScrollRect.Top += 1;
03192         TargetPoint.X = 0;
03193 <span class="preprocessor">#if defined(FE_SB)</span>
03194 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) ) {
03195             <span class="keywordflow">if</span> (! ScreenInfo-&gt;ConvScreenInfo)  {
03196                 <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;CurrentScreenBuffer == ScreenInfo) {
03197                     ScrollHW(ScreenInfo,
03198                              &amp;ScrollRect,
03199                              NULL,
03200                              TargetPoint
03201                             );
03202                 }
03203             }
03204             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
03205                 ScrollHW(ScreenInfo,
03206                          &amp;ScrollRect,
03207                          NULL,
03208                          TargetPoint
03209                         );
03210             }
03211         }
03212         <span class="keywordflow">else</span>
03213 <span class="preprocessor">#endif</span>
03214 <span class="preprocessor"></span>        ScrollHW(ScreenInfo,
03215                  &amp;ScrollRect,
03216                  NULL,
03217                  TargetPoint
03218                 );
03219         ScrollRect.Top = ScrollRect.Bottom - 1;
03220         WriteRegionToScreenHW(ScreenInfo,&amp;ScrollRect);
03221     }
03222 <span class="preprocessor">#endif</span>
03223 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a270" doxytag="consrv.h::TranslateConsoleTitle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LPWSTR TranslateConsoleTitle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleTitle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbTranslatedLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Unexpand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>Substitute</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">1831</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00369">MyStringCompareW()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01827">SYSTEM_ROOT</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01828">SYSTEM_ROOT_LENGTH</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00066">TITLE_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>.
<p>
<pre class="fragment"><div>01839                    :
01840 
01841     This routine translates <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> characters into <span class="charliteral">'_'</span> characters because
01842     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NT registry apis <span class="keywordflow">do</span> not allow <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of keys with
01843     names that contain <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> characters. It also converts absolute paths
01844     into %SystemRoot% relative ones. As an example, <span class="keywordflow">if</span> both behaviors were
01845     specified <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> would convert a title like C:\WINNT\System32\cmd.exe to
01846     %SystemRoot%_System32_cmd.exe.
01847 
01848 Arguments:
01849 
01850     ConsoleTitle - Pointer to string to translate.
01851 
01852     pcbTranslatedTitle - On <span class="keywordflow">return</span>, contains size of translated title.
01853 
01854     Unexpand - Convert absolute <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> to %SystemRoot% relative one.
01855 
01856     Substitute - Replace <span class="charliteral">'\'</span> with <span class="charliteral">'_'</span> in <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>.
01857 
01858 Return Value:
01859 
01860     Pointer to translated title or <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
01861 
01862 Note:
01863 
01864     This routine allocates a buffer that must be freed.
01865 
01866 --*/
01867 {
01868     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> cbConsoleTitle,i;
01869     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> cbSystemRoot;
01870     LPWSTR TranslatedConsoleTitle,Tmp;
01871 
01872     cbConsoleTitle = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((lstrlenW(ConsoleTitle) + 1) * <span class="keyword">sizeof</span>(WCHAR));
01873     cbSystemRoot = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(lstrlenW(USER_SHARED_DATA-&gt;NtSystemRoot) * <span class="keyword">sizeof</span>(WCHAR));
01874 
01875     <span class="keywordflow">if</span> (Unexpand &amp;&amp; !<a class="code" href="../../d8/d5/consrv_8h.html#a262">MyStringCompareW</a>(ConsoleTitle,
01876                                       USER_SHARED_DATA-&gt;NtSystemRoot,
01877                                       cbSystemRoot,
01878                                       TRUE)) {
01879         cbConsoleTitle -= cbSystemRoot;
01880         (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)ConsoleTitle += cbSystemRoot;
01881         cbSystemRoot = <a class="code" href="../../d0/d5/srvinit_8c.html#a1">SYSTEM_ROOT_LENGTH</a>;
01882     } <span class="keywordflow">else</span> {
01883         cbSystemRoot = 0;
01884     }
01885 
01886     Tmp = TranslatedConsoleTitle = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TITLE_TAG ),cbSystemRoot + cbConsoleTitle);
01887     <span class="keywordflow">if</span> (TranslatedConsoleTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01888         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01889     }
01890 
01891     RtlCopyMemory(TranslatedConsoleTitle, SYSTEM_ROOT, cbSystemRoot);
01892     (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)TranslatedConsoleTitle += cbSystemRoot;
01893 
01894     <span class="keywordflow">for</span> (i=0;i&lt;cbConsoleTitle;i+=<span class="keyword">sizeof</span>(WCHAR)) {
01895         <span class="keywordflow">if</span> (Substitute &amp;&amp; *ConsoleTitle == <span class="charliteral">'\\'</span>) {
01896             *TranslatedConsoleTitle++ = (WCHAR)<span class="charliteral">'_'</span>;
01897         } <span class="keywordflow">else</span> {
01898             *TranslatedConsoleTitle++ = *ConsoleTitle;
01899         }
01900         ConsoleTitle++;
01901     }
01902 
01903     <span class="keywordflow">if</span> (pcbTranslatedTitle) {
01904         *pcbTranslatedTitle = cbSystemRoot + cbConsoleTitle;
01905     }
01906 
01907     <span class="keywordflow">return</span> Tmp;
01908 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a192" doxytag="consrv.h::TranslateOutputToPaddingUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS TranslateOutputToPaddingUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBufferR</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01191">1191</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
<pre class="fragment"><div>01197 {
01198     <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/directio_8c.html#a9">FE_TranslateOutputToAnsiUnicodeInternal</a>(Console,
01199                                                    OutputBuffer,
01200                                                    Size,
01201                                                    OutputBufferR,
01202                                                    FALSE
01203                                                    );
01204 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a228" doxytag="consrv.h::UnblockWriteConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnblockWriteConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Reason</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02442">2442</a> of file <a class="el" href="../../d1/d6/server_2stream_8c-source.html">server/stream.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00106">CONSOLE_SCROLLBAR_TRACKING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00118">CONSOLE_SUSPENDED</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01340">PreprocessInput()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04575">VerticalScroll()</a>.
<p>
<pre class="fragment"><div>02445 {
02446     Console-&gt;Flags &amp;= ~Reason;
02447 
02448     <span class="keywordflow">if</span> ((Console-&gt;Flags &amp; (<a class="code" href="../../d1/d7/server_8h.html#a25">CONSOLE_SUSPENDED</a> | <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a> | <a class="code" href="../../d1/d7/server_8h.html#a21">CONSOLE_SCROLLBAR_TRACKING</a>)) == 0) {
02449         <span class="comment">/*</span>
02450 <span class="comment">         * no remain reason to suspend output, so unblock it.</span>
02451 <span class="comment">         */</span>
02452         <span class="keywordflow">if</span> (CsrNotifyWait(&amp;Console-&gt;OutputQueue, TRUE, NULL, NULL)) {
02453             <span class="comment">// #334370 under stress, WaitQueue may already hold the satisfied waits</span>
02454             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> ((Console-&gt;WaitQueue == NULL) ||
02455                     (Console-&gt;WaitQueue == &amp;Console-&gt;OutputQueue));
02456             Console-&gt;WaitQueue = &amp;Console-&gt;OutputQueue;
02457         }
02458     }
02459 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a153" doxytag="consrv.h::UnlockConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnlockConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">4103</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00383">CONSOLE_CLIENTPROCESSID</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00280">CONSOLE_CTRL_LOGOFF_FLAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00281">CONSOLE_CTRL_SHUTDOWN_FLAG</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00279">CONSOLE_FORCE_SHUTDOWN_FLAG</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00871">CONSOLE_SHUTDOWN_SUCCEEDED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00872">CONSOLE_SHUTDOWN_SYSTEM</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00100">CONSOLE_SHUTTING_DOWN</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00040">ConsoleVDMCriticalSection</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00041">ConsoleVDMOnSwitching</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00223">_CONSOLE_INFORMATION::CtrlFlags</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00224">_CONSOLE_INFORMATION::LimitingProcessId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00061">NtQueryVirtualMemory()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03865">ProcessCtrlEvents()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00563">RtlRaiseStatus()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00078">SHUTDOWN_CANCEL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00076">SHUTDOWN_KNOWN_PROCESS</a>, <a class="el" href="../../d8/d5/consrv_8h.html#a154">ShutdownConsole()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d8/w32_2ntuser_2server_2harderr_8c.html#a12">UserExitWorkerThread()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00370">ValidateConsole()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00196">_CONSOLE_INFORMATION::VDMProcessId</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d7/d5/ttime_8c-source.html#l00031">Zero</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00705">ConsoleAddProcessRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01912">ConsoleClientShutdown()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00821">ConsoleSetActiveWindow()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01110">FreeCon()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03139">GetThreadConsoleDesktop()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01657">ProcessCreateConsoleWindow()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02997">SrvCloseHandle()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00373">SrvConsoleMenuControl()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01346">SrvConsoleNotifyLastClose()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02603">SrvDuplicateHandle()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01393">SrvExpungeConsoleCommandHistory()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01568">SrvFillConsoleOutput()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00524">SrvFlushConsoleInputBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00444">SrvGenerateConsoleCtrlEvent()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">SrvGetConsoleAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00834">SrvGetConsoleAliasesLength()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">SrvGetConsoleAliasExes()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00994">SrvGetConsoleAliasExesLength()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">SrvGetConsoleCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01458">SrvGetConsoleCommandHistoryLength()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01359">SrvGetConsoleCP()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00315">SrvGetConsoleCurrentFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00179">SrvGetConsoleCursorInfo()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02355">SrvGetConsoleDisplayMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00233">SrvGetConsoleFontInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00278">SrvGetConsoleFontSize()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02232">SrvGetConsoleHardwareState()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">SrvGetConsoleInput()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01385">SrvGetConsoleKeyboardLayoutName()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02680">SrvGetConsoleLangId()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00033">SrvGetConsoleMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00211">SrvGetConsoleMouseInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00082">SrvGetConsoleNumberOfFonts()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00108">SrvGetConsoleNumberOfInputEvents()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00141">SrvGetConsoleScreenBufferInfo()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04879">SrvGetConsoleTitle()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01424">SrvGetConsoleWindow()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02747">SrvGetHandleInformation()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00555">SrvGetLargestConsoleWindowSize()</a>, <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00168">SrvInvalidateBitMapRect()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00080">SrvOpenConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02263">SrvReadConsole()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">SrvReadConsoleOutput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01448">SrvReadConsoleOutputString()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01094">SrvRegisterConsoleVDM()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00492">SrvSetConsoleActiveScreenBuffer()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01575">SrvSetConsoleCommandHistoryMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01229">SrvSetConsoleCP()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00213">SrvSetConsoleCursor()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00738">SrvSetConsoleCursorInfo()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00662">SrvSetConsoleCursorPosition()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00853">SrvSetConsoleDisplayMode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01118">SrvSetConsoleFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02280">SrvSetConsoleHardwareState()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01164">SrvSetConsoleIcon()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02423">SrvSetConsoleKeyShortcuts()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l02376">SrvSetConsoleMenuClose()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00354">SrvSetConsoleMode()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01424">SrvSetConsoleNumberOfCommands()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00432">SrvSetConsolePalette()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00608">SrvSetConsoleScreenBufferSize()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01078">SrvSetConsoleTextAttribute()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00773">SrvSetConsoleWindowInfo()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02794">SrvSetHandleInformation()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00298">SrvShowConsoleCursor()</a>, <a class="el" href="../../d3/d4/srvvdm_8c-source.html#l00024">SrvVDMConsoleOperation()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01582">SrvVerifyConsoleIoHandle()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02463">SrvWriteConsole()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00730">SrvWriteConsoleInput()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01508">SrvWriteConsoleOutputString()</a>.
<p>
<pre class="fragment"><div>04106 {
04107     LIST_ENTRY WaitQueue;
04108 
04109     <span class="comment">//</span>
04110     <span class="comment">// Make sure the console pointer is still valid</span>
04111     <span class="comment">//</span>
04112     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a15">ValidateConsole</a>(Console)));
04113 
04114 <span class="preprocessor">#ifdef i386</span>
04115 <span class="preprocessor"></span>    <span class="comment">//</span>
04116     <span class="comment">// do nothing if we are in screen switching(handshaking with ntvdm)</span>
04117     <span class="comment">// we don't check anything else because we are in a safe state here.</span>
04118     <span class="comment">//</span>
04119     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a14">ConsoleVDMOnSwitching</a> == Console &amp;&amp;
04120         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a14">ConsoleVDMOnSwitching</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o52">VDMProcessId</a> == <a class="code" href="../../d1/d7/server_8h.html#a80">CONSOLE_CLIENTPROCESSID</a>()) {
04121         KdPrint((<span class="stringliteral">"    UnlockConsole - Thread %lx is leaving VDM CritSec\n"</span>, GetCurrentThreadId()));
04122         RtlLeaveCriticalSection(&amp;ConsoleVDMCriticalSection);
04123         <span class="keywordflow">return</span>;
04124     }
04125 <span class="preprocessor">#endif</span>
04126 <span class="preprocessor"></span>
04127     <span class="comment">//</span>
04128     <span class="comment">// if we're about to release the console lock, see if there</span>
04129     <span class="comment">// are any satisfied wait blocks that need to be dereferenced.</span>
04130     <span class="comment">// this code avoids a deadlock between grabbing the console</span>
04131     <span class="comment">// lock and then grabbing the process structure lock.</span>
04132     <span class="comment">//</span>
04133 <span class="preprocessor">#if defined(_X86_)</span>
04134 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Console-&gt;ConsoleLock.RecursionCount == 1) {
04135 <span class="preprocessor">#endif</span>
04136 <span class="preprocessor"></span><span class="preprocessor">#if defined(_MIPS_) || defined(_ALPHA_) || defined(_PPC_) || defined(_IA64_)</span>
04137 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Console-&gt;ConsoleLock.RecursionCount == 0) {
04138 <span class="preprocessor">#endif</span>
04139 <span class="preprocessor"></span>        InitializeListHead(&amp;WaitQueue);
04140         <span class="keywordflow">if</span> (Console-&gt;WaitQueue) {
04141             CsrMoveSatisfiedWait(&amp;WaitQueue, Console-&gt;WaitQueue);
04142             Console-&gt;WaitQueue = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04143         }
04144         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a53">ProcessCtrlEvents</a>(Console);
04145 
04146         <span class="comment">/*</span>
04147 <span class="comment">         * Can't call CsrDereferenceWait with the console locked or we could deadlock.</span>
04148 <span class="comment">         */</span>
04149         <span class="keywordflow">if</span> (!IsListEmpty(&amp;WaitQueue)) {
04150             CsrDereferenceWait(&amp;WaitQueue);
04151         }
04152     } <span class="keywordflow">else</span> {
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="consrv.h::UnProtectHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN UnProtectHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01474">RtlDeleteCriticalSection()</a>, and <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01266">RtlInitializeCriticalSectionAndSpinCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a128" doxytag="consrv.h::UnqueueThreadMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UnqueueThreadMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwThreadId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM *&nbsp;</td>
          <td class="mdname" nowrap> <em>pwParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM *&nbsp;</td>
          <td class="mdname" nowrap> <em>plParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01906">1906</a> of file <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html">ntcon/server/input.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d7/server_8h.html#a108">CONSOLE_THREAD_MSG</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00080">_CONSOLE_THREAD_MSG::dwThreadId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01825">gInputThreadMsg</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00062">gInputThreadMsgLock</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01837">CleanupInputThreadMessages()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01726">DialogHookProc()</a>.
<p>
<pre class="fragment"><div>01911 {
01912     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fResult = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;       <span class="comment">// if message is found, set this to TRUE</span>
01913     PLIST_ENTRY pEntry;
01914 
01915     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(dwThreadId);
01916 
01917     RtlEnterCriticalSection(&amp;gInputThreadMsgLock);
01918 
01919     <span class="comment">//</span>
01920     <span class="comment">// Search for dwThreadId message from the tail of the queue.</span>
01921     <span class="comment">//</span>
01922     pEntry = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a11">gInputThreadMsg</a>.Blink;
01923 
01924     <span class="keywordflow">while</span> (pEntry != &amp;<a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a11">gInputThreadMsg</a>) {
01925         <a class="code" href="../../d1/d7/struct__CONSOLE__THREAD__MSG.html">PCONSOLE_THREAD_MSG</a> pConMsg = CONTAINING_RECORD(pEntry, <a class="code" href="../../d1/d7/struct__CONSOLE__THREAD__MSG.html">CONSOLE_THREAD_MSG</a>, ListLink);
01926 
01927         <span class="keywordflow">if</span> (pConMsg-&gt;<a class="code" href="../../d1/d7/struct__CONSOLE__THREAD__MSG.html#o1">dwThreadId</a> == dwThreadId) {
01928             *pMessage = pConMsg-&gt;Message;
01929             *pwParam = pConMsg-&gt;wParam;
01930             *plParam = pConMsg-&gt;lParam;
01931 
01932             RemoveEntryList(pEntry);
01933             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pConMsg);
01934             fResult = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01935             <span class="keywordflow">break</span>;
01936         }
01937         pEntry = pEntry-&gt;Blink;
01938     }
01939 
01940     RtlLeaveCriticalSection(&amp;gInputThreadMsgLock);
01941 
01942     <span class="keywordflow">return</span> fResult;
01943 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a284" doxytag="consrv.h::UnsetActivePalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnsetActivePalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00573">573</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00720">RealizePalette</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d8/d3/server_2private_8c-source.html#l01567">DisplayModeTransition()</a>.
<p>
<pre class="fragment"><div>00576 {
00577     USERTHREAD_USEDESKTOPINFO utudi;
00578     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00579 
00580     <span class="keywordflow">if</span> (GetCurrentThreadId() != ScreenInfo-&gt;Console-&gt;InputThreadInfo-&gt;ThreadId) {
00581         bReset = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00582         utudi.hThread = ScreenInfo-&gt;Console-&gt;InputThreadInfo-&gt;ThreadHandle;
00583         utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00584         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00585                 UserThreadUseDesktop,
00586                 &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00587     }
00588 
00589     SetSystemPaletteUse(ScreenInfo-&gt;Console-&gt;hDC,
00590                         SYSPAL_STATIC
00591                        );
00592     <a class="code" href="../../d3/d0/user32_8def.html#a84">RealizePalette</a>(ScreenInfo-&gt;Console-&gt;hDC);
00593 
00594 
00595     <span class="keywordflow">if</span> (bReset == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00596         utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00597         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00598                 UserThreadUseDesktop, &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00599     }
00600 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a277" doxytag="consrv.h::UpdateMousePosition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UpdateMousePosition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Position</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="consrv.h::ValidateConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ValidateConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00370">370</a> of file <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html">w32/ntcon/server/handle.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00029">ConsoleHandles</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00030">NumberOfConsoleHandles</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00376                    :
00377 
00378     This routine ensures that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given console pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid.
00379 
00380 Arguments:
00381 
00382     Console - Console pointer to validate.
00383 
00384 --*/
00385 
00386 {
00387     ULONG i;
00388 
00389     <span class="keywordflow">if</span> (Console != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00390         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a5">NumberOfConsoleHandles</a>; i++) {
00391             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a4">ConsoleHandles</a>[i] == Console)
00392                 <span class="keywordflow">return</span> STATUS_SUCCESS;
00393         }
00394     }
00395     <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00396 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a122" doxytag="consrv.h::VerticalScroll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VerticalScroll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ScrollCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>AbsoluteChange</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/output_8c-source.html#l04575">4575</a> of file <a class="el" href="../../d7/d1/output_8c-source.html">output.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00106">CONSOLE_SCROLLBAR_TRACKING</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02442">UnblockWriteConsole()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>.
<p>
<pre class="fragment"><div>04581 {
04582     COORD NewOrigin;
04583 
04584     NewOrigin.X = ScreenInfo-&gt;Window.Left;
04585     NewOrigin.Y = ScreenInfo-&gt;Window.Top;
04586     <span class="keywordflow">switch</span> (ScrollCommand) {
04587         <span class="keywordflow">case</span> SB_LINEUP:
04588             NewOrigin.Y--;
04589             <span class="keywordflow">break</span>;
04590         <span class="keywordflow">case</span> SB_LINEDOWN:
04591             NewOrigin.Y++;
04592             <span class="keywordflow">break</span>;
04593         <span class="keywordflow">case</span> SB_PAGEUP:
04594 <span class="preprocessor">#if defined(FE_IME)</span>
04595 <span class="preprocessor"></span><span class="comment">// MSKK July.22.1993 KazuM</span>
04596 <span class="comment">// Plan of bottom line reservation for console IME.</span>
04597             <span class="keywordflow">if</span> ( ScreenInfo-&gt;Console-&gt;InputBuffer.ImeMode.Open )
04598             {
04599                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ScreenInfo-&gt;Flags &amp; CONSOLE_TEXTMODE_BUFFER);
04600                 <span class="keywordflow">if</span> (!(ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)) {
04601                     <span class="keywordflow">return</span>;
04602                 }
04603                 NewOrigin.Y-=<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-2;
04604                 ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
04605                 ScreenInfo-&gt;BufferInfo.TextInfo.Flags |= CONSOLE_CONVERSION_AREA_REDRAW;
04606             }
04607             <span class="keywordflow">else</span>
04608 <span class="preprocessor">#endif // FE_IME</span>
04609 <span class="preprocessor"></span>            NewOrigin.Y-=<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-1;
04610             <span class="keywordflow">break</span>;
04611         <span class="keywordflow">case</span> SB_PAGEDOWN:
04612 <span class="preprocessor">#if defined(FE_IME)</span>
04613 <span class="preprocessor"></span><span class="comment">// MSKK July.22.1993 KazuM</span>
04614 <span class="comment">// Plan of bottom line reservation for console IME.</span>
04615             <span class="keywordflow">if</span> ( ScreenInfo-&gt;Console-&gt;InputBuffer.ImeMode.Open )
04616             {
04617                 NewOrigin.Y+=<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-2;
04618                 ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
04619                 ScreenInfo-&gt;BufferInfo.TextInfo.Flags |= CONSOLE_CONVERSION_AREA_REDRAW;
04620             }
04621             <span class="keywordflow">else</span>
04622 <span class="preprocessor">#endif // FE_IME</span>
04623 <span class="preprocessor"></span>            NewOrigin.Y+=<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)-1;
04624             <span class="keywordflow">break</span>;
04625         <span class="keywordflow">case</span> SB_THUMBTRACK:
04626             Console-&gt;Flags |= <a class="code" href="../../d1/d7/server_8h.html#a21">CONSOLE_SCROLLBAR_TRACKING</a>;
04627             NewOrigin.Y= AbsoluteChange;
04628             <span class="keywordflow">break</span>;
04629         <span class="keywordflow">case</span> SB_THUMBPOSITION:
04630             <a class="code" href="../../d0/d7/server_2stream_8c.html#a30">UnblockWriteConsole</a>(Console, CONSOLE_SCROLLBAR_TRACKING);
04631             NewOrigin.Y= AbsoluteChange;
04632             <span class="keywordflow">break</span>;
04633         <span class="keywordflow">case</span> SB_TOP:
04634             NewOrigin.Y=0;
04635             <span class="keywordflow">break</span>;
04636         <span class="keywordflow">case</span> SB_BOTTOM:
04637             NewOrigin.Y=(WORD)(ScreenInfo-&gt;ScreenBufferSize.Y-<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo));
04638             <span class="keywordflow">break</span>;
04639 
04640         <span class="keywordflow">default</span>:
04641             <span class="keywordflow">return</span>;
04642     }
04643 
04644     NewOrigin.Y = (WORD)(<a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0,<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((SHORT)NewOrigin.Y,
04645                             (SHORT)ScreenInfo-&gt;ScreenBufferSize.Y-(SHORT)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo))));
04646     <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
04647                     (BOOLEAN)TRUE,
04648                     NewOrigin
04649                    );
04650 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a175" doxytag="consrv.h::WcharToChar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char WcharToChar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Wchar</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01489">1489</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, and <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/__priv_8h-source.html#l00041">FE_WriteRegionToScreenHW()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00801">SB_TranslateOutputToOem()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l00045">TranslateInputToOem()</a>.
<p>
<pre class="fragment"><div>01492 {
01493     <span class="keywordtype">char</span> ch;
01494     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01495         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(&amp;ch, <span class="keyword">sizeof</span>(ch), NULL, &amp;Wchar, <span class="keyword">sizeof</span>(Wchar));
01496     } <span class="keywordflow">else</span> {
01497         WideCharToMultiByte(Codepage, 0, &amp;Wchar, 1, &amp;ch, 1, NULL, NULL);
01498     }
01499 <span class="preprocessor">#ifdef DEBUG_PRINT</span>
01500 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Wchar &gt; 0x007F) {
01501         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"WcharToChar %d 0x%04x -&gt; 0x%02x\n"</span>,Codepage,Wchar,(UCHAR)ch));
01502     }
01503 <span class="preprocessor">#endif</span>
01504 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ch;
01505 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a137" doxytag="consrv.h::WriteInputBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> WriteInputBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d2/struct__INPUT__INFORMATION.html">PINPUT_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InputBufferInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PINPUT_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a274" doxytag="consrv.h::WriteRegionToScreenBitMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS WriteRegionToScreenBitMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>Region</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html#l00293">293</a> of file <a class="el" href="../../d6/d0/w32_2ntcon_2server_2bitmap_8c-source.html">w32/ntcon/server/bitmap.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00155">InvertSelection()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00918">WWSB_WriteToScreen()</a>.
<p>
<pre class="fragment"><div>00297 {
00298     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumScanLines;
00299     <span class="keywordtype">int</span>   Height;
00300     <span class="comment">//</span>
00301     <span class="comment">// if we have a selection, turn it off.</span>
00302     <span class="comment">//</span>
00303 
00304     <a class="code" href="../../d8/d5/consrv_8h.html#a308">InvertSelection</a>(ScreenInfo-&gt;Console,TRUE);
00305 
00306     <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.hMutex,
00307                           FALSE, NULL);
00308 
00309     <span class="comment">// The origin of (xSrc, ySrc) passed to SetDIBitsToDevice is located</span>
00310     <span class="comment">// at the DIB's bottom-left corner no matter if the DIB is</span>
00311     <span class="comment">// a top-down or bottom-up. Thus, if the DIB is a top-down, we have</span>
00312     <span class="comment">// to translate ySrc accordingly:</span>
00313     <span class="comment">// if (height &lt; 0) {        // top-down</span>
00314     <span class="comment">//      ySrc = abs(height) - rect.Bottom -1;</span>
00315     <span class="comment">//</span>
00316     <span class="comment">// else</span>
00317     <span class="comment">//      ySrc = rect.Bottom;</span>
00318     <span class="comment">//</span>
00319     Height = ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo-&gt;bmiHeader.biHeight;
00320 
00321     NumScanLines = SetDIBitsToDevice(ScreenInfo-&gt;Console-&gt;hDC,
00322                       Region-&gt;Left - ScreenInfo-&gt;Window.Left,
00323                       Region-&gt;Top - ScreenInfo-&gt;Window.Top,
00324                       Region-&gt;Right - Region-&gt;Left + 1,
00325                       Region-&gt;Bottom - Region-&gt;Top + 1,
00326                       Region-&gt;Left,
00327               Height &lt; 0 ? -Height - Region-&gt;Bottom - 1 : Region-&gt;Bottom,
00328                       0,
00329                       ScreenInfo-&gt;ScreenBufferSize.Y,
00330                       ScreenInfo-&gt;BufferInfo.GraphicsInfo.BitMap,
00331                       ScreenInfo-&gt;BufferInfo.GraphicsInfo.lpBitMapInfo,
00332                       ScreenInfo-&gt;BufferInfo.GraphicsInfo.dwUsage
00333                      );
00334 
00335     <a class="code" href="../../d2/d5/mutant_8c.html#a8">NtReleaseMutant</a>(ScreenInfo-&gt;BufferInfo.GraphicsInfo.hMutex, NULL);
00336 
00337     <span class="comment">//</span>
00338     <span class="comment">// if we have a selection, turn it on.</span>
00339     <span class="comment">//</span>
00340 
00341     <a class="code" href="../../d8/d5/consrv_8h.html#a308">InvertSelection</a>(ScreenInfo-&gt;Console,FALSE);
00342 
00343     <span class="keywordflow">if</span> (NumScanLines == 0) {
00344         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00345     }
00346     <span class="keywordflow">return</span> STATUS_SUCCESS;
00347 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a103" doxytag="consrv.h::WriteScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS WriteScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PSMALL_RECT&nbsp;</td>
          <td class="mdname" nowrap> <em>WriteRegion</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a60" doxytag="consrv.h::dwConBaseTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d0/d5/srvinit_8c.html#a18">dwConBaseTag</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00165">165</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00737">ConServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="consrv.h::pConHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWIN32HEAP <a class="el" href="../../d0/d5/srvinit_8c.html#a17">pConHeap</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/consrv_8h-source.html#l00164">164</a> of file <a class="el" href="../../d9/d4/consrv_8h-source.html">consrv.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00737">ConServerDllInitialization()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:16 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
