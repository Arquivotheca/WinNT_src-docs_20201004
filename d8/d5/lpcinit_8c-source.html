<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lpcinit.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lpcinit.c</h1><a href="../../d7/d6/lpcinit_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    lpcinit.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Initialization module for the LPC subcomponent of NTOS</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Steve Wood (stevewo) 15-May-1989</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d0/d7/lpcp_8h.html">lpcp.h</a>"</span>
00022 
00023 <span class="comment">//</span>
00024 <span class="comment">//  The following two object types are defined system wide to handle lpc ports</span>
00025 <span class="comment">//</span>
00026 
<a name="l00027"></a><a class="code" href="../../d7/d6/lpcinit_8c.html#a0">00027</a> <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> <a class="code" href="../../d9/d8/ntos_8h.html#a5">LpcPortObjectType</a>;
<a name="l00028"></a><a class="code" href="../../d7/d6/lpcinit_8c.html#a1">00028</a> <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> <a class="code" href="../../d9/d8/ntos_8h.html#a6">LpcWaitablePortObjectType</a>;
00029 
00030 <span class="comment">//</span>
00031 <span class="comment">//  This is the default access mask mapping for lpc port objects</span>
00032 <span class="comment">//</span>
00033 
<a name="l00034"></a><a class="code" href="../../d7/d6/lpcinit_8c.html#a2">00034</a> GENERIC_MAPPING <a class="code" href="../../d7/d6/lpcinit_8c.html#a2">LpcpPortMapping</a> = {
00035     READ_CONTROL | PORT_CONNECT,
00036     DELETE | PORT_CONNECT,
00037     0,
00038     PORT_ALL_ACCESS
00039 };
00040 
00041 <span class="comment">//</span>
00042 <span class="comment">//  This lock is used to protect practically everything in lpc</span>
00043 <span class="comment">//</span>
00044 
<a name="l00045"></a><a class="code" href="../../d7/d6/lpcinit_8c.html#a3">00045</a> <a class="code" href="../../d3/d4/struct__LPC__MUTEX.html">LPC_MUTEX</a> <a class="code" href="../../d7/d6/lpcinit_8c.html#a3">LpcpLock</a>;
00046 
00047 <span class="comment">//</span>
00048 <span class="comment">//  The following array of strings is used to debugger purposes and the</span>
00049 <span class="comment">//  values correspond to the Port message types defined in ntlpcapi.h</span>
00050 <span class="comment">//</span>
00051 
00052 <span class="preprocessor">#if ENABLE_LPC_TRACING</span>
00053 <span class="preprocessor"></span>
00054 <span class="keywordtype">char</span> *LpcpMessageTypeName[] = {
00055     <span class="stringliteral">"UNUSED_MSG_TYPE"</span>,
00056     <span class="stringliteral">"LPC_REQUEST"</span>,
00057     <span class="stringliteral">"LPC_REPLY"</span>,
00058     <span class="stringliteral">"LPC_DATAGRAM"</span>,
00059     <span class="stringliteral">"LPC_LOST_REPLY"</span>,
00060     <span class="stringliteral">"LPC_PORT_CLOSED"</span>,
00061     <span class="stringliteral">"LPC_CLIENT_DIED"</span>,
00062     <span class="stringliteral">"LPC_EXCEPTION"</span>,
00063     <span class="stringliteral">"LPC_DEBUG_EVENT"</span>,
00064     <span class="stringliteral">"LPC_ERROR_EVENT"</span>,
00065     <span class="stringliteral">"LPC_CONNECTION_REQUEST"</span>
00066 };
00067 
00068 <span class="preprocessor">#endif // ENABLE_LPC_TRACING</span>
00069 <span class="preprocessor"></span>
00070 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(INIT,LpcInitSystem)</span>
00072 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00073 <span class="preprocessor"></span>
00074 
00075 BOOLEAN
<a name="l00076"></a><a class="code" href="../../d7/d6/lpcinit_8c.html#a4">00076</a> <a class="code" href="../../d7/d6/lpcinit_8c.html#a4">LpcInitSystem</a> (
00077     VOID
00078 )
00079 
00080 <span class="comment">/*++</span>
00081 <span class="comment"></span>
00082 <span class="comment">Routine Description:</span>
00083 <span class="comment"></span>
00084 <span class="comment">    This function performs the system initialization for the LPC package.</span>
00085 <span class="comment">    LPC stands for Local Inter-Process Communication.</span>
00086 <span class="comment"></span>
00087 <span class="comment">Arguments:</span>
00088 <span class="comment"></span>
00089 <span class="comment">    None.</span>
00090 <span class="comment"></span>
00091 <span class="comment">Return Value:</span>
00092 <span class="comment"></span>
00093 <span class="comment">    TRUE if successful and FALSE if an error occurred.</span>
00094 <span class="comment"></span>
00095 <span class="comment">    The following errors can occur:</span>
00096 <span class="comment"></span>
00097 <span class="comment">    - insufficient memory</span>
00098 <span class="comment"></span>
00099 <span class="comment">--*/</span>
00100 
00101 {
00102     <a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">OBJECT_TYPE_INITIALIZER</a> ObjectTypeInitializer;
00103     UNICODE_STRING PortTypeName;
00104     ULONG ZoneElementSize;
00105     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00106 
00107     <span class="comment">//</span>
00108     <span class="comment">//  Initialize our global lpc lock</span>
00109     <span class="comment">//</span>
00110 
00111     <a class="code" href="../../d0/d7/lpcp_8h.html#a2">LpcpInitializeLpcpLock</a>();
00112 
00113     <span class="comment">//</span>
00114     <span class="comment">//  Create the object type for the port object</span>
00115     <span class="comment">//</span>
00116 
00117     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;PortTypeName, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Port"</span> );
00118 
00119     RtlZeroMemory( &amp;ObjectTypeInitializer, <span class="keyword">sizeof</span>( ObjectTypeInitializer ));
00120 
00121     ObjectTypeInitializer.Length = <span class="keyword">sizeof</span>( ObjectTypeInitializer );
00122     ObjectTypeInitializer.GenericMapping = <a class="code" href="../../d7/d6/lpcinit_8c.html#a2">LpcpPortMapping</a>;
00123     ObjectTypeInitializer.MaintainTypeList = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00124     ObjectTypeInitializer.PoolType = <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>;
00125     ObjectTypeInitializer.DefaultPagedPoolCharge = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">LPCP_PORT_OBJECT</a> );
00126     ObjectTypeInitializer.DefaultNonPagedPoolCharge = <span class="keyword">sizeof</span>( <a class="code" href="../../d8/d4/struct__LPCP__NONPAGED__PORT__QUEUE.html">LPCP_NONPAGED_PORT_QUEUE</a> );
00127     ObjectTypeInitializer.InvalidAttributes = OBJ_VALID_ATTRIBUTES ^ PORT_VALID_OBJECT_ATTRIBUTES;
00128     ObjectTypeInitializer.ValidAccessMask = PORT_ALL_ACCESS;
00129     ObjectTypeInitializer.CloseProcedure = <a class="code" href="../../d3/d6/lpcclose_8c.html#a0">LpcpClosePort</a>;
00130     ObjectTypeInitializer.DeleteProcedure = <a class="code" href="../../d3/d6/lpcclose_8c.html#a1">LpcpDeletePort</a>;
00131     ObjectTypeInitializer.UseDefaultObject = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00132 
00133     <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>( &amp;PortTypeName,
00134                         &amp;ObjectTypeInitializer,
00135                         (PSECURITY_DESCRIPTOR)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00136                         &amp;<a class="code" href="../../d9/d8/ntos_8h.html#a5">LpcPortObjectType</a> );
00137 
00138     <span class="comment">//</span>
00139     <span class="comment">//  Create the object type for the waitable port object</span>
00140     <span class="comment">//</span>
00141 
00142     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;PortTypeName, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"WaitablePort"</span> );
00143     ObjectTypeInitializer.PoolType = <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> ;
00144     ObjectTypeInitializer.UseDefaultObject = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00145 
00146     <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>( &amp;PortTypeName,
00147                         &amp;ObjectTypeInitializer,
00148                         (PSECURITY_DESCRIPTOR)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00149                         &amp;<a class="code" href="../../d9/d8/ntos_8h.html#a6">LpcWaitablePortObjectType</a> );
00150 
00151     <span class="comment">//</span>
00152     <span class="comment">//  Initialize the lpc message and callback id counters</span>
00153     <span class="comment">//</span>
00154 
00155     <a class="code" href="../../d0/d7/lpcp_8h.html#a18">LpcpNextMessageId</a> = 1;
00156     <a class="code" href="../../d0/d7/lpcp_8h.html#a19">LpcpNextCallbackId</a> = 1;
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">//  Initialize the lpc port zone.  Each element can contain a max</span>
00160     <span class="comment">//  message, plus an LPCP message structure, plus an LPCP connection</span>
00161     <span class="comment">//  message</span>
00162     <span class="comment">//</span>
00163 
00164     ZoneElementSize = PORT_MAXIMUM_MESSAGE_LENGTH +
00165                       <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d4/struct__LPCP__MESSAGE.html">LPCP_MESSAGE</a> ) +
00166                       <span class="keyword">sizeof</span>( <a class="code" href="../../d4/d4/struct__LPCP__CONNECTION__MESSAGE.html">LPCP_CONNECTION_MESSAGE</a> );
00167 
00168     <span class="comment">//</span>
00169     <span class="comment">//  Round up the size to the next 16 byte alignment</span>
00170     <span class="comment">//</span>
00171 
00172     ZoneElementSize = (ZoneElementSize + <a class="code" href="../../d2/d6/lpc_8h.html#a0">LPCP_ZONE_ALIGNMENT</a> - 1) &amp;
00173                       <a class="code" href="../../d2/d6/lpc_8h.html#a1">LPCP_ZONE_ALIGNMENT_MASK</a>;
00174 
00175     <span class="comment">//</span>
00176     <span class="comment">//  Initialize the zone</span>
00177     <span class="comment">//</span>
00178 
00179     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d7/lpcqueue_8c.html#a2">LpcpInitializePortZone</a>( ZoneElementSize,
00180                                      <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>,
00181                                      <a class="code" href="../../d2/d6/lpc_8h.html#a2">LPCP_ZONE_MAX_POOL_USAGE</a> );
00182 
00183     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00184 
00185         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00186     }
00187 
00188     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00189 }
00190 
00191 
00192 <span class="keywordtype">char</span> *
<a name="l00193"></a><a class="code" href="../../d0/d7/lpcp_8h.html#a33">00193</a> <a class="code" href="../../d0/d7/lpcp_8h.html#a33">LpcpGetCreatorName</a> (
00194     <a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">PLPCP_PORT_OBJECT</a> PortObject
00195     )
00196 
00197 <span class="comment">/*++</span>
00198 <span class="comment"></span>
00199 <span class="comment">Routine Description:</span>
00200 <span class="comment"></span>
00201 <span class="comment">    This routine returns the name of the process that created the specified</span>
00202 <span class="comment">    port object</span>
00203 <span class="comment"></span>
00204 <span class="comment">Arguments:</span>
00205 <span class="comment"></span>
00206 <span class="comment">    PortObject - Supplies the port object being queried</span>
00207 <span class="comment"></span>
00208 <span class="comment">Return Value:</span>
00209 <span class="comment"></span>
00210 <span class="comment">    char * - The image name of the process that created the port process</span>
00211 <span class="comment"></span>
00212 <span class="comment">--*/</span>
00213 
00214 {
00215     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00216     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
00217 
00218     <span class="comment">//</span>
00219     <span class="comment">//  First find the process that created the port object</span>
00220     <span class="comment">//</span>
00221 
00222     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/pscid_8c.html#a1">PsLookupProcessByProcessId</a>( PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o5">Creator</a>.UniqueProcess, &amp;Process );
00223 
00224     <span class="comment">//</span>
00225     <span class="comment">//  If we were able to get the process then return the name of the process</span>
00226     <span class="comment">//  to our caller</span>
00227     <span class="comment">//</span>
00228 
00229     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00230 
00231         <span class="keywordflow">return</span> Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o65">ImageFileName</a>;
00232 
00233     } <span class="keywordflow">else</span> {
00234 
00235         <span class="comment">//</span>
00236         <span class="comment">//  Otherwise tell our caller we don't know the name</span>
00237         <span class="comment">//</span>
00238 
00239         <span class="keywordflow">return</span> <span class="stringliteral">"Unknown"</span>;
00240     }
00241 }
00242 
00243 <span class="preprocessor">#ifdef LPCP_TRACE_SERVER_THREADS</span>
00244 <span class="preprocessor"></span>
00245 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d0/d7/lpcp_8h.html#a5">LpcpPortExtraDataCreate</a> ( <a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">PLPCP_PORT_OBJECT</a> PortObject )
00246 <span class="comment">/*++</span>
00247 <span class="comment"></span>
00248 <span class="comment">Routine Description:</span>
00249 <span class="comment"></span>
00250 <span class="comment">    Allocate a LPCP_PORT_EXTRA_DATA structure and initializate it.</span>
00251 <span class="comment"></span>
00252 <span class="comment">Arguments:</span>
00253 <span class="comment"></span>
00254 <span class="comment">    PortObject - The port object that will contains this structure</span>
00255 <span class="comment"></span>
00256 <span class="comment">Return Value:</span>
00257 <span class="comment"></span>
00258 <span class="comment">    None</span>
00259 <span class="comment"></span>
00260 <span class="comment"></span>
00261 <span class="comment">--*/</span>
00262 {
00263     PLPCP_PORT_EXTRA_DATA PortData;
00264 
00265     PortData = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(NonPagedPool, <span class="keyword">sizeof</span>(LPCP_PORT_EXTRA_DATA), 'DEPL');
00266 
00267     PortData-&gt;ThreadCount = 0;
00268 
00269     PortData-&gt;PortObject = PortObject;
00270 
00271     PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o17">Reserved</a> = (ULONG)PortData;
00272 
00273 }
00274 
00275 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d0/d7/lpcp_8h.html#a6">LpcpPortExtraDataDestroy</a> (<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">PLPCP_PORT_OBJECT</a> PortObject)
00276 <span class="comment">/*++</span>
00277 <span class="comment"></span>
00278 <span class="comment">Routine Description:</span>
00279 <span class="comment"></span>
00280 <span class="comment">    Free the memory alocated for the extra data structure</span>
00281 <span class="comment"></span>
00282 <span class="comment">Arguments:</span>
00283 <span class="comment"></span>
00284 <span class="comment">    PortObject - The port object that will contains this structure</span>
00285 <span class="comment"></span>
00286 <span class="comment">Return Value:</span>
00287 <span class="comment"></span>
00288 <span class="comment">    None</span>
00289 <span class="comment"></span>
00290 <span class="comment">--*/</span>
00291 {
00292     PLPCP_PORT_EXTRA_DATA PortData;
00293 
00294     PortData = (PLPCP_PORT_EXTRA_DATA) PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o17">Reserved</a>;
00295 
00296     <span class="keywordflow">if</span> ((PortData != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00297         (PortData-&gt;PortObject == PortObject)) {
00298 
00299         <a class="code" href="../../d5/d8/ex_8h.html#a7">ExFreePoolWithTag</a>( PortData, 'DEPL');
00300 
00301         PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o17">Reserved</a> = 0;
00302     }
00303 }
00304 
00305 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> LpcpPortExtraDataPush (PLPCP_PORT_EXTRA_DATA PortData, PVOID Thread)
00306 <span class="comment">/*++</span>
00307 <span class="comment"></span>
00308 <span class="comment">Routine Description:</span>
00309 <span class="comment"></span>
00310 <span class="comment">    Push a new thread on the array. The opperation occurs only if the thread is first time</span>
00311 <span class="comment">    using this port.</span>
00312 <span class="comment"></span>
00313 <span class="comment">Arguments:</span>
00314 <span class="comment"></span>
00315 <span class="comment">    PortData - the pointer to the Extra data port structure</span>
00316 <span class="comment"></span>
00317 <span class="comment">    Thread - The thread that should be added to the thread array</span>
00318 <span class="comment"></span>
00319 <span class="comment"></span>
00320 <span class="comment">Return Value:</span>
00321 <span class="comment"></span>
00322 <span class="comment">    None</span>
00323 <span class="comment"></span>
00324 <span class="comment"></span>
00325 <span class="comment">--*/</span>
00326 {
00327     ULONG Position;
00328     ULONG EndSearch;
00329 
00330     EndSearch = PortData-&gt;ThreadCount;
00331 
00332     <span class="keywordflow">if</span> ( EndSearch &gt;=  LPCP_SERVER_THREAD_ARRAY_SIZE) {
00333 
00334         EndSearch = LPCP_SERVER_THREAD_ARRAY_SIZE - 1;
00335     }
00336 
00337     <span class="keywordflow">for</span> (Position = 0; Position &lt; EndSearch ; Position++) {
00338 
00339         <span class="keywordflow">if</span> ( PortData-&gt;Threads[Position] == Thread ) {
00340 
00341             <span class="keywordflow">return</span>;
00342         }
00343     }
00344 
00345     PortData-&gt;Threads[PortData-&gt;ThreadCount % LPCP_SERVER_THREAD_ARRAY_SIZE] = Thread;
00346 
00347     PortData-&gt;ThreadCount += 1;
00348 
00349 <span class="comment">//    DbgPrint( "Port %lx : Threads: %ld  (%lx)\n", PortData-&gt;PortObject, PortData-&gt;ThreadCount, Thread);</span>
00350 
00351 }
00352 
00353 
00354 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d0/d7/lpcp_8h.html#a7">LpcpSaveThread</a> (<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">PLPCP_PORT_OBJECT</a> PortObject)
00355 <span class="comment">/*++</span>
00356 <span class="comment"></span>
00357 <span class="comment">Routine Description:</span>
00358 <span class="comment"></span>
00359 <span class="comment">    This function is used to store the current thread to the PortObject. If the port object does not</span>
00360 <span class="comment">    have the extra-data structure allocated, this function will call LpcpPortExtraDataCreate to do this.</span>
00361 <span class="comment"></span>
00362 <span class="comment">Arguments:</span>
00363 <span class="comment"></span>
00364 <span class="comment">    PortObject - The port object that will contains this structure</span>
00365 <span class="comment"></span>
00366 <span class="comment">Return Value:</span>
00367 <span class="comment"></span>
00368 <span class="comment">    None</span>
00369 <span class="comment"></span>
00370 <span class="comment">--*/</span>
00371 {
00372 
00373     <span class="keywordflow">if</span> (PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o17">Reserved</a> == 0) {
00374 
00375         <a class="code" href="../../d0/d7/lpcp_8h.html#a5">LpcpPortExtraDataCreate</a>( PortObject );
00376     }
00377 
00378     <span class="keywordflow">if</span> ( ((PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o1">Flags</a> &amp; <a class="code" href="../../d2/d6/lpc_8h.html#a3">PORT_TYPE</a>) == <a class="code" href="../../d2/d6/lpc_8h.html#a6">SERVER_COMMUNICATION_PORT</a>) &amp;&amp;
00379          (PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o17">Reserved</a> != 0) ) {
00380 
00381              LpcpPortExtraDataPush( (PLPCP_PORT_EXTRA_DATA)PortObject-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o17">Reserved</a>, <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>());
00382     }
00383 }
00384 
00385 <span class="preprocessor">#endif // LPCP_TRACE_SERVER_THREADS</span>
00386 <span class="preprocessor"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:39 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
