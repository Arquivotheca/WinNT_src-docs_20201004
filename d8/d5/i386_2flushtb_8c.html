<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: i386/flushtb.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flushtb.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d9/d4/i386_2flushtb_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a0">KiFlushTargetEntireTb</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Invalid, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a1">KiFlushTargetMultipleTb</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a2">KiFlushTargetSingleTb</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HARDWARE_PTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a3">KiFlushSingleTbSynchronous</a> (IN PVOID Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE PtePointer, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a4">KiFlushTargetSingleTbSynchronous</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a5">Ki386UseSynchronousTbFlush</a> (IN volatile PLONG Number)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a6">KeFlushEntireTb</a> (IN BOOLEAN Invalid, IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a7">KeFlushMultipleTb</a> (IN ULONG Number, IN PVOID *Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE *PtePointer OPTIONAL, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HARDWARE_PTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/i386_2flushtb_8c.html#a8">KeFlushSingleTb</a> (IN PVOID Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE PtePointer, IN HARDWARE_PTE PteValue)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6" doxytag="i386/flushtb.c::KeFlushEntireTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushEntireTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00094">94</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00202">KiFlushTargetEntireTb()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00101                    :
00102 
00103     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer (TB) on all processors
00104     that are currently running threads which are child of the current process
00105     or flushes the entire translation buffer on all processors in the host
00106     configuration.
00107 
00108 Arguments:
00109 
00110     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies the reason for flushing
00111         the translation buffer.
00112 
00113     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which translation
00114         buffers are to be flushed.
00115 
00116 Return Value:
00117 
00118     None.
00119 
00120 --*/
00121 
00122 {
00123 
00124     KIRQL OldIrql;
00125     PKPRCB Prcb;
00126     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00127     KAFFINITY TargetProcessors;
00128 
00129     <span class="comment">//</span>
00130     <span class="comment">// Compute the target set of processors, disable context switching,</span>
00131     <span class="comment">// and send the flush entire parameters to the target processors,</span>
00132     <span class="comment">// if any, for execution.</span>
00133     <span class="comment">//</span>
00134 
00135 <span class="preprocessor">#if defined(NT_UP)</span>
00136 <span class="preprocessor"></span>
00137     OldIrql = KeRaiseIrqlToSynchLevel();
00138 
00139 <span class="preprocessor">#else</span>
00140 <span class="preprocessor"></span>
00141     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00142         OldIrql = KeRaiseIrqlToSynchLevel();
00143         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00144         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00145 
00146     } <span class="keywordflow">else</span> {
00147         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00148         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00149         Process = Prcb-&gt;CurrentThread-&gt;ApcState.Process;
00150         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00151     }
00152 
00153     TargetProcessors &amp;= ~Prcb-&gt;SetMember;
00154     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00155         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00156                         KiFlushTargetEntireTb,
00157                         NULL,
00158                         NULL,
00159                         NULL);
00160 
00161         <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a> (Prcb-&gt;Number, FlushEntireTb);
00162     }
00163 
00164 <span class="preprocessor">#endif</span>
00165 <span class="preprocessor"></span>
00166     <span class="comment">//</span>
00167     <span class="comment">// Flush TB on current processor.</span>
00168     <span class="comment">//</span>
00169 
00170     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00171 
00172     <span class="comment">//</span>
00173     <span class="comment">// Wait until all target processors have finished and complete packet.</span>
00174     <span class="comment">//</span>
00175 
00176 <span class="preprocessor">#if defined(NT_UP)</span>
00177 <span class="preprocessor"></span>
00178     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00179 
00180 <span class="preprocessor">#else</span>
00181 <span class="preprocessor"></span>
00182     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00183         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00184     }
00185 
00186     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00187         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00188 
00189     } <span class="keywordflow">else</span> {
00190         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00191     }
00192 
00193 <span class="preprocessor">#endif</span>
00194 <span class="preprocessor"></span>
00195     <span class="keywordflow">return</span>;
00196 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="i386/flushtb.c::KeFlushMultipleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushMultipleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE *PtePointer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00240">240</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00368">KiFlushTargetMultipleTb()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00251                    :
00252 
00253     This function flushes multiple entries from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00254     on all processors that are currently running threads which are
00255     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a multiple entries from
00256     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00257 
00258 Arguments:
00259 
00260     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00261 
00262     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> addresses that
00263         are within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pages whose <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entries are to be
00264         flushed.
00265 
00266     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00267         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00268 
00269     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00270         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00271 
00272     PtePointer - Supplies an optional pointer to an array of pointers to
00273        page table entries that receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry
00274        value.
00275 
00276     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00277 
00278 Return Value:
00279 
00280     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00281     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00282 
00283 --*/
00284 
00285 {
00286 
00287     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00288     KIRQL OldIrql;
00289     PKPRCB Prcb;
00290     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00291     KAFFINITY TargetProcessors;
00292 
00293     <span class="comment">//</span>
00294     <span class="comment">// Compute target set of processors.</span>
00295     <span class="comment">//</span>
00296 
00297     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00298         OldIrql = KeRaiseIrqlToSynchLevel();
00299         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00300         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00301 
00302     } <span class="keywordflow">else</span> {
00303         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00304         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00305         Process = Prcb-&gt;CurrentThread-&gt;ApcState.Process;
00306         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00307     }
00308 
00309     TargetProcessors &amp;= ~Prcb-&gt;SetMember;
00310 
00311     <span class="comment">//</span>
00312     <span class="comment">// If a page table entry address array is specified, then set the</span>
00313     <span class="comment">// specified page table entries to the specific value.</span>
00314     <span class="comment">//</span>
00315 
00316     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00317         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00318             KI_FILL_PTE(PtePointer[Index], PteValue);
00319         }
00320     }
00321 
00322     <span class="comment">//</span>
00323     <span class="comment">// If any target processors are specified, then send a flush multiple</span>
00324     <span class="comment">// packet to the target set of processors.</span>
00325     <span class="comment">//</span>
00326 
00327     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00328         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00329                         KiFlushTargetMultipleTb,
00330                         (PVOID)Invalid,
00331                         (PVOID)Number,
00332                         (PVOID)Virtual);
00333 
00334         <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a> (Prcb-&gt;Number, FlushMultipleTb);
00335     }
00336 
00337     <span class="comment">//</span>
00338     <span class="comment">// Flush the specified entries from the TB on the current processor.</span>
00339     <span class="comment">//</span>
00340 
00341     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00342         <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(Invalid, Virtual[Index]);
00343     }
00344 
00345     <span class="comment">//</span>
00346     <span class="comment">// Wait until all target processors have finished and complete packet.</span>
00347     <span class="comment">//</span>
00348 
00349     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00350         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00351     }
00352 
00353     <span class="comment">//</span>
00354     <span class="comment">// Release the context swap lock.</span>
00355     <span class="comment">//</span>
00356 
00357     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00358         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00359 
00360     } <span class="keywordflow">else</span> {
00361         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00362     }
00363 
00364     <span class="keywordflow">return</span>;
00365 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="i386/flushtb.c::KeFlushSingleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HARDWARE_PTE KeFlushSingleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PtePointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00428">428</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00546">KiFlushTargetSingleTb()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00438                    :
00439 
00440     This function flushes a single entry from <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer (TB) on all
00441     processors that are currently running threads which are child of the current
00442     process or flushes the entire translation buffer on all processors in the
00443     host configuration.
00444 
00445 Arguments:
00446 
00447     Virtual - Supplies a virtual address that is within the page whose
00448         translation buffer entry is to be flushed.
00449 
00450     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies the reason for flushing
00451         the translation buffer.
00452 
00453     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which translation
00454         buffers are to be flushed.
00455 
00456     PtePointer - Address of Pte to update with new value.
00457 
00458     PteValue - New value to put in the Pte.  Will simply be assigned to
00459         *PtePointer, in a fashion correct for the hardware.
00460 
00461 Return Value:
00462 
00463     Returns the contents of the PtePointer before the new value
00464     is stored.
00465 
00466 --*/
00467 
00468 {
00469 
00470     KIRQL OldIrql;
00471     PKPRCB Prcb;
00472     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00473     HARDWARE_PTE OldPteValue;
00474     KAFFINITY TargetProcessors;
00475 
00476     <span class="comment">//</span>
00477     <span class="comment">// Compute target set of processors.</span>
00478     <span class="comment">//</span>
00479 
00480     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00481         OldIrql = KeRaiseIrqlToSynchLevel();
00482         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00483         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00484 
00485     } <span class="keywordflow">else</span> {
00486         <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00487         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00488         Process = Prcb-&gt;CurrentThread-&gt;ApcState.Process;
00489         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00490     }
00491 
00492     TargetProcessors &amp;= ~Prcb-&gt;SetMember;
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00496     <span class="comment">// page table entry to the new value.</span>
00497     <span class="comment">//</span>
00498 
00499     KI_SWAP_PTE(PtePointer, PteValue, OldPteValue);
00500 
00501     <span class="comment">//</span>
00502     <span class="comment">// If any target processors are specified, then send a flush single</span>
00503     <span class="comment">// packet to the target set of processors.</span>
00504     <span class="comment">//</span>
00505 
00506     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00507         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00508                         KiFlushTargetSingleTb,
00509                         (PVOID)Invalid,
00510                         (PVOID)Virtual,
00511                         NULL);
00512 
00513         <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(Prcb-&gt;Number, FlushSingleTb);
00514     }
00515 
00516 
00517     <span class="comment">//</span>
00518     <span class="comment">// Flush the specified entry from the TB on the current processor.</span>
00519     <span class="comment">//</span>
00520 
00521     <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(Invalid, Virtual);
00522 
00523     <span class="comment">//</span>
00524     <span class="comment">// Wait until all target processors have finished and complete packet.</span>
00525     <span class="comment">//</span>
00526 
00527     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00528         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00529     }
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">// Release the context swap lock.</span>
00533     <span class="comment">//</span>
00534 
00535     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00536         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00537 
00538     } <span class="keywordflow">else</span> {
00539         <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00540     }
00541 
00542     <span class="keywordflow">return</span>(OldPteValue);
00543 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="i386/flushtb.c::Ki386UseSynchronousTbFlush" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID Ki386UseSynchronousTbFlush           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN volatile PLONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Number</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00747">747</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, and <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>.
<p>
Referenced by <a class="el" href="../../d7/d8/kernlini_8c-source.html#l01691">KiInitMachineDependent()</a>.
<p>
<pre class="fragment"><div>00750 {
00751     PKPRCB              Prcb;
00752     <span class="keyword">volatile</span> PUCHAR     Patch;
00753 
00754     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00755     Patch = (PUCHAR) <a class="code" href="../../d4/d9/ke_8h.html#a377">KeFlushSingleTb</a>;
00756 
00757     <span class="comment">//</span>
00758     <span class="comment">// Signal we're here and wait for others</span>
00759     <span class="comment">//</span>
00760 
00761     InterlockedDecrement (Number);
00762     <span class="keywordflow">while</span> (*Number) ;
00763 
00764     <span class="comment">//</span>
00765     <span class="comment">// If this is processor 0 apply the patch</span>
00766     <span class="comment">//</span>
00767 
00768     <span class="keywordflow">if</span> (Prcb-&gt;Number == 0) {
00769         *((PULONG) &amp;Patch[1]) = ((ULONG) &amp;<a class="code" href="../../d8/d5/i386_2flushtb_8c.html#a3">KiFlushSingleTbSynchronous</a>) - ((ULONG) Patch) - 5;
00770         Patch[0] = 0xe9;
00771     }
00772 
00773     <span class="comment">//</span>
00774     <span class="comment">// Wait for processor 0 to complete installation of handler</span>
00775     <span class="comment">//</span>
00776 
00777     <span class="keywordflow">while</span> (Patch[0] != 0xe9) ;
00778 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="i386/flushtb.c::KiFlushSingleTbSynchronous" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HARDWARE_PTE KiFlushSingleTbSynchronous           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PtePointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">589</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00747">_KPROCESS::ActiveProcessors</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00703">KiFlushTargetSingleTbSynchronous()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00747">Ki386UseSynchronousTbFlush()</a>.
<p>
<pre class="fragment"><div>00599                    :
00600 
00601     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a slow synchronous version of <a class="code" href="../../d4/d9/ke_8h.html#a377">KeFlushSingleTb</a>.  We need
00602     <span class="keyword">this</span> function as many P6's don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> actually know how to deal with PTEs in
00603     an MP safe manner.
00604 
00605 Arguments:
00606 
00607     See <a class="code" href="../../d4/d9/ke_8h.html#a377">KeFlushSingleTb</a>
00608 
00609 Return Value:
00610 
00611     See <a class="code" href="../../d4/d9/ke_8h.html#a377">KeFlushSingleTb</a>
00612 
00613 --*/
00614 {
00615 
00616     KIRQL OldIrql;
00617     PKPRCB Prcb;
00618     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00619     HARDWARE_PTE OldPteValue;
00620     KAFFINITY TargetProcessors;
00621 
00622     <span class="comment">//</span>
00623     <span class="comment">// Synchronize will all other single flush calls (and other</span>
00624     <span class="comment">// IPIs which use reverse stalls)</span>
00625     <span class="comment">//</span>
00626 
00627     <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00628 
00629     <span class="comment">//</span>
00630     <span class="comment">// Compute target set of processors.</span>
00631     <span class="comment">//</span>
00632 
00633     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00634     <span class="keywordflow">if</span> (AllProcessors != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00635         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00636     } <span class="keywordflow">else</span> {
00637         Process = Prcb-&gt;CurrentThread-&gt;ApcState.Process;
00638         TargetProcessors = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o3">ActiveProcessors</a>;
00639     }
00640 
00641     TargetProcessors &amp;= ~Prcb-&gt;SetMember;
00642 
00643     <span class="comment">//</span>
00644     <span class="comment">// If any target processors are specified, then send a flush single</span>
00645     <span class="comment">// packet to the target set of processors.</span>
00646     <span class="comment">//</span>
00647 
00648     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00649         KiIpiSendSynchronousPacket(Prcb,
00650                                    TargetProcessors,
00651                                    KiFlushTargetSingleTbSynchronous,
00652                                    (PVOID)Invalid,
00653                                    (PVOID)Virtual,
00654                                    (PVOID)&amp;Prcb-&gt;ReverseStall
00655                                    );
00656 
00657         <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(Prcb-&gt;Number, FlushSingleTb);
00658 
00659         <span class="comment">//</span>
00660         <span class="comment">// Wait for the target processors to stall</span>
00661         <span class="comment">//</span>
00662 
00663         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00664 
00665         <span class="comment">//</span>
00666         <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00667         <span class="comment">// page table entry to the new value.</span>
00668         <span class="comment">//</span>
00669 
00670         KI_SWAP_PTE(PtePointer, PteValue, OldPteValue);
00671 
00672         <span class="comment">//</span>
00673         <span class="comment">// Notify all prcessors it's time to go</span>
00674         <span class="comment">//</span>
00675 
00676         Prcb-&gt;ReverseStall += 1;
00677 
00678     } <span class="keywordflow">else</span> {
00679 
00680         <span class="comment">//</span>
00681         <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00682         <span class="comment">// page table entry to the new value.</span>
00683         <span class="comment">//</span>
00684 
00685         KI_SWAP_PTE(PtePointer, PteValue, OldPteValue);
00686     }
00687 
00688     <span class="comment">//</span>
00689     <span class="comment">// Flush the specified entry from the TB on the current processor.</span>
00690     <span class="comment">//</span>
00691 
00692     <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(Invalid, Virtual);
00693 
00694     <span class="comment">//</span>
00695     <span class="comment">// Done</span>
00696     <span class="comment">//</span>
00697 
00698     <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00699     <span class="keywordflow">return</span>(OldPteValue);
00700 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="i386/flushtb.c::KiFlushTargetEntireTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushTargetEntireTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00202">202</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00094">KeFlushEntireTb()</a>.
<p>
<pre class="fragment"><div>00211                    :
00212 
00213     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire TB.
00214 
00215 Arguments:
00216 
00217     SignalDone - Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00218         requested operation has been performed.
00219 
00220     Parameter1 - Parameter3 - Not used.
00221 
00222 Return Value:
00223 
00224     None.
00225 
00226 --*/
00227 
00228 {
00229 
00230     <span class="comment">//</span>
00231     <span class="comment">// Flush the entire TB on the current processor.</span>
00232     <span class="comment">//</span>
00233 
00234     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00235     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00236     <span class="keywordflow">return</span>;
00237 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="i386/flushtb.c::KiFlushTargetMultipleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushTargetMultipleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00368">368</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00240">KeFlushMultipleTb()</a>.
<p>
<pre class="fragment"><div>00377                    :
00378 
00379     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing multiple TB entries.
00380 
00381 Arguments:
00382 
00383     SignalDone - Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00384         requested operation has been performed.
00385 
00386     Invalid - Supplies a bollean value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span>
00387         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invalid.
00388 
00389     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00390 
00391     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> addresses that
00392         are within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pages whose <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entries are to be
00393         flushed.
00394 
00395 Return Value:
00396 
00397     None.
00398 
00399 --*/
00400 
00401 {
00402 
00403     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00404     PVOID VirtualAddress[FLUSH_MULTIPLE_MAXIMUM];
00405 
00406     <span class="comment">//</span>
00407     <span class="comment">// Capture the virtual addresses that are to be flushed from the TB</span>
00408     <span class="comment">// on the current processor and signal pack done.</span>
00409     <span class="comment">//</span>
00410 
00411     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; (ULONG) Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00412         VirtualAddress[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = ((PVOID *)(<a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a>))[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00413     }
00414 
00415     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00416 
00417     <span class="comment">//</span>
00418     <span class="comment">// Flush the specified virtual address for the TB on the current</span>
00419     <span class="comment">// processor.</span>
00420     <span class="comment">//</span>
00421 
00422     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; (ULONG) Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00423         <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>((BOOLEAN)Invalid, VirtualAddress [Index]);
00424     }
00425 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="i386/flushtb.c::KiFlushTargetSingleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushTargetSingleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00546">546</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00428">KeFlushSingleTb()</a>.
<p>
<pre class="fragment"><div>00555                    :
00556 
00557     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing a single TB entry.
00558 
00559 Arguments:
00560 
00561     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00562         requested operation has been performed.
00563 
00564     Invalid - Supplies a bollean value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span>
00565         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invalid.
00566 
00567     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> address that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page whose
00568         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be flushed.
00569 
00570     Parameter3 - Not used.
00571 
00572 Return Value:
00573 
00574     None.
00575 
00576 --*/
00577 
00578 {
00579 
00580     <span class="comment">//</span>
00581     <span class="comment">// Flush a single entry from the TB on the current processor.</span>
00582     <span class="comment">//</span>
00583 
00584     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00585     <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>((BOOLEAN)Invalid, (PVOID)VirtualAddress);
00586 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="i386/flushtb.c::KiFlushTargetSingleTbSynchronous" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushTargetSingleTbSynchronous           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00703">703</a> of file <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html">i386/flushtb.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>.
<p>
<pre class="fragment"><div>00712                    :
00713 
00714     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing a single TB entry synchronously.
00715 
00716 Arguments:
00717 
00718     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00719         requested operation has been performed.
00720 
00721     Invalid - Supplies a bollean value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span>
00722         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invalid.
00723 
00724     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> address that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page whose
00725         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be flushed.
00726 
00727     Parameter3 - Not used.
00728 
00729 Return Value:
00730 
00731     None.
00732 
00733 --*/
00734 
00735 {
00736 
00737     <span class="comment">//</span>
00738     <span class="comment">// Flush a single entry from the TB on the current processor.</span>
00739     <span class="comment">//</span>
00740 
00741     KiIpiSignalPacketDoneAndStall(SignalDone, Proceed);
00742     <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>((BOOLEAN)Invalid, (PVOID)VirtualAddress);
00743 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
