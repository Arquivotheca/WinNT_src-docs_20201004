<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dllinit.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dllinit.c File Reference</h1><code>#include "<a class="el" href="../../d5/d2/w32_2ntcon_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include &lt;cpl.h&gt;</code><br>

<p>
<a href="../../d9/d8/dllinit_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a0">DEFAULT_WINDOW_TITLE</a>&nbsp;&nbsp;&nbsp;(L"Command Prompt")</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a1">MAX_SESSION_PATH</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a2">SESSION_ROOT</a>&nbsp;&nbsp;&nbsp;L"\\Sessions"</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a8">CtrlRoutine</a> (IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpThreadParameter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a9">PropRoutine</a> (IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpThreadParameter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a10">InitExeName</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a11">ConsoleApp</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a12">SetUpAppName</a> (IN OUT LPDWORD CurDirLength, OUT LPWSTR CurDir, IN OUT LPDWORD AppNameLength, OUT LPWSTR AppName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a13">ParseReserved</a> (WCHAR *pchReserved, WCHAR *pchFind)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a14">SetUpConsoleInfo</a> (IN BOOL DllInit, OUT LPDWORD TitleLength, OUT LPWSTR Title OPTIONAL, OUT LPDWORD DesktopLength, OUT LPWSTR *Desktop OPTIONAL, OUT <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a> ConsoleInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a15">SetUpHandles</a> (IN <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a> ConsoleInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a16">GetConsoleLangId</a> (OUT LANGID *lpLangId)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a16"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a17">SetTEBLangID</a> (VOID)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW6432)  <a href="#a17"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a18">ConnectConsoleInternal</a> (IN PWSTR pObjectDirectory, IN OUT <a class="el" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html">PCONSOLE_API_CONNECTINFO</a> pConnectInfo, OUT PBOOLEAN pServerProcess)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a18"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a19">ConDllInitialize</a> (IN PVOID DllHandle, IN ULONG Reason, IN PCONTEXT Context OPTIONAL)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW6432)  <a href="#a19"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a20">AllocConsoleInternal</a> (IN LPWSTR lpTitle, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTitleLength, IN LPWSTR lpDesktop, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesktopLength, IN LPWSTR lpCurDir, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCurDirLength, IN LPWSTR lpAppName, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwAppNameLength, IN LPTHREAD_START_ROUTINE CtrlRoutine, IN LPTHREAD_START_ROUTINE PropRoutine, IN OUT <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a> pConsoleInfo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a20"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a21">AllocConsole</a> (VOID)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW6432)  <a href="#a21"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a22">FreeConsoleInternal</a> (VOID)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a22"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a23">FreeConsole</a> (VOID)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW6432)  <a href="#a23"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a3">InputWaitHandle</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a4">ExeNameBuffer</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a5">ExeNameLength</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a6">StartDirBuffer</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/dllinit_8c.html#a7">StartDirLength</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="dllinit.c::DEFAULT_WINDOW_TITLE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEFAULT_WINDOW_TITLE&nbsp;&nbsp;&nbsp;(L"Command Prompt")          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00028">28</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00141">SetUpConsoleInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="dllinit.c::MAX_SESSION_PATH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_SESSION_PATH&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00056">56</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l01169">CleanupSessionObjectDirectories()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02146">InitiateWin32kCleanup()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00891">NtUserCreateWindowStation()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="dllinit.c::SESSION_ROOT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SESSION_ROOT&nbsp;&nbsp;&nbsp;L"\\Sessions"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00057">57</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l01169">CleanupSessionObjectDirectories()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>, and <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02004">UserInitialize()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="dllinit.c::AllocConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY AllocConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW6432) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">803</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00656">AllocConsoleInternal()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00033">CtrlRoutine</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00028">DEFAULT_WINDOW_TITLE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">InitExeName()</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00068">InitializeCtrlHandling()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00043">_CONSOLE_INFO::InputWaitHandle</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00030">InputWaitHandle</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00068">LockDll</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00031">MAX_APP_NAME_LENGTH</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00030">MAX_TITLE_LENGTH</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l01019">PropRoutine()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00346">SetTEBLangID()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">SetUpAppName()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00141">SetUpConsoleInfo()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00263">SetUpHandles()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00069">UnlockDll</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/talloc_8c-source.html#l00106">main()</a>.
<p>
<pre class="fragment"><div>00807                    :
00808 
00809     This API creates a console <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling process.
00810 
00811 Arguments:
00812 
00813     none.
00814 
00815 Return Value:
00816 
00817     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - function was successful.
00818 
00819 --*/
00820 
00821 {
00822     <a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html">CONSOLE_INFO</a> ConsoleInfo;
00823     STARTUPINFOW StartupInfo;
00824     WCHAR CurDir[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>+1];
00825     WCHAR AppName[<a class="code" href="../../d5/d5/conmsg_8h.html#a3">MAX_APP_NAME_LENGTH</a>/2];
00826     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00827 
00828     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTitleLength;
00829     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesktopLength;
00830     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCurDirLength;
00831     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwAppNameLength;
00832 
00833     <a class="code" href="../../d6/d4/condll_8h.html#a9">LockDll</a>();
00834     <span class="keywordflow">try</span> {
00835         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00836             SetLastError(ERROR_ACCESS_DENIED);
00837             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00838             leave;
00839         }
00840 
00841         <span class="comment">//</span>
00842         <span class="comment">// set up initialization parameters</span>
00843         <span class="comment">//</span>
00844 
00845         <a class="code" href="../../d8/d9/dllinit_8c.html#a14">SetUpConsoleInfo</a>(FALSE,
00846                          &amp;dwTitleLength,
00847                          NULL,
00848                          &amp;dwDesktopLength,
00849                          NULL,
00850                          &amp;ConsoleInfo);
00851 
00852         <a class="code" href="../../d8/d9/dllinit_8c.html#a10">InitExeName</a>();
00853         dwCurDirLength = <span class="keyword">sizeof</span>(CurDir);
00854         dwAppNameLength = <span class="keyword">sizeof</span>(AppName);
00855         <a class="code" href="../../d8/d9/dllinit_8c.html#a12">SetUpAppName</a>(&amp;dwCurDirLength,
00856                      CurDir,
00857                      &amp;dwAppNameLength,
00858                      AppName);
00859 
00860         GetStartupInfoW(&amp;StartupInfo);
00861 
00862         <span class="keywordflow">if</span> (StartupInfo.lpTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00863             StartupInfo.lpTitle = <a class="code" href="../../d8/d9/dllinit_8c.html#a0">DEFAULT_WINDOW_TITLE</a>;
00864         }
00865         dwTitleLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((lstrlenW(StartupInfo.lpTitle)+1)*<span class="keyword">sizeof</span>(WCHAR));
00866         dwTitleLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwTitleLength,MAX_TITLE_LENGTH));
00867         <span class="keywordflow">if</span> (StartupInfo.lpDesktop != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; *StartupInfo.lpDesktop != 0) {
00868             dwDesktopLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((lstrlenW(StartupInfo.lpDesktop)+1)*<span class="keyword">sizeof</span>(WCHAR));
00869             dwDesktopLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(dwDesktopLength,MAX_TITLE_LENGTH));
00870         } <span class="keywordflow">else</span> {
00871             dwDesktopLength = 0;
00872         }
00873 
00874         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d9/dllinit_8c.html#a20">AllocConsoleInternal</a>(StartupInfo.lpTitle,
00875                                       dwTitleLength,
00876                                       StartupInfo.lpDesktop,
00877                                       dwDesktopLength,
00878                                       CurDir,
00879                                       dwCurDirLength,
00880                                       AppName,
00881                                       dwAppNameLength,
00882                                       CtrlRoutine,
00883                                       PropRoutine,
00884                                       &amp;ConsoleInfo
00885                                       );
00886 
00887         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) {
00888            leave;
00889         }
00890 
00891         <span class="comment">//</span>
00892         <span class="comment">// fill in peb values</span>
00893         <span class="comment">//</span>
00894 
00895         <a class="code" href="../../d8/d9/dllinit_8c.html#a15">SetUpHandles</a>(&amp;ConsoleInfo);
00896 
00897         <span class="comment">//</span>
00898         <span class="comment">// create ctrl-c thread</span>
00899         <span class="comment">//</span>
00900 
00901         <a class="code" href="../../d9/d0/ctrlc_8c.html#a11">InitializeCtrlHandling</a>();
00902 
00903         <a class="code" href="../../d8/d9/dllinit_8c.html#a3">InputWaitHandle</a> = ConsoleInfo.<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o1">InputWaitHandle</a>;
00904 
00905         <a class="code" href="../../d8/d9/dllinit_8c.html#a17">SetTEBLangID</a>();
00906 
00907         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00908 
00909     } finally {
00910         <a class="code" href="../../d6/d4/condll_8h.html#a10">UnlockDll</a>();
00911     }
00912 
00913     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00914 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="dllinit.c::AllocConsoleInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY AllocConsoleInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpTitle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwTitleLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpDesktop</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDesktopLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCurDir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCurDirLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpAppName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwAppNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPTHREAD_START_ROUTINE&nbsp;</td>
          <td class="mdname" nowrap> <em>CtrlRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPTHREAD_START_ROUTINE&nbsp;</td>
          <td class="mdname" nowrap> <em>PropRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pConsoleInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00656">656</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00600">_CONSOLE_ALLOC_MSG::AppName</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00599">_CONSOLE_ALLOC_MSG::AppNameLength</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a13">CONSOLE_INFO</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00594">_CONSOLE_ALLOC_MSG::ConsoleInfo</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a199">ConsolepAlloc</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00088">CsrAllocateCaptureBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00122">CsrCaptureMessageBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00098">CsrFreeCaptureBuffer()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00033">CtrlRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00603">_CONSOLE_ALLOC_MSG::CtrlRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00602">_CONSOLE_ALLOC_MSG::CurDir</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00601">_CONSOLE_ALLOC_MSG::CurDirLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00598">_CONSOLE_ALLOC_MSG::Desktop</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00597">_CONSOLE_ALLOC_MSG::DesktopLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00034">INITIALIZATION_FAILED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00033">INITIALIZATION_SUCCEEDED</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00035">NUMBER_OF_INITIALIZATION_EVENTS</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l01019">PropRoutine()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00604">_CONSOLE_ALLOC_MSG::PropRoutine</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00046">SET_CONSOLE_HANDLE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00596">_CONSOLE_ALLOC_MSG::Title</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00595">_CONSOLE_ALLOC_MSG::TitleLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>.
<p>
<pre class="fragment"><div>00670                    :
00671 
00672    Marshels <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parameters <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d5/d5/conmsg_8h.html#a236a199">ConsolepAlloc</a> command.
00673 
00674 Arguments:
00675 
00676    See <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html">CONSOLE_ALLOC_MSG</a> structure and <a class="code" href="../../d8/d9/dllinit_8c.html#a21">AllocConsole</a>.
00677 
00678 Return Value:
00679 
00680     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Success
00681 
00682     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - An error occured.
00683 
00684 --*/
00685 {
00686    <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00687    <a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html">PCONSOLE_ALLOC_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.AllocConsole;
00688    PCSR_CAPTURE_HEADER CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00689    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00690    <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> St;
00691 
00692    <span class="keywordflow">try</span> {
00693 
00694         a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o9">CtrlRoutine</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a10">CtrlRoutine</a>;
00695         a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o10">PropRoutine</a> = <a class="code" href="../../d8/d9/dllinit_8c.html#a9">PropRoutine</a>;
00696 
00697         <span class="comment">// Allocate 4 extra pointer sizes to compensate for any alignment done</span>
00698         <span class="comment">// by CsrCaptureMessageBuffer.</span>
00699 
00700         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 5,
00701                                                   dwTitleLength + dwDesktopLength + dwCurDirLength +
00702                                                   dwAppNameLength + <span class="keyword">sizeof</span>( <a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html">CONSOLE_INFO</a> ) + (4 * <span class="keyword">sizeof</span>(PVOID))
00703                                                  );
00704         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00705             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00706             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00707             leave;
00708         }
00709 
00710         <span class="comment">// Allocate the CONSOLE_INFO first so that it is aligned on a pointer</span>
00711         <span class="comment">// boundry.  This is necessary since NtWaitForMultipleObject expects</span>
00712         <span class="comment">// its arguments aligned on a handle boundry.</span>
00713 
00714         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00715                                  pConsoleInfo,
00716                                  <span class="keyword">sizeof</span>( CONSOLE_INFO ),
00717                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>
00718                                );
00719 
00720         a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o1">TitleLength</a> = dwTitleLength;
00721         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00722                                  lpTitle,
00723                                  dwTitleLength,
00724                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o2">Title</a>
00725                                );
00726 
00727         a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o3">DesktopLength</a> = dwDesktopLength;
00728         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00729                                  lpDesktop,
00730                                  dwDesktopLength,
00731                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o4">Desktop</a>
00732                                );
00733 
00734         a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o7">CurDirLength</a> = dwCurDirLength;
00735         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00736                                  lpCurDir,
00737                                  dwCurDirLength,
00738                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o8">CurDir</a>
00739                                );
00740 
00741         a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o5">AppNameLength</a> = dwAppNameLength;
00742         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00743                                  lpAppName,
00744                                  dwAppNameLength,
00745                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o6">AppName</a>
00746                                );
00747 
00748         <span class="comment">//</span>
00749         <span class="comment">// Connect to the server process</span>
00750         <span class="comment">//</span>
00751 
00752         <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00753                              CaptureBuffer,
00754                              CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00755                                                   ConsolepAlloc
00756                                                 ),
00757                              <span class="keyword">sizeof</span>( *a )
00758                            );
00759         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00760             <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00761             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00762             leave;
00763         }
00764 
00765         St = <a class="code" href="../../d1/d2/obwait_8c.html#a5">NtWaitForMultipleObjects</a>(NUMBER_OF_INITIALIZATION_EVENTS,
00766                                       a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>-&gt;<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o5">InitEvents</a>,
00767                                       WaitAny,
00768                                       FALSE,
00769                                       NULL
00770                                       );
00771         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(St)) {
00772            <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(St);
00773            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00774            leave;
00775         }
00776 
00777         <span class="comment">//The handles to be closed are events, so NtClose works fine.</span>
00778         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>-&gt;<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o5">InitEvents</a>[INITIALIZATION_SUCCEEDED]);
00779         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>-&gt;<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o5">InitEvents</a>[INITIALIZATION_FAILED]);
00780         <span class="keywordflow">if</span> (St != <a class="code" href="../../d5/d5/conmsg_8h.html#a4">INITIALIZATION_SUCCEEDED</a>) {
00781             <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00782             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00783             leave;
00784         }
00785         RtlCopyMemory(pConsoleInfo, a-&gt;<a class="code" href="../../d3/d9/struct__CONSOLE__ALLOC__MSG.html#o0">ConsoleInfo</a>, <span class="keyword">sizeof</span>(CONSOLE_INFO));
00786         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00787    }
00788    finally {
00789       <span class="keywordflow">if</span> (CaptureBuffer) {
00790          <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00791       }
00792    }
00793 
00794    <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00795 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="dllinit.c::ConDllInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ConDllInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DllHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Reason</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT Context&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW6432) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">470</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00103">_CONSOLE_API_CONNECTINFO::AppName</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00102">_CONSOLE_API_CONNECTINFO::AppNameLength</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00373">ConnectConsoleInternal()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00063">ConsoleApp()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00089">_CONSOLE_API_CONNECTINFO::ConsoleApp</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00042">_CONSOLE_INFO::ConsoleHandle</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00036">ConsoleIMERoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00088">_CONSOLE_API_CONNECTINFO::ConsoleInfo</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00033">CtrlRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00091">_CONSOLE_API_CONNECTINFO::CtrlRoutine</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00105">_CONSOLE_API_CONNECTINFO::CurDir</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00104">_CONSOLE_API_CONNECTINFO::CurDirLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00101">_CONSOLE_API_CONNECTINFO::Desktop</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00100">_CONSOLE_API_CONNECTINFO::DesktopLength</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00067">DllLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">InitExeName()</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00068">InitializeCtrlHandling()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00043">_CONSOLE_INFO::InputWaitHandle</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00030">InputWaitHandle</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00056">MAX_SESSION_PATH</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l01019">PropRoutine()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00092">_CONSOLE_API_CONNECTINFO::PropRoutine</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01210">RtlInitializeCriticalSection()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00057">SESSION_ROOT</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00046">SET_CONSOLE_HANDLE</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00346">SetTEBLangID()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">SetUpAppName()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00141">SetUpConsoleInfo()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00263">SetUpHandles()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00099">_CONSOLE_API_CONNECTINFO::Title</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00098">_CONSOLE_API_CONNECTINFO::TitleLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00090">_CONSOLE_API_CONNECTINFO::WindowVisible</a>.
<p>
<pre class="fragment"><div>00478                    :
00479 
00480     This function implements console dll initialization.
00481 
00482 Arguments:
00483 
00484     DllHandle - Not Used
00485 
00486     Context - Not Used
00487 
00488 Return Value:
00489 
00490     STATUS_SUCCESS
00491 
00492 --*/
00493 
00494 {
00495     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00496     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bStatus;
00497     <a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html">CONSOLE_API_CONNECTINFO</a> ConnectionInformation;
00498     BOOLEAN ServerProcess;
00499 
00500     ULONG SessionId = NtCurrentPeb()-&gt;SessionId;
00501     WCHAR szSessionDir[<a class="code" href="../../d8/d9/dllinit_8c.html#a1">MAX_SESSION_PATH</a>];
00502 
00503     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00504 
00505     <span class="comment">//</span>
00506     <span class="comment">// if we're attaching the DLL, we need to connect to the server.</span>
00507     <span class="comment">// if no console exists, we also need to create it and set up stdin,</span>
00508     <span class="comment">// stdout, and stderr.</span>
00509     <span class="comment">//</span>
00510 
00511     <span class="keywordflow">if</span> ( Reason == DLL_PROCESS_ATTACH ) {
00512 
00513         <span class="comment">//</span>
00514         <span class="comment">// Remember in the connect information if this app is a console</span>
00515         <span class="comment">// app. need to actually connect to the console server for windowed</span>
00516         <span class="comment">// apps so that we know NOT to do any special work during</span>
00517         <span class="comment">// ConsoleClientDisconnectRoutine(). Store ConsoleApp info in the</span>
00518         <span class="comment">// CSR managed per-process data.</span>
00519         <span class="comment">//</span>
00520 
00521         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;DllLock);
00522         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00523             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00524         }
00525 
00526         ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o3">CtrlRoutine</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a10">CtrlRoutine</a>;
00527         ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o4">PropRoutine</a> = <a class="code" href="../../d8/d9/dllinit_8c.html#a9">PropRoutine</a>;
00528 <span class="preprocessor">#if defined(FE_SB)</span>
00529 <span class="preprocessor"></span><span class="preprocessor">#if defined(FE_IME)</span>
00530 <span class="preprocessor"></span>        ConnectionInformation.ConsoleIMERoutine = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a11">ConsoleIMERoutine</a>;
00531 <span class="preprocessor">#endif // FE_IME</span>
00532 <span class="preprocessor"></span><span class="preprocessor">#endif // FE_SB</span>
00533 <span class="preprocessor"></span>
00534         ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o2">WindowVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00535         ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o1">ConsoleApp</a> = <a class="code" href="../../d8/d9/dllinit_8c.html#a11">ConsoleApp</a>();
00536         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> == (HANDLE)CONSOLE_DETACHED_PROCESS) {
00537             <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00538             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o1">ConsoleApp</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00539         }
00540         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> == (HANDLE)CONSOLE_NEW_CONSOLE) {
00541             <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00542         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> == (HANDLE)CONSOLE_CREATE_NO_WINDOW) {
00543             <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00544             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o2">WindowVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00545         }
00546         <span class="keywordflow">if</span> (!ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o1">ConsoleApp</a>) {
00547             <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00548         }
00549         ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o0">ConsoleInfo</a>.<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00550 
00551         <span class="comment">//</span>
00552         <span class="comment">// if no console exists, pass parameters for console creation</span>
00553         <span class="comment">//</span>
00554 
00555         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o1">ConsoleApp</a>) {
00556             <a class="code" href="../../d8/d9/dllinit_8c.html#a14">SetUpConsoleInfo</a>(TRUE,
00557                              &amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o5">TitleLength</a>,
00558                              ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o6">Title</a>,
00559                              &amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o7">DesktopLength</a>,
00560                              &amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o8">Desktop</a>,
00561                              &amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o0">ConsoleInfo</a>);
00562         } <span class="keywordflow">else</span> {
00563             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o5">TitleLength</a> = 0;
00564             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o7">DesktopLength</a> = 0;
00565         }
00566 
00567         <span class="keywordflow">if</span> (ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o1">ConsoleApp</a>) {
00568             <a class="code" href="../../d8/d9/dllinit_8c.html#a10">InitExeName</a>();
00569             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o11">CurDirLength</a> = <span class="keyword">sizeof</span>(ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o12">CurDir</a>);
00570             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o9">AppNameLength</a> = <span class="keyword">sizeof</span>(ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o10">AppName</a>);
00571             <a class="code" href="../../d8/d9/dllinit_8c.html#a12">SetUpAppName</a>(&amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o11">CurDirLength</a>,
00572                          ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o12">CurDir</a>,
00573                          &amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o9">AppNameLength</a>,
00574                          ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o10">AppName</a>);
00575         } <span class="keywordflow">else</span> {
00576             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o9">AppNameLength</a> = 0;
00577             ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o11">CurDirLength</a> = 0;
00578         }
00579 
00580         <span class="comment">//</span>
00581         <span class="comment">// initialize ctrl handling. This should work for all apps, so</span>
00582         <span class="comment">// initialize it before we check for ConsoleApp (which means the</span>
00583         <span class="comment">// console bit was set in the module header).</span>
00584         <span class="comment">//</span>
00585 
00586         <a class="code" href="../../d9/d0/ctrlc_8c.html#a11">InitializeCtrlHandling</a>();
00587 
00588         <span class="comment">//</span>
00589         <span class="comment">// Connect to the server process</span>
00590         <span class="comment">//</span>
00591 
00592         <span class="keywordflow">if</span> ( SessionId == 0 ) {
00593            <span class="comment">//</span>
00594            <span class="comment">// Console Session</span>
00595            <span class="comment">//</span>
00596            wcscpy(szSessionDir, WINSS_OBJECT_DIRECTORY_NAME);
00597         } <span class="keywordflow">else</span> {
00598            swprintf(szSessionDir,L<span class="stringliteral">"%ws\\%ld%ws"</span>,SESSION_ROOT,SessionId,WINSS_OBJECT_DIRECTORY_NAME);
00599         }
00600 
00601         bStatus = <a class="code" href="../../d8/d9/dllinit_8c.html#a18">ConnectConsoleInternal</a>(szSessionDir,
00602                                          &amp;ConnectionInformation,
00603                                          &amp;ServerProcess
00604                                          );
00605 
00606         <span class="keywordflow">if</span> (!bStatus) {
00607            <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00608         }
00609 
00610         <span class="comment">//</span>
00611         <span class="comment">// we return success although no console api can be called because</span>
00612         <span class="comment">// loading shouldn't fail.  we'll fail the api calls later.</span>
00613         <span class="comment">//</span>
00614         <span class="keywordflow">if</span> (ServerProcess) {
00615            <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00616         }
00617 
00618         <span class="comment">//</span>
00619         <span class="comment">// if this is not a console app, return success - nothing else to do.</span>
00620         <span class="comment">//</span>
00621 
00622         <span class="keywordflow">if</span> (!ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o1">ConsoleApp</a>) {
00623            <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00624         }
00625 
00626         <span class="comment">//</span>
00627         <span class="comment">// if console was just created, fill in peb values</span>
00628         <span class="comment">//</span>
00629 
00630         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00631             <a class="code" href="../../d8/d9/dllinit_8c.html#a15">SetUpHandles</a>(&amp;ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o0">ConsoleInfo</a>
00632                         );
00633         }
00634 
00635         <a class="code" href="../../d8/d9/dllinit_8c.html#a3">InputWaitHandle</a> = ConnectionInformation.<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html#o0">ConsoleInfo</a>.<a class="code" href="../../d0/d3/struct__CONSOLE__INFO.html#o1">InputWaitHandle</a>;
00636 
00637         <a class="code" href="../../d8/d9/dllinit_8c.html#a17">SetTEBLangID</a>();
00638 
00639     }
00640     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Reason == DLL_THREAD_ATTACH ) {
00641         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/dllinit_8c.html#a11">ConsoleApp</a>()) {
00642             <a class="code" href="../../d8/d9/dllinit_8c.html#a17">SetTEBLangID</a>();
00643         }
00644     }
00645     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00646     UNREFERENCED_PARAMETER(DllHandle);
00647     UNREFERENCED_PARAMETER(Context);
00648 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="dllinit.c::ConnectConsoleInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY ConnectConsoleInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pObjectDirectory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html">PCONSOLE_API_CONNECTINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pConnectInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>pServerProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00373">373</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00031">CsrClientConnectToServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00034">INITIALIZATION_FAILED</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00033">INITIALIZATION_SUCCEEDED</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00035">NUMBER_OF_INITIALIZATION_EVENTS</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00046">SET_CONSOLE_HANDLE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>00379                    :
00380 
00381     Helper function <span class="keywordflow">for</span> establishing a connection with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console server.
00382     Waits <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server to signal completion.
00383 
00384 Arguments:
00385 
00386     pObjectDirectory -  Supplies a null terminated string that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same
00387         as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ObjectDirectory= argument passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CSRSS
00388         program.
00389 
00390     pConnectInfo - Supplies and recieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> connection information.
00391 
00392     pServerProcess - Recieves <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a server process.
00393 
00394 Return Value:
00395 
00396     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Success
00397 
00398     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - An error occured.
00399 
00400 --*/
00401 {
00402 
00403    <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00404    ULONG ConnectionInformationLength;
00405 
00406    ConnectionInformationLength = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d9/struct__CONSOLE__API__CONNECTINFO.html">CONSOLE_API_CONNECTINFO</a>);
00407 
00408    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d9/wow64csr_8c.html#a0">CsrClientConnectToServer</a>( pObjectDirectory,
00409                                       CONSRV_SERVERDLL_INDEX,
00410                                       NULL,
00411                                       pConnectInfo,
00412                                       &amp;ConnectionInformationLength,
00413                                       pServerProcess
00414                                     );
00415 
00416    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00417        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00418    }
00419 
00420    <span class="comment">//</span>
00421    <span class="comment">// we return success although no console api can be called because</span>
00422    <span class="comment">// loading shouldn't fail.  we'll fail the api calls later.</span>
00423    <span class="comment">//</span>
00424 
00425    <span class="keywordflow">if</span> (*pServerProcess) {
00426        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00427    }
00428 
00429 
00430    <span class="comment">//</span>
00431    <span class="comment">// if this is not a console app, return success - nothing else to do.</span>
00432    <span class="comment">//</span>
00433 
00434    <span class="keywordflow">if</span> (!pConnectInfo-&gt;ConsoleApp) {
00435        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00436    }
00437 
00438    <span class="comment">//</span>
00439    <span class="comment">// wait for initialization to complete.  we have to use the NT</span>
00440    <span class="comment">// wait because the heap hasn't been initialized yet.</span>
00441    <span class="comment">//</span>
00442 
00443    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a5">NtWaitForMultipleObjects</a>(NUMBER_OF_INITIALIZATION_EVENTS,
00444                                         pConnectInfo-&gt;ConsoleInfo.InitEvents,
00445                                         WaitAny,
00446                                         FALSE,
00447                                         NULL
00448                                         );
00449 
00450    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00451        <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(Status);
00452        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00453    }
00454 
00455    <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(pConnectInfo-&gt;ConsoleInfo.InitEvents[INITIALIZATION_SUCCEEDED]);
00456    <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(pConnectInfo-&gt;ConsoleInfo.InitEvents[INITIALIZATION_FAILED]);
00457    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d5/d5/conmsg_8h.html#a4">INITIALIZATION_SUCCEEDED</a>) {
00458        <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00459        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00460    }
00461 
00462    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00463 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="dllinit.c::ConsoleApp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ConsoleApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00063">63</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00029">RtlImageNtHeader()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>00070           :
00071 
00072     none.
00073 
00074 Return Value:
00075 
00076     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> console app.
00077 
00078 --*/
00079 
00080 {
00081     PIMAGE_NT_HEADERS NtHeaders;
00082 
00083     NtHeaders = <a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(GetModuleHandle(NULL));
00084     <span class="keywordflow">return</span> (NtHeaders-&gt;OptionalHeader.Subsystem == IMAGE_SUBSYSTEM_WINDOWS_CUI) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00085 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="dllinit.c::CtrlRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CtrlRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpThreadParameter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00093">93</a> of file <a class="el" href="../../d0/d0/ctrlc_8c-source.html">ctrlc.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00043">DefaultHandler()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00032">HandlerList</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00030">HandlerListLength</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00037">IGNORE_CTRL_C</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00039">LastConsoleEventActive</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00068">LockDll</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00034">NUMBER_OF_CTRL_EVENTS</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00466">RtlRaiseException()</a>, <a class="el" href="../../d0/d0/ctrlc_8c-source.html#l00035">SYSTEM_CLOSE_EVENT</a>, and <a class="el" href="../../d7/d3/condll_8h-source.html#l00069">UnlockDll</a>.
<p>
<pre class="fragment"><div>00099                    :
00100 
00101     This thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created when ctrl-<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> or ctrl-<span class="keywordflow">break</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> entered,
00102     or when close <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> selected.  <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> calls <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate handlers.
00103 
00104 Arguments:
00105 
00106     lpThreadParameter - what <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of event happened.
00107 
00108 Return Value:
00109 
00110     STATUS_SUCCESS
00111 
00112 --*/
00113 
00114 {
00115     ULONG i;
00116     ULONG EventNumber,OriginalEventNumber;
00117     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fNoExit;
00118     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExitCode;
00119     EXCEPTION_RECORD ExceptionRecord;
00120 
00121     SetThreadPriority(NtCurrentThread(), THREAD_PRIORITY_HIGHEST);
00122     OriginalEventNumber = EventNumber = PtrToUlong(lpThreadParameter);
00123 
00124     <span class="comment">//</span>
00125     <span class="comment">// If this bit is set, it means we don't want to cause this process</span>
00126     <span class="comment">// to exit itself if it is a logoff or shutdown event.</span>
00127     <span class="comment">//</span>
00128     fNoExit = 0x80000000 &amp; EventNumber;
00129     EventNumber &amp;= ~0x80000000;
00130 
00131     <span class="comment">//</span>
00132     <span class="comment">// the ctrl_close event is set when the user selects the window</span>
00133     <span class="comment">// close option from the system menu, or EndTask, or Settings-Terminate.</span>
00134     <span class="comment">// the system close event is used when another ctrl-thread times out.</span>
00135     <span class="comment">//</span>
00136 
00137     <span class="keywordflow">switch</span> (EventNumber) {
00138     <span class="keywordflow">default</span>:
00139         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (EventNumber &lt; NUMBER_OF_CTRL_EVENTS);
00140         <span class="keywordflow">if</span> (EventNumber &gt;= <a class="code" href="../../d9/d0/ctrlc_8c.html#a2">NUMBER_OF_CTRL_EVENTS</a>)
00141             <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)STATUS_UNSUCCESSFUL;
00142         <span class="keywordflow">break</span>;
00143 
00144     <span class="keywordflow">case</span> CTRL_C_EVENT:
00145     <span class="keywordflow">case</span> CTRL_BREAK_EVENT:
00146         <span class="comment">//</span>
00147         <span class="comment">// If the process is being debugged, give the debugger</span>
00148         <span class="comment">// a shot. If the debugger handles the exception, then</span>
00149         <span class="comment">// go back and wait.</span>
00150         <span class="comment">//</span>
00151 
00152         <span class="keywordflow">if</span> (!IsDebuggerPresent())
00153             <span class="keywordflow">break</span>;
00154 
00155         <span class="keywordflow">if</span> ( EventNumber == CTRL_C_EVENT ) {
00156             ExceptionRecord.ExceptionCode = DBG_CONTROL_C;
00157             }
00158         <span class="keywordflow">else</span> {
00159             ExceptionRecord.ExceptionCode = DBG_CONTROL_BREAK;
00160             }
00161         ExceptionRecord.ExceptionFlags = 0;
00162         ExceptionRecord.ExceptionRecord = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00163         ExceptionRecord.ExceptionAddress = (PVOID)<a class="code" href="../../d9/d0/ctrlc_8c.html#a10">DefaultHandler</a>;
00164         ExceptionRecord.NumberParameters = 0;
00165 
00166         <span class="keywordflow">try</span> {
00167             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00168         } except (EXCEPTION_EXECUTE_HANDLER) {
00169             <a class="code" href="../../d6/d4/condll_8h.html#a9">LockDll</a>();
00170             <span class="keywordflow">try</span> {
00171                 <span class="keywordflow">if</span> (EventNumber != CTRL_C_EVENT ||
00172                         NtCurrentPeb()-&gt;ProcessParameters-&gt;ConsoleFlags != <a class="code" href="../../d9/d0/ctrlc_8c.html#a4">IGNORE_CTRL_C</a>) {
00173                     <span class="keywordflow">for</span> (i=<a class="code" href="../../d9/d0/ctrlc_8c.html#a6">HandlerListLength</a>;i&gt;0;i--) {
00174                         <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d0/ctrlc_8c.html#a8">HandlerList</a>[i-1])(EventNumber)) {
00175                             <span class="keywordflow">break</span>;
00176                         }
00177                     }
00178                 }
00179             } finally {
00180                 <a class="code" href="../../d6/d4/condll_8h.html#a10">UnlockDll</a>();
00181             }
00182         }
00183         ExitThread(0);
00184         <span class="keywordflow">break</span>;
00185 
00186     <span class="keywordflow">case</span> <a class="code" href="../../d9/d0/ctrlc_8c.html#a3">SYSTEM_CLOSE_EVENT</a>:
00187         ExitProcess((DWORD)CONTROL_C_EXIT);
00188         <span class="keywordflow">break</span>;
00189 
00190     <span class="keywordflow">case</span> SYSTEM_ROOT_CONSOLE_EVENT:
00191         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d0/ctrlc_8c.html#a9">LastConsoleEventActive</a>)
00192             ExitThread(0);
00193         <span class="keywordflow">break</span>;
00194 
00195     <span class="keywordflow">case</span> CTRL_CLOSE_EVENT:
00196     <span class="keywordflow">case</span> CTRL_LOGOFF_EVENT:
00197     <span class="keywordflow">case</span> CTRL_SHUTDOWN_EVENT:
00198         <span class="comment">//if (LastConsoleEventActive)</span>
00199             <span class="comment">//EventNumber = SYSTEM_ROOT_CONSOLE_EVENT;</span>
00200         <span class="keywordflow">break</span>;
00201     }
00202 
00203     <a class="code" href="../../d6/d4/condll_8h.html#a9">LockDll</a>();
00204     dwExitCode = 0;
00205     <span class="keywordflow">try</span> {
00206         <span class="keywordflow">if</span> (EventNumber != CTRL_C_EVENT ||
00207                 NtCurrentPeb()-&gt;ProcessParameters-&gt;ConsoleFlags != <a class="code" href="../../d9/d0/ctrlc_8c.html#a4">IGNORE_CTRL_C</a>) {
00208             <span class="keywordflow">for</span> (i=<a class="code" href="../../d9/d0/ctrlc_8c.html#a6">HandlerListLength</a>;i&gt;0;i--) {
00209 
00210                 <span class="comment">//</span>
00211                 <span class="comment">// Don't call the last handler (the default one which calls</span>
00212                 <span class="comment">// ExitProcess() if this process isn't supposed to exit (system</span>
00213                 <span class="comment">// process are not supposed to exit because of shutdown or</span>
00214                 <span class="comment">// logoff event notification).</span>
00215                 <span class="comment">//</span>
00216 
00217                 <span class="keywordflow">if</span> ((i-1) == 0 &amp;&amp; fNoExit) {
00218                     <span class="keywordflow">if</span> (EventNumber == CTRL_LOGOFF_EVENT ||
00219                         EventNumber == CTRL_SHUTDOWN_EVENT) {
00220                         <span class="keywordflow">break</span>;
00221                     }
00222                 }
00223 
00224                 <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d0/ctrlc_8c.html#a8">HandlerList</a>[i-1])(EventNumber)) {
00225                     <span class="keywordflow">switch</span> (EventNumber) {
00226                     <span class="keywordflow">case</span> CTRL_CLOSE_EVENT:
00227                     <span class="keywordflow">case</span> CTRL_LOGOFF_EVENT:
00228                     <span class="keywordflow">case</span> CTRL_SHUTDOWN_EVENT:
00229                     <span class="keywordflow">case</span> SYSTEM_ROOT_CONSOLE_EVENT:
00230                         dwExitCode = OriginalEventNumber;
00231                         <span class="keywordflow">break</span>;
00232                     }
00233                     <span class="keywordflow">break</span>;
00234                 }
00235             }
00236         }
00237     } finally {
00238         <a class="code" href="../../d6/d4/condll_8h.html#a10">UnlockDll</a>();
00239     }
00240     ExitThread(dwExitCode);
00241     <span class="keywordflow">return</span> STATUS_SUCCESS;
00242 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="dllinit.c::FreeConsole" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY FreeConsole           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW6432) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00979">979</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00922">FreeConsoleInternal()</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00030">InputWaitHandle</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00068">LockDll</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d3/condll_8h-source.html#l00069">UnlockDll</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/talloc_8c-source.html#l00106">main()</a>.
<p>
<pre class="fragment"><div>00983                    :
00984 
00985     This API frees <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling process's console.
00986 
00987 Arguments:
00988 
00989     none.
00990 
00991 Return Value:
00992 
00993     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - function was successful.
00994 
00995 --*/
00996 
00997 {
00998     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00999 
01000     <a class="code" href="../../d6/d4/condll_8h.html#a9">LockDll</a>();
01001     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01002         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
01003         Success = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01004     } <span class="keywordflow">else</span> {
01005 
01006         Success = <a class="code" href="../../d8/d9/dllinit_8c.html#a22">FreeConsoleInternal</a>();
01007 
01008         <span class="keywordflow">if</span> (Success) {
01009            CloseHandle(InputWaitHandle);
01010         }
01011 
01012     }
01013     <a class="code" href="../../d6/d4/condll_8h.html#a10">UnlockDll</a>();
01014     <span class="keywordflow">return</span> Success;
01015 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="dllinit.c::FreeConsoleInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY FreeConsoleInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00922">922</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00608">_CONSOLE_FREE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a200">ConsolepFree</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00046">SET_CONSOLE_HANDLE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00979">FreeConsole()</a>.
<p>
<pre class="fragment"><div>00927                    :
00928 
00929    Marshels <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parameters <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d5/d5/conmsg_8h.html#a236a200">ConsolepFree</a> command.
00930 
00931 Arguments:
00932 
00933    See <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d0/struct__CONSOLE__FREE__MSG.html">CONSOLE_FREE_MSG</a> structure and <a class="code" href="../../d8/d9/dllinit_8c.html#a23">FreeConsole</a>.
00934 
00935 Return Value:
00936 
00937     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Success
00938 
00939     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - An error occured.
00940 
00941 --*/
00942 {
00943 
00944    <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00945    <a class="code" href="../../d4/d0/struct__CONSOLE__FREE__MSG.html">PCONSOLE_FREE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.FreeConsole;
00946 
00947    a-&gt;<a class="code" href="../../d4/d0/struct__CONSOLE__FREE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00948 
00949    <span class="comment">//</span>
00950    <span class="comment">// Connect to the server process</span>
00951    <span class="comment">//</span>
00952 
00953    <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00954                         NULL,
00955                         CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00956                                              ConsolepFree
00957                                            ),
00958                         <span class="keyword">sizeof</span>( *a )
00959                       );
00960 
00961    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00962       <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00963       <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00964 
00965    } <span class="keywordflow">else</span> {
00966 
00967       <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(NULL);
00968       <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00969    }
00970 
00971 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="dllinit.c::GetConsoleLangId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetConsoleLangId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT LANGID *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpLangId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00296">296</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00824">_CONSOLE_LANGID_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a234">ConsolepGetLangId</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
<pre class="fragment"><div>00302           :
00303 
00304     lpLangId - Supplies a pointer to a LANGID in which to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Language <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
00305 
00306 Return Value:
00307 
00308     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00309 
00310     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00311         <span class="keyword">using</span> GetLastError.
00312 
00313 
00314 --*/
00315 
00316 {
00317     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00318     <a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html">PCONSOLE_LANGID_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleLangId;
00319 
00320     a-&gt;<a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00321     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00322                          NULL,
00323                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00324                                               ConsolepGetLangId
00325                                             ),
00326                          <span class="keyword">sizeof</span>( *a )
00327                        );
00328     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00329         <span class="keywordflow">try</span> {
00330             *lpLangId = a-&gt;<a class="code" href="../../d4/d3/struct__CONSOLE__LANGID__MSG.html#o1">LangId</a>;
00331         } except( EXCEPTION_EXECUTE_HANDLER ) {
00332             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00333         }
00334         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00335     } <span class="keywordflow">else</span> {
00336         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337     }
00338 
00339 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="dllinit.c::InitExeName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitExeName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">39</a> of file <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html">client/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00026">CONSOLE_NAME_PATH_TERMINATOR</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00033">ExeNameBuffer</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00032">ExeNameCriticalSection</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00031">ExeNameInitialized</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00034">ExeNameLength</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01210">RtlInitializeCriticalSection()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00035">StartDirBuffer</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00036">StartDirLength</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>00040 {
00041 
00042     PPEB Peb;
00043     PLDR_DATA_TABLE_ENTRY ImageEntry;
00044 
00045     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">ExeNameInitialized</a>) {
00046         <span class="keywordflow">return</span>;
00047     }
00048 
00049     <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;ExeNameCriticalSection);
00050     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">ExeNameInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00051     Peb = NtCurrentPeb();
00052     ImageEntry = (PLDR_DATA_TABLE_ENTRY)Peb-&gt;Ldr-&gt;InLoadOrderModuleList.Flink;
00053     ImageEntry = CONTAINING_RECORD(ImageEntry, LDR_DATA_TABLE_ENTRY, InLoadOrderLinks);
00054     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> = ImageEntry-&gt;BaseDllName.Length/<span class="keyword">sizeof</span>(WCHAR);
00055     RtlCopyMemory(ExeNameBuffer,
00056            ImageEntry-&gt;BaseDllName.Buffer,
00057            ImageEntry-&gt;BaseDllName.Length
00058           );
00059     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>[<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>] = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a1">CONSOLE_NAME_PATH_TERMINATOR</a>;
00060     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a> = Peb-&gt;ProcessParameters-&gt;CurrentDirectory.DosPath.Length/<span class="keyword">sizeof</span>(WCHAR);
00061     RtlCopyMemory(StartDirBuffer,
00062            Peb-&gt;ProcessParameters-&gt;CurrentDirectory.DosPath.Buffer,
00063            Peb-&gt;ProcessParameters-&gt;CurrentDirectory.DosPath.Length
00064           );
00065     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a7">StartDirBuffer</a>[<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a>] = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a1">CONSOLE_NAME_PATH_TERMINATOR</a>;
00066 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="dllinit.c::ParseReserved" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG ParseReserved           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">WCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>pchReserved</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>pchFind</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00111">111</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00225">RtlUnicodeStringToInteger()</a>.
<p>
<pre class="fragment"><div>00115 {
00116     ULONG dw;
00117     WCHAR *pch, *pchT, ch;
00118     UNICODE_STRING uString;
00119 
00120     dw = 0;
00121     <span class="keywordflow">if</span> ((pch = wcsstr(pchReserved, pchFind)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00122         pch += lstrlenW(pchFind);
00123 
00124         pchT = pch;
00125         <span class="keywordflow">while</span> (*pchT &gt;= <span class="charliteral">'0'</span> &amp;&amp; *pchT &lt;= <span class="charliteral">'9'</span>)
00126             pchT++;
00127 
00128         ch = *pchT;
00129         *pchT = 0;
00130         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;uString, pch);
00131         *pchT = ch;
00132 
00133         <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>(&amp;uString, 0, &amp;dw);
00134     }
00135 
00136     <span class="keywordflow">return</span> dw;
00137 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="dllinit.c::PropRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> PropRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpThreadParameter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l01019">1019</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00656">AllocConsoleInternal()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>01025                    :
01026 
01027     This thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user tries to change console
01028     properties from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system menu. It invokes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> panel
01029     applet.
01030 
01031 Arguments:
01032 
01033     lpThreadParameter - not used.
01034 
01035 Return Value:
01036 
01037     STATUS_SUCCESS - function was successful
01038 
01039 --*/
01040 
01041 {
01042     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01043     HANDLE hLibrary;
01044     APPLET_PROC pfnCplApplet;
01045     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fInPropRoutine = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01046 
01047     <span class="comment">//</span>
01048     <span class="comment">// Prevent the user from launching multiple applets attached</span>
01049     <span class="comment">// to a single console</span>
01050     <span class="comment">//</span>
01051 
01052     <span class="keywordflow">if</span> (fInPropRoutine) {
01053         <span class="keywordflow">if</span> (lpThreadParameter) {
01054             CloseHandle((HANDLE)lpThreadParameter);
01055         }
01056         <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
01057     }
01058 
01059     fInPropRoutine = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01060     hLibrary = LoadLibraryW(L<span class="stringliteral">"CONSOLE.DLL"</span>);
01061     <span class="keywordflow">if</span> (hLibrary != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01062         pfnCplApplet = (APPLET_PROC)GetProcAddress(hLibrary, <span class="stringliteral">"CPlApplet"</span>);
01063         <span class="keywordflow">if</span> (pfnCplApplet != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01064             (*pfnCplApplet)((HWND)lpThreadParameter, CPL_INIT, 0, 0);
01065             (*pfnCplApplet)((HWND)lpThreadParameter, CPL_DBLCLK, 0, 0);
01066             (*pfnCplApplet)((HWND)lpThreadParameter, CPL_EXIT, 0, 0);
01067             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01068         } <span class="keywordflow">else</span> {
01069             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
01070         }
01071         FreeLibrary(hLibrary);
01072     } <span class="keywordflow">else</span> {
01073         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
01074     }
01075     fInPropRoutine = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01076 
01077     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01078 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="dllinit.c::SetTEBLangID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetTEBLangID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW6432) 
<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00346">346</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">GetConsoleLangId()</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>, and <a class="el" href="../../d9/d3/ntcon_2client_2getset_8c-source.html#l01501">SetConsoleOutputCP()</a>.
<p>
<pre class="fragment"><div>00359 {
00360     LANGID LangId;
00361 
00362     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d5/srvinit_8c.html#a45">GetConsoleLangId</a>(&amp;LangId)) {
00363         SetThreadLocale( MAKELCID(LangId, SORT_DEFAULT) );
00364     }
00365 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="dllinit.c::SetUpAppName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetUpAppName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>CurDirLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>CurDir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>AppNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>AppName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">89</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00033">ExeNameBuffer</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00034">ExeNameLength</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00035">StartDirBuffer</a>, and <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00036">StartDirLength</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>00095 {
00096     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Length;
00097 
00098     *CurDirLength -= <span class="keyword">sizeof</span>(WCHAR);
00099     Length = (<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a>*<span class="keyword">sizeof</span>(WCHAR)) &gt; *CurDirLength ? *CurDirLength : (<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00100     RtlCopyMemory(CurDir,StartDirBuffer,Length+<span class="keyword">sizeof</span>(WCHAR));
00101     *CurDirLength = Length + <span class="keyword">sizeof</span>(WCHAR);   <span class="comment">// add terminating NULL</span>
00102 
00103     *AppNameLength -= <span class="keyword">sizeof</span>(WCHAR);
00104     Length = (<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>*<span class="keyword">sizeof</span>(WCHAR)) &gt; *AppNameLength ? *AppNameLength : (<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00105     RtlCopyMemory(AppName,ExeNameBuffer,Length+<span class="keyword">sizeof</span>(WCHAR));
00106     *AppNameLength = Length + <span class="keyword">sizeof</span>(WCHAR);   <span class="comment">// add terminating NULL</span>
00107 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="dllinit.c::SetUpConsoleInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetUpConsoleInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>DllInit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>TitleLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR Title&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>DesktopLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR *Desktop&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ConsoleInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00141">141</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00028">DEFAULT_WINDOW_TITLE</a>, <a class="el" href="../../d4/d5/kdexts_8c-source.html#l00068">DllInit()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00030">MAX_TITLE_LENGTH</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01474">ParseReserved()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>00155           :
00156 
00157     ConsoleInfo - pointer to structure to fill in.
00158 
00159 Return Value:
00160 
00161     none.
00162 
00163 --*/
00164 
00165 {
00166     STARTUPINFOW StartupInfo;
00167     HANDLE h;
00168     <span class="keywordtype">int</span> <span class="keywordtype">id</span>;
00169     HANDLE <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a4">ghInstance</a>;
00170     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
00171 
00172 
00173     GetStartupInfoW(&amp;StartupInfo);
00174     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a4">ghInstance</a> = (HANDLE)((PVOID)NtCurrentPeb()-&gt;ImageBaseAddress );
00175 
00176     <span class="comment">// these will eventually be filled in using menu input</span>
00177 
00178     ConsoleInfo-&gt;nFont = 0;
00179     ConsoleInfo-&gt;nInputBufferSize = 0;
00180     ConsoleInfo-&gt;hIcon = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00181     ConsoleInfo-&gt;hSmIcon = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00182     ConsoleInfo-&gt;iIconId = 0;
00183     ConsoleInfo-&gt;dwStartupFlags = StartupInfo.dwFlags;
00184 <span class="preprocessor">#if defined(FE_SB)</span>
00185 <span class="preprocessor"></span>    ConsoleInfo-&gt;uCodePage = GetOEMCP();
00186 <span class="preprocessor">#endif</span>
00187 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (StartupInfo.lpTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00188         StartupInfo.lpTitle = <a class="code" href="../../d8/d9/dllinit_8c.html#a0">DEFAULT_WINDOW_TITLE</a>;
00189     }
00190 
00191     <span class="comment">//</span>
00192     <span class="comment">// if the desktop name was specified, set up the pointers.</span>
00193     <span class="comment">//</span>
00194 
00195     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/kdexts_8c.html#a14">DllInit</a> &amp;&amp; Desktop != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00196             StartupInfo.lpDesktop != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; *StartupInfo.lpDesktop != 0) {
00197         *DesktopLength = (lstrlenW(StartupInfo.lpDesktop) + 1) * <span class="keyword">sizeof</span>(WCHAR);
00198         *Desktop = StartupInfo.lpDesktop;
00199     } <span class="keywordflow">else</span> {
00200         *DesktopLength = 0;
00201         <span class="keywordflow">if</span> (Desktop != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00202             *Desktop = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00203     }
00204 
00205     <span class="comment">// Nope, do normal initialization (TitleLength is in BYTES, not CHARS!)</span>
00206     *TitleLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((lstrlenW(StartupInfo.lpTitle)+1)*<span class="keyword">sizeof</span>(WCHAR));
00207     *TitleLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(*TitleLength,MAX_TITLE_LENGTH));
00208     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/kdexts_8c.html#a14">DllInit</a>) {
00209         RtlCopyMemory(Title,StartupInfo.lpTitle,*TitleLength);
00210         <span class="comment">// ensure the title is NULL terminated</span>
00211         <span class="keywordflow">if</span> (*TitleLength == <a class="code" href="../../d5/d5/conmsg_8h.html#a2">MAX_TITLE_LENGTH</a>)
00212             Title[ (<a class="code" href="../../d5/d5/conmsg_8h.html#a2">MAX_TITLE_LENGTH</a>/<span class="keyword">sizeof</span>(WCHAR)) - 1 ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00213     }
00214 
00215     <span class="keywordflow">if</span> (StartupInfo.dwFlags &amp; STARTF_USESHOWWINDOW) {
00216         ConsoleInfo-&gt;wShowWindow = StartupInfo.wShowWindow;
00217     }
00218     <span class="keywordflow">if</span> (StartupInfo.dwFlags &amp; STARTF_USEFILLATTRIBUTE) {
00219         ConsoleInfo-&gt;wFillAttribute = (WORD)StartupInfo.dwFillAttribute;
00220     }
00221     <span class="keywordflow">if</span> (StartupInfo.dwFlags &amp; STARTF_USECOUNTCHARS) {
00222         ConsoleInfo-&gt;dwScreenBufferSize.X = (WORD)(StartupInfo.dwXCountChars);
00223         ConsoleInfo-&gt;dwScreenBufferSize.Y = (WORD)(StartupInfo.dwYCountChars);
00224     }
00225     <span class="keywordflow">if</span> (StartupInfo.dwFlags &amp; STARTF_USESIZE) {
00226         ConsoleInfo-&gt;dwWindowSize.X = (WORD)(StartupInfo.dwXSize);
00227         ConsoleInfo-&gt;dwWindowSize.Y = (WORD)(StartupInfo.dwYSize);
00228     }
00229     <span class="keywordflow">if</span> (StartupInfo.dwFlags &amp; STARTF_USEPOSITION) {
00230         ConsoleInfo-&gt;dwWindowOrigin.X = (WORD)(StartupInfo.dwX);
00231         ConsoleInfo-&gt;dwWindowOrigin.Y = (WORD)(StartupInfo.dwY);
00232     }
00233 
00234     <span class="comment">//</span>
00235     <span class="comment">// Grab information passed on lpReserved line...</span>
00236     <span class="comment">//</span>
00237 
00238     <span class="keywordflow">if</span> (StartupInfo.lpReserved != 0) {
00239 
00240         <span class="comment">//</span>
00241         <span class="comment">// the program manager has an icon for the exe.  store the</span>
00242         <span class="comment">// index in the iIconId field.</span>
00243         <span class="comment">//</span>
00244 
00245         ConsoleInfo-&gt;iIconId = <a class="code" href="../../d6/d3/queue_8c.html#a43">ParseReserved</a>(StartupInfo.lpReserved, L<span class="stringliteral">"dde."</span>);
00246 
00247         <span class="comment">//</span>
00248         <span class="comment">// The new "Chicago" way of doing things is to pass the hotkey in the</span>
00249         <span class="comment">// hStdInput field and set the STARTF_USEHOTKEY flag.  So, if this is</span>
00250         <span class="comment">// specified, we get the hotkey from there instead</span>
00251         <span class="comment">//</span>
00252 
00253         <span class="keywordflow">if</span> (StartupInfo.dwFlags &amp; STARTF_USEHOTKEY) {
00254             ConsoleInfo-&gt;dwHotKey = HandleToUlong(StartupInfo.hStdInput);
00255         } <span class="keywordflow">else</span> {
00256             ConsoleInfo-&gt;dwHotKey = <a class="code" href="../../d6/d3/queue_8c.html#a43">ParseReserved</a>(StartupInfo.lpReserved, L<span class="stringliteral">"hotkey."</span>);
00257         }
00258     }
00259 
00260 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="dllinit.c::SetUpHandles" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetUpHandles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__CONSOLE__INFO.html">PCONSOLE_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ConsoleInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00263">263</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
References <a class="el" href="../../d7/d3/condll_8h-source.html#l00046">SET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/rdwr_8c-source.html#l00047">STD_ERROR_HANDLE</a>, <a class="el" href="../../d6/d4/rdwr_8c-source.html#l00045">STD_INPUT_HANDLE</a>, and <a class="el" href="../../d6/d4/rdwr_8c-source.html#l00046">STD_OUTPUT_HANDLE</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>.
<p>
<pre class="fragment"><div>00271           :
00272 
00273     ConsoleInfo - pointer to structure containing handles.
00274 
00275 Return Value:
00276 
00277     none.
00278 
00279 --*/
00280 
00281 {
00282     <a class="code" href="../../d6/d4/condll_8h.html#a0">SET_CONSOLE_HANDLE</a>(ConsoleInfo-&gt;ConsoleHandle);
00283     <span class="keywordflow">if</span> (!(ConsoleInfo-&gt;dwStartupFlags &amp; STARTF_USESTDHANDLES)) {
00284         SetStdHandle(STD_INPUT_HANDLE,ConsoleInfo-&gt;StdIn);
00285         SetStdHandle(STD_OUTPUT_HANDLE,ConsoleInfo-&gt;StdOut);
00286         SetStdHandle(STD_ERROR_HANDLE,ConsoleInfo-&gt;StdErr);
00287     }
00288 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="dllinit.c::ExeNameBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d8/d9/dllinit_8c.html#a4">ExeNameBuffer</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00031">31</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00716">GetConsoleAliasExesA()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00647">GetConsoleAliasExesInternal()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00704">GetConsoleAliasExesW()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l01288">GetConsoleInputExeNameW()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00070">GetCurrentExeName()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">InitExeName()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l01337">SetConsoleInputExeNameW()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">SetUpAppName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="dllinit.c::ExeNameLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d8/d9/dllinit_8c.html#a5">ExeNameLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00032">32</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l01288">GetConsoleInputExeNameW()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00070">GetCurrentExeName()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">InitExeName()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00349">ReadConsoleA()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00191">ReadConsoleInternal()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00377">ReadConsoleW()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l01337">SetConsoleInputExeNameW()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">SetUpAppName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="dllinit.c::InputWaitHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d9/d6/client_2stream_8c.html#a0">InputWaitHandle</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00030">30</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00979">FreeConsole()</a>, and <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00033">GetConsoleInputWaitHandle()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="dllinit.c::StartDirBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d8/d9/dllinit_8c.html#a6">StartDirBuffer</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00033">33</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">InitExeName()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">SetUpAppName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="dllinit.c::StartDirLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d8/d9/dllinit_8c.html#a7">StartDirLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00034">34</a> of file <a class="el" href="../../d9/d8/dllinit_8c-source.html">dllinit.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00039">InitExeName()</a>, and <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00089">SetUpAppName()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
