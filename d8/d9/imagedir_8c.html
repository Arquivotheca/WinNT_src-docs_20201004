<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: imagedir.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>imagedir.c File Reference</h1><code>#include "<a class="el" href="../../d6/d8/ntrtlp_8h-source.html">ntrtlp.h</a>"</code><br>

<p>
<a href="../../d9/d8/imagedir_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PIMAGE_NT_HEADERS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a> (IN PVOID Base)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PIMAGE_SECTION_HEADER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a1">RtlSectionTableFromVirtualAddress</a> (IN PIMAGE_NT_HEADERS NtHeaders, IN PVOID Base, IN ULONG Address)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a2">RtlAddressInSectionTable</a> (IN PIMAGE_NT_HEADERS NtHeaders, IN PVOID Base, IN ULONG Address)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a3">RtlpImageDirectoryEntryToData32</a> (IN PVOID Base, IN BOOLEAN MappedAsImage, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> DirectoryEntry, OUT PULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, PIMAGE_NT_HEADERS32 NtHeaders)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a4">RtlpImageDirectoryEntryToData64</a> (IN PVOID Base, IN BOOLEAN MappedAsImage, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> DirectoryEntry, OUT PULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, PIMAGE_NT_HEADERS64 NtHeaders)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a> (IN PVOID Base, IN BOOLEAN MappedAsImage, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> DirectoryEntry, OUT PULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PIMAGE_SECTION_HEADER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a6">RtlImageRvaToSection</a> (IN PIMAGE_NT_HEADERS NtHeaders, IN PVOID Base, IN ULONG Rva)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/imagedir_8c.html#a7">RtlImageRvaToVa</a> (IN PIMAGE_NT_HEADERS NtHeaders, IN PVOID Base, IN ULONG Rva, IN OUT PIMAGE_SECTION_HEADER *LastRvaSection OPTIONAL)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="imagedir.c::RtlAddressInSectionTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID RtlAddressInSectionTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIMAGE_NT_HEADERS&nbsp;</td>
          <td class="mdname" nowrap> <em>NtHeaders</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Address</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00131">131</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00082">RtlSectionTableFromVirtualAddress()</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00096">LdrpAccessResourceData()</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00178">RtlpImageDirectoryEntryToData32()</a>, and <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00214">RtlpImageDirectoryEntryToData64()</a>.
<p>
<pre class="fragment"><div>00139                    :
00140 
00141     This function locates a VirtualAddress within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image header
00142     of a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped as a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> seek address
00143     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a> describes.
00144 
00145 Arguments:
00146 
00147     NtHeaders - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00148 
00149     Base - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00150 
00151     Address - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to locate.
00152 
00153 Return Value:
00154 
00155     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> does not contain data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified directory entry.
00156 
00157     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> raw data <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory describes.
00158 
00159 --*/
00160 
00161 {
00162     PIMAGE_SECTION_HEADER NtSection;
00163 
00164     NtSection = <a class="code" href="../../d8/d9/imagedir_8c.html#a1">RtlSectionTableFromVirtualAddress</a>( NtHeaders,
00165                                                    Base,
00166                                                    Address
00167                                                  );
00168     <span class="keywordflow">if</span> (NtSection != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00169         <span class="keywordflow">return</span>( ((PCHAR)Base + ((ULONG_PTR)Address - NtSection-&gt;VirtualAddress) + NtSection-&gt;PointerToRawData) );
00170         }
00171     <span class="keywordflow">else</span> {
00172         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00173         }
00174 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="imagedir.c::RtlImageDirectoryEntryToData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID RtlImageDirectoryEntryToData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MappedAsImage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">250</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00029">RtlImageNtHeader()</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00178">RtlpImageDirectoryEntryToData32()</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00214">RtlpImageDirectoryEntryToData64()</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/mapview_8c-source.html#l02930">CacheImageSymbols()</a>, <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>, <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00515">KiLookupFunctionEntry()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l01039">LdrEnumResources()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00096">LdrpAccessResourceData()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l02178">LdrpCallTlsInitializers()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l03710">LdrpDphDetectSnapRoutines()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l03781">LdrpDphSnapImports()</a>, <a class="el" href="../../d5/d1/ldrapi_8c-source.html#l00851">LdrpGetProcedureAddress()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00186">LdrpInitialize()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00616">LdrpInitializeProcess()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l01978">LdrpInitializeTls()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l01261">LdrpMapDll()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00492">LdrpSearchResourceSection_U()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l02258">LdrpSnapIAT()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l02802">LdrpUpdateLoadCount()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l00214">LdrpWalkImportDescriptor()</a>, <a class="el" href="../../d1/d2/ldrreloc_8c-source.html#l00091">LdrRelocateImage()</a>, <a class="el" href="../../d5/d1/ldrapi_8c-source.html#l01069">LdrVerifyImageMatchesChecksum()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03326">MiBuildImportsForBootDrivers()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06928">MiFindExportedRoutineByName()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03712">MiLocateExportName()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03953">MiResolveImageReferences()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l04464">MiSnapThunk()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l05878">MiUpdateThunks()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l04631">MmCreatePeb()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00985">RtlDispatchException()</a>, <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00184">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l02421">RtlLookupStaticFunctionEntry()</a>, and <a class="el" href="../../d8/d8/ia64_2exdsptch_8c-source.html#l00605">RtlUnwind2()</a>.
<p>
<pre class="fragment"><div>00259                    :
00260 
00261     This function locates a <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a> Entry within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image header
00262     and returns either <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address or seek address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00263     data <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a> describes.
00264 
00265 Arguments:
00266 
00267     Base - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00268 
00269     MappedAsImage - <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped as a data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00270                   - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped as an image.
00271 
00272     DirectoryEntry - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory entry to locate.
00273 
00274     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - Return <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory.
00275 
00276 Return Value:
00277 
00278     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> does not contain data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified directory entry.
00279 
00280     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> raw data <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory describes.
00281 
00282 --*/
00283 
00284 {
00285     PIMAGE_NT_HEADERS NtHeaders;
00286 
00287     <span class="keywordflow">if</span> ((ULONG_PTR)Base &amp; 0x00000001) {
00288         Base = (PVOID)((ULONG_PTR)Base &amp; ~0x00000001);
00289         MappedAsImage = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00290         }
00291 
00292     NtHeaders = <a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(Base);
00293 
00294     <span class="keywordflow">if</span> (!NtHeaders)
00295         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00296 
00297     <span class="keywordflow">if</span> (NtHeaders-&gt;OptionalHeader.Magic == IMAGE_NT_OPTIONAL_HDR32_MAGIC) {
00298         <span class="keywordflow">return</span> (<a class="code" href="../../d8/d9/imagedir_8c.html#a3">RtlpImageDirectoryEntryToData32</a>(Base,
00299                                                 MappedAsImage,
00300                                                 DirectoryEntry,
00301                                                 Size,
00302                                                 (PIMAGE_NT_HEADERS32)NtHeaders));
00303     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NtHeaders-&gt;OptionalHeader.Magic == IMAGE_NT_OPTIONAL_HDR64_MAGIC) {
00304         <span class="keywordflow">return</span> (<a class="code" href="../../d8/d9/imagedir_8c.html#a4">RtlpImageDirectoryEntryToData64</a>(Base,
00305                                                 MappedAsImage,
00306                                                 DirectoryEntry,
00307                                                 Size,
00308                                                 (PIMAGE_NT_HEADERS64)NtHeaders));
00309     } <span class="keywordflow">else</span> {
00310         <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00311     }
00312 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="imagedir.c::RtlImageNtHeader" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PIMAGE_NT_HEADERS RtlImageNtHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Base</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00029">29</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00063">ConsoleApp()</a>, <a class="el" href="../../d2/d9/csrinit_8c-source.html#l00106">CsrClientConnectToServer()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00586">DbgkMapViewOfSection()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00599">IopDriverCorrectnessProcessParams()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l02681">IopWriteDriverList()</a>, <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00059">KeDumpMachineState()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00317">KiDumpParameterImages()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00278">LdrFindEntryForAddress()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l01563">LdrLoadAlternateResourceModule()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00096">LdrpAccessResourceData()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l03043">LdrpAllocateDataTableEntry()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l00832">LdrpCheckForLoadedDll()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l03249">LdrpFetchAddressOfEntryPoint()</a>, <a class="el" href="../../d5/d1/ldrapi_8c-source.html#l00851">LdrpGetProcedureAddress()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00186">LdrpInitialize()</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00616">LdrpInitializeProcess()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l00140">LdrpLoadImportModule()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l01261">LdrpMapDll()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l00652">LdrpRunInitializeRoutines()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l03417">LdrpSetProtection()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l02258">LdrpSnapIAT()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l02476">LdrpSnapThunk()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l02802">LdrpUpdateLoadCount()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l00214">LdrpWalkImportDescriptor()</a>, <a class="el" href="../../d1/d2/ldrreloc_8c-source.html#l00091">LdrRelocateImage()</a>, <a class="el" href="../../d5/d1/ldrapi_8c-source.html#l01069">LdrVerifyImageMatchesChecksum()</a>, <a class="el" href="../../d1/d6/checksum_8c-source.html#l00099">LdrVerifyMappedImageMatchesChecksum()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00933">LoadAppDlls()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02208">MiEnablePagingOfDriver()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02735">MiEnablePagingTheExecutive()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02474">MiFindInitializationCode()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l05956">MiReloadBootLoadedDrivers()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l05633">MiWriteProtectSystemImage()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l04631">MmCreatePeb()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02106">MmFreeDriverInitialization()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06797">MmGetSectionRange()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06864">MmLockPagableDataSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02560">MmResetDriverPaging()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l04923">MmVerifyImageIsOkForMpUse()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l00515">RtlAcquireResourceExclusive()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l00350">RtlAcquireResourceShared()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l00851">RtlConvertSharedToExclusive()</a>, <a class="el" href="../../d2/d4/w32_2ntuser_2rtl_2random_8c-source.html#l00028">RtlGetExpWinVer()</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l00539">RtlpCreateStack()</a>, <a class="el" href="../../d7/d3/pctohdr_8c-source.html#l00042">RtlPcToFileHeader()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01544">RtlpWaitForCriticalSection()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00814">SetAppCompatFlags()</a>, and <a class="el" href="../../d3/d7/clhook_8c-source.html#l00026">SetWindowsHookExAW()</a>.
<p>
<pre class="fragment"><div>00035                    :
00036 
00037     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NT <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.
00038 
00039 Arguments:
00040 
00041     Base - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image.
00042 
00043 Return Value:
00044 
00045     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NT <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.
00046 
00047 --*/
00048 
00049 {
00050 <span class="preprocessor">#if defined (BLDR_KERNEL_RUNTIME) || defined(NTOS_KERNEL_RUNTIME)</span>
00051 <span class="preprocessor"></span>    PIMAGE_NT_HEADERS NtHeaders = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00052 
00053     <span class="keywordflow">if</span> (Base != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Base != (PVOID)-1) {
00054         <span class="keywordflow">if</span> (((PIMAGE_DOS_HEADER)Base)-&gt;e_magic == IMAGE_DOS_SIGNATURE) {
00055             NtHeaders = (PIMAGE_NT_HEADERS)((PCHAR)Base + ((PIMAGE_DOS_HEADER)Base)-&gt;e_lfanew);
00056 
00057 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00058 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (Base &lt; MM_HIGHEST_USER_ADDRESS) {
00059                 <span class="keywordflow">if</span> ((PVOID)NtHeaders &gt;= MM_HIGHEST_USER_ADDRESS) {
00060                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00061                 }
00062                 <span class="keywordflow">if</span> ((PVOID)((PCHAR)NtHeaders + <span class="keyword">sizeof</span> (IMAGE_NT_HEADERS)) &gt;= MM_HIGHEST_USER_ADDRESS) {
00063                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00064                 }
00065             }
00066 <span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
00068             <span class="keywordflow">if</span> (NtHeaders-&gt;Signature != IMAGE_NT_SIGNATURE) {
00069                 NtHeaders = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00070             }
00071         }
00072     }
00073 
00074     <span class="keywordflow">return</span> NtHeaders;
00075 <span class="preprocessor">#else</span>
00076 <span class="preprocessor"></span>    <span class="keywordflow">return</span> RtlpImageNtHeader( Base );
00077 <span class="preprocessor">#endif</span>
00078 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="imagedir.c::RtlImageRvaToSection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PIMAGE_SECTION_HEADER RtlImageRvaToSection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIMAGE_NT_HEADERS&nbsp;</td>
          <td class="mdname" nowrap> <em>NtHeaders</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Rva</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00318">318</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00370">RtlImageRvaToVa()</a>.
<p>
<pre class="fragment"><div>00326                    :
00327 
00328     This function locates an RVA within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image header of a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>
00329     that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped as a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
00330     table entry <span class="keywordflow">for</span> that <span class="keyword">virtual</span> address
00331 
00332 Arguments:
00333 
00334     NtHeaders - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00335 
00336     Base - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.  The image
00337         was mapped as a data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00338 
00339     Rva - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> relative <span class="keyword">virtual</span> address (RVA) to locate.
00340 
00341 Return Value:
00342 
00343     NULL - The RVA was not found within any of the sections of the image.
00344 
00345     NON-NULL - Returns the pointer to the image section that contains
00346                the RVA
00347 
00348 --*/
00349 
00350 {
00351     ULONG i;
00352     PIMAGE_SECTION_HEADER NtSection;
00353 
00354     NtSection = IMAGE_FIRST_SECTION( NtHeaders );
00355     <span class="keywordflow">for</span> (i=0; i&lt;NtHeaders-&gt;FileHeader.NumberOfSections; i++) {
00356         <span class="keywordflow">if</span> (Rva &gt;= NtSection-&gt;VirtualAddress &amp;&amp;
00357             Rva &lt; NtSection-&gt;VirtualAddress + NtSection-&gt;SizeOfRawData
00358            ) {
00359             <span class="keywordflow">return</span> NtSection;
00360             }
00361         ++NtSection;
00362         }
00363 
00364     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00365 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="imagedir.c::RtlImageRvaToVa" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID RtlImageRvaToVa           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIMAGE_NT_HEADERS&nbsp;</td>
          <td class="mdname" nowrap> <em>NtHeaders</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Rva</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PIMAGE_SECTION_HEADER *LastRvaSection&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00370">370</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00318">RtlImageRvaToSection()</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/ldrapi_8c-source.html#l01069">LdrVerifyImageMatchesChecksum()</a>.
<p>
<pre class="fragment"><div>00379                    :
00380 
00381     This function locates an RVA within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image header of a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> that
00382     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped as a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> addrees of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00383     corresponding byte in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00384 
00385 
00386 Arguments:
00387 
00388     NtHeaders - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00389 
00390     Base - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.  The image
00391         was mapped as a data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00392 
00393     Rva - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> relative <span class="keyword">virtual</span> address (RVA) to locate.
00394 
00395     LastRvaSection - Optional parameter that if specified, points
00396         to a variable that contains the last section value used for
00397         the specified image to translate and RVA to a VA.
00398 
00399 Return Value:
00400 
00401     NULL - The file does not contain the specified RVA
00402 
00403     NON-NULL - Returns the virtual addrees in the mapped file.
00404 
00405 --*/
00406 
00407 {
00408     PIMAGE_SECTION_HEADER NtSection;
00409 
00410     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( LastRvaSection ) ||
00411         (NtSection = *LastRvaSection) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00412         Rva &lt; NtSection-&gt;VirtualAddress ||
00413         Rva &gt;= NtSection-&gt;VirtualAddress + NtSection-&gt;SizeOfRawData
00414        ) {
00415         NtSection = <a class="code" href="../../d8/d9/imagedir_8c.html#a6">RtlImageRvaToSection</a>( NtHeaders,
00416                                           Base,
00417                                           Rva
00418                                         );
00419         }
00420 
00421     <span class="keywordflow">if</span> (NtSection != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00422         <span class="keywordflow">if</span> (LastRvaSection != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00423             *LastRvaSection = NtSection;
00424             }
00425 
00426         <span class="keywordflow">return</span> (PVOID)((PCHAR)Base +
00427                        (Rva - NtSection-&gt;VirtualAddress) +
00428                        NtSection-&gt;PointerToRawData
00429                       );
00430         }
00431     <span class="keywordflow">else</span> {
00432         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00433         }
00434 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="imagedir.c::RtlpImageDirectoryEntryToData32" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID RtlpImageDirectoryEntryToData32           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MappedAsImage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PIMAGE_NT_HEADERS32&nbsp;</td>
          <td class="mdname" nowrap> <em>NtHeaders</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00178">178</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00131">RtlAddressInSectionTable()</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>.
<p>
<pre class="fragment"><div>00185 {
00186     ULONG DirectoryAddress;
00187 
00188     <span class="keywordflow">if</span> (DirectoryEntry &gt;= NtHeaders-&gt;OptionalHeader.NumberOfRvaAndSizes) {
00189         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00190     }
00191 
00192     <span class="keywordflow">if</span> (!(DirectoryAddress = NtHeaders-&gt;OptionalHeader.DataDirectory[ DirectoryEntry ].VirtualAddress)) {
00193         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00194     }
00195 
00196 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00197 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Base &lt; MM_HIGHEST_USER_ADDRESS) {
00198         <span class="keywordflow">if</span> ((PVOID)((PCHAR)Base + DirectoryAddress) &gt;= MM_HIGHEST_USER_ADDRESS) {
00199             <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00200         }
00201     }
00202 <span class="preprocessor">#endif</span>
00203 <span class="preprocessor"></span>
00204     *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = NtHeaders-&gt;OptionalHeader.DataDirectory[ DirectoryEntry ].Size;
00205     <span class="keywordflow">if</span> (MappedAsImage || DirectoryAddress &lt; NtHeaders-&gt;OptionalHeader.SizeOfHeaders) {
00206         <span class="keywordflow">return</span>( (PVOID)((PCHAR)Base + DirectoryAddress) );
00207     }
00208 
00209     <span class="keywordflow">return</span>( <a class="code" href="../../d8/d9/imagedir_8c.html#a2">RtlAddressInSectionTable</a>((PIMAGE_NT_HEADERS)NtHeaders, Base, DirectoryAddress ));
00210 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="imagedir.c::RtlpImageDirectoryEntryToData64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID RtlpImageDirectoryEntryToData64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MappedAsImage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PIMAGE_NT_HEADERS64&nbsp;</td>
          <td class="mdname" nowrap> <em>NtHeaders</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00214">214</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00131">RtlAddressInSectionTable()</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>.
<p>
<pre class="fragment"><div>00221 {
00222     ULONG DirectoryAddress;
00223 
00224     <span class="keywordflow">if</span> (DirectoryEntry &gt;= NtHeaders-&gt;OptionalHeader.NumberOfRvaAndSizes) {
00225         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00226     }
00227 
00228     <span class="keywordflow">if</span> (!(DirectoryAddress = NtHeaders-&gt;OptionalHeader.DataDirectory[ DirectoryEntry ].VirtualAddress)) {
00229         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00230     }
00231 
00232 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00233 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Base &lt; MM_HIGHEST_USER_ADDRESS) {
00234         <span class="keywordflow">if</span> ((PVOID)((PCHAR)Base + DirectoryAddress) &gt;= MM_HIGHEST_USER_ADDRESS) {
00235             <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00236         }
00237     }
00238 <span class="preprocessor">#endif</span>
00239 <span class="preprocessor"></span>
00240     *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = NtHeaders-&gt;OptionalHeader.DataDirectory[ DirectoryEntry ].Size;
00241     <span class="keywordflow">if</span> (MappedAsImage || DirectoryAddress &lt; NtHeaders-&gt;OptionalHeader.SizeOfHeaders) {
00242         <span class="keywordflow">return</span>( (PVOID)((PCHAR)Base + DirectoryAddress) );
00243     }
00244 
00245     <span class="keywordflow">return</span>( <a class="code" href="../../d8/d9/imagedir_8c.html#a2">RtlAddressInSectionTable</a>((PIMAGE_NT_HEADERS)NtHeaders, Base, DirectoryAddress ));
00246 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="imagedir.c::RtlSectionTableFromVirtualAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PIMAGE_SECTION_HEADER RtlSectionTableFromVirtualAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIMAGE_NT_HEADERS&nbsp;</td>
          <td class="mdname" nowrap> <em>NtHeaders</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Address</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00082">82</a> of file <a class="el" href="../../d9/d8/imagedir_8c-source.html">imagedir.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00096">LdrpAccessResourceData()</a>, and <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00131">RtlAddressInSectionTable()</a>.
<p>
<pre class="fragment"><div>00090                    :
00091 
00092     This function locates a VirtualAddress within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image header
00093     of a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped as a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00094     section table entry <span class="keywordflow">for</span> that <span class="keyword">virtual</span> address
00095 
00096 Arguments:
00097 
00098     NtHeaders - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00099 
00100     Base - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image or data <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00101 
00102     Address - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to locate.
00103 
00104 Return Value:
00105 
00106     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> does not contain data <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified directory entry.
00107 
00108     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section entry containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data.
00109 
00110 --*/
00111 
00112 {
00113     ULONG i;
00114     PIMAGE_SECTION_HEADER NtSection;
00115 
00116     NtSection = IMAGE_FIRST_SECTION( NtHeaders );
00117     <span class="keywordflow">for</span> (i=0; i&lt;NtHeaders-&gt;FileHeader.NumberOfSections; i++) {
00118         <span class="keywordflow">if</span> ((ULONG)Address &gt;= NtSection-&gt;VirtualAddress &amp;&amp;
00119             (ULONG)Address &lt; NtSection-&gt;VirtualAddress + NtSection-&gt;SizeOfRawData
00120            ) {
00121             <span class="keywordflow">return</span> NtSection;
00122             }
00123         ++NtSection;
00124         }
00125 
00126     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00127 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:09 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
