<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: client/ntstubs.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ntstubs.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include &lt;dbt.h&gt;</code><br>
<code>#include "<a class="el" href="../../d8/d8/ntsend_8h-source.html">ntsend.h</a>"</code><br>
<code>#include "cfgmgr32.h"</code><br>
<code>#include "<a class="el" href="../../d1/d9/csrhlpr_8h-source.html">csrhlpr.h</a>"</code><br>

<p>
<a href="../../d9/d8/client_2ntstubs_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a0">CLIENTSIDE</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a1">GetRemoteKeyboardLayout</a> (PWCHAR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WINUSERAPI BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a2">SetSysColors</a> (int cElements, CONST <a class="el" href="../../d2/d1/bench_8h.html#a7">INT</a> *lpaElements, CONST COLORREF *lpaRgbValues)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HWND&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a3">WOWFindWindow</a> (LPCSTR pClassName, LPCSTR pWindowName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a4">UpdatePerUserSystemParameters</a> (HANDLE hToken, BOOL bUserLoggedOn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> (<a class="el" href="../../d7/d4/structtagEVENT__PACKET.html">PEVENT_PACKET</a> pep)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a6">GetClassWOWWords</a> (HINSTANCE hInstance, LPCTSTR pString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a7">InitTask</a> (UINT wVersion, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwAppCompatFlags, LPCSTR pszModName, LPCSTR pszBaseFileName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> hTaskWow, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHotkey, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idTask, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwX, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwY, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwXSize, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwYSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a8">ConvertMemHandle</a> (HANDLE hData, UINT cbNULL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a9">CreateLocalMemHandle</a> (HANDLE hMem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HHOOK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a10">_SetWindowsHookEx</a> (HANDLE hmod, LPTSTR pszLib, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idThread, int nFilterType, PROC pfnFilterProc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WINUSERAPI HWINEVENTHOOK WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a11">SetWinEventHook</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> eventMin, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> eventMax, HMODULE hmodWinEventProc, WINEVENTPROC lpfnWinEventProc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idProcess, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idThread, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WINUSERAPI VOID WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwEvent, HWND hwnd, LONG idObject, LONG idChild)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a13">ThunkedMenuItemInfo</a> (HMENU hMenu, UINT nPosition, BOOL fByPosition, BOOL fInsert, LPMENUITEMINFOW lpmii, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a14">DrawCaption</a> (HWND hwnd, HDC hdc, CONST RECT *lprc, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a15">GetAsyncKeyState</a> (int vKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a> (int vKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a> (HWND hwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a18">_PeekMessage</a> (LPMSG pmsg, HWND hwnd, UINT wMsgFilterMin, UINT wMsgFilterMax, UINT wRemoveMsg, BOOL bAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a19">_SetWindowLongPtr</a> (HWND hwnd, int nIndex, LONG_PTR dwNewLong, BOOL bAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a20">TranslateMessageEx</a> (CONST MSG *pmsg, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a21">TranslateMessage</a> (CONST MSG *pmsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a22">SetWindowRgn</a> (HWND hwnd, HRGN hrgn, BOOL bRedraw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a23">InternalGetWindowText</a> (HWND hwnd, LPWSTR pString, int cchMaxCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a24">ToUnicode</a> (UINT wVirtKey, UINT wScanCode, CONST <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *pKeyState, LPWSTR pwszBuff, int cchBuff, UINT wFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a25">ToUnicodeEx</a> (UINT wVirtKey, UINT wScanCode, CONST <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *pKeyState, LPWSTR pwszBuff, int cchBuff, UINT wFlags, HKL hkl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a26">SetWindowStationUser</a> (HWINSTA hwinsta, PLUID pluidUser, PSID psidUser, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbsidUser)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a27">SetSystemCursor</a> (HCURSOR hcur, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> id)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HCURSOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a28">FindExistingCursorIcon</a> (LPWSTR pszModName, LPCWSTR pszResName, <a class="el" href="../../d9/d1/structtagCURSORFIND.html">PCURSORFIND</a> pcfSearch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a29">_SetCursorIconData</a> (HCURSOR hCursor, <a class="el" href="../../d8/d1/structtagCURSORDATA.html">PCURSORDATA</a> pcur)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a30">_DefSetText</a> (HWND hwnd, LPCWSTR lpszText, BOOL bAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HWND&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a31">_CreateWindowEx</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExStyle, LPCTSTR pClassName, LPCTSTR pWindowName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwStyle, int x, int y, int nWidth, int nHeight, HWND hwndParent, HMENU hmenu, HANDLE hModule, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pParam, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HKL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a32">_LoadKeyboardLayoutEx</a> (HANDLE hFile, UINT offTable, HKL hkl, LPCTSTR pwszKL, UINT KbdInputLocale, UINT Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a33">mouse_event</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dx, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dy, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwData, ULONG_PTR dwExtraInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a34">keybd_event</a> (<a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bVk, <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bScan, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, ULONG_PTR dwExtraInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a35">MESSAGECALL</a> (fnINWPARAMDBCSCHAR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a36">MESSAGECALL</a> (fnCOPYGLOBALDATA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a37">MESSAGECALL</a> (fnINPAINTCLIPBRD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a38">MESSAGECALL</a> (fnINSIZECLIPBRD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a39">MESSAGECALL</a> (fnINDEVICECHANGE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a40">MESSAGECALL</a> (fnIMECONTROL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a41">MESSAGECALL</a> (fnEMGETSEL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a42">MESSAGECALL</a> (fnEMSETSEL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a43">MESSAGECALL</a> (fnCBGETEDITSEL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a44">BroadcastSystemMessageWorker</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, LPDWORD lpdwRecipients, UINT message, WPARAM wParam, LPARAM lParam, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HDEVNOTIFY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a45">RegisterDeviceNotificationWorker</a> (IN HANDLE hRecipient, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> NotificationFilter, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Flags, IN BOOL IsAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/client_2ntstubs_8c.html#a46">UnregisterDeviceNotification</a> (IN HDEVNOTIFY <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="client/ntstubs.c::CLIENTSIDE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CLIENTSIDE&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00015">15</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a31" doxytag="client/ntstubs.c::_CreateWindowEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HWND _CreateWindowEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwExStyle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCTSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pClassName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCTSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pWindowName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwStyle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>nWidth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>nHeight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndParent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HMENU&nbsp;</td>
          <td class="mdname" nowrap> <em>hmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hModule</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01197">1197</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00451">_LARGE_STRING::bAnsi</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00421">_LARGE_STRING::Buffer</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00176">CLEANUPLPSTRW</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02794">CreateMDIChild()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02744">CW_FLAGS_DIFFHMOD</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02035">tagSHORTCREATE::cx</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02034">tagSHORTCREATE::cy</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00322">_LARGE_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00799">FNID_MDICLIENT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00916">GETEXPWINVER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02039">tagSHORTCREATE::hMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a352">LARGE_IN_STRING</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00449">_LARGE_STRING::Length</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00450">_LARGE_STRING::MaximumLength</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02735">MDICompleteChildCreation()</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08087">NtUserCreateWindowEx()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00321">_LARGE_IN_STRING::pstr</a>, <a class="el" href="../../d2/d1/rtlinit_8c-source.html#l00095">RtlCaptureLargeAnsiString()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00608">RtlInitLargeAnsiString()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00636">RtlInitLargeUnicodeString()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a382">SHORTCREATE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00320">_LARGE_IN_STRING::strCapture</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02038">tagSHORTCREATE::style</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00728">WS_EX_ANSICREATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00727">WS_EX_MDICHILD</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02037">tagSHORTCREATE::x</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l02036">tagSHORTCREATE::y</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00038">CreateWindowEx()</a>, <a class="el" href="../../d9/d4/reader_8c-source.html#l00355">EnterReaderMode()</a>, <a class="el" href="../../d0/d3/ddemlcli_8c-source.html#l00065">InternalDdeInitialize()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l02696">UserRegisterWowHandlers()</a>, and <a class="el" href="../../d4/d3/comboini_8c-source.html#l00070">xxxCBCreateHandler()</a>.
<p>
<pre class="fragment"><div>01211 {
01212     <a class="code" href="../../d8/d8/struct__LARGE__IN__STRING.html">LARGE_IN_STRING</a> strClassName;
01213     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">LARGE_STRING</a> strWindowName;
01214     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstrClassName;
01215     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstrWindowName;
01216     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExpWinVerAndFlags;
01217 
01218     <span class="comment">/*</span>
01219 <span class="comment">     * Make sure cleanup will work successfully</span>
01220 <span class="comment">     */</span>
01221     strClassName.<a class="code" href="../../d8/d8/struct__LARGE__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01222 
01223     <span class="comment">/*</span>
01224 <span class="comment">     * To be compatible with Chicago, we test the validity of</span>
01225 <span class="comment">     * the ExStyle bits and fail if any invalid bits are found.</span>
01226 <span class="comment">     * And for backward compatibilty with NT apps, we only fail for</span>
01227 <span class="comment">     * new apps (post NT 3.1).</span>
01228 <span class="comment">     */</span>
01229 
01230 <span class="comment">// BOGUS</span>
01231 
01232     <span class="keywordflow">if</span> (dwExStyle &amp; 0x00000800<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>) {
01233         dwExStyle |= WS_EX_TOOLWINDOW;
01234         dwExStyle &amp;= 0xfffff7ff<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01235     }
01236 
01237     dwExpWinVerAndFlags = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(WORD)<a class="code" href="../../d6/d0/usercli_8h.html#a134">GETEXPWINVER</a>(hModule);
01238     <span class="keywordflow">if</span> ((dwExStyle &amp; ~WS_EX_VALID50) &amp;&amp; (dwExpWinVerAndFlags &gt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>) ) {
01239         RIPMSG0(RIP_ERROR, <span class="stringliteral">"Invalid 5.0 ExStyle\n"</span>);
01240         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01241     }
01242     {
01243 
01244     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fMDIchild = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01245     MDICREATESTRUCT mdics;
01246     HMENU hSysMenu;
01247 
01248     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01249 
01250         if ((fMDIchild = (BOOL)(dwExStyle &amp; WS_EX_MDICHILD))) {
01251             <a class="code" href="../../d5/d6/structtagSHORTCREATE.html">SHORTCREATE</a> sc;
01252             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
01253 
01254             pwndParent = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndParent);
01255 
01256             <span class="keywordflow">if</span> ((pwndParent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndParent) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a206">FNID_MDICLIENT</a>)) {
01257                 RIPMSG0(RIP_ERROR, <span class="stringliteral">"Invalid parent for MDI child window\n"</span>);
01258                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01259             }
01260 
01261             mdics.lParam  = (LPARAM)pParam;
01262             pParam = &amp;mdics;
01263             mdics.x = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o3">x</a> = x;
01264             mdics.y = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o2">y</a> = y;
01265             mdics.cx = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o1">cx</a> = nWidth;
01266             mdics.cy = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o0">cy</a> = nHeight;
01267             mdics.style = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o4">style</a> = dwStyle;
01268             mdics.hOwner = hModule;
01269             mdics.szClass = pClassName;
01270             mdics.szTitle = pWindowName;
01271 
01272             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a773">CreateMDIChild</a>(&amp;sc, &amp;mdics, dwExpWinVerAndFlags, &amp;hSysMenu, pwndParent))
01273                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01274 
01275             x = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o3">x</a>;
01276             y = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o2">y</a>;
01277             nWidth = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o1">cx</a>;
01278             nHeight = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o0">cy</a>;
01279             dwStyle = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o4">style</a>;
01280             hmenu = sc.<a class="code" href="../../d5/d6/structtagSHORTCREATE.html#o5">hMenu</a>;
01281         }
01282 
01283         <span class="comment">/*</span>
01284 <span class="comment">         * Set up class and window name.  If the window name is an</span>
01285 <span class="comment">         * ordinal, make it look like a string so the callback thunk</span>
01286 <span class="comment">         * will be able to ensure it is in the correct format.</span>
01287 <span class="comment">         */</span>
01288         pstrWindowName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01289         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; CW_FLAGS_ANSI) {
01290             dwExStyle = dwExStyle | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a188">WS_EX_ANSICREATOR</a>;
01291             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(pClassName)) {
01292                 <a class="code" href="../../d6/d0/usercli_8h.html#a430">RtlCaptureLargeAnsiString</a>(&amp;strClassName,
01293                         (PCHAR)pClassName, TRUE);
01294                 pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)strClassName.<a class="code" href="../../d8/d8/struct__LARGE__IN__STRING.html#o1">pstr</a>;
01295             } <span class="keywordflow">else</span>
01296                 pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)pClassName;
01297 
01298             <span class="keywordflow">if</span> (pWindowName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01299                 <span class="keywordflow">if</span> (*(<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pWindowName == 0xff) {
01300                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01301                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = (PVOID)pWindowName;
01302                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> = 3;
01303                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a> = 3;
01304                 } <span class="keywordflow">else</span>
01305                     <a class="code" href="../../d5/d6/chartran_8c.html#a6">RtlInitLargeAnsiString</a>((<a class="code" href="../../d5/d8/struct__LARGE__ANSI__STRING.html">PLARGE_ANSI_STRING</a>)&amp;strWindowName,
01306                             (LPSTR)pWindowName, (UINT)-1);
01307                 pstrWindowName = &amp;strWindowName;
01308             }
01309         } <span class="keywordflow">else</span> {
01310             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(pClassName)) {
01311                 <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>(
01312                         (<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;strClassName.<a class="code" href="../../d8/d8/struct__LARGE__IN__STRING.html#o0">strCapture</a>,
01313                         pClassName, (UINT)-1);
01314                 pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)&amp;strClassName.<a class="code" href="../../d8/d8/struct__LARGE__IN__STRING.html#o0">strCapture</a>;
01315             } <span class="keywordflow">else</span>
01316                 pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)pClassName;
01317 
01318             <span class="keywordflow">if</span> (pWindowName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01319                 <span class="keywordflow">if</span> (pWindowName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01320                      *(PWORD)pWindowName == 0xffff) {
01321                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01322                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = (PVOID)pWindowName;
01323                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> = 4;
01324                     strWindowName.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a> = 4;
01325                 } <span class="keywordflow">else</span>
01326                     <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>((<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;strWindowName,
01327                             pWindowName, (UINT)-1);
01328                 pstrWindowName = &amp;strWindowName;
01329             }
01330         }
01331         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a771">CW_FLAGS_DIFFHMOD</a>) {
01332             dwExpWinVerAndFlags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a771">CW_FLAGS_DIFFHMOD</a>;
01333         }
01334 
01335         retval = (ULONG_PTR)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a290">NtUserCreateWindowEx</a>(
01336                 dwExStyle,
01337                 pstrClassName,
01338                 pstrWindowName,
01339                 dwStyle,
01340                 x,
01341                 y,
01342                 nWidth,
01343                 nHeight,
01344                 hwndParent,
01345                 hmenu,
01346                 hModule,
01347                 pParam,
01348                 dwExpWinVerAndFlags);
01349 
01350     <span class="comment">// If this is an MDI child, we need to do some more to complete the</span>
01351     <span class="comment">// process of creating an MDI child.</span>
01352     <span class="keywordflow">if</span> (retval &amp;&amp; fMDIchild) {
01353         <a class="code" href="../../d6/d0/usercli_8h.html#a774">MDICompleteChildCreation</a>((HWND)retval, hSysMenu, ((dwStyle &amp; WS_VISIBLE) != 0L), (BOOL)((dwStyle &amp; WS_DISABLED)!= 0L));
01354     }
01355 
01356 
01357     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01358     <a class="code" href="../../d7/d9/ntsend_8h.html#a29">CLEANUPLPSTRW</a>(strClassName);
01359     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(HWND);
01360     }
01361 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="client/ntstubs.c::_DefSetText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _DefSetText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpszText</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01171">1171</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07490">NtUserDefSetText()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a971">PLARGE_ANSI_STRING</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00608">RtlInitLargeAnsiString()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00636">RtlInitLargeUnicodeString()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/btnctl_8c-source.html#l01338">ButtonWndProcWorker()</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l01657">MDIClientWndProcWorker()</a>, <a class="el" href="../../d6/d4/statctl_8c-source.html#l00840">StaticWndProcWorker()</a>, and <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l00032">xxxSetFrameTitle()</a>.
<p>
<pre class="fragment"><div>01175 {
01176     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">LARGE_STRING</a> str;
01177 
01178     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01179 
01180         if (lpszText) {
01181             <span class="keywordflow">if</span> (bAnsi)
01182                 <a class="code" href="../../d5/d6/chartran_8c.html#a6">RtlInitLargeAnsiString</a>((<a class="code" href="../../d5/d8/struct__LARGE__ANSI__STRING.html">PLARGE_ANSI_STRING</a>)&amp;str,
01183                         (LPSTR)lpszText, (UINT)-1);
01184             <span class="keywordflow">else</span>
01185                 <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>((<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;str,
01186                         lpszText, (UINT)-1);
01187         }
01188 
01189         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a275">NtUserDefSetText</a>(
01190                 hwnd,
01191                 lpszText ? &amp;str : NULL);
01192 
01193     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01194     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
01195 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="client/ntstubs.c::_LoadKeyboardLayoutEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HKL _LoadKeyboardLayoutEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>offTable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hkl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCTSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>KbdInputLocale</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01363">1363</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00235">CLEANUPLPWSTR</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00316">_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00227">FIRSTCOPYLPWSTR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08449">NtUserLoadKeyboardLayoutEx()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00315">_IN_STRING::pstr</a>.
<p>
<pre class="fragment"><div>01370 {
01371     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strKL;
01372 
01373     <span class="comment">/*</span>
01374 <span class="comment">     * Make sure cleanup will work successfully</span>
01375 <span class="comment">     */</span>
01376     strKL.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01377 
01378     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01379 
01380         FIRSTCOPYLPWSTR(&amp;strKL, pwszKL);
01381 
01382         retval = (ULONG_PTR)NtUserLoadKeyboardLayoutEx(
01383                 hFile,
01384                 offTable,
01385                 hkl,
01386                 strKL.pstr,
01387                 KbdInputLocale,
01388                 Flags);
01389 
01390     ERRORTRAP(0);
01391     CLEANUPLPWSTR(strKL);
01392     ENDCALL(HKL);
01393 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="client/ntstubs.c::_PeekMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _PeekMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pmsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wMsgFilterMin</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wMsgFilterMax</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wRemoveMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00556">556</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02311">BUILD_DBCS_MESSAGE_TO_CLIENTA_FROM_SERVER</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02359">BUILD_DBCS_MESSAGE_TO_CLIENTW_FROM_SERVER</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02229">GET_DBCS_MESSAGE_IF_EXIST</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05514">NtUserPeekMessage()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00483">PeekMessage()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00361">RtlWCSMessageWParamCharToMB()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00483">PeekMessage()</a>.
<p>
<pre class="fragment"><div>00563 {
00564     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00565 
00566         if (bAnsi) {
00567             <span class="comment">//</span>
00568             <span class="comment">// If we have pushed message for DBCS messaging, we should pass this one</span>
00569             <span class="comment">// to Apps at first...</span>
00570             <span class="comment">//</span>
00571             <a class="code" href="../../d6/d0/usercli_8h.html#a293">GET_DBCS_MESSAGE_IF_EXIST</a>(
00572                 PeekMessage,pmsg,wMsgFilterMin,wMsgFilterMax,((wRemoveMsg &amp; PM_REMOVE) ? TRUE:FALSE));
00573         }
00574 
00575         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a213">NtUserPeekMessage</a>(
00576                 pmsg,
00577                 hwnd,
00578                 wMsgFilterMin,
00579                 wMsgFilterMax,
00580                 wRemoveMsg);
00581 
00582         <span class="keywordflow">if</span> (retval) {
00583             <span class="comment">// May have a bit more work to do if this MSG is for an ANSI app</span>
00584 
00585             <span class="keywordflow">if</span> (bAnsi) {
00586                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/chartran_8c.html#a4">RtlWCSMessageWParamCharToMB</a>(pmsg-&gt;message, &amp;(pmsg-&gt;wParam))) {
00587                     WPARAM dwAnsi = pmsg-&gt;wParam;
00588                     <span class="comment">//</span>
00589                     <span class="comment">// Build DBCS-ware wParam. (for EM_SETPASSWORDCHAR...)</span>
00590                     <span class="comment">//</span>
00591                     <a class="code" href="../../d6/d0/usercli_8h.html#a296">BUILD_DBCS_MESSAGE_TO_CLIENTA_FROM_SERVER</a>(
00592                         pmsg,dwAnsi,TRUE,((wRemoveMsg &amp; PM_REMOVE) ? TRUE:FALSE));
00593                 } <span class="keywordflow">else</span> {
00594                     retval = 0;
00595                 }
00596             } <span class="keywordflow">else</span> {
00597                <span class="comment">//</span>
00598                <span class="comment">// Only LOWORD of WPARAM is valid for WM_CHAR....</span>
00599                <span class="comment">// (Mask off DBCS messaging information.)</span>
00600                <span class="comment">//</span>
00601                <a class="code" href="../../d6/d0/usercli_8h.html#a297">BUILD_DBCS_MESSAGE_TO_CLIENTW_FROM_SERVER</a>(pmsg-&gt;message,pmsg-&gt;wParam);
00602             }
00603         }
00604 
00605 ExitPeekMessage:
00606 
00607     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00608     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
00609 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="client/ntstubs.c::_SetCursorIconData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _SetCursorIconData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HCURSOR&nbsp;</td>
          <td class="mdname" nowrap> <em>hCursor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d1/structtagCURSORDATA.html">PCURSORDATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcur</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01138">1138</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
<pre class="fragment"><div>01141 {
01142     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a>  strModName;
01143     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a>  strResName;
01144 
01145     <span class="comment">/*</span>
01146 <span class="comment">     * Make sure cleanup will work successfully</span>
01147 <span class="comment">     */</span>
01148     strModName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01149     strResName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01150 
01151     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01152 
01153         COPYLPWSTROPT(&amp;strModName, pcur-&gt;lpModName);
01154         COPYLPWSTRIDOPT(&amp;strResName, pcur-&gt;lpName);
01155 
01156         retval = (DWORD)NtUserSetCursorIconData(hCursor,
01157                                                 strModName.pstr,
01158                                                 strResName.pstr,
01159                                                 pcur);
01160 
01161     ERRORTRAP(0);
01162 
01163     CLEANUPLPWSTR(strModName);
01164     CLEANUPLPWSTR(strResName);
01165 
01166     ENDCALL(BOOL);
01167 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="client/ntstubs.c::_SetWindowLongPtr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG_PTR _SetWindowLongPtr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>nIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>dwNewLong</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00612">612</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01561">CPD_ANSI_TO_UNICODE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01567">CPD_DIALOG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01562">CPD_UNICODE_TO_ANSI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02824">DLGF_ANSI</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00798">FNID_LISTBOX</a>, <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00875">GetCPD()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00353">HMValidateHandleNoRip()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01572">ISCPDTAG</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00964">NtUserSetWindowLongPtr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02819">PDLG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01580">_CALLPROCDATA::pfnClientPrevious</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01178">TestWindowProcess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00912">TYPE_CALLPROC</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02282">WFDIALOGWINDOW</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01658">_CALLPROCDATA::wType</a>.
<p>
<pre class="fragment"><div>00617 {
00618     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00619     LONG_PTR dwOldLong;
00620     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCPDType = 0;
00621 
00622     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00623 
00624     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00625         <span class="keywordflow">return</span> 0;
00626 
00627     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDIALOGWINDOW)) {
00628         <span class="keywordflow">switch</span> (nIndex) {
00629         <span class="keywordflow">case</span> DWLP_DLGPROC:    <span class="comment">// See similar case GWL_WNDPROC</span>
00630 
00631             <span class="comment">/*</span>
00632 <span class="comment">             * Hide the window proc from other processes</span>
00633 <span class="comment">             */</span>
00634             <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a16">TestWindowProcess</a>(pwnd)) {
00635                 RIPERR1(ERROR_ACCESS_DENIED,
00636                         RIP_WARNING,
00637                         <span class="stringliteral">"Access denied to hwnd (%#lx) in _SetWindowLong"</span>,
00638                         hwnd);
00639 
00640                 <span class="keywordflow">return</span> 0;
00641             }
00642 
00643             <span class="comment">/*</span>
00644 <span class="comment">             * Get the old window proc address</span>
00645 <span class="comment">             */</span>
00646             dwOldLong = (LONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;lpfnDlg;
00647 
00648             <span class="comment">/*</span>
00649 <span class="comment">             * We always store the actual address in the wndproc; We only</span>
00650 <span class="comment">             * give the CallProc handles to the application</span>
00651 <span class="comment">             */</span>
00652             UserAssert(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a468">ISCPDTAG</a>(dwOldLong));
00653 
00654             <span class="comment">/*</span>
00655 <span class="comment">             * May need to return a CallProc handle if there is an</span>
00656 <span class="comment">             * Ansi/Unicode tranistion</span>
00657 <span class="comment">             */</span>
00658 
00659             <span class="keywordflow">if</span> (bAnsi != ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a794">DLGF_ANSI</a>) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00660                 dwCPDType |= bAnsi ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a459">CPD_ANSI_TO_UNICODE</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a460">CPD_UNICODE_TO_ANSI</a>;
00661             }
00662 
00663             <span class="comment">/*</span>
00664 <span class="comment">             * If we detected a transition create a CallProc handle for</span>
00665 <span class="comment">             * this type of transition and this wndproc (dwOldLong)</span>
00666 <span class="comment">             */</span>
00667             <span class="keywordflow">if</span> (dwCPDType) {
00668                 ULONG_PTR cpd;
00669 
00670                 cpd = <a class="code" href="../../d0/d5/ntuser_2kernel_2getset_8c.html#a7">GetCPD</a>(pwnd, dwCPDType | CPD_DIALOG, dwOldLong);
00671 
00672                 <span class="keywordflow">if</span> (cpd) {
00673                     dwOldLong = cpd;
00674                 } <span class="keywordflow">else</span> {
00675                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"SetWindowLong (DWL_DLGPROC) unable to alloc CPD returning handle\n"</span>);
00676                 }
00677             }
00678 
00679             <span class="comment">/*</span>
00680 <span class="comment">             * Convert a possible CallProc Handle into a real address.</span>
00681 <span class="comment">             * The app may have kept the CallProc Handle from some</span>
00682 <span class="comment">             * previous mixed GetClassinfo or SetWindowLong.</span>
00683 <span class="comment">             *</span>
00684 <span class="comment">             * WARNING bAnsi is modified here to represent real type of</span>
00685 <span class="comment">             * proc rather than if SetWindowLongA or W was called</span>
00686 <span class="comment">             */</span>
00687             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a468">ISCPDTAG</a>(dwNewLong)) {
00688                 <a class="code" href="../../d3/d7/struct__CALLPROCDATA.html">PCALLPROCDATA</a> pCPD;
00689                 <span class="keywordflow">if</span> (pCPD = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>((HANDLE)dwNewLong, TYPE_CALLPROC)) {
00690                     dwNewLong = KERNEL_ULONG_PTR_TO_ULONG_PTR(pCPD-&gt;<a class="code" href="../../d3/d7/struct__CALLPROCDATA.html#o2">pfnClientPrevious</a>);
00691                     bAnsi = pCPD-&gt;<a class="code" href="../../d3/d7/struct__CALLPROCDATA.html#o3">wType</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a460">CPD_UNICODE_TO_ANSI</a>;
00692                 }
00693             }
00694 
00695             <span class="comment">/*</span>
00696 <span class="comment">             * If an app 'unsubclasses' a server-side window proc we need to</span>
00697 <span class="comment">             * restore everything so SendMessage and friends know that it's</span>
00698 <span class="comment">             * a server-side proc again.  Need to check against client side</span>
00699 <span class="comment">             * stub addresses.</span>
00700 <span class="comment">             */</span>
00701             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;lpfnDlg = (DLGPROC)dwNewLong;
00702             <span class="keywordflow">if</span> (bAnsi) {
00703                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a794">DLGF_ANSI</a>;
00704             } <span class="keywordflow">else</span> {
00705                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;flags &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a794">DLGF_ANSI</a>;
00706             }
00707 
00708             <span class="keywordflow">return</span> dwOldLong;
00709 
00710         <span class="keywordflow">case</span> DWLP_USER:
00711 <span class="preprocessor">#ifdef BUILD_WOW6432</span>
00712 <span class="preprocessor"></span>            <span class="comment">// kernel has special handling of DWLP_USER</span>
00713             nIndex = <span class="keyword">sizeof</span>(KERNEL_LRESULT) + <span class="keyword">sizeof</span>(KERNEL_PVOID);
00714 <span class="preprocessor">#endif</span>
00715 <span class="preprocessor"></span>        <span class="keywordflow">case</span> DWLP_MSGRESULT:
00716             <span class="keywordflow">break</span>;
00717 
00718         <span class="keywordflow">default</span>:
00719             <span class="keywordflow">if</span> (nIndex &gt;= 0 &amp;&amp; nIndex &lt; DLGWINDOWEXTRA) {
00720                 RIPERR0(ERROR_PRIVATE_DIALOG_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00721                 <span class="keywordflow">return</span> 0;
00722             }
00723         }
00724     }
00725 
00726     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00727 
00728     <span class="comment">/*</span>
00729 <span class="comment">     * If this is a listbox window and the listbox structure has</span>
00730 <span class="comment">     * already been initialized, don't allow the app to override the</span>
00731 <span class="comment">     * owner draw styles. We need to do this since Windows only</span>
00732 <span class="comment">     * used the styles in creating the structure, but we also use</span>
00733 <span class="comment">     * them to determine if strings need to be thunked.</span>
00734 <span class="comment">     *</span>
00735 <span class="comment">     */</span>
00736 
00737     if (nIndex == GWL_STYLE &amp;&amp;
00738         GETFNID(pwnd) == FNID_LISTBOX &amp;&amp;
00739         ((<a class="code" href="../../d9/d9/structtagLBWND.html">PLBWND</a>)pwnd)-&gt;pLBIV != NULL &amp;&amp;
00740         (!TestWindowProcess(pwnd) || ((<a class="code" href="../../d9/d9/structtagLBWND.html">PLBWND</a>)pwnd)-&gt;pLBIV-&gt;fInitialized)) {
00741 
00742 <span class="preprocessor">#if DBG</span>
00743 <span class="preprocessor"></span>        LONG_PTR dwDebugLong = dwNewLong;
00744 <span class="preprocessor">#endif</span>
00745 <span class="preprocessor"></span>
00746         dwNewLong &amp;= ~(LBS_OWNERDRAWFIXED |
00747                        LBS_OWNERDRAWVARIABLE |
00748                        LBS_HASSTRINGS);
00749 
00750         dwNewLong |= pwnd-&gt;style &amp; (LBS_OWNERDRAWFIXED |
00751                                     LBS_OWNERDRAWVARIABLE |
00752                                     LBS_HASSTRINGS);
00753 
00754 <span class="preprocessor">#if DBG</span>
00755 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (dwDebugLong != dwNewLong) {
00756            RIPMSG0(RIP_WARNING, <span class="stringliteral">"SetWindowLong can't change LBS_OWNERDRAW* or LBS_HASSTRINGS."</span>);
00757         }
00758 <span class="preprocessor">#endif</span>
00759 <span class="preprocessor"></span>    }
00760 
00761 
00762         retval = (ULONG_PTR)<a class="code" href="../../d0/d0/ntuser_8h.html#a3">NtUserSetWindowLongPtr</a>(
00763                 hwnd,
00764                 nIndex,
00765                 dwNewLong,
00766                 bAnsi);
00767 
00768     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00769     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(LONG_PTR);
00770 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="client/ntstubs.c::_SetWindowsHookEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HHOOK _SetWindowsHookEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hmod</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPTSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszLib</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>nFilterType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PROC&nbsp;</td>
          <td class="mdname" nowrap> <em>pfnFilterProc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00258">258</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00235">CLEANUPLPWSTR</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00316">_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00230">FIRSTCOPYLPWSTROPT</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03376">NtUserSetWindowsHookEx()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00315">_IN_STRING::pstr</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/clhook_8c-source.html#l00026">SetWindowsHookExAW()</a>.
<p>
<pre class="fragment"><div>00265 {
00266     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strLib;
00267 
00268     <span class="comment">/*</span>
00269 <span class="comment">     * Make sure cleanup will work successfully</span>
00270 <span class="comment">     */</span>
00271     strLib.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00272 
00273     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00274 
00275         FIRSTCOPYLPWSTROPT(&amp;strLib, pszLib);
00276 
00277         retval = (ULONG_PTR)NtUserSetWindowsHookEx(
00278                 hmod,
00279                 strLib.pstr,
00280                 idThread,
00281                 nFilterType,
00282                 pfnFilterProc,
00283                 dwFlags);
00284 
00285     ERRORTRAP(0);
00286     CLEANUPLPWSTR(strLib);
00287     ENDCALL(HHOOK);
00288 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="client/ntstubs.c::BroadcastSystemMessageWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG BroadcastSystemMessageWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpdwRecipients</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l02439">2439</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00148">CsSendMessage</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00808">BROADCASTSYSTEMMSGPARAMS::dwFlags</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00807">BROADCASTSYSTEMMSGPARAMS::dwRecipients</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00816">FNID_SENDMESSAGEBSM</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00120">GetDesktopWindow()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00133">RESERVED_MSG_BITS</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03526">TESTSYNCONLYMESSAGE</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01760">BroadcastSystemMessage()</a>.
<p>
<pre class="fragment"><div>02446 {
02447     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  dwRecipients;
02448 
02449     <span class="comment">/*</span>
02450 <span class="comment">     * Prevent apps from setting hi 16 bits so we can use them internally.</span>
02451 <span class="comment">     */</span>
02452     <span class="keywordflow">if</span> (message &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a8">RESERVED_MSG_BITS</a>) {
02453         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"invalid message (%x) for BroadcastSystemMessage\n"</span>, message);
02454         <span class="keywordflow">return</span>(0);
02455     }
02456 
02457     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; ~BSF_VALID) {
02458         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"invalid dwFlags (%x) for BroadcastSystemMessage\n"</span>, dwFlags);
02459         <span class="keywordflow">return</span>(0);
02460     }
02461 
02462     <span class="comment">//</span>
02463     <span class="comment">// Check if the message number is in the private message range.</span>
02464     <span class="comment">// If so, do not send it to Win4.0 windows.</span>
02465     <span class="comment">// (This is required because apps like SimCity broadcast a message</span>
02466     <span class="comment">// that has the value 0x500 and that confuses MsgSrvr's</span>
02467     <span class="comment">// MSGSRVR_NOTIFY handler.</span>
02468     <span class="comment">//</span>
02469     <span class="keywordflow">if</span> ((message &gt;= WM_USER) &amp;&amp; (message &lt; 0xC000))
02470     {
02471         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"invalid message (%x) for BroadcastSystemMessage\n"</span>, message);
02472         <span class="keywordflow">return</span>(0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
02473     }
02474 
02475     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; BSF_FORCEIFHUNG)
02476         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= BSF_NOHANG;
02477 
02478     <span class="comment">//</span>
02479     <span class="comment">// If BSF_QUERY or message has a pointer, it can not be posted.</span>
02480     <span class="comment">//</span>
02481     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; BSF_QUERY)
02482     {
02483 <span class="preprocessor">#if DBG</span>
02484 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; BSF_ASYNC)
02485         {
02486             RIPMSG0(RIP_ERROR, <span class="stringliteral">"BroadcastSystemMessage: Can't post queries\n"</span>);
02487         }
02488 <span class="preprocessor">#endif</span>
02489 <span class="preprocessor"></span>
02490         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp;= ~BSF_ASYNC;          <span class="comment">// Strip the BSF_ASYNC flags.</span>
02491     }
02492 
02493     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; BSF_ASYNC) {
02494         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a918">TESTSYNCONLYMESSAGE</a>(message, wParam)) {
02495             RIPERR0(ERROR_MESSAGE_SYNC_ONLY, RIP_WARNING, <span class="stringliteral">"BroadcastSystemMessage: Can't post messages with pointers\n"</span>);
02496             <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp;= ~BSF_ASYNC;          <span class="comment">// Strip the BSF_ASYNC flags.</span>
02497         }
02498     }
02499 
02500 
02501     <span class="comment">// Let us find out who the intended recipients are.</span>
02502     <span class="keywordflow">if</span> (lpdwRecipients != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02503         dwRecipients = *lpdwRecipients;
02504     <span class="keywordflow">else</span>
02505         dwRecipients = BSM_ALLCOMPONENTS;
02506 
02507     <span class="comment">// if they want all components, add the corresponding bits</span>
02508     <span class="keywordflow">if</span> ((dwRecipients &amp; BSM_COMPONENTS) == BSM_ALLCOMPONENTS)
02509         dwRecipients |= (BSM_VXDS | BSM_NETDRIVER | BSM_INSTALLABLEDRIVERS |
02510                              BSM_APPLICATIONS);
02511 
02512 
02513     <span class="keywordflow">if</span> (dwRecipients &amp; ~BSM_VALID) {
02514         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"invalid dwRecipients (%x) for BroadcastSystemMessage\n"</span>, dwRecipients);
02515         <span class="keywordflow">return</span>(0);
02516     }
02517 
02518     <span class="comment">//</span>
02519     <span class="comment">// Check if this is a WM_USERCHANGED message; If so, we want to reload</span>
02520     <span class="comment">// the per-user settings before anyone else sees this message.</span>
02521     <span class="comment">//</span>
02522     <span class="comment">// LATER -- FritzS</span>
02523 <span class="comment">//    if (uiMessage == WM_USERCHANGED)</span>
02524 <span class="comment">//        ReloadPerUserSettings();</span>
02525 
02526 
02527     <span class="comment">// Does this need to be sent to all apps?</span>
02528     <span class="keywordflow">if</span> (dwRecipients &amp; BSM_APPLICATIONS)
02529     {
02530         <a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html">BROADCASTSYSTEMMSGPARAMS</a> bsmParams;
02531 
02532         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o1">dwFlags</a> = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
02533         bsmParams.<a class="code" href="../../d3/d1/structBROADCASTSYSTEMMSGPARAMS.html#o0">dwRecipients</a> = dwRecipients;
02534 
02535         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d0/usercli_8h.html#a11">CsSendMessage</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a4">GetDesktopWindow</a>(), message, wParam, lParam,
02536             (ULONG_PTR)&amp;bsmParams, FNID_SENDMESSAGEBSM, fAnsi);
02537     }
02538 
02539     <span class="keywordflow">return</span> -1;
02540 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="client/ntstubs.c::ConvertMemHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE ConvertMemHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cbNULL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00189">189</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03310">NtUserConvertMemHandle()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l00390">GetClipboardData()</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l00876">SetClipboardData()</a>.
<p>
<pre class="fragment"><div>00192 {
00193     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cbData;
00194     LPBYTE lpData;
00195 
00196     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00197 
00198         if (GlobalFlags(hData) == GMEM_INVALID_HANDLE) {
00199             RIPMSG0(RIP_WARNING, <span class="stringliteral">"ConvertMemHandle hMem is not valid\n"</span>);
00200             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00201             }
00202 
00203         <span class="keywordflow">if</span> (!(cbData = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)GlobalSize(hData)))
00204             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00205 
00206         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hData, lpData);
00207         <span class="keywordflow">if</span> (lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00208             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00209         }
00210 
00211         <span class="comment">/*</span>
00212 <span class="comment">         * Make sure text formats are NULL terminated.</span>
00213 <span class="comment">         */</span>
00214         <span class="keywordflow">switch</span> (cbNULL) {
00215         <span class="keywordflow">case</span> 2:
00216             lpData[cbData - 2] = 0;
00217             <span class="comment">// FALL THROUGH</span>
00218         <span class="keywordflow">case</span> 1:
00219             lpData[cbData - 1] = 0;
00220         }
00221 
00222         retval = (ULONG_PTR)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a132">NtUserConvertMemHandle</a>(lpData, cbData);
00223 
00224         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hData);
00225 
00226     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(NULL);
00227     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(HANDLE);
00228 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="client/ntstubs.c::CreateLocalMemHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE CreateLocalMemHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hMem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00230">230</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03336">NtUserCreateLocalMemHandle()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l00390">GetClipboardData()</a>.
<p>
<pre class="fragment"><div>00232 {
00233     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cbData;
00234     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00235 
00236     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00237 
00238         Status = NtUserCreateLocalMemHandle(hMem, NULL, 0, &amp;cbData);
00239         if (Status != STATUS_BUFFER_TOO_SMALL) {
00240             RIPMSG0(RIP_WARNING, <span class="stringliteral">"__CreateLocalMemHandle server returned failure\n"</span>);
00241             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00242         }
00243 
00244         <span class="keywordflow">if</span> (!(retval = (ULONG_PTR)GlobalAlloc(GMEM_FIXED, cbData)))
00245             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00246 
00247         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a133">NtUserCreateLocalMemHandle</a>(hMem, (LPBYTE)retval, cbData, NULL);
00248         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00249             RIPMSG0(RIP_WARNING, <span class="stringliteral">"__CreateLocalMemHandle server returned failure\n"</span>);
00250             <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>((HANDLE)retval);
00251             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00252         }
00253 
00254     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00255     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(HANDLE);
00256 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="client/ntstubs.c::DrawCaption" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DrawCaption           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CONST RECT *&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00446">446</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d1/client_2drawtext_8c-source.html#l00027">IsMetaFile()</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04852">NtUserDrawCaption()</a>.
<p>
<pre class="fragment"><div>00451 {
00452     HDC hdcr;
00453     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00454 
00455         if (IsMetaFile(hdc))
00456             return FALSE;
00457 
00458         hdcr = GdiConvertAndCheckDC(hdc);
00459         if (hdcr == (HDC)0)
00460             return FALSE;
00461 
00462         retval = (DWORD)NtUserDrawCaption(hwnd, hdcr, lprc, flags);
00463 
00464     ERRORTRAP(0);
00465     ENDCALL(BOOL);
00466 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="client/ntstubs.c::Event" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d4/structtagEVENT__PACKET.html">PEVENT_PACKET</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pep</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">86</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00059">CheckDDECritOut</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l02956">NtUserEvent()</a>, and <a class="el" href="../../d1/d8/w32_2ntuser_2kernel_2event_8c.html#a2">pep</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02717">CcSetValidData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01062">CcWaitOnActiveCount()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00410">ExpAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03060">ExpGetProcessInformation()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00273">ExReinitializeResourceLite()</a>, <a class="el" href="../../d8/d0/faulttol_8c-source.html#l00031">FsRtlBalanceReads()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02691">FsRtlGetFileSize()</a>, <a class="el" href="../../d4/d8/fsrtl_2pnp_8c-source.html#l00041">FsRtlNotifyVolumeEvent()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02454">FsRtlOplockBreakToII()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00177">FsRtlPostPagingFileStackOverflow()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00139">FsRtlPostStackOverflow()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00215">FsRtlpPostStackOverflow()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02864">FsRtlSetFileSize()</a>, <a class="el" href="../../d8/d0/faulttol_8c-source.html#l00096">FsRtlSyncVolumes()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03025">FsRtlWaitOnIrp()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01552">IoBuildDeviceIoControlRequest()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01933">IoBuildSynchronousFsdRequest()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01300">IoFreeDumpStack()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08509">IoPageRead()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00417">IopCancelAlertedRequest()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l00384">IopGetDumpStack()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06926">IopSynchronousApiServiceTail()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07272">IopTrackLink()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08084">IopXxxControlFile()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10957">IoSynchronousPageWrite()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00486">IovBuildDeviceIoControlRequest()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00453">KdUpdateTimeSlipEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00134">KeClearEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00053">KeInitializeEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00167">KePulseEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00253">KeReadStateEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00285">KeResetEvent()</a>, <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html#l00454">KeSetAutoAlignmentThread()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00458">KeSetEventBoostPriority()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l01544">MiDereferenceSession()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00941">MiEnsureAvailablePageOrWait()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03523">MiInitializeReadInProgressPfn()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l05287">MiMakeOutswappedPageResident()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00191">MiSegmentDelete()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00243">MiUnmapImageHeaderInHyperSpace()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l01695">MmCleanProcessAddressSpace()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01274">MmCopyToCachedPage()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d8/d2/monitor_8c-source.html#l00167">MonitorConv()</a>, <a class="el" href="../../d8/d2/monitor_8c-source.html#l00090">MonitorLink()</a>, <a class="el" href="../../d8/d2/monitor_8c-source.html#l00031">MonitorStringHandle()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00126">NtClearEvent()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d2/d6/io_2devctrl_8c-source.html#l00034">NtDeviceIoControlFile()</a>, <a class="el" href="../../d9/d6/io_2fsctrl_8c-source.html#l00034">NtFsControlFile()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00821">NtNotifyChangeDirectoryFile()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01156">NtNotifyChangeKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00412">NtPulseEvent()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00682">NtQueryDirectoryFile()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00514">NtQueryEvent()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00648">NtResetEvent()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00035">NtWriteFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l01145">RtlDeleteTimer()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l00809">RtlDeleteTimerQueueEx()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l00256">RtlDeregisterWaitEx()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05648">RtlpFreeWaitEvent()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05575">RtlpGetWaitEvent()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05503">RtlpWaitForEvent()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l00077">RtlRegisterWait()</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00573">UdfPerformDevIoCtrl()</a>, <a class="el" href="../../d5/d8/udfs_2pnp_8c-source.html#l00710">UdfPnpCompletionRoutine()</a>, <a class="el" href="../../d5/d8/udfs_2pnp_8c-source.html#l00194">UdfPnpQueryRemove()</a>, <a class="el" href="../../d5/d8/udfs_2pnp_8c-source.html#l00350">UdfPnpRemove()</a>, <a class="el" href="../../d5/d8/udfs_2pnp_8c-source.html#l00500">UdfPnpSurpriseRemove()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00685">UdfReadSectors()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00408">VdmpQueueIntNormalRoutine()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02160">VerifierSetEvent()</a>.
<p>
<pre class="fragment"><div>00088 {
00089     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00090 
00091         CheckDDECritOut;
00092 
00093         retval = (DWORD)NtUserEvent(
00094                 pep);
00095 
00096     ERRORTRAP(0);
00097     ENDCALL(DWORD);
00098 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="client/ntstubs.c::FindExistingCursorIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HCURSOR FindExistingCursorIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszModName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszResName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d1/structtagCURSORFIND.html">PCURSORFIND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcfSearch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01102">1102</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00235">CLEANUPLPWSTR</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00183">COPYLPWSTR</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00188">COPYLPWSTRID</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00316">_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07243">NtUserFindExistingCursorIcon()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00315">_IN_STRING::pstr</a>, and <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00063">szUSER32</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/clres_8c-source.html#l04436">CopyImageFromRes()</a>, and <a class="el" href="../../d5/d8/clres_8c-source.html#l02657">LoadIcoCur()</a>.
<p>
<pre class="fragment"><div>01106 {
01107     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strModName;
01108     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strResName;
01109 
01110     <span class="comment">/*</span>
01111 <span class="comment">     * Make sure cleanup will work successfully</span>
01112 <span class="comment">     */</span>
01113     strModName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01114     strResName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01115 
01116     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01117 
01118         if (pszModName == NULL)
01119             pszModName = szUSER32;
01120 
01121         COPYLPWSTR(&amp;strModName, pszModName);
01122         COPYLPWSTRID(&amp;strResName, pszResName);
01123 
01124         retval = (ULONG_PTR)NtUserFindExistingCursorIcon(strModName.pstr,
01125                                                      strResName.pstr,
01126                                                      pcfSearch);
01127 
01128     ERRORTRAP(0);
01129 
01130     CLEANUPLPWSTR(strModName);
01131     CLEANUPLPWSTR(strResName);
01132 
01133     ENDCALL(HCURSOR);
01134 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="client/ntstubs.c::GetAsyncKeyState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> GetAsyncKeyState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>vKey</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00468">468</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00542">_CLIENTINFO::afAsyncKeyState</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00543">_CLIENTINFO::afAsyncKeyStateRecentDown</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00014">BEGINCALLCONNECT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00495">CVKASYNCKEYCACHE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00541">_CLIENTINFO::dwAsyncKeyCache</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04907">NtUserGetAsyncKeyState()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02934">TestKeyDownBit</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02948">TestKeyRecentDownBit</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/bench_8c-source.html#l01543">msProfGetAsyncKeyState()</a>.
<p>
<pre class="fragment"><div>00470 {
00471     <a class="code" href="../../d7/d9/ntsend_8h.html#a0">BEGINCALLCONNECT</a>()
00472 
00473         <span class="comment">/*</span>
00474 <span class="comment">         * Asynchronous key state reports the PHYSICAL mouse button,</span>
00475 <span class="comment">         * regardless of whether the buttons have been swapped or not.</span>
00476 <span class="comment">         */</span>
00477         if (((vKey == VK_RBUTTON) || (vKey == VK_LBUTTON)) &amp;&amp; SYSMET(SWAPBUTTON)) {
00478             vKey ^= (VK_RBUTTON ^ VK_LBUTTON);
00479         }
00480 
00481         <span class="comment">/*</span>
00482 <span class="comment">         * If this is one of the common keys, see if we can pull it out</span>
00483 <span class="comment">         * of the cache.</span>
00484 <span class="comment">         */</span>
00485         <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)vKey &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a110">CVKASYNCKEYCACHE</a>) {
00486             <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00487             <span class="keywordflow">if</span> ((pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o17">dwAsyncKeyCache</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dwAsyncKeyCache) &amp;&amp;
00488                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a834">TestKeyRecentDownBit</a>(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o19">afAsyncKeyStateRecentDown</a>, vKey)) {
00489 
00490                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a827">TestKeyDownBit</a>(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o18">afAsyncKeyState</a>, vKey))
00491                     retval = 0x8000;
00492                 <span class="keywordflow">else</span>
00493                     retval = 0;
00494 
00495                 <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)retval;
00496             }
00497         }
00498 
00499         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a189">NtUserGetAsyncKeyState</a>(
00500                 vKey);
00501 
00502     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00503     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(SHORT);
00504 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="client/ntstubs.c::GetClassWOWWords" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG GetClassWOWWords           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HINSTANCE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCTSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00100">100</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d6/d6/classc_8c-source.html#l00100">_GetClassData()</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00176">CLEANUPLPSTRW</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00316">_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00132">FIRSTCOPYLPSTRW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00072">MSGERRORCODE</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03023">NtUserGetWOWClass()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00315">_IN_STRING::pstr</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l02696">UserRegisterWowHandlers()</a>.
<p>
<pre class="fragment"><div>00103 {
00104     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strClassName;
00105     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls;
00106 
00107     <span class="comment">/*</span>
00108 <span class="comment">     * Make sure cleanup will work successfully</span>
00109 <span class="comment">     */</span>
00110     strClassName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00111 
00112     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00113 
00114         FIRSTCOPYLPSTRW(&amp;strClassName, pString);
00115 
00116         pcls = NtUserGetWOWClass(hInstance, strClassName.pstr);
00117 
00118         if (pcls == NULL) {
00119             <a class="code" href="../../d5/d8/crecv_8c.html#a8">MSGERRORCODE</a>(ERROR_CLASS_DOES_NOT_EXIST);
00120         }
00121 
00122         pcls = (<a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pcls - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;ulClientDelta);
00123         retval = <a class="code" href="../../d6/d0/usercli_8h.html#a631">_GetClassData</a>(pcls, NULL, GCLP_WOWWORDS, TRUE);
00124 
00125     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00126     <a class="code" href="../../d7/d9/ntsend_8h.html#a29">CLEANUPLPSTRW</a>(strClassName);
00127     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(LONG);
00128 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="client/ntstubs.c::GetKeyState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> GetKeyState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>vKey</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">506</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00540">_CLIENTINFO::afKeyState</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00014">BEGINCALLCONNECT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00492">CVKKEYCACHE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00539">_CLIENTINFO::dwKeyCache</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09596">NtUserGetKeyState()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02934">TestKeyDownBit</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02940">TestKeyToggleBit</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d2/d3/combo_8c-source.html#l00207">ComboBoxWndProcWorker()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l01036">DialogBox2()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00733">ECGetModKeys()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02179">GetControlKeyState()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l03080">HandleMouseEvent()</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02272">HandleSysKeyEvent()</a>, <a class="el" href="../../d6/d8/dlgmgr2_8c-source.html#l00317">IsDialogMessageW()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00209">MakeInfoStringJapan()</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l01527">msProfGetKeyState()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>, <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l00096">TranslateMDISysAccel()</a>, <a class="el" href="../../d0/d1/lboxctl2_8c-source.html#l02948">xxxLBoxCtlCharInput()</a>, <a class="el" href="../../d0/d1/lboxctl2_8c-source.html#l02183">xxxLBoxCtlKeyInput()</a>, and <a class="el" href="../../d0/d1/lboxctl2_8c-source.html#l01290">xxxTrackMouse()</a>.
<p>
<pre class="fragment"><div>00508 {
00509     <a class="code" href="../../d7/d9/ntsend_8h.html#a0">BEGINCALLCONNECT</a>()
00510 
00511         <span class="comment">/*</span>
00512 <span class="comment">         * If this is one of the common keys, see if we can pull it out</span>
00513 <span class="comment">         * of the cache.</span>
00514 <span class="comment">         */</span>
00515         if ((UINT)vKey &lt; CVKKEYCACHE) {
00516             <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00517             <span class="keywordflow">if</span> (pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o15">dwKeyCache</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dwKeyCache) {
00518                 retval = 0;
00519                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a830">TestKeyToggleBit</a>(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o16">afKeyState</a>, vKey))
00520                     retval |= 0x0001;
00521                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a827">TestKeyDownBit</a>(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o16">afKeyState</a>, vKey)) {
00522                   <span class="comment">/*</span>
00523 <span class="comment">                   * Used to be retval |= 0x8000.Fix for bug 28820; Ctrl-Enter</span>
00524 <span class="comment">                   * accelerator doesn't work on Nestscape Navigator Mail 2.0</span>
00525 <span class="comment">                   */</span>
00526                     retval |= 0xff80;  <span class="comment">// This is what 3.1 returned!!!!</span>
00527                 }
00528 
00529                 <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)retval;
00530             }
00531         }
00532 
00533         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a327">NtUserGetKeyState</a>(
00534                 vKey);
00535 
00536     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00537     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(SHORT);
00538 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="client/ntstubs.c::GetRemoteKeyboardLayout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL GetRemoteKeyboardLayout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWCHAR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/client_8c-source.html#l02091">2091</a> of file <a class="el" href="../../d4/d7/client_8c-source.html">client.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01983">GetServerIMEKeyboardLayout()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00149">IS_IME_KBDLAYOUT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00293">ISREMOTESESSION</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01931">WinStaQueryInformationW()</a>, and <a class="el" href="../../d7/d9/wsprintf_8c-source.html#l00995">wsprintfW()</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00049">UpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>02093 {
02094     ULONG                        KeyboardLayout;
02095     ULONG                        Length;
02096     WINSTATIONCONFIG             ConfigData;
02097 
02098     <span class="comment">/*</span>
02099 <span class="comment">     * Skip if this is the main session</span>
02100 <span class="comment">     */</span>
02101     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a30">ISREMOTESESSION</a>()) {
02102         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02103     }
02104 
02105     <span class="comment">/*</span>
02106 <span class="comment">     * Fetch the WinStation's basic information</span>
02107 <span class="comment">     */</span>
02108     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d8/client_8c.html#a66">WinStaQueryInformationW</a>(SERVERNAME_CURRENT,
02109                                 LOGONID_CURRENT,
02110                                 WinStationConfiguration,
02111                                 &amp;ConfigData,
02112                                 <span class="keyword">sizeof</span>(ConfigData),
02113                                 &amp;Length)) {
02114 
02115         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02116     }
02117 
02118     KeyboardLayout = ConfigData.User.KeyboardLayout;
02119 
02120     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>()) {
02121         WINSTATIONCLIENTW ClientData;
02122 
02123         <span class="comment">// Fetch the WinStation's basic information</span>
02124         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d8/client_8c.html#a66">WinStaQueryInformationW</a>(SERVERNAME_CURRENT,
02125                                            LOGONID_CURRENT,
02126                                            WinStationClient,
02127                                            &amp;ClientData,
02128                                            <span class="keyword">sizeof</span>(ClientData),
02129                                            &amp;Length)) {
02130             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02131         }
02132 
02133         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(ConfigData.User.KeyboardLayout)) {
02134             KeyboardLayout = <a class="code" href="../../d3/d8/client_8c.html#a67">GetServerIMEKeyboardLayout</a>(ClientData.imeFileName);
02135         }
02136     }
02137 
02138     <span class="keywordflow">if</span> (KeyboardLayout != 0) {
02139         <a class="code" href="../../d6/d0/wsprintf_8c.html#a10">wsprintfW</a>(LayoutBuf, L<span class="stringliteral">"%8.8lx"</span>, KeyboardLayout);
02140         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02141     }
02142 
02143     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02144 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="client/ntstubs.c::InitTask" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InitTask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wVersion</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwAppCompatFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszModName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszBaseFileName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>hTaskWow</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwHotkey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idTask</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwX</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwY</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwXSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwYSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00140">140</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00176">CLEANUPLPSTRW</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00087">COPYLPSTRW</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00316">_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00132">FIRSTCOPYLPSTRW</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03098">NtUserInitTask()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00315">_IN_STRING::pstr</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l02696">UserRegisterWowHandlers()</a>.
<p>
<pre class="fragment"><div>00152 {
00153     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strModName;
00154     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strBaseFileName;
00155     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00156 
00157     <span class="comment">/*</span>
00158 <span class="comment">     * Make sure cleanup will work successfully</span>
00159 <span class="comment">     */</span>
00160     strModName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00161     strBaseFileName.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00162 
00163     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00164 
00165         FIRSTCOPYLPSTRW(&amp;strModName, pszModName);
00166         COPYLPSTRW(&amp;strBaseFileName, pszBaseFileName);
00167 
00168         Status = NtUserInitTask(
00169                 wVersion,
00170                 dwAppCompatFlags,
00171                 strModName.pstr,
00172                 strBaseFileName.pstr,
00173                 hTaskWow,
00174                 dwHotkey,
00175                 idTask,
00176                 dwX,
00177                 dwY,
00178                 dwXSize,
00179                 dwYSize);
00180         retval = (Status == STATUS_SUCCESS);
00181 
00182         CLEANUPLPSTRW(strModName);
00183         CLEANUPLPSTRW(strBaseFileName);
00184 
00185     ERRORTRAP(FALSE);
00186     ENDCALL(BOOL);
00187 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="client/ntstubs.c::InternalGetWindowText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InternalGetWindowText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cchMaxCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00926">926</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06874">NtUserInternalGetWindowText()</a>.
<p>
<pre class="fragment"><div>00930 {
00931     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00932 
00933         retval = (DWORD)NtUserInternalGetWindowText(
00934                 hwnd,
00935                 pString,
00936                 cchMaxCount);
00937 
00938         if (!retval) {
00939             *pString = (WCHAR)0;
00940         }
00941 
00942     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00943     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
00944 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="client/ntstubs.c::keybd_event" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID keybd_event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>bVk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>bScan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>dwExtraInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01419">1419</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00032">BEGINCALLVOID</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00051">ENDCALLVOID</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08617">NtUserSendInput()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/sftkbdc1_8c-source.html#l00914">SKC1ButtonUp()</a>, <a class="el" href="../../d7/d7/sftkbdt1_8c-source.html#l01099">SKT1ButtonUp()</a>, and <a class="el" href="../../d7/d7/sftkbdt1_8c-source.html#l00968">SKT1SetCursor()</a>.
<p>
<pre class="fragment"><div>01424 {
01425     INPUT kbd;
01426 
01427     <a class="code" href="../../d7/d9/ntsend_8h.html#a2">BEGINCALLVOID</a>()
01428 
01429         kbd.type           = INPUT_KEYBOARD;
01430         kbd.ki.dwFlags     = dwFlags;
01431         kbd.ki.wVk         = bVk;
01432         kbd.ki.wScan       = bScan;
01433         kbd.ki.time        = 0;
01434         kbd.ki.dwExtraInfo = dwExtraInfo;
01435 
01436         NtUserSendInput(1, &amp;kbd, sizeof(INPUT));
01437 
01438     ENDCALLVOID()
01439 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnCBGETEDITSEL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l02320">2320</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02410">CalcAnsiStringLengthA</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02435">CalcUnicodeStringLengthW</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02286">WFANSIPROC</a>.
<p>
<pre class="fragment"><div>02321 {
02322     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
02323 
02324     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02325         <span class="keywordflow">return</span> 0;
02326 
02327     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
02328 
02329         retval = (DWORD)NtUserMessageCall(
02330                 hwnd,
02331                 msg,
02332                 wParam,
02333                 lParam,
02334                 xParam,
02335                 xpfnProc,
02336                 bAnsi);
02337 
02338         <span class="comment">//</span>
02339         <span class="comment">// temp for our beta...</span>
02340         <span class="comment">//</span>
02341         <span class="comment">// !!! THIS CODE SHOULD BE IN KERNEL MODE !!!</span>
02342         <span class="comment">//</span>
02343         <span class="comment">// to reduce user &lt;-&gt; kernel mode transition...</span>
02344         <span class="comment">//</span>
02345         if (bAnsi != ((TestWF(pwnd, WFANSIPROC)) ? TRUE : FALSE)) {
02346             ULONG  cchTextLength;
02347             LONG   lOriginalLengthW = *(LONG *)wParam;
02348             LONG   lOriginalLengthL = *(LONG *)lParam;
02349             LONG   wParamLocal;
02350             LONG   lParamLocal;
02351 
02352             <span class="keywordflow">if</span> (wParam) {
02353                 lOriginalLengthW = *(LONG *)wParam;
02354             } <span class="keywordflow">else</span> {
02355                 lOriginalLengthW = (LONG)(LOWORD(retval));
02356             }
02357 
02358             <span class="keywordflow">if</span> (lParam) {
02359                 lOriginalLengthL = *(LONG *)lParam;
02360             } <span class="keywordflow">else</span> {
02361                 lOriginalLengthL = (LONG)(HIWORD(retval));
02362             }
02363 
02364             cchTextLength = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02365                            hwnd,
02366                            WM_GETTEXTLENGTH,
02367                            (WPARAM)0,
02368                            (LPARAM)0,
02369                            xParam,
02370                            xpfnProc,
02371                            bAnsi);
02372 
02373             <span class="keywordflow">if</span> (cchTextLength) {
02374                 PVOID pvString;
02375                 ULONG cbTextLength;
02376 
02377                 cchTextLength++;
02378                 <span class="keywordflow">if</span> (!bAnsi) {
02379                     cbTextLength = cchTextLength * <span class="keyword">sizeof</span>(WCHAR);
02380                 } <span class="keywordflow">else</span> {
02381                     cbTextLength = cchTextLength;
02382                 }
02383 
02384                 pvString = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0,cbTextLength);
02385 
02386                 <span class="keywordflow">if</span> (pvString) {
02387 
02388                     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02389                             hwnd,
02390                             WM_GETTEXT,
02391                             cchTextLength,
02392                             (LPARAM)pvString,
02393                             xParam,
02394                             xpfnProc,
02395                             bAnsi);
02396 
02397                     <span class="keywordflow">if</span> (retval) {
02398                         <span class="keywordflow">if</span> (bAnsi) {
02399                             <span class="comment">/*</span>
02400 <span class="comment">                             * ansiString/unicodeLenght -&gt; ansiLength</span>
02401 <span class="comment">                             */</span>
02402                             <a class="code" href="../../d6/d0/usercli_8h.html#a301">CalcAnsiStringLengthA</a>(pvString, lOriginalLengthW, &amp;wParamLocal);
02403                             <a class="code" href="../../d6/d0/usercli_8h.html#a301">CalcAnsiStringLengthA</a>(pvString, lOriginalLengthL, &amp;lParamLocal);
02404                         } <span class="keywordflow">else</span> {
02405                             <span class="comment">/*</span>
02406 <span class="comment">                             * unicodeString/ansiLenght -&gt; unicodeLength</span>
02407 <span class="comment">                             */</span>
02408                             <a class="code" href="../../d6/d0/usercli_8h.html#a303">CalcUnicodeStringLengthW</a>(pvString, lOriginalLengthW, &amp;wParamLocal);
02409                             <a class="code" href="../../d6/d0/usercli_8h.html#a303">CalcUnicodeStringLengthW</a>(pvString, lOriginalLengthL, &amp;lParamLocal);
02410                         }
02411 
02412                         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(((lParamLocal) &lt;&lt; 16) | ((wParamLocal) &amp; 0x0000FFFF));
02413 
02414                         <span class="keywordflow">if</span> (wParam) {
02415                             *(LONG *)wParam = wParamLocal;
02416                         }
02417 
02418                         <span class="keywordflow">if</span> (lParam) {
02419                             *(LONG *)lParam = lParamLocal;
02420                         }
02421 
02422                     } <span class="keywordflow">else</span> {
02423                         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvString);
02424                         <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02425                     }
02426 
02427                     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvString);
02428 
02429                 } <span class="keywordflow">else</span>
02430                     <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02431             } <span class="keywordflow">else</span>
02432                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02433         }
02434 
02435     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
02436     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
02437 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnEMSETSEL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l02208">2208</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02402">CalcAnsiStringLengthW</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02426">CalcUnicodeStringLengthA</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02286">WFANSIPROC</a>.
<p>
<pre class="fragment"><div>02209 {
02210     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
02211 
02212     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02213         <span class="keywordflow">return</span> 0;
02214 
02215     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
02216 
02217         <span class="comment">//</span>
02218         <span class="comment">// temp for our beta...</span>
02219         <span class="comment">//</span>
02220         <span class="comment">// !!! THIS CODE SHOULD BE IN KERNEL MODE !!!</span>
02221         <span class="comment">//</span>
02222         <span class="comment">// to reduce user &lt;-&gt; kernel mode transition...</span>
02223         <span class="comment">//</span>
02224         if (bAnsi != ((TestWF(pwnd, WFANSIPROC)) ? TRUE : FALSE)) {
02225             <span class="keywordflow">if</span> (((LONG)wParam &lt;= 0) &amp;&amp; ((LONG)lParam &lt;=0)) {
02226                 <span class="comment">//</span>
02227                 <span class="comment">// if (wParam == 0 or wParam == -1)</span>
02228                 <span class="comment">//               and</span>
02229                 <span class="comment">//    (lParam == 0 or lParam == -1)</span>
02230                 <span class="comment">//</span>
02231                 <span class="comment">// In this case, we don't need to convert the value...</span>
02232                 <span class="comment">//</span>
02233             } <span class="keywordflow">else</span> {
02234                 ULONG  cchTextLength;
02235                 LONG   lOriginalLengthW = (LONG)wParam;
02236                 LONG   lOriginalLengthL = (LONG)lParam;
02237 
02238                 cchTextLength = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02239                                hwnd,
02240                                WM_GETTEXTLENGTH,
02241                                (WPARAM)0,
02242                                (LPARAM)0,
02243                                xParam,
02244                                xpfnProc,
02245                                bAnsi);
02246 
02247                 <span class="keywordflow">if</span> (cchTextLength) {
02248                     PVOID pvString;
02249                     ULONG cbTextLength;
02250 
02251                     cchTextLength++;
02252                     <span class="keywordflow">if</span> (!bAnsi) {
02253                         cbTextLength = cchTextLength * <span class="keyword">sizeof</span>(WCHAR);
02254                     } <span class="keywordflow">else</span> {
02255                         cbTextLength = cchTextLength;
02256                     }
02257 
02258                     pvString = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0,cbTextLength);
02259 
02260                     <span class="keywordflow">if</span> (pvString) {
02261 
02262                         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02263                                 hwnd,
02264                                 WM_GETTEXT,
02265                                 cchTextLength,
02266                                 (LPARAM)pvString,
02267                                 xParam,
02268                                 xpfnProc,
02269                                 bAnsi);
02270 
02271                         <span class="keywordflow">if</span> (retval) {
02272                             <span class="keywordflow">if</span> ((LONG)retval &lt; lOriginalLengthW) {
02273                                 lOriginalLengthW = (LONG)retval;
02274                             }
02275                             <span class="keywordflow">if</span> ((LONG)retval &lt; lOriginalLengthL) {
02276                                 lOriginalLengthL = (LONG)retval;
02277                             }
02278                             <span class="keywordflow">if</span> (bAnsi) {
02279                                 <span class="keywordflow">if</span> (lOriginalLengthW &gt; 0) {
02280                                     <a class="code" href="../../d6/d0/usercli_8h.html#a302">CalcUnicodeStringLengthA</a>(pvString, lOriginalLengthW, &amp;wParam);
02281                                 }
02282                                 <span class="keywordflow">if</span>(lOriginalLengthL &gt; 0) {
02283                                     <a class="code" href="../../d6/d0/usercli_8h.html#a302">CalcUnicodeStringLengthA</a>(pvString, lOriginalLengthL, &amp;lParam);
02284                                 }
02285                             } <span class="keywordflow">else</span> {
02286                                 <span class="keywordflow">if</span> (lOriginalLengthW &gt; 0) {
02287                                     <a class="code" href="../../d6/d0/usercli_8h.html#a300">CalcAnsiStringLengthW</a>(pvString, lOriginalLengthW, &amp;wParam);
02288                                 }
02289                                 <span class="keywordflow">if</span>(lOriginalLengthL &gt; 0) {
02290                                     <a class="code" href="../../d6/d0/usercli_8h.html#a300">CalcAnsiStringLengthW</a>(pvString, lOriginalLengthL, &amp;lParam);
02291                                 }
02292                             }
02293                         } <span class="keywordflow">else</span> {
02294                             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvString);
02295                             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02296                         }
02297 
02298                         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvString);
02299 
02300                     } <span class="keywordflow">else</span>
02301                         <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02302                 } <span class="keywordflow">else</span>
02303                     <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02304             }
02305         }
02306 
02307         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02308                 hwnd,
02309                 msg,
02310                 wParam,
02311                 lParam,
02312                 xParam,
02313                 xpfnProc,
02314                 bAnsi);
02315 
02316     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
02317     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
02318 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnEMGETSEL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l02089">2089</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02410">CalcAnsiStringLengthA</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02435">CalcUnicodeStringLengthW</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02286">WFANSIPROC</a>.
<p>
<pre class="fragment"><div>02090 {
02091     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
02092 
02093     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02094         <span class="keywordflow">return</span> 0;
02095 
02096     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
02097 
02098         retval = (DWORD)NtUserMessageCall(
02099                 hwnd,
02100                 msg,
02101                 wParam,
02102                 lParam,
02103                 xParam,
02104                 xpfnProc,
02105                 bAnsi);
02106 
02107         <span class="comment">//</span>
02108         <span class="comment">// temp for our beta...</span>
02109         <span class="comment">//</span>
02110         <span class="comment">// !!! THIS CODE SHOULD BE IN KERNEL MODE !!!</span>
02111         <span class="comment">//</span>
02112         <span class="comment">// to reduce user &lt;-&gt; kernel mode transition...</span>
02113         <span class="comment">//</span>
02114         if (bAnsi != ((TestWF(pwnd, WFANSIPROC)) ? TRUE : FALSE)) {
02115             ULONG  cchTextLength;
02116             LONG   lOriginalLengthW;
02117             LONG   lOriginalLengthL;
02118             LONG   wParamLocal;
02119             LONG   lParamLocal;
02120 
02121             <span class="keywordflow">if</span> (wParam) {
02122                 lOriginalLengthW = *(LONG *)wParam;
02123             } <span class="keywordflow">else</span> {
02124                 lOriginalLengthW = (LONG)(LOWORD(retval));
02125             }
02126 
02127             <span class="keywordflow">if</span> (lParam) {
02128                 lOriginalLengthL = *(LONG *)lParam;
02129             } <span class="keywordflow">else</span> {
02130                 lOriginalLengthL = (LONG)(HIWORD(retval));
02131             }
02132 
02133             cchTextLength = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02134                            hwnd,
02135                            WM_GETTEXTLENGTH,
02136                            (WPARAM)0,
02137                            (LPARAM)0,
02138                            xParam,
02139                            xpfnProc,
02140                            bAnsi);
02141 
02142             <span class="keywordflow">if</span> (cchTextLength) {
02143                 PVOID pvString;
02144                 ULONG cbTextLength;
02145 
02146                 cchTextLength++;
02147                 <span class="keywordflow">if</span> (!bAnsi) {
02148                     cbTextLength = cchTextLength * <span class="keyword">sizeof</span>(WCHAR);
02149                 } <span class="keywordflow">else</span> {
02150                     cbTextLength = cchTextLength;
02151                 }
02152 
02153                 pvString = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0,cbTextLength);
02154 
02155                 <span class="keywordflow">if</span> (pvString) {
02156 
02157                     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
02158                             hwnd,
02159                             WM_GETTEXT,
02160                             cchTextLength,
02161                             (LPARAM)pvString,
02162                             xParam,
02163                             xpfnProc,
02164                             bAnsi);
02165 
02166                     <span class="keywordflow">if</span> (retval) {
02167                         <span class="keywordflow">if</span> (bAnsi) {
02168                             <span class="comment">/*</span>
02169 <span class="comment">                             * ansiString/unicodeLenght -&gt; ansiLength</span>
02170 <span class="comment">                             */</span>
02171                             <a class="code" href="../../d6/d0/usercli_8h.html#a301">CalcAnsiStringLengthA</a>(pvString, lOriginalLengthW, &amp;wParamLocal)
02172                             CalcAnsiStringLengthA(pvString, lOriginalLengthL, &amp;lParamLocal);
02173                         } else {
02174                             <span class="comment">/*</span>
02175 <span class="comment">                             * unicodeString/ansiLenght -&gt; unicodeLength</span>
02176 <span class="comment">                             */</span>
02177                             <a class="code" href="../../d6/d0/usercli_8h.html#a303">CalcUnicodeStringLengthW</a>(pvString, lOriginalLengthW, &amp;wParamLocal);
02178                             <a class="code" href="../../d6/d0/usercli_8h.html#a303">CalcUnicodeStringLengthW</a>(pvString, lOriginalLengthL, &amp;lParamLocal);
02179                         }
02180 
02181                         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(((lParamLocal) &lt;&lt; 16) | ((wParamLocal) &amp; 0x0000FFFF));
02182 
02183                         <span class="keywordflow">if</span> (wParam) {
02184                             *(LONG *)wParam = wParamLocal;
02185                         }
02186 
02187                         <span class="keywordflow">if</span> (lParam) {
02188                             *(LONG *)lParam = lParamLocal;
02189                         }
02190 
02191                     } <span class="keywordflow">else</span> {
02192                         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvString);
02193                         <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02194                     }
02195 
02196                     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvString);
02197 
02198                 } <span class="keywordflow">else</span>
02199                     <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02200             } <span class="keywordflow">else</span>
02201                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02202         }
02203 
02204     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
02205     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
02206 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnIMECONTROL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01669">1669</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a637">CopyLogFontAtoW()</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a638">CopyLogFontWtoA()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00191">MBToWCSEx()</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00558">THREAD_CODEPAGE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
<pre class="fragment"><div>01670 {
01671     PVOID pvData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01672     LPARAM lData = lParam;
01673 
01674     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01675 
01676         <span class="comment">/*</span>
01677 <span class="comment">         * The server always expects the characters to be unicode so</span>
01678 <span class="comment">         * if this was generated from an ANSI routine convert it to Unicode</span>
01679 <span class="comment">         */</span>
01680         if (bAnsi) {
01681             <span class="keywordflow">switch</span> (wParam) {
01682                 <span class="keywordflow">case</span> IMC_GETCOMPOSITIONFONT:
01683                 <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
01684                 <span class="keywordflow">case</span> IMC_SETCOMPOSITIONFONT:
01685                     pvData = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, <span class="keyword">sizeof</span>(LOGFONTW));
01686                     <span class="keywordflow">if</span> (pvData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01687                         <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01688 
01689                     <span class="keywordflow">if</span> (wParam == IMC_SETCOMPOSITIONFONT) {
01690                         <span class="comment">// Later, we do A/W conversion based on thread hkl/CP.</span>
01691                         <a class="code" href="../../d6/d0/usercli_8h.html#a637">CopyLogFontAtoW</a>((PLOGFONTW)pvData, (PLOGFONTA)lParam);
01692                     }
01693 
01694                     lData = (LPARAM)pvData;
01695                     <span class="keywordflow">break</span>;
01696 
01697                 <span class="keywordflow">case</span> IMC_SETSOFTKBDDATA:
01698                     {
01699                         PSOFTKBDDATA pSoftKbdData;
01700                         PWORD pCodeA;
01701                         PWSTR pCodeW;
01702                         <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>  ch[3];
01703                         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize;
01704                         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  uCount, i;
01705 
01706                         uCount = ((PSOFTKBDDATA)lParam)-&gt;uCount;
01707 
01708                         cbSize = FIELD_OFFSET(SOFTKBDDATA, wCode[0])
01709                                + uCount * <span class="keyword">sizeof</span>(WORD) * 256;
01710 
01711                         pvData = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, cbSize);
01712                         <span class="keywordflow">if</span> (pvData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01713                             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01714 
01715                         pSoftKbdData = (PSOFTKBDDATA)pvData;
01716 
01717                         pSoftKbdData-&gt;uCount = uCount;
01718 
01719                         ch[2] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)<span class="charliteral">'\0'</span>;
01720 
01721                         pCodeA = &amp;((PSOFTKBDDATA)lParam)-&gt;wCode[0][0];
01722                         pCodeW = &amp;pSoftKbdData-&gt;wCode[0][0];
01723 
01724                         i = uCount * 256;
01725 
01726                         <span class="keywordflow">while</span> (i--) {
01727                             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(*pCodeA)) {
01728                                 ch[0] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(*pCodeA);
01729                                 ch[1] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(*pCodeA);
01730                             } <span class="keywordflow">else</span> {
01731                                 ch[0] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(*pCodeA);
01732                                 ch[1] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)<span class="charliteral">'\0'</span>;
01733                             }
01734                             <a class="code" href="../../d5/d6/chartran_8c.html#a3">MBToWCSEx</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a118">THREAD_CODEPAGE</a>(), (LPSTR)&amp;ch, -1, &amp;pCodeW, 1, FALSE);
01735                             pCodeA++; pCodeW++;
01736                         }
01737 
01738                         lData = (LPARAM)pvData;
01739                     }
01740                     <span class="keywordflow">break</span>;
01741 
01742                 <span class="keywordflow">default</span>:
01743                     <span class="keywordflow">break</span>;
01744             }
01745         }
01746 
01747         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
01748                 hwnd,
01749                 msg,
01750                 wParam,
01751                 lData,
01752                 xParam,
01753                 xpfnProc,
01754                 bAnsi);
01755 
01756         <span class="keywordflow">if</span> (bAnsi) {
01757             <span class="keywordflow">switch</span> (wParam) {
01758                 <span class="keywordflow">case</span> IMC_GETCOMPOSITIONFONT:
01759                 <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
01760                     <a class="code" href="../../d6/d0/usercli_8h.html#a638">CopyLogFontWtoA</a>((PLOGFONTA)lParam, (PLOGFONTW)pvData);
01761                     <span class="keywordflow">break</span>;
01762 
01763                 <span class="keywordflow">default</span>:
01764                     <span class="keywordflow">break</span>;
01765             }
01766         }
01767 
01768         <span class="keywordflow">if</span> (pvData != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01769             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvData);
01770 
01771     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01772     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
01773 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnINDEVICECHANGE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01554">1554</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
<pre class="fragment"><div>01555 {
01556     <span class="keyword">struct </span>_DEV_BROADCAST_HEADER *pHdr;
01557     PDEV_BROADCAST_PORT_W pPortW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01558     PDEV_BROADCAST_PORT_A pPortA;
01559     PDEV_BROADCAST_DEVICEINTERFACE_W pInterfaceW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01560     PDEV_BROADCAST_DEVICEINTERFACE_A pInterfaceA;
01561     PDEV_BROADCAST_HANDLE pHandleW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01562     PDEV_BROADCAST_HANDLE pHandleA;
01563 
01564     LPWSTR lpStr;
01565     <span class="keywordtype">int</span> iStr, iSize;
01566 
01567     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01568 
01569         if (!(wParam &amp;0x8000) || !lParam || !bAnsi)
01570             goto shipit;
01571 
01572         pHdr = (struct _DEV_BROADCAST_HEADER *)lParam;
01573         switch (pHdr-&gt;dbcd_devicetype) {
01574         <span class="keywordflow">case</span> DBT_DEVTYP_PORT:
01575             pPortA = (PDEV_BROADCAST_PORT_A)lParam;
01576             iStr = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(pPortA-&gt;dbcp_name);
01577             iSize = FIELD_OFFSET(DEV_BROADCAST_PORT_W, dbcp_name) + <span class="keyword">sizeof</span>(WCHAR)*(iStr+1);
01578             pPortW = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, iSize);
01579             <span class="keywordflow">if</span> (pPortW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01580                 <span class="keywordflow">return</span> 0;
01581             RtlCopyMemory(pPortW, pPortA, <span class="keyword">sizeof</span>(DEV_BROADCAST_PORT_A));
01582             lpStr = pPortW-&gt;dbcp_name;
01583             <span class="keywordflow">if</span> (iStr) {
01584                 MBToWCS(pPortA-&gt;dbcp_name, -1, &amp;lpStr, iStr, FALSE);
01585                 lpStr[iStr] = 0;
01586             } <span class="keywordflow">else</span> {
01587                 lpStr[0] = 0;
01588             }
01589             pPortW-&gt;dbcp_size = iSize;
01590             lParam = (LPARAM)pPortW;
01591             bAnsi = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01592             <span class="keywordflow">break</span>;
01593 
01594         <span class="keywordflow">case</span> DBT_DEVTYP_DEVICEINTERFACE:
01595             pInterfaceA = (PDEV_BROADCAST_DEVICEINTERFACE_A)lParam;
01596             iStr = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(pInterfaceA-&gt;dbcc_name);
01597             iSize = FIELD_OFFSET(DEV_BROADCAST_DEVICEINTERFACE_W, dbcc_name) + <span class="keyword">sizeof</span>(WCHAR)*(iStr+1);
01598             pInterfaceW = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, iSize);
01599             <span class="keywordflow">if</span> (pInterfaceW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01600                 <span class="keywordflow">return</span> 0;
01601             RtlCopyMemory(pInterfaceW, pInterfaceA, <span class="keyword">sizeof</span>(DEV_BROADCAST_DEVICEINTERFACE_A));
01602             lpStr = pInterfaceW-&gt;dbcc_name;
01603             <span class="keywordflow">if</span> (iStr) {
01604                 MBToWCS(pInterfaceA-&gt;dbcc_name, -1, &amp;lpStr, iStr, FALSE);
01605                 lpStr[iStr] = 0;
01606             } <span class="keywordflow">else</span> {
01607                 lpStr[0] = 0;
01608             }
01609             pInterfaceW-&gt;dbcc_size = iSize;
01610             lParam = (LPARAM)pInterfaceW;
01611             bAnsi = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01612             <span class="keywordflow">break</span>;
01613 
01614         <span class="keywordflow">case</span> DBT_DEVTYP_HANDLE:
01615             pHandleA = (PDEV_BROADCAST_HANDLE)lParam;
01616             bAnsi = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01617             <span class="keywordflow">if</span> ((wParam != DBT_CUSTOMEVENT) || (pHandleA-&gt;dbch_nameoffset &lt; 0)) <span class="keywordflow">break</span>;
01618             iStr = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(pHandleA-&gt;dbch_data+pHandleA-&gt;dbch_nameoffset);
01619         <span class="comment">/*</span>
01620 <span class="comment">         * Calculate size of new structure with UNICODE string instead of Ansi string</span>
01621 <span class="comment">         */</span>
01622 
01623             iSize = FIELD_OFFSET(DEV_BROADCAST_HANDLE, dbch_data)+ pHandleA-&gt;dbch_nameoffset + <span class="keyword">sizeof</span>(WCHAR)*(iStr+1);
01624             <span class="comment">/*</span>
01625 <span class="comment">             * Just in case there were an odd number of bytes in the non-text data</span>
01626 <span class="comment">             */</span>
01627             <span class="keywordflow">if</span> (iSize &amp; 1) iSize++;
01628             pHandleW = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, iSize);
01629             <span class="keywordflow">if</span> (pHandleW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01630                 <span class="keywordflow">return</span> 0;
01631             RtlCopyMemory(pHandleW, pHandleA, FIELD_OFFSET(DEV_BROADCAST_HANDLE, dbch_data)+ pHandleA-&gt;dbch_nameoffset);
01632 
01633             <span class="comment">/*</span>
01634 <span class="comment">             * Make sure this is even for the UNICODE string.</span>
01635 <span class="comment">             */</span>
01636 
01637             <span class="keywordflow">if</span> (pHandleW-&gt;dbch_nameoffset &amp; 1) pHandleW-&gt;dbch_nameoffset++;
01638 
01639             lpStr = (LPWSTR)(pHandleW-&gt;dbch_data+pHandleW-&gt;dbch_nameoffset);
01640             <span class="keywordflow">if</span> (iStr) {
01641                 MBToWCS(pHandleA-&gt;dbch_data+pHandleA-&gt;dbch_nameoffset, -1,
01642                         &amp;lpStr, iStr, FALSE);
01643             }
01644                 lpStr[iStr] = 0;
01645             pHandleW-&gt;dbch_size = iSize;
01646             lParam = (LPARAM)pHandleW;
01647 
01648             <span class="keywordflow">break</span>;
01649         }
01650 
01651 shipit:
01652         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
01653                 hwnd,
01654                 msg,
01655                 wParam,
01656                 lParam,
01657                 xParam,
01658                 xpfnProc,
01659                 bAnsi);
01660 
01661     <span class="keywordflow">if</span> (pPortW) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pPortW);
01662     <span class="keywordflow">if</span> (pInterfaceW) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pInterfaceW);
01663     <span class="keywordflow">if</span> (pHandleW) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pHandleW);
01664 
01665     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01666     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
01667 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnINSIZECLIPBRD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01530">1530</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>.
<p>
<pre class="fragment"><div>01531 {
01532     LPRECT lprc;
01533     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01534 
01535         USERGLOBALLOCK((HGLOBAL)lParam, lprc);
01536         if (lprc) {
01537             retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
01538                     hwnd,
01539                     msg,
01540                     wParam,
01541                     (LPARAM)lprc,
01542                     xParam,
01543                     xpfnProc,
01544                 bAnsi);
01545             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>((HGLOBAL)lParam);
01546         } <span class="keywordflow">else</span> {
01547             RIPMSG1(RIP_WARNING, <span class="stringliteral">"MESSAGECALL(fnINSIZECLIPBRD): USERGLOBALLOCK failed on %p!"</span>, lParam);
01548         }
01549 
01550     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01551     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
01552 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnINPAINTCLIPBRD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01505">1505</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>.
<p>
<pre class="fragment"><div>01506 {
01507     LPPAINTSTRUCT lpps;
01508 
01509     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01510 
01511         USERGLOBALLOCK((HGLOBAL)lParam, lpps);
01512         if (lpps) {
01513             retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
01514                     hwnd,
01515                     msg,
01516                     wParam,
01517                     (LPARAM)lpps,
01518                     xParam,
01519                     xpfnProc,
01520                     bAnsi);
01521             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>((HGLOBAL)lParam);
01522         } <span class="keywordflow">else</span> {
01523             RIPMSG1(RIP_WARNING, <span class="stringliteral">"MESSAGECALL(fnINPAINTCLIPBRD): USERGLOBALLOCK failed on %p!"</span>, lParam);
01524         }
01525 
01526     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01527     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
01528 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnCOPYGLOBALDATA&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01478">1478</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>.
<p>
<pre class="fragment"><div>01479 {
01480     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pData;
01481     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01482 
01483         if (wParam == 0) {
01484             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01485         }
01486 
01487         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>((HGLOBAL)lParam, pData);
01488         <span class="keywordflow">if</span> (pData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01489             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01490         }
01491         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
01492                 hwnd,
01493                 msg,
01494                 wParam,
01495                 (LPARAM)pData,
01496                 xParam,
01497                 xpfnProc,
01498                 bAnsi);
01499         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>((HGLOBAL)lParam);
01500         <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>((HGLOBAL)lParam);
01501     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01502     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
01503 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="client/ntstubs.c::MESSAGECALL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MESSAGECALL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">fnINWPARAMDBCSCHAR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01444">1444</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02253">BUILD_DBCS_MESSAGE_TO_SERVER_FROM_CLIENTA</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09804">NtUserMessageCall()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00490">RtlMBMessageWParamCharToWCS()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01445 {
01446     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01447 
01448         <span class="comment">/*</span>
01449 <span class="comment">         * The server always expects the characters to be unicode so</span>
01450 <span class="comment">         * if this was generated from an ANSI routine convert it to Unicode</span>
01451 <span class="comment">         */</span>
01452         if (bAnsi) {
01453 
01454             <span class="comment">/*</span>
01455 <span class="comment">             * Setup for DBCS Messaging..</span>
01456 <span class="comment">             */</span>
01457             <a class="code" href="../../d6/d0/usercli_8h.html#a294">BUILD_DBCS_MESSAGE_TO_SERVER_FROM_CLIENTA</a>(msg,wParam,TRUE);
01458 
01459             <span class="comment">/*</span>
01460 <span class="comment">             * Convert DBCS/SBCS to Unicode...</span>
01461 <span class="comment">             */</span>
01462             <a class="code" href="../../d5/d6/chartran_8c.html#a5">RtlMBMessageWParamCharToWCS</a>(msg, &amp;wParam);
01463         }
01464 
01465         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a332">NtUserMessageCall</a>(
01466                 hwnd,
01467                 msg,
01468                 wParam,
01469                 lParam,
01470                 xParam,
01471                 xpfnProc,
01472                 bAnsi);
01473 
01474     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01475     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(DWORD);
01476 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="client/ntstubs.c::mouse_event" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID mouse_event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>dwExtraInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01395">1395</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00032">BEGINCALLVOID</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00051">ENDCALLVOID</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08617">NtUserSendInput()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01401 {
01402     INPUT ms;
01403 
01404     <a class="code" href="../../d7/d9/ntsend_8h.html#a2">BEGINCALLVOID</a>()
01405 
01406         ms.type           = INPUT_MOUSE;
01407         ms.mi.dwFlags     = dwFlags;
01408         ms.mi.dx          = dx;
01409         ms.mi.dy          = dy;
01410         ms.mi.mouseData   = dwData;
01411         ms.mi.time        = 0;
01412         ms.mi.dwExtraInfo = dwExtraInfo;
01413 
01414         NtUserSendInput(1, &amp;ms, sizeof(INPUT));
01415 
01416     ENDCALLVOID()
01417 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="client/ntstubs.c::NotifyWinEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WINUSERAPI VOID WINAPI NotifyWinEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>idObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>idChild</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00354">354</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00032">BEGINCALLVOID</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00051">ENDCALLVOID</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00043">ERRORTRAPVOID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03461">NtUserNotifyWinEvent()</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/btnctl_8c-source.html#l01338">ButtonWndProcWorker()</a>, <a class="el" href="../../d2/d3/combo_8c-source.html#l00207">ComboBoxWndProcWorker()</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l00460">DefDlgProcWorker()</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l01036">DialogBox2()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02547">ECResetTextInfo()</a>, <a class="el" href="../../d3/d1/lboxrare_8c-source.html#l00820">LBEvent()</a>, <a class="el" href="../../d7/d3/msgbox_8c-source.html#l01648">MB_DlgProcWorker()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01367">MLDeleteText()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01040">MLInsertText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02467">SLPaste()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00087">SLUndo()</a>, and <a class="el" href="../../d2/d3/combo_8c-source.html#l00029">xxxPressButton()</a>.
<p>
<pre class="fragment"><div>00359 {
00360     <a class="code" href="../../d7/d9/ntsend_8h.html#a2">BEGINCALLVOID</a>()
00361 
00362     if (FWINABLE()) {
00363         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a137">NtUserNotifyWinEvent</a>(dwEvent, hwnd, idObject, idChild);
00364     }
00365 
00366     <a class="code" href="../../d7/d9/ntsend_8h.html#a4">ERRORTRAPVOID</a>();
00367     <a class="code" href="../../d7/d9/ntsend_8h.html#a6">ENDCALLVOID</a>();
00368 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="client/ntstubs.c::OpenClipboard" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL OpenClipboard           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00540">540</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00353">ClientEmptyClipboard()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05481">NtUserOpenClipboard()</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l01008">DoPaste()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02703">ECCopy()</a>, <a class="el" href="../../d7/d3/msgbox_8c-source.html#l01176">MB_CopyToClipboard()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l02720">MLPasteText()</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00307">msProfClipboardGroup()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01157">SLPasteText()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
<pre class="fragment"><div>00542 {
00543     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fEmptyClient;
00544 
00545     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00546 
00547         retval = (DWORD)NtUserOpenClipboard(hwnd, &amp;fEmptyClient);
00548 
00549         if (fEmptyClient)
00550             ClientEmptyClipboard();
00551 
00552     ERRORTRAP(0);
00553     ENDCALL(BOOL);
00554 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="client/ntstubs.c::RegisterDeviceNotificationWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDEVNOTIFY RegisterDeviceNotificationWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hRecipient</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NotificationFilter</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>IsAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l02543">2543</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01792">RegisterDeviceNotification()</a>.
<p>
<pre class="fragment"><div>02549 {
02550     HINSTANCE   hLib = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02551     FARPROC     fpRegisterNotification = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02552     PVOID       Context = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02553     HDEVNOTIFY  notifyHandle = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02554     CONFIGRET   <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = CR_SUCCESS;
02555 
02556     <span class="keyword">extern</span>
02557     CONFIGRET
02558     CMP_RegisterNotification(IN  HANDLE   hRecipient,
02559                              IN  LPBYTE   NotificationFilter,
02560                              IN  DWORD    Flags,
02561                              OUT PVOID   *Context
02562                              );
02563 
02564     UNREFERENCED_PARAMETER(IsAnsi);
02565 
02566     <span class="keywordflow">try</span> {
02567         <span class="comment">//</span>
02568         <span class="comment">// load the config manager client dll and retrieve entry pts</span>
02569         <span class="comment">//</span>
02570         hLib = LoadLibrary(TEXT(<span class="stringliteral">"SETUPAPI.DLL"</span>));
02571         <span class="keywordflow">if</span> (hLib == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02572             <span class="keywordflow">goto</span> Clean0;  <span class="comment">// use last error set by LoadLibrary</span>
02573         }
02574 
02575         fpRegisterNotification = GetProcAddress(hLib, <span class="stringliteral">"CMP_RegisterNotification"</span>);
02576         <span class="keywordflow">if</span> (fpRegisterNotification == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02577             <span class="keywordflow">goto</span> Clean0;    <span class="comment">// use last error set by GetProcAddress</span>
02578         }
02579 
02580         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (CONFIGRET)(fpRegisterNotification)(hRecipient,
02581                                         NotificationFilter,
02582                                         Flags,
02583                                         &amp;Context);
02584 
02585         Clean0:
02586             ;
02587 
02588     } except(W32ExceptionHandler(FALSE, RIP_WARNING)) {
02589     }
02590 
02591     <span class="keywordflow">if</span> (hLib != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02592         FreeLibrary(hLib);
02593     }
02594 
02595     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != CR_SUCCESS) {
02596 
02597         <span class="comment">//</span>
02598         <span class="comment">//Something went wrong, map the CR errors to a</span>
02599         <span class="comment">//W32 style error code</span>
02600         <span class="comment">//</span>
02601         <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) {
02602             <span class="keywordflow">case</span> CR_INVALID_POINTER:
02603                 SetLastError (ERROR_INVALID_PARAMETER);
02604                 <span class="keywordflow">break</span>;
02605             <span class="keywordflow">case</span> CR_INVALID_DATA:
02606                 SetLastError (ERROR_INVALID_DATA);
02607                 <span class="keywordflow">break</span>;
02608             <span class="keywordflow">case</span> CR_OUT_OF_MEMORY:
02609                 SetLastError (ERROR_NOT_ENOUGH_MEMORY);
02610                 <span class="keywordflow">break</span>;
02611             <span class="keywordflow">case</span> CR_FAILURE:
02612             <span class="keywordflow">default</span>:
02613                 SetLastError (ERROR_SERVICE_SPECIFIC_ERROR);
02614                 <span class="keywordflow">break</span>;
02615 
02616         }
02617     }
02618 
02619     <span class="keywordflow">if</span> ((Context != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; ((ULONG_PTR)Context != -1)) {
02620         notifyHandle = (HDEVNOTIFY)Context;
02621     }
02622 
02623     <span class="keywordflow">return</span> notifyHandle;
02624 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="client/ntstubs.c::SetSysColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WINUSERAPI BOOL WINAPI SetSysColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>cElements</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CONST <a class="el" href="../../d2/d1/bench_8h.html#a7">INT</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpaElements</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CONST COLORREF *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpaRgbValues</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00028">28</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06023">NtUserSetSysColors()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01311">SSCF_FORCESOLIDCOLOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01310">SSCF_NOTIFY</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01312">SSCF_SETMAGICCOLORS</a>.
<p>
<pre class="fragment"><div>00032 {
00033 
00034     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a229">NtUserSetSysColors</a>(cElements,
00035                               lpaElements,
00036                               lpaRgbValues,
00037                               SSCF_NOTIFY | SSCF_FORCESOLIDCOLOR | SSCF_SETMAGICCOLORS);
00038 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="client/ntstubs.c::SetSystemCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetSystemCursor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HCURSOR&nbsp;</td>
          <td class="mdname" nowrap> <em>hcur</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01078">1078</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l02657">LoadIcoCur()</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07166">NtUserSetSystemCursor()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>01081 {
01082     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01083 
01084         if (hcur == NULL) {
01085             hcur = (HANDLE)<a class="code" href="../../d6/d0/usercli_8h.html#a655">LoadIcoCur</a>(NULL,
01086                                       MAKEINTRESOURCE(<span class="keywordtype">id</span>),
01087                                       RT_CURSOR,
01088                                       0,
01089                                       0,
01090                                       LR_DEFAULTSIZE);
01091 
01092             <span class="keywordflow">if</span> (hcur == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01093                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01094         }
01095 
01096         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a267">NtUserSetSystemCursor</a>(hcur, <span class="keywordtype">id</span>);
01097 
01098     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01099     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
01100 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="client/ntstubs.c::SetWindowRgn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetWindowRgn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HRGN&nbsp;</td>
          <td class="mdname" nowrap> <em>hrgn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bRedraw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00906">906</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06801">NtUserSetWindowRgn()</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00810">AnimateWindow()</a>, and <a class="el" href="../../d9/d4/reader_8c-source.html#l00158">ReaderWndProc()</a>.
<p>
<pre class="fragment"><div>00910 {
00911     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00912 
00913         retval = (DWORD)NtUserSetWindowRgn(
00914                 hwnd,
00915                 hrgn,
00916                 bRedraw);
00917 
00918         if (retval) {
00919             DeleteObject(hrgn);
00920         }
00921 
00922     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00923     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
00924 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="client/ntstubs.c::SetWindowStationUser" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetWindowStationUser           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWINSTA&nbsp;</td>
          <td class="mdname" nowrap> <em>hwinsta</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>pluidUser</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>psidUser</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbsidUser</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01039">1039</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d0/csrhlpr_8h.html#a2">Logon()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07110">NtUserSetWindowStationUser()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01044 {
01045     LUID luidNone = { 0, 0 };
01046 
01047 
01048     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
01049 
01050         retval = (DWORD)NtUserSetWindowStationUser(hwinsta,
01051                                                    pluidUser,
01052                                                    psidUser,
01053                                                    cbsidUser);
01054 
01055         <span class="comment">/*</span>
01056 <span class="comment">         * Load global atoms if the logon succeeded</span>
01057 <span class="comment">         */</span>
01058         if (retval) {
01059 
01060             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>(pluidUser,&amp;luidNone)) {
01061                 <span class="comment">/*</span>
01062 <span class="comment">                 * Reset console and load Nls data.</span>
01063 <span class="comment">                 */</span>
01064                 <a class="code" href="../../d0/d0/csrhlpr_8h.html#a2">Logon</a>(TRUE);
01065             } <span class="keywordflow">else</span> {
01066                 <span class="comment">/*</span>
01067 <span class="comment">                 * Flush NLS cache.</span>
01068 <span class="comment">                 */</span>
01069                 <a class="code" href="../../d0/d0/csrhlpr_8h.html#a2">Logon</a>(FALSE);
01070             }
01071 
01072             retval = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01073         }
01074     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
01075     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
01076 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="client/ntstubs.c::SetWinEventHook" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WINUSERAPI HWINEVENTHOOK WINAPI SetWinEventHook           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>eventMin</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>eventMax</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HMODULE&nbsp;</td>
          <td class="mdname" nowrap> <em>hmodWinEventProc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WINEVENTPROC&nbsp;</td>
          <td class="mdname" nowrap> <em>lpfnWinEventProc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00299">299</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03414">NtUserSetWinEventHook()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00307 {
00308     UNICODE_STRING str;
00309     PUNICODE_STRING pstr;
00310     WCHAR awchLib[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00311 
00312     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00313 
00314         if ((dwFlags &amp; WINEVENT_INCONTEXT) &amp;&amp; (hmodWinEventProc != NULL)) {
00315             <span class="comment">/*</span>
00316 <span class="comment">             * If we're passing an hmod, we need to grab the file name of the</span>
00317 <span class="comment">             * module while we're still on the client since module handles</span>
00318 <span class="comment">             * are NOT global.</span>
00319 <span class="comment">             */</span>
00320             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> cb;
00321             cb = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<span class="keyword">sizeof</span>(WCHAR) * GetModuleFileNameW(hmodWinEventProc, awchLib, <span class="keyword">sizeof</span>(awchLib)/<span class="keyword">sizeof</span>(WCHAR)));
00322             <span class="keywordflow">if</span> (cb == 0) {
00323                 <span class="comment">/*</span>
00324 <span class="comment">                 * hmod is bogus - return NULL.</span>
00325 <span class="comment">                 */</span>
00326                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00327             }
00328             str.Buffer = awchLib;
00329             str.Length = cb - <span class="keyword">sizeof</span>(UNICODE_NULL);
00330             str.MaximumLength = cb;
00331             pstr = &amp;str;
00332         } <span class="keywordflow">else</span> {
00333             pstr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00334         }
00335 
00336         retval = (ULONG_PTR)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a135">NtUserSetWinEventHook</a>(
00337                 eventMin,
00338                 eventMax,
00339                 hmodWinEventProc,
00340                 pstr,
00341                 lpfnWinEventProc,
00342                 idProcess,
00343                 idThread,
00344                 dwFlags);
00345 
00346     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00347     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(HWINEVENTHOOK);
00348 };
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="client/ntstubs.c::ThunkedMenuItemInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ThunkedMenuItemInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HMENU&nbsp;</td>
          <td class="mdname" nowrap> <em>hMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>nPosition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fByPosition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fInsert</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPMENUITEMINFOW&nbsp;</td>
          <td class="mdname" nowrap> <em>lpmii</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00377">377</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00176">CLEANUPLPSTRW</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00316">_IN_STRING::fAllocated</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00149">FIRSTCOPYLPSTROPTW</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00230">FIRSTCOPYLPWSTROPT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04663">NtUserThunkedMenuItemInfo()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00315">_IN_STRING::pstr</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01734">AppendMenu()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01720">InsertMenu()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01702">InsertMenuItem()</a>, <a class="el" href="../../d0/d8/clmenu_8c-source.html#l00439">InternalInsertMenuItem()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01747">ModifyMenu()</a>, <a class="el" href="../../d6/d4/mdimenu_8c-source.html#l00104">ModifyMenuItem()</a>, and <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01685">SetMenuItemInfo()</a>.
<p>
<pre class="fragment"><div>00384 {
00385     MENUITEMINFOW mii;
00386     <a class="code" href="../../d8/d1/struct__IN__STRING.html">IN_STRING</a> strItem;
00387 
00388     <span class="comment">/*</span>
00389 <span class="comment">     * Make sure cleanup will work successfully</span>
00390 <span class="comment">     */</span>
00391     strItem.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o2">fAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00392 
00393     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00394 
00395         <span class="comment">/*</span>
00396 <span class="comment">         *  Make a local copy so we can make changes</span>
00397 <span class="comment">         */</span>
00398         mii = *(LPMENUITEMINFO)(lpmii);
00399 
00400         strItem.pstr = NULL;
00401         if (mii.fMask &amp; MIIM_BITMAP) {
00402             <span class="keywordflow">if</span> (((HBITMAP)LOWORD(HandleToUlong(mii.hbmpItem)) &lt; HBMMENU_MAX) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(mii.hbmpItem)) {
00403                 <span class="comment">/*</span>
00404 <span class="comment">                 *  Looks like the user was trying to insert one of the</span>
00405 <span class="comment">                 *  HBMMENU_* bitmaps, but stuffed some data in the HIWORD.</span>
00406 <span class="comment">                 *  We know the HIWORD data is invalid because the LOWORD</span>
00407 <span class="comment">                  *  handle is below the GDI minimum.</span>
00408 <span class="comment">                 */</span>
00409                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"Invalid HIWORD data (0x%04X) for HBMMENU_* bitmap."</span>, HIWORD(HandleToUlong(mii.hbmpItem)));
00410                 mii.hbmpItem = (HBITMAP)LOWORD(HandleToUlong(mii.hbmpItem));
00411             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(mii.hbmpItem) &amp;&amp; (mii.hbmpItem &gt;= HBMMENU_MAX)) {
00412             <span class="comment">/*</span>
00413 <span class="comment">             * The app is passing a 16-bit GDI handle.  GDI handles this on the</span>
00414 <span class="comment">             * client-side, but not on the kernel side.  So convert it to 32-bits.</span>
00415 <span class="comment">             * This fixes bug 201493 in Macromedia Director.</span>
00416 <span class="comment">             */</span>
00417                 HBITMAP hbmNew = GdiFixUpHandle(mii.hbmpItem);
00418                 <span class="keywordflow">if</span> (hbmNew) {
00419                     RIPMSG2(RIP_WARNING, <span class="stringliteral">"Menu bitmap change, fix 16-bit bitmap handle %lx to %lx\n"</span>, mii.hbmpItem, hbmNew);
00420                     mii.hbmpItem = hbmNew;
00421                 }
00422             }
00423         }
00424 
00425         <span class="keywordflow">if</span> (mii.fMask &amp; MIIM_STRING){
00426             <span class="keywordflow">if</span> (fAnsi) {
00427                 <a class="code" href="../../d7/d9/ntsend_8h.html#a25">FIRSTCOPYLPSTROPTW</a>(&amp;strItem, mii.dwTypeData);
00428             } <span class="keywordflow">else</span> {
00429                 <a class="code" href="../../d7/d9/ntsend_8h.html#a40">FIRSTCOPYLPWSTROPT</a>(&amp;strItem, mii.dwTypeData);
00430             }
00431         }
00432 
00433         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a181">NtUserThunkedMenuItemInfo</a>(
00434                 hMenu,
00435                 nPosition,
00436                 fByPosition,
00437                 fInsert,
00438                 &amp;mii,
00439                 strItem.<a class="code" href="../../d8/d1/struct__IN__STRING.html#o1">pstr</a>);
00440 
00441     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(FALSE);
00442     <a class="code" href="../../d7/d9/ntsend_8h.html#a29">CLEANUPLPSTRW</a>(strItem);
00443     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
00444 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="client/ntstubs.c::ToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wVirtKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wScanCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CONST <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pKeyState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszBuff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cchBuff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00946">946</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06953">NtUserToUnicodeEx()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/ntuser_2imm_2input_8c-source.html#l00196">ImmTranslateMessage()</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l01082">ToAscii()</a>.
<p>
<pre class="fragment"><div>00953 {
00954     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00955 
00956         retval = (DWORD)NtUserToUnicodeEx(
00957                 wVirtKey,
00958                 wScanCode,
00959                 pKeyState,
00960                 pwszBuff,
00961                 cchBuff,
00962                 wFlags,
00963                 (HKL)NULL);
00964 
00965         if (!retval) {
00966             *pwszBuff = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00967         }
00968 
00969     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00970     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(<span class="keywordtype">int</span>);
00971 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="client/ntstubs.c::ToUnicodeEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ToUnicodeEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wVirtKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wScanCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CONST <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pKeyState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszBuff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cchBuff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hkl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00973">973</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06953">NtUserToUnicodeEx()</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l01112">ToAsciiEx()</a>.
<p>
<pre class="fragment"><div>00981 {
00982     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00983 
00984     retval = (DWORD)NtUserToUnicodeEx(
00985             wVirtKey,
00986             wScanCode,
00987             pKeyState,
00988             pwszBuff,
00989             cchBuff,
00990             wFlags,
00991             hkl);
00992 
00993     if (!retval) {
00994         *pwszBuff = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00995     }
00996 
00997     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00998     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(<span class="keywordtype">int</span>);
00999 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="client/ntstubs.c::TranslateMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL TranslateMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">CONST MSG *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pmsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00885">885</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02563">fpImmTranslateMessage</a>, and <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00851">TranslateMessageEx()</a>.
<p>
Referenced by <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l01036">DialogBox2()</a>, <a class="el" href="../../d6/d8/dlgmgr2_8c-source.html#l00317">IsDialogMessageW()</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l01843">msProfTranslateMessage()</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00757">ThreadShutdownNotify()</a>, and <a class="el" href="../../d1/d4/ntcon_2conime_2conime_8c-source.html#l00062">WinMain()</a>.
<p>
<pre class="fragment"><div>00887 {
00888     <span class="comment">//</span>
00889     <span class="comment">// IME special key handling</span>
00890     <span class="comment">//</span>
00891     <span class="keywordflow">if</span> ( LOWORD(pmsg-&gt;wParam) == VK_PROCESSKEY ) {
00892         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fResult;
00893         <span class="comment">//</span>
00894         <span class="comment">// This vkey should be processed by IME</span>
00895         <span class="comment">//</span>
00896         fResult = <a class="code" href="../../d6/d0/usercli_8h.html#a338">fpImmTranslateMessage</a>( pmsg-&gt;hwnd,
00897                                        pmsg-&gt;message,
00898                                        pmsg-&gt;wParam,
00899                                        pmsg-&gt;lParam );
00900         <span class="keywordflow">if</span> ( fResult )
00901             <span class="keywordflow">return</span> fResult;
00902     }
00903     <span class="keywordflow">return</span>(<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a20">TranslateMessageEx</a>(pmsg, 0));
00904 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="client/ntstubs.c::TranslateMessageEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL TranslateMessageEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">CONST MSG *&nbsp;</td>
          <td class="mdname" nowrap> <em>pmsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00851">851</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d6/d7/crecv_8c-source.html#l00069">MSGERROR</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06394">NtUserTranslateMessage()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00133">RESERVED_MSG_BITS</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>, and <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00885">TranslateMessage()</a>.
<p>
<pre class="fragment"><div>00854 {
00855     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00856 
00857         <span class="comment">/*</span>
00858 <span class="comment">         * Don't bother going over to the kernel if this isn't</span>
00859 <span class="comment">         * key message.</span>
00860 <span class="comment">         */</span>
00861         switch (pmsg-&gt;message) {
00862         <span class="keywordflow">case</span> WM_KEYDOWN:
00863         <span class="keywordflow">case</span> WM_KEYUP:
00864         <span class="keywordflow">case</span> WM_SYSKEYDOWN:
00865         <span class="keywordflow">case</span> WM_SYSKEYUP:
00866             <span class="keywordflow">break</span>;
00867         <span class="keywordflow">default</span>:
00868             <span class="keywordflow">if</span> (pmsg-&gt;message &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a8">RESERVED_MSG_BITS</a>) {
00869                 RIPERR1(ERROR_INVALID_PARAMETER,
00870                         RIP_WARNING,
00871                         <span class="stringliteral">"Invalid parameter \"pmsg-&gt;message\" (%ld) to TranslateMessageEx"</span>,
00872                         pmsg-&gt;message);
00873             }
00874             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00875         }
00876 
00877         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a240">NtUserTranslateMessage</a>(
00878                 pmsg,
00879                 flags);
00880 
00881     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00882     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
00883 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="client/ntstubs.c::UnregisterDeviceNotification" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UnregisterDeviceNotification           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HDEVNOTIFY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l02628">2628</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/sti_8h-source.html#l00561">DECLARE_INTERFACE_()</a>.
<p>
<pre class="fragment"><div>02631 {
02632     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        status = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02633     HINSTANCE   hLib = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02634     FARPROC     fpUnregisterNotification = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02635     CONFIGRET   crStatus = CR_SUCCESS;
02636 
02637     <span class="keyword">extern</span>
02638     CONFIGRET
02639     CMP_UnregisterNotification(IN ULONG Context);
02640 
02641     <span class="keywordflow">try</span> {
02642         <span class="comment">//</span>
02643         <span class="comment">// load the config manager client dll and retrieve entry pts</span>
02644         <span class="comment">//</span>
02645         hLib = LoadLibrary(TEXT(<span class="stringliteral">"SETUPAPI.DLL"</span>));
02646         <span class="keywordflow">if</span> (hLib == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02647             status = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02648             <span class="keywordflow">goto</span> Clean0;  <span class="comment">// use last error set by LoadLibrary</span>
02649         }
02650 
02651         fpUnregisterNotification = GetProcAddress(hLib, <span class="stringliteral">"CMP_UnregisterNotification"</span>);
02652         <span class="keywordflow">if</span> (fpUnregisterNotification == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02653             status = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02654             <span class="keywordflow">goto</span> Clean0;    <span class="comment">// use last error set by GetProcAddress</span>
02655         }
02656 
02657         crStatus = (CONFIGRET)(fpUnregisterNotification)((ULONG_PTR)<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>);
02658 
02659         <span class="keywordflow">if</span> (crStatus != CR_SUCCESS) {
02660             status = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02661             <span class="comment">//</span>
02662             <span class="comment">//Something went wrong, map the CR errors to a</span>
02663             <span class="comment">//W32 style error code</span>
02664             <span class="comment">//</span>
02665             <span class="keywordflow">switch</span> (crStatus) {
02666                 <span class="keywordflow">case</span> CR_INVALID_POINTER:
02667                     SetLastError (ERROR_INVALID_PARAMETER);
02668                     <span class="keywordflow">break</span>;
02669                 <span class="keywordflow">case</span> CR_INVALID_DATA:
02670                     SetLastError (ERROR_INVALID_DATA);
02671                     <span class="keywordflow">break</span>;
02672                 <span class="keywordflow">case</span> CR_FAILURE:
02673                 <span class="keywordflow">default</span>:
02674                     SetLastError (ERROR_SERVICE_SPECIFIC_ERROR);
02675                     <span class="keywordflow">break</span>;
02676             }
02677         }
02678 
02679         Clean0:
02680             ;
02681 
02682     } except(W32ExceptionHandler(FALSE, RIP_WARNING)) {
02683         status = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02684     }
02685 
02686     <span class="keywordflow">if</span> (hLib != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02687         FreeLibrary(hLib);
02688     }
02689 
02690     <span class="keywordflow">return</span> status;
02691 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="client/ntstubs.c::UpdatePerUserSystemParameters" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UpdatePerUserSystemParameters           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bUserLoggedOn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00049">49</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00027">BEGINCALL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d6/d9/immhotky_8c-source.html#l00129">CliImmInitializeHotKeys()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00047">ENDCALL</a>, <a class="el" href="../../d8/d8/ntsend_8h-source.html#l00035">ERRORTRAP</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03729">GetActiveKeyboardName()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l02091">GetRemoteKeyboardLayout()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00078">ISHK_INITIALIZE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04385">LoadKeyboardLayoutWorker()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03976">LoadPreloadKeyboardLayouts()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l02876">NtUserUpdatePerUserSystemParameters()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00959">SystemParametersInfo()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00052 {
00053     WCHAR pwszKLID[KL_NAMELENGTH];
00054 
00055     <a class="code" href="../../d7/d9/ntsend_8h.html#a1">BEGINCALL</a>()
00056 
00057         <span class="comment">/*</span>
00058 <span class="comment">         * Initialize IME hotkeys before loading keyboard</span>
00059 <span class="comment">         * layouts.</span>
00060 <span class="comment">         */</span>
00061         CliImmInitializeHotKeys(ISHK_INITIALIZE, NULL);
00062         <span class="comment">/*</span>
00063 <span class="comment">         * Load initial keyboard layout.</span>
00064 <span class="comment">         */</span>
00065         if (!GetRemoteKeyboardLayout(pwszKLID)) {
00066             <a class="code" href="../../d6/d0/usercli_8h.html#a603">GetActiveKeyboardName</a>(pwszKLID);
00067         }
00068 
00069         <a class="code" href="../../d6/d0/usercli_8h.html#a608">LoadKeyboardLayoutWorker</a>(NULL, pwszKLID, KLF_ACTIVATE | KLF_RESET | KLF_SUBSTITUTE_OK, TRUE);
00070 
00071         <span class="comment">/*</span>
00072 <span class="comment">         * Now load the remaining preload keyboard layouts.</span>
00073 <span class="comment">         */</span>
00074         <a class="code" href="../../d3/d8/client_8c.html#a147">LoadPreloadKeyboardLayouts</a>();
00075         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a119">NtUserUpdatePerUserSystemParameters</a>(hToken, bUserLoggedOn);
00076 
00077         <span class="comment">/*</span>
00078 <span class="comment">         * Cause the wallpaper to be changed.</span>
00079 <span class="comment">         */</span>
00080         <a class="code" href="../../d5/d9/cltxt_8h.html#a26">SystemParametersInfo</a>(SPI_SETDESKWALLPAPER, 0, 0, 0);
00081 
00082     <a class="code" href="../../d7/d9/ntsend_8h.html#a3">ERRORTRAP</a>(0);
00083     <a class="code" href="../../d7/d9/ntsend_8h.html#a5">ENDCALL</a>(BOOL);
00084 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="client/ntstubs.c::WOWFindWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HWND WOWFindWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pClassName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pWindowName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00041">41</a> of file <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html">client/ntstubs.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00785">FW_16BIT</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a556">InternalFindWindowExA()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l02696">UserRegisterWowHandlers()</a>.
<p>
<pre class="fragment"><div>00044 {
00045     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a556">InternalFindWindowExA</a>(NULL, NULL, pClassName, pWindowName, FW_16BIT);
00046 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:54 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
