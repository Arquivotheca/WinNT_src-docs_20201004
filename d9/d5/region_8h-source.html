<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: region.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>region.h</h1><a href="../../d8/d6/region_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Region Allocation.</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// Regions can be used to replace zones where it is not essential that the</span>
00005 <span class="comment">// specified spinlock be acquired.</span>
00006 <span class="comment">//</span>
00007 
<a name="l00008"></a><a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html">00008</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html">_REGION_SEGMENT_HEADER</a> {
<a name="l00009"></a><a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html#o0">00009</a>     <span class="keyword">struct </span><a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html">_REGION_SEGMENT_HEADER</a> *<a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html#o0">NextSegment</a>;
<a name="l00010"></a><a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html#o1">00010</a>     PVOID <a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html#o1">Reserved</a>;
00011 } <a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html">REGION_SEGMENT_HEADER</a>, *<a class="code" href="../../d1/d3/struct__REGION__SEGMENT__HEADER.html">PREGION_SEGMENT_HEADER</a>;
00012 
<a name="l00013"></a><a class="code" href="../../d0/d3/struct__REGION__HEADER.html">00013</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d3/struct__REGION__HEADER.html">_REGION_HEADER</a> {
<a name="l00014"></a><a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o0">00014</a>     <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">SLIST_HEADER</a> <a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o0">ListHead</a>;
<a name="l00015"></a><a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o1">00015</a>     <a class="code" href="../../d8/d6/region_8h.html#a5">PREGION_SEGMENT_HEADER</a> <a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o1">FirstSegment</a>;
<a name="l00016"></a><a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o2">00016</a>     ULONG <a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o2">BlockSize</a>;
<a name="l00017"></a><a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o3">00017</a>     ULONG <a class="code" href="../../d0/d3/struct__REGION__HEADER.html#o3">TotalSize</a>;
00018 } <a class="code" href="../../d0/d3/struct__REGION__HEADER.html">REGION_HEADER</a>, *<a class="code" href="../../d0/d3/struct__REGION__HEADER.html">PREGION_HEADER</a>;
00019 
00020 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00021 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00022 <a class="code" href="../../d8/d6/region_8h.html#a8">ExInitializeRegion</a>(
00023     IN PREGION_HEADER Region,
00024     IN ULONG BlockSize,
00025     IN PVOID Segment,
00026     IN ULONG SegmentSize
00027     );
00028 
00029 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00030 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00031 <a class="code" href="../../d8/d6/region_8h.html#a9">ExInterlockedExtendRegion</a>(
00032     IN PREGION_HEADER Region,
00033     IN PVOID Segment,
00034     IN ULONG SegmentSize,
00035     IN PKSPIN_LOCK Lock
00036     );
00037 
00038 <span class="comment">//++</span>
00039 <span class="comment">//</span>
00040 <span class="comment">// PVOID</span>
00041 <span class="comment">// ExInterlockedAllocateFromRegion(</span>
00042 <span class="comment">//     IN PREGION_HEADER Region,</span>
00043 <span class="comment">//     IN PKSPIN_LOCK Lock</span>
00044 <span class="comment">//     )</span>
00045 <span class="comment">//</span>
00046 <span class="comment">// Routine Description:</span>
00047 <span class="comment">//</span>
00048 <span class="comment">//     This routine removes a free entry from the specified region and returns</span>
00049 <span class="comment">//     the address of the entry.</span>
00050 <span class="comment">//</span>
00051 <span class="comment">// Arguments:</span>
00052 <span class="comment">//</span>
00053 <span class="comment">//     Region - Supplies a pointer to the region header.</span>
00054 <span class="comment">//</span>
00055 <span class="comment">//     Lock - Supplies a pointer to a spinlock.</span>
00056 <span class="comment">//</span>
00057 <span class="comment">// Return Value:</span>
00058 <span class="comment">//</span>
00059 <span class="comment">//     The address of the removed entry is returned as the function value.</span>
00060 <span class="comment">//</span>
00061 <span class="comment">//--</span>
00062 
00063 <span class="preprocessor">#if defined(_ALPHA_) || defined(_MIPS_) || defined(_X86_)</span>
00064 <span class="preprocessor"></span>
00065 <span class="preprocessor">#define ExInterlockedAllocateFromRegion(Region, Lock) \</span>
00066 <span class="preprocessor">    (PVOID)ExInterlockedPopEntrySList(&amp;(Region)-&gt;ListHead, Lock)</span>
00067 <span class="preprocessor"></span>
00068 <span class="preprocessor">#else</span>
00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="../../d8/d6/region_8h.html#a0">00070</a> <span class="preprocessor">#define ExInterlockedAllocateFromRegion(Region, Lock) \</span>
00071 <span class="preprocessor">    (PVOID)ExInterlockedPopEntryList((PSINGLE_LIST_ENTRY)&amp;(Region)-&gt;ListHead.Next, Lock)</span>
00072 <span class="preprocessor"></span>
00073 <span class="preprocessor">#endif</span>
00074 <span class="preprocessor"></span>
00075 <span class="comment">//++</span>
00076 <span class="comment">//</span>
00077 <span class="comment">// PVOID</span>
00078 <span class="comment">// ExInterlockedFreeToRegion(</span>
00079 <span class="comment">//     IN PREGION_HEADER Region,</span>
00080 <span class="comment">//     IN PVOID Block,</span>
00081 <span class="comment">//     IN PKSPIN_LOCK Lock</span>
00082 <span class="comment">//     )</span>
00083 <span class="comment">//</span>
00084 <span class="comment">// Routine Description:</span>
00085 <span class="comment">//</span>
00086 <span class="comment">//     This routine inserts an entry at the front of the free list for the</span>
00087 <span class="comment">//     specified region.</span>
00088 <span class="comment">//</span>
00089 <span class="comment">// Arguments:</span>
00090 <span class="comment">//</span>
00091 <span class="comment">//     Region - Supplies a pointer to the region header.</span>
00092 <span class="comment">//</span>
00093 <span class="comment">//     Block - Supplies a pointer to the entry that is inserted at the front</span>
00094 <span class="comment">//        of the region free list.</span>
00095 <span class="comment">//</span>
00096 <span class="comment">//     Lock - Supplies a pointer to a spinlock.</span>
00097 <span class="comment">//</span>
00098 <span class="comment">// Return Value:</span>
00099 <span class="comment">//</span>
00100 <span class="comment">//     The previous firt entry in the region free list is returned as the</span>
00101 <span class="comment">//     function value. a value of NULL implies the region went from empty</span>
00102 <span class="comment">//     to at least one free block.</span>
00103 <span class="comment">//</span>
00104 <span class="comment">//--</span>
00105 
00106 <span class="preprocessor">#if defined(_ALPHA_) || defined(_MIPS_) || defined(_X86_)</span>
00107 <span class="preprocessor"></span>
00108 <span class="preprocessor">#define ExInterlockedFreeToRegion(Region, Block, Lock) \</span>
00109 <span class="preprocessor">    ExInterlockedPushEntrySList(&amp;(Region)-&gt;ListHead, ((PSINGLE_LIST_ENTRY)(Block)), Lock)</span>
00110 <span class="preprocessor"></span>
00111 <span class="preprocessor">#else</span>
00112 <span class="preprocessor"></span>
<a name="l00113"></a><a class="code" href="../../d8/d6/region_8h.html#a1">00113</a> <span class="preprocessor">#define ExInterlockedFreeToRegion(Region, Block, Lock) \</span>
00114 <span class="preprocessor">    ExInterlockedPushEntryList((PSINGLE_LIST_ENTRY)&amp;(Region)-&gt;ListHead.Next, ((PSINGLE_LIST_ENTRY)(Block)), Lock)</span>
00115 <span class="preprocessor"></span>
00116 <span class="preprocessor">#endif</span>
00117 <span class="preprocessor"></span>
00118 <span class="comment">//++</span>
00119 <span class="comment">//</span>
00120 <span class="comment">// BOOLEAN</span>
00121 <span class="comment">// ExIsFullRegion(</span>
00122 <span class="comment">//     IN PREGION_HEADER Region</span>
00123 <span class="comment">//     )</span>
00124 <span class="comment">//</span>
00125 <span class="comment">// Routine Description:</span>
00126 <span class="comment">//</span>
00127 <span class="comment">//     This routine determines if the specified region is full. A region is</span>
00128 <span class="comment">//     considered full if the free list is empty.</span>
00129 <span class="comment">//</span>
00130 <span class="comment">// Arguments:</span>
00131 <span class="comment">//</span>
00132 <span class="comment">//     Region - Supplies a pointer the region header.</span>
00133 <span class="comment">//</span>
00134 <span class="comment">// Return Value:</span>
00135 <span class="comment">//</span>
00136 <span class="comment">//     TRUE if the region is full and FALSE otherwise.</span>
00137 <span class="comment">//</span>
00138 <span class="comment">//--</span>
00139 
<a name="l00140"></a><a class="code" href="../../d8/d6/region_8h.html#a2">00140</a> <span class="preprocessor">#define ExIsFullRegion(Region) \</span>
00141 <span class="preprocessor">    ((Region)-&gt;ListHead.Next == (PSINGLE_LIST_ENTRY)NULL)</span>
00142 <span class="preprocessor"></span>
00143 <span class="comment">//++</span>
00144 <span class="comment">//</span>
00145 <span class="comment">// BOOLEAN</span>
00146 <span class="comment">// ExIsObjectInFirstRegionSegment(</span>
00147 <span class="comment">//     IN PREGION_HEADER Region,</span>
00148 <span class="comment">//     IN PVOID Object</span>
00149 <span class="comment">//     )</span>
00150 <span class="comment">//</span>
00151 <span class="comment">// Routine Description:</span>
00152 <span class="comment">//</span>
00153 <span class="comment">//     This routine determines if the specified object is contained in the</span>
00154 <span class="comment">//     first region segement.</span>
00155 <span class="comment">//</span>
00156 <span class="comment">// Arguments:</span>
00157 <span class="comment">//</span>
00158 <span class="comment">//     Region - Supplies a pointer to the region header.</span>
00159 <span class="comment">//</span>
00160 <span class="comment">//     Object - Supplies a pointer to an object.</span>
00161 <span class="comment">//</span>
00162 <span class="comment">// Return Value:</span>
00163 <span class="comment">//</span>
00164 <span class="comment">//     TRUE if the Object came from the first segment of region.</span>
00165 <span class="comment">//</span>
00166 <span class="comment">//--</span>
00167 
<a name="l00168"></a><a class="code" href="../../d8/d6/region_8h.html#a3">00168</a> <span class="preprocessor">#define ExIsObjectInFirstRegionSegment(Region, Object) ((BOOLEAN)   \</span>
00169 <span class="preprocessor">    (((PUCHAR)(Object) &gt;= ((PUCHAR)((Region)-&gt;FirstSegment) + sizeof(REGION_SEGMENT_HEADER))) &amp;&amp;        \</span>
00170 <span class="preprocessor">     ((PUCHAR)(Object) &lt; ((PUCHAR)((Region)-&gt;FirstSegment) + (Region)-&gt;TotalSize + sizeof(REGION_SEGMENT_HEADER)))))</span>
00171 <span class="preprocessor"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:37 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
