<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: verifier.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>verifier.c File Reference</h1><code>#include "<a class="el" href="../../d5/d7/mi_8h-source.html">mi.h</a>"</code><br>

<p>
<a href="../../d0/d5/verifier_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">_VERIFIER_THUNKS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">_DRIVER_SPECIFIED_VERIFIER_THUNKS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">_VERIFIER_STRING_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a0">THUNKED_API</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a1">VI_BAD_MAPPERS_MAX</a>&nbsp;&nbsp;&nbsp;100</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a2">VI_POOL_ENTRIES_PER_PAGE</a>&nbsp;&nbsp;&nbsp;(PAGE_SIZE / sizeof(<a class="el" href="../../d7/d6/struct__VI__POOL__ENTRY.html">VI_POOL_ENTRY</a>))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a3">UNICODE_TAB</a>&nbsp;&nbsp;&nbsp;0x0009</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a4">UNICODE_LF</a>&nbsp;&nbsp;&nbsp;0x000A</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a5">UNICODE_CR</a>&nbsp;&nbsp;&nbsp;0x000D</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>&nbsp;&nbsp;&nbsp;0x0020</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a7">UNICODE_CJK_SPACE</a>&nbsp;&nbsp;&nbsp;0x3000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a8">UNICODE_WHITESPACE</a>(_ch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a9">MM_BOOT_IMAGE_SIZE</a>&nbsp;&nbsp;&nbsp;(16 * 1024 * 1024)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a10">ROUND_UP</a>(VALUE, ROUND)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a11">X86_HAL_ROUTINE</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a12">POOL_ROUTINE</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a13">VERIFIER_THUNK_IN_HAL</a>(Flag)&nbsp;&nbsp;&nbsp;(Flag &amp; X86_HAL_ROUTINE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a14">VERIFIER_POOL_ROUTINE</a>(Flag)&nbsp;&nbsp;&nbsp;(Flag &amp; POOL_ROUTINE)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">_VERIFIER_THUNKS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a37">VERIFIER_THUNKS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">_VERIFIER_THUNKS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a38">PVERIFIER_THUNKS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">_DRIVER_SPECIFIED_VERIFIER_THUNKS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a39">DRIVER_SPECIFIED_VERIFIER_THUNKS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">_DRIVER_SPECIFIED_VERIFIER_THUNKS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a40">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a44">PKE_ACQUIRE_SPINLOCK</a> )(IN PKSPIN_LOCK SpinLock, OUT PKIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a45">PKE_RELEASE_SPINLOCK</a> )(IN PKSPIN_LOCK SpinLock, IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a46">PKE_RAISE_IRQL</a> )(IN KIRQL NewIrql, OUT PKIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a47">PKE_LOWER_IRQL</a> )(IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">_VERIFIER_STRING_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a49">VERIFIER_STRING_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">_VERIFIER_STRING_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a50">PVERIFIER_STRING_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a54">VerifierAllocatePool</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a55">VerifierAllocatePoolWithTag</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes, IN ULONG Tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a56">VerifierAllocatePoolWithQuotaTag</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes, IN ULONG Tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a57">VerifierAllocatePoolWithTagPriority</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes, IN ULONG Tag, IN <a class="el" href="../../d5/d8/ex_8h.html#a97">EX_POOL_PRIORITY</a> Priority)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes, IN ULONG Tag, IN <a class="el" href="../../d5/d8/ex_8h.html#a97">EX_POOL_PRIORITY</a> Priority, IN PVOID CallingAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a59">VerifierFreePool</a> (IN PVOID P)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a60">VerifierFreePoolWithTag</a> (IN PVOID P, IN ULONG TagToFree)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a61">VerifierSetEvent</a> (IN <a class="el" href="../../d2/d6/struct__KEVENT.html">PRKEVENT</a> Event, IN KPRIORITY Increment, IN BOOLEAN Wait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API KIRQL FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a62">VerifierKfRaiseIrql</a> (IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a63">VerifierKfLowerIrql</a> (IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a64">VerifierKeRaiseIrql</a> (IN KIRQL NewIrql, OUT PKIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a65">VerifierKeLowerIrql</a> (IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a66">VerifierKeAcquireSpinLock</a> (IN PKSPIN_LOCK SpinLock, OUT PKIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a67">VerifierKeReleaseSpinLock</a> (IN PKSPIN_LOCK SpinLock, IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API KIRQL FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a68">VerifierKfAcquireSpinLock</a> (IN PKSPIN_LOCK SpinLock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a69">VerifierKfReleaseSpinLock</a> (IN PKSPIN_LOCK SpinLock, IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a70">VerifierKeInitializeTimerEx</a> (IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer, IN TIMER_TYPE Type)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a71">VerifierKeInitializeTimer</a> (IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API BOOLEAN FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a72">VerifierExTryToAcquireFastMutex</a> (IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a> FastMutex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a73">VerifierExAcquireFastMutex</a> (IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a> FastMutex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a74">VerifierExReleaseFastMutex</a> (IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a> FastMutex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a75">VerifierExAcquireFastMutexUnsafe</a> (IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a> FastMutex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a76">VerifierExReleaseFastMutexUnsafe</a> (IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a> FastMutex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a77">VerifierExAcquireResourceExclusive</a> (IN <a class="el" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>, IN BOOLEAN Wait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a78">VerifierExReleaseResource</a> (IN <a class="el" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API KIRQL FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a79">VerifierKeAcquireQueuedSpinLock</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a35">KSPIN_LOCK_QUEUE_NUMBER</a> Number)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a80">VerifierKeReleaseQueuedSpinLock</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a35">KSPIN_LOCK_QUEUE_NUMBER</a> Number, IN KIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a81">VerifierSynchronizeExecution</a> (IN <a class="el" href="../../d0/d7/struct__KINTERRUPT.html">PKINTERRUPT</a> Interrupt, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a44">PKSYNCHRONIZE_ROUTINE</a> SynchronizeRoutine, IN PVOID SynchronizeContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a82">VerifierProbeAndLockPages</a> (IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN <a class="el" href="../../d2/d1/mm_8h.html#a141">LOCK_OPERATION</a> Operation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a83">VerifierProbeAndLockProcessPages</a> (IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList, IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN <a class="el" href="../../d2/d1/mm_8h.html#a141">LOCK_OPERATION</a> Operation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a84">VerifierProbeAndLockSelectedPages</a> (IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList, IN PFILE_SEGMENT_ELEMENT SegmentArray, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN <a class="el" href="../../d2/d1/mm_8h.html#a141">LOCK_OPERATION</a> Operation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a85">VerifierUnlockPages</a> (IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a86">VerifierUnmapLockedPages</a> (IN PVOID BaseAddress, IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a87">VerifierUnmapIoSpace</a> (IN PVOID BaseAddress, IN SIZE_T NumberOfBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a88">VerifierMapIoSpace</a> (IN PHYSICAL_ADDRESS PhysicalAddress, IN SIZE_T NumberOfBytes, IN <a class="el" href="../../d4/d9/ke_8h.html#a156">MEMORY_CACHING_TYPE</a> CacheType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a89">VerifierMapLockedPages</a> (IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a90">VerifierMapLockedPagesSpecifyCache</a> (IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> MemoryDescriptorList, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN <a class="el" href="../../d4/d9/ke_8h.html#a156">MEMORY_CACHING_TYPE</a> CacheType, IN PVOID RequestedAddress, IN ULONG BugCheckOnFailure, IN <a class="el" href="../../d2/d1/mm_8h.html#a154">MM_PAGE_PRIORITY</a> Priority)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a91">VerifierFreeTrackedPool</a> (IN PVOID VirtualAddress, IN SIZE_T ChargedBytes, IN LOGICAL CheckType, IN LOGICAL SpecialPool)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a92">ViPrintString</a> (IN PUNICODE_STRING DriverName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a93">ViInjectResourceFailure</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a94">ViTrimAllSystemPagableMemory</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a95">ViInitializeEntry</a> (IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier, IN LOGICAL FirstLoad)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a96">ViReservePoolAllocation</a> (IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a97">ViInsertPoolAllocation</a> (IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier, IN PVOID VirtualAddress, IN PVOID CallingAddress, IN SIZE_T NumberOfBytes, IN ULONG Tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a98">ViCancelPoolAllocation</a> (IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a99">ViReleasePoolAllocation</a> (IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier, IN PVOID VirtualAddress, IN ULONG_PTR ListIndex, IN SIZE_T ChargedBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a100">KfSanityCheckRaiseIrql</a> (IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a101">KfSanityCheckLowerIrql</a> (IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a102">MiEnableVerifier</a> (IN PLDR_DATA_TABLE_ENTRY DataTableEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a103">ViInsertVerifierEntry</a> (IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a104">ViPostPoolAllocation</a> (IN PVOID VirtualAddress, IN SIZE_T NumberOfBytes, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG Tag, IN PVOID CallingAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a105">ViLocateVerifierEntry</a> (IN PVOID SystemAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a106">MiVerifierCheckThunks</a> (IN PLDR_DATA_TABLE_ENTRY DataTableEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a107">ViAddBadMapper</a> (IN PVOID BadMapper)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>THUNKED_API PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a108">VerifierAllocatePoolWithQuota</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a109">MiInitializeDriverVerifierList</a> (IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a110">MiApplyDriverVerifier</a> (IN PLDR_DATA_TABLE_ENTRY DataTableEntry, IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a111">MiVerifyingDriverUnloading</a> (IN PLDR_DATA_TABLE_ENTRY DataTableEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a112">MmIsDriverVerifying</a> (IN <a class="el" href="../../d4/d9/struct__DRIVER__OBJECT.html">PDRIVER_OBJECT</a> DriverObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a113">MmAddVerifierThunks</a> (IN PVOID ThunkBuffer, IN ULONG ThunkBufferSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a114">MmGetVerifierInformation</a> (OUT PVOID SystemInformation, IN ULONG SystemInformationLength, OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a115">MmSetVerifierInformation</a> (IN OUT PVOID SystemInformation, IN ULONG SystemInformationLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a> (IN KIRQL NewIrql, OUT PKIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a> (IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a118">KeAcquireSpinLock</a> (IN PKSPIN_LOCK SpinLock, OUT PKIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a> (IN PKSPIN_LOCK SpinLock, IN KIRQL NewIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a120">ExAcquireResourceExclusive</a> (IN <a class="el" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a> <a class="el" href="../../d4/d0/tex_8c.html#a21">Resource</a>, IN BOOLEAN Wait)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d9/struct__MM__DRIVER__VERIFIER__DATA.html">MM_DRIVER_VERIFIER_DATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a15">MmVerifierData</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a16">VerifierModifyableOptions</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a17">VerifierOptionChanges</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a18">MiSuspectDriverList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a19">MiVerifyAllDrivers</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a21">MiActiveVerifies</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a22">MiActiveVerifierThunks</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a23">MiNoPageOnRaiseIrql</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a24">MiVerifierStackProtectTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a25">MmDontVerifyRandomDrivers</a> = TRUE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a26">VerifierSystemSufficientlyBooted</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a27">VerifierRequiredTimeSinceBoot</a> = {(ULONG)(40 * 1000 * 1000 * 10), 1}</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a28">VerifierIsTrackingPool</a> = FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a29">VerifierListLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a30">VerifierPoolLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a31">VerifierPoolMutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PRTL_BITMAP&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a32">VerifierLargePagedPoolMap</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a33">MiVerifierDriverAddedThunkListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a34">MmSpecialPoolCatchOverruns</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a35">KernelVerifier</a> = FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a36">KernelVerifierTickPage</a> = 0x7</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a41">ViBadMapperLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a42">ViBadMappers</a> [VI_BAD_MAPPERS_MAX]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a> [0x10]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PUNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a48">ViBadDriver</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a51">Printable</a> [] = L"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a52">PrintableChars</a> = sizeof (<a class="el" href="../../d9/d5/verifier_8c.html#a51">Printable</a>) / sizeof (<a class="el" href="../../d9/d5/verifier_8c.html#a51">Printable</a>[0]) - 1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">VERIFIER_THUNKS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/verifier_8c.html#a53">MiVerifierThunks</a> []</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a9" doxytag="verifier.c::MM_BOOT_IMAGE_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MM_BOOT_IMAGE_SIZE&nbsp;&nbsp;&nbsp;(16 * 1024 * 1024)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03843">3843</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="verifier.c::POOL_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_ROUTINE&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04511">4511</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="verifier.c::ROUND_UP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ROUND_UP          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VALUE,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ROUND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((ULONG)(((ULONG)VALUE + \
                               ((ULONG)ROUND - 1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)) &amp; (~((ULONG)ROUND - 1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>))))
</div></pre>
<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04042">4042</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="verifier.c::THUNKED_API" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define THUNKED_API          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00022">22</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="verifier.c::UNICODE_CJK_SPACE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNICODE_CJK_SPACE&nbsp;&nbsp;&nbsp;0x3000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03112">3112</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/nls_8c-source.html#l02098">RtlIsTextUnicode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="verifier.c::UNICODE_CR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNICODE_CR&nbsp;&nbsp;&nbsp;0x000D          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03110">3110</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/nls_8c-source.html#l02098">RtlIsTextUnicode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="verifier.c::UNICODE_LF" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNICODE_LF&nbsp;&nbsp;&nbsp;0x000A          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03109">3109</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/nls_8c-source.html#l02098">RtlIsTextUnicode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="verifier.c::UNICODE_SPACE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNICODE_SPACE&nbsp;&nbsp;&nbsp;0x0020          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03111">3111</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/imefull_8c-source.html#l00281">CharHandlerToConsole()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02388">FastStreamWrite()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00061">FE_StreamWriteToScreenBuffer()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l00805">GetSystemLineJ()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l01071">GetSystemLineP()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l00962">GetSystemLineT()</a>, <a class="el" href="../../d1/d5/consubs_8c-source.html#l00160">ImeUIComposition()</a>, <a class="el" href="../../d1/d5/consubs_8c-source.html#l00108">ImeUIEndComposition()</a>, <a class="el" href="../../d1/d5/consubs_8c-source.html#l00067">ImeUIStartComposition()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00692">IncludeCandidateP()</a>, <a class="el" href="../../d1/d4/ntcon_2conime_2conime_8c-source.html#l00109">InitConsoleIME()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00744">MakeInfoStringKorea()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00555">MakeStatusStrPRC1()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00608">MakeStatusStrPRC2()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00328">MakeStatusStrTaiwan1()</a>, <a class="el" href="../../d7/d6/country_8c-source.html#l00388">MakeStatusStrTaiwan2()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l01182">NumString()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01415">ReadRectFromScreenBuffer()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l02098">RtlIsTextUnicode()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00809">WWSB_DoWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01918">WWSB_FillRectangle()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00552">WWSB_WriteRegionToScreen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="verifier.c::UNICODE_TAB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNICODE_TAB&nbsp;&nbsp;&nbsp;0x0009          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03108">3108</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02059">ECInsertText()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00818">RetrieveNumberOfSpaces()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00774">RetrieveTotalNumberOfSpaces()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l02098">RtlIsTextUnicode()</a>, and <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="verifier.c::UNICODE_WHITESPACE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNICODE_WHITESPACE          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_ch&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(((_ch) == <a class="code" href="../../d9/d5/verifier_8c.html#a3">UNICODE_TAB</a>) || \
                                     ((_ch) == <a class="code" href="../../d9/d5/verifier_8c.html#a4">UNICODE_LF</a>) || \
                                     ((_ch) == <a class="code" href="../../d9/d5/verifier_8c.html#a5">UNICODE_CR</a>) || \
                                     ((_ch) == <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>) || \
                                     ((_ch) == <a class="code" href="../../d9/d5/verifier_8c.html#a7">UNICODE_CJK_SPACE</a>))
</div></pre>
<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03114">3114</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="verifier.c::VERIFIER_POOL_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VERIFIER_POOL_ROUTINE          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flag&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(Flag &amp; POOL_ROUTINE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04514">4514</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="verifier.c::VERIFIER_THUNK_IN_HAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VERIFIER_THUNK_IN_HAL          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flag&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(Flag &amp; X86_HAL_ROUTINE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04513">4513</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="verifier.c::VI_BAD_MAPPERS_MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VI_BAD_MAPPERS_MAX&nbsp;&nbsp;&nbsp;100          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00626">626</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l00632">ViAddBadMapper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="verifier.c::VI_POOL_ENTRIES_PER_PAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VI_POOL_ENTRIES_PER_PAGE&nbsp;&nbsp;&nbsp;(PAGE_SIZE / sizeof(<a class="el" href="../../d7/d6/struct__VI__POOL__ENTRY.html">VI_POOL_ENTRY</a>))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01233">ViReservePoolAllocation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="verifier.c::X86_HAL_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define X86_HAL_ROUTINE&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04508">4508</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a39" doxytag="verifier.c::DRIVER_SPECIFIED_VERIFIER_THUNKS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">_DRIVER_SPECIFIED_VERIFIER_THUNKS</a>  <a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">DRIVER_SPECIFIED_VERIFIER_THUNKS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="verifier.c::PDRIVER_SPECIFIED_VERIFIER_THUNKS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">_DRIVER_SPECIFIED_VERIFIER_THUNKS</a> * <a class="el" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03982">MiVerifierCheckThunks()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03846">MmAddVerifierThunks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="verifier.c::PKE_ACQUIRE_SPINLOCK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d9/d5/verifier_8c.html#a44">PKE_ACQUIRE_SPINLOCK</a>)(IN PKSPIN_LOCK SpinLock, OUT PKIRQL OldIrql)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02358">2358</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02365">VerifierKeAcquireSpinLock()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="verifier.c::PKE_LOWER_IRQL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d9/d5/verifier_8c.html#a47">PKE_LOWER_IRQL</a>)(IN KIRQL NewIrql)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02966">2966</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02972">VerifierKeLowerIrql()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="verifier.c::PKE_RAISE_IRQL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d9/d5/verifier_8c.html#a46">PKE_RAISE_IRQL</a>)(IN KIRQL NewIrql, OUT PKIRQL OldIrql)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02927">2927</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02934">VerifierKeRaiseIrql()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="verifier.c::PKE_RELEASE_SPINLOCK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d9/d5/verifier_8c.html#a45">PKE_RELEASE_SPINLOCK</a>)(IN PKSPIN_LOCK SpinLock, IN KIRQL NewIrql)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02399">2399</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02406">VerifierKeReleaseSpinLock()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="verifier.c::PVERIFIER_STRING_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">_VERIFIER_STRING_INFO</a> * <a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">PVERIFIER_STRING_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="verifier.c::PVERIFIER_THUNKS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">_VERIFIER_THUNKS</a> * <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">PVERIFIER_THUNKS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="verifier.c::VERIFIER_STRING_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">_VERIFIER_STRING_INFO</a>  <a class="el" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">VERIFIER_STRING_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="verifier.c::VERIFIER_THUNKS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">_VERIFIER_THUNKS</a>  <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">VERIFIER_THUNKS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a120" doxytag="verifier.c::ExAcquireResourceExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ExAcquireResourceExclusive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Resource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a118" doxytag="verifier.c::KeAcquireSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeAcquireSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>SpinLock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a117" doxytag="verifier.c::KeLowerIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeLowerIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01028">CmNotifyRunDown()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00922">CmpPostApcRunDown()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00357">CmpReportNotifyHelper()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00262">ExUnlockPool()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12535">IoCancelFileOpen()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02242">IoCancelThreadIo()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00417">IopCancelAlertedRequest()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00036">IopCloseFile()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00417">IopDeleteFile()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01623">IopDisassociateThreadIrp()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07030">IopSynchronousServiceTail()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10735">IoStartPacket()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l01901">IovpCompleteRequest5()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">KdEnableDebugger()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00379">KdLogDbgPrint()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00074">KeChangeColorPage()</a>, <a class="el" href="../../d7/d3/mips_2intobj_8c-source.html#l00153">KeConnectInterrupt()</a>, <a class="el" href="../../d0/d8/i386_2exceptn_8c-source.html#l00544">KeContextToKframes()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01064">KeDeregisterBugCheckCallback()</a>, <a class="el" href="../../d7/d3/mips_2intobj_8c-source.html#l00301">KeDisconnectInterrupt()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00374">KeFlushIoBuffers()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">KeFlushMultipleTb64()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">KeFlushSingleTb64()</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01123">KeRegisterBugCheckCallback()</a>, <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html#l00454">KeSetAutoAlignmentThread()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00453">KeSweepCacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00071">KeSweepDcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00674">KeSweepDcacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00202">KeSweepIcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00559">KeSweepIcacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00561">KeSynchronizeMemoryAccess()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>, <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00099">KiContinue()</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>, <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l02880">MiCheckVirtualAddress()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l04726">MiEmptyWorkingSet()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l03198">MiGatherMappedPages()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l03701">MiGatherPagefilePages()</a>, <a class="el" href="../../d2/d1/mm_2i386_2init386_8c-source.html#l00058">MiInitMachineDependent()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l04239">MiMappedPageWriter()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l01354">MiReleaseSystemPtes()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l00843">MiReserveSystemPtes2()</a>, <a class="el" href="../../d5/d0/mmfault_8c-source.html#l00041">MmAccessFault()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01274">MmCopyToCachedPage()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l02986">MmTrimAllSystemPagableMemory()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00397">MmWorkingSetManager()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00049">NtCancelIoFile()</a>, <a class="el" href="../../d6/d4/rdwr_8c-source.html#l00050">NTFastDOSIO()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00869">Ps386GetVdmIoHandler()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00730">Psp386CreateVdmIoListHead()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00477">Psp386InstallIoHandler()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00280">Psp386RemoveIoHandler()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01920">PspSystemThreadStartup()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01800">PspUserThreadStartup()</a>, <a class="el" href="../../d7/d3/vdmfault_8c-source.html#l00036">VdmDispatchPageFault()</a>, <a class="el" href="../../d5/d4/vdmprint_8c-source.html#l00236">VdmFlushPrinterWriteData()</a>, <a class="el" href="../../d5/d4/vdmprint_8c-source.html#l00042">VdmPrinterStatus()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00040">VdmpStartExecution()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, <a class="el" href="../../d7/d4/vdmtrace_8c-source.html#l00037">VdmTraceEvent()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02972">VerifierKeLowerIrql()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a116" doxytag="verifier.c::KeRaiseIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeRaiseIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>NewIrql</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01028">CmNotifyRunDown()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00922">CmpPostApcRunDown()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00357">CmpReportNotifyHelper()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00190">ExLockPool()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12535">IoCancelFileOpen()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02242">IoCancelThreadIo()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00417">IopCancelAlertedRequest()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00036">IopCloseFile()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00417">IopDeleteFile()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01623">IopDisassociateThreadIrp()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07030">IopSynchronousServiceTail()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10735">IoStartPacket()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l01416">IovpCompleteRequest2()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03240">KdDisableDebugger()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03282">KdEnableDebugger()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00379">KdLogDbgPrint()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d7/d3/mips_2intobj_8c-source.html#l00153">KeConnectInterrupt()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01064">KeDeregisterBugCheckCallback()</a>, <a class="el" href="../../d7/d3/mips_2intobj_8c-source.html#l00301">KeDisconnectInterrupt()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01123">KeRegisterBugCheckCallback()</a>, <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html#l00454">KeSetAutoAlignmentThread()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01112">KiCompleteEffectiveRangeChange()</a>, <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00099">KiContinue()</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, <a class="el" href="../../d0/d3/pat_8c-source.html#l00119">KiInitializePAT()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l02880">MiCheckVirtualAddress()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l04726">MiEmptyWorkingSet()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l03198">MiGatherMappedPages()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l03701">MiGatherPagefilePages()</a>, <a class="el" href="../../d2/d1/mm_2i386_2init386_8c-source.html#l00058">MiInitMachineDependent()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l04239">MiMappedPageWriter()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l01354">MiReleaseSystemPtes()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l00843">MiReserveSystemPtes2()</a>, <a class="el" href="../../d5/d0/mmfault_8c-source.html#l00041">MmAccessFault()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01274">MmCopyToCachedPage()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00397">MmWorkingSetManager()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00049">NtCancelIoFile()</a>, <a class="el" href="../../d6/d4/rdwr_8c-source.html#l00050">NTFastDOSIO()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00869">Ps386GetVdmIoHandler()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00730">Psp386CreateVdmIoListHead()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00477">Psp386InstallIoHandler()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00280">Psp386RemoveIoHandler()</a>, <a class="el" href="../../d7/d3/vdmfault_8c-source.html#l00036">VdmDispatchPageFault()</a>, <a class="el" href="../../d5/d4/vdmprint_8c-source.html#l00236">VdmFlushPrinterWriteData()</a>, <a class="el" href="../../d5/d4/vdmprint_8c-source.html#l00042">VdmPrinterStatus()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00040">VdmpStartExecution()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, <a class="el" href="../../d7/d4/vdmtrace_8c-source.html#l00037">VdmTraceEvent()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02934">VerifierKeRaiseIrql()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a119" doxytag="verifier.c::KeReleaseSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeReleaseSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>SpinLock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>NewIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00563">ExNotifyCallback()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00378">ExRegisterCallback()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00262">ExUnlockPool()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00479">ExUnregisterCallback()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00328">KdDeregisterDebuggerDataBlock()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00528">KdpTimeSlipWork()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00252">KdRegisterDebuggerDataBlock()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00453">KdUpdateTimeSlipEvent()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l00526">KeRestoreMtrr()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l00576">KeSetPhysicalCacheTypeRange()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00276">KeSweepDcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00143">KeSweepIcache()</a>, <a class="el" href="../../d1/d4/mtrramd_8c-source.html#l00168">KiAmdK6InitializeMTRR()</a>, <a class="el" href="../../d1/d4/mtrramd_8c-source.html#l00294">KiAmdK6MtrrSetMemoryType()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l00246">KiInitializeKernel()</a>, <a class="el" href="../../d6/d5/memprint_8c-source.html#l00250">MemPrint()</a>, <a class="el" href="../../d6/d5/memprint_8c-source.html#l00492">MemPrintFlush()</a>, <a class="el" href="../../d6/d5/memprint_8c-source.html#l00862">MemPrintWriteCompleteApc()</a>, <a class="el" href="../../d6/d5/memprint_8c-source.html#l00598">MemPrintWriteThread()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00203">PspDeleteVdmObjects()</a>, <a class="el" href="../../d9/d6/rtl_2remlock_8c-source.html#l00091">RtlAcquireRemoveLockEx()</a>, <a class="el" href="../../d9/d6/rtl_2remlock_8c-source.html#l00204">RtlReleaseRemoveLock()</a>, <a class="el" href="../../d3/d8/workque_8c-source.html#l00316">UdfAddToWorkque()</a>, <a class="el" href="../../d1/d7/fspdisp_8c-source.html#l00038">UdfFspDispatch()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01709">VdmpDelayIntApcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01583">VdmpDelayIntDpcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02406">VerifierKeReleaseSpinLock()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a101" doxytag="verifier.c::KfSanityCheckLowerIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KfSanityCheckLowerIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02283">2283</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02230">VerifierIrqlData</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02972">VerifierKeLowerIrql()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02406">VerifierKeReleaseSpinLock()</a>.
<p>
<pre class="fragment"><div>02286 {
02287     KIRQL CurrentIrql;
02288 
02289     <span class="comment">//</span>
02290     <span class="comment">// Check for the caller inadvertently lowering.</span>
02291     <span class="comment">//</span>
02292 
02293     CurrentIrql = KeGetCurrentIrql ();
02294 
02295     <span class="keywordflow">if</span> (CurrentIrql == NewIrql) {
02296         <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[8] += 1;
02297         <span class="keywordflow">if</span> (CurrentIrql == <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
02298             <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[9] += 1;
02299         }
02300         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CurrentIrql == <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
02301             <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[10] += 1;
02302         }
02303         <span class="keywordflow">else</span> {
02304             <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[11] += 1;
02305         }
02306     }
02307     <span class="keywordflow">else</span> {
02308         <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[12] += 1;
02309     }
02310 
02311     <span class="keywordflow">if</span> (CurrentIrql &lt; NewIrql) {
02312         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02313                       0x31,
02314                       CurrentIrql,
02315                       NewIrql,
02316                       0);
02317     }
02318 
02319     <span class="comment">//</span>
02320     <span class="comment">// Check for the caller using an uninitialized variable.</span>
02321     <span class="comment">//</span>
02322 
02323     <span class="keywordflow">if</span> (NewIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a57">HIGH_LEVEL</a>) {
02324         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02325                       0x31,
02326                       CurrentIrql,
02327                       NewIrql,
02328                       0);
02329     }
02330 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a100" doxytag="verifier.c::KfSanityCheckRaiseIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KfSanityCheckRaiseIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02233">2233</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02230">VerifierIrqlData</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02365">VerifierKeAcquireSpinLock()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02934">VerifierKeRaiseIrql()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02993">VerifierSynchronizeExecution()</a>.
<p>
<pre class="fragment"><div>02236 {
02237     KIRQL CurrentIrql;
02238 
02239     <span class="comment">//</span>
02240     <span class="comment">// Check for the caller inadvertently lowering.</span>
02241     <span class="comment">//</span>
02242 
02243     CurrentIrql = KeGetCurrentIrql ();
02244 
02245     <span class="keywordflow">if</span> (CurrentIrql == NewIrql) {
02246         <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[0] += 1;
02247         <span class="keywordflow">if</span> (CurrentIrql == <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
02248             <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[1] += 1;
02249         }
02250         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CurrentIrql == <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
02251             <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[2] += 1;
02252         }
02253         <span class="keywordflow">else</span> {
02254             <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[3] += 1;
02255         }
02256     }
02257     <span class="keywordflow">else</span> {
02258         <a class="code" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[4] += 1;
02259     }
02260 
02261     <span class="keywordflow">if</span> (CurrentIrql &gt; NewIrql) {
02262         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02263                       0x30,
02264                       CurrentIrql,
02265                       NewIrql,
02266                       0);
02267     }
02268 
02269     <span class="comment">//</span>
02270     <span class="comment">// Check for the caller using an uninitialized variable.</span>
02271     <span class="comment">//</span>
02272 
02273     <span class="keywordflow">if</span> (NewIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a57">HIGH_LEVEL</a>) {
02274         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02275                       0x30,
02276                       CurrentIrql,
02277                       NewIrql,
02278                       0);
02279     }
02280 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a110" doxytag="verifier.c::MiApplyDriverVerifier" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL MiApplyDriverVerifier           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLDR_DATA_TABLE_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>DataTableEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Verifier</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">3448</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02783">KiStackProtectTime</a>, <a class="el" href="../../d4/d8/mi_8h.html#a548">MI_VERIFIER_DRIVER_ENTRY</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00376">MiActiveVerifies</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03398">MiEnableRandomSpecialPool()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00246">MiFaultRetries</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00245">MiIoRetryLevel</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04193">MiSuspectDriverList</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00248">MiUserFaultRetries</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00247">MiUserIoRetryLevel</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00382">MiVerifierStackProtectTime</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00372">MiVerifyAllDrivers</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00374">MiVerifyRandomDrivers</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01608">RtlEqualUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01178">RtlUpcaseUnicodeChar()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04109">VI_VERIFYING_INVERSELY</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03047">ViInitializeEntry()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03360">ViInsertVerifierEntry()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l04336">ViPrintString()</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>.
<p>
<pre class="fragment"><div>03455                    :
03456 
03457     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called as each module <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> loaded.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> module being
03458     loaded <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> suspect list, thunk <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> here.
03459 
03460 Arguments:
03461 
03462     DataTableEntry - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data table entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> module.
03463 
03464     Verifier - Non-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> verification must be applied.  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates
03465                       that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver name must match <span class="keywordflow">for</span> verification to be
03466                       applied.
03467 
03468 Return Value:
03469 
03470     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> thunking was applied, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
03471 
03472 Environment:
03473 
03474     Kernel mode, Phase 0 Initialization and normal runtime.
03475     Non paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> exists in Phase0, but paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> does not.
03476     Post-Phase0 serialization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d8/mi_8h.html#a432">MmSystemLoadLock</a>.
03477 
03478 --*/
03479 
03480 {
03481     WCHAR FirstChar;
03482     LOGICAL Found;
03483     PLIST_ENTRY NextEntry;
03484     ULONG VerifierFlags;
03485 
03486     <span class="keywordflow">if</span> (Verifier != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03487         Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03488     }
03489     <span class="keywordflow">else</span> {
03490         Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03491         NextEntry = <a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>.Flink;
03492         <span class="keywordflow">while</span> (NextEntry != &amp;<a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>) {
03493 
03494             Verifier = CONTAINING_RECORD(NextEntry,
03495                                          <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>,
03496                                          Links);
03497 
03498             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a> (&amp;Verifier-&gt;BaseName,
03499                                        &amp;DataTableEntry-&gt;BaseDllName,
03500                                        TRUE)) {
03501 
03502                 Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03503                 <a class="code" href="../../d9/d5/verifier_8c.html#a95">ViInitializeEntry</a> (Verifier, FALSE);
03504                 <span class="keywordflow">break</span>;
03505             }
03506             NextEntry = NextEntry-&gt;Flink;
03507         }
03508     }
03509 
03510     <span class="keywordflow">if</span> (Found == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03511         VerifierFlags = <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>;
03512         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a19">MiVerifyAllDrivers</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03513             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03514                 VerifierFlags = <a class="code" href="../../d4/d8/mi_8h.html#a253">VI_VERIFYING_INVERSELY</a>;
03515             }
03516             Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03517         }
03518         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> != (WCHAR)0) {
03519 
03520             <span class="comment">//</span>
03521             <span class="comment">// Wildcard match drivers randomly.</span>
03522             <span class="comment">//</span>
03523 
03524             FirstChar = <a class="code" href="../../d6/d6/nls_8c.html#a33">RtlUpcaseUnicodeChar</a>(DataTableEntry-&gt;BaseDllName.Buffer[0]);
03525 
03526             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == FirstChar) {
03527                 Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03528             }
03529             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)<span class="charliteral">'X'</span>) {
03530                 <span class="keywordflow">if</span> ((FirstChar &gt;= (WCHAR)<span class="charliteral">'0'</span>) &amp;&amp; (FirstChar &lt;= (WCHAR)<span class="charliteral">'9'</span>)) {
03531                     Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03532                 }
03533             }
03534         }
03535 
03536         <span class="keywordflow">if</span> (Found == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03537             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03538         }
03539 
03540         Verifier = (<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a> (
03541                                     NonPagedPool,
03542                                     <span class="keyword">sizeof</span> (<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>) +
03543                                         DataTableEntry-&gt;BaseDllName.MaximumLength,
03544                                     'dLmM');
03545 
03546         <span class="keywordflow">if</span> (Verifier == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03547             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03548         }
03549 
03550         Verifier-&gt;BaseName.Buffer = (PWSTR)((PCHAR)Verifier +
03551                                         <span class="keyword">sizeof</span> (<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>));
03552         Verifier-&gt;BaseName.Length = DataTableEntry-&gt;BaseDllName.Length;
03553         Verifier-&gt;BaseName.MaximumLength = DataTableEntry-&gt;BaseDllName.MaximumLength;
03554 
03555         RtlMoveMemory (Verifier-&gt;BaseName.Buffer,
03556                        DataTableEntry-&gt;BaseDllName.Buffer,
03557                        DataTableEntry-&gt;BaseDllName.Length);
03558 
03559         <a class="code" href="../../d9/d5/verifier_8c.html#a95">ViInitializeEntry</a> (Verifier, TRUE);
03560 
03561         Verifier-&gt;Flags = VerifierFlags;
03562 
03563         <a class="code" href="../../d9/d5/verifier_8c.html#a103">ViInsertVerifierEntry</a> (Verifier);
03564     }
03565 
03566     Verifier-&gt;StartAddress = DataTableEntry-&gt;DllBase;
03567     Verifier-&gt;EndAddress = (PVOID)((ULONG_PTR)DataTableEntry-&gt;DllBase + DataTableEntry-&gt;SizeOfImage);
03568 
03569     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a102">MiEnableVerifier</a> (DataTableEntry) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03570 
03571         <span class="keywordflow">if</span> (Verifier-&gt;Flags &amp; <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>) {
03572             <a class="code" href="../../d9/d5/verifier_8c.html#a92">ViPrintString</a> (&amp;DataTableEntry-&gt;BaseDllName);
03573         }
03574 
03575         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Loads += 1;
03576 
03577         Verifier-&gt;Loads += 1;
03578 
03579         DataTableEntry-&gt;Flags |= LDRP_IMAGE_VERIFYING;
03580         <a class="code" href="../../d9/d5/verifier_8c.html#a21">MiActiveVerifies</a> += 1;
03581 
03582         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a21">MiActiveVerifies</a> == 1) {
03583 
03584             <span class="comment">//</span>
03585             <span class="comment">// Up the retry mechanism for potential injection failures.</span>
03586             <span class="comment">//</span>
03587 
03588             <a class="code" href="../../d4/d8/mi_8h.html#a428">MiIoRetryLevel</a> = (ULONG)-1;
03589             <a class="code" href="../../d4/d8/mi_8h.html#a429">MiFaultRetries</a> = <a class="code" href="../../d4/d8/mi_8h.html#a428">MiIoRetryLevel</a>;
03590             <a class="code" href="../../d4/d8/mi_8h.html#a430">MiUserIoRetryLevel</a> = (ULONG)-1;
03591             <a class="code" href="../../d4/d8/mi_8h.html#a431">MiUserFaultRetries</a> = <a class="code" href="../../d4/d8/mi_8h.html#a430">MiUserIoRetryLevel</a>;
03592 
03593 <span class="preprocessor">#ifndef NO_POOL_CHECKS</span>
03594 <span class="preprocessor"></span>
03595             <span class="comment">//</span>
03596             <span class="comment">// If a loaded driver(s) is undergoing validation, the default</span>
03597             <span class="comment">// special pool randomizer is disabled as the precious virtual</span>
03598             <span class="comment">// address space and physical memory is being put to specific</span>
03599             <span class="comment">// use.</span>
03600             <span class="comment">//</span>
03601 
03602             <a class="code" href="../../d4/d8/mi_8h.html#a956">MiEnableRandomSpecialPool</a> (FALSE);
03603 <span class="preprocessor">#endif</span>
03604 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_FORCE_IRQL_CHECKING) {
03605 
03606                 <span class="comment">//</span>
03607                 <span class="comment">// Page out all thread stacks as soon as possible to</span>
03608                 <span class="comment">// catch drivers using local events that do usermode waits.</span>
03609                 <span class="comment">//</span>
03610 
03611                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03612                     <a class="code" href="../../d9/d5/verifier_8c.html#a24">MiVerifierStackProtectTime</a> = <a class="code" href="../../d4/d9/ke_8h.html#a140">KiStackProtectTime</a>;
03613                     <a class="code" href="../../d4/d9/ke_8h.html#a140">KiStackProtectTime</a> = 0;
03614                 }
03615             }
03616         }
03617     }
03618 
03619     <span class="keywordflow">return</span> Found;
03620 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a102" doxytag="verifier.c::MiEnableVerifier" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL MiEnableVerifier           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLDR_DATA_TABLE_ENTRY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DataTableEntry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">4712</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00507">_VERIFIER_THUNKS::Flag</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00400">MiVerifierDriverAddedThunkListHead</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04516">MiVerifierThunks</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00506">_VERIFIER_THUNKS::NewRoutine</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00513">_DRIVER_SPECIFIED_VERIFIER_THUNKS::NumberOfThunks</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a40">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00505">_VERIFIER_THUNKS::PristineRoutine</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a38">PVERIFIER_THUNKS</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00250">RtlImageDirectoryEntryToData()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04514">VERIFIER_POOL_ROUTINE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l04513">VERIFIER_THUNK_IN_HAL</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>.
<p>
<pre class="fragment"><div>04718                    :
04719 
04720     This function enables <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> argument driver by thunking
04721     relevant system <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a26">APIs</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> argument driver <span class="keyword">import</span> table.
04722 
04723 Arguments:
04724 
04725     DataTableEntry - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data table entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver.
04726 
04727 Return Value:
04728 
04729     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> thunking was applied, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
04730 
04731 Environment:
04732 
04733     Kernel mode, Phase 0 Initialization and normal runtime.
04734     Non paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> exists in Phase0, but paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> does not.
04735 
04736 --*/
04737 
04738 {
04739     ULONG i;
04740     ULONG j;
04741     PULONG_PTR ImportThunk;
04742     ULONG ImportSize;
04743     <a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html">PVERIFIER_THUNKS</a> VerifierThunk;
04744     ULONG ThunkCount;
04745     LOGICAL Found;
04746     ULONG_PTR RealRoutine;
04747     PULONG_PTR PointerRealRoutine;
04748     PLIST_ENTRY NextEntry;
04749     PDRIVER_VERIFIER_THUNK_PAIRS ThunkTable;
04750     <a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a> ThunkTableBase;
04751 
04752     ImportThunk = (PULONG_PTR)<a class="code" href="../../d8/d9/imagedir_8c.html#a5">RtlImageDirectoryEntryToData</a>(
04753                                                DataTableEntry-&gt;DllBase,
04754                                                TRUE,
04755                                                IMAGE_DIRECTORY_ENTRY_IAT,
04756                                                &amp;ImportSize);
04757 
04758     <span class="keywordflow">if</span> (ImportThunk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04759         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04760     }
04761 
04762     ImportSize /= <span class="keyword">sizeof</span>(PULONG_PTR);
04763 
04764     <span class="keywordflow">for</span> (i = 0; i &lt; ImportSize; i += 1, ImportThunk += 1) {
04765 
04766         Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04767 
04768         VerifierThunk = <a class="code" href="../../d9/d5/verifier_8c.html#a53">MiVerifierThunks</a>;
04769 
04770         <span class="keywordflow">for</span> (ThunkCount = 0; ThunkCount &lt; <span class="keyword">sizeof</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a53">MiVerifierThunks</a>) / <span class="keyword">sizeof</span> (<a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html">VERIFIER_THUNKS</a>); ThunkCount += 1) {
04771 
04772             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
04773                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a14">VERIFIER_POOL_ROUTINE</a> (VerifierThunk-&gt;<a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html#o2">Flag</a>) == 0) {
04774                     VerifierThunk += 1;
04775                     <span class="keywordflow">continue</span>;
04776                 }
04777             }
04778 
04779             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a13">VERIFIER_THUNK_IN_HAL</a> (VerifierThunk-&gt;<a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html#o2">Flag</a>) == 0) {
04780                 RealRoutine = (ULONG_PTR)VerifierThunk-&gt;<a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html#o0">PristineRoutine</a>;
04781             }
04782             <span class="keywordflow">else</span> {
04783 
04784                 <span class="comment">//</span>
04785                 <span class="comment">// Only the x86 has/needs this oddity - take the kernel address,</span>
04786                 <span class="comment">// knowing that it points at a 2 byte jmp opcode followed by</span>
04787                 <span class="comment">// a 4-byte indirect pointer to a destination address.</span>
04788                 <span class="comment">//</span>
04789 
04790                 PointerRealRoutine = (PULONG_PTR)*((PULONG_PTR)((PCHAR)VerifierThunk-&gt;<a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html#o0">PristineRoutine</a> + 2));
04791                 RealRoutine = *PointerRealRoutine;
04792             }
04793 
04794             <span class="keywordflow">if</span> (*ImportThunk == RealRoutine) {
04795                 *ImportThunk = (ULONG_PTR)(VerifierThunk-&gt;<a class="code" href="../../d6/d6/struct__VERIFIER__THUNKS.html#o1">NewRoutine</a>);
04796                 Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04797                 <span class="keywordflow">break</span>;
04798             }
04799             VerifierThunk += 1;
04800         }
04801 
04802         <span class="keywordflow">if</span> (Found == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
04803 
04804             NextEntry = <a class="code" href="../../d9/d5/verifier_8c.html#a33">MiVerifierDriverAddedThunkListHead</a>.Flink;
04805             <span class="keywordflow">while</span> (NextEntry != &amp;<a class="code" href="../../d9/d5/verifier_8c.html#a33">MiVerifierDriverAddedThunkListHead</a>) {
04806 
04807                 ThunkTableBase = CONTAINING_RECORD(NextEntry,
04808                                                    <a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">DRIVER_SPECIFIED_VERIFIER_THUNKS</a>,
04809                                                    ListEntry);
04810 
04811                 ThunkTable = (PDRIVER_VERIFIER_THUNK_PAIRS)(ThunkTableBase + 1);
04812 
04813                 <span class="keywordflow">for</span> (j = 0; j &lt; ThunkTableBase-&gt;<a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html#o2">NumberOfThunks</a>; j += 1) {
04814 
04815                     <span class="keywordflow">if</span> (*ImportThunk == (ULONG_PTR)ThunkTable-&gt;PristineRoutine) {
04816                         *ImportThunk = (ULONG_PTR)(ThunkTable-&gt;NewRoutine);
04817                         Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04818                         <span class="keywordflow">break</span>;
04819                     }
04820                     ThunkTable += 1;
04821                 }
04822 
04823                 <span class="keywordflow">if</span> (Found == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
04824                     <span class="keywordflow">break</span>;
04825                 }
04826 
04827                 NextEntry = NextEntry-&gt;Flink;
04828             }
04829         }
04830     }
04831     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04832 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a109" doxytag="verifier.c::MiInitializeDriverVerifierList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL MiInitializeDriverVerifierList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LoaderBlock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">3121</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l04104">_MI_VERIFIER_DRIVER_ENTRY::BaseName</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04111">_MI_VERIFIER_DRIVER_ENTRY::Flags</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00091">IoVerifierInit()</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l04697">IOVERIFIERINIT_EVERYTHING_TRACKED</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l04696">IOVERIFIERINIT_PHASE0</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l04700">IOVERIFIERINIT_VERIFIER_DRIVER_LIST</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d8/mi_8h.html#a548">MI_VERIFIER_DRIVER_ENTRY</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04193">MiSuspectDriverList</a>, <a class="el" href="../../d4/d8/mi_8h.html#a958">MiTriageAddDrivers()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00400">MiVerifierDriverAddedThunkListHead</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00372">MiVerifyAllDrivers</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00374">MiVerifyRandomDrivers</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00068">MmDontVerifyRandomDrivers</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00064">MmVerifyDriverBuffer</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00065">MmVerifyDriverBufferLength</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00067">MmVerifyDriverLevel</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01608">RtlEqualUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00049">Start</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03114">UNICODE_WHITESPACE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00392">VerifierListLock</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00367">VerifierModifyableOptions</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00394">VerifierPoolLock</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00396">VerifierPoolMutex</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00628">ViBadMapperLock</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03047">ViInitializeEntry()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03360">ViInsertVerifierEntry()</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>.
<p>
<pre class="fragment"><div>03127                    :
03128 
03129     Parse <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry setting and set up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of driver names that will
03130     be put through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> validation process.
03131 
03132     Walk <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> loaded module list and thunk any drivers that need/deserve <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
03133 
03134 Arguments:
03135 
03136     None.
03137 
03138 Return Value:
03139 
03140     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> successful, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
03141 
03142 Environment:
03143 
03144     Kernel mode, Phase 0 Initialization.
03145 
03146     Nonpaged (but not paged) <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> exists.
03147 
03148     The <a class="code" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a> has not been set up yet although <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> boot drivers
03149     have been relocated to their <span class="keyword">final</span> resting places.
03150 
03151 --*/
03152 
03153 {
03154     ULONG i;
03155     PLIST_ENTRY NextEntry;
03156     PLDR_DATA_TABLE_ENTRY DataTableEntry;
03157     PWCHAR <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a>;
03158     PWCHAR <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
03159     PWCHAR Walk;
03160     ULONG NameLength;
03161     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
03162     LARGE_INTEGER CurrentTime;
03163     UNICODE_STRING KernelString;
03164     UNICODE_STRING HalString;
03165     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> KernelEntry;
03166     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> HalEntry;
03167 
03168     InitializeListHead (&amp;MiSuspectDriverList);
03169 
03170     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a12">MmVerifyDriverLevel</a> != (ULONG)-1) {
03171         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a12">MmVerifyDriverLevel</a> &amp; DRIVER_VERIFIER_IO_CHECKING) {
03172             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a10">MmVerifyDriverBufferLength</a> == (ULONG)-1) {
03173                 <a class="code" href="../../d8/d0/cmdat3_8c.html#a10">MmVerifyDriverBufferLength</a> = 0;     <span class="comment">// Mm will not page out verifier pages.</span>
03174             }
03175         }
03176     }
03177 
03178     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a10">MmVerifyDriverBufferLength</a> == (ULONG)-1) {
03179 
03180         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a13">MmDontVerifyRandomDrivers</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03181             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03182         }
03183 
03184         <a class="code" href="../../d8/d0/cmdat3_8c.html#a10">MmVerifyDriverBufferLength</a> = 0;
03185 
03186         CurrentTime = <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a> (NULL);
03187         CurrentTime.LowPart = (CurrentTime.LowPart % 26);
03188 
03189         <a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> = (WCHAR)<span class="charliteral">'A'</span> + (WCHAR)CurrentTime.LowPart;
03190 
03191         <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)<span class="charliteral">'H'</span>) ||
03192             (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)<span class="charliteral">'J'</span>) ||
03193             (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)<span class="charliteral">'X'</span>) ||
03194             (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)<span class="charliteral">'Y'</span>) ||
03195             (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)<span class="charliteral">'Z'</span>)) {
03196                 <a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> = (WCHAR)<span class="charliteral">'X'</span>;
03197         }
03198     }
03199 
03200     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a> (&amp;ViBadMapperLock);
03201     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a> (&amp;VerifierListLock);
03202 
03203     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a> (&amp;VerifierPoolLock);
03204     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a> (&amp;VerifierPoolMutex);
03205 
03206     InitializeListHead (&amp;MiVerifierDriverAddedThunkListHead);
03207 
03208     <span class="comment">//</span>
03209     <span class="comment">// If no default is specified, then special pool, pagable code/data</span>
03210     <span class="comment">// flushing and pool leak detection are enabled.</span>
03211     <span class="comment">//</span>
03212 
03213     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a12">MmVerifyDriverLevel</a> == (ULONG)-1) {
03214         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level = DRIVER_VERIFIER_SPECIAL_POOLING |
03215                                DRIVER_VERIFIER_FORCE_IRQL_CHECKING |
03216                                DRIVER_VERIFIER_TRACK_POOL_ALLOCATIONS;
03217     }
03218     <span class="keywordflow">else</span> {
03219         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level = <a class="code" href="../../d8/d0/cmdat3_8c.html#a12">MmVerifyDriverLevel</a>;
03220     }
03221 
03222     <a class="code" href="../../d9/d5/verifier_8c.html#a16">VerifierModifyableOptions</a> = (DRIVER_VERIFIER_SPECIAL_POOLING |
03223                                  DRIVER_VERIFIER_FORCE_IRQL_CHECKING |
03224                                  DRIVER_VERIFIER_INJECT_ALLOCATION_FAILURES);
03225 
03226     <a class="code" href="../../d6/d6/ioverifier_8c.html#a26">IoVerifierInit</a> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level, IOVERIFIERINIT_PHASE0 |
03227                                           IOVERIFIERINIT_EVERYTHING_TRACKED |
03228                                           IOVERIFIERINIT_VERIFIER_DRIVER_LIST);
03229 
03230     KernelEntry = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03231     HalEntry = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03232 
03233     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> == (WCHAR)0) {
03234 
03235         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a> (&amp;KernelString, L<span class="stringliteral">"ntoskrnl.exe"</span>);
03236         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a> (&amp;HalString, L<span class="stringliteral">"hal.dll"</span>);
03237 
03238         <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> = <a class="code" href="../../d8/d0/cmdat3_8c.html#a9">MmVerifyDriverBuffer</a>;
03239         <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = <a class="code" href="../../d8/d0/cmdat3_8c.html#a9">MmVerifyDriverBuffer</a> + (<a class="code" href="../../d8/d0/cmdat3_8c.html#a10">MmVerifyDriverBufferLength</a> - <span class="keyword">sizeof</span>(WCHAR)) / <span class="keyword">sizeof</span>(WCHAR);
03240 
03241         <span class="keywordflow">while</span> (<a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> &lt; <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>) {
03242             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a8">UNICODE_WHITESPACE</a>(*Start)) {
03243                 <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> += 1;
03244                 <span class="keywordflow">continue</span>;
03245             }
03246 
03247             <span class="keywordflow">if</span> (*<a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> == (WCHAR)<span class="charliteral">'*'</span>) {
03248                 <a class="code" href="../../d9/d5/verifier_8c.html#a19">MiVerifyAllDrivers</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03249                 <span class="keywordflow">break</span>;
03250             }
03251 
03252             <span class="keywordflow">for</span> (Walk = <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a>; Walk &lt; <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>; Walk += 1) {
03253                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a8">UNICODE_WHITESPACE</a>(*Walk)) {
03254                     <span class="keywordflow">break</span>;
03255                 }
03256             }
03257 
03258             <span class="comment">//</span>
03259             <span class="comment">// Got a string.  Save it.</span>
03260             <span class="comment">//</span>
03261 
03262             NameLength = (ULONG)(Walk - <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> + 1) * <span class="keyword">sizeof</span> (WCHAR);
03263 
03264             Verifier = (<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a> (
03265                                         NonPagedPool,
03266                                         <span class="keyword">sizeof</span> (<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>) +
03267                                                             NameLength,
03268                                         'dLmM');
03269 
03270             <span class="keywordflow">if</span> (Verifier == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03271                 <span class="keywordflow">break</span>;
03272             }
03273 
03274             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Buffer = (PWSTR)((PCHAR)Verifier +
03275                                                 <span class="keyword">sizeof</span> (<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>));
03276             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)NameLength - <span class="keyword">sizeof</span> (UNICODE_NULL);
03277             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)NameLength;
03278 
03279             RtlMoveMemory (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Buffer,
03280                            Start,
03281                            NameLength - sizeof (UNICODE_NULL));
03282 
03283             <a class="code" href="../../d9/d5/verifier_8c.html#a95">ViInitializeEntry</a> (Verifier, TRUE);
03284 
03285             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o6">Flags</a> |= <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>;
03286 
03287             <a class="code" href="../../d9/d5/verifier_8c.html#a103">ViInsertVerifierEntry</a> (Verifier);
03288 
03289             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a> (&amp;KernelString,
03290                                        &amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>,
03291                                        TRUE)) {
03292 
03293                 <span class="comment">//</span>
03294                 <span class="comment">// All driver pool allocation calls must be intercepted so</span>
03295                 <span class="comment">// they are not mistaken for kernel pool allocations.</span>
03296                 <span class="comment">//</span>
03297 
03298                 <a class="code" href="../../d9/d5/verifier_8c.html#a19">MiVerifyAllDrivers</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03299 
03300                 <a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03301                 KernelEntry = Verifier;
03302 
03303             }
03304             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a> (&amp;HalString,
03305                                             &amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>,
03306                                             TRUE)) {
03307                 HalEntry = Verifier;
03308             }
03309 
03310             <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> = Walk + 1;
03311         }
03312     }
03313 
03314     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d8/mi_8h.html#a958">MiTriageAddDrivers</a> (LoaderBlock) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03315 
03316         <span class="comment">//</span>
03317         <span class="comment">// Disable random driver verification if triage has picked driver(s).</span>
03318         <span class="comment">//</span>
03319 
03320         <a class="code" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a> = (WCHAR)0;
03321     }
03322 
03323     <span class="comment">//</span>
03324     <span class="comment">// Process the boot-loaded drivers now.</span>
03325     <span class="comment">//</span>
03326 
03327     i = 0;
03328     NextEntry = LoaderBlock-&gt;LoadOrderListHead.Flink;
03329 
03330     <span class="keywordflow">for</span> ( ; NextEntry != &amp;LoaderBlock-&gt;LoadOrderListHead; NextEntry = NextEntry-&gt;Flink) {
03331 
03332         DataTableEntry = CONTAINING_RECORD(NextEntry,
03333                                            LDR_DATA_TABLE_ENTRY,
03334                                            InLoadOrderLinks);
03335 
03336         <span class="comment">//</span>
03337         <span class="comment">// Process the kernel and HAL specially.</span>
03338         <span class="comment">//</span>
03339 
03340         <span class="keywordflow">if</span> (i == 0) {
03341             <span class="keywordflow">if</span> (KernelEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03342                 <a class="code" href="../../d9/d5/verifier_8c.html#a110">MiApplyDriverVerifier</a> (DataTableEntry, KernelEntry);
03343             }
03344         }
03345         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1) {
03346             <span class="keywordflow">if</span> (HalEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03347                 <a class="code" href="../../d9/d5/verifier_8c.html#a110">MiApplyDriverVerifier</a> (DataTableEntry, HalEntry);
03348             }
03349         }
03350         <span class="keywordflow">else</span> {
03351             <a class="code" href="../../d9/d5/verifier_8c.html#a110">MiApplyDriverVerifier</a> (DataTableEntry, NULL);
03352         }
03353         i += 1;
03354     }
03355 
03356     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03357 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a106" doxytag="verifier.c::MiVerifierCheckThunks" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MiVerifierCheckThunks           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLDR_DATA_TABLE_ENTRY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DataTableEntry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a111" doxytag="verifier.c::MiVerifyingDriverUnloading" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MiVerifyingDriverUnloading           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLDR_DATA_TABLE_ENTRY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DataTableEntry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">3625</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04104">_MI_VERIFIER_DRIVER_ENTRY::BaseName</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04122">_MI_VERIFIER_DRIVER_ENTRY::CurrentNonPagedPoolAllocations</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04121">_MI_VERIFIER_DRIVER_ENTRY::CurrentPagedPoolAllocations</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04106">_MI_VERIFIER_DRIVER_ENTRY::EndAddress</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02783">KiStackProtectTime</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00376">MiActiveVerifies</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03398">MiEnableRandomSpecialPool()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00380">MiNoPageOnRaiseIrql</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04193">MiSuspectDriverList</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00382">MiVerifierStackProtectTime</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04127">_MI_VERIFIER_DRIVER_ENTRY::NonPagedBytes</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04126">_MI_VERIFIER_DRIVER_ENTRY::PagedBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04116">_MI_VERIFIER_DRIVER_ENTRY::PoolHash</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04118">_MI_VERIFIER_DRIVER_ENTRY::PoolHashFree</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04119">_MI_VERIFIER_DRIVER_ENTRY::PoolHashReserved</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04117">_MI_VERIFIER_DRIVER_ENTRY::PoolHashSize</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01608">RtlEqualUnicodeString()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04105">_MI_VERIFIER_DRIVER_ENTRY::StartAddress</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04102">_MI_VERIFIER_DRIVER_ENTRY::Unloads</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00392">VerifierListLock</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04114">_MI_VERIFIER_DRIVER_ENTRY::VerifierPoolLock</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04081">VI_POOL_FREELIST_END</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03622">ViBadDriver</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>.
<p>
<pre class="fragment"><div>03631                    :
03632 
03633     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called as a driver that was being verified <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> now being
03634     unloaded.
03635 
03636 Arguments:
03637 
03638     DataTableEntry - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data table entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver.
03639 
03640 Return Value:
03641 
03642     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> thunking was applied, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
03643 
03644 Environment:
03645 
03646     Kernel mode, Phase 0 Initialization and normal runtime.
03647     Non paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> exists in Phase0, but paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> does not.
03648     Post-Phase0 serialization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d8/mi_8h.html#a432">MmSystemLoadLock</a>.
03649 
03650 --*/
03651 
03652 {
03653     KIRQL OldIrql;
03654     LOGICAL Found;
03655     PLIST_ENTRY NextEntry;
03656     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
03657     <a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a> OldHashTable;
03658 
03659     Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03660     NextEntry = <a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>.Flink;
03661     <span class="keywordflow">while</span> (NextEntry != &amp;<a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>) {
03662 
03663         Verifier = CONTAINING_RECORD(NextEntry,
03664                                           <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>,
03665                                           Links);
03666 
03667         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a> (&amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>,
03668                                    &amp;DataTableEntry-&gt;BaseDllName,
03669                                    TRUE)) {
03670 
03671             Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03672             <span class="keywordflow">break</span>;
03673         }
03674         NextEntry = NextEntry-&gt;Flink;
03675     }
03676 
03677     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Found == TRUE);
03678 
03679     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_TRACK_POOL_ALLOCATIONS) {
03680 
03681         <span class="comment">//</span>
03682         <span class="comment">// Better not be any pool left that wasn't freed.  Walk the pagable</span>
03683         <span class="comment">// allocations in an attempt to make them all resident for a</span>
03684         <span class="comment">// kernel debugger session.</span>
03685         <span class="comment">//</span>
03686 
03687         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a>) {
03688 
03689 <span class="preprocessor">#if DBG</span>
03690 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"Driver %wZ leaked %d paged pool allocations (0x%x bytes)\n"</span>,
03691                 &amp;DataTableEntry-&gt;FullDllName,
03692                 Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a>,
03693                 Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a>);
03694 <span class="preprocessor">#endif</span>
03695 <span class="preprocessor"></span>
03696             <span class="comment">//</span>
03697             <span class="comment">// It would be nice to fault in the driver's paged pool allocations</span>
03698             <span class="comment">// now to make debugging easier, but this cannot be easily done</span>
03699             <span class="comment">// in a deadlock free manner.</span>
03700             <span class="comment">//</span>
03701             <span class="comment">// At least disable the paging of pool on IRQL raising in attempt</span>
03702             <span class="comment">// to keep some of these allocations resident for debugging.</span>
03703             <span class="comment">// No need to undo the increment as we're about to bugcheck anyway.</span>
03704             <span class="comment">//</span>
03705 
03706             InterlockedIncrement ((PLONG)&amp;MiNoPageOnRaiseIrql);
03707         }
03708 
03709 <span class="preprocessor">#if DBG</span>
03710 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>) {
03711             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"Driver %wZ leaked %d nonpaged pool allocations (0x%x bytes)\n"</span>,
03712                 &amp;DataTableEntry-&gt;FullDllName,
03713                 Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a>,
03714                 Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>);
03715         }
03716 <span class="preprocessor">#endif</span>
03717 <span class="preprocessor"></span>
03718         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a> || Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>) {
03719 <span class="preprocessor">#if 0</span>
03720 <span class="preprocessor"></span>            DbgBreakPoint ();
03721             InterlockedDecrement (&amp;MiNoPageOnRaiseIrql);
03722 <span class="preprocessor">#else</span>
03723 <span class="preprocessor"></span>            <span class="comment">//</span>
03724             <span class="comment">// Snap this so the build/BVT lab can easily triage the culprit.</span>
03725             <span class="comment">//</span>
03726 
03727             <a class="code" href="../../d9/d5/verifier_8c.html#a48">ViBadDriver</a> = &amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>;
03728 
03729             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
03730                           0x60,
03731                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a>,
03732                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>,
03733                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a> +
03734                             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a>);
03735 <span class="preprocessor">#endif</span>
03736 <span class="preprocessor"></span>        }
03737 
03738         ExAcquireSpinLock (&amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o9">VerifierPoolLock</a>, &amp;OldIrql);
03739 
03740         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o13">PoolHashReserved</a> != 0) {
03741             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
03742                           0x61,
03743                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a>,
03744                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>,
03745                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a> +
03746                             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a>);
03747         }
03748 
03749         OldHashTable = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o10">PoolHash</a>;
03750         <span class="keywordflow">if</span> (OldHashTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03751             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o11">PoolHashSize</a> = 0;
03752             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o12">PoolHashFree</a> = <a class="code" href="../../d4/d8/mi_8h.html#a250">VI_POOL_FREELIST_END</a>;
03753             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o10">PoolHash</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03754         }
03755         <span class="keywordflow">else</span> {
03756             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o11">PoolHashSize</a> == 0);
03757             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o12">PoolHashFree</a> == VI_POOL_FREELIST_END);
03758         }
03759 
03760         ExReleaseSpinLock (&amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o9">VerifierPoolLock</a>, OldIrql);
03761 
03762         <span class="keywordflow">if</span> (OldHashTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03763             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (OldHashTable);
03764         }
03765 
03766         <span class="comment">//</span>
03767         <span class="comment">// Clear these fields so reuse of stale addresses don't trigger</span>
03768         <span class="comment">// erroneous bucket fills.</span>
03769         <span class="comment">//</span>
03770 
03771         ExAcquireSpinLock (&amp;VerifierListLock, &amp;OldIrql);
03772         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o4">StartAddress</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03773         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o5">EndAddress</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03774         ExReleaseSpinLock (&amp;VerifierListLock, OldIrql);
03775     }
03776 
03777     Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o2">Unloads</a> += 1;
03778     <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Unloads += 1;
03779     <a class="code" href="../../d9/d5/verifier_8c.html#a21">MiActiveVerifies</a> -= 1;
03780 
03781     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a21">MiActiveVerifies</a> == 0) {
03782 
03783         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_FORCE_IRQL_CHECKING) {
03784 
03785             <span class="comment">//</span>
03786             <span class="comment">// Return to normal thread stack protection.</span>
03787             <span class="comment">//</span>
03788 
03789             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03790                 <a class="code" href="../../d4/d9/ke_8h.html#a140">KiStackProtectTime</a> = <a class="code" href="../../d9/d5/verifier_8c.html#a24">MiVerifierStackProtectTime</a>;
03791             }
03792         }
03793 
03794 <span class="preprocessor">#ifndef NO_POOL_CHECKS</span>
03795 <span class="preprocessor"></span>        <a class="code" href="../../d4/d8/mi_8h.html#a956">MiEnableRandomSpecialPool</a> (TRUE);
03796 <span class="preprocessor">#endif</span>
03797 <span class="preprocessor"></span>    }
03798 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a113" doxytag="verifier.c::MmAddVerifierThunks" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MmAddVerifierThunks           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ThunkBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ThunkBufferSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03846">3846</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d0/d5/verifier_8c-source.html#l00512">_DRIVER_SPECIFIED_VERIFIER_THUNKS::DataTableEntry</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00591">KSEG0_BASE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00511">_DRIVER_SPECIFIED_VERIFIER_THUNKS::ListEntry</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04192">MiActiveVerifierThunks</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06991">MiLookupDataTableEntry()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00400">MiVerifierDriverAddedThunkListHead</a>, <a class="el" href="../../d7/d7/mi386_8h-source.html#l00164">MM_BOOT_IMAGE_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00928">MmSystemLoadLock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00513">_DRIVER_SPECIFIED_VERIFIER_THUNKS::NumberOfThunks</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a40">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a407a216">WrVirtualMemory</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>.
<p>
<pre class="fragment"><div>03853                    :
03854 
03855     This routine adds another set of thunks to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier list.
03856 
03857 Arguments:
03858 
03859     ThunkBuffer - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thunk pairs.
03860 
03861     ThunkBufferSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thunk buffer.
03862 
03863 Return Value:
03864 
03865     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
03866 
03867 Environment:
03868 
03869     Kernel mode.  <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a> and below.
03870 
03871 --*/
03872 
03873 {
03874     ULONG i;
03875     ULONG NumberOfThunkPairs;
03876     PDRIVER_VERIFIER_THUNK_PAIRS ThunkPairs;
03877     PDRIVER_VERIFIER_THUNK_PAIRS ThunkTable;
03878     <a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a> ThunkTableBase;
03879     PLDR_DATA_TABLE_ENTRY DataTableEntry;
03880     PVOID DriverStartAddress;
03881     PVOID DriverEndAddress;
03882 
03883     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03884 
03885     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a33">MiVerifierDriverAddedThunkListHead</a>.Flink == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03886         <span class="keywordflow">return</span> STATUS_NOT_SUPPORTED;
03887     }
03888 
03889     ThunkPairs = (PDRIVER_VERIFIER_THUNK_PAIRS)ThunkBuffer;
03890     NumberOfThunkPairs = ThunkBufferSize / <span class="keyword">sizeof</span>(DRIVER_VERIFIER_THUNK_PAIRS);
03891 
03892     <span class="keywordflow">if</span> (NumberOfThunkPairs == 0) {
03893         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER_1;
03894     }
03895 
03896     ThunkTableBase = (<a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">PDRIVER_SPECIFIED_VERIFIER_THUNKS</a>) <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a> (
03897                             PagedPool,
03898                             <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html">DRIVER_SPECIFIED_VERIFIER_THUNKS</a>) + NumberOfThunkPairs * <span class="keyword">sizeof</span> (DRIVER_VERIFIER_THUNK_PAIRS),
03899                             'tVmM');
03900 
03901     <span class="keywordflow">if</span> (ThunkTableBase == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03902         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
03903     }
03904 
03905     ThunkTable = (PDRIVER_VERIFIER_THUNK_PAIRS)(ThunkTableBase + 1);
03906 
03907     RtlCopyMemory (ThunkTable,
03908                    ThunkPairs,
03909                    NumberOfThunkPairs * <span class="keyword">sizeof</span>(DRIVER_VERIFIER_THUNK_PAIRS));
03910 
03911     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
03912 
03913     <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a> (&amp;MmSystemLoadLock,
03914                            WrVirtualMemory,
03915                            KernelMode,
03916                            FALSE,
03917                            (PLARGE_INTEGER)NULL);
03918 
03919     <span class="comment">//</span>
03920     <span class="comment">// Find and validate the image that contains the routines to be thunked.</span>
03921     <span class="comment">//</span>
03922 
03923     DataTableEntry = <a class="code" href="../../d4/d8/mi_8h.html#a874">MiLookupDataTableEntry</a> (ThunkTable-&gt;PristineRoutine,
03924                                              TRUE);
03925 
03926     <span class="keywordflow">if</span> (DataTableEntry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03927         <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (&amp;MmSystemLoadLock, 1, FALSE, FALSE);
03928         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
03929         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (ThunkTableBase);
03930         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER_2;
03931     }
03932 
03933     DriverStartAddress = (PVOID)(DataTableEntry-&gt;DllBase);
03934     DriverEndAddress = (PVOID)((PCHAR)DataTableEntry-&gt;DllBase + DataTableEntry-&gt;SizeOfImage);
03935 
03936     <span class="comment">//</span>
03937     <span class="comment">// Don't let drivers hook calls to kernel or HAL routines.</span>
03938     <span class="comment">//</span>
03939 
03940     <span class="keywordflow">if</span> (DriverStartAddress &lt; (PVOID)(<a class="code" href="../../d6/d7/halmips_8h.html#a443">KSEG0_BASE</a> + <a class="code" href="../../d6/d8/mi386_8h.html#a4">MM_BOOT_IMAGE_SIZE</a>)) {
03941         <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (&amp;MmSystemLoadLock, 1, FALSE, FALSE);
03942         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
03943         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (ThunkTableBase);
03944         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER_2;
03945     }
03946 
03947     <span class="keywordflow">for</span> (i = 0; i &lt; NumberOfThunkPairs; i += 1) {
03948 
03949         <span class="comment">//</span>
03950         <span class="comment">// Ensure all the routines being thunked are in the same driver.</span>
03951         <span class="comment">//</span>
03952 
03953         <span class="keywordflow">if</span> (((ULONG_PTR)ThunkTable-&gt;PristineRoutine &lt; (ULONG_PTR)DriverStartAddress) ||
03954             ((ULONG_PTR)ThunkTable-&gt;PristineRoutine &gt;= (ULONG_PTR)DriverEndAddress)) {
03955 
03956             <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (&amp;MmSystemLoadLock, 1, FALSE, FALSE);
03957             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
03958             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (ThunkTableBase);
03959             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER_2;
03960         }
03961         ThunkTable += 1;
03962     }
03963 
03964     <span class="comment">//</span>
03965     <span class="comment">// Add the validated thunk table to the verifier's global list.</span>
03966     <span class="comment">//</span>
03967 
03968     ThunkTableBase-&gt;<a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html#o1">DataTableEntry</a> = DataTableEntry;
03969     ThunkTableBase-&gt;<a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html#o2">NumberOfThunks</a> = NumberOfThunkPairs;
03970     <a class="code" href="../../d4/d8/mi_8h.html#a554">MiActiveVerifierThunks</a> += 1;
03971 
03972     InsertTailList (&amp;MiVerifierDriverAddedThunkListHead,
03973                     &amp;ThunkTableBase-&gt;<a class="code" href="../../d5/d9/struct__DRIVER__SPECIFIED__VERIFIER__THUNKS.html#o0">ListEntry</a>);
03974 
03975     <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (&amp;MmSystemLoadLock, 1, FALSE, FALSE);
03976     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
03977 
03978     <span class="keywordflow">return</span> STATUS_SUCCESS;
03979 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a114" doxytag="verifier.c::MmGetVerifierInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MmGetVerifierInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemInformationLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04046">4046</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l04104">_MI_VERIFIER_DRIVER_ENTRY::BaseName</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04122">_MI_VERIFIER_DRIVER_ENTRY::CurrentNonPagedPoolAllocations</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04121">_MI_VERIFIER_DRIVER_ENTRY::CurrentPagedPoolAllocations</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04111">_MI_VERIFIER_DRIVER_ENTRY::Flags</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04101">_MI_VERIFIER_DRIVER_ENTRY::Loads</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04193">MiSuspectDriverList</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00928">MmSystemLoadLock</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04127">_MI_VERIFIER_DRIVER_ENTRY::NonPagedBytes</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04126">_MI_VERIFIER_DRIVER_ENTRY::PagedBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04129">_MI_VERIFIER_DRIVER_ENTRY::PeakNonPagedBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04124">_MI_VERIFIER_DRIVER_ENTRY::PeakNonPagedPoolAllocations</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04128">_MI_VERIFIER_DRIVER_ENTRY::PeakPagedBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04123">_MI_VERIFIER_DRIVER_ENTRY::PeakPagedPoolAllocations</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00049">ROUND_UP</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04102">_MI_VERIFIER_DRIVER_ENTRY::Unloads</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a407a216">WrVirtualMemory</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>.
<p>
<pre class="fragment"><div>04054                    :
04055 
04056     This routine returns information about drivers undergoing verification.
04057 
04058 Arguments:
04059 
04060     SystemInformation - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver verification information.
04061 
04062     SystemInformationLength - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SystemInformation
04063                               buffer.
04064 
04065     Length - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver verification <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> information
04066              placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer.
04067 
04068 Return Value:
04069 
04070     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
04071 
04072 Environment:
04073 
04074     The SystemInformation buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in user space and our caller has wrapped
04075     a <span class="keywordflow">try</span>-except around <span class="keyword">this</span> entire routine.  Capture any exceptions here and
04076     release resources accordingly.
04077 
04078 --*/
04079 
04080 {
04081     PSYSTEM_VERIFIER_INFORMATION UserVerifyBuffer;
04082     ULONG NextEntryOffset;
04083     ULONG TotalSize;
04084     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04085     PLIST_ENTRY NextEntry;
04086     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
04087     UNICODE_STRING UserBufferDriverName;
04088 
04089     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
04090 
04091     NextEntryOffset = 0;
04092     TotalSize = 0;
04093 
04094     *Length = 0;
04095     UserVerifyBuffer = (PSYSTEM_VERIFIER_INFORMATION)SystemInformation;
04096 
04097     <span class="comment">//</span>
04098     <span class="comment">// Capture the number of verifying drivers and the relevant data while</span>
04099     <span class="comment">// synchronized.  Then return it to our caller.</span>
04100     <span class="comment">//</span>
04101 
04102     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
04103 
04104     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
04105 
04106     <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a> (&amp;MmSystemLoadLock,
04107                            WrVirtualMemory,
04108                            KernelMode,
04109                            FALSE,
04110                            (PLARGE_INTEGER)NULL);
04111 
04112     <span class="keywordflow">try</span> {
04113 
04114         NextEntry = <a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>.Flink;
04115         <span class="keywordflow">while</span> (NextEntry != &amp;<a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>) {
04116 
04117             Verifier = CONTAINING_RECORD(NextEntry,
04118                                               <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>,
04119                                               Links);
04120 
04121             <span class="keywordflow">if</span> ((Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o6">Flags</a> &amp; <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>) == 0) {
04122                 NextEntry = NextEntry-&gt;Flink;
04123                 <span class="keywordflow">continue</span>;
04124             }
04125 
04126             UserVerifyBuffer = (PSYSTEM_VERIFIER_INFORMATION)(
04127                                     (PUCHAR)UserVerifyBuffer + NextEntryOffset);
04128             NextEntryOffset = <span class="keyword">sizeof</span>(SYSTEM_VERIFIER_INFORMATION);
04129             TotalSize += <span class="keyword">sizeof</span>(SYSTEM_VERIFIER_INFORMATION);
04130 
04131             <span class="keywordflow">if</span> (TotalSize &gt; SystemInformationLength) {
04132                 <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_INFO_LENGTH_MISMATCH);
04133             }
04134 
04135             <span class="comment">//</span>
04136             <span class="comment">// This data is cumulative for all drivers.</span>
04137             <span class="comment">//</span>
04138 
04139             UserVerifyBuffer-&gt;Level = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level;
04140             UserVerifyBuffer-&gt;RaiseIrqls = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.RaiseIrqls;
04141             UserVerifyBuffer-&gt;AcquireSpinLocks = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AcquireSpinLocks;
04142 
04143             UserVerifyBuffer-&gt;UnTrackedPool = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.UnTrackedPool;
04144             UserVerifyBuffer-&gt;SynchronizeExecutions = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.SynchronizeExecutions;
04145 
04146             UserVerifyBuffer-&gt;AllocationsAttempted = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsAttempted;
04147             UserVerifyBuffer-&gt;AllocationsSucceeded = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsSucceeded;
04148             UserVerifyBuffer-&gt;AllocationsSucceededSpecialPool = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsSucceededSpecialPool;
04149             UserVerifyBuffer-&gt;AllocationsWithNoTag = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsWithNoTag;
04150 
04151             UserVerifyBuffer-&gt;TrimRequests = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.TrimRequests;
04152             UserVerifyBuffer-&gt;Trims = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Trims;
04153             UserVerifyBuffer-&gt;AllocationsFailed = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsFailed;
04154             UserVerifyBuffer-&gt;AllocationsFailedDeliberately = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsFailedDeliberately;
04155 
04156             <span class="comment">//</span>
04157             <span class="comment">// This data is kept on a per-driver basis.</span>
04158             <span class="comment">//</span>
04159 
04160             UserVerifyBuffer-&gt;CurrentPagedPoolAllocations = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a>;
04161             UserVerifyBuffer-&gt;CurrentNonPagedPoolAllocations = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a>;
04162             UserVerifyBuffer-&gt;PeakPagedPoolAllocations = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o16">PeakPagedPoolAllocations</a>;
04163             UserVerifyBuffer-&gt;PeakNonPagedPoolAllocations = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o17">PeakNonPagedPoolAllocations</a>;
04164 
04165             UserVerifyBuffer-&gt;PagedPoolUsageInBytes = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a>;
04166             UserVerifyBuffer-&gt;NonPagedPoolUsageInBytes = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>;
04167             UserVerifyBuffer-&gt;PeakPagedPoolUsageInBytes = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o20">PeakPagedBytes</a>;
04168             UserVerifyBuffer-&gt;PeakNonPagedPoolUsageInBytes = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o21">PeakNonPagedBytes</a>;
04169 
04170             UserVerifyBuffer-&gt;Loads = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o1">Loads</a>;
04171             UserVerifyBuffer-&gt;Unloads = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o2">Unloads</a>;
04172 
04173             <span class="comment">//</span>
04174             <span class="comment">// The DriverName portion of the UserVerifyBuffer must be saved</span>
04175             <span class="comment">// locally to protect against a malicious thread changing the</span>
04176             <span class="comment">// contents.  This is because we will reference the contents</span>
04177             <span class="comment">// ourselves when the actual string is copied out carefully below.</span>
04178             <span class="comment">//</span>
04179 
04180             UserBufferDriverName.Length = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Length;
04181             UserBufferDriverName.MaximumLength = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Length + <span class="keyword">sizeof</span> (WCHAR);
04182             UserBufferDriverName.Buffer = (PWCHAR)(UserVerifyBuffer + 1);
04183 
04184             UserVerifyBuffer-&gt;DriverName = UserBufferDriverName;
04185 
04186             TotalSize += <a class="code" href="../../d6/d0/hive_8h.html#a2">ROUND_UP</a> (UserBufferDriverName.MaximumLength,
04187                                    <span class="keyword">sizeof</span>(ULONG));
04188             NextEntryOffset += <a class="code" href="../../d6/d0/hive_8h.html#a2">ROUND_UP</a> (UserBufferDriverName.MaximumLength,
04189                                          <span class="keyword">sizeof</span>(ULONG));
04190 
04191             <span class="keywordflow">if</span> (TotalSize &gt; SystemInformationLength) {
04192                 <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_INFO_LENGTH_MISMATCH);
04193             }
04194 
04195             <span class="comment">//</span>
04196             <span class="comment">// Carefully reference the UserVerifyBuffer here.</span>
04197             <span class="comment">//</span>
04198 
04199             RtlMoveMemory(UserBufferDriverName.Buffer,
04200                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Buffer,
04201                           Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Length);
04202 
04203             UserBufferDriverName.Buffer[
04204                         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o3">BaseName</a>.Length/<span class="keyword">sizeof</span>(WCHAR)] = UNICODE_NULL;
04205             UserVerifyBuffer-&gt;NextEntryOffset = NextEntryOffset;
04206 
04207             NextEntry = NextEntry-&gt;Flink;
04208         }
04209     } except (EXCEPTION_EXECUTE_HANDLER) {
04210         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
04211     }
04212 
04213     <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (&amp;MmSystemLoadLock, 1, FALSE, FALSE);
04214 
04215     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
04216 
04217     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_INFO_LENGTH_MISMATCH) {
04218         UserVerifyBuffer-&gt;NextEntryOffset = 0;
04219         *Length = TotalSize;
04220     }
04221 
04222     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04223 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a112" doxytag="verifier.c::MmIsDriverVerifying" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI LOGICAL MmIsDriverVerifying           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__DRIVER__OBJECT.html">PDRIVER_OBJECT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DriverObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03802">3802</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03521">IovpIsInterestingDriver()</a>.
<p>
<pre class="fragment"><div>03808                    :
03809 
03810     This function informs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> argument driver <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being verified.
03811 
03812 Arguments:
03813 
03814     DriverObject - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver object.
03815 
03816 Return Value:
03817 
03818     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <span class="keyword">this</span> driver <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being verified, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
03819 
03820 Environment:
03821 
03822     Kernel mode, any IRQL, any needed synchronization must be provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03823     caller.
03824 
03825 --*/
03826 
03827 {
03828     PLDR_DATA_TABLE_ENTRY DataTableEntry;
03829 
03830     DataTableEntry = (PLDR_DATA_TABLE_ENTRY)DriverObject-&gt;DriverSection;
03831 
03832     <span class="keywordflow">if</span> (DataTableEntry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03833         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03834     }
03835 
03836     <span class="keywordflow">if</span> ((DataTableEntry-&gt;Flags &amp; LDRP_IMAGE_VERIFYING) == 0) {
03837         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03838     }
03839 
03840     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03841 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a115" doxytag="verifier.c::MmSetVerifierInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MmSetVerifierInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemInformationLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04226">4226</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00928">MmSystemLoadLock</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00367">VerifierModifyableOptions</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00368">VerifierOptionChanges</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a407a216">WrVirtualMemory</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>.
<p>
<pre class="fragment"><div>04233                    :
04234 
04235     This routine sets any driver verifier flags that can be done without
04236     rebooting.
04237 
04238 Arguments:
04239 
04240     SystemInformation - Gets and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver verification flags.
04241 
04242     SystemInformationLength - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SystemInformation
04243                               buffer.
04244 
04245 Return Value:
04246 
04247     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
04248 
04249 Environment:
04250 
04251     The SystemInformation buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in user space and our caller has wrapped
04252     a <span class="keywordflow">try</span>-except around <span class="keyword">this</span> entire routine.  Capture any exceptions here and
04253     release resources accordingly.
04254 
04255 --*/
04256 
04257 {
04258     ULONG UserFlags;
04259     ULONG NewFlags;
04260     ULONG NewFlagsOn;
04261     ULONG NewFlagsOff;
04262     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04263     PULONG UserVerifyBuffer;
04264 
04265     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
04266 
04267     <span class="keywordflow">if</span> (SystemInformationLength &lt; <span class="keyword">sizeof</span> (ULONG)) {
04268         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_INFO_LENGTH_MISMATCH);
04269     }
04270 
04271     UserVerifyBuffer = (PULONG)SystemInformation;
04272 
04273     <span class="comment">//</span>
04274     <span class="comment">// Synchronize all changes to the flags here.</span>
04275     <span class="comment">//</span>
04276 
04277     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
04278 
04279     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
04280 
04281     <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a> (&amp;MmSystemLoadLock,
04282                            WrVirtualMemory,
04283                            KernelMode,
04284                            FALSE,
04285                            (PLARGE_INTEGER)NULL);
04286 
04287     <span class="keywordflow">try</span> {
04288 
04289         UserFlags = *UserVerifyBuffer;
04290 
04291         <span class="comment">//</span>
04292         <span class="comment">// Ensure nothing is being set or cleared that isn't supported.</span>
04293         <span class="comment">//</span>
04294         <span class="comment">//</span>
04295 
04296         NewFlagsOn = UserFlags &amp; <a class="code" href="../../d9/d5/verifier_8c.html#a16">VerifierModifyableOptions</a>;
04297 
04298         NewFlags = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level | NewFlagsOn;
04299 
04300         <span class="comment">//</span>
04301         <span class="comment">// Any bits set in NewFlagsOff must be zeroed in the NewFlags.</span>
04302         <span class="comment">//</span>
04303 
04304         NewFlagsOff = ((~UserFlags) &amp; <a class="code" href="../../d9/d5/verifier_8c.html#a16">VerifierModifyableOptions</a>);
04305 
04306         NewFlags &amp;= ~NewFlagsOff;
04307 
04308         <span class="keywordflow">if</span> (NewFlags != <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level) {
04309             <a class="code" href="../../d9/d5/verifier_8c.html#a17">VerifierOptionChanges</a> += 1;
04310             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level = NewFlags;
04311             *UserVerifyBuffer = NewFlags;
04312         }
04313 
04314     } except (EXCEPTION_EXECUTE_HANDLER) {
04315         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
04316     }
04317 
04318     <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (&amp;MmSystemLoadLock, 1, FALSE, FALSE);
04319 
04320     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
04321 
04322     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04323 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="verifier.c::VeAllocatePoolWithTagPriority" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID VeAllocatePoolWithTagPriority           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a97">EX_POOL_PRIORITY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Priority</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CallingAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l01104">ExAllocatePoolWithTag()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00927">VerifierAllocatePool()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01003">VerifierAllocatePoolWithQuota()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01059">VerifierAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00965">VerifierAllocatePoolWithTag()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01115">VerifierAllocatePoolWithTagPriority()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="verifier.c::VerifierAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierAllocatePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00927">927</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04111">_MI_VERIFIER_DRIVER_ENTRY::Flags</a>, <a class="el" href="../../d5/d8/ex_8h.html#a330a194">HighPoolPriority</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00060">POOL_DRIVER_MASK</a>, <a class="el" href="../../d6/d1/ppc_2getcalr_8c-source.html#l00038">RtlGetCallersAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.
<p>
<pre class="fragment"><div>00931 {
00932     PVOID CallingAddress;
00933     PVOID CallersCaller;
00934     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
00935 
00936 <span class="preprocessor">#if defined (_X86_)</span>
00937 <span class="preprocessor"></span>    <a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a0">RtlGetCallersAddress</a>(&amp;CallingAddress, &amp;CallersCaller);
00938 <span class="preprocessor">#else</span>
00939 <span class="preprocessor"></span>    CallingAddress = (PVOID)_ReturnAddress();
00940 <span class="preprocessor">#endif</span>
00941 <span class="preprocessor"></span>
00942     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00943 
00944         Verifier = <a class="code" href="../../d9/d5/verifier_8c.html#a105">ViLocateVerifierEntry</a> (CallingAddress);
00945 
00946         <span class="keywordflow">if</span> ((Verifier == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00947             ((Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o6">Flags</a> &amp; <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>) == 0)) {
00948 
00949             <span class="keywordflow">return</span> <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a> (PoolType | POOL_DRIVER_MASK, NumberOfBytes);
00950         }
00951         PoolType |= <a class="code" href="../../d4/d2/pool_8h.html#a10">POOL_DRIVER_MASK</a>;
00952     }
00953 
00954     <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsWithNoTag += 1;
00955 
00956     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority</a> (PoolType,
00957                                           NumberOfBytes,
00958                                           'parW',
00959                                           HighPoolPriority,
00960                                           CallingAddress);
00961 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a108" doxytag="verifier.c::VerifierAllocatePoolWithQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierAllocatePoolWithQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01003">1003</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00127">ExAllocatePoolWithQuota</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04111">_MI_VERIFIER_DRIVER_ENTRY::Flags</a>, <a class="el" href="../../d5/d8/ex_8h.html#a330a194">HighPoolPriority</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00060">POOL_DRIVER_MASK</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00143">POOL_QUOTA_FAIL_INSTEAD_OF_RAISE</a>, <a class="el" href="../../d6/d1/ppc_2getcalr_8c-source.html#l00038">RtlGetCallersAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.
<p>
<pre class="fragment"><div>01007 {
01008     PVOID Va;
01009     LOGICAL RaiseOnQuotaFailure;
01010     PVOID CallingAddress;
01011     PVOID CallersCaller;
01012     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
01013 
01014 <span class="preprocessor">#if defined (_X86_)</span>
01015 <span class="preprocessor"></span>    <a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a0">RtlGetCallersAddress</a>(&amp;CallingAddress, &amp;CallersCaller);
01016 <span class="preprocessor">#else</span>
01017 <span class="preprocessor"></span>    CallingAddress = (PVOID)_ReturnAddress();
01018 <span class="preprocessor">#endif</span>
01019 <span class="preprocessor"></span>
01020     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01021         Verifier = <a class="code" href="../../d9/d5/verifier_8c.html#a105">ViLocateVerifierEntry</a> (CallingAddress);
01022 
01023         <span class="keywordflow">if</span> ((Verifier == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
01024             ((Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o6">Flags</a> &amp; <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>) == 0)) {
01025 
01026             <span class="keywordflow">return</span> <a class="code" href="../../d5/d5/cc_8h.html#a11">ExAllocatePoolWithQuota</a> (PoolType | POOL_DRIVER_MASK,
01027                                             NumberOfBytes);
01028         }
01029         PoolType |= <a class="code" href="../../d4/d2/pool_8h.html#a10">POOL_DRIVER_MASK</a>;
01030     }
01031 
01032     <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsWithNoTag += 1;
01033 
01034     <span class="keywordflow">if</span> (PoolType &amp; <a class="code" href="../../d5/d8/ex_8h.html#a2">POOL_QUOTA_FAIL_INSTEAD_OF_RAISE</a>) {
01035         RaiseOnQuotaFailure = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01036         PoolType &amp;= ~<a class="code" href="../../d5/d8/ex_8h.html#a2">POOL_QUOTA_FAIL_INSTEAD_OF_RAISE</a>;
01037     }
01038     <span class="keywordflow">else</span> {
01039         RaiseOnQuotaFailure = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01040     }
01041 
01042     Va = <a class="code" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority</a> (PoolType,
01043                                         NumberOfBytes,
01044                                         'parW',
01045                                         HighPoolPriority,
01046                                         CallingAddress);
01047 
01048     <span class="keywordflow">if</span> (Va == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01049         <span class="keywordflow">if</span> (RaiseOnQuotaFailure == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01050             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_INSUFFICIENT_RESOURCES);
01051         }
01052     }
01053 
01054     <span class="keywordflow">return</span> Va;
01055 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="verifier.c::VerifierAllocatePoolWithQuotaTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierAllocatePoolWithQuotaTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="verifier.c::VerifierAllocatePoolWithTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierAllocatePoolWithTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00965">965</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04111">_MI_VERIFIER_DRIVER_ENTRY::Flags</a>, <a class="el" href="../../d5/d8/ex_8h.html#a330a194">HighPoolPriority</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00060">POOL_DRIVER_MASK</a>, <a class="el" href="../../d6/d1/ppc_2getcalr_8c-source.html#l00038">RtlGetCallersAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.
<p>
<pre class="fragment"><div>00970 {
00971     PVOID CallingAddress;
00972     PVOID CallersCaller;
00973     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
00974 
00975 <span class="preprocessor">#if defined (_X86_)</span>
00976 <span class="preprocessor"></span>    <a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a0">RtlGetCallersAddress</a>(&amp;CallingAddress, &amp;CallersCaller);
00977 <span class="preprocessor">#else</span>
00978 <span class="preprocessor"></span>    CallingAddress = (PVOID)_ReturnAddress();
00979 <span class="preprocessor">#endif</span>
00980 <span class="preprocessor"></span>
00981     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00982         Verifier = <a class="code" href="../../d9/d5/verifier_8c.html#a105">ViLocateVerifierEntry</a> (CallingAddress);
00983 
00984         <span class="keywordflow">if</span> ((Verifier == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00985             ((Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o6">Flags</a> &amp; <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>) == 0)) {
00986 
00987             <span class="keywordflow">return</span> <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a> (PoolType | POOL_DRIVER_MASK,
00988                                           NumberOfBytes,
00989                                           Tag);
00990         }
00991         PoolType |= <a class="code" href="../../d4/d2/pool_8h.html#a10">POOL_DRIVER_MASK</a>;
00992     }
00993 
00994     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority</a> (PoolType,
00995                                           NumberOfBytes,
00996                                           Tag,
00997                                           HighPoolPriority,
00998                                           CallingAddress);
00999 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="verifier.c::VerifierAllocatePoolWithTagPriority" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierAllocatePoolWithTagPriority           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a97">EX_POOL_PRIORITY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Priority</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01115">1115</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00993">ExAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04111">_MI_VERIFIER_DRIVER_ENTRY::Flags</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00060">POOL_DRIVER_MASK</a>, <a class="el" href="../../d6/d1/ppc_2getcalr_8c-source.html#l00038">RtlGetCallersAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04108">VI_VERIFYING_DIRECTLY</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.
<p>
<pre class="fragment"><div>01124                    :
01125 
01126     This thunked-in function:
01127 
01128         - Performs sanity checks on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
01129         - Can optionally provide allocation failures to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
01130         - Attempts to provide <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocation from special <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
01131         - Tracks <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to ensure callers free everything they allocate.
01132 
01133 --*/
01134 
01135 {
01136     PVOID CallingAddress;
01137     PVOID CallersCaller;
01138     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
01139 
01140 <span class="preprocessor">#if defined (_X86_)</span>
01141 <span class="preprocessor"></span>    <a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a0">RtlGetCallersAddress</a>(&amp;CallingAddress, &amp;CallersCaller);
01142 <span class="preprocessor">#else</span>
01143 <span class="preprocessor"></span>    CallingAddress = (PVOID)_ReturnAddress();
01144 <span class="preprocessor">#endif</span>
01145 <span class="preprocessor"></span>
01146     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01147         Verifier = <a class="code" href="../../d9/d5/verifier_8c.html#a105">ViLocateVerifierEntry</a> (CallingAddress);
01148 
01149         <span class="keywordflow">if</span> ((Verifier == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
01150             ((Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o6">Flags</a> &amp; <a class="code" href="../../d4/d8/mi_8h.html#a252">VI_VERIFYING_DIRECTLY</a>) == 0)) {
01151 
01152             <span class="keywordflow">return</span> <a class="code" href="../../d5/d8/ex_8h.html#a222">ExAllocatePoolWithTagPriority</a> (PoolType | POOL_DRIVER_MASK,
01153                                                   NumberOfBytes,
01154                                                   Tag,
01155                                                   Priority);
01156         }
01157         PoolType |= <a class="code" href="../../d4/d2/pool_8h.html#a10">POOL_DRIVER_MASK</a>;
01158     }
01159 
01160     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5/verifier_8c.html#a58">VeAllocatePoolWithTagPriority</a> (PoolType,
01161                                           NumberOfBytes,
01162                                           Tag,
01163                                           Priority,
01164                                           CallingAddress);
01165 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="verifier.c::VerifierExAcquireFastMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierExAcquireFastMutex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FastMutex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02815">2815</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>02818 {
02819     KIRQL CurrentIrql;
02820 
02821     CurrentIrql = KeGetCurrentIrql ();
02822 
02823     <span class="comment">//</span>
02824     <span class="comment">// Caller better be at or below APC_LEVEL or have APCs blocked.</span>
02825     <span class="comment">//</span>
02826 
02827     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
02828         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02829                       0x33,
02830                       CurrentIrql,
02831                       (ULONG_PTR)FastMutex,
02832                       0);
02833     }
02834 
02835     ExAcquireFastMutex (FastMutex);
02836 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="verifier.c::VerifierExAcquireFastMutexUnsafe" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierExAcquireFastMutexUnsafe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FastMutex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02841">2841</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>.
<p>
<pre class="fragment"><div>02844 {
02845     KIRQL CurrentIrql;
02846 
02847     CurrentIrql = KeGetCurrentIrql ();
02848 
02849     <span class="comment">//</span>
02850     <span class="comment">// Caller better be at APC_LEVEL or have APCs blocked.</span>
02851     <span class="comment">//</span>
02852 
02853     <span class="keywordflow">if</span> ((CurrentIrql != <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) &amp;&amp;
02854         (!<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>())) &amp;&amp;
02855         (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable == 0)) {
02856 
02857         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02858                       0x39,
02859                       CurrentIrql,
02860                       (ULONG_PTR)(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable),
02861                       (ULONG_PTR)FastMutex);
02862     }
02863 
02864     <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a> (FastMutex);
02865 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="verifier.c::VerifierExAcquireResourceExclusive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API BOOLEAN VerifierExAcquireResourceExclusive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Resource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02182">2182</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, and <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>.
<p>
<pre class="fragment"><div>02186 {
02187     KIRQL CurrentIrql;
02188 
02189     CurrentIrql = KeGetCurrentIrql ();
02190 
02191     <span class="keywordflow">if</span> ((CurrentIrql != <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) &amp;&amp;
02192         (!<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>())) &amp;&amp;
02193         (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable == 0)) {
02194 
02195             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02196                           0x37,
02197                           CurrentIrql,
02198                           (ULONG_PTR)(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable),
02199                           (ULONG_PTR)Resource);
02200     }
02201 
02202     <span class="keywordflow">return</span> <a class="code" href="../../d5/d8/ex_8h.html#a269">ExAcquireResourceExclusiveLite</a> (Resource, Wait);
02203 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="verifier.c::VerifierExReleaseFastMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierExReleaseFastMutex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FastMutex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02870">2870</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>.
<p>
<pre class="fragment"><div>02873 {
02874     KIRQL CurrentIrql;
02875 
02876     CurrentIrql = KeGetCurrentIrql ();
02877 
02878     <span class="comment">//</span>
02879     <span class="comment">// Caller better be at APC_LEVEL or have APCs blocked.</span>
02880     <span class="comment">//</span>
02881 
02882     <span class="keywordflow">if</span> ((CurrentIrql != <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) &amp;&amp;
02883         (!<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>())) &amp;&amp;
02884         (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable == 0)) {
02885 
02886         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02887                       0x34,
02888                       CurrentIrql,
02889                       (ULONG_PTR)(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable),
02890                       (ULONG_PTR)FastMutex);
02891     }
02892 
02893     ExReleaseFastMutex (FastMutex);
02894 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="verifier.c::VerifierExReleaseFastMutexUnsafe" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierExReleaseFastMutexUnsafe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FastMutex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02899">2899</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>.
<p>
<pre class="fragment"><div>02902 {
02903     KIRQL CurrentIrql;
02904 
02905     CurrentIrql = KeGetCurrentIrql ();
02906 
02907     <span class="comment">//</span>
02908     <span class="comment">// Caller better be at APC_LEVEL or have APCs blocked.</span>
02909     <span class="comment">//</span>
02910 
02911     <span class="keywordflow">if</span> ((CurrentIrql != <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) &amp;&amp;
02912         (!<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>())) &amp;&amp;
02913         (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable == 0)) {
02914 
02915         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02916                       0x3A,
02917                       CurrentIrql,
02918                       (ULONG_PTR)(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable),
02919                       (ULONG_PTR)FastMutex);
02920     }
02921 
02922     <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a> (FastMutex);
02923 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="verifier.c::VerifierExReleaseResource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierExReleaseResource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Resource</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02208">2208</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01389">ExReleaseResourceLite()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, and <a class="el" href="../../d5/d9/tex_8c-source.html#l01561">Resource</a>.
<p>
<pre class="fragment"><div>02211 {
02212     KIRQL CurrentIrql;
02213 
02214     CurrentIrql = KeGetCurrentIrql ();
02215 
02216     <span class="keywordflow">if</span> ((CurrentIrql != <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) &amp;&amp;
02217         (!<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>())) &amp;&amp;
02218         (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable == 0)) {
02219 
02220             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02221                           0x38,
02222                           CurrentIrql,
02223                           (ULONG_PTR)(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;KernelApcDisable),
02224                           (ULONG_PTR)Resource);
02225     }
02226 
02227     <a class="code" href="../../d5/d8/ex_8h.html#a273">ExReleaseResourceLite</a> (Resource);
02228 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="verifier.c::VerifierExTryToAcquireFastMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API BOOLEAN FASTCALL VerifierExTryToAcquireFastMutex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FastMutex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02789">2789</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>02792 {
02793     KIRQL CurrentIrql;
02794 
02795     CurrentIrql = KeGetCurrentIrql ();
02796 
02797     <span class="comment">//</span>
02798     <span class="comment">// Caller better be at or below APC_LEVEL or have APCs blocked.</span>
02799     <span class="comment">//</span>
02800 
02801     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
02802         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02803                       0x33,
02804                       CurrentIrql,
02805                       (ULONG_PTR)FastMutex,
02806                       0);
02807     }
02808 
02809     <span class="keywordflow">return</span> ExTryToAcquireFastMutex (FastMutex);
02810 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="verifier.c::VerifierFreePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierFreePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>P</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02129">2129</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02143">VerifierFreePoolWithTag()</a>.
<p>
<pre class="fragment"><div>02132 {
02133     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02134         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (P);
02135         <span class="keywordflow">return</span>;
02136     }
02137 
02138     <a class="code" href="../../d9/d5/verifier_8c.html#a60">VerifierFreePoolWithTag</a> (P, 0);
02139 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="verifier.c::VerifierFreePoolWithTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierFreePoolWithTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TagToFree</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02143">2143</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03892">ExFreePoolSanityChecks()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00291">ExFreePoolWithTag</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02129">VerifierFreePool()</a>.
<p>
<pre class="fragment"><div>02147 {
02148     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02149         <a class="code" href="../../d5/d8/ex_8h.html#a7">ExFreePoolWithTag</a> (P, TagToFree);
02150         <span class="keywordflow">return</span>;
02151     }
02152 
02153     <a class="code" href="../../d5/d8/ex_8h.html#a218">ExFreePoolSanityChecks</a> (P);
02154 
02155     <a class="code" href="../../d5/d8/ex_8h.html#a7">ExFreePoolWithTag</a> (P, TagToFree);
02156 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a91" doxytag="verifier.c::VerifierFreeTrackedPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VerifierFreeTrackedPool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>ChargedBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>CheckType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>SpecialPool</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02760">ExFreePoolWithTag()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l01778">MiFreePoolPages()</a>, and <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03742">MmFreeSpecialPool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="verifier.c::VerifierKeAcquireQueuedSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API KIRQL FASTCALL VerifierKeAcquireQueuedSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a35">KSPIN_LOCK_QUEUE_NUMBER</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Number</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="verifier.c::VerifierKeAcquireSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierKeAcquireSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>SpinLock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02365">2365</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02233">KfSanityCheckRaiseIrql()</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02358">PKE_ACQUIRE_SPINLOCK</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02333">ViTrimAllSystemPagableMemory()</a>.
<p>
<pre class="fragment"><div>02369 {
02370     KIRQL CurrentIrql;
02371     <a class="code" href="../../d9/d5/verifier_8c.html#a44">PKE_ACQUIRE_SPINLOCK</a> HalRoutine;
02372 
02373     CurrentIrql = KeGetCurrentIrql ();
02374 
02375     <a class="code" href="../../d9/d5/verifier_8c.html#a100">KfSanityCheckRaiseIrql</a> (DISPATCH_LEVEL);
02376 
02377     <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AcquireSpinLocks += 1;
02378 
02379     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_FORCE_IRQL_CHECKING) {
02380         <span class="keywordflow">if</span> (CurrentIrql &lt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
02381             <a class="code" href="../../d9/d5/verifier_8c.html#a94">ViTrimAllSystemPagableMemory</a> ();
02382         }
02383     }
02384 
02385 <span class="preprocessor">#if defined (_X86_)</span>
02386 <span class="preprocessor"></span>    HalRoutine = (<a class="code" href="../../d9/d5/verifier_8c.html#a44">PKE_ACQUIRE_SPINLOCK</a>) (ULONG_PTR) MiKernelVerifierOriginalCalls[VI_KE_ACQUIRE_SPINLOCK];
02387 
02388     <span class="keywordflow">if</span> (HalRoutine) {
02389         (*HalRoutine)(SpinLock, OldIrql);
02390         <span class="keywordflow">return</span>;
02391     }
02392 <span class="preprocessor">#endif</span>
02393 <span class="preprocessor"></span>
02394     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a> (SpinLock, OldIrql);
02395 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="verifier.c::VerifierKeInitializeTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierKeInitializeTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Timer</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03039">3039</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d0/d5/verifier_8c-source.html#l03020">VerifierKeInitializeTimerEx()</a>.
<p>
<pre class="fragment"><div>03042 {
03043     <a class="code" href="../../d9/d5/verifier_8c.html#a70">VerifierKeInitializeTimerEx</a>(Timer, NotificationTimer);
03044 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="verifier.c::VerifierKeInitializeTimerEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierKeInitializeTimerEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Timer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN TIMER_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>Type</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03020">3020</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00467">KeCheckForTimer()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00075">KeInitializeTimerEx()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00059">KiTimerTableListHead</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03039">VerifierKeInitializeTimer()</a>.
<p>
<pre class="fragment"><div>03024 {
03025     <span class="comment">//</span>
03026     <span class="comment">// Check the object being initialized isn't already an</span>
03027     <span class="comment">// active timer.  Make sure the timer table list is initialized.</span>
03028     <span class="comment">//</span>
03029 
03030     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/kernldat_8c.html#a3">KiTimerTableListHead</a>[0].Flink != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03031         <a class="code" href="../../d3/d2/timerobj_8c.html#a9">KeCheckForTimer</a>(Timer, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8/struct__KTIMER.html">KTIMER</a>));
03032     }
03033 
03034     <a class="code" href="../../d3/d2/timerobj_8c.html#a2">KeInitializeTimerEx</a>(Timer, Type);
03035 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="verifier.c::VerifierKeLowerIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierKeLowerIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02972">2972</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02283">KfSanityCheckLowerIrql()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02966">PKE_LOWER_IRQL</a>.
<p>
<pre class="fragment"><div>02975 {
02976     <a class="code" href="../../d9/d5/verifier_8c.html#a47">PKE_LOWER_IRQL</a> HalRoutine;
02977 
02978     <a class="code" href="../../d9/d5/verifier_8c.html#a101">KfSanityCheckLowerIrql</a> (NewIrql);
02979 
02980 <span class="preprocessor">#if defined (_X86_)</span>
02981 <span class="preprocessor"></span>    HalRoutine = (<a class="code" href="../../d9/d5/verifier_8c.html#a47">PKE_LOWER_IRQL</a>) (ULONG_PTR) MiKernelVerifierOriginalCalls[VI_KE_LOWER_IRQL];
02982     <span class="keywordflow">if</span> (HalRoutine) {
02983         (*HalRoutine)(NewIrql);
02984         <span class="keywordflow">return</span>;
02985     }
02986 <span class="preprocessor">#endif</span>
02987 <span class="preprocessor"></span>
02988     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a> (NewIrql);
02989 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="verifier.c::VerifierKeRaiseIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierKeRaiseIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>NewIrql</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02934">2934</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02233">KfSanityCheckRaiseIrql()</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02927">PKE_RAISE_IRQL</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02333">ViTrimAllSystemPagableMemory()</a>.
<p>
<pre class="fragment"><div>02938 {
02939     <a class="code" href="../../d9/d5/verifier_8c.html#a46">PKE_RAISE_IRQL</a> HalRoutine;
02940 
02941     *OldIrql = KeGetCurrentIrql ();
02942 
02943     <a class="code" href="../../d9/d5/verifier_8c.html#a100">KfSanityCheckRaiseIrql</a> (NewIrql);
02944 
02945     <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.RaiseIrqls += 1;
02946 
02947     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_FORCE_IRQL_CHECKING) {
02948         <span class="keywordflow">if</span> ((*OldIrql &lt; DISPATCH_LEVEL) &amp;&amp; (NewIrql &gt;= <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>)) {
02949             <a class="code" href="../../d9/d5/verifier_8c.html#a94">ViTrimAllSystemPagableMemory</a> ();
02950         }
02951     }
02952 
02953 <span class="preprocessor">#if defined (_X86_)</span>
02954 <span class="preprocessor"></span>    HalRoutine = (<a class="code" href="../../d9/d5/verifier_8c.html#a46">PKE_RAISE_IRQL</a>) (ULONG_PTR) MiKernelVerifierOriginalCalls[VI_KE_RAISE_IRQL];
02955     <span class="keywordflow">if</span> (HalRoutine) {
02956         (*HalRoutine)(NewIrql, OldIrql);
02957         <span class="keywordflow">return</span>;
02958     }
02959 <span class="preprocessor">#endif</span>
02960 <span class="preprocessor"></span>
02961     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a> (NewIrql, OldIrql);
02962 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="verifier.c::VerifierKeReleaseQueuedSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierKeReleaseQueuedSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a35">KSPIN_LOCK_QUEUE_NUMBER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="verifier.c::VerifierKeReleaseSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierKeReleaseSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>SpinLock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>NewIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02406">2406</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02283">KfSanityCheckLowerIrql()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02399">PKE_RELEASE_SPINLOCK</a>.
<p>
<pre class="fragment"><div>02410 {
02411     KIRQL CurrentIrql;
02412     <a class="code" href="../../d9/d5/verifier_8c.html#a45">PKE_RELEASE_SPINLOCK</a> HalRoutine;
02413 
02414     CurrentIrql = KeGetCurrentIrql ();
02415 
02416     <span class="comment">//</span>
02417     <span class="comment">// Caller better still be at DISPATCH_LEVEL when releasing the spinlock</span>
02418     <span class="comment">//</span>
02419 
02420     <span class="keywordflow">if</span> (CurrentIrql != <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
02421         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02422                       0x32,
02423                       CurrentIrql,
02424                       (ULONG_PTR)SpinLock,
02425                       0);
02426     }
02427 
02428     <a class="code" href="../../d9/d5/verifier_8c.html#a101">KfSanityCheckLowerIrql</a> (NewIrql);
02429 
02430 <span class="preprocessor">#if defined (_X86_)</span>
02431 <span class="preprocessor"></span>    HalRoutine = (<a class="code" href="../../d9/d5/verifier_8c.html#a45">PKE_RELEASE_SPINLOCK</a>) (ULONG_PTR) MiKernelVerifierOriginalCalls[VI_KE_RELEASE_SPINLOCK];
02432 
02433     <span class="keywordflow">if</span> (HalRoutine) {
02434         (*HalRoutine)(SpinLock, NewIrql);
02435         <span class="keywordflow">return</span>;
02436     }
02437 <span class="preprocessor">#endif</span>
02438 <span class="preprocessor"></span>
02439     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a> (SpinLock, NewIrql);
02440 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="verifier.c::VerifierKfAcquireSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API KIRQL FASTCALL VerifierKfAcquireSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SpinLock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="verifier.c::VerifierKfLowerIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierKfLowerIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="verifier.c::VerifierKfRaiseIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API KIRQL FASTCALL VerifierKfRaiseIrql           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="verifier.c::VerifierKfReleaseSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID FASTCALL VerifierKfReleaseSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>SpinLock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>NewIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="verifier.c::VerifierMapIoSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierMapIoSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PHYSICAL_ADDRESS&nbsp;</td>
          <td class="mdname" nowrap> <em>PhysicalAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a156">MEMORY_CACHING_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CacheType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00662">662</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03415">MmMapIoSpace()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.
<p>
<pre class="fragment"><div>00667 {
00668     KIRQL CurrentIrql;
00669 
00670     CurrentIrql = KeGetCurrentIrql();
00671     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00672         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00673                       0x73,
00674                       CurrentIrql,
00675                       (ULONG_PTR)PhysicalAddress.LowPart,
00676                       NumberOfBytes);
00677     }
00678 
00679     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a93">ViInjectResourceFailure</a> () == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00680         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00681     }
00682 
00683     <span class="keywordflow">return</span> <a class="code" href="../../d5/d6/iosup_8c.html#a57">MmMapIoSpace</a> (PhysicalAddress, NumberOfBytes, CacheType);
00684 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a89" doxytag="verifier.c::VerifierMapLockedPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierMapLockedPages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryDescriptorList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00688">688</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00437">MDL_MAPPING_CAN_FAIL</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02009">MmMapLockedPages()</a>, <a class="el" href="../../d6/d1/ppc_2getcalr_8c-source.html#l00038">RtlGetCallersAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00632">ViAddBadMapper()</a>.
<p>
<pre class="fragment"><div>00692 {
00693     PVOID CallingAddress;
00694     PVOID CallersCaller;
00695     KIRQL CurrentIrql;
00696 
00697 <span class="preprocessor">#if defined (_X86_)</span>
00698 <span class="preprocessor"></span>    <a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a0">RtlGetCallersAddress</a>(&amp;CallingAddress, &amp;CallersCaller);
00699 <span class="preprocessor">#else</span>
00700 <span class="preprocessor"></span>    CallingAddress = (PVOID)_ReturnAddress();
00701 <span class="preprocessor">#endif</span>
00702 <span class="preprocessor"></span>
00703     CurrentIrql = KeGetCurrentIrql();
00704 
00705     <span class="keywordflow">if</span> (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00706         <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00707             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00708                           0x74,
00709                           CurrentIrql,
00710                           (ULONG_PTR)MemoryDescriptorList,
00711                           (ULONG_PTR)AccessMode);
00712         }
00713     }
00714     <span class="keywordflow">else</span> {
00715         <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
00716             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00717                           0x75,
00718                           CurrentIrql,
00719                           (ULONG_PTR)MemoryDescriptorList,
00720                           (ULONG_PTR)AccessMode);
00721         }
00722     }
00723 
00724     <span class="keywordflow">if</span> ((MemoryDescriptorList-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a25">MDL_MAPPING_CAN_FAIL</a>) == 0) {
00725 
00726         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a107">ViAddBadMapper</a> (CallingAddress) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00727 
00728             <span class="comment">//</span>
00729             <span class="comment">// All drivers must specify can fail.  We'd really like to bugcheck</span>
00730             <span class="comment">// here to get drivers to convert but cut them some slack for now.</span>
00731             <span class="comment">//</span>
00732 
00733             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*******************************************************************************\n"</span>);
00734             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*                                                                             *\n"</span>);
00735 
00736             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* The Driver Verifier has detected the driver at address %p\n"</span>, CallingAddress);
00737             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* is calling MmMapLockedPages instead of MmMapLockedPagesSpecifyCache.\n"</span>);
00738             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* This can cause the system to needlessly bugcheck whenever system\n"</span>);
00739             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* resources are low.  This driver needs to be fixed.\n"</span>);
00740 
00741             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*                                                                             *\n"</span>);
00742             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*******************************************************************************\n"</span>);
00743         }
00744     }
00745 
00746     <span class="keywordflow">return</span> <a class="code" href="../../d5/d6/iosup_8c.html#a49">MmMapLockedPages</a> (MemoryDescriptorList, AccessMode);
00747 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a90" doxytag="verifier.c::VerifierMapLockedPagesSpecifyCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API PVOID VerifierMapLockedPagesSpecifyCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryDescriptorList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a156">MEMORY_CACHING_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CacheType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestedAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckOnFailure</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d1/mm_8h.html#a154">MM_PAGE_PRIORITY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Priority</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00751">751</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00437">MDL_MAPPING_CAN_FAIL</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02058">MmMapLockedPagesSpecifyCache()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d1/ppc_2getcalr_8c-source.html#l00038">RtlGetCallersAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00632">ViAddBadMapper()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.
<p>
<pre class="fragment"><div>00759 {
00760     PVOID CallingAddress;
00761     PVOID CallersCaller;
00762     KIRQL CurrentIrql;
00763 
00764 <span class="preprocessor">#if defined (_X86_)</span>
00765 <span class="preprocessor"></span>    <a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a0">RtlGetCallersAddress</a>(&amp;CallingAddress, &amp;CallersCaller);
00766 <span class="preprocessor">#else</span>
00767 <span class="preprocessor"></span>    CallingAddress = (PVOID)_ReturnAddress();
00768 <span class="preprocessor">#endif</span>
00769 <span class="preprocessor"></span>
00770     CurrentIrql = KeGetCurrentIrql();
00771     <span class="keywordflow">if</span> (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00772         <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00773             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00774                           0x76,
00775                           CurrentIrql,
00776                           (ULONG_PTR)MemoryDescriptorList,
00777                           (ULONG_PTR)AccessMode);
00778         }
00779     }
00780     <span class="keywordflow">else</span> {
00781         <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
00782             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00783                           0x77,
00784                           CurrentIrql,
00785                           (ULONG_PTR)MemoryDescriptorList,
00786                           (ULONG_PTR)AccessMode);
00787         }
00788     }
00789 
00790     <span class="keywordflow">if</span> ((MemoryDescriptorList-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a25">MDL_MAPPING_CAN_FAIL</a>) ||
00791         (BugCheckOnFailure == 0)) {
00792 
00793         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a93">ViInjectResourceFailure</a> () == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00794             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00795         }
00796     }
00797     <span class="keywordflow">else</span> {
00798 
00799         <span class="comment">//</span>
00800         <span class="comment">// All drivers must specify can fail or don't bugcheck.  We'd</span>
00801         <span class="comment">// really like to bugcheck here to get drivers to convert but</span>
00802         <span class="comment">// cut them some slack for now.</span>
00803         <span class="comment">//</span>
00804 
00805         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a107">ViAddBadMapper</a> (CallingAddress) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00806 
00807             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*******************************************************************************\n"</span>);
00808             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*                                                                             *\n"</span>);
00809 
00810             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* The Driver Verifier has detected the driver at address %p\n"</span>, CallingAddress);
00811             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* is not calling the safe version of MmMapLockedPagesSpecifyCache.\n"</span>);
00812             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* This can cause the system to needlessly bugcheck whenever system\n"</span>);
00813             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* resources are low.  This driver needs to be fixed.\n"</span>);
00814 
00815             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*                                                                             *\n"</span>);
00816             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*******************************************************************************\n"</span>);
00817         }
00818     }
00819 
00820     <span class="keywordflow">return</span> <a class="code" href="../../d5/d6/iosup_8c.html#a50">MmMapLockedPagesSpecifyCache</a> (MemoryDescriptorList,
00821                                          AccessMode,
00822                                          CacheType,
00823                                          RequestedAddress,
00824                                          BugCheckOnFailure,
00825                                          Priority);
00826 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="verifier.c::VerifierProbeAndLockPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierProbeAndLockPages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryDescriptorList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d1/mm_8h.html#a141">LOCK_OPERATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Operation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00537">537</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l00238">MmProbeAndLockPages()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.
<p>
<pre class="fragment"><div>00542 {
00543     KIRQL CurrentIrql;
00544 
00545     CurrentIrql = KeGetCurrentIrql();
00546     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00547         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00548                       0x70,
00549                       CurrentIrql,
00550                       (ULONG_PTR)MemoryDescriptorList,
00551                       (ULONG_PTR)AccessMode);
00552     }
00553 
00554     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a93">ViInjectResourceFailure</a> () == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00555         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_WORKING_SET_QUOTA);
00556     }
00557 
00558     <a class="code" href="../../d5/d6/iosup_8c.html#a41">MmProbeAndLockPages</a> (MemoryDescriptorList, AccessMode, Operation);
00559 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="verifier.c::VerifierProbeAndLockProcessPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierProbeAndLockProcessPages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryDescriptorList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d1/mm_8h.html#a141">LOCK_OPERATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Operation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00563">563</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l00813">MmProbeAndLockProcessPages()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.
<p>
<pre class="fragment"><div>00569 {
00570     KIRQL CurrentIrql;
00571 
00572     CurrentIrql = KeGetCurrentIrql();
00573     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00574         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00575                       0x71,
00576                       CurrentIrql,
00577                       (ULONG_PTR)MemoryDescriptorList,
00578                       (ULONG_PTR)Process);
00579     }
00580 
00581     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a93">ViInjectResourceFailure</a> () == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00582         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_WORKING_SET_QUOTA);
00583     }
00584 
00585     <a class="code" href="../../d5/d6/iosup_8c.html#a42">MmProbeAndLockProcessPages</a> (MemoryDescriptorList,
00586                                 Process,
00587                                 AccessMode,
00588                                 Operation);
00589 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="verifier.c::VerifierProbeAndLockSelectedPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API VOID VerifierProbeAndLockSelectedPages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryDescriptorList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PFILE_SEGMENT_ELEMENT&nbsp;</td>
          <td class="mdname" nowrap> <em>SegmentArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d1/mm_8h.html#a141">LOCK_OPERATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Operation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00593">593</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01152">MmProbeAndLockSelectedPages()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.
<p>
<pre class="fragment"><div>00599 {
00600     KIRQL CurrentIrql;
00601 
00602     CurrentIrql = KeGetCurrentIrql();
00603     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
00604         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00605                       0x72,
00606                       CurrentIrql,
00607                       (ULONG_PTR)MemoryDescriptorList,
00608                       (ULONG_PTR)AccessMode);
00609     }
00610 
00611     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a93">ViInjectResourceFailure</a> () == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00612         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_WORKING_SET_QUOTA);
00613     }
00614 
00615     <a class="code" href="../../d5/d6/iosup_8c.html#a44">MmProbeAndLockSelectedPages</a> (MemoryDescriptorList,
00616                                  SegmentArray,
00617                                  AccessMode,
00618                                  Operation);
00619 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="verifier.c::VerifierSetEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API LONG VerifierSetEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d6/struct__KEVENT.html">PRKEVENT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02160">2160</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">Event()</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>.
<p>
<pre class="fragment"><div>02165 {
02166     KIRQL CurrentIrql;
02167 
02168     CurrentIrql = KeGetCurrentIrql();
02169     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
02170         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
02171                       0x80,
02172                       CurrentIrql,
02173                       (ULONG_PTR)Event,
02174                       (ULONG_PTR)0);
02175     }
02176 
02177     <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a> (Event, Increment, Wait);
02178 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="verifier.c::VerifierSynchronizeExecution" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> THUNKED_API BOOLEAN VerifierSynchronizeExecution           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d7/struct__KINTERRUPT.html">PKINTERRUPT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Interrupt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a44">PKSYNCHRONIZE_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SynchronizeRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SynchronizeContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02993">2993</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a273">KeSynchronizeExecution()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02233">KfSanityCheckRaiseIrql()</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02333">ViTrimAllSystemPagableMemory()</a>.
<p>
<pre class="fragment"><div>02998 {
02999     KIRQL OldIrql;
03000 
03001     OldIrql = KeGetCurrentIrql ();
03002 
03003     <a class="code" href="../../d9/d5/verifier_8c.html#a100">KfSanityCheckRaiseIrql</a> (Interrupt-&gt;SynchronizeIrql);
03004 
03005     <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.SynchronizeExecutions += 1;
03006 
03007     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_FORCE_IRQL_CHECKING) {
03008         <span class="keywordflow">if</span> ((OldIrql &lt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) &amp;&amp; (Interrupt-&gt;SynchronizeIrql &gt;= <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>)) {
03009             <a class="code" href="../../d9/d5/verifier_8c.html#a94">ViTrimAllSystemPagableMemory</a> ();
03010         }
03011     }
03012 
03013     <span class="keywordflow">return</span> <a class="code" href="../../d4/d9/ke_8h.html#a273">KeSynchronizeExecution</a> (Interrupt,
03014                                    SynchronizeRoutine,
03015                                    SynchronizeContext);
03016 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="verifier.c::VerifierUnlockPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VerifierUnlockPages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>MemoryDescriptorList</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00829">829</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00425">MDL_PAGES_LOCKED</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00426">MDL_SOURCE_IS_NONPAGED_POOL</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l01347">MmUnlockPages()</a>.
<p>
<pre class="fragment"><div>00832 {
00833     KIRQL CurrentIrql;
00834 
00835     CurrentIrql = KeGetCurrentIrql();
00836     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00837         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00838                       0x78,
00839                       CurrentIrql,
00840                       (ULONG_PTR)MemoryDescriptorList,
00841                       0);
00842     }
00843 
00844     <span class="keywordflow">if</span> ((MemoryDescriptorList-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a13">MDL_PAGES_LOCKED</a>) == 0) {
00845 
00846         <span class="comment">//</span>
00847         <span class="comment">// The caller is trying to unlock an MDL that was never locked down.</span>
00848         <span class="comment">//</span>
00849 
00850         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00851                       0x7C,
00852                       (ULONG_PTR)MemoryDescriptorList,
00853                       (ULONG_PTR)MemoryDescriptorList-&gt;MdlFlags,
00854                       0);
00855     }
00856 
00857     <span class="keywordflow">if</span> (MemoryDescriptorList-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a14">MDL_SOURCE_IS_NONPAGED_POOL</a>) {
00858 
00859         <span class="comment">//</span>
00860         <span class="comment">// Nonpaged pool should never be locked down.</span>
00861         <span class="comment">//</span>
00862 
00863         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00864                       0x7D,
00865                       (ULONG_PTR)MemoryDescriptorList,
00866                       (ULONG_PTR)MemoryDescriptorList-&gt;MdlFlags,
00867                       0);
00868     }
00869 
00870     <a class="code" href="../../d5/d6/iosup_8c.html#a45">MmUnlockPages</a> (MemoryDescriptorList);
00871 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="verifier.c::VerifierUnmapIoSpace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VerifierUnmapIoSpace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00906">906</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>.
<p>
<pre class="fragment"><div>00910 {
00911     KIRQL CurrentIrql;
00912 
00913     CurrentIrql = KeGetCurrentIrql();
00914     <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00915         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00916                       0x7B,
00917                       CurrentIrql,
00918                       (ULONG_PTR)BaseAddress,
00919                       (ULONG_PTR)NumberOfBytes);
00920     }
00921 
00922     <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a> (BaseAddress, NumberOfBytes);
00923 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a86" doxytag="verifier.c::VerifierUnmapLockedPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID VerifierUnmapLockedPages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryDescriptorList</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00874">874</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l03124">MmUnmapLockedPages()</a>.
<p>
<pre class="fragment"><div>00878 {
00879     KIRQL CurrentIrql;
00880 
00881     CurrentIrql = KeGetCurrentIrql();
00882 
00883     <span class="keywordflow">if</span> (BaseAddress &gt; MM_HIGHEST_USER_ADDRESS) {
00884         <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00885             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00886                           0x79,
00887                           CurrentIrql,
00888                           (ULONG_PTR)BaseAddress,
00889                           (ULONG_PTR)MemoryDescriptorList);
00890         }
00891     }
00892     <span class="keywordflow">else</span> {
00893         <span class="keywordflow">if</span> (CurrentIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
00894             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
00895                           0x7A,
00896                           CurrentIrql,
00897                           (ULONG_PTR)BaseAddress,
00898                           (ULONG_PTR)MemoryDescriptorList);
00899         }
00900     }
00901 
00902     <a class="code" href="../../d5/d6/iosup_8c.html#a56">MmUnmapLockedPages</a> (BaseAddress, MemoryDescriptorList);
00903 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a107" doxytag="verifier.c::ViAddBadMapper" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL ViAddBadMapper           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>BadMapper</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00632">632</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00626">VI_BAD_MAPPERS_MAX</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00628">ViBadMapperLock</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00629">ViBadMappers</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l00688">VerifierMapLockedPages()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00751">VerifierMapLockedPagesSpecifyCache()</a>.
<p>
<pre class="fragment"><div>00635 {
00636     ULONG i;
00637     KIRQL OldIrql;
00638     LOGICAL Added;
00639 
00640     Added = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00641     ExAcquireSpinLock (&amp;ViBadMapperLock, &amp;OldIrql);
00642 
00643     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d9/d5/verifier_8c.html#a1">VI_BAD_MAPPERS_MAX</a>; i += 1) {
00644         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a42">ViBadMappers</a>[i] == BadMapper) {
00645             <span class="keywordflow">break</span>;
00646         }
00647 
00648         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a42">ViBadMappers</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00649             <a class="code" href="../../d9/d5/verifier_8c.html#a42">ViBadMappers</a>[i] = BadMapper;
00650             Added = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00651             <span class="keywordflow">break</span>;
00652         }
00653     }
00654 
00655     ExReleaseSpinLock (&amp;ViBadMapperLock, OldIrql);
00656 
00657     <span class="keywordflow">return</span> Added;
00658 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a98" doxytag="verifier.c::ViCancelPoolAllocation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ViCancelPoolAllocation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Verifier</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01566">1566</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l04081">VI_POOL_FREELIST_END</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01812">VeAllocatePoolWithTagPriority()</a>.
<p>
<pre class="fragment"><div>01572                    :
01573 
01574     This function removes a reservation from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier list <span class="keywordflow">for</span> <span class="keyword">this</span> driver.
01575     All reservations must be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> in advance.  This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used when an
01576     earlier reservation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not going to be used (ie: the actual pool
01577     allocation failed so no reservation will be needed after all).
01578 
01579 Arguments:
01580 
01581     Verifier - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier entry to update.
01582 
01583 Return Value:
01584 
01585     None.
01586 
01587 Environment:
01588 
01589     Kernel mode, <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a> or below, no verifier mutexes held.
01590 
01591 --*/
01592 
01593 {
01594     KIRQL OldIrql;
01595 
01596     ExAcquireSpinLock (&amp;Verifier-&gt;VerifierPoolLock, &amp;OldIrql);
01597 
01598     <span class="comment">//</span>
01599     <span class="comment">// The hash entry reserved earlier is not going to be used after all.</span>
01600     <span class="comment">//</span>
01601 
01602     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;PoolHashReserved != 0);
01603 
01604     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;PoolHashSize &gt;= Verifier-&gt;CurrentPagedPoolAllocations + Verifier-&gt;CurrentNonPagedPoolAllocations + Verifier-&gt;PoolHashReserved);
01605 
01606     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;PoolHashFree != VI_POOL_FREELIST_END);
01607 
01608     Verifier-&gt;PoolHashReserved -= 1;
01609 
01610     ExReleaseSpinLock (&amp;Verifier-&gt;VerifierPoolLock, OldIrql);
01611 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a95" doxytag="verifier.c::ViInitializeEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ViInitializeEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Verifier</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>FirstLoad</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03047">3047</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04097">MI_VERIFIER_ENTRY_SIGNATURE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00392">VerifierListLock</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l04081">VI_POOL_FREELIST_END</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>.
<p>
<pre class="fragment"><div>03054                    :
03055 
03056     Initialize various verifier fields as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being (re)loaded now.
03057 
03058 Arguments:
03059 
03060     Verifier - Supplies the verifier entry to be initialized.
03061 
03062     FirstLoad - Supplies TRUE if this is the first load of this driver.
03063 
03064 Return Value:
03065 
03066     None.
03067 
03068 --*/
03069 
03070 {
03071     KIRQL OldIrql;
03072 
03073     <span class="comment">//</span>
03074     <span class="comment">// Only the BaseName field is initialized on entry.</span>
03075     <span class="comment">//</span>
03076 
03077     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a> (&amp;Verifier-&gt;VerifierPoolLock);
03078 
03079     Verifier-&gt;CurrentPagedPoolAllocations = 0;
03080     Verifier-&gt;CurrentNonPagedPoolAllocations = 0;
03081     Verifier-&gt;PeakPagedPoolAllocations = 0;
03082     Verifier-&gt;PeakNonPagedPoolAllocations = 0;
03083 
03084     Verifier-&gt;PagedBytes = 0;
03085     Verifier-&gt;NonPagedBytes = 0;
03086     Verifier-&gt;PeakPagedBytes = 0;
03087     Verifier-&gt;PeakNonPagedBytes = 0;
03088 
03089     Verifier-&gt;PoolHash = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03090     Verifier-&gt;PoolHashSize = 0;
03091     Verifier-&gt;PoolHashFree = <a class="code" href="../../d4/d8/mi_8h.html#a250">VI_POOL_FREELIST_END</a>;
03092     Verifier-&gt;PoolHashReserved = 0;
03093 
03094     Verifier-&gt;Signature = <a class="code" href="../../d4/d8/mi_8h.html#a251">MI_VERIFIER_ENTRY_SIGNATURE</a>;
03095 
03096     <span class="keywordflow">if</span> (FirstLoad == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03097         Verifier-&gt;Flags = 0;
03098         Verifier-&gt;Loads = 0;
03099         Verifier-&gt;Unloads = 0;
03100     }
03101 
03102     ExAcquireSpinLock (&amp;VerifierListLock, &amp;OldIrql);
03103     Verifier-&gt;StartAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03104     Verifier-&gt;EndAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03105     ExReleaseSpinLock (&amp;VerifierListLock, OldIrql);
03106 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a93" doxytag="verifier.c::ViInjectResourceFailure" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL ViInjectResourceFailure           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">1168</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02767">KeBootTime</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00153">KeQuerySystemTime()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00182">KeQueryTickCount()</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00388">VerifierRequiredTimeSinceBoot</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00386">VerifierSystemSufficientlyBooted</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01812">VeAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00662">VerifierMapIoSpace()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00751">VerifierMapLockedPagesSpecifyCache()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00537">VerifierProbeAndLockPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00563">VerifierProbeAndLockProcessPages()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00593">VerifierProbeAndLockSelectedPages()</a>.
<p>
<pre class="fragment"><div>01174                    :
01175 
01176     This function determines whether a resource allocation should be
01177     deliberately failed.  This may be a <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocation, <a class="code" href="../../d6/d7/struct__MDL.html">MDL</a> creation,
01178     system PTE allocation, etc.
01179 
01180 Arguments:
01181 
01182     None.
01183 
01184 Return Value:
01185 
01186     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocation should be failed.  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
01187 
01188 Environment:
01189 
01190     Kernel mode.  <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a> or below.
01191 
01192 --*/
01193 
01194 {
01195     LARGE_INTEGER CurrentTime;
01196 
01197     <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level &amp; DRIVER_VERIFIER_INJECT_ALLOCATION_FAILURES) == 0) {
01198         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01199     }
01200 
01201     <span class="comment">//</span>
01202     <span class="comment">// Don't fail any requests in the first 7 or 8 minutes as we want to</span>
01203     <span class="comment">// give the system enough time to boot.</span>
01204     <span class="comment">//</span>
01205 
01206     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a26">VerifierSystemSufficientlyBooted</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01207         <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a3">KeQuerySystemTime</a> (&amp;CurrentTime);
01208         <span class="keywordflow">if</span> (CurrentTime.QuadPart &gt; <a class="code" href="../../d4/d9/ke_8h.html#a124">KeBootTime</a>.QuadPart + <a class="code" href="../../d9/d5/verifier_8c.html#a27">VerifierRequiredTimeSinceBoot</a>.QuadPart) {
01209             <a class="code" href="../../d9/d5/verifier_8c.html#a26">VerifierSystemSufficientlyBooted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01210         }
01211     }
01212 
01213     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/verifier_8c.html#a26">VerifierSystemSufficientlyBooted</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01214 
01215         <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a4">KeQueryTickCount</a>(&amp;CurrentTime);
01216 
01217         <span class="keywordflow">if</span> ((CurrentTime.LowPart &amp; 0xF) == 0) {
01218 
01219             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsFailedDeliberately += 1;
01220 
01221             <span class="comment">//</span>
01222             <span class="comment">// Deliberately fail this request.</span>
01223             <span class="comment">//</span>
01224 
01225             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01226         }
01227     }
01228 
01229     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01230 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a97" doxytag="verifier.c::ViInsertPoolAllocation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR ViInsertPoolAllocation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Verifier</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CallingAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01369">1369</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04085">_VI_POOL_ENTRY_INUSE::CallingAddress</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04093">_VI_POOL_ENTRY::FreeListNext</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04092">_VI_POOL_ENTRY::InUse</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04086">_VI_POOL_ENTRY_INUSE::NumberOfBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04087">_VI_POOL_ENTRY_INUSE::Tag</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04081">VI_POOL_FREELIST_END</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l04084">_VI_POOL_ENTRY_INUSE::VirtualAddress</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.
<p>
<pre class="fragment"><div>01379                    :
01380 
01381     This function inserts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <span class="keyword">virtual</span> address into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier
01382     list <span class="keywordflow">for</span> <span class="keyword">this</span> driver.
01383 
01384 Arguments:
01385 
01386     Verifier - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier entry to update.
01387 
01388     VirtualAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to insert.
01389 
01390     CallingAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's address.
01391 
01392     NumberOfBytes - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to allocate.
01393 
01394     Tag - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tag <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> being allocated.
01395 
01396 Return Value:
01397 
01398     The list index <span class="keyword">this</span> <span class="keyword">virtual</span> address was inserted at.
01399 
01400 Environment:
01401 
01402     Kernel mode, <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.  The Verifier-&gt;VerifierPoolLock must be held.
01403 
01404 --*/
01405 
01406 {
01407     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01408     <a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a> HashEntry;
01409 
01410     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (KeGetCurrentIrql() == DISPATCH_LEVEL);
01411 
01412     <span class="comment">//</span>
01413     <span class="comment">// The list entry must be reserved in advance.</span>
01414     <span class="comment">//</span>
01415 
01416     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;PoolHashReserved != 0);
01417 
01418     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;PoolHashSize &gt;= Verifier-&gt;CurrentPagedPoolAllocations + Verifier-&gt;CurrentNonPagedPoolAllocations + Verifier-&gt;PoolHashReserved);
01419 
01420     <span class="comment">//</span>
01421     <span class="comment">// Use the next free list entry.</span>
01422     <span class="comment">//</span>
01423 
01424     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = Verifier-&gt;PoolHashFree;
01425     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Index != VI_POOL_FREELIST_END);
01426 
01427     HashEntry = Verifier-&gt;PoolHash + <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01428 
01429     Verifier-&gt;PoolHashFree = HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a>;
01430 
01431     Verifier-&gt;PoolHashReserved -= 1;
01432 
01433     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (((HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a> &amp; MINLONG_PTR) == 0) ||
01434             (HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a> == VI_POOL_FREELIST_END));
01435 
01436     HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o0">VirtualAddress</a> = VirtualAddress;
01437     HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o1">CallingAddress</a> = CallingAddress;
01438     HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o2">NumberOfBytes</a> = NumberOfBytes;
01439     HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o3">Tag</a> = Tag;
01440 
01441     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> ((HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a> &amp; MINLONG_PTR) != 0);
01442 
01443     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01444 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a103" doxytag="verifier.c::ViInsertVerifierEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ViInsertVerifierEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Verifier</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03360">3360</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l04193">MiSuspectDriverList</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00392">VerifierListLock</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>.
<p>
<pre class="fragment"><div>03366                    :
03367 
03368     Nonpagable wrapper to insert a <span class="keyword">new</span> verifier entry.
03369 
03370     Note that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system load mutant or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier load spinlock <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> sufficient
03371     <span class="keywordflow">for</span> readers to access <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> because <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> insertion <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>
03372     acquires both.
03373 
03374     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a> synchronization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed because <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocators walk <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03375     verifier list at <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.
03376 
03377 Arguments:
03378 
03379     Verifier - Supplies a caller-initialized entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver.
03380 
03381 Return Value:
03382 
03383     None.
03384 
03385 --*/
03386 
03387 {
03388     KIRQL OldIrql;
03389 
03390     ExAcquireSpinLock (&amp;VerifierListLock, &amp;OldIrql);
03391     InsertTailList (&amp;MiSuspectDriverList, &amp;Verifier-&gt;Links);
03392     ExReleaseSpinLock (&amp;VerifierListLock, OldIrql);
03393 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a105" doxytag="verifier.c::ViLocateVerifierEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> ViLocateVerifierEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SystemAddress</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">3396</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l04106">_MI_VERIFIER_DRIVER_ENTRY::EndAddress</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04193">MiSuspectDriverList</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04105">_MI_VERIFIER_DRIVER_ENTRY::StartAddress</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00392">VerifierListLock</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01812">VeAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00927">VerifierAllocatePool()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01003">VerifierAllocatePoolWithQuota()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01059">VerifierAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00965">VerifierAllocatePoolWithTag()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01115">VerifierAllocatePoolWithTagPriority()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.
<p>
<pre class="fragment"><div>03402                    :
03403 
03404     Locate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Driver Verifier entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified system address.
03405 
03406 Arguments:
03407 
03408     SystemAddress - Supplies a code or data address within a driver.
03409 
03410 Return Value:
03411 
03412     The Verifier entry corresponding to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver or <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
03413 
03414 Environment:
03415 
03416     The caller may be at <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a> and does not hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d8/mi_8h.html#a432">MmSystemLoadLock</a>.
03417 
03418 --*/
03419 
03420 {
03421     KIRQL OldIrql;
03422     PLIST_ENTRY NextEntry;
03423     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
03424 
03425     ExAcquireSpinLock (&amp;VerifierListLock, &amp;OldIrql);
03426 
03427     NextEntry = <a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>.Flink;
03428     <span class="keywordflow">while</span> (NextEntry != &amp;<a class="code" href="../../d4/d8/mi_8h.html#a555">MiSuspectDriverList</a>) {
03429 
03430         Verifier = CONTAINING_RECORD(NextEntry,
03431                                      <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">MI_VERIFIER_DRIVER_ENTRY</a>,
03432                                      Links);
03433 
03434         <span class="keywordflow">if</span> ((SystemAddress &gt;= Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o4">StartAddress</a>) &amp;&amp;
03435             (SystemAddress &lt; Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o5">EndAddress</a>)) {
03436 
03437             ExReleaseSpinLock (&amp;VerifierListLock, OldIrql);
03438             <span class="keywordflow">return</span> Verifier;
03439         }
03440         NextEntry = NextEntry-&gt;Flink;
03441     }
03442 
03443     ExReleaseSpinLock (&amp;VerifierListLock, OldIrql);
03444     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03445 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a104" doxytag="verifier.c::ViPostPoolAllocation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ViPostPoolAllocation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CallingAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">1614</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00050">BASE_POOL_TYPE_MASK</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00166">BYTE_OFFSET</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04122">_MI_VERIFIER_DRIVER_ENTRY::CurrentNonPagedPoolAllocations</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04121">_MI_VERIFIER_DRIVER_ENTRY::CurrentPagedPoolAllocations</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00263">EX_REAL_POOL_USAGE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/dumpuser_8c-source.html#l00048">Header</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00066">MI_SPECIAL_POOL_VERIFIER</a>, <a class="el" href="../../d4/d8/mi_8h.html#a550">MI_VERIFIER_POOL_HEADER</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01977">MmSpecialPoolEnd</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01976">MmSpecialPoolStart</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04127">_MI_VERIFIER_DRIVER_ENTRY::NonPagedBytes</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00190">PAGE_ALIGN</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04126">_MI_VERIFIER_DRIVER_ENTRY::PagedBytes</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04129">_MI_VERIFIER_DRIVER_ENTRY::PeakNonPagedBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04124">_MI_VERIFIER_DRIVER_ENTRY::PeakNonPagedPoolAllocations</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04128">_MI_VERIFIER_DRIVER_ENTRY::PeakPagedBytes</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04123">_MI_VERIFIER_DRIVER_ENTRY::PeakPagedPoolAllocations</a>, <a class="el" href="../../d4/d8/mi_8h.html#a551">PMI_VERIFIER_POOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00117">POOL_BUDDY_MAX</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00058">POOL_VERIFIER_MASK</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00173">_POOL_HEADER::Ulong1</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00390">VerifierIsTrackingPool</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00394">VerifierPoolLock</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04114">_MI_VERIFIER_DRIVER_ENTRY::VerifierPoolLock</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00396">VerifierPoolMutex</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01369">ViInsertPoolAllocation()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01812">VeAllocatePoolWithTagPriority()</a>.
<p>
<pre class="fragment"><div>01624                    :
01625 
01626     This function performs verifier book-keeping on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocation attempt.
01627 
01628 Arguments:
01629 
01630     VirtualAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address that should be allocated.
01631 
01632     NumberOfBytes - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to allocate.
01633 
01634     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> being allocated.
01635 
01636     Tag - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tag <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> being allocated.
01637 
01638     CallingAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's address.
01639 
01640 Return Value:
01641 
01642     The <span class="keyword">virtual</span> address <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller should use.
01643 
01644 Environment:
01645 
01646     Kernel mode.  <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a> or below.
01647 
01648 --*/
01649 
01650 {
01651     KIRQL OldIrql;
01652     <a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">PMI_VERIFIER_POOL_HEADER</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>;
01653     SIZE_T ChargedBytes;
01654     <a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a> Verifier;
01655     ULONG_PTR InsertedIndex;
01656     LOGICAL SpecialPoolAllocation;
01657     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> PoolHeader;
01658 
01659     InterlockedIncrement ((PLONG)&amp;<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsSucceeded);
01660     ChargedBytes = <a class="code" href="../../d4/d2/pool_8h.html#a23">EX_REAL_POOL_USAGE</a>(NumberOfBytes);
01661     SpecialPoolAllocation = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01662 
01663     <span class="keywordflow">if</span> (VirtualAddress &gt;= <a class="code" href="../../d2/d1/mm_8h.html#a160">MmSpecialPoolStart</a> &amp;&amp; VirtualAddress &lt; <a class="code" href="../../d2/d1/mm_8h.html#a161">MmSpecialPoolEnd</a>) {
01664         ChargedBytes = NumberOfBytes;
01665         InterlockedIncrement ((PLONG)&amp;<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsSucceededSpecialPool);
01666         SpecialPoolAllocation = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01667     }
01668     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NumberOfBytes &lt;= <a class="code" href="../../d5/d2/poolhack_8c.html#a7">POOL_BUDDY_MAX</a>) {
01669         ChargedBytes -= <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>;
01670     }
01671     <span class="keywordflow">else</span> {
01672 
01673         <span class="comment">//</span>
01674         <span class="comment">// This isn't exactly true but it does give the user a way to see</span>
01675         <span class="comment">// if this machine is large enough to support special pool 100%.</span>
01676         <span class="comment">//</span>
01677 
01678         InterlockedIncrement ((PLONG)&amp;<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.AllocationsSucceededSpecialPool);
01679     }
01680 
01681     <span class="keywordflow">if</span> ((PoolType &amp; <a class="code" href="../../d4/d2/pool_8h.html#a9">POOL_VERIFIER_MASK</a>) == 0) {
01682         <span class="keywordflow">return</span> VirtualAddress;
01683     }
01684 
01685     <span class="keywordflow">if</span> (NumberOfBytes &gt; <a class="code" href="../../d5/d2/poolhack_8c.html#a7">POOL_BUDDY_MAX</a>) {
01686         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d2/d1/mm_8h.html#a6">BYTE_OFFSET</a>(VirtualAddress) == 0);
01687     }
01688 
01689     Verifier = <a class="code" href="../../d9/d5/verifier_8c.html#a105">ViLocateVerifierEntry</a> (CallingAddress);
01690     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier != NULL);
01691     <a class="code" href="../../d9/d5/verifier_8c.html#a28">VerifierIsTrackingPool</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01692 
01693     <span class="keywordflow">if</span> (SpecialPoolAllocation == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01694 
01695         <span class="comment">//</span>
01696         <span class="comment">// Carefully adjust the special pool page to move the verifier tracking</span>
01697         <span class="comment">// header to the front.  This allows the allocation to remain butted</span>
01698         <span class="comment">// against the end of the page so overruns can be detected immediately.</span>
01699         <span class="comment">//</span>
01700 
01701         <span class="keywordflow">if</span> (((ULONG_PTR)VirtualAddress &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1))) {
01702             PoolHeader = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)(<a class="code" href="../../d2/d1/mm_8h.html#a7">PAGE_ALIGN</a> (VirtualAddress));
01703             <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> = (<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">PMI_VERIFIER_POOL_HEADER</a>) (PoolHeader + 1);
01704             VirtualAddress = (PVOID) ((PCHAR)VirtualAddress + <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">MI_VERIFIER_POOL_HEADER</a>));
01705         }
01706         <span class="keywordflow">else</span> {
01707             PoolHeader = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCHAR)<a class="code" href="../../d2/d1/mm_8h.html#a7">PAGE_ALIGN</a> (VirtualAddress) + <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01708             <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> = (<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">PMI_VERIFIER_POOL_HEADER</a>) (PoolHeader - 1);
01709         }
01710         <span class="comment">// ASSERT (PoolHeader-&gt;Ulong1 &amp; MI_SPECIAL_POOL_VERIFIER);</span>
01711         PoolHeader-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o7">Ulong1</a> -= <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">MI_VERIFIER_POOL_HEADER</a>);
01712         ChargedBytes -= <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">MI_VERIFIER_POOL_HEADER</a>);
01713         PoolHeader-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o7">Ulong1</a> |= <a class="code" href="../../d4/d8/mi_8h.html#a3">MI_SPECIAL_POOL_VERIFIER</a>;
01714     }
01715     <span class="keywordflow">else</span> {
01716         <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a> = (<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">PMI_VERIFIER_POOL_HEADER</a>)((PCHAR)VirtualAddress +
01717                          ChargedBytes -
01718                          <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/struct__MI__VERIFIER__POOL__HEADER.html">MI_VERIFIER_POOL_HEADER</a>));
01719     }
01720 
01721     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (((ULONG_PTR)Header &amp; (<span class="keyword">sizeof</span>(ULONG) - 1)) == 0);
01722 
01723 
01724     <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;Verifier = Verifier;
01725 
01726     <span class="comment">//</span>
01727     <span class="comment">// Enqueue the entry and update per-driver counters.</span>
01728     <span class="comment">// Note that paged pool allocations must be chained using nonpaged</span>
01729     <span class="comment">// pool to prevent deadlocks.</span>
01730     <span class="comment">//</span>
01731 
01732     ExAcquireSpinLock (&amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o9">VerifierPoolLock</a>, &amp;OldIrql);
01733 
01734     InsertedIndex = <a class="code" href="../../d9/d5/verifier_8c.html#a97">ViInsertPoolAllocation</a> (Verifier,
01735                                             VirtualAddress,
01736                                             CallingAddress,
01737                                             ChargedBytes,
01738                                             Tag);
01739 
01740     <span class="keywordflow">if</span> ((PoolType &amp; <a class="code" href="../../d4/d2/pool_8h.html#a5">BASE_POOL_TYPE_MASK</a>) == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>) {
01741 
01742         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a> += ChargedBytes;
01743         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a> &gt; Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o20">PeakPagedBytes</a>) {
01744             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o20">PeakPagedBytes</a> = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o18">PagedBytes</a>;
01745         }
01746 
01747         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a> += 1;
01748         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a> &gt; Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o16">PeakPagedPoolAllocations</a>) {
01749             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o16">PeakPagedPoolAllocations</a> = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o14">CurrentPagedPoolAllocations</a>;
01750         }
01751     }
01752     <span class="keywordflow">else</span> {
01753         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a> += ChargedBytes;
01754         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a> &gt; Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o21">PeakNonPagedBytes</a>) {
01755             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o21">PeakNonPagedBytes</a> = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o19">NonPagedBytes</a>;
01756         }
01757 
01758         Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a> += 1;
01759         <span class="keywordflow">if</span> (Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a> &gt; Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o17">PeakNonPagedPoolAllocations</a>) {
01760             Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o17">PeakNonPagedPoolAllocations</a> = Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o15">CurrentNonPagedPoolAllocations</a>;
01761         }
01762     }
01763 
01764     ExReleaseSpinLock (&amp;Verifier-&gt;<a class="code" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html#o9">VerifierPoolLock</a>, OldIrql);
01765 
01766     <span class="comment">//</span>
01767     <span class="comment">// Since the header for paged pool is paged, don't initialize it until the</span>
01768     <span class="comment">// spinlock above is released.</span>
01769     <span class="comment">//</span>
01770 
01771     <a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>-&gt;ListIndex = InsertedIndex;
01772 
01773     <span class="comment">//</span>
01774     <span class="comment">// Update systemwide counters.</span>
01775     <span class="comment">//</span>
01776 
01777     <span class="keywordflow">if</span> ((PoolType &amp; <a class="code" href="../../d4/d2/pool_8h.html#a5">BASE_POOL_TYPE_MASK</a>) == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>) {
01778         ExAcquireFastMutex (&amp;VerifierPoolMutex);
01779 
01780         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PagedBytes += ChargedBytes;
01781         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PagedBytes &gt; <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakPagedBytes) {
01782             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakPagedBytes = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PagedBytes;
01783         }
01784 
01785         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.CurrentPagedPoolAllocations += 1;
01786         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.CurrentPagedPoolAllocations &gt; <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakPagedPoolAllocations) {
01787             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakPagedPoolAllocations = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.CurrentPagedPoolAllocations;
01788         }
01789 
01790         ExReleaseFastMutex (&amp;VerifierPoolMutex);
01791     }
01792     <span class="keywordflow">else</span> {
01793         ExAcquireSpinLock (&amp;VerifierPoolLock, &amp;OldIrql);
01794 
01795         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.NonPagedBytes += ChargedBytes;
01796         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.NonPagedBytes &gt; <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakNonPagedBytes) {
01797             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakNonPagedBytes = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.NonPagedBytes;
01798         }
01799 
01800         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.CurrentNonPagedPoolAllocations += 1;
01801         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.CurrentNonPagedPoolAllocations &gt; <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakNonPagedPoolAllocations) {
01802             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.PeakNonPagedPoolAllocations = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.CurrentNonPagedPoolAllocations;
01803         }
01804 
01805         ExReleaseSpinLock (&amp;VerifierPoolLock, OldIrql);
01806     }
01807 
01808     <span class="keywordflow">return</span> VirtualAddress;
01809 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a92" doxytag="verifier.c::ViPrintString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ViPrintString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DriverName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04336">4336</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d0/d5/verifier_8c-source.html#l04326">_VERIFIER_STRING_INFO::BuildNumber</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04329">_VERIFIER_STRING_INFO::Check</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04327">_VERIFIER_STRING_INFO::DriverVerifierLevel</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04328">_VERIFIER_STRING_INFO::Flags</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, <a class="el" href="../../d6/d4/triage_8c-source.html#l00042">NtBuildNumber</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04332">Printable</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04333">PrintableChars</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01178">RtlUpcaseUnicodeChar()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>.
<p>
<pre class="fragment"><div>04342                    :
04343 
04344     This routine does a really bad hash of build number, verifier level and
04345     flags by <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver name as a stream of bytes to XOR into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> flags,
04346     etc.
04347 
04348     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a Neill Clift special.
04349 
04350 Arguments:
04351 
04352     DriverName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> driver.
04353 
04354 Return Value:
04355 
04356     None.
04357 
04358 --*/
04359 
04360 {
04361     <a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">VERIFIER_STRING_INFO</a> Bld;
04362     PUCHAR BufPtr;
04363     PWCHAR DriverPtr;
04364     ULONG BufLen;
04365     ULONG i;
04366     ULONG j;
04367     ULONG DriverChars;
04368     ULONG MaxChars;
04369     WCHAR OutBuf[<span class="keyword">sizeof</span> (<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">VERIFIER_STRING_INFO</a>) * 2 + 1];
04370     UNICODE_STRING OutBufU;
04371     ULONG Rem;
04372     ULONG LastRem;
04373     LOGICAL Done;
04374 
04375     Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o0">BuildNumber</a> = <a class="code" href="../../d5/d5/triage_8c.html#a0">NtBuildNumber</a>;
04376     Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o1">DriverVerifierLevel</a> = <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Level;
04377 
04378     <span class="comment">//</span>
04379     <span class="comment">// Unloads and other actions could be encoded in the Flags field here.</span>
04380     <span class="comment">//</span>
04381 
04382     Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o2">Flags</a> = 0;
04383 
04384     <span class="comment">//</span>
04385     <span class="comment">// Make the last ULONG a weird function of the others.</span>
04386     <span class="comment">//</span>
04387 
04388     Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o3">Check</a> = ((Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o2">Flags</a> + 1) * Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o0">BuildNumber</a> * (Bld.<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html#o1">DriverVerifierLevel</a> + 1)) * 123456789;
04389 
04390     BufPtr = (PUCHAR) &amp;Bld;
04391     BufLen = <span class="keyword">sizeof</span> (Bld);
04392 
04393     DriverChars = DriverName-&gt;Length / <span class="keyword">sizeof</span> (DriverName-&gt;Buffer[0]);
04394     DriverPtr = DriverName-&gt;Buffer;
04395     MaxChars = DriverChars;
04396 
04397     <span class="keywordflow">if</span> (DriverChars &lt; <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">VERIFIER_STRING_INFO</a>)) {
04398         MaxChars = <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">VERIFIER_STRING_INFO</a>);
04399     }
04400 
04401     <span class="comment">//</span>
04402     <span class="comment">// Xor each character in the driver name into the buffer.</span>
04403     <span class="comment">//</span>
04404 
04405     <span class="keywordflow">for</span> (i = 0; i &lt; MaxChars; i += 1) {
04406         BufPtr[i % BufLen] ^= (UCHAR) <a class="code" href="../../d6/d6/nls_8c.html#a33">RtlUpcaseUnicodeChar</a>(DriverPtr[i % DriverChars]);
04407     }
04408 
04409     <span class="comment">//</span>
04410     <span class="comment">// Produce a base N decoding of the binary buffer using the printable</span>
04411     <span class="comment">// characters defines. Treat the binary as a byte array and do the</span>
04412     <span class="comment">// division for each, tracking the carry.</span>
04413     <span class="comment">//</span>
04414 
04415     j = 0;
04416     <span class="keywordflow">do</span> {
04417         Done = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04418 
04419         <span class="keywordflow">for</span> (i = 0, LastRem = 0; i &lt; <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d6/struct__VERIFIER__STRING__INFO.html">VERIFIER_STRING_INFO</a>); i += 1) {
04420             Rem = BufPtr[i] + 256 * LastRem;
04421             BufPtr[i] = (UCHAR) (Rem / <a class="code" href="../../d9/d5/verifier_8c.html#a52">PrintableChars</a>);
04422             LastRem = Rem % <a class="code" href="../../d9/d5/verifier_8c.html#a52">PrintableChars</a>;
04423             <span class="keywordflow">if</span> (BufPtr[i]) {
04424                 Done = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04425             }
04426         }
04427         OutBuf[j++] = <a class="code" href="../../d9/d5/verifier_8c.html#a51">Printable</a>[LastRem];
04428 
04429         <span class="keywordflow">if</span> (j &gt;= <span class="keyword">sizeof</span> (OutBuf) / <span class="keyword">sizeof</span> (OutBuf[0])) {
04430 
04431             <span class="comment">//</span>
04432             <span class="comment">// The stack buffer isn't big enough.</span>
04433             <span class="comment">//</span>
04434 
04435             <span class="keywordflow">return</span>;
04436         }
04437 
04438     } <span class="keywordflow">while</span> (Done == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
04439 
04440     OutBuf[j] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
04441 
04442     OutBufU.Length = OutBufU.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) j * <span class="keyword">sizeof</span> (WCHAR);
04443     OutBufU.Buffer = OutBuf;
04444 
04445     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*******************************************************************************\n"</span>);
04446     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*                                                                             *\n"</span>);
04447 
04448     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* This is the string to paste into your build mail\n"</span>);
04449 
04450     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"* Driver Verifier: Enabled for %Z on Build %ld %wZ\n"</span>,
04451               DriverName, NtBuildNumber &amp; 0xFFFFFFF, &amp;OutBufU);
04452 
04453     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*                                                                             *\n"</span>);
04454     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"*******************************************************************************\n"</span>);
04455 
04456     <span class="keywordflow">return</span>;
04457 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a99" doxytag="verifier.c::ViReleasePoolAllocation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ViReleasePoolAllocation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Verifier</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ListIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>ChargedBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01447">1447</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04093">_VI_POOL_ENTRY::FreeListNext</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04092">_VI_POOL_ENTRY::InUse</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l02287">MI_CONVERT_PHYSICAL_TO_PFN</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l02410">MI_GET_PAGE_FRAME_FROM_PTE</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l02262">MI_IS_PHYSICAL_ADDRESS</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l01671">MiGetPteAddress</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04086">_VI_POOL_ENTRY_INUSE::NumberOfBytes</a>, <a class="el" href="../../d2/d4/struct__MMPTE.html#o8">_MMPTE::u</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l04084">_VI_POOL_ENTRY_INUSE::VirtualAddress</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>.
<p>
<pre class="fragment"><div>01456                    :
01457 
01458     This function removes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <span class="keyword">virtual</span> address from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier
01459     list <span class="keywordflow">for</span> <span class="keyword">this</span> driver.
01460 
01461 Arguments:
01462 
01463     Verifier - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier entry to update.
01464 
01465     VirtualAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to release.
01466 
01467     ListIndex - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> verifier <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> hash index <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address being
01468                 released.
01469 
01470     ChargedBytes - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bytes charged <span class="keywordflow">for</span> <span class="keyword">this</span> allocation.
01471 
01472 Return Value:
01473 
01474     None.
01475 
01476 Environment:
01477 
01478     Kernel mode, <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>.  The Verifier-&gt;VerifierPoolLock must be held.
01479 
01480 --*/
01481 
01482 {
01483     PFN_NUMBER PageFrameIndex;
01484     PFN_NUMBER PageFrameIndex2;
01485     <a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a> HashEntry;
01486     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;
01487 
01488     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (KeGetCurrentIrql() == DISPATCH_LEVEL);
01489 
01490     <span class="keywordflow">if</span> (Verifier-&gt;PoolHash == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01491         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
01492                       0x59,
01493                       (ULONG_PTR)VirtualAddress,
01494                       ListIndex,
01495                       (ULONG_PTR)Verifier);
01496     }
01497 
01498     <span class="comment">//</span>
01499     <span class="comment">// Ensure that the list pointer has not been overrun and still</span>
01500     <span class="comment">// points at something decent.</span>
01501     <span class="comment">//</span>
01502 
01503     HashEntry = Verifier-&gt;PoolHash + ListIndex;
01504 
01505     <span class="keywordflow">if</span> (ListIndex &gt;= Verifier-&gt;PoolHashSize) {
01506         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
01507                       0x54,
01508                       (ULONG_PTR)VirtualAddress,
01509                       Verifier-&gt;PoolHashSize,
01510                       ListIndex);
01511     }
01512 
01513     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o0">VirtualAddress</a> != VirtualAddress) {
01514 
01515         PageFrameIndex = 0;
01516         PageFrameIndex2 = 1;
01517 
01518         <span class="keywordflow">if</span> ((!<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a178">MI_IS_PHYSICAL_ADDRESS</a>(VirtualAddress)) &amp;&amp;
01519             (<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a178">MI_IS_PHYSICAL_ADDRESS</a>(HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o0">VirtualAddress</a>))) {
01520 
01521             PointerPte = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a153">MiGetPteAddress</a>(VirtualAddress);
01522             <span class="keywordflow">if</span> (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.Valid == 1) {
01523                 PageFrameIndex = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a182">MI_GET_PAGE_FRAME_FROM_PTE</a> (PointerPte);
01524 
01525                 PageFrameIndex2 = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a179">MI_CONVERT_PHYSICAL_TO_PFN</a> (HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o0">VirtualAddress</a>);
01526             }
01527         }
01528 
01529         <span class="comment">//</span>
01530         <span class="comment">// Caller overran and corrupted the virtual address - the linked</span>
01531         <span class="comment">// list cannot be counted on either.</span>
01532         <span class="comment">//</span>
01533 
01534         <span class="keywordflow">if</span> (PageFrameIndex != PageFrameIndex2) {
01535             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
01536                           0x52,
01537                           (ULONG_PTR)VirtualAddress,
01538                           (ULONG_PTR)HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o0">VirtualAddress</a>,
01539                           ChargedBytes);
01540         }
01541     }
01542 
01543     <span class="keywordflow">if</span> (HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o0">InUse</a>.<a class="code" href="../../d9/d6/struct__VI__POOL__ENTRY__INUSE.html#o2">NumberOfBytes</a> != ChargedBytes) {
01544 
01545         <span class="comment">//</span>
01546         <span class="comment">// Caller overran and corrupted the byte count - the linked</span>
01547         <span class="comment">// list cannot be counted on either.</span>
01548         <span class="comment">//</span>
01549 
01550         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (DRIVER_VERIFIER_DETECTED_VIOLATION,
01551                       0x51,
01552                       (ULONG_PTR)VirtualAddress,
01553                       (ULONG_PTR)HashEntry,
01554                       ChargedBytes);
01555     }
01556 
01557     <span class="comment">//</span>
01558     <span class="comment">// Put this list entry into the freelist.</span>
01559     <span class="comment">//</span>
01560 
01561     HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a> = Verifier-&gt;PoolHashFree;
01562     Verifier-&gt;PoolHashFree = HashEntry - Verifier-&gt;PoolHash;
01563 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a96" doxytag="verifier.c::ViReservePoolAllocation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL ViReservePoolAllocation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d9/struct__MI__VERIFIER__DRIVER__ENTRY.html">PMI_VERIFIER_DRIVER_ENTRY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Verifier</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l01233">1233</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00993">ExAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l04093">_VI_POOL_ENTRY::FreeListNext</a>, <a class="el" href="../../d5/d8/ex_8h.html#a330a194">HighPoolPriority</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00060">POOL_DRIVER_MASK</a>, <a class="el" href="../../d4/d8/mi_8h.html#a547">PVI_POOL_ENTRY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a2">VI_POOL_ENTRIES_PER_PAGE</a>, and <a class="el" href="../../d4/d8/mi_8h.html#a546">VI_POOL_ENTRY</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01812">VeAllocatePoolWithTagPriority()</a>.
<p>
<pre class="fragment"><div>01236 {
01237     ULONG_PTR OldSize;
01238     ULONG_PTR NewSize;
01239     ULONG_PTR NewHashOffset;
01240     ULONG_PTR <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
01241     ULONG_PTR Entries;
01242     ULONG_PTR i;
01243     KIRQL OldIrql;
01244     PVOID NewHashTable;
01245     <a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a> HashEntry;
01246     <a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a> OldHashTable;
01247 
01248     ExAcquireSpinLock (&amp;Verifier-&gt;VerifierPoolLock, &amp;OldIrql);
01249 
01250     <span class="keywordflow">while</span> (Verifier-&gt;PoolHashSize &lt;= Verifier-&gt;CurrentPagedPoolAllocations + Verifier-&gt;CurrentNonPagedPoolAllocations + Verifier-&gt;PoolHashReserved) {
01251 
01252         <span class="comment">//</span>
01253         <span class="comment">// More space is needed.  Try for it now.</span>
01254         <span class="comment">//</span>
01255 
01256 <span class="preprocessor">#define VI_POOL_ENTRIES_PER_PAGE (PAGE_SIZE / sizeof(VI_POOL_ENTRY))</span>
01257 <span class="preprocessor"></span>
01258         OldSize = Verifier-&gt;PoolHashSize * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">VI_POOL_ENTRY</a>);
01259 
01260         <span class="keywordflow">if</span> (Verifier-&gt;PoolHashSize &gt;= <a class="code" href="../../d9/d5/verifier_8c.html#a2">VI_POOL_ENTRIES_PER_PAGE</a>) {
01261             <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
01262         }
01263         <span class="keywordflow">else</span> {
01264             <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> = 16 * <span class="keyword">sizeof</span> (<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">VI_POOL_ENTRY</a>);
01265         }
01266 
01267         ExReleaseSpinLock (&amp;Verifier-&gt;VerifierPoolLock, OldIrql);
01268 
01269         NewSize = OldSize + <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
01270 
01271         <span class="keywordflow">if</span> (NewSize &lt; OldSize) {
01272             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01273         }
01274 
01275         <span class="comment">//</span>
01276         <span class="comment">// Note POOL_DRIVER_MASK must be set to stop the recursion loop</span>
01277         <span class="comment">// when using the kernel verifier.</span>
01278         <span class="comment">//</span>
01279 
01280         NewHashTable = <a class="code" href="../../d5/d8/ex_8h.html#a222">ExAllocatePoolWithTagPriority</a> (NonPagedPool | POOL_DRIVER_MASK,
01281                                                       NewSize,
01282                                                       'ppeV',
01283                                                       HighPoolPriority);
01284 
01285         ExAcquireSpinLock (&amp;Verifier-&gt;VerifierPoolLock, &amp;OldIrql);
01286 
01287         OldSize = Verifier-&gt;PoolHashSize * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">VI_POOL_ENTRY</a>);
01288 
01289         <span class="keywordflow">if</span> (NewHashTable == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01290             <span class="keywordflow">if</span> (Verifier-&gt;PoolHashSize &lt;= Verifier-&gt;CurrentPagedPoolAllocations + Verifier-&gt;CurrentNonPagedPoolAllocations + Verifier-&gt;PoolHashReserved) {
01291                 ExReleaseSpinLock (&amp;Verifier-&gt;VerifierPoolLock, OldIrql);
01292                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01293             }
01294 
01295             <span class="comment">//</span>
01296             <span class="comment">// Another thread got here before us and space is available.</span>
01297             <span class="comment">//</span>
01298 
01299             <span class="keywordflow">break</span>;
01300         }
01301 
01302         <span class="keywordflow">if</span> (NewSize != OldSize + <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>) {
01303 
01304             <span class="comment">//</span>
01305             <span class="comment">// Another thread got here before us.</span>
01306             <span class="comment">//</span>
01307 
01308             ExReleaseSpinLock (&amp;Verifier-&gt;VerifierPoolLock, OldIrql);
01309             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (NewHashTable);
01310             ExAcquireSpinLock (&amp;Verifier-&gt;VerifierPoolLock, &amp;OldIrql);
01311         }
01312         <span class="keywordflow">else</span> {
01313 
01314             <span class="comment">//</span>
01315             <span class="comment">// Rebuild the list into the new table.</span>
01316             <span class="comment">//</span>
01317 
01318             OldHashTable = Verifier-&gt;PoolHash;
01319             <span class="keywordflow">if</span> (OldHashTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01320                 RtlCopyMemory (NewHashTable, OldHashTable, OldSize);
01321             }
01322 
01323             <span class="comment">//</span>
01324             <span class="comment">// Construct the freelist chaining it through any existing</span>
01325             <span class="comment">// list (any free entries must be already reserved).</span>
01326             <span class="comment">//</span>
01327 
01328             HashEntry = (<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a>) ((PCHAR)NewHashTable + OldSize);
01329             Entries = <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> / <span class="keyword">sizeof</span> (<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">VI_POOL_ENTRY</a>);
01330             NewHashOffset = HashEntry - (<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html">PVI_POOL_ENTRY</a>)NewHashTable;
01331 
01332             <span class="comment">//</span>
01333             <span class="comment">// If list compaction becomes important then chaining it on the</span>
01334             <span class="comment">// end here will need to be revisited.</span>
01335             <span class="comment">//</span>
01336 
01337             <span class="keywordflow">for</span> (i = 0; i &lt; Entries; i += 1) {
01338                 HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a> = NewHashOffset + i + 1;
01339                 HashEntry += 1;
01340             }
01341             HashEntry -= 1;
01342             HashEntry-&gt;<a class="code" href="../../d7/d6/struct__VI__POOL__ENTRY.html#o1">FreeListNext</a> = Verifier-&gt;PoolHashFree;
01343             Verifier-&gt;PoolHashFree = NewHashOffset;
01344             Verifier-&gt;PoolHash = NewHashTable;
01345             Verifier-&gt;PoolHashSize += Entries;
01346 
01347             <span class="comment">//</span>
01348             <span class="comment">// Free the old table.</span>
01349             <span class="comment">//</span>
01350 
01351             <span class="keywordflow">if</span> (OldHashTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01352                 ExReleaseSpinLock (&amp;Verifier-&gt;VerifierPoolLock, OldIrql);
01353                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (OldHashTable);
01354                 ExAcquireSpinLock (&amp;Verifier-&gt;VerifierPoolLock, &amp;OldIrql);
01355             }
01356         }
01357     }
01358 
01359     Verifier-&gt;PoolHashReserved += 1;
01360 
01361     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Verifier-&gt;PoolHashSize &gt;= Verifier-&gt;CurrentPagedPoolAllocations + Verifier-&gt;CurrentNonPagedPoolAllocations + Verifier-&gt;PoolHashReserved);
01362 
01363     ExReleaseSpinLock (&amp;Verifier-&gt;VerifierPoolLock, OldIrql);
01364 
01365     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01366 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a94" doxytag="verifier.c::ViTrimAllSystemPagableMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ViTrimAllSystemPagableMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02333">2333</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00182">KeQueryTickCount()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00987">KernelVerifier</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00406">KernelVerifierTickPage</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00380">MiNoPageOnRaiseIrql</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l02986">MmTrimAllSystemPagableMemory()</a>, <a class="el" href="../../d0/d5/4_2kddata_8c-source.html#l00097">MmVerifierData</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02365">VerifierKeAcquireSpinLock()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02934">VerifierKeRaiseIrql()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02993">VerifierSynchronizeExecution()</a>.
<p>
<pre class="fragment"><div>02336 {
02337     LARGE_INTEGER CurrentTime;
02338     LOGICAL PageOut;
02339 
02340     PageOut = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02341     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/ex_2pool_8c.html#a61">KernelVerifier</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02342         <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a4">KeQueryTickCount</a>(&amp;CurrentTime);
02343         <span class="keywordflow">if</span> ((CurrentTime.LowPart &amp; <a class="code" href="../../d9/d5/verifier_8c.html#a36">KernelVerifierTickPage</a>) != 0) {
02344             PageOut = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02345         }
02346     }
02347 
02348     <span class="keywordflow">if</span> ((PageOut == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) &amp;&amp; (<a class="code" href="../../d9/d5/verifier_8c.html#a23">MiNoPageOnRaiseIrql</a> == 0)) {
02349         <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.TrimRequests += 1;
02350         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d0/wsmanage_8c.html#a48">MmTrimAllSystemPagableMemory</a> (FALSE) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02351             <a class="code" href="../../d9/d5/4_2kddata_8c.html#a51">MmVerifierData</a>.Trims += 1;
02352         }
02353     }
02354 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a35" doxytag="verifier.c::KernelVerifier" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL <a class="el" href="../../d9/d5/verifier_8c.html#a35">KernelVerifier</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00404">404</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="verifier.c::KernelVerifierTickPage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a36">KernelVerifierTickPage</a> = 0x7          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00406">406</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02333">ViTrimAllSystemPagableMemory()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="verifier.c::MiActiveVerifierThunks" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a22">MiActiveVerifierThunks</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00378">378</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03982">MiVerifierCheckThunks()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03846">MmAddVerifierThunks()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="verifier.c::MiActiveVerifies" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a21">MiActiveVerifies</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00376">376</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="verifier.c::MiNoPageOnRaiseIrql" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a23">MiNoPageOnRaiseIrql</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00380">380</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02333">ViTrimAllSystemPagableMemory()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="verifier.c::MiSuspectDriverList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d5/verifier_8c.html#a18">MiSuspectDriverList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00370">370</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04046">MmGetVerifierInformation()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03360">ViInsertVerifierEntry()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="verifier.c::MiVerifierDriverAddedThunkListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d5/verifier_8c.html#a33">MiVerifierDriverAddedThunkListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00400">400</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03982">MiVerifierCheckThunks()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03846">MmAddVerifierThunks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="verifier.c::MiVerifierStackProtectTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a24">MiVerifierStackProtectTime</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00382">382</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="verifier.c::MiVerifierThunks" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d6/struct__VERIFIER__THUNKS.html">VERIFIER_THUNKS</a> <a class="el" href="../../d9/d5/verifier_8c.html#a53">MiVerifierThunks</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04516">4516</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04712">MiEnableVerifier()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="verifier.c::MiVerifyAllDrivers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL <a class="el" href="../../d9/d5/verifier_8c.html#a19">MiVerifyAllDrivers</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00372">372</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="verifier.c::MiVerifyRandomDrivers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d5/verifier_8c.html#a20">MiVerifyRandomDrivers</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00374">374</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03448">MiApplyDriverVerifier()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="verifier.c::MmDontVerifyRandomDrivers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL <a class="el" href="../../d9/d5/verifier_8c.html#a25">MmDontVerifyRandomDrivers</a> = TRUE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00384">384</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="verifier.c::MmSpecialPoolCatchOverruns" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL <a class="el" href="../../d9/d5/verifier_8c.html#a34">MmSpecialPoolCatchOverruns</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00402">402</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="verifier.c::MmVerifierData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d9/struct__MM__DRIVER__VERIFIER__DATA.html">MM_DRIVER_VERIFIER_DATA</a> <a class="el" href="../../d9/d5/verifier_8c.html#a15">MmVerifierData</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00361">361</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="verifier.c::Printable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d5/verifier_8c.html#a51">Printable</a>[] = L"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04332">4332</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04336">ViPrintString()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="verifier.c::PrintableChars" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a52">PrintableChars</a> = sizeof (<a class="el" href="../../d9/d5/verifier_8c.html#a51">Printable</a>) / sizeof (<a class="el" href="../../d9/d5/verifier_8c.html#a51">Printable</a>[0]) - 1<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l04333">4333</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04336">ViPrintString()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="verifier.c::VerifierIrqlData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int <a class="el" href="../../d9/d5/verifier_8c.html#a43">VerifierIrqlData</a>[0x10]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l02230">2230</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l02283">KfSanityCheckLowerIrql()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l02233">KfSanityCheckRaiseIrql()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="verifier.c::VerifierIsTrackingPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL <a class="el" href="../../d9/d5/verifier_8c.html#a28">VerifierIsTrackingPool</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00390">390</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="verifier.c::VerifierLargePagedPoolMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PRTL_BITMAP <a class="el" href="../../d9/d5/verifier_8c.html#a32">VerifierLargePagedPoolMap</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00398">398</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02184">MiBuildPagedPool()</a>, and <a class="el" href="../../d2/d5/allocpag_8c-source.html#l01778">MiFreePoolPages()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="verifier.c::VerifierListLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d9/d5/verifier_8c.html#a29">VerifierListLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00392">392</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03047">ViInitializeEntry()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03360">ViInsertVerifierEntry()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03396">ViLocateVerifierEntry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="verifier.c::VerifierModifyableOptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a16">VerifierModifyableOptions</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00367">367</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l04226">MmSetVerifierInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="verifier.c::VerifierOptionChanges" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/verifier_8c.html#a17">VerifierOptionChanges</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00368">368</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l04226">MmSetVerifierInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="verifier.c::VerifierPoolLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d9/d5/verifier_8c.html#a30">VerifierPoolLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00394">394</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="verifier.c::VerifierPoolMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="el" href="../../d9/d5/verifier_8c.html#a31">VerifierPoolMutex</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00396">396</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="verifier.c::VerifierRequiredTimeSinceBoot" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d9/d5/verifier_8c.html#a27">VerifierRequiredTimeSinceBoot</a> = {(ULONG)(40 * 1000 * 1000 * 10), 1}          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00388">388</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="verifier.c::VerifierSystemSufficientlyBooted" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL <a class="el" href="../../d9/d5/verifier_8c.html#a26">VerifierSystemSufficientlyBooted</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00386">386</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l01168">ViInjectResourceFailure()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="verifier.c::ViBadDriver" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PUNICODE_STRING <a class="el" href="../../d9/d5/verifier_8c.html#a48">ViBadDriver</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l03622">3622</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="verifier.c::ViBadMapperLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d9/d5/verifier_8c.html#a41">ViBadMapperLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00628">628</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l03121">MiInitializeDriverVerifierList()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00632">ViAddBadMapper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="verifier.c::ViBadMappers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d9/d5/verifier_8c.html#a42">ViBadMappers</a>[VI_BAD_MAPPERS_MAX]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/verifier_8c-source.html#l00629">629</a> of file <a class="el" href="../../d0/d5/verifier_8c-source.html">verifier.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/verifier_8c-source.html#l00632">ViAddBadMapper()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:08 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
