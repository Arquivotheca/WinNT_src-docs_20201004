<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: alpha/debugsup.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>debugsup.c File Reference</h1><code>#include "<a class="el" href="../../d5/d7/mi_8h-source.html">mi.h</a>"</code><br>

<p>
<a href="../../d0/d5/alpha_2debugsup_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/alpha_2debugsup_8c.html#a0">MmDbgReadCheck</a> (IN PVOID VirtualAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/alpha_2debugsup_8c.html#a1">MmDbgWriteCheck</a> (IN PVOID VirtualAddress, IN PHARDWARE_PTE Opaque)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/alpha_2debugsup_8c.html#a2">MmDbgReleaseAddress</a> (IN PVOID VirtualAddress, IN PHARDWARE_PTE Opaque)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID64&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/alpha_2debugsup_8c.html#a3">MmDbgReadCheck64</a> (IN PVOID64 VirtualAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID64&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/alpha_2debugsup_8c.html#a4">MmDbgWriteCheck64</a> (IN PVOID64 VirtualAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID64&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/alpha_2debugsup_8c.html#a5">MmDbgTranslatePhysicalAddress64</a> (IN PHYSICAL_ADDRESS PhysicalAddress)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="alpha/debugsup.c::MmDbgReadCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID MmDbgReadCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VirtualAddress</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00027">27</a> of file <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html">alpha/debugsup.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00591">KSEG0_BASE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00593">KSEG2_BASE</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03883">MmIsAddressValid()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00033                    :
00034 
00035 
00036     ALPHA implementation specific:
00037 
00038     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid (mapped)
00039     for read access.
00040 
00041 Arguments:
00042 
00043     VirtualAddress - Supplies the virtual address to check.
00044 
00045 Return Value:
00046 
00047     Returns NULL if the address is not valid or readable, otherwise
00048     returns the virtual address.
00049 
00050 Environment:
00051 
00052     Kernel mode IRQL at DISPATCH_LEVEL or greater.
00053 
00054 --*/
00055 
00056 {
00057     <span class="keywordflow">if</span> ((VirtualAddress &gt;= (PVOID)<a class="code" href="../../d6/d7/halmips_8h.html#a443">KSEG0_BASE</a>) &amp;&amp;
00058         (VirtualAddress &lt; (PVOID)<a class="code" href="../../d6/d7/halmips_8h.html#a445">KSEG2_BASE</a>)) {
00059         <span class="keywordflow">return</span> VirtualAddress;
00060     }
00061 
00062     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d2/pagfault_8c.html#a26">MmIsAddressValid</a> (VirtualAddress)) {
00063         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00064     }
00065 
00066     <span class="keywordflow">return</span> VirtualAddress;
00067 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="alpha/debugsup.c::MmDbgReadCheck64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID64 MmDbgReadCheck64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID64&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VirtualAddress</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00246">246</a> of file <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html">alpha/debugsup.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00252                    :
00253 
00254 
00255     ALPHA implementation specific:
00256 
00257     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid (mapped)
00258     for read access.
00259 
00260     If the address is valid and readable then the called address is returned.
00261 
00262 Arguments:
00263 
00264     VirtualAddress - Supplies the virtual address to check.
00265 
00266 Return Value:
00267 
00268     Returns NULL if the address is not valid or readable, otherwise
00269     returns the virtual address.
00270 
00271 Environment:
00272 
00273     Kernel mode IRQL at DISPATCH_LEVEL or greater.
00274 
00275 --*/
00276 
00277 {
00278 <span class="preprocessor">#ifdef VLM_SUPPORT</span>
00279 <span class="preprocessor"></span>
00280     <span class="keywordflow">if</span> (!MmIsAddressValid64 (VirtualAddress)) {
00281         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00282     }
00283 
00284     <span class="keywordflow">return</span> VirtualAddress;
00285 <span class="preprocessor">#else</span>
00286 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00287 <span class="preprocessor">#endif</span>
00288 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="alpha/debugsup.c::MmDbgReleaseAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MmDbgReleaseAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>Opaque</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00182">182</a> of file <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html">alpha/debugsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l01671">MiGetPteAddress</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03883">MmIsAddressValid()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d4/struct__MMPTE.html#o8">_MMPTE::u</a>.
<p>
<pre class="fragment"><div>00189                    :
00190 
00191     i386/486 implementation specific:
00192 
00193     This routine resets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <span class="keyword">virtual</span> address access permissions
00194     to its original state.
00195 
00196 Arguments:
00197 
00198     VirtualAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to check.
00199 
00200     Opaque - Supplies an opaque pointer.
00201 
00202 Return Value:
00203 
00204     None.
00205 
00206 Environment:
00207 
00208     Kernel mode IRQL at <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a> or greater.
00209 
00210 --*/
00211 
00212 {
00213     <a class="code" href="../../d2/d4/struct__MMPTE.html">MMPTE</a> TempPte;
00214     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;
00215     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> InputPte;
00216 
00217     InputPte = (<a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a>)Opaque;
00218 
00219     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (MmIsAddressValid (VirtualAddress));
00220 
00221     <span class="keywordflow">if</span> (InputPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Long != 0) {
00222 
00223         PointerPte = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a153">MiGetPteAddress</a> (VirtualAddress);
00224     
00225         TempPte = *InputPte;
00226         
00227         <span class="comment">// LWFIX: Need to make the write go out to memory but can't</span>
00228         <span class="comment">// make it dirty here ! TempPte.u.Hard.Dirty = MM_PTE_DIRTY;</span>
00229     
00230         *PointerPte = TempPte;
00231     
00232         <span class="comment">//</span>
00233         <span class="comment">// BUGBUG John Vert (jvert) 3/4/1999</span>
00234         <span class="comment">//   KeFillEntryTb is liable to IPI the other processors. This is</span>
00235         <span class="comment">//   definitely NOT what we want as the other processors are frozen</span>
00236         <span class="comment">//   in the debugger and we will deadlock if we try and IPI them.</span>
00237         <span class="comment">//   Just flush the current processor instead.</span>
00238         <span class="comment">//KeFillEntryTb ((PHARDWARE_PTE)PointerPte, VirtualAddress, TRUE);</span>
00239         <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(TRUE, VirtualAddress);
00240     }
00241 
00242     <span class="keywordflow">return</span>;
00243 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="alpha/debugsup.c::MmDbgTranslatePhysicalAddress64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID64 MmDbgTranslatePhysicalAddress64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PHYSICAL_ADDRESS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PhysicalAddress</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00342">342</a> of file <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html">alpha/debugsup.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l02778">KeProcessorLevel</a>.
<p>
<pre class="fragment"><div>00348                    :
00349 
00350     ALPHA implementation specific:
00351 
00352     The Alpha processor provides a direct-mapped address space called
00353     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> superpage.  The entire physical address space can be
00354     addressed via <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> superpage.  This routine translates a physical
00355     address to its corresponding superpage address.  Unfortunately,
00356     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base superpage address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> processor-dependent.  Therefore, we
00357     have to compute <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor level.  As <span class="keyword">new</span> processors are
00358     released, <span class="keyword">this</span> routine will need to be updated.
00359 
00360     This routine does not use PTEs.
00361 
00362 Arguments:
00363 
00364     PhysicalAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address to translate.
00365 
00366 Return Value:
00367 
00368     The <span class="keyword">virtual</span> (superpage) address which corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address.
00369 
00370 Environment:
00371 
00372     Kernel mode IRQL at <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a> or greater.
00373 
00374 --*/
00375 
00376 {
00377     <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a>) {
00378 
00379     <span class="keywordflow">case</span> PROCESSOR_ALPHA_21064:
00380     <span class="keywordflow">case</span> PROCESSOR_ALPHA_21066:
00381     <span class="keywordflow">case</span> PROCESSOR_ALPHA_21068:
00382         PhysicalAddress.QuadPart &amp;= 0x00000003ffffffff;
00383         PhysicalAddress.QuadPart |= 0xfffffc0000000000;
00384         <span class="keywordflow">break</span>;
00385 
00386     <span class="keywordflow">case</span> PROCESSOR_ALPHA_21164:
00387     <span class="keywordflow">case</span> PROCESSOR_ALPHA_21164PC:
00388         PhysicalAddress.QuadPart &amp;= 0x000000ffffffffff;
00389         PhysicalAddress.QuadPart |= 0xfffffc0000000000;
00390         <span class="keywordflow">break</span>;
00391 
00392     <span class="keywordflow">case</span> PROCESSOR_ALPHA_21264:
00393         PhysicalAddress.QuadPart &amp;= 0x00000fffffffffff;
00394         PhysicalAddress.QuadPart |= 0xffff800000000000;
00395         <span class="keywordflow">break</span>;
00396 
00397     <span class="keywordflow">default</span>:
00398         <span class="keywordflow">return</span> NULL64;
00399 
00400     }
00401 
00402     <span class="keywordflow">return</span> (PVOID64)PhysicalAddress.QuadPart;
00403 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="alpha/debugsup.c::MmDbgWriteCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID MmDbgWriteCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>Opaque</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00070">70</a> of file <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html">alpha/debugsup.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00591">KSEG0_BASE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00593">KSEG2_BASE</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l01671">MiGetPteAddress</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l00130">MM_PAGES_IN_KSEG0</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05490">MmGetPhysicalAddress()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03883">MmIsAddressValid()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d4/struct__MMPTE.html#o8">_MMPTE::u</a>.
<p>
<pre class="fragment"><div>00077                    :
00078 
00079     ALPHA implementation specific:
00080 
00081     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address <span class="keywordflow">for</span> a <span class="keyword">virtual</span> address
00082     which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid (mapped) for write access.
00083 
00084     If the address is valid and writable and not within KSEG0
00085     the physical address within KSEG0 is returned.  If the address
00086     is within KSEG0 then the called address is returned.
00087 
00088     NOTE: The physical address must only be used while the interrupt
00089     level on ALL processors is above DISPATCH_LEVEL, otherwise the
00090     binding between the virtual address and the physical address can
00091     change due to paging.
00092 
00093 Arguments:
00094 
00095     VirtualAddress - Supplies the virtual address to check.
00096 
00097     Opaque - Supplies a pointer to fill with an opaque value.
00098 
00099 Return Value:
00100 
00101     Returns NULL if the address is not valid or readable, otherwise
00102     returns the physical address of the corresponding virtual address.
00103 
00104 Environment:
00105 
00106     Kernel mode IRQL at DISPATCH_LEVEL or greater.
00107 
00108 --*/
00109 
00110 {
00111     <a class="code" href="../../d2/d4/struct__MMPTE.html">MMPTE</a> PteContents;
00112     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;
00113     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> InputPte;
00114 
00115     InputPte = (<a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a>)Opaque;
00116 
00117     InputPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Long = 0;
00118 
00119     <span class="keywordflow">if</span> ((VirtualAddress &gt;= (PVOID)<a class="code" href="../../d6/d7/halmips_8h.html#a443">KSEG0_BASE</a>) &amp;&amp;
00120         (VirtualAddress &lt; (PVOID)<a class="code" href="../../d6/d7/halmips_8h.html#a445">KSEG2_BASE</a>)) {
00121         <span class="keywordflow">return</span> VirtualAddress;
00122     }
00123 
00124     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d2/pagfault_8c.html#a26">MmIsAddressValid</a> (VirtualAddress)) {
00125         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00126     }
00127 
00128     PointerPte = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a153">MiGetPteAddress</a> (VirtualAddress);
00129     <span class="keywordflow">if</span> ((VirtualAddress &lt;= MM_HIGHEST_USER_ADDRESS) &amp;&amp;
00130          (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.PageFrameNumber &lt; <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a8">MM_PAGES_IN_KSEG0</a>)) {
00131 
00132         <span class="comment">//</span>
00133         <span class="comment">// User mode - return the physical address.  This prevents</span>
00134         <span class="comment">// copy on write faults for breakpoints on user-mode pages.</span>
00135         <span class="comment">// IGNORE write protection.</span>
00136         <span class="comment">//</span>
00137         <span class="comment">// N.B. - The physical address must be less than 1GB to allow this</span>
00138         <span class="comment">//        short-cut mapping.</span>
00139         <span class="comment">//</span>
00140         <span class="comment">// N.B. - Any non-breakpoint modifications can get lost when the page</span>
00141         <span class="comment">//        is paged out because the PTE is not marked modified when</span>
00142         <span class="comment">//        the access is made through this alternate mapping.</span>
00143         <span class="comment">//</span>
00144 
00145         <span class="keywordflow">return</span> (PVOID)
00146            ((ULONG)<a class="code" href="../../d5/d6/iosup_8c.html#a68">MmGetPhysicalAddress</a>(VirtualAddress).LowPart + <a class="code" href="../../d6/d7/halmips_8h.html#a443">KSEG0_BASE</a>);
00147     }
00148 
00149     <span class="keywordflow">if</span> (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.Write == 0) {
00150 
00151         <span class="comment">//</span>
00152         <span class="comment">// PTE is not writable, make it so.</span>
00153         <span class="comment">//</span>
00154 
00155         PteContents = *PointerPte;
00156     
00157         *InputPte = PteContents;
00158     
00159         <span class="comment">//</span>
00160         <span class="comment">// Modify the PTE to ensure write permissions.</span>
00161         <span class="comment">//</span>
00162     
00163         PteContents.<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.Write = 1;
00164 
00165         *PointerPte = PteContents;
00166     
00167         <span class="comment">//</span>
00168         <span class="comment">// BUGBUG John Vert (jvert) 3/4/1999</span>
00169         <span class="comment">//   KeFillEntryTb is liable to IPI the other processors. This is</span>
00170         <span class="comment">//   definitely NOT what we want as the other processors are frozen</span>
00171         <span class="comment">//   in the debugger and we will deadlock if we try and IPI them.</span>
00172         <span class="comment">//   Just flush the the current processor instead.</span>
00173         <span class="comment">//KeFillEntryTb ((PHARDWARE_PTE)PointerPte, VirtualAddress, TRUE);</span>
00174         <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(TRUE, VirtualAddress);
00175 
00176     }
00177 
00178     <span class="keywordflow">return</span> VirtualAddress;
00179 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="alpha/debugsup.c::MmDbgWriteCheck64" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID64 MmDbgWriteCheck64           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID64&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VirtualAddress</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00291">291</a> of file <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html">alpha/debugsup.c</a>.
<p>
References <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l01674">MiGetPteAddress64</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d4/struct__MMPTE.html#o8">_MMPTE::u</a>.
<p>
<pre class="fragment"><div>00297                    :
00298 
00299     ALPHA implementation specific:
00300 
00301     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address <span class="keywordflow">for</span> a <span class="keyword">virtual</span> address
00302     which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid (mapped) for write access.
00303 
00304     If the address is valid and writable then the called address is returned.
00305 
00306 Arguments:
00307 
00308     VirtualAddress - Supplies the virtual address to check.
00309 
00310 Return Value:
00311 
00312     Returns NULL if the address is not valid or readable, otherwise
00313     returns the virtual address.
00314 
00315 Environment:
00316 
00317     Kernel mode IRQL at DISPATCH_LEVEL or greater.
00318 
00319 --*/
00320 
00321 {
00322 <span class="preprocessor">#ifdef VLM_SUPPORT</span>
00323 <span class="preprocessor"></span>    <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;
00324 
00325     <span class="keywordflow">if</span> (!MmIsAddressValid64 (VirtualAddress)) {
00326         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00327     }
00328 
00329     PointerPte = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a154">MiGetPteAddress64</a> (VirtualAddress);
00330 
00331     <span class="keywordflow">if</span> (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.Write == 0) {
00332         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00333     }
00334 
00335     <span class="keywordflow">return</span> VirtualAddress;
00336 <span class="preprocessor">#else</span>
00337 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00338 <span class="preprocessor">#endif</span>
00339 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
