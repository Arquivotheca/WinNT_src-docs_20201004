<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: icm32.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>icm32.c</h1><a href="../../d8/d6/mscmm_2icm32_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*</span>
00002 <span class="comment">        File:           MsLinoCMM.c</span>
00003 <span class="comment"></span>
00004 <span class="comment">        Contains:</span>
00005 <span class="comment">                Interface to MS ICM</span>
00006 <span class="comment">        Written by:     U. J. Krabbenhoeft</span>
00007 <span class="comment"></span>
00008 <span class="comment">        Copyright:      © 1993-1997 by Heidelberger Druckmaschinen AG, all rights reserved.</span>
00009 <span class="comment"></span>
00010 <span class="comment">        Version:        </span>
00011 <span class="comment">*/</span>
00012 
00013 <span class="preprocessor">#include "Windef.h"</span>
00014 <span class="preprocessor">#include "WinGdi.h"</span>
00015 <span class="preprocessor">#include &lt;wtypes.h&gt;</span>
00016 <span class="preprocessor">#include &lt;winbase.h&gt;</span>
00017 <span class="preprocessor">#include &lt;WindowsX.h&gt;</span>
00018 <span class="preprocessor">#include "ICM.h"</span>
00019 
00020 <span class="preprocessor">#ifndef LHGeneralIncs_h</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include "General.h"</span>
00022 <span class="preprocessor">#endif</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#ifndef MSNewMemProfile_h</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "MemProf.h"</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
<a name="l00028"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a0">00028</a> <span class="preprocessor">#define CMM_WIN_VERSION         0</span>
<a name="l00029"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a1">00029</a> <span class="preprocessor"></span><span class="preprocessor">#define CMM_IDENT                       1</span>
<a name="l00030"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a2">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define CMM_DRIVER_LEVEL        2</span>
<a name="l00031"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a3">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define CMM_DLL_VERSION         3</span>
<a name="l00032"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a4">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define CMM_VERSION                     4</span>
<a name="l00033"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a5">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_LEVEL_1                     1</span>
00034 <span class="preprocessor"></span>
<a name="l00035"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">00035</a> <span class="keyword">typedef</span> HANDLE  <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>;
<a name="l00036"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a8">00036</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>  <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a8">LPDEVCHARACTER</a>;
<a name="l00037"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a9">00037</a> <span class="keyword">typedef</span> HANDLE *<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a9">LPHPROFILE</a>;
<a name="l00038"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a10">00038</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>  <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a10">LPARGBQUAD</a>;
<a name="l00039"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a11">00039</a> <span class="keyword">typedef</span> COLORREF <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> *<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a11">LPCOLORREF</a>;
00040 
00041 <span class="preprocessor">#ifdef _DEBUG</span>
00042 <span class="preprocessor"></span><span class="comment">//#define WRITE_PROFILE</span>
00043 <span class="preprocessor">#endif</span>
00044 <span class="preprocessor"></span><span class="comment">/* ______________________________________________________________________</span>
00045 <span class="comment">                        static section for holding the CW pointers</span>
00046 <span class="comment">   _____________________________________________________________________ */</span>
00047 
<a name="l00048"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">00048</a> <span class="keywordtype">long</span> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a>=0;
<a name="l00049"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">00049</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[1000] = {0};
00050 
<a name="l00051"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">00051</a> CRITICAL_SECTION <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>;         <span class="comment">/* for multithreaded dll */</span>
00052 
00053 <span class="comment">/* ______________________________________________________________________ */</span>
00054 
00055 <span class="comment">/* ______________________________________________________________________</span>
00056 <span class="comment"></span>
00057 <span class="comment">BOOL WINAPI DllMain (   HINSTANCE hinstDLL,</span>
00058 <span class="comment">                                                DWORD fdwReason,</span>
00059 <span class="comment">                                                LPVOID lpvReserved )</span>
00060 <span class="comment"></span>
00061 <span class="comment">        Abstract:</span>
00062 <span class="comment">                DLL Entrypoint</span>
00063 <span class="comment"></span>
00064 <span class="comment">        Params:</span>
00065 <span class="comment">                standard</span>
00066 <span class="comment"></span>
00067 <span class="comment">        Return:</span>
00068 <span class="comment">                TRUE</span>
00069 <span class="comment"></span>
00070 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00071"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a15">00071</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a15">DllMain</a> (   HINSTANCE hinstDLL,
00072                                                 DWORD fdwReason,
00073                                                 LPVOID lpvReserved )
00074 {
00075 <span class="keywordflow">switch</span> (fdwReason)
00076    {
00077    <span class="keywordflow">case</span> DLL_PROCESS_ATTACH:
00078       DisableThreadLibraryCalls(hinstDLL);
00079           InitializeCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
00080       <span class="keywordflow">break</span>;
00081    <span class="keywordflow">case</span> DLL_PROCESS_DETACH:
00082       DeleteCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
00083       <span class="keywordflow">break</span>;
00084    }
00085 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00086 }
00087 
<a name="l00088"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a6">00088</a> <span class="preprocessor">#define DllExport       __declspec( dllexport )</span>
00089 <span class="preprocessor"></span>
00090 <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a16">CMCreateMultiProfileTransform</a>(     LPHPROFILE      lpahProfiles,
00091                                                                                                         DWORD           nProfiles,
00092                                                                                                         DWORD           *aIntentArr,
00093                                                                                                         DWORD           nIntents,
00094                                                                                                         DWORD           dwFlags );
00095 <span class="keywordtype">long</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a17">FillProfileFromLog</a>(        LPLOGCOLORSPACEA        lpColorSpace,
00096                                                         PPROFILE                        theProf );
00097 <span class="keywordtype">long</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a18">FillProfileFromLogW</a>(       LPLOGCOLORSPACEW        lpColorSpace,
00098                                                         PPROFILE                        theProf );
00099 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a19">CMCreateProfile</a>(   LPLOGCOLORSPACEA        lpColorSpace,
00100                                                                 LPDEVCHARACTER          *lpProfileData );
00101 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a20">StoreTransform</a>( CMWorldRef aRef );
00102 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( BMFORMAT c, <span class="keywordtype">long</span> *pixelSize );
00103 <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( HCMTRANSFORM       hcmTransform );
00104 <span class="keywordtype">long</span>  <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a23">CMCreateMultiProfileTransformInternal</a>(            CMWorldRef      *cw,
00105                                                                                                         LPHPROFILE      lpahProfiles,
00106                                                                                                         DWORD           nProfiles,
00107                                                                                                         DWORD           *aIntentArr,
00108                                                                                                         DWORD           nIntents,
00109                                                                                                         DWORD           dwFlags,
00110                                                                                                         DWORD           dwCreateLink );
00111 <span class="comment">/* ______________________________________________________________________</span>
00112 <span class="comment"></span>
00113 <span class="comment">DWORD WINAPI CMGetInfo( DWORD dwInfo );</span>
00114 <span class="comment"></span>
00115 <span class="comment">Abstract:</span>
00116 <span class="comment">        The CMGetInfo function retrieves various information about the ICM.</span>
00117 <span class="comment"></span>
00118 <span class="comment">Parameter               Description</span>
00119 <span class="comment">        </span>
00120 <span class="comment">        dwInfo          Values that can have the following meaning:</span>
00121 <span class="comment"></span>
00122 <span class="comment">        Type    Meaning</span>
00123 <span class="comment">                </span>
00124 <span class="comment">        CMS_VERSION     Retrieves the version of Windows supported.</span>
00125 <span class="comment">        CMS_IDENT       Retrieves the identifier of the ICMDLL.</span>
00126 <span class="comment">        CMS_DRIVER_LEVEL        Retrieves the support level of a device driver.</span>
00127 <span class="comment"></span>
00128 <span class="comment">Returns</span>
00129 <span class="comment">        CMGetInfo returns zero if an invalid parameter is passed in. If successful it returns a value that depends on the information requested.</span>
00130 <span class="comment">        For CMS_VERSION CMGetInfo retrieves the version of Windows ICM interface supported by this module. For Windows 95 this should be 4.0, represented as 0x00040000.</span>
00131 <span class="comment">        For CMS_IDENT CMGetInfo retrieves the identifier of the ICMDLL. This is the same as the ICC color profile header identifier.</span>
00132 <span class="comment">        For CMS_DRIVER_LEVEL CMGetInfo retrieves the supported level of the device driver. ICMDLLs should return CMS_LEVEL_1. The values have been defined in a previous section.</span>
00133 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00134"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a24">00134</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a24">CMGetInfo</a>( DWORD dwInfo )
00135 {
00136         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ret = 0;
00137         <span class="keywordflow">switch</span>( dwInfo ){
00138         <span class="keywordflow">case</span> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a4">CMM_VERSION</a>:
00139                 ret = 0x00050000;
00140                 <span class="keywordflow">break</span>;
00141         <span class="keywordflow">case</span> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a0">CMM_WIN_VERSION</a>:
00142                 ret = 0x00040000;
00143                 <span class="keywordflow">break</span>;
00144         <span class="keywordflow">case</span> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a3">CMM_DLL_VERSION</a>:
00145                 ret = 0x00010000;
00146                 <span class="keywordflow">break</span>;
00147         <span class="keywordflow">case</span> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a1">CMM_IDENT</a>:
00148                 ret = 'Win ';
00149                 <span class="keywordflow">break</span>;
00150         <span class="keywordflow">case</span> CMM_LOGOICON:
00151                 ret = 100;
00152                 <span class="keywordflow">break</span>;
00153         <span class="keywordflow">case</span> CMM_DESCRIPTION:
00154                 ret = 100;
00155                 <span class="keywordflow">break</span>;
00156         <span class="keywordflow">case</span> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a2">CMM_DRIVER_LEVEL</a>:
00157                 ret = <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a4">CMS_LEVEL_1</a>;
00158                 <span class="keywordflow">break</span>;
00159         <span class="keywordflow">default</span>:
00160                 ret = 0;
00161                 <span class="keywordflow">break</span>;
00162         }
00163         <span class="keywordflow">return</span>  ret;
00164 }
00165 
00166 
<a name="l00167"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a25">00167</a> <span class="keywordtype">long</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a25">CMCreateTransformExtInternal</a>(      CMWorldRef      *cwOut,
00168                                                                         UINT32          dwFlags,
00169                                                                         UINT32          lcsIntent,
00170                                                                         HPROFILE        aProf,
00171                                                                         LPBYTE          ptDeRef,
00172                                                                         LPBYTE          pdDeRef )
00173 {
00174         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw=0;
00175         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw2=0;
00176         <span class="keywordtype">long</span> err;
00177         HPROFILE saveProf;
00178         HPROFILE hArray[3];
00179         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> aIntent[3];
00180         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> aUINT32,count;
00181         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> theModelPtr;
00182 
00183         *cwOut = 0;
00184         aIntent[0] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>;
00185         <span class="keywordflow">switch</span>( lcsIntent ){
00186           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a21">LCS_GM_BUSINESS</a>:
00187                 aIntent[1] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a144">icSaturation</a>;
00188                 <span class="keywordflow">break</span>;
00189           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a22">LCS_GM_GRAPHICS</a>:
00190                 aIntent[1] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>;
00191                 <span class="keywordflow">break</span>;
00192           <span class="keywordflow">case</span> LCS_GM_ABS_COLORIMETRIC:
00193                 aIntent[1] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>;
00194                 <span class="keywordflow">break</span>;
00195           <span class="keywordflow">default</span>:
00196                 aIntent[1] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>;
00197                 <span class="keywordflow">break</span>;
00198         }
00199         <span class="keywordflow">if</span>( ptDeRef == 0 ){
00200                 count = 2;
00201                 hArray[0] =  aProf;
00202                 hArray[1] =  pdDeRef;
00203         }
00204         <span class="keywordflow">else</span>{
00205                 count = 3;
00206                 hArray[0] =  aProf;
00207                 hArray[1] =  ptDeRef;
00208                 hArray[2] =  pdDeRef;
00209                 <span class="keywordflow">if</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; USE_RELATIVE_COLORIMETRIC )aIntent[2] = INTENT_RELATIVE_COLORIMETRIC;
00210                 <span class="keywordflow">else</span> aIntent[2] = INTENT_ABSOLUTE_COLORIMETRIC;
00211         }
00212 
00213         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a23">CMCreateMultiProfileTransformInternal</a>( &amp;cw, hArray, count, aIntent, count, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, 0 );
00214         <span class="keywordflow">if</span>( err ){
00215                 <span class="keywordflow">goto</span> CleanupAndExit;
00216         }
00217         <span class="keywordflow">if</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; 0x80000000 ){                             <span class="comment">/* this is for the backward transform */</span>
00218                 count--;
00219                 saveProf = hArray[count];
00220                 hArray[count] =  hArray[0];
00221                 hArray[0] =  saveProf;
00222                 aUINT32 = aIntent[count];
00223                 aIntent[count] = aIntent[0];
00224                 aIntent[0] = aUINT32;
00225 
00226                 count++;
00227                 err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a23">CMCreateMultiProfileTransformInternal</a>( &amp;cw2, hArray, count, aIntent, count, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, 0 );
00228                 <span class="keywordflow">if</span>( err ){
00229                         <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a6">CWDisposeColorWorld</a>( cw );      <span class="comment">/* delete other cw */</span>
00230                         <span class="keywordflow">goto</span> CleanupAndExit;
00231                 }
00232                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>( cw );
00233                 theModelPtr = (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( cw ));
00234                 theModelPtr-&gt;pBackwardTransform = cw2;
00235                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>( aTrans );
00236         }
00237 
00238 CleanupAndExit:
00239         <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a13">CloseColorProfile</a>( aProf );
00240         <span class="keywordflow">if</span>( err ){
00241                 SetLastError( err );
00242                 cw = (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a>)(ULONG_PTR)(err &amp; 255);
00243         }
00244         <span class="keywordflow">else</span>{
00245                 cw = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a20">StoreTransform</a>( cw );
00246         }
00247         *cwOut = cw;
00248         <span class="keywordflow">return</span> 0;
00249 }
00250 <span class="comment">/* ______________________________________________________________________</span>
00251 <span class="comment"></span>
00252 <span class="comment">HCMTRANSFORM  WINAPI CMCreateTransformExt(      LPLOGCOLORSPACEA        lpColorSpace,</span>
00253 <span class="comment">                                                                                        LPDEVCHARACTER          lpDevCharacter,</span>
00254 <span class="comment">                                                                                        LPDEVCHARACTER          lpTargetDevCharacter,</span>
00255 <span class="comment">                                                                                        UINT32                          dwFlags );</span>
00256 <span class="comment"></span>
00257 <span class="comment">Abstract:</span>
00258 <span class="comment">        The CMCreateTransformExt function creates a color transform that</span>
00259 <span class="comment">        maps from an input LogColorSpace to an optional target to an</span>
00260 <span class="comment">        output device.</span>
00261 <span class="comment"></span>
00262 <span class="comment">Parameter                                       Description</span>
00263 <span class="comment">        lpColorSpace                    Pointer to input color space. If lcsFilename is non-zero,</span>
00264 <span class="comment">                                                        it is a pointer to the memory mapped profile.</span>
00265 <span class="comment">        LpDevCharacter                  Pointer to memory mapped device profile</span>
00266 <span class="comment">        lpTargetDevCharacter    Pointer to memory mapped target profile</span>
00267 <span class="comment">        dwFlags                                 Specifies flags to control creation of the transform.</span>
00268 <span class="comment">                                                        It is up to the CMM to determine how best to use these flags.</span>
00269 <span class="comment">                                                        Set the high-order word to ENABLE_GAMUT_CHECKING if the transform</span>
00270 <span class="comment">                                                        will be used for gamut checking.</span>
00271 <span class="comment">                                                        The low-order WORD can have one of the following constant values:</span>
00272 <span class="comment">                                                        PROOF_MODE, NORMAL_MODE, BEST_MODE.</span>
00273 <span class="comment">                                                        Moving from PROOF_MODE to BEST_MODE, output quality generally improves and transform speed declines.</span>
00274 <span class="comment"></span>
00275 <span class="comment">Returns</span>
00276 <span class="comment">        If the function is successful, it returns a color transform</span>
00277 <span class="comment">        in the range 256 to 65535. Otherwise it returns an error code</span>
00278 <span class="comment">        (return value &lt; 255).</span>
00279 <span class="comment"></span>
00280 <span class="comment">  _____________________________________________________________________ */</span>
00281 <span class="keywordtype">void</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a26">WriteProf</a>( LPSTR name, <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *theProf, <span class="keywordtype">long</span> currentSize );
<a name="l00282"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a27">00282</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a27">CMCreateTransformExt</a>(      LPLOGCOLORSPACEA        lpColorSpace,
00283                                                                                         LPDEVCHARACTER          lpDevCharacter,
00284                                                                                         LPDEVCHARACTER          lpTargetDevCharacter,
00285                                                                                         DWORD                           dwFlags )
00286 {
00287         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw=0;
00288         <span class="keywordtype">long</span> err;
00289         LPBYTE pt,<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>, ptDeRef, pdDeRef;
00290         HPROFILE aProf;
00291         PROFILE theProf;
00292     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   bWin95;
00293     OSVERSIONINFO osvi;
00294 
00295 <span class="preprocessor">#if 0                           </span><span class="comment">/* Test for CMCreateProfile */</span>
00296         <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a19">CMCreateProfile</a>( lpColorSpace, &amp;pt );
00297         err = *(<span class="keywordtype">long</span> *)pt;
00298         SwapLong(&amp;err);
00299         <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a26">WriteProf</a>( <span class="stringliteral">"CMCreateProfile.icc"</span>, (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)pt, err );
00300         GlobalFreePtr( pt );
00301 <span class="preprocessor">#endif</span>
00302 <span class="preprocessor"></span>
00303 
00304         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a17">FillProfileFromLog</a>( lpColorSpace, &amp;theProf );
00305         <span class="keywordflow">if</span>( err ){
00306                 SetLastError( err );
00307                 <span class="keywordflow">goto</span> CleanupAndExit;
00308         }
00309         aProf = OpenColorProfile(&amp;theProf, PROFILE_READ, FILE_SHARE_READ, <a class="code" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a> );
00310         <span class="keywordflow">if</span>( !aProf ){
00311                 err = GetLastError();
00312                 <span class="keywordflow">goto</span> CleanupAndExit;
00313         }
00314     osvi.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVERSIONINFO);
00315     GetVersionEx(&amp;osvi);
00316     bWin95 = osvi.dwMajorVersion == 4 &amp;&amp;
00317              osvi.dwMinorVersion == 0 &amp;&amp;
00318              osvi.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS;
00319 
00320     <span class="keywordflow">if</span> (bWin95)
00321     {
00322         PROFILE myProf;
00323         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   l;
00324 
00325         <span class="comment">//</span>
00326         <span class="comment">// Handles are not provided below LCS structure, so create handles</span>
00327         <span class="comment">//</span>
00328 
00329         myProf.dwType = PROFILE_MEMBUFFER;
00330         myProf.pProfileData = lpDevCharacter;
00331         l = *(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(myProf.pProfileData);
00332         myProf.cbDataSize = SwapLong(&amp;l);
00333         pdDeRef = OpenColorProfile(&amp;myProf, PROFILE_READ, FILE_SHARE_READ, <a class="code" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a> );
00334         <span class="keywordflow">if</span>( !pdDeRef ){
00335                 err = GetLastError();
00336                 <span class="keywordflow">goto</span> CleanupAndExit;
00337         }
00338 
00339         ptDeRef = 0;
00340         <span class="keywordflow">if</span> (lpTargetDevCharacter)
00341         {
00342             myProf.dwType = PROFILE_MEMBUFFER;
00343             myProf.pProfileData = lpTargetDevCharacter;
00344             l = *(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(myProf.pProfileData);
00345             myProf.cbDataSize = SwapLong(&amp;l);
00346             ptDeRef = OpenColorProfile(&amp;myProf, PROFILE_READ, FILE_SHARE_READ, <a class="code" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a> );
00347             <span class="keywordflow">if</span>( !ptDeRef ){
00348                     err = GetLastError();
00349                     <span class="keywordflow">goto</span> CleanupAndExit;
00350             }
00351         }
00352     }
00353     <span class="keywordflow">else</span>
00354     {
00355                 <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = ((LPBYTE)lpColorSpace+<span class="keyword">sizeof</span>(LOGCOLORSPACEA));
00356                 pdDeRef= (LPBYTE)*(PULONG_PTR)<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>;
00357 
00358                 pt = ((LPBYTE)lpColorSpace+<span class="keyword">sizeof</span>(LOGCOLORSPACEA)+<span class="keyword">sizeof</span>(HPROFILE));
00359                 ptDeRef= (LPBYTE)*(PULONG_PTR)pt;
00360         }
00361 
00362         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a25">CMCreateTransformExtInternal</a>(     &amp;cw, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>,
00363                                 lpColorSpace-&gt;lcsIntent, aProf, ptDeRef, pdDeRef );
00364 
00365 CleanupAndExit:
00366         <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsFilename[0] == 0 ){
00367                 <span class="keywordflow">if</span>( theProf.pProfileData )GlobalFreePtr( theProf.pProfileData );
00368                 theProf.pProfileData = 0;
00369         }
00370     <span class="keywordflow">if</span> (bWin95)
00371     {
00372         <span class="keywordflow">if</span> (pdDeRef)
00373         {
00374             <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a13">CloseColorProfile</a>(pdDeRef);
00375         }
00376         <span class="keywordflow">if</span> (ptDeRef)
00377         {
00378             <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a13">CloseColorProfile</a>(ptDeRef);
00379         }
00380     }
00381         <span class="keywordflow">if</span>( err ){
00382                 <span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)(ULONG_PTR)(err &amp; 255);
00383         }
00384         <span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)cw;
00385 }
00386 
00387 <span class="comment">/* ______________________________________________________________________</span>
00388 <span class="comment"></span>
00389 <span class="comment">HCMTRANSFORM  WINAPI CMCreateTransform(         LPLOGCOLORSPACEA        lpColorSpace,</span>
00390 <span class="comment">                                                                                        LPDEVCHARACTER          lpDevCharacter,</span>
00391 <span class="comment">                                                                                        LPDEVCHARACTER          lpTargetDevCharacter );</span>
00392 <span class="comment"></span>
00393 <span class="comment">Abstract:</span>
00394 <span class="comment">        The CMCreateTransform function creates a color transform that</span>
00395 <span class="comment">        maps from an input LogColorSpace to an optional target to an</span>
00396 <span class="comment">        output device.</span>
00397 <span class="comment"></span>
00398 <span class="comment">Parameter                                       Description</span>
00399 <span class="comment">        lpColorSpace                    Pointer to input color space. If lcsFilename is non-zero,</span>
00400 <span class="comment">                                                        it is a pointer to the memory mapped profile.</span>
00401 <span class="comment">        LpDevCharacter                  Pointer to memory mapped device profile</span>
00402 <span class="comment">        lpTargetDevCharacter    Pointer to memory mapped target profile</span>
00403 <span class="comment"></span>
00404 <span class="comment">Returns</span>
00405 <span class="comment">        If the function is successful, it returns a color transform</span>
00406 <span class="comment">        in the range 256 to 65535. Otherwise it returns an error code</span>
00407 <span class="comment">        (return value &lt; 255).</span>
00408 <span class="comment"></span>
00409 <span class="comment">  _____________________________________________________________________ */</span>
<a name="l00410"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a28">00410</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a28">CMCreateTransform</a>  (       LPLOGCOLORSPACEA        lpColorSpace,
00411                                                                                         LPDEVCHARACTER          lpDevCharacter,
00412                                                                                         LPDEVCHARACTER          lpTargetDevCharacter )
00413 {
00414         <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a27">CMCreateTransformExt</a>( lpColorSpace, lpDevCharacter, lpTargetDevCharacter, PROOF_MODE | ENABLE_GAMUT_CHECKING | 0x80000000 );
00415 }
00416 <span class="comment">/* ______________________________________________________________________</span>
00417 <span class="comment"></span>
00418 <span class="comment">HCMTRANSFORM  WINAPI CMCreateTransformExtW(     LPLOGCOLORSPACEW        lpColorSpace,</span>
00419 <span class="comment">                                                                                        LPDEVCHARACTER          lpDevCharacter,</span>
00420 <span class="comment">                                                                                        LPDEVCHARACTER          lpTargetDevCharacter,</span>
00421 <span class="comment">                                                                                        DWORD                           dwFlags );</span>
00422 <span class="comment"></span>
00423 <span class="comment">Abstract:</span>
00424 <span class="comment">        The CMCreateTransformExtW function creates a color transform that</span>
00425 <span class="comment">        maps from an input LogColorSpace to an optional target to an</span>
00426 <span class="comment">        output device.</span>
00427 <span class="comment"></span>
00428 <span class="comment">Parameter                                       Description</span>
00429 <span class="comment">        lpColorSpace                    Pointer to input color space. If lcsFilename is non-zero, it is a pointer to the memory mapped profile.</span>
00430 <span class="comment">        LpDevCharacter                  Pointer to memory mapped device profile</span>
00431 <span class="comment">        lpTargetDevCharacter    Pointer to memory mapped target profile</span>
00432 <span class="comment">        dwFlags                                 Specifies flags to control creation of the transform.</span>
00433 <span class="comment">                                                        It is up to the CMM to determine how best to use these flags.</span>
00434 <span class="comment">                                                        Set the high-order word to ENABLE_GAMUT_CHECKING if the transform</span>
00435 <span class="comment">                                                        will be used for gamut checking.</span>
00436 <span class="comment">                                                        The low-order WORD can have one of the following constant values:</span>
00437 <span class="comment">                                                        PROOF_MODE, NORMAL_MODE, BEST_MODE.</span>
00438 <span class="comment">                                                        Moving from PROOF_MODE to BEST_MODE, output quality generally improves and transform speed declines.</span>
00439 <span class="comment"></span>
00440 <span class="comment">Returns</span>
00441 <span class="comment">        If the function is successful, it returns a color transform</span>
00442 <span class="comment">        in the range 256 to 65535. Otherwise it returns an error code</span>
00443 <span class="comment">        (return value &lt; 255).</span>
00444 <span class="comment"></span>
00445 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00446"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a29">00446</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a29">CMCreateTransformExtW</a>(     LPLOGCOLORSPACEW        lpColorSpace,
00447                                                                                         LPDEVCHARACTER          lpDevCharacter,
00448                                                                                         LPDEVCHARACTER          lpTargetDevCharacter,
00449                                                                                         DWORD                           dwFlags )
00450 {
00451         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw=0;
00452         <span class="keywordtype">long</span> err;
00453         LPBYTE pt,<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>, ptDeRef, pdDeRef;
00454         HPROFILE aProf;
00455         PROFILE theProf;
00456 
00457         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a18">FillProfileFromLogW</a>( lpColorSpace, &amp;theProf );
00458         <span class="keywordflow">if</span>( err ){
00459                 SetLastError( err );
00460                 <span class="keywordflow">goto</span> CleanupAndExit;
00461         }
00462         aProf = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a12">OpenColorProfileW</a>(&amp;theProf, PROFILE_READ, FILE_SHARE_READ, <a class="code" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a> );
00463         <span class="keywordflow">if</span>( !aProf ){
00464                 err = GetLastError();
00465                 <span class="keywordflow">goto</span> CleanupAndExit;
00466         }
00467         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = ((LPBYTE)lpColorSpace+<span class="keyword">sizeof</span>(LOGCOLORSPACEW));
00468         pdDeRef= (LPBYTE)*(PULONG_PTR)<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>;
00469 
00470         pt = ((LPBYTE)lpColorSpace+<span class="keyword">sizeof</span>(LOGCOLORSPACEW)+<span class="keyword">sizeof</span>(HPROFILE));
00471         ptDeRef= (LPBYTE)*(PULONG_PTR)pt;
00472 
00473         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a25">CMCreateTransformExtInternal</a>(     &amp;cw, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>,
00474                                 lpColorSpace-&gt;lcsIntent, aProf, ptDeRef, pdDeRef );
00475 
00476 CleanupAndExit:
00477         <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsFilename[0] == 0 ){
00478                 <span class="keywordflow">if</span>( theProf.pProfileData )GlobalFreePtr( theProf.pProfileData );
00479                 theProf.pProfileData = 0;
00480         }
00481         <span class="keywordflow">if</span>( err ){
00482                 <span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)(ULONG_PTR)(err &amp; 255);
00483         }
00484         <span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)cw;
00485 }
00486 
00487 <span class="comment">/* ______________________________________________________________________</span>
00488 <span class="comment"></span>
00489 <span class="comment">HCMTRANSFORM  WINAPI CMCreateTransformW(        LPLOGCOLORSPACEW        lpColorSpace,</span>
00490 <span class="comment">                                                                                        LPDEVCHARACTER          lpDevCharacter,</span>
00491 <span class="comment">                                                                                        LPDEVCHARACTER          lpTargetDevCharacter );</span>
00492 <span class="comment"></span>
00493 <span class="comment">Abstract:</span>
00494 <span class="comment">        The CMCreateTransformW function creates a color transform that</span>
00495 <span class="comment">        maps from an input LogColorSpace to an optional target to an</span>
00496 <span class="comment">        output device.</span>
00497 <span class="comment"></span>
00498 <span class="comment">Parameter                                       Description</span>
00499 <span class="comment">        lpColorSpace                    Pointer to input color space. If lcsFilename is non-zero, it is a pointer to the memory mapped profile.</span>
00500 <span class="comment">        LpDevCharacter                  Pointer to memory mapped device profile</span>
00501 <span class="comment">        lpTargetDevCharacter    Pointer to memory mapped target profile</span>
00502 <span class="comment"></span>
00503 <span class="comment">Returns</span>
00504 <span class="comment">        If the function is successful, it returns a color transform</span>
00505 <span class="comment">        in the range 256 to 65535. Otherwise it returns an error code</span>
00506 <span class="comment">        (return value &lt; 255).</span>
00507 <span class="comment"></span>
00508 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00509"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a30">00509</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a30">CMCreateTransformW</a>(        LPLOGCOLORSPACEW        lpColorSpace,
00510                                                                                         LPDEVCHARACTER          lpDevCharacter,
00511                                                                                         LPDEVCHARACTER          lpTargetDevCharacter )
00512 {
00513         <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a29">CMCreateTransformExtW</a>( lpColorSpace, lpDevCharacter, lpTargetDevCharacter, PROOF_MODE | ENABLE_GAMUT_CHECKING );
00514 }
00515 
<a name="l00516"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a23">00516</a> <span class="keywordtype">long</span>  <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a23">CMCreateMultiProfileTransformInternal</a>(            CMWorldRef      *cw,
00517                                                                                                         LPHPROFILE      lpahProfiles,
00518                                                                                                         DWORD           nProfiles,
00519                                                                                                         DWORD           *aIntentArr,
00520                                                                                                         DWORD           nIntents,
00521                                                                                                         DWORD           dwFlags,
00522                                                                                                         DWORD           dwCreateLink )
00523 {
00524         <a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>      *profileSet;
00525         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                           aOSErr;
00526         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                           i;
00527         <span class="keywordtype">long</span>                            err;
00528         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                          theFlags;
00529         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                          *arrIntents = 0;;
00530 
00531         profileSet = (<a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a6">SmartNewPtrClear</a>( <span class="keyword">sizeof</span> (<a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>) + (nProfiles)* <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a13">CMProfileRef</a>), &amp;aOSErr );
00532         <span class="keywordflow">if</span> (aOSErr == 0 )
00533         {
00534                 profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o0">keyIndex</a> = 0;
00535                 profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)nProfiles;
00536                 <span class="keywordflow">for</span>( i=0; i&lt;nProfiles; i++)
00537                         profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[i] = (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a13">CMProfileRef</a>)((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(((PVOID *)lpahProfiles)[i]));
00538         }
00539         <span class="keywordflow">else</span> <span class="keywordflow">return</span> ERROR_NOT_ENOUGH_MEMORY;
00540 
00541         <span class="keywordflow">switch</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; 0xffff ){
00542                 <span class="keywordflow">case</span> BEST_MODE:
00543                         theFlags = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>;
00544                         <span class="keywordflow">break</span>;
00545                 <span class="keywordflow">case</span> PROOF_MODE:
00546                         theFlags = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a115">cmDraftMode</a>;
00547                         <span class="keywordflow">break</span>;
00548                 <span class="keywordflow">default</span>:
00549                         theFlags = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a114">cmNormalMode</a>;
00550                         <span class="keywordflow">break</span>;
00551         }
00552         <span class="keywordflow">if</span>( ! (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; ENABLE_GAMUT_CHECKING) ){
00553                 theFlags |= <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a4">kCreateGamutLutMask</a>;
00554         }
00555         <span class="keywordflow">if</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; USE_RELATIVE_COLORIMETRIC ){
00556                 theFlags |= <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a5">kUseRelColorimetric</a>;
00557         }
00558         <span class="keywordflow">if</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; FAST_TRANSLATE ){
00559                 theFlags |= <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a3">kLookupOnlyMask</a>;
00560         }
00561         <span class="keywordflow">if</span>( nProfiles &gt; 1 &amp;&amp; nIntents == 1 ){
00562                 arrIntents = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a6">SmartNewPtrClear</a>( nProfiles * <span class="keyword">sizeof</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>), &amp;aOSErr);
00563                 <span class="keywordflow">if</span> (aOSErr != 0 ){
00564                         err = ERROR_NOT_ENOUGH_MEMORY;
00565                         <span class="keywordflow">goto</span> CleanupAndExit;
00566                 }
00567                 arrIntents[0] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>;
00568                 arrIntents[1] = aIntentArr[0];
00569                 <span class="keywordflow">for</span>( i=2; i&lt;nProfiles; i++){
00570                         arrIntents[i] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>;
00571                         <span class="keywordflow">if</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a5">kUseRelColorimetric</a> ) arrIntents[i] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>;
00572                 }
00573                 err = <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a4">CWConcatColorWorld4MS</a>( cw, profileSet, arrIntents, nProfiles, theFlags );
00574                 arrIntents= (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>) arrIntents );
00575         }
00576         <span class="keywordflow">else</span>{
00577                 err = <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a4">CWConcatColorWorld4MS</a>( cw, profileSet, aIntentArr, nIntents, theFlags );
00578         }
00579 <span class="preprocessor">#ifdef WRITE_PROFILE</span>
00580 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( err == 0 ){
00581                 err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a2">MyNewDeviceLink</a>( *cw, profileSet, <span class="stringliteral">"MyCreateTransform.pf"</span> );
00582                 <span class="comment">//goto CleanupAndExit;</span>
00583         }
00584 <span class="preprocessor">#endif</span>
00585 <span class="preprocessor"></span>CleanupAndExit:
00586         profileSet= (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a16">CMConcatProfileSet</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>) profileSet );
00587         <span class="keywordflow">return</span> err;
00588 }
00589 
00590 <span class="comment">/* ______________________________________________________________________</span>
00591 <span class="comment"></span>
00592 <span class="comment">HCMTRANSFORM  WINAPI CMCreateMultiProfileTransform(     LPHPROFILE      lpahProfiles,</span>
00593 <span class="comment">                                                                                                        DWORD           nProfiles,</span>
00594 <span class="comment">                                                                                                        UINT32          *aIntentArr,</span>
00595 <span class="comment">                                                                                                        UINT32          nIntents,</span>
00596 <span class="comment">                                                                                                        UINT32          dwFlags );</span>
00597 <span class="comment"></span>
00598 <span class="comment">Abstract:</span>
00599 <span class="comment">        The CMCreateMultiProfileTransform function accepts</span>
00600 <span class="comment">        an array of profiles or a single device link profile</span>
00601 <span class="comment">        and creates a color transform.</span>
00602 <span class="comment">        This transform is a mapping from the color space specified</span>
00603 <span class="comment">        by the first profile to that of the second profile</span>
00604 <span class="comment">        and so on until the last one.</span>
00605 <span class="comment"></span>
00606 <span class="comment">Parameter                       Description</span>
00607 <span class="comment">        lpahProfiles    Pointer to an array of profile handles</span>
00608 <span class="comment">        nProfiles               Number of profiles in the array</span>
00609 <span class="comment">        padwIntents             (in)            Points to an array of intent structures.</span>
00610 <span class="comment">                                                                0 = default behavior ( intents out of profiles )</span>
00611 <span class="comment"></span>
00612 <span class="comment">        nIntents                (in)            Specifies the number of intents in the intent array.</span>
00613 <span class="comment">                                                                Can be 1, or the same value as nProfiles.</span>
00614 <span class="comment"></span>
00615 <span class="comment">        dwFlags                 (in)            Specifies flags to control creation of the transform.</span>
00616 <span class="comment">                                                                These flags are intended only as hints, and it is up to the CMM</span>
00617 <span class="comment">                                                                to determine how best to use these flags.</span>
00618 <span class="comment">                                                                Set the high-order word to ENABLE_GAMUT_CHECKING if the transform will be used</span>
00619 <span class="comment">                                                                for gamut checking.</span>
00620 <span class="comment">                                                                The low-order WORD can have one of the following constant values:</span>
00621 <span class="comment">                                                                PROOF_MODE, NORMAL_MODE, BEST_MODE. Moving from PROOF_MODE to BEST_MODE,</span>
00622 <span class="comment">Returns</span>
00623 <span class="comment">        If the function is successful, it returns a color transform.</span>
00624 <span class="comment">        Otherwise it returns an error code (return value &lt; 255).</span>
00625 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00626"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a16">00626</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a16">CMCreateMultiProfileTransform</a>(     LPHPROFILE      lpahProfiles,
00627                                                                                                         DWORD           nProfiles,
00628                                                                                                         DWORD           *aIntentArr,
00629                                                                                                         DWORD           nIntents,
00630                                                                                                         DWORD           dwFlags )
00631 {
00632         <span class="keywordtype">long</span>                            err;
00633         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a>                      cw;
00634 
00635         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a23">CMCreateMultiProfileTransformInternal</a>( &amp;cw, lpahProfiles, nProfiles, aIntentArr, nIntents, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, 0 );
00636         <span class="keywordflow">if</span>( err ){
00637                 SetLastError( err );
00638                 <span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)(ULONG_PTR)(err &amp; 255);
00639         }
00640         cw = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a20">StoreTransform</a>( cw );
00641         <span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)cw;
00642 }
00643 
00644 <span class="comment">/* ______________________________________________________________________</span>
00645 <span class="comment">BOOL  WINAPI CMDeleteTransform( HCMTRANSFORM    hcmTransform );</span>
00646 <span class="comment"></span>
00647 <span class="comment">Abstract:</span>
00648 <span class="comment">        The CMDeleteTransform function deletes the given color transform,</span>
00649 <span class="comment">        and frees any memory associated with it.</span>
00650 <span class="comment"></span>
00651 <span class="comment">Parameter                       Description</span>
00652 <span class="comment">        hcmTransform    Identifies the color transform</span>
00653 <span class="comment"></span>
00654 <span class="comment">Returns</span>
00655 <span class="comment">        If the function is successful, the return value is nonzero.</span>
00656 <span class="comment">        Otherwise it is zero.</span>
00657 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00658"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a31">00658</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a31">CMDeleteTransform</a>( HCMTRANSFORM    hcmTransform )
00659 {
00660         <span class="keywordtype">long</span> actTransform = (<span class="keywordtype">long</span>)(ULONG_PTR)hcmTransform - 256;
00661         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a> aTrans = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00662         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> theModelPtr;
00663         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> theWorldRef;
00664     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bReturn = 0;
00665 
00666         __try {
00667                 EnterCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
00668                 <span class="keywordflow">if</span>( actTransform &lt; IndexTransform &amp;&amp; actTransform &gt;= 0 ){
00669                         aTrans = <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[actTransform];
00670                         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[ actTransform ] = 0;
00671                         <span class="keywordflow">if</span>( actTransform == <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a>-1 )<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a>--;
00672                         bReturn = 1;
00673                 }
00674         }
00675         __finally{
00676                 LeaveCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
00677                 
00678                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>( aTrans );
00679                 theModelPtr = (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( aTrans ));
00680                 theWorldRef = theModelPtr-&gt;pBackwardTransform;
00681                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>( aTrans );
00682                 <span class="keywordflow">if</span>( theWorldRef != 0 ){
00683                         <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a6">CWDisposeColorWorld</a>( theWorldRef );
00684                 }
00685 
00686                 <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a6">CWDisposeColorWorld</a>( aTrans );
00687         }
00688     <span class="keywordflow">return</span> bReturn;
00689 }
00690 
00691 <span class="comment">/* ______________________________________________________________________</span>
00692 <span class="comment">BOOL  WINAPI CMCreateProfile(   LPLOGCOLORSPACEA                lpColorSpace,</span>
00693 <span class="comment">                                                                LPBYTE                                  *lpProfileData );</span>
00694 <span class="comment"></span>
00695 <span class="comment">Abstract:</span>
00696 <span class="comment">        The CMCreateProfile function creates a display color profile</span>
00697 <span class="comment">        from a LogColorSpace structure.</span>
00698 <span class="comment"></span>
00699 <span class="comment">Parameter                       Description</span>
00700 <span class="comment">        lpColorSpace    Pointer to color space. lcsFilename field will be NULL.</span>
00701 <span class="comment">        pProfileData    Points to a pointer to a buffer.</span>
00702 <span class="comment">                                        If successful the function allocates and fills this buffer.</span>
00703 <span class="comment">                                        It is then the calling applications responsibility to</span>
00704 <span class="comment">                                        free this buffer with GlobalFreePtr( lpProfileData )</span>
00705 <span class="comment">                                        when it is no longer needed.</span>
00706 <span class="comment"></span>
00707 <span class="comment">Returns</span>
00708 <span class="comment">        If the function is successful, it returns nonzero.</span>
00709 <span class="comment">        Otherwise it returns zero.</span>
00710 <span class="comment"></span>
00711 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00712"></a><a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a19">00712</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a19">CMCreateProfile</a>(   LPLOGCOLORSPACEA        lpColorSpace,
00713                                                                 LPBYTE                          *lpProfileData )
00714 {
00715         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw=0;
00716         <span class="keywordtype">long</span> err;
00717 
00718         <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsFilename[0] ) <span class="keywordflow">return</span> 0;
00719         err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a1">MyNewAbstract</a>( lpColorSpace, (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> **)lpProfileData );
00720         <span class="comment">//err = FillProfileFromLog( lpColorSpace, &amp;theProf );</span>
00721         <span class="keywordflow">if</span>( err ){
00722                 SetLastError( err );
00723                 <span class="keywordflow">goto</span> CleanupAndExit;
00724         }
00725         <span class="keywordflow">return</span> 1;
00726 CleanupAndExit:
00727         <span class="keywordflow">return</span> 0;
00728 }
00729 
00730 <span class="comment">/* ______________________________________________________________________</span>
00731 <span class="comment">BOOL  WINAPI CMCreateProfileW(  LPLOGCOLORSPACEW        lpColorSpace,</span>
00732 <span class="comment">                                                                LPBYTE                          *lpProfileData );</span>
00733 <span class="comment"></span>
00734 <span class="comment">Abstract:</span>
00735 <span class="comment">        The CMCreateProfileW function creates a display color profile</span>
00736 <span class="comment">        from a LogColorSpace structure.</span>
00737 <span class="comment"></span>
00738 <span class="comment">Parameter                       Description</span>
00739 <span class="comment">        lpColorSpace    Pointer to color space. lcsFilename field will be NULL.</span>
00740 <span class="comment">        pProfileData    Points to a pointer to a buffer.</span>
00741 <span class="comment">                                        If successful the function allocates and fills this buffer.</span>
00742 <span class="comment">                                        It is then the calling applications responsibility to</span>
00743 <span class="comment">                                        free this buffer with GlobalFreePtr( lpProfileData )</span>
00744 <span class="comment">                                        when it is no longer needed.</span>
00745 <span class="comment"></span>
00746 <span class="comment">Returns</span>
00747 <span class="comment">        If the function is successful, it returns nonzero.</span>
00748 <span class="comment">        Otherwise it returns zero.</span>
00749 <span class="comment"></span>
00750 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00751"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a33">00751</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a32">CMCreateProfileW</a>(  LPLOGCOLORSPACEW        lpColorSpace,
00752                                                                 LPBYTE                          *lpProfileData )
00753 {
00754         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw=0;
00755         <span class="keywordtype">long</span> err;
00756 
00757         <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsFilename[0] ) <span class="keywordflow">return</span> 0;
00758         err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a0">MyNewAbstractW</a>( lpColorSpace, (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> **)lpProfileData );
00759         <span class="comment">//err = FillProfileFromLogW( lpColorSpace, &amp;theProf );</span>
00760         <span class="keywordflow">if</span>( err ){
00761                 SetLastError( err );
00762                 <span class="keywordflow">goto</span> CleanupAndExit;
00763         }
00764         <span class="keywordflow">return</span> 1;
00765 CleanupAndExit:
00766         <span class="keywordflow">return</span> 0;
00767 }
00768 
00769 <span class="comment">/* ______________________________________________________________________</span>
00770 <span class="comment">BOOL  WINAPI CMCreateDeviceLinkProfile(         LPHPROFILE      lpahProfiles,</span>
00771 <span class="comment">                                                                                        DWORD           nProfiles,</span>
00772 <span class="comment">                                                                                        UINT32          *aIntentArr,</span>
00773 <span class="comment">                                                                                        UINT32          nIntents,</span>
00774 <span class="comment">                                                                                        UINT32          dwFlags,</span>
00775 <span class="comment">                                                                                        LPBYTE          *lpProfileData );</span>
00776 <span class="comment"></span>
00777 <span class="comment">Abstract:</span>
00778 <span class="comment">        The CMCreateDeviceLinkProfile function creates a device link</span>
00779 <span class="comment">        profile as specified by the "ICC Profile Format Specification."</span>
00780 <span class="comment"></span>
00781 <span class="comment">Parameter                       Description</span>
00782 <span class="comment">        lpahProfiles    Pointer to an array of profile handles</span>
00783 <span class="comment">        nProfiles               Number of profiles in the array</span>
00784 <span class="comment">        padwIntents             Points to an array of rendering intents.</span>
00785 <span class="comment">                                        Each rendering intent is represented by one of the following values:</span>
00786 <span class="comment">                                                INTENT_PERCEPTUAL</span>
00787 <span class="comment">                                                INTENT_SATURATION</span>
00788 <span class="comment">                                                INTENT_RELATIVE_COLORIMETRIC</span>
00789 <span class="comment">                                                INTENT_ABSOLUTE_COLORIMETRIC</span>
00790 <span class="comment">                                        For more information, see Rendering Intents.</span>
00791 <span class="comment"></span>
00792 <span class="comment">        nIntents                Specifies the number of intents in the intent array. Can be 1, or the same value as nProfiles.</span>
00793 <span class="comment">        dwFlags                 Specifies flags to control creation of the transform. These flags are intended only as hints,</span>
00794 <span class="comment">                                        and it is up to the CMM to determine how best to use these flags.</span>
00795 <span class="comment">                                        Set the high-order word to ENABLE_GAMUT_CHECKING if the transform will be used for gamut checking.</span>
00796 <span class="comment">                                        The low-order WORD can have one of the following constant values:</span>
00797 <span class="comment">                                                PROOF_MODE, NORMAL_MODE, BEST_MODE. Moving from PROOF_MODE to BEST_MODE,</span>
00798 <span class="comment">                                                output quality generally improves.</span>
00799 <span class="comment"></span>
00800 <span class="comment">        lpProfileData   Points to a pointer to a buffer.</span>
00801 <span class="comment">                                        If successful the function allocates and fills this buffer.</span>
00802 <span class="comment">                                        It is then the calling applications responsibility to</span>
00803 <span class="comment">                                        free this buffer with GlobalFreePtr( lpProfileData )</span>
00804 <span class="comment">                                        when it is no longer needed.</span>
00805 <span class="comment"></span>
00806 <span class="comment">Returns</span>
00807 <span class="comment">        If the function is successful, it returns nonzero.</span>
00808 <span class="comment">        Otherwise it returns zero. SetLastError is used.</span>
00809 <span class="comment"></span>
00810 <span class="comment">   _____________________________________________________________________ */</span>
00811 
<a name="l00812"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a34">00812</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a33">CMCreateDeviceLinkProfile</a>( LPHPROFILE      lpahProfiles,
00813                                                                                 DWORD           nProfiles,
00814                                                                                 DWORD           *aIntentArr,
00815                                                                                 DWORD           nIntents,
00816                                                                                 DWORD           dwFlags,
00817                                                                                 LPBYTE          *lpProfileData )
00818 {
00819         <span class="keywordtype">long</span>                            err;
00820         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                           aOSErr;
00821         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a>                      cw;
00822         <a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>      *profileSet;
00823         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                          i;
00824 
00825         *lpProfileData = 0;
00826         
00827         err = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a23">CMCreateMultiProfileTransformInternal</a>( &amp;cw, lpahProfiles, nProfiles, aIntentArr, nIntents, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, 0 );
00828         <span class="keywordflow">if</span>( err ){
00829                 SetLastError( err );
00830                 <span class="keywordflow">return</span> 0;
00831         }
00832         profileSet = (<a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a6">SmartNewPtrClear</a>(<span class="keyword">sizeof</span> (<a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>) + (nProfiles)* <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a13">CMProfileRef</a>),&amp;aOSErr);
00833         err = aOSErr;
00834         <span class="keywordflow">if</span> (aOSErr == 0 )
00835         {
00836                 profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o0">keyIndex</a> = 0;
00837                 profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)nProfiles;
00838                 <span class="keywordflow">for</span>( i=0; i&lt;nProfiles; i++)
00839                         profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[i] = (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a13">CMProfileRef</a>)((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(((PVOID *)lpahProfiles)[i]));
00840         }
00841         <span class="keywordflow">else</span> <span class="keywordflow">goto</span> CleanupAndExit;
00842 
00843         err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a6">DeviceLinkFill</a>( (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)cw, profileSet, (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> **)lpProfileData, aIntentArr[0]  );
00844         profileSet= (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a16">CMConcatProfileSet</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>) profileSet );
00845 
00846         <span class="keywordflow">if</span>( err )<span class="keywordflow">goto</span> CleanupAndExit;
00847         <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a6">CWDisposeColorWorld</a> ( cw );
00848         <span class="keywordflow">return</span> 1;
00849 
00850 CleanupAndExit:
00851         <a class="code" href="../../d1/d7/w98_2lh__open_2pi__color_8c.html#a6">CWDisposeColorWorld</a> ( cw );
00852         SetLastError( err );
00853         <span class="keywordflow">return</span> 0;
00854 }
00855 
00856 <span class="comment">/* ______________________________________________________________________</span>
00857 <span class="comment">BOOL  WINAPI CMCreateDeviceLinkProfile( LPHPROFILE      lpahProfiles,</span>
00858 <span class="comment">                                                                                DWORD           nProfiles,</span>
00859 <span class="comment">                                                                                LPBYTE          *lpProfileData );</span>
00860 <span class="comment"></span>
00861 <span class="comment">Abstract:</span>
00862 <span class="comment">        The CMCreateDeviceLinkProfile function creates a device link</span>
00863 <span class="comment">        profile as specified by the "ICC Profile Format Specification."</span>
00864 <span class="comment"></span>
00865 <span class="comment">Parameter                       Description</span>
00866 <span class="comment">        lpahProfiles    Pointer to an array of profile handles</span>
00867 <span class="comment">        nProfiles               Number of profiles in the array</span>
00868 <span class="comment">        pProfileData    Points to a pointer to a buffer.</span>
00869 <span class="comment">                                        If successful the function allocates and fills this buffer.</span>
00870 <span class="comment">                                        It is then the calling applications responsibility to</span>
00871 <span class="comment">                                        free this buffer with GlobalFreePtr( lpProfileData )</span>
00872 <span class="comment">                                        when it is no longer needed.</span>
00873 <span class="comment"></span>
00874 <span class="comment">Returns</span>
00875 <span class="comment">        If the function is successful, it returns nonzero.</span>
00876 <span class="comment">        Otherwise it returns zero. SetLastError is used.</span>
00877 <span class="comment"></span>
00878 <span class="comment">   _____________________________________________________________________ */</span>
00879 
00880 <span class="comment">/*BOOL  WINAPI CMCreateDeviceLinkProfile(       LPHPROFILE      lpahProfiles,</span>
00881 <span class="comment">                                                                                DWORD           nProfiles,</span>
00882 <span class="comment">                                                                                LPBYTE          *lpProfileData )</span>
00883 <span class="comment">{</span>
00884 <span class="comment">        long                    err;</span>
00885 <span class="comment">        UINT32                  *arrIntents = 0;</span>
00886 <span class="comment">        OSErr                   aOSErr;</span>
00887 <span class="comment">        DWORD                   i;</span>
00888 <span class="comment"></span>
00889 <span class="comment">        arrIntents = (UINT32 *)SmartNewPtrClear( nProfiles * sizeof (UINT32), &amp;aOSErr);</span>
00890 <span class="comment">        if (aOSErr != 0 ) return ERROR_NOT_ENOUGH_MEMORY;</span>
00891 <span class="comment"></span>
00892 <span class="comment">        for( i=0; i&lt;nProfiles; i++){</span>
00893 <span class="comment">                arrIntents[i] = icPerceptual;</span>
00894 <span class="comment">        }</span>
00895 <span class="comment"></span>
00896 <span class="comment">        err = CMCreateDeviceLinkProfileExt( lpahProfiles, nProfiles, arrIntents, nProfiles, BEST_MODE, lpProfileData );</span>
00897 <span class="comment">        </span>
00898 <span class="comment">        arrIntents = (UINT32 *)DisposeIfPtr( (Ptr)arrIntents );</span>
00899 <span class="comment">        return err;</span>
00900 <span class="comment">}</span>
00901 <span class="comment">*/</span>
00902 <span class="comment">/* ______________________________________________________________________</span>
00903 <span class="comment">BOOL  WINAPI CMIsProfileValid ( HPROFILE        hProfile,       </span>
00904 <span class="comment">                                                                LPBOOL          lpbValid        </span>
00905 <span class="comment">                                                          );</span>
00906 <span class="comment"></span>
00907 <span class="comment">Abstract:</span>
00908 <span class="comment">        The CMIsProfileValid function reports if the given profile is a valid ICC profile that can be used for color matching.</span>
00909 <span class="comment"></span>
00910 <span class="comment">Parameter                       Description</span>
00911 <span class="comment">        lpDevCharacter  Pointer to memory mapped profile</span>
00912 <span class="comment">        lpbValid                Points to a variable that is set on exit to TRUE if the profile is a valid ICC profile, or FALSE if not.</span>
00913 <span class="comment"></span>
00914 <span class="comment">Returns</span>
00915 <span class="comment">        If it is a valid ICC profile that can be used for color matching,</span>
00916 <span class="comment">        the return value is nonzero. Otherwise it is zero.</span>
00917 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00918"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a35">00918</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a34">CMIsProfileValid</a>(  HPROFILE        hProfile,       
00919                                                                 LPBOOL          lpbValid        
00920                                                           )
00921 {
00922         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a> valid;
00923 
00924         <a class="code" href="../../d1/d9/w98_2lh__open_2pi__valid_8h.html#a0">CMValidateProfile</a>( (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a13">CMProfileRef</a>)hProfile, &amp;valid );
00925 
00926         *lpbValid = valid;
00927         <span class="keywordflow">return</span> valid;
00928 }
00929 
00930 <span class="comment">/* ______________________________________________________________________</span>
00931 <span class="comment">BOOL  WINAPI CMTranslateColors( HCMTRANSFORM    hcmTransform,</span>
00932 <span class="comment">                                                                LPCOLOR                 lpaInputColors,</span>
00933 <span class="comment">                                                                DWORD                   nColors,</span>
00934 <span class="comment">                                                                COLORTYPE               ctInput,</span>
00935 <span class="comment">                                                                LPCOLOR                 lpaOutputColors,</span>
00936 <span class="comment">                                                                COLORTYPE               ctOutput );</span>
00937 <span class="comment">Abstract:</span>
00938 <span class="comment">        The CMTranslateColors function translates an array of colors from</span>
00939 <span class="comment">        the source colorspace to the destination colorspace as defined by</span>
00940 <span class="comment">        the color transform.</span>
00941 <span class="comment"></span>
00942 <span class="comment">Parameter                       Description</span>
00943 <span class="comment">        hcmTransform    Identifies the color transform to use</span>
00944 <span class="comment">        lpaInputColors  Pointer to an array of COLOR structures to translate</span>
00945 <span class="comment">        nColors                 Number of elements in the array</span>
00946 <span class="comment">        ctInput                 Specifies the input color type</span>
00947 <span class="comment">        lpaOutputColors Pointer to an array of COLOR structures that receive the translated colors</span>
00948 <span class="comment">        ctOutput                Specifies the output color type</span>
00949 <span class="comment"></span>
00950 <span class="comment">Returns</span>
00951 <span class="comment">        If the function is successful, the return value is nonzero.</span>
00952 <span class="comment">        Otherwise it is zero.</span>
00953 <span class="comment"></span>
00954 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00955"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a36">00955</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a35">CMTranslateColors</a>( HCMTRANSFORM    hcmTransform,
00956                                                                 LPCOLOR                 lpaInputColors,
00957                                                                 DWORD                   nColors,
00958                                                                 COLORTYPE               ctInput,
00959                                                                 LPCOLOR                 lpaOutputColors,
00960                                                                 COLORTYPE               ctOutput )
00961 {
00962         <span class="keywordtype">long</span> matchErr;
00963         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00964 
00965     <span class="keywordflow">if</span> (lpaOutputColors != lpaInputColors){
00966         <span class="keywordflow">for</span>( i=0; i&lt;nColors; i++) lpaOutputColors[ i ] = lpaInputColors[ i ];
00967     }
00968 
00969         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a4">CWMatchColors</a>( <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform ), (<a class="code" href="../../d8/d3/unionCMColor.html">CMColor</a> *)lpaOutputColors, nColors );
00970         <span class="keywordflow">if</span>( matchErr ){
00971                 SetLastError( matchErr );
00972                 <span class="keywordflow">return</span> 0;
00973         }
00974         <span class="keywordflow">return</span> 1;
00975 }
00976 
00977 <span class="comment">/* ______________________________________________________________________</span>
00978 <span class="comment">BOOL  WINAPI CMCheckColors(     HCMTRANSFORM    hcmTransform,</span>
00979 <span class="comment">                                                        LPCOLOR                 lpaInputColors,</span>
00980 <span class="comment">                                                        DWORD                   nColors,</span>
00981 <span class="comment">                                                        COLORTYPE               ctInput,</span>
00982 <span class="comment">                                                        LPBYTE                  lpaResult );</span>
00983 <span class="comment">Abstract:</span>
00984 <span class="comment">        The CMCheckColors function determines if the given colors lie</span>
00985 <span class="comment">        within the output gamut of the given transform.</span>
00986 <span class="comment"></span>
00987 <span class="comment">Parameter                       Description</span>
00988 <span class="comment">        hcmTransform    Identifies the color transform to use</span>
00989 <span class="comment">        lpaInputColors  Pointer to an array of COLOR structures</span>
00990 <span class="comment">        nColors                 Number of elements in the array</span>
00991 <span class="comment">        ctInput                 Input color type</span>
00992 <span class="comment">        lpaResult               Pointer to an array of bytes that hold the result</span>
00993 <span class="comment"></span>
00994 <span class="comment">Returns</span>
00995 <span class="comment">        If the function is successful, the return value is nonzero.</span>
00996 <span class="comment">        Otherwise it is zero.</span>
00997 <span class="comment">        The lpaResult array holds the results, each byte corresponds to a</span>
00998 <span class="comment">        COLOR element and has a value between 0 and 255.</span>
00999 <span class="comment">        The value 0 denotes that the color is in gamut; a non-zero value</span>
01000 <span class="comment">        implies that it is out of gamut, with the number "n+1" being at</span>
01001 <span class="comment">        least as far out of gamut as the number "n". These values are</span>
01002 <span class="comment">        usually generated from the gamutTag in the ICC profile.</span>
01003 <span class="comment"></span>
01004 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01005"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a37">01005</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a36">CMCheckColors</a>(     HCMTRANSFORM    hcmTransform,
01006                                                         LPCOLOR                 lpaInputColors,
01007                                                         DWORD                   nColors,
01008                                                         COLORTYPE               ctInput,
01009                                                         LPBYTE                  lpaResult )
01010 {
01011         <span class="keywordtype">long</span> matchErr;
01012 
01013         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a5">CWCheckColorsMS</a>( <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform ), (<a class="code" href="../../d8/d3/unionCMColor.html">CMColor</a> *)lpaInputColors, nColors, lpaResult );
01014         <span class="keywordflow">if</span>( matchErr ){
01015                 SetLastError( matchErr );
01016                 <span class="keywordflow">return</span> 0;
01017         }
01018         <span class="keywordflow">return</span> 1;
01019 }
01020 
01021 <span class="comment">/* ______________________________________________________________________</span>
01022 <span class="comment">BOOL  WINAPI CMTranslateRGBs(   HCMTRANSFORM    hcmTransform,</span>
01023 <span class="comment">                                                                LPVOID                  lpSrcBits,</span>
01024 <span class="comment">                                                                BMFORMAT                bmInput,</span>
01025 <span class="comment">                                                                DWORD                   dwWidth,</span>
01026 <span class="comment">                                                                DWORD                   dwHeight,</span>
01027 <span class="comment">                                                                DWORD                   dwStride,</span>
01028 <span class="comment">                                                                LPVOID                  lpDestBits,</span>
01029 <span class="comment">                                                                BMFORMAT                bmOutput,</span>
01030 <span class="comment">                                                                DWORD                   dwTranslateDirection );</span>
01031 <span class="comment">Abstract:</span>
01032 <span class="comment">        The CMTranslateRGBs function takes a bitmap in one of the defined</span>
01033 <span class="comment">        formats and translates the colors in the bitmap producing another</span>
01034 <span class="comment">        bitmap in the requested format.</span>
01035 <span class="comment"></span>
01036 <span class="comment">Parameter                                       Description</span>
01037 <span class="comment">        hcmTransform                    Identifies the color transform to use</span>
01038 <span class="comment">        lpSrcBits                               Pointer to bitmap to translate</span>
01039 <span class="comment">        bmInput                                 Input bitmap format</span>
01040 <span class="comment">        dwWidth                                 Number of pixels per scanline of input data</span>
01041 <span class="comment">        dwHeight                                Number of        scanlines of input data</span>
01042 <span class="comment">        dwStride                                Number of bytes from beginning of one scanline to beginning of next</span>
01043 <span class="comment">        lpDestBits                              Pointer to buffer to receive translated data</span>
01044 <span class="comment">        bmOutput                                Output bitmap format</span>
01045 <span class="comment">        dwTranslateDirection    Describes direction of transform</span>
01046 <span class="comment">        Value   Meaning</span>
01047 <span class="comment">        CMS_FORWARD     Use forward transform</span>
01048 <span class="comment">        CMS_BACKWARD    Use reverse transform  // NOT supported</span>
01049 <span class="comment"></span>
01050 <span class="comment">Returns</span>
01051 <span class="comment">        If the function is successful, the return value is nonzero.</span>
01052 <span class="comment">        Otherwise it is zero.</span>
01053 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01054"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a38">01054</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a37">CMTranslateRGBs</a>(   HCMTRANSFORM    hcmTransform,
01055                                                                 LPVOID                  lpSrcBits,
01056                                                                 BMFORMAT                bmInput,
01057                                                                 DWORD                   dwWidth,
01058                                                                 DWORD                   dwHeight,
01059                                                                 DWORD                   dwStride,
01060                                                                 LPVOID                  lpDestBits,
01061                                                                 BMFORMAT                bmOutput,
01062                                                                 DWORD                   dwTranslateDirection )
01063 {
01064         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a>              spaceIn,spaceOut;
01065         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                                InBitmap,OutBitmap;
01066         <span class="keywordtype">long</span> matchErr, inPixelSize, outPixelSize;
01067         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> aBgrMode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01068         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> theModelPtr;
01069         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> theWorldRef;
01070         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a> theTransform = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform );
01071         
01072         <span class="keywordflow">if</span>( dwTranslateDirection == <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a9">CMS_BACKWARD</a> ){
01073                 <span class="keywordflow">if</span>( theTransform == 0 ){
01074                         SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a> );
01075                         <span class="keywordflow">return</span> 0;
01076                 }
01077                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>( theTransform );
01078                 theModelPtr = (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( theTransform ));
01079                 theWorldRef = theModelPtr-&gt;pBackwardTransform;
01080                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>( theTransform );
01081                 <span class="keywordflow">if</span>( theWorldRef == 0 ){
01082                         SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a> );
01083                         <span class="keywordflow">return</span> 0;
01084                 }
01085                 theTransform = (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)theWorldRef;
01086         }
01087 
01088         spaceIn = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( bmInput, &amp;inPixelSize );
01089         <span class="keywordflow">if</span>( spaceIn == 0 ){
01090                 SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a34">cmInvalidColorSpace</a> );
01091                 <span class="keywordflow">return</span> 0;
01092         }
01093         spaceOut = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( bmOutput, &amp;outPixelSize );
01094         <span class="keywordflow">if</span>( spaceOut == 0 ){
01095                 SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a34">cmInvalidColorSpace</a> );
01096                 <span class="keywordflow">return</span> 0;
01097         }
01098         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>          = lpSrcBits;
01099         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>          = dwWidth;
01100         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>         = dwHeight;
01101         <span class="keywordflow">if</span>( dwStride == 0 ){
01102                 InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> = ( dwWidth * (inPixelSize / 8) + 3 ) &amp; ~3;
01103         }
01104         <span class="keywordflow">else</span>{
01105                 InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>       = dwStride;
01106         }
01107         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>      = inPixelSize;
01108         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>          = spaceIn;
01109                 
01110         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>         = lpDestBits;
01111         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>         = dwWidth;
01112         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>        = dwHeight;
01113         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>      = ( dwWidth * (outPixelSize / 8) + 3 ) &amp; ~3;
01114         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>     = outPixelSize;
01115         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>         = spaceOut;
01116 
01117         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a0">CWMatchBitmap</a>( theTransform, &amp;InBitmap,
01118                                                           (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>)0,(<span class="keywordtype">void</span> *)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,&amp;OutBitmap );
01119         <span class="keywordflow">if</span>( matchErr ){
01120                 SetLastError( matchErr );
01121                 <span class="keywordflow">return</span> 0;
01122         }
01123         <span class="keywordflow">return</span> 1;
01124 }
01125 
01126 <span class="comment">/* ______________________________________________________________________</span>
01127 <span class="comment">BOOL  WINAPI CMTranslateRGBsExt(        HCMTRANSFORM    hcmTransform,</span>
01128 <span class="comment">                                                                        LPVOID                  lpSrcBits,</span>
01129 <span class="comment">                                                                        BMFORMAT                bmInput,</span>
01130 <span class="comment">                                                                        DWORD                   dwWidth,</span>
01131 <span class="comment">                                                                        DWORD                   dwHeight,</span>
01132 <span class="comment">                                                                        DWORD                   dwInputStride,</span>
01133 <span class="comment">                                                                        LPVOID                  lpDestBits,</span>
01134 <span class="comment">                                                                        BMFORMAT                bmOutput,</span>
01135 <span class="comment">                                                                        DWORD                   dwOutputStride,</span>
01136 <span class="comment">                                                                        LPBMCALLBACKFN  lpfnCallback,</span>
01137 <span class="comment">                                                                        LPARAM                  ulCallbackData )</span>
01138 <span class="comment">Abstract:</span>
01139 <span class="comment">        The CMTranslateRGBs function takes a bitmap in one of the defined</span>
01140 <span class="comment">        formats and translates the colors in the bitmap producing another</span>
01141 <span class="comment">        bitmap in the requested format.</span>
01142 <span class="comment"></span>
01143 <span class="comment">Parameter                                       Description</span>
01144 <span class="comment">        hcmTransform                    Specifies the color transform to use.</span>
01145 <span class="comment">        lpSrcBits                               Points to the bitmap to translate.</span>
01146 <span class="comment">        bmInput                                 Specifies the input bitmap format.</span>
01147 <span class="comment">        dwWidth                                 Specifies the number of pixels per scanline in the input bitmap.</span>
01148 <span class="comment">        dwHeight                                Specifies the number of scanlines in the input bitmap.</span>
01149 <span class="comment">        dwInputStride                   Specifies the number of bytes from the beginning of one scanline to</span>
01150 <span class="comment">                                                        the beginning of the next in the input bitmap.</span>
01151 <span class="comment">                                                        If dwInputStride is set to zero, the CMM should assume that scanlines</span>
01152 <span class="comment">                                                        are padded so as to be DWORD aligned.</span>
01153 <span class="comment">        lpDestBits                              Points to a destination buffer in which to place the translated bitmap.</span>
01154 <span class="comment">        bmOutput                                Specifies the output bitmap format.</span>
01155 <span class="comment">        dwOutputStride                  Specifies the number of bytes from the beginning of one scanline to the</span>
01156 <span class="comment">                                                        beginning of the next in the input bitmap.</span>
01157 <span class="comment">                                                        If dwOutputStride is set to zero, the CMM should pad scanlines so</span>
01158 <span class="comment">                                                        that they are DWORD aligned.</span>
01159 <span class="comment">        lpfnCallback                    Pointer to an application-supplied callback function called periodically</span>
01160 <span class="comment">                                                        by CMTranslateRGBsExt to report progress and allow the calling process</span>
01161 <span class="comment">                                                        to cancel the translation. (See ICMProgressProc.)</span>
01162 <span class="comment">        ulCallbackData                  Data passed back to the callback function, for example to identify the</span>
01163 <span class="comment">                                                        translation that is reporting progress.</span>
01164 <span class="comment"></span>
01165 <span class="comment">Returns</span>
01166 <span class="comment">        If the function is successful, the return value is nonzero.</span>
01167 <span class="comment">        Otherwise it is zero.</span>
01168 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01169"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a39">01169</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a38">CMTranslateRGBsExt</a>(        HCMTRANSFORM    hcmTransform,
01170                                                                         LPVOID                  lpSrcBits,
01171                                                                         BMFORMAT                bmInput,
01172                                                                         DWORD                   dwWidth,
01173                                                                         DWORD                   dwHeight,
01174                                                                         DWORD                   dwInputStride,
01175                                                                         LPVOID                  lpDestBits,
01176                                                                         BMFORMAT                bmOutput,
01177                                                                         DWORD                   dwOutputStride,
01178                                                                         LPBMCALLBACKFN  lpfnCallback,
01179                                                                         LPARAM          ulCallbackData )
01180 {
01181         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a>              spaceIn,spaceOut;
01182         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                                InBitmap,OutBitmap;
01183         <span class="keywordtype">long</span> matchErr, inPixelSize, outPixelSize;
01184         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> aBgrMode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01185 
01186         spaceIn = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( bmInput, &amp;inPixelSize );
01187         <span class="keywordflow">if</span>( spaceIn == 0 ){
01188                 SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a34">cmInvalidColorSpace</a> );
01189                 <span class="keywordflow">return</span> 0;
01190         }
01191         spaceOut = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( bmOutput, &amp;outPixelSize );
01192         <span class="keywordflow">if</span>( spaceOut == 0 ){
01193                 SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a34">cmInvalidColorSpace</a> );
01194                 <span class="keywordflow">return</span> 0;
01195         }
01196         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>          = lpSrcBits;
01197         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>          = dwWidth;
01198         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>         = dwHeight;
01199         <span class="keywordflow">if</span>( dwInputStride == 0 ){
01200                 InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> = ( dwWidth * (inPixelSize / 8) + 3 ) &amp; ~3;
01201         }
01202         <span class="keywordflow">else</span>{
01203                 InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>       = dwInputStride;
01204         }
01205         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>      = inPixelSize;
01206         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>          = spaceIn;
01207                 
01208         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>         = lpDestBits;
01209         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>         = dwWidth;
01210         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>        = dwHeight;
01211         <span class="keywordflow">if</span>( dwOutputStride == 0 ){
01212                 OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> = ( dwWidth * (outPixelSize / 8) + 3 ) &amp; ~3;
01213         }
01214         <span class="keywordflow">else</span>{
01215                 OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>      = dwOutputStride;
01216         }
01217         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>     = outPixelSize;
01218         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>         = spaceOut;
01219 
01220         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a0">CWMatchBitmap</a>( <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform ), &amp;InBitmap,
01221                                                           (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>)lpfnCallback,(<span class="keywordtype">void</span> *)ulCallbackData,&amp;OutBitmap );
01222         <span class="keywordflow">if</span>( matchErr ){
01223                 SetLastError( matchErr );
01224                 <span class="keywordflow">return</span> 0;
01225         }
01226         <span class="keywordflow">return</span> 1;
01227 }
01228 
01229 <span class="comment">/* ______________________________________________________________________</span>
01230 <span class="comment">BOOL  WINAPI CMCheckRGBs(       HCMTRANSFORM    hcmTransform,</span>
01231 <span class="comment">                                                        LPVOID                  lpSrcBits,</span>
01232 <span class="comment">                                                        BMFORMAT                bmInput,</span>
01233 <span class="comment">                                                        DWORD                   dwWidth,</span>
01234 <span class="comment">                                                        DWORD                   dwHeight,</span>
01235 <span class="comment">                                                        DWORD                   dwStride,</span>
01236 <span class="comment">                                                        LPBYTE                  lpDestBits,</span>
01237 <span class="comment">                                                        PBMCALLBACKFN   pfnCallback,    </span>
01238 <span class="comment">                                                        LPARAM          ulCallbackData );</span>
01239 <span class="comment">Abstract:</span>
01240 <span class="comment">        The CMCheckRGBs function checks if the pixels in the bitmap lie</span>
01241 <span class="comment">        within the output gamut of the given transform.</span>
01242 <span class="comment"></span>
01243 <span class="comment">Parameter                       Description</span>
01244 <span class="comment"></span>
01245 <span class="comment">        hcmTransform    Specifies the color transform to use.</span>
01246 <span class="comment">        lpSrcBits               Points to the bitmap to check against an output gamut.</span>
01247 <span class="comment">        bmInput                 Specifies the input bitmap format.</span>
01248 <span class="comment">        dwWidth                 Specifies the number of pixels per scanline in the input bitmap.</span>
01249 <span class="comment">        dwHeight                Specifies the number of scanlines in the input bitmap.</span>
01250 <span class="comment">        dwStride                Specifies the number of bytes from the beginning of one scanline</span>
01251 <span class="comment">                                        to the beginning of the next in the input bitmap.</span>
01252 <span class="comment">                                        If dwStride is set to zero, the CMM should assume that scanlines</span>
01253 <span class="comment">                                        are padded so as to be DWORD-aligned.</span>
01254 <span class="comment">        lpaResult               Points to a buffer in which the test results are to be placed.</span>
01255 <span class="comment">                                        The results are represented by an array of bytes.</span>
01256 <span class="comment">                                        Each byte in the array corresponds to a pixel in the bitmap,</span>
01257 <span class="comment">                                        and on exit is set to an unsigned value between 0 and 255.</span>
01258 <span class="comment">                                        The value 0 denotes that the color is in gamut,</span>
01259 <span class="comment">                                        while a nonzero value denotes that it is out of gamut.</span>
01260 <span class="comment">                                        For any integer n such that 0 &lt; n &lt; 255, a result value of n+1</span>
01261 <span class="comment">                                        indicates that the corresponding color is at least as far out of</span>
01262 <span class="comment">                                        gamut as would be indicated by a result value of n.</span>
01263 <span class="comment">                                        These values are usually generated from the gamutTag in the ICC profile.</span>
01264 <span class="comment">        pfnCallback             Pointer to an application-supplied callback function called periodically</span>
01265 <span class="comment">                                        by CMCheckRGBs to report progress and allow the calling process</span>
01266 <span class="comment">                                        to cancel the translation. (See ICMProgressProc.)</span>
01267 <span class="comment">        ulCallbackData  Data passed back to the callback function, for example to identify</span>
01268 <span class="comment">                                        the bitmap test that is reporting progress.</span>
01269 <span class="comment"></span>
01270 <span class="comment">Returns</span>
01271 <span class="comment">        If the function is successful, the return value is nonzero.</span>
01272 <span class="comment">        Otherwise it is zero.</span>
01273 <span class="comment">        The lpaResult array holds the results, each byte corresponds to a pixel</span>
01274 <span class="comment">        and has a value between 0 and 255. The value 0 denotes that the color is in gamut;</span>
01275 <span class="comment">        a non-zero value implies that it is out of gamut, with the number "n+1" being at</span>
01276 <span class="comment">        least as far out of gamut as the number "n". These values are usually generated</span>
01277 <span class="comment">        from the gamutTag in the ICC profile.</span>
01278 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01279"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a40">01279</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a39">CMCheckRGBs</a>(       HCMTRANSFORM    hcmTransform,
01280                                                         LPVOID                  lpSrcBits,
01281                                                         BMFORMAT                bmInput,
01282                                                         DWORD                   dwWidth,
01283                                                         DWORD                   dwHeight,
01284                                                         DWORD                   dwStride,
01285                                                         LPBYTE                  lpDestBits,
01286                                                         PBMCALLBACKFN   pfnCallback,    
01287                                                         LPARAM          ulCallbackData )
01288 
01289 {
01290         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a>              spaceIn,spaceOut;
01291         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                                InBitmap,OutBitmap;
01292         <span class="keywordtype">long</span> matchErr, inPixelSize;
01293         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> aBgrMode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01294 
01295         spaceIn = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( bmInput, &amp;inPixelSize );
01296         <span class="keywordflow">if</span>( spaceIn == 0 ){
01297                 SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a34">cmInvalidColorSpace</a> );
01298                 <span class="keywordflow">return</span> 0;
01299         }
01300         spaceOut = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a65">cmGraySpace</a>;
01301 
01302         <span class="keywordflow">if</span>( spaceOut == 0 )<span class="keywordflow">return</span> 0;
01303         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>          = lpSrcBits;
01304         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>          = dwWidth;
01305         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>         = dwHeight;
01306         <span class="keywordflow">if</span>( dwStride == 0 ){
01307                 InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> = ( dwWidth * (inPixelSize / 8) + 3 ) &amp; ~3;
01308         }
01309         <span class="keywordflow">else</span>{
01310                 InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>       = dwStride;
01311         }
01312         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>      = inPixelSize;
01313         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>          = spaceIn;
01314                 
01315         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>         = lpDestBits;
01316         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>         = dwWidth;
01317         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>        = dwHeight;
01318         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>      = dwWidth;      <span class="comment">// perhaps wrong format?</span>
01319         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>     = 8;
01320         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>         = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a67">cmGamutResultSpace</a>;
01321 
01322         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a1">CWCheckBitmap</a>(       <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform ), &amp;InBitmap,
01323                                                                 (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>)pfnCallback,(<span class="keywordtype">void</span> *)ulCallbackData,&amp;OutBitmap );
01324         
01325         <span class="keywordflow">if</span>( matchErr ){
01326                 SetLastError( matchErr );
01327                 <span class="keywordflow">return</span> 0;
01328         }
01329         <span class="keywordflow">return</span> 1;
01330 }
01331 
01332 <span class="comment">/* ______________________________________________________________________</span>
01333 <span class="comment">BOOL WINAPI CMTranslateRGB(     HCMTRANSFORM    hcmTransform,</span>
01334 <span class="comment">                                                        COLORREF                colorRef,</span>
01335 <span class="comment">                                                        LPCOLORREF              lpColorRef,</span>
01336 <span class="comment">                                                        DWORD                   dwFlags );</span>
01337 <span class="comment">Abstract:</span>
01338 <span class="comment">        The CMTranslateRGB function translates an application supplied RGBQuad into the</span>
01339 <span class="comment">        device color coordinate space.</span>
01340 <span class="comment"></span>
01341 <span class="comment">Parameter                       Description</span>
01342 <span class="comment">        hcmTransform    Handle of transform to use.</span>
01343 <span class="comment">        colorRef                RGBQuad to translate.</span>
01344 <span class="comment">        lpColorRef              Pointer to buffer to store result.</span>
01345 <span class="comment">        dwFlags                 Flags that can have the following meaning</span>
01346 <span class="comment"></span>
01347 <span class="comment">        Type                    Meaning</span>
01348 <span class="comment">                </span>
01349 <span class="comment">        CMS_FORWARD             Specifies that the forward transform is to be used.</span>
01350 <span class="comment">        CMS_BACKWARD    Specifies that the backward transform is to be used.  // NOT supported</span>
01351 <span class="comment"></span>
01352 <span class="comment">Returns</span>
01353 <span class="comment">        The return value is TRUE if the function is successful. Otherwise, it is NULL.</span>
01354 <span class="comment"></span>
01355 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01356"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a41">01356</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a40">CMTranslateRGB</a>(     HCMTRANSFORM    hcmTransform,
01357                                                         COLORREF                colorRef,
01358                                                         LPCOLORREF              lpColorRef,
01359                                                         DWORD                   dwFlags )
01360 
01361 {
01362         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a>              spaceIn;
01363         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                                InBitmap,OutBitmap;
01364         <span class="keywordtype">long</span> matchErr;
01365         COLORREF aColorRef = colorRef;
01366         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> aBgrMode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01367         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a> In,Out;
01368         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> theModelPtr;
01369         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> theWorldRef;
01370         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a> theTransform = <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform );
01371         
01372         <span class="keywordflow">if</span>( <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> == <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a9">CMS_BACKWARD</a> ){
01373                 <span class="keywordflow">if</span>( theTransform == 0 ){
01374                         SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a> );
01375                         <span class="keywordflow">return</span> 0;
01376                 }
01377                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>( theTransform );
01378                 theModelPtr = (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( theTransform ));
01379                 theWorldRef = theModelPtr-&gt;pBackwardTransform;
01380                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>( theTransform );
01381                 <span class="keywordflow">if</span>( theWorldRef == 0 ){
01382                         SetLastError( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a> );
01383                         <span class="keywordflow">return</span> 0;
01384                 }
01385                 theTransform = (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)theWorldRef;
01386         }
01387 
01388         spaceIn = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a93">cmRGBA32Space</a>;
01389         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>          = (<span class="keywordtype">char</span> *)(&amp;aColorRef);
01390         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>          = 1;
01391         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>         = 1;
01392         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>       = 4;
01393         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>      = 32;
01394         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>          = spaceIn;
01395         OutBitmap = InBitmap;   
01396         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>         = (<span class="keywordtype">char</span> *)lpColorRef;
01397 
01398         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a7">CWGetColorSpaces</a>( theTransform, &amp;In, &amp;Out );
01399         <span class="keywordflow">if</span>( matchErr ){
01400                 SetLastError( matchErr );
01401                 <span class="keywordflow">return</span> 0;
01402         }
01403         <span class="keywordflow">if</span>( Out == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a118">icSigCmykData</a> ) OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a> = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a84">cmKYMC32Space</a>;
01404         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a0">CWMatchBitmap</a>(       theTransform, &amp;InBitmap,
01405                                                                 (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>)0,(<span class="keywordtype">void</span> *)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,&amp;OutBitmap );
01406         <span class="keywordflow">if</span>( matchErr ){
01407                 SetLastError( matchErr );
01408                 <span class="keywordflow">return</span> 0;
01409         }
01410         <span class="keywordflow">return</span> 1;
01411 }
01412 
01413 
01414 <span class="comment">/* ______________________________________________________________________</span>
01415 <span class="comment">BOOL WINAPI CMCheckColorsInGamut(       HCMTRANSFORM    hcmTransform,</span>
01416 <span class="comment">                                                                        LPARGBQUAD              lpaRGBTriplet,</span>
01417 <span class="comment">                                                                        LPBYTE                  lpBuffer,</span>
01418 <span class="comment">                                                                        UINT                    nCount );</span>
01419 <span class="comment">Abstract:</span>
01420 <span class="comment">        The CMCheckColorInGamut determines if the given RGBs lie in the output gamut of the</span>
01421 <span class="comment">        given transform.</span>
01422 <span class="comment"></span>
01423 <span class="comment">Parameter                       Description     </span>
01424 <span class="comment">        hcmTransform    Handle of transform to use.</span>
01425 <span class="comment">        lpaRGBTriples   Pointer to array of RGB triples to check.</span>
01426 <span class="comment">        lpBuffer                Pointer to buffer to put results.</span>
01427 <span class="comment">        nCount                  Count of elements in array.</span>
01428 <span class="comment"></span>
01429 <span class="comment"></span>
01430 <span class="comment">Returns</span>
01431 <span class="comment">        The return value is TRUE if the function is successful. Otherwise, it is NULL.</span>
01432 <span class="comment">        The lpBuffer holds the results, each byte corresponding to an RGB triple is a value in</span>
01433 <span class="comment">        the range 0 to 255.</span>
01434 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01435"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a42">01435</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a41">CMCheckColorsInGamut</a>(       HCMTRANSFORM    hcmTransform,
01436                                                                         RGBTRIPLE               *lpaRGBTriplet,
01437                                                                         LPBYTE                  lpBuffer,
01438                                                                         UINT                    nCount )
01439 {
01440         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                                InBitmap,OutBitmap;
01441         <span class="keywordtype">long</span> matchErr;
01442         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> aBgrMode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01443 
01444         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>          = (<span class="keywordtype">char</span> *)(lpaRGBTriplet);
01445         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>          = nCount;
01446         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>         = 1;
01447         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>       = 3*nCount;
01448         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>      = 24;
01449         InBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>          = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a56">cmRGBSpace</a>;
01450         OutBitmap = InBitmap;   
01451         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>      = nCount;       <span class="comment">// perhaps wrong format?</span>
01452         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>     = 8;
01453         OutBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>         = (<span class="keywordtype">char</span> *)lpBuffer;
01454 
01455         matchErr = <a class="code" href="../../d3/d8/w98_2lh__open_2pi__run_8c.html#a1">CWCheckBitmap</a>(       <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( hcmTransform ), &amp;InBitmap,
01456                                                                 (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>)0,(<span class="keywordtype">void</span> *)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,&amp;OutBitmap );
01457         <span class="keywordflow">if</span>( matchErr ){
01458                 SetLastError( matchErr );
01459                 <span class="keywordflow">return</span> 0;
01460         }
01461         <span class="keywordflow">return</span> 1;
01462 }
01463 <span class="comment">/* ______________________________________________________________________</span>
01464 <span class="comment">long FillProfileFromLog(        LPLOGCOLORSPACEA        lpColorSpace,</span>
01465 <span class="comment">                                                        PPROFILE                        theProf )</span>
01466 <span class="comment">Abstract:</span>
01467 <span class="comment">        The FillProfileFromLog function convertes a lpColorSpace to a PROFILE.</span>
01468 <span class="comment">        If lpColorSpace has a profile name the function returns a file based profile.</span>
01469 <span class="comment">        Else it returns a memory based profile.</span>
01470 <span class="comment"></span>
01471 <span class="comment">Parameter                       Description     </span>
01472 <span class="comment">        lpColorSpace    Handle of transform to use.</span>
01473 <span class="comment">        theProf                 Pointer to the profile.</span>
01474 <span class="comment"></span>
01475 <span class="comment">Returns</span>
01476 <span class="comment">        The return value is 0 if the function is successful. Otherwise, it is an error code.</span>
01477 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01478"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a17">01478</a> <span class="keywordtype">long</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a17">FillProfileFromLog</a>(        LPLOGCOLORSPACEA        lpColorSpace,
01479                                                         PPROFILE                        theProf )
01480 {
01481         <span class="keywordtype">long</span> l;
01482         <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *aProf;
01483         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>  err = -1;
01484 
01485         <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsFilename[0] ){
01486                 theProf-&gt;pProfileData = (<span class="keywordtype">char</span> *)lpColorSpace-&gt;lcsFilename;
01487                 theProf-&gt;dwType = PROFILE_FILENAME;
01488                 theProf-&gt;cbDataSize = lstrlenA((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)theProf-&gt;pProfileData) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
01489                 err = 0;
01490         }
01491         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsCSType == <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a17">LCS_CALIBRATED_RGB</a> ){
01492                 err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a1">MyNewAbstract</a>( lpColorSpace, &amp;aProf );
01493                 theProf-&gt;pProfileData = ((PVOID *)aProf);
01494                 theProf-&gt;dwType = PROFILE_MEMBUFFER;
01495                 l = *(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(theProf-&gt;pProfileData);
01496                 theProf-&gt;cbDataSize = SwapLong(&amp;l);
01497         }
01498         <span class="keywordflow">else</span>  theProf-&gt;pProfileData = 0;
01499 
01500         <span class="keywordflow">return</span> err;
01501 }
01502 
01503 <span class="comment">/* ______________________________________________________________________</span>
01504 <span class="comment">long FillProfileFromLogW(       LPLOGCOLORSPACEW        lpColorSpace,</span>
01505 <span class="comment">                                                        PPROFILE                        theProf )</span>
01506 <span class="comment">Abstract:</span>
01507 <span class="comment">        The FillProfileFromLog function convertes a lpColorSpace to a PROFILE.</span>
01508 <span class="comment">        If lpColorSpace has a profile name the function returns a file based profile.</span>
01509 <span class="comment">        Else it returns a memory based profile.</span>
01510 <span class="comment"></span>
01511 <span class="comment">Parameter                       Description     </span>
01512 <span class="comment">        lpColorSpace    Handle of transform to use.</span>
01513 <span class="comment">        theProf                 Pointer to the profile.</span>
01514 <span class="comment"></span>
01515 <span class="comment">Returns</span>
01516 <span class="comment">        The return value is 0 if the function is successful. Otherwise, it is an error code.</span>
01517 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l01518"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a18">01518</a> <span class="keywordtype">long</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a18">FillProfileFromLogW</a>(       LPLOGCOLORSPACEW        lpColorSpace,
01519                                                         PPROFILE                        theProf )
01520 {
01521         <span class="keywordtype">long</span> l;
01522         <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *aProf;
01523         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>  err = -1;
01524 
01525         <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsFilename[0] ){
01526                 theProf-&gt;pProfileData = (<span class="keywordtype">char</span> *)lpColorSpace-&gt;lcsFilename;
01527                 theProf-&gt;dwType = PROFILE_FILENAME;
01528                 theProf-&gt;cbDataSize = lstrlenW((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *)theProf-&gt;pProfileData) * <span class="keyword">sizeof</span>(WCHAR);
01529                 err = 0;
01530         }
01531         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( lpColorSpace-&gt;lcsCSType == <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a17">LCS_CALIBRATED_RGB</a> ){
01532                 err = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a0">MyNewAbstractW</a>( lpColorSpace, &amp;aProf );
01533                 theProf-&gt;pProfileData = ((PVOID *)aProf);
01534                 theProf-&gt;dwType = PROFILE_MEMBUFFER;
01535                 l = *(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(theProf-&gt;pProfileData);
01536                 theProf-&gt;cbDataSize = SwapLong(&amp;l);
01537         }
01538         <span class="keywordflow">else</span>  theProf-&gt;pProfileData = 0;
01539 
01540         <span class="keywordflow">return</span> err;
01541 }
01542 
01543 <span class="comment">/* ______________________________________________________________________</span>
01544 <span class="comment">CMBitmapColorSpace CMGetDataColorSpace( BMFORMAT bmMode, long *pixelSize );</span>
01545 <span class="comment"></span>
01546 <span class="comment">Abstract:</span>
01547 <span class="comment">        The CMGetDataColorSpace function retrieves the CMBitmapColorSpace and</span>
01548 <span class="comment">        the pixel size from the BMFORMAT.</span>
01549 <span class="comment"></span>
01550 <span class="comment">Parameter                       Description</span>
01551 <span class="comment">        bmMode                  Identifies the data format.</span>
01552 <span class="comment">        pixelSize               Pointer to pixelsize.</span>
01553 <span class="comment"></span>
01554 <span class="comment">Returns</span>
01555 <span class="comment">        function returns the internal data format</span>
01556 <span class="comment">________________________________________________________________ */</span>
<a name="l01557"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a21">01557</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a10">CMBitmapColorSpace</a> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a21">CMGetDataColorSpace</a>( BMFORMAT bmMode, <span class="keywordtype">long</span> *pixelSize )
01558 {
01559         <span class="keywordflow">switch</span>(  bmMode ){
01560         <span class="keywordflow">case</span> BM_565RGB:
01561                 *pixelSize = 16;
01562                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a45">cmWord565ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a56">cmRGBSpace</a>;
01563                 <span class="keywordflow">break</span>;
01564     <span class="keywordflow">case</span> BM_x555RGB:
01565                 *pixelSize = 16;
01566                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a44">cmWord5ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a56">cmRGBSpace</a>;
01567                 <span class="keywordflow">break</span>;
01568         <span class="keywordflow">case</span> BM_x555XYZ:
01569                 *pixelSize = 16;
01570                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a44">cmWord5ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a61">cmXYZSpace</a>;
01571                 <span class="keywordflow">break</span>;
01572         <span class="keywordflow">case</span> BM_x555Yxy:
01573                 *pixelSize = 16;
01574                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a44">cmWord5ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a60">cmYXYSpace</a>;
01575                 <span class="keywordflow">break</span>;
01576         <span class="keywordflow">case</span> BM_x555Lab:
01577                 *pixelSize = 16;
01578                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a44">cmWord5ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a63">cmLABSpace</a>;
01579                 <span class="keywordflow">break</span>;
01580         <span class="keywordflow">case</span> BM_x555G3CH:
01581                 *pixelSize = 16;
01582                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a44">cmWord5ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a68">cmGenericSpace</a>;
01583                 <span class="keywordflow">break</span>;
01584         <span class="keywordflow">case</span> BM_RGBTRIPLETS:
01585                 *pixelSize = 24;
01586                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a69">cmBGRSpace</a>;
01587                 <span class="keywordflow">break</span>;
01588         <span class="keywordflow">case</span> BM_BGRTRIPLETS:
01589                 *pixelSize = 24;
01590                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a56">cmRGBSpace</a>;
01591                 <span class="keywordflow">break</span>;
01592         <span class="keywordflow">case</span> BM_XYZTRIPLETS:
01593                 *pixelSize = 24;
01594                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a61">cmXYZSpace</a>;
01595                 <span class="keywordflow">break</span>;
01596         <span class="keywordflow">case</span> BM_YxyTRIPLETS:
01597                 *pixelSize = 24;
01598                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a60">cmYXYSpace</a>;
01599                 <span class="keywordflow">break</span>;
01600         <span class="keywordflow">case</span> BM_LabTRIPLETS:
01601                 *pixelSize = 24;
01602                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a63">cmLABSpace</a>;
01603                 <span class="keywordflow">break</span>;
01604         <span class="keywordflow">case</span> BM_G3CHTRIPLETS:
01605                 *pixelSize = 24;
01606                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a68">cmGenericSpace</a>;
01607                 <span class="keywordflow">break</span>;
01608         <span class="keywordflow">case</span> BM_5CHANNEL:
01609                 *pixelSize = 40;
01610                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a106">cmMCFive8Space</a>;
01611                 <span class="keywordflow">break</span>;
01612         <span class="keywordflow">case</span> BM_6CHANNEL:
01613                 *pixelSize = 48;
01614                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a107">cmMCSix8Space</a>;
01615                 <span class="keywordflow">break</span>;
01616         <span class="keywordflow">case</span> BM_7CHANNEL:
01617                 *pixelSize = 56;
01618                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a108">cmMCSeven8Space</a>;
01619                 <span class="keywordflow">break</span>;
01620         <span class="keywordflow">case</span> BM_8CHANNEL:
01621                 *pixelSize = 64;
01622                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a109">cmMCEight8Space</a>;
01623                 <span class="keywordflow">break</span>;
01624         <span class="keywordflow">case</span> BM_GRAY:
01625                 *pixelSize = 8;
01626                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a65">cmGraySpace</a>;
01627                 <span class="keywordflow">break</span>;
01628         <span class="keywordflow">case</span> BM_xRGBQUADS:
01629                 *pixelSize = 32;
01630                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a103">cmBGR32Space</a>;
01631                 <span class="keywordflow">break</span>;
01632         <span class="keywordflow">case</span> BM_xBGRQUADS:
01633                 *pixelSize = 32;
01634                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a93">cmRGBA32Space</a>;
01635                 <span class="keywordflow">break</span>;
01636 <span class="preprocessor">#if 0</span>
01637 <span class="preprocessor"></span>        <span class="keywordflow">case</span> BM_xXYZQUADS:
01638                 *pixelSize = 32;
01639                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a46">cmLong8ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a61">cmXYZSpace</a>;
01640                 <span class="keywordflow">break</span>;
01641         <span class="keywordflow">case</span> BM_xYxyQUADS:
01642                 *pixelSize = 32;
01643                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a46">cmLong8ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a60">cmYXYSpace</a>;
01644                 <span class="keywordflow">break</span>;
01645         <span class="keywordflow">case</span> BM_xLabQUADS:
01646                 *pixelSize = 32;
01647                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a46">cmLong8ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a63">cmLABSpace</a>;
01648                 <span class="keywordflow">break</span>;
01649 <span class="preprocessor">#endif</span>
01650 <span class="preprocessor"></span>    <span class="keywordflow">case</span> BM_xG3CHQUADS:
01651                 *pixelSize = 32;
01652                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a46">cmLong8ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a68">cmGenericSpace</a>;
01653                 <span class="keywordflow">break</span>;
01654         <span class="keywordflow">case</span> BM_CMYKQUADS:
01655                 *pixelSize = 32;
01656                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a46">cmLong8ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a76">cmKYMCSpace</a>;
01657                 <span class="keywordflow">break</span>;
01658         <span class="keywordflow">case</span> BM_KYMCQUADS:
01659                 *pixelSize = 32;
01660                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a46">cmLong8ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a57">cmCMYKSpace</a>;
01661                 <span class="keywordflow">break</span>;
01662         <span class="keywordflow">case</span> BM_10b_RGB:
01663                 *pixelSize = 32;
01664                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a47">cmLong10ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a56">cmRGBSpace</a>;
01665                 <span class="keywordflow">break</span>;
01666         <span class="keywordflow">case</span> BM_10b_XYZ:
01667                 *pixelSize = 32;
01668                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a47">cmLong10ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a61">cmXYZSpace</a>;
01669                 <span class="keywordflow">break</span>;
01670         <span class="keywordflow">case</span> BM_10b_Yxy:
01671                 *pixelSize = 32;
01672                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a47">cmLong10ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a60">cmYXYSpace</a>;
01673                 <span class="keywordflow">break</span>;
01674         <span class="keywordflow">case</span> BM_10b_Lab:
01675                 *pixelSize = 32;
01676                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a47">cmLong10ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a63">cmLABSpace</a>;
01677                 <span class="keywordflow">break</span>;
01678         <span class="keywordflow">case</span> BM_10b_G3CH:
01679                 *pixelSize = 32;
01680                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a47">cmLong10ColorPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a68">cmGenericSpace</a>;
01681                 <span class="keywordflow">break</span>;
01682         <span class="keywordflow">case</span> BM_16b_RGB:
01683                 *pixelSize = 48;
01684                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a69">cmBGRSpace</a>;
01685                 <span class="keywordflow">break</span>;
01686         <span class="keywordflow">case</span> BM_16b_XYZ:
01687                 *pixelSize = 48;
01688                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a61">cmXYZSpace</a>;
01689                 <span class="keywordflow">break</span>;
01690         <span class="keywordflow">case</span> BM_16b_Yxy:
01691                 *pixelSize = 48;
01692                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a60">cmYXYSpace</a>;
01693                 <span class="keywordflow">break</span>;
01694         <span class="keywordflow">case</span> BM_16b_Lab:
01695                 *pixelSize = 48;
01696                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a63">cmLABSpace</a>;
01697                 <span class="keywordflow">break</span>;
01698         <span class="keywordflow">case</span> BM_16b_G3CH:
01699                 *pixelSize = 48;
01700                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a> + <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a68">cmGenericSpace</a>;
01701                 <span class="keywordflow">break</span>;
01702         <span class="keywordflow">case</span> BM_16b_GRAY:
01703                 *pixelSize = 16;
01704                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a65">cmGraySpace</a>;
01705                 <span class="keywordflow">break</span>;
01706         <span class="keywordflow">case</span> BM_NAMED_INDEX:
01707                 *pixelSize = 32;
01708                 <span class="keywordflow">return</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a105">cmNamedIndexed32Space</a>;
01709                 <span class="keywordflow">break</span>;
01710         <span class="keywordflow">default</span>:
01711                 *pixelSize = 0;
01712                 <span class="keywordflow">return</span> 0;
01713         }
01714 }
01715 
01716 <span class="comment">/* ______________________________________________________________________</span>
01717 <span class="comment">HCMTRANSFORM  WINAPI CMGetTransform( HCMTRANSFORM       hcmTransform );</span>
01718 <span class="comment"></span>
01719 <span class="comment">Abstract:</span>
01720 <span class="comment">        The CMGetTransform function retrieves the actual transform out of the static array</span>
01721 <span class="comment">        in the critical section.</span>
01722 <span class="comment"></span>
01723 <span class="comment">Parameter                       Description</span>
01724 <span class="comment">        hcmTransform    Handle to the transform.</span>
01725 <span class="comment"></span>
01726 <span class="comment">Returns</span>
01727 <span class="comment">        the actual pointer to the transform</span>
01728 <span class="comment">________________________________________________________________ */</span>
<a name="l01729"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a22">01729</a> <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a22">CMGetTransform</a>( HCMTRANSFORM       hcmTransform )
01730 {
01731         <span class="keywordtype">long</span> actTransform = (<span class="keywordtype">long</span>)(ULONG_PTR)hcmTransform - 256;
01732         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a> aTrans = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01733 
01734         __try {
01735                 EnterCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
01736                 <span class="keywordflow">if</span>( actTransform &lt; IndexTransform &amp;&amp; actTransform &gt;= 0 ){
01737                         aTrans = <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[actTransform];
01738                 }
01739         }
01740         __finally{
01741                 LeaveCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
01742         }
01743     <span class="keywordflow">return</span> aTrans;
01744 }
01745 
01746 <span class="comment">/* ______________________________________________________________________</span>
01747 <span class="comment">CMWorldRef StoreTransform( CMWorldRef aRef );</span>
01748 <span class="comment"></span>
01749 <span class="comment">Abstract:</span>
01750 <span class="comment">        The StoreTransform function stores the actual transform in the static array</span>
01751 <span class="comment">        in the critical section.</span>
01752 <span class="comment"></span>
01753 <span class="comment">Parameter               Description</span>
01754 <span class="comment">        aRef            Ptr to the transform.</span>
01755 <span class="comment"></span>
01756 <span class="comment">Returns</span>
01757 <span class="comment">        valid (255 &lt; handle &lt; 65536 ) handle of the transform</span>
01758 <span class="comment">________________________________________________________________ */</span>
<a name="l01759"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a20">01759</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a20">StoreTransform</a>( CMWorldRef aRef )
01760 {
01761         <span class="keywordtype">long</span> i;
01762     <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a> cw = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01763         
01764         __try {
01765                 EnterCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
01766 
01767                 <span class="keywordflow">if</span>( <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a> &gt;= 1000 )<span class="keywordflow">return</span> (<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a7">HCMTRANSFORM</a>)ERROR_NOT_ENOUGH_MEMORY;
01768                 <span class="keywordflow">for</span>( i = 0; i&lt;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a> ; i++ ){
01769                         <span class="keywordflow">if</span>( <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[i] == 0 ){
01770                                 <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[i] = aRef;
01771                                 cw = (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a>)(ULONG_PTR)(i + 256 );
01772                         }
01773                 }
01774                 <span class="keywordflow">if</span>( i &gt;= <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a> ){
01775                         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a13">TheTransform</a>[<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a>] = aRef;
01776                         <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a>++;
01777                         cw = (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a28">CMWorldRef</a>)(ULONG_PTR)(<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a12">IndexTransform</a> - 1 + 256);
01778                 }
01779         }
01780         __finally{
01781                 LeaveCriticalSection(&amp;<a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a14">GlobalCriticalSection</a>);
01782         }
01783 
01784    <span class="keywordflow">return</span> cw;
01785 }
01786 
<a name="l01787"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a43">01787</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a42">CMConvertColorNameToIndex</a>( HPROFILE aProf, LPCOLOR_NAME aColorNameArr, LPDWORD aDWordArr, DWORD count )
01788 {
01789         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> err;
01790 
01791         err = <a class="code" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a143">CMConvNameToIndexProfile</a>( aProf, aColorNameArr, aDWordArr, count );
01792         <span class="keywordflow">if</span>( err ){
01793                 SetLastError( err );
01794                 <span class="keywordflow">return</span> 0;
01795         }
01796         <span class="keywordflow">return</span> 1;
01797 }
01798 
<a name="l01799"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a44">01799</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a43">CMConvertIndexToColorName</a>( HPROFILE aProf, LPDWORD aDWordArr, LPCOLOR_NAME aColorNameArr, DWORD count )
01800 {
01801         <span class="keywordtype">long</span> matchErr;
01802 
01803         matchErr = <a class="code" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a145">CMConvIndexToNameProfile</a>( aProf, aDWordArr, aColorNameArr, count );
01804         <span class="keywordflow">if</span>( matchErr ){
01805                 SetLastError( matchErr );
01806                 <span class="keywordflow">return</span> 0;
01807         }
01808         <span class="keywordflow">return</span> 1;
01809 }
01810 
<a name="l01811"></a><a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a45">01811</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  WINAPI <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a44">CMGetNamedProfileInfo</a>( HPROFILE aProf, LPNAMED_PROFILE_INFO Info )
01812 {
01813         <span class="keywordtype">long</span> matchErr;
01814 
01815         matchErr = <a class="code" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a147">CMGetNamedProfileInfoProfile</a>( aProf, (<a class="code" href="../../d9/d0/structtagCMNamedProfileInfo.html">pCMNamedProfileInfo</a>)Info );
01816         <span class="keywordflow">if</span>( matchErr ){
01817                 SetLastError( matchErr );
01818                 <span class="keywordflow">return</span> 0;
01819         }
01820         <span class="keywordflow">return</span> 1;
01821 }
01822 
01823 <span class="comment">/*</span>
01824 <span class="comment">CMBitmapColorSpace CMGetColorType( COLORTYPE bmMode, long *pixelSize )</span>
01825 <span class="comment">{</span>
01826 <span class="comment">        switch(  bmMode ){</span>
01827 <span class="comment">        case COLOR_GRAY:</span>
01828 <span class="comment">                *pixelSize = 16;</span>
01829 <span class="comment">                return cm16PerChannelPacking + cmGraySpace;</span>
01830 <span class="comment">                break;</span>
01831 <span class="comment">        case COLOR_     :</span>
01832 <span class="comment">        case COLOR_XYZ:</span>
01833 <span class="comment">        case COLOR_Yxy:</span>
01834 <span class="comment">        case COLOR_Lab:</span>
01835 <span class="comment">        case COLOR_3_CHANNEL:</span>
01836 <span class="comment">        case COLOR_CMYK:</span>
01837 <span class="comment">                *pixelSize = 64;</span>
01838 <span class="comment">                return cm16PerChannelPacking + cmRGBSpace;</span>
01839 <span class="comment">                break;</span>
01840 <span class="comment">        case COLOR_5_CHANNEL:</span>
01841 <span class="comment">        case COLOR_6_CHANNEL:</span>
01842 <span class="comment">        case COLOR_7_CHANNEL:</span>
01843 <span class="comment">        case COLOR_8_CHANNEL:</span>
01844 <span class="comment">                *pixelSize = 64;</span>
01845 <span class="comment">                return cm8PerChannelPacking + cmMCFiveSpace + bmMode - COLOR_5_CHANNEL;</span>
01846 <span class="comment">                break;</span>
01847 <span class="comment">        default:</span>
01848 <span class="comment">                *pixelSize = 0;</span>
01849 <span class="comment">                return 0;</span>
01850 <span class="comment">        }</span>
01851 <span class="comment">}</span>
01852 <span class="comment"></span>
01853 <span class="comment">#define CMS_x555WORD      0x00000000</span>
01854 <span class="comment">#define CMS_565WORD       0x00000001</span>
01855 <span class="comment">#define CMS_RGBTRIPLETS   0x00000002</span>
01856 <span class="comment">#define CMS_BGRTRIPLETS   0x00000004</span>
01857 <span class="comment">#define CMS_XRGBQUADS     0x00000008</span>
01858 <span class="comment">#define CMS_XBGRQUADS     0x00000010</span>
01859 <span class="comment">#define CMS_QUADS         0x00000020</span>
01860 <span class="comment"></span>
01861 <span class="comment">CMBitmapColorSpace CMGetCMSType( DWORD bmMode, long *pixelSize )</span>
01862 <span class="comment">{</span>
01863 <span class="comment">        if(  bmMode &amp; CMS_x555WORD ){</span>
01864 <span class="comment">                *pixelSize = 16;</span>
01865 <span class="comment">                return cmWord5ColorPacking + cmRGBSpace;</span>
01866 <span class="comment">        }</span>
01867 <span class="comment">        else if( bmMode &amp; CMS_RGBTRIPLETS ){</span>
01868 <span class="comment">                *pixelSize = 24;</span>
01869 <span class="comment">                return cm8PerChannelPacking + cmRGBSpace;</span>
01870 <span class="comment">        }</span>
01871 <span class="comment">        else if( bmMode &amp;  CMS_BGRTRIPLETS ){</span>
01872 <span class="comment">                *pixelSize = 24;</span>
01873 <span class="comment">                return cm8PerChannelPacking + cmBGRSpace;</span>
01874 <span class="comment">        }</span>
01875 <span class="comment">        else if( bmMode &amp;  CMS_XRGBQUADS ){</span>
01876 <span class="comment">                *pixelSize = 32;</span>
01877 <span class="comment">                return cmLong8ColorPacking + cmRGBSpace;</span>
01878 <span class="comment">        }</span>
01879 <span class="comment">        else if( bmMode &amp;  CMS_XBGRQUADS ){</span>
01880 <span class="comment">                *pixelSize = 32;</span>
01881 <span class="comment">                return cmLong8ColorPacking + cmBGRSpace;</span>
01882 <span class="comment">        }</span>
01883 <span class="comment">        else if( bmMode &amp;  CMS_QUADS     ){</span>
01884 <span class="comment">                *pixelSize = 32;</span>
01885 <span class="comment">                return cmLong8ColorPacking + cmCMYKSpace;</span>
01886 <span class="comment">        }</span>
01887 <span class="comment">        else{</span>
01888 <span class="comment">                *pixelSize = 0;</span>
01889 <span class="comment">                return 0;</span>
01890 <span class="comment">        }</span>
01891 <span class="comment">}</span>
01892 <span class="comment">*/</span>
01893 
01894 
01895 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:19 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
