<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ia64/flushtb.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flushtb.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include "<a class="el" href="../../d3/d0/mm_8h-source.html">mm.h</a>"</code><br>
<code>#include "<a class="el" href="../../d5/d7/mi_8h-source.html">..\..\mm\mi.h</a>"</code><br>

<p>
<a href="../../d0/d5/ia64_2flushtb_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a0">_x256mb</a>&nbsp;&nbsp;&nbsp;(1024*1024*256)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a1">KiFlushSingleTbGlobal</a>(Invalid, Va)&nbsp;&nbsp;&nbsp;__ptcga((__int64)Va, PAGE_SHIFT &lt;&lt; 2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a2">KiFlushSingleTbLocal</a>(Invalid, va)&nbsp;&nbsp;&nbsp;__ptcl((__int64)va, PAGE_SHIFT &lt;&lt; 2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a3">KiTbSynchronizeGlobal</a>()&nbsp;&nbsp;&nbsp;{ __mf(); __isrlz(); }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a4">KiTbSynchronizeLocal</a>()&nbsp;&nbsp;&nbsp;{  __isrlz(); }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a5">KiFlush2gbTbGlobal</a>(Invalid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a6">KiFlush2gbTbLocal</a>(Invalid)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a9">KiSetProcessRid</a> (ULONG NewProcessRid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a10">KiSetRegionRegister</a> (PVOID VirtualAddress, ULONGLONG Contents)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a11">KiFlushEntireTbTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a12">KiInvalidateForwardProgressTbBuffer</a> (KAFFINITY TargetProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a13">KiFlushForwardProgressTbBuffer</a> (KAFFINITY TargetProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a14">KiFlushForwardProgressTbBufferLocal</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a15">KeFlushEntireTb</a> (IN BOOLEAN Invalid, IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a16">KeFlushMultipleTb</a> (IN ULONG Number, IN PVOID *Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE *PtePointer OPTIONAL, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HARDWARE_PTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a17">KeFlushSingleTb</a> (IN PVOID Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE PtePointer, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a18">KiGetNewRid</a> (IN PULONG ProcessNewRid, IN PULONGLONG ProcessNewSequence)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a7">KiTbBroadcastLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ia64_2flushtb_8c.html#a8">KiMasterRidLock</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ia64/flushtb.c::_x256mb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define _x256mb&nbsp;&nbsp;&nbsp;(1024*1024*256)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00031">31</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mm_2ia64_2initia64_8c-source.html#l00277">MiInitMachineDependent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ia64/flushtb.c::KiFlush2gbTbGlobal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiFlush2gbTbGlobal          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Invalid&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{ \
    __ptcga((__int64)0, 28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb, 28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb*2,28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb*3, 28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb*4, 28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb*5, 28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb*6, 28 &lt;&lt; 2); \
    __ptcg((__int64)_x256mb*7, 28 &lt;&lt; 2); \
  }
</div></pre>
<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00043">43</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ia64/flushtb.c::KiFlush2gbTbLocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiFlush2gbTbLocal          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Invalid&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{ \
    __ptcl((__int64)0, 28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb, 28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb*2,28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb*3, 28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb*4, 28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb*5, 28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb*6, 28 &lt;&lt; 2); \
    __ptcl((__int64)_x256mb*7, 28 &lt;&lt; 2); \
  }
</div></pre>
<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00055">55</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ia64/flushtb.c::KiFlushSingleTbGlobal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiFlushSingleTbGlobal          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Invalid,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Va&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;__ptcga((__int64)Va, PAGE_SHIFT &lt;&lt; 2)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00035">35</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00644">KiFlushForwardProgressTbBuffer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ia64/flushtb.c::KiFlushSingleTbLocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiFlushSingleTbLocal          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Invalid,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>va&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;__ptcl((__int64)va, PAGE_SHIFT &lt;&lt; 2)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00037">37</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00706">KiFlushForwardProgressTbBufferLocal()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ia64/flushtb.c::KiTbSynchronizeGlobal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiTbSynchronizeGlobal          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{ __mf(); __isrlz(); }</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00039">39</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ia64/flushtb.c::KiTbSynchronizeLocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiTbSynchronizeLocal          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{  __isrlz(); }</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00041">41</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a15" doxytag="ia64/flushtb.c::KeFlushEntireTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushEntireTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00109">109</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00188">KiFlushEntireTbTarget()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00595">KiInvalidateForwardProgressTbBuffer()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>.
<p>
<pre class="fragment"><div>00116                    :
00117 
00118     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer (TB) on all
00119     processors that are currently running threads which are children
00120     of the current process or flushes the entire translation buffer
00121     on all processors in the host configuration.
00122 
00123 Arguments:
00124 
00125     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies the reason for
00126         flushing the translation buffer.
00127 
00128     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00129         translation buffers are to be flushed.
00130 
00131 Return Value:
00132 
00133     None.
00134 
00135 
00136 --*/
00137 
00138 {
00139 
00140     KIRQL OldIrql;
00141     KAFFINITY TargetProcessors;
00142     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00143     BOOLEAN NeedTbFlush = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00144 
00145     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00146 
00147     OldIrql = KeRaiseIrqlToSynchLevel();
00148 
00149 <span class="preprocessor">#if !defined(NT_UP)</span>
00150 <span class="preprocessor"></span>    TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00151     TargetProcessors &amp;= PCR-&gt;NotMember;
00152     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00153         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00154                         KiFlushEntireTbTarget,
00155                         (PVOID)NeedTbFlush,
00156                         NULL,
00157                         NULL);
00158     }
00159 
00160     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Wow64Process != 0) {
00161         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a12">KiInvalidateForwardProgressTbBuffer</a>(TargetProcessors);
00162     }
00163 <span class="preprocessor">#endif</span>
00164 <span class="preprocessor"></span>
00165     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00166 
00167     <span class="comment">//</span>
00168     <span class="comment">// Wait until all target processors have finished.</span>
00169     <span class="comment">//</span>
00170 
00171 <span class="preprocessor">#if !defined(NT_UP)</span>
00172 <span class="preprocessor"></span>
00173     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00174         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00175     }
00176 
00177 <span class="preprocessor">#endif</span>
00178 <span class="preprocessor"></span>
00179     <span class="comment">//</span>
00180     <span class="comment">// Wait until all target processors have finished.</span>
00181     <span class="comment">//</span>
00182 
00183 <span class="preprocessor">#if defined(NT_UP)</span>
00184 <span class="preprocessor"></span>
00185     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00186 
00187 <span class="preprocessor">#else</span>
00188 <span class="preprocessor"></span>
00189     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00190         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00191     }
00192 
00193     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00194 
00195 <span class="preprocessor">#endif</span>
00196 <span class="preprocessor"></span>
00197     <span class="keywordflow">return</span>;
00198 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ia64/flushtb.c::KeFlushMultipleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushMultipleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE *PtePointer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">247</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00043">KiFlush2gbTbGlobal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00055">KiFlush2gbTbLocal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00644">KiFlushForwardProgressTbBuffer()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00706">KiFlushForwardProgressTbBufferLocal()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00035">KiFlushSingleTbGlobal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00037">KiFlushSingleTbLocal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00028">KiTbBroadcastLock</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00039">KiTbSynchronizeGlobal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00041">KiTbSynchronizeLocal</a>, <a class="el" href="../../d3/d8/miia64_8h-source.html#l03238">MI_ALTFLG_FLUSH2G</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00258                    :
00259 
00260     This function flushes multiple entries from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00261     on all processors that are currently running threads which are
00262     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes multiple entries from
00263     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00264 
00265     N.B. The specified <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> entries on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host
00266          configuration are always flushed since PowerPC TB <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> tagged by
00267          VSID and <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a52">translations</a> are held across context <span class="keywordflow">switch</span> boundaries.
00268 
00269 Arguments:
00270 
00271     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00272 
00273     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> addresses that
00274         are within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pages whose <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entries are to be
00275         flushed.
00276 
00277     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00278         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00279 
00280     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00281         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00282 
00283     PtePointer - Supplies an optional pointer to an array of pointers to
00284        page table entries that receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry
00285        value.
00286 
00287     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00288 
00289 Return Value:
00290 
00291     None.
00292 
00293 --*/
00294 
00295 {
00296 
00297     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00298     PKPRCB Prcb;
00299     KAFFINITY TargetProcessors;
00300     <a class="code" href="../../d8/d9/struct__WOW64__PROCESS.html">PWOW64_PROCESS</a> Wow64Process;
00301     KIRQL OldIrql;
00302     BOOLEAN Flush2gb = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00303 
00304 <span class="preprocessor">#if 0</span>
00305 <span class="preprocessor"></span>    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00306 <span class="preprocessor">#endif</span>
00307 <span class="preprocessor"></span>
00308     OldIrql = KeRaiseIrqlToSynchLevel();
00309 
00310     Wow64Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Wow64Process;
00311 
00312 <span class="preprocessor">#ifdef MI_ALTFLG_FLUSH2G</span>
00313 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; 
00314         ((Wow64Process-&gt;AltFlags &amp; <a class="code" href="../../d2/d9/miia64_8h.html#a239">MI_ALTFLG_FLUSH2G</a>) != 0)) { 
00315         Flush2gb = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00316     }
00317 <span class="preprocessor">#endif</span>
00318 <span class="preprocessor"></span>
00319     <span class="comment">//</span>
00320     <span class="comment">// If a page table entry address array is specified, then set the</span>
00321     <span class="comment">// specified page table entries to the specific value.</span>
00322     <span class="comment">//</span>
00323 
00324 <span class="preprocessor">#if !defined(NT_UP)</span>
00325 <span class="preprocessor"></span>
00326     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00327     TargetProcessors &amp;= PCR-&gt;NotMember;
00328 
00329     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00330 
00331         <span class="comment">//</span>
00332         <span class="comment">// Acquire a global lock. Only one processor at a time can issue</span>
00333         <span class="comment">// a PTC.G operation.</span>
00334         <span class="comment">//</span>
00335 
00336         KiAcquireSpinLock(&amp;KiTbBroadcastLock);
00337 
00338         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00339             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00340                 *PtePointer[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = PteValue;
00341             }
00342 
00343             <span class="comment">//</span>
00344             <span class="comment">// Flush the specified TB on each processor. Hardware automatically</span>
00345             <span class="comment">// perform broadcasts if MP.</span>
00346             <span class="comment">//</span>
00347 
00348             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a1">KiFlushSingleTbGlobal</a>(Invalid, Virtual[Index]);
00349         }
00350 
00351         <span class="keywordflow">if</span> (Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00352             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a13">KiFlushForwardProgressTbBuffer</a>(TargetProcessors);
00353         }
00354 
00355         <span class="keywordflow">if</span> (Flush2gb == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00356             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a5">KiFlush2gbTbGlobal</a>(Invalid);
00357         }
00358 
00359         <span class="comment">//</span>
00360         <span class="comment">// Wait for the broadcast to be complete.</span>
00361         <span class="comment">//</span>
00362 
00363         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a3">KiTbSynchronizeGlobal</a>();
00364 
00365         KiReleaseSpinLock(&amp;KiTbBroadcastLock);
00366 
00367     }
00368     <span class="keywordflow">else</span> {
00369 
00370         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00371             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00372                 *PtePointer[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = PteValue;
00373             }
00374 
00375             <span class="comment">//</span>
00376             <span class="comment">// Flush the specified TB on the local processor.  No broadcast is</span>
00377             <span class="comment">// performed.</span>
00378             <span class="comment">//</span>
00379 
00380             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a2">KiFlushSingleTbLocal</a>(Invalid, Virtual[Index]);
00381         }
00382 
00383         <span class="keywordflow">if</span> (Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00384             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a14">KiFlushForwardProgressTbBufferLocal</a>();
00385         }
00386 
00387         <span class="keywordflow">if</span> (Flush2gb == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00388             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a6">KiFlush2gbTbLocal</a>(Invalid);
00389         }
00390 
00391         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a4">KiTbSynchronizeLocal</a>();
00392     }
00393 
00394 <span class="preprocessor">#else</span>
00395 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00396         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00397            *PtePointer[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = PteValue;
00398         }
00399 
00400         <span class="comment">//</span>
00401         <span class="comment">// Flush the specified TB on the local processor.  No broadcast is</span>
00402         <span class="comment">// performed.</span>
00403         <span class="comment">//</span>
00404 
00405         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a2">KiFlushSingleTbLocal</a>(Invalid, Virtual[Index]);
00406     }
00407 
00408     <span class="keywordflow">if</span> (Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00409         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a14">KiFlushForwardProgressTbBufferLocal</a>();
00410     }
00411 
00412     <span class="keywordflow">if</span> (Flush2gb == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00413         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a6">KiFlush2gbTbLocal</a>(Invalid);
00414     }
00415 
00416     <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a4">KiTbSynchronizeLocal</a>();
00417 
00418 <span class="preprocessor">#endif</span>
00419 <span class="preprocessor"></span>
00420     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00421 
00422     <span class="keywordflow">return</span>;
00423 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ia64/flushtb.c::KeFlushSingleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HARDWARE_PTE KeFlushSingleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PtePointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">427</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00043">KiFlush2gbTbGlobal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00055">KiFlush2gbTbLocal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00644">KiFlushForwardProgressTbBuffer()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00706">KiFlushForwardProgressTbBufferLocal()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00035">KiFlushSingleTbGlobal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00037">KiFlushSingleTbLocal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00028">KiTbBroadcastLock</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00039">KiTbSynchronizeGlobal</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00041">KiTbSynchronizeLocal</a>, <a class="el" href="../../d3/d8/miia64_8h-source.html#l03238">MI_ALTFLG_FLUSH2G</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
<pre class="fragment"><div>00437                    :
00438 
00439     This function flushes a single entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00440     on all processors that are currently running threads which are
00441     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a single entry from
00442     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00443 
00444     N.B. The specified <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> entry on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host
00445          configuration <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always flushed since PowerPC TB <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> tagged by
00446          VSID and <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a52">translations</a> are held across context <span class="keywordflow">switch</span> boundaries.
00447 
00448 Arguments:
00449 
00450     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> address that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page whose
00451         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be flushed.
00452 
00453     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00454         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00455 
00456     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00457         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00458 
00459     PtePointer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page table entry which
00460         receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified value.
00461 
00462     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00463 
00464 Return Value:
00465 
00466     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00467     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00468 
00469 --*/
00470 
00471 {
00472 
00473     HARDWARE_PTE OldPte;
00474     PKPRCB Prcb;
00475     KAFFINITY TargetProcessors;
00476     <a class="code" href="../../d8/d9/struct__WOW64__PROCESS.html">PWOW64_PROCESS</a> Wow64Process;
00477     KIRQL OldIrql;
00478     BOOLEAN Flush2gb = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00479 
00480 <span class="preprocessor">#if 0</span>
00481 <span class="preprocessor"></span>    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00482 <span class="preprocessor">#endif</span>
00483 <span class="preprocessor"></span>
00484     <span class="comment">//</span>
00485     <span class="comment">// Compute the target set of processors.</span>
00486     <span class="comment">//</span>
00487 
00488     OldIrql = KeRaiseIrqlToSynchLevel();
00489 
00490     <span class="comment">//</span>
00491     <span class="comment">// Check to see if it is the Wow64 process</span>
00492     <span class="comment">//</span>
00493 
00494     Wow64Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;Wow64Process;
00495 
00496 <span class="preprocessor">#ifdef MI_ALTFLG_FLUSH2G</span>
00497 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; 
00498         ((Wow64Process-&gt;AltFlags &amp; <a class="code" href="../../d2/d9/miia64_8h.html#a239">MI_ALTFLG_FLUSH2G</a>) != 0)) { 
00499         Flush2gb = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00500     }
00501 <span class="preprocessor">#endif</span>
00502 <span class="preprocessor"></span>
00503     <span class="comment">//</span>
00504     <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00505     <span class="comment">// page table entry to the new value.</span>
00506     <span class="comment">//</span>
00507 
00508     OldPte = *PtePointer;
00509     *PtePointer = PteValue;
00510 
00511 <span class="preprocessor">#if !defined(NT_UP)</span>
00512 <span class="preprocessor"></span>
00513     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00514     TargetProcessors &amp;= PCR-&gt;NotMember;
00515 
00516     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00517 
00518         <span class="comment">//</span>
00519         <span class="comment">// Flush the specified TB on each processor. Hardware automatically</span>
00520         <span class="comment">// perform broadcasts if MP.</span>
00521         <span class="comment">//</span>
00522 
00523         KiAcquireSpinLock(&amp;KiTbBroadcastLock);
00524 
00525         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a1">KiFlushSingleTbGlobal</a>(Invalid, Virtual);
00526 
00527         <span class="keywordflow">if</span> (Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00528             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a13">KiFlushForwardProgressTbBuffer</a>(TargetProcessors);
00529         }
00530 
00531         <span class="keywordflow">if</span> (Flush2gb) {
00532             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a5">KiFlush2gbTbGlobal</a>(Invalid);
00533         }
00534 
00535         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a3">KiTbSynchronizeGlobal</a>();
00536 
00537         KiReleaseSpinLock(&amp;KiTbBroadcastLock);
00538 
00539     }
00540     <span class="keywordflow">else</span> {
00541 
00542         <span class="comment">//</span>
00543         <span class="comment">// Flush the specified TB on the local processor.  No broadcast is</span>
00544         <span class="comment">// performed.</span>
00545         <span class="comment">//</span>
00546         
00547         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a2">KiFlushSingleTbLocal</a>(Invalid, Virtual);
00548 
00549         <span class="keywordflow">if</span> (Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00550             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a14">KiFlushForwardProgressTbBufferLocal</a>();
00551         }
00552 
00553         <span class="keywordflow">if</span> (Flush2gb == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) { 
00554             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a6">KiFlush2gbTbLocal</a>(Invalid);
00555         } 
00556 
00557         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a4">KiTbSynchronizeLocal</a>();
00558 
00559     }
00560 
00561 <span class="preprocessor">#else</span>
00562 <span class="preprocessor"></span>
00563     <span class="comment">//</span>
00564     <span class="comment">// Flush the specified entry from the TB on the local processor.</span>
00565     <span class="comment">//</span>
00566 
00567     <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a2">KiFlushSingleTbLocal</a>(Invalid, Virtual);
00568 
00569     <span class="keywordflow">if</span> (Wow64Process != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00570         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a14">KiFlushForwardProgressTbBufferLocal</a>();
00571     }
00572 
00573     <span class="keywordflow">if</span> (Flush2gb == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) { 
00574         <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a6">KiFlush2gbTbLocal</a>(Invalid);
00575     }
00576 
00577     <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a4">KiTbSynchronizeLocal</a>();
00578 
00579 <span class="preprocessor">#endif</span>
00580 <span class="preprocessor"></span>
00581     <span class="comment">//</span>
00582     <span class="comment">// Wait until all target processors have finished.</span>
00583     <span class="comment">//</span>
00584 
00585     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00586 
00587     <span class="comment">//</span>
00588     <span class="comment">// Return the previous page table entry value.</span>
00589     <span class="comment">//</span>
00590 
00591     <span class="keywordflow">return</span> OldPte;
00592 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ia64/flushtb.c::KiFlushEntireTbTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushEntireTbTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00203">203</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
<pre class="fragment"><div>00212                    :
00213 
00214     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire TB.
00215 
00216 Arguments:
00217 
00218     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00219         requested operation has been performed.
00220 
00221     Parameter1 - Parameter3 - Not used.
00222 
00223 Return Value:
00224 
00225     None.
00226 
00227 --*/
00228 
00229 {
00230 
00231 <span class="preprocessor">#if !defined(NT_UP)</span>
00232 <span class="preprocessor"></span>
00233     <span class="comment">//</span>
00234     <span class="comment">// Flush the entire TB on the current processor.</span>
00235     <span class="comment">//</span>
00236 
00237     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00238 
00239     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00240 
00241 <span class="preprocessor">#endif</span>
00242 <span class="preprocessor"></span>
00243     <span class="keywordflow">return</span>;
00244 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ia64/flushtb.c::KiFlushForwardProgressTbBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushForwardProgressTbBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">KAFFINITY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TargetProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00644">644</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00058">ClearMember</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02293">KeFindFirstSetRightMember</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00035">KiFlushSingleTbGlobal</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>.
<p>
<pre class="fragment"><div>00647 {
00648     PKPRCB Prcb;
00649     ULONG BitNumber;
00650     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> CurrentProcess;
00651     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> TargetProcess;
00652     PKPCR Pcr;
00653     ULONG i;
00654     PVOID Va;
00655     <span class="keyword">volatile</span> ULONGLONG *PointerPte;
00656 
00657     CurrentProcess = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process;
00658 
00659     <span class="comment">//</span>
00660     <span class="comment">// Flush the ForwardProgressTb buffer on the current processor</span>
00661     <span class="comment">//</span>
00662 
00663     <span class="keywordflow">for</span> (i = 0; i &lt; MAXIMUM_FWP_BUFFER_ENTRY; i += 1) {
00664         
00665         Va = (PVOID)PCR-&gt;ForwardProgressBuffer[i*2]; 
00666         PointerPte = &amp;PCR-&gt;ForwardProgressBuffer[(i*2)+1];
00667 
00668         <span class="keywordflow">if</span> (*PointerPte != 0) {
00669             *PointerPte = 0;
00670             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a1">KiFlushSingleTbGlobal</a>(Invalid, Va);
00671         }
00672 
00673     }
00674 
00675     <span class="comment">//</span>
00676     <span class="comment">// Flush the ForwardProgressTb buffer on all the processors</span>
00677     <span class="comment">//</span>
00678         
00679     <span class="keywordflow">while</span> (TargetProcessors != 0) {
00680 
00681         BitNumber = <a class="code" href="../../d4/d9/ke_8h.html#a39">KeFindFirstSetRightMember</a>(TargetProcessors);
00682         <a class="code" href="../../d0/d0/ki_8h.html#a6">ClearMember</a>(BitNumber, TargetProcessors);
00683         Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[BitNumber];
00684 
00685         Pcr = KSEG_ADDRESS(Prcb-&gt;PcrPage);
00686         
00687         TargetProcess = Pcr-&gt;CurrentThread-&gt;ApcState.Process;
00688 
00689         <span class="keywordflow">if</span> (TargetProcess == CurrentProcess) {
00690 
00691             <span class="keywordflow">for</span> (i = 0; i &lt; MAXIMUM_FWP_BUFFER_ENTRY; i += 1) {
00692                 
00693                 Va = (PVOID)Pcr-&gt;ForwardProgressBuffer[i*2]; 
00694                 PointerPte = &amp;Pcr-&gt;ForwardProgressBuffer[(i*2)+1];
00695 
00696                 <span class="keywordflow">if</span> (*PointerPte != 0) {
00697                     *PointerPte = 0;
00698                     <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a1">KiFlushSingleTbGlobal</a>(Invalid, Va);
00699                 }
00700             }
00701         }
00702     }
00703 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ia64/flushtb.c::KiFlushForwardProgressTbBufferLocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushForwardProgressTbBufferLocal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00706">706</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00037">KiFlushSingleTbLocal</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, and <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>.
<p>
<pre class="fragment"><div>00709 {
00710     ULONG i;
00711     PVOID Va;
00712     <span class="keyword">volatile</span> ULONGLONG *PointerPte;
00713 
00714     <span class="comment">//</span>
00715     <span class="comment">// Flush the ForwardProgressTb buffer on the current processor</span>
00716     <span class="comment">//</span>
00717 
00718     <span class="keywordflow">for</span> (i = 0; i &lt; MAXIMUM_FWP_BUFFER_ENTRY; i += 1) {
00719         
00720         Va = (PVOID)PCR-&gt;ForwardProgressBuffer[i*2]; 
00721         PointerPte = &amp;PCR-&gt;ForwardProgressBuffer[(i*2)+1];
00722 
00723         <span class="keywordflow">if</span> (*PointerPte != 0) {
00724             *PointerPte = 0;
00725             <a class="code" href="../../d9/d5/ia64_2flushtb_8c.html#a2">KiFlushSingleTbLocal</a>(Invalid, Va);
00726         }
00727 
00728     }
00729 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ia64/flushtb.c::KiGetNewRid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KiGetNewRid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessNewRid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessNewSequence</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00733">733</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00188">KiFlushEntireTbTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00740                     :
00741 
00742     Generate a <span class="keyword">new</span> region <span class="keywordtype">id</span>. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> region <span class="keywordtype">id</span> wraps then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TBs of
00743     all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processors need to be flushed.
00744 
00745  Arguments:
00746 
00747     ProcessNewRid (a0) - Supplies a pointer to rid of <span class="keyword">new</span> process (64-bit).
00748 
00749     ProcessNewSeqNum (a1) - Pointer to <span class="keyword">new</span> process sequence number (64-bit).
00750 
00751  Return Value:
00752 
00753     New rid value
00754 
00755  Notes:
00756 
00757     This routine called by <a class="code" href="../../d0/d0/ki_8h.html#a137">KiSwapProcess</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a>.
00758 
00759  Environment:
00760 
00761     Kernel mode.
00762     KiLockDispaterLock or LockQueuedDispatcherLock <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> held
00763 
00764 --*/
00765 
00766 {
00767 
00768     ULONG NewRid;
00769     KAFFINITY TargetProcessors;
00770 
00771     KiMasterRid += 1;
00772 
00773     <span class="keywordflow">if</span> (KiMasterRid &lt;= MAXIMUM_RID) {
00774 
00775         <span class="comment">//</span>
00776         <span class="comment">// Update Process-&gt;ProcessRid and Process-&gt;ProcessSequence.</span>
00777         <span class="comment">//</span>
00778 
00779         *ProcessNewRid = KiMasterRid;
00780         *ProcessNewSequence = KiMasterSequence;
00781 
00782         <span class="keywordflow">return</span> (*ProcessNewRid);
00783     }
00784 
00785     <span class="comment">//</span>
00786     <span class="comment">// Region ID must be recycled.</span>
00787     <span class="comment">//</span>
00788 
00789 
00790     KiMasterRid = START_PROCESS_RID;
00791 
00792     KiMasterSequence += 1;
00793 
00794     <span class="keywordflow">if</span> (KiMasterSequence &gt; MAXIMUM_SEQUENCE) {
00795 
00796         KiMasterSequence = START_SEQUENCE;
00797 
00798     }
00799 
00800     <span class="comment">//</span>
00801     <span class="comment">// Update new process's ProcessRid and ProcessSequence.</span>
00802     <span class="comment">//</span>
00803 
00804     *ProcessNewRid = KiMasterRid;
00805     *ProcessNewSequence = KiMasterSequence;
00806 
00807 <span class="preprocessor">#if !defined(NT_UP)</span>
00808 <span class="preprocessor"></span>
00809     <span class="comment">//</span>
00810     <span class="comment">// Broadcast TB flush.</span>
00811     <span class="comment">//</span>
00812 
00813     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>;
00814     TargetProcessors &amp;= PCR-&gt;NotMember;
00815     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00816         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00817                         KiFlushEntireTbTarget,
00818                         (PVOID)TRUE,
00819                         NULL,
00820                         NULL);
00821     }
00822 
00823 <span class="preprocessor">#endif</span>
00824 <span class="preprocessor"></span>
00825     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00826 
00827 
00828 <span class="preprocessor">#if !defined(NT_UP)</span>
00829 <span class="preprocessor"></span>
00830     <span class="comment">//</span>
00831     <span class="comment">// Wait until all target processors have finished.</span>
00832     <span class="comment">//</span>
00833 
00834     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00835         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00836     }
00837 
00838 <span class="preprocessor">#endif</span>
00839 <span class="preprocessor"></span>
00840     <span class="keywordflow">return</span> *ProcessNewRid;
00841 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ia64/flushtb.c::KiInvalidateForwardProgressTbBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInvalidateForwardProgressTbBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">KAFFINITY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TargetProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00595">595</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00058">ClearMember</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02293">KeFindFirstSetRightMember</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00109">KeFlushEntireTb()</a>.
<p>
<pre class="fragment"><div>00598 {
00599     PKPRCB Prcb;
00600     ULONG BitNumber;
00601     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> CurrentProcess;
00602     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> TargetProcess;
00603     PKPCR Pcr;
00604     ULONG i;
00605 
00606     CurrentProcess = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process;
00607 
00608     <span class="comment">//</span>
00609     <span class="comment">// Invalidate the ForwardProgressTb buffer on the current processor</span>
00610     <span class="comment">//</span>
00611 
00612     <span class="keywordflow">for</span> (i = 0; i &lt; MAXIMUM_FWP_BUFFER_ENTRY; i += 1) {
00613         
00614         PCR-&gt;ForwardProgressBuffer[(i*2)+1] = 0;
00615 
00616     }
00617 
00618     <span class="comment">//</span>
00619     <span class="comment">// Invalidate the ForwardProgressTb buffer on all the other processors</span>
00620     <span class="comment">//</span>
00621 
00622     <span class="keywordflow">while</span> (TargetProcessors != 0) {
00623 
00624         BitNumber = <a class="code" href="../../d4/d9/ke_8h.html#a39">KeFindFirstSetRightMember</a>(TargetProcessors);
00625         <a class="code" href="../../d0/d0/ki_8h.html#a6">ClearMember</a>(BitNumber, TargetProcessors);
00626         Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[BitNumber];
00627 
00628         Pcr = KSEG_ADDRESS(Prcb-&gt;PcrPage);
00629         
00630         TargetProcess = Pcr-&gt;CurrentThread-&gt;ApcState.Process;
00631 
00632         <span class="keywordflow">if</span> (TargetProcess == CurrentProcess) {
00633 
00634             <span class="keywordflow">for</span> (i = 0; i &lt; MAXIMUM_FWP_BUFFER_ENTRY; i += 1) {
00635                 
00636                 Pcr-&gt;ForwardProgressBuffer[(i*2)+1] = 0;
00637 
00638             }
00639         }
00640     }
00641 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ia64/flushtb.c::KiSetProcessRid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSetProcessRid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewProcessRid</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ia64/flushtb.c::KiSetRegionRegister" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSetRegionRegister           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Contents</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a8" doxytag="ia64/flushtb.c::KiMasterRidLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d8/d2/ia64_2initkr_8c.html#a1">KiMasterRidLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00029">29</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00543">KeDetachSessionSpace()</a>, <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00122">KiSyncNewRegionId()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00041">KiSyncNewRegionIdTarget()</a>, and <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00468">KiSyncSessionTarget()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ia64/flushtb.c::KiTbBroadcastLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d8/d2/ia64_2initkr_8c.html#a0">KiTbBroadcastLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00028">28</a> of file <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html">ia64/flushtb.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>, and <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
