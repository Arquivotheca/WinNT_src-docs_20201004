<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ex/lookasid.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lookasid.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>

<p>
<a href="../../d0/d5/ex_2lookasid_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a0">MAXIMUM_SCAN_PERIOD</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a2">MINIMUM_ALLOCATION_THRESHOLD</a>&nbsp;&nbsp;&nbsp;25</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a10">ExpComputeLookasideDepth</a> (IN ULONG Allocates, IN ULONG Misses, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> MaximumDepth, IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a> Depth)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a11">ExpDummyAllocate</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T NumberOfBytes, IN ULONG Tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a12">ExpScanGeneralLookasideList</a> (IN PLIST_ENTRY ListHead, IN PKSPIN_LOCK SpinLock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a13">ExpScanPoolLookasideList</a> (IN PLIST_ENTRY ListHead)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a14">ExAdjustLookasideDepth</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a15">ExInitializeNPagedLookasideList</a> (IN <a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a> Lookaside, IN <a class="el" href="../../d5/d8/ex_8h.html#a100">PALLOCATE_FUNCTION</a> Allocate, IN <a class="el" href="../../d5/d8/ex_8h.html#a101">PFREE_FUNCTION</a> Free, IN ULONG Flags, IN SIZE_T <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN ULONG Tag, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Depth)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a16">ExDeleteNPagedLookasideList</a> (IN <a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a> Lookaside)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a17">ExInitializePagedLookasideList</a> (IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a> Lookaside, IN <a class="el" href="../../d5/d8/ex_8h.html#a100">PALLOCATE_FUNCTION</a> Allocate, IN <a class="el" href="../../d5/d8/ex_8h.html#a101">PFREE_FUNCTION</a> Free, IN ULONG Flags, IN SIZE_T <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN ULONG Tag, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Depth)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a18">ExDeletePagedLookasideList</a> (IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a> Lookaside)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a19">ExAllocateFromPagedLookasideList</a> (IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a> Lookaside)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a20">ExFreeToPagedLookasideList</a> (IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a> Lookaside, IN PVOID Entry)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a3">ExNPagedLookasideListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a4">ExNPagedLookasideLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a5">ExPagedLookasideListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a6">ExPagedLookasideLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a7">ExPoolLookasideListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a> = 1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a9">ExpCurrentScanPeriod</a> = 1</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ex/lookasid.c::MAXIMUM_SCAN_PERIOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAXIMUM_SCAN_PERIOD&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00027">27</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ex/lookasid.c::MINIMUM_ALLOCATION_THRESHOLD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MINIMUM_ALLOCATION_THRESHOLD&nbsp;&nbsp;&nbsp;25          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00039">39</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00161">ExpComputeLookasideDepth()</a>, and <a class="el" href="../../d1/d5/rtl_2lookasid_8c-source.html#l00130">RtlpAdjustHeapLookasideDepth()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ex/lookasid.c::MINIMUM_LOOKASIDE_DEPTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MINIMUM_LOOKASIDE_DEPTH&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00033">33</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">ExInitializeNPagedLookasideList()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">ExInitializePagedLookasideList()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00161">ExpComputeLookasideDepth()</a>, <a class="el" href="../../d1/d5/rtl_2lookasid_8c-source.html#l00130">RtlpAdjustHeapLookasideDepth()</a>, and <a class="el" href="../../d1/d5/rtl_2lookasid_8c-source.html#l00045">RtlpInitializeHeapLookaside()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a14" doxytag="ex/lookasid.c::ExAdjustLookasideDepth" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExAdjustLookasideDepth           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">89</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d5/d9/exp_8h-source.html#l00262">ExNPagedLookasideListHead</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00263">ExNPagedLookasideLock</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00085">ExpAdjustScanPeriod</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00264">ExPagedLookasideListHead</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00265">ExPagedLookasideLock</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00086">ExpCurrentScanPeriod</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00266">ExPoolLookasideListHead</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00251">ExpScanGeneralLookasideList()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00340">ExpScanPoolLookasideList()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00027">MAXIMUM_SCAN_PERIOD</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00142">KeBalanceSetManager()</a>.
<p>
<pre class="fragment"><div>00095                    :
00096 
00097     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called periodically to adjust <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum depth of
00098     all lookaside lists.
00099 
00100 Arguments:
00101 
00102     None.
00103 
00104 Return Value:
00105 
00106     None.
00107 
00108 --*/
00109 
00110 {
00111 
00112     LOGICAL Changes;
00113 
00114     <span class="comment">//</span>
00115     <span class="comment">// Decrement the scan period and check if it is time to dynamically</span>
00116     <span class="comment">// adjust the maximum depth of lookaside lists.</span>
00117     <span class="comment">//</span>
00118 
00119     <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a9">ExpCurrentScanPeriod</a> -= 1;
00120     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a9">ExpCurrentScanPeriod</a> == 0) {
00121         Changes = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122 
00123         <span class="comment">//</span>
00124         <span class="comment">// Scan the general paged and nonpaged lookaside lists.</span>
00125         <span class="comment">//</span>
00126 
00127         Changes |= <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a12">ExpScanGeneralLookasideList</a>(&amp;ExNPagedLookasideListHead,
00128                                                &amp;ExNPagedLookasideLock);
00129 
00130         Changes |= <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a12">ExpScanGeneralLookasideList</a>(&amp;ExPagedLookasideListHead,
00131                                                &amp;ExPagedLookasideLock);
00132 
00133         <span class="comment">//</span>
00134         <span class="comment">// Scan the pool paged and nonpaged lookaside lists;</span>
00135         <span class="comment">//</span>
00136 
00137         Changes |= <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a13">ExpScanPoolLookasideList</a>(&amp;ExPoolLookasideListHead);
00138 
00139         <span class="comment">//</span>
00140         <span class="comment">// If any changes were made to the depth of any lookaside list during</span>
00141         <span class="comment">// this scan period, then lower the scan period to the minimum value.</span>
00142         <span class="comment">// Otherwise, attempt to raise the scan period.</span>
00143         <span class="comment">//</span>
00144 
00145         <span class="keywordflow">if</span> (Changes != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00146             <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a> = 1;
00147 
00148         } <span class="keywordflow">else</span> {
00149             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a> != <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a0">MAXIMUM_SCAN_PERIOD</a>) {
00150                 <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a> += 1;
00151             }
00152         }
00153 
00154         <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a9">ExpCurrentScanPeriod</a> = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a>;
00155     }
00156 
00157     <span class="keywordflow">return</span>;
00158 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ex/lookasid.c::ExAllocateFromPagedLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ExAllocateFromPagedLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Lookaside</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00681">681</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a242">ExInterlockedPopEntrySList()</a>, <a class="el" href="../../d6/d2/i386_8h-source.html#l02725">Isx86FeaturePresent</a>, <a class="el" href="../../d6/d2/i386_8h-source.html#l02709">KF_CMPXCHG8B</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00687                    :
00688 
00689     This function removes (pops) the first entry from the specified
00690     paged lookaside list.
00691 
00692 Arguments:
00693 
00694     Lookaside - Supplies a pointer to a paged lookaside list structure.
00695 
00696 Return Value:
00697 
00698     If an entry is removed from the specified lookaside list, then the
00699     address of the entry is returned as the function value. Otherwise,
00700     NULL is returned.
00701 
00702 --*/
00703 
00704 {
00705 
00706     PVOID Entry;
00707 
00708     Lookaside-&gt;L.TotalAllocates += 1;
00709 
00710     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d3/i386_8h.html#a16">Isx86FeaturePresent</a>(KF_CMPXCHG8B)) {
00711         <span class="keywordflow">if</span> ((Entry = <a class="code" href="../../d5/d8/ex_8h.html#a242">ExInterlockedPopEntrySList</a>(&amp;Lookaside-&gt;L.ListHead,
00712                                                 NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00713 
00714             Lookaside-&gt;L.AllocateMisses += 1;
00715             Entry = (Lookaside-&gt;L.Allocate)(Lookaside-&gt;L.Type,
00716                                             Lookaside-&gt;L.Size,
00717                                             Lookaside-&gt;L.Tag);
00718         }
00719 
00720         <span class="keywordflow">return</span> Entry;
00721     }
00722 
00723     ExAcquireFastMutex(&amp;Lookaside-&gt;Lock);
00724     Entry = PopEntryList(&amp;Lookaside-&gt;L.ListHead.Next);
00725     <span class="keywordflow">if</span> (Entry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00726         ExReleaseFastMutex(&amp;Lookaside-&gt;Lock);
00727         Lookaside-&gt;L.AllocateMisses += 1;
00728         Entry = (Lookaside-&gt;L.Allocate)(Lookaside-&gt;L.Type,
00729                                         Lookaside-&gt;L.Size,
00730                                         Lookaside-&gt;L.Tag);
00731 
00732     } <span class="keywordflow">else</span> {
00733         Lookaside-&gt;L.ListHead.Depth -= 1;
00734         ExReleaseFastMutex(&amp;Lookaside-&gt;Lock);
00735     }
00736 
00737     <span class="keywordflow">return</span> Entry;
00738 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ex/lookasid.c::ExDeleteNPagedLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExDeleteNPagedLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Lookaside</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00494">494</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00780">ExAllocateFromNPagedLookasideList()</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00263">ExNPagedLookasideLock</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00802">ExpDummyAllocate()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00500                    :
00501 
00502     This function removes a paged lookaside structure from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system paged
00503     lookaside list and frees any entries specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lookaside structure.
00504 
00505 Arguments:
00506 
00507     Lookaside - Supplies a pointer to a nonpaged lookaside list structure.
00508 
00509 Return Value:
00510 
00511     None.
00512 
00513 --*/
00514 
00515 {
00516 
00517     PVOID Entry;
00518     KIRQL OldIrql;
00519 
00520     <span class="comment">//</span>
00521     <span class="comment">// Acquire the nonpaged system lookaside list lock and remove the</span>
00522     <span class="comment">// specified lookaside list structure from the list.</span>
00523     <span class="comment">//</span>
00524 
00525     ExAcquireSpinLock(&amp;ExNPagedLookasideLock, &amp;OldIrql);
00526     RemoveEntryList(&amp;Lookaside-&gt;L.ListEntry);
00527     ExReleaseSpinLock(&amp;ExNPagedLookasideLock, OldIrql);
00528 
00529     <span class="comment">//</span>
00530     <span class="comment">// Remove all pool entries from the specified lookaside structure</span>
00531     <span class="comment">// and free them.</span>
00532     <span class="comment">//</span>
00533 
00534     Lookaside-&gt;L.Allocate = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a11">ExpDummyAllocate</a>;
00535     <span class="keywordflow">while</span> ((Entry = <a class="code" href="../../d5/d8/ex_8h.html#a248">ExAllocateFromNPagedLookasideList</a>(Lookaside)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00536         (Lookaside-&gt;L.Free)(Entry);
00537     }
00538 
00539     <span class="keywordflow">return</span>;
00540 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ex/lookasid.c::ExDeletePagedLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExDeletePagedLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Lookaside</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00629">629</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00906">ExAllocateFromPagedLookasideList()</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00265">ExPagedLookasideLock</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00802">ExpDummyAllocate()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l02193">FreeCachedQueues()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00097">Win32kNtUserCleanup()</a>.
<p>
<pre class="fragment"><div>00635                    :
00636 
00637     This function removes a paged lookaside structure from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system paged
00638     lookaside list and frees any entries specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lookaside structure.
00639 
00640 Arguments:
00641 
00642     Lookaside - Supplies a pointer to a paged lookaside list structure.
00643 
00644 Return Value:
00645 
00646     None.
00647 
00648 --*/
00649 
00650 {
00651 
00652     PVOID Entry;
00653     KIRQL OldIrql;
00654 
00655     <span class="comment">//</span>
00656     <span class="comment">// Acquire the paged system lookaside list lock and remove the</span>
00657     <span class="comment">// specified lookaside list structure from the list.</span>
00658     <span class="comment">//</span>
00659 
00660     ExAcquireSpinLock(&amp;ExPagedLookasideLock, &amp;OldIrql);
00661     RemoveEntryList(&amp;Lookaside-&gt;L.ListEntry);
00662     ExReleaseSpinLock(&amp;ExPagedLookasideLock, OldIrql);
00663 
00664     <span class="comment">//</span>
00665     <span class="comment">// Remove all pool entries from the specified lookaside structure</span>
00666     <span class="comment">// and free them.</span>
00667     <span class="comment">//</span>
00668 
00669     Lookaside-&gt;L.Allocate = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a11">ExpDummyAllocate</a>;
00670     <span class="keywordflow">while</span> ((Entry = <a class="code" href="../../d5/d8/ex_8h.html#a252">ExAllocateFromPagedLookasideList</a>(Lookaside)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00671         (Lookaside-&gt;L.Free)(Entry);
00672     }
00673 
00674     <span class="keywordflow">return</span>;
00675 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ex/lookasid.c::ExFreeToPagedLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExFreeToPagedLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lookaside</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Entry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00741">741</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a243">ExInterlockedPushEntrySList()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00637">ExQueryDepthSList</a>, <a class="el" href="../../d6/d2/i386_8h-source.html#l02725">Isx86FeaturePresent</a>, <a class="el" href="../../d6/d2/i386_8h-source.html#l02709">KF_CMPXCHG8B</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00748                    :
00749 
00750     This function inserts (pushes) the specified entry into the specified
00751     paged lookaside list.
00752 
00753 Arguments:
00754 
00755     Lookaside - Supplies a pointer to a paged lookaside list structure.
00756 
00757     Entry - Supples a pointer to the entry that is inserted in the
00758         lookaside list.
00759 
00760 Return Value:
00761 
00762     None.
00763 
00764 --*/
00765 
00766 {
00767 
00768     Lookaside-&gt;L.TotalFrees += 1;
00769 
00770     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d3/i386_8h.html#a16">Isx86FeaturePresent</a>(KF_CMPXCHG8B)) {
00771         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a10">ExQueryDepthSList</a>(&amp;Lookaside-&gt;L.ListHead) &gt;= Lookaside-&gt;L.Depth) {
00772             Lookaside-&gt;L.FreeMisses += 1;
00773             (Lookaside-&gt;L.Free)(Entry);
00774 
00775         } <span class="keywordflow">else</span> {
00776             <a class="code" href="../../d5/d8/ex_8h.html#a243">ExInterlockedPushEntrySList</a>(&amp;Lookaside-&gt;L.ListHead,
00777                                         (PSINGLE_LIST_ENTRY)Entry,
00778                                         NULL);
00779         }
00780 
00781         <span class="keywordflow">return</span>;
00782     }
00783 
00784     ExAcquireFastMutex(&amp;Lookaside-&gt;Lock);
00785     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a10">ExQueryDepthSList</a>(&amp;Lookaside-&gt;L.ListHead) &gt;= Lookaside-&gt;L.Depth) {
00786         ExReleaseFastMutex(&amp;Lookaside-&gt;Lock);
00787         Lookaside-&gt;L.FreeMisses += 1;
00788         (Lookaside-&gt;L.Free)(Entry);
00789 
00790     } <span class="keywordflow">else</span> {
00791         PushEntryList(&amp;Lookaside-&gt;L.ListHead.Next, (PSINGLE_LIST_ENTRY)Entry);
00792         Lookaside-&gt;L.ListHead.Depth += 1;
00793         ExReleaseFastMutex(&amp;Lookaside-&gt;Lock);
00794     }
00795 
00796     <span class="keywordflow">return</span>;
00797 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ex/lookasid.c::ExInitializeNPagedLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExInitializeNPagedLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lookaside</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a100">PALLOCATE_FUNCTION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Allocate</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a101">PFREE_FUNCTION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Free</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Depth</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">408</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00611">ExInitializeSListHead</a>, <a class="el" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList()</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00262">ExNPagedLookasideListHead</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00263">ExNPagedLookasideLock</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00033">MINIMUM_LOOKASIDE_DEPTH</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l00744">FsRtlInitializeFileLocks()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00521">FsRtlInitializeLargeMcbs()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>, and <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>.
<p>
<pre class="fragment"><div>00420                    :
00421 
00422     This function initializes a nonpaged lookaside list structure and inserts
00423     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structure in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system nonpaged lookaside list.
00424 
00425 Arguments:
00426 
00427     Lookaside - Supplies a pointer to a nonpaged lookaside list structure.
00428 
00429     Allocate - Supplies an optional pointer to an allocate function.
00430 
00431     Free - Supplies an optional pointer to a free function.
00432 
00433     Flags - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocation flags which are merged with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00434         <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocation <a class="code" href="../../d4/d4/iafptrap_8c.html#a9">type</a> (NonPagedPool) to control pool allocation.
00435 
00436     Size - Supplies the size for the lookaside list entries.
00437 
00438     Tag - Supplies the pool tag for the lookaside list entries.
00439 
00440     Depth - Supplies the maximum depth of the lookaside list.
00441 
00442 Return Value:
00443 
00444     None.
00445 
00446 --*/
00447 
00448 {
00449 
00450     <span class="comment">//</span>
00451     <span class="comment">// Initialize the lookaside list structure.</span>
00452     <span class="comment">//</span>
00453 
00454     <a class="code" href="../../d5/d8/ex_8h.html#a9">ExInitializeSListHead</a>(&amp;Lookaside-&gt;L.ListHead);
00455     Lookaside-&gt;L.Depth = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a>;
00456     Lookaside-&gt;L.MaximumDepth = 256; <span class="comment">//Depth;</span>
00457     Lookaside-&gt;L.TotalAllocates = 0;
00458     Lookaside-&gt;L.AllocateMisses = 0;
00459     Lookaside-&gt;L.TotalFrees = 0;
00460     Lookaside-&gt;L.FreeMisses = 0;
00461     Lookaside-&gt;L.Type = <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> | Flags;
00462     Lookaside-&gt;L.Tag = Tag;
00463     Lookaside-&gt;L.Size = (ULONG)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00464     <span class="keywordflow">if</span> (Allocate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00465         Lookaside-&gt;L.Allocate = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>;
00466 
00467     } <span class="keywordflow">else</span> {
00468         Lookaside-&gt;L.Allocate = Allocate;
00469     }
00470 
00471     <span class="keywordflow">if</span> (Free == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00472         Lookaside-&gt;L.Free = <a class="code" href="../../d6/d3/cmwraper_8c.html#a26">ExFreePool</a>;
00473 
00474     } <span class="keywordflow">else</span> {
00475         Lookaside-&gt;L.Free = Free;
00476     }
00477 
00478     Lookaside-&gt;L.LastTotalAllocates = 0;
00479     Lookaside-&gt;L.LastAllocateMisses = 0;
00480     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;Lookaside-&gt;Lock);
00481 
00482     <span class="comment">//</span>
00483     <span class="comment">// Insert the lookaside list structure is the system nonpaged lookaside</span>
00484     <span class="comment">// list.</span>
00485     <span class="comment">//</span>
00486 
00487     <a class="code" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList</a>(&amp;ExNPagedLookasideListHead,
00488                                 &amp;Lookaside-&gt;L.ListEntry,
00489                                 &amp;ExNPagedLookasideLock);
00490     <span class="keywordflow">return</span>;
00491 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ex/lookasid.c::ExInitializePagedLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExInitializePagedLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lookaside</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a100">PALLOCATE_FUNCTION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Allocate</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a101">PFREE_FUNCTION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Free</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Depth</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">543</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00611">ExInitializeSListHead</a>, <a class="el" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList()</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00264">ExPagedLookasideListHead</a>, <a class="el" href="../../d5/d9/exp_8h-source.html#l00265">ExPagedLookasideLock</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00033">MINIMUM_LOOKASIDE_DEPTH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/filelock_8c-source.html#l00744">FsRtlInitializeFileLocks()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00521">FsRtlInitializeLargeMcbs()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00382">FsRtlInitializeTunnels()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l03169">InitQEntryLookaside()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00137">InitSMSLookaside()</a>.
<p>
<pre class="fragment"><div>00555                    :
00556 
00557     This function initializes a paged lookaside list structure and inserts
00558     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structure in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system paged lookaside list.
00559 
00560 Arguments:
00561 
00562     Lookaside - Supplies a pointer to a paged lookaside list structure.
00563 
00564     Allocate - Supplies an optional pointer to an allocate function.
00565 
00566     Free - Supplies an optional pointer to a free function.
00567 
00568     Flags - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocation flags which are merged with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00569         <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocation <a class="code" href="../../d4/d4/iafptrap_8c.html#a9">type</a> (NonPagedPool) to control pool allocation.
00570 
00571     Size - Supplies the size for the lookaside list entries.
00572 
00573     Tag - Supplies the pool tag for the lookaside list entries.
00574 
00575     Depth - Supplies the maximum depth of the lookaside list.
00576 
00577 Return Value:
00578 
00579     None.
00580 
00581 --*/
00582 
00583 {
00584 
00585     <span class="comment">//</span>
00586     <span class="comment">// Initialize the lookaside list structure.</span>
00587     <span class="comment">//</span>
00588 
00589     <a class="code" href="../../d5/d8/ex_8h.html#a9">ExInitializeSListHead</a>(&amp;Lookaside-&gt;L.ListHead);
00590     Lookaside-&gt;L.Depth = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a>;
00591     Lookaside-&gt;L.MaximumDepth = 256; <span class="comment">//Depth;</span>
00592     Lookaside-&gt;L.TotalAllocates = 0;
00593     Lookaside-&gt;L.AllocateMisses = 0;
00594     Lookaside-&gt;L.TotalFrees = 0;
00595     Lookaside-&gt;L.FreeMisses = 0;
00596     Lookaside-&gt;L.Type = <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> | Flags;
00597     Lookaside-&gt;L.Tag = Tag;
00598     Lookaside-&gt;L.Size = (ULONG)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00599     <span class="keywordflow">if</span> (Allocate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00600         Lookaside-&gt;L.Allocate = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>;
00601 
00602     } <span class="keywordflow">else</span> {
00603         Lookaside-&gt;L.Allocate = Allocate;
00604     }
00605 
00606     <span class="keywordflow">if</span> (Free == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00607         Lookaside-&gt;L.Free = <a class="code" href="../../d6/d3/cmwraper_8c.html#a26">ExFreePool</a>;
00608 
00609     } <span class="keywordflow">else</span> {
00610         Lookaside-&gt;L.Free = Free;
00611     }
00612 
00613     Lookaside-&gt;L.LastTotalAllocates = 0;
00614     Lookaside-&gt;L.LastAllocateMisses = 0;
00615     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>(&amp;Lookaside-&gt;Lock);
00616 
00617     <span class="comment">//</span>
00618     <span class="comment">// Insert the lookaside list structure in the system paged lookaside</span>
00619     <span class="comment">// list.</span>
00620     <span class="comment">//</span>
00621 
00622     <a class="code" href="../../d5/d8/ex_8h.html#a238">ExInterlockedInsertTailList</a>(&amp;ExPagedLookasideListHead,
00623                                 &amp;Lookaside-&gt;L.ListEntry,
00624                                 &amp;ExPagedLookasideLock);
00625     <span class="keywordflow">return</span>;
00626 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ex/lookasid.c::ExpComputeLookasideDepth" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL ExpComputeLookasideDepth           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Allocates</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Misses</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumDepth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Depth</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00161">161</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00085">ExpAdjustScanPeriod</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00039">MINIMUM_ALLOCATION_THRESHOLD</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00033">MINIMUM_LOOKASIDE_DEPTH</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00251">ExpScanGeneralLookasideList()</a>, and <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00340">ExpScanPoolLookasideList()</a>.
<p>
<pre class="fragment"><div>00170                    :
00171 
00172     This function computes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target depth of a lookaside list given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00173     total allocations and misses during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last scan period and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00174     depth.
00175 
00176 Arguments:
00177 
00178     Allocates - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> total number of allocations during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last
00179         scan period.
00180 
00181     Misses - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> total number of allocate misses during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last
00182         scan period.
00183 
00184     MaximumDepth - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum depth <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lookaside list <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed
00185         to reach.
00186 
00187     Depth - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current lookaside list depth which
00188         receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target depth.
00189 
00190 Return Value:
00191 
00192     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target depth <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> greater than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current depth, then a value of
00193     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00194     returned.
00195 
00196 --*/
00197 
00198 {
00199 
00200     LOGICAL Changes;
00201     ULONG Ratio;
00202     ULONG Target;
00203 
00204     <span class="comment">//</span>
00205     <span class="comment">// If the allocate rate is less than the mimimum threshold, then lower</span>
00206     <span class="comment">// the maximum depth of the lookaside list. Otherwise, if the miss rate</span>
00207     <span class="comment">// is less than .5%, then lower the maximum depth. Otherwise, raise the</span>
00208     <span class="comment">// maximum depth based on the miss rate.</span>
00209     <span class="comment">//</span>
00210 
00211     Changes = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00212     <span class="keywordflow">if</span> (Misses &gt;= Allocates) {
00213         Misses = Allocates;
00214     }
00215 
00216     <span class="keywordflow">if</span> (Allocates == 0) {
00217         Allocates = 1;
00218     }
00219 
00220     Ratio = (Misses * 1000) / Allocates;
00221     Target = *Depth;
00222     <span class="keywordflow">if</span> ((Allocates / <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a>) &lt; <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a2">MINIMUM_ALLOCATION_THRESHOLD</a>) {
00223         <span class="keywordflow">if</span> (Target &gt; (<a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a> + 10)) {
00224             Target -= 10;
00225 
00226         } <span class="keywordflow">else</span> {
00227             Target = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a>;
00228         }
00229 
00230     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ratio &lt; 5) {
00231         <span class="keywordflow">if</span> (Target &gt; (<a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a> + 1)) {
00232             Target -= 1;
00233 
00234         } <span class="keywordflow">else</span> {
00235             Target = <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a1">MINIMUM_LOOKASIDE_DEPTH</a>;
00236         }
00237 
00238     } <span class="keywordflow">else</span> {
00239         Changes = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00240         Target += ((Ratio * MaximumDepth) / (1000 * 2)) + 5;
00241         <span class="keywordflow">if</span> (Target &gt; MaximumDepth) {
00242             Target = MaximumDepth;
00243         }
00244     }
00245 
00246     *Depth = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Target;
00247     <span class="keywordflow">return</span> Changes;
00248 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ex/lookasid.c::ExpDummyAllocate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ExpDummyAllocate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00802">802</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00494">ExDeleteNPagedLookasideList()</a>, and <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00629">ExDeletePagedLookasideList()</a>.
<p>
<pre class="fragment"><div>00810                    :
00811 
00812     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a <a class="code" href="../../d0/d2/config_2test_2init386_8c.html#a0">dummy</a> allocation routine which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to empty
00813     a lookaside list.
00814 
00815 Arguments:
00816 
00817     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to allocate.
00818 
00819     NumberOfBytes - supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to allocate.
00820 
00821     Tag - supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> tag.
00822 
00823 Return Value:
00824 
00825     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00826 
00827 --*/
00828 
00829 {
00830 
00831     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00832 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ex/lookasid.c::ExpScanGeneralLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL ExpScanGeneralLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>ListHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>SpinLock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00251">251</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00729">_GENERAL_LOOKASIDE::AllocateMisses</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00725">_GENERAL_LOOKASIDE::Depth</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00161">ExpComputeLookasideDepth()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00865">_PAGED_LOOKASIDE_LIST::L</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00747">_GENERAL_LOOKASIDE::LastAllocateMisses</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00745">_GENERAL_LOOKASIDE::LastTotalAllocates</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00726">_GENERAL_LOOKASIDE::MaximumDepth</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l00727">_GENERAL_LOOKASIDE::TotalAllocates</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>.
<p>
<pre class="fragment"><div>00258                    :
00259 
00260     This function scans <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified list of general lookaside descriptors
00261     and adjusts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum depth as necessary.
00262 
00263 Arguments:
00264 
00265     ListHead - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> listhead <span class="keywordflow">for</span> a list of lookaside
00266         descriptors.
00267 
00268     SpinLock - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> spinlock to be used to synchronize
00269         access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of lookaside descriptors.
00270 
00271 Return Value:
00272 
00273     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum depth of any lookaside list
00274     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> changed. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00275 
00276 --*/
00277 
00278 {
00279 
00280     ULONG Allocates;
00281     LOGICAL Changes;
00282     PLIST_ENTRY Entry;
00283     <a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PPAGED_LOOKASIDE_LIST</a> Lookaside;
00284     ULONG Misses;
00285     KIRQL OldIrql;
00286 
00287     <span class="comment">//</span>
00288     <span class="comment">// Raise IRQL and acquire the specified spinlock.</span>
00289     <span class="comment">//</span>
00290 
00291     Changes = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00292     ExAcquireSpinLock(SpinLock, &amp;OldIrql);
00293 
00294     <span class="comment">//</span>
00295     <span class="comment">// Scan the specified list of lookaside descriptors and adjust the</span>
00296     <span class="comment">// maximum depth as necessary.</span>
00297     <span class="comment">//</span>
00298     <span class="comment">// N.B. All lookaside list descriptor are treated as if they were</span>
00299     <span class="comment">//      paged descriptor even though they may be nonpaged descriptors.</span>
00300     <span class="comment">//      This is possible since both structures are identical except</span>
00301     <span class="comment">//      for the locking fields which are the last structure fields.</span>
00302 
00303     Entry = ListHead-&gt;Flink;
00304     <span class="keywordflow">while</span> (Entry != ListHead) {
00305         Lookaside = CONTAINING_RECORD(Entry,
00306                                       <a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PAGED_LOOKASIDE_LIST</a>,
00307                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>.ListEntry);
00308 
00309         <span class="comment">//</span>
00310         <span class="comment">// Compute the total number of allocations and misses per second for</span>
00311         <span class="comment">// this scan period.</span>
00312         <span class="comment">//</span>
00313 
00314         Allocates = Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">TotalAllocates</a> - Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o15">LastTotalAllocates</a>;
00315         Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o15">LastTotalAllocates</a> = Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">TotalAllocates</a>;
00316         Misses = Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o4">AllocateMisses</a> - Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o16">LastAllocateMisses</a>;
00317         Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o16">LastAllocateMisses</a> = Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o4">AllocateMisses</a>;
00318 
00319         <span class="comment">//</span>
00320         <span class="comment">// Compute target depth of lookaside list.</span>
00321         <span class="comment">//</span>
00322 
00323         Changes |= <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a10">ExpComputeLookasideDepth</a>(Allocates,
00324                                             Misses,
00325                                             Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o2">MaximumDepth</a>,
00326                                             &amp;Lookaside-&gt;<a class="code" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o1">Depth</a>);
00327 
00328         Entry = Entry-&gt;Flink;
00329     }
00330 
00331     <span class="comment">//</span>
00332     <span class="comment">// Release spinlock, lower IRQL, and return function value.</span>
00333     <span class="comment">//</span>
00334 
00335     ExReleaseSpinLock(SpinLock, OldIrql);
00336     <span class="keywordflow">return</span> Changes;
00337 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ex/lookasid.c::ExpScanPoolLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL ExpScanPoolLookasideList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ListHead</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00340">340</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00730">_GENERAL_LOOKASIDE::AllocateHits</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00725">_GENERAL_LOOKASIDE::Depth</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00161">ExpComputeLookasideDepth()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00755">_NPAGED_LOOKASIDE_LIST::L</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00748">_GENERAL_LOOKASIDE::LastAllocateHits</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00745">_GENERAL_LOOKASIDE::LastTotalAllocates</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00726">_GENERAL_LOOKASIDE::MaximumDepth</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l00727">_GENERAL_LOOKASIDE::TotalAllocates</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>.
<p>
<pre class="fragment"><div>00346                    :
00347 
00348     This function scans <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> lookaside descriptors and adjusts
00349     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum depth as necessary.
00350 
00351 Arguments:
00352 
00353     ListHead - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> lookaside structures.
00354 
00355 Return Value:
00356 
00357     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum depth of any lookaside list
00358     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> changed. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00359 
00360 --*/
00361 
00362 {
00363 
00364     ULONG Allocates;
00365     LOGICAL Changes;
00366     <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a> Lookaside;
00367     PLIST_ENTRY NextEntry;
00368     ULONG Misses;
00369 
00370     <span class="comment">//</span>
00371     <span class="comment">// Scan the specified list of lookaside descriptors and adjust the</span>
00372     <span class="comment">// maximum depth as necessary.</span>
00373     <span class="comment">//</span>
00374 
00375     Changes = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00376     NextEntry = ListHead-&gt;Flink;
00377     <span class="keywordflow">while</span> (NextEntry != ListHead) {
00378         Lookaside = CONTAINING_RECORD(NextEntry,
00379                                       <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a>,
00380                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>.ListEntry);
00381 
00382         <span class="comment">//</span>
00383         <span class="comment">// Compute the total number of allocations and misses per second for</span>
00384         <span class="comment">// this scan period.</span>
00385         <span class="comment">//</span>
00386 
00387         Allocates = Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">TotalAllocates</a> - Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o15">LastTotalAllocates</a>;
00388         Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o15">LastTotalAllocates</a> = Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o3">TotalAllocates</a>;
00389         Misses = Allocates - (Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o5">AllocateHits</a> - Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o17">LastAllocateHits</a>);
00390         Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o17">LastAllocateHits</a> = Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o5">AllocateHits</a>;
00391 
00392         <span class="comment">//</span>
00393         <span class="comment">// Compute target depth of lookaside list.</span>
00394         <span class="comment">//</span>
00395 
00396         Changes |= <a class="code" href="../../d9/d5/ex_2lookasid_8c.html#a10">ExpComputeLookasideDepth</a>(Allocates,
00397                                             Misses,
00398                                             Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o2">MaximumDepth</a>,
00399                                             &amp;Lookaside-&gt;<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a>.<a class="code" href="../../d6/d1/struct__GENERAL__LOOKASIDE.html#o1">Depth</a>);
00400 
00401         NextEntry = NextEntry-&gt;Flink;
00402     }
00403 
00404     <span class="keywordflow">return</span> Changes;
00405 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="ex/lookasid.c::ExNPagedLookasideListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a3">ExNPagedLookasideListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00075">75</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">ExInitializeNPagedLookasideList()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03661">ExpGetLookasideInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ex/lookasid.c::ExNPagedLookasideLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a4">ExNPagedLookasideLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00076">76</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00494">ExDeleteNPagedLookasideList()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">ExInitializeNPagedLookasideList()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03661">ExpGetLookasideInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ex/lookasid.c::ExpAdjustScanPeriod" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a8">ExpAdjustScanPeriod</a> = 1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00085">85</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>, and <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00161">ExpComputeLookasideDepth()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ex/lookasid.c::ExPagedLookasideListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a5">ExPagedLookasideListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00077">77</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">ExInitializePagedLookasideList()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03661">ExpGetLookasideInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ex/lookasid.c::ExPagedLookasideLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a6">ExPagedLookasideLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00078">78</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00629">ExDeletePagedLookasideList()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">ExInitializePagedLookasideList()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03661">ExpGetLookasideInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ex/lookasid.c::ExpCurrentScanPeriod" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a9">ExpCurrentScanPeriod</a> = 1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00086">86</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ex/lookasid.c::ExPoolLookasideListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d5/ex_2lookasid_8c.html#a7">ExPoolLookasideListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00079">79</a> of file <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html">ex/lookasid.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00089">ExAdjustLookasideDepth()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03661">ExpGetLookasideInformation()</a>, and <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03405">ExQueryPoolUsage()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
