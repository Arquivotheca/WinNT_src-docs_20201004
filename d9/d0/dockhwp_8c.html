<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dockhwp.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dockhwp.c File Reference</h1><code>#include "<a class="el" href="../../d1/d5/iop_8h-source.html">iop.h</a>"</code><br>
<code>#include "<a class="el" href="../../d2/d1/cmp_8h-source.html">..\config\cmp.h</a>"</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;<a class="el" href="../../d7/d6/profiles_8h-source.html">profiles.h</a>&gt;</code><br>
<code>#include &lt;wdmguid.h&gt;</code><br>

<p>
<a href="../../d0/d0/dockhwp_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/structPROFILE__WORK__ITEM.html">PROFILE_WORK_ITEM</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(SemaphoreObject)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a7">PPROFILE_WORK_ITEM</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a8">IopExecuteHardwareProfileChange</a> (IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a194">HARDWARE_PROFILE_BUS_TYPE</a> Bus, IN PWCHAR *ProfileSerialNumbers, IN ULONG SerialNumbersCount, OUT PHANDLE NewProfile, OUT PBOOLEAN ProfileChanged)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a9">IopUpdateHardwareProfile</a> (OUT PBOOLEAN ProfileChanged)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a10">IopHardwareProfileSendCommit</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a11">IopHardwareProfileSendCancel</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a12">IopHardwareProfileBeginTransition</a> (IN BOOLEAN SubsumeExistingDeparture)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a13">IopHardwareProfileMarkDock</a> (<a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387">PROFILE_STATUS</a> ChangeInPresence)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a14">IopHardwareProfileQueryChange</a> (IN BOOLEAN SubsumingExistingDeparture, IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a388">PROFILE_NOTIFICATION_TIME</a> InPnpEvent, OUT PPNP_VETO_TYPE VetoType, OUT PUNICODE_STRING VetoName OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a15">IopHardwareProfileCommitStartedDock</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a16">IopHardwareProfileCommitRemovedDock</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a17">IopHardwareProfileCancelRemovedDock</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a18">IopHardwareProfileCancelTransition</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a19">IopHardwareProfileSetMarkedDocksEjected</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a20">IopExecuteHwpDefaultSelect</a> (IN <a class="el" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html">PCM_HARDWARE_PROFILE_LIST</a> ProfileList, OUT PULONG ProfileIndexToUse, IN PVOID Context)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a2">IopDockDeviceCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a3">IopDockDeviceListLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d7/struct__KSEMAPHORE.html">KSEMAPHORE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a4">IopProfileChangeSemaphore</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d0/dockhwp_8c.html#a6">IopDocksInTransition</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="dockhwp.c::ASSERT_SEMA_NOT_SIGNALLED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ASSERT_SEMA_NOT_SIGNALLED          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SemaphoreObject&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">35</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00103">IopHardwareProfileBeginTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">IopHardwareProfileQueryChange()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">IopHardwareProfileSendCancel()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00795">IopHardwareProfileSendCommit()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00739">IopHardwareProfileSetMarkedDocksEjected()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a7" doxytag="dockhwp.c::PPROFILE_WORK_ITEM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef   * <a class="el" href="../../d9/d0/dockhwp_8c.html#a7">PPROFILE_WORK_ITEM</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a8" doxytag="dockhwp.c::IopExecuteHardwareProfileChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopExecuteHardwareProfileChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a194">HARDWARE_PROFILE_BUS_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Bus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ProfileSerialNumbers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SerialNumbersCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>NewProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ProfileChanged</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01028">1028</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l00805">CmSetAcpiHwProfile()</a>, <a class="el" href="../../d7/d6/profiles_8h-source.html#l00079">_PROFILE_ACPI_DOCKING_STATE::DockingState</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a392a226">HardwareProfileBusTypeACPI</a>, <a class="el" href="../../d7/d6/profiles_8h-source.html#l00045">HW_PROFILE_DOCKSTATE_DOCKED</a>, <a class="el" href="../../d7/d6/profiles_8h-source.html#l00044">HW_PROFILE_DOCKSTATE_UNDOCKED</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01014">IopExecuteHwpDefaultSelect()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01520">RtlCompareUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d7/d6/profiles_8h-source.html#l00080">_PROFILE_ACPI_DOCKING_STATE::SerialLength</a>, <a class="el" href="../../d7/d6/profiles_8h-source.html#l00081">_PROFILE_ACPI_DOCKING_STATE::SerialNumber</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>.
<p>
<pre class="fragment"><div>01038                    :
01039     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> docking event has occured and now, given a list of Profile Serial Numbers
01040     that describe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> docking state:
01041     <a class="code" href="../../d4/d9/ke_8h.html#a406a197">Transition</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given docking state.
01042     Set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Current Hardware Profile to based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> state.
01043     (Possibly Prompt <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ambiguity)
01044     Send Removes to those devices that are turned off in <span class="keyword">this</span> profile,
01045 
01046 Arguments:
01047     Bus - This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> supplying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hardware profile change
01048     (currently <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> HardwareProfileBusTypeAcpi <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> supported).
01049 
01050     ProfileSerialNumbers - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> list of serial numbers (a list of null terminated
01051     UCHAR lists) representing <span class="keyword">this</span> <span class="keyword">new</span> docking state.  These can be listed in
01052     any order, and form a complete representation of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> docking state
01053     caused by a docking even on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given bus.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> Serial Number string of <span class="stringliteral">"\0"</span>
01054     represents an <span class="stringliteral">"undocked state"</span> and should not be listed with any other
01055     strings.  This list need not be sorted.
01056 
01057     SerialNumbersCount - The number of serial numbers listed.
01058 
01059     NewProfile - a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry key representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> hardware
01060     profile (IE \CCS\HardwareProfiles\Current<span class="stringliteral">".)</span>
01061 <span class="stringliteral"></span>
01062 <span class="stringliteral">    ProfileChanged - set to TRUE if new current profile (as a result of this</span>
01063 <span class="stringliteral">    docking event, is different that then old current profile.</span>
01064 <span class="stringliteral"></span>
01065 <span class="stringliteral">--*/</span>
01066 <span class="stringliteral">{</span>
01067 <span class="stringliteral">    NTSTATUS        status = STATUS_SUCCESS;</span>
01068 <span class="stringliteral">    ULONG           len;</span>
01069 <span class="stringliteral">    ULONG           tmplen;</span>
01070 <span class="stringliteral">    ULONG           i, j;</span>
01071 <span class="stringliteral">    PWCHAR          tmpStr;</span>
01072 <span class="stringliteral">    UNICODE_STRING  tmpUStr;</span>
01073 <span class="stringliteral">    PUNICODE_STRING sortedSerials = NULL;</span>
01074 <span class="stringliteral"></span>
01075 <span class="stringliteral">    PPROFILE_ACPI_DOCKING_STATE dockState = NULL;</span>
01076 <span class="stringliteral"></span>
01077 <span class="stringliteral">    PIDBGMSG(</span>
01078 <span class="stringliteral">        PIDBG_HWPROFILE,</span>
01079 <span class="stringliteral">        ("</span>Execute Profile (BusType %x), (SerialNumCount %x)\n<span class="stringliteral">", Bus, SerialNumbersCount)</span>
01080 <span class="stringliteral">        ) ;</span>
01081 <span class="stringliteral"></span>
01082 <span class="stringliteral">    //</span>
01083 <span class="stringliteral">    // Sort the list of serial numbers</span>
01084 <span class="stringliteral">    //</span>
01085 <span class="stringliteral">    len = sizeof (UNICODE_STRING) * SerialNumbersCount;</span>
01086 <span class="stringliteral">    sortedSerials = ExAllocatePool (NonPagedPool, len);</span>
01087 <span class="stringliteral">    if (NULL == sortedSerials) {</span>
01088 <span class="stringliteral">        status = STATUS_INSUFFICIENT_RESOURCES;</span>
01089 <span class="stringliteral">        goto Clean;</span>
01090 <span class="stringliteral">    }</span>
01091 <span class="stringliteral">    for (i = 0; i &lt; SerialNumbersCount; i++) {</span>
01092 <span class="stringliteral">        RtlInitUnicodeString (&amp;sortedSerials[i], ProfileSerialNumbers[i]);</span>
01093 <span class="stringliteral">    }</span>
01094 <span class="stringliteral">    //</span>
01095 <span class="stringliteral">    // I do not anticipate getting more than a few serial numbers, and I am</span>
01096 <span class="stringliteral">    // just lasy enough to write this comment and use a buble sort.</span>
01097 <span class="stringliteral">    //</span>
01098 <span class="stringliteral">    for (i = 0; i &lt; SerialNumbersCount; i++) {</span>
01099 <span class="stringliteral">        for (j = 0; j &lt; SerialNumbersCount - 1; j++) {</span>
01100 <span class="stringliteral">            if (0 &lt; RtlCompareUnicodeString (&amp;sortedSerials[j],</span>
01101 <span class="stringliteral">                                             &amp;sortedSerials[j+1],</span>
01102 <span class="stringliteral">                                             FALSE)) {</span>
01103 <span class="stringliteral">                tmpUStr = sortedSerials[j];</span>
01104 <span class="stringliteral">                sortedSerials[j] = sortedSerials[j+1];</span>
01105 <span class="stringliteral">                sortedSerials[j+1] = tmpUStr;</span>
01106 <span class="stringliteral">            }</span>
01107 <span class="stringliteral">        }</span>
01108 <span class="stringliteral">    }</span>
01109 <span class="stringliteral"></span>
01110 <span class="stringliteral">    //</span>
01111 <span class="stringliteral">    // Construct the DockState ID</span>
01112 <span class="stringliteral">    //</span>
01113 <span class="stringliteral">    len = 0;</span>
01114 <span class="stringliteral">    for (i = 0; i &lt; SerialNumbersCount; i++) {</span>
01115 <span class="stringliteral">        len += sortedSerials[i].Length;</span>
01116 <span class="stringliteral">    }</span>
01117 <span class="stringliteral">    len += sizeof (WCHAR); // NULL termination;</span>
01118 <span class="stringliteral"></span>
01119 <span class="stringliteral">    dockState = (PPROFILE_ACPI_DOCKING_STATE)</span>
01120 <span class="stringliteral">                ExAllocatePool (NonPagedPool,</span>
01121 <span class="stringliteral">                                len + sizeof (PROFILE_ACPI_DOCKING_STATE));</span>
01122 <span class="stringliteral">    // BUGBUG wasted WCHAR here.  Oh well.</span>
01123 <span class="stringliteral"></span>
01124 <span class="stringliteral">    if (NULL == dockState) {</span>
01125 <span class="stringliteral">        status = STATUS_INSUFFICIENT_RESOURCES;</span>
01126 <span class="stringliteral">        goto Clean;</span>
01127 <span class="stringliteral">    }</span>
01128 <span class="stringliteral">    for (i = 0, tmpStr = dockState-&gt;SerialNumber, tmplen = 0;</span>
01129 <span class="stringliteral">         i &lt; SerialNumbersCount;</span>
01130 <span class="stringliteral">         i++) {</span>
01131 <span class="stringliteral"></span>
01132 <span class="stringliteral">        tmplen = sortedSerials[i].Length;</span>
01133 <span class="stringliteral">        ASSERT (tmplen &lt;= len - ((PCHAR)tmpStr - (PCHAR)dockState-&gt;SerialNumber));</span>
01134 <span class="stringliteral"></span>
01135 <span class="stringliteral">        RtlCopyMemory (tmpStr, sortedSerials[i].Buffer, tmplen);</span>
01136 <span class="stringliteral">        (PCHAR) tmpStr += tmplen;</span>
01137 <span class="stringliteral">    }</span>
01138 <span class="stringliteral"></span>
01139 <span class="stringliteral">    *(tmpStr++) = L'\0';</span>
01140 <span class="stringliteral"></span>
01141 <span class="stringliteral">    ASSERT (len == (ULONG) ((PCHAR) tmpStr - (PCHAR) dockState-&gt;SerialNumber));</span>
01142 <span class="stringliteral">    dockState-&gt;SerialLength = (USHORT) len;</span>
01143 <span class="stringliteral"></span>
01144 <span class="stringliteral">    if ((SerialNumbersCount &gt; 1) || (L'\0' !=  dockState-&gt;SerialNumber[0])) {</span>
01145 <span class="stringliteral">        dockState-&gt;DockingState = HW_PROFILE_DOCKSTATE_DOCKED;</span>
01146 <span class="stringliteral">    } else {</span>
01147 <span class="stringliteral">        dockState-&gt;DockingState = HW_PROFILE_DOCKSTATE_UNDOCKED;</span>
01148 <span class="stringliteral">    }</span>
01149 <span class="stringliteral"></span>
01150 <span class="stringliteral"></span>
01151 <span class="stringliteral">    //</span>
01152 <span class="stringliteral">    // Set the new Profile</span>
01153 <span class="stringliteral">    //</span>
01154 <span class="stringliteral">    switch (Bus) {</span>
01155 <span class="stringliteral">    case HardwareProfileBusTypeACPI:</span>
01156 <span class="stringliteral"></span>
01157 <span class="stringliteral">        status = CmSetAcpiHwProfile (dockState,</span>
01158 <span class="stringliteral">                                     IopExecuteHwpDefaultSelect,</span>
01159 <span class="stringliteral">                                     NULL,</span>
01160 <span class="stringliteral">                                     NewProfile,</span>
01161 <span class="stringliteral">                                     ProfileChanged);</span>
01162 <span class="stringliteral"></span>
01163 <span class="stringliteral">        ASSERT(NT_SUCCESS(status) || (!(*ProfileChanged))) ;</span>
01164 <span class="stringliteral">        break;</span>
01165 <span class="stringliteral"></span>
01166 <span class="stringliteral">    default:</span>
01167 <span class="stringliteral">        *ProfileChanged = FALSE ;</span>
01168 <span class="stringliteral">        status = STATUS_NOT_SUPPORTED;</span>
01169 <span class="stringliteral">        goto Clean;</span>
01170 <span class="stringliteral">    }</span>
01171 <span class="stringliteral"></span>
01172 <span class="stringliteral">Clean:</span>
01173 <span class="stringliteral">    if (NULL != sortedSerials) {</span>
01174 <span class="stringliteral">        ExFreePool (sortedSerials);</span>
01175 <span class="stringliteral">    }</span>
01176 <span class="stringliteral">    if (NULL != dockState) {</span>
01177 <span class="stringliteral">        ExFreePool (dockState);</span>
01178 <span class="stringliteral">    }</span>
01179 <span class="stringliteral"></span>
01180 <span class="stringliteral">    return status;</span>
01181 <span class="stringliteral">}</span>
</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="dockhwp.c::IopExecuteHwpDefaultSelect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopExecuteHwpDefaultSelect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html">PCM_HARDWARE_PROFILE_LIST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProfileList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ProfileIndexToUse</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01014">1014</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01028">IopExecuteHardwareProfileChange()</a>.
<p>
<pre class="fragment"><div>01019 {
01020     UNREFERENCED_PARAMETER (Context);
01021 
01022     * ProfileIndexToUse = 0;
01023 
01024     <span class="keywordflow">return</span> STATUS_SUCCESS;
01025 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="dockhwp.c::IopHardwareProfileBeginTransition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileBeginTransition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubsumeExistingDeparture</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00103">103</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00510">IopStartDevice()</a>.
<p>
<pre class="fragment"><div>00108                    :
00109 
00110     This routine must be called before any dock devnodes can be marked <span class="keywordflow">for</span>
00111     transition (ie arriving or departing). After calling <span class="keyword">this</span> function,
00112     <a class="code" href="../../d9/d0/dockhwp_8c.html#a13">IopHardwareProfileMarkDock</a> should be called <span class="keywordflow">for</span> each dock that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> appearing
00113     or disappearing.
00114 
00115     Functionally, <span class="keyword">this</span> code acquires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile change semaphore. Future
00116     changes in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> life of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> added dock devnodes cause <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> to be released.
00117 
00118 Arguments:
00119 
00120     SubsumeExistingDeparture - Set <span class="keywordflow">if</span> we are ejecting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent of a
00121                                device that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> still in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process of
00122                                ejecting...
00123 
00124 Return Value:
00125 
00126     None.
00127 
00128 --*/
00129 {
00130     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status ;
00131 
00132     <span class="keywordflow">if</span> (SubsumeExistingDeparture) {
00133 
00134         <span class="comment">//</span>
00135         <span class="comment">// We will already have queried in this case. Also, enumeration is</span>
00136         <span class="comment">// locked right now, so the appropriate devices found cannot disappear.</span>
00137         <span class="comment">// Assert everything is consistant.</span>
00138         <span class="comment">//</span>
00139         <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00140         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IopDocksInTransition != 0) ;
00141         <span class="keywordflow">return</span> ;
00142     }
00143 
00144     <span class="comment">//</span>
00145     <span class="comment">// Take the profile change semaphore. We do this whenever a dock is</span>
00146     <span class="comment">// in our list, even if no query is going to occur.</span>
00147     <span class="comment">//</span>
00148     status = <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(
00149         &amp;IopProfileChangeSemaphore,
00150         Executive,
00151         KernelMode,
00152         FALSE,
00153         NULL
00154         );
00155 
00156     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(status == STATUS_SUCCESS) ;
00157 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="dockhwp.c::IopHardwareProfileCancelRemovedDock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileCancelRemovedDock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceNode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">572</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a207">DOCK_EJECTIRP_COMPLETED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00056">IO_NO_INCREMENT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">IopHardwareProfileSendCancel()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00795">IopHardwareProfileSendCommit()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05034">IopProcessNewProfile()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00075">IopProfileChangeCancelRequired</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>.
<p>
<pre class="fragment"><div>00577                    :
00578 
00579     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when a dock that was marked to disappear didn'<a class="code" href="../../d5/d1/genppc_8c.html#a17">t</a> (ie,
00580     after the eject, the dock device still enumerated). We remove <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00581     transition list and complete/cancel <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a> profile change as appropriate.
00582     See <a class="code" href="../../d9/d0/dockhwp_8c.html#a19">IopHardwareProfileSetMarkedDocksEjected</a>.
00583 
00584 Arguments:
00585 
00586     DeviceNode - Supplies a pointer to a device node which will be started and
00587                  enumerated.
00588 
00589 Return Value:
00590 
00591     None.
00592 
00593 --*/
00594 {
00595     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00596     BOOLEAN  profileChanged ;
00597     LONG     remainingDockCount ;
00598 
00599     <span class="comment">//</span>
00600     <span class="comment">// Acquire the lock on the list of dock devices</span>
00601     <span class="comment">//</span>
00602     ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00603 
00604     <span class="comment">//</span>
00605     <span class="comment">// Since we are about to remove this dock device from the list of</span>
00606     <span class="comment">// all dock devices present, the list should not be empty.</span>
00607     <span class="comment">//</span>
00608     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00609     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceNode-&gt;DockInfo.DockStatus == DOCK_EJECTIRP_COMPLETED) ;
00610     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IsListEmpty(&amp;DeviceNode-&gt;DockInfo.ListEntry)) ;
00611 
00612     DeviceNode-&gt;DockInfo.DockStatus = <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a> ;
00613     remainingDockCount = InterlockedDecrement(&amp;IopDocksInTransition) ;
00614     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(remainingDockCount &gt;= 0) ;
00615 
00616     <span class="comment">//</span>
00617     <span class="comment">// Release the lock on the list of dock devices</span>
00618     <span class="comment">//</span>
00619     ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00620 
00621     <span class="keywordflow">if</span> (remainingDockCount) {
00622 
00623         <span class="keywordflow">return</span> ;
00624     }
00625 
00626     <span class="comment">//</span>
00627     <span class="comment">// Update the current Hardware Profile after removing this device.</span>
00628     <span class="comment">//</span>
00629     status = <a class="code" href="../../d9/d0/dockhwp_8c.html#a9">IopUpdateHardwareProfile</a>(&amp;profileChanged);
00630 
00631     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00632 
00633         <span class="comment">//</span>
00634         <span class="comment">// So we're there physically, but not mentally? Too bad, where broadcasting</span>
00635         <span class="comment">// change either way.</span>
00636         <span class="comment">//</span>
00637         PIDBGMSG(
00638             PIDBG_HWPROFILE,
00639             (<span class="stringliteral">"IopUpdateHardwareProfile failed with status == %lx\n"</span>, status)
00640             ) ;
00641         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) ;
00642     }
00643 
00644     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; profileChanged) {
00645 
00646         <a class="code" href="../../d9/d0/dockhwp_8c.html#a10">IopHardwareProfileSendCommit</a>() ;
00647         <a class="code" href="../../d9/d0/pnpiop_8h.html#a361">IopProcessNewProfile</a>();
00648 
00649     } <span class="keywordflow">else</span> {
00650 
00651         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IopProfileChangeCancelRequired) ;
00652         <a class="code" href="../../d9/d0/dockhwp_8c.html#a11">IopHardwareProfileSendCancel</a>() ;
00653     }
00654 
00655     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(
00656         &amp;IopProfileChangeSemaphore,
00657         IO_NO_INCREMENT,
00658         1,
00659         FALSE
00660         );
00661 
00662     <span class="keywordflow">return</span> ;
00663 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="dockhwp.c::IopHardwareProfileCancelTransition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileCancelTransition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">666</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a207">DOCK_EJECTIRP_COMPLETED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a203">DOCK_NOTDOCKDEVICE</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o42">_DEVICE_NODE::DockInfo</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00056">IO_NO_INCREMENT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00071">IopDockDeviceListHead</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">IopHardwareProfileSendCancel()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00075">IopProfileChangeCancelRequired</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, and <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00510">IopStartDevice()</a>.
<p>
<pre class="fragment"><div>00671                    :
00672 
00673     This routine unmarks any marked devnodes (ie, sets them to no change,
00674     appearing or disappearing), and sends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CancelQueryProfileChange as
00675     appropriate. Once called, other profile changes can occur.
00676 
00677 Arguments:
00678 
00679     None.
00680 
00681 Return Value:
00682 
00683     Nodda.
00684 
00685 --*/
00686 {
00687     PLIST_ENTRY  listEntry;
00688     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> devNode;
00689 
00690     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00691 
00692     <span class="comment">//</span>
00693     <span class="comment">// Acquire the lock on the list of dock devices</span>
00694     <span class="comment">//</span>
00695     ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00696 
00697     <span class="keywordflow">for</span> (listEntry  = <a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>.Flink;
00698         listEntry != &amp;(<a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>);
00699         listEntry  = listEntry-&gt;Flink ) {
00700 
00701         devNode = CONTAINING_RECORD(listEntry,
00702                                     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>,
00703                                     DockInfo.ListEntry);
00704 
00705         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != DOCK_NOTDOCKDEVICE)&amp;&amp;
00706                (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != DOCK_EJECTIRP_COMPLETED)) ;
00707         <span class="keywordflow">if</span> (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>) {
00708 
00709             InterlockedDecrement(&amp;IopDocksInTransition) ;
00710             devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus = <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a> ;
00711         }
00712     }
00713 
00714     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IopDocksInTransition) ;
00715 
00716     <span class="comment">//</span>
00717     <span class="comment">// Release the lock on the list of dock devices</span>
00718     <span class="comment">//</span>
00719     ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00720 
00721     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a>) {
00722 
00723         <a class="code" href="../../d9/d0/dockhwp_8c.html#a11">IopHardwareProfileSendCancel</a>() ;
00724     }
00725 
00726     <span class="comment">//</span>
00727     <span class="comment">// No need to broadcast the cancels here, as IopQueryHardwareProfileChange</span>
00728     <span class="comment">// will have taken care of the cancels for us.</span>
00729     <span class="comment">//</span>
00730     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(
00731         &amp;IopProfileChangeSemaphore,
00732         IO_NO_INCREMENT,
00733         1,
00734         FALSE
00735         );
00736 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="dockhwp.c::IopHardwareProfileCommitRemovedDock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileCommitRemovedDock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceNode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">465</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a206">DOCK_DEPARTING</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a207">DOCK_EJECTIRP_COMPLETED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00056">IO_NO_INCREMENT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00072">IopDockDeviceCount</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">IopHardwareProfileSendCancel()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00795">IopHardwareProfileSendCommit()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05034">IopProcessNewProfile()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00075">IopProfileChangeCancelRequired</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00232">IopDeleteLockedDeviceNode()</a>.
<p>
<pre class="fragment"><div>00470                    :
00471 
00472     This routine removes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of current dock
00473     devices and requests a Hardware Profile change.
00474 
00475 Arguments:
00476 
00477     DeviceNode - Supplies a pointer to a device node which has been listed as
00478                  missing in a previous enumeration, has had <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> remove <a class="code" href="../../d0/d2/struct__IRP.html">IRP</a>
00479                  sent to <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>, and <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> about to be deleted.
00480 
00481 Return Value:
00482 
00483     None.
00484 
00485 --*/
00486 {
00487     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00488     BOOLEAN  profileChanged ;
00489     LONG     remainingDockCount ;
00490 
00491     <span class="comment">//</span>
00492     <span class="comment">// Acquire the lock on the list of dock devices</span>
00493     <span class="comment">//</span>
00494     ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00495 
00496     <span class="comment">//</span>
00497     <span class="comment">// Since we are about to remove this dock device from the list of</span>
00498     <span class="comment">// all dock devices present, the list should not be empty.</span>
00499     <span class="comment">//</span>
00500     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00501     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((DeviceNode-&gt;DockInfo.DockStatus == DOCK_DEPARTING)||
00502            (DeviceNode-&gt;DockInfo.DockStatus == DOCK_EJECTIRP_COMPLETED)) ;
00503     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IsListEmpty(&amp;DeviceNode-&gt;DockInfo.ListEntry)) ;
00504 
00505     <span class="comment">//</span>
00506     <span class="comment">// Remove the current devnode from the list of docks</span>
00507     <span class="comment">//</span>
00508     RemoveEntryList(&amp;DeviceNode-&gt;DockInfo.ListEntry);
00509     InitializeListHead(&amp;DeviceNode-&gt;DockInfo.ListEntry);
00510     <span class="keywordflow">if</span> (DeviceNode-&gt;DockInfo.SerialNumber) {
00511 
00512         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode-&gt;DockInfo.SerialNumber);
00513         DeviceNode-&gt;DockInfo.SerialNumber = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00514     }
00515     <a class="code" href="../../d9/d0/dockhwp_8c.html#a2">IopDockDeviceCount</a>--;
00516 
00517     DeviceNode-&gt;DockInfo.DockStatus = <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a> ;
00518     remainingDockCount = InterlockedDecrement(&amp;IopDocksInTransition) ;
00519     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(remainingDockCount &gt;= 0) ;
00520 
00521     <span class="comment">//</span>
00522     <span class="comment">// Release the lock on the list of dock devices</span>
00523     <span class="comment">//</span>
00524     ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00525 
00526     <span class="keywordflow">if</span> (remainingDockCount) {
00527 
00528         <span class="keywordflow">return</span> ;
00529     }
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">// Update the current Hardware Profile after removing this device.</span>
00533     <span class="comment">//</span>
00534     status = <a class="code" href="../../d9/d0/dockhwp_8c.html#a9">IopUpdateHardwareProfile</a>(&amp;profileChanged);
00535 
00536     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00537 
00538         <span class="comment">//</span>
00539         <span class="comment">// So we're there physically, but not mentally? Too bad, where broadcasting</span>
00540         <span class="comment">// change either way.</span>
00541         <span class="comment">//</span>
00542         PIDBGMSG(
00543             PIDBG_HWPROFILE,
00544             (<span class="stringliteral">"IopUpdateHardwareProfile failed with status == %lx\n"</span>, status)
00545             ) ;
00546 
00547         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) ;
00548     }
00549 
00550     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; profileChanged) {
00551 
00552         <a class="code" href="../../d9/d0/dockhwp_8c.html#a10">IopHardwareProfileSendCommit</a>() ;
00553         <a class="code" href="../../d9/d0/pnpiop_8h.html#a361">IopProcessNewProfile</a>();
00554 
00555     } <span class="keywordflow">else</span> {
00556 
00557         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IopProfileChangeCancelRequired) ;
00558         <a class="code" href="../../d9/d0/dockhwp_8c.html#a11">IopHardwareProfileSendCancel</a>() ;
00559     }
00560 
00561     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(
00562         &amp;IopProfileChangeSemaphore,
00563         IO_NO_INCREMENT,
00564         1,
00565         FALSE
00566         );
00567 
00568     <span class="keywordflow">return</span> ;
00569 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="dockhwp.c::IopHardwareProfileCommitStartedDock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileCommitStartedDock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceNode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">370</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a205">DOCK_ARRIVING</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00056">IO_NO_INCREMENT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">IopHardwareProfileSendCancel()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00795">IopHardwareProfileSendCommit()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05034">IopProcessNewProfile()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00075">IopProfileChangeCancelRequired</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l03195">IopQueryDeviceSerialNumber()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00510">IopStartDevice()</a>.
<p>
<pre class="fragment"><div>00375                    :
00376 
00377     This routine adds <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified device from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of current dock
00378     devices and requests a Hardware Profile change.
00379 
00380 Arguments:
00381 
00382     DeviceNode  - Supplies a pointer to a device node which will be started and
00383                   enumerated.
00384 
00385 Return Value:
00386 
00387     None.
00388 
00389 --*/
00390 {
00391     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00392     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> deviceObject;
00393     PWCHAR  deviceSerialNumber;
00394     BOOLEAN profileChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00395 
00396     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00397     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceNode-&gt;DockInfo.DockStatus == DOCK_ARRIVING) ;
00398     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IsListEmpty(&amp;DeviceNode-&gt;DockInfo.ListEntry)) ;
00399 
00400     DeviceNode-&gt;DockInfo.DockStatus = <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a> ;
00401     InterlockedDecrement(&amp;IopDocksInTransition) ;
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">// We only add one dock at a time. So this should have been the last!</span>
00405     <span class="comment">//</span>
00406     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IopDocksInTransition) ;
00407 
00408     <span class="comment">//</span>
00409     <span class="comment">// Retrieve the Serial Number from this dock device</span>
00410     <span class="comment">//</span>
00411     <span class="keywordflow">if</span> (DeviceNode-&gt;DockInfo.SerialNumber == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00412 
00413         deviceObject = DeviceNode-&gt;PhysicalDeviceObject;
00414 
00415         status = <a class="code" href="../../d0/d1/pnpirp_8c.html#a35">IopQueryDeviceSerialNumber</a>(deviceObject,
00416                                             &amp;deviceSerialNumber);
00417 
00418         DeviceNode-&gt;DockInfo.SerialNumber = deviceSerialNumber;
00419 
00420         <span class="comment">//</span>
00421         <span class="comment">// Update the current Hardware Profile after successfully starting this</span>
00422         <span class="comment">// device. This routine does two things for us:</span>
00423         <span class="comment">// 1) It determines whether the profile actually changed and updates</span>
00424         <span class="comment">//    the global flag IopProfileChangeOccured appropriately.</span>
00425         <span class="comment">// 2) If the profile changed, this routine updates the registry, but</span>
00426         <span class="comment">//    does *not* broadcast the profile change around.</span>
00427         <span class="comment">//</span>
00428         status = <a class="code" href="../../d9/d0/dockhwp_8c.html#a9">IopUpdateHardwareProfile</a>(&amp;profileChanged);
00429         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00430 
00431             PIDBGMSG(
00432                 PIDBG_HWPROFILE,
00433                 (<span class="stringliteral">"IopUpdateHardwareProfile failed with status == %lx\n"</span>, status)
00434                 ) ;
00435         }
00436 
00437     } <span class="keywordflow">else</span> {
00438         <span class="comment">//</span>
00439         <span class="comment">// Couldn't get Serial Number for this dock device, or serial number was NULL</span>
00440         <span class="comment">//</span>
00441         status = STATUS_UNSUCCESSFUL;
00442     }
00443 
00444     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; profileChanged) {
00445 
00446         <a class="code" href="../../d9/d0/dockhwp_8c.html#a10">IopHardwareProfileSendCommit</a>() ;
00447         <a class="code" href="../../d9/d0/pnpiop_8h.html#a361">IopProcessNewProfile</a>();
00448 
00449     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a>) {
00450 
00451         <a class="code" href="../../d9/d0/dockhwp_8c.html#a11">IopHardwareProfileSendCancel</a>() ;
00452     }
00453 
00454     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(
00455         &amp;IopProfileChangeSemaphore,
00456         IO_NO_INCREMENT,
00457         1,
00458         FALSE
00459         );
00460 
00461     <span class="keywordflow">return</span> ;
00462 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="dockhwp.c::IopHardwareProfileMarkDock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileMarkDock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceNode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d0/pnpiop_8h.html#a387">PROFILE_STATUS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ChangeInPresence</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">160</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a205">DOCK_ARRIVING</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a206">DOCK_DEPARTING</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o42">_DEVICE_NODE::DockInfo</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00072">IopDockDeviceCount</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00071">IopDockDeviceListHead</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l03195">IopQueryDeviceSerialNumber()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00151">_DEVICE_NODE::PhysicalDeviceObject</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00510">IopStartDevice()</a>.
<p>
<pre class="fragment"><div>00166                    :
00167 
00168     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to mark a dock as <span class="stringliteral">"in transition"</span>, ie <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either
00169     disappearing or appearing, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> results of which determine our <span class="keyword">final</span>
00170     hardware profile state. After all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> docks that are transitioning have
00171     been passed into <span class="keyword">this</span> function, <a class="code" href="../../d9/d0/dockhwp_8c.html#a14">IopHardwareProfileQueryChange</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00172 
00173 Arguments:
00174 
00175     DeviceNode          - The dock devnode that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> appearing or disappearing
00176     ChangeInPresence    - Either <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a206">DOCK_DEPARTING</a> or <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a205">DOCK_ARRIVING</a>
00177 
00178 Return Value:
00179 
00180     Nope.
00181 
00182 --*/
00183 {
00184     PWCHAR          deviceSerialNumber;
00185     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>  deviceObject;
00186     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>        status;
00187 
00188     <span class="comment">//</span>
00189     <span class="comment">// Verify we are under semaphore, we aren't marking the dock twice, and</span>
00190     <span class="comment">// our parameters are sensable.</span>
00191     <span class="comment">//</span>
00192     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00193     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus == DOCK_QUIESCENT) ;
00194     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((ChangeInPresence == DOCK_DEPARTING)||
00195            (ChangeInPresence == DOCK_ARRIVING)) ;
00196 
00197     <span class="keywordflow">if</span> (ChangeInPresence == <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a205">DOCK_ARRIVING</a>) {
00198 
00199         <span class="comment">//</span>
00200         <span class="comment">// First, ensure this dock is a member of the dock list.</span>
00201         <span class="comment">// ADRIAO BUGBUG 11/12/98 -</span>
00202         <span class="comment">//     We should move this into IopProcessNewDeviceNode.</span>
00203         <span class="comment">//</span>
00204         <span class="keywordflow">if</span> (IsListEmpty(&amp;DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.ListEntry)) {
00205 
00206             <span class="comment">//</span>
00207             <span class="comment">// Acquire the lock on the list of dock devices</span>
00208             <span class="comment">//</span>
00209             ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00210 
00211             <span class="comment">//</span>
00212             <span class="comment">// Add this element to the head of the list</span>
00213             <span class="comment">//</span>
00214             InsertHeadList(&amp;IopDockDeviceListHead,
00215                            &amp;DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.ListEntry);
00216             <a class="code" href="../../d9/d0/dockhwp_8c.html#a2">IopDockDeviceCount</a>++;
00217 
00218             <span class="comment">//</span>
00219             <span class="comment">// Release the lock on the list of dock devices</span>
00220             <span class="comment">//</span>
00221             ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00222         }
00223 
00224         <span class="comment">//</span>
00225         <span class="comment">// Retrieve the Serial Number from this dock device. We do this just</span>
00226         <span class="comment">// to test the BIOS today. Later we will be acquiring the information</span>
00227         <span class="comment">// to determine the profile we are *about* to enter.</span>
00228         <span class="comment">//</span>
00229         deviceObject = DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o9">PhysicalDeviceObject</a>;
00230         status = <a class="code" href="../../d0/d1/pnpirp_8c.html#a35">IopQueryDeviceSerialNumber</a>(deviceObject,
00231                                             &amp;deviceSerialNumber);
00232 
00233         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; (deviceSerialNumber != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00234 
00235             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(deviceSerialNumber) ;
00236         }
00237 
00238     } <span class="keywordflow">else</span> {
00239 
00240         <span class="comment">//</span>
00241         <span class="comment">// DOCK_DEPARTING case, we must be a member of the dock list...</span>
00242         <span class="comment">//</span>
00243         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IsListEmpty(&amp;DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.ListEntry)) ;
00244     }
00245 
00246     InterlockedIncrement(&amp;IopDocksInTransition) ;
00247     DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus = ChangeInPresence ;
00248 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="dockhwp.c::IopHardwareProfileQueryChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopHardwareProfileQueryChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SubsumingExistingDeparture</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a388">PROFILE_NOTIFICATION_TIME</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InPnpEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PPNP_VETO_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>VetoType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING VetoName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">251</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a205">DOCK_ARRIVING</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a207">DOCK_EJECTIRP_COMPLETED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a203">DOCK_NOTDOCKDEVICE</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o42">_DEVICE_NODE::DockInfo</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00071">IopDockDeviceListHead</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">IopDocksInTransition</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00075">IopProfileChangeCancelRequired</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06672">IopRequestHwProfileChangeNotification()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00510">IopStartDevice()</a>.
<p>
<pre class="fragment"><div>00259                    :
00260 
00261     This function queries drivers to see <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> OK to <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00262     hardware profile and enter next one (as determined by which docks have
00263     been marked). One of three <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a> should be used subsequently to <span class="keyword">this</span>
00264     call:
00265         <a class="code" href="../../d9/d0/pnpiop_8h.html#a380">IopHardwareProfileCommitStartedDock</a> (call when a dock has successfully
00266                                              started)
00267         <a class="code" href="../../d9/d0/pnpiop_8h.html#a381">IopHardwareProfileCommitRemovedDock</a> (call when a dock is no longer
00268                                              present in the system)
00269         <a class="code" href="../../d9/d0/pnpiop_8h.html#a383">IopHardwareProfileCancelTransition</a>  (call to abort a transition, say
00270                                              <span class="keywordflow">if</span> a dock failed to start or a
00271                                              query returned failure <span class="keywordflow">for</span> eject)
00272 
00273 Arguments:
00274 
00275     InPnpEvent  - This argument indicates whether an operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being done
00276                   within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context of another PnpEvent or not. If not, we
00277                   will queue such an event and block on <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>. If so, we cannot
00278                   queue&amp;block (we'd deadlock), so we <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query manually.
00279     VetoType    - If <span class="keyword">this</span> function returns <span class="keyword">false</span>, <span class="keyword">this</span> parameter will describe
00280                   who failed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query profile change. The below optional
00281                   parameter will contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of said vetoer.
00282     VetoName    - This optional parameter will get <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> vetoer (ie
00283                   devinst, service name, application name, etc). If VetoName
00284                   <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> supplied, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller must free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer returned.
00285 
00286 Return Value:
00287 
00288     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>.
00289 
00290 --*/
00291 {
00292     <a class="code" href="../../d2/d6/structPROFILE__WORK__ITEM.html">PROFILE_WORK_ITEM</a> profileWorkItem;
00293     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00294     BOOLEAN arrivingDockFound;
00295     PLIST_ENTRY listEntry ;
00296     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> devNode ;
00297 
00298     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00299 
00300     <span class="comment">//</span>
00301     <span class="comment">// Acquire the lock on the list of dock devices and determine whether any</span>
00302     <span class="comment">// dock devnodes are arriving.</span>
00303     <span class="comment">//</span>
00304     ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00305 
00306     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IopDocksInTransition) ;
00307 
00308     arrivingDockFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00309     <span class="keywordflow">for</span> (listEntry  = <a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>.Flink;
00310         listEntry != &amp;(<a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>);
00311         listEntry  = listEntry-&gt;Flink ) {
00312 
00313         devNode = CONTAINING_RECORD(listEntry,
00314                                     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>,
00315                                     DockInfo.ListEntry);
00316 
00317         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != DOCK_NOTDOCKDEVICE)&amp;&amp;
00318                (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != DOCK_EJECTIRP_COMPLETED)) ;
00319 
00320         <span class="keywordflow">if</span> (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus == <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a205">DOCK_ARRIVING</a>) {
00321 
00322             arrivingDockFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00323         }
00324     }
00325 
00326     <span class="comment">//</span>
00327     <span class="comment">// Release the lock on the list of dock devices</span>
00328     <span class="comment">//</span>
00329     ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00330 
00331     <span class="keywordflow">if</span> (SubsumingExistingDeparture) {
00332 
00333         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IopProfileChangeCancelRequired) ;
00334         <span class="comment">//</span>
00335         <span class="comment">// We're nesting. Work off the last query, and don't requery.</span>
00336         <span class="comment">//</span>
00337         <span class="keywordflow">return</span> STATUS_SUCCESS ;
00338     }
00339 
00340     <span class="keywordflow">if</span> (arrivingDockFound) {
00341 
00342         <span class="comment">//</span>
00343         <span class="comment">// We currently don't actually query for hardware profile change on a</span>
00344         <span class="comment">// dock event as the user may have the lid closed. If we ever find a</span>
00345         <span class="comment">// piece of hardware that needs to be updated *prior* to actually</span>
00346         <span class="comment">// switching over, we will have to remove this bit of code.</span>
00347         <span class="comment">//</span>
00348         <a class="code" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00349         <span class="keywordflow">return</span> STATUS_SUCCESS ;
00350     }
00351 
00352     PIDBGMSG(PIDBG_HWPROFILE, (<span class="stringliteral">"NTOSKRNL: Sending HW profile change [query]\n"</span>)) ;
00353 
00354     status = <a class="code" href="../../d9/d0/pnpiop_8h.html#a348">IopRequestHwProfileChangeNotification</a>(
00355         (LPGUID) &amp;GUID_HWPROFILE_QUERY_CHANGE,
00356         InPnpEvent,
00357         VetoType,
00358         VetoName
00359         );
00360 
00361     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00362         <a class="code" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00363     } <span class="keywordflow">else</span> {
00364         <a class="code" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00365     }
00366     <span class="keywordflow">return</span> status ;
00367 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="dockhwp.c::IopHardwareProfileSendCancel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileSendCancel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">827</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06672">IopRequestHwProfileChangeNotification()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d0/pnpiop_8h.html#a388a210">PROFILE_PERHAPS_IN_PNPEVENT</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>.
<p>
<pre class="fragment"><div>00832                    :
00833 
00834     This routine (internal to dockhwp.c) simply sends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cancel.
00835 
00836 Arguments:
00837 
00838     None.
00839 
00840 Return Value:
00841 
00842     Nodda.
00843 
00844 --*/
00845 {
00846     <a class="code" href="../../d2/d6/structPROFILE__WORK__ITEM.html">PROFILE_WORK_ITEM</a>   profileWorkItem;
00847     PNP_VETO_TYPE       vetoType;
00848     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
00849 
00850     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00851     PIDBGMSG(PIDBG_HWPROFILE, (<span class="stringliteral">"NTOSKRNL: Sending HW profile change [cancel]\n"</span>)) ;
00852 
00853     <a class="code" href="../../d9/d0/pnpiop_8h.html#a348">IopRequestHwProfileChangeNotification</a>(
00854         (LPGUID) &amp;GUID_HWPROFILE_CHANGE_CANCELLED,
00855         PROFILE_PERHAPS_IN_PNPEVENT,
00856         NULL,
00857         NULL
00858         ) ;
00859 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="dockhwp.c::IopHardwareProfileSendCommit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileSendCommit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00795">795</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06672">IopRequestHwProfileChangeNotification()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d0/pnpiop_8h.html#a388a210">PROFILE_PERHAPS_IN_PNPEVENT</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>.
<p>
<pre class="fragment"><div>00800                    :
00801 
00802     This routine (internal to dockhwp.c) simply sends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> change complete message.
00803     We <span class="keywordflow">do</span> not wait <span class="keywordflow">for</span> <span class="keyword">this</span>, as <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> asynchronous...
00804 
00805 Arguments:
00806 
00807     None.
00808 
00809 Return Value:
00810 
00811     Nodda.
00812 
00813 --*/
00814 {
00815     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00816     PIDBGMSG(PIDBG_HWPROFILE, (<span class="stringliteral">"NTOSKRNL: Sending HW profile change [commit]\n"</span>)) ;
00817 
00818     <a class="code" href="../../d9/d0/pnpiop_8h.html#a348">IopRequestHwProfileChangeNotification</a>(
00819         (LPGUID) &amp;GUID_HWPROFILE_CHANGE_COMPLETE,
00820         PROFILE_PERHAPS_IN_PNPEVENT,
00821         NULL,
00822         NULL
00823         );
00824 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="dockhwp.c::IopHardwareProfileSetMarkedDocksEjected" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopHardwareProfileSetMarkedDocksEjected           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00739">739</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00035">ASSERT_SEMA_NOT_SIGNALLED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a206">DOCK_DEPARTING</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a207">DOCK_EJECTIRP_COMPLETED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o42">_DEVICE_NODE::DockInfo</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00071">IopDockDeviceListHead</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">IopProfileChangeSemaphore</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01417">IopProcessCompletedEject()</a>.
<p>
<pre class="fragment"><div>00744                    :
00745 
00746     This routine moves any departing devnodes to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ejected state. If any
00747     subsequent enumeration lists <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device as present, we know <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> eject
00748     failed and we appropriately cancel that piece of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile change.
00749     <a class="code" href="../../d9/d0/dockhwp_8c.html#a17">IopHardwareProfileCancelRemovedDock</a> can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called after <span class="keyword">this</span> function
00750     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00751 
00752 Arguments:
00753 
00754     None.
00755 
00756 Return Value:
00757 
00758     Nodda.
00759 
00760 --*/
00761 {
00762     PLIST_ENTRY  listEntry;
00763     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> devNode;
00764 
00765     <a class="code" href="../../d9/d0/dockhwp_8c.html#a0">ASSERT_SEMA_NOT_SIGNALLED</a>(&amp;IopProfileChangeSemaphore) ;
00766 
00767     <span class="comment">//</span>
00768     <span class="comment">// Acquire the lock on the list of dock devices</span>
00769     <span class="comment">//</span>
00770     ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00771 
00772     <span class="keywordflow">for</span> (listEntry  = <a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>.Flink;
00773         listEntry != &amp;(<a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>);
00774         listEntry  = listEntry-&gt;Flink ) {
00775 
00776         devNode = CONTAINING_RECORD(listEntry,
00777                                     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>,
00778                                     DockInfo.ListEntry);
00779 
00780         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus == DOCK_QUIESCENT)||
00781                (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus == DOCK_DEPARTING)) ;
00782         <span class="keywordflow">if</span> (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a204">DOCK_QUIESCENT</a>) {
00783 
00784             devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus = <a class="code" href="../../d9/d0/pnpiop_8h.html#a387a207">DOCK_EJECTIRP_COMPLETED</a> ;
00785         }
00786     }
00787 
00788     <span class="comment">//</span>
00789     <span class="comment">// Release the lock on the list of dock devices</span>
00790     <span class="comment">//</span>
00791     ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00792 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="dockhwp.c::IopUpdateHardwareProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopUpdateHardwareProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PBOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ProfileChanged</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">862</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l01593">CM_HARDWARE_PROFILE_STR_CURRENT_DOCK_INFO</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l01566">CM_HARDWARE_PROFILE_STR_DATABASE</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a387a203">DOCK_NOTDOCKDEVICE</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o42">_DEVICE_NODE::DockInfo</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a392a226">HardwareProfileBusTypeACPI</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00072">IopDockDeviceCount</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00071">IopDockDeviceListHead</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">IopDockDeviceListLock</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01028">IopExecuteHardwareProfileChange()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05325">IopOpenRegistryKey()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>.
<p>
<pre class="fragment"><div>00866                    :
00867 
00868     This routine scans <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of current dock devices, builds a list of serial
00869     numbers from those devices, and calls <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Hardware Profile to be
00870     changed, based on that list.
00871 
00872 Arguments:
00873 
00874     ProfileChanged - Supplies a variable to receive <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current hardware
00875                      profile changes as a result of calling <span class="keyword">this</span> routine.
00876 
00877 Return Value:
00878 
00879     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> code.
00880 
00881 --*/
00882 {
00883     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status = STATUS_SUCCESS;
00884     PLIST_ENTRY  listEntry;
00885     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> devNode;
00886     PWCHAR  *profileSerialNumbers, *p;
00887     HANDLE  hProfileKey=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00888     ULONG   len, numProfiles;
00889     HANDLE  hCurrent, hIDConfigDB;
00890     UNICODE_STRING unicodeName;
00891 
00892     <span class="comment">//</span>
00893     <span class="comment">// Acquire the lock on the list of dock devices</span>
00894     <span class="comment">//</span>
00895     ExAcquireFastMutex(&amp;IopDockDeviceListLock);
00896 
00897     <span class="comment">//</span>
00898     <span class="comment">// Update the flag for Ejectable Docks</span>
00899     <span class="comment">//</span>
00900     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName, CM_HARDWARE_PROFILE_STR_DATABASE);
00901     <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d6/iop_8h.html#a198">IopOpenRegistryKey</a>(&amp;hIDConfigDB,
00902                                      NULL,
00903                                      &amp;unicodeName,
00904                                      KEY_READ,
00905                                      FALSE) )) {
00906 
00907         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName, CM_HARDWARE_PROFILE_STR_CURRENT_DOCK_INFO);
00908         <span class="keywordflow">if</span>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d6/iop_8h.html#a198">IopOpenRegistryKey</a>(&amp;hCurrent,
00909                                          hIDConfigDB,
00910                                          &amp;unicodeName,
00911                                          KEY_READ | KEY_WRITE,
00912                                          FALSE) )) {
00913 
00914             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName, REGSTR_VAL_EJECTABLE_DOCKS);
00915             ZwSetValueKey(hCurrent,
00916                           &amp;unicodeName,
00917                           0,
00918                           REG_DWORD,
00919                           &amp;IopDockDeviceCount,
00920                           <span class="keyword">sizeof</span>(IopDockDeviceCount));
00921             ZwClose(hCurrent);
00922         }
00923         ZwClose(hIDConfigDB);
00924     }
00925 
00926     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0/dockhwp_8c.html#a2">IopDockDeviceCount</a> == 0) {
00927         <span class="comment">//</span>
00928         <span class="comment">// if there are no dock devices, the list should</span>
00929         <span class="comment">// contain a single null entry, in addition to the null</span>
00930         <span class="comment">// termination.</span>
00931         <span class="comment">//</span>
00932         numProfiles = 1;
00933         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IsListEmpty(&amp;IopDockDeviceListHead));
00934     } <span class="keywordflow">else</span> {
00935         numProfiles = <a class="code" href="../../d9/d0/dockhwp_8c.html#a2">IopDockDeviceCount</a>;
00936         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!IsListEmpty(&amp;IopDockDeviceListHead));
00937     }
00938 
00939     <span class="comment">//</span>
00940     <span class="comment">// Allocate space for a null-terminated list of SerialNumber lists.</span>
00941     <span class="comment">//</span>
00942     len = (numProfiles+1)*<span class="keyword">sizeof</span>(PWCHAR);
00943     profileSerialNumbers = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, len);
00944 
00945     <span class="keywordflow">if</span> (profileSerialNumbers) {
00946 
00947         p = profileSerialNumbers;
00948 
00949         <span class="comment">//</span>
00950         <span class="comment">// Create the list of Serial Numbers</span>
00951         <span class="comment">//</span>
00952         <span class="keywordflow">for</span> (listEntry  = <a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>.Flink;
00953              listEntry != &amp;(<a class="code" href="../../d9/d0/dockhwp_8c.html#a1">IopDockDeviceListHead</a>);
00954              listEntry  = listEntry-&gt;Flink ) {
00955 
00956             devNode = CONTAINING_RECORD(listEntry,
00957                                         <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>,
00958                                         DockInfo.ListEntry);
00959 
00960             <span class="comment">//</span>
00961             <span class="comment">// ADRIAO BUGBUG 11/11/98 -</span>
00962             <span class="comment">//     Is everything in the quiescent state here?</span>
00963             <span class="comment">//</span>
00964             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.DockStatus != DOCK_NOTDOCKDEVICE) ;
00965             <span class="keywordflow">if</span> (devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.SerialNumber) {
00966                 *p = devNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.SerialNumber;
00967                 p++;
00968             }
00969         }
00970 
00971         ExReleaseFastMutex(&amp;IopDockDeviceListLock);
00972 
00973         <span class="keywordflow">if</span> (p == profileSerialNumbers) {
00974             <span class="comment">//</span>
00975             <span class="comment">// Set a single list entry to NULL if we look to be in an "undocked"</span>
00976             <span class="comment">// profile</span>
00977             <span class="comment">//</span>
00978             *p = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00979             p++;
00980         }
00981 
00982         <span class="comment">//</span>
00983         <span class="comment">// Null-terminate the list</span>
00984         <span class="comment">//</span>
00985         *p = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00986 
00987         numProfiles = (ULONG)(p - profileSerialNumbers);
00988 
00989         <span class="comment">//</span>
00990         <span class="comment">// Change the current Hardware Profile based on the new Dock State</span>
00991         <span class="comment">// and perform notification that the Hardware Profile has changed</span>
00992         <span class="comment">//</span>
00993         status = <a class="code" href="../../d9/d0/dockhwp_8c.html#a8">IopExecuteHardwareProfileChange</a>(HardwareProfileBusTypeACPI,
00994                                                  profileSerialNumbers,
00995                                                  numProfiles,
00996                                                  &amp;hProfileKey,
00997                                                  ProfileChanged);
00998         <span class="keywordflow">if</span> (hProfileKey) {
00999             ZwClose(hProfileKey);
01000         }
01001         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (profileSerialNumbers);
01002 
01003     } <span class="keywordflow">else</span> {
01004 
01005         ExReleaseFastMutex(&amp;IopDockDeviceListLock);
01006 
01007         status = STATUS_INSUFFICIENT_RESOURCES;
01008     }
01009 
01010     <span class="keywordflow">return</span> status;
01011 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a2" doxytag="dockhwp.c::IopDockDeviceCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d0/pnpiop_8h.html#a198">IopDockDeviceCount</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00072">72</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="dockhwp.c::IopDockDeviceListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d9/d0/pnpiop_8h.html#a196">IopDockDeviceListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00071">71</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">IopHardwareProfileQueryChange()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00739">IopHardwareProfileSetMarkedDocksEjected()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="dockhwp.c::IopDockDeviceListLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="el" href="../../d9/d0/pnpiop_8h.html#a197">IopDockDeviceListLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00073">73</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">IopHardwareProfileQueryChange()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00739">IopHardwareProfileSetMarkedDocksEjected()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="dockhwp.c::IopDocksInTransition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG <a class="el" href="../../d9/d0/pnpiop_8h.html#a200">IopDocksInTransition</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00076">76</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00103">IopHardwareProfileBeginTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">IopHardwareProfileQueryChange()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="dockhwp.c::IopProfileChangeCancelRequired" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d9/d0/dockhwp_8c.html#a5">IopProfileChangeCancelRequired</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00075">75</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">IopHardwareProfileQueryChange()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="dockhwp.c::IopProfileChangeSemaphore" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d7/struct__KSEMAPHORE.html">KSEMAPHORE</a> <a class="el" href="../../d9/d0/pnpiop_8h.html#a199">IopProfileChangeSemaphore</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00074">74</a> of file <a class="el" href="../../d0/d0/dockhwp_8c-source.html">dockhwp.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00103">IopHardwareProfileBeginTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00572">IopHardwareProfileCancelRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00666">IopHardwareProfileCancelTransition()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00370">IopHardwareProfileCommitStartedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00251">IopHardwareProfileQueryChange()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00827">IopHardwareProfileSendCancel()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00795">IopHardwareProfileSendCommit()</a>, and <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00739">IopHardwareProfileSetMarkedDocksEjected()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
