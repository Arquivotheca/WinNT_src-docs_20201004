<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: btnctl.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>btnctl.c</h1><a href="../../d8/d1/btnctl_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************** Module Header ********************************\</span>
00002 <span class="comment">* Module Name: btnctl.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Radio Button and Check Box Handling Routines</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* ??-???-???? ??????    Ported from Win 3.0 sources</span>
00010 <span class="comment">* 01-Feb-1991 mikeke    Added Revalidation code</span>
00011 <span class="comment">* 03-Jan-1992 ianja     Neutralized (ANSI/wide-character)</span>
00012 <span class="comment">\***************************************************************************/</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00015 <span class="preprocessor">#pragma hdrstop</span>
00016 <span class="preprocessor"></span>
00017 <span class="comment">/* ButtonCalcRect codes */</span>
<a name="l00018"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a0">00018</a> <span class="preprocessor">#define CBR_CLIENTRECT 0</span>
<a name="l00019"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a1">00019</a> <span class="preprocessor"></span><span class="preprocessor">#define CBR_CHECKBOX   1</span>
<a name="l00020"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a2">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define CBR_CHECKTEXT  2</span>
<a name="l00021"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a3">00021</a> <span class="preprocessor"></span><span class="preprocessor">#define CBR_GROUPTEXT  3</span>
<a name="l00022"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a4">00022</a> <span class="preprocessor"></span><span class="preprocessor">#define CBR_GROUPFRAME 4</span>
<a name="l00023"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a5">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define CBR_PUSHBUTTON 5</span>
00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a8">00025</a> CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d8/d1/btnctl_8c.html#a8">mpStyleCbr</a>[] = {
00026     <a class="code" href="../../d8/d1/btnctl_8c.html#a5">CBR_PUSHBUTTON</a>,  <span class="comment">/* BS_PUSHBUTTON */</span>
00027     <a class="code" href="../../d8/d1/btnctl_8c.html#a5">CBR_PUSHBUTTON</a>,  <span class="comment">/* BS_DEFPUSHBUTTON */</span>
00028     <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>,   <span class="comment">/* BS_CHECKBOX */</span>
00029     <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>,   <span class="comment">/* BS_AUTOCHECKBOX */</span>
00030     <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>,   <span class="comment">/* BS_RADIOBUTTON */</span>
00031     <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>,   <span class="comment">/* BS_3STATE */</span>
00032     <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>,   <span class="comment">/* BS_AUTO3STATE */</span>
00033     <a class="code" href="../../d8/d1/btnctl_8c.html#a3">CBR_GROUPTEXT</a>,   <span class="comment">/* BS_GROUPBOX */</span>
00034     <a class="code" href="../../d8/d1/btnctl_8c.html#a0">CBR_CLIENTRECT</a>,  <span class="comment">/* BS_USERBUTTON */</span>
00035     <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>,   <span class="comment">/* BS_AUTORADIOBUTTON */</span>
00036     <a class="code" href="../../d8/d1/btnctl_8c.html#a0">CBR_CLIENTRECT</a>,  <span class="comment">/* BS_PUSHBOX */</span>
00037     <a class="code" href="../../d8/d1/btnctl_8c.html#a0">CBR_CLIENTRECT</a>,  <span class="comment">/* BS_OWNERDRAW */</span>
00038 };
00039 
<a name="l00040"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a6">00040</a> <span class="preprocessor">#define IMAGE_BMMAX    IMAGE_CURSOR+1</span>
<a name="l00041"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a9">00041</a> <span class="preprocessor"></span><span class="keyword">static</span> CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d8/d1/btnctl_8c.html#a9">rgbType</a>[<a class="code" href="../../d8/d1/btnctl_8c.html#a6">IMAGE_BMMAX</a>] = {
00042     BS_BITMAP,          <span class="comment">// IMAGE_BITMAP</span>
00043     BS_ICON,            <span class="comment">// IMAGE_CURSOR</span>
00044     BS_ICON             <span class="comment">// IMAGE_ICON</span>
00045 };
00046 
<a name="l00047"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a7">00047</a> <span class="preprocessor">#define IsValidImage(imageType, realType, max)   \</span>
00048 <span class="preprocessor">    ((imageType &lt; max) &amp;&amp; (rgbType[imageType] == realType))</span>
00049 <span class="preprocessor"></span>
<a name="l00050"></a><a class="code" href="../../d1/d9/structtagBTNDATA.html">00050</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d9/structtagBTNDATA.html">tagBTNDATA</a> {
<a name="l00051"></a><a class="code" href="../../d1/d9/structtagBTNDATA.html#o0">00051</a>     LPWSTR  <a class="code" href="../../d1/d9/structtagBTNDATA.html#o0">lpsz</a>;       <span class="comment">// Text string</span>
<a name="l00052"></a><a class="code" href="../../d1/d9/structtagBTNDATA.html#o1">00052</a>     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a>   <a class="code" href="../../d1/d9/structtagBTNDATA.html#o1">pbutn</a>;      <span class="comment">// Button data</span>
<a name="l00053"></a><a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">00053</a>     WORD    <a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a>;     <span class="comment">// Alignment flags</span>
00054 } <a class="code" href="../../d1/d9/structtagBTNDATA.html">BTNDATA</a>, <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> * <a class="code" href="../../d1/d9/structtagBTNDATA.html">LPBTNDATA</a>;
00055 
00056 <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a13">xxxDrawButton</a>(<a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn, HDC hdc, UINT pbfPush);
00057 
<a name="l00058"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a12">00058</a> <a class="code" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a> <a class="code" href="../../d8/d1/btnctl_8c.html#a12">ButtonLookaside</a>;
00059 
00060 <span class="comment">/***************************************************************************\</span>
00061 <span class="comment">*</span>
00062 <span class="comment">*  IsPushButton()</span>
00063 <span class="comment">*</span>
00064 <span class="comment">*  Returns non-zero if the window is a push button.  Returns flags that</span>
00065 <span class="comment">*  are interesting if it is.  These flags are</span>
00066 <span class="comment">*</span>
00067 <span class="comment">*</span>
00068 <span class="comment">*</span>
00069 <span class="comment">\***************************************************************************/</span>
00070 
<a name="l00071"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a14">00071</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d8/d1/btnctl_8c.html#a14">IsPushButton</a>(
00072     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00073 {
00074     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bStyle;
00075     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> flags;
00076 
00077     bStyle = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>);
00078 
00079     flags = 0;
00080 
00081     <span class="keywordflow">switch</span> (bStyle) {
00082         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_PUSHBUTTON):
00083             flags |= <a class="code" href="../../d6/d0/usercli_8h.html#a50">PBF_PUSHABLE</a>;
00084             <span class="keywordflow">break</span>;
00085 
00086         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_DEFPUSHBUTTON):
00087             flags |= <a class="code" href="../../d6/d0/usercli_8h.html#a50">PBF_PUSHABLE</a> | <a class="code" href="../../d6/d0/usercli_8h.html#a51">PBF_DEFAULT</a>;
00088             <span class="keywordflow">break</span>;
00089 
00090         <span class="keywordflow">default</span>:
00091             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a673">BFPUSHLIKE</a>))
00092                 flags |= <a class="code" href="../../d6/d0/usercli_8h.html#a50">PBF_PUSHABLE</a>;
00093             <span class="keywordflow">break</span>;
00094     }
00095 
00096     <span class="keywordflow">return</span>(flags);
00097 }
00098 
00099 <span class="comment">/***************************************************************************\</span>
00100 <span class="comment">*</span>
00101 <span class="comment">*  GetAlignment()</span>
00102 <span class="comment">*</span>
00103 <span class="comment">*  Gets default alignment of button.  If BS_HORZMASK and/or BS_VERTMASK</span>
00104 <span class="comment">*  is specified, uses those.  Otherwise, uses default for button.</span>
00105 <span class="comment">*</span>
00106 <span class="comment">* It's probably a fine time to describe what alignment flags mean for</span>
00107 <span class="comment">* each type of button.  Note that the presence of a bitmap/icon affects</span>
00108 <span class="comment">* the meaning of alignments.</span>
00109 <span class="comment">*</span>
00110 <span class="comment">* (1) Push like buttons</span>
00111 <span class="comment">*      With one of {bitmap, icon, text}:</span>
00112 <span class="comment">*          Just like you'd expect</span>
00113 <span class="comment">*      With one of {bitmap, icon} AND text:</span>
00114 <span class="comment">*          Image &amp; text are centered as a unit; alignment means where</span>
00115 <span class="comment">*          the image shows up.  E.G., left-aligned means the image</span>
00116 <span class="comment">*          on the left, text on the right.</span>
00117 <span class="comment">* (2) Radio/check like buttons</span>
00118 <span class="comment">*      Left aligned means check/radio box is on left, then bitmap/icon</span>
00119 <span class="comment">*          and text follows, left justified.</span>
00120 <span class="comment">*      Right aligned means checkk/radio box is on right, preceded by</span>
00121 <span class="comment">*          text and bitmap/icon, right justified.</span>
00122 <span class="comment">*      Centered has no meaning.</span>
00123 <span class="comment">*      With one of {bitmap, icon} AND text:</span>
00124 <span class="comment">*          Top aligned means bitmap/icon above, text below</span>
00125 <span class="comment">*          Bottom aligned means text above, bitmap/icon below</span>
00126 <span class="comment">*      With one of {bitmap, icon, text}</span>
00127 <span class="comment">*          Alignments mean what you'd expect.</span>
00128 <span class="comment">* (3) Group boxes</span>
00129 <span class="comment">*      Left aligned means text is left justified on left side</span>
00130 <span class="comment">*      Right aligned means text is right justified on right side</span>
00131 <span class="comment">*      Center aligned means text is in middle</span>
00132 <span class="comment">*</span>
00133 <span class="comment">*</span>
00134 <span class="comment">\***************************************************************************/</span>
00135 
<a name="l00136"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a15">00136</a> WORD <a class="code" href="../../d8/d1/btnctl_8c.html#a15">GetAlignment</a>(
00137     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00138 {
00139     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bHorz;
00140     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bVert;
00141 
00142     bHorz = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a667">BFHORZMASK</a>);
00143     bVert = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a671">BFVERTMASK</a>);
00144 
00145     <span class="keywordflow">if</span> (!bHorz || !bVert) {
00146         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/btnctl_8c.html#a14">IsPushButton</a>(pwnd)) {
00147             <span class="keywordflow">if</span> (!bHorz)
00148                 bHorz = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a666">BFCENTER</a>);
00149         } <span class="keywordflow">else</span> {
00150             <span class="keywordflow">if</span> (!bHorz)
00151                 bHorz = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a664">BFLEFT</a>);
00152         }
00153 
00154         <span class="keywordflow">if</span> (!bVert)
00155             bVert = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a670">BFVCENTER</a>);
00156     }
00157 
00158     <span class="keywordflow">return</span> bHorz | bVert;
00159 }
00160 
00161 
00162 <span class="comment">/***************************************************************************\</span>
00163 <span class="comment">*</span>
00164 <span class="comment">*  BNSetFont()</span>
00165 <span class="comment">*</span>
00166 <span class="comment">*  Changes button font, and decides if we can use real bold font for default</span>
00167 <span class="comment">*  push buttons or if we have to simulate it.</span>
00168 <span class="comment">*</span>
00169 <span class="comment">\***************************************************************************/</span>
00170 
<a name="l00171"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a16">00171</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a16">BNSetFont</a>(
00172     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00173     HFONT hfn,
00174     BOOL fRedraw)
00175 {
00176     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00177 
00178     pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o2">hFont</a> = hfn;
00179 
00180     <span class="keywordflow">if</span> (fRedraw &amp;&amp; <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd)) {
00181         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00182     }
00183 
00184 }
00185 
00186 
00187 <span class="comment">/***************************************************************************\</span>
00188 <span class="comment">* xxxBNInitDC</span>
00189 <span class="comment">*</span>
00190 <span class="comment">* History:</span>
00191 <span class="comment">\***************************************************************************/</span>
00192 
<a name="l00193"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a17">00193</a> HBRUSH <a class="code" href="../../d8/d1/btnctl_8c.html#a17">xxxBNInitDC</a>(
00194     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00195     HDC hdc)
00196 {
00197     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    wColor;
00198     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>    bStyle;
00199     HBRUSH  hbr;
00200     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00201 
00202     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00203 
00204     <span class="comment">/*</span>
00205 <span class="comment">     * Set BkMode before getting brush so that the app can change it to</span>
00206 <span class="comment">     * transparent if it wants.</span>
00207 <span class="comment">     */</span>
00208     SetBkMode(hdc, OPAQUE);
00209 
00210     bStyle = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>);
00211 
00212     <span class="keywordflow">switch</span> (bStyle) {
00213         <span class="keywordflow">default</span>:
00214             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a673">BFPUSHLIKE</a>)) {
00215                 wColor = WM_CTLCOLORSTATIC;
00216                 <span class="keywordflow">break</span>;
00217             }
00218 
00219         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_PUSHBUTTON):
00220         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_DEFPUSHBUTTON):
00221         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW):
00222         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON):
00223             wColor = WM_CTLCOLORBTN;
00224             <span class="keywordflow">break</span>;
00225     }
00226 
00227     hbr = <a class="code" href="../../d6/d0/usercli_8h.html#a235">GetControlBrush</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), hdc, wColor);
00228 
00229     <span class="comment">/*</span>
00230 <span class="comment">     * Select in the user's font if set, and save the old font so that we can</span>
00231 <span class="comment">     * restore it when we release the dc.</span>
00232 <span class="comment">     */</span>
00233     <span class="keywordflow">if</span> (pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o2">hFont</a>) {
00234         SelectObject(hdc, pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o2">hFont</a>);
00235     }
00236 
00237     <span class="comment">/*</span>
00238 <span class="comment">     * Clip output to the window rect if needed.</span>
00239 <span class="comment">     */</span>
00240     <span class="keywordflow">if</span> (bStyle != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX)) {
00241         IntersectClipRect(hdc, 0, 0,
00242             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00243             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
00244     }
00245 
00246     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>))
00247         SetTextAlign(hdc, TA_RTLREADING | GetTextAlign(hdc));
00248 
00249     <span class="keywordflow">return</span>(hbr);
00250 }
00251 
00252 <span class="comment">/***************************************************************************\</span>
00253 <span class="comment">* xxxBNGetDC</span>
00254 <span class="comment">*</span>
00255 <span class="comment">* History:</span>
00256 <span class="comment">\***************************************************************************/</span>
00257 
<a name="l00258"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a18">00258</a> HDC <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(
00259     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00260     HBRUSH *lphbr)
00261 {
00262     HDC hdc;
00263     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00264 
00265     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00266 
00267     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd)) {
00268         HBRUSH  hbr;
00269 
00270         hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
00271         hbr = <a class="code" href="../../d8/d1/btnctl_8c.html#a17">xxxBNInitDC</a>(pbutn, hdc);
00272 
00273         <span class="keywordflow">if</span> (lphbr!=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00274             *lphbr = hbr;
00275 
00276         <span class="keywordflow">return</span> hdc;
00277     }
00278 
00279     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00280 }
00281 
00282 <span class="comment">/***************************************************************************\</span>
00283 <span class="comment">* BNReleaseDC</span>
00284 <span class="comment">*</span>
00285 <span class="comment">* History:</span>
00286 <span class="comment">\***************************************************************************/</span>
00287 
<a name="l00288"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a19">00288</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(
00289     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00290     HDC hdc)
00291 {
00292     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00293 
00294     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>))
00295         SetTextAlign(hdc, GetTextAlign(hdc) &amp; ~TA_RTLREADING);
00296 
00297     <span class="keywordflow">if</span> (pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o2">hFont</a>) {
00298         SelectObject(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>);
00299     }
00300 
00301     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), hdc);
00302 }
00303 
00304 <span class="comment">/***************************************************************************\</span>
00305 <span class="comment">* xxxBNOwnerDraw</span>
00306 <span class="comment">*</span>
00307 <span class="comment">* History:</span>
00308 <span class="comment">\***************************************************************************/</span>
00309 
<a name="l00310"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a20">00310</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a20">xxxBNOwnerDraw</a>(
00311     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00312     HDC hdc,
00313     UINT itemAction)
00314 {
00315     DRAWITEMSTRUCT drawItemStruct;
00316     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
00317     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00318     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> itemState = 0;
00319 
00320     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a622">WEFPUIFOCUSHIDDEN</a>)) {
00321         itemState |= ODS_NOFOCUSRECT;
00322     }
00323     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>)) {
00324         itemState |= ODS_NOACCEL;
00325     }
00326     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_FOCUS) {
00327         itemState |= ODS_FOCUS;
00328     }
00329     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED) {
00330         itemState |= ODS_SELECTED;
00331     }
00332 
00333     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>))
00334         itemState |= ODS_DISABLED;
00335 
00336     drawItemStruct.CtlType = ODT_BUTTON;
00337     drawItemStruct.CtlID = PtrToUlong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
00338     drawItemStruct.itemAction = itemAction;
00339     drawItemStruct.itemState = itemState;
00340     drawItemStruct.hwndItem = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00341     drawItemStruct.hDC = hdc;
00342     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;drawItemStruct.rcItem);
00343     drawItemStruct.itemData = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00344 
00345     <span class="comment">/*</span>
00346 <span class="comment">     * Send a WM_DRAWITEM message to the parent</span>
00347 <span class="comment">     * IanJa:  in this case pMenu is being used as the control ID</span>
00348 <span class="comment">     */</span>
00349     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent), &amp;tlpwndParent);
00350     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent)), WM_DRAWITEM, (WPARAM)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>,
00351             (LPARAM)&amp;drawItemStruct);
00352     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00353 }
00354 
00355 <span class="comment">/***************************************************************************\</span>
00356 <span class="comment">* CalcBtnRect</span>
00357 <span class="comment">*</span>
00358 <span class="comment">* History:</span>
00359 <span class="comment">\***************************************************************************/</span>
00360 
<a name="l00361"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a21">00361</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(
00362     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00363     HDC hdc,
00364     LPRECT lprc,
00365     <span class="keywordtype">int</span> code,
00366     UINT pbfFlags)
00367 {
00368     <span class="keywordtype">int</span> cch;
00369     SIZE extent;
00370     <span class="keywordtype">int</span> dy;
00371     LPWSTR lpName;
00372     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> align;
00373 
00374     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, lprc);
00375 
00376     align = <a class="code" href="../../d8/d1/btnctl_8c.html#a15">GetAlignment</a>(pwnd);
00377 
00378     <span class="keywordflow">switch</span> (code) {
00379     <span class="keywordflow">case</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a5">CBR_PUSHBUTTON</a>:
00380         <span class="comment">// Subtract out raised edge all around</span>
00381         <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(lprc, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE));
00382 
00383         <span class="keywordflow">if</span> (pbfFlags &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a51">PBF_DEFAULT</a>)
00384             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(lprc, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00385         <span class="keywordflow">break</span>;
00386 
00387     <span class="keywordflow">case</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a1">CBR_CHECKBOX</a>:
00388         <span class="keywordflow">switch</span> (align &amp; <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a671">BFVERTMASK</a>))
00389         {
00390         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a670">BFVCENTER</a>):
00391                 lprc-&gt;top = (lprc-&gt;top + lprc-&gt;bottom - <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>].cy) / 2;
00392                 <span class="keywordflow">break</span>;
00393 
00394             <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a668">BFTOP</a>):
00395             <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a669">BFBOTTOM</a>):
00396                 <a class="code" href="../../d8/d0/rtl_2text_8c.html#a0">PSMGetTextExtent</a>(hdc, (LPWSTR)<a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;extent);
00397                 dy = extent.cy + extent.cy/4;
00398 
00399                 <span class="comment">// Save vertical extent</span>
00400                 extent.cx = dy;
00401 
00402                 <span class="comment">// Get centered amount</span>
00403 
00404                 dy = (dy - <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>].cy) / 2;
00405                 <span class="keywordflow">if</span> ((align &amp; <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a671">BFVERTMASK</a>)) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a668">BFTOP</a>))
00406                     lprc-&gt;top += dy;
00407                 <span class="keywordflow">else</span>
00408                     lprc-&gt;top = lprc-&gt;bottom - extent.cx + dy;
00409                 <span class="keywordflow">break</span>;
00410         }
00411 
00412         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a660">BFRIGHTBUTTON</a>))
00413             lprc-&gt;left = lprc-&gt;right - <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>].cx;
00414         <span class="keywordflow">else</span>
00415             lprc-&gt;right = lprc-&gt;left + <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>].cx;
00416 
00417         <span class="keywordflow">break</span>;
00418 
00419     <span class="keywordflow">case</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a2">CBR_CHECKTEXT</a>:
00420         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a660">BFRIGHTBUTTON</a>)) {
00421             lprc-&gt;right -= <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>].cx;
00422 
00423             <span class="comment">// More spacing for 4.0 dudes</span>
00424             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00425                 <a class="code" href="../../d8/d0/rtl_2text_8c.html#a0">PSMGetTextExtent</a>(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;extent);
00426                 lprc-&gt;right -= extent.cx  / 2;
00427             }
00428         } <span class="keywordflow">else</span> {
00429             lprc-&gt;left += <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>].cx;
00430 
00431             <span class="comment">// More spacing for 4.0 dudes</span>
00432             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00433                 <a class="code" href="../../d8/d0/rtl_2text_8c.html#a0">PSMGetTextExtent</a>(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;extent);
00434                 lprc-&gt;left +=  extent.cx / 2;
00435             }
00436         }
00437         <span class="keywordflow">break</span>;
00438 
00439     <span class="keywordflow">case</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a3">CBR_GROUPTEXT</a>:
00440         <span class="keywordflow">if</span> (!pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>)
00441             <span class="keywordflow">goto</span> <a class="code" href="../../d3/d6/visrgn_8c.html#a3">EmptyRect</a>;
00442 
00443         lpName = <a class="code" href="../../d6/d0/usercli_8h.html#a26">REBASE</a>(pwnd, strName.Buffer);
00444         <span class="keywordflow">if</span> (!(cch = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> / <span class="keyword">sizeof</span>(WCHAR))) {
00445 <a class="code" href="../../d3/d6/visrgn_8c.html#a3">EmptyRect</a>:
00446             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(lprc);
00447             <span class="keywordflow">break</span>;
00448         }
00449 
00450         <a class="code" href="../../d8/d0/rtl_2text_8c.html#a0">PSMGetTextExtent</a>(hdc, lpName, cch, &amp;extent);
00451         extent.cx += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) * 2;
00452 
00453         <span class="keywordflow">switch</span> (align &amp; <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a667">BFHORZMASK</a>))
00454         {
00455         <span class="comment">// BFLEFT, nothing</span>
00456         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a664">BFLEFT</a>):
00457             lprc-&gt;left += (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER));
00458             lprc-&gt;right = lprc-&gt;left + (<span class="keywordtype">int</span>)(extent.cx);
00459             <span class="keywordflow">break</span>;
00460 
00461         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a665">BFRIGHT</a>):
00462             lprc-&gt;right -= (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER));
00463             lprc-&gt;left = lprc-&gt;right - (<span class="keywordtype">int</span>)(extent.cx);
00464             <span class="keywordflow">break</span>;
00465 
00466         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a666">BFCENTER</a>):
00467             lprc-&gt;left = (lprc-&gt;left + lprc-&gt;right - (<span class="keywordtype">int</span>)(extent.cx)) / 2;
00468             lprc-&gt;right = lprc-&gt;left + (<span class="keywordtype">int</span>)(extent.cx);
00469             <span class="keywordflow">break</span>;
00470         }
00471 
00472         <span class="comment">// Center aligned.</span>
00473         lprc-&gt;bottom = lprc-&gt;top + extent.cy + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00474         <span class="keywordflow">break</span>;
00475 
00476     <span class="keywordflow">case</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a4">CBR_GROUPFRAME</a>:
00477         <a class="code" href="../../d8/d0/rtl_2text_8c.html#a0">PSMGetTextExtent</a>(hdc, (LPWSTR)<a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;extent);
00478         lprc-&gt;top += extent.cy / 2;
00479         <span class="keywordflow">break</span>;
00480     }
00481 }
00482 
00483 <span class="comment">/***************************************************************************\</span>
00484 <span class="comment">*</span>
00485 <span class="comment">*  BtnGetMultiExtent()</span>
00486 <span class="comment">*</span>
00487 <span class="comment">*  Calculates button text extent, given alignment flags.</span>
00488 <span class="comment">*</span>
00489 <span class="comment">\***************************************************************************/</span>
00490 
<a name="l00491"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a22">00491</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a22">BNMultiExtent</a>(
00492     WORD wFlags,
00493     HDC hdc,
00494     LPRECT lprcMax,
00495     LPWSTR lpsz,
00496     <span class="keywordtype">int</span> cch,
00497     <a class="code" href="../../d9/d5/ndismain_8h.html#a264">PINT</a> pcx,
00498     PINT pcy)
00499 {
00500     RECT rcT;
00501 
00502     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> dtFlags = DT_CALCRECT | DT_WORDBREAK | DT_EDITCONTROL;
00503     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rcT, lprcMax);
00504 
00505     <span class="comment">// Note that since we're just calculating the maximum dimensions,</span>
00506     <span class="comment">// left-justification and top-justification are not important.</span>
00507     <span class="comment">// Also, remember to leave margins horz and vert that follow our rules</span>
00508     <span class="comment">// in DrawBtnText().</span>
00509 
00510     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcT, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00511 
00512     <span class="keywordflow">if</span> ((wFlags &amp; LOWORD(BS_HORZMASK)) == LOWORD(BS_CENTER))
00513         dtFlags |= DT_CENTER;
00514 
00515     <span class="keywordflow">if</span> ((wFlags &amp; LOWORD(BS_VERTMASK)) == LOWORD(BS_VCENTER))
00516         dtFlags |= DT_VCENTER;
00517 
00518     <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a51">DrawTextExW</a>(hdc, lpsz, cch, &amp;rcT, dtFlags, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00519 
00520     <span class="keywordflow">if</span> (pcx)
00521         *pcx = rcT.right-rcT.left;
00522     <span class="keywordflow">if</span> (pcy)
00523         *pcy = rcT.bottom-rcT.top;
00524 }
00525 
00526 <span class="comment">/***************************************************************************\</span>
00527 <span class="comment">*</span>
00528 <span class="comment">*  BtnMultiDraw()</span>
00529 <span class="comment">*</span>
00530 <span class="comment">*  Draws multiline button text</span>
00531 <span class="comment">*</span>
00532 <span class="comment">\***************************************************************************/</span>
00533 
<a name="l00534"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a23">00534</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d8/d1/btnctl_8c.html#a23">BNMultiDraw</a>(
00535     HDC hdc,
00536     LPBTNDATA lpbd,
00537     <span class="keywordtype">int</span> cch,
00538     <span class="keywordtype">int</span> cx,
00539     <span class="keywordtype">int</span> cy)
00540 {
00541     RECT rcT;
00542     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> dtFlags = DT_WORDBREAK | DT_EDITCONTROL;
00543     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn = lpbd-&gt;<a class="code" href="../../d1/d9/structtagBTNDATA.html#o1">pbutn</a>;
00544 
00545     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>)) {
00546         dtFlags |= DT_HIDEPREFIX;
00547     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o4">fPaintKbdCuesOnly</a>){
00548         dtFlags |= DT_PREFIXONLY;
00549     }
00550 
00551     rcT.left    = 0;
00552     rcT.top     = 0;
00553     rcT.right   = cx;
00554     rcT.bottom  = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00555 
00556     <span class="comment">// Horizontal alignment</span>
00557     UserAssert(DT_LEFT == 0);
00558     <span class="keywordflow">switch</span> (lpbd-&gt;<a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a> &amp; LOWORD(BS_HORZMASK)) {
00559         <span class="keywordflow">case</span> LOWORD(BS_CENTER):
00560             dtFlags |= DT_CENTER;
00561             <span class="keywordflow">break</span>;
00562 
00563         <span class="keywordflow">case</span> LOWORD(BS_RIGHT):
00564             dtFlags |= DT_RIGHT;
00565             <span class="keywordflow">break</span>;
00566     }
00567 
00568     <span class="comment">// Vertical alignment</span>
00569     UserAssert(DT_TOP == 0);
00570     <span class="keywordflow">switch</span> (lpbd-&gt;<a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a> &amp; LOWORD(BS_VERTMASK)) {
00571         <span class="keywordflow">case</span> LOWORD(BS_VCENTER):
00572             dtFlags |= DT_VCENTER;
00573             <span class="keywordflow">break</span>;
00574 
00575         <span class="keywordflow">case</span> LOWORD(BS_BOTTOM):
00576             dtFlags |= DT_BOTTOM;
00577             <span class="keywordflow">break</span>;
00578     }
00579 
00580     <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a51">DrawTextExW</a>(hdc, lpbd-&gt;<a class="code" href="../../d1/d9/structtagBTNDATA.html#o0">lpsz</a>, cch, &amp;rcT, dtFlags, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00581     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00582 }
00583 
00584 <span class="comment">/***************************************************************************\</span>
00585 <span class="comment">* xxxBNSetCapture</span>
00586 <span class="comment">*</span>
00587 <span class="comment">* History:</span>
00588 <span class="comment">\***************************************************************************/</span>
00589 
<a name="l00590"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a24">00590</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d8/d1/btnctl_8c.html#a24">xxxBNSetCapture</a>(
00591     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00592     UINT codeMouse)
00593 {
00594     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00595 
00596     <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= codeMouse;
00597 
00598     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00599 
00600     <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a>)) {
00601         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a221">NtUserSetCapture</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
00602         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= <a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a>;
00603 
00604         <span class="comment">/*</span>
00605 <span class="comment">         * To prevent redundant CLICK messages, we set the INCLICK bit so</span>
00606 <span class="comment">         * the WM_SETFOCUS code will not do a xxxButtonNotifyParent(BN_CLICKED).</span>
00607 <span class="comment">         */</span>
00608 
00609         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= <a class="code" href="../../d6/d0/usercli_8h.html#a45">BST_INCLICK</a>;
00610 
00611         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a225">NtUserSetFocus</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
00612 
00613         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~<a class="code" href="../../d6/d0/usercli_8h.html#a45">BST_INCLICK</a>;
00614     }
00615     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a>);
00616 }
00617 
00618 
00619 <span class="comment">/***************************************************************************\</span>
00620 <span class="comment">* xxxButtonNotifyParent</span>
00621 <span class="comment">*</span>
00622 <span class="comment">* History:</span>
00623 <span class="comment">\***************************************************************************/</span>
00624 
<a name="l00625"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a25">00625</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(
00626     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00627     UINT code)
00628 {
00629     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
00630     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;            <span class="comment">// Parent if it exists</span>
00631 
00632     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00633 
00634     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>)
00635         pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00636     <span class="keywordflow">else</span>
00637         pwndParent = pwnd;
00638 
00639     <span class="comment">/*</span>
00640 <span class="comment">     * Note: A button's pwnd-&gt;spmenu is used to store the control ID</span>
00641 <span class="comment">     */</span>
00642     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndParent, &amp;tlpwndParent);
00643     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), WM_COMMAND,
00644             MAKELONG(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;spmenu), code), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
00645     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00646 }
00647 
00648 <span class="comment">/***************************************************************************\</span>
00649 <span class="comment">* xxxBNReleaseCapture</span>
00650 <span class="comment">*</span>
00651 <span class="comment">* History:</span>
00652 <span class="comment">\***************************************************************************/</span>
00653 
<a name="l00654"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a26">00654</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a26">xxxBNReleaseCapture</a>(
00655     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00656     BOOL fCheck)
00657 {
00658     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00659     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> check;
00660     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fNotifyParent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00661     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndT;
00662     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00663 
00664     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00665 
00666     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED) {
00667         <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETSTATE, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00668         <span class="keywordflow">if</span> (fCheck) {
00669             <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>)) {
00670             <span class="keywordflow">case</span> BS_AUTOCHECKBOX:
00671             <span class="keywordflow">case</span> BS_AUTO3STATE:
00672                 check = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>) + 1);
00673 
00674                 <span class="keywordflow">if</span> (check &gt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>) == BS_AUTO3STATE? BST_INDETERMINATE : BST_CHECKED)) {
00675                     check = BST_UNCHECKED;
00676                 }
00677                 <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETCHECK, check, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00678                 <span class="keywordflow">break</span>;
00679 
00680             <span class="keywordflow">case</span> BS_AUTORADIOBUTTON:
00681                 pwndT = pwnd;
00682                 <span class="keywordflow">do</span> {
00683                     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndT, &amp;tlpwndT);
00684 
00685                     <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndT), WM_GETDLGCODE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>) &amp;
00686                             DLGC_RADIOBUTTON) {
00687                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndT), BM_SETCHECK, (pwnd == pwndT), 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00688                     }
00689                     pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a641">_GetNextDlgGroupItem</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndT, spwndParent),
00690                             pwndT, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00691                     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00692 
00693                 } <span class="keywordflow">while</span> (pwndT != pwnd);
00694             }
00695 
00696             fNotifyParent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00697         }
00698     }
00699 
00700     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a>) {
00701         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~(<a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a> | <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>);
00702         <a class="code" href="../../d6/d0/usercli_8h.html#a225">NtUserReleaseCapture</a>();
00703     }
00704 
00705     <span class="keywordflow">if</span> (fNotifyParent) {
00706 
00707         <span class="comment">/*</span>
00708 <span class="comment">         * We have to do the notification after setting the buttonstate bits.</span>
00709 <span class="comment">         */</span>
00710         <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_CLICKED);
00711     }
00712 }
00713 
00714 <span class="comment">/***************************************************************************\</span>
00715 <span class="comment">*</span>
00716 <span class="comment">*  DrawBtnText()</span>
00717 <span class="comment">*</span>
00718 <span class="comment">*  Draws text of button.</span>
00719 <span class="comment">*</span>
00720 <span class="comment">\***************************************************************************/</span>
00721 
<a name="l00722"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a27">00722</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(
00723     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00724     HDC hdc,
00725     BOOL dbt,
00726     BOOL fDepress)
00727 {
00728     RECT    rc;
00729     HBRUSH  hbr;
00730     <span class="keywordtype">int</span>     x;
00731     <span class="keywordtype">int</span>     y;
00732     <span class="keywordtype">int</span>     cx;
00733     <span class="keywordtype">int</span>     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00734     LPWSTR   lpName;
00735     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>    bStyle;
00736     <span class="keywordtype">int</span>     cch;
00737     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    dsFlags;
00738     <a class="code" href="../../d1/d9/structtagBTNDATA.html">BTNDATA</a> bdt;
00739     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    pbfPush;
00740     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
00741 
00742     bStyle = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>);
00743 
00744     <span class="keywordflow">if</span> (bStyle &gt; <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d1/btnctl_8c.html#a8">mpStyleCbr</a>)) {
00745         RIPERR0(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"Invalid button style"</span>);
00746     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((bStyle == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX)) &amp;&amp; (dbt == <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a>))
00747         <span class="keywordflow">return</span>;
00748 
00749     pbfPush = <a class="code" href="../../d8/d1/btnctl_8c.html#a14">IsPushButton</a>(pwnd);
00750     <span class="keywordflow">if</span> (pbfPush) {
00751         <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(pwnd, hdc, &amp;rc, <a class="code" href="../../d8/d1/btnctl_8c.html#a5">CBR_PUSHBUTTON</a>, pbfPush);
00752         IntersectClipRect(hdc, rc.left, rc.top, rc.right, rc.bottom);
00753 
00754         <span class="comment">//</span>
00755         <span class="comment">// This is because we were too stupid to have WM_CTLCOLOR,</span>
00756         <span class="comment">// CTLCOLOR_BTN actually set up the damned button colors.  For</span>
00757         <span class="comment">// old apps, CTLCOLOR_BTN needs to work like CTLCOLOR_STATIC.</span>
00758         <span class="comment">//</span>
00759         SetBkColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DFACE));
00760         SetTextColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(BTNTEXT));
00761         hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(BTNTEXT);
00762     } <span class="keywordflow">else</span> {
00763         <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(pwnd, hdc, &amp;rc, <a class="code" href="../../d8/d1/btnctl_8c.html#a8">mpStyleCbr</a>[bStyle], pbfPush);
00764 
00765         <span class="comment">// Skip stuff for ownerdraw buttons, since we aren't going to</span>
00766         <span class="comment">// draw text/image.</span>
00767         <span class="keywordflow">if</span> (bStyle == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW))
00768             <span class="keywordflow">goto</span> DrawFocus;
00769         <span class="keywordflow">else</span>
00770             hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(WINDOWTEXT);
00771     }
00772 
00773     <span class="comment">// Alignment</span>
00774     bdt.<a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a> = <a class="code" href="../../d8/d1/btnctl_8c.html#a15">GetAlignment</a>(pwnd);
00775     bdt.<a class="code" href="../../d1/d9/structtagBTNDATA.html#o1">pbutn</a> = pbutn;
00776 
00777     <span class="comment">// Bail if we have nothing to draw</span>
00778     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a662">BFBITMAP</a>)) {
00779         BITMAP bmp;
00780 
00781         <span class="comment">// Bitmap button</span>
00782         <span class="keywordflow">if</span> (!pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a>)
00783             <span class="keywordflow">return</span>;
00784 
00785         GetObject(pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a>, <span class="keyword">sizeof</span>(BITMAP), &amp;bmp);
00786         cx = bmp.bmWidth;
00787         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = bmp.bmHeight;
00788 
00789         dsFlags = DST_BITMAP;
00790         <span class="keywordflow">goto</span> UseImageForName;
00791     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a661">BFICON</a>)) {
00792         <span class="comment">// Icon button</span>
00793         <span class="keywordflow">if</span> (!pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a>)
00794             <span class="keywordflow">return</span>;
00795 
00796         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a106">NtUserGetIconSize</a>(pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a>, 0, &amp;cx, &amp;<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00797         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> /= 2;    <span class="comment">// The bitmap height is half because a Mask is present in NT</span>
00798 
00799         dsFlags = DST_ICON;
00800 UseImageForName:
00801         lpName = (LPWSTR)pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a>;
00802         cch = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00803     } <span class="keywordflow">else</span> {
00804         <span class="comment">// Text button</span>
00805         <span class="keywordflow">if</span> (!pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>)
00806             <span class="keywordflow">return</span>;
00807 
00808         lpName = <a class="code" href="../../d6/d0/usercli_8h.html#a26">REBASE</a>(pwnd, strName.Buffer);
00809         cch    = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> / <span class="keyword">sizeof</span>(WCHAR);
00810 
00811         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a674">BFMULTILINE</a>)) {
00812 
00813             bdt.<a class="code" href="../../d1/d9/structtagBTNDATA.html#o0">lpsz</a> = lpName;
00814 
00815             <a class="code" href="../../d8/d1/btnctl_8c.html#a22">BNMultiExtent</a>(bdt.<a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a>, hdc, &amp;rc, lpName, cch, &amp;cx, &amp;<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00816 
00817             lpName = (LPWSTR)(<a class="code" href="../../d8/d1/btnctl_8c.html#a11">LPBTNDATA</a>)&amp;bdt;
00818             dsFlags = DST_COMPLEX;
00819 
00820         } <span class="keywordflow">else</span> {
00821             SIZE size;
00822 
00823             <a class="code" href="../../d8/d0/rtl_2text_8c.html#a0">PSMGetTextExtent</a>(hdc, lpName, cch, &amp;size);
00824             cx = size.cx;
00825             <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = size.cy;
00826             <span class="comment">/*</span>
00827 <span class="comment">             * If the control doesn't need underlines, set DST_HIDEPREFIX and</span>
00828 <span class="comment">             * also do not show the focus indicator</span>
00829 <span class="comment">             */</span>
00830             dsFlags = DST_PREFIXTEXT;
00831             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>)) {
00832                 dsFlags |= DSS_HIDEPREFIX;
00833             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o4">fPaintKbdCuesOnly</a>) {
00834                 dsFlags |= DSS_PREFIXONLY;
00835             }
00836         }
00837 
00838 
00839         <span class="comment">//</span>
00840         <span class="comment">// Add on a pixel or two of vertical space to make centering</span>
00841         <span class="comment">// happier.  That way underline won't abut focus rect unless</span>
00842         <span class="comment">// spacing is really tight.</span>
00843         <span class="comment">//</span>
00844         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>++;
00845     }
00846 
00847     <span class="comment">//</span>
00848     <span class="comment">// ALIGNMENT</span>
00849     <span class="comment">//</span>
00850 
00851     <span class="comment">// Horizontal</span>
00852     <span class="keywordflow">switch</span> (bdt.<a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a> &amp; <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a667">BFHORZMASK</a>)) {
00853         <span class="comment">//</span>
00854         <span class="comment">// For left &amp; right justified, we leave a margin of CXEDGE on either</span>
00855         <span class="comment">// side for eye-pleasing space.</span>
00856         <span class="comment">//</span>
00857         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a664">BFLEFT</a>):
00858             x = rc.left + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00859             <span class="keywordflow">break</span>;
00860 
00861         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a665">BFRIGHT</a>):
00862             x = rc.right - cx - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00863             <span class="keywordflow">break</span>;
00864 
00865         <span class="keywordflow">default</span>:
00866             x = (rc.left + rc.right - cx) / 2;
00867             <span class="keywordflow">break</span>;
00868     }
00869 
00870     <span class="comment">// Vertical</span>
00871     <span class="keywordflow">switch</span> (bdt.<a class="code" href="../../d1/d9/structtagBTNDATA.html#o2">wFlags</a> &amp; <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a671">BFVERTMASK</a>)) {
00872         <span class="comment">//</span>
00873         <span class="comment">// For top &amp; bottom justified, we leave a margin of CYBORDER on</span>
00874         <span class="comment">// either side for more eye-pleasing space.</span>
00875         <span class="comment">//</span>
00876         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a668">BFTOP</a>):
00877             y = rc.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00878             <span class="keywordflow">break</span>;
00879 
00880         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a669">BFBOTTOM</a>):
00881             y = rc.bottom - <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00882             <span class="keywordflow">break</span>;
00883 
00884         <span class="keywordflow">default</span>:
00885             y = (rc.top + rc.bottom - <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>) / 2;
00886             <span class="keywordflow">break</span>;
00887     }
00888 
00889     <span class="comment">//</span>
00890     <span class="comment">// Draw the text</span>
00891     <span class="comment">//</span>
00892     <span class="keywordflow">if</span> (dbt &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a52">DBT_TEXT</a>) {
00893         <span class="comment">//</span>
00894         <span class="comment">// This isn't called for USER buttons.</span>
00895         <span class="comment">//</span>
00896         UserAssert(bStyle != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON));
00897 
00898         <span class="keywordflow">if</span> (fDepress) {
00899             x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00900             y += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00901         }
00902 
00903         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00904             UserAssert(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a661">BFICON</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a662">BFBITMAP</a>));
00905             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SLOWMACHINE)  &amp;&amp;
00906                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a661">BFICON</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a662">BFBITMAP</a>) &amp;&amp;
00907                 (GetBkColor(hdc) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(GRAYTEXT)))
00908             {
00909                 <span class="comment">// Perf &amp;&amp; consistency with menus, statics</span>
00910                 SetTextColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(GRAYTEXT));
00911             }
00912             <span class="keywordflow">else</span>
00913                 dsFlags |= DSS_DISABLED;
00914         }
00915 
00916         <span class="comment">//</span>
00917         <span class="comment">// Use transparent mode for checked push buttons since we're going to</span>
00918         <span class="comment">// fill background with dither.</span>
00919         <span class="comment">//</span>
00920         <span class="keywordflow">if</span> (pbfPush) {
00921             <span class="keywordflow">switch</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>) {
00922                 <span class="keywordflow">case</span> BST_INDETERMINATE:
00923                     hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(GRAYTEXT);
00924                     dsFlags |= DSS_MONO;
00925                     <span class="comment">// FALL THRU</span>
00926 
00927                 <span class="keywordflow">case</span> BST_CHECKED:
00928                     <span class="comment">// Drawing on dithered background...</span>
00929                     SetBkMode(hdc, TRANSPARENT);
00930                     <span class="keywordflow">break</span>;
00931             }
00932         }
00933 
00934         <span class="comment">//</span>
00935         <span class="comment">// Use brush and colors currently selected into hdc when we grabbed</span>
00936         <span class="comment">// color</span>
00937         <span class="comment">//</span>
00938         DrawState(hdc, hbr, (DRAWSTATEPROC)<a class="code" href="../../d8/d1/btnctl_8c.html#a23">BNMultiDraw</a>, (LPARAM)lpName,
00939             (WPARAM)cch, x, y, cx, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>,
00940             dsFlags);
00941     }
00942 
00943     <span class="comment">// Draw focus rect.</span>
00944     <span class="comment">//</span>
00945     <span class="comment">// This can get called for OWNERDRAW and USERDRAW buttons. However, only</span>
00946     <span class="comment">// OWNERDRAW buttons let the owner change the drawing of the focus button.</span>
00947 DrawFocus:
00948     <span class="keywordflow">if</span> (dbt &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a>) {
00949         <span class="keywordflow">if</span> (bStyle == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW)) {
00950             <span class="comment">// For ownerdraw buttons, this is only called in response to a</span>
00951             <span class="comment">// WM_SETFOCUS or WM_KILL FOCUS message.  So, we can check the</span>
00952             <span class="comment">// new state of the focus by looking at the BUTTONSTATE bits</span>
00953             <span class="comment">// which are set before this procedure is called.</span>
00954             <a class="code" href="../../d8/d1/btnctl_8c.html#a20">xxxBNOwnerDraw</a>(pbutn, hdc, ODA_FOCUS);
00955         } <span class="keywordflow">else</span> {
00956             <span class="comment">// Don't draw the focus if underlines are not turned on</span>
00957             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a622">WEFPUIFOCUSHIDDEN</a>)) {
00958 
00959                 <span class="comment">// Let focus rect always hug edge of push buttons.  We already</span>
00960                 <span class="comment">// have the client area setup for push buttons, so we don't have</span>
00961                 <span class="comment">// to do anything.</span>
00962                 <span class="keywordflow">if</span> (!pbfPush) {
00963 
00964                     RECT rcClient;
00965 
00966                     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rcClient);
00967                     <span class="keywordflow">if</span> (bStyle == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON))
00968                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rc, &amp;rcClient);
00969                     <span class="keywordflow">else</span> {
00970                         <span class="comment">// Try to leave a border all around text.  That causes</span>
00971                         <span class="comment">// focus to hug text.</span>
00972                         rc.top = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(rcClient.top, y-<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00973                         rc.bottom = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(rcClient.bottom, rc.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE) + <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00974 
00975                         rc.left = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(rcClient.left, x-<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER));
00976                         rc.right = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(rcClient.right, rc.left + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) + cx);
00977                     }
00978                 } <span class="keywordflow">else</span>
00979                     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rc, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00980 
00981                 <span class="comment">// Are back &amp; fore colors set properly?</span>
00982                 <a class="code" href="../../d3/d9/clrect_8c.html#a0">DrawFocusRect</a>(hdc, &amp;rc);
00983             }
00984         }
00985     }
00986 }
00987 
00988 
00989 <span class="comment">/***************************************************************************\</span>
00990 <span class="comment">*</span>
00991 <span class="comment">*  DrawCheck()</span>
00992 <span class="comment">*</span>
00993 <span class="comment">\***************************************************************************/</span>
00994 
<a name="l00995"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a28">00995</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a28">xxxButtonDrawCheck</a>(
00996     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
00997     HDC hdc,
00998     HBRUSH hbr)
00999 {
01000     RECT rc;
01001     <span class="keywordtype">int</span> bm;
01002     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> flags;
01003     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoubleBlt = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01004     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
01005     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
01006     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
01007 
01008     <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(pwnd, hdc, &amp;rc, <a class="code" href="../../d8/d1/btnctl_8c.html#a1">CBR_CHECKBOX</a>, 0);
01009 
01010     flags = 0;
01011     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>)
01012         flags |= DFCS_CHECKED;
01013     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED)
01014         flags |= DFCS_PUSHED;
01015     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>))
01016         flags |= DFCS_INACTIVE;
01017 
01018     bm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a339">OBI_CHECK</a>;
01019     <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>)) {
01020         <span class="keywordflow">case</span> BS_AUTORADIOBUTTON:
01021         <span class="keywordflow">case</span> BS_RADIOBUTTON:
01022             fDoubleBlt = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01023             bm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a344">OBI_RADIO</a>;
01024             flags |= DFCS_BUTTONRADIO;
01025             <span class="keywordflow">break</span>;
01026 
01027         <span class="keywordflow">case</span> BS_3STATE:
01028         <span class="keywordflow">case</span> BS_AUTO3STATE:
01029             <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>) == BST_INDETERMINATE) {
01030                 bm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a349">OBI_3STATE</a>;
01031                 flags |= DFCS_BUTTON3STATE;
01032                 <span class="keywordflow">break</span>;
01033             }
01034             <span class="comment">// FALL THRU</span>
01035 
01036         <span class="keywordflow">default</span>:
01037             flags |= DFCS_BUTTONCHECK;
01038             <span class="keywordflow">break</span>;
01039     }
01040 
01041     rc.right = rc.left + <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[bm].cx;
01042     rc.bottom = rc.top + <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[bm].cy;
01043 
01044     <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwnd);
01045     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
01046     <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), hdc, hbr, &amp;rc);
01047     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01048 
01049     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a676">BFFLAT</a>) &amp;&amp; <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount != 1) {
01050         flags |= DFCS_MONO | DFCS_FLAT;
01051         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a14">DrawFrameControl</a>(hdc, &amp;rc, DFC_BUTTON, flags);
01052     } <span class="keywordflow">else</span> {
01053 
01054         <span class="keywordflow">switch</span> (flags &amp; (DFCS_CHECKED | DFCS_PUSHED | DFCS_INACTIVE))
01055         {
01056         <span class="keywordflow">case</span> 0:
01057             <span class="keywordflow">break</span>;
01058 
01059         <span class="keywordflow">case</span> DFCS_CHECKED:
01060             bm += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a260">DOBI_CHECK</a>;
01061             <span class="keywordflow">break</span>;
01062 
01063         <span class="comment">// These are mutually exclusive!</span>
01064         <span class="keywordflow">case</span> DFCS_PUSHED:
01065         <span class="keywordflow">case</span> DFCS_INACTIVE:
01066             bm += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a261">DOBI_DOWN</a>;        <span class="comment">// DOBI_DOWN == DOBI_INACTIVE</span>
01067             <span class="keywordflow">break</span>;
01068 
01069         <span class="keywordflow">case</span> DFCS_CHECKED | DFCS_PUSHED:
01070             bm += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a262">DOBI_CHECKDOWN</a>;
01071             <span class="keywordflow">break</span>;
01072 
01073         <span class="keywordflow">case</span> DFCS_CHECKED | DFCS_INACTIVE:
01074             bm += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a262">DOBI_CHECKDOWN</a> + 1;
01075             <span class="keywordflow">break</span>;
01076         }
01077 
01078         <span class="keywordflow">if</span> (fDoubleBlt) {
01079             <span class="comment">// This is a diamond-shaped radio button -- Blt with a mask so that</span>
01080             <span class="comment">// the exterior keeps the same color as the window's background</span>
01081             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> clrTextSave = SetTextColor(hdc, 0x00000000L);
01082             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> clrBkSave   = SetBkColor(hdc, 0x00FFFFFFL);
01083             <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a338">OBI_RADIOMASK</a>;
01084 
01085             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a330">NtUserBitBltSysBmp</a>(hdc, rc.left, rc.top, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
01086                     pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>, SRCAND);
01087 
01088             pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + bm;
01089             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a330">NtUserBitBltSysBmp</a>(hdc, rc.left, rc.top, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
01090                     pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>, SRCINVERT);
01091 
01092             SetTextColor(hdc, clrTextSave);
01093             SetBkColor(hdc, clrBkSave);
01094         } <span class="keywordflow">else</span> {
01095             <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + bm;
01096             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwROP = 0;
01097 <span class="preprocessor">#ifdef USE_MIRRORING</span>
01098 <span class="preprocessor"></span>            <span class="comment">// We do not want to mirror the check box.</span>
01099             <span class="keywordflow">if</span> (MIRRORED_HDC(hdc)) {
01100                 dwROP = NOMIRRORBITMAP;
01101             }
01102 <span class="preprocessor">#endif</span>
01103 <span class="preprocessor"></span>            <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a330">NtUserBitBltSysBmp</a>(hdc, rc.left, rc.top, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>, 
01104                     pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>, SRCCOPY | dwROP);
01105         }
01106     }
01107 }
01108 
01109 
01110 <span class="comment">/***************************************************************************\</span>
01111 <span class="comment">* xxxButtonDrawNewState</span>
01112 <span class="comment">*</span>
01113 <span class="comment">* History:</span>
01114 <span class="comment">\***************************************************************************/</span>
01115 
<a name="l01116"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a29">01116</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a29">xxxButtonDrawNewState</a>(
01117     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
01118     HDC hdc,
01119     HBRUSH hbr,
01120     UINT sOld)
01121 {
01122     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
01123 
01124     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01125 
01126     <span class="keywordflow">if</span> (sOld != (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED)) {
01127         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    pbfPush;
01128 
01129         pbfPush = <a class="code" href="../../d8/d1/btnctl_8c.html#a14">IsPushButton</a>(pwnd);
01130 
01131         <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>)) {
01132         <span class="keywordflow">case</span> BS_GROUPBOX:
01133         <span class="keywordflow">case</span> BS_OWNERDRAW:
01134             <span class="keywordflow">break</span>;
01135 
01136         <span class="keywordflow">default</span>:
01137             <span class="keywordflow">if</span> (!pbfPush) {
01138                 <a class="code" href="../../d8/d1/btnctl_8c.html#a28">xxxButtonDrawCheck</a>(pbutn, hdc, hbr);
01139                 <span class="keywordflow">break</span>;
01140             }
01141 
01142         <span class="keywordflow">case</span> BS_PUSHBUTTON:
01143         <span class="keywordflow">case</span> BS_DEFPUSHBUTTON:
01144         <span class="keywordflow">case</span> BS_PUSHBOX:
01145             <a class="code" href="../../d8/d1/btnctl_8c.html#a13">xxxDrawButton</a>(pbutn, hdc, pbfPush);
01146             <span class="keywordflow">break</span>;
01147         }
01148     }
01149 }
01150 
01151 <span class="comment">/***************************************************************************\</span>
01152 <span class="comment">*</span>
01153 <span class="comment">*  DrawButton()</span>
01154 <span class="comment">*</span>
01155 <span class="comment">*  Draws push-like button with text</span>
01156 <span class="comment">*</span>
01157 <span class="comment">\***************************************************************************/</span>
01158 
<a name="l01159"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a13">01159</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a13">xxxDrawButton</a>(
01160     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
01161     HDC hdc,
01162     UINT pbfPush)
01163 {
01164     RECT rc;
01165     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> flags = 0;
01166     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> state = 0;
01167     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
01168 
01169     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED)
01170         state |= DFCS_PUSHED;
01171 
01172     <span class="keywordflow">if</span> (!pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o4">fPaintKbdCuesOnly</a>) {
01173         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>)
01174             state |= DFCS_CHECKED;
01175 
01176         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>))
01177             flags = BF_SOFT;
01178 
01179         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a676">BFFLAT</a>))
01180             flags |= BF_FLAT | BF_MONO;
01181 
01182         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rc);
01183 
01184         <span class="keywordflow">if</span> (pbfPush &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a51">PBF_DEFAULT</a>) {
01185             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc, &amp;rc, 1, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a177">DF_WINDOWFRAME</a>);
01186             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rc, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01187 
01188             <span class="keywordflow">if</span> (state &amp; DFCS_PUSHED)
01189                 flags |= BF_FLAT;
01190         }
01191 
01192         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a16">DrawPushButton</a>(hdc, &amp;rc, state, flags);
01193     }
01194 
01195     <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a52">DBT_TEXT</a> | (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;
01196            BST_FOCUS ? <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a> : 0), (state &amp; DFCS_PUSHED));
01197 }
01198 
01199 
01200 <span class="comment">/***************************************************************************\</span>
01201 <span class="comment">* xxxBNPaint</span>
01202 <span class="comment">*</span>
01203 <span class="comment">* History:</span>
01204 <span class="comment">\***************************************************************************/</span>
01205 
<a name="l01206"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a30">01206</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a30">xxxBNPaint</a>(
01207     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn,
01208     HDC hdc)
01209 {
01210     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> bsWnd;
01211     RECT rc;
01212     HBRUSH  hbr;
01213     HBRUSH hbrBtnSave;
01214     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
01215     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> pbfPush;
01216     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>;
01217     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
01218 
01219     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01220 
01221     hbr = <a class="code" href="../../d8/d1/btnctl_8c.html#a17">xxxBNInitDC</a>(pbutn, hdc);
01222 
01223     bsWnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>);
01224     pbfPush = <a class="code" href="../../d8/d1/btnctl_8c.html#a14">IsPushButton</a>(pwnd);
01225     <span class="keywordflow">if</span> (!pbfPush &amp;&amp; !pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o4">fPaintKbdCuesOnly</a>) {
01226         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rc);
01227 
01228         <span class="keywordflow">if</span> ((bsWnd != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW)) &amp;&amp;
01229             (bsWnd != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX))) {
01230              <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01231              pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
01232              <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), hdc, hbr, &amp;rc);
01233              <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01234         }
01235 
01236         hbrBtnSave = SelectObject(hdc, hbr);
01237     }
01238 
01239     <span class="keywordflow">switch</span> (bsWnd) {
01240     <span class="keywordflow">case</span> BS_CHECKBOX:
01241     <span class="keywordflow">case</span> BS_RADIOBUTTON:
01242     <span class="keywordflow">case</span> BS_AUTORADIOBUTTON:
01243     <span class="keywordflow">case</span> BS_3STATE:
01244     <span class="keywordflow">case</span> BS_AUTOCHECKBOX:
01245     <span class="keywordflow">case</span> BS_AUTO3STATE:
01246         <span class="keywordflow">if</span> (!pbfPush) {
01247             <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc,
01248                 <a class="code" href="../../d6/d0/usercli_8h.html#a52">DBT_TEXT</a> | (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_FOCUS ? <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a> : 0), <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01249             <span class="keywordflow">if</span> (!pbutn-&gt;fPaintKbdCuesOnly) {
01250                 <a class="code" href="../../d8/d1/btnctl_8c.html#a28">xxxButtonDrawCheck</a>(pbutn, hdc, hbr);
01251             }
01252             <span class="keywordflow">break</span>;
01253         }
01254         <span class="comment">/*</span>
01255 <span class="comment">         * Fall through for PUSHLIKE buttons</span>
01256 <span class="comment">         */</span>
01257 
01258     <span class="keywordflow">case</span> BS_PUSHBUTTON:
01259     <span class="keywordflow">case</span> BS_DEFPUSHBUTTON:
01260         <a class="code" href="../../d8/d1/btnctl_8c.html#a13">xxxDrawButton</a>(pbutn, hdc, pbfPush);
01261         <span class="keywordflow">break</span>;
01262 
01263     <span class="keywordflow">case</span> BS_PUSHBOX:
01264         <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc,
01265             <a class="code" href="../../d6/d0/usercli_8h.html#a52">DBT_TEXT</a> | (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_FOCUS ? <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a> : 0), <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01266 
01267         <a class="code" href="../../d8/d1/btnctl_8c.html#a29">xxxButtonDrawNewState</a>(pbutn, hdc, hbr, 0);
01268         <span class="keywordflow">break</span>;
01269 
01270     <span class="keywordflow">case</span> BS_USERBUTTON:
01271         <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_PAINT);
01272 
01273         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED) {
01274             <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_PUSHED);
01275         }
01276         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
01277             <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_DISABLE);
01278         }
01279         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_FOCUS) {
01280             <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01281         }
01282         <span class="keywordflow">break</span>;
01283 
01284     <span class="keywordflow">case</span> BS_OWNERDRAW:
01285         <a class="code" href="../../d8/d1/btnctl_8c.html#a20">xxxBNOwnerDraw</a>(pbutn, hdc, ODA_DRAWENTIRE);
01286         <span class="keywordflow">break</span>;
01287 
01288     <span class="keywordflow">case</span> BS_GROUPBOX:
01289         <span class="keywordflow">if</span> (!pbutn-&gt;fPaintKbdCuesOnly) {
01290             <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(pwnd, hdc, &amp;rc, <a class="code" href="../../d8/d1/btnctl_8c.html#a4">CBR_GROUPFRAME</a>, 0);
01291             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rc, EDGE_ETCHED, BF_RECT |
01292                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a676">BFFLAT</a>) ? BF_FLAT | BF_MONO : 0));
01293 
01294             <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(pwnd, hdc, &amp;rc, <a class="code" href="../../d8/d1/btnctl_8c.html#a3">CBR_GROUPTEXT</a>, 0);
01295             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd-&gt;spwndParent, &amp;tlpwndParent);
01296             pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
01297             <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), hdc, hbr, &amp;rc);
01298             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01299         }
01300 
01301         <span class="comment">/*</span>
01302 <span class="comment">         * FillRect(hdc, &amp;rc, hbrBtn);</span>
01303 <span class="comment">         */</span>
01304         <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a52">DBT_TEXT</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01305         <span class="keywordflow">break</span>;
01306     }
01307 
01308     <span class="keywordflow">if</span> (!pbfPush)
01309         SelectObject(hdc, hbrBtnSave);
01310 
01311     <span class="comment">/*</span>
01312 <span class="comment">     * Release the font which may have been loaded by xxxButtonInitDC.</span>
01313 <span class="comment">     */</span>
01314     <span class="keywordflow">if</span> (pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o2">hFont</a>) {
01315         SelectObject(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>);
01316     }
01317 }
01318 <span class="comment">/***************************************************************************\</span>
01319 <span class="comment">* RepaintButton</span>
01320 <span class="comment">*</span>
01321 <span class="comment">\***************************************************************************/</span>
<a name="l01322"></a><a class="code" href="../../d8/d1/btnctl_8c.html#a31">01322</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1/btnctl_8c.html#a31">RepaintButton</a> (<a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn)
01323 {
01324     HDC hdc = <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(pbutn, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01325     <span class="keywordflow">if</span> (hdc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01326         <a class="code" href="../../d8/d1/btnctl_8c.html#a30">xxxBNPaint</a>(pbutn, hdc);
01327         <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(pbutn, hdc);
01328     }
01329 }
01330 <span class="comment">/***************************************************************************\</span>
01331 <span class="comment">* ButtonWndProc</span>
01332 <span class="comment">*</span>
01333 <span class="comment">* WndProc for buttons, check boxes, etc.</span>
01334 <span class="comment">*</span>
01335 <span class="comment">* History:</span>
01336 <span class="comment">\***************************************************************************/</span>
01337 
<a name="l01338"></a><a class="code" href="../../d6/d0/usercli_8h.html#a611">01338</a> LRESULT <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a> <a class="code" href="../../d6/d0/usercli_8h.html#a611">ButtonWndProcWorker</a>(
01339     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
01340     UINT message,
01341     WPARAM wParam,
01342     LPARAM lParam,
01343     DWORD fAnsi)
01344 {
01345     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
01346     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> bsWnd;
01347     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wOldState;
01348     RECT rc;
01349     POINT pt;
01350     HDC hdc;
01351     HBRUSH      hbr;
01352     PAINTSTRUCT ps;
01353     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
01354     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn;
01355     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
01356     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fInit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01357     LONG lResult;
01358 
01359     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01360 
01361     bsWnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a659">BFTYPEMASK</a>);
01362 
01363     <a class="code" href="../../d6/d0/usercli_8h.html#a28">VALIDATECLASSANDSIZE</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>);
01364     <a class="code" href="../../d6/d0/usercli_8h.html#a29">INITCONTROLLOOKASIDE</a>(&amp;<a class="code" href="../../d8/d1/btnctl_8c.html#a12">ButtonLookaside</a>, <a class="code" href="../../d2/d9/structtagBUTN.html">BUTN</a>, spwnd, 8);
01365 
01366     <span class="comment">/*</span>
01367 <span class="comment">     * Get the pbutn for the given window now since we will use it a lot in</span>
01368 <span class="comment">     * various handlers. This was stored using SetWindowLong(hwnd,0,pbutn) when</span>
01369 <span class="comment">     * we initially created the button control.</span>
01370 <span class="comment">     */</span>
01371     pbutn = ((<a class="code" href="../../d3/d9/structtagBUTNWND.html">PBUTNWND</a>)pwnd)-&gt;pbutn;
01372 
01373     <span class="keywordflow">switch</span> (message) {
01374     <span class="keywordflow">case</span> WM_NCHITTEST:
01375         <span class="keywordflow">if</span> (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX)) {
01376             <span class="keywordflow">return</span> (LONG)HTTRANSPARENT;
01377         } <span class="keywordflow">else</span> {
01378             <span class="keywordflow">goto</span> CallDWP;
01379         }
01380 
01381     <span class="keywordflow">case</span> WM_ERASEBKGND:
01382         <span class="keywordflow">if</span> (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW)) {
01383 
01384             <span class="comment">/*</span>
01385 <span class="comment">             * Handle erase background for owner draw buttons.</span>
01386 <span class="comment">             */</span>
01387             <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rc);
01388             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01389             pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
01390             <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), hwnd, (HDC)wParam, (HBRUSH)CTLCOLOR_BTN, &amp;rc);
01391             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01392         }
01393 
01394         <span class="comment">/*</span>
01395 <span class="comment">         * Do nothing for other buttons, but don't let DefWndProc() do it</span>
01396 <span class="comment">         * either.  It will be erased in xxxBNPaint().</span>
01397 <span class="comment">         */</span>
01398         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01399 
01400     <span class="keywordflow">case</span> WM_PRINTCLIENT:
01401         <a class="code" href="../../d8/d1/btnctl_8c.html#a30">xxxBNPaint</a>(pbutn, (HDC)wParam);
01402         <span class="keywordflow">break</span>;
01403 
01404     <span class="keywordflow">case</span> WM_PAINT:
01405 
01406         <span class="comment">/*</span>
01407 <span class="comment">         * If wParam != NULL, then this is a subclassed paint.</span>
01408 <span class="comment">         */</span>
01409         <span class="keywordflow">if</span> ((hdc = (HDC)wParam) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01410             hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a246">NtUserBeginPaint</a>(hwnd, &amp;ps);
01411 
01412         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd))
01413             <a class="code" href="../../d8/d1/btnctl_8c.html#a30">xxxBNPaint</a>(pbutn, hdc);
01414 
01415         <span class="keywordflow">if</span> (!wParam)
01416             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a248">NtUserEndPaint</a>(hwnd, &amp;ps);
01417         <span class="keywordflow">break</span>;
01418 
01419     <span class="keywordflow">case</span> WM_SETFOCUS:
01420         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= BST_FOCUS;
01421         <span class="keywordflow">if</span> ((hdc = <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(pbutn, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01422             <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01423 
01424             <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(pbutn, hdc);
01425         }
01426 
01427         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a675">BFNOTIFY</a>))
01428             <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_SETFOCUS);
01429 
01430         <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a45">BST_INCLICK</a>)) {
01431             <span class="keywordflow">switch</span> (bsWnd) {
01432             <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_RADIOBUTTON):
01433             <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTORADIOBUTTON):
01434                 <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a48">BST_DONTCLICK</a>)) {
01435                     <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>)) {
01436                         <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_CLICKED);
01437                     }
01438                 }
01439                 <span class="keywordflow">break</span>;
01440             }
01441         }
01442         <span class="keywordflow">break</span>;
01443 
01444     <span class="keywordflow">case</span> WM_GETDLGCODE:
01445         <span class="keywordflow">switch</span> (bsWnd) {
01446         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_DEFPUSHBUTTON):
01447             wParam = DLGC_DEFPUSHBUTTON;
01448             <span class="keywordflow">break</span>;
01449 
01450         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_PUSHBUTTON):
01451         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_PUSHBOX):
01452             wParam = DLGC_UNDEFPUSHBUTTON;
01453             <span class="keywordflow">break</span>;
01454 
01455         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTORADIOBUTTON):
01456         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_RADIOBUTTON):
01457             wParam = DLGC_RADIOBUTTON;
01458             <span class="keywordflow">break</span>;
01459 
01460         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX):
01461             <span class="keywordflow">return</span> (LONG)DLGC_STATIC;
01462 
01463         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_CHECKBOX):
01464         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTOCHECKBOX):
01465 
01466             <span class="comment">/*</span>
01467 <span class="comment">             * If this is a char that is a '=/+', or '-', we want it</span>
01468 <span class="comment">             */</span>
01469             <span class="keywordflow">if</span> (lParam &amp;&amp; ((LPMSG)lParam)-&gt;message == WM_CHAR) {
01470                 <span class="keywordflow">switch</span> (wParam) {
01471                 <span class="keywordflow">case</span> TEXT(<span class="charliteral">'='</span>):
01472                 <span class="keywordflow">case</span> TEXT(<span class="charliteral">'+'</span>):
01473                 <span class="keywordflow">case</span> TEXT(<span class="charliteral">'-'</span>):
01474                     wParam = DLGC_WANTCHARS;
01475                     <span class="keywordflow">break</span>;
01476 
01477                 <span class="keywordflow">default</span>:
01478                     wParam = 0;
01479                 }
01480             } <span class="keywordflow">else</span> {
01481                 wParam = 0;
01482             }
01483             <span class="keywordflow">break</span>;
01484 
01485         <span class="keywordflow">default</span>:
01486             wParam = 0;
01487         }
01488         <span class="keywordflow">return</span> (LONG)(wParam | DLGC_BUTTON);
01489 
01490     <span class="keywordflow">case</span> WM_CAPTURECHANGED:
01491         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a>) {
01492             <span class="comment">// Unwittingly, we've been kicked out of capture,</span>
01493             <span class="comment">// so undepress etc.</span>
01494             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>)
01495                 <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETSTATE, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01496             <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~(<a class="code" href="../../d6/d0/usercli_8h.html#a46">BST_CAPTURED</a> | <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>);
01497         }
01498         <span class="keywordflow">break</span>;
01499 
01500     <span class="keywordflow">case</span> WM_KILLFOCUS:
01501 
01502         <span class="comment">/*</span>
01503 <span class="comment">         * If we are losing the focus and we are in "capture mode", click</span>
01504 <span class="comment">         * the button.  This allows tab and space keys to overlap for</span>
01505 <span class="comment">         * fast toggle of a series of buttons.</span>
01506 <span class="comment">         */</span>
01507         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>) {
01508 
01509             <span class="comment">/*</span>
01510 <span class="comment">             * If for some reason we are killing the focus, and we have the</span>
01511 <span class="comment">             * mouse captured, don't notify the parent we got clicked.  This</span>
01512 <span class="comment">             * breaks Omnis Quartz otherwise.</span>
01513 <span class="comment">             */</span>
01514             <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETSTATE, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01515         }
01516 
01517         <a class="code" href="../../d8/d1/btnctl_8c.html#a26">xxxBNReleaseCapture</a>(pbutn, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01518 
01519         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~BST_FOCUS;
01520         <span class="keywordflow">if</span> ((hdc = <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(pbutn, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01521             <a class="code" href="../../d8/d1/btnctl_8c.html#a27">xxxBNDrawText</a>(pbutn, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a53">DBT_FOCUS</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01522 
01523             <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(pbutn, hdc);
01524         }
01525 
01526         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a675">BFNOTIFY</a>))
01527             <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_KILLFOCUS);
01528 
01529         <span class="comment">/*</span>
01530 <span class="comment">         * Since the bold border around the defpushbutton is done by</span>
01531 <span class="comment">         * someone else, we need to invalidate the rect so that the</span>
01532 <span class="comment">         * focus rect is repainted properly.</span>
01533 <span class="comment">         */</span>
01534         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01535         <span class="keywordflow">break</span>;
01536 
01537     <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
01538 
01539         <span class="comment">/*</span>
01540 <span class="comment">         * Double click messages are recognized for BS_RADIOBUTTON,</span>
01541 <span class="comment">         * BS_USERBUTTON, and BS_OWNERDRAW styles.  For all other buttons,</span>
01542 <span class="comment">         * double click is handled like a normal button down.</span>
01543 <span class="comment">         */</span>
01544         <span class="keywordflow">switch</span> (bsWnd) {
01545         <span class="keywordflow">default</span>:
01546             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a675">BFNOTIFY</a>))
01547                 <span class="keywordflow">goto</span> btnclick;
01548 
01549         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON):
01550         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_RADIOBUTTON):
01551         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW):
01552             <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_DOUBLECLICKED);
01553             <span class="keywordflow">break</span>;
01554         }
01555         <span class="keywordflow">break</span>;
01556 
01557     <span class="keywordflow">case</span> WM_LBUTTONUP:
01558         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>) {
01559             <a class="code" href="../../d8/d1/btnctl_8c.html#a26">xxxBNReleaseCapture</a>(pbutn, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01560         }
01561         <span class="keywordflow">break</span>;
01562 
01563     <span class="keywordflow">case</span> WM_MOUSEMOVE:
01564         <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>)) {
01565             <span class="keywordflow">break</span>;
01566         }
01567 
01568         <span class="comment">/*</span>
01569 <span class="comment">         *** FALL THRU **</span>
01570 <span class="comment">         */</span>
01571     <span class="keywordflow">case</span> WM_LBUTTONDOWN:
01572 btnclick:
01573         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/btnctl_8c.html#a24">xxxBNSetCapture</a>(pbutn, <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>)) {
01574             <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rc);
01575             POINTSTOPOINT(pt, lParam);
01576             <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETSTATE, <a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rc, pt), 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01577         }
01578         <span class="keywordflow">break</span>;
01579 
01580     <span class="keywordflow">case</span> WM_CHAR:
01581         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>)
01582             <span class="keywordflow">goto</span> CallDWP;
01583 
01584         <span class="keywordflow">if</span> (bsWnd != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_CHECKBOX) &amp;&amp;
01585             bsWnd != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTOCHECKBOX))
01586             <span class="keywordflow">goto</span> CallDWP;
01587 
01588         <span class="keywordflow">switch</span> (wParam) {
01589         <span class="keywordflow">case</span> TEXT(<span class="charliteral">'+'</span>):
01590         <span class="keywordflow">case</span> TEXT(<span class="charliteral">'='</span>):
01591             wParam = 1;    <span class="comment">// we must Set the check mark on.</span>
01592             <span class="keywordflow">goto</span>   SetCheck;
01593 
01594         <span class="keywordflow">case</span> TEXT(<span class="charliteral">'-'</span>):
01595             wParam = 0;    <span class="comment">// Set the check mark off.</span>
01596 SetCheck:
01597             <span class="comment">// Must notify only if the check status changes</span>
01598             <span class="keywordflow">if</span> ((WORD)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>) != (WORD)wParam)
01599             {
01600                 <span class="comment">// We must check/uncheck only if it is AUTO</span>
01601                 <span class="keywordflow">if</span> (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTOCHECKBOX))
01602                 {
01603                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/btnctl_8c.html#a24">xxxBNSetCapture</a>(pbutn, 0))
01604                     {
01605                         <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETCHECK, wParam, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01606 
01607                         <a class="code" href="../../d8/d1/btnctl_8c.html#a26">xxxBNReleaseCapture</a>(pbutn, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01608                     }
01609                 }
01610 
01611                 <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, BN_CLICKED);
01612             }
01613             <span class="keywordflow">break</span>;
01614 
01615         <span class="keywordflow">default</span>:
01616             <span class="keywordflow">goto</span> CallDWP;
01617         }
01618         <span class="keywordflow">break</span>;
01619 
01620     <span class="keywordflow">case</span> BM_CLICK:
01621         <span class="comment">// Don't recurse into this code!</span>
01622         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a49">BST_INBMCLICK</a>)
01623             <span class="keywordflow">break</span>;
01624 
01625         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= <a class="code" href="../../d6/d0/usercli_8h.html#a49">BST_INBMCLICK</a>;
01626         <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, WM_LBUTTONDOWN, 0, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01627         <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, WM_LBUTTONUP, 0, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01628         <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~<a class="code" href="../../d6/d0/usercli_8h.html#a49">BST_INBMCLICK</a>;
01629 
01630         <span class="comment">/*</span>
01631 <span class="comment">         *** FALL THRU **</span>
01632 <span class="comment">         */</span>
01633 
01634     <span class="keywordflow">case</span> WM_KEYDOWN:
01635         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>)
01636             <span class="keywordflow">break</span>;
01637 
01638         <span class="keywordflow">if</span> (wParam == VK_SPACE) {
01639             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/btnctl_8c.html#a24">xxxBNSetCapture</a>(pbutn, 0)) {
01640                 <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, BM_SETSTATE, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01641             }
01642         } <span class="keywordflow">else</span> {
01643             <a class="code" href="../../d8/d1/btnctl_8c.html#a26">xxxBNReleaseCapture</a>(pbutn, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01644         }
01645         <span class="keywordflow">break</span>;
01646 
01647     <span class="keywordflow">case</span> WM_KEYUP:
01648     <span class="keywordflow">case</span> WM_SYSKEYUP:
01649         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a47">BST_MOUSE</a>) {
01650             <span class="keywordflow">goto</span> CallDWP;
01651         }
01652 
01653         <span class="comment">/*</span>
01654 <span class="comment">         * Don't cancel the capture mode on the up of the tab in case the</span>
01655 <span class="comment">         * guy is overlapping tab and space keys.</span>
01656 <span class="comment">         */</span>
01657         <span class="keywordflow">if</span> (wParam == VK_TAB) {
01658             <span class="keywordflow">goto</span> CallDWP;
01659         }
01660 
01661         <span class="comment">/*</span>
01662 <span class="comment">         * WARNING: pwnd is history after this call!</span>
01663 <span class="comment">         */</span>
01664         <a class="code" href="../../d8/d1/btnctl_8c.html#a26">xxxBNReleaseCapture</a>(pbutn, (wParam == VK_SPACE));
01665 
01666         <span class="keywordflow">if</span> (message == WM_SYSKEYUP) {
01667             <span class="keywordflow">goto</span> CallDWP;
01668         }
01669         <span class="keywordflow">break</span>;
01670 
01671     <span class="keywordflow">case</span> BM_GETSTATE:
01672         <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn);
01673 
01674     <span class="keywordflow">case</span> BM_SETSTATE:
01675         wOldState = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED);
01676         <span class="keywordflow">if</span> (wParam) {
01677             <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= BST_PUSHED;
01678         } <span class="keywordflow">else</span> {
01679             <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~BST_PUSHED;
01680         }
01681 
01682         <span class="keywordflow">if</span> ((hdc = <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(pbutn, &amp;hbr)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01683             <span class="keywordflow">if</span> (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON)) {
01684                 <a class="code" href="../../d8/d1/btnctl_8c.html#a25">xxxButtonNotifyParent</a>(pwnd, (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(wParam ? BN_PUSHED : BN_UNPUSHED));
01685             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_OWNERDRAW)) {
01686                 <span class="keywordflow">if</span> (wOldState != (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED)) {
01687                     <span class="comment">/*</span>
01688 <span class="comment">                     * Only notify for drawing if state has changed..</span>
01689 <span class="comment">                     */</span>
01690                     <a class="code" href="../../d8/d1/btnctl_8c.html#a20">xxxBNOwnerDraw</a>(pbutn, hdc, ODA_SELECT);
01691                 }
01692             } <span class="keywordflow">else</span> {
01693                 <a class="code" href="../../d8/d1/btnctl_8c.html#a29">xxxButtonDrawNewState</a>(pbutn, hdc, hbr, wOldState);
01694             }
01695 
01696             <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(pbutn, hdc);
01697         }
01698         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>() &amp;&amp; (wOldState != (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; BST_PUSHED))) {
01699             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_STATECHANGE, hwnd, OBJID_CLIENT, INDEXID_CONTAINER);
01700         }
01701         <span class="keywordflow">break</span>;
01702 
01703     <span class="keywordflow">case</span> BM_GETCHECK:
01704         <span class="keywordflow">return</span> (LONG)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>);
01705 
01706     <span class="keywordflow">case</span> BM_SETCHECK:
01707         <span class="keywordflow">switch</span> (bsWnd) {
01708         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_RADIOBUTTON):
01709         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTORADIOBUTTON):
01710             <span class="keywordflow">if</span> (wParam) {
01711                     <a class="code" href="../../d4/d1/userk_8h.html#a1628">SetWindowState</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a635">WFTABSTOP</a>);
01712             } <span class="keywordflow">else</span> {
01713                     <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a635">WFTABSTOP</a>);
01714             }
01715 
01716             <span class="comment">/*</span>
01717 <span class="comment">             *** FALL THRU **</span>
01718 <span class="comment">             */</span>
01719         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_CHECKBOX):
01720         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTOCHECKBOX):
01721             <span class="keywordflow">if</span> (wParam) {
01722                 wParam = 1;
01723             }
01724             <span class="keywordflow">goto</span> CheckIt;
01725 
01726         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_3STATE):
01727         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_AUTO3STATE):
01728             <span class="keywordflow">if</span> (wParam &gt; BST_INDETERMINATE) {
01729                 wParam = BST_INDETERMINATE;
01730             }
01731 CheckIt:
01732             <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(<a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>) != (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam) {
01733                 <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) &amp;= ~<a class="code" href="../../d6/d0/usercli_8h.html#a44">BST_CHECKMASK</a>;
01734                 <a class="code" href="../../d6/d0/usercli_8h.html#a43">BUTTONSTATE</a>(pbutn) |= (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam;
01735 
01736                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd))
01737                     <span class="keywordflow">break</span>;
01738 
01739                 <span class="keywordflow">if</span> ((hdc = <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(pbutn, &amp;hbr)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01740                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a673">BFPUSHLIKE</a>)) {
01741                         <a class="code" href="../../d8/d1/btnctl_8c.html#a13">xxxDrawButton</a>(pbutn, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a50">PBF_PUSHABLE</a>);
01742                     } <span class="keywordflow">else</span> {
01743                         <a class="code" href="../../d8/d1/btnctl_8c.html#a28">xxxButtonDrawCheck</a>(pbutn, hdc, hbr);
01744                     }
01745                     <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(pbutn, hdc);
01746                 }
01747 
01748                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>())
01749                     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_STATECHANGE, hwnd, OBJID_CLIENT, INDEXID_CONTAINER);
01750             }
01751             <span class="keywordflow">break</span>;
01752         }
01753         <span class="keywordflow">break</span>;
01754 
01755     <span class="keywordflow">case</span> BM_SETSTYLE:
01756         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a285">NtUserAlterWindowStyle</a>(hwnd, BS_TYPEMASK, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)wParam);
01757 
01758         <span class="keywordflow">if</span> (lParam) {
01759             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01760         }
01761         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01762             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_STATECHANGE, hwnd, OBJID_CLIENT, INDEXID_CONTAINER);
01763         }
01764         <span class="keywordflow">break</span>;
01765 
01766     <span class="keywordflow">case</span> WM_SETTEXT:
01767 
01768         <span class="comment">/*</span>
01769 <span class="comment">         * In case the new group name is longer than the old name,</span>
01770 <span class="comment">         * this paints over the old name before repainting the group</span>
01771 <span class="comment">         * box with the new name.</span>
01772 <span class="comment">         */</span>
01773         <span class="keywordflow">if</span> (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_GROUPBOX)) {
01774             hdc = <a class="code" href="../../d8/d1/btnctl_8c.html#a18">xxxBNGetDC</a>(pbutn, &amp;hbr);
01775             <span class="keywordflow">if</span> (hdc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01776                 <a class="code" href="../../d8/d1/btnctl_8c.html#a21">BNCalcRect</a>(pwnd, hdc, &amp;rc, <a class="code" href="../../d8/d1/btnctl_8c.html#a3">CBR_GROUPTEXT</a>, 0);
01777                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, &amp;rc, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01778 
01779                 pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
01780                 <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01781                 <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), hwnd, hdc, hbr, &amp;rc);
01782                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01783 
01784                 <a class="code" href="../../d8/d1/btnctl_8c.html#a19">BNReleaseDC</a>(pbutn, hdc);
01785             }
01786         }
01787 
01788         lResult = <a class="code" href="../../d6/d0/usercli_8h.html#a622">_DefSetText</a>(hwnd, (LPWSTR)lParam, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)fAnsi);
01789 
01790         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01791             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_NAMECHANGE, hwnd, OBJID_WINDOW, INDEXID_CONTAINER);
01792         }
01793         <span class="keywordflow">goto</span> DoEnable;
01794 
01795         <span class="comment">/*</span>
01796 <span class="comment">         *** FALL THRU **</span>
01797 <span class="comment">         */</span>
01798     <span class="keywordflow">case</span> WM_ENABLE:
01799         lResult = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01800 DoEnable:
01801         <a class="code" href="../../d8/d1/btnctl_8c.html#a31">RepaintButton</a>(pbutn);
01802         <span class="keywordflow">return</span> lResult;
01803 
01804     <span class="keywordflow">case</span> WM_SETFONT:
01805         <span class="comment">/*</span>
01806 <span class="comment">         * wParam - handle to the font</span>
01807 <span class="comment">         * lParam - if true, redraw else don't</span>
01808 <span class="comment">         */</span>
01809         <a class="code" href="../../d8/d1/btnctl_8c.html#a16">BNSetFont</a>(pbutn, (HFONT)wParam, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)(lParam != 0));
01810         <span class="keywordflow">break</span>;
01811 
01812     <span class="keywordflow">case</span> WM_GETFONT:
01813         <span class="keywordflow">return</span> (LRESULT)pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o2">hFont</a>;
01814 
01815     <span class="keywordflow">case</span> BM_GETIMAGE:
01816     <span class="keywordflow">case</span> BM_SETIMAGE:
01817         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d1/btnctl_8c.html#a7">IsValidImage</a>(wParam, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a663">BFIMAGEMASK</a>), <a class="code" href="../../d8/d1/btnctl_8c.html#a6">IMAGE_BMMAX</a>)) {
01818             RIPERR0(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"Invalid button image type"</span>);
01819         } <span class="keywordflow">else</span> {
01820             HANDLE  hOld = pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a>;
01821 
01822             <span class="keywordflow">if</span> (message == BM_SETIMAGE) {
01823                 pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o3">hImage</a> = (HANDLE)lParam;
01824                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>)) {
01825                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01826                 }
01827             }
01828             <span class="keywordflow">return</span> (LRESULT)hOld;
01829         }
01830         <span class="keywordflow">break</span>;
01831 
01832     <span class="keywordflow">case</span> WM_NCDESTROY:
01833     <span class="keywordflow">case</span> WM_FINALDESTROY:
01834         <span class="keywordflow">if</span> (pbutn) {
01835             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o0">spwnd</a>);
01836             <a class="code" href="../../d6/d0/usercli_8h.html#a408">FreeLookasideEntry</a>(&amp;<a class="code" href="../../d8/d1/btnctl_8c.html#a12">ButtonLookaside</a>, pbutn);
01837         }
01838         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a284">NtUserSetWindowFNID</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>);
01839         <span class="keywordflow">break</span>;
01840 
01841     <span class="keywordflow">case</span> WM_NCCREATE:
01842         <span class="comment">// Borland's OBEX has a button with style 0x98; We didn't strip</span>
01843         <span class="comment">// these bits in win3.1 because we checked for 0x08.</span>
01844         <span class="comment">// Stripping these bits cause a GP Fault in OBEX.</span>
01845         <span class="comment">// For win3.1 guys, I use the old code to strip the style bits.</span>
01846         <span class="comment">//</span>
01847         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a592">WFWIN31COMPAT</a>)) {
01848             <span class="keywordflow">if</span>(((!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) &amp;&amp;
01849                 (((<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pwnd-&gt;style)) &amp; (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(~BS_LEFTTEXT))) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON))) ||
01850                (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp;
01851                (bsWnd == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(BS_USERBUTTON))))
01852             {
01853                 <span class="comment">// BS_USERBUTTON is no longer allowed for 3.1 and beyond.</span>
01854                 <span class="comment">// Just turn to normal push button.</span>
01855                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a285">NtUserAlterWindowStyle</a>(hwnd, BS_TYPEMASK, 0);
01856                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"BS_USERBUTTON no longer supported"</span>);
01857             }
01858         }
01859         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a624">WEFRIGHT</a>)) {
01860             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a285">NtUserAlterWindowStyle</a>(hwnd, BS_RIGHT | BS_RIGHTBUTTON, BS_RIGHT | BS_RIGHTBUTTON);
01861         }
01862         <span class="keywordflow">goto</span> CallDWP;
01863 
01864     <span class="keywordflow">case</span> WM_INPUTLANGCHANGEREQUEST:
01865 
01866         <span class="comment">//</span>
01867         <span class="comment">// #115190</span>
01868         <span class="comment">// If the window is one of controls on top of dialogbox,</span>
01869         <span class="comment">// let the parent dialog handle it.</span>
01870         <span class="comment">//</span>
01871         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>) {
01872             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
01873             <span class="keywordflow">if</span> (pwndParent) {
01874                 <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pclsParent = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndParent, pcls);
01875 
01876                 UserAssert(pclsParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01877                 <span class="keywordflow">if</span> (pclsParent-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a76">ICLS_DIALOG</a>]) {
01878                     RIPMSG0(RIP_VERBOSE, <span class="stringliteral">"Button: WM_INPUTLANGCHANGEREQUEST is sent to parent.\n"</span>);
01879                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwndParent, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01880                 }
01881             }
01882         }
01883         <span class="keywordflow">goto</span> CallDWP;
01884 
01885     <span class="keywordflow">case</span> WM_UPDATEUISTATE:
01886         {
01887             <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, fAnsi);
01888             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a668">ISBSTEXTOROD</a>(pwnd)) {
01889                 pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o4">fPaintKbdCuesOnly</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01890                 <a class="code" href="../../d8/d1/btnctl_8c.html#a31">RepaintButton</a>(pbutn);
01891                 pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o4">fPaintKbdCuesOnly</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01892             }
01893         }
01894         <span class="keywordflow">break</span>;
01895 
01896     <span class="keywordflow">default</span>:
01897 CallDWP:
01898         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, fAnsi);
01899     }
01900 
01901     <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01902 }
01903 
01904 <span class="comment">/***************************************************************************\</span>
01905 <span class="comment">\***************************************************************************/</span>
01906 
<a name="l01907"></a><a class="code" href="../../d6/d0/usercli_8h.html#a574">01907</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a574">ButtonWndProcA</a>(
01908     HWND hwnd,
01909     UINT message,
01910     WPARAM wParam,
01911     LPARAM lParam)
01912 {
01913     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
01914 
01915     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01916         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01917     }
01918 
01919     <span class="comment">/*</span>
01920 <span class="comment">     * If the control is not interested in this message,</span>
01921 <span class="comment">     * pass it to DefWindowProc.</span>
01922 <span class="comment">     */</span>
01923     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>))
01924         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01925 
01926     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a611">ButtonWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01927 }
01928 
<a name="l01929"></a><a class="code" href="../../d6/d0/usercli_8h.html#a575">01929</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a575">ButtonWndProcW</a>(
01930     HWND hwnd,
01931     UINT message,
01932     WPARAM wParam,
01933     LPARAM lParam)
01934 {
01935     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
01936 
01937     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01938         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01939     }
01940 
01941     <span class="comment">/*</span>
01942 <span class="comment">     * If the control is not interested in this message,</span>
01943 <span class="comment">     * pass it to DefWindowProc.</span>
01944 <span class="comment">     */</span>
01945     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>))
01946         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01947 
01948     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a611">ButtonWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01949 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:18 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
