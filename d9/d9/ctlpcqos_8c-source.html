<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ctlpcqos.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ctlpcqos.c</h1><a href="../../d8/d0/ctlpcqos_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00003 <span class="comment">//                                                                          //</span>
00004 <span class="comment">//                Global Definitions                                        //</span>
00005 <span class="comment">//                                                                          //</span>
00007 <span class="comment"></span>
00008 
00009 
00010 
00012 <span class="comment">//                                                                          //</span>
00013 <span class="comment">//                Global Variables                                          //</span>
00014 <span class="comment">//                                                                          //</span>
00016 <span class="comment"></span>
<a name="l00017"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a0">00017</a>     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
<a name="l00018"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a1">00018</a>     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
<a name="l00019"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a2">00019</a>     STRING <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a5">EventName</a>;
<a name="l00020"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a3">00020</a>     UNICODE_STRING <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a6">UnicodeEventName</a>;
<a name="l00021"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a4">00021</a>     HANDLE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a7">EventHandle</a>;
<a name="l00022"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a5">00022</a>     UNICODE_STRING <a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>;
<a name="l00023"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a6">00023</a>     HANDLE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a12">EarPort</a>;
<a name="l00024"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a7">00024</a>     HANDLE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a13">TalkPort</a>;
<a name="l00025"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">00025</a>     PORT_MESSAGE <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>;
<a name="l00026"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a9">00026</a>     SECURITY_QUALITY_OF_SERVICE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>;
<a name="l00027"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a10">00027</a>     ULONG <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a15">RequestCount</a>;
<a name="l00028"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a11">00028</a>     HANDLE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a16">ClientToken</a>;
<a name="l00029"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a12">00029</a>     TOKEN_STATISTICS <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a17">ClientTokenStatistics</a>;
<a name="l00030"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a13">00030</a>     ULONG <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a18">IgnoreLength</a>;
00031 
<a name="l00032"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a14">00032</a>     HANDLE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a19">SepServerThread</a>;
00033 
00034 
00035 
00036 
00038 <span class="comment">//                                                                          //</span>
00039 <span class="comment">//                Test Routine Definitions                                  //</span>
00040 <span class="comment">//                                                                          //</span>
00042 <span class="comment"></span>BOOLEAN
00043 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a15">SepClientTestStatic</a>(VOID);
00044 
00045 BOOLEAN
00046 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a16">SepClientTestDynamic</a>(VOID);
00047 
00048 BOOLEAN
00049 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a17">SepClientTestEffectiveOnly</a>(
00050     BOOLEAN StaticTest
00051     );
00052 
00053 BOOLEAN
00054 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a18">SepClientTestNotEffectiveOnly</a>(
00055     BOOLEAN StaticTest
00056     );
00057 
00058 BOOLEAN
00059 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a19">SepClientTestAnonymous</a>(
00060     BOOLEAN StaticTest,
00061     BOOLEAN EffectiveOnly
00062     );
00063 
00064 BOOLEAN
00065 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a20">SepClientTestIdentification</a>(
00066     BOOLEAN StaticTest,
00067     BOOLEAN EffectiveOnly
00068     );
00069 
00070 BOOLEAN
00071 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a21">SepClientTestImpersonation</a>(
00072     BOOLEAN StaticTest,
00073     BOOLEAN EffectiveOnly
00074     );
00075 
00076 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00077 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a22">SepClientConnect</a>(
00078     SECURITY_IMPERSONATION_LEVEL ImpersonationLevel,
00079     SECURITY_CONTEXT_TRACKING_MODE TrackingMode,
00080     BOOLEAN EffectiveOnly
00081     );
00082 
00083 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00084 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a23">SepClientMakeRemoteCall</a>( VOID );
00085 
00086 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00087 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a24">SepClientDropConnection</a>( VOID );
00088 
00089 BOOLEAN
00090 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a25">SepClientTest</a>(VOID);
00091 
00092 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00093 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a31">SepClientInitialize</a>(
00094   );
00095 
00096 
00097 
00098 
00099 
00100 
00101 BOOLEAN
00102 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a27">SepServerTestStatic</a>(VOID);
00103 
00104 BOOLEAN
00105 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a28">SepServerTestDynamic</a>(VOID);
00106 
00107 BOOLEAN
00108 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a29">SepServerTestEffectiveOnly</a>(
00109     BOOLEAN StaticTest
00110     );
00111 
00112 BOOLEAN
00113 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a30">SepServerTestNotEffectiveOnly</a>(
00114     BOOLEAN StaticTest
00115     );
00116 
00117 BOOLEAN
00118 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a31">SepServerTestAnonymous</a>(
00119     BOOLEAN StaticTest,
00120     BOOLEAN EffectiveOnly
00121     );
00122 
00123 BOOLEAN
00124 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a32">SepServerTestIdentification</a>(
00125     BOOLEAN StaticTest,
00126     BOOLEAN EffectiveOnly
00127     );
00128 
00129 BOOLEAN
00130 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a33">SepServerTestImpersonation</a>(
00131     BOOLEAN StaticTest,
00132     BOOLEAN EffectiveOnly
00133     );
00134 
00135 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00136 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a34">SepServerWaitForNextConnect</a>( VOID );
00137 
00138 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00139 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a35">SepServerGetNextMessage</a>( VOID );
00140 
00141 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00142 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a36">SepServerCompleteMessage</a>( VOID );
00143 
00144 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00145 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a37">SepServerDropConnection</a>( VOID );
00146 
00147 
00148 
00149 BOOLEAN
00150 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a38">SepServerTest</a>(VOID);
00151 
00152 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00153 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a44">SepServerInitialize</a>(
00154   );
00155 
00156 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00157 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a40">SepServerSpawnClientProcess</a>(VOID);
00158 
00159 
00160 
00161 
00162 BOOLEAN
00163 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a41">CtLpcQos</a> (VOID);
00164 
00165 
00167 <span class="comment">//                                                                          //</span>
00168 <span class="comment">//                Client-Side Test Routines                                 //</span>
00169 <span class="comment">//                                                                          //</span>
00171 <span class="comment"></span>
00172 
00173 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00174 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a22">SepClientConnect</a>(
00175     SECURITY_IMPERSONATION_LEVEL ImpersonationLevel,
00176     SECURITY_CONTEXT_TRACKING_MODE TrackingMode,
00177     BOOLEAN EffectiveOnly
00178     )
00179 
00180 {
00181 
00182     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>.ImpersonationLevel = ImpersonationLevel;
00183     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>.ContextTrackingMode = TrackingMode;
00184     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>.EffectiveOnly = EffectiveOnly;
00185 
00186     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d6/lpcconn_8c.html#a1">NtConnectPort</a>(
00187                  &amp;TalkPort,
00188                  &amp;PortName,
00189                  &amp;SecurityQos,
00190                  0L,
00191                  NULL,
00192                  NULL,
00193                  NULL,
00194                  NULL,
00195                  NULL
00196                  );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00197 
00198     <span class="keywordflow">return</span>;
00199 }
00200 
00201 
00202 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00203 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a23">SepClientMakeRemoteCall</a>( VOID )
00204 
00205 {
00206     PORT_MESSAGE <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>;
00207 
00208     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/lpcsend_8c.html#a1">NtRequestWaitReplyPort</a>(
00209                  TalkPort,
00210                  &amp;RequestMessage,
00211                  &amp;ReplyMessage
00212                  );
00213 
00214     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a15">RequestCount</a> += 1;
00215 
00216     <span class="keywordflow">return</span>;
00217 }
00218 
00219 
00220 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00221 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a24">SepClientDropConnection</a>( VOID )
00222 
00223 {
00224 
00225     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( TalkPort );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00226 
00227     <span class="keywordflow">return</span>;
00228 
00229 }
00230 
00231 
00232 BOOLEAN
00233 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a15">SepClientTestStatic</a>(VOID)
00234 
00235 {
00236 
00237     BOOLEAN CompletionStatus;
00238 
00239     <span class="comment">//</span>
00240     <span class="comment">//  Static Context Tracking ... Suite</span>
00241     <span class="comment">//</span>
00242 
00243     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a17">SepClientTestEffectiveOnly</a>( TRUE );
00244 
00245 
00246     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00247 
00248         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a18">SepClientTestNotEffectiveOnly</a>( TRUE );
00249     }
00250 
00251     <span class="keywordflow">return</span> CompletionStatus;
00252 
00253 }
00254 
00255 
00256 BOOLEAN
00257 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a16">SepClientTestDynamic</a>(VOID)
00258 
00259 {
00260     BOOLEAN CompletionStatus;
00261 
00262     <span class="comment">//</span>
00263     <span class="comment">// Dynamic Context Tracking ... Suite</span>
00264     <span class="comment">//</span>
00265 
00266     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a17">SepClientTestEffectiveOnly</a>( FALSE );
00267 
00268 
00269     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00270 
00271         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a18">SepClientTestNotEffectiveOnly</a>( FALSE );
00272     }
00273 
00274     <span class="keywordflow">return</span> CompletionStatus;
00275 
00276 }
00277 
00278 
00279 BOOLEAN
00280 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a17">SepClientTestEffectiveOnly</a>(
00281     BOOLEAN StaticTest
00282     )
00283 
00284 
00285 {
00286 
00287     BOOLEAN CompletionStatus;
00288 
00289     <span class="comment">//</span>
00290     <span class="comment">// Effective Only ... Test</span>
00291     <span class="comment">//</span>
00292 
00293     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a19">SepClientTestAnonymous</a>( StaticTest, TRUE );
00294     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00295         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a20">SepClientTestIdentification</a>( StaticTest, TRUE );
00296     }
00297     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00298         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a21">SepClientTestImpersonation</a>( StaticTest, TRUE );
00299     }
00300 
00301     <span class="keywordflow">return</span> CompletionStatus;
00302 
00303 }
00304 
00305 
00306 BOOLEAN
00307 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a18">SepClientTestNotEffectiveOnly</a>(
00308     BOOLEAN StaticTest
00309     )
00310 
00311 {
00312     BOOLEAN CompletionStatus;
00313 
00314     <span class="comment">//</span>
00315     <span class="comment">// Not Effective Only ... Test</span>
00316     <span class="comment">//</span>
00317 
00318     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a19">SepClientTestAnonymous</a>( StaticTest, FALSE );
00319     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00320         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a20">SepClientTestIdentification</a>( StaticTest, FALSE );
00321     }
00322     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00323         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a21">SepClientTestImpersonation</a>( StaticTest, FALSE );
00324     }
00325 
00326     <span class="keywordflow">return</span> CompletionStatus;
00327 
00328 }
00329 
00330 
00331 BOOLEAN
00332 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a19">SepClientTestAnonymous</a>(
00333     BOOLEAN StaticTest,
00334     BOOLEAN EffectiveOnly
00335     )
00336 
00337 {
00338 
00340     <span class="comment">//                                                                      //</span>
00341     <span class="comment">//        Anonymous Use Test                                            //</span>
00342     <span class="comment">//                                                                      //</span>
00344 <span class="comment"></span>
00345     SECURITY_CONTEXT_TRACKING_MODE TrackingMode;
00346 
00347     <span class="keywordflow">if</span> (StaticTest) {
00348         TrackingMode = SECURITY_STATIC_TRACKING;
00349     } <span class="keywordflow">else</span> {
00350         TrackingMode = SECURITY_DYNAMIC_TRACKING;
00351     }
00352 
00353     <span class="keywordflow">if</span> (!StaticTest) {
00354         <span class="comment">//</span>
00355         <span class="comment">// No action for dynamic test</span>
00356         <span class="comment">//</span>
00357         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00358     }
00359 
00360     <span class="comment">//</span>
00361     <span class="comment">// Anonymous Use ... Test</span>
00362     <span class="comment">//</span>
00363 
00364 
00365     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a22">SepClientConnect</a>(
00366         SecurityAnonymous,
00367         TrackingMode,
00368         EffectiveOnly
00369         );
00370 
00371     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a23">SepClientMakeRemoteCall</a>();
00372 
00373     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a24">SepClientDropConnection</a>();
00374 
00375 
00376     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00377 }
00378 
00379 
00380 BOOLEAN
00381 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a20">SepClientTestIdentification</a>(
00382     BOOLEAN StaticTest,
00383     BOOLEAN EffectiveOnly
00384     )
00385 
00386 {
00387 
00389     <span class="comment">//                                                                      //</span>
00390     <span class="comment">//        Identification Use Test                                       //</span>
00391     <span class="comment">//                                                                      //</span>
00393 <span class="comment"></span>
00394     SECURITY_CONTEXT_TRACKING_MODE TrackingMode;
00395 
00396     <span class="keywordflow">if</span> (StaticTest) {
00397         TrackingMode = SECURITY_STATIC_TRACKING;
00398     } <span class="keywordflow">else</span> {
00399         TrackingMode = SECURITY_DYNAMIC_TRACKING;
00400     }
00401 
00402     <span class="comment">//</span>
00403     <span class="comment">// Identification Use ... Test</span>
00404     <span class="comment">//</span>
00405 
00406 
00407     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a22">SepClientConnect</a>(
00408         SecurityIdentification,
00409         TrackingMode,
00410         EffectiveOnly
00411         );
00412 
00413     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a23">SepClientMakeRemoteCall</a>();
00414 
00415     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a24">SepClientDropConnection</a>();
00416 
00417 
00418     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00419 
00420 }
00421 
00422 
00423 BOOLEAN
00424 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a21">SepClientTestImpersonation</a>(
00425     BOOLEAN StaticTest,
00426     BOOLEAN EffectiveOnly
00427     )
00428 
00429 {
00430 
00432     <span class="comment">//                                                                      //</span>
00433     <span class="comment">//        Impersonation Use Test                                        //</span>
00434     <span class="comment">//                                                                      //</span>
00436 <span class="comment"></span>
00437     SECURITY_CONTEXT_TRACKING_MODE TrackingMode;
00438 
00439     <span class="keywordflow">if</span> (StaticTest) {
00440         TrackingMode = SECURITY_STATIC_TRACKING;
00441     } <span class="keywordflow">else</span> {
00442         TrackingMode = SECURITY_DYNAMIC_TRACKING;
00443     }
00444 
00445 
00446     <span class="comment">//</span>
00447     <span class="comment">// Impersonation Use ... Test</span>
00448     <span class="comment">//</span>
00449 
00450 
00451     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a22">SepClientConnect</a>(
00452         SecurityImpersonation,
00453         TrackingMode,
00454         EffectiveOnly
00455         );
00456 
00457     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a23">SepClientMakeRemoteCall</a>();
00458 
00459     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a24">SepClientDropConnection</a>();
00460 
00461 
00462 
00463     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00464 
00465 }
00466 
00467 
00468 
00469 
00470 BOOLEAN
00471 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a25">SepClientTest</a>(VOID)
00472 <span class="comment">//</span>
00473 <span class="comment">// Tests:</span>
00474 <span class="comment">//</span>
00475 <span class="comment">//      Static Context Tracking Tests</span>
00476 <span class="comment">//          Effective Only</span>
00477 <span class="comment">//              Anonymous</span>
00478 <span class="comment">//              Identification</span>
00479 <span class="comment">//              Impersonation</span>
00480 <span class="comment">//          Not Effective Only</span>
00481 <span class="comment">//              Anonymous</span>
00482 <span class="comment">//              Identification</span>
00483 <span class="comment">//              Impersonation</span>
00484 <span class="comment">//</span>
00485 <span class="comment">//      Dynamic Context Tracking Tests</span>
00486 <span class="comment">//          Effective Only</span>
00487 <span class="comment">//              Identification</span>
00488 <span class="comment">//              Impersonation</span>
00489 <span class="comment">//          Not Effective Only</span>
00490 <span class="comment">//              Identification</span>
00491 <span class="comment">//              Impersonation</span>
00492 <span class="comment">//</span>
00493 {
00494 
00495     BOOLEAN CompletionStatus;
00496 
00497 
00498 
00499 
00500     <span class="comment">//</span>
00501     <span class="comment">// Run the static test suite...</span>
00502     <span class="comment">//</span>
00503 
00504     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a15">SepClientTestStatic</a>();
00505 
00506     <span class="comment">//</span>
00507     <span class="comment">// Run the dynamic test suite...</span>
00508     <span class="comment">//</span>
00509 
00510     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00511         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a16">SepClientTestDynamic</a>();
00512     }
00513 
00514     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Client Test Complete.\n"</span>);
00515 
00516 
00517     <span class="keywordflow">return</span> CompletionStatus;
00518 }
00519 
00520 
00521 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00522 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a31">SepClientInitialize</a>(
00523   )
00524 
00525 {
00526 
00527 
00528 
00529     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Client Initializing ...\n"</span>);
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">// Initialize global variables</span>
00533     <span class="comment">//</span>
00534 
00535     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>.u1.s1.DataLength = 0;
00536     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>.u1.s1.TotalLength = (CSHORT)<span class="keyword">sizeof</span>(PORT_MESSAGE);
00537     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>.u2.ZeroInit = 0;
00538 
00539     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a15">RequestCount</a> = 0;
00540 
00541 
00542     <span class="comment">//</span>
00543     <span class="comment">// Signal the named event to start the test</span>
00544     <span class="comment">//</span>
00545 
00546     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Client Starting Test ...\n"</span>);
00547     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>( EventHandle, NULL ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00548 
00549     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( EventHandle ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00550 
00551 
00552     <span class="keywordflow">return</span> STATUS_SUCCESS;
00553 }
00554 
00555 
00557 <span class="comment">//                                                                          //</span>
00558 <span class="comment">//                Server-Side Test Routines                                 //</span>
00559 <span class="comment">//                                                                          //</span>
00561 <span class="comment"></span>
00562 
00563 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00564 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a34">SepServerWaitForNextConnect</a>( VOID )
00565 {
00566 
00567     CONNECTION_REQUEST ConnectionRequest;
00568 
00569     ConnectionRequest.Length = (ULONG)<span class="keyword">sizeof</span>(CONNECTION_REQUEST);
00570 
00571     <span class="comment">//</span>
00572     <span class="comment">// Wait for the client to connect to the port</span>
00573     <span class="comment">//</span>
00574 
00575     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/lpclistn_8c.html#a0">NtListenPort</a>(
00576                  EarPort,
00577                  &amp;ConnectionRequest,
00578                  NULL,
00579                  0L
00580                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00581 
00582     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d6/lpccompl_8c.html#a1">NtAcceptConnectPort</a>(
00583                  &amp;TalkPort,
00584                  NULL,
00585                  &amp;ConnectionRequest,
00586                  TRUE,
00587                  NULL,
00588                  NULL,
00589                  NULL,
00590                  0L
00591                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00592 
00593     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d6/lpccompl_8c.html#a2">NtCompleteConnectPort</a>( TalkPort ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00594 
00595     <span class="keywordflow">return</span>;
00596 
00597 }
00598 
00599 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00600 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a35">SepServerGetNextMessage</a>( VOID )
00601 
00602 {
00603 
00604     <span class="comment">//</span>
00605     <span class="comment">// Wait for the next message to come in...</span>
00606     <span class="comment">//</span>
00607 
00608     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/lpcrecv_8c.html#a0">NtReplyWaitReceivePort</a>(
00609                  EarPort,
00610                  NULL,
00611                  NULL,
00612                  &amp;RequestMessage
00613                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00614 
00615     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a15">RequestCount</a> += 1;
00616 
00617     <span class="keywordflow">return</span>;
00618 }
00619 
00620 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00621 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a36">SepServerCompleteMessage</a>( VOID )
00622 
00623 {
00624     PORT_MESSAGE <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>;
00625 
00626     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.u1.s1.DataLength = 0;
00627     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.u1.s1.TotalLength = (CSHORT)<span class="keyword">sizeof</span>(PORT_MESSAGE);
00628     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.u2.ZeroInit = 0;
00629     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.ClientId = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>.ClientId;
00630     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageId = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>.MessageId;
00631 
00632     <span class="comment">//</span>
00633     <span class="comment">// Send the response message</span>
00634     <span class="comment">//</span>
00635 
00636     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(
00637                  EarPort,
00638                  &amp;ReplyMessage
00639                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00640 
00641     <span class="keywordflow">return</span>;
00642 }
00643 
00644 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00645"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a42">00645</a> <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a42">SepServerImpersonateClient</a>( VOID )
00646 
00647 {
00648 
00649     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/lpcpriv_8c.html#a0">NtImpersonateClientOfPort</a>(
00650                  <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a13">TalkPort</a>,
00651                  &amp;<a class="code" href="../../d8/d0/ctlpcqos_8c.html#a8">RequestMessage</a>
00652                  );   <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00653 
00654 }
00655 
00656 
00657 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00658"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a43">00658</a> <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a43">SepServerRevertToSelf</a>( VOID )
00659 
00660 {
00661     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus;
00662     HANDLE NullHandle;
00663 
00664     NullHandle = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00665     TmpStatus = <a class="code" href="../../d9/d1/psquery_8c.html#a21">NtSetInformationThread</a>(
00666                     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a19">SepServerThread</a>,
00667                     ThreadImpersonationToken,
00668                     (PVOID)&amp;NullHandle,
00669                     (ULONG)<span class="keyword">sizeof</span>(HANDLE)
00670                     );   <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(TmpStatus);
00671 
00672 }
00673 
00674 
00675 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00676 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a37">SepServerDropConnection</a>( VOID )
00677 
00678 {
00679     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( TalkPort ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00680 
00681     <span class="keywordflow">return</span>;
00682 }
00683 
00684 BOOLEAN
00685 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a27">SepServerTestStatic</a>(VOID)
00686 
00687 {
00688     BOOLEAN CompletionStatus;
00689 
00690     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:    Static Context Tracking ...                           Suite\n"</span>);
00691 
00692     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a29">SepServerTestEffectiveOnly</a>( TRUE );
00693 
00694 
00695     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00696 
00697         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a30">SepServerTestNotEffectiveOnly</a>( TRUE );
00698     }
00699 
00700     <span class="keywordflow">return</span> CompletionStatus;
00701 
00702 }
00703 
00704 
00705 BOOLEAN
00706 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a28">SepServerTestDynamic</a>(VOID)
00707 
00708 {
00709     BOOLEAN CompletionStatus;
00710 
00711     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:    Dynamic Context Tracking ...                          Suite\n"</span>);
00712 
00713     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a29">SepServerTestEffectiveOnly</a>( FALSE );
00714 
00715 
00716     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00717 
00718         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a30">SepServerTestNotEffectiveOnly</a>( FALSE );
00719     }
00720 
00721     <span class="keywordflow">return</span> CompletionStatus;
00722 
00723 }
00724 
00725 
00726 BOOLEAN
00727 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a29">SepServerTestEffectiveOnly</a>(
00728     BOOLEAN StaticTest
00729     )
00730 
00731 {
00732 
00733     BOOLEAN CompletionStatus;
00734 
00735     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:      Effective Only ...                                    Test\n"</span>);
00736 
00737     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a31">SepServerTestAnonymous</a>( StaticTest, TRUE );
00738     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00739         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a32">SepServerTestIdentification</a>( StaticTest, TRUE );
00740     }
00741     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00742         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a33">SepServerTestImpersonation</a>( StaticTest, TRUE );
00743     }
00744 
00745     <span class="keywordflow">return</span> CompletionStatus;
00746 
00747 }
00748 
00749 
00750 BOOLEAN
00751 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a30">SepServerTestNotEffectiveOnly</a>(
00752     BOOLEAN StaticTest
00753     )
00754 
00755 {
00756 
00757     BOOLEAN CompletionStatus;
00758 
00759     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:      Not Effective Only ...                                Test\n"</span>);
00760 
00761     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a31">SepServerTestAnonymous</a>( StaticTest, FALSE );
00762     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00763         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a32">SepServerTestIdentification</a>( StaticTest, FALSE );
00764     }
00765     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00766         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a33">SepServerTestImpersonation</a>( StaticTest, FALSE );
00767     }
00768 
00769     <span class="keywordflow">return</span> CompletionStatus;
00770 
00771 }
00772 
00773 
00774 BOOLEAN
00775 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a31">SepServerTestAnonymous</a>(
00776     BOOLEAN StaticTest,
00777     BOOLEAN EffectiveOnly
00778     )
00779 
00780 {
00781     BOOLEAN CompletionStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00782 
00784     <span class="comment">//                                                                      //</span>
00785     <span class="comment">//        Anonymous Use Test                                            //</span>
00786     <span class="comment">//                                                                      //</span>
00788 <span class="comment"></span>
00789 
00790     <span class="keywordflow">if</span> (!StaticTest) {
00791         <span class="comment">//</span>
00792         <span class="comment">// No action for dynamic test</span>
00793         <span class="comment">//</span>
00794 
00795         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00796     }
00797 
00798     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:        Anonymous Use ...                                     "</span>);
00799 
00800     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a34">SepServerWaitForNextConnect</a>();
00801 
00802     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a35">SepServerGetNextMessage</a>();
00803 
00804 
00805     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a42">SepServerImpersonateClient</a>();
00806     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d3/tokenopn_8c.html#a3">NtOpenThreadToken</a>(
00807                  SepServerThread,
00808                  TOKEN_ALL_ACCESS,
00809                  TRUE,
00810                  &amp;ClientToken
00811                  );
00812     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a43">SepServerRevertToSelf</a>();
00813     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_CANT_OPEN_ANONYMOUS) {
00814 
00815         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Succeeded\n"</span>);
00816 
00817     } <span class="keywordflow">else</span> {
00818         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"* ! FAILED (srvr) ! *\n"</span>);
00819         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Status is: 0x%lx \n"</span>, Status );
00820         CompletionStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00821     }
00822 
00823 
00824     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a36">SepServerCompleteMessage</a>();
00825 
00826     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a37">SepServerDropConnection</a>();
00827 
00828     <span class="comment">//</span>
00829     <span class="comment">// Appease the compiler Gods..</span>
00830     <span class="comment">//</span>
00831 
00832     <span class="keywordflow">if</span> (EffectiveOnly) {;}
00833 
00834 
00835     <span class="keywordflow">return</span> CompletionStatus;
00836 
00837 }
00838 
00839 
00840 BOOLEAN
00841 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a32">SepServerTestIdentification</a>(
00842     BOOLEAN StaticTest,
00843     BOOLEAN EffectiveOnly
00844     )
00845 
00846 {
00847 
00848     BOOLEAN CompletionStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00850     <span class="comment">//                                                                      //</span>
00851     <span class="comment">//        Identification Use Test                                       //</span>
00852     <span class="comment">//                                                                      //</span>
00854 <span class="comment"></span>
00855     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:        Identification Use ...                                "</span>);
00856 
00857     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a34">SepServerWaitForNextConnect</a>();
00858 
00859     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a35">SepServerGetNextMessage</a>();
00860 
00861     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a42">SepServerImpersonateClient</a>();
00862     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d3/tokenopn_8c.html#a3">NtOpenThreadToken</a>(
00863                  SepServerThread,
00864                  TOKEN_ALL_ACCESS,
00865                  TRUE,
00866                  &amp;ClientToken
00867                  );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00868     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a43">SepServerRevertToSelf</a>();
00869     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/tokenqry_8c.html#a0">NtQueryInformationToken</a>(
00870                  ClientToken,
00871                  TokenStatistics,
00872                  &amp;ClientTokenStatistics,
00873                  (ULONG)<span class="keyword">sizeof</span>(TOKEN_STATISTICS),
00874                  &amp;IgnoreLength
00875                  );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00876 
00877     <span class="keywordflow">if</span> ( (<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a17">ClientTokenStatistics</a>.TokenType == TokenImpersonation) &amp;&amp;
00878          (<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a17">ClientTokenStatistics</a>.ImpersonationLevel == SecurityIdentification)
00879        ) {
00880         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Succeeded\n"</span>);
00881 
00882     } <span class="keywordflow">else</span> {
00883         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"* ! FAILED (srvr) ! *\n"</span>);
00884         CompletionStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00885     }
00886 
00887 
00888     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a36">SepServerCompleteMessage</a>();
00889 
00890     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a37">SepServerDropConnection</a>();
00891 
00892     <span class="comment">//</span>
00893     <span class="comment">// Appease the compiler Gods..</span>
00894     <span class="comment">//</span>
00895     <span class="keywordflow">if</span> (StaticTest) {;}
00896     <span class="keywordflow">if</span> (EffectiveOnly) {;}
00897 
00898     <span class="keywordflow">return</span> CompletionStatus;
00899 }
00900 
00901 
00902 BOOLEAN
00903 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a33">SepServerTestImpersonation</a>(
00904     BOOLEAN StaticTest,
00905     BOOLEAN EffectiveOnly
00906     )
00907 
00908 {
00909     BOOLEAN CompletionStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00910 
00912     <span class="comment">//                                                                      //</span>
00913     <span class="comment">//        Impersonation Use Test                                        //</span>
00914     <span class="comment">//                                                                      //</span>
00916 <span class="comment"></span>
00917     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se:        Impersonation Use ...                                 "</span>);
00918 
00919 
00920     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a34">SepServerWaitForNextConnect</a>();
00921 
00922     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a35">SepServerGetNextMessage</a>();
00923 
00924 
00925 
00926     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a42">SepServerImpersonateClient</a>();
00927     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d3/tokenopn_8c.html#a3">NtOpenThreadToken</a>(
00928                  SepServerThread,
00929                  TOKEN_ALL_ACCESS,
00930                  TRUE,
00931                  &amp;ClientToken
00932                  );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00933     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a43">SepServerRevertToSelf</a>();
00934     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/tokenqry_8c.html#a0">NtQueryInformationToken</a>(
00935                  ClientToken,
00936                  TokenStatistics,
00937                  &amp;ClientTokenStatistics,
00938                  (ULONG)<span class="keyword">sizeof</span>(TOKEN_STATISTICS),
00939                  &amp;IgnoreLength
00940                  );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
00941 
00942     <span class="keywordflow">if</span> ( (<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a17">ClientTokenStatistics</a>.TokenType == TokenImpersonation) &amp;&amp;
00943          (<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a17">ClientTokenStatistics</a>.ImpersonationLevel == SecurityImpersonation)
00944        ) {
00945         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Succeeded\n"</span>);
00946 
00947     } <span class="keywordflow">else</span> {
00948         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"* ! FAILED (srvr) ! *\n"</span>);
00949         CompletionStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00950     }
00951 
00952 
00953 
00954 
00955     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a36">SepServerCompleteMessage</a>();
00956 
00957     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a37">SepServerDropConnection</a>();
00958 
00959     <span class="comment">//</span>
00960     <span class="comment">// Appease the compiler gods</span>
00961     <span class="comment">//</span>
00962     <span class="keywordflow">if</span> (StaticTest) {;}
00963     <span class="keywordflow">if</span> (EffectiveOnly) {;}
00964 
00965     <span class="keywordflow">return</span> CompletionStatus;
00966 }
00967 
00968 
00969 BOOLEAN
00970 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a38">SepServerTest</a>(VOID)
00971 <span class="comment">//</span>
00972 <span class="comment">// Tests:</span>
00973 <span class="comment">//</span>
00974 <span class="comment">//      Static Context Tracking Tests</span>
00975 <span class="comment">//          Effective Only</span>
00976 <span class="comment">//              Anonymous</span>
00977 <span class="comment">//              Identification</span>
00978 <span class="comment">//              Impersonation</span>
00979 <span class="comment">//          Not Effective Only</span>
00980 <span class="comment">//              Anonymous</span>
00981 <span class="comment">//              Identification</span>
00982 <span class="comment">//              Impersonation</span>
00983 <span class="comment">//</span>
00984 <span class="comment">//      Dynamic Context Tracking Tests</span>
00985 <span class="comment">//          Effective Only</span>
00986 <span class="comment">//              Identification</span>
00987 <span class="comment">//              Impersonation</span>
00988 <span class="comment">//          Not Effective Only</span>
00989 <span class="comment">//              Identification</span>
00990 <span class="comment">//              Impersonation</span>
00991 <span class="comment">//</span>
00992 {
00993 
00994     BOOLEAN CompletionStatus;
00995 
00996 
00997     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Server Starting Test ...\n"</span>);
00998 
00999     <span class="comment">//</span>
01000     <span class="comment">// Run the static test suite...</span>
01001     <span class="comment">//</span>
01002 
01003     CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a27">SepServerTestStatic</a>();
01004 
01005     <span class="comment">//</span>
01006     <span class="comment">// Run the dynamic test suite...</span>
01007     <span class="comment">//</span>
01008 
01009     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01010         CompletionStatus = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a28">SepServerTestDynamic</a>();
01011     }
01012 
01013     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Server Test Complete.\n"</span>);
01014 
01015     <span class="comment">//</span>
01016     <span class="comment">// Print test results</span>
01017     <span class="comment">//</span>
01018 
01019     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01020     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01021     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"**********************\n"</span>);
01022     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"**                  **\n"</span>);
01023 
01024     <span class="keywordflow">if</span> (CompletionStatus == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01025         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"**  Test Succeeded  **\n"</span>);
01026     } <span class="keywordflow">else</span> {
01027         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"**  Test Failed !!  **\n"</span>);
01028     }
01029 
01030     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"**                  **\n"</span>);
01031     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"**********************\n"</span>);
01032 
01033     <span class="keywordflow">return</span> CompletionStatus;
01034 
01035 }
01036 
01037 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01038 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a44">SepServerInitialize</a>(
01039   )
01040 
01041 {
01042 
01043     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01044     OBJECT_ATTRIBUTES ThreadAttributes;
01045     PTEB CurrentTeb;
01046 
01047 
01048     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Server Initializing ...\n"</span>);
01049 
01050     <span class="comment">//</span>
01051     <span class="comment">// Initialize global variables</span>
01052     <span class="comment">//</span>
01053 
01054     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a15">RequestCount</a> = 0;
01055 
01056     <span class="comment">//</span>
01057     <span class="comment">// Get a handle to our thread to so that we can access our thread</span>
01058     <span class="comment">// even when impersonating an anonymous client (which we can't do</span>
01059     <span class="comment">// using NtCurrentThread()).</span>
01060     <span class="comment">//</span>
01061 
01062     CurrentTeb = NtCurrentTeb();
01063     InitializeObjectAttributes(&amp;ThreadAttributes, NULL, 0, NULL, NULL);
01064     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/psopen_8c.html#a1">NtOpenThread</a>(
01065                  &amp;SepServerThread,           <span class="comment">// TargetHandle</span>
01066                  THREAD_ALL_ACCESS,          <span class="comment">// DesiredAccess</span>
01067                  &amp;ThreadAttributes,          <span class="comment">// ObjectAttributes</span>
01068                  &amp;CurrentTeb-&gt;ClientId       <span class="comment">// ClientId</span>
01069                  );
01070     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
01071 
01072 
01073     <span class="comment">//</span>
01074     <span class="comment">// Create the server's port</span>
01075     <span class="comment">//</span>
01076 
01077     InitializeObjectAttributes(
01078         &amp;ObjectAttributes,
01079         &amp;PortName,
01080         0,
01081         NULL,
01082         NULL );
01083 
01084     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/lpccreat_8c.html#a1">NtCreatePort</a>(
01085                  &amp;EarPort,
01086                  &amp;ObjectAttributes,
01087                  0,
01088                  4,
01089                  4 * 256
01090                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
01091 
01092 
01093 
01094     <span class="comment">//</span>
01095     <span class="comment">// Spawn a copy of ourselves...</span>
01096     <span class="comment">//</span>
01097 
01098     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Server Spawning client process ...\n"</span>);
01099     <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a40">SepServerSpawnClientProcess</a>();
01100 
01101 
01102     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Server waiting for start of test signal ...\n"</span>);
01103 
01104     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(
01105                  EventHandle,
01106                  TRUE,
01107                  NULL
01108                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
01109 
01110     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( EventHandle );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
01111 
01112 
01113     <span class="keywordflow">return</span> STATUS_SUCCESS;
01114 }
01115 
01116 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01117 <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a40">SepServerSpawnClientProcess</a>(VOID)
01118 
01119 {
01120 
01121 
01122     RTL_USER_PROCESS_INFORMATION ProcessInformation;
01123     STRING ImagePathName, ProgramName;
01124     UNICODE_STRING UnicodeImagePathName, UnicodeProgramName;
01125     PRTL_USER_PROCESS_PARAMETERS ProcessParameters;
01126 
01127     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;ProgramName, <span class="stringliteral">"\\SystemRoot\\Bin\\utlpcqos.exe"</span> );
01128     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
01129                  &amp;UnicodeProgramName,
01130                  &amp;ProgramName,
01131                  TRUE );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
01132     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;ImagePathName, <span class="stringliteral">"utlpcqos.exe"</span>);
01133     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
01134                  &amp;UnicodeImagePathName,
01135                  &amp;ImagePathName,
01136                  TRUE );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
01137 
01138     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a8">RtlCreateProcessParameters</a>(
01139                  &amp;ProcessParameters,
01140                  &amp;ImagePathName,        <span class="comment">//UNICODEFIX &amp;UnicodeImagePathName,</span>
01141                  NULL,
01142                  NULL,
01143                  NULL,
01144                  NULL,
01145                  NULL,
01146                  NULL,
01147                  NULL,
01148                  NULL
01149                  );
01150 
01151     <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
01152 
01153 
01154     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a12">RtlCreateUserProcess</a>(
01155                  &amp;ProgramName,                   <span class="comment">// UNICODEFIX &amp;UnicodeProgramName,</span>
01156                  ProcessParameters,              <span class="comment">// ProcessParameters</span>
01157                  NULL,                           <span class="comment">// ProcessSecurityDescriptor</span>
01158                  NULL,                           <span class="comment">// ThreadSecurityDescriptor</span>
01159                  NtCurrentProcess(),             <span class="comment">// ParentProcess</span>
01160                  FALSE,                          <span class="comment">// InheritHandles</span>
01161                  NULL,                           <span class="comment">// DebugPort</span>
01162                  NULL,                           <span class="comment">// ExceptionPort</span>
01163                  &amp;ProcessInformation             <span class="comment">// ProcessInformation</span>
01164                  ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
01165 
01166     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(
01167                   ProcessInformation.Thread,
01168                   NULL
01169                   ); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(Status);
01170 
01171     <a class="code" href="../../d0/d2/rtlexec_8c.html#a9">RtlDestroyProcessParameters</a>( ProcessParameters );
01172     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;UnicodeProgramName );
01173     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;UnicodeImagePathName );
01174 
01175 }
01176 
01177 
01178 
01179 
01181 <span class="comment">//                                                                          //</span>
01182 <span class="comment">//                Main Program Entry Routine                                //</span>
01183 <span class="comment">//                                                                          //</span>
01185 <span class="comment"></span>
01186 BOOLEAN
<a name="l01187"></a><a class="code" href="../../d8/d0/ctlpcqos_8c.html#a41">01187</a> <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a41">CtLpcQos</a> (VOID)
01188 {
01189 
01190     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01191 
01192     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\TestLpcQosServerPort"</span> );
01193 
01194     <span class="comment">//</span>
01195     <span class="comment">// Determine whether we are the client or server side of the test.</span>
01196     <span class="comment">// This is done by creating or opening a named event object.  If the</span>
01197     <span class="comment">// event does not yet exist, then we are the client, and must create</span>
01198     <span class="comment">// the server process.  Otherwise, we are the server and the client</span>
01199     <span class="comment">// is waiting for us to signal the event.</span>
01200     <span class="comment">//</span>
01201 
01202     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a5">EventName</a>, <span class="stringliteral">"\\TestLpcQosEvent"</span> );
01203     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
01204                  &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a6">UnicodeEventName</a>,
01205                  &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a5">EventName</a>,
01206                  <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );  <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) );
01207     InitializeObjectAttributes(
01208         &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
01209         &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a6">UnicodeEventName</a>,
01210         OBJ_OPENIF,
01211         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01212         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01213         );
01214     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(
01215                  &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a7">EventHandle</a>,
01216                  EVENT_ALL_ACCESS,
01217                  &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
01218                  SynchronizationEvent,
01219                  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
01220                  );
01221 
01222     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_EXISTS) {
01223 
01224         <span class="comment">//</span>
01225         <span class="comment">// Server is already running, therefore, this process gets to be</span>
01226         <span class="comment">// the client.</span>
01227         <span class="comment">//</span>
01228 
01229         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a31">SepClientInitialize</a>(); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01230         Result = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a25">SepClientTest</a>();
01231 
01232     } <span class="keywordflow">else</span> {
01233 
01234         <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01235 
01236         <span class="comment">//</span>
01237         <span class="comment">// Event wasn't yet there, so we must be the server.</span>
01238         <span class="comment">//</span>
01239 
01240     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: Starting LPC Impersonation Test.\n"</span>);
01241 
01242         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a44">SepServerInitialize</a>(); <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01243         Result = <a class="code" href="../../d8/d0/ctlpcqos_8c.html#a38">SepServerTest</a>();
01244 
01245     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Se: End Test.\n"</span>);
01246 
01247         }
01248 
01249 
01250 
01251     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/psdelete_8c.html#a6">NtTerminateThread</a>( NtCurrentThread(), STATUS_SUCCESS);
01252     <a class="code" href="../../d2/d6/tsecomm_8c.html#a0">SEASSERT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01253 
01254     <span class="keywordflow">return</span> Result;
01255 
01256 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:37 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
