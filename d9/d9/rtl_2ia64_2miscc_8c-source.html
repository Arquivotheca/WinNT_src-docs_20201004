<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: miscc.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>miscc.c</h1><a href="../../d8/d0/rtl_2ia64_2miscc_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1996  Intel Corporation</span>
00004 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00005 <span class="comment"></span>
00006 <span class="comment">Module Name:</span>
00007 <span class="comment"></span>
00008 <span class="comment">    miscc.c</span>
00009 <span class="comment"></span>
00010 <span class="comment">Abstract:</span>
00011 <span class="comment"></span>
00012 <span class="comment">    This module implements the functions that get the memory stack</span>
00013 <span class="comment">    and backing store limits.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    William K. Cheung (wcheung) 09-Aug-1996</span>
00018 <span class="comment"></span>
00019 <span class="comment">Environment:</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Any mode.</span>
00022 <span class="comment"></span>
00023 <span class="comment">Revision History:</span>
00024 <span class="comment"></span>
00025 <span class="comment">--*/</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="../../d5/d9/ntrtlp_8h.html">ntrtlp.h</a>"</span>
00028 
00029 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00030 <a class="code" href="../../d8/d0/rtl_2ia64_2miscc_8c.html#a0">RtlpFlushRSE</a> (
00031     OUT PULONGLONG BackingStore,
00032     OUT PULONGLONG RNat
00033     );
00034 
00035 
00036 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00037"></a><a class="code" href="../../d8/d0/rtl_2ia64_2miscc_8c.html#a1">00037</a> <a class="code" href="../../d8/d0/rtl_2ia64_2miscc_8c.html#a1">RtlpCaptureRnats</a> (
00038    IN OUT PCONTEXT ContextRecord
00039    )
00040 
00041 <span class="comment">/*++</span>
00042 <span class="comment"></span>
00043 <span class="comment">Routine Description:</span>
00044 <span class="comment"></span>
00045 <span class="comment">    This function captures Nat bits of all the stacked registers in</span>
00046 <span class="comment">    the RSE frame specified in the context record.</span>
00047 <span class="comment">--*/</span>
00048 {
00049     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> BsFrameSize;                  <span class="comment">// in 8-byte units</span>
00050     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> TempFrameSize;                <span class="comment">// in 8-byte units</span>
00051     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RNatSaveIndex;
00052     ULONGLONG Rnat;
00053     ULONGLONG Bsp;
00054     ULONGLONG TopRnatAddress;
00055 
00056     <a class="code" href="../../d8/d0/rtl_2ia64_2miscc_8c.html#a0">RtlpFlushRSE</a>(&amp;Bsp, &amp;Rnat);
00057 
00058     BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)ContextRecord-&gt;StIFS &amp; PFS_SIZE_MASK;
00059     RNatSaveIndex = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ContextRecord-&gt;RsBSP &gt;&gt; 3) &amp; NAT_BITS_PER_RNAT_REG;
00060     TempFrameSize = RNatSaveIndex + BsFrameSize - NAT_BITS_PER_RNAT_REG;
00061     <span class="keywordflow">while</span> (TempFrameSize &gt;= 0) {
00062         BsFrameSize++;
00063         TempFrameSize -= NAT_BITS_PER_RNAT_REG;
00064     }
00065     TopRnatAddress = (ContextRecord-&gt;RsBSP + BsFrameSize * 8) | RNAT_ALIGNMENT;
00066     <span class="keywordflow">if</span> (TopRnatAddress &lt; Bsp) {
00067         ContextRecord-&gt;RsRNAT = *(PULONGLONG)TopRnatAddress;
00068     } <span class="keywordflow">else</span> {
00069         ContextRecord-&gt;RsRNAT = Rnat;
00070     }
00071 }
00072 
00073 
00074 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00075"></a><a class="code" href="../../d3/d9/ntrtli64_8h.html#a1">00075</a> <a class="code" href="../../d3/d9/ntrtli64_8h.html#a1">Rtlp64GetBStoreLimits</a> (
00076     OUT PULONGLONG LowBStoreLimit,
00077     OUT PULONGLONG HighBStoreLimit
00078     )
00079 
00080 <span class="comment">/*++</span>
00081 <span class="comment"></span>
00082 <span class="comment">Routine Description:</span>
00083 <span class="comment"></span>
00084 <span class="comment">    This function returns the current backing store limits based on the </span>
00085 <span class="comment">    current processor mode.</span>
00086 <span class="comment"></span>
00087 <span class="comment">Arguments:</span>
00088 <span class="comment"></span>
00089 <span class="comment">    LowBStoreLimit - Supplies a pointer to a variable that is to receive</span>
00090 <span class="comment">        the low limit of the backing store.</span>
00091 <span class="comment"></span>
00092 <span class="comment">    HighBStoreLimit - Supplies a pointer to a variable that is to receive</span>
00093 <span class="comment">        the high limit of the backing store.</span>
00094 <span class="comment"></span>
00095 <span class="comment">Return Value:</span>
00096 <span class="comment"></span>
00097 <span class="comment">    None.</span>
00098 <span class="comment"></span>
00099 <span class="comment">--*/</span>
00100 
00101 {
00102 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00103 <span class="preprocessor"></span>
00104     <span class="comment">//</span>
00105     <span class="comment">// Kernel Mode</span>
00106     <span class="comment">//</span>
00107 
00108     *LowBStoreLimit = (ULONGLONG)(PCR-&gt;InitialBStore);
00109     *HighBStoreLimit = (ULONGLONG)(PCR-&gt;BStoreLimit);
00110 
00111 <span class="preprocessor">#else</span>
00112 <span class="preprocessor"></span>
00113     <span class="comment">//</span>
00114     <span class="comment">// User Mode</span>
00115     <span class="comment">//</span>
00116 
00117     PTEB CurrentTeb = NtCurrentTeb();
00118 
00119     *HighBStoreLimit = (ULONGLONG)CurrentTeb-&gt;BStoreLimit;
00120     *LowBStoreLimit = (ULONGLONG)CurrentTeb-&gt;NtTib.StackBase;
00121 
00122 <span class="preprocessor">#endif // defined(NTOS_KERNEL_RUNTIME)</span>
00123 <span class="preprocessor"></span>}
00124     
00125 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00126"></a><a class="code" href="../../d5/d9/ntrtlp_8h.html#a30">00126</a> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a30">RtlpGetStackLimits</a> (
00127     OUT PULONG_PTR LowStackLimit,
00128     OUT PULONG_PTR HighStackLimit
00129     )
00130 
00131 <span class="comment">/*++</span>
00132 <span class="comment"></span>
00133 <span class="comment">Routine Description:</span>
00134 <span class="comment"></span>
00135 <span class="comment">    This function returns the current memory stack limits based on the </span>
00136 <span class="comment">    current processor mode.</span>
00137 <span class="comment"></span>
00138 <span class="comment">Arguments:</span>
00139 <span class="comment"></span>
00140 <span class="comment">    LowStackLimit - Supplies a pointer to a variable that is to receive</span>
00141 <span class="comment">        the low limit of the memory stack.</span>
00142 <span class="comment"></span>
00143 <span class="comment">    HighStackLimit - Supplies a pointer to a variable that is to receive</span>
00144 <span class="comment">        the high limit of the memory stack.</span>
00145 <span class="comment"></span>
00146 <span class="comment">Return Value:</span>
00147 <span class="comment"></span>
00148 <span class="comment">    None.</span>
00149 <span class="comment"></span>
00150 <span class="comment">--*/</span>
00151 
00152 {
00153 
00154 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00155 <span class="preprocessor"></span>
00156     <span class="comment">//</span>
00157     <span class="comment">// Kernel Mode</span>
00158     <span class="comment">//</span>
00159 
00160     *HighStackLimit = (ULONG_PTR)PCR-&gt;InitialStack;
00161     *LowStackLimit = (ULONG_PTR)PCR-&gt;StackLimit;
00162 
00163 <span class="preprocessor">#else</span>
00164 <span class="preprocessor"></span>
00165     <span class="comment">//</span>
00166     <span class="comment">// User Mode</span>
00167     <span class="comment">//</span>
00168 
00169     PTEB CurrentTeb = NtCurrentTeb();
00170 
00171     *HighStackLimit = (ULONG_PTR)CurrentTeb-&gt;NtTib.StackBase;
00172     *LowStackLimit = (ULONG_PTR)CurrentTeb-&gt;NtTib.StackLimit;
00173 
00174 <span class="preprocessor">#endif // defined(NTOS_KERNEL_RUNTIME)</span>
00175 <span class="preprocessor"></span>}
00176 
00177 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00178"></a><a class="code" href="../../d3/d9/ntrtli64_8h.html#a0">00178</a> <a class="code" href="../../d3/d9/ntrtli64_8h.html#a0">Rtlp64GetStackLimits</a> (
00179     OUT PULONGLONG LowStackLimit,
00180     OUT PULONGLONG HighStackLimit
00181     )
00182 
00183 <span class="comment">/*++</span>
00184 <span class="comment"></span>
00185 <span class="comment">Routine Description:</span>
00186 <span class="comment"></span>
00187 <span class="comment">    This function returns the current memory stack limits based on the </span>
00188 <span class="comment">    current processor mode.</span>
00189 <span class="comment"></span>
00190 <span class="comment">Arguments:</span>
00191 <span class="comment"></span>
00192 <span class="comment">    LowStackLimit - Supplies a pointer to a variable that is to receive</span>
00193 <span class="comment">        the low limit of the memory stack.</span>
00194 <span class="comment"></span>
00195 <span class="comment">    HighStackLimit - Supplies a pointer to a variable that is to receive</span>
00196 <span class="comment">        the high limit of the memory stack.</span>
00197 <span class="comment"></span>
00198 <span class="comment">Return Value:</span>
00199 <span class="comment"></span>
00200 <span class="comment">    None.</span>
00201 <span class="comment"></span>
00202 <span class="comment">--*/</span>
00203 
00204 {
00205 
00206 <span class="preprocessor">#if defined(NTOS_KERNEL_RUNTIME)</span>
00207 <span class="preprocessor"></span>
00208     <span class="comment">//</span>
00209     <span class="comment">// Kernel Mode</span>
00210     <span class="comment">//</span>
00211 
00212     *HighStackLimit = (ULONG_PTR)PCR-&gt;InitialStack;
00213     *LowStackLimit = (ULONG_PTR)PCR-&gt;StackLimit;
00214 
00215 <span class="preprocessor">#else</span>
00216 <span class="preprocessor"></span>
00217     <span class="comment">//</span>
00218     <span class="comment">// User Mode</span>
00219     <span class="comment">//</span>
00220 
00221     PTEB CurrentTeb = NtCurrentTeb();
00222 
00223     *HighStackLimit = (ULONGLONG)CurrentTeb-&gt;NtTib.StackBase;
00224     *LowStackLimit = (ULONGLONG)CurrentTeb-&gt;NtTib.StackLimit;
00225 
00226 <span class="preprocessor">#endif // defined(NTOS_KERNEL_RUNTIME)</span>
00227 <span class="preprocessor"></span>}
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
