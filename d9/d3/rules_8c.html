<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rules.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rules.c File Reference</h1><code>#include "<a class="el" href="../../d2/d1/cmp_8h-source.html">cmp.h</a>"</code><br>
<code>#include "stdlib.h"</code><br>
<code>#include "<a class="el" href="../../d7/d2/parseini_8h-source.html">parseini.h</a>"</code><br>
<code>#include "<a class="el" href="../../d0/d0/geninst_8h-source.html">geninst.h</a>"</code><br>
<code>#include "<a class="el" href="../../d1/d3/rules_8h-source.html">rules.h</a>"</code><br>
<code>#include "<a class="el" href="../../d6/d3/acpitabl_8h-source.html">acpitabl.h</a>"</code><br>
<code>#include "<a class="el" href="../../d7/d6/ntacpi_8h-source.html">ntacpi.h</a>"</code><br>

<p>
<a href="../../d0/d3/rules_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d6/struct__PNP__BIOS__TABLE.html">_PNP_BIOS_TABLE</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a0">TABLE_ENTRIES_FROM_RSDT_POINTER</a>(p)&nbsp;&nbsp;&nbsp;(((p)-&gt;<a class="el" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.Length-min((p)-&gt;<a class="el" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.Length, sizeof(<a class="el" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>))) / 4)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a1">SYSTEM_BIOS_LENGTH</a>&nbsp;&nbsp;&nbsp;0x10000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a2">PNPBIOS_SIGNATURE</a>&nbsp;&nbsp;&nbsp;'PnP$'</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a3">NUM_OF_RULES</a>&nbsp;&nbsp;&nbsp;14</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOLEAN(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a4">PFN_RULE</a> )(IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d6/struct__PNP__BIOS__TABLE.html">_PNP_BIOS_TABLE</a> PNP_BIOS_TABLE *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a14">CmpComputeChecksum</a> (IN PCHAR Address, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a15">CmpFindRSDTTable</a> (OUT <a class="el" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">PACPI_BIOS_MULTI_NODE</a> *Rsdt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a16">CmpGetRegistryValue</a> (IN HANDLE <a class="el" href="../../d8/d3/rtvbatcr_8c.html#a3">KeyName</a>, IN PWSTR <a class="el" href="../../d8/d2/rtrenval_8c.html#a3">ValueName</a>, OUT PKEY_VALUE_PARTIAL_INFORMATION *Information)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a> (IN ULONG Signature, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a18">CmpCheckOperator</a> (IN PCHAR Operator, IN ULONG Lhs, IN ULONG Rhs)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a> (IN OUT PVOID *BaseAddress, IN ULONG Address, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a20">CmpGetInfData</a> (IN PVOID InfHandle, IN PCHAR Section, IN ULONG KeyIndex, IN ULONG LineIndex, IN OUT PCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG <a class="el" href="../../d7/d2/rtqval_8c.html#a7">BufferSize</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a21">CmpFindPattern</a> (IN PCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN ULONG BufSize, IN PCHAR <a class="el" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a>, IN ULONG PatSize, IN BOOLEAN IgnoreCase, IN ULONG Step)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a22">CmpGetPnPBIOSTableAddress</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a23">CmpMatchDescription</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a24">CmpMatchDateRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a25">CmpMatchMemoryRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a26">CmpMatchSearchRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a27">CmpMatchNextMatchRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a28">CmpMatchPointerRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a29">CmpMatchOemIdRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a30">CmpMatchPModeRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a31">CmpMatchRmPmSameRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a32">CmpMatchInstallRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a33">CmpMatchAcpiOemIdRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a34">CmpMatchAcpiOemTableIdRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a35">CmpMatchAcpiOemRevisionRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a36">CmpMatchAcpiRevisionRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a37">CmpMatchAcpiCreatorRevisionRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a38">CmpMatchInfList</a> (IN PVOID InfImage, IN ULONG ImageSize, IN PCHAR Section)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a39">CmpMatchAcpiCreatorIdRule</a> (IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;PCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d9/d3/rules_8c.html#a4">PFN_RULE</a>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d9/d3/rules_8c.html#a7">Action</a></td></tr>

<tr><td class="memItemLeft" nowrap valign=top>}&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a8">gRuleTable</a> [NUM_OF_RULES]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a10">rgzMultiFunctionAdapter</a> [] = L"\\Registry\\Machine\\Hardware\\<a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>\\System\\MultifunctionAdapter"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a11">rgzAcpiConfigurationData</a> [] = L"Configuration Data"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a12">rgzAcpiIdentifier</a> [] = L"Identifier"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/rules_8c.html#a13">rgzBIOSIdentifier</a> [] = L"ACPI BIOS"</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a3" doxytag="rules.c::NUM_OF_RULES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NUM_OF_RULES&nbsp;&nbsp;&nbsp;14          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00252">252</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00394">CmpMatchDescription()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="rules.c::PNPBIOS_SIGNATURE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PNPBIOS_SIGNATURE&nbsp;&nbsp;&nbsp;'PnP$'          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00048">48</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">CmpGetPnPBIOSTableAddress()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="rules.c::SYSTEM_BIOS_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SYSTEM_BIOS_LENGTH&nbsp;&nbsp;&nbsp;0x10000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00042">42</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rules.c::TABLE_ENTRIES_FROM_RSDT_POINTER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TABLE_ENTRIES_FROM_RSDT_POINTER          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((p)-&gt;<a class="el" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.Length-min((p)-&gt;<a class="el" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.Length, sizeof(<a class="el" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>))) / 4)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00035">35</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a4" doxytag="rules.c::PFN_RULE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOLEAN(*  <a class="el" href="../../d9/d3/rules_8c.html#a4">PFN_RULE</a>)(IN PVOID InfHandle, IN PCHAR <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, IN ULONG RuleIndex)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00052">52</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rules.c::PPNP_BIOS_TABLE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d6/struct__PNP__BIOS__TABLE.html">_PNP_BIOS_TABLE</a> PNP_BIOS_TABLE* <a class="el" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00058">58</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">CmpGetPnPBIOSTableAddress()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00957">CmpMatchOemIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01035">CmpMatchPModeRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l01104">CmpMatchRmPmSameRule()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a18" doxytag="rules.c::CmpCheckOperator" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpCheckOperator           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Operator</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Lhs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Rhs</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01927">1927</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l01540">CmpMatchAcpiCreatorRevisionRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01372">CmpMatchAcpiOemRevisionRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01456">CmpMatchAcpiRevisionRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00476">CmpMatchDateRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l00853">CmpMatchPointerRule()</a>.
<p>
<pre class="fragment"><div>01935                        :
01936 
01937         This routine tests condition specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">operator</span> by
01938         applying <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified LHS and RHS arguments.
01939 
01940     Input Parameters:
01941 
01942         Operator - Is <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">operator</span> to be tested.
01943 
01944         Lhs - Left Hand Side argument <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Operator.
01945 
01946         Rhs - Right Hand Side argument <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Operator.
01947 
01948     Return Value:
01949 
01950         True iff <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> condition Lhs Operator Rhs <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> satisfied.
01951 
01952 --*/
01953 
01954 {
01955     BOOLEAN result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01956 
01957     <span class="comment">//</span>
01958     <span class="comment">// We are pretty lenient about which operators we support.</span>
01959     <span class="comment">//</span>
01960 
01961     <span class="comment">//</span>
01962     <span class="comment">// "=" or "==" for EQUAL.</span>
01963     <span class="comment">//</span>
01964 
01965     <span class="keywordflow">if</span> (strcmp(Operator, <span class="stringliteral">"="</span>) == 0 || strcmp(Operator, <span class="stringliteral">"=="</span>) == 0)
01966     {
01967         result = (Lhs == Rhs);
01968     }
01969 
01970     <span class="comment">//</span>
01971     <span class="comment">// "!=" or "=!" or "&lt;&gt;" for NOT EQUAL.</span>
01972     <span class="comment">//</span>
01973 
01974     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(    strcmp(Operator, <span class="stringliteral">"!="</span>) == 0 ||
01975                 strcmp(Operator, <span class="stringliteral">"&lt;&gt;"</span>) == 0 ||
01976                 strcmp(Operator, <span class="stringliteral">"=!"</span>) == 0)
01977     {
01978         result = (Lhs != Rhs);
01979     }
01980 
01981     <span class="comment">//</span>
01982     <span class="comment">// "&lt;" for LESS THAN.</span>
01983     <span class="comment">//</span>
01984 
01985     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(Operator, <span class="stringliteral">"&lt;"</span>) == 0)
01986     {
01987         result = (Lhs &lt; Rhs);
01988     }
01989 
01990     <span class="comment">//</span>
01991     <span class="comment">// "&lt;=" or "=&lt;" for LESS THAN or EQUAL.</span>
01992     <span class="comment">//</span>
01993 
01994     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(Operator, <span class="stringliteral">"&lt;="</span>) == 0 || strcmp(Operator, <span class="stringliteral">"=&lt;"</span>) == 0)
01995     {
01996         result = (Lhs &lt;= Rhs);
01997     }
01998 
01999     <span class="comment">//</span>
02000     <span class="comment">// "&gt;" for GREATER THAN.</span>
02001     <span class="comment">//</span>
02002 
02003     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(Operator, <span class="stringliteral">"&gt;"</span>) == 0)
02004     {
02005         result = (Lhs &gt; Rhs);
02006     }
02007 
02008     <span class="comment">//</span>
02009     <span class="comment">// "&gt;=" or "=&gt;" for GREATER THAN or EQUAL.</span>
02010     <span class="comment">//</span>
02011 
02012     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(Operator, <span class="stringliteral">"&gt;="</span>) == 0 || strcmp(Operator, <span class="stringliteral">"=&gt;"</span>) == 0)
02013     {
02014         result = (Lhs &gt;= Rhs);
02015     }
02016     <span class="keywordflow">else</span>
02017     {
02018         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Invalid operator %s used!\n"</span>, Operator);
02019     }
02020 
02021     <span class="keywordflow">return</span> (result);
02022 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="rules.c::CmpComputeChecksum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG CmpComputeChecksum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Address</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="rules.c::CmpFindACPITable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> CmpFindACPITable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Signature</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">2173</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d4/acpitabl_8h.html#a79">DESCRIPTION_HEADER</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00119">_FADT::dsdt</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00373">DSDT_SIGNATURE</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00113">FADT_SIGNATURE</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00052">_DESCRIPTION_HEADER::Length</a>, <a class="el" href="../../d4/d9/ke_8h.html#a413a249">MmCached</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03415">MmMapIoSpace()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00164">PFADT</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00357">PRSDT</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00348">RSDT_SIGNATURE</a>, <a class="el" href="../../d7/d6/ntacpi_8h-source.html#l00320">_ACPI_BIOS_MULTI_NODE::RsdtAddress</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00051">_DESCRIPTION_HEADER::Signature</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00035">TABLE_ENTRIES_FROM_RSDT_POINTER</a>, and <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00353">_RSDT::Tables</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l01623">CmpMatchAcpiCreatorIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01540">CmpMatchAcpiCreatorRevisionRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01171">CmpMatchAcpiOemIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01372">CmpMatchAcpiOemRevisionRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01288">CmpMatchAcpiOemTableIdRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l01456">CmpMatchAcpiRevisionRule()</a>.
<p>
<pre class="fragment"><div>02177 {
02178     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a>     header      = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02179     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a>     tempHeader  = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02180     <span class="keyword">static</span> PHYSICAL_ADDRESS rsdtAddress = { -1, -1 };
02181     ULONG                   length      = 0;
02182 
02183     <span class="comment">//</span>
02184     <span class="comment">// Use the cached location of RSDT address if available.</span>
02185     <span class="comment">//</span>
02186     <span class="keywordflow">if</span> (rsdtAddress.QuadPart == -1) {
02187 
02188         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                status;
02189         <a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">PACPI_BIOS_MULTI_NODE</a>   rsdpMulti;
02190 
02191         rsdtAddress.QuadPart = 0;
02192         <span class="comment">//</span>
02193         <span class="comment">// Get the multinode</span>
02194         <span class="comment">//</span>
02195         status = <a class="code" href="../../d9/d3/rules_8c.html#a15">CmpFindRSDTTable</a>( &amp;rsdpMulti );
02196         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02197 
02198             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02199 
02200         }
02201 
02202         <span class="comment">//</span>
02203         <span class="comment">// Map the address</span>
02204         <span class="comment">//</span>
02205         rsdtAddress.LowPart = rsdpMulti-&gt;<a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html#o0">RsdtAddress</a>.LowPart;
02206         rsdtAddress.HighPart = rsdpMulti-&gt;<a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html#o0">RsdtAddress</a>.HighPart;
02207 
02208         <span class="comment">//</span>
02209         <span class="comment">// Done with the multinode</span>
02210         <span class="comment">//</span>
02211         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( rsdpMulti );
02212 
02213     }
02214 
02215     <span class="comment">//</span>
02216     <span class="comment">// If we have an address</span>
02217     <span class="comment">//</span>
02218     <span class="keywordflow">if</span> (rsdtAddress.QuadPart) {
02219 
02220         <span class="comment">//</span>
02221         <span class="comment">// Map in the the rsdt table</span>
02222         <span class="comment">//</span>
02223         tempHeader = <a class="code" href="../../d5/d6/iosup_8c.html#a57">MmMapIoSpace</a>(
02224             rsdtAddress,
02225             <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>),
02226             MmCached
02227             );
02228         <span class="keywordflow">if</span> (tempHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02229 
02230             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpFindACPITable: Cannot map RSDT at %I64x\n"</span>, rsdtAddress.QuadPart);
02231             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02232 
02233         }
02234 
02235         <span class="comment">//</span>
02236         <span class="comment">// If what we are looking for is the RSDT, then we are done</span>
02237         <span class="comment">//</span>
02238         <span class="keywordflow">if</span> (Signature == <a class="code" href="../../d5/d4/acpitabl_8h.html#a68">RSDT_SIGNATURE</a>) {
02239 
02240             header = tempHeader;
02241             length = <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>);
02242 
02243         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Signature == <a class="code" href="../../d5/d4/acpitabl_8h.html#a72">DSDT_SIGNATURE</a>) {
02244 
02245             <a class="code" href="../../d4/d9/struct__FADT.html">PFADT</a>               fadt;
02246             PHYSICAL_ADDRESS    dsdtAddress;
02247             ULONG               tempLength;
02248 
02249             fadt = (<a class="code" href="../../d4/d9/struct__FADT.html">PFADT</a>) <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>( FADT_SIGNATURE, &amp;length );
02250             <span class="keywordflow">if</span> (fadt) {
02251 
02252                 dsdtAddress.HighPart = 0;
02253                 dsdtAddress.LowPart = fadt-&gt;<a class="code" href="../../d4/d9/struct__FADT.html#o2">dsdt</a>;
02254 
02255                 <span class="comment">//</span>
02256                 <span class="comment">// Done with the FADT</span>
02257                 <span class="comment">//</span>
02258                 <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( fadt, length );
02259 
02260                 <span class="comment">//</span>
02261                 <span class="comment">// Map in the dsdt table</span>
02262                 <span class="comment">//</span>
02263                 header = <a class="code" href="../../d5/d6/iosup_8c.html#a57">MmMapIoSpace</a>(
02264                     dsdtAddress,
02265                     <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>),
02266                     MmCached
02267                     );
02268                 <span class="keywordflow">if</span> (header == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02269 
02270                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(
02271                         <span class="stringliteral">"CmpFindACPITable: Cannot map DSDT at %I64x\n"</span>,
02272                         dsdtAddress.QuadPart
02273                         );
02274                     <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( tempHeader, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>) );
02275                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02276 
02277                 }
02278                 length = <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>);
02279 
02280             } <span class="keywordflow">else</span> {
02281 
02282                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpFindACPITable: Cannot find FADT\n"</span>);
02283                 <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( tempHeader, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>) );
02284                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02285 
02286             }
02287 
02288         } <span class="keywordflow">else</span> {
02289 
02290             PHYSICAL_ADDRESS    tableAddress;
02291             <a class="code" href="../../d1/d5/struct__RSDT.html">PRSDT</a>               rsdt;
02292             ULONG               i;
02293             ULONG               num;
02294             ULONG               rsdtLength;
02295 
02296             <span class="comment">//</span>
02297             <span class="comment">// Map in the entire RSDT</span>
02298             <span class="comment">//</span>
02299             rsdtLength = tempHeader-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o1">Length</a>;
02300             rsdt = (<a class="code" href="../../d1/d5/struct__RSDT.html">PRSDT</a>) <a class="code" href="../../d5/d6/iosup_8c.html#a57">MmMapIoSpace</a>( rsdtAddress, rsdtLength, MmCached );
02301             <span class="keywordflow">if</span> (rsdt == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02302 
02303                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(
02304                     <span class="stringliteral">"CmpFindACPITable: Cannot map RSDT at %I64x\n"</span>,
02305                     rsdtAddress.QuadPart
02306                     );
02307                 <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( tempHeader, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>) );
02308                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02309 
02310             }
02311 
02312             <span class="comment">//</span>
02313             <span class="comment">// Done with the temp header</span>
02314             <span class="comment">//</span>
02315             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( tempHeader, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>) );
02316 
02317             <span class="comment">//</span>
02318             <span class="comment">// Look at all the table entries for the header that we care about</span>
02319             <span class="comment">//</span>
02320             num = <a class="code" href="../../d9/d3/rules_8c.html#a0">TABLE_ENTRIES_FROM_RSDT_POINTER</a>( rsdt );
02321             <span class="keywordflow">for</span> (i = 0; i &lt; num ; i ++) {
02322 
02323                 <span class="comment">//</span>
02324                 <span class="comment">// Get the address of the table</span>
02325                 <span class="comment">//</span>
02326                 tableAddress.HighPart = 0;
02327                 tableAddress.LowPart = rsdt-&gt;<a class="code" href="../../d1/d5/struct__RSDT.html#o1">Tables</a>[i];
02328 
02329                 <span class="comment">//</span>
02330                 <span class="comment">// Map in the header</span>
02331                 <span class="comment">//</span>
02332                 tempHeader = <a class="code" href="../../d5/d6/iosup_8c.html#a57">MmMapIoSpace</a>(
02333                     tableAddress,
02334                     <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>),
02335                     MmCached
02336                     );
02337                 <span class="keywordflow">if</span> (!tempHeader) {
02338 
02339                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(
02340                         <span class="stringliteral">"CmpFindACPITable: Cannot map header at %I64x\n"</span>,
02341                         tableAddress.QuadPart
02342                         );
02343                     <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( rsdt, rsdtLength );
02344                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02345 
02346                 }
02347 
02348                 <span class="comment">//</span>
02349                 <span class="comment">// Signature check</span>
02350                 <span class="comment">//</span>
02351                 <span class="keywordflow">if</span> (tempHeader-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o0">Signature</a> != Signature) {
02352 
02353                     <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( tempHeader, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>) );
02354                     <span class="keywordflow">continue</span>;
02355 
02356                 }
02357 
02358                 <span class="comment">//</span>
02359                 <span class="comment">// Are we looking at the FADT?</span>
02360                 <span class="comment">//</span>
02361                 <span class="keywordflow">if</span> (Signature == <a class="code" href="../../d5/d4/acpitabl_8h.html#a17">FADT_SIGNATURE</a>) {
02362 
02363                     <span class="comment">//</span>
02364                     <span class="comment">// Map the entire table for this one</span>
02365                     <span class="comment">//</span>
02366                     length = tempHeader-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o1">Length</a>;
02367                     header = <a class="code" href="../../d5/d6/iosup_8c.html#a57">MmMapIoSpace</a>( tableAddress, length, MmCached );
02368 
02369                     <span class="comment">//</span>
02370                     <span class="comment">// Unmap the old table</span>
02371                     <span class="comment">//</span>
02372                     <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( tempHeader, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>) );
02373 
02374                     <span class="comment">//</span>
02375                     <span class="comment">// Did we successfully map the header?</span>
02376                     <span class="comment">//</span>
02377                     <span class="keywordflow">if</span> (header == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02378 
02379                         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(
02380                             <span class="stringliteral">"CmpFindACPITable: Cannot map FADT at %I64x\n"</span>,
02381                             tableAddress.QuadPart
02382                             );
02383                         <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( rsdt, rsdtLength );
02384                         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02385 
02386                     }
02387 
02388                 } <span class="keywordflow">else</span> {
02389 
02390                     <span class="comment">//</span>
02391                     <span class="comment">// Remember where the table and length are stored</span>
02392                     <span class="comment">//</span>
02393                     length = <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">DESCRIPTION_HEADER</a>);
02394                     header = tempHeader;
02395 
02396                 }
02397 
02398             } <span class="comment">// for</span>
02399 
02400             <span class="comment">//</span>
02401             <span class="comment">// Done with the rsdt</span>
02402             <span class="comment">//</span>
02403             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( rsdt, rsdtLength );
02404 
02405         }
02406 
02407         <span class="comment">//</span>
02408         <span class="comment">// If we found the table, return its length.</span>
02409         <span class="comment">//</span>
02410         <span class="keywordflow">if</span> (Length) {
02411 
02412             <span class="keywordflow">if</span> (header) {
02413 
02414                 *Length = length;
02415 
02416             } <span class="keywordflow">else</span> {
02417 
02418                 *Length = 0;
02419 
02420             }
02421 
02422         }
02423 
02424     }
02425 
02426     <span class="keywordflow">return</span> (header);
02427 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="rules.c::CmpFindPattern" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID CmpFindPattern           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BufSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Pattern</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PatSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IgnoreCase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Step</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l02025">2025</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d4/localrtl_8c-source.html#l00032">Pattern</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00666">CmpMatchSearchRule()</a>.
<p>
<pre class="fragment"><div>02036                        :
02037 
02038         This routine searches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified pattern of data.
02039 
02040     Input Parameters:
02041 
02042         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> to be searched.
02043 
02044         BufSize - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> of <span class="keyword">this</span> buffer.
02045 
02046         <a class="code" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a> - <a class="code" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a> to be searched.
02047 
02048         PatSize - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pattern.
02049 
02050         IgnoreCase - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> search <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be <span class="keywordflow">case</span> insensitive.
02051 
02052     Return Value:
02053 
02054         Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pattern <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> first found.
02055 
02056 --*/
02057 
02058 {
02059     PCHAR   bufEnd;
02060 
02061     <span class="keywordflow">if</span> (PatSize &gt; BufSize)
02062     {
02063         <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02064     }
02065 
02066     <span class="keywordflow">if</span> (PatSize == 0)
02067     {
02068         PatSize = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Pattern);
02069     }
02070 
02071     <span class="keywordflow">if</span> (Step == 0)
02072     {
02073         Step = 1;
02074     }
02075 
02076     <span class="keywordflow">for</span> (   bufEnd = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> + BufSize;
02077             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> + PatSize &lt; bufEnd;
02078             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> += Step)
02079     {
02080         <span class="keywordflow">if</span> (IgnoreCase)
02081         {
02082             <span class="keywordflow">if</span> (_strnicmp(Buffer, Pattern, PatSize) == 0)
02083             {
02084                 <span class="keywordflow">return</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>);
02085             }
02086         }
02087         <span class="keywordflow">else</span>
02088         {
02089             <span class="keywordflow">if</span> (strncmp(Buffer, Pattern, PatSize) == 0)
02090             {
02091                 <span class="keywordflow">return</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>);
02092             }
02093         }
02094     }
02095 
02096     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02097  }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="rules.c::CmpFindRSDTTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpFindRSDTTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">PACPI_BIOS_MULTI_NODE</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Rsdt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">2430</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l02635">CmpGetRegistryValue()</a>, <a class="el" href="../../d7/d6/ntacpi_8h-source.html#l00321">_ACPI_BIOS_MULTI_NODE::Count</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00282">rgzAcpiConfigurationData</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00283">rgzAcpiIdentifier</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00284">rgzBIOSIdentifier</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00281">rgzMultiFunctionAdapter</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01608">RtlEqualUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00433">RtlIntegerToUnicodeString()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>.
<p>
<pre class="fragment"><div>02435                    :
02436 
02437     This function looks into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry to find <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACPI <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a>,
02438     which was stored there by ntdetect.com
02439 
02440 Arguments:
02441 
02442     RsdtPtr - Pointer to a buffer that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACPI
02443               Root System <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> Pointer Structure.
02444               The caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> responsible <span class="keywordflow">for</span> freeing <span class="keyword">this</span>
02445               buffer.  Note:  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned in non-paged
02446               <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
02447 
02448 Return Value:
02449 
02450     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> code to indicate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initialization.
02451 
02452 --*/
02453 {
02454     BOOLEAN                         same;
02455     HANDLE                          hMFunc;
02456     HANDLE                          hBus;
02457     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status;
02458     OBJECT_ATTRIBUTES               objectAttributes;
02459     <a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">PACPI_BIOS_MULTI_NODE</a>           multiNode;
02460     PCM_PARTIAL_RESOURCE_DESCRIPTOR prd;
02461     PCM_PARTIAL_RESOURCE_LIST       prl;
02462     PKEY_VALUE_PARTIAL_INFORMATION  valueInfo;
02463     PWSTR                           p;
02464     ULONG                           i;
02465     ULONG                           length;
02466     ULONG                           multiNodeSize;
02467     UNICODE_STRING                  unicodeString;
02468     UNICODE_STRING                  unicodeValueName;
02469     UNICODE_STRING                  biosId;
02470     WCHAR                           wbuffer[10];
02471 
02472     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02473 
02474     <span class="comment">//</span>
02475     <span class="comment">// Look in the registry for the "ACPI BIOS bus" data</span>
02476     <span class="comment">//</span>
02477     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;unicodeString, rgzMultiFunctionAdapter );
02478     InitializeObjectAttributes(
02479         &amp;objectAttributes,
02480         &amp;unicodeString,
02481         OBJ_CASE_INSENSITIVE,
02482         NULL,       <span class="comment">// handle</span>
02483         NULL
02484         );
02485     status = ZwOpenKey( &amp;hMFunc, KEY_READ, &amp;objectAttributes );
02486     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02487 
02488         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpFindRSDTTable: Cannot open MultifunctionAdapter registry key.\n"</span>);
02489         <span class="keywordflow">return</span> status;
02490 
02491     }
02492 
02493     <span class="comment">//</span>
02494     <span class="comment">// We will need to make a unicode string that we can use to enumerate</span>
02495     <span class="comment">// the subkeys of the MFA key</span>
02496     <span class="comment">//</span>
02497     unicodeString.Buffer = wbuffer;
02498     unicodeString.MaximumLength = <span class="keyword">sizeof</span>(wbuffer);
02499     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;biosId, rgzBIOSIdentifier );
02500 
02501     <span class="comment">//</span>
02502     <span class="comment">// Loop over all subkeys</span>
02503     <span class="comment">//</span>
02504     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; i++) {
02505 
02506         <span class="comment">//</span>
02507         <span class="comment">// Turn the number into a key name</span>
02508         <span class="comment">//</span>
02509         <a class="code" href="../../d9/d3/cnvint_8c.html#a6">RtlIntegerToUnicodeString</a>( i, 10, &amp;unicodeString);
02510         InitializeObjectAttributes(
02511             &amp;objectAttributes,
02512             &amp;unicodeString,
02513             OBJ_CASE_INSENSITIVE,
02514             hMFunc,
02515             NULL
02516             );
02517 
02518         <span class="comment">//</span>
02519         <span class="comment">// Open the named subkey</span>
02520         <span class="comment">//</span>
02521         status = ZwOpenKey( &amp;hBus, KEY_READ, &amp;objectAttributes );
02522         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02523 
02524             <span class="comment">//</span>
02525             <span class="comment">// Out of Multifunction adapter entries...</span>
02526             <span class="comment">//</span>
02527             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpFindRSDTTable: ACPI BIOS MultifunctionAdapter registry key not found.\n"</span>);
02528             ZwClose (hMFunc);
02529             <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
02530 
02531         }
02532 
02533         <span class="comment">//</span>
02534         <span class="comment">// Check the Indentifier to see if this is an ACPI BIOS entry</span>
02535         <span class="comment">//</span>
02536         status = <a class="code" href="../../d9/d3/rules_8c.html#a16">CmpGetRegistryValue</a>( hBus, rgzAcpiIdentifier, &amp;valueInfo );
02537         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a> (status)) {
02538 
02539             ZwClose( hBus );
02540             <span class="keywordflow">continue</span>;
02541 
02542         }
02543 
02544         p = (PWSTR) ((PUCHAR) valueInfo-&gt;Data);
02545         unicodeValueName.Buffer = p;
02546         unicodeValueName.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)valueInfo-&gt;DataLength;
02547         length = valueInfo-&gt;DataLength;
02548 
02549         <span class="comment">//</span>
02550         <span class="comment">// Determine the real length of the ID string</span>
02551         <span class="comment">//</span>
02552         <span class="keywordflow">while</span> (length) {
02553 
02554             <span class="keywordflow">if</span> (p[length / <span class="keyword">sizeof</span>(WCHAR) - 1] == UNICODE_NULL) {
02555 
02556                 length -= 2;
02557 
02558             } <span class="keywordflow">else</span> {
02559 
02560                 <span class="keywordflow">break</span>;
02561             }
02562 
02563         }
02564 
02565         <span class="comment">//</span>
02566         <span class="comment">// Do we have a match the "ACPI BIOS" identifier?</span>
02567         <span class="comment">//</span>
02568         unicodeValueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)length;
02569         same = <a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a>( &amp;biosId, &amp;unicodeValueName, TRUE );
02570         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueInfo );
02571         <span class="keywordflow">if</span> (!same) {
02572 
02573             ZwClose( hBus );
02574             <span class="keywordflow">continue</span>;
02575 
02576         }
02577 
02578         <span class="comment">//</span>
02579         <span class="comment">// We do, so get the configuration data</span>
02580         <span class="comment">//</span>
02581         status = <a class="code" href="../../d9/d3/rules_8c.html#a16">CmpGetRegistryValue</a>(
02582             hBus,
02583             rgzAcpiConfigurationData,
02584             &amp;valueInfo
02585             );
02586         ZwClose( hBus );
02587         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02588 
02589             <span class="keywordflow">continue</span> ;
02590 
02591         }
02592 
02593         <span class="comment">//</span>
02594         <span class="comment">// The data that we want is at the end of the PARTIAL_RESOURCE_LIST</span>
02595         <span class="comment">// descriptor</span>
02596         <span class="comment">//</span>
02597         prl = (PCM_PARTIAL_RESOURCE_LIST)(valueInfo-&gt;Data);
02598         prd = &amp;prl-&gt;PartialDescriptors[0];
02599         multiNode = (<a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">PACPI_BIOS_MULTI_NODE</a>)
02600             ( (PCHAR) prd + <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_LIST) );
02601         <span class="keywordflow">break</span>;
02602 
02603     }
02604 
02605     <span class="comment">//</span>
02606     <span class="comment">// Calculate the size of the data so that we can make a copy</span>
02607     <span class="comment">//</span>
02608     multiNodeSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">ACPI_BIOS_MULTI_NODE</a>) +
02609         ( (ULONG)(multiNode-&gt;<a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html#o1">Count</a> - 1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d0/structACPI__E820__ENTRY.html">ACPI_E820_ENTRY</a>) );
02610     *Rsdt = (<a class="code" href="../../d4/d5/struct__ACPI__BIOS__MULTI__NODE.html">PACPI_BIOS_MULTI_NODE</a>) <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
02611         NonPagedPool,
02612         multiNodeSize,
02613         'IPCA'
02614         );
02615     <span class="keywordflow">if</span> (*Rsdt == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02616 
02617         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueInfo );
02618         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
02619 
02620     }
02621     RtlCopyMemory(*Rsdt, multiNode, multiNodeSize);
02622 
02623     <span class="comment">//</span>
02624     <span class="comment">// Done with the key memory</span>
02625     <span class="comment">//</span>
02626     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(valueInfo);
02627 
02628     <span class="comment">//</span>
02629     <span class="comment">// Done</span>
02630     <span class="comment">//</span>
02631     <span class="keywordflow">return</span> STATUS_SUCCESS;
02632 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="rules.c::CmpGetInfData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpGetInfData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LineIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BufferSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">1703</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00076">type</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00569">CmpMatchMemoryRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00764">CmpMatchNextMatchRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01035">CmpMatchPModeRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00853">CmpMatchPointerRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l00666">CmpMatchSearchRule()</a>.
<p>
<pre class="fragment"><div>01714                        :
01715 
01716         This routine reads and parses data from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf. It understands
01717         two kinds of data 1. <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> 2. Binary.
01718 
01719         Examples-
01720 
01721         B,02 - byte 0x02
01722         B,72,0<a class="code" href="../../d2/d0/imemenu_8c.html#a0">D</a>,FF,0F - sequence of bytes 0x72 0x0D 0xFF 0x0F or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> 0x0FFF0D72
01723         S,COMPAQ - ASCII string <span class="stringliteral">"COMPAQ"</span>
01724 
01725     Input Parameters:
01726 
01727         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
01728 
01729         Section - Section name to be read.
01730 
01731         LineIndex - <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> line in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Section to be read.
01732 
01733         ValueIndex - First value to be read on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LineIndex.
01734 
01735         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Parsed data gets returned in <span class="keyword">this</span> buffer.
01736 
01737         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> - On entry, contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>.
01738         The number of bytes parsed in gets returned in <span class="keyword">this</span>
01739         variable.
01740 
01741     Return Value:
01742 
01743         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff data was parsed in successfully. Else <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
01744 
01745 --*/
01746 
01747 {
01748     BOOLEAN result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01749     ULONG   cbData;
01750     PCHAR   data;
01751     ULONG   remainingBytes;
01752 
01753     <span class="comment">//</span>
01754     <span class="comment">// Validate input parameters.</span>
01755     <span class="comment">//</span>
01756 
01757     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &amp;&amp; <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> &amp;&amp; *<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>)
01758     {
01759         <span class="comment">//</span>
01760         <span class="comment">// Read in the data type "S" or "B".</span>
01761         <span class="comment">//</span>
01762 
01763         PCHAR <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Section, LineIndex, ValueIndex++);
01764         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>)
01765         {
01766             <span class="comment">//</span>
01767             <span class="comment">// Initialize local data.</span>
01768             <span class="comment">//</span>
01769 
01770             remainingBytes = *<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01771 
01772             <span class="comment">//</span>
01773             <span class="comment">// Process Binary data.</span>
01774             <span class="comment">//</span>
01775 
01776             <span class="keywordflow">if</span> (_stricmp(type, <span class="stringliteral">"B"</span>) == 0)
01777             {
01778 
01779                 <span class="comment">//</span>
01780                 <span class="comment">// Parse data as long as there is more data and the buffer is not full.</span>
01781                 <span class="comment">//</span>
01782 
01783                 <span class="keywordflow">for</span> (result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; result == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> &amp;&amp; remainingBytes; remainingBytes--)
01784                 {
01785                     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    value;
01786 
01787                     <span class="comment">//</span>
01788                     <span class="comment">// Read in the data.</span>
01789                     <span class="comment">//</span>
01790 
01791                     data = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Section, LineIndex, ValueIndex++);
01792                     <span class="keywordflow">if</span> (data)
01793                     {
01794                         <span class="comment">//</span>
01795                         <span class="comment">// Convert the data read in and validate that is indeed a HEX value.</span>
01796                         <span class="comment">//</span>
01797 
01798                         value = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)strtoul(data, NULL, 16);
01799                         <span class="keywordflow">if</span> (value == 0 &amp;&amp; strcmp(data, <span class="stringliteral">"00"</span>) &amp;&amp; strcmp(data, <span class="stringliteral">"0"</span>))
01800                         {
01801                             result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01802                         }
01803                         <span class="keywordflow">else</span>
01804                         {
01805                             *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = value;
01806                         }
01807                     }
01808                     <span class="keywordflow">else</span>
01809                     {
01810                         <span class="keywordflow">break</span>;
01811                     }
01812                 }
01813 
01814                 <span class="comment">//</span>
01815                 <span class="comment">// Return the number of bytes parsed in.</span>
01816                 <span class="comment">//</span>
01817 
01818                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> -= remainingBytes;
01819             }
01820 
01821             <span class="comment">//</span>
01822             <span class="comment">// Process String data.</span>
01823             <span class="comment">//</span>
01824 
01825             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(_stricmp(type, <span class="stringliteral">"S"</span>) == 0)
01826             {
01827                 <span class="comment">//</span>
01828                 <span class="comment">// Read in the string.</span>
01829                 <span class="comment">//</span>
01830 
01831                 data = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Section, LineIndex, ValueIndex);
01832 
01833                 <span class="comment">//</span>
01834                 <span class="comment">// Only copy as much data as the buffer can hold.</span>
01835                 <span class="comment">//</span>
01836 
01837                 cbData = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(remainingBytes, <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(data));
01838                 RtlCopyBytes(Buffer, data, cbData);
01839 
01840                 <span class="comment">//</span>
01841                 <span class="comment">// Return the number of bytes actually copied.</span>
01842                 <span class="comment">//</span>
01843 
01844                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> = cbData;
01845                 result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01846             }
01847         }
01848     }
01849 
01850     <span class="keywordflow">return</span> (result);
01851 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="rules.c::CmpGetPnPBIOSTableAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG CmpGetPnPBIOSTableAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">2100</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00048">PNPBIOS_SIGNATURE</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00058">PPNP_BIOS_TABLE</a>, and <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00070">SYSTEM_BIOS_LENGTH</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00957">CmpMatchOemIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01035">CmpMatchPModeRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l01104">CmpMatchRmPmSameRule()</a>.
<p>
<pre class="fragment"><div>02106                        :
02107 
02108         This routine searches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS ROM <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS installation
02109         structure.
02110 
02111     Input Parameters:
02112 
02113         None.
02114 
02115     Return Value:
02116 
02117         Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ROM BIOS where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP
02118         BIOS structure <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> located.
02119 
02120 --*/
02121 
02122 {
02123     <span class="keyword">static</span> ULONG    tableAddress = (ULONG)-1;
02124     PVOID           baseAddress;
02125     <a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a> address;
02126     <a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a> lastAddress;
02127     ULONG           i;
02128     ULONG           checksum;
02129 
02130     <span class="keywordflow">if</span> (tableAddress == (ULONG)-1)
02131     {
02132         <span class="comment">//</span>
02133         <span class="comment">// Search for the PnPBIOS structure in the BIOS ROM.</span>
02134         <span class="comment">//</span>
02135 
02136         address = (<a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a>)<a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, 0xF0000, SYSTEM_BIOS_LENGTH);
02137         <span class="keywordflow">if</span> (address)
02138         {
02139             <span class="keywordflow">for</span> (   lastAddress = (<a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a>)((PCHAR)address + <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a4">SYSTEM_BIOS_LENGTH</a> - 0x10);
02140                     address &lt; lastAddress;
02141                     (PCHAR)address += 0x10)
02142             {
02143                 <span class="keywordflow">if</span> (address-&gt;Signature == <a class="code" href="../../d9/d3/rules_8c.html#a2">PNPBIOS_SIGNATURE</a>)
02144                 {
02145                     <span class="keywordflow">for</span> (   i = 0, checksum = 0;
02146                             i &lt; address-&gt;Length;
02147                             i++)
02148                     {
02149                         checksum += ((PUCHAR)address)[i];
02150                     }
02151 
02152                     <span class="keywordflow">if</span> (    (checksum &amp; 0xFF) == 0 &amp;&amp;
02153                             address-&gt;Length &gt;= 0x21)
02154                     {
02155                         tableAddress = 0xF0000 + (<a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a4">SYSTEM_BIOS_LENGTH</a> - 10) - ((PCHAR)lastAddress - (PCHAR)address);
02156                         <span class="keywordflow">break</span>;
02157                     }
02158                 }
02159             }
02160 
02161             <span class="comment">//</span>
02162             <span class="comment">// Unmap the physical address.</span>
02163             <span class="comment">//</span>
02164 
02165             ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
02166         }
02167     }
02168 
02169     <span class="keywordflow">return</span> (tableAddress);
02170 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="rules.c::CmpGetRegistryValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpGetRegistryValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKEY_VALUE_PARTIAL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>Information</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l02635">2635</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>.
<p>
<pre class="fragment"><div>02642                    :
02643 
02644     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invoked to retrieve <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data <span class="keywordflow">for</span> a registry key's value.
02645     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done by querying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key with a zero-length buffer
02646     to determine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value, and then allocating a buffer and
02647     actually querying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer.
02648 
02649     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> responsibility of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer.
02650 
02651 Arguments:
02652 
02653     KeyHandle - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key handle whose value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be queried
02654 
02655     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> null-terminated <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value.
02656 
02657     Information - Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated data buffer.
02658 
02659 Return Value:
02660 
02661     The function value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query operation.
02662 
02663 --*/
02664 
02665 {
02666     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status;
02667     PKEY_VALUE_PARTIAL_INFORMATION  infoBuffer;
02668     ULONG                           keyValueLength;
02669     UNICODE_STRING                  unicodeString;
02670 
02671     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02672 
02673     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;unicodeString, ValueName );
02674 
02675     <span class="comment">//</span>
02676     <span class="comment">// Figure out how big the data value is so that a buffer of the</span>
02677     <span class="comment">// appropriate size can be allocated.</span>
02678     <span class="comment">//</span>
02679     status = ZwQueryValueKey(
02680         KeyHandle,
02681         &amp;unicodeString,
02682         KeyValuePartialInformation,
02683         (PVOID) NULL,
02684         0,
02685         &amp;keyValueLength
02686         );
02687     <span class="keywordflow">if</span> (status != STATUS_BUFFER_OVERFLOW &amp;&amp;
02688         status != STATUS_BUFFER_TOO_SMALL) {
02689 
02690         <span class="keywordflow">return</span> status;
02691 
02692     }
02693 
02694     <span class="comment">//</span>
02695     <span class="comment">// Allocate a buffer large enough to contain the entire key data value.</span>
02696     <span class="comment">//</span>
02697     infoBuffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
02698         NonPagedPool,
02699         keyValueLength,
02700         'IPCA'
02701         );
02702     <span class="keywordflow">if</span> (!infoBuffer) {
02703 
02704         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
02705 
02706     }
02707 
02708     <span class="comment">//</span>
02709     <span class="comment">// Query the data for the key value.</span>
02710     <span class="comment">//</span>
02711     status = ZwQueryValueKey(
02712         KeyHandle,
02713         &amp;unicodeString,
02714         KeyValuePartialInformation,
02715         infoBuffer,
02716         keyValueLength,
02717         &amp;keyValueLength
02718         );
02719     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
02720 
02721         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( infoBuffer );
02722 
02723         <span class="keywordflow">return</span> status;
02724 
02725     }
02726 
02727     <span class="comment">//</span>
02728     <span class="comment">// Everything worked, so simply return the address of the allocated</span>
02729     <span class="comment">// buffer to the caller, who is now responsible for freeing it.</span>
02730     <span class="comment">//</span>
02731     *Information = infoBuffer;
02732     <span class="keywordflow">return</span> STATUS_SUCCESS;
02733 
02734 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="rules.c::CmpMapPhysicalAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID CmpMapPhysicalAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Address</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">1854</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">CmpGetPnPBIOSTableAddress()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00476">CmpMatchDateRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00569">CmpMatchMemoryRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00764">CmpMatchNextMatchRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00957">CmpMatchOemIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01035">CmpMatchPModeRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00853">CmpMatchPointerRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01104">CmpMatchRmPmSameRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l00666">CmpMatchSearchRule()</a>.
<p>
<pre class="fragment"><div>01862                        :
01863 
01864         This routine maps <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified physical segment into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process
01865         <span class="keyword">virtual</span> memory.
01866 
01867     Input Parameters:
01868 
01869         Segment - Segment to be mapped.
01870 
01871         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - Segment size to be mapped.
01872 
01873     Return Value:
01874 
01875         <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> address <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapped segment.
01876 
01877 --*/
01878 
01879 {
01880     UNICODE_STRING      sectionName;
01881     OBJECT_ATTRIBUTES   objectAttributes;
01882     HANDLE              sectionHandle;
01883     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
01884     PVOID               baseAddress;
01885     ULONG               viewSize;
01886     LARGE_INTEGER       viewBase;
01887     PVOID               ptr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01888 
01889     *BaseAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01890 
01891     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;sectionName, L<span class="stringliteral">"\\Device\\PhysicalMemory"</span>);
01892     InitializeObjectAttributes( &amp;objectAttributes,
01893                                 &amp;sectionName,
01894                                 OBJ_CASE_INSENSITIVE,
01895                                 (HANDLE)NULL,
01896                                 (PSECURITY_DESCRIPTOR)NULL);
01897     status = ZwOpenSection( &amp;sectionHandle,
01898                             SECTION_MAP_READ,
01899                             &amp;objectAttributes);
01900     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01901     {
01902         baseAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01903         viewSize = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01904         viewBase.LowPart = Address &amp; ~(0xFFF);
01905         viewBase.HighPart = 0;
01906         status = ZwMapViewOfSection(    sectionHandle,
01907                                         NtCurrentProcess(),
01908                                         &amp;baseAddress,
01909                                         0,
01910                                         viewSize,
01911                                         &amp;viewBase,
01912                                         &amp;viewSize,
01913                                         ViewUnmap,
01914                                         MEM_DOS_LIM,
01915                                         PAGE_READWRITE);
01916         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))
01917         {
01918             ptr = (PVOID)((PCHAR)baseAddress + (Address &amp; 0xFFF));
01919             *BaseAddress = baseAddress;
01920         }
01921     }
01922 
01923     <span class="keywordflow">return</span> (ptr);
01924 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="rules.c::CmpMatchAcpiCreatorIdRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchAcpiCreatorIdRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01623">1623</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00058">_DESCRIPTION_HEADER::CreatorID</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
<pre class="fragment"><div>01630                    :
01631 
01632     This function processes a ACPI Creator <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> rule from an INF <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01633 
01634     Examples:
01635 
01636         AcpiCreatorId=<span class="stringliteral">"RSDT"</span>, <span class="stringliteral">"MSFT"</span>
01637 
01638     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Creator <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of MSFT.
01639 
01640 Arguments:
01641 
01642     InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
01643 
01644     <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section name <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
01645 
01646     RuleIndex - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
01647 
01648 Return Value:
01649 
01650     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Creator <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01651 
01652     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Creator <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01653 
01654 --*/
01655 
01656 {
01657     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01658     PCHAR               tableName;
01659     PCHAR               creatorId;
01660     ULONG               length;
01661     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> header;
01662     ULONG               idLength;
01663     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                acpiCreatorId[6];
01664 
01665     tableName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01666         InfHandle,
01667         Description,
01668         RuleIndex,
01669         0
01670         );
01671     creatorId = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01672         InfHandle,
01673         Description,
01674         RuleIndex,
01675         1
01676         );
01677     <span class="keywordflow">if</span> (tableName &amp;&amp; creatorId) {
01678 
01679         <span class="comment">//</span>
01680         <span class="comment">// Find the specified table.</span>
01681         <span class="comment">//</span>
01682         header = <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>(*(PULONG)tableName, &amp;length);
01683         <span class="keywordflow">if</span> (header) {
01684 
01685             RtlZeroMemory(acpiCreatorId, <span class="keyword">sizeof</span>(acpiCreatorId));
01686             idLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(creatorId);
01687             <span class="keywordflow">if</span> (idLength &gt; <span class="keyword">sizeof</span>(acpiCreatorId)) {
01688 
01689                 idLength = <span class="keyword">sizeof</span>(acpiCreatorId);
01690 
01691             }
01692             RtlCopyMemory(acpiCreatorId, creatorId, idLength);
01693             match = RtlEqualMemory(acpiCreatorId, header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o7">CreatorID</a>, <span class="keyword">sizeof</span>(header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o7">CreatorID</a>));
01694             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( header, length );
01695 
01696         }
01697 
01698     }
01699     <span class="keywordflow">return</span>(match);
01700 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="rules.c::CmpMatchAcpiCreatorRevisionRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchAcpiCreatorRevisionRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01540">1540</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l01927">CmpCheckOperator()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00059">_DESCRIPTION_HEADER::CreatorRev</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, and <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00121">RtlCharToInteger()</a>.
<p>
<pre class="fragment"><div>01547                    :
01548 
01549     This function processes a ACPI Creator Revision rule from an INF <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01550 
01551     Examples:
01552 
01553         AcpiCreatorRevision=<span class="stringliteral">"="</span>, <span class="stringliteral">"RSDT"</span>, 1234
01554 
01555     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a> ACPI Creator Revision <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> EQUAL to 1234.
01556 
01557         AcpiCreatorRevision=<span class="stringliteral">"&gt;"</span>, <span class="stringliteral">"DSDT"</span>, 4321
01558 
01559     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d9/struct__DSDT.html">DSDT</a> ACPI Creator Revision <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> GREATER than 4321.
01560 
01561 Arguments:
01562 
01563     InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
01564 
01565     <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section name <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
01566 
01567     RuleIndex - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
01568 
01569 Return Value:
01570 
01571     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Creator Revision.
01572 
01573     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Creator Revision.
01574 
01575 --*/
01576 
01577 {
01578     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01579     PCHAR               op;
01580     PCHAR               tableName;
01581     PCHAR               creatorRevisionStr;
01582     ULONG               creatorRevision;
01583     ULONG               length;
01584     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> header;
01585 
01586     op = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01587         InfHandle,
01588         Description,
01589         RuleIndex,
01590         0
01591         );
01592     tableName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01593         InfHandle,
01594         Description,
01595         RuleIndex,
01596         1
01597         );
01598     creatorRevisionStr = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01599         InfHandle,
01600         Description,
01601         RuleIndex,
01602         2
01603         );
01604     <span class="keywordflow">if</span> (op &amp;&amp; tableName &amp;&amp; creatorRevisionStr) {
01605 
01606         <span class="comment">//</span>
01607         <span class="comment">// Find the specified table.</span>
01608         <span class="comment">//</span>
01609         header = <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>(*(PULONG)tableName, &amp;length);
01610         <span class="keywordflow">if</span> (header){
01611 
01612             <a class="code" href="../../d9/d3/cnvint_8c.html#a3">RtlCharToInteger</a>(creatorRevisionStr, 16, &amp;creatorRevision);
01613             match = <a class="code" href="../../d9/d3/rules_8c.html#a18">CmpCheckOperator</a>(op, header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o8">CreatorRev</a>, creatorRevision);
01614             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( header, length );
01615 
01616         }
01617 
01618     }
01619     <span class="keywordflow">return</span>(match);
01620 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="rules.c::CmpMatchAcpiOemIdRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchAcpiOemIdRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01171">1171</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00055">_DESCRIPTION_HEADER::OEMID</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00399">RtlEqualString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01178                    :
01179 
01180     This function processes a ACPI OEM <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> rule from an INF <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>
01181 
01182     Examples:
01183 
01184         AcpiOemId=<span class="stringliteral">"RSDT"</span>, <span class="stringliteral">"123456"</span>
01185 
01186     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> OEM <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of 123456.
01187 
01188         AcpiOemId=<span class="stringliteral">"DSDT"</span>, <span class="stringliteral">"768000"</span>
01189 
01190     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d9/struct__DSDT.html">DSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> OEM <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of 768000.
01191 
01192 Arguments:
01193 
01194     InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
01195 
01196     <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section name <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
01197 
01198     RuleIndex - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
01199 
01200 Return Value:
01201 
01202     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI OEM <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01203 
01204     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI OEM <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01205 
01206 --*/
01207 
01208 {
01209     BOOLEAN             anyCase = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01210     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01211     PCHAR               tableName;
01212     PCHAR               oemId;
01213     PCHAR               optionalArgs;
01214     ULONG               length;
01215     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> header;
01216     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                tableOemId[7];
01217     STRING              acpiString;
01218     STRING              tableString;
01219 
01220     tableName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01221         InfHandle,
01222         Description,
01223         RuleIndex,
01224         0
01225         );
01226     oemId = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01227         InfHandle,
01228         Description,
01229         RuleIndex,
01230         1
01231         );
01232     <span class="keywordflow">if</span> (tableName &amp;&amp; oemId) {
01233 
01234         <span class="comment">//</span>
01235         <span class="comment">// See if we have to do a case insensitive match</span>
01236         <span class="comment">//</span>
01237         optionalArgs = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01238             InfHandle,
01239             Description,
01240             RuleIndex,
01241             2
01242             );
01243         <span class="keywordflow">if</span> (optionalArgs) {
01244 
01245             <span class="keywordflow">if</span> (_stricmp(optionalArgs,<span class="stringliteral">"any"</span>) == 0) {
01246 
01247                 anyCase = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01248 
01249             }
01250 
01251         }
01252 
01253         <span class="comment">//</span>
01254         <span class="comment">// Find the specified table in the BIOS ROM.</span>
01255         <span class="comment">//</span>
01256         header = <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>(*(PULONG)tableName, &amp;length);
01257         <span class="keywordflow">if</span> (header) {
01258 
01259             <span class="comment">//</span>
01260             <span class="comment">// Build the OEM id from the table</span>
01261             <span class="comment">//</span>
01262             RtlZeroMemory(tableOemId, <span class="keyword">sizeof</span>(tableOemId));
01263             RtlCopyMemory(tableOemId, header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o4">OEMID</a>, <span class="keyword">sizeof</span>(header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o4">OEMID</a>));
01264             <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;tableString, tableOemId );
01265 
01266             <span class="comment">//</span>
01267             <span class="comment">// And one from the string in the file</span>
01268             <span class="comment">//</span>
01269             <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;acpiString, oemId );
01270 
01271             <span class="comment">//</span>
01272             <span class="comment">// Now see if they are equal</span>
01273             <span class="comment">//</span>
01274             match = <a class="code" href="../../d2/d7/string_8c.html#a11">RtlEqualString</a>( &amp;acpiString, &amp;tableString, anyCase );
01275 
01276             <span class="comment">//</span>
01277             <span class="comment">// Unmap the table</span>
01278             <span class="comment">//</span>
01279             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>(header, length );
01280 
01281         }
01282 
01283     }
01284     <span class="keywordflow">return</span> (match);
01285 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="rules.c::CmpMatchAcpiOemRevisionRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchAcpiOemRevisionRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01372">1372</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l01927">CmpCheckOperator()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00057">_DESCRIPTION_HEADER::OEMRevision</a>, and <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00121">RtlCharToInteger()</a>.
<p>
<pre class="fragment"><div>01379                    :
01380 
01381     This function processes a ACPI Oem Revision rule from an INF <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01382 
01383     Examples:
01384 
01385     AcpiOemRevision=<span class="stringliteral">"="</span>,<span class="stringliteral">"RSDT"</span>, 1234
01386 
01387         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Oem Revision EQUAL to 1234.
01388 
01389     AcpiOemRevision=<span class="stringliteral">"&gt;"</span>,<span class="stringliteral">"DSDT"</span>, 4321
01390 
01391         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d9/struct__DSDT.html">DSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Oem Revision GREATER than 4321.
01392 
01393 Arguments:
01394 
01395     InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
01396 
01397     <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section name <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
01398 
01399     RuleIndex - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
01400 
01401 Return Value:
01402 
01403     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Oem Revision.
01404 
01405     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Oem Revision.
01406 
01407 --*/
01408 
01409 {
01410     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01411     PCHAR               op;
01412     PCHAR               tableName;
01413     PCHAR               oemRevisionStr;
01414     ULONG               oemRevision;
01415     ULONG               length;
01416     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> header;
01417 
01418     op = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01419         InfHandle,
01420         Description,
01421         RuleIndex,
01422         0
01423         );
01424     tableName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01425         InfHandle,
01426         Description,
01427         RuleIndex,
01428         1
01429         );
01430     oemRevisionStr = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01431         InfHandle,
01432         Description,
01433         RuleIndex,
01434         2
01435         );
01436     <span class="keywordflow">if</span> (op &amp;&amp; tableName &amp;&amp; oemRevisionStr) {
01437 
01438         <span class="comment">//</span>
01439         <span class="comment">// Find the specified table.</span>
01440         <span class="comment">//</span>
01441         header = <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>(*(PULONG)tableName, &amp;length);
01442         <span class="keywordflow">if</span> (header) {
01443 
01444             <a class="code" href="../../d9/d3/cnvint_8c.html#a3">RtlCharToInteger</a>(oemRevisionStr, 16, &amp;oemRevision);
01445             match = <a class="code" href="../../d9/d3/rules_8c.html#a18">CmpCheckOperator</a>(op, header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o6">OEMRevision</a>, oemRevision);
01446             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>(header, length);
01447 
01448         }
01449 
01450     }
01451     <span class="keywordflow">return</span>(match);
01452 
01453 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="rules.c::CmpMatchAcpiOemTableIdRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchAcpiOemTableIdRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01288">1288</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00056">_DESCRIPTION_HEADER::OEMTableID</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
<pre class="fragment"><div>01295                    :
01296 
01297     This function processes a ACPI OEM Table <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> rule from an INF <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01298 
01299     Examples:
01300 
01301     AcpiOemTableId=<span class="stringliteral">"RSDT"</span>, <span class="stringliteral">"12345678"</span>
01302 
01303         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Oem Table <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of 12345678.
01304 
01305     AcpiOemTableId=<span class="stringliteral">"DSDT"</span>, <span class="stringliteral">"87654321"</span>
01306 
01307         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d9/struct__DSDT.html">DSDT</a> has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Oem Table <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of 87654321.
01308 
01309 Arguments:
01310 
01311     InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
01312 
01313     <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section name <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
01314 
01315     RuleIndex - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
01316 
01317 Return Value:
01318 
01319     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI OEM Table <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01320 
01321     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI OEM Table <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01322 
01323 --*/
01324 
01325 {
01326     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01327     PCHAR               tableName;
01328     PCHAR               oemTableId;
01329     ULONG               length;
01330     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> header;
01331     ULONG               idLength;
01332     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                acpiOemTableId[8];
01333 
01334     tableName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01335         InfHandle,
01336         Description,
01337         RuleIndex,
01338         0
01339         );
01340     oemTableId = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01341         InfHandle,
01342         Description,
01343         RuleIndex,
01344         1
01345         );
01346     <span class="keywordflow">if</span> (tableName &amp;&amp; oemTableId) {
01347 
01348         <span class="comment">//</span>
01349         <span class="comment">// Find the specified table in the BIOS ROM.</span>
01350         <span class="comment">//</span>
01351         header = <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>(*(PULONG)tableName, &amp;length);
01352         <span class="keywordflow">if</span> (header) {
01353 
01354             RtlZeroMemory(acpiOemTableId, <span class="keyword">sizeof</span>(acpiOemTableId));
01355             idLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(oemTableId);
01356             <span class="keywordflow">if</span> (idLength &gt; <span class="keyword">sizeof</span>(acpiOemTableId)) {
01357 
01358                 idLength = <span class="keyword">sizeof</span>(acpiOemTableId);
01359 
01360             }
01361             RtlCopyMemory(acpiOemTableId, oemTableId, idLength);
01362             match = RtlEqualMemory(acpiOemTableId, header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o5">OEMTableID</a>, <span class="keyword">sizeof</span>(header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o5">OEMTableID</a>));
01363             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>( header, length );
01364 
01365         }
01366 
01367     }
01368     <span class="keywordflow">return</span> (match);
01369 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="rules.c::CmpMatchAcpiRevisionRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchAcpiRevisionRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01456">1456</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l01927">CmpCheckOperator()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03678">MmUnmapIoSpace()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00053">_DESCRIPTION_HEADER::Revision</a>, and <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00121">RtlCharToInteger()</a>.
<p>
<pre class="fragment"><div>01463                    :
01464 
01465     This function processes a ACPI Revision rule from an INF <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01466 
01467     Examples:
01468 
01469         AcpiRevision=<span class="stringliteral">"="</span>, <span class="stringliteral">"RSDT"</span>, 1234
01470 
01471     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d5/struct__RSDT.html">RSDT</a> ACPI Revision <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> EQUAL to 1234.
01472 
01473         AcpiRevision=<span class="stringliteral">"&gt;"</span>, <span class="stringliteral">"DSDT"</span>, 4321
01474 
01475     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d9/struct__DSDT.html">DSDT</a> ACPI Revision <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> GREATER than 4321.
01476 
01477 Arguments:
01478 
01479     InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
01480 
01481     <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section name <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in
01482 
01483     RuleIndex - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section
01484 
01485 Return Value:
01486 
01487     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Revision.
01488 
01489     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computer does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACPI Revision.
01490 
01491 --*/
01492 
01493 {
01494     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01495     PCHAR               op;
01496     PCHAR               tableName;
01497     PCHAR               revisionStr;
01498     ULONG               revision;
01499     ULONG               length;
01500     <a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html">PDESCRIPTION_HEADER</a> header;
01501 
01502     op = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01503         InfHandle,
01504         Description,
01505         RuleIndex,
01506         0
01507         );
01508     tableName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01509         InfHandle,
01510         Description,
01511         RuleIndex,
01512         1
01513         );
01514     revisionStr = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(
01515         InfHandle,
01516         Description,
01517         RuleIndex,
01518         2
01519         );
01520     <span class="keywordflow">if</span> (op &amp;&amp; tableName &amp;&amp; revisionStr){
01521 
01522         <span class="comment">//</span>
01523         <span class="comment">// Find the specified table.</span>
01524         <span class="comment">//</span>
01525         header = <a class="code" href="../../d9/d3/rules_8c.html#a17">CmpFindACPITable</a>(*(PULONG)tableName, &amp;length);
01526         <span class="keywordflow">if</span> (header) {
01527 
01528             <a class="code" href="../../d9/d3/cnvint_8c.html#a3">RtlCharToInteger</a>(revisionStr, 16, &amp;revision);
01529             match = <a class="code" href="../../d9/d3/rules_8c.html#a18">CmpCheckOperator</a>(op, header-&gt;<a class="code" href="../../d6/d2/struct__DESCRIPTION__HEADER.html#o2">Revision</a>, revision);
01530             <a class="code" href="../../d5/d6/iosup_8c.html#a58">MmUnmapIoSpace</a>(header, length);
01531 
01532         }
01533 
01534     }
01535     <span class="keywordflow">return</span>(match);
01536 
01537 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="rules.c::CmpMatchDateRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchDateRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00476">476</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01927">CmpCheckOperator()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00484                        :
00485 
00486         This routine checks <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine satisfies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DATE rule. The BIOS date
00487         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> stored in a standard location in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS ROM at FFFF:5.
00488 
00489         Syntax -
00490 
00491         DATE=<span class="keyword">operator</span>,month,day,year
00492             where <span class="keyword">operator</span> [=, ==, !=, &lt;&gt;, &lt;, &lt;=, =&lt;, &gt;, &gt;=, =&gt;]
00493 
00494         Examples -
00495 
00496         date=<span class="stringliteral">"&lt;="</span>,2,1,95
00497             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS date on <span class="keyword">this</span> machine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> less than or equal to
00498             02/01/95.
00499 
00500     Input Parameters:
00501 
00502         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00503 
00504         <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule info.
00505 
00506         RuleIndex - Line number <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> description section.
00507 
00508     Return Value:
00509 
00510         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS on <span class="keyword">this</span> machine has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified relation with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00511         date specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule.
00512 
00513 --*/
00514 
00515 {
00516     PCHAR   op;
00517     PCHAR   month;
00518     PCHAR   day;
00519     PCHAR   year;
00520     ULONG   infDate;
00521     ULONG   yr;
00522     ULONG   biosDate;
00523     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    temp[3];
00524     PVOID   baseAddress;
00525     PCHAR   address;
00526 
00527     op = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
00528     month = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 1);
00529     day = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 2);
00530     year = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 3);
00531 
00532     <span class="keywordflow">if</span> (op &amp;&amp; month &amp;&amp; day &amp;&amp; year)
00533     {
00534         yr = strtoul(year, NULL, 16);
00535         infDate = ((yr &lt; 0x80) ? 0x20000000 : 0x19000000) +
00536                     (yr &lt;&lt; 16) +
00537                     (strtoul(month, NULL, 16) &lt;&lt; 8) +
00538                     (strtoul(day, NULL, 16));
00539 
00540         address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, 0xFFFF5, 8);
00541         <span class="keywordflow">if</span> (address)
00542         {
00543             temp[2] = <span class="charliteral">'\0'</span>;
00544 
00545             RtlCopyBytes(temp, address + 6, 2);
00546             yr = strtoul(temp, NULL, 16);
00547             biosDate = ((yr &lt; 0x80) ? 0x20000000 : 0x19000000) +
00548                         (yr &lt;&lt; 16);
00549 
00550             RtlCopyBytes(temp, address, 2);
00551             biosDate |= (strtoul(temp, NULL, 16) &lt;&lt; 8);
00552 
00553             RtlCopyBytes(temp, address + 3, 2);
00554             biosDate |= strtoul(temp, NULL, 16);
00555 
00556             ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00557 
00558             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a18">CmpCheckOperator</a>(op, biosDate, infDate))
00559             {
00560                 <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00561             }
00562         }
00563     }
00564 
00565     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00566 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="rules.c::CmpMatchDescription" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchDescription           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00394">394</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d6/d2/parseini_8c-source.html#l01890">CmpGetKeyName()</a>, <a class="el" href="../../d6/d3/parseini_8h.html#a3">CmpSearchInfSection()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d3/rules_8c.html#a8">gRuleTable</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00252">NUM_OF_RULES</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00315">CmpMatchInfList()</a>.
<p>
<pre class="fragment"><div>00401                        :
00402 
00403         This routine processes all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rules in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified description.
00404 
00405     Input Parameters:
00406 
00407         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> description.
00408 
00409         <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - Section name containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rules.
00410 
00411     Return Value:
00412 
00413         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rules in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> description succeed.
00414 
00415 --*/
00416 
00417 {
00418     ULONG   ruleNumber;
00419     ULONG   i;
00420     PCHAR   ruleName;
00421 
00422     <span class="comment">//</span>
00423     <span class="comment">// Proceed only if the section does exist.</span>
00424     <span class="comment">//</span>
00425 
00426     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/parseini_8h.html#a3">CmpSearchInfSection</a>(InfHandle, Description))
00427     {
00428         <span class="comment">//</span>
00429         <span class="comment">// Go through all the rules in the description and try to match</span>
00430         <span class="comment">// each of them.</span>
00431         <span class="comment">//</span>
00432 
00433         ruleNumber = 0;
00434         <span class="keywordflow">while</span> ((ruleName = <a class="code" href="../../d6/d3/parseini_8h.html#a2">CmpGetKeyName</a>(InfHandle, Description, ruleNumber)))
00435         {
00436             <span class="comment">//</span>
00437             <span class="comment">// Search for the rule in our table.</span>
00438             <span class="comment">//</span>
00439 
00440             <span class="keywordflow">for</span> (   i = 0;
00441                     i &lt; <a class="code" href="../../d9/d3/rules_8c.html#a3">NUM_OF_RULES</a> &amp;&amp;
00442                         _stricmp(ruleName, gRuleTable[i].Name);
00443                     i++);
00444 
00445             <span class="comment">//</span>
00446             <span class="comment">// If we did not find the rule or the rule failed,</span>
00447             <span class="comment">// return failure.</span>
00448             <span class="comment">//</span>
00449 
00450             <span class="keywordflow">if</span> (    i &gt;= <a class="code" href="../../d9/d3/rules_8c.html#a3">NUM_OF_RULES</a> ||
00451                     !(*<a class="code" href="../../d9/d3/rules_8c.html#a8">gRuleTable</a>[i].Action)(InfHandle, <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, ruleNumber++))
00452             {
00453                 <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00454             }
00455         }
00456 
00457         <span class="comment">//</span>
00458         <span class="comment">// Description matches if we found at least one rule and all rules</span>
00459         <span class="comment">// succeeded.</span>
00460         <span class="comment">//</span>
00461 
00462         <span class="keywordflow">if</span> (ruleNumber)
00463         {
00464             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00465         }
00466     }
00467 
00468     <span class="comment">//</span>
00469     <span class="comment">// Description did not match.</span>
00470     <span class="comment">//</span>
00471 
00472     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00473 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="rules.c::CmpMatchInfList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchInfList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfImage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ImageSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Section</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00315">315</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d6/d2/parseini_8c-source.html#l01832">CmpCloseInfFile()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00176">CmpGenInstall()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00394">CmpMatchDescription()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01790">CmpOpenInfFile()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00279">gSearchAddress</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00323                        :
00324 
00325     Input Parameters:
00326 
00327         InfImage - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf image in memory.
00328 
00329         ImageSize - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf image.
00330 
00331         Section - Section name containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptions.
00332 
00333         <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> -
00334 
00335     Return Value:
00336 
00337         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine matches any one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptions in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf.
00338 
00339 --*/
00340 
00341 {
00342     PCHAR   computerName;
00343     ULONG   i = 0;
00344     PVOID   infHandle;
00345     BOOLEAN result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00346 
00347     infHandle = <a class="code" href="../../d6/d3/parseini_8h.html#a0">CmpOpenInfFile</a>(InfImage, ImageSize);
00348 
00349     <span class="keywordflow">if</span> (infHandle)
00350     {
00351         <span class="comment">//</span>
00352         <span class="comment">// Do any clean-up specified in the inf.</span>
00353         <span class="comment">//</span>
00354 
00355         <a class="code" href="../../d9/d0/geninst_8h.html#a0">CmpGenInstall</a>(infHandle, <span class="stringliteral">"Cleanup"</span>);
00356 
00357         <span class="comment">//</span>
00358         <span class="comment">// Go through each description in this section and try to match</span>
00359         <span class="comment">// this machine to it.</span>
00360         <span class="comment">//</span>
00361 
00362         <span class="keywordflow">while</span> ((computerName = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(infHandle, Section, i++, 0)))
00363         {
00364             <span class="comment">//</span>
00365             <span class="comment">// Reset search result from previous description.</span>
00366             <span class="comment">//</span>
00367 
00368             <a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00369 
00370             <span class="comment">//</span>
00371             <span class="comment">// If this description matches, we are done.</span>
00372             <span class="comment">// NOTE: IF MORE THAN ONE DESCRIPTION MATCHES,</span>
00373             <span class="comment">// WE STOP AT THE FIRST ONE.</span>
00374             <span class="comment">//</span>
00375 
00376             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a23">CmpMatchDescription</a>(infHandle, computerName))
00377             {
00378                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CmpMatchInfList: Machine matches %s description!\n"</span>, computerName);
00379                 result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00380             }
00381         }
00382 
00383         <a class="code" href="../../d6/d3/parseini_8h.html#a1">CmpCloseInfFile</a>(infHandle);
00384     }
00385 
00386     <span class="comment">//</span>
00387     <span class="comment">// None of the descriptions match.</span>
00388     <span class="comment">//</span>
00389 
00390     <span class="keywordflow">return</span> (result);
00391 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="rules.c::CmpMatchInstallRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchInstallRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01145">1145</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d9/d9/geninst_8c-source.html#l00176">CmpGenInstall()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01150 {
01151     BOOLEAN match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01152     PCHAR   install;
01153 
01154     install = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
01155     <span class="keywordflow">if</span> (install)
01156     {
01157         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0/geninst_8h.html#a0">CmpGenInstall</a>(InfHandle, install))
01158         {
01159             <span class="comment">//</span>
01160             <span class="comment">// Successfully installed the specified section.</span>
01161             <span class="comment">//</span>
01162 
01163             match = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01164         }
01165     }
01166 
01167     <span class="keywordflow">return</span> (match);
01168 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="rules.c::CmpMatchMemoryRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchMemoryRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00569">569</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/rules_8h-source.html#l00006">MAX_DESCRIPTION_LEN</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00577                        :
00578 
00579         This routine checks <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine satisfies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MEMORY rule.
00580 
00581         Syntax -
00582 
00583         MEMORY=segment,offset,<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>,data
00584             where <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> [<span class="stringliteral">"S"</span>, <span class="stringliteral">"B"</span>]
00585 
00586         Examples -
00587 
00588         memory=f000,e000,S,<span class="stringliteral">"TOSHIBA"</span>
00589             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory in <span class="keyword">this</span> machine at physical address f000:e000
00590             has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string <span class="stringliteral">"TOSHIBA"</span>.
00591 
00592         memory=ffff,5,B,01,02
00593             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory in <span class="keyword">this</span> machine at physical memory ffff:5
00594             has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bytes 0x01 and 0x02.
00595 
00596     Input Parameters:
00597 
00598         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00599 
00600         <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule info.
00601 
00602         RuleIndex - Line number <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> description section.
00603 
00604     Return Value:
00605 
00606         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MEMORY in <span class="keyword">this</span> machine at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address
00607         contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified data.
00608 
00609 --*/
00610 
00611 {
00612     BOOLEAN             match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00613     PCHAR               segment;
00614     PCHAR               offset;
00615     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                data[<a class="code" href="../../d0/d4/rules_8h.html#a0">MAX_DESCRIPTION_LEN</a> + 1];
00616     ULONG               cbData;
00617     PVOID               baseAddress;
00618     PCHAR               address;
00619     ULONG               memory;
00620 
00621     <span class="comment">//</span>
00622     <span class="comment">// Read in the segment and offset of the address specified.</span>
00623     <span class="comment">//</span>
00624 
00625     segment = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
00626     offset = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 1);
00627 
00628     <span class="keywordflow">if</span> (segment &amp;&amp; offset)
00629     {
00630         <span class="comment">//</span>
00631         <span class="comment">// Get the data specified in the inf.</span>
00632         <span class="comment">//</span>
00633 
00634         cbData = <span class="keyword">sizeof</span>(data);
00635         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a20">CmpGetInfData</a>(InfHandle, Description, RuleIndex, 2, data, &amp;cbData))
00636         {
00637             memory = (strtoul(segment, NULL, 16) &lt;&lt; 4) + strtoul(offset, NULL, 16);
00638 
00639             <span class="comment">//</span>
00640             <span class="comment">// Map in the physical address.</span>
00641             <span class="comment">//</span>
00642 
00643             address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, memory, cbData);
00644             <span class="keywordflow">if</span> (address)
00645             {
00646 
00647                 <span class="comment">//</span>
00648                 <span class="comment">// Check if the inf data matches data in memory.</span>
00649                 <span class="comment">//</span>
00650 
00651                 match = (RtlCompareMemory(address, data, cbData) == cbData);
00652 
00653                 <span class="comment">//</span>
00654                 <span class="comment">// Unmap the physical address.</span>
00655                 <span class="comment">//</span>
00656 
00657                 ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00658             }
00659         }
00660     }
00661 
00662     <span class="keywordflow">return</span> (match);
00663 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="rules.c::CmpMatchNextMatchRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchNextMatchRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00764">764</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00279">gSearchAddress</a>, <a class="el" href="../../d1/d3/rules_8h-source.html#l00006">MAX_DESCRIPTION_LEN</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00772                        :
00773 
00774         This routine checks to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine matches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NEXTMATCH rule.
00775 
00776         Syntax -
00777 
00778         NEXTMATCH=offset,<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>,data
00779             where <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> [<span class="stringliteral">"S"</span>, <span class="stringliteral">"B"</span>]
00780 
00781         Examples -
00782 
00783         nextmatch=f0,S,<span class="stringliteral">"Atlanta"</span>
00784             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string <span class="stringliteral">"Atlanta"</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> at offset 0xF0 from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous
00785             successful SEARCH or NEXTMATCH rule.
00786 
00787     Input Parameters:
00788 
00789         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00790 
00791         <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule info.
00792 
00793         RuleIndex - Line number <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> description section.
00794 
00795     Return Value:
00796 
00797         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified pattern <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified offset
00798         from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous successful SEARCH or NEXTMATCH.
00799 
00800 --*/
00801 
00802 {
00803     BOOLEAN match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00804     PCHAR   offset;
00805     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    data[<a class="code" href="../../d0/d4/rules_8h.html#a0">MAX_DESCRIPTION_LEN</a> + 1];
00806     ULONG   cbData;
00807     PVOID   baseAddress;
00808     PCHAR   address;
00809 
00810     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a>)
00811     {
00812         offset = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
00813         <span class="keywordflow">if</span> (offset)
00814         {
00815             <span class="comment">//</span>
00816             <span class="comment">// Get the data specified in the inf.</span>
00817             <span class="comment">//</span>
00818 
00819             cbData = <span class="keyword">sizeof</span>(data);
00820 
00821             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a20">CmpGetInfData</a>(InfHandle, Description, RuleIndex, 1, data, &amp;cbData))
00822             {
00823                 (PCHAR)<a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> += strtoul(offset, NULL, 16);
00824 
00825                 <span class="comment">//</span>
00826                 <span class="comment">// Map in the physical address.</span>
00827                 <span class="comment">//</span>
00828 
00829                 address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, (ULONG)gSearchAddress, cbData);
00830                 <span class="keywordflow">if</span> (address)
00831                 {
00832 
00833                     <span class="comment">//</span>
00834                     <span class="comment">// Check if the inf data matches data in memory.</span>
00835                     <span class="comment">//</span>
00836 
00837                     match = (RtlCompareMemory(address, data, cbData) == cbData);
00838 
00839                     <span class="comment">//</span>
00840                     <span class="comment">// Unmap the physical address.</span>
00841                     <span class="comment">//</span>
00842 
00843                     ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00844                 }
00845             }
00846         }
00847     }
00848 
00849     <span class="keywordflow">return</span> (match);
00850 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="rules.c::CmpMatchOemIdRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchOemIdRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00957">957</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">CmpGetPnPBIOSTableAddress()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00058">PPNP_BIOS_TABLE</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
<pre class="fragment"><div>00962 {
00963     BOOLEAN         match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00964     ULONG           address;
00965     PCHAR           op;
00966     PCHAR           oemIdStr;
00967     ULONG           oemId;
00968     PCHAR           baseAddress;
00969     <a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a> biosTable;
00970 
00971     <span class="comment">//</span>
00972     <span class="comment">// Search for the PnPBIOS structure in the BIOS ROM.</span>
00973     <span class="comment">//</span>
00974 
00975     address = <a class="code" href="../../d9/d3/rules_8c.html#a22">CmpGetPnPBIOSTableAddress</a>();
00976 
00977     <span class="comment">//</span>
00978     <span class="comment">// Proceed if we found the PnP BIOS structure.</span>
00979     <span class="comment">//</span>
00980 
00981     <span class="keywordflow">if</span> (address)
00982     {
00983         op = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
00984         oemIdStr = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 1);
00985         <span class="keywordflow">if</span> (op &amp;&amp; oemIdStr)
00986         {
00987 
00988             <span class="keywordflow">if</span> (    <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(oemIdStr) == 7 &amp;&amp;
00989                     isalpha(oemIdStr[0]) &amp;&amp;
00990                     isalpha(oemIdStr[1]) &amp;&amp;
00991                     isalpha(oemIdStr[2]) &amp;&amp;
00992                     isxdigit(oemIdStr[3]) &amp;&amp;
00993                     isxdigit(oemIdStr[4]) &amp;&amp;
00994                     isxdigit(oemIdStr[5]) &amp;&amp;
00995                     isxdigit(oemIdStr[6]))
00996             {
00997 
00998                 biosTable = (<a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a>)<a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, address, <span class="keyword">sizeof</span>(PNP_BIOS_TABLE));
00999                 <span class="keywordflow">if</span> (biosTable)
01000                 {
01001                     oemId = ((ULONG)(oemIdStr[0] &amp; 0x1F) &lt;&lt; 26) +
01002                             ((ULONG)(oemIdStr[1] &amp; 0x1F) &lt;&lt; 21) +
01003                             ((ULONG)(oemIdStr[2] &amp; 0x1F) &lt;&lt; 16) +
01004                             strtoul(&amp;oemIdStr[3], NULL, 16);
01005 
01006                     <span class="comment">//</span>
01007                     <span class="comment">// We only support EQUAL and NOT EQUAL operators.</span>
01008                     <span class="comment">//</span>
01009 
01010                     <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">"="</span>) == 0 || strcmp(op, <span class="stringliteral">"=="</span>) == 0)
01011                     {
01012                         match = (oemId == biosTable-&gt;Oem);
01013                     }
01014                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(    strcmp(op, <span class="stringliteral">"&lt;&gt;"</span>) == 0 ||
01015                                 strcmp(op, <span class="stringliteral">"!="</span>) == 0 ||
01016                                 strcmp(op, <span class="stringliteral">"=!"</span>) == 0)
01017                     {
01018                         match = (oemId != biosTable-&gt;Oem);
01019                     }
01020 
01021                     <span class="comment">//</span>
01022                     <span class="comment">// Unmap the physical address.</span>
01023                     <span class="comment">//</span>
01024 
01025                     ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
01026                 }
01027             }
01028         }
01029     }
01030 
01031     <span class="keywordflow">return</span> (match);
01032 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="rules.c::CmpMatchPModeRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchPModeRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01035">1035</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">CmpGetPnPBIOSTableAddress()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/rules_8h-source.html#l00006">MAX_DESCRIPTION_LEN</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00058">PPNP_BIOS_TABLE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, and <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00070">SYSTEM_BIOS_LENGTH</a>.
<p>
<pre class="fragment"><div>01040 {
01041     BOOLEAN         match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01042     ULONG           address;
01043     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>            data[<a class="code" href="../../d0/d4/rules_8h.html#a0">MAX_DESCRIPTION_LEN</a> + 1];
01044     ULONG           cbData;
01045     PVOID           baseAddress;
01046     <a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a> biosTable;
01047     ULONG           pmAddress;
01048     PCHAR           pmodeEntry;
01049 
01050     <span class="comment">//</span>
01051     <span class="comment">// Search for the PnPBIOS structure in the BIOS ROM.</span>
01052     <span class="comment">//</span>
01053 
01054     address = <a class="code" href="../../d9/d3/rules_8c.html#a22">CmpGetPnPBIOSTableAddress</a>();
01055 
01056     <span class="comment">//</span>
01057     <span class="comment">// Proceed if we found the PnP BIOS structure.</span>
01058     <span class="comment">//</span>
01059 
01060     <span class="keywordflow">if</span> (address)
01061     {
01062         <span class="comment">//</span>
01063         <span class="comment">// Get the data specified in the inf.</span>
01064         <span class="comment">//</span>
01065 
01066         cbData = <span class="keyword">sizeof</span>(data);
01067         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a20">CmpGetInfData</a>(InfHandle, Description, RuleIndex, 0, data, &amp;cbData))
01068         {
01069             biosTable = (<a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a>)<a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, address, <span class="keyword">sizeof</span>(PNP_BIOS_TABLE));
01070             <span class="keywordflow">if</span> (biosTable)
01071             {
01072                 pmAddress = (biosTable-&gt;PMSegment &lt;&lt; 4) + biosTable-&gt;PMOffset;
01073 
01074                 <span class="comment">//</span>
01075                 <span class="comment">// Unmap the physical address.</span>
01076                 <span class="comment">//</span>
01077 
01078                 ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
01079 
01080                 pmodeEntry = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, pmAddress, SYSTEM_BIOS_LENGTH);
01081                 <span class="keywordflow">if</span> (pmodeEntry)
01082                 {
01083                     <span class="keywordflow">if</span> (*pmodeEntry == 0xE9)
01084                     {
01085                         pmodeEntry += (3 + (*((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)&amp;pmodeEntry[1])));
01086                     }
01087 
01088                     match = (RtlCompareMemory(pmodeEntry, data, cbData) == cbData);
01089 
01090                     <span class="comment">//</span>
01091                     <span class="comment">// Unmap the physical address.</span>
01092                     <span class="comment">//</span>
01093 
01094                     ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
01095                 }
01096             }
01097         }
01098     }
01099 
01100     <span class="keywordflow">return</span> (match);
01101 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="rules.c::CmpMatchPointerRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchPointerRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00853">853</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01927">CmpCheckOperator()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/rules_8h-source.html#l00006">MAX_DESCRIPTION_LEN</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
<pre class="fragment"><div>00858 {
00859     BOOLEAN match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00860     PCHAR   segment1;
00861     PCHAR   offset1;
00862     PCHAR   segment2;
00863     PCHAR   offset2;
00864     PCHAR   index;
00865     PCHAR   op;
00866     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    data[<a class="code" href="../../d0/d4/rules_8h.html#a0">MAX_DESCRIPTION_LEN</a> + 1];
00867     ULONG   cbData;
00868     ULONG   memory;
00869     ULONG   pointer;
00870     PVOID   baseAddress;
00871     PCHAR   address;
00872 
00873     segment1 = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
00874     offset1 = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 1);
00875     segment2 = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 2);
00876     offset2 = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 3);
00877     index = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 4);
00878     op = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 5);
00879 
00880     <span class="keywordflow">if</span> (    segment1 &amp;&amp; offset1 &amp;&amp;
00881             segment2 &amp;&amp; offset2 &amp;&amp;
00882             index &amp;&amp; op)
00883     {
00884         <span class="comment">//</span>
00885         <span class="comment">// Get the data specified in the inf.</span>
00886         <span class="comment">//</span>
00887 
00888         cbData = <span class="keyword">sizeof</span>(data);
00889 
00890         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a20">CmpGetInfData</a>(InfHandle, Description, RuleIndex, 6, data, &amp;cbData))
00891         {
00892             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(offset2) == 0)
00893             {
00894                 memory = strtoul(segment2, NULL, 16) &lt;&lt; 4;
00895             }
00896             <span class="keywordflow">else</span>
00897             {
00898                 memory = (strtoul(segment2, NULL, 16) &lt;&lt; 4) + strtoul(offset2, NULL, 16);
00899             }
00900 
00901             address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, memory, 4);
00902             <span class="keywordflow">if</span> (address)
00903             {
00904                 pointer = *((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)address);
00905 
00906                 <span class="comment">//</span>
00907                 <span class="comment">// Unmap the physical address.</span>
00908                 <span class="comment">//</span>
00909 
00910                 ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00911 
00912                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(offset1) == 0)
00913                 {
00914                     memory = (strtoul(segment1, NULL, 16) &lt;&lt; 4) + pointer;
00915                 }
00916                 <span class="keywordflow">else</span>
00917                 {
00918                     memory = (strtoul(segment1, NULL, 16) &lt;&lt; 4) + strtoul(offset1, NULL, 16);
00919                     address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, memory, 2);
00920                     <span class="keywordflow">if</span> (address)
00921                     {
00922                         memory = ((*(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)address) &lt;&lt; 4) + pointer;
00923 
00924                         <span class="comment">//</span>
00925                         <span class="comment">// Unmap the physical address.</span>
00926                         <span class="comment">//</span>
00927 
00928                         ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00929                     }
00930                 }
00931 
00932                 memory += strtoul(index, NULL, 16);
00933 
00934                 <span class="comment">//</span>
00935                 <span class="comment">// Map in the physical address.</span>
00936                 <span class="comment">//</span>
00937 
00938                 address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, memory, cbData);
00939                 <span class="keywordflow">if</span> (address)
00940                 {
00941                     match = <a class="code" href="../../d9/d3/rules_8c.html#a18">CmpCheckOperator</a>(op, RtlCompareMemory(address, data, cbData), cbData);
00942 
00943                     <span class="comment">//</span>
00944                     <span class="comment">// Unmap the physical address.</span>
00945                     <span class="comment">//</span>
00946 
00947                     ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00948                 }
00949             }
00950         }
00951     }
00952 
00953     <span class="keywordflow">return</span> (match);
00954 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="rules.c::CmpMatchRmPmSameRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchRmPmSameRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l01104">1104</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d0/d3/rules_8c-source.html#l02100">CmpGetPnPBIOSTableAddress()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l00058">PPNP_BIOS_TABLE</a>.
<p>
<pre class="fragment"><div>01109 {
01110     BOOLEAN match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01111     ULONG           address;
01112     PCHAR           baseAddress;
01113     <a class="code" href="../../d9/d3/rules_8c.html#a5">PPNP_BIOS_TABLE</a> biosTable;
01114 
01115     <span class="comment">//</span>
01116     <span class="comment">// Search for the PnPBIOS structure in the BIOS ROM.</span>
01117     <span class="comment">//</span>
01118 
01119     address = <a class="code" href="../../d9/d3/rules_8c.html#a22">CmpGetPnPBIOSTableAddress</a>();
01120 
01121     <span class="comment">//</span>
01122     <span class="comment">// Proceed if we found the PnP BIOS structure.</span>
01123     <span class="comment">//</span>
01124 
01125     <span class="keywordflow">if</span> (address)
01126     {
01127         biosTable = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, address, <span class="keyword">sizeof</span>(PNP_BIOS_TABLE));
01128         <span class="keywordflow">if</span> (biosTable)
01129         {
01130             match = (   biosTable-&gt;RMSegment == biosTable-&gt;PMSegment &amp;&amp;
01131                         biosTable-&gt;RMOffset == biosTable-&gt;PMOffset);
01132 
01133             <span class="comment">//</span>
01134             <span class="comment">// Unmap the physical address.</span>
01135             <span class="comment">//</span>
01136 
01137             ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
01138         }
01139     }
01140 
01141     <span class="keywordflow">return</span> (match);
01142 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="rules.c::CmpMatchSearchRule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CmpMatchSearchRule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>InfHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RuleIndex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00666">666</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02025">CmpFindPattern()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01991">CmpGetSectionLineIndex()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01854">CmpMapPhysicalAddress()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00034">Description</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00279">gSearchAddress</a>, <a class="el" href="../../d1/d3/rules_8h-source.html#l00006">MAX_DESCRIPTION_LEN</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00674                        :
00675 
00676         This routine checks to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine matches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SEARCH rule.
00677 
00678         Syntax -
00679 
00680         SEARCH=segment,offset,length,<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>,data
00681             where <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> [<span class="stringliteral">"S"</span>, <span class="stringliteral">"B"</span>]
00682 
00683         Examples -
00684 
00685         search=f000,e000,7f,S,<span class="stringliteral">"SurePath"</span>
00686             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string <span class="stringliteral">"SurePath"</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> somewhere in memory range
00687             F000:E000 to F000:E07F (inclusive).
00688 
00689     Input Parameters:
00690 
00691         InfHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inf to be read.
00692 
00693         <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> - <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule info.
00694 
00695         RuleIndex - Line number <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rule in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> description section.
00696 
00697     Return Value:
00698 
00699         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> iff <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified pattern <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address
00700         range.
00701 
00702 --*/
00703 
00704 {
00705     BOOLEAN match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00706     PCHAR   segment;
00707     PCHAR   offset;
00708     PCHAR   size;
00709     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    data[<a class="code" href="../../d0/d4/rules_8h.html#a0">MAX_DESCRIPTION_LEN</a> + 1];
00710     ULONG   cbData;
00711     ULONG   memory;
00712     ULONG   length;
00713     PVOID   baseAddress;
00714     PCHAR   address;
00715 
00716     segment = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 0);
00717     offset = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 1);
00718     size = <a class="code" href="../../d6/d3/parseini_8h.html#a5">CmpGetSectionLineIndex</a>(InfHandle, Description, RuleIndex, 2);
00719 
00720     <span class="keywordflow">if</span> (segment &amp;&amp; offset &amp;&amp; size)
00721     {
00722         <span class="comment">//</span>
00723         <span class="comment">// Get the data specified in the inf.</span>
00724         <span class="comment">//</span>
00725 
00726         cbData = <span class="keyword">sizeof</span>(data);
00727         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a20">CmpGetInfData</a>(InfHandle, Description, RuleIndex, 3, data, &amp;cbData))
00728         {
00729             memory = (strtoul(segment, NULL, 16) &lt;&lt; 4) + strtoul(offset, NULL, 16);
00730 
00731             <span class="comment">//</span>
00732             <span class="comment">// Map in the physical address.</span>
00733             <span class="comment">//</span>
00734 
00735             length = strtoul(size, NULL, 16);
00736             address = <a class="code" href="../../d9/d3/rules_8c.html#a19">CmpMapPhysicalAddress</a>(&amp;baseAddress, memory, length);
00737             <span class="keywordflow">if</span> (address)
00738             {
00739                 <a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> = <a class="code" href="../../d9/d3/rules_8c.html#a21">CmpFindPattern</a>(address, length, data, cbData, FALSE, 0);
00740                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a>)
00741                 {
00742                     <span class="comment">//</span>
00743                     <span class="comment">// If we found the pattern, compute the actual address for it.</span>
00744                     <span class="comment">//</span>
00745 
00746                     (PCHAR)<a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> -= (ULONG)address;
00747                     (PCHAR)<a class="code" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> += memory;
00748                     match = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00749                 }
00750 
00751                 <span class="comment">//</span>
00752                 <span class="comment">// Unmap the physical address.</span>
00753                 <span class="comment">//</span>
00754 
00755                 ZwUnmapViewOfSection(NtCurrentProcess(), baseAddress);
00756             }
00757         }
00758     }
00759 
00760     <span class="keywordflow">return</span> (match);
00761 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a7" doxytag="rules.c::Action" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d3/rules_8c.html#a4">PFN_RULE</a> <a class="el" href="../../d9/d3/rules_8c.html#a7">Action</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00260">260</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="rules.c::gRuleTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct { ... }   <a class="el" href="../../d9/d3/rules_8c.html#a8">gRuleTable</a>[NUM_OF_RULES]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00394">CmpMatchDescription()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="rules.c::gSearchAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d9/d3/rules_8c.html#a9">gSearchAddress</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00279">279</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l00315">CmpMatchInfList()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00764">CmpMatchNextMatchRule()</a>, and <a class="el" href="../../d0/d3/rules_8c-source.html#l00666">CmpMatchSearchRule()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="rules.c::Name" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCHAR <a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00259">259</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="rules.c::rgzAcpiConfigurationData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d3/rules_8c.html#a11">rgzAcpiConfigurationData</a>[] = L"Configuration Data"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00282">282</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="rules.c::rgzAcpiIdentifier" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d3/rules_8c.html#a12">rgzAcpiIdentifier</a>[] = L"Identifier"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00283">283</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="rules.c::rgzBIOSIdentifier" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d3/rules_8c.html#a13">rgzBIOSIdentifier</a>[] = L"ACPI BIOS"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00284">284</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="rules.c::rgzMultiFunctionAdapter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d9/d3/rules_8c.html#a10">rgzMultiFunctionAdapter</a>[] = L"\\Registry\\Machine\\Hardware\\<a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>\\System\\MultifunctionAdapter"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/rules_8c-source.html#l00281">281</a> of file <a class="el" href="../../d0/d3/rules_8c-source.html">rules.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:31 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
