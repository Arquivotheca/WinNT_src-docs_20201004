<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ke/i386/vdm.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>vdm.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include "<a class="el" href="../../d2/d4/vdmntos_8h-source.html">vdmntos.h</a>"</code><br>

<p>
<a href="../../d0/d3/ke_2i386_2vdm_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a0">VDM_IO_TEST</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a1">STRINGIO_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;1024</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a9">Ki386GetSelectorParameters</a> (IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Selector, OUT PULONG Flags, OUT PULONG Base, OUT PULONG Limit)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a10">Ki386VdmDispatchIo</a> (IN ULONG PortNumber, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN BOOLEAN Read, IN UCHAR InstructionSize, IN PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a11">Ki386VdmDispatchStringIo</a> (IN ULONG PortNumber, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN BOOLEAN Rep, IN BOOLEAN Read, IN ULONG <a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>, IN ULONG Address, IN UCHAR InstructionSize, IN PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a> (IN PVDM_IO_HANDLER VdmIoHandler, IN ULONG Context, IN ULONG PortNumber, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN BOOLEAN Read, IN OUT PULONG Data)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a13">VdmDispatchUnalignedIoToHandler</a> (IN PVDM_IO_HANDLER VdmIoHandler, IN ULONG Context, IN ULONG PortNumber, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN BOOLEAN Read, IN OUT PULONG Data)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a14">VdmDispatchStringIoToHandler</a> (IN PVDM_IO_HANDLER VdmIoHandler, IN ULONG Context, IN ULONG PortNumber, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN ULONG <a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>, IN BOOLEAN Read, IN ULONG Data)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a15">VdmCallStringIoHandler</a> (IN PVDM_IO_HANDLER VdmIoHandler, IN PVOID StringIoRoutine, IN ULONG Context, IN ULONG PortNumber, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN ULONG <a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>, IN BOOLEAN Read, IN ULONG Data)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a16">VdmConvertToLinearAddress</a> (IN ULONG SegmentedAddress, IN PVOID *LinearAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a17">KeI386VdmInitialize</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a18">Ki386VdmEnablePentiumExtentions</a> (ULONG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a19">VdmConvertToLinearAddress</a> (IN ULONG SegmentedAddress, OUT PVOID *LinearAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a20">Ke386VdmInsertQueueApc</a> (IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc, IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ApcMode, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a42">PKKERNEL_ROUTINE</a> KernelRoutine, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a43">PKRUNDOWN_ROUTINE</a> RundownRoutine OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> NormalRoutine OPTIONAL, IN PVOID NormalContext OPTIONAL, IN KPRIORITY Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a21">Ke386VdmClearApcObject</a> (IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d7/struct__KMUTANT.html">KMUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a2">VdmStringIoMutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a3">VdmFixedStateLinear</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a4">KeI386EFlagsAndMaskV86</a> = EFLAGS_USER_SANITIZE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a5">KeI386EFlagsOrMaskV86</a> = EFLAGS_INTERRUPT_MASK</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a6">KeI386VdmIoplAllowed</a> = FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a7">KeI386VirtualIntExtensions</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a8">VdmStringIoBuffer</a> [STRINGIO_BUFFER_SIZE]</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="ke/i386/vdm.c::STRINGIO_BUFFER_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define STRINGIO_BUFFER_SIZE&nbsp;&nbsp;&nbsp;1024          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00878">878</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ke/i386/vdm.c::VDM_IO_TEST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VDM_IO_TEST&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00039">39</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="ke/i386/vdm.c::Ke386VdmClearApcObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID Ke386VdmClearApcObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Apc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01437">1437</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01709">VdmpDelayIntApcRoutine()</a>, and <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00232">VdmpQueueIntApcRoutine()</a>.
<p>
<pre class="fragment"><div>01442                    :
01443 
01444     Clears a VDM APC object, synchronously with <a class="code" href="../../d5/d3/i386_8h.html#a47">Ke386VdmInsertQueueApc</a>, and
01445     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> expected to be called by one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> vdm kernel apc routine or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01446     rundown routine.
01447 
01448 
01449 Arguments:
01450 
01451     Apc - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> APC.
01452 
01453 
01454 Return Value:
01455 
01456     <span class="keywordtype">void</span>
01457 
01458 --*/
01459 {
01460 
01461     KIRQL   OldIrql;
01462 
01463     <span class="comment">//</span>
01464     <span class="comment">// Take Dispatcher database lock, to sync with Ke386VDMInsertQueueApc</span>
01465     <span class="comment">//</span>
01466 
01467     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01468     Apc-&gt;Thread  = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01469     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01470 
01471 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ke/i386/vdm.c::Ke386VdmInsertQueueApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN Ke386VdmInsertQueueApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Apc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ApcMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a42">PKKERNEL_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>KernelRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a43">PKRUNDOWN_ROUTINE</a> RundownRoutine&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> NormalRoutine&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID NormalContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01257">1257</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00243">_KAPC_STATE::ApcListHead</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a175">ApcObject</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00613">_KTHREAD::ApcQueueLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00246">_KAPC_STATE::KernelApcPending</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00179">KiBoostPriorityThread</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">KiInsertQueueApc()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a403a181">OriginalApcEnvironment</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00247">_KAPC_STATE::UserApcPending</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01583">VdmpDelayIntDpcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00232">VdmpQueueIntApcRoutine()</a>, and <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00146">VdmpQueueInterrupt()</a>.
<p>
<pre class="fragment"><div>01270                    :
01271 
01272     This function initializes, and queues a vdm <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of APC to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01273     specified thread.
01274 
01275 
01276     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> Vdm <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of APC:
01277        - <a class="code" href="../../d4/d9/ke_8h.html#a403a181">OriginalApcEnvironment</a>
01278        - will <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be queued to one thread at a time
01279        - <span class="keywordflow">if</span> <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> Fires on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next system <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> apc should
01280          not be queued <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current vdm context <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not application mode.
01281 
01282 Arguments:
01283 
01284     Apc - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> APC.
01285 
01286     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01287 
01288     ApcMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode user\kernel of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Apc
01289 
01290     KernelRoutine - Supplies a pointer to a function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01291         executed at IRQL <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a> in kernel mode.
01292 
01293     RundownRoutine - Supplies an optional pointer to a function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01294         called <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in a thread's APC queue when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread terminates.
01295 
01296     NormalRoutine - Supplies an optional pointer to a function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01297         to be executed at IRQL 0 in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor mode. If <span class="keyword">this</span>
01298         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ProcessorMode and NormalContext
01299         parameters are ignored.
01300 
01301     NormalContext - Supplies a pointer to an arbitrary data structure which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01302         to be passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NormalRoutine parameter.
01303 
01304     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority increment that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied <span class="keywordflow">if</span>
01305         queuing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC causes a thread wait to be satisfied.
01306 
01307 
01308 Return Value:
01309 
01310     If APC queuing <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> disabled, then a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01311     Otherwise a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01312 
01313 
01314 --*/
01315 
01316 {
01317 
01318     <a class="code" href="../../d3/d5/struct__KAPC__STATE.html">PKAPC_STATE</a> ApcState;
01319     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> ApcThread;
01320     KIRQL   OldIrql;
01321     BOOLEAN Inserted;
01322 
01323     <span class="comment">//</span>
01324     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01325     <span class="comment">//</span>
01326 
01327     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01328 
01329     <span class="comment">//</span>
01330     <span class="comment">// If the apc object not initialized, then initialize it and acquire</span>
01331     <span class="comment">// the target thread APC queue lock.</span>
01332     <span class="comment">//</span>
01333 
01334     <span class="keywordflow">if</span> (Apc-&gt;Type != <a class="code" href="../../d4/d9/ke_8h.html#a402a175">ApcObject</a>) {
01335         Apc-&gt;Type = <a class="code" href="../../d4/d9/ke_8h.html#a402a175">ApcObject</a>;
01336         Apc-&gt;Size = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d5/struct__KAPC.html">KAPC</a>);
01337         Apc-&gt;ApcStateIndex  = <a class="code" href="../../d4/d9/ke_8h.html#a403a181">OriginalApcEnvironment</a>;
01338     } <span class="keywordflow">else</span> {
01339 
01340         <span class="comment">//</span>
01341         <span class="comment">// Acquire the APC thread APC queue lock.</span>
01342         <span class="comment">//</span>
01343         <span class="comment">// If the APC is inserted in the corresponding APC queue, and the</span>
01344         <span class="comment">// APC thread is not the same thread as the target thread, then</span>
01345         <span class="comment">// the APC is removed from its current queue, the APC pending state</span>
01346         <span class="comment">// is updated, the APC thread APC queue lock is released, and the</span>
01347         <span class="comment">// target thread APC queue lock is acquired. Otherwise, the APC</span>
01348         <span class="comment">// thread and the target thread are same thread and the APC is already</span>
01349         <span class="comment">// queued to the correct thread.</span>
01350         <span class="comment">//</span>
01351         <span class="comment">// If the APC is not inserted in an APC queue, then release the</span>
01352         <span class="comment">// APC thread APC queue lock and acquire the target thread APC queue</span>
01353         <span class="comment">// lock.</span>
01354         <span class="comment">//</span>
01355 
01356         ApcThread = Apc-&gt;Thread;
01357         <span class="keywordflow">if</span> (ApcThread) {
01358             KiAcquireSpinLock(&amp;ApcThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
01359             <span class="keywordflow">if</span> (Apc-&gt;Inserted) {
01360                 <span class="keywordflow">if</span> (ApcThread == Apc-&gt;Thread &amp;&amp; Apc-&gt;Thread != Thread) {
01361                     Apc-&gt;Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01362                     RemoveEntryList(&amp;Apc-&gt;ApcListEntry);
01363                     ApcState = Apc-&gt;Thread-&gt;ApcStatePointer[Apc-&gt;ApcStateIndex];
01364                     <span class="keywordflow">if</span> (IsListEmpty(&amp;ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[Apc-&gt;ApcMode]) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01365                         <span class="keywordflow">if</span> (Apc-&gt;ApcMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
01366                             ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o3">KernelApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01367 
01368                         } <span class="keywordflow">else</span> {
01369                             ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01370                         }
01371                     }
01372 
01373                 } <span class="keywordflow">else</span> {
01374                     KiReleaseSpinLock(&amp;ApcThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
01375                     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01376                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01377                 }
01378             }
01379 
01380             KiReleaseSpinLock(&amp;ApcThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
01381         }
01382     }
01383 
01384 
01385     KiAcquireSpinLock(&amp;Thread-&gt;ApcQueueLock);
01386 
01387     Apc-&gt;ApcMode = ApcMode;
01388     Apc-&gt;Thread  = Thread;
01389     Apc-&gt;KernelRoutine   = KernelRoutine;
01390     Apc-&gt;RundownRoutine  = RundownRoutine;
01391     Apc-&gt;NormalRoutine   = NormalRoutine;
01392     Apc-&gt;SystemArgument1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01393     Apc-&gt;SystemArgument2 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01394     Apc-&gt;NormalContext   = NormalContext;
01395 
01396     <span class="comment">//</span>
01397     <span class="comment">// Unlock the target thread APC queue.</span>
01398     <span class="comment">//</span>
01399 
01400     KiReleaseSpinLock(&amp;Thread-&gt;ApcQueueLock);
01401 
01402     <span class="comment">//</span>
01403     <span class="comment">// If APC queuing is enable, then attempt to queue the APC object.</span>
01404     <span class="comment">//</span>
01405 
01406     <span class="keywordflow">if</span> (Thread-&gt;ApcQueueable &amp;&amp; <a class="code" href="../../d0/d0/ki_8h.html#a123">KiInsertQueueApc</a>(Apc, Increment)) {
01407         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01408 
01409         <span class="comment">//</span>
01410         <span class="comment">// If UserMode:</span>
01411         <span class="comment">//    For vdm a UserMode Apc is only queued by a kernel mode</span>
01412         <span class="comment">//    apc which is on the current thread for the target thread.</span>
01413         <span class="comment">//    Force UserApcPending for User mode apcstate, so that</span>
01414         <span class="comment">//    the apc will fire when this thread exits the kernel.</span>
01415         <span class="comment">//</span>
01416 
01417         <span class="keywordflow">if</span> (ApcMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>) {
01418             <a class="code" href="../../d0/d0/ki_8h.html#a14">KiBoostPriorityThread</a>(Thread, Increment);
01419             Thread-&gt;ApcState.UserApcPending = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01420         }
01421 
01422     } <span class="keywordflow">else</span> {
01423         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01424     }
01425 
01426     <span class="comment">//</span>
01427     <span class="comment">// Unlock the dispatcher database, lower IRQL to its previous value, and</span>
01428     <span class="comment">// return whether the APC object was inserted.</span>
01429     <span class="comment">//</span>
01430 
01431     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01432     <span class="keywordflow">return</span> Inserted;
01433 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ke/i386/vdm.c::KeI386VdmInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeI386VdmInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ke/i386/vdm.c::Ki386GetSelectorParameters" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN Ki386GetSelectorParameters           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Selector</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Base</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Limit</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ke/i386/vdm.c::Ki386VdmDispatchIo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN Ki386VdmDispatchIo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PortNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>InstructionSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00307">307</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00036">_VdmEventInfo::Event</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00059">_Vdm_Tib::EventInfo</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d5/d8/ex_8h.html#a302">ExRaiseException()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00037">_VdmEventInfo::InstructionSize</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00039">_VdmEventInfo::IoInfo</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00018">_VdmIoInfo::PortNumber</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00869">Ps386GetVdmIoHandler()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00020">_VdmIoInfo::Read</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00019">_VdmIoInfo::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00535">VdmDispatchIoToHandler()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00672">VdmDispatchUnalignedIoToHandler()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00224">VdmEndExecution()</a>, and <a class="el" href="../../d2/d5/ke_2i386_2vdmp_8h.html#a33a25">VdmIO</a>.
<p>
<pre class="fragment"><div>00316                    :
00317 
00318     This routine sets up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> info <span class="keywordflow">for</span> an IO event, and causes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00319     event to be reflected to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Monitor.
00320 
00321     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed that interrupts are enabled upon entry, and Irql <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00322     at APC level.
00323 
00324 Arguments:
00325 
00326     PortNumber -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port number <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO was done to
00327     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation.
00328     Read -- Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation was a read or a write.
00329     InstructionSize -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO instruction in bytes.
00330 
00331 Return Value:
00332 
00333     True <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io instruction will be reflected to User mode.
00334 
00335 --*/
00336 {
00337     <a class="code" href="../../d0/d6/struct__Vdm__Tib.html">PVDM_TIB</a> VdmTib;
00338     EXCEPTION_RECORD ExceptionRecord;
00339     VDM_IO_HANDLER VdmIoHandler;
00340     ULONG Result;
00341     BOOLEAN Success = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00342     ULONG Context;
00343 
00344     Success = <a class="code" href="../../d3/d2/i386_2psvdm_8c.html#a10">Ps386GetVdmIoHandler</a>(
00345         <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>(),
00346         PortNumber &amp; ~0x3,
00347         &amp;VdmIoHandler,
00348         &amp;Context
00349         );
00350 
00351     <span class="keywordflow">if</span> (Success) {
00352         Result = TrapFrame-&gt;Eax;
00353         <span class="comment">// if port is not aligned, perform unaligned IO</span>
00354         <span class="comment">// else do the io the easy way</span>
00355         <span class="keywordflow">if</span> (PortNumber % <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00356             Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a13">VdmDispatchUnalignedIoToHandler</a>(
00357                 &amp;VdmIoHandler,
00358                 Context,
00359                 PortNumber,
00360                 Size,
00361                 Read,
00362                 &amp;Result
00363                 );
00364         } <span class="keywordflow">else</span> {
00365             Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00366                 &amp;VdmIoHandler,
00367                 Context,
00368                 PortNumber,
00369                 Size,
00370                 Read,
00371                 &amp;Result
00372                 );
00373         }
00374     }
00375 
00376     <span class="keywordflow">if</span> (Success) {
00377         <span class="keywordflow">if</span> (Read) {
00378             <span class="keywordflow">switch</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00379             <span class="keywordflow">case</span> 4:
00380                 TrapFrame-&gt;Eax = Result;
00381                 <span class="keywordflow">break</span>;
00382             <span class="keywordflow">case</span> 2:
00383                 *(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)(&amp;TrapFrame-&gt;Eax) = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Result;
00384                 <span class="keywordflow">break</span>;
00385             <span class="keywordflow">case</span> 1:
00386                 *(PUCHAR)(&amp;TrapFrame-&gt;Eax) = (UCHAR)Result;
00387                 <span class="keywordflow">break</span>;
00388             }
00389         }
00390         TrapFrame-&gt;Eip += (ULONG) InstructionSize;
00391         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00392     } <span class="keywordflow">else</span> {
00393         <span class="keywordflow">try</span> {
00394             VdmTib = 
00395                 ((PVDM_PROCESS_OBJECTS)<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;VdmObjects)-&gt;VdmTib;
00396             VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o2">InstructionSize</a> = (ULONG) InstructionSize;
00397             VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o1">Event</a> = <a class="code" href="../../d2/d5/ke_2i386_2vdmp_8h.html#a33a25">VdmIO</a>;
00398             VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o3">IoInfo</a>.<a class="code" href="../../d3/d6/struct__VdmIoInfo.html#o0">PortNumber</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)PortNumber;
00399             VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o3">IoInfo</a>.<a class="code" href="../../d3/d6/struct__VdmIoInfo.html#o1">Size</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00400             VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o3">IoInfo</a>.<a class="code" href="../../d3/d6/struct__VdmIoInfo.html#o2">Read</a> = Read;
00401         } except(EXCEPTION_EXECUTE_HANDLER) {
00402             ExceptionRecord.ExceptionCode = STATUS_ACCESS_VIOLATION;
00403             ExceptionRecord.ExceptionFlags = 0;
00404             ExceptionRecord.NumberParameters = 0;
00405             <a class="code" href="../../d5/d8/ex_8h.html#a302">ExRaiseException</a>(&amp;ExceptionRecord);
00406             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00407         }
00408     }
00409 
00410     <a class="code" href="../../d7/d7/strtexec_8c.html#a1">VdmEndExecution</a>(TrapFrame, VdmTib);
00411 
00412     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00413 
00414 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ke/i386/vdm.c::Ki386VdmDispatchStringIo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN Ki386VdmDispatchStringIo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PortNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Rep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Address</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>InstructionSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00418">418</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00028">_VdmStringIoInfo::Address</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00027">_VdmStringIoInfo::Count</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00036">_VdmEventInfo::Event</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00059">_Vdm_Tib::EventInfo</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d5/d8/ex_8h.html#a302">ExRaiseException()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00037">_VdmEventInfo::InstructionSize</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00024">_VdmStringIoInfo::PortNumber</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00869">Ps386GetVdmIoHandler()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00026">_VdmStringIoInfo::Read</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00025">_VdmStringIoInfo::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d4/ke_2i386_2vdmp_8h-source.html#l00040">_VdmEventInfo::StringIoInfo</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00777">VdmDispatchStringIoToHandler()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00224">VdmEndExecution()</a>, and <a class="el" href="../../d2/d5/ke_2i386_2vdmp_8h.html#a33a26">VdmStringIO</a>.
<p>
<pre class="fragment"><div>00430                    :
00431 
00432     This routine sets up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> info <span class="keywordflow">for</span> a string IO event, and causes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00433     event to be reflected to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Monitor.
00434 
00435     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed that interrupts are enabled upon entry, and Irql <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00436     at APC level.
00437 
00438 Arguments:
00439 
00440     PortNumber -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port number <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO was done to
00441     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation.
00442     Read -- Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation was a read or a write.
00443     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> -- indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of IO operations of <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> size
00444     Address -- Indicates address <span class="keywordflow">for</span> string io
00445     InstructionSize -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO instruction in bytes.
00446 
00447 
00448 Return Value:
00449 
00450     True <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io instruction will be reflected to User mode.
00451 
00452 
00453 
00454 --*/
00455 {
00456     <a class="code" href="../../d0/d6/struct__Vdm__Tib.html">PVDM_TIB</a> VdmTib;
00457     EXCEPTION_RECORD ExceptionRecord;
00458     BOOLEAN Success = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00459     VDM_IO_HANDLER VdmIoHandler;
00460     ULONG Context;
00461 
00462     Success = <a class="code" href="../../d3/d2/i386_2psvdm_8c.html#a10">Ps386GetVdmIoHandler</a>(
00463         <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>(),
00464         PortNumber &amp; ~0x3,
00465         &amp;VdmIoHandler,
00466         &amp;Context
00467         );
00468 
00469 
00470     <span class="keywordflow">if</span> (Success) {
00471         Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a14">VdmDispatchStringIoToHandler</a>(
00472             &amp;VdmIoHandler,
00473             Context,
00474             PortNumber,
00475             Size,
00476             Count,
00477             Read,
00478             Address
00479             );
00480     }
00481 
00482     <span class="keywordflow">if</span> (Success) {
00483         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a> pIndexRegister;
00484         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00485 
00486         <span class="comment">// WARNING no 32 bit address support</span>
00487 
00488         pIndexRegister = Read ? (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)&amp;TrapFrame-&gt;Edi
00489                               : (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)&amp;TrapFrame-&gt;Esi;
00490 
00491         <span class="keywordflow">if</span> (TrapFrame-&gt;EFlags &amp; EFLAGS_DF_MASK) {
00492             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = *pIndexRegister - (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>);
00493             }
00494         <span class="keywordflow">else</span> {
00495             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = *pIndexRegister + (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>);
00496             }
00497 
00498         *pIndexRegister = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00499 
00500         <span class="keywordflow">if</span> (Rep) {
00501             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)TrapFrame-&gt;Ecx = 0;
00502             }
00503 
00504         TrapFrame-&gt;Eip += (ULONG) InstructionSize;
00505         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00506     }
00507 
00508     <span class="keywordflow">try</span> {
00509         VdmTib = 
00510             ((PVDM_PROCESS_OBJECTS)<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;VdmObjects)-&gt;VdmTib;
00511         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o2">InstructionSize</a> = (ULONG) InstructionSize;
00512         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o1">Event</a> = <a class="code" href="../../d2/d5/ke_2i386_2vdmp_8h.html#a33a26">VdmStringIO</a>;
00513         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o4">StringIoInfo</a>.<a class="code" href="../../d4/d6/struct__VdmStringIoInfo.html#o0">PortNumber</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)PortNumber;
00514         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o4">StringIoInfo</a>.<a class="code" href="../../d4/d6/struct__VdmStringIoInfo.html#o1">Size</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00515         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o4">StringIoInfo</a>.Rep = Rep;
00516         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o4">StringIoInfo</a>.<a class="code" href="../../d4/d6/struct__VdmStringIoInfo.html#o2">Read</a> = Read;
00517         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o4">StringIoInfo</a>.<a class="code" href="../../d4/d6/struct__VdmStringIoInfo.html#o3">Count</a> = <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00518         VdmTib-&gt;<a class="code" href="../../d0/d6/struct__Vdm__Tib.html#o5">EventInfo</a>.<a class="code" href="../../d1/d6/struct__VdmEventInfo.html#o4">StringIoInfo</a>.<a class="code" href="../../d4/d6/struct__VdmStringIoInfo.html#o4">Address</a> = Address;
00519     } except(EXCEPTION_EXECUTE_HANDLER) {
00520         ExceptionRecord.ExceptionCode = STATUS_ACCESS_VIOLATION;
00521         ExceptionRecord.ExceptionFlags = 0;
00522         ExceptionRecord.NumberParameters = 0;
00523         <a class="code" href="../../d5/d8/ex_8h.html#a302">ExRaiseException</a>(&amp;ExceptionRecord);
00524         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00525     }
00526 
00527 
00528     <a class="code" href="../../d7/d7/strtexec_8c.html#a1">VdmEndExecution</a>(TrapFrame, VdmTib);
00529 
00530     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00531 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ke/i386/vdm.c::Ki386VdmEnablePentiumExtentions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG Ki386VdmEnablePentiumExtentions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ke/i386/vdm.c::VdmCallStringIoHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN VdmCallStringIoHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVDM_IO_HANDLER&nbsp;</td>
          <td class="mdname" nowrap> <em>VdmIoHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>StringIoRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PortNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">882</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d5/d2/v86emul_8h-source.html#l00044">EMULATOR_READ_ACCESS</a>, <a class="el" href="../../d5/d2/v86emul_8h-source.html#l00045">EMULATOR_WRITE_ACCESS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d5/d8/ex_8h.html#a302">ExRaiseException()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d2/v86emul_8h-source.html#l00074">PDRIVER_IO_PORT_UCHAR_STRING</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00878">STRINGIO_BUFFER_SIZE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01034">VdmConvertToLinearAddress()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00535">VdmDispatchIoToHandler()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00672">VdmDispatchUnalignedIoToHandler()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00879">VdmStringIoBuffer</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00777">VdmDispatchStringIoToHandler()</a>.
<p>
<pre class="fragment"><div>00894                    :
00895 
00896     This routine actually performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to string io routine.  It takes
00897     care of buffering <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user data in kernel space so that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device driver
00898     does not have to.  If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a string io function, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00899     misaligned, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will be simulated as a series of normal io operations
00900 
00901 Arguments:
00902 
00903     StringIoRoutine -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string Io routine
00904     Context -- Supplies 32 bits of data set when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port was trapped
00905     PortNumber -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port to perform Io to
00906     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io operations
00907     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of Io operations in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string.
00908     Read -- Indicates a read operation
00909     Data -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user buffer to perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io on.
00910 
00911 Returns
00912 
00913     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> a handler was called
00914     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
00915 
00916 --*/
00917 {
00918     ULONG TotalBytes,BytesDone,BytesToDo,LoopCount,NumberIo;
00919     PUCHAR CurrentDataPtr;
00920     UCHAR AccessType;
00921     EXCEPTION_RECORD ExceptionRecord;
00922     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00923     BOOLEAN Success;
00924 
00925     Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a19">VdmConvertToLinearAddress</a>(
00926         Data,
00927         &amp;CurrentDataPtr
00928         );
00929 
00930     <span class="keywordflow">if</span> (!Success) {
00931         ExceptionRecord.ExceptionCode = STATUS_ACCESS_VIOLATION;
00932         ExceptionRecord.ExceptionFlags = 0;
00933         ExceptionRecord.NumberParameters = 0;
00934         <a class="code" href="../../d5/d8/ex_8h.html#a302">ExRaiseException</a>(&amp;ExceptionRecord);
00935         <span class="comment">// Cause kernel exit, rather than Io reflection</span>
00936         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00937     }
00938 
00939 
00940     TotalBytes = <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00941     BytesDone = 0;
00942 
00943     <span class="keywordflow">if</span> (PortNumber % <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00944         StringIoRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00945     }
00946 
00947     <span class="keywordflow">if</span> (Read) {
00948         AccessType = <a class="code" href="../../d4/d3/v86emul_8h.html#a0">EMULATOR_READ_ACCESS</a>;
00949     } <span class="keywordflow">else</span> {
00950         AccessType = <a class="code" href="../../d4/d3/v86emul_8h.html#a1">EMULATOR_WRITE_ACCESS</a>;
00951     }
00952 
00953 
00954     <span class="comment">// Set up try out here to avoid overhead in loop</span>
00955     <span class="keywordflow">try</span> {
00956         <span class="keywordflow">while</span> (BytesDone &lt; TotalBytes) {
00957             <span class="keywordflow">if</span> ((BytesDone + <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a1">STRINGIO_BUFFER_SIZE</a>) &gt; TotalBytes) {
00958                 BytesToDo = TotalBytes - BytesDone;
00959             } <span class="keywordflow">else</span> {
00960                 BytesToDo = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a1">STRINGIO_BUFFER_SIZE</a>;
00961             }
00962 
00963             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((!(BytesToDo % Size)));
00964 
00965             <span class="keywordflow">if</span> (!Read) {
00966                 RtlMoveMemory(VdmStringIoBuffer, CurrentDataPtr, BytesToDo);
00967             }
00968 
00969             NumberIo = BytesToDo / <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00970 
00971             <span class="keywordflow">if</span> (StringIoRoutine) {
00972                 <span class="comment">// in order to avoid having 3 separate calls, one for each size</span>
00973                 <span class="comment">// we simply cast the parameters appropriately for the</span>
00974                 <span class="comment">// byte routine.</span>
00975 
00976                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*((<a class="code" href="../../d4/d3/v86emul_8h.html#a7">PDRIVER_IO_PORT_UCHAR_STRING</a>)StringIoRoutine))(
00977                     Context,
00978                     PortNumber,
00979                     AccessType,
00980                     <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a8">VdmStringIoBuffer</a>,
00981                     NumberIo
00982                     );
00983 
00984                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00985                     Success |= <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00986                 }
00987             } <span class="keywordflow">else</span> {
00988                 <span class="keywordflow">if</span> (PortNumber % <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00989                     <span class="keywordflow">for</span> (LoopCount = 0; LoopCount &lt; NumberIo; LoopCount++ ) {
00990                         Success |= <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a13">VdmDispatchUnalignedIoToHandler</a>(
00991                             VdmIoHandler,
00992                             Context,
00993                             PortNumber,
00994                             Size,
00995                             Read,
00996                             (PULONG)(VdmStringIoBuffer + LoopCount * Size)
00997                             );
00998                     }
00999                 } <span class="keywordflow">else</span> {
01000                     <span class="keywordflow">for</span> (LoopCount = 0; LoopCount &lt; NumberIo; LoopCount++ ) {
01001                         Success |= <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
01002                             VdmIoHandler,
01003                             Context,
01004                             PortNumber,
01005                             Size,
01006                             Read,
01007                             (PULONG)(VdmStringIoBuffer + LoopCount * Size)
01008                             );
01009                     }
01010 
01011                 }
01012             }
01013 
01014             <span class="keywordflow">if</span> (Read) {
01015                 RtlMoveMemory(CurrentDataPtr, VdmStringIoBuffer, BytesToDo);
01016             }
01017 
01018             BytesDone += BytesToDo;
01019             CurrentDataPtr += BytesToDo;
01020         }
01021     } except(EXCEPTION_EXECUTE_HANDLER) {
01022         ExceptionRecord.ExceptionCode = GetExceptionCode();
01023         ExceptionRecord.ExceptionFlags = 0;
01024         ExceptionRecord.NumberParameters = 0;
01025         <a class="code" href="../../d5/d8/ex_8h.html#a302">ExRaiseException</a>(&amp;ExceptionRecord);
01026         <span class="comment">// Cause kernel exit, rather than Io reflection</span>
01027         Success = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01028     }
01029     <span class="keywordflow">return</span> Success;
01030 
01031 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ke/i386/vdm.c::VdmConvertToLinearAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN VdmConvertToLinearAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SegmentedAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>LinearAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01034">1034</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d8/d4/vdmint21_8c.html#a6">Ki386GetSelectorParameters()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>.
<p>
<pre class="fragment"><div>01040                    :
01041 
01042     This routine converts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified segmented address into a linear
01043     address, based on processor mode in user mode.
01044 
01045 Arguments:
01046 
01047     SegmentedAddress -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> segmented address to convert.
01048     LinearAddress -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> destination <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01049         coresponding linear address
01050 
01051 Return Value:
01052 
01053     True <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address was converted.
01054     False otherwise
01055 
01056 Note:
01057 
01058     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> linear address of 0 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a valid <span class="keywordflow">return</span>
01059 --*/
01060 {
01061     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
01062     PKTRAP_FRAME TrapFrame;
01063     BOOLEAN Success;
01064     ULONG Base, Limit, Flags;
01065 
01066     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
01067     TrapFrame = VdmGetTrapFrame(Thread);
01068 
01069     <span class="keywordflow">if</span> (TrapFrame-&gt;EFlags &amp; EFLAGS_V86_MASK) {
01070         *LinearAddress = (PVOID)(((SegmentedAddress &amp; 0xFFFF0000) &gt;&gt; 12) +
01071             (SegmentedAddress &amp; 0xFFFF));
01072         Success = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01073     } <span class="keywordflow">else</span> {
01074         Success = <a class="code" href="../../d8/d4/vdmint21_8c.html#a6">Ki386GetSelectorParameters</a>(
01075             (USHORT)((SegmentedAddress &amp; 0xFFFF0000) &gt;&gt; 16),
01076             &amp;Flags,
01077             &amp;Base,
01078             &amp;Limit
01079             );
01080         <span class="keywordflow">if</span> (Success) {
01081             *LinearAddress = (PVOID)(Base + (SegmentedAddress &amp; 0xFFFF));
01082         }
01083     }
01084     <span class="keywordflow">return</span> Success;
01085 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ke/i386/vdm.c::VdmConvertToLinearAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN VdmConvertToLinearAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SegmentedAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>LinearAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ke/i386/vdm.c::VdmDispatchIoToHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN VdmDispatchIoToHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVDM_IO_HANDLER&nbsp;</td>
          <td class="mdname" nowrap> <em>VdmIoHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PortNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00535">535</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d2/v86emul_8h-source.html#l00044">EMULATOR_READ_ACCESS</a>, <a class="el" href="../../d5/d2/v86emul_8h-source.html#l00045">EMULATOR_WRITE_ACCESS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00307">Ki386VdmDispatchIo()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00672">VdmDispatchUnalignedIoToHandler()</a>.
<p>
<pre class="fragment"><div>00545                    :
00546 
00547      This routine calls <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.  If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a handler
00548      of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proper size, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will call <span class="keyword">this</span> function <span class="keywordflow">for</span> 2 io's to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next
00549      smaller size.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size was a byte, and there was no handler, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00550      <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00551 
00552 Arguments:
00553 
00554     VdmIoHandler -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler table
00555     Context -- Supplies 32 bits of data set when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port was trapped
00556     PortNumber -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port number <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO was done to
00557     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation.
00558     Read -- Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation was a read or a write.
00559     Result -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> location to put <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result
00560 
00561 Return Value:
00562 
00563     True <span class="keywordflow">if</span> one or more handlers were called to take care of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.
00564     False <span class="keywordflow">if</span> no handler was called to take care of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.
00565 
00566 --*/
00567 {
00568     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00569     BOOLEAN Success1, Success2;
00570     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> FnIndex;
00571     UCHAR AccessType;
00572 
00573     <span class="comment">// Insure that Io is aligned</span>
00574     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((!(PortNumber % Size)));
00575 
00576     <span class="keywordflow">if</span> (Read) {
00577         FnIndex = 0;
00578         AccessType = <a class="code" href="../../d4/d3/v86emul_8h.html#a0">EMULATOR_READ_ACCESS</a>;
00579     } <span class="keywordflow">else</span> {
00580         FnIndex = 1;
00581         AccessType = <a class="code" href="../../d4/d3/v86emul_8h.html#a1">EMULATOR_WRITE_ACCESS</a>;
00582     }
00583 
00584     <span class="keywordflow">switch</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00585     <span class="keywordflow">case</span> 1:
00586         <span class="keywordflow">if</span> (VdmIoHandler-&gt;IoFunctions[FnIndex].UcharIo[PortNumber % 4]) {
00587             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*(VdmIoHandler-&gt;IoFunctions[FnIndex].UcharIo[PortNumber % 4]))(
00588                 Context,
00589                 PortNumber,
00590                 AccessType,
00591                 (PUCHAR)Data
00592                 );
00593             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00594                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00595             }
00596         }
00597         <span class="comment">// No handler for this port</span>
00598         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00599 
00600     <span class="keywordflow">case</span> 2:
00601         <span class="keywordflow">if</span> (VdmIoHandler-&gt;IoFunctions[FnIndex].UshortIo[PortNumber % 2]) {
00602             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*(VdmIoHandler-&gt;IoFunctions[FnIndex].UshortIo[PortNumber % 2]))(
00603                 Context,
00604                 PortNumber,
00605                 AccessType,
00606                 (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)Data
00607                 );
00608             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00609                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00610             }
00611         } <span class="keywordflow">else</span> {
00612             <span class="comment">// Dispatch to the two uchar handlers for this ushort port</span>
00613             Success1 = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00614                 VdmIoHandler,
00615                 Context,
00616                 PortNumber,
00617                 Size /2,
00618                 Read,
00619                 Data
00620                 );
00621 
00622             Success2 = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00623                 VdmIoHandler,
00624                 Context,
00625                 PortNumber + 1,
00626                 Size / 2,
00627                 Read,
00628                 (PULONG)((PUCHAR)Data + 1)
00629                 );
00630 
00631             <span class="keywordflow">return</span> (Success1 || Success2);
00632 
00633         }
00634         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00635 
00636     <span class="keywordflow">case</span> 4:
00637         <span class="keywordflow">if</span> (VdmIoHandler-&gt;IoFunctions[FnIndex].UlongIo) {
00638             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*(VdmIoHandler-&gt;IoFunctions[FnIndex].UlongIo))(
00639                 Context,
00640                 PortNumber,
00641                 AccessType,
00642                 Data
00643                 );
00644             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00645                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00646             }
00647         } <span class="keywordflow">else</span> {
00648             <span class="comment">// Dispatch to the two ushort handlers for this port</span>
00649             Success1 = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00650                 VdmIoHandler,
00651                 Context,
00652                 PortNumber,
00653                 Size /2,
00654                 Read,
00655                 Data);
00656             Success2 = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00657                 VdmIoHandler,
00658                 Context,
00659                 PortNumber + 2,
00660                 Size / 2,
00661                 Read,
00662                 (PULONG)((PUSHORT)Data + 1)
00663                 );
00664 
00665             <span class="keywordflow">return</span> (Success1 || Success2);
00666         }
00667         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00668     }
00669 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ke/i386/vdm.c::VdmDispatchStringIoToHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN VdmDispatchStringIoToHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVDM_IO_HANDLER&nbsp;</td>
          <td class="mdname" nowrap> <em>VdmIoHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PortNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00777">777</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00310">KeReleaseMutex()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00150">VdmStringIoMutex</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00418">Ki386VdmDispatchStringIo()</a>.
<p>
<pre class="fragment"><div>00788                    :
00789 
00790      This routine calls <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.  If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a handler
00791      of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proper size, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not aligned, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will simulate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> io
00792      to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> normal io handlers.
00793 
00794 Arguments:
00795 
00796     VdmIoHandler -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler table
00797     Context -- Supplies 32 bits of data set when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port was trapped
00798     PortNumber -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port number <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO was done to
00799     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation.
00800     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of IO operations.
00801     Read -- Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation was a read or a write.
00802     Data -- Supplies a segmented address at which to put <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result.
00803 
00804 Return Value:
00805 
00806     True <span class="keywordflow">if</span> one or more handlers were called to take care of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.
00807     False <span class="keywordflow">if</span> no handler was called to take care of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.
00808 
00809 --*/
00810 {
00811     BOOLEAN Success = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00812     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> FnIndex;
00813     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00814 
00815     <span class="keywordflow">if</span> (Read) {
00816         FnIndex = 0;
00817     } <span class="keywordflow">else</span> {
00818         FnIndex = 1;
00819     }
00820 
00821     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(
00822         &amp;VdmStringIoMutex,
00823         Executive,
00824         KernelMode,
00825         FALSE,
00826         NULL
00827         );
00828 
00829     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00830         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00831     }
00832 
00833     <span class="keywordflow">switch</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00834     <span class="keywordflow">case</span> 1:
00835         Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a15">VdmCallStringIoHandler</a>(
00836             VdmIoHandler,
00837             (PVOID)VdmIoHandler-&gt;IoFunctions[FnIndex].UcharStringIo[PortNumber % 4],
00838             Context,
00839             PortNumber,
00840             Size,
00841             Count,
00842             Read,
00843             Data
00844             );
00845         <span class="keywordflow">break</span>;
00846 
00847     <span class="keywordflow">case</span> 2:
00848         Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a15">VdmCallStringIoHandler</a>(
00849             VdmIoHandler,
00850             (PVOID)VdmIoHandler-&gt;IoFunctions[FnIndex].UshortStringIo[PortNumber % 2],
00851             Context,
00852             PortNumber,
00853             Size,
00854             Count,
00855             Read,
00856             Data
00857             );
00858         <span class="keywordflow">break</span>;
00859 
00860     <span class="keywordflow">case</span> 4:
00861         Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a15">VdmCallStringIoHandler</a>(
00862             VdmIoHandler,
00863             (PVOID)VdmIoHandler-&gt;IoFunctions[FnIndex].UlongStringIo,
00864             Context,
00865             PortNumber,
00866             Size,
00867             Count,
00868             Read,
00869             Data
00870             );
00871         <span class="keywordflow">break</span>;
00872 
00873     }
00874     <a class="code" href="../../d3/d5/mutntobj_8c.html#a5">KeReleaseMutex</a>(&amp;VdmStringIoMutex, FALSE);
00875     <span class="keywordflow">return</span> Success;
00876 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ke/i386/vdm.c::VdmDispatchUnalignedIoToHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN VdmDispatchUnalignedIoToHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVDM_IO_HANDLER&nbsp;</td>
          <td class="mdname" nowrap> <em>VdmIoHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PortNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00672">672</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00535">VdmDispatchIoToHandler()</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00307">Ki386VdmDispatchIo()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>.
<p>
<pre class="fragment"><div>00682                    :
00683 
00684      This routine converts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unaligned IO to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> necessary number of aligned
00685      IOs to smaller ports.
00686 
00687 Arguments:
00688 
00689     VdmIoHandler -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler table
00690     Context -- Supplies 32 bits of data set when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port was trapped
00691     PortNumber -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port number <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO was done to
00692     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -- Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation.
00693     Read -- Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO operation was a read or a write.
00694     Result -- Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> location to put <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result
00695 
00696 Return Value:
00697 
00698     True <span class="keywordflow">if</span> one or more handlers were called to take care of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.
00699     False <span class="keywordflow">if</span> no handler was called to take care of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IO.
00700 
00701 --*/
00702 {
00703     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00704     BOOLEAN Success;
00705 
00706     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Size &gt; 1));
00707     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((PortNumber % Size));
00708 
00709     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = 0;
00710 
00711     <span class="comment">//</span>
00712     <span class="comment">//  The possible unaligned io situations are as follows.</span>
00713     <span class="comment">//</span>
00714     <span class="comment">//  1.  Uchar aligned Ulong io</span>
00715     <span class="comment">//          We have to dispatch a uchar io, a ushort io, and a uchar io</span>
00716     <span class="comment">//</span>
00717     <span class="comment">//  2.  Ushort aligned Ulong Io</span>
00718     <span class="comment">//          We have to dispatch a ushort io, and a ushort io</span>
00719     <span class="comment">//</span>
00720     <span class="comment">//  3.  Uchar aligned Ushort Io</span>
00721     <span class="comment">//          We have to dispatch a uchar io and a uchar io</span>
00722     <span class="comment">//</span>
00723 
00724     <span class="comment">// if the port is uchar aligned</span>
00725     <span class="keywordflow">if</span> ((PortNumber % <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) &amp; 1) {
00726         Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00727             VdmIoHandler,
00728             Context,
00729             PortNumber,
00730             1,
00731             Read,
00732             Data
00733             );
00734         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> += 1;
00735     <span class="comment">// else it is ushort aligned (and therefore must be a ulong port)</span>
00736     } <span class="keywordflow">else</span> {
00737         Success = <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00738             VdmIoHandler,
00739             Context,
00740             PortNumber,
00741             2,
00742             Read,
00743             Data
00744             );
00745         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> += 2;
00746     }
00747 
00748     <span class="comment">// if it is a ulong port, we know we have a ushort IO to dispatch</span>
00749     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> == 4) {
00750         Success |= <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00751             VdmIoHandler,
00752             Context,
00753             PortNumber + Offset,
00754             2,
00755             Read,
00756             (PULONG)((PUCHAR)Data + Offset)
00757             );
00758         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> += 2;
00759     }
00760 
00761     <span class="comment">// If we haven't dispatched the entire port, dispatch the final uchar</span>
00762     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> != 4) {
00763         Success |= <a class="code" href="../../d9/d3/ke_2i386_2vdm_8c.html#a12">VdmDispatchIoToHandler</a>(
00764             VdmIoHandler,
00765             Context,
00766             PortNumber + Offset,
00767             1,
00768             Read,
00769             (PULONG)((PUCHAR)Data + Offset)
00770             );
00771     }
00772 
00773     <span class="keywordflow">return</span> Success;
00774 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="ke/i386/vdm.c::KeI386EFlagsAndMaskV86" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a4">KeI386EFlagsAndMaskV86</a> = EFLAGS_USER_SANITIZE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00153">153</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ke/i386/vdm.c::KeI386EFlagsOrMaskV86" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a5">KeI386EFlagsOrMaskV86</a> = EFLAGS_INTERRUPT_MASK          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00154">154</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ke/i386/vdm.c::KeI386VdmIoplAllowed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a6">KeI386VdmIoplAllowed</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00155">155</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>, <a class="el" href="../../d6/d3/vdmentry_8c-source.html#l00051">NtVdmControl()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00477">VdmDispatchInterrupts()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00224">VdmEndExecution()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01870">VdmpDispatchableIntPending()</a>, and <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00040">VdmpStartExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ke/i386/vdm.c::KeI386VirtualIntExtensions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a7">KeI386VirtualIntExtensions</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00156">156</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>, <a class="el" href="../../d6/d3/vdmentry_8c-source.html#l00051">NtVdmControl()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00477">VdmDispatchInterrupts()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00224">VdmEndExecution()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01870">VdmpDispatchableIntPending()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00232">VdmpQueueIntApcRoutine()</a>, and <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00040">VdmpStartExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ke/i386/vdm.c::VdmFixedStateLinear" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d4/ke_2ia64_2vdm_8c.html#a5">VdmFixedStateLinear</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00151">151</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>, and <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00040">VdmpStartExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ke/i386/vdm.c::VdmStringIoBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d9/d3/ke_2i386_2vdm_8c.html#a8">VdmStringIoBuffer</a>[STRINGIO_BUFFER_SIZE]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00879">879</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ke/i386/vdm.c::VdmStringIoMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d7/struct__KMUTANT.html">KMUTEX</a> <a class="el" href="../../d0/d4/ke_2ia64_2vdm_8c.html#a4">VdmStringIoMutex</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00150">150</a> of file <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html">ke/i386/vdm.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00777">VdmDispatchStringIoToHandler()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:07 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
