<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: perform.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>perform.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;memory.h&gt;</code><br>
<code>#include &lt;wchar.h&gt;</code><br>
<code>#include "windows.h"</code><br>
<code>#include "winreg.h"</code><br>

<p>
<a href="../../d0/d4/perform_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a0">TEST_STRING</a>&nbsp;&nbsp;&nbsp;"Test <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a1">TEST_STRING_W</a>&nbsp;&nbsp;&nbsp;L"Test <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a2">ENVIRONMENT_NAME</a>&nbsp;&nbsp;&nbsp;L"Environment"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a3">TESTKEY_NAME</a>&nbsp;&nbsp;&nbsp;L"TestKey"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a4">TESTKEY_FULL_NAME</a>&nbsp;&nbsp;&nbsp;L"Environment\\TestKey"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a5">KEY1_NAME</a>&nbsp;&nbsp;&nbsp;L"Key1"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a6">KEY1_FULL_NAME</a>&nbsp;&nbsp;&nbsp;L"Environment\\TestKey\\Key1"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a7">KEY2_NAME</a>&nbsp;&nbsp;&nbsp;L"Key2"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a8">KEY2_FULL_NAME</a>&nbsp;&nbsp;&nbsp;L"Environment\\TestKey\\Key2"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a9">VALUE_NAME</a>&nbsp;&nbsp;&nbsp;L"123"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a10">VALUE_DATA</a>&nbsp;&nbsp;&nbsp;L"This <a class="el" href="../../d3/d0/user32_8def.html#a108">is</a> a string"</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a11">AdjustPrivilege</a> (PSTR SecurityNameString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d1/bench_8h.html#a7">INT</a> __cdecl&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/perform_8c.html#a12">main</a> ()</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="perform.c::ENVIRONMENT_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ENVIRONMENT_NAME&nbsp;&nbsp;&nbsp;L"Environment"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00067">67</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="perform.c::KEY1_FULL_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY1_FULL_NAME&nbsp;&nbsp;&nbsp;L"Environment\\TestKey\\Key1"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00071">71</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="perform.c::KEY1_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY1_NAME&nbsp;&nbsp;&nbsp;L"Key1"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00070">70</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="perform.c::KEY2_FULL_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY2_FULL_NAME&nbsp;&nbsp;&nbsp;L"Environment\\TestKey\\Key2"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00073">73</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="perform.c::KEY2_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY2_NAME&nbsp;&nbsp;&nbsp;L"Key2"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00072">72</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="perform.c::TEST_STRING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TEST_STRING&nbsp;&nbsp;&nbsp;"Test <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00009">9</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="perform.c::TEST_STRING_W" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TEST_STRING_W&nbsp;&nbsp;&nbsp;L"Test <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00010">10</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="perform.c::TESTKEY_FULL_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TESTKEY_FULL_NAME&nbsp;&nbsp;&nbsp;L"Environment\\TestKey"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00069">69</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="perform.c::TESTKEY_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TESTKEY_NAME&nbsp;&nbsp;&nbsp;L"TestKey"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00068">68</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="perform.c::VALUE_DATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VALUE_DATA&nbsp;&nbsp;&nbsp;L"This <a class="el" href="../../d3/d0/user32_8def.html#a108">is</a> a string"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00075">75</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="perform.c::VALUE_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VALUE_NAME&nbsp;&nbsp;&nbsp;L"123"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00074">74</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">main()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="perform.c::AdjustPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN AdjustPrivilege           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSTR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityNameString</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00015">15</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00018 {
00019     HANDLE              TokenHandle;
00020     LUID_AND_ATTRIBUTES LuidAndAttributes;
00021 <span class="comment">//    PSTR                SecurityNameString;</span>
00022 
00023     TOKEN_PRIVILEGES    TokenPrivileges;
00024     TOKEN_PRIVILEGES    PreviousTokenPrivileges;
00025     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>               ReturnLength;
00026 
00027     <span class="keywordflow">if</span>( !OpenProcessToken( GetCurrentProcess(),
00028                            TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY,
00029                            &amp;TokenHandle ) ) {
00030         printf( <span class="stringliteral">"OpenProcessToken failed \n"</span> );
00031         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00032     }
00033 
00034 <span class="comment">//    SecurityNameString = SE_RESTORE_NAME; // SE_SECURITY_NAME;</span>
00035 
00036     <span class="keywordflow">if</span>( !LookupPrivilegeValue( NULL,
00037                                SecurityNameString,
00038                                &amp;( LuidAndAttributes.Luid ) ) ) {
00039         printf( <span class="stringliteral">"LookupPrivilegeValue failed, Error = %#x \n"</span>, GetLastError() );
00040         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00041     }
00042 
00043     LuidAndAttributes.Attributes = SE_PRIVILEGE_ENABLED;
00044     TokenPrivileges.PrivilegeCount = 1;
00045     TokenPrivileges.Privileges[0] = LuidAndAttributes;
00046 
00047     <span class="keywordflow">if</span>( !AdjustTokenPrivileges( TokenHandle,
00048                                 FALSE,
00049                                 &amp;TokenPrivileges,
00050                                 0,
00051                                 NULL,
00052                                 NULL ) ) {
00053         printf( <span class="stringliteral">"AdjustTokenPrivileges failed, Error = %#x \n"</span>, GetLastError() );
00054         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00055     }
00056 
00057 
00058     <span class="keywordflow">if</span>( GetLastError() != NO_ERROR ) {
00059         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00060     }
00061 
00062     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00063 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="perform.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d1/bench_8h.html#a7">INT</a> __cdecl main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/perform_8c-source.html#l00080">80</a> of file <a class="el" href="../../d0/d4/perform_8c-source.html">perform.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d0/d4/perform_8c-source.html#l00067">ENVIRONMENT_NAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d4/perform_8c-source.html#l00070">KEY1_NAME</a>, <a class="el" href="../../d0/d4/perform_8c-source.html#l00072">KEY2_NAME</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d4/perform_8c-source.html#l00069">TESTKEY_FULL_NAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d4/perform_8c-source.html#l00075">VALUE_DATA</a>, and <a class="el" href="../../d0/d4/perform_8c-source.html#l00074">VALUE_NAME</a>.
<p>
<pre class="fragment"><div>00081 {
00082     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00083 
00084     HKEY        TestKeyHandle;
00085     HKEY        Key1Handle;
00086     HKEY        Key2Handle;
00087     HKEY        EnvironmentHandle;
00088 
00089     WCHAR       ValueData[] = <a class="code" href="../../d9/d4/perform_8c.html#a10">VALUE_DATA</a>;
00090 
00091     WCHAR       BufferForKeyName[100];
00092     WCHAR       BufferForKeyClass[100];
00093     WCHAR       BufferForValueEntryName[100];
00094     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        BufferForValueEntryData[100];
00095 
00096 
00097     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       DataType;
00098     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       DataSize;
00099     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       NameSize;
00100     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       ClassSize;
00101 
00102 
00103     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       cSubKeys;
00104     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       cbMaxSubkey;
00105     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       cbMaxClass;
00106     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       cValues;
00107     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       vbMaxValueName;
00108     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       cbMaxValueData;
00109     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       cbSecurityDescriptor;
00110     FILETIME    ftLastWriteTime;
00111 
00112 
00113     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        BufferForSecurityDescriptor[2048];
00114 
00115     HANDLE      NotificationEvent;
00116 
00117     PWSTR       File1 = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"d:\\File1"</span>;
00118     PWSTR       File2 = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"d:\\File2"</span>;
00119     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       Disposition;
00120 
00121 
00122 
00123 <span class="comment">/*</span>
00124 <span class="comment">    Key = NULL;</span>
00125 <span class="comment">    Status = RegOpenKeyExW( HKEY_CURRENT_USER,</span>
00126 <span class="comment">                            L"",</span>
00127 <span class="comment">                            0,</span>
00128 <span class="comment">                            MAXIMUM_ALLOWED,</span>
00129 <span class="comment">                            &amp;Key );</span>
00130 <span class="comment">*/</span>
00131 
00132 
00133 
00134 
00135 
00136 
00137 
00138 
00139 <span class="comment">//    AdjustPrivilege( SE_BACKUP_NAME );</span>
00140 <span class="comment">//    AdjustPrivilege( SE_RESTORE_NAME );</span>
00141 
00142 
00143     NotificationEvent = CreateEvent( NULL,
00144                                      FALSE,
00145                                      FALSE,
00146                                      NULL );
00147 
00148     <span class="keywordflow">if</span>( NotificationEvent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00149         printf( <span class="stringliteral">"CreateEvent failed, ErrorCode = %d \n"</span>, GetLastError() );
00150     }
00151 
00152 
00153 
00154     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegOpenKeyExW( HKEY_CURRENT_USER,
00155                             TESTKEY_FULL_NAME,
00156                             0,
00157                             MAXIMUM_ALLOWED,
00158                             &amp;TestKeyHandle );
00159 
00160     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00161         printf( <span class="stringliteral">"RegOpenKeyExW failed, Status = %d \n"</span>, Status );
00162     } <span class="keywordflow">else</span> {
00163         printf( <span class="stringliteral">"RegOpenKeyExW succeeded \n"</span> );
00164     }
00165 
00166 
00167     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegOpenKeyW( HKEY_CURRENT_USER,
00168                           ENVIRONMENT_NAME,
00169                           &amp;EnvironmentHandle );
00170 
00171     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00172         printf( <span class="stringliteral">"RegOpenKeyW failed, Status = %d \n"</span>, Status );
00173     } <span class="keywordflow">else</span> {
00174         printf( <span class="stringliteral">"RegOpenKeyW succeeded \n"</span> );
00175     }
00176 
00177 
00178 
00179 
00180 
00181 
00182     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegCreateKeyExW( TestKeyHandle,
00183                               KEY1_NAME,
00184                               NULL,
00185                               NULL,
00186                               REG_OPTION_NON_VOLATILE,
00187                               MAXIMUM_ALLOWED,
00188                               NULL,
00189                               &amp;Key1Handle,
00190                               &amp;Disposition );
00191 
00192     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00193         printf( <span class="stringliteral">"RegCreateKeyExW failed, Status = %d \n"</span>, Status );
00194     } <span class="keywordflow">else</span> {
00195         printf( <span class="stringliteral">"RegCreateKeyExW succeeded \n"</span> );
00196     }
00197 
00198 
00199 
00200     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegCreateKeyW( TestKeyHandle,
00201                             KEY2_NAME,
00202                             &amp;Key2Handle );
00203 
00204 
00205     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00206         printf( <span class="stringliteral">"RegCreateKeyW failed, Status = %d \n"</span>, Status );
00207     } <span class="keywordflow">else</span> {
00208         printf( <span class="stringliteral">"RegCreateKeyW succeeded \n"</span> );
00209     }
00210 
00211 
00212     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegSetValueExW( Key1Handle,
00213                              VALUE_NAME,
00214                              NULL,
00215                              REG_SZ,
00216                              ValueData,
00217                              <span class="keyword">sizeof</span>( ValueData ) );
00218 
00219     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00220         printf( <span class="stringliteral">"RegSetValueExW failed, Status = %d \n"</span>, Status );
00221     } <span class="keywordflow">else</span> {
00222         printf( <span class="stringliteral">"RegSetValueExW succeeded \n"</span> );
00223     }
00224 
00225 
00226     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegSetValueW( Key1Handle,
00227                              NULL,
00228                              REG_SZ,
00229                              ValueData,
00230                              <span class="keyword">sizeof</span>( ValueData ) );
00231 
00232     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00233         printf( <span class="stringliteral">"RegSetValueW failed, Status = %d \n"</span>, Status );
00234     } <span class="keywordflow">else</span> {
00235         printf( <span class="stringliteral">"RegSetValueW succeeded \n"</span> );
00236     }
00237 
00238 
00239 
00240     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegFlushKey( Key1Handle );
00241     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00242         printf( <span class="stringliteral">"RegFlushKey failed, Status = %d \n"</span>, Status );
00243     } <span class="keywordflow">else</span> {
00244         printf( <span class="stringliteral">"RegFlushKey succeeded \n"</span> );
00245     }
00246 
00247 
00248 
00249 
00250     DataSize = <span class="keyword">sizeof</span>( BufferForValueEntryData );
00251     memset( BufferForValueEntryData, <span class="charliteral">'\0'</span>, DataSize );
00252     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegQueryValueExW( Key1Handle,
00253                                VALUE_NAME,
00254                                NULL,
00255                                &amp;DataType,
00256                                BufferForValueEntryData,
00257                                &amp;DataSize );
00258 
00259     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00260         printf( <span class="stringliteral">"RegQueryValueExW failed, Status = %d \n"</span>, Status );
00261     } <span class="keywordflow">else</span> {
00262         printf( <span class="stringliteral">"RegQueryValueExW succeeded \n"</span> );
00263     }
00264 
00265 
00266 
00267     DataSize = <span class="keyword">sizeof</span>( BufferForValueEntryData );
00268     memset( BufferForValueEntryData, <span class="charliteral">'\0'</span>, DataSize );
00269     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegQueryValueW( Key1Handle,
00270                              NULL,
00271                              BufferForValueEntryData,
00272                              &amp;DataSize );
00273 
00274 
00275     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00276         printf( <span class="stringliteral">"RegQueryValueW failed, Status = %d \n"</span>, Status );
00277     } <span class="keywordflow">else</span> {
00278         printf( <span class="stringliteral">"RegQueryValueW succeeded \n"</span> );
00279     }
00280 
00281 
00282     DataSize = <span class="keyword">sizeof</span>( BufferForValueEntryData );
00283     memset( BufferForValueEntryData, <span class="charliteral">'X'</span>, DataSize );
00284     NameSize = <span class="keyword">sizeof</span>( BufferForValueEntryName );
00285     memset( BufferForValueEntryName, <span class="charliteral">'X'</span>, NameSize );
00286 
00287     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegEnumValueW( Key1Handle,
00288                             0,
00289                             BufferForValueEntryName,
00290                             &amp;NameSize,
00291                             NULL,
00292                             &amp;DataType,
00293                             BufferForValueEntryData,
00294                             &amp;DataSize );
00295 
00296 
00297     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00298         printf( <span class="stringliteral">"RegEnumValueW failed, Status = %d \n"</span>, Status );
00299     } <span class="keywordflow">else</span> {
00300         printf( <span class="stringliteral">"RegEnumValueW succeeded \n"</span> );
00301     }
00302 
00303 
00304     NameSize = <span class="keyword">sizeof</span>( BufferForKeyName );
00305     ClassSize = <span class="keyword">sizeof</span>( BufferForKeyClass );
00306     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegEnumKeyExW( TestKeyHandle,
00307                             0,
00308                             BufferForKeyName,
00309                             &amp;NameSize,
00310                             NULL,
00311                             BufferForKeyClass,
00312                             &amp;ClassSize,
00313                             &amp;ftLastWriteTime );
00314 
00315     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00316         printf( <span class="stringliteral">"RegEnumKeyExW failed, Status = %d \n"</span>, Status );
00317     } <span class="keywordflow">else</span> {
00318         printf( <span class="stringliteral">"RegEnumKeyExW succeeded \n"</span> );
00319     }
00320 
00321 
00322     NameSize = <span class="keyword">sizeof</span>( BufferForKeyName );
00323     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegEnumKeyW( TestKeyHandle,
00324                           0,
00325                           BufferForKeyName,
00326                           &amp;NameSize );
00327 
00328     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00329         printf( <span class="stringliteral">"RegEnumKeyW failed, Status = %d \n"</span>, Status );
00330     } <span class="keywordflow">else</span> {
00331         printf( <span class="stringliteral">"RegEnumKeyW succeeded \n"</span> );
00332     }
00333 
00334 
00335     ClassSize = <span class="keyword">sizeof</span>( BufferForKeyClass );
00336     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegQueryInfoKeyW( Key1Handle,
00337                                BufferForKeyClass,
00338                                &amp;ClassSize,
00339                                NULL,
00340                                &amp;cSubKeys,
00341                                &amp;cbMaxSubkey,
00342                                &amp;cbMaxClass,
00343                                &amp;cValues,
00344                                &amp;vbMaxValueName,
00345                                &amp;cbMaxValueData,
00346                                &amp;cbSecurityDescriptor,
00347                                &amp;ftLastWriteTime );
00348 
00349 
00350 
00351     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00352         printf( <span class="stringliteral">"RegQueryInfoKeyW failed, Status = %d \n"</span>, Status );
00353     } <span class="keywordflow">else</span> {
00354         printf( <span class="stringliteral">"RegQueryInfoKeyW succeeded \n"</span> );
00355     }
00356 
00357 
00358     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegGetKeySecurity( Key1Handle,
00359                                 DACL_SECURITY_INFORMATION,
00360                                 ( PSECURITY_DESCRIPTOR )BufferForSecurityDescriptor,
00361                                 &amp;cbSecurityDescriptor );
00362 
00363     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00364         printf( <span class="stringliteral">"RegGetKeySecurity failed, Status = %d \n"</span>, Status );
00365     } <span class="keywordflow">else</span> {
00366         printf( <span class="stringliteral">"RegGetKeySecurity succeeded \n"</span> );
00367     }
00368 
00369 
00370 
00371     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegSetKeySecurity( Key1Handle,
00372                                 DACL_SECURITY_INFORMATION,
00373                                 ( PSECURITY_DESCRIPTOR )BufferForSecurityDescriptor );
00374 
00375     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00376         printf( <span class="stringliteral">"RegSetKeySecurity failed, Status = %d \n"</span>, Status );
00377     } <span class="keywordflow">else</span> {
00378         printf( <span class="stringliteral">"RegSetKeySecurity succeeded \n"</span> );
00379     }
00380 
00381 <span class="comment">/*</span>
00382 <span class="comment">    Status = RegSaveKeyW( Key1Handle,</span>
00383 <span class="comment">                          File1,</span>
00384 <span class="comment">                          NULL );</span>
00385 <span class="comment"></span>
00386 <span class="comment"></span>
00387 <span class="comment">    if( Status != 0 ) {</span>
00388 <span class="comment">        printf( "RegSaveKeyW failed, Status = %d \n", Status );</span>
00389 <span class="comment">    } else {</span>
00390 <span class="comment">        printf( "RegSaveKeyW succeeded \n" );</span>
00391 <span class="comment">    }</span>
00392 <span class="comment"></span>
00393 <span class="comment"></span>
00394 <span class="comment"></span>
00395 <span class="comment">    Status = RegRestoreKeyW( Key2Handle,</span>
00396 <span class="comment">                             File1,</span>
00397 <span class="comment">                             0 );</span>
00398 <span class="comment"></span>
00399 <span class="comment"></span>
00400 <span class="comment">    if( Status != 0 ) {</span>
00401 <span class="comment">        printf( "RegRestoreKeyW failed, Status = %d \n", Status );</span>
00402 <span class="comment">    } else {</span>
00403 <span class="comment">        printf( "RegRestoreKeyW succeeded \n" );</span>
00404 <span class="comment">    }</span>
00405 <span class="comment">*/</span>
00406 
00407     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegDeleteValueW( Key1Handle,
00408                               VALUE_NAME );
00409 
00410 
00411     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00412         printf( <span class="stringliteral">"RegDeleteValueW failed, Status = %d \n"</span>, Status );
00413     } <span class="keywordflow">else</span> {
00414         printf( <span class="stringliteral">"RegDeleteValueW succeeded \n"</span> );
00415     }
00416 
00417 
00418     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegCloseKey( Key1Handle );
00419 
00420     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00421         printf( <span class="stringliteral">"RegCloseKey failed, Status = %d \n"</span>, Status );
00422     } <span class="keywordflow">else</span> {
00423         printf( <span class="stringliteral">"RegCloseKey succeeded \n"</span> );
00424     }
00425 
00426     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegDeleteKeyW( TestKeyHandle,
00427                             KEY1_NAME );
00428 
00429     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00430         printf( <span class="stringliteral">"RegCloseKey failed, Status = %d \n"</span>, Status );
00431     } <span class="keywordflow">else</span> {
00432         printf( <span class="stringliteral">"RegCloseKey succeeded \n"</span> );
00433     }
00434 
00435 
00436     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RegNotifyChangeKeyValue( HKEY_CURRENT_USER,
00437                                       TRUE,
00438                                       REG_NOTIFY_CHANGE_NAME |
00439                                       REG_NOTIFY_CHANGE_ATTRIBUTES |
00440                                       REG_NOTIFY_CHANGE_LAST_SET |
00441                                       REG_NOTIFY_CHANGE_SECURITY,
00442                                       NotificationEvent,
00443                                       TRUE );
00444 
00445     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != 0 ) {
00446         printf( <span class="stringliteral">"RegNotifyChangeKeyValue failed, Status = %d \n"</span>, Status );
00447     } <span class="keywordflow">else</span> {
00448         printf( <span class="stringliteral">"RegNotifyChangeKeyValue succeeded \n"</span> );
00449     }
00450 
00451 
00452     <span class="comment">//</span>
00453     <span class="comment">//  Cleanup</span>
00454     <span class="comment">//</span>
00455 
00456     CloseHandle( NotificationEvent );
00457 <span class="comment">//    DeleteFileW( File1 );</span>
00458     RegCloseKey( Key2Handle );
00459     RegDeleteKeyW( TestKeyHandle,
00460                    KEY2_NAME );
00461 
00462 
00463 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:02 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
