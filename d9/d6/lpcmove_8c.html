<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lpcmove.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lpcmove.c File Reference</h1><code>#include "<a class="el" href="../../d1/d6/lpcp_8h-source.html">lpcp.h</a>"</code><br>

<p>
<a href="../../d0/d6/lpcmove_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/lpcmove_8c.html#a0">LpcpMoveMessage</a> (OUT PPORT_MESSAGE DstMsg, IN PPORT_MESSAGE SrcMsg, IN PUCHAR SrcMsgData, IN ULONG MsgType OPTIONAL, IN PCLIENT_ID ClientId OPTIONAL)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="lpcmove.c::LpcpMoveMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID LpcpMoveMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PPORT_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>DstMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPORT_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>SrcMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>SrcMsgData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG MsgType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID ClientId&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Copyright (C) 1996-97 Intel Corporation. All rights reserved.<p>
The information and source code contained herein is the exclusive property of Intel Corporation and may not be disclosed, examined or reproduced in whole or in part without explicit written authorization from the company. 
<p>
Definition at line <a class="el" href="../../d0/d6/lpcmove_8c-source.html#l00038">38</a> of file <a class="el" href="../../d0/d6/lpcmove_8c-source.html">lpcmove.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00048                    :
00049 
00050     This function moves an LPC message block and optionally sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message
00051     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and client <span class="keywordtype">id</span> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified values.
00052 
00053 Arguments:
00054 
00055     DstMsg     - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> destination message.
00056 
00057     SrcMsg     - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source message.
00058 
00059     SrcMsgData - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source message data to
00060                  copy to destination.
00061 
00062     MsgType    - If non-zero, then store in <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00063                  destination message.
00064 
00065     ClientId   - If non-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, then points to a ClientId to copy to
00066                  <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> destination message.
00067 
00068 Return Value:
00069 
00070     None
00071 
00072 --*/
00073 
00074 {
00075     ULONG NumberDwords;
00076     ULONGLONG Temp1, Temp2, Temp3;
00077 
00078     <span class="comment">//</span>
00079     <span class="comment">// Extract the data length and copy over the first dword</span>
00080     <span class="comment">//</span>
00081 
00082     *((PULONG)DstMsg)++ = NumberDwords = *((PULONG)SrcMsg)++;
00083     NumberDwords = ((0x0000FFFF &amp; NumberDwords) + 3) &gt;&gt; 2;
00084 
00085     <span class="comment">//</span>
00086     <span class="comment">// Set the message type properly and update the second dword</span>
00087     <span class="comment">//</span>
00088 
00089     *((PULONG)DstMsg)++ = MsgType == 0 ? *((PULONG)SrcMsg)++ :
00090                          *((PULONG)SrcMsg)++ &amp; 0xFFFF0000 | MsgType &amp; 0xFFFF;
00091 
00092     <span class="comment">//</span>
00093     <span class="comment">// Set the ClientId appropriately and update the third dword</span>
00094     <span class="comment">//</span>
00095 
00096     *((PULONG_PTR)DstMsg)++ = ClientId == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? *((PULONG_PTR)SrcMsg) :
00097             *((PULONG_PTR)ClientId)++;
00098     ((PULONG_PTR)SrcMsg)++;
00099 
00100     *((PULONG_PTR)DstMsg)++ = ClientId == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? *((PULONG_PTR)SrcMsg) :
00101             *((PULONG_PTR)ClientId);
00102     ((PULONG_PTR)SrcMsg)++;
00103 
00104     <span class="comment">//</span>
00105     <span class="comment">// Update the final two longwords in the header</span>
00106     <span class="comment">//</span>
00107 
00108     *((PULONG_PTR)DstMsg)++ = *((PULONG_PTR)SrcMsg)++;
00109     *((PULONG_PTR)DstMsg)++ = *((PULONG_PTR)SrcMsg)++;
00110 
00111     <span class="comment">//</span>
00112     <span class="comment">// Copy the data</span>
00113     <span class="comment">//</span>
00114 
00115     <span class="keywordflow">if</span> (NumberDwords &gt; 0) {
00116 
00117         <span class="keywordflow">if</span> ((ULONG_PTR) SrcMsgData &amp; (<span class="keyword">sizeof</span>(ULONGLONG)-1)) {
00118 
00119             <span class="comment">//</span>
00120             <span class="comment">// SrcMsgData is 4-byte aligned while DstMsg is 8-byte aligned.</span>
00121             <span class="comment">//</span>
00122 
00123             Temp1 = *((PULONG) SrcMsgData)++;
00124 
00125             <span class="keywordflow">while</span> (NumberDwords &gt;= 3) {
00126 
00127                 Temp2 = *((PULONGLONG)SrcMsgData)++;
00128                 *((PULONGLONG)DstMsg)++ = (Temp2 &lt;&lt; 32) | Temp1;
00129                 Temp1 = Temp2 &amp; 0x0000FFFF;
00130                 NumberDwords -= <span class="keyword">sizeof</span>(ULONGLONG) / <span class="keyword">sizeof</span>(ULONG);
00131             }
00132 
00133             *(PULONG)DstMsg = (ULONG)Temp1;
00134             NumberDwords--;
00135 
00136         } <span class="keywordflow">else</span> {
00137 
00138             <span class="comment">// </span>
00139             <span class="comment">// Both DstMsg and SrcMsgData are 8-byte aligned;</span>
00140             <span class="comment">// copy 2 dwords (1 qword) at a time.</span>
00141             <span class="comment">// </span>
00142 
00143             <span class="keywordflow">while</span> (NumberDwords &gt;= <span class="keyword">sizeof</span>(ULONGLONG) / <span class="keyword">sizeof</span>(ULONG)) {
00144 
00145                 *((PULONGLONG)DstMsg)++ = *((PULONGLONG)SrcMsgData)++;
00146                 NumberDwords -= <span class="keyword">sizeof</span>(ULONGLONG) / <span class="keyword">sizeof</span>(ULONG);
00147             }
00148         }
00149 
00150         <span class="comment">//</span>
00151         <span class="comment">// copy the remaining dwords, if any</span>
00152         <span class="comment">//</span>
00153     
00154         <span class="keywordflow">while</span> (NumberDwords--) {
00155             *((PULONG)DstMsg)++ = *((PULONG)SrcMsgData)++;
00156         }
00157     }
00158 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:34 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
