<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: client/stream.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>stream.c File Reference</h1><code>#include "<a class="el" href="../../d5/d2/w32_2ntcon_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d0/d6/client_2stream_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a1">GetConsoleInputWaitHandle</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a2">OpenConsoleWInternal</a> (IN ULONG HandleType, IN ULONG DesiredAccess, IN BOOL InheritHandle, IN ULONG ShareMode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a3">OpenConsoleW</a> (IN LPWSTR lpConsoleDevice, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesiredAccess, IN BOOL bInheritHandle, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwShareMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a4">ReadConsoleInternal</a> (IN HANDLE hConsoleInput, OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpBuffer, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nNumberOfCharsToRead, OUT LPDWORD lpNumberOfCharsRead, IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpReserved, IN BOOLEAN <a class="el" href="../../d3/d0/user32_8def.html#a97">Unicode</a>, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d8/d9/dllinit_8c.html#a5">ExeNameLength</a>, IN LPWSTR ExeName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a5">ReadConsoleA</a> (IN HANDLE hConsoleInput, OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpBuffer, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nNumberOfCharsToRead, OUT LPDWORD lpNumberOfCharsRead, IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpReserved)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW6432)  <a href="#a5"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a6">ReadConsoleW</a> (IN HANDLE hConsoleInput, OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpBuffer, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nNumberOfCharsToRead, OUT LPDWORD lpNumberOfCharsRead, IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a7">WriteConsoleInternal</a> (IN HANDLE hConsoleOutput, IN CONST VOID *lpBuffer, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nNumberOfCharsToWrite, OUT LPDWORD lpNumberOfCharsWritten, IN BOOLEAN <a class="el" href="../../d3/d0/user32_8def.html#a97">Unicode</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a7"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a8">WriteConsoleA</a> (IN HANDLE hConsoleOutput, IN CONST VOID *lpBuffer, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nNumberOfCharsToWrite, OUT LPDWORD lpNumberOfCharsWritten, IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpReserved)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW6432)  <a href="#a8"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a9">WriteConsoleW</a> (IN HANDLE hConsoleOutput, IN CONST VOID *lpBuffer, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nNumberOfCharsToWrite, OUT LPDWORD lpNumberOfCharsWritten, IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a10">CloseConsoleHandle</a> (IN HANDLE hConsole)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">defined(BUILD_WOW64)  <a href="#a10"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a11">DuplicateConsoleHandle</a> (IN HANDLE hSourceHandle, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesiredAccess, IN BOOL bInheritHandle, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOptions)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a12">GetConsoleHandleInformation</a> (IN HANDLE hObject, OUT LPDWORD lpdwFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a13">SetConsoleHandleInformation</a> (IN HANDLE hObject, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwMask, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a14">VerifyConsoleIoHandle</a> (IN HANDLE hIoHandle)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/client_2stream_8c.html#a0">InputWaitHandle</a> = (HANDLE)-1</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a10" doxytag="client/stream.c::CloseConsoleHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY CloseConsoleHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hConsole</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00553">553</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00464">_CONSOLE_CLOSEHANDLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a197">ConsolepCloseHandle</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00465">_CONSOLE_CLOSEHANDLE_MSG::Handle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a82">PCONSOLE_CLOSEHANDLE_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
<pre class="fragment"><div>00559           :
00560 
00561     hConsole - An open handle to console input or output.
00562 
00563 Return Value:
00564 
00565     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00566 
00567     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00568         <span class="keyword">using</span> GetLastError.
00569 
00570 --*/
00571 
00572 {
00573 
00574     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00575     <a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html">PCONSOLE_CLOSEHANDLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.CloseHandle;
00576 
00577     a-&gt;<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00578     a-&gt;<a class="code" href="../../d7/d9/struct__CONSOLE__CLOSEHANDLE__MSG.html#o1">Handle</a> = hConsole;
00579     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00580                          NULL,
00581                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00582                                               ConsolepCloseHandle
00583                                             ),
00584                          <span class="keyword">sizeof</span>( *a )
00585                        );
00586     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00587         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00588     } <span class="keywordflow">else</span> {
00589         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00590         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00591     }
00592 
00593 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="client/stream.c::DuplicateConsoleHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE APIENTRY DuplicateConsoleHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hSourceHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bInheritHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwOptions</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00597">597</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00469">_CONSOLE_DUPHANDLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a194">ConsolepDupHandle</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00471">_CONSOLE_DUPHANDLE_MSG::DesiredAccess</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00472">_CONSOLE_DUPHANDLE_MSG::InheritHandle</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00473">_CONSOLE_DUPHANDLE_MSG::Options</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a84">PCONSOLE_DUPHANDLE_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00470">_CONSOLE_DUPHANDLE_MSG::SourceHandle</a>, <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00053">VALID_ACCESSES</a>, and <a class="el" href="../../d7/d3/condll_8h-source.html#l00056">VALID_DUP_OPTIONS</a>.
<p>
<pre class="fragment"><div>00604           :
00605 
00606     hSourceHandle - An open handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device.
00607 
00608     dwDesiredAccess - The access requested to <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> handle.  This
00609         access must be equal to or a proper subset of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> granted access
00610         associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SourceHandle.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span>
00611         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DUPLICATE_SAME_ACCESS option <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00612 
00613     bInheritHandle - Supplies a flag that <span class="keywordflow">if</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, marks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00614         handle as inheritable.  If <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">case</span>, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00615         handle will be inherited to <span class="keyword">new</span> processes each time <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00616         process creates a <span class="keyword">new</span> process <span class="keyword">using</span> CreateProcess.
00617 
00618     dwOptions - Specifies optional behaviors <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
00619 
00620         Options Flags:
00621 
00622         DUPLICATE_CLOSE_SOURCE - The SourceHandle will be closed by
00623             <span class="keyword">this</span> service prior to returning to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.  This occurs
00624             regardless of any error status returned.
00625 
00626         DUPLICATE_SAME_ACCESS - The DesiredAccess parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored
00627             and instead <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> GrantedAccess associated with SourceHandle
00628             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DesiredAccess when creating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TargetHandle.
00629 
00630 
00631 Return Value:
00632 
00633     Not -1 - Returns an open handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified console device.
00634         Subsequent access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> controlled by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DesiredAccess
00635         parameter.
00636 
00637     0xffffffff - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00638         <span class="keyword">using</span> GetLastError.
00639 --*/
00640 
00641 {
00642 
00643     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00644     <a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html">PCONSOLE_DUPHANDLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.DuplicateHandle;
00645 
00646     <span class="keywordflow">if</span> (dwOptions &amp; ~<a class="code" href="../../d6/d4/condll_8h.html#a6">VALID_DUP_OPTIONS</a>) {
00647         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
00648         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00649     }
00650     <span class="keywordflow">if</span> (((dwOptions &amp; DUPLICATE_SAME_ACCESS) == 0) &amp;&amp;
00651          (dwDesiredAccess &amp; ~<a class="code" href="../../d6/d4/condll_8h.html#a4">VALID_ACCESSES</a>)) {
00652         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
00653         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00654     }
00655 
00656     a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00657     a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o1">SourceHandle</a> = hSourceHandle;
00658     a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o2">DesiredAccess</a> = dwDesiredAccess;
00659     a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o3">InheritHandle</a> = (BOOLEAN) bInheritHandle;
00660     a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o4">Options</a> = dwOptions;
00661     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00662                          NULL,
00663                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00664                                               ConsolepDupHandle
00665                                             ),
00666                          <span class="keyword">sizeof</span>( *a )
00667                        );
00668     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00669         <span class="keywordflow">return</span> a-&gt;<a class="code" href="../../d0/d0/struct__CONSOLE__DUPHANDLE__MSG.html#o5">TargetHandle</a>;
00670     } <span class="keywordflow">else</span> {
00671         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00672         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00673     }
00674 
00675 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="client/stream.c::GetConsoleHandleInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY GetConsoleHandleInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpdwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00680">680</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00478">_CONSOLE_GETHANDLEINFORMATION_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a195">ConsolepGetHandleInformation</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00479">_CONSOLE_GETHANDLEINFORMATION_MSG::Handle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a86">PCONSOLE_GETHANDLEINFORMATION_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
<pre class="fragment"><div>00686           :
00687 
00688     hObject - An open handle to console input or output.
00689 
00690     lpdwFlags - Receives flags <span class="keywordflow">for</span> console object.
00691 
00692 Return Value:
00693 
00694     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00695 
00696     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00697         <span class="keyword">using</span> GetLastError.
00698 
00699 --*/
00700 
00701 {
00702 
00703     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00704     <a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html">PCONSOLE_GETHANDLEINFORMATION_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetHandleInformation;
00705 
00706     a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00707     a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o1">Handle</a> = hObject;
00708 
00709     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00710                          NULL,
00711                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00712                                               ConsolepGetHandleInformation
00713                                             ),
00714                          <span class="keyword">sizeof</span>( *a )
00715                        );
00716     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00717         <span class="keywordflow">try</span> {
00718            *lpdwFlags = a-&gt;<a class="code" href="../../d0/d2/struct__CONSOLE__GETHANDLEINFORMATION__MSG.html#o2">Flags</a>;
00719         } except( EXCEPTION_EXECUTE_HANDLER ) {
00720             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00721             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00722         }
00723         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00724     } <span class="keywordflow">else</span> {
00725         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00726         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00727     }
00728 
00729 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="client/stream.c::GetConsoleInputWaitHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE APIENTRY GetConsoleInputWaitHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00033">33</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00030">InputWaitHandle</a>.
<p>
<pre class="fragment"><div>00034 {
00035     <span class="keywordflow">return</span> <a class="code" href="../../d8/d9/dllinit_8c.html#a3">InputWaitHandle</a>;
00036 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="client/stream.c::OpenConsoleW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE APIENTRY OpenConsoleW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpConsoleDevice</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bInheritHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwShareMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00098">98</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00044">OpenConsoleWInternal()</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00053">VALID_ACCESSES</a>, and <a class="el" href="../../d7/d3/condll_8h-source.html#l00054">VALID_SHARE_ACCESSES</a>.
<p>
<pre class="fragment"><div>00107           :
00108 
00109     lpConsoleDevice - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device name to open.  <span class="stringliteral">"CONIN$"</span>
00110         indicates console input.  <span class="stringliteral">"CONOUT$"</span> indicates console output.  The
00111         caller must have appropriate access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console <span class="keywordflow">for</span> <span class="keyword">this</span> call to
00112         succeed.
00113 
00114     dwDesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's desired access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console
00115         device.
00116 
00117         DesiredAccess Flags:
00118 
00119         GENERIC_READ - Read access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> requested.  This
00120             allows data to be read from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device.
00121 
00122         GENERIC_WRITE - Write access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> requested.  This
00123             allows data to be written to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device.
00124 
00125     bInheritHandle - Supplies a flag that indicates whether or not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00126         returned handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be inherited by a <span class="keyword">new</span> process
00127         during a CreateProcess.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00128         <span class="keyword">new</span> process will inherit <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle.
00129 
00130     dwShareMode - Supplies a set of flags that indicates how <span class="keyword">this</span> console
00131         device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be shared with other openers of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console device.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a>
00132         value of zero <span class="keywordflow">for</span> <span class="keyword">this</span> parameter indicates no sharing of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console,
00133         or exclusive access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to occur.
00134 
00135         ShareMode Flags:
00136 
00137         FILE_SHARE_READ - Other open operations may be performed on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00138             console device <span class="keywordflow">for</span> read access.
00139 
00140         FILE_SHARE_WRITE - Other open operations may be performed on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00141             console device <span class="keywordflow">for</span> write access.
00142 
00143 Return Value:
00144 
00145     Not -1 - Returns an open handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified console device.
00146         Subsequent access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> controlled by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DesiredAccess
00147         parameter.
00148 
00149     0xffffffff - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00150         <span class="keyword">using</span> GetLastError.
00151 --*/
00152 
00153 {
00154     ULONG HandleType;
00155 
00156     <span class="keywordflow">try</span> {
00157         <span class="keywordflow">if</span> (!lstrcmpiW(CONSOLE_INPUT_STRING,lpConsoleDevice)) {
00158             HandleType = <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>;
00159         }
00160         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!lstrcmpiW(CONSOLE_OUTPUT_STRING,lpConsoleDevice)) {
00161             HandleType = <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>;
00162         }
00163         <span class="keywordflow">else</span> {
00164             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
00165             <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00166         }
00167     } except( EXCEPTION_EXECUTE_HANDLER ) {
00168         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00169         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00170     }
00171     <span class="keywordflow">if</span> (dwDesiredAccess &amp; ~<a class="code" href="../../d6/d4/condll_8h.html#a4">VALID_ACCESSES</a> ||
00172         dwShareMode &amp; ~<a class="code" href="../../d6/d4/condll_8h.html#a5">VALID_SHARE_ACCESSES</a>) {
00173         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
00174         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00175     }
00176 
00177     <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/client_2stream_8c.html#a2">OpenConsoleWInternal</a>(HandleType,
00178                                 dwDesiredAccess,
00179                                 bInheritHandle,
00180                                 dwShareMode
00181                                 );
00182 
00183 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="client/stream.c::OpenConsoleWInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE APIENTRY OpenConsoleWInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>InheritHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ShareMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00044">44</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00215">_CONSOLE_OPENCONSOLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a163">ConsolepOpenConsole</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00217">_CONSOLE_OPENCONSOLE_MSG::DesiredAccess</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00216">_CONSOLE_OPENCONSOLE_MSG::HandleType</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00218">_CONSOLE_OPENCONSOLE_MSG::InheritHandle</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a22">PCONSOLE_OPENCONSOLE_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00219">_CONSOLE_OPENCONSOLE_MSG::ShareMode</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00098">OpenConsoleW()</a>.
<p>
<pre class="fragment"><div>00052                    :
00053 
00054    Marshels parameters <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d5/d5/conmsg_8h.html#a236a163">ConsolepOpenConsole</a> command.
00055 
00056 Arguments:
00057 
00058    See <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html">CONSOLE_OPENCONSOLE_MSG</a> structure and <a class="code" href="../../d9/d6/client_2stream_8c.html#a3">OpenConsoleW</a>.
00059 
00060 Return Value:
00061 
00062     <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a> - An error occured.
00063 
00064 --*/
00065 {
00066 
00067     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00068     <a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html">PCONSOLE_OPENCONSOLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.OpenConsole;
00069 
00070     a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00071     a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o1">HandleType</a>    = HandleType;
00072     a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o2">DesiredAccess</a> = DesiredAccess;
00073     a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o3">InheritHandle</a> = InheritHandle;
00074     a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o4">ShareMode</a>= ShareMode;
00075     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00076                          NULL,
00077                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00078                                               ConsolepOpenConsole
00079                                             ),
00080                          <span class="keyword">sizeof</span>( *a )
00081                        );
00082     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
00083         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00084         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
00085     }
00086     <span class="keywordflow">else</span> {
00087         <span class="keywordflow">return</span> a-&gt;<a class="code" href="../../d9/d3/struct__CONSOLE__OPENCONSOLE__MSG.html#o5">Handle</a>;
00088     }
00089 
00090 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="client/stream.c::ReadConsoleA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY ReadConsoleA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hConsoleInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nNumberOfCharsToRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpNumberOfCharsRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW6432) 
<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00349">349</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00035">BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00034">ExeNameLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/condll_8h.html#a13">GetCurrentExeName()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00191">ReadConsoleInternal()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00356 {
00357 
00358     WCHAR ExeName[<a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>/2];
00359     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>;
00360 
00361     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> = <a class="code" href="../../d6/d4/condll_8h.html#a13">GetCurrentExeName</a>(ExeName, <span class="keyword">sizeof</span>(ExeName));
00362 
00363     <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/client_2stream_8c.html#a4">ReadConsoleInternal</a>(hConsoleInput,
00364                                lpBuffer,
00365                                nNumberOfCharsToRead,
00366                                lpNumberOfCharsRead,
00367                                NULL,
00368                                FALSE,
00369                                ExeNameLength,
00370                                ExeName
00371                               );
00372     UNREFERENCED_PARAMETER(lpReserved);
00373 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="client/stream.c::ReadConsoleInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY ReadConsoleInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hConsoleInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nNumberOfCharsToRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpNumberOfCharsRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReserved</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Unicode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00191">191</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00440">_CONSOLE_READCONSOLE_MSG::Buffer</a>, <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00035">BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00441">_CONSOLE_READCONSOLE_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00443">_CONSOLE_READCONSOLE_MSG::CaptureBufferSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00437">_CONSOLE_READCONSOLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a192">ConsolepReadConsole</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00446">_CONSOLE_READCONSOLE_MSG::ControlKeyState</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00088">CsrAllocateCaptureBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00122">CsrCaptureMessageBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00098">CsrFreeCaptureBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00445">_CONSOLE_READCONSOLE_MSG::CtrlWakeupMask</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00034">ExeNameLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00439">_CONSOLE_READCONSOLE_MSG::ExeNameLength</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00444">_CONSOLE_READCONSOLE_MSG::InitialNumBytes</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00438">_CONSOLE_READCONSOLE_MSG::InputHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d0/yield_8c-source.html#l00029">NtYieldExecution()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00442">_CONSOLE_READCONSOLE_MSG::NumBytes</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a78">PCONSOLE_READCONSOLE_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00844">Unicode</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00447">_CONSOLE_READCONSOLE_MSG::Unicode</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00349">ReadConsoleA()</a>, and <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00377">ReadConsoleW()</a>.
<p>
<pre class="fragment"><div>00202           :
00203 
00204     hConsoleInput - Supplies an open handle to <span class="stringliteral">"CONIN$"</span> open <span class="keywordflow">for</span> GENERIC_READ
00205         or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> StdIn handle.
00206 
00207     lpBuffer - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a buffer to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data read
00208         from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console input.
00209 
00210     nNumberOfBytesToRead - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to read from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00211         input buffer.
00212 
00213     lpReserved - Ignore unless 4.0 application, in which <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> points
00214         to a CONSOLE_READCONSOLE_CONTROL data structure.  UNICODE <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a>.
00215         If !<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>, then call fails <span class="keywordflow">if</span> <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> non-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00216 
00217     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> call from <a class="code" href="../../d9/d6/client_2stream_8c.html#a6">ReadConsoleW</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d9/d6/client_2stream_8c.html#a5">ReadConsoleA</a>
00218 
00219 
00220 Return Value:
00221 
00222     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes actually read from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
00223 
00224     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed.
00225         Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available <span class="keyword">using</span> GetLastError.
00226 --*/
00227 
00228 {
00229     PCSR_CAPTURE_HEADER CaptureBuffer;
00230     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00231     <a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.ReadConsole;
00232     BOOLEAN Dummy;
00233     PCONSOLE_READCONSOLE_CONTROL pInputControl;
00234     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00235 
00236     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00237     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o1">InputHandle</a> = hConsoleInput;
00238     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o2">ExeNameLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>;
00239     RtlCopyMemory(a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o3">Buffer</a>, ExeName, ExeNameLength);
00240     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00241 
00242     <span class="comment">//</span>
00243     <span class="comment">// if ansi, make capture buffer large enough to hold translated</span>
00244     <span class="comment">// string.  this will make server side code much simpler.</span>
00245     <span class="comment">//</span>
00246 
00247     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o6">CaptureBufferSize</a> = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = nNumberOfCharsToRead * <span class="keyword">sizeof</span>(WCHAR);
00248     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o6">CaptureBufferSize</a> &gt; <a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>) {
00249         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00250                                                   a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o6">CaptureBufferSize</a>
00251                                                 );
00252         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00253             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00254             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00255         }
00256         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00257                                  NULL,
00258                                  a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o6">CaptureBufferSize</a>,
00259                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o4">BufPtr</a>
00260                                );
00261 
00262     }
00263     <span class="keywordflow">else</span> {
00264         a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o4">BufPtr</a> = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o3">Buffer</a>;
00265         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00266     }
00267 
00268 
00269     pInputControl = (PCONSOLE_READCONSOLE_CONTROL)lpReserved;
00270     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o7">InitialNumBytes</a> = 0;
00271     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o8">CtrlWakeupMask</a> = 0;
00272     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o9">ControlKeyState</a> = 0;
00273     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00274     <span class="keywordflow">try</span> {
00275         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> &amp;&amp;
00276             ARGUMENT_PRESENT(lpReserved) &amp;&amp;
00277             NtCurrentPeb()-&gt;ImageSubsystemMajorVersion &gt;= 4 &amp;&amp;
00278             pInputControl-&gt;nLength == <span class="keyword">sizeof</span>(*pInputControl)
00279            ) {
00280             <span class="keywordflow">if</span> ((pInputControl-&gt;nInitialChars &gt; nNumberOfCharsToRead)) {
00281                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00282             } <span class="keywordflow">else</span> {
00283                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o7">InitialNumBytes</a> = pInputControl-&gt;nInitialChars * <span class="keyword">sizeof</span>(WCHAR);
00284                 <span class="keywordflow">if</span> (pInputControl-&gt;nInitialChars != 0) {
00285                     RtlCopyMemory( a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o4">BufPtr</a>, lpBuffer, a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o7">InitialNumBytes</a> );
00286                 }
00287                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o8">CtrlWakeupMask</a> = pInputControl-&gt;dwCtrlWakeupMask;
00288             }
00289         } <span class="keywordflow">else</span> {
00290             pInputControl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00291         }
00292     } except( EXCEPTION_EXECUTE_HANDLER ) {
00293         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00294     }
00295 
00296     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; pInputControl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00297         <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00298             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00299         }
00300         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(Status);
00301         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00302     }
00303 
00304     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00305                          CaptureBuffer,
00306                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00307                                               ConsolepReadConsole
00308                                             ),
00309                          <span class="keyword">sizeof</span>( *a )
00310                        );
00311     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00312         <span class="keywordflow">try</span> {
00313             *lpNumberOfCharsRead = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>;
00314             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
00315                 *lpNumberOfCharsRead /= <span class="keyword">sizeof</span>(WCHAR);
00316                 <span class="keywordflow">if</span> (pInputControl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00317                     pInputControl-&gt;dwControlKeyState = a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o9">ControlKeyState</a>;
00318                 }
00319             }
00320             RtlCopyMemory( lpBuffer, a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o4">BufPtr</a>, a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> );
00321         } except( EXCEPTION_EXECUTE_HANDLER ) {
00322             <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00323                 <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00324             }
00325             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00326             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00327         }
00328     }
00329     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00330         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00331     }
00332     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00333         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00334         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00335     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m.ReturnValue == STATUS_ALERTED) {
00336         <span class="comment">// ctrl-c or ctrl-break</span>
00337         <a class="code" href="../../d6/d1/yield_8c.html#a0">NtYieldExecution</a>();
00338         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_OPERATION_ABORTED);
00339     }
00340     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00341 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="client/stream.c::ReadConsoleW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY ReadConsoleW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hConsoleInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nNumberOfCharsToRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpNumberOfCharsRead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00377">377</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00035">BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00034">ExeNameLength</a>, <a class="el" href="../../d6/d4/condll_8h.html#a13">GetCurrentExeName()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00191">ReadConsoleInternal()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00384 {
00385     WCHAR ExeName[<a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>/2];
00386     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>;
00387 
00388     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> = <a class="code" href="../../d6/d4/condll_8h.html#a13">GetCurrentExeName</a>(ExeName, <span class="keyword">sizeof</span>(ExeName));
00389 
00390     <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/client_2stream_8c.html#a4">ReadConsoleInternal</a>(hConsoleInput,
00391                                lpBuffer,
00392                                nNumberOfCharsToRead,
00393                                lpNumberOfCharsRead,
00394                                lpReserved,
00395                                TRUE,
00396                                ExeNameLength,
00397                                ExeName
00398                               );
00399     UNREFERENCED_PARAMETER(lpReserved);
00400 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="client/stream.c::SetConsoleHandleInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY SetConsoleHandleInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwMask</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00734">734</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00484">_CONSOLE_SETHANDLEINFORMATION_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a196">ConsolepSetHandleInformation</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00487">_CONSOLE_SETHANDLEINFORMATION_MSG::Flags</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00485">_CONSOLE_SETHANDLEINFORMATION_MSG::Handle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00486">_CONSOLE_SETHANDLEINFORMATION_MSG::Mask</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a88">PCONSOLE_SETHANDLEINFORMATION_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
<pre class="fragment"><div>00741           :
00742 
00743     hObject - An open handle to console input or output.
00744 
00745     dwMask - Flags to change.
00746 
00747     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> - New values <span class="keywordflow">for</span> flags.
00748 
00749 Return Value:
00750 
00751     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The operation was successful.
00752 
00753     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed. Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available
00754         <span class="keyword">using</span> GetLastError.
00755 
00756 --*/
00757 
00758 {
00759 
00760     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00761     <a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html">PCONSOLE_SETHANDLEINFORMATION_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetHandleInformation;
00762 
00763     a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00764     a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o1">Handle</a> = hObject;
00765     a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o2">Mask</a> = dwMask;
00766     a-&gt;<a class="code" href="../../d7/d5/struct__CONSOLE__SETHANDLEINFORMATION__MSG.html#o3">Flags</a> = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00767 
00768     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00769                          NULL,
00770                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00771                                               ConsolepSetHandleInformation
00772                                             ),
00773                          <span class="keyword">sizeof</span>( *a )
00774                        );
00775     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00776         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00777     } <span class="keywordflow">else</span> {
00778         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00779         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00780     }
00781 
00782 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="client/stream.c::VerifyConsoleIoHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY VerifyConsoleIoHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hIoHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00787">787</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00589">_CONSOLE_VERIFYIOHANDLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a198">ConsolepVerifyIoHandle</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00590">_CONSOLE_VERIFYIOHANDLE_MSG::Handle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a112">PCONSOLE_VERIFYIOHANDLE_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, and <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>.
<p>
<pre class="fragment"><div>00792           :
00793 
00794     hIoHandle - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to verify
00795 
00796 Return Value:
00797 
00798     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a valid console handle.
00799 
00800     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a valid console handle.
00801 
00802 --*/
00803 
00804 {
00805 
00806     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00807     <a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html">PCONSOLE_VERIFYIOHANDLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.VerifyConsoleIoHandle;
00808 
00809     a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o1">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00810     a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o2">Handle</a> = hIoHandle;
00811 
00812     <span class="comment">//</span>
00813     <span class="comment">// If this process doesn't have a console handle, bail immediately.</span>
00814     <span class="comment">//</span>
00815 
00816     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o1">ConsoleHandle</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00817         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00818     }
00819 
00820     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00821                          NULL,
00822                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00823                                               ConsolepVerifyIoHandle
00824                                             ),
00825                          <span class="keyword">sizeof</span>( *a )
00826                        );
00827     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00828         <span class="keywordflow">return</span> a-&gt;<a class="code" href="../../d3/d7/struct__CONSOLE__VERIFYIOHANDLE__MSG.html#o0">Valid</a>;
00829     } <span class="keywordflow">else</span> {
00830         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
00831         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00832     }
00833 
00834 
00835 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="client/stream.c::WriteConsoleA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY WriteConsoleA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hConsoleOutput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CONST VOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nNumberOfCharsToWrite</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpNumberOfCharsWritten</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW6432) 
<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00511">511</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00408">WriteConsoleInternal()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/proc__out_8c-source.html#l00013">PrintPair()</a>.
<p>
<pre class="fragment"><div>00518 {
00519     <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/client_2stream_8c.html#a7">WriteConsoleInternal</a>(hConsoleOutput,
00520                                 lpBuffer,
00521                                 nNumberOfCharsToWrite,
00522                                 lpNumberOfCharsWritten,
00523                                 FALSE
00524                                );
00525     UNREFERENCED_PARAMETER(lpReserved);
00526 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="client/stream.c::WriteConsoleInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY WriteConsoleInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hConsoleOutput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CONST VOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nNumberOfCharsToWrite</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpNumberOfCharsWritten</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Unicode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
defined(BUILD_WOW64) 
<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00408">408</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00453">_CONSOLE_WRITECONSOLE_MSG::Buffer</a>, <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00035">BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00457">_CONSOLE_WRITECONSOLE_MSG::BufferInMessage</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00454">_CONSOLE_WRITECONSOLE_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00451">_CONSOLE_WRITECONSOLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a236a193">ConsolepWriteConsole</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00088">CsrAllocateCaptureBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00122">CsrCaptureMessageBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00098">CsrFreeCaptureBuffer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00047">GET_CONSOLE_HANDLE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00455">_CONSOLE_WRITECONSOLE_MSG::NumBytes</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00452">_CONSOLE_WRITECONSOLE_MSG::OutputHandle</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a80">PCONSOLE_WRITECONSOLE_MSG</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00048">SET_LAST_ERROR</a>, <a class="el" href="../../d7/d3/condll_8h-source.html#l00049">SET_LAST_NT_ERROR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">_CONSOLE_API_MSG::u</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00458">_CONSOLE_WRITECONSOLE_MSG::Unicode</a>, and <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00844">Unicode</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00511">WriteConsoleA()</a>, and <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00530">WriteConsoleW()</a>.
<p>
<pre class="fragment"><div>00417           :
00418 
00419     hFile - Supplies an open handle to to <span class="stringliteral">"CONOUT$"</span> open <span class="keywordflow">for</span> GENERIC_WRITE
00420         or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> StdOut or StdErr handle.
00421 
00422     lpBuffer - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be written to
00423         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> console output.
00424 
00425     nNumberOfBytesToWrite - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to write to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00426         console output.
00427 
00428 Return Value:
00429 
00430     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes actually written to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device.
00431 
00432     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>/<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The operation failed.
00433         Extended error status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> available <span class="keyword">using</span> GetLastError.
00434 --*/
00435 
00436 {
00437 
00438     PCSR_CAPTURE_HEADER CaptureBuffer;
00439     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00440     <a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html">PCONSOLE_WRITECONSOLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.WriteConsole;
00441 
00442     a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00443     a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00444 
00445     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
00446         a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a> = nNumberOfCharsToWrite * <span class="keyword">sizeof</span>(WCHAR);
00447     } <span class="keywordflow">else</span> {
00448         a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a> = nNumberOfCharsToWrite;
00449     }
00450 
00451     a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o7">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00452     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a> &gt; <a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>) {
00453         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00454                                                   a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a>
00455                                                 );
00456         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00457             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00458             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00459         }
00460         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00461                                  (PCHAR) lpBuffer,
00462                                  a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a>,
00463                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o3">BufPtr</a>
00464                                );
00465         a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o6">BufferInMessage</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00466     }
00467     <span class="keywordflow">else</span> {
00468         a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o3">BufPtr</a> = a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o2">Buffer</a>;
00469         <span class="keywordflow">try</span> {
00470             RtlCopyMemory( a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o3">BufPtr</a>, lpBuffer, a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a>);
00471         } except( EXCEPTION_EXECUTE_HANDLER ) {
00472             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00473             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00474         }
00475         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00476         a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o6">BufferInMessage</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00477     }
00478     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00479                          CaptureBuffer,
00480                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00481                                               ConsolepWriteConsole
00482                                             ),
00483                          <span class="keyword">sizeof</span>( *a )
00484                        );
00485     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00486         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00487     }
00488     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00489         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00490         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00491     }
00492     <span class="keywordflow">try</span> {
00493        *lpNumberOfCharsWritten = a-&gt;<a class="code" href="../../d4/d7/struct__CONSOLE__WRITECONSOLE__MSG.html#o4">NumBytes</a>;
00494        <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
00495            *lpNumberOfCharsWritten /= <span class="keyword">sizeof</span>(WCHAR);
00496        }
00497     } except( EXCEPTION_EXECUTE_HANDLER ) {
00498         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00499         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00500     }
00501     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00502 
00503 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="client/stream.c::WriteConsoleW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY WriteConsoleW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hConsoleOutput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CONST VOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nNumberOfCharsToWrite</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>lpNumberOfCharsWritten</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00530">530</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00408">WriteConsoleInternal()</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/tdisp_8c-source.html#l00031">main()</a>, and <a class="el" href="../../d2/d4/proc__out_8c-source.html#l00013">PrintPair()</a>.
<p>
<pre class="fragment"><div>00537 {
00538     <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/client_2stream_8c.html#a7">WriteConsoleInternal</a>(hConsoleOutput,
00539                                 lpBuffer,
00540                                 nNumberOfCharsToWrite,
00541                                 lpNumberOfCharsWritten,
00542                                 TRUE
00543                                );
00544     UNREFERENCED_PARAMETER(lpReserved);
00545 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="client/stream.c::InputWaitHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d9/d6/client_2stream_8c.html#a0">InputWaitHandle</a> = (HANDLE)-1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00029">29</a> of file <a class="el" href="../../d0/d6/client_2stream_8c-source.html">client/stream.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00803">AllocConsole()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00470">ConDllInitialize()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00979">FreeConsole()</a>, and <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00033">GetConsoleInputWaitHandle()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:41 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
