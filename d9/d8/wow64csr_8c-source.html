<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: wow64csr.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>wow64csr.c</h1><a href="../../d8/d9/wow64csr_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1998  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    wow64csr.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the WOW64 versions of the code for the Windows Client.</span>
00012 <span class="comment">    See csr* files in ntos\dll for more function comments. </span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Michael Zoran (mzoran) 2-JUN-1998</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    User Mode only</span>
00021 <span class="comment"></span>
00022 <span class="comment">Revision History:</span>
00023 <span class="comment"></span>
00024 <span class="comment">--*/</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="../../d9/d9/csrdll_8h.html">csrdll.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="../../d9/d2/ldrp_8h.html">ldrp.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="../../d2/d0/ntwow64_8h.html">ntwow64.h</a>"</span>
00029 
00030 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00031"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a0">00031</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a0">CsrClientConnectToServer</a>(
00032     IN PWSTR ObjectDirectory,
00033     IN ULONG ServerDllIndex,
00034     IN PCSR_CALLBACK_INFO CallbackInformation OPTIONAL,
00035     IN PVOID ConnectionInformation,
00036     IN OUT PULONG ConnectionInformationLength OPTIONAL,
00037     OUT PBOOLEAN CalledFromServer OPTIONAL
00038     )
00039 
00040 {
00041     <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a0">NtWow64CsrClientConnectToServer</a>(ObjectDirectory,
00042                                            ServerDllIndex,
00043                                            CallbackInformation,
00044                                            ConnectionInformation,
00045                                            ConnectionInformationLength,
00046                                            CalledFromServer);
00047 }
00048 
00049 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00050"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a1">00050</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a1">CsrNewThread</a>(
00051     VOID
00052     )
00053 {
00054     <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a1">NtWow64CsrNewThread</a>();
00055 }
00056 
00057 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00058"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a2">00058</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a2">CsrIdentifyAlertableThread</a>( VOID )
00059 {
00060     <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a2">NtWow64CsrIdentifyAlertableThread</a>();
00061 }
00062 
00063 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00064"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a3">00064</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a3">CsrSetPriorityClass</a>(
00065     IN HANDLE ProcessHandle,
00066     IN OUT PULONG PriorityClass
00067     )
00068 {
00069 
00070    <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a9">NtWow64CsrSetPriorityClass</a>(ProcessHandle, PriorityClass); 
00071 
00072 }
00073 
00074 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00075"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a4">00075</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>(
00076     IN OUT PCSR_API_MSG m,
00077     IN OUT PCSR_CAPTURE_HEADER CaptureBuffer OPTIONAL,
00078     IN CSR_API_NUMBER ApiNumber,
00079     IN ULONG ArgLength
00080     )
00081 {
00082 
00083     <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a3">NtWow64CsrClientCallServer</a>(m,CaptureBuffer,ApiNumber,ArgLength);
00084 }
00085 
00086 
00087 PCSR_CAPTURE_HEADER
<a name="l00088"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a5">00088</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>(
00089     IN ULONG CountMessagePointers,
00090     IN ULONG Sizecd
00091     )
00092 {
00093    <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a4">NtWow64CsrAllocateCaptureBuffer</a>(CountMessagePointers, Sizecd);
00094 }
00095 
00096 
00097 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00098"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a6">00098</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>(
00099     IN PCSR_CAPTURE_HEADER CaptureBuffer
00100     )
00101 
00102 {
00103 
00104     <a class="code" href="../../d2/d0/ntwow64_8h.html#a5">NtWow64CsrFreeCaptureBuffer</a>(CaptureBuffer);
00105 }
00106 
00107 
00108 ULONG
<a name="l00109"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a7">00109</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a7">CsrAllocateMessagePointer</a>(
00110     IN OUT PCSR_CAPTURE_HEADER CaptureBuffer,
00111     IN ULONG Length,
00112     OUT PVOID *Pointer
00113     )
00114 {
00115  
00116    <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/ntwow64_8h.html#a6">NtWow64CsrAllocateMessagePointer</a>(CaptureBuffer, Length, Pointer);
00117 
00118 }
00119 
00120 
00121 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00122"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a8">00122</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>(
00123     IN OUT PCSR_CAPTURE_HEADER CaptureBuffer,
00124     IN PVOID Buffer OPTIONAL,
00125     IN ULONG Length,
00126     OUT PVOID *CapturedBuffer
00127     )
00128 {
00129 
00130    <a class="code" href="../../d2/d0/ntwow64_8h.html#a7">NtWow64CsrCaptureMessageBuffer</a>(CaptureBuffer,<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>,Length,CapturedBuffer);
00131 
00132 }
00133 
00134 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00135"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a9">00135</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a9">CsrCaptureMessageString</a>(
00136     IN OUT PCSR_CAPTURE_HEADER CaptureBuffer,
00137     IN PCSTR String OPTIONAL,
00138     IN ULONG Length,
00139     IN ULONG MaximumLength,
00140     OUT PSTRING CapturedString
00141     )
00142 
00143 {
00144 
00145   <a class="code" href="../../d2/d0/ntwow64_8h.html#a8">NtWow64CsrCaptureMessageString</a>(CaptureBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, Length, MaximumLength, CapturedString);
00146 
00147 }
00148 
00149 
00150 
00151 PLARGE_INTEGER
<a name="l00152"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a10">00152</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a10">CsrCaptureTimeout</a>(
00153     IN ULONG MilliSeconds,
00154     OUT PLARGE_INTEGER Timeout
00155     )
00156 {
00157     <span class="keywordflow">if</span> (MilliSeconds == -1) {
00158         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00159         }
00160     <span class="keywordflow">else</span> {
00161         Timeout-&gt;QuadPart = Int32x32To64( MilliSeconds, -10000 );
00162         <span class="keywordflow">return</span>( (PLARGE_INTEGER)Timeout );
00163         }
00164 }
00165 
00166 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00167"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a11">00167</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a11">CsrProbeForWrite</a>(
00168     IN PVOID Address,
00169     IN ULONG Length,
00170     IN ULONG Alignment
00171     )
00172 
00173 <span class="comment">/*++</span>
00174 <span class="comment"></span>
00175 <span class="comment">Routine Description:</span>
00176 <span class="comment"></span>
00177 <span class="comment">    This function probes a structure for read accessibility.</span>
00178 <span class="comment">    If the structure is not accessible, then an exception is raised.</span>
00179 <span class="comment"></span>
00180 <span class="comment">Arguments:</span>
00181 <span class="comment"></span>
00182 <span class="comment">    Address - Supplies a pointer to the structure to be probed.</span>
00183 <span class="comment"></span>
00184 <span class="comment">    Length - Supplies the length of the structure.</span>
00185 <span class="comment"></span>
00186 <span class="comment">    Alignment - Supplies the required alignment of the structure expressed</span>
00187 <span class="comment">        as the number of bytes in the primitive datatype (e.g., 1 for char,</span>
00188 <span class="comment">        2 for short, 4 for long, and 8 for quad).</span>
00189 <span class="comment"></span>
00190 <span class="comment">Return Value:</span>
00191 <span class="comment"></span>
00192 <span class="comment">    None.</span>
00193 <span class="comment"></span>
00194 <span class="comment">--*/</span>
00195 
00196 {
00197     <span class="keyword">volatile</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> *StartAddress;
00198     <span class="keyword">volatile</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> *EndAddress;
00199     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> Temp;
00200 
00201     <span class="comment">//</span>
00202     <span class="comment">// If the structure has zero length, then do not probe the structure for</span>
00203     <span class="comment">// write accessibility or alignment.</span>
00204     <span class="comment">//</span>
00205 
00206     <span class="keywordflow">if</span> (Length != 0) {
00207 
00208         <span class="comment">//</span>
00209         <span class="comment">// If the structure is not properly aligned, then raise a data</span>
00210         <span class="comment">// misalignment exception.</span>
00211         <span class="comment">//</span>
00212 
00213         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Alignment == 1) || (Alignment == 2) ||
00214                (Alignment == 4) || (Alignment == 8));
00215         StartAddress = (<span class="keyword">volatile</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> *)Address;
00216 
00217         <span class="keywordflow">if</span> (((ULONG_PTR)StartAddress &amp; (Alignment - 1)) != 0) {
00218             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_DATATYPE_MISALIGNMENT);
00219         } <span class="keywordflow">else</span> {
00220             <span class="comment">//</span>
00221             <span class="comment">// BUG, BUG - this should not be necessary once the 386 kernel</span>
00222             <span class="comment">// makes system space inaccessable to user mode.</span>
00223             <span class="comment">//</span>
00224             <span class="keywordflow">if</span> ((ULONG_PTR)StartAddress &gt; <a class="code" href="../../d9/d9/csrdll_8h.html#a11">CsrNtSysInfo</a>.MaximumUserModeAddress) {
00225                 <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_ACCESS_VIOLATION);
00226             }
00227 
00228             Temp = *StartAddress;
00229             *StartAddress = Temp;
00230             EndAddress = StartAddress + Length - 1;
00231             Temp = *EndAddress;
00232             *EndAddress = Temp;
00233         }
00234     }
00235 }
00236 
00237 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00238"></a><a class="code" href="../../d8/d9/wow64csr_8c.html#a12">00238</a> <a class="code" href="../../d8/d9/wow64csr_8c.html#a12">CsrProbeForRead</a>(
00239     IN PVOID Address,
00240     IN ULONG Length,
00241     IN ULONG Alignment
00242     )
00243 
00244 <span class="comment">/*++</span>
00245 <span class="comment"></span>
00246 <span class="comment">Routine Description:</span>
00247 <span class="comment"></span>
00248 <span class="comment">    This function probes a structure for read accessibility.</span>
00249 <span class="comment">    If the structure is not accessible, then an exception is raised.</span>
00250 <span class="comment"></span>
00251 <span class="comment">Arguments:</span>
00252 <span class="comment"></span>
00253 <span class="comment">    Address - Supplies a pointer to the structure to be probed.</span>
00254 <span class="comment"></span>
00255 <span class="comment">    Length - Supplies the length of the structure.</span>
00256 <span class="comment"></span>
00257 <span class="comment">    Alignment - Supplies the required alignment of the structure expressed</span>
00258 <span class="comment">        as the number of bytes in the primitive datatype (e.g., 1 for char,</span>
00259 <span class="comment">        2 for short, 4 for long, and 8 for quad).</span>
00260 <span class="comment"></span>
00261 <span class="comment">Return Value:</span>
00262 <span class="comment"></span>
00263 <span class="comment">    None.</span>
00264 <span class="comment"></span>
00265 <span class="comment">--*/</span>
00266 
00267 {
00268     <span class="keyword">volatile</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> *StartAddress;
00269     <span class="keyword">volatile</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> *EndAddress;
00270     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> Temp;
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">// If the structure has zero length, then do not probe the structure for</span>
00274     <span class="comment">// read accessibility or alignment.</span>
00275     <span class="comment">//</span>
00276 
00277     <span class="keywordflow">if</span> (Length != 0) {
00278 
00279         <span class="comment">//</span>
00280         <span class="comment">// If the structure is not properly aligned, then raise a data</span>
00281         <span class="comment">// misalignment exception.</span>
00282         <span class="comment">//</span>
00283 
00284         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Alignment == 1) || (Alignment == 2) ||
00285                (Alignment == 4) || (Alignment == 8));
00286         StartAddress = (<span class="keyword">volatile</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> *)Address;
00287 
00288         <span class="keywordflow">if</span> (((ULONG_PTR)StartAddress &amp; (Alignment - 1)) != 0) {
00289             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_DATATYPE_MISALIGNMENT);
00290         } <span class="keywordflow">else</span> {
00291             Temp = *StartAddress;
00292             EndAddress = StartAddress + Length - 1;
00293             Temp = *EndAddress;
00294         }
00295     }
00296 }
00297 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
