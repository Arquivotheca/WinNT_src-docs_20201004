<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: sysmet.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>sysmet.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d0/d8/sysmet_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d8/sysmet_8c.html#a0">_SwapMouseButton</a> (BOOL fSwapButtons)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d8/sysmet_8c.html#a1">_SetDoubleClickTime</a> (UINT dtTime)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d8/sysmet_8c.html#a2">SetSysColor</a> (UINT icol, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> rgb, UINT uOptions)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d8/sysmet_8c.html#a3">xxxSetSysColors</a> (PUNICODE_STRING pProfileUserName, int cicol, <a class="el" href="../../d9/d5/ndismain_8h.html#a266">PUINT</a> picolor, COLORREF *prgb, UINT uOptions)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="sysmet.c::_SetDoubleClickTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY _SetDoubleClickTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dtTime</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00074">74</a> of file <a class="el" href="../../d0/d8/sysmet_8c-source.html">sysmet.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00233">gdtDblClk</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06932">InitTooltipDelay()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02712">tagWINDOWSTATION::rpdeskList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02661">tagDESKTOP::spwndTooltip</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00076 {
00077     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta = <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>()-&gt;rpwinsta;
00078 
00079     <span class="comment">/*</span>
00080 <span class="comment">     * Blow it off if the caller doesn't have the proper access rights</span>
00081 <span class="comment">     */</span>
00082     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
00083         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00084     }
00085 
00086     <span class="keywordflow">if</span> (!dtTime) {
00087         dtTime = 500;
00088     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dtTime &gt; 5000) {
00089         dtTime = 5000;
00090     }
00091 
00092     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a100">gdtDblClk</a>         = dtTime;
00093     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtLBSearch = dtTime * 4;            <span class="comment">// dtLBSearch   =  4  * gdtDblClk</span>
00094     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtScroll   = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtLBSearch / 5;  <span class="comment">// dtScroll     = 4/5 * gdtDblClk</span>
00095     <span class="comment">/*</span>
00096 <span class="comment">     * This value should be set through SPI_SETMENUSHOWDELAY</span>
00097 <span class="comment">     *   gdtMNDropDown     = gpsi-&gt;dtScroll;        // gdtMNDropDown = 4/5 * gdtDblClk</span>
00098 <span class="comment">     */</span>
00099 
00100     <span class="comment">/*</span>
00101 <span class="comment">     * Recalculate delays for tooltip windows on all desktops.</span>
00102 <span class="comment">     */</span>
00103     <span class="keywordflow">if</span> (pwinsta != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00104         <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk;
00105         <span class="keywordflow">for</span> (pdesk = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>; pdesk; pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>) {
00106             <a class="code" href="../../d4/d1/userk_8h.html#a2018">InitTooltipDelay</a>((<a class="code" href="../../d8/d8/structtagTOOLTIPWND.html">PTOOLTIPWND</a>)pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o14">spwndTooltip</a>);
00107         }
00108     }
00109 
00110     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00111 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="sysmet.c::_SwapMouseButton" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY _SwapMouseButton           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fSwapButtons</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00025">25</a> of file <a class="el" href="../../d0/d8/sysmet_8c-source.html">sysmet.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03490">tagPROCESSINFO::amwinsta</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00222">gbMouseButtonsRecentlySwapped</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02364">RETURN_IF_ACCESS_DENIED</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00027 {
00028     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            fSwapOld;
00029     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a>    ppiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>();
00030 
00031     <span class="comment">/*</span>
00032 <span class="comment">     * Blow it off if the caller doesn't have the proper access rights</span>
00033 <span class="comment">     */</span>
00034     <a class="code" href="../../d4/d1/userk_8h.html#a263">RETURN_IF_ACCESS_DENIED</a>(ppiCurrent-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o16">amwinsta</a>,
00035                             WINSTA_READATTRIBUTES | WINSTA_WRITEATTRIBUTES,
00036                             FALSE);
00037 
00038     <span class="keywordflow">if</span> (!(ppiCurrent-&gt;W32PF_Flags &amp; W32PF_IOWINSTA)) {
00039         RIPERR0(ERROR_REQUIRES_INTERACTIVE_WINDOWSTATION,
00040                 RIP_WARNING,
00041                 <span class="stringliteral">"SwapMouseButton invalid on a non-interactive WindowStation."</span>);
00042 
00043         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00044     }
00045 
00046     fSwapOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SWAPBUTTON);
00047     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SWAPBUTTON) = fSwapButtons;
00048 
00049     <span class="comment">/*</span>
00050 <span class="comment">     * Give xxxButtonEvent a hint that a mouse button event may have to be</span>
00051 <span class="comment">     * left/right swapped to correspond with our current async key state.</span>
00052 <span class="comment">     * Toggle the global since an even number of SwapMouseButtons has no effect.</span>
00053 <span class="comment">     */</span>
00054     <span class="keywordflow">if</span> (fSwapButtons != fSwapOld) {
00055         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a93">gbMouseButtonsRecentlySwapped</a> = !<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a93">gbMouseButtonsRecentlySwapped</a>;
00056     }
00057 
00058     <span class="comment">/*</span>
00059 <span class="comment">     * Return previous state</span>
00060 <span class="comment">     */</span>
00061     <span class="keywordflow">return</span> fSwapOld;
00062 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="sysmet.c::SetSysColor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetSysColor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>icol</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>rgb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uOptions</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00121">121</a> of file <a class="el" href="../../d0/d8/sysmet_8c-source.html">sysmet.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02212">tagDISPLAYINFO::fAnyPalette</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01379">SSCF_16COLORS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01311">SSCF_FORCESOLIDCOLOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01312">SSCF_SETMAGICCOLORS</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00236">SYSHBRUSH</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00225">xxxSetSysColors()</a>.
<p>
<pre class="fragment"><div>00126 {
00127 
00128     <span class="keywordflow">if</span> ((uOptions &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a412">SSCF_SETMAGICCOLORS</a>) &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o19">fAnyPalette</a>) {
00129         <span class="keyword">union </span>{
00130             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> rgb;
00131             PALETTEENTRY pe;
00132         } peMagic;
00133 
00134         peMagic.rgb = rgb;
00135 
00136         <span class="comment">/*</span>
00137 <span class="comment">         *  when any of the 3D colors are changing, call GDI to</span>
00138 <span class="comment">         *  set the apropiate "magic" color</span>
00139 <span class="comment">         *</span>
00140 <span class="comment">         *  the four magic colors are reserved like so</span>
00141 <span class="comment">         *</span>
00142 <span class="comment">         *  8       - UI color (3D shadow)</span>
00143 <span class="comment">         *  9       - UI color (3D face)</span>
00144 <span class="comment">         *</span>
00145 <span class="comment">         *  F6      - UI color (3D hilight)</span>
00146 <span class="comment">         *  F7      - UI color (desktop)</span>
00147 <span class="comment">         *</span>
00148 <span class="comment">         *  NOTE (3D hilight) inverts to (3D shadow)</span>
00149 <span class="comment">         *       (3D face)    inverts to sys gray</span>
00150 <span class="comment">         *</span>
00151 <span class="comment">         */</span>
00152 
00153         <span class="keywordflow">switch</span> (icol)
00154         {
00155         <span class="keywordflow">case</span> COLOR_3DSHADOW:
00156             GreSetMagicColors(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, peMagic.pe, 8);
00157             <span class="keywordflow">break</span>;
00158 
00159         <span class="keywordflow">case</span> COLOR_3DFACE:
00160             GreSetMagicColors(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, peMagic.pe, 9);
00161             <span class="keywordflow">break</span>;
00162 
00163         <span class="keywordflow">case</span> COLOR_3DHILIGHT:
00164             GreSetMagicColors(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, peMagic.pe, 246);
00165             <span class="keywordflow">break</span>;
00166 
00167         <span class="keywordflow">case</span> COLOR_DESKTOP:
00168             GreSetMagicColors(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, peMagic.pe, 247);
00169             <span class="keywordflow">break</span>;
00170         }
00171     }
00172 
00173     <span class="keywordflow">if</span> (uOptions &amp; <a class="code" href="../../d1/d0/inc_2user_8h.html#a404">SSCF_16COLORS</a>) {
00174         <span class="comment">/*</span>
00175 <span class="comment">         * Force solid colors for all elements in 16 color or less modes.</span>
00176 <span class="comment">         */</span>
00177         rgb = GreGetNearestColor(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, rgb);
00178     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uOptions &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a411">SSCF_FORCESOLIDCOLOR</a>) {
00179         <span class="comment">/*</span>
00180 <span class="comment">         * Force solid colors for certain window elements.</span>
00181 <span class="comment">         */</span>
00182         <span class="keywordflow">switch</span> (icol) {
00183 
00184         <span class="comment">/*</span>
00185 <span class="comment">         * These can be dithers</span>
00186 <span class="comment">         */</span>
00187         <span class="keywordflow">case</span> COLOR_DESKTOP:
00188         <span class="keywordflow">case</span> COLOR_ACTIVEBORDER:
00189         <span class="keywordflow">case</span> COLOR_INACTIVEBORDER:
00190         <span class="keywordflow">case</span> COLOR_APPWORKSPACE:
00191         <span class="keywordflow">case</span> COLOR_INFOBK:
00192         <span class="keywordflow">case</span> COLOR_GRADIENTACTIVECAPTION:
00193         <span class="keywordflow">case</span> COLOR_GRADIENTINACTIVECAPTION:
00194             <span class="keywordflow">break</span>;
00195 
00196         <span class="keywordflow">default</span>:
00197             rgb = GreGetNearestColor(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, rgb);
00198             <span class="keywordflow">break</span>;
00199         }
00200     }
00201 
00202     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[icol] = rgb;
00203     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icol) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00204         <span class="comment">/*</span>
00205 <span class="comment">         * This is the first time we're setting up the system colors.</span>
00206 <span class="comment">         * We need to create the brush</span>
00207 <span class="comment">         */</span>
00208         <a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icol) = GreCreateSolidBrush(rgb);
00209         GreMarkUndeletableBrush(<a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icol));
00210         GreSetBrushOwnerPublic(<a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icol));
00211     } <span class="keywordflow">else</span> {
00212         GreSetSolidBrush(<a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icol), rgb);
00213     }
00214 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="sysmet.c::xxxSetSysColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY xxxSetSysColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cicol</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d5/ndismain_8h.html#a266">PUINT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>picolor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORREF *&nbsp;</td>
          <td class="mdname" nowrap> <em>prgb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uOptions</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00225">225</a> of file <a class="el" href="../../d0/d8/sysmet_8c-source.html">sysmet.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03833">PWND_BROADCAST</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1177">RecolorDeskPattern()</a>, <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00121">SetSysColor()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01379">SSCF_16COLORS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01310">SSCF_NOTIFY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01312">SSCF_SETMAGICCOLORS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03863">xxxRedrawScreen</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l01069">xxxSendNotifyMessage()</a>, and <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l01080">xxxSetWindowNCMetrics()</a>.
<p>
<pre class="fragment"><div>00231 {
00232     <span class="keywordtype">int</span>      i;
00233     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     icol;
00234     COLORREF rgb;
00235 
00236     <span class="comment">/*</span>
00237 <span class="comment">     * Blow it off if the caller doesn't have the proper access rights</span>
00238 <span class="comment">     */</span>
00239     <span class="keywordflow">if</span> ((uOptions &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a410">SSCF_NOTIFY</a>) &amp;&amp; !<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
00240         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00241     }
00242 
00243     <span class="keywordflow">if</span> (GreGetDeviceCaps(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, NUMCOLORS) &lt;= 16) {
00244         uOptions |= <a class="code" href="../../d1/d0/inc_2user_8h.html#a404">SSCF_16COLORS</a>;
00245     }
00246 
00247     <span class="keywordflow">if</span> (uOptions &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a412">SSCF_SETMAGICCOLORS</a>) {
00248         <span class="comment">/*</span>
00249 <span class="comment">         * Set the Magic colors first</span>
00250 <span class="comment">         */</span>
00251         <span class="keywordflow">for</span>(i = 0; i &lt; cicol; i++) {
00252             icol = picolor[i];
00253             rgb = prgb[i];
00254             <span class="keywordflow">if</span> (    icol == COLOR_3DFACE ||
00255                     icol == COLOR_3DSHADOW ||
00256                     icol == COLOR_3DHILIGHT ||
00257                     icol == COLOR_DESKTOP) {
00258 
00259                 <a class="code" href="../../d4/d1/userk_8h.html#a1775">SetSysColor</a>(icol, rgb, uOptions);
00260             }
00261         }
00262     }
00263 
00264     <span class="keywordflow">for</span> (i = 0; i &lt; cicol; i++) {
00265 
00266         icol = *picolor++;
00267         rgb  = *prgb++;
00268 
00269         <span class="keywordflow">if</span> (icol &gt;= COLOR_MAX)
00270             <span class="keywordflow">continue</span>;
00271 
00272         <span class="keywordflow">if</span> ((uOptions &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a412">SSCF_SETMAGICCOLORS</a>) &amp;&amp;
00273                (icol == COLOR_3DFACE ||
00274                 icol == COLOR_3DSHADOW ||
00275                 icol == COLOR_3DHIGHLIGHT ||
00276                 icol == COLOR_DESKTOP)) {
00277             <span class="keywordflow">continue</span>;
00278         }
00279 
00280         <a class="code" href="../../d4/d1/userk_8h.html#a1775">SetSysColor</a>(icol, rgb, uOptions);
00281     }
00282 
00283     <span class="keywordflow">if</span> (uOptions &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a410">SSCF_NOTIFY</a>) {
00284 
00285         <span class="comment">/*</span>
00286 <span class="comment">         * Recolor all the current desktop</span>
00287 <span class="comment">         */</span>
00288         <a class="code" href="../../d4/d1/userk_8h.html#a1177">RecolorDeskPattern</a>();
00289 
00290         <span class="comment">/*</span>
00291 <span class="comment">         * Render the system bitmaps in new colors before we broadcast</span>
00292 <span class="comment">         */</span>
00293 
00294         <a class="code" href="../../d4/d1/userk_8h.html#a1857">xxxSetWindowNCMetrics</a>(pProfileUserName,NULL, FALSE, -1);
00295 
00296 
00297         <span class="comment">/*</span>
00298 <span class="comment">         * Notify everyone that the colors have changed.</span>
00299 <span class="comment">         */</span>
00300         <a class="code" href="../../d4/d1/userk_8h.html#a1581">xxxSendNotifyMessage</a>(PWND_BROADCAST, WM_SYSCOLORCHANGE, 0, 0L);
00301 
00302         <span class="comment">/*</span>
00303 <span class="comment">         * Just redraw the entire screen.  Trying to just draw the parts</span>
00304 <span class="comment">         * that were changed isn't worth it, since Control Panel always</span>
00305 <span class="comment">         * resets every color anyway.</span>
00306 <span class="comment">         *</span>
00307 <span class="comment">         * Anyway, it could get messy, sending apps NCPAINT messages without</span>
00308 <span class="comment">         * accumulating update regions too.</span>
00309 <span class="comment">         */</span>
00310         <a class="code" href="../../d4/d1/userk_8h.html#a470">xxxRedrawScreen</a>();
00311     }
00312 
00313     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00314 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
