<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: paint.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>paint.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d0/d2/paint_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a0">xxxFillWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndBrush, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndPaint, HDC hdc, HBRUSH hbr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a1">xxxPaintRect</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndBrush, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndPaint, HDC hdc, HBRUSH hbr, LPRECT lprc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a2">DeleteMaybeSpecialRgn</a> (HRGN hrgn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HRGN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a3">GetNCUpdateRgn</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fValidateFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a4">xxxSendNCPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HRGN hrgnUpdate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a5">xxxSendChildNCPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HDC&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a6">xxxBeginPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPPAINTSTRUCT lpps)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a7">xxxEndPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPPAINTSTRUCT lpps)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a8">InternalDoPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a9">DoPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndFilter, LPMSG lpMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a10">xxxSimpleDoSyncPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a11">xxxInternalDoSyncPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a12">DoQueuedSyncPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags, <a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a13">xxxDoSyncPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a14">ParentNeedsPaint</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a15">xxxSendEraseBkgnd</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdcBeginPaint, HRGN hrgnUpdate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a16">IncPaintCount</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a17">DecPaintCount</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a18">UT_GetParentDCClipBox</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdc, LPRECT lprc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/paint_8c.html#a19">UserRedrawDesktop</a> (VOID)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a17" doxytag="paint.c::DecPaintCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DecPaintCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01272">1272</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03346">tagTHREADINFO::cPaintsReady</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03040">tagCLIENTTHREADINFO::fsChangeBits</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03041">tagCLIENTTHREADINFO::fsWakeBits</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03325">tagTHREADINFO::pcti</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/swp_8c-source.html#l05495">ClrFTrueVis()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00574">DoPaint()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00151">GetNCUpdateRgn()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l00784">InternalInvalidate3()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l01121">xxxUpdateWindow2()</a>.
<p>
<pre class="fragment"><div>01274 {
01275     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
01276 
01277     <span class="keywordflow">if</span> (--pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o19">cPaintsReady</a> == 0) {
01278         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o5">pcti</a>-&gt;<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o2">fsWakeBits</a>   &amp;= ~QS_PAINT;
01279         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o5">pcti</a>-&gt;<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o1">fsChangeBits</a> &amp;= ~QS_PAINT;
01280     }
01281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="paint.c::DeleteMaybeSpecialRgn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DeleteMaybeSpecialRgn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HRGN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hrgn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00132">132</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03066">HRGN_SPECIAL_LAST</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/swp_8c-source.html#l05495">ClrFTrueVis()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00549">DeleteHrgnClip()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01638">DestroyCacheDC()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l00784">InternalInvalidate3()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00740">xxxSimpleDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>00134 {
00135     <span class="keywordflow">if</span> (hrgn &gt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a879">HRGN_SPECIAL_LAST</a>) {
00136         GreDeleteObject(hrgn);
00137     }
00138 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="paint.c::DoPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DoPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndFilter</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>lpMsg</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00574">574</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00131">CheckPwndFilter()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01272">DecPaintCount()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00787">FNID_DESKTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01757">tagWND::hrgnUpdate</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00510">InternalDoPaint()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03353">tagTHREADINFO::pwinsta</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02712">tagWINDOWSTATION::rpdeskList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04799">StoreMessage()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02828">TIF_SYSTEMTHREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02416">WFCLIPCHILDREN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02273">WFINTERNALPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02307">WFSTARTPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02274">WFUPDATEDIRTY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02305">WFWMPAINTSENT</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00213">xxxInternalGetMessage()</a>.
<p>
<pre class="fragment"><div>00577 {
00578     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwnd;
00579     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwndT;
00580     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00581 
00582 
00583 <span class="preprocessor">#if 0 // CHRISWIL: WIN95 SPECIFIC</span>
00584 <span class="preprocessor"></span>
00585     <span class="comment">/*</span>
00586 <span class="comment">     * If there is a system modal up and it is attached to another task,</span>
00587 <span class="comment">     * DON'T do paints.  We don't want to return a message for a window in</span>
00588 <span class="comment">     * another task!</span>
00589 <span class="comment">     */</span>
00590     <span class="keywordflow">if</span> (hwndSysModal &amp;&amp; (hwndSysModal-&gt;hq != hqCurrent)) {
00591 
00592         <span class="comment">/*</span>
00593 <span class="comment">         * Poke this guy so he wakes up at some point in the future,</span>
00594 <span class="comment">         * otherwise he may never wake up to realize he should paint.</span>
00595 <span class="comment">         * Causes hangs - e.g. Photoshop installation program</span>
00596 <span class="comment">         *   PostThreadMessage32(Lpq(hqCurrent)-&gt;idThread, WM_NULL, 0, 0, 0);</span>
00597 <span class="comment">         */</span>
00598         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00599     }
00600 
00601 <span class="preprocessor">#endif</span>
00602 <span class="preprocessor"></span>
00603     <span class="comment">/*</span>
00604 <span class="comment">     * If this is a system thread, then walk the windowstation desktop-list</span>
00605 <span class="comment">     * to find the window which needs painting.  For other threads, we</span>
00606 <span class="comment">     * reference off the thread-desktop.</span>
00607 <span class="comment">     */</span>
00608     <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a797">TIF_SYSTEMTHREAD</a>) {
00609 
00610         <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
00611         <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>       pdesk;
00612 
00613         <span class="keywordflow">if</span> ((pwinsta = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o23">pwinsta</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00614             RIPMSG0(RIP_ERROR, <span class="stringliteral">"DoPaint: SYSTEMTHREAD does not have (pwinsta)"</span>);
00615             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00616         }
00617 
00618         pwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00619         <span class="keywordflow">for</span>(pdesk = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>; pdesk; pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>) {
00620 
00621             <span class="keywordflow">if</span> (pwnd = <a class="code" href="../../d9/d2/paint_8c.html#a8">InternalDoPaint</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>, ptiCurrent))
00622                 <span class="keywordflow">break</span>;
00623         }
00624 
00625     } <span class="keywordflow">else</span> {
00626         pwnd = <a class="code" href="../../d9/d2/paint_8c.html#a8">InternalDoPaint</a>(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
00627                                ptiCurrent);
00628     }
00629 
00630     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00631 
00632         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1220">CheckPwndFilter</a>(pwnd, pwndFilter))
00633             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00634 
00635         <span class="comment">/*</span>
00636 <span class="comment">         * We're returning a WM_PAINT message, so clear WFINTERNALPAINT so</span>
00637 <span class="comment">         * it won't get sent again later.</span>
00638 <span class="comment">         */</span>
00639         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFINTERNALPAINT)) {
00640 
00641             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFINTERNALPAINT);
00642 
00643             <span class="comment">/*</span>
00644 <span class="comment">             * If there is no update region, then no more paint for this</span>
00645 <span class="comment">             * window.</span>
00646 <span class="comment">             */</span>
00647             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00648                 <a class="code" href="../../d4/d1/userk_8h.html#a1470">DecPaintCount</a>(pwnd);
00649         }
00650 
00651         <span class="comment">/*</span>
00652 <span class="comment">         * Set the STARTPAINT so that any other calls to BeginPaint while</span>
00653 <span class="comment">         * painting is begin performed, will prevent painting on those</span>
00654 <span class="comment">         * windows.</span>
00655 <span class="comment">         *</span>
00656 <span class="comment">         * Clear the UPDATEDIRTY since some apps (DBFast) don't call</span>
00657 <span class="comment">         * GetUpdateRect, BeginPaint/EndPaint.</span>
00658 <span class="comment">         */</span>
00659         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSTARTPAINT);
00660         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFUPDATEDIRTY);
00661 
00662         <span class="comment">/*</span>
00663 <span class="comment">         * If we get an invalidate between now and the time the app calls</span>
00664 <span class="comment">         * BeginPaint() and the windows parent is not CLIPCHILDREN, then</span>
00665 <span class="comment">         * the parent will paint in the wrong order.  So we are going to</span>
00666 <span class="comment">         * cause the child to paint again.  Look in beginpaint and internal</span>
00667 <span class="comment">         * invalidate for other parts of this fix.</span>
00668 <span class="comment">         *</span>
00669 <span class="comment">         * Set a flag to signify that we are in the bad zone.</span>
00670 <span class="comment">         *</span>
00671 <span class="comment">         * Must go up the parent links to make sure all parents have</span>
00672 <span class="comment">         * WFCLIPCHILDREN set otherwise set the WFWMPAINTSENT flag.</span>
00673 <span class="comment">         * This is to fix Excel spreadsheet and fulldrag. The speadsheet</span>
00674 <span class="comment">         * parent window (class XLDESK) has WFCLIPCHILDREN set but it's</span>
00675 <span class="comment">         * parent (class XLMAIN) doesn't. So the main window erases  the</span>
00676 <span class="comment">         * background after the child window paints.</span>
00677 <span class="comment">         *</span>
00678 <span class="comment">         * JOHANNEC : 27-Jul-1994</span>
00679 <span class="comment">         */</span>
00680         
00681         <span class="comment">/*</span>
00682 <span class="comment">         * NT Bug 400167: As we walk up the tree, we need to stop short of</span>
00683 <span class="comment">         * desktop windows and mother desktop windows.  We can't do a test</span>
00684 <span class="comment">         * for WFCLIPCHILDREN on the mother desktop window's parent because</span>
00685 <span class="comment">         * it doesn't exist.  This means that no desktop window will get </span>
00686 <span class="comment">         * WFWMPAINTSENT set, but the message window will be able to get </span>
00687 <span class="comment">         * WFWMPAINTSENT set.</span>
00688 <span class="comment">         */</span>
00689         
00690         pwndT = pwnd;
00691         <span class="keywordflow">while</span> (pwndT &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndT) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>)) {
00692 
00693             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, WFCLIPCHILDREN)) {
00694                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFWMPAINTSENT);
00695                 <span class="keywordflow">break</span>;
00696             }
00697 
00698             pwndT = pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>;
00699         }
00700 
00701         <span class="comment">/*</span>
00702 <span class="comment">         * If the top level "tiled" owner/parent of this window is iconed,</span>
00703 <span class="comment">         * send a WM_PAINTICON rather than a WM_PAINT.  The wParam</span>
00704 <span class="comment">         * is TRUE if this is the tiled window and FALSE if it is a</span>
00705 <span class="comment">         * child/owned popup of the minimized window.</span>
00706 <span class="comment">         *</span>
00707 <span class="comment">         * BACKWARD COMPATIBILITY HACK</span>
00708 <span class="comment">         *</span>
00709 <span class="comment">         * 3.0 sent WM_PAINTICON with wParam == TRUE for no apparent</span>
00710 <span class="comment">         * reason.  Lotus Notes 2.1 depends on this for some reason</span>
00711 <span class="comment">         * to properly change its icon when new mail arrives.</span>
00712 <span class="comment">         */</span>
00713         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT) &amp;&amp;
00714             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)    &amp;&amp;
00715             (pwnd-&gt;pcls-&gt;spicn != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00716 
00717             <a class="code" href="../../d4/d1/userk_8h.html#a1502">StoreMessage</a>(lpMsg, pwnd, WM_PAINTICON, (DWORD)TRUE, 0L, 0L);
00718 
00719         } <span class="keywordflow">else</span> {
00720 
00721             <a class="code" href="../../d4/d1/userk_8h.html#a1502">StoreMessage</a>(lpMsg, pwnd, WM_PAINT, 0, 0L, 0L);
00722         }
00723 
00724         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00725     }
00726 
00727     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00728 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="paint.c::DoQueuedSyncPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoQueuedSyncPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pti</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00972">972</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l04036">DSP_ALLCHILDREN</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04033">DSP_ENUMCLIPPEDCHILDREN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03297">PSMS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03337">tagTHREADINFO::psmsReceiveList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00969">QueueNotifyMessage()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02416">WFCLIPCHILDREN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02270">WFSENDERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02290">WFSYNCPAINTPENDING</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l01084">xxxDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>00976 {
00977     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiPwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
00978 
00979     <span class="keywordflow">if</span> ((ptiPwnd != pti)          &amp;&amp;
00980         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDNCPAINT)    &amp;&amp;
00981         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDERASEBKGND) &amp;&amp;
00982         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00983 
00984         <a class="code" href="../../d4/d1/userk_8h.html#a871">PSMS</a> psms = ptiPwnd-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o13">psmsReceiveList</a>;
00985 
00986         <span class="comment">/*</span>
00987 <span class="comment">         * If this window already has a WM_SYNCPAINT queue'd up, then there's</span>
00988 <span class="comment">         * no need to send another one.  Also protects our heap from getting</span>
00989 <span class="comment">         * chewed up.</span>
00990 <span class="comment">         */</span>
00991         <span class="keywordflow">while</span> (psms != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00992 
00993             <span class="keywordflow">if</span> ((psms-&gt;message == WM_SYNCPAINT) &amp;&amp; (psms-&gt;spwnd == pwnd)) {
00994                 <span class="keywordflow">break</span>;
00995             }
00996 
00997             psms = psms-&gt;psmsReceiveNext;
00998         }
00999 
01000         <span class="keywordflow">if</span> (psms == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01001             <span class="comment">/*</span>
01002 <span class="comment">             * This will give this message the semantics of a notify</span>
01003 <span class="comment">             * message (sendmessage no wait), without calling back</span>
01004 <span class="comment">             * the WH_CALLWNDPROC hook. We don't want to do that</span>
01005 <span class="comment">             * because that'll let all these processes with invalid</span>
01006 <span class="comment">             * windows to process paint messages before they process</span>
01007 <span class="comment">             * "synchronous" erasing or framing needs.</span>
01008 <span class="comment">             *</span>
01009 <span class="comment">             * Hi word of wParam must be zero or wow will drop it</span>
01010 <span class="comment">             *</span>
01011 <span class="comment">             * LATER mikeke</span>
01012 <span class="comment">             * Do we need to send down the flags with DWP_ERASE and DSP_FRAME</span>
01013 <span class="comment">             * in it?</span>
01014 <span class="comment">             */</span>
01015             UserAssert(HIWORD(flags) == 0);
01016             <a class="code" href="../../d4/d1/userk_8h.html#a1582">QueueNotifyMessage</a>(pwnd, WM_SYNCPAINT, flags, 0);
01017 
01018             <span class="comment">/*</span>
01019 <span class="comment">             * Set our syncpaint-pending flag, since we queued one up.  This</span>
01020 <span class="comment">             * will be used to check when we validate-parents for windows</span>
01021 <span class="comment">             * without clipchildren.</span>
01022 <span class="comment">             */</span>
01023             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSYNCPAINTPENDING);
01024         }
01025 
01026         <span class="comment">/*</span>
01027 <span class="comment">         * If we posted a WM_SYNCPAINT for a top-level window that is not</span>
01028 <span class="comment">         * of the current thread we're done; we'll pick up the children</span>
01029 <span class="comment">         * when we process the message for real.  If we're the desktop</span>
01030 <span class="comment">         * however make sure we get all it children.</span>
01031 <span class="comment">         */</span>
01032         <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd))
01033             <span class="keywordflow">return</span>;
01034     }
01035 
01036     <span class="comment">/*</span>
01037 <span class="comment">     * Normally we like to enumerate all of this window's children and have</span>
01038 <span class="comment">     * them erase their backgrounds synchronously.  However, this is a bad</span>
01039 <span class="comment">     * thing to do if the window is NOT CLIPCHLIDREN.  Here's the scenario</span>
01040 <span class="comment">     * we want to to avoid:</span>
01041 <span class="comment">     *</span>
01042 <span class="comment">     * 1.  Window 'A' is invalidated</span>
01043 <span class="comment">     * 2.  'A' erases itself (or not, doesn't matter)</span>
01044 <span class="comment">     * 3.  'A's children are enumerated and they erase themselves.</span>
01045 <span class="comment">     * 4.  'A' paints over its children (remember, 'A' isn't CLIPCHILDREN)</span>
01046 <span class="comment">     * 5.  'A's children paint but their backgrounds aren't their ERASEBKND</span>
01047 <span class="comment">     *    color (because 'A' painted over them) and everything looks like</span>
01048 <span class="comment">     *    dirt.</span>
01049 <span class="comment">     */</span>
01050     <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a498">DSP_ALLCHILDREN</a>) ||
01051         ((flags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a495">DSP_ENUMCLIPPEDCHILDREN</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCLIPCHILDREN))) {
01052 
01053         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
01054 
01055         <span class="keywordflow">for</span> (pwndT = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>; pwndT; pwndT = pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) {
01056 
01057             <span class="comment">/*</span>
01058 <span class="comment">             * Don't cause any more intertask sendmessages cause it does</span>
01059 <span class="comment">             * bad things to cbt's windowproc hooks.  (Due to SetParent</span>
01060 <span class="comment">             * allowing child windows in the topwindow hierarchy.</span>
01061 <span class="comment">             * The child bit also catches the desktop window; we want to</span>
01062 <span class="comment">             */</span>
01063             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, WFCHILD) &amp;&amp; (pti != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndT)))
01064                 <span class="keywordflow">continue</span>;
01065 
01066             <span class="comment">/*</span>
01067 <span class="comment">             * Note that we pass only certain bits down as we recurse:</span>
01068 <span class="comment">             * the other bits pertain to the current window only.</span>
01069 <span class="comment">             */</span>
01070             <a class="code" href="../../d9/d2/paint_8c.html#a12">DoQueuedSyncPaint</a>(pwndT, flags, pti);
01071         }
01072     }
01073 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="paint.c::GetNCUpdateRgn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HRGN GetNCUpdateRgn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fValidateFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00151">151</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00585">CalcWindowRgn()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02217">CopyRgn</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00074">CreateEmptyRgnPublic()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01272">DecPaintCount()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00491">ghrgnInv2</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01757">tagWND::hrgnUpdate</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02219">IntersectRgn</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02273">WFINTERNALPAINT</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02274">WFUPDATEDIRTY</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00740">xxxSimpleDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>00154 {
00155     HRGN hrgnUpdate;
00156 
00157     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> &gt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a877">HRGN_FULL</a>) {
00158 
00159         <span class="comment">/*</span>
00160 <span class="comment">         * We must make a copy of our update region, because</span>
00161 <span class="comment">         * it could change if we send a message, and we want to</span>
00162 <span class="comment">         * make sure the whole thing is used for drawing our</span>
00163 <span class="comment">         * frame and background.  We can't use a global</span>
00164 <span class="comment">         * temporary region, because more than one app may</span>
00165 <span class="comment">         * be calling this routine.</span>
00166 <span class="comment">         */</span>
00167         hrgnUpdate = <a class="code" href="../../d4/d1/userk_8h.html#a1163">CreateEmptyRgnPublic</a>();
00168 
00169         <span class="keywordflow">if</span> (hrgnUpdate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00170             hrgnUpdate = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a877">HRGN_FULL</a>;
00171         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a227">CopyRgn</a>(hrgnUpdate, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>) == ERROR) {
00172             GreDeleteObject(hrgnUpdate);
00173             hrgnUpdate = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a877">HRGN_FULL</a>;
00174         }
00175 
00176         <span class="keywordflow">if</span> (fValidateFrame) {
00177 
00178             <span class="comment">/*</span>
00179 <span class="comment">             * Now that we've taken care of any frame drawing,</span>
00180 <span class="comment">             * intersect the update region with the window's</span>
00181 <span class="comment">             * client area.  Otherwise, apps that do ValidateRects()</span>
00182 <span class="comment">             * to draw themselves (e.g., WinWord) won't ever</span>
00183 <span class="comment">             * subtract off the part of the update region that</span>
00184 <span class="comment">             * overlaps the frame but not the client.</span>
00185 <span class="comment">             */</span>
00186             <a class="code" href="../../d3/d6/visrgn_8c.html#a18">CalcWindowRgn</a>(pwnd, ghrgnInv2, TRUE);
00187 
00188             <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d1/userk_8h.html#a228">IntersectRgn</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>,
00189                                  pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>,
00190                                  ghrgnInv2)) {
00191             <span class="keywordflow">case</span> ERROR:
00192                 <span class="comment">/*</span>
00193 <span class="comment">                 * If an error occured, we can't leave things as</span>
00194 <span class="comment">                 * they are: invalidate the whole window and let</span>
00195 <span class="comment">                 * BeginPaint() take care of it.</span>
00196 <span class="comment">                 */</span>
00197                 GreDeleteObject(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>);
00198                 pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a877">HRGN_FULL</a>;
00199                 <span class="keywordflow">break</span>;
00200 
00201             <span class="keywordflow">case</span> NULLREGION:
00202                 <span class="comment">/*</span>
00203 <span class="comment">                 * There is nothing in the client area to repaint.</span>
00204 <span class="comment">                 * Blow the region away, and decrement the paint count</span>
00205 <span class="comment">                 * if possible.</span>
00206 <span class="comment">                 */</span>
00207                 GreDeleteObject(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>);
00208                 pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00209                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFUPDATEDIRTY);
00210                 <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFINTERNALPAINT))
00211                     <a class="code" href="../../d4/d1/userk_8h.html#a1470">DecPaintCount</a>(pwnd);
00212                 <span class="keywordflow">break</span>;
00213             }
00214         }
00215 
00216     } <span class="keywordflow">else</span> {
00217         hrgnUpdate = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>;
00218     }
00219 
00220     <span class="keywordflow">return</span> hrgnUpdate;
00221 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="paint.c::IncPaintCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IncPaintCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01248">1248</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03346">tagTHREADINFO::cPaintsReady</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04578">SetWakeBit()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/update_8c-source.html#l00784">InternalInvalidate3()</a>.
<p>
<pre class="fragment"><div>01250 {
01251     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
01252 
01253     <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o19">cPaintsReady</a>++ == 0)
01254         <a class="code" href="../../d4/d1/userk_8h.html#a1197">SetWakeBit</a>(pti, QS_PAINT);
01255 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="paint.c::InternalDoPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> InternalDoPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ptiCurrent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00510">510</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01774">NEEDSPAINT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02362">WEFTRANSPARENT</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00574">DoPaint()</a>.
<p>
<pre class="fragment"><div>00513 {
00514     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00515 
00516     <span class="comment">/*</span>
00517 <span class="comment">     * Enumerate all windows, top-down, looking for one that</span>
00518 <span class="comment">     * needs repainting.  Skip windows of other tasks.</span>
00519 <span class="comment">     */</span>
00520     <span class="keywordflow">for</span> ( ; pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) {
00521 
00522         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd) == ptiCurrent) {
00523 
00524             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a501">NEEDSPAINT</a>(pwnd)) {
00525 
00526                 <span class="comment">/*</span>
00527 <span class="comment">                 * If this window is transparent, we don't want to</span>
00528 <span class="comment">                 * send it a WM_PAINT until all its siblings below it</span>
00529 <span class="comment">                 * have been repainted.  If we find an unpainted sibling</span>
00530 <span class="comment">                 * below, return it instead.</span>
00531 <span class="comment">                 */</span>
00532                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTRANSPARENT)) {
00533 
00534                     pwndT = pwnd;
00535                     <span class="keywordflow">while</span> ((pwndT = pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00536 
00537                         <span class="comment">/*</span>
00538 <span class="comment">                         * Make sure sibling window belongs to same app</span>
00539 <span class="comment">                         */</span>
00540                         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndT) == ptiCurrent) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a501">NEEDSPAINT</a>(pwndT)) {
00541 
00542                             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, WEFTRANSPARENT))
00543                                 <span class="keywordflow">continue</span>;
00544 
00545                             <span class="keywordflow">return</span> pwndT;
00546                         }
00547                     }
00548                 }
00549 
00550                 <span class="keywordflow">return</span> pwnd;
00551             }
00552         }
00553 
00554         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a> &amp;&amp;
00555             (pwndT = <a class="code" href="../../d9/d2/paint_8c.html#a8">InternalDoPaint</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, ptiCurrent))) {
00556 
00557             <span class="keywordflow">return</span> pwndT;
00558         }
00559     }
00560 
00561     <span class="keywordflow">return</span> pwnd;
00562 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="paint.c::ParentNeedsPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> ParentNeedsPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01120">1120</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01774">NEEDSPAINT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02416">WFCLIPCHILDREN</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l01084">xxxDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>01122 {
01123     <span class="keywordflow">while</span> ((pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01124 
01125         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCLIPCHILDREN))
01126             <span class="keywordflow">break</span>;
01127 
01128         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a501">NEEDSPAINT</a>(pwnd))
01129             <span class="keywordflow">return</span> pwnd;
01130     }
01131 
01132     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01133 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="paint.c::UserRedrawDesktop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserRedrawDesktop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01321">1321</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l01302">xxxInternalInvalidate()</a>.
<p>
<pre class="fragment"><div>01322 {
01323     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwnd;
01324     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDesk;
01325 
01326     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
01327 
01328     pwndDesk = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;rpdesk-&gt;pDeskInfo-&gt;spwnd;
01329 
01330     <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndDesk, &amp;tlpwnd);
01331 
01332     <a class="code" href="../../d4/d1/userk_8h.html#a1681">xxxInternalInvalidate</a>(pwndDesk,
01333                           HRGN_FULL,
01334                           RDW_INVALIDATE |
01335                               RDW_ERASE  |
01336                               RDW_FRAME  |
01337                               RDW_ALLCHILDREN);
01338 
01339     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01340 
01341     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
01342 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="paint.c::UT_GetParentDCClipBox" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int UT_GetParentDCClipBox           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01293">1293</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01594">CFPARENTDC</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00856">GetRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03420">GRECT_CLIENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03424">GRECT_CLIENTCOORDS</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00191">IntersectRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00033">xxxFillWindow()</a>.
<p>
<pre class="fragment"><div>01297 {
01298     RECT rc;
01299 
01300     <span class="keywordflow">if</span> (GreGetClipBox(hdc, lprc, TRUE) == NULLREGION)
01301         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01302 
01303     <span class="keywordflow">if</span> ((pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFPARENTDC))
01304         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01305 
01306     <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">GetRect</a>(pwnd, &amp;rc, GRECT_CLIENT | GRECT_CLIENTCOORDS);
01307 
01308     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/rect_8c.html#a8">IntersectRect</a>(lprc, lprc, &amp;rc);
01309 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="paint.c::xxxBeginPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDC xxxBeginPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPPAINTSTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpps</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">310</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00057">ClearHungFlag()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00057">CreateEmptyRgn()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01272">DecPaintCount()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00132">DeleteMaybeSpecialRgn()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00151">GetNCUpdateRgn()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00049">ghrgnUpdateSave</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00050">gnUpdateSave</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01757">tagWND::hrgnUpdate</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01774">NEEDSPAINT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06597">PUDF_DRAGGINGFULLWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02223">UnionRgn</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01293">UT_GetParentDCClipBox()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02306">WFDONTVALIDATE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02271">WFERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02273">WFINTERNALPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02289">WFPAINTNOTPROCESSED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02298">WFREDRAWIFHUNG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02270">WFSENDERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02307">WFSTARTPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02274">WFUPDATEDIRTY</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00278">xxxSendChildNCPaint()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01147">xxxSendEraseBkgnd()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00232">xxxSendNCPaint()</a>, and <a class="el" href="../../d5/d4/caret_8c-source.html#l00376">zzzInternalHideCaret()</a>.
<p>
<pre class="fragment"><div>00313 {
00314     HRGN hrgnUpdate;
00315     HDC  hdc;
00316     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSendEraseBkgnd;
00317 
00318     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00319     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00320 
00321     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_DRAGGINGFULLWINDOW))
00322         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSTARTPAINT);
00323 
00324     <span class="comment">/*</span>
00325 <span class="comment">     * We're processing a WM_PAINT message: clear this flag.</span>
00326 <span class="comment">     */</span>
00327     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFPAINTNOTPROCESSED);
00328 
00329     <span class="comment">/*</span>
00330 <span class="comment">     * If this bit gets set while we are drawing the frame we will need</span>
00331 <span class="comment">     * to redraw it.</span>
00332 <span class="comment">     *</span>
00333 <span class="comment">     * If necessary, send our WM_NCPAINT message now.</span>
00334 <span class="comment">     *</span>
00335 <span class="comment">     * please heed these notes</span>
00336 <span class="comment">     *</span>
00337 <span class="comment">     * We have to send this message BEFORE we diddle hwnd-&gt;hrgnUpdate,</span>
00338 <span class="comment">     * because an app may call ValidateRect or InvalidateRect in its</span>
00339 <span class="comment">     * handler, and it expects what it does to affect what gets drawn</span>
00340 <span class="comment">     * in the later WM_PAINT.</span>
00341 <span class="comment">     *</span>
00342 <span class="comment">     * It is possible to get an invalidate when we leave the critical</span>
00343 <span class="comment">     * section below, therefore we loop until UPDATEDIRTY is clear</span>
00344 <span class="comment">     * meaning there were no additional invalidates.</span>
00345 <span class="comment">     */</span>
00346     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDNCPAINT)) {
00347 
00348         <span class="keywordflow">do</span> {
00349             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFUPDATEDIRTY);
00350             hrgnUpdate = <a class="code" href="../../d9/d2/paint_8c.html#a3">GetNCUpdateRgn</a>(pwnd, FALSE);
00351             <a class="code" href="../../d9/d2/paint_8c.html#a4">xxxSendNCPaint</a>(pwnd, hrgnUpdate);
00352             <a class="code" href="../../d4/d1/userk_8h.html#a1003">DeleteMaybeSpecialRgn</a>(hrgnUpdate);
00353         } <span class="keywordflow">while</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFUPDATEDIRTY));
00354 
00355     } <span class="keywordflow">else</span> {
00356         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFUPDATEDIRTY);
00357     }
00358 
00359     <span class="comment">/*</span>
00360 <span class="comment">     * Hide the caret if needed.  Do this before we get the DC so</span>
00361 <span class="comment">     * that if HideCaret() gets and releases a DC we will be able</span>
00362 <span class="comment">     * to reuse it later here.</span>
00363 <span class="comment">     * No need to DeferWinEventNotify() since pwnd is locked.</span>
00364 <span class="comment">     */</span>
00365     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;caret.spwnd)
00366         <a class="code" href="../../d4/d5/caret_8c.html#a6">zzzInternalHideCaret</a>();
00367 
00368     <span class="comment">/*</span>
00369 <span class="comment">     * Send the check for sending an WM_ERASEBKGND to the</span>
00370 <span class="comment">     * window.</span>
00371 <span class="comment">     */</span>
00372     <span class="keywordflow">if</span> (fSendEraseBkgnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDERASEBKGND)) {
00373         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFERASEBKGND);
00374         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDERASEBKGND);
00375     }
00376 
00377     <span class="comment">/*</span>
00378 <span class="comment">     * Validate the entire window.</span>
00379 <span class="comment">     */</span>
00380     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a501">NEEDSPAINT</a>(pwnd))
00381         <a class="code" href="../../d4/d1/userk_8h.html#a1470">DecPaintCount</a>(pwnd);
00382 
00383     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFINTERNALPAINT);
00384 
00385     hrgnUpdate = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>;
00386     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00387 
00388     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDONTVALIDATE)) {
00389 
00390         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a9">ghrgnUpdateSave</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00391             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a9">ghrgnUpdateSave</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1162">CreateEmptyRgn</a>();
00392         }
00393 
00394         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a9">ghrgnUpdateSave</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00395             <a class="code" href="../../d4/d1/userk_8h.html#a230">UnionRgn</a>(ghrgnUpdateSave, ghrgnUpdateSave, hrgnUpdate);
00396             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a10">gnUpdateSave</a>++;
00397         }
00398     }
00399 
00400     <span class="comment">/*</span>
00401 <span class="comment">     * Clear these flags for backward compatibility</span>
00402 <span class="comment">     */</span>
00403     lpps-&gt;fIncUpdate =
00404     lpps-&gt;fRestore   = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00405 
00406     lpps-&gt;hdc =
00407     hdc       = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd,
00408                          hrgnUpdate,
00409                          DCX_USESTYLE | DCX_INTERSECTRGN);
00410 
00411     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1233">UT_GetParentDCClipBox</a>(pwnd, hdc, &amp;lpps-&gt;rcPaint)) {
00412 
00413         <span class="comment">/*</span>
00414 <span class="comment">         * If necessary, erase our background, and possibly deal with</span>
00415 <span class="comment">         * our children's frames and backgrounds.</span>
00416 <span class="comment">         */</span>
00417         <span class="keywordflow">if</span> (fSendEraseBkgnd)
00418             <a class="code" href="../../d4/d1/userk_8h.html#a1467">xxxSendEraseBkgnd</a>(pwnd, hdc, hrgnUpdate);
00419     }
00420 
00421     <span class="comment">/*</span>
00422 <span class="comment">     * Now that we're completely erased, see if there are any children</span>
00423 <span class="comment">     * that couldn't draw their own frames because their update regions</span>
00424 <span class="comment">     * got deleted.</span>
00425 <span class="comment">     */</span>
00426     <a class="code" href="../../d9/d2/paint_8c.html#a5">xxxSendChildNCPaint</a>(pwnd);
00427 
00428     <span class="comment">/*</span>
00429 <span class="comment">     * The erase and frame operation has occured. Clear the WFREDRAWIFHUNG</span>
00430 <span class="comment">     * bit here. We don't want to clear it until we know the erase and</span>
00431 <span class="comment">     * frame has occured, so we know we always have a consistent looking</span>
00432 <span class="comment">     * window.</span>
00433 <span class="comment">     */</span>
00434     <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWIFHUNG);
00435 
00436     lpps-&gt;fErase = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFERASEBKGND) != 0);
00437 
00438     <span class="keywordflow">return</span> hdc;
00439 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="paint.c::xxxDoSyncPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxDoSyncPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01084">1084</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00972">DoQueuedSyncPaint()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01120">ParentNeedsPaint()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00885">xxxInternalDoSyncPaint()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/swp_8c-source.html#l04773">xxxEndDeferWindowPosEx()</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l01302">xxxInternalInvalidate()</a>.
<p>
<pre class="fragment"><div>01087 {
01088     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01089 
01090     <span class="comment">/*</span>
01091 <span class="comment">     * If any of our non-clipchildren parents have an update region, don't</span>
01092 <span class="comment">     * do anything.  This way we won't redraw our background or frame out</span>
01093 <span class="comment">     * of order, only to have it get obliterated when our parent erases his</span>
01094 <span class="comment">     * background.</span>
01095 <span class="comment">     */</span>
01096     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1124">ParentNeedsPaint</a>(pwnd))
01097         <span class="keywordflow">return</span>;
01098 
01099     <span class="comment">/*</span>
01100 <span class="comment">     * First of all if we are going to be queueing any WM_SYNCPAINT messages</span>
01101 <span class="comment">     * to windows of another thread do it first while the window's update</span>
01102 <span class="comment">     * regions are still in sync.  This way there is no chance the update</span>
01103 <span class="comment">     * region will be incorrect (through window movement during callbacks of</span>
01104 <span class="comment">     * the WM_ERASEBKGND|WM_NCPAINT messages).</span>
01105 <span class="comment">     */</span>
01106     <a class="code" href="../../d9/d2/paint_8c.html#a12">DoQueuedSyncPaint</a>(pwnd, flags, <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>());
01107     <a class="code" href="../../d4/d1/userk_8h.html#a1042">xxxInternalDoSyncPaint</a>(pwnd, flags);
01108 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="paint.c::xxxEndPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxEndPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPPAINTSTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpps</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00449">449</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00049">ghrgnUpdateSave</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00050">gnUpdateSave</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l00784">InternalInvalidate3()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01337">ReleaseCacheDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02306">WFDONTVALIDATE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02307">WFSTARTPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02305">WFWMPAINTSENT</a>, and <a class="el" href="../../d5/d4/caret_8c-source.html#l00331">zzzInternalShowCaret()</a>.
<p>
<pre class="fragment"><div>00452 {
00453     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00454 
00455     <a class="code" href="../../d4/d1/userk_8h.html#a1698">ReleaseCacheDC</a>(lpps-&gt;hdc, TRUE);
00456 
00457     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDONTVALIDATE)) {
00458 
00459         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a9">ghrgnUpdateSave</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00460 
00461             <a class="code" href="../../d4/d1/userk_8h.html#a1992">InternalInvalidate3</a>(pwnd,
00462                                 ghrgnUpdateSave,
00463                                 RDW_INVALIDATE | RDW_ERASE);
00464 
00465             <span class="keywordflow">if</span> (--<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a10">gnUpdateSave</a> == 0) {
00466                 GreDeleteObject(ghrgnUpdateSave);
00467                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a9">ghrgnUpdateSave</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00468             }
00469         }
00470 
00471         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFDONTVALIDATE);
00472     }
00473 
00474     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFWMPAINTSENT);
00475 
00476     <span class="comment">/*</span>
00477 <span class="comment">     * This used to check that the update-region was empty before</span>
00478 <span class="comment">     * doing the clear.  However, this caused a problem with WOW</span>
00479 <span class="comment">     * amipro/approach hanging.  They were invalidating rects in</span>
00480 <span class="comment">     * their WM_PAINT handler, and allowing the defwindowproc to</span>
00481 <span class="comment">     * perform the validation for them.  Since we were blocking</span>
00482 <span class="comment">     * the BeginPaint in this case, it sent them into a infinite</span>
00483 <span class="comment">     * loop (see bug 19036).</span>
00484 <span class="comment">     */</span>
00485     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSTARTPAINT);
00486 
00487     <span class="comment">/*</span>
00488 <span class="comment">     * Reshow the caret if needed, but AFTER we've released the DC.</span>
00489 <span class="comment">     * This way ShowCaret() can reuse the DC we just released.</span>
00490 <span class="comment">     */</span>
00491     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;caret.spwnd)
00492         <a class="code" href="../../d4/d5/caret_8c.html#a5">zzzInternalShowCaret</a>();
00493 
00494     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00495 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="paint.c::xxxFillWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxFillWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndBrush</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndPaint</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBRUSH&nbsp;</td>
          <td class="mdname" nowrap> <em>hbr</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00033">33</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01293">UT_GetParentDCClipBox()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00072">xxxPaintRect()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l02986">NtUserFillWindow()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00340">xxxDWP_EraseBkgnd()</a>.
<p>
<pre class="fragment"><div>00038 {
00039     RECT rc;
00040 
00041     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndBrush);
00042     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndPaint);
00043 
00044     <span class="comment">/*</span>
00045 <span class="comment">     * If there is no pwndBrush (sometimes the parent), use pwndPaint.</span>
00046 <span class="comment">     */</span>
00047     <span class="keywordflow">if</span> (pwndBrush == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00048         pwndBrush = pwndPaint;
00049 
00050     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1233">UT_GetParentDCClipBox</a>(pwndPaint, hdc, &amp;rc))
00051         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1568">xxxPaintRect</a>(pwndBrush, pwndPaint, hdc, hbr, &amp;rc);
00052 
00053     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00054 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="paint.c::xxxInternalDoSyncPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxInternalDoSyncPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00885">885</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00091">BuildHwndList()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03634">BWL_ENUMLIST</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04036">DSP_ALLCHILDREN</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04033">DSP_ENUMCLIPPEDCHILDREN</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00417">FreeHwndList()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03624">tagBWL::rghwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02416">WFCLIPCHILDREN</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00740">xxxSimpleDoSyncPaint()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l01084">xxxDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>00888 {
00889     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00890 
00891     <span class="comment">/*</span>
00892 <span class="comment">     * Do the paint for this window.</span>
00893 <span class="comment">     */</span>
00894     <a class="code" href="../../d4/d1/userk_8h.html#a1040">xxxSimpleDoSyncPaint</a>(pwnd);
00895 
00896     <span class="comment">/*</span>
00897 <span class="comment">     * Normally we like to enumerate all of this window's children and have</span>
00898 <span class="comment">     * them erase their backgrounds synchronously.  However, this is a bad</span>
00899 <span class="comment">     * thing to do if the window is NOT CLIPCHLIDREN.  Here's the scenario</span>
00900 <span class="comment">     * we want to to avoid:</span>
00901 <span class="comment">     *</span>
00902 <span class="comment">     * 1) Window 'A' is invalidated</span>
00903 <span class="comment">     * 2) 'A' erases itself (or not, doesn't matter)</span>
00904 <span class="comment">     * 3) 'A's children are enumerated and they erase themselves.</span>
00905 <span class="comment">     * 4) 'A' paints over its children (remember, 'A' isn't CLIPCHILDREN)</span>
00906 <span class="comment">     * 5) 'A's children paint but their backgrounds aren't their ERASEBKND</span>
00907 <span class="comment">     *    color (because 'A' painted over them) and everything looks like</span>
00908 <span class="comment">     *    dirt.</span>
00909 <span class="comment">     */</span>
00910     <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a498">DSP_ALLCHILDREN</a>) ||
00911         ((flags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a495">DSP_ENUMCLIPPEDCHILDREN</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCLIPCHILDREN))) {
00912 
00913         <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwnd;
00914         <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a> pbwl;
00915         HWND *phwnd;
00916 
00917         <span class="keywordflow">if</span> (pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, BWL_ENUMLIST, NULL)) {
00918 
00919             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00920             HWND        hwnd;
00921 
00922             <span class="comment">/*</span>
00923 <span class="comment">             * If the client dies during a callback, the hwnd list</span>
00924 <span class="comment">             * will be freed in xxxDestroyThreadInfo.</span>
00925 <span class="comment">             */</span>
00926             <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; (hwnd = *phwnd) != (HWND)1; phwnd++) {
00927 
00928                 <span class="keywordflow">if</span> (hwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00929                     <span class="keywordflow">continue</span>;
00930 
00931                 <span class="keywordflow">if</span> ((pwnd = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00932                     <span class="keywordflow">continue</span>;
00933 
00934                 <span class="comment">/*</span>
00935 <span class="comment">                 * Note: testing if a window is a child automatically</span>
00936 <span class="comment">                 * excludes the desktop window.</span>
00937 <span class="comment">                 */</span>
00938                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD) &amp;&amp; (ptiCurrent != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd))) {
00939 
00940                     <span class="comment">/*</span>
00941 <span class="comment">                     * Don't cause any more intertask sendmessages cause it</span>
00942 <span class="comment">                     * does bad things to cbt's windowproc hooks.  (Due to</span>
00943 <span class="comment">                     * SetParent allowing child windows in the topwindow</span>
00944 <span class="comment">                     * hierarchy.</span>
00945 <span class="comment">                     */</span>
00946                     <span class="keywordflow">continue</span>;
00947                 }
00948 
00949                 <span class="comment">/*</span>
00950 <span class="comment">                 * Note that we pass only certain bits down as we recurse:</span>
00951 <span class="comment">                 * the other bits pertain to the current window only.</span>
00952 <span class="comment">                 */</span>
00953                 <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(ptiCurrent, pwnd, &amp;tlpwnd);
00954                 <a class="code" href="../../d4/d1/userk_8h.html#a1042">xxxInternalDoSyncPaint</a>(pwnd, flags);
00955                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00956             }
00957 
00958             <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
00959         }
00960     }
00961 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="paint.c::xxxPaintRect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxPaintRect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndBrush</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndPaint</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBRUSH&nbsp;</td>
          <td class="mdname" nowrap> <em>hbr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00072">72</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00193">xxxGetControlColor()</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00033">xxxFillWindow()</a>.
<p>
<pre class="fragment"><div>00078 {
00079     POINT ptOrg;
00080 
00081     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndBrush);
00082     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndPaint);
00083 
00084     <span class="keywordflow">if</span> (pwndBrush == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00085         pwndBrush = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;rpdesk-&gt;pDeskInfo-&gt;spwnd;
00086     }
00087 
00088     <span class="keywordflow">if</span> (pwndBrush == <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwndBrush)) {
00089         GreSetBrushOrg(
00090                 hdc,
00091                 0,
00092                 0,
00093                 &amp;ptOrg);
00094     } <span class="keywordflow">else</span> {
00095         GreSetBrushOrg(
00096                 hdc,
00097                 pwndBrush-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left - pwndPaint-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00098                 pwndBrush-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top - pwndPaint-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top,
00099                 &amp;ptOrg);
00100     }
00101 
00102     <span class="comment">/*</span>
00103 <span class="comment">     * If hbr &lt; CTLCOLOR_MAX, it isn't really a brush but is one of our</span>
00104 <span class="comment">     * special color values.  Translate it to the appropriate WM_CTLCOLOR</span>
00105 <span class="comment">     * message and send it off to get back a real brush.  The translation</span>
00106 <span class="comment">     * process assumes the CTLCOLOR*** and WM_CTLCOLOR*** values map directly.</span>
00107 <span class="comment">     */</span>
00108     <span class="keywordflow">if</span> (hbr &lt; (HBRUSH)CTLCOLOR_MAX) {
00109         hbr = <a class="code" href="../../d4/d1/userk_8h.html#a1565">xxxGetControlColor</a>(pwndBrush,
00110                                  pwndPaint,
00111                                  hdc,
00112                                  HandleToUlong(hbr) + WM_CTLCOLORMSGBOX);
00113     }
00114 
00115     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, lprc, hbr);
00116 
00117     GreSetBrushOrg(hdc, ptOrg.x, ptOrg.y, NULL);
00118 
00119 
00120     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00121 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="paint.c::xxxSendChildNCPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxSendChildNCPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00278">278</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01757">tagWND::hrgnUpdate</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01342">ThreadLockExchangeAlways()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01247">ThreadLockNever</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00232">xxxSendNCPaint()</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>.
<p>
<pre class="fragment"><div>00280 {
00281     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00282 
00283     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00284 
00285     <a class="code" href="../../d4/d1/userk_8h.html#a115">ThreadLockNever</a>(&amp;tlpwnd);
00286     pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
00287     <span class="keywordflow">while</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00288         <span class="keywordflow">if</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDNCPAINT)) {
00289             <a class="code" href="../../d4/d1/userk_8h.html#a983">ThreadLockExchangeAlways</a>(pwnd, &amp;tlpwnd);
00290             <a class="code" href="../../d9/d2/paint_8c.html#a4">xxxSendNCPaint</a>(pwnd, HRGN_FULL);
00291         }
00292 
00293         pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
00294     }
00295 
00296     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00297 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="paint.c::xxxSendEraseBkgnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSendEraseBkgnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcBeginPaint</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HRGN&nbsp;</td>
          <td class="mdname" nowrap> <em>hrgnUpdate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l01147">1147</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03319">tagTHREADINFO::ppi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01337">ReleaseCacheDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02271">WFERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02270">WFSENDERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02318">WFWIN31COMPAT</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00740">xxxSimpleDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>01151 {
01152     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent;
01153     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fErased;
01154     HDC         hdc;
01155 
01156     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01157 
01158     <span class="comment">/*</span>
01159 <span class="comment">     * For minimized dudes in win3.1, we would've sent an</span>
01160 <span class="comment">     * WM_ICONERASEBKGND and cleared the erase bit.  Now that min</span>
01161 <span class="comment">     * windows in 4.0 are all nonclient, don't bother erasing at</span>
01162 <span class="comment">     * all.  Pretend like we did.</span>
01163 <span class="comment">     *</span>
01164 <span class="comment">     * NOTE:</span>
01165 <span class="comment">     * For &lt; 4.0 windows, we may have to send a fake WM_ICONERASEKBGND</span>
01166 <span class="comment">     * to keep 'em happy.  Saves time not to though.  Getting a DC and</span>
01167 <span class="comment">     * sending the message ain't speedy.</span>
01168 <span class="comment">     */</span>
01169     <span class="keywordflow">if</span> ((hrgnUpdate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED))
01170         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01171 
01172     <span class="comment">/*</span>
01173 <span class="comment">     * If a DC to use was not passed in, get one.</span>
01174 <span class="comment">     * We want one clipped to this window's update region.</span>
01175 <span class="comment">     */</span>
01176     <span class="keywordflow">if</span> (hdcBeginPaint == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01177 
01178        hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd,
01179                       hrgnUpdate,
01180                       DCX_USESTYLE | DCX_INTERSECTRGN | DCX_NODELETERGN);
01181     } <span class="keywordflow">else</span> {
01182 
01183         hdc = hdcBeginPaint;
01184     }
01185 
01186     <span class="comment">/*</span>
01187 <span class="comment">     * If we're send the WM_ERASEBKGND to another process</span>
01188 <span class="comment">     * we need to change the DC owner.</span>
01189 <span class="comment">     *</span>
01190 <span class="comment">     * We'd like to change the owner to pwnd-&gt;pti-&gt;idProcess, but</span>
01191 <span class="comment">     * GDI won't let us assign ownership back to ourselves later.</span>
01192 <span class="comment">     */</span>
01193     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01194 
01195     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi != ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>)
01196         GreSetDCOwner(hdc, OBJECT_OWNER_PUBLIC);
01197 
01198     <span class="comment">/*</span>
01199 <span class="comment">     * Send the event to the window.  This contains the DC clipped to</span>
01200 <span class="comment">     * the update-region.</span>
01201 <span class="comment">     */</span>
01202     fErased = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_ERASEBKGND, (WPARAM)hdc, 0L);
01203 
01204     <span class="comment">/*</span>
01205 <span class="comment">     * If we've changed the DC owner, change it back to</span>
01206 <span class="comment">     * the current process.</span>
01207 <span class="comment">     */</span>
01208     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi != ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>)
01209         GreSetDCOwner(hdc, OBJECT_OWNER_CURRENT);
01210 
01211     <span class="comment">/*</span>
01212 <span class="comment">     * If the WM_ERASEBKGND message did not erase the</span>
01213 <span class="comment">     * background, then set this flag to let BeginPaint()</span>
01214 <span class="comment">     * know to ask the caller to do it via the fErase</span>
01215 <span class="comment">     * flag in the PAINTSTRUCT.</span>
01216 <span class="comment">     */</span>
01217     <span class="keywordflow">if</span> (!fErased) {
01218         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFERASEBKGND);
01219         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN31COMPAT))
01220             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSENDERASEBKGND);
01221     }
01222 
01223     <span class="comment">/*</span>
01224 <span class="comment">     * If we got a cache DC in this routine, release it.</span>
01225 <span class="comment">     */</span>
01226     <span class="keywordflow">if</span> (hdcBeginPaint == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01227         <a class="code" href="../../d4/d1/userk_8h.html#a1698">ReleaseCacheDC</a>(hdc, TRUE);
01228     }
01229 
01230     <span class="keywordflow">return</span> fErased;
01231 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="paint.c::xxxSendNCPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxSendNCPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HRGN&nbsp;</td>
          <td class="mdname" nowrap> <em>hrgnUpdate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00232">232</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02267">WFFRAMEON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02269">WFNONCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02338">WFPIXIEHACK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/paint_8c-source.html#l00310">xxxBeginPaint()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00278">xxxSendChildNCPaint()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00740">xxxSimpleDoSyncPaint()</a>.
<p>
<pre class="fragment"><div>00235 {
00236     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00237 
00238     <span class="comment">/*</span>
00239 <span class="comment">     * Clear the WFSENDNCPAINT bit...</span>
00240 <span class="comment">     */</span>
00241     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDNCPAINT);
00242 
00243     <span class="comment">/*</span>
00244 <span class="comment">     * If the window is active, but its FRAMEON bit hasn't</span>
00245 <span class="comment">     * been set yet, set it and make sure that the entire frame</span>
00246 <span class="comment">     * gets redrawn when we send the NCPAINT.</span>
00247 <span class="comment">     */</span>
00248     <span class="keywordflow">if</span> ((pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndActive) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFFRAMEON)) {
00249         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFFRAMEON);
00250         hrgnUpdate = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a877">HRGN_FULL</a>;
00251         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFNONCPAINT);
00252     }
00253 
00254     <span class="comment">/*</span>
00255 <span class="comment">     * If PixieHack() has set the WM_NCPAINT bit, we must be sure</span>
00256 <span class="comment">     * to send with hrgnClip == HRGN_FULL.  (see PixieHack() in wmupdate.c)</span>
00257 <span class="comment">     */</span>
00258     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFPIXIEHACK)) {
00259         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFPIXIEHACK);
00260         hrgnUpdate = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a877">HRGN_FULL</a>;
00261     }
00262 
00263     <span class="keywordflow">if</span> (hrgnUpdate)
00264         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_NCPAINT, (WPARAM)hrgnUpdate, 0L);
00265 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="paint.c::xxxSimpleDoSyncPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxSimpleDoSyncPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d2/paint_8c-source.html#l00740">740</a> of file <a class="el" href="../../d0/d2/paint_8c-source.html">paint.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00057">ClearHungFlag()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03506">CMSHUNGAPPTIMEOUT</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00132">DeleteMaybeSpecialRgn()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04031">DSP_ERASE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04032">DSP_FRAME</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00080">FHungApp()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00151">GetNCUpdateRgn()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01757">tagWND::hrgnUpdate</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02271">WFERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02289">WFPAINTNOTPROCESSED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02338">WFPIXIEHACK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02298">WFREDRAWIFHUNG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02270">WFSENDERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00135">xxxRedrawHungWindow()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01147">xxxSendEraseBkgnd()</a>, and <a class="el" href="../../d0/d2/paint_8c-source.html#l00232">xxxSendNCPaint()</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00762">xxxDispatchMessage()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l01525">xxxGetUpdateRect()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l01665">xxxGetUpdateRgn()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00885">xxxInternalDoSyncPaint()</a>, and <a class="el" href="../../d9/d8/update_8c-source.html#l01121">xxxUpdateWindow2()</a>.
<p>
<pre class="fragment"><div>00742 {
00743     HRGN  hrgnUpdate;
00744     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags = 0;
00745 
00746     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00747 
00748     <span class="comment">/*</span>
00749 <span class="comment">     * Since we're taking care of the frame drawing, we can consider</span>
00750 <span class="comment">     * this WM_PAINT message processed.</span>
00751 <span class="comment">     */</span>
00752     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFPAINTNOTPROCESSED);
00753 
00754     <span class="comment">/*</span>
00755 <span class="comment">     * Make copies of these flags, because their state might</span>
00756 <span class="comment">     * change after we send a message, and we don't want</span>
00757 <span class="comment">     * to "lose" them.</span>
00758 <span class="comment">     */</span>
00759     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDNCPAINT))
00760         flags |= <a class="code" href="../../d4/d1/userk_8h.html#a494">DSP_FRAME</a>;
00761 
00762     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDERASEBKGND))
00763         flags |= <a class="code" href="../../d4/d1/userk_8h.html#a493">DSP_ERASE</a>;
00764 
00765     <span class="keywordflow">if</span> (flags &amp; (<a class="code" href="../../d4/d1/userk_8h.html#a493">DSP_ERASE</a> | <a class="code" href="../../d4/d1/userk_8h.html#a494">DSP_FRAME</a>)) {
00766 
00767         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
00768 
00769             <span class="comment">/*</span>
00770 <span class="comment">             * If there is no update region, just clear the bits.</span>
00771 <span class="comment">             */</span>
00772             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDNCPAINT);
00773             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDERASEBKGND);
00774             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFPIXIEHACK);
00775             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFERASEBKGND);
00776             <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWIFHUNG);
00777 
00778         } <span class="keywordflow">else</span> {
00779 
00780             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00781 
00782             <span class="comment">/*</span>
00783 <span class="comment">             * If there is no update region, we don't have to</span>
00784 <span class="comment">             * do any erasing, but we may need to send an NCPAINT.</span>
00785 <span class="comment">             */</span>
00786             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00787                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDERASEBKGND);
00788                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFERASEBKGND);
00789                 flags &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a493">DSP_ERASE</a>;
00790             }
00791 
00792             <span class="comment">/*</span>
00793 <span class="comment">             * Only mess with windows owned by the current thread.</span>
00794 <span class="comment">             * NOTE: This means that WM_NCPAINT and WM_ERASEBKGND are</span>
00795 <span class="comment">             *       only sent intra-thread.</span>
00796 <span class="comment">             */</span>
00797             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd) == ptiCurrent) {
00798 
00799                 hrgnUpdate = <a class="code" href="../../d9/d2/paint_8c.html#a3">GetNCUpdateRgn</a>(pwnd, TRUE);
00800 
00801                 <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a494">DSP_FRAME</a>) {
00802 
00803                     <span class="comment">/*</span>
00804 <span class="comment">                     * If the message got sent before we got here then do</span>
00805 <span class="comment">                     * nothing.</span>
00806 <span class="comment">                     */</span>
00807                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDNCPAINT))
00808                         <a class="code" href="../../d9/d2/paint_8c.html#a4">xxxSendNCPaint</a>(pwnd, hrgnUpdate);
00809                 }
00810 
00811                 <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a493">DSP_ERASE</a>) {
00812 
00813                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDNCPAINT)) {
00814                         <span class="comment">/*</span>
00815 <span class="comment">                         * If we got another invalidate during the NCPAINT</span>
00816 <span class="comment">                         * callback get the new update region</span>
00817 <span class="comment">                         */</span>
00818                         <a class="code" href="../../d4/d1/userk_8h.html#a1003">DeleteMaybeSpecialRgn</a>(hrgnUpdate);
00819                         hrgnUpdate = <a class="code" href="../../d9/d2/paint_8c.html#a3">GetNCUpdateRgn</a>(pwnd, FALSE);
00820                     }
00821 
00822                     <span class="comment">/*</span>
00823 <span class="comment">                     * If the message got sent before we got here</span>
00824 <span class="comment">                     * (e.g.: an UpdateWindow() inside WM_NCPAINT handler,</span>
00825 <span class="comment">                     * for example), don't do anything.</span>
00826 <span class="comment">                     *</span>
00827 <span class="comment">                     * WINPROJ.EXE (version 1.0) calls UpdateWindow() in</span>
00828 <span class="comment">                     * the WM_NCPAINT handlers for its subclassed listboxes</span>
00829 <span class="comment">                     * in the open dialog.</span>
00830 <span class="comment">                     */</span>
00831                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDERASEBKGND)) {
00832                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDERASEBKGND);
00833                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFERASEBKGND);
00834                         <a class="code" href="../../d4/d1/userk_8h.html#a1467">xxxSendEraseBkgnd</a>(pwnd, NULL, hrgnUpdate);
00835                     }
00836 
00837                     <span class="comment">/*</span>
00838 <span class="comment">                     * The erase and frame operation has occured. Clear the</span>
00839 <span class="comment">                     * WFREDRAWIFHUNG bit here. We don't want to clear it until we</span>
00840 <span class="comment">                     * know the erase and frame has occured, so we know we always</span>
00841 <span class="comment">                     * have a consistent looking window.</span>
00842 <span class="comment">                     */</span>
00843                     <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWIFHUNG);
00844                 }
00845 
00846                 <a class="code" href="../../d4/d1/userk_8h.html#a1003">DeleteMaybeSpecialRgn</a>(hrgnUpdate);
00847 
00848             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)                         &amp;&amp;
00849                        (pwnd != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>) &amp;&amp;
00850                        <a class="code" href="../../d4/d1/userk_8h.html#a1650">FHungApp</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd), CMSHUNGAPPTIMEOUT)   &amp;&amp;
00851                        <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFREDRAWIFHUNG)) {
00852 
00853                 <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWIFHUNG);
00854                 <a class="code" href="../../d4/d1/userk_8h.html#a1651">xxxRedrawHungWindow</a>(pwnd, NULL);
00855             }
00856         }
00857     }
00858 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:01 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
