<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: thredobj.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>thredobj.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d0/d1/thredobj_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a0">ASSERT_THREAD</a>(E)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a1">KeInitializeThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN PVOID KernelStack, IN <a class="el" href="../../d4/d9/ke_8h.html#a67">PKSYSTEM_ROUTINE</a> SystemRoutine, IN <a class="el" href="../../d4/d9/ke_8h.html#a66">PKSTART_ROUTINE</a> StartRoutine OPTIONAL, IN PVOID StartContext OPTIONAL, IN PCONTEXT ContextFrame OPTIONAL, IN PVOID Teb OPTIONAL, IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a2">KeAlertThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AlertMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a3">KeAlertResumeThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a4">KeBoostPriorityThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN KPRIORITY Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KAFFINITY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a5">KeConfineThread</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a6">KeDisableApcQueuingThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a7">KeEnableApcQueuingThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a8">KeForceResumeThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a9">KeFreezeAllThreads</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a10">KeQueryAutoAlignmentThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a11">KeQueryBasePriorityThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KPRIORITY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a12">KeQueryPriorityThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a13">KeReadStateThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a14">KeReadyThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a15">KeResumeThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a16">KeRevertToUserAffinityThread</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a17">KeRundownThread</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KAFFINITY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a18">KeSetAffinityThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN KAFFINITY Affinity)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a19">KeSetSystemAffinityThread</a> (IN KAFFINITY Affinity)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a20">KeSetBasePriorityThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN LONG Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a21">KeSetDisableBoostThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN LOGICAL Disable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a22">KeSetIdealProcessorThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN CCHAR Processor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a23">KeSetKernelStackSwapEnable</a> (IN BOOLEAN Enable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KPRIORITY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a24">KeSetPriorityThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN KPRIORITY Priority)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a25">KeSuspendThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a26">KeTerminateThread</a> (IN KPRIORITY Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a27">KeTestAlertThread</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AlertMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/thredobj_8c.html#a28">KeThawAllThreads</a> (VOID)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="thredobj.c::ASSERT_THREAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ASSERT_THREAD          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">E&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                    \
    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((E)-&gt;<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.Type == ThreadObject); \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00038">38</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="thredobj.c::KeAlertResumeThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KeAlertResumeThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00365">365</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00035">ALERT_INCREMENT</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">RESUME_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00267">NtAlertResumeThread()</a>.
<p>
<pre class="fragment"><div>00371                    :
00372 
00373     This function attempts to alert a thread in kernel mode and cause its
00374     execution to be continued <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently in an alertable Wait state.
00375     In addition, a resume operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
00376 
00377 Arguments:
00378 
00379     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00380 
00381 Return Value:
00382 
00383     The previous suspend count.
00384 
00385 --*/
00386 
00387 {
00388 
00389     ULONG OldCount;
00390     KIRQL OldIrql;
00391 
00392     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00393     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00394 
00395     <span class="comment">//</span>
00396     <span class="comment">// Raise IRQL to dispatcher level, lock dispatcher database, and lock</span>
00397     <span class="comment">// APC queue.</span>
00398     <span class="comment">//</span>
00399 
00400     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00401     KiAcquireSpinLock(&amp;Thread-&gt;ApcQueueLock);
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">// If the kernel mode alerted state is FALSE, then attempt to alert</span>
00405     <span class="comment">// the thread for kernel mode.</span>
00406     <span class="comment">//</span>
00407 
00408     <span class="keywordflow">if</span> (Thread-&gt;Alerted[<a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>] == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00409 
00410         <span class="comment">//</span>
00411         <span class="comment">// If the thread is currently in a Wait state and the Wait is alertable,</span>
00412         <span class="comment">// then the thread is unwaited with a status of "alerted". Else set the</span>
00413         <span class="comment">// kernel mode alerted variable.</span>
00414         <span class="comment">//</span>
00415 
00416         <span class="keywordflow">if</span> ((Thread-&gt;State == <a class="code" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>) &amp;&amp; (Thread-&gt;Alertable == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
00417             <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, STATUS_ALERTED, ALERT_INCREMENT);
00418 
00419         } <span class="keywordflow">else</span> {
00420             Thread-&gt;Alerted[<a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>] = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00421         }
00422     }
00423 
00424     <span class="comment">//</span>
00425     <span class="comment">// Capture the current suspend count.</span>
00426     <span class="comment">//</span>
00427 
00428     OldCount = Thread-&gt;SuspendCount;
00429 
00430     <span class="comment">//</span>
00431     <span class="comment">// If the thread is currently suspended, then decrement its suspend count.</span>
00432     <span class="comment">//</span>
00433 
00434     <span class="keywordflow">if</span> (OldCount != 0) {
00435         Thread-&gt;SuspendCount -= 1;
00436 
00437         <span class="comment">//</span>
00438         <span class="comment">// If the resultant suspend count is zero and the freeze count is</span>
00439         <span class="comment">// zero, then resume the thread by releasing its suspend semaphore.</span>
00440         <span class="comment">//</span>
00441 
00442         <span class="keywordflow">if</span> ((Thread-&gt;SuspendCount == 0) &amp;&amp; (Thread-&gt;FreezeCount == 0)) {
00443             Thread-&gt;SuspendSemaphore.Header.SignalState += 1;
00444             <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;Thread-&gt;SuspendSemaphore, RESUME_INCREMENT);
00445         }
00446     }
00447 
00448     <span class="comment">//</span>
00449     <span class="comment">// Unlock APC queue, unlock dispatcher database, lower IRQL to its</span>
00450     <span class="comment">// previous value, and return the previous suspend count.</span>
00451     <span class="comment">//</span>
00452 
00453     KiReleaseSpinLock(&amp;Thread-&gt;ApcQueueLock);
00454     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00455     <span class="keywordflow">return</span> OldCount;
00456 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="thredobj.c::KeAlertThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeAlertThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AlertMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00281">281</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00035">ALERT_INCREMENT</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00214">NtAlertThread()</a>.
<p>
<pre class="fragment"><div>00288                    :
00289 
00290     This function attempts to alert a thread and cause its execution to
00291     be continued <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently in an alertable Wait state. Otherwise
00292     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> just sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alerted variable <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor mode.
00293 
00294 Arguments:
00295 
00296     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00297 
00298     AlertMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00299         to be alerted.
00300 
00301 Return Value:
00302 
00303     The previous state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alerted variable <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor
00304     mode.
00305 
00306 --*/
00307 
00308 {
00309 
00310     BOOLEAN Alerted;
00311     KIRQL OldIrql;
00312 
00313     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00314     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00315 
00316     <span class="comment">//</span>
00317     <span class="comment">// Raise IRQL to dispatcher level, lock dispatcher database, and lock</span>
00318     <span class="comment">// APC queue.</span>
00319     <span class="comment">//</span>
00320 
00321     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00322     KiAcquireSpinLock(&amp;Thread-&gt;ApcQueueLock);
00323 
00324     <span class="comment">//</span>
00325     <span class="comment">// Capture the current state of the alerted variable for the specified</span>
00326     <span class="comment">// processor mode.</span>
00327     <span class="comment">//</span>
00328 
00329     Alerted = Thread-&gt;Alerted[AlertMode];
00330 
00331     <span class="comment">//</span>
00332     <span class="comment">// If the alerted state for the specified processor mode is Not-Alerted,</span>
00333     <span class="comment">// then attempt to alert the thread.</span>
00334     <span class="comment">//</span>
00335 
00336     <span class="keywordflow">if</span> (Alerted == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00337 
00338         <span class="comment">//</span>
00339         <span class="comment">// If the thread is currently in a Wait state, the Wait is alertable,</span>
00340         <span class="comment">// and the specified processor mode is less than or equal to the Wait</span>
00341         <span class="comment">// mode, then the thread is unwaited with a status of "alerted".</span>
00342         <span class="comment">//</span>
00343 
00344         <span class="keywordflow">if</span> ((Thread-&gt;State == <a class="code" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>) &amp;&amp; (Thread-&gt;Alertable == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) &amp;&amp;
00345             (AlertMode &lt;= Thread-&gt;WaitMode)) {
00346             <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, STATUS_ALERTED, ALERT_INCREMENT);
00347 
00348         } <span class="keywordflow">else</span> {
00349             Thread-&gt;Alerted[AlertMode] = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00350         }
00351     }
00352 
00353     <span class="comment">//</span>
00354     <span class="comment">// Unlock APC queue, unlock dispatcher database, lower IRQL to its</span>
00355     <span class="comment">// previous value, and return the previous alerted state for the</span>
00356     <span class="comment">// specified mode.</span>
00357     <span class="comment">//</span>
00358 
00359     KiReleaseSpinLock(&amp;Thread-&gt;ApcQueueLock);
00360     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00361     <span class="keywordflow">return</span> Alerted;
00362 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="thredobj.c::KeBoostPriorityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeBoostPriorityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00459">459</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00179">KiBoostPriorityThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/ddkresrc_8c-source.html#l00463">ExpWaitForResourceDdk()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, and <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00477">VdmDispatchInterrupts()</a>.
<p>
<pre class="fragment"><div>00466                    :
00467 
00468     This function boosts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00469     same algorithm used when a thread gets a boost from a wait operation.
00470 
00471 Arguments:
00472 
00473     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00474 
00475     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority increment that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied to
00476         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's priority.
00477 
00478 Return Value:
00479 
00480     None.
00481 
00482 --*/
00483 
00484 {
00485 
00486     KIRQL OldIrql;
00487 
00488     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00489 
00490     <span class="comment">//</span>
00491     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00492     <span class="comment">//</span>
00493 
00494     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00495 
00496     <span class="comment">//</span>
00497     <span class="comment">// If the thread does not run at a realtime priority level, then boost</span>
00498     <span class="comment">// the thread priority.</span>
00499     <span class="comment">//</span>
00500 
00501     <span class="keywordflow">if</span> (Thread-&gt;Priority &lt; LOW_REALTIME_PRIORITY) {
00502         <a class="code" href="../../d0/d0/ki_8h.html#a14">KiBoostPriorityThread</a>(Thread, Increment);
00503     }
00504 
00505     <span class="comment">//</span>
00506     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00507     <span class="comment">// value.</span>
00508     <span class="comment">//</span>
00509 
00510     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00511     <span class="keywordflow">return</span>;
00512 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="thredobj.c::KeConfineThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KAFFINITY KeConfineThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00515">515</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00622">_KTHREAD::Affinity</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00626">_KTHREAD::NextProcessor</a>.
<p>
<pre class="fragment"><div>00521                    :
00522 
00523     This function confines <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00524     processor.
00525 
00526 Arguments:
00527 
00528     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00529 
00530 Return Value:
00531 
00532     The previous affinity value.
00533 
00534 --*/
00535 
00536 {
00537 
00538     KAFFINITY Affinity;
00539     KIRQL OldIrql;
00540     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00541 
00542     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00543 
00544     <span class="comment">//</span>
00545     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00546     <span class="comment">//</span>
00547 
00548     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00549     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00550 
00551     <span class="comment">//</span>
00552     <span class="comment">// Capture the current affinity and compute new affinity value by</span>
00553     <span class="comment">// shifting a one bit left by the current processor number.</span>
00554     <span class="comment">//</span>
00555 
00556     Affinity = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o41">Affinity</a>;
00557     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o41">Affinity</a> = (KAFFINITY)(1 &lt;&lt; Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o45">NextProcessor</a>);
00558 
00559     <span class="comment">//</span>
00560     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00561     <span class="comment">// value.</span>
00562     <span class="comment">//</span>
00563 
00564     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00565 
00566     <span class="comment">//</span>
00567     <span class="comment">// Return the previous affinity value.</span>
00568     <span class="comment">//</span>
00569 
00570     <span class="keywordflow">return</span> Affinity;
00571 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="thredobj.c::KeDisableApcQueuingThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeDisableApcQueuingThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00574">574</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.
<p>
<pre class="fragment"><div>00580                    :
00581 
00582     This function disables <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queuing of APC's to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
00583 
00584 Arguments:
00585 
00586     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00587 
00588 Return Value:
00589 
00590     The previous value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC queuing state variable.
00591 
00592 --*/
00593 
00594 {
00595 
00596     BOOLEAN ApcQueueable;
00597     KIRQL OldIrql;
00598 
00599     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00600     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00601 
00602     <span class="comment">//</span>
00603     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00604     <span class="comment">//</span>
00605 
00606     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00607 
00608     <span class="comment">//</span>
00609     <span class="comment">// Capture the current state of the APC queueable state variable and</span>
00610     <span class="comment">// set its state to FALSE.</span>
00611     <span class="comment">//</span>
00612 
00613     ApcQueueable = Thread-&gt;ApcQueueable;
00614     Thread-&gt;ApcQueueable = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00615 
00616     <span class="comment">//</span>
00617     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00618     <span class="comment">// value.</span>
00619     <span class="comment">//</span>
00620 
00621     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00622 
00623     <span class="comment">//</span>
00624     <span class="comment">// Return the previous APC queueable state.</span>
00625     <span class="comment">//</span>
00626 
00627     <span class="keywordflow">return</span> ApcQueueable;
00628 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="thredobj.c::KeEnableApcQueuingThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeEnableApcQueuingThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00631">631</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.
<p>
<pre class="fragment"><div>00637                    :
00638 
00639     This function enables <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queuing of APC's to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
00640 
00641 Arguments:
00642 
00643     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00644 
00645 Return Value:
00646 
00647     The previous value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC queuing state variable.
00648 
00649 --*/
00650 
00651 {
00652 
00653     BOOLEAN ApcQueueable;
00654     KIRQL OldIrql;
00655 
00656     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00657     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00658 
00659     <span class="comment">//</span>
00660     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00661     <span class="comment">//</span>
00662 
00663     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00664 
00665     <span class="comment">//</span>
00666     <span class="comment">// Capture the current state of the APC queueable state variable and</span>
00667     <span class="comment">// set its state to TRUE.</span>
00668     <span class="comment">//</span>
00669 
00670     ApcQueueable = Thread-&gt;ApcQueueable;
00671     Thread-&gt;ApcQueueable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00672 
00673     <span class="comment">//</span>
00674     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00675     <span class="comment">// value.</span>
00676     <span class="comment">//</span>
00677 
00678     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00679 
00680     <span class="comment">//</span>
00681     <span class="comment">// Return previous APC queueable state.</span>
00682     <span class="comment">//</span>
00683 
00684     <span class="keywordflow">return</span> ApcQueueable;
00685 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="thredobj.c::KeForceResumeThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KeForceResumeThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00688">688</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, and <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">RESUME_INCREMENT</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00631">PspExitNormalApc()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>.
<p>
<pre class="fragment"><div>00694                    :
00695 
00696     This function forces resumption of thread execution <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00697     suspended. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not suspended, then no operation
00698     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed.
00699 
00700 Arguments:
00701 
00702     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00703 
00704 Return Value:
00705 
00706     The sum of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous suspend count and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> freeze count.
00707 
00708 --*/
00709 
00710 {
00711 
00712     ULONG OldCount;
00713     KIRQL OldIrql;
00714 
00715     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00716     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00717 
00718     <span class="comment">//</span>
00719     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00720     <span class="comment">//</span>
00721 
00722     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00723 
00724     <span class="comment">//</span>
00725     <span class="comment">// Capture the current suspend count.</span>
00726     <span class="comment">//</span>
00727 
00728     OldCount = Thread-&gt;SuspendCount + Thread-&gt;FreezeCount;
00729 
00730     <span class="comment">//</span>
00731     <span class="comment">// If the thread is currently suspended, then force resumption of</span>
00732     <span class="comment">// thread execution.</span>
00733     <span class="comment">//</span>
00734 
00735     <span class="keywordflow">if</span> (OldCount != 0) {
00736         Thread-&gt;FreezeCount = 0;
00737         Thread-&gt;SuspendCount = 0;
00738         Thread-&gt;SuspendSemaphore.Header.SignalState += 1;
00739         <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;Thread-&gt;SuspendSemaphore, RESUME_INCREMENT);
00740     }
00741 
00742     <span class="comment">//</span>
00743     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00744     <span class="comment">// value.</span>
00745     <span class="comment">//</span>
00746 
00747     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00748 
00749     <span class="comment">//</span>
00750     <span class="comment">// Return the previous suspend count.</span>
00751     <span class="comment">//</span>
00752 
00753     <span class="keywordflow">return</span> OldCount;
00754 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="thredobj.c::KeFreezeAllThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFreezeAllThreads           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00757">757</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00679">_KTHREAD::FreezeCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00512">_KSEMAPHORE::Header</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">KiInsertQueueApc()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">RESUME_INCREMENT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00668">_KTHREAD::SuspendApc</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00680">_KTHREAD::SuspendCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00669">_KTHREAD::SuspendSemaphore</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00453">_ETHREAD::ThreadListEntry</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00764">_KPROCESS::ThreadListHead</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00036">DbgkpSuspendProcess()</a>.
<p>
<pre class="fragment"><div>00763                    :
00764 
00765     This function suspends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of all thread in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00766     process except <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> freeze count overflows
00767     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum suspend count, then a condition <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> raised.
00768 
00769 Arguments:
00770 
00771     None.
00772 
00773 Return Value:
00774 
00775     None.
00776 
00777 --*/
00778 
00779 {
00780 
00781     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> CurrentThread;
00782     PLIST_ENTRY ListHead;
00783     PLIST_ENTRY NextEntry;
00784     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00785     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00786     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> EThread;
00787     ULONG OldCount;
00788     KIRQL OldIrql;
00789 
00790     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00791 
00792     <span class="comment">//</span>
00793     <span class="comment">// Get the address of the current thread object, the current process</span>
00794     <span class="comment">// object, raise IRQL to dispatch level, lock dispatcher database,</span>
00795     <span class="comment">// and freeze the execution of all threads in the process except the</span>
00796     <span class="comment">// current thread.</span>
00797     <span class="comment">//</span>
00798 
00799     CurrentThread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00800     Process = CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00801     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00802 
00803     <span class="comment">//</span>
00804     <span class="comment">// If the freeze count of the current thread is not zero, then there</span>
00805     <span class="comment">// is another thread that is trying to freeze this thread. Unlock the</span>
00806     <span class="comment">// dispatcher, lower IRQL to its previous value, allow the suspend</span>
00807     <span class="comment">// APC to occur, then raise IRQL to dispatch level, lock the dispatcher</span>
00808     <span class="comment">// database, and try again.</span>
00809     <span class="comment">//</span>
00810 
00811     <span class="keywordflow">while</span> (CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a> != 0) {
00812         <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00813         <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00814     }
00815 
00816     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00817 
00818     <span class="comment">//</span>
00819     <span class="comment">// Freeze all threads except the current thread.</span>
00820     <span class="comment">//</span>
00821 
00822     ListHead = &amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o8">ThreadListHead</a>;
00823     NextEntry = ListHead-&gt;Flink;
00824     <span class="keywordflow">do</span> {
00825 
00826         <span class="comment">//</span>
00827         <span class="comment">// Get the address of the next thread and suspend it if it is</span>
00828         <span class="comment">// not the current thread.</span>
00829         <span class="comment">//</span>
00830 
00831         Thread = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>, ThreadListEntry);
00832         <span class="keywordflow">if</span> (Thread != CurrentThread) {
00833 
00834             EThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>) Thread;
00835             <span class="keywordflow">if</span> ( EThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o37">ThreadListEntry</a>.Flink == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00836                 ;
00837             } <span class="keywordflow">else</span> {
00838 
00839                 <span class="comment">//</span>
00840                 <span class="comment">// Increment the freeze count. If the thread was not previously</span>
00841                 <span class="comment">// suspended, then queue the thread's suspend APC.</span>
00842                 <span class="comment">//</span>
00843 
00844                 OldCount = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a>;
00845 
00846                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(OldCount != MAXIMUM_SUSPEND_COUNT);
00847 
00848                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a> += 1;
00849                 <span class="keywordflow">if</span> ((OldCount == 0) &amp;&amp; (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o66">SuspendCount</a> == 0)) {
00850                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/ki_8h.html#a123">KiInsertQueueApc</a>(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o62">SuspendApc</a>, RESUME_INCREMENT) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00851                         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o63">SuspendSemaphore</a>.<a class="code" href="../../d8/d7/struct__KSEMAPHORE.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> -= 1;
00852                     }
00853                 }
00854             }
00855         }
00856         NextEntry = NextEntry-&gt;Flink;
00857     } <span class="keywordflow">while</span> (NextEntry != ListHead);
00858 
00859     <span class="comment">//</span>
00860     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00861     <span class="comment">// value.</span>
00862     <span class="comment">//</span>
00863 
00864     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00865     <span class="keywordflow">return</span>;
00866 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="thredobj.c::KeInitializeThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeInitializeThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>KernelStack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a67">PKSYSTEM_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a66">PKSTART_ROUTINE</a> StartRoutine&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID StartContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT ContextFrame&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Teb&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00043">43</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00522">_KTIMER::Header</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a191">Initialized</a>, <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00039">KeInitializeApc()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00039">KeInitializeSemaphore()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00043">KeInitializeTimer()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02794">KeServiceDescriptorTable</a>, <a class="el" href="../../d9/d0/ppc_2thredini_8c-source.html#l00045">KiInitializeContextThread()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a135">KiSuspendNop()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00770">KiSuspendThread()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00282">_KWAIT_BLOCK::Object</a>, <a class="el" href="../../d4/d9/ke_8h.html#a403a181">OriginalApcEnvironment</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00204">PKKERNEL_ROUTINE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00214">PKRUNDOWN_ROUTINE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00079">THREAD_WAIT_OBJECTS</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00084">TIMER_WAIT_BLOCK</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00284">_KWAIT_BLOCK::WaitKey</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00280">_KWAIT_BLOCK::WaitListEntry</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00263">_DISPATCHER_HEADER::WaitListHead</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00285">_KWAIT_BLOCK::WaitType</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, and <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.
<p>
<pre class="fragment"><div>00056                    :
00057 
00058     This function initializes a thread object. The priority, affinity,
00059     and initial quantum are taken from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process object. The
00060     thread object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread list <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00061     parent process.
00062 
00063     N.B. This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> carefully written so that <span class="keywordflow">if</span> an access violation
00064         occurs <span class="keywordflow">while</span> reading <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context frame, then no kernel
00065         data structures will have been modified. It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> responsibility
00066         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to handle <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception and provide necessary clean
00067         up.
00068 
00069     N.B. It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> zeroed.
00070 
00071 Arguments:
00072 
00073     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00074 
00075     KernelStack - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of a kernel stack on which
00076         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context frame <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be constructed.
00077 
00078     SystemRoutine - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
00079         called when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> first scheduled <span class="keywordflow">for</span> execution.
00080 
00081     StartRoutine - Supplies an optional pointer to a function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
00082         called after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system has finished initializing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread. This
00083         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a system thread and will
00084         execute totally in kernel mode.
00085 
00086     StartContext - Supplies an optional pointer to an arbitrary data structure
00087         which will be passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> StartRoutine as a parameter. This
00088         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a system thread and will
00089         execute totally in kernel mode.
00090 
00091     ContextFrame - Supplies an optional pointer a context frame which contains
00092         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial user mode state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified
00093         <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a user thread and will execute in user mode. If <span class="keyword">this</span>
00094         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Teb parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored.
00095 
00096     Teb - Supplies an optional pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode thread environment
00097         block. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a user thread and
00098         will execute in user mode. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ContextFrame
00099         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified.
00100 
00101     Process - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> process.
00102 
00103 Return Value:
00104 
00105     None.
00106 
00107 --*/
00108 
00109 {
00110 
00111     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00112     KIRQL OldIrql;
00113     <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer;
00114     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PKWAIT_BLOCK</a> WaitBlock;
00115 
00116     <span class="comment">//</span>
00117     <span class="comment">// Initialize the standard dispatcher object header and set the initial</span>
00118     <span class="comment">// state of the thread object.</span>
00119     <span class="comment">//</span>
00120 
00121     Thread-&gt;Header.Type = <a class="code" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>;
00122     Thread-&gt;Header.Size = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>) / <span class="keyword">sizeof</span>(LONG);
00123     InitializeListHead(&amp;Thread-&gt;Header.WaitListHead);
00124 
00125     <span class="comment">//</span>
00126     <span class="comment">// Initialize the owned mutant listhead.</span>
00127     <span class="comment">//</span>
00128 
00129     InitializeListHead(&amp;Thread-&gt;MutantListHead);
00130 
00131     <span class="comment">//</span>
00132     <span class="comment">// Initialize the thread field of all builtin wait blocks.</span>
00133     <span class="comment">//</span>
00134 
00135     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; (<a class="code" href="../../d4/d9/ke_8h.html#a6">THREAD_WAIT_OBJECTS</a> + 1); <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00136         Thread-&gt;WaitBlock[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Thread = Thread;
00137     }
00138 
00139     <span class="comment">//</span>
00140     <span class="comment">// Initialize the alerted, preempted, debugactive, autoalignment,</span>
00141     <span class="comment">// kernel stack resident, enable kernel stack swap, and process</span>
00142     <span class="comment">// ready queue boolean values.</span>
00143     <span class="comment">//</span>
00144     <span class="comment">// N.B. Only nonzero values are initialized.</span>
00145     <span class="comment">//</span>
00146 
00147     Thread-&gt;AutoAlignment = Process-&gt;AutoAlignment;
00148     Thread-&gt;EnableStackSwap = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00149     Thread-&gt;KernelStackResident = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00150 
00151     <span class="comment">//</span>
00152     <span class="comment">// Set the system service table pointer to the address of the static</span>
00153     <span class="comment">// system service descriptor table. If the thread is later converted</span>
00154     <span class="comment">// to a Win32 thread this pointer will be change to a pointer to the</span>
00155     <span class="comment">// shadow system service descriptor table.</span>
00156     <span class="comment">//</span>
00157 
00158     Thread-&gt;ServiceTable = (PVOID)&amp;<a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[0];
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">// Initialize the APC state pointers, the current APC state, the saved</span>
00162     <span class="comment">// APC state, and enable APC queuing.</span>
00163     <span class="comment">//</span>
00164 
00165     Thread-&gt;ApcStatePointer[0] = &amp;Thread-&gt;ApcState;
00166     Thread-&gt;ApcStatePointer[1] = &amp;Thread-&gt;SavedApcState;
00167     InitializeListHead(&amp;Thread-&gt;ApcState.ApcListHead[KernelMode]);
00168     InitializeListHead(&amp;Thread-&gt;ApcState.ApcListHead[UserMode]);
00169     Thread-&gt;ApcState.Process = Process;
00170     Thread-&gt;ApcQueueable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00171 
00172     <span class="comment">//</span>
00173     <span class="comment">// Initialize the kernel mode suspend APC and the suspend semaphore object.</span>
00174     <span class="comment">// and the builtin wait timeout timer object.</span>
00175     <span class="comment">//</span>
00176 
00177     <a class="code" href="../../d5/d7/apcobj_8c.html#a1">KeInitializeApc</a>(&amp;Thread-&gt;SuspendApc,
00178                     Thread,
00179                     OriginalApcEnvironment,
00180                     (PKKERNEL_ROUTINE)KiSuspendNop,
00181                     (PKRUNDOWN_ROUTINE)NULL,
00182                     KiSuspendThread,
00183                     KernelMode,
00184                     NULL);
00185 
00186     <a class="code" href="../../d1/d6/semphobj_8c.html#a1">KeInitializeSemaphore</a>(&amp;Thread-&gt;SuspendSemaphore, 0L, 2L);
00187 
00188     <span class="comment">//</span>
00189     <span class="comment">// Initialize the builtin timer trimer wait wait block.</span>
00190     <span class="comment">//</span>
00191     <span class="comment">// N.B. This is the only time the wait block is initialized sincs this</span>
00192     <span class="comment">//      information is constant.</span>
00193     <span class="comment">//</span>
00194 
00195     Timer = &amp;Thread-&gt;Timer;
00196     <a class="code" href="../../d3/d2/timerobj_8c.html#a1">KeInitializeTimer</a>(Timer);
00197     WaitBlock = &amp;Thread-&gt;WaitBlock[<a class="code" href="../../d4/d9/ke_8h.html#a9">TIMER_WAIT_BLOCK</a>];
00198     WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o2">Object</a> = Timer;
00199     WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a> = (CSHORT)STATUS_TIMEOUT;
00200     WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o5">WaitType</a> = WaitAny;
00201     WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o0">WaitListEntry</a>.Flink = &amp;Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>;
00202     WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o0">WaitListEntry</a>.Blink = &amp;Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>;
00203 
00204     <span class="comment">//</span>
00205     <span class="comment">// Initialize the APC queue spinlock.</span>
00206     <span class="comment">//</span>
00207 
00208     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;Thread-&gt;ApcQueueLock);
00209 
00210     <span class="comment">//</span>
00211     <span class="comment">// Initialize the Thread Environment Block (TEB) pointer (can be NULL).</span>
00212     <span class="comment">//</span>
00213 
00214     Thread-&gt;Teb = Teb;
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">// Set the initial kernel stack and the initial thread context.</span>
00218     <span class="comment">//</span>
00219 
00220     Thread-&gt;InitialStack = KernelStack;
00221     Thread-&gt;StackBase = KernelStack;
00222     Thread-&gt;StackLimit = (PVOID)((ULONG_PTR)KernelStack - KERNEL_STACK_SIZE);
00223     <a class="code" href="../../d8/d1/ppc_2thredini_8c.html#a2">KiInitializeContextThread</a>(Thread,
00224                               SystemRoutine,
00225                               StartRoutine,
00226                               StartContext,
00227                               ContextFrame);
00228 
00229     <span class="comment">//</span>
00230     <span class="comment">// Set the base thread priority, the thread priority, the thread affinity,</span>
00231     <span class="comment">// the thread quantum, and the scheduling state.</span>
00232     <span class="comment">//</span>
00233 
00234     Thread-&gt;BasePriority = Process-&gt;BasePriority;
00235     Thread-&gt;Priority = Thread-&gt;BasePriority;
00236     Thread-&gt;Affinity = Process-&gt;Affinity;
00237     Thread-&gt;UserAffinity = Process-&gt;Affinity;
00238     Thread-&gt;SystemAffinityActive = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00239     Thread-&gt;Quantum = Process-&gt;ThreadQuantum;
00240     Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a191">Initialized</a>;
00241     Thread-&gt;DisableBoost = Process-&gt;DisableBoost;
00242 
00243 <span class="preprocessor">#ifdef i386</span>
00244 <span class="preprocessor"></span>
00245     Thread-&gt;Iopl = Process-&gt;Iopl;
00246 
00247 <span class="preprocessor">#endif</span>
00248 <span class="preprocessor"></span>
00249     <span class="comment">//</span>
00250     <span class="comment">// Lock the dispatcher database, insert the thread in the process</span>
00251     <span class="comment">// thread list, increment the kernel stack count, and unlock the</span>
00252     <span class="comment">// dispatcher database.</span>
00253     <span class="comment">//</span>
00254     <span class="comment">// N.B. The distinguished value MAXSHORT is used to signify that no</span>
00255     <span class="comment">//      threads have been created for a process.</span>
00256     <span class="comment">//</span>
00257 
00258     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00259     InsertTailList(&amp;Process-&gt;ThreadListHead, &amp;Thread-&gt;ThreadListEntry);
00260     <span class="keywordflow">if</span> (Process-&gt;StackCount == MAXSHORT) {
00261         Process-&gt;StackCount = 1;
00262 
00263     } <span class="keywordflow">else</span> {
00264         Process-&gt;StackCount += 1;
00265     }
00266 
00267     <span class="comment">//</span>
00268     <span class="comment">// Initialize the ideal processor number for the thread.</span>
00269     <span class="comment">//</span>
00270     <span class="comment">//  N.B. This must be done under the dispatcher lock to prevent byte</span>
00271     <span class="comment">//      granularity problems on Alpha.</span>
00272     <span class="comment">//</span>
00273 
00274     Process-&gt;ThreadSeed += 1;
00275     Thread-&gt;IdealProcessor = (UCHAR)(Process-&gt;ThreadSeed % <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>);
00276     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00277     <span class="keywordflow">return</span>;
00278 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="thredobj.c::KeQueryAutoAlignmentThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeQueryAutoAlignmentThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00869">869</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>.
<p>
<pre class="fragment"><div>00875                    :
00876 
00877     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data alignment handling mode <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00878     thread.
00879 
00880 Arguments:
00881 
00882     None.
00883 
00884 Return Value:
00885 
00886     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> data alignment exceptions are being
00887     automatically handled by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00888     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00889 
00890 --*/
00891 
00892 {
00893 
00894     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00895 
00896     <span class="comment">//</span>
00897     <span class="comment">// Return the data alignment handling mode for the thread.</span>
00898     <span class="comment">//</span>
00899 
00900     <span class="keywordflow">return</span> Thread-&gt;AutoAlignment;
00901 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="thredobj.c::KeQueryBasePriorityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KeQueryBasePriorityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00904">904</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00768">_KPROCESS::BasePriority</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>.
<p>
<pre class="fragment"><div>00910                    :
00911 
00912     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base priority increment of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00913     thread.
00914 
00915 Arguments:
00916 
00917     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00918 
00919 Return Value:
00920 
00921     The base priority increment of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
00922 
00923 --*/
00924 
00925 {
00926 
00927     LONG <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
00928     KIRQL OldIrql;
00929     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00930 
00931     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
00932     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00933 
00934     <span class="comment">//</span>
00935     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00936     <span class="comment">//</span>
00937 
00938     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00939 
00940     <span class="comment">//</span>
00941     <span class="comment">// If priority saturation occured the last time the thread base priority</span>
00942     <span class="comment">// was set, then return the saturation increment value. Otherwise, compute</span>
00943     <span class="comment">// the increment value as the difference between the thread base priority</span>
00944     <span class="comment">// and the process base priority.</span>
00945     <span class="comment">//</span>
00946 
00947     Process = Thread-&gt;ApcStatePointer[0]-&gt;Process;
00948     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> = Thread-&gt;BasePriority - Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a>;
00949     <span class="keywordflow">if</span> (Thread-&gt;Saturation != 0) {
00950         <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> = ((HIGH_PRIORITY + 1) / 2) * Thread-&gt;Saturation;
00951     }
00952 
00953     <span class="comment">//</span>
00954     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
00955     <span class="comment">// value.</span>
00956     <span class="comment">//</span>
00957 
00958     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00959 
00960     <span class="comment">//</span>
00961     <span class="comment">// Return the previous thread base priority increment.</span>
00962     <span class="comment">//</span>
00963 
00964     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
00965 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="thredobj.c::KeQueryPriorityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KPRIORITY KeQueryPriorityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00968">968</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
<pre class="fragment"><div>00974                    :
00975 
00976     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
00977 
00978 Arguments:
00979 
00980     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00981 
00982 Return Value:
00983 
00984     The current priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
00985 
00986 --*/
00987 
00988 {
00989     <span class="keywordflow">return</span> Thread-&gt;Priority;
00990 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="thredobj.c::KeReadStateThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeReadStateThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00993">993</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>.
<p>
<pre class="fragment"><div>00999                    :
01000 
01001     This function reads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current signal state of a thread object.
01002 
01003 Arguments:
01004 
01005     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01006 
01007 Return Value:
01008 
01009     The current signal state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread object.
01010 
01011 --*/
01012 
01013 {
01014 
01015     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01016 
01017     <span class="comment">//</span>
01018     <span class="comment">// Return current signal state of thread object.</span>
01019     <span class="comment">//</span>
01020 
01021     <span class="keywordflow">return</span> (BOOLEAN)Thread-&gt;Header.SignalState;
01022 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="thredobj.c::KeReadyThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeReadyThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01025">1025</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.
<p>
<pre class="fragment"><div>01031                    :
01032 
01033     This function readies a thread <span class="keywordflow">for</span> execution. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's process
01034     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently not in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> balance set, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01035     thread's process' ready queue. Else <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> higher priority than
01036     another thread that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently running on a processor then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
01037     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> selected <span class="keywordflow">for</span> execution on that processor. Else <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted
01038     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher ready queue selected by its priority.
01039 
01040 Arguments:
01041 
01042     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01043 
01044 Return Value:
01045 
01046     None.
01047 
01048 --*/
01049 
01050 {
01051 
01052     KIRQL OldIrql;
01053 
01054     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01055     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01056 
01057     <span class="comment">//</span>
01058     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01059     <span class="comment">//</span>
01060 
01061     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01062 
01063     <span class="comment">//</span>
01064     <span class="comment">// Ready the specified thread for execution.</span>
01065     <span class="comment">//</span>
01066 
01067     <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread);
01068 
01069     <span class="comment">//</span>
01070     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01071     <span class="comment">// value.</span>
01072     <span class="comment">//</span>
01073 
01074     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01075     <span class="keywordflow">return</span>;
01076 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="thredobj.c::KeResumeThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KeResumeThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01079">1079</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, and <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">RESUME_INCREMENT</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, and <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.
<p>
<pre class="fragment"><div>01085                    :
01086 
01087     This function resumes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of a suspended thread. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01088     specified thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not suspended, then no operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed.
01089 
01090 Arguments:
01091 
01092     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01093 
01094 Return Value:
01095 
01096     The previous suspend count.
01097 
01098 --*/
01099 
01100 {
01101 
01102     ULONG OldCount;
01103     KIRQL OldIrql;
01104 
01105     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01106     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01107 
01108     <span class="comment">//</span>
01109     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01110     <span class="comment">//</span>
01111 
01112     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01113 
01114     <span class="comment">//</span>
01115     <span class="comment">// Capture the current suspend count.</span>
01116     <span class="comment">//</span>
01117 
01118     OldCount = Thread-&gt;SuspendCount;
01119 
01120     <span class="comment">//</span>
01121     <span class="comment">// If the thread is currently suspended, then decrement its suspend count.</span>
01122     <span class="comment">//</span>
01123 
01124     <span class="keywordflow">if</span> (OldCount != 0) {
01125         Thread-&gt;SuspendCount -= 1;
01126 
01127         <span class="comment">//</span>
01128         <span class="comment">// If the resultant suspend count is zero and the freeze count is</span>
01129         <span class="comment">// zero, then resume the thread by releasing its suspend semaphore.</span>
01130         <span class="comment">//</span>
01131 
01132         <span class="keywordflow">if</span> ((Thread-&gt;SuspendCount == 0) &amp;&amp; (Thread-&gt;FreezeCount == 0)) {
01133             Thread-&gt;SuspendSemaphore.Header.SignalState += 1;
01134             <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;Thread-&gt;SuspendSemaphore, RESUME_INCREMENT);
01135         }
01136     }
01137 
01138     <span class="comment">//</span>
01139     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01140     <span class="comment">// value.</span>
01141     <span class="comment">//</span>
01142 
01143     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01144 
01145     <span class="comment">//</span>
01146     <span class="comment">// Return the previous suspend count.</span>
01147     <span class="comment">//</span>
01148 
01149     <span class="keywordflow">return</span> OldCount;
01150 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="thredobj.c::KeRevertToUserAffinityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeRevertToUserAffinityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01153">1153</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00622">_KTHREAD::Affinity</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00479">KiSelectNextThread()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00569">_KTHREAD::State</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00598">_KTHREAD::SystemAffinityActive</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00597">_KTHREAD::UserAffinity</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01986">CmpConfigureProcessors()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d4/d0/biosc_8c-source.html#l00060">Ke386CallBios()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02008">KeSetup80387OrEmulate()</a>, and <a class="el" href="../../d7/d8/kernlini_8c-source.html#l01691">KiInitMachineDependent()</a>.
<p>
<pre class="fragment"><div>01159                    :
01160 
01161     This function setss <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> affinity of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread to its user
01162     affinity.
01163 
01164 Arguments:
01165 
01166     None.
01167 
01168 Return Value:
01169 
01170     None.
01171 
01172 --*/
01173 
01174 {
01175 
01176     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> CurrentThread;
01177     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> NextThread;
01178     KIRQL OldIrql;
01179     PKPRCB Prcb;
01180 
01181     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01182     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;SystemAffinityActive != FALSE);
01183 
01184     <span class="comment">//</span>
01185     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01186     <span class="comment">//</span>
01187 
01188     CurrentThread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
01189     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01190 
01191     <span class="comment">//</span>
01192     <span class="comment">// Set the current affinity to the user affinity.</span>
01193     <span class="comment">//</span>
01194     <span class="comment">// If the current processor is not in the new affinity set and another</span>
01195     <span class="comment">// thread has not already been selected for execution on the current</span>
01196     <span class="comment">// processor, then select a new thread for the current processor.</span>
01197     <span class="comment">//</span>
01198 
01199     CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o41">Affinity</a> = CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o31">UserAffinity</a>;
01200     CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o32">SystemAffinityActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01201     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
01202     <span class="keywordflow">if</span> (((Prcb-&gt;SetMember &amp; CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o41">Affinity</a>) == 0) &amp;&amp;
01203         (Prcb-&gt;NextThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01204         NextThread = <a class="code" href="../../d0/d2/thredsup_8c.html#a4">KiSelectNextThread</a>(CurrentThread);
01205         NextThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
01206         Prcb-&gt;NextThread = NextThread;
01207     }
01208 
01209     <span class="comment">//</span>
01210     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous value.</span>
01211     <span class="comment">//</span>
01212 
01213     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01214     <span class="keywordflow">return</span>;
01215 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="thredobj.c::KeRundownThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeRundownThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01218">1218</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00488">_KMUTANT::Abandoned</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00489">_KMUTANT::ApcDisable</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00485">_KMUTANT::Header</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a88">KiRundownChannel()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00147">MUTANT_INCREMENT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00486">_KMUTANT::MutantListEntry</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00546">_KTHREAD::MutantListHead</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00487">_KMUTANT::OwnerThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00263">_DISPATCHER_HEADER::WaitListHead</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.
<p>
<pre class="fragment"><div>01223                    :
01224 
01225     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> executive to rundown thread structures
01226     which must be guarded by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher database lock and which must
01227     be processed before actually terminating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread. An example of such
01228     a structure <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant ownership list that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> anchored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel
01229     thread object.
01230 
01231 Arguments:
01232 
01233     None.
01234 
01235 Return Value:
01236 
01237     None.
01238 
01239 --*/
01240 
01241 {
01242 
01243     <a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a> Mutant;
01244     PLIST_ENTRY NextEntry;
01245     KIRQL OldIrql;
01246     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
01247 
01248     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01249 
01250     <span class="comment">//</span>
01251     <span class="comment">// Rundown possible associated channel object or receive buffer.</span>
01252     <span class="comment">//</span>
01253 
01254 <span class="preprocessor">#if 0</span>
01255 <span class="preprocessor"></span>
01256     <a class="code" href="../../d0/d0/ki_8h.html#a88">KiRundownChannel</a>();
01257 
01258 <span class="preprocessor">#endif</span>
01259 <span class="preprocessor"></span>
01260     <span class="comment">//</span>
01261     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01262     <span class="comment">//</span>
01263 
01264     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
01265     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01266 
01267     <span class="comment">//</span>
01268     <span class="comment">// Scan the list of owned mutant objects and release the mutant objects</span>
01269     <span class="comment">// with an abandoned status. If the mutant is a kernel mutex, then bug</span>
01270     <span class="comment">// check.</span>
01271     <span class="comment">//</span>
01272 
01273     NextEntry = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o1">MutantListHead</a>.Flink;
01274     <span class="keywordflow">while</span> (NextEntry != &amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o1">MutantListHead</a>) {
01275         Mutant = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d3/d7/struct__KMUTANT.html">KMUTANT</a>, MutantListEntry);
01276         <span class="keywordflow">if</span> (Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o4">ApcDisable</a> != 0) {
01277             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(THREAD_TERMINATE_HELD_MUTEX,
01278                          (ULONG_PTR)Thread,
01279                          (ULONG_PTR)Mutant, 0, 0);
01280         }
01281 
01282         RemoveEntryList(&amp;Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o1">MutantListEntry</a>);
01283         Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> = 1;
01284         Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o3">Abandoned</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01285         Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o2">OwnerThread</a> = (<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01286         <span class="keywordflow">if</span> (IsListEmpty(&amp;Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01287             <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(Mutant, MUTANT_INCREMENT);
01288         }
01289 
01290         NextEntry = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o1">MutantListHead</a>.Flink;
01291     }
01292 
01293     <span class="comment">//</span>
01294     <span class="comment">// Release dispatcher database lock and lower IRQL to its previous value.</span>
01295     <span class="comment">//</span>
01296 
01297     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01298     <span class="keywordflow">return</span>;
01299 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="thredobj.c::KeSetAffinityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KAFFINITY KeSetAffinityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KAFFINITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Affinity</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">1302</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00766">_KPROCESS::Affinity</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00058">ClearMember</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00021">INVALID_AFFINITY_SET</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00036">KiDispatcherReadyListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00052">KiReadySummary</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00782">KiRequestDispatchInterrupt</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00479">KiSelectNextThread()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a192">Ready</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a193">Running</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00569">_KTHREAD::State</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02262">PspApplyJobLimitsToProcess()</a>.
<p>
<pre class="fragment"><div>01309                    :
01310 
01311     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> affinity of a specified thread to a <span class="keyword">new</span>
01312     value. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> affinity <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a proper subset of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent
01313     process affinity, or <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> null, then an error condition <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> raised.
01314     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> running on, or about to run on, a
01315     processor <span class="keywordflow">for</span> which <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no longer able to run, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
01316     processor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> rescheduled. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in a ready
01317     state and <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process ready queue, then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01318     rereadied to reevaluate any additional processors <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> may run on.
01319 
01320 Arguments:
01321 
01322     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01323 
01324     Affinity - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> of set of processors on which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
01325         can run.
01326 
01327 Return Value:
01328 
01329     The previous affinity of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
01330 
01331 --*/
01332 
01333 {
01334 
01335     KAFFINITY OldAffinity;
01336     KIRQL OldIrql;
01337     PKPRCB Prcb;
01338     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
01339     ULONG Processor;
01340     KPRIORITY ThreadPriority;
01341     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread1;
01342 
01343     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01344     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01345 
01346     <span class="comment">//</span>
01347     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01348     <span class="comment">//</span>
01349 
01350     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01351 
01352     <span class="comment">//</span>
01353     <span class="comment">// Capture the current affinity of the specified thread and get address</span>
01354     <span class="comment">// of parent process object;</span>
01355     <span class="comment">//</span>
01356 
01357     OldAffinity = Thread-&gt;UserAffinity;
01358     Process = Thread-&gt;ApcStatePointer[0]-&gt;Process;
01359 
01360     <span class="comment">//</span>
01361     <span class="comment">// If new affinity is not a proper subset of the parent process affinity,</span>
01362     <span class="comment">// or the new affinity is null, then bugcheck.</span>
01363     <span class="comment">//</span>
01364 
01365     <span class="keywordflow">if</span> (((Affinity &amp; Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o10">Affinity</a>) != (Affinity)) || (!Affinity)) {
01366         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(INVALID_AFFINITY_SET);
01367     }
01368 
01369     <span class="comment">//</span>
01370     <span class="comment">// Set the thread user affinity to the specified value.</span>
01371     <span class="comment">//</span>
01372     <span class="comment">// If the thread is not current executing with system affinity active,</span>
01373     <span class="comment">// then set the thread current affinity and switch on the thread state.</span>
01374     <span class="comment">//</span>
01375 
01376     Thread-&gt;UserAffinity = Affinity;
01377     <span class="keywordflow">if</span> (Thread-&gt;SystemAffinityActive == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01378         Thread-&gt;Affinity = Affinity;
01379         <span class="keywordflow">switch</span> (Thread-&gt;State) {
01380 
01381             <span class="comment">//</span>
01382             <span class="comment">// Ready State.</span>
01383             <span class="comment">//</span>
01384             <span class="comment">// If the thread is not in the process ready queue, then remove</span>
01385             <span class="comment">// it from its current dispatcher ready queue and reready it for</span>
01386             <span class="comment">// execution.</span>
01387             <span class="comment">//</span>
01388 
01389         <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/ke_8h.html#a406a192">Ready</a>:
01390             <span class="keywordflow">if</span> (Thread-&gt;ProcessReadyQueue == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01391                 RemoveEntryList(&amp;Thread-&gt;WaitListEntry);
01392                 ThreadPriority = Thread-&gt;Priority;
01393                 <span class="keywordflow">if</span> (IsListEmpty(&amp;KiDispatcherReadyListHead[ThreadPriority]) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01394                     <a class="code" href="../../d0/d0/ki_8h.html#a6">ClearMember</a>(ThreadPriority, KiReadySummary);
01395                 }
01396 
01397                 <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread);
01398             }
01399 
01400             <span class="keywordflow">break</span>;
01401 
01402             <span class="comment">//</span>
01403             <span class="comment">// Standby State.</span>
01404             <span class="comment">//</span>
01405             <span class="comment">// If the target processor is not in the new affinity set, then</span>
01406             <span class="comment">// set the next thread to null for the target processor, select</span>
01407             <span class="comment">// a new thread to run on the target processor, and reready the</span>
01408             <span class="comment">// thread for execution.</span>
01409             <span class="comment">//</span>
01410 
01411         <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>:
01412             Processor = Thread-&gt;NextProcessor;
01413             Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Processor];
01414             <span class="keywordflow">if</span> ((Prcb-&gt;SetMember &amp; Affinity) == 0) {
01415                 Prcb-&gt;NextThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01416                 Thread1 = <a class="code" href="../../d0/d2/thredsup_8c.html#a4">KiSelectNextThread</a>(Thread);
01417                 Thread1-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
01418                 Prcb-&gt;NextThread = Thread1;
01419                 <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread);
01420             }
01421 
01422             <span class="keywordflow">break</span>;
01423 
01424             <span class="comment">//</span>
01425             <span class="comment">// Running State.</span>
01426             <span class="comment">//</span>
01427             <span class="comment">// If the target processor is not in the new affinity set and</span>
01428             <span class="comment">// another thread has not already been selected for execution</span>
01429             <span class="comment">// on the target processor, then select a new thread for the</span>
01430             <span class="comment">// target processor, and cause the target processor to be</span>
01431             <span class="comment">// redispatched.</span>
01432             <span class="comment">//</span>
01433 
01434         <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/ke_8h.html#a406a193">Running</a>:
01435             Processor = Thread-&gt;NextProcessor;
01436             Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Processor];
01437             <span class="keywordflow">if</span> (((Prcb-&gt;SetMember &amp; Affinity) == 0) &amp;&amp;
01438                 (Prcb-&gt;NextThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01439                 Thread1 = <a class="code" href="../../d0/d2/thredsup_8c.html#a4">KiSelectNextThread</a>(Thread);
01440                 Thread1-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
01441                 Prcb-&gt;NextThread = Thread1;
01442                 <a class="code" href="../../d0/d0/ki_8h.html#a24">KiRequestDispatchInterrupt</a>(Processor);
01443             }
01444 
01445             <span class="keywordflow">break</span>;
01446 
01447             <span class="comment">//</span>
01448             <span class="comment">// Initialized, Terminated, Waiting, Transition case - For these</span>
01449             <span class="comment">// states it is sufficient to just set the new thread affinity.</span>
01450             <span class="comment">//</span>
01451 
01452         <span class="keywordflow">default</span>:
01453             <span class="keywordflow">break</span>;
01454         }
01455     }
01456 
01457     <span class="comment">//</span>
01458     <span class="comment">// Unlock dispatcher database, lower IRQL to its previous value, and</span>
01459     <span class="comment">// return the previous user affinity.</span>
01460     <span class="comment">//</span>
01461 
01462     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01463     <span class="keywordflow">return</span> OldAffinity;
01464 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="thredobj.c::KeSetBasePriorityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KeSetBasePriorityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01532">1532</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l02354">abs</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00768">_KPROCESS::BasePriority</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00769">_KPROCESS::ThreadQuantum</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>.
<p>
<pre class="fragment"><div>01539                    :
01540 
01541     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread to a
01542     <span class="keyword">new</span> value.  The <span class="keyword">new</span> base priority <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process base
01543     priority plus <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> increment.
01544 
01545 Arguments:
01546 
01547     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01548 
01549     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base priority increment of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject thread.
01550 
01551         N.B. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> absolute value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> increment <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> such that saturation
01552              of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base priority <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> forced, then subsequent changes to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01553              parent process base priority will not change <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base priority
01554              of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread.
01555 
01556 Return Value:
01557 
01558     The previous base priority increment of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
01559 
01560 --*/
01561 
01562 {
01563 
01564     KPRIORITY NewBase;
01565     KPRIORITY NewPriority;
01566     KPRIORITY OldBase;
01567     LONG OldIncrement;
01568     KIRQL OldIrql;
01569     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
01570 
01571     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01572     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01573 
01574     <span class="comment">//</span>
01575     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01576     <span class="comment">//</span>
01577 
01578     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01579 
01580     <span class="comment">//</span>
01581     <span class="comment">// Capture the base priority of the specified thread and determine</span>
01582     <span class="comment">// whether saturation if being forced.</span>
01583     <span class="comment">//</span>
01584 
01585     Process = Thread-&gt;ApcStatePointer[0]-&gt;Process;
01586     OldBase = Thread-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a>;
01587     OldIncrement = OldBase - Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a>;
01588     <span class="keywordflow">if</span> (Thread-&gt;Saturation != 0) {
01589         OldIncrement = ((HIGH_PRIORITY + 1) / 2) * Thread-&gt;Saturation;
01590     }
01591 
01592     Thread-&gt;Saturation = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01593     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a259">abs</a>(Increment) &gt;= (HIGH_PRIORITY + 1) / 2) {
01594         Thread-&gt;Saturation = (<a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> &gt; 0) ? 1 : -1;
01595     }
01596 
01597     <span class="comment">//</span>
01598     <span class="comment">// Set the base priority of the specified thread. If the thread's process</span>
01599     <span class="comment">// is in the realtime class, then limit the change to the realtime class.</span>
01600     <span class="comment">// Otherwise, limit the change to the variable class.</span>
01601     <span class="comment">//</span>
01602 
01603     NewBase = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a> + <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
01604     <span class="keywordflow">if</span> (Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a> &gt;= LOW_REALTIME_PRIORITY) {
01605         <span class="keywordflow">if</span> (NewBase &lt; LOW_REALTIME_PRIORITY) {
01606             NewBase = LOW_REALTIME_PRIORITY;
01607 
01608         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewBase &gt; HIGH_PRIORITY) {
01609             NewBase = HIGH_PRIORITY;
01610         }
01611 
01612         <span class="comment">//</span>
01613         <span class="comment">// Set the new priority of the thread to the new base priority.</span>
01614         <span class="comment">//</span>
01615 
01616         NewPriority = NewBase;
01617 
01618     } <span class="keywordflow">else</span> {
01619         <span class="keywordflow">if</span> (NewBase &gt;= LOW_REALTIME_PRIORITY) {
01620             NewBase = LOW_REALTIME_PRIORITY - 1;
01621 
01622         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewBase &lt;= LOW_PRIORITY) {
01623             NewBase = 1;
01624         }
01625 
01626         <span class="comment">//</span>
01627         <span class="comment">// Compute the new thread priority. If the new priority is outside</span>
01628         <span class="comment">// the variable class, then set the new priority to the highest</span>
01629         <span class="comment">// variable priority.</span>
01630         <span class="comment">//</span>
01631 
01632         <span class="keywordflow">if</span> (Thread-&gt;Saturation != 0) {
01633             NewPriority = NewBase;
01634 
01635         } <span class="keywordflow">else</span> {
01636             NewPriority = Thread-&gt;Priority +
01637                             (NewBase - OldBase) - Thread-&gt;PriorityDecrement;
01638 
01639             <span class="keywordflow">if</span> (NewPriority &gt;= LOW_REALTIME_PRIORITY) {
01640                 NewPriority = LOW_REALTIME_PRIORITY - 1;
01641             }
01642         }
01643     }
01644 
01645     <span class="comment">//</span>
01646     <span class="comment">// Set the new base priority and clear the priority decrement. If the</span>
01647     <span class="comment">// new priority is not equal to the old priority, then set the new thread</span>
01648     <span class="comment">// priority.</span>
01649     <span class="comment">//</span>
01650 
01651     Thread-&gt;BasePriority = (SCHAR)NewBase;
01652     Thread-&gt;DecrementCount = 0;
01653     Thread-&gt;PriorityDecrement = 0;
01654     <span class="keywordflow">if</span> (NewPriority != Thread-&gt;Priority) {
01655         Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
01656         <a class="code" href="../../d0/d2/thredsup_8c.html#a5">KiSetPriorityThread</a>(Thread, NewPriority);
01657     }
01658 
01659     <span class="comment">//</span>
01660     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01661     <span class="comment">// value.</span>
01662     <span class="comment">//</span>
01663 
01664     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01665 
01666     <span class="comment">//</span>
01667     <span class="comment">// Return the previous thread base priority.</span>
01668     <span class="comment">//</span>
01669 
01670     <span class="keywordflow">return</span> OldIncrement;
01671 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="thredobj.c::KeSetDisableBoostThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL KeSetDisableBoostThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>Disable</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01674">1674</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, and <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>.
<p>
<pre class="fragment"><div>01681                    :
01682 
01683     This function disables priority boosts <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
01684 
01685 Arguments:
01686 
01687     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01688 
01689     Disable - Supplies a logical value that determines whether priority
01690         boosts <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread are disabled or enabled.
01691 
01692 Return Value:
01693 
01694     The previous value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> disable boost state variable.
01695 
01696 --*/
01697 
01698 {
01699 
01700     LOGICAL DisableBoost;
01701     KIRQL OldIrql;
01702 
01703     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01704     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01705 
01706     <span class="comment">//</span>
01707     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01708     <span class="comment">//</span>
01709 
01710     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01711 
01712     <span class="comment">//</span>
01713     <span class="comment">// Capture the current state of the disable boost variable and set its</span>
01714     <span class="comment">// state to TRUE.</span>
01715     <span class="comment">//</span>
01716 
01717     DisableBoost = Thread-&gt;DisableBoost;
01718     Thread-&gt;DisableBoost = (BOOLEAN)Disable;
01719 
01720     <span class="comment">//</span>
01721     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01722     <span class="comment">// value.</span>
01723     <span class="comment">//</span>
01724 
01725     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01726 
01727     <span class="comment">//</span>
01728     <span class="comment">// Return the previous disable boost state.</span>
01729     <span class="comment">//</span>
01730 
01731     <span class="keywordflow">return</span> DisableBoost;
01732 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="thredobj.c::KeSetIdealProcessorThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CCHAR KeSetIdealProcessorThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Processor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01735">1735</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l01420">MAXIMUM_PROCESSORS</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00772">_KPROCESS::ThreadSeed</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>.
<p>
<pre class="fragment"><div>01742                    :
01743 
01744     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ideal processor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread execution.
01745 
01746 Arguments:
01747 
01748     Thread - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread whose ideal processor number <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01749         set to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specfied value.
01750 
01751     Processor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ideal processor (the distinguished
01752         value MAXIMUM_PROCESSORS indicates that there is no ideal processor).
01753 
01754 Return Value:
01755 
01756     The previous ideal processor number.
01757 
01758 --*/
01759 
01760 {
01761 
01762     CCHAR OldProcessor;
01763     KIRQL OldIrql;
01764     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
01765 
01766     <span class="comment">//</span>
01767     <span class="comment">// Capture the previous ideal processor value, set the new ideal</span>
01768     <span class="comment">// processor value, and return the old ideal processor value for the</span>
01769     <span class="comment">// current thread;</span>
01770     <span class="comment">//</span>
01771     <span class="comment">// Note that this is done under the dispatcher lock in order to</span>
01772     <span class="comment">// synchronize the updates with the other fields that share the</span>
01773     <span class="comment">// same DWORD. Otherwise there is a granularity problem on Alpha.</span>
01774     <span class="comment">//</span>
01775 
01776     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Processor &lt;= MAXIMUM_PROCESSORS);
01777 
01778     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01779     OldProcessor = Thread-&gt;IdealProcessor;
01780     <span class="keywordflow">if</span> (Processor &lt; <a class="code" href="../../d9/d5/ndismain_8h.html#a183">MAXIMUM_PROCESSORS</a>) {
01781         Thread-&gt;IdealProcessor = Processor;
01782 
01783     } <span class="keywordflow">else</span> {
01784         Process = Thread-&gt;ApcState.Process;
01785         Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o16">ThreadSeed</a> += 1;
01786         Thread-&gt;IdealProcessor = (UCHAR)(Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o16">ThreadSeed</a> % <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>);
01787     }
01788 
01789     <span class="comment">//</span>
01790     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01791     <span class="comment">// value.</span>
01792     <span class="comment">//</span>
01793 
01794     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01795     <span class="keywordflow">return</span> OldProcessor;
01796 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="thredobj.c::KeSetKernelStackSwapEnable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeSetKernelStackSwapEnable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Enable</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01799">1799</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00640">_KTHREAD::EnableStackSwap</a>, and <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l02552">xxxDestroyThreadInfo()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l01296">xxxInterSendMsgEx()</a>.
<p>
<pre class="fragment"><div>01805                    :
01806 
01807     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel stack swap enable value <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
01808     thread and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old swap enable value.
01809 
01810 Arguments:
01811 
01812     Enable - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> kernel stack swap enable value.
01813 
01814 Return Value:
01815 
01816     The previous kernel stack swap enable value.
01817 
01818 --*/
01819 
01820 {
01821 
01822     BOOLEAN OldState;
01823     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
01824 
01825     <span class="comment">//</span>
01826     <span class="comment">// Capture the previous kernel stack swap enable value, set the new</span>
01827     <span class="comment">// swap enable value, and return the old swap enable value for the</span>
01828     <span class="comment">// current thread;</span>
01829     <span class="comment">//</span>
01830 
01831     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
01832     OldState = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o51">EnableStackSwap</a>;
01833     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o51">EnableStackSwap</a> = Enable;
01834     <span class="keywordflow">return</span> OldState;
01835 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="thredobj.c::KeSetPriorityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KPRIORITY KeSetPriorityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Priority</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01838">1838</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00769">_KPROCESS::ThreadQuantum</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00345">FsRtlWorkerThread()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00142">KeBalanceSetManager()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00154">KeBoostCurrentThread()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00322">KeSwapProcessOrStack()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00603">MiDereferenceSegmentThread()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l04239">MiMappedPageWriter()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l02669">MiModifiedPageWriter()</a>, <a class="el" href="../../d8/d0/zeropage_8c-source.html#l00029">MmZeroPageThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, and <a class="el" href="../../d2/d1/hooks_8c-source.html#l00576">zzzSetWindowsHookEx()</a>.
<p>
<pre class="fragment"><div>01845                    :
01846 
01847     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread to a <span class="keyword">new</span> value.
01848     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> thread priority <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> lower than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old thread priority, then
01849     resecheduling may take place <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently running on, or
01850     about to run on, a processor.
01851 
01852 Arguments:
01853 
01854     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01855 
01856     Priority - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject thread.
01857 
01858 Return Value:
01859 
01860     The previous priority of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread.
01861 
01862 --*/
01863 
01864 {
01865 
01866     KIRQL OldIrql;
01867     KPRIORITY OldPriority;
01868     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
01869 
01870     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01871     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01872     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(((Priority != 0) || (Thread-&gt;BasePriority == 0)) &amp;&amp;
01873            (Priority &lt;= HIGH_PRIORITY));
01874 
01875     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeIsExecutingDpc() == FALSE);
01876 
01877     <span class="comment">//</span>
01878     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01879     <span class="comment">//</span>
01880 
01881     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01882 
01883     <span class="comment">//</span>
01884     <span class="comment">// Capture the current thread priority, set the thread priority to the</span>
01885     <span class="comment">// the new value, and replenish the thread quantum. It is assumed that</span>
01886     <span class="comment">// the priority would not be set unless the thread had already lost it</span>
01887     <span class="comment">// initial quantum.</span>
01888     <span class="comment">//</span>
01889 
01890     OldPriority = Thread-&gt;Priority;
01891     Process = Thread-&gt;ApcStatePointer[0]-&gt;Process;
01892     Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
01893     Thread-&gt;DecrementCount = 0;
01894     Thread-&gt;PriorityDecrement = 0;
01895     <a class="code" href="../../d0/d2/thredsup_8c.html#a5">KiSetPriorityThread</a>(Thread, Priority);
01896 
01897     <span class="comment">//</span>
01898     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01899     <span class="comment">// value.</span>
01900     <span class="comment">//</span>
01901 
01902     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01903 
01904     <span class="comment">//</span>
01905     <span class="comment">// Return the previous thread priority.</span>
01906     <span class="comment">//</span>
01907 
01908     <span class="keywordflow">return</span> OldPriority;
01909 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="thredobj.c::KeSetSystemAffinityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSetSystemAffinityThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KAFFINITY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Affinity</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01467">1467</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00622">_KTHREAD::Affinity</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00479">KiSelectNextThread()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00569">_KTHREAD::State</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00598">_KTHREAD::SystemAffinityActive</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01986">CmpConfigureProcessors()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d4/d0/biosc_8c-source.html#l00060">Ke386CallBios()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02008">KeSetup80387OrEmulate()</a>, and <a class="el" href="../../d7/d8/kernlini_8c-source.html#l01691">KiInitMachineDependent()</a>.
<p>
<pre class="fragment"><div>01473                    :
01474 
01475     This function set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system affinity of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread.
01476 
01477 Arguments:
01478 
01479     Affinity - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> of set of processors on which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
01480         can run.
01481 
01482 Return Value:
01483 
01484     None.
01485 
01486 --*/
01487 
01488 {
01489 
01490     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> CurrentThread;
01491     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> NextThread;
01492     KIRQL OldIrql;
01493     PKPRCB Prcb;
01494 
01495     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01496     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Affinity &amp; KeActiveProcessors) != 0);
01497 
01498     <span class="comment">//</span>
01499     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01500     <span class="comment">//</span>
01501 
01502     CurrentThread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
01503     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01504 
01505     <span class="comment">//</span>
01506     <span class="comment">// Set the current affinity to the specified affinity.</span>
01507     <span class="comment">//</span>
01508     <span class="comment">// If the current processor is not in the new affinity set and another</span>
01509     <span class="comment">// thread has not already been selected for execution on the current</span>
01510     <span class="comment">// processor, then select a new thread for the current processor.</span>
01511     <span class="comment">//</span>
01512 
01513     CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o41">Affinity</a> = Affinity;
01514     CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o32">SystemAffinityActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01515     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
01516     <span class="keywordflow">if</span> (((Prcb-&gt;SetMember &amp; CurrentThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o41">Affinity</a>) == 0) &amp;&amp;
01517         (Prcb-&gt;NextThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01518         NextThread = <a class="code" href="../../d0/d2/thredsup_8c.html#a4">KiSelectNextThread</a>(CurrentThread);
01519         NextThread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
01520         Prcb-&gt;NextThread = NextThread;
01521     }
01522 
01523     <span class="comment">//</span>
01524     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous value.</span>
01525     <span class="comment">//</span>
01526 
01527     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01528     <span class="keywordflow">return</span>;
01529 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="thredobj.c::KeSuspendThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KeSuspendThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01912">1912</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00052">ASSERT_THREAD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">KiInsertQueueApc()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, and <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">RESUME_INCREMENT</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00033">NtSuspendThread()</a>, and <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.
<p>
<pre class="fragment"><div>01918                    :
01919 
01920     This function suspends <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of a thread. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> suspend count
01921     overflows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum suspend count, then a condition <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> raised.
01922 
01923 Arguments:
01924 
01925     Thread  - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
01926 
01927 Return Value:
01928 
01929     The previous suspend count.
01930 
01931 --*/
01932 
01933 {
01934 
01935     ULONG OldCount;
01936     KIRQL OldIrql;
01937 
01938     <a class="code" href="../../d4/d1/alpha_2thredini_8c.html#a1">ASSERT_THREAD</a>(Thread);
01939     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
01940 
01941     <span class="comment">//</span>
01942     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
01943     <span class="comment">//</span>
01944 
01945     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
01946 
01947     <span class="comment">//</span>
01948     <span class="comment">// Capture the current suspend count.</span>
01949     <span class="comment">//</span>
01950 
01951     OldCount = Thread-&gt;SuspendCount;
01952 
01953     <span class="comment">//</span>
01954     <span class="comment">// If the suspend count is at its maximum value, then unlock dispatcher</span>
01955     <span class="comment">// database, lower IRQL to its previous value, and raise an error</span>
01956     <span class="comment">// condition.</span>
01957     <span class="comment">//</span>
01958 
01959     <span class="keywordflow">if</span> (OldCount == MAXIMUM_SUSPEND_COUNT) {
01960 
01961         <span class="comment">//</span>
01962         <span class="comment">// Unlock the dispatcher database and raise an exception.</span>
01963         <span class="comment">//</span>
01964 
01965         <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01966         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_SUSPEND_COUNT_EXCEEDED);
01967     }
01968 
01969     <span class="comment">//</span>
01970     <span class="comment">// Increment the suspend count. If the thread was not previously suspended,</span>
01971     <span class="comment">// then queue the thread's suspend APC.</span>
01972     <span class="comment">//</span>
01973 
01974     Thread-&gt;SuspendCount += 1;
01975     <span class="keywordflow">if</span> ((OldCount == 0) &amp;&amp; (Thread-&gt;FreezeCount == 0)) {
01976         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/ki_8h.html#a123">KiInsertQueueApc</a>(&amp;Thread-&gt;SuspendApc, RESUME_INCREMENT) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01977             Thread-&gt;SuspendSemaphore.Header.SignalState -= 1;
01978         }
01979     }
01980 
01981     <span class="comment">//</span>
01982     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
01983     <span class="comment">// value.</span>
01984     <span class="comment">//</span>
01985 
01986     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
01987 
01988     <span class="comment">//</span>
01989     <span class="comment">// Return the previous suspend count.</span>
01990     <span class="comment">//</span>
01991 
01992     <span class="keywordflow">return</span> OldCount;
01993 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="thredobj.c::KeTerminateThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeTerminateThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KPRIORITY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Increment</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">1996</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00036">BALANCE_INCREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00413">_KEVENT::Header</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00649">KiActivateWaiterQueue()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00710">KiInsertQueue()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00435">KiProcessOutSwapListHead</a>, <a class="el" href="../../d0/d9/mips_8h-source.html#l01576">KiRundownThread</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00421">KiSwapEvent</a>, <a class="el" href="../../d0/d0/ki_8h.html#a138">KiSwapThread()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01955">_WORK_QUEUE_ITEM::List</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a405a188">ProcessInTransition</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00589">PsReaperActive</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00590">PsReaperListHead</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00591">PsReaperWorkItem</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00767">_KPROCESS::StackCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00771">_KPROCESS::State</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00763">_KPROCESS::SwapListEntry</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a195">Terminated</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00453">_ETHREAD::ThreadListEntry</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00764">_KPROCESS::ThreadListHead</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00263">_DISPATCHER_HEADER::WaitListHead</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.
<p>
<pre class="fragment"><div>02002                    :
02003 
02004     This function terminates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread, sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02005     signal state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread to Signaled, and attempts to satisfy as many
02006     Waits as possible. The scheduling state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to terminated,
02007     and a <span class="keyword">new</span> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> selected to run on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current processor. There <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no
02008     <span class="keywordflow">return</span> from <span class="keyword">this</span> function.
02009 
02010 Arguments:
02011 
02012     None.
02013 
02014 Return Value:
02015 
02016     None.
02017 
02018 --*/
02019 
02020 {
02021 
02022     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> NextThread;
02023     KIRQL OldIrql;
02024     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
02025     <a class="code" href="../../d7/d7/struct__KQUEUE.html">PRKQUEUE</a> Queue;
02026     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
02027 
02028     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
02029 
02030     <span class="comment">//</span>
02031     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
02032     <span class="comment">//</span>
02033 
02034     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
02035     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
02036 
02037     <span class="comment">//</span>
02038     <span class="comment">// Insert the thread in the reaper list.</span>
02039     <span class="comment">//</span>
02040     <span class="comment">// If a reaper thread is not currently active, then insert a work item in</span>
02041     <span class="comment">// the hyper critical work queue.</span>
02042     <span class="comment">//</span>
02043     <span class="comment">// N.B. This code has knowledge of the reaper data structures and how</span>
02044     <span class="comment">//      worker threads are implemented.</span>
02045     <span class="comment">//</span>
02046     <span class="comment">// N.B. The dispatcher database lock is used to synchronize access to the</span>
02047     <span class="comment">//      reaper list.</span>
02048     <span class="comment">//</span>
02049 
02050     InsertTailList(&amp;PsReaperListHead, &amp;((<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)Thread)-&gt;TerminationPortList);
02051     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a63">PsReaperActive</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
02052         <a class="code" href="../../d1/d9/ps_8h.html#a63">PsReaperActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02053         <a class="code" href="../../d8/d3/queueobj_8c.html#a8">KiInsertQueue</a>(&amp;ExWorkerQueue[HyperCriticalWorkQueue].WorkerQueue,
02054                       &amp;<a class="code" href="../../d1/d9/ps_8h.html#a65">PsReaperWorkItem</a>.<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o0">List</a>,
02055                       FALSE);
02056     }
02057 
02058     <span class="comment">//</span>
02059     <span class="comment">// If the current thread is processing a queue entry, then remove</span>
02060     <span class="comment">// the thrread from the queue object thread list and attempt to</span>
02061     <span class="comment">// activate another thread that is blocked on the queue object.</span>
02062     <span class="comment">//</span>
02063 
02064     Queue = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o37">Queue</a>;
02065     <span class="keywordflow">if</span> (Queue != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02066         RemoveEntryList(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o40">QueueListEntry</a>);
02067         <a class="code" href="../../d8/d3/queueobj_8c.html#a7">KiActivateWaiterQueue</a>(Queue);
02068     }
02069 
02070     <span class="comment">//</span>
02071     <span class="comment">// Set the state of the current thread object to Signaled, and attempt</span>
02072     <span class="comment">// to satisfy as many Waits as possible.</span>
02073     <span class="comment">//</span>
02074 
02075     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02076     <span class="keywordflow">if</span> (IsListEmpty(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02077         <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>((PVOID)Thread, Increment);
02078     }
02079 
02080     <span class="comment">//</span>
02081     <span class="comment">// Remove thread from its parent process' thread list.</span>
02082     <span class="comment">//</span>
02083 
02084     RemoveEntryList(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o64">ThreadListEntry</a>);
02085 
02086     <span class="comment">//</span>
02087     <span class="comment">// Set thread scheduling state to terminated, decrement the process'</span>
02088     <span class="comment">// stack count, select a new thread to run on the current processor,</span>
02089     <span class="comment">// and swap context to the new thread.</span>
02090     <span class="comment">//</span>
02091 
02092     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a406a195">Terminated</a>;
02093     Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
02094     Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o11">StackCount</a> -= 1;
02095     <span class="keywordflow">if</span> (Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o11">StackCount</a> == 0) {
02096         <span class="keywordflow">if</span> (Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o8">ThreadListHead</a>.Flink != &amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o8">ThreadListHead</a>) {
02097             Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o15">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a405a188">ProcessInTransition</a>;
02098             InsertTailList(&amp;KiProcessOutSwapListHead, &amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o7">SwapListEntry</a>);
02099             <a class="code" href="../../d5/d9/kernldat_8c.html#a47">KiSwapEvent</a>.<a class="code" href="../../d2/d6/struct__KEVENT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> = 1;
02100             <span class="keywordflow">if</span> (IsListEmpty(&amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a47">KiSwapEvent</a>.<a class="code" href="../../d2/d6/struct__KEVENT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
02101                 <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;KiSwapEvent, BALANCE_INCREMENT);
02102             }
02103         }
02104     }
02105 
02106     <span class="comment">//</span>
02107     <span class="comment">// Rundown any architectural specific structures</span>
02108     <span class="comment">//</span>
02109 
02110     <a class="code" href="../../d9/d9/mips_8h.html#a2">KiRundownThread</a>(Thread);
02111 
02112     <span class="comment">//</span>
02113     <span class="comment">// Get off the processor for the last time.</span>
02114     <span class="comment">//</span>
02115 
02116     <a class="code" href="../../d0/d0/ki_8h.html#a138">KiSwapThread</a>();
02117     <span class="keywordflow">return</span>;
02118 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="thredobj.c::KeTestAlertThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeTestAlertThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AlertMode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02121">2121</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00570">_KTHREAD::Alerted</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00243">_KAPC_STATE::ApcListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00613">_KTHREAD::ApcQueueLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00247">_KAPC_STATE::UserApcPending</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>, and <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00345">NtTestAlert()</a>.
<p>
<pre class="fragment"><div>02127                    :
02128 
02129     This function tests to determine <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alerted variable <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02130     specified processor mode has a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> or whether a user mode
02131     APC should be delivered to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread.
02132 
02133 Arguments:
02134 
02135     AlertMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be tested
02136         <span class="keywordflow">for</span> an alerted condition.
02137 
02138 Return Value:
02139 
02140     The previous state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alerted variable <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor
02141     mode.
02142 
02143 --*/
02144 
02145 {
02146 
02147     BOOLEAN Alerted;
02148     KIRQL OldIrql;
02149     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
02150 
02151     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
02152 
02153     <span class="comment">//</span>
02154     <span class="comment">// Raise IRQL to dispatcher level, lock dispatcher database, and lock</span>
02155     <span class="comment">// APC queue.</span>
02156     <span class="comment">//</span>
02157 
02158     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
02159     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
02160     KiAcquireSpinLock(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
02161 
02162     <span class="comment">//</span>
02163     <span class="comment">// If the current thread is alerted for the specified processor mode,</span>
02164     <span class="comment">// then clear the alerted state. Else if the specified processor mode</span>
02165     <span class="comment">// is user and the current thread's user mode APC queue contains an entry,</span>
02166     <span class="comment">// then set user APC pending.</span>
02167     <span class="comment">//</span>
02168 
02169     Alerted = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o9">Alerted</a>[AlertMode];
02170     <span class="keywordflow">if</span> (Alerted == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02171         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o9">Alerted</a>[AlertMode] = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02172 
02173     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((AlertMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>) &amp;&amp;
02174               (IsListEmpty(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[UserMode]) != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
02175         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02176     }
02177 
02178     <span class="comment">//</span>
02179     <span class="comment">// Unlock APC queue, unlock dispatcher database, lower IRQL to its</span>
02180     <span class="comment">// previous value, and return the previous alerted state for the</span>
02181     <span class="comment">// specified mode.</span>
02182     <span class="comment">//</span>
02183 
02184     KiReleaseSpinLock(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
02185     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
02186     <span class="keywordflow">return</span> Alerted;
02187 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="thredobj.c::KeThawAllThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeThawAllThreads           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02190">2190</a> of file <a class="el" href="../../d0/d1/thredobj_8c-source.html">thredobj.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00679">_KTHREAD::FreezeCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00512">_KSEMAPHORE::Header</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">RESUME_INCREMENT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00680">_KTHREAD::SuspendCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00669">_KTHREAD::SuspendSemaphore</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00764">_KPROCESS::ThreadListHead</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00086">DbgkpResumeProcess()</a>.
<p>
<pre class="fragment"><div>02196                    :
02197 
02198     This function resumes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of all suspended froozen threads
02199     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process.
02200 
02201 Arguments:
02202 
02203     None.
02204 
02205 Return Value:
02206 
02207     None.
02208 
02209 --*/
02210 
02211 {
02212 
02213     PLIST_ENTRY ListHead;
02214     PLIST_ENTRY NextEntry;
02215     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
02216     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
02217     ULONG OldCount;
02218     KIRQL OldIrql;
02219 
02220     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
02221 
02222     <span class="comment">//</span>
02223     <span class="comment">// Get the address of the current current process object, raise IRQL</span>
02224     <span class="comment">// to dispatch level, lock dispatcher database, and thaw the execution</span>
02225     <span class="comment">// of all threads in the current process that have been frozzen.</span>
02226     <span class="comment">//</span>
02227 
02228     Process = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process;
02229     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
02230     ListHead = &amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o8">ThreadListHead</a>;
02231     NextEntry = ListHead-&gt;Flink;
02232     <span class="keywordflow">do</span> {
02233 
02234         <span class="comment">//</span>
02235         <span class="comment">// Get the address of the next thread and thaw its execution if</span>
02236         <span class="comment">// if was previously froozen.</span>
02237         <span class="comment">//</span>
02238 
02239         Thread = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>, ThreadListEntry);
02240         OldCount = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a>;
02241         <span class="keywordflow">if</span> (OldCount != 0) {
02242             Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a> -= 1;
02243 
02244             <span class="comment">//</span>
02245             <span class="comment">// If the resultant suspend count is zero and the freeze count is</span>
02246             <span class="comment">// zero, then resume the thread by releasing its suspend semaphore.</span>
02247             <span class="comment">//</span>
02248 
02249             <span class="keywordflow">if</span> ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o66">SuspendCount</a> == 0) &amp;&amp; (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a> == 0)) {
02250                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o63">SuspendSemaphore</a>.<a class="code" href="../../d8/d7/struct__KSEMAPHORE.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> += 1;
02251                 <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o63">SuspendSemaphore</a>, RESUME_INCREMENT);
02252             }
02253         }
02254 
02255         NextEntry = NextEntry-&gt;Flink;
02256     } <span class="keywordflow">while</span> (NextEntry != ListHead);
02257 
02258     <span class="comment">//</span>
02259     <span class="comment">// Unlock dispatcher database and lower IRQL to its previous</span>
02260     <span class="comment">// value.</span>
02261     <span class="comment">//</span>
02262 
02263     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
02264     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
02265     <span class="keywordflow">return</span>;
02266 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:46 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
