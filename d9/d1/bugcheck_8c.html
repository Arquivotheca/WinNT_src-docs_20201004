<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: bugcheck.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>bugcheck.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include "wdbgexts.h"</code><br>
<code>#include &lt;<a class="el" href="../../d1/d0/inbv_8h-source.html">inbv.h</a>&gt;</code><br>

<p>
<a href="../../d0/d1/bugcheck_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a0">NOEXTAPI</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a1">POWER_FAILURE_SIMULATE</a>&nbsp;&nbsp;&nbsp;((ULONG)0x000000E5L)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a12">KiScanBugCheckCallbackList</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a> (IN ULONG BugCheckCode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a14">KeGetBugMessageText</a> (IN ULONG MessageId, IN PANSI_STRING ReturnedString OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a15">KeBugCheckUnicodeToAnsi</a> (IN PUNICODE_STRING UnicodeString, OUT PCHAR AnsiBuffer, IN ULONG MaxAnsiLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a16">KiBugCheckDebugBreak</a> (IN ULONG BreakStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a17">KiPcToFileHeader</a> (IN PVOID PcValue, OUT PLDR_DATA_TABLE_ENTRY *DataTableEntry, IN LOGICAL DriversOnly, OUT PBOOLEAN InKernelOrHal)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a18">KiDumpParameterImages</a> (IN PCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN PULONG_PTR BugCheckParameters, IN ULONG NumberOfParameters, IN <a class="el" href="../../d4/d9/ke_8h.html#a116">PKE_BUGCHECK_UNICODE_TO_ANSI</a> UnicodeToAnsiRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a> (IN ULONG BugCheckCode, IN ULONG_PTR BugCheckParameter1, IN ULONG_PTR BugCheckParameter2, IN ULONG_PTR BugCheckParameter3, IN ULONG_PTR BugCheckParameter4)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a20">KeEnterKernelDebugger</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a21">KeDeregisterBugCheckCallback</a> (IN <a class="el" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">PKBUGCHECK_CALLBACK_RECORD</a> CallbackRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a22">KeRegisterBugCheckCallback</a> (IN <a class="el" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">PKBUGCHECK_CALLBACK_RECORD</a> CallbackRecord, IN <a class="el" href="../../d4/d9/ke_8h.html#a113">PKBUGCHECK_CALLBACK_ROUTINE</a> CallbackRoutine, IN PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN ULONG Length, IN PUCHAR Component)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>KDDEBUGGER_DATA64&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a2">KdDebuggerDataBlock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a3">ExPoolCodeStart</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a4">ExPoolCodeEnd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a5">MmPoolCodeStart</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a6">MmPoolCodeEnd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a7">MmPteCodeStart</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a8">MmPteCodeEnd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a9">KeBugCheckCount</a> = 1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a10">KiBugCheckData</a> [5]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PUNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="bugcheck.c::NOEXTAPI" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOEXTAPI          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00026">26</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="bugcheck.c::POWER_FAILURE_SIMULATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POWER_FAILURE_SIMULATE&nbsp;&nbsp;&nbsp;((ULONG)0x000000E5L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00425">425</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a13" doxytag="bugcheck.c::KeBugCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeBugCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>BugCheckCode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">70</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02683">ExpFindCurrentThread()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01804">IoBuildPartialMdl()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l01546">IopAssignNetworkDriveLetter()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d1/d2/ppc_2initkr_8c-source.html#l00653">KePhase0DeleteIoMap()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">Ki386CheckDivideByZeroTrap()</a>, <a class="el" href="../../d2/d1/mips_2buserror_8c-source.html#l00124">KiDataBusError()</a>, <a class="el" href="../../d0/d8/i386_2exceptn_8c-source.html#l00115">KiEspToTrapFrame()</a>, <a class="el" href="../../d5/d3/i386_2intobj_8c-source.html#l00558">KiGetVectorInfo()</a>, <a class="el" href="../../d8/d2/i386init_8c-source.html#l00067">KiInitializeGDT()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, <a class="el" href="../../d2/d1/mips_2buserror_8c-source.html#l00216">KiInstructionBusError()</a>, <a class="el" href="../../d1/d1/alpha_2buserror_8c-source.html#l00031">KiMachineCheck()</a>, <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00056">KiMemoryFault()</a>, <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00906">KiSystemServiceHandler()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00311">LfsGetLbcb()</a>, <a class="el" href="../../d3/d0/inialpha_8c-source.html#l00041">MiInitMachineDependent()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00153">MiMapImageHeaderInHyperSpace()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00035">MiMapPageInHyperSpace()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00313">MiMapPageToZeroInHyperSpace()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00138">PsInitSystem()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00631">PspExitNormalApc()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01920">PspSystemThreadStartup()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01438">PspThreadDelete()</a>, <a class="el" href="../../d1/d5/semethod_8c-source.html#l00195">SeDefaultObjectMethod()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00041">SeInitSystem()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00153">SepAuditFailed()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, and <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01243">xHalIoAssignDriveLetters()</a>.
<p>
<pre class="fragment"><div>00076                    :
00077 
00078     This function crashes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system in a controlled manner.
00079 
00080 Arguments:
00081 
00082     BugCheckCode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check.
00083 
00084 Return Value:
00085 
00086     None.
00087 
00088 --*/
00089 {
00090     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(BugCheckCode,0,0,0,0);
00091 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="bugcheck.c::KeBugCheckEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeBugCheckEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckParameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckParameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckParameter3</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckParameter4</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">428</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00014">DATA_BUS_ERROR</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00037">ExPoolCodeEnd</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00036">ExPoolCodeStart</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a411a244">HalRebootRoutine</a>, <a class="el" href="../../d2/d7/hal_8h.html#a177">HalReturnToFirmware()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d1/d0/inbv_8h-source.html#l00034">INBV_DISPLAY_STRING_FILTER</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a4">InbvAcquireDisplayOwnership()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a17">InbvEnableDisplayString()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a3">InbvInstallDisplayStringFilter()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a18">InbvIsBootDriverInstalled()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a6">InbvResetDisplay()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a26">InbvSetScrollRegion()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a27">InbvSetTextColor()</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a8">InbvSolidColorFill()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01519">IoWriteCrashDump()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00281">IPI_FREEZE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00024">IRQL_NOT_LESS_OR_EQUAL</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00248">IS_SYSTEM_ADDRESS</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00106">KdDebuggerDataBlock</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00133">KdDebuggerNotPresent</a>, <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00072">KdInitSystem()</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00024">KeBugCheckCount</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00160">KeBugCheckUnicodeToAnsi()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00097">KeGetBugMessageText()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a206">KeStallExecutionProcessor()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00023">KiBugCheckData</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00184">KiBugCheckDebugBreak()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00094">KiBugCheckDriver</a>, <a class="el" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00317">KiDumpParameterImages()</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00064">KiHardwareTrigger</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00253">KiIpiSend()</a>, <a class="el" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader()</a>, <a class="el" href="../../d6/d0/xxmpipi_8c-source.html#l00124">KiSaveProcessorControlState()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01207">KiScanBugCheckCallbackList()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00025">KMODE_EXCEPTION_NOT_HANDLED</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l05146">MmIsHydraAddress()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l05177">MmIsSpecialPoolAddressFree()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02836">MmLocateUnloadedDriver()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00039">MmPoolCodeEnd</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00038">MmPoolCodeStart</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00041">MmPteCodeEnd</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00040">MmPteCodeStart</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01977">MmSpecialPoolEnd</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01976">MmSpecialPoolStart</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00425">POWER_FAILURE_SIMULATE</a>, <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00562">_KTHREAD::Teb</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00035">UNEXPECTED_KERNEL_MODE_TRAP</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03778">CmBootLastKnownGood()</a>, <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">CmGetSystemControlValues()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">CmGetSystemDriverList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00081">CmpCheckLockExceptionFilter()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01227">CmpHiveRootSecurityDescriptor()</a>, <a class="el" href="../../d9/d1/cmsubs_8c-source.html#l01512">CmpInitializeCache()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00726">CmpInitializeHiveList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02022">CmpInitializeSystemHive()</a>, <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00265">CmpReleaseGlobalQuota()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l00158">CmpSecurityMethod()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00115">CmpWorker()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01985">DrvDriverFailure()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03828">ExAllocatePoolSanityChecks()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03892">ExFreePoolSanityChecks()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02760">ExFreePoolWithTag()</a>, <a class="el" href="../../d7/d5/ex_2region_8c-source.html#l00024">ExInitializeRegion()</a>, <a class="el" href="../../d7/d5/ex_2region_8c-source.html#l00110">ExInterlockedExtendRegion()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l01097">ExpCheckForWorker()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00064">ExpSystemErrorHandler()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01389">ExReleaseResourceLite()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00336">ExUnlockHandleTableEntry()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00345">FsRtlWorkerThread()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l01584">HvRefreshHive()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00677">InitializePool()</a>, <a class="el" href="../../d8/d8/assign_8c-source.html#l00394">IoAssignResources()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00048">IoBuildPoDeviceNotifyList()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02149">IoCancelIrp()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00297">IopDestroyDeviceNode()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00960">IopDriverCorrectnessThrowBugCheck()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02063">IopfCallDriver()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06641">IopFreeIrp()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02327">IopInitializeBootDrivers()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03479">IopMarkBootPartition()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04282">IopMountVolume()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01538">IopProcessNewDeviceNode()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00917">IopProcessRelation()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00994">IopStartAndEnumerateDevice()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00297">IoReportResourceForDetection()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00379">IoReportResourceUsage()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00455">IovBuildAsynchronousFsdRequest()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00486">IovBuildDeviceIoControlRequest()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00248">IovCallDriver()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00297">IovCompleteRequest()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00206">IovFreeIrpPrivate()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00524">IovInitializeTimer()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00542">IovpCompleteRequest()</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l01159">IovSpecialIrpCallDriver()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l03007">KdpCauseBugCheck()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00166">KeAttachProcess()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d2/d1/mips_2buserror_8c-source.html#l00029">KeBusError()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00467">KeCheckForTimer()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00228">KeForceAttachProcess()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01218">KeRundownThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00324">KeStackAttachProcess()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02283">KfSanityCheckLowerIrql()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02233">KfSanityCheckRaiseIrql()</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>, <a class="el" href="../../d1/d8/ia64_2exceptn_8c-source.html#l00098">KiEmulateFloat()</a>, <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00438">KiGeneralExceptions()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00417">KiIA32ExceptionNoDevice()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00938">KiIA32ExceptionPanic()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00355">KiIA32InterceptInstruction()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00056">KiMemoryFault()</a>, <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00590">KiNatExceptions()</a>, <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00159">KiRequestSoftwareInterrupt()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l00879">MiAddMdlTracker()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03472">MiAllocateSpecialPool()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04116">MiCheckSessionPoolAllocations()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l01075">MiCleanSection()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l00100">MiCloneProcessAddressSpace()</a>, <a class="el" href="../../d7/d1/mm_2ia64_2initia64_8c-source.html#l02185">MiConvertToLoaderVirtual()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l01745">MiDecrementCloneBlockReference()</a>, <a class="el" href="../../d7/d4/pfndec_8c-source.html#l00167">MiDecrementReferenceCount()</a>, <a class="el" href="../../d7/d4/pfndec_8c-source.html#l00030">MiDecrementShareCount()</a>, <a class="el" href="../../d9/d5/deleteva_8c-source.html#l00506">MiDeletePte()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l04950">MiDeleteSystemPagableVm()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03974">MiEliminateWorkingSetEntry()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00941">MiEnsureAvailablePageOrWait()</a>, <a class="el" href="../../d7/d1/mm_2ia64_2initia64_8c-source.html#l00225">MiEnsureAvailablePagesInFreeDescriptor()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01041">MiFreeMdlTracker()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l01778">MiFreePoolPages()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l04071">MiFreeSessionSpaceMap()</a>, <a class="el" href="../../d7/d1/mm_2ia64_2initia64_8c-source.html#l00139">MiGetNextPhysicalPage()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l02204">MiHandleForkTransitionPte()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03764">MiInitializeCopyOnWritePfn()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03398">MiInitializePfn()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03523">MiInitializeReadInProgressPfn()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03650">MiInitializeTransitionPfn()</a>, <a class="el" href="../../d3/d0/inialpha_8c-source.html#l00041">MiInitMachineDependent()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00059">MiInsertPageInList()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00388">MiInsertStandbyListAtFront()</a>, <a class="el" href="../../d8/d9/wstree_8c-source.html#l00248">MiLocateWsle()</a>, <a class="el" href="../../d8/d9/wstree_8c-source.html#l00765">MiLookupWsleHashIndex()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l05287">MiMakeOutswappedPageResident()</a>, <a class="el" href="../../d1/d1/mmsup_8c-source.html#l00764">MiMakeSystemAddressValid()</a>, <a class="el" href="../../d1/d1/mmsup_8c-source.html#l00996">MiMakeSystemAddressValidPfn()</a>, <a class="el" href="../../d1/d1/mmsup_8c-source.html#l00916">MiMakeSystemAddressValidPfnSystemWs()</a>, <a class="el" href="../../d1/d1/mmsup_8c-source.html#l00837">MiMakeSystemAddressValidPfnWs()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l01354">MiReleaseSystemPtes()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l03893">MiRemoveFromSystemSpace()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l01567">MiRemovePageByColor()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00521">MiRemovePageFromList()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01675">MiRemovePteTracker()</a>, <a class="el" href="../../d8/d9/wstree_8c-source.html#l00464">MiRemoveWsle()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l00524">MiReserveSystemPtes()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l00843">MiReserveSystemPtes2()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01989">MiResolveMappedFileFault()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00667">MiUnlinkPageFromList()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l02335">MiWaitForInPageComplete()</a>, <a class="el" href="../../d5/d0/mmfault_8c-source.html#l00041">MmAccessFault()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l01695">MmCleanProcessAddressSpace()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02005">MmFreeLoaderBlock()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03742">MmFreeSpecialPool()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l03445">MmInPageKernelStack()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06864">MmLockPagableDataSection()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l00063">MmMapViewInSystemCache()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l01548">MmPurgeSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01833">MmUnlockCachedPage()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01347">MmUnlockPages()</a>, <a class="el" href="../../d8/d0/zeropage_8c-source.html#l00029">MmZeroPageThread()</a>, <a class="el" href="../../d4/d0/iniaxp64_8c-source.html#l00046">MxGetNextPage()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02713">NtUserInitialize()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00525">PsLocateSystemDll()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00745">PspInitializeSystemDll()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01895">PspUnhandledExceptionInSystemThread()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02815">VerifierExAcquireFastMutex()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02841">VerifierExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02182">VerifierExAcquireResourceExclusive()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02870">VerifierExReleaseFastMutex()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02899">VerifierExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02208">VerifierExReleaseResource()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02789">VerifierExTryToAcquireFastMutex()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02406">VerifierKeReleaseSpinLock()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00662">VerifierMapIoSpace()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00688">VerifierMapLockedPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00751">VerifierMapLockedPagesSpecifyCache()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00537">VerifierProbeAndLockPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00563">VerifierProbeAndLockProcessPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00593">VerifierProbeAndLockSelectedPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02160">VerifierSetEvent()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00829">VerifierUnlockPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00906">VerifierUnmapIoSpace()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l00874">VerifierUnmapLockedPages()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01447">ViReleasePoolAllocation()</a>, <a class="el" href="../../d6/d6/halfnc_8c-source.html#l00884">xHalAssignSlotResources()</a>, and <a class="el" href="../../d6/d6/halfnc_8c-source.html#l00866">xHalTranslateBusAddress()</a>.
<p>
<pre class="fragment"><div>00438                    :
00439 
00440     This function crashes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system in a controlled manner.
00441 
00442 Arguments:
00443 
00444     BugCheckCode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check.
00445 
00446     BugCheckParameter1-4 - Supplies additional bug check information
00447 
00448 Return Value:
00449 
00450     None.
00451 
00452 --*/
00453 
00454 {
00455     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[100];
00456     ULONG_PTR BugCheckParameters[4];
00457     CONTEXT ContextSave;
00458     ULONG PssMessage;
00459     PCHAR HardErrorCaption;
00460     PCHAR HardErrorMessage;
00461     KIRQL OldIrql;
00462     PKTRAP_FRAME TrapInformation;
00463     PVOID ExecutionAddress;
00464     PVOID ImageBase;
00465     PVOID VirtualAddress;
00466     PLDR_DATA_TABLE_ENTRY DataTableEntry;
00467     UCHAR AnsiBuffer[32];
00468     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00469     BOOLEAN InKernelOrHal;
00470     BOOLEAN DontCare;
00471 
00472 <span class="preprocessor">#if !defined(NT_UP)</span>
00473 <span class="preprocessor"></span>
00474     ULONG TargetSet;
00475 
00476 <span class="preprocessor">#endif</span>
00477 <span class="preprocessor"></span>    BOOLEAN hardErrorCalled;
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">// Try to simulate a power failure for Cluster testing</span>
00481     <span class="comment">//</span>
00482 
00483     <span class="keywordflow">if</span> (BugCheckCode == <a class="code" href="../../d9/d1/bugcheck_8c.html#a1">POWER_FAILURE_SIMULATE</a>) {
00484         <a class="code" href="../../d9/d1/bugcheck_8c.html#a12">KiScanBugCheckCallbackList</a>();
00485         <a class="code" href="../../d2/d7/hal_8h.html#a177">HalReturnToFirmware</a>(HalRebootRoutine);
00486     }
00487 
00488     <span class="comment">//</span>
00489     <span class="comment">// Capture the callers context as closely as possible into the debugger's</span>
00490     <span class="comment">// processor state area of the Prcb.</span>
00491     <span class="comment">//</span>
00492     <span class="comment">// N.B. There may be some prologue code that shuffles registers such that</span>
00493     <span class="comment">//      they get destroyed.</span>
00494     <span class="comment">//</span>
00495 
00496 <span class="preprocessor">#if defined(i386)</span>
00497 <span class="preprocessor"></span>    KiSetHardwareTrigger();
00498 <span class="preprocessor">#else</span>
00499 <span class="preprocessor"></span>    <a class="code" href="../../d4/d4/alpha_2splocks_8c.html#a12">KiHardwareTrigger</a> = 1;
00500 <span class="preprocessor">#endif</span>
00501 <span class="preprocessor"></span>
00502     RtlCaptureContext(&amp;<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;ProcessorState.ContextFrame);
00503     <a class="code" href="../../d9/d6/ppc_2ipi_8c.html#a1">KiSaveProcessorControlState</a>(&amp;<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;ProcessorState);
00504 
00505     <span class="comment">//</span>
00506     <span class="comment">// This is necessary on machines where the virtual unwind that happens</span>
00507     <span class="comment">// during KeDumpMachineState() destroys the context record.</span>
00508     <span class="comment">//</span>
00509 
00510     ContextSave = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;ProcessorState.ContextFrame;
00511 
00512     <span class="comment">//</span>
00513     <span class="comment">// If we are called by hard error then we don't want to dump the</span>
00514     <span class="comment">// processor state on the machine.</span>
00515     <span class="comment">//</span>
00516     <span class="comment">// We know that we are called by hard error because the bug check</span>
00517     <span class="comment">// code will be FATAL_UNHANDLED_HARD_ERROR.  If this is so then the</span>
00518     <span class="comment">// error status passed to harderr is the first parameter, and a pointer</span>
00519     <span class="comment">// to the parameter array from hard error is passed as the second</span>
00520     <span class="comment">// argument.</span>
00521     <span class="comment">//</span>
00522     <span class="comment">// The third argument is the OemCaption to be printed.</span>
00523     <span class="comment">// The last argument is the OemMessage to be printed.</span>
00524     <span class="comment">//</span>
00525 
00526     <span class="keywordflow">if</span> (BugCheckCode == FATAL_UNHANDLED_HARD_ERROR) {
00527 
00528         PULONG_PTR parameterArray;
00529 
00530         hardErrorCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00531 
00532         HardErrorCaption = (PCHAR)BugCheckParameter3;
00533         HardErrorMessage = (PCHAR)BugCheckParameter4;
00534         parameterArray = (PULONG_PTR)BugCheckParameter2;
00535         BugCheckCode = (ULONG)BugCheckParameter1;
00536         BugCheckParameter1 = parameterArray[0];
00537         BugCheckParameter2 = parameterArray[1];
00538         BugCheckParameter3 = parameterArray[2];
00539         BugCheckParameter4 = parameterArray[3];
00540 
00541     } <span class="keywordflow">else</span> {
00542 
00543         hardErrorCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00544 
00545         <span class="keywordflow">switch</span> (BugCheckCode) {
00546 
00547             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a12">IRQL_NOT_LESS_OR_EQUAL</a>:
00548 
00549                 ExecutionAddress = (PVOID)BugCheckParameter4;
00550 
00551                 <span class="keywordflow">if</span> (ExecutionAddress &gt;= <a class="code" href="../../d9/d1/bugcheck_8c.html#a3">ExPoolCodeStart</a> &amp;&amp; ExecutionAddress &lt; <a class="code" href="../../d9/d1/bugcheck_8c.html#a4">ExPoolCodeEnd</a>) {
00552                     BugCheckCode = DRIVER_CORRUPTED_EXPOOL;
00553                 }
00554                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ExecutionAddress &gt;= <a class="code" href="../../d9/d1/bugcheck_8c.html#a5">MmPoolCodeStart</a> &amp;&amp; ExecutionAddress &lt; <a class="code" href="../../d9/d1/bugcheck_8c.html#a6">MmPoolCodeEnd</a>) {
00555                     BugCheckCode = DRIVER_CORRUPTED_MMPOOL;
00556                 }
00557                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ExecutionAddress &gt;= <a class="code" href="../../d9/d1/bugcheck_8c.html#a7">MmPteCodeStart</a> &amp;&amp; ExecutionAddress &lt; <a class="code" href="../../d9/d1/bugcheck_8c.html#a8">MmPteCodeEnd</a>) {
00558                     BugCheckCode = DRIVER_CORRUPTED_SYSPTES;
00559                 }
00560                 <span class="keywordflow">else</span> {
00561                     ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a> (ExecutionAddress,
00562                                                   &amp;DataTableEntry,
00563                                                   FALSE,
00564                                                   &amp;InKernelOrHal);
00565                     <span class="keywordflow">if</span> (InKernelOrHal == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00566 
00567                         <span class="comment">//</span>
00568                         <span class="comment">// The kernel faulted at raised IRQL.  Quite often this</span>
00569                         <span class="comment">// is a driver that has unloaded without deleting its</span>
00570                         <span class="comment">// lookaside lists or other resources.  Or its resources</span>
00571                         <span class="comment">// are marked pagable and shouldn't be.  Detect both</span>
00572                         <span class="comment">// cases here and identify the offending driver</span>
00573                         <span class="comment">// whenever possible.</span>
00574                         <span class="comment">//</span>
00575 
00576                         VirtualAddress = (PVOID)BugCheckParameter1;
00577 
00578                         ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a> (VirtualAddress,
00579                                                       &amp;DataTableEntry,
00580                                                       TRUE,
00581                                                       &amp;InKernelOrHal);
00582 
00583                         <span class="keywordflow">if</span> (ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00584                             <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = &amp;DataTableEntry-&gt;BaseDllName;
00585                             BugCheckCode = DRIVER_PORTION_MUST_BE_NONPAGED;
00586                         }
00587                         <span class="keywordflow">else</span> {
00588                             <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = <a class="code" href="../../d8/d8/sysload_8c.html#a58">MmLocateUnloadedDriver</a> (VirtualAddress);
00589                             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00590                                 BugCheckCode = SYSTEM_SCAN_AT_RAISED_IRQL_CAUGHT_IMPROPER_DRIVER_UNLOAD;
00591                             }
00592                         }
00593                     }
00594                     <span class="keywordflow">else</span> {
00595                         BugCheckCode = DRIVER_IRQL_NOT_LESS_OR_EQUAL;
00596                     }
00597                 }
00598                 <span class="keywordflow">break</span>;
00599 
00600             <span class="keywordflow">case</span> ATTEMPTED_WRITE_TO_READONLY_MEMORY:
00601 
00602                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00603                 TrapInformation = (PKTRAP_FRAME)BugCheckParameter3;
00604 
00605                 <span class="comment">//</span>
00606                 <span class="comment">// Extract the execution address from the trap frame to</span>
00607                 <span class="comment">// identify the component.</span>
00608                 <span class="comment">//</span>
00609 
00610                 <span class="keywordflow">if</span> (TrapInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00611                     ExecutionAddress = (PVOID)PROGRAM_COUNTER (TrapInformation);
00612                     ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a> (ExecutionAddress,
00613                                                   &amp;DataTableEntry,
00614                                                   TRUE,
00615                                                   &amp;InKernelOrHal);
00616 
00617                     <span class="keywordflow">if</span> (ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00618                         <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = &amp;DataTableEntry-&gt;BaseDllName;
00619                     }
00620                 }
00621 
00622                 <span class="keywordflow">break</span>;
00623 
00624             <span class="keywordflow">case</span> DRIVER_LEFT_LOCKED_PAGES_IN_PROCESS:
00625 
00626                 ExecutionAddress = (PVOID)BugCheckParameter1;
00627 
00628                 ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a> (ExecutionAddress,
00629                                               &amp;DataTableEntry,
00630                                               TRUE,
00631                                               &amp;InKernelOrHal);
00632 
00633                 <span class="keywordflow">if</span> (ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00634                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = &amp;DataTableEntry-&gt;BaseDllName;
00635                 }
00636                 <span class="keywordflow">else</span> {
00637                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = <a class="code" href="../../d8/d8/sysload_8c.html#a58">MmLocateUnloadedDriver</a> (ExecutionAddress);
00638                 }
00639 
00640                 BugCheckParameter4 = (ULONG_PTR)<a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a>;
00641 
00642                 <span class="keywordflow">break</span>;
00643 
00644             <span class="keywordflow">case</span> DRIVER_USED_EXCESSIVE_PTES:
00645 
00646                 DataTableEntry = (PLDR_DATA_TABLE_ENTRY)BugCheckParameter1;
00647                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = &amp;DataTableEntry-&gt;BaseDllName;
00648 
00649                 <span class="keywordflow">break</span>;
00650 
00651             <span class="keywordflow">case</span> PAGE_FAULT_IN_NONPAGED_AREA:
00652 
00653                 ExecutionAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00654                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00655 
00656                 VirtualAddress = (PVOID)BugCheckParameter1;
00657 
00658                 TrapInformation = (PKTRAP_FRAME)BugCheckParameter3;
00659 
00660                 <span class="comment">//</span>
00661                 <span class="comment">// Extract the execution address from the trap frame to</span>
00662                 <span class="comment">// identify the component.</span>
00663                 <span class="comment">//</span>
00664 
00665                 <span class="keywordflow">if</span> (TrapInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00666 
00667                     ExecutionAddress = (PVOID)PROGRAM_COUNTER (TrapInformation);
00668                     BugCheckParameter3 = (ULONG_PTR)ExecutionAddress;
00669 
00670                     <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a> (ExecutionAddress,
00671                                       &amp;DataTableEntry,
00672                                       FALSE,
00673                                       &amp;InKernelOrHal);
00674 
00675                     ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a> (ExecutionAddress,
00676                                                   &amp;DataTableEntry,
00677                                                   TRUE,
00678                                                   &amp;DontCare);
00679 
00680                     <span class="keywordflow">if</span> (ImageBase != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00681                         <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = &amp;DataTableEntry-&gt;BaseDllName;
00682                     }
00683                 }
00684                 <span class="keywordflow">else</span> {
00685 
00686                     <span class="comment">//</span>
00687                     <span class="comment">// No trap frame, so no execution address either.</span>
00688                     <span class="comment">//</span>
00689 
00690                     BugCheckParameter3 = 0;
00691                 }
00692 
00693                 Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00694 
00695                 <span class="keywordflow">if</span> ((VirtualAddress &gt;= <a class="code" href="../../d2/d1/mm_8h.html#a160">MmSpecialPoolStart</a>) &amp;&amp;
00696                     (VirtualAddress &lt; <a class="code" href="../../d2/d1/mm_8h.html#a161">MmSpecialPoolEnd</a>)) {
00697 
00698                     <span class="comment">//</span>
00699                     <span class="comment">// Update the bugcheck number so the administrator gets</span>
00700                     <span class="comment">// useful feedback that enabling special pool has enabled</span>
00701                     <span class="comment">// the system to locate the corruptor.</span>
00702                     <span class="comment">//</span>
00703 
00704                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6/allocpag_8c.html#a66">MmIsSpecialPoolAddressFree</a> (VirtualAddress) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00705                         <span class="keywordflow">if</span> (InKernelOrHal == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00706                             BugCheckCode = PAGE_FAULT_IN_FREED_SPECIAL_POOL;
00707                         }
00708                         <span class="keywordflow">else</span> {
00709                             BugCheckCode = DRIVER_PAGE_FAULT_IN_FREED_SPECIAL_POOL;
00710                         }
00711                     }
00712                     <span class="keywordflow">else</span> {
00713                         <span class="keywordflow">if</span> (InKernelOrHal == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00714                             BugCheckCode = PAGE_FAULT_BEYOND_END_OF_ALLOCATION;
00715                         }
00716                         <span class="keywordflow">else</span> {
00717                             BugCheckCode = DRIVER_PAGE_FAULT_BEYOND_END_OF_ALLOCATION;
00718                         }
00719                     }
00720                 }
00721                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ExecutionAddress == VirtualAddress) &amp;&amp;
00722                         (<a class="code" href="../../d1/d6/allocpag_8c.html#a65">MmIsHydraAddress</a> (VirtualAddress) == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) &amp;&amp;
00723                         ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o4">Teb</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>(Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o4">Teb</a>)))) {
00724                     <span class="comment">//</span>
00725                     <span class="comment">// This is a driver reference to session space from a</span>
00726                     <span class="comment">// worker thread.  Since the system process has no session</span>
00727                     <span class="comment">// space this is illegal and the driver must be fixed.</span>
00728                     <span class="comment">//</span>
00729 
00730                     BugCheckCode = TERMINAL_SERVER_DRIVER_MADE_INCORRECT_MEMORY_REFERENCE;
00731                 }
00732                 <span class="keywordflow">else</span> {
00733                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> = <a class="code" href="../../d8/d8/sysload_8c.html#a58">MmLocateUnloadedDriver</a> (VirtualAddress);
00734                     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00735                         BugCheckCode = DRIVER_UNLOADED_WITHOUT_CANCELLING_PENDING_OPERATIONS;
00736                     }
00737                 }
00738 
00739                 <span class="keywordflow">break</span>;
00740 
00741             <span class="keywordflow">default</span>:
00742                 <span class="keywordflow">break</span>;
00743         }
00744     }
00745 
00746     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00747         <a class="code" href="../../d9/d1/bugcheck_8c.html#a15">KeBugCheckUnicodeToAnsi</a> (KiBugCheckDriver,
00748                                  AnsiBuffer,
00749                                  <span class="keyword">sizeof</span> (AnsiBuffer));
00750     }
00751 
00752     <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a2">KiBugCheckData</a>[0] = BugCheckCode;
00753     <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a2">KiBugCheckData</a>[1] = BugCheckParameter1;
00754     <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a2">KiBugCheckData</a>[2] = BugCheckParameter2;
00755     <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a2">KiBugCheckData</a>[3] = BugCheckParameter3;
00756     <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a2">KiBugCheckData</a>[4] = BugCheckParameter4;
00757 
00758     BugCheckParameters[0] = BugCheckParameter1;
00759     BugCheckParameters[1] = BugCheckParameter2;
00760     BugCheckParameters[2] = BugCheckParameter3;
00761     BugCheckParameters[3] = BugCheckParameter4;
00762 
00763     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
00764         <a class="code" href="../../d8/d5/kddata_8c.html#a50">KdDebuggerDataBlock</a>.SavedContext = (ULONG_PTR) &amp;ContextSave;
00765     }
00766 
00767     <span class="comment">//</span>
00768     <span class="comment">// If the user manually crashed the machine, skips the DbgPrints and</span>
00769     <span class="comment">// go to the crashdump.</span>
00770     <span class="comment">// Trying to do DbgPrint causes us to reeeter the debugger which causes</span>
00771     <span class="comment">// some problems.</span>
00772     <span class="comment">//</span>
00773     <span class="comment">// Otherwise, if the debugger is enabled, print out the information and</span>
00774     <span class="comment">// stop.</span>
00775     <span class="comment">//</span>
00776 
00777     <span class="keywordflow">if</span> ((BugCheckCode != MANUALLY_INITIATED_CRASH) &amp;&amp;
00778         (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a>)) {
00779 
00780         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n*** Fatal System Error: 0x%08lx\n"</span>
00781                  <span class="stringliteral">"                       (0x%p,0x%p,0x%p,0x%p)\n\n"</span>,
00782                  BugCheckCode,
00783                  BugCheckParameter1,
00784                  BugCheckParameter2,
00785                  BugCheckParameter3,
00786                  BugCheckParameter4);
00787 
00788         <span class="comment">//</span>
00789         <span class="comment">// If the debugger is not actually connected, or the user manually</span>
00790         <span class="comment">// crashed the machine by typing .crash in the debugger, proceed to</span>
00791         <span class="comment">// "blue screen" the system.</span>
00792         <span class="comment">//</span>
00793         <span class="comment">// The call to DbgPrint above will have set the state of</span>
00794         <span class="comment">// KdDebuggerNotPresent if the debugger has become disconnected</span>
00795         <span class="comment">// since the system was booted.</span>
00796         <span class="comment">//</span>
00797 
00798         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a12">KdDebuggerNotPresent</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00799 
00800             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00801                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"The %s driver may be at fault.\n"</span>, AnsiBuffer);
00802             }
00803 
00804             <span class="keywordflow">if</span> (hardErrorCalled != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00805                 <span class="keywordflow">if</span> (HardErrorCaption) {
00806                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(HardErrorCaption);
00807                 }
00808                 <span class="keywordflow">if</span> (HardErrorMessage) {
00809                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(HardErrorMessage);
00810                 }
00811             }
00812 
00813             <a class="code" href="../../d9/d1/bugcheck_8c.html#a16">KiBugCheckDebugBreak</a> (DBG_STATUS_BUGCHECK_FIRST);
00814         }
00815     }
00816 
00817     <span class="comment">//</span>
00818     <span class="comment">// Freeze execution of the system by disabling interrupts and looping.</span>
00819     <span class="comment">//</span>
00820 
00821     <a class="code" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a>();
00822     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
00823 
00824     <span class="comment">//</span>
00825     <span class="comment">// Don't attempt to display message more than once.</span>
00826     <span class="comment">//</span>
00827 
00828     <span class="keywordflow">if</span> (InterlockedDecrement (&amp;KeBugCheckCount) == 0) {
00829 
00830 <span class="preprocessor">#if !defined(NT_UP)</span>
00831 <span class="preprocessor"></span>
00832         <span class="comment">//</span>
00833         <span class="comment">// Attempt to get the other processors frozen now, but don't wait</span>
00834         <span class="comment">// for them to freeze (in case someone is stuck).</span>
00835         <span class="comment">//</span>
00836 
00837         TargetSet = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; ~<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;SetMember;
00838         <span class="keywordflow">if</span> (TargetSet != 0) {
00839             <a class="code" href="../../d0/d0/ki_8h.html#a90">KiIpiSend</a>((KAFFINITY) TargetSet, IPI_FREEZE);
00840 
00841             <span class="comment">//</span>
00842             <span class="comment">// Give the other processors one second to flush their data caches.</span>
00843             <span class="comment">//</span>
00844             <span class="comment">// N.B. This cannot be synchronized since the reason for the bug</span>
00845             <span class="comment">//      may be one of the other processors failed.</span>
00846             <span class="comment">//</span>
00847 
00848             <a class="code" href="../../d2/d7/hal_8h.html#a206">KeStallExecutionProcessor</a>(1000 * 1000);
00849         }
00850 
00851 <span class="preprocessor">#endif</span>
00852 <span class="preprocessor"></span>
00853         <span class="comment">//</span>
00854         <span class="comment">// Enable InbvDisplayString calls to make it through to bootvid driver.</span>
00855         <span class="comment">//</span>
00856 
00857         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1/inbv_8h.html#a18">InbvIsBootDriverInstalled</a>()) {
00858 
00859             <a class="code" href="../../d0/d1/inbv_8h.html#a4">InbvAcquireDisplayOwnership</a>();
00860 
00861             <a class="code" href="../../d0/d1/inbv_8h.html#a6">InbvResetDisplay</a>();
00862             <a class="code" href="../../d0/d1/inbv_8h.html#a8">InbvSolidColorFill</a>(0,0,639,479,4); <span class="comment">// make the screen blue</span>
00863             <a class="code" href="../../d0/d1/inbv_8h.html#a27">InbvSetTextColor</a>(15);
00864             <a class="code" href="../../d0/d1/inbv_8h.html#a3">InbvInstallDisplayStringFilter</a>((<a class="code" href="../../d0/d1/inbv_8h.html#a1">INBV_DISPLAY_STRING_FILTER</a>)NULL);
00865             <a class="code" href="../../d0/d1/inbv_8h.html#a17">InbvEnableDisplayString</a>(TRUE);     <span class="comment">// enable display string</span>
00866             <a class="code" href="../../d0/d1/inbv_8h.html#a26">InbvSetScrollRegion</a>(0,0,639,479);  <span class="comment">// set to use entire screen</span>
00867         }
00868 
00869         <span class="keywordflow">if</span> (!hardErrorCalled) {
00870             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((<span class="keywordtype">char</span> *)Buffer,
00871                     <span class="stringliteral">"\n*** STOP: 0x%08lX (0x%p,0x%p,0x%p,0x%p)\n"</span>,
00872                     BugCheckCode,
00873                     BugCheckParameter1,
00874                     BugCheckParameter2,
00875                     BugCheckParameter3,
00876                     BugCheckParameter4
00877                     );
00878             <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>((<span class="keywordtype">char</span> *)Buffer);
00879 
00880             <a class="code" href="../../d9/d1/bugcheck_8c.html#a14">KeGetBugMessageText</a>(BugCheckCode, NULL);
00881             <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(<span class="stringliteral">"\n"</span>);
00882 
00883             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00884 
00885                 <span class="comment">//</span>
00886                 <span class="comment">// Output the driver name.</span>
00887                 <span class="comment">//</span>
00888 
00889                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a14">KeGetBugMessageText</a>(BUGCODE_ID_DRIVER, NULL);
00890                 <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(AnsiBuffer);
00891                 <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(<span class="stringliteral">"\n"</span>);
00892             }
00893 
00894         } <span class="keywordflow">else</span> {
00895             <span class="keywordflow">if</span> (HardErrorCaption) {
00896                 <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(HardErrorCaption);
00897             }
00898             <span class="keywordflow">if</span> (HardErrorMessage) {
00899                 <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(HardErrorMessage);
00900             }
00901         }
00902 
00903         <span class="comment">//</span>
00904         <span class="comment">// Process the bug check callback list.</span>
00905         <span class="comment">//</span>
00906 
00907         <a class="code" href="../../d9/d1/bugcheck_8c.html#a12">KiScanBugCheckCallbackList</a>();
00908 
00909         <span class="comment">//</span>
00910         <span class="comment">// If the debugger is not enabled, then dump the machine state and</span>
00911         <span class="comment">// attempt to enable the debugger.</span>
00912         <span class="comment">//</span>
00913 
00914         <span class="keywordflow">if</span> (!hardErrorCalled) {
00915 
00916             <a class="code" href="../../d9/d1/bugcheck_8c.html#a18">KiDumpParameterImages</a>(
00917                 (<span class="keywordtype">char</span> *)Buffer,
00918                 BugCheckParameters,
00919                 4,
00920                 KeBugCheckUnicodeToAnsi);
00921 
00922         }
00923 
00924         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> &amp;&amp; <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
00925             <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a4">KdInitSystem</a>(NULL, FALSE);
00926 
00927         } <span class="keywordflow">else</span> {
00928             <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(<span class="stringliteral">"\n"</span>);
00929         }
00930 
00931         <span class="comment">//</span>
00932         <span class="comment">// Write a crash dump and optionally reboot if the system has been</span>
00933         <span class="comment">// so configured.</span>
00934         <span class="comment">//</span>
00935 
00936         <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;ProcessorState.ContextFrame = ContextSave;
00937 
00938         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d3/dumpctl_8c.html#a43">IoWriteCrashDump</a>(BugCheckCode,
00939                               BugCheckParameter1,
00940                               BugCheckParameter2,
00941                               BugCheckParameter3,
00942                               BugCheckParameter4,
00943                               &amp;ContextSave
00944                               )) {
00945             <span class="comment">//</span>
00946             <span class="comment">// If no crashdump take, display the PSS message.</span>
00947             <span class="comment">//</span>
00948 
00949             <span class="keywordflow">switch</span> ( BugCheckCode ) {
00950 
00951                 <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a12">IRQL_NOT_LESS_OR_EQUAL</a>:
00952                 <span class="keywordflow">case</span> DRIVER_IRQL_NOT_LESS_OR_EQUAL:
00953                 <span class="keywordflow">case</span> DRIVER_CORRUPTED_EXPOOL:
00954                 <span class="keywordflow">case</span> DRIVER_CORRUPTED_MMPOOL:
00955                 <span class="keywordflow">case</span> DRIVER_PORTION_MUST_BE_NONPAGED:
00956                 <span class="keywordflow">case</span> SYSTEM_SCAN_AT_RAISED_IRQL_CAUGHT_IMPROPER_DRIVER_UNLOAD:
00957                     PssMessage = BUGCODE_PSS_MESSAGE_A;
00958                     <span class="keywordflow">break</span>;
00959 
00960                 <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a13">KMODE_EXCEPTION_NOT_HANDLED</a>:
00961                     PssMessage = BUGCODE_PSS_MESSAGE_1E;
00962                     <span class="keywordflow">break</span>;
00963 
00964                 <span class="keywordflow">case</span> FAT_FILE_SYSTEM:
00965                 <span class="keywordflow">case</span> NTFS_FILE_SYSTEM:
00966                     PssMessage = BUGCODE_PSS_MESSAGE_23;
00967                     <span class="keywordflow">break</span>;
00968 
00969                 <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a2">DATA_BUS_ERROR</a>:
00970                     PssMessage = BUGCODE_PSS_MESSAGE_2E;
00971                     <span class="keywordflow">break</span>;
00972 
00973                 <span class="keywordflow">case</span> NO_MORE_SYSTEM_PTES:
00974                     PssMessage = BUGCODE_PSS_MESSAGE_3F;
00975                     <span class="keywordflow">break</span>;
00976 
00977                 <span class="keywordflow">case</span> INACCESSIBLE_BOOT_DEVICE:
00978                     PssMessage = BUGCODE_PSS_MESSAGE_7B;
00979                     <span class="keywordflow">break</span>;
00980 
00981                 <span class="keywordflow">case</span> <a class="code" href="../../d6/d7/halmips_8h.html#a23">UNEXPECTED_KERNEL_MODE_TRAP</a>:
00982                     PssMessage = BUGCODE_PSS_MESSAGE_7F;
00983                     <span class="keywordflow">break</span>;
00984 
00985                 <span class="keywordflow">case</span> STATUS_SYSTEM_IMAGE_BAD_SIGNATURE:
00986                     PssMessage = BUGCODE_PSS_MESSAGE_SIGNATURE;
00987                     <span class="keywordflow">break</span>;
00988 
00989                 <span class="keywordflow">case</span> ACPI_BIOS_ERROR:
00990                     PssMessage = BUGCODE_PSS_MESSAGE_A5;
00991                     <span class="keywordflow">break</span>;
00992 
00993                 <span class="keywordflow">case</span> ACPI_BIOS_FATAL_ERROR:
00994                     PssMessage = ACPI_BIOS_FATAL_ERROR;
00995                     <span class="keywordflow">break</span>;
00996 
00997                 <span class="keywordflow">default</span>:
00998                     PssMessage = BUGCODE_PSS_MESSAGE;
00999                     <span class="keywordflow">break</span>;
01000                 }
01001 
01002             <a class="code" href="../../d9/d1/bugcheck_8c.html#a14">KeGetBugMessageText</a>(PssMessage, NULL);
01003         }
01004     }
01005 
01006     <span class="comment">//</span>
01007     <span class="comment">// Attempt to enter the kernel debugger.</span>
01008     <span class="comment">//</span>
01009 
01010     <a class="code" href="../../d9/d1/bugcheck_8c.html#a16">KiBugCheckDebugBreak</a> (DBG_STATUS_BUGCHECK_SECOND);
01011     <span class="keywordflow">return</span>;
01012 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="bugcheck.c::KeBugCheckUnicodeToAnsi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCHAR KeBugCheckUnicodeToAnsi           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>AnsiBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MaxAnsiLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00160">160</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ioassert_8c-source.html#l01016">IopDriverCorrectnessPrintBuffer()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00599">IopDriverCorrectnessProcessParams()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00960">IopDriverCorrectnessThrowBugCheck()</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>00165 {
00166     PCHAR Dst;
00167     PWSTR Src;
00168     ULONG Length;
00169 
00170     Length = UnicodeString-&gt;Length / <span class="keyword">sizeof</span>( WCHAR );
00171     <span class="keywordflow">if</span> (Length &gt;= MaxAnsiLength) {
00172         Length = MaxAnsiLength - 1;
00173         }
00174     Src = UnicodeString-&gt;Buffer;
00175     Dst = AnsiBuffer;
00176     <span class="keywordflow">while</span> (Length--) {
00177         *Dst++ = (UCHAR)*Src++;
00178         }
00179     *Dst = <span class="charliteral">'\0'</span>;
00180     <span class="keywordflow">return</span> AnsiBuffer;
00181 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="bugcheck.c::KeDeregisterBugCheckCallback" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN KeDeregisterBugCheckCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">PKBUGCHECK_CALLBACK_RECORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CallbackRecord</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01064">1064</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a410a236">BufferEmpty</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a237">BufferInserted</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02771">KeBugCheckCallbackLock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a115">PKBUGCHECK_CALLBACK_RECORD</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01070                    :
01071 
01072     This function deregisters a bug check callback record.
01073 
01074 Arguments:
01075 
01076     CallbackRecord - Supplies a pointer to a bug check callback record.
01077 
01078 Return Value:
01079 
01080     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified bug check callback record <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully deregistered,
01081     then a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01082 
01083 --*/
01084 
01085 {
01086 
01087     BOOLEAN Deregister;
01088     KIRQL OldIrql;
01089 
01090     <span class="comment">//</span>
01091     <span class="comment">// Raise IRQL to HIGH_LEVEL and acquire the bug check callback list</span>
01092     <span class="comment">// spinlock.</span>
01093     <span class="comment">//</span>
01094 
01095     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
01096     KiAcquireSpinLock(&amp;KeBugCheckCallbackLock);
01097 
01098     <span class="comment">//</span>
01099     <span class="comment">// If the specified callback record is currently registered, then</span>
01100     <span class="comment">// deregister the callback record.</span>
01101     <span class="comment">//</span>
01102 
01103     Deregister = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01104     <span class="keywordflow">if</span> (CallbackRecord-&gt;State == <a class="code" href="../../d4/d9/ke_8h.html#a410a237">BufferInserted</a>) {
01105         CallbackRecord-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a410a236">BufferEmpty</a>;
01106         RemoveEntryList(&amp;CallbackRecord-&gt;Entry);
01107         Deregister = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01108     }
01109 
01110     <span class="comment">//</span>
01111     <span class="comment">// Release the bug check callback spinlock, lower IRQL to its previous</span>
01112     <span class="comment">// value, and return whether the callback record was successfully</span>
01113     <span class="comment">// deregistered.</span>
01114     <span class="comment">//</span>
01115 
01116     KiReleaseSpinLock(&amp;KeBugCheckCallbackLock);
01117     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
01118     <span class="keywordflow">return</span> Deregister;
01119 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="bugcheck.c::KeEnterKernelDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeEnterKernelDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">1015</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00072">KdInitSystem()</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00024">KeBugCheckCount</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00184">KiBugCheckDebugBreak()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts()</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00064">KiHardwareTrigger</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>01021                    :
01022 
01023     This function crashes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system in a controlled manner attempting
01024     to invoke <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel debugger.
01025 
01026 Arguments:
01027 
01028     None.
01029 
01030 Return Value:
01031 
01032     None.
01033 
01034 --*/
01035 
01036 {
01037 
01038 <span class="preprocessor">#if !defined(i386)</span>
01039 <span class="preprocessor"></span>    KIRQL OldIrql;
01040 <span class="preprocessor">#endif</span>
01041 <span class="preprocessor"></span>
01042     <span class="comment">//</span>
01043     <span class="comment">// Freeze execution of the system by disabling interrupts and looping.</span>
01044     <span class="comment">//</span>
01045 
01046     <a class="code" href="../../d4/d4/alpha_2splocks_8c.html#a12">KiHardwareTrigger</a> = 1;
01047     <a class="code" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a>();
01048 <span class="preprocessor">#if !defined(i386)</span>
01049 <span class="preprocessor"></span>    <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
01050 <span class="preprocessor">#endif</span>
01051 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (InterlockedDecrement (&amp;KeBugCheckCount) == 0) {
01052         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01053             <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
01054                 <a class="code" href="../../d5/d6/4_2kdinit_8c.html#a4">KdInitSystem</a>(NULL, FALSE);
01055             }
01056         }
01057     }
01058 
01059     <a class="code" href="../../d9/d1/bugcheck_8c.html#a16">KiBugCheckDebugBreak</a> (DBG_STATUS_FATAL);
01060 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="bugcheck.c::KeGetBugMessageText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KeGetBugMessageText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MessageId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PANSI_STRING ReturnedString&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00097">97</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06495">MmMakeKernelResourceSectionWritable()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l00384">IopGetDumpStack()</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>00101 {
00102     ULONG   i;
00103     PUCHAR  s;
00104     PMESSAGE_RESOURCE_BLOCK MessageBlock;
00105     PUCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00106     BOOLEAN Result;
00107 
00108     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00109     <span class="keywordflow">try</span> {
00110         <span class="keywordflow">if</span> (KiBugCodeMessages != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00111             <a class="code" href="../../d8/d8/sysload_8c.html#a65">MmMakeKernelResourceSectionWritable</a> ();
00112             MessageBlock = &amp;KiBugCodeMessages-&gt;Blocks[0];
00113             <span class="keywordflow">for</span> (i = KiBugCodeMessages-&gt;NumberOfBlocks; i; i -= 1) {
00114                 <span class="keywordflow">if</span> (MessageId &gt;= MessageBlock-&gt;LowId &amp;&amp;
00115                     MessageId &lt;= MessageBlock-&gt;HighId) {
00116 
00117                     s = (PCHAR)KiBugCodeMessages + MessageBlock-&gt;OffsetToEntries;
00118                     <span class="keywordflow">for</span> (i = MessageId - MessageBlock-&gt;LowId; i; i -= 1) {
00119                         s += ((PMESSAGE_RESOURCE_ENTRY)s)-&gt;Length;
00120                     }
00121 
00122                     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = ((PMESSAGE_RESOURCE_ENTRY)s)-&gt;Text;
00123 
00124                     i = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Buffer) - 1;
00125                     <span class="keywordflow">while</span> (i &gt; 0 &amp;&amp; (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[i] == <span class="charliteral">'\n'</span>  ||
00126                                      <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[i] == <span class="charliteral">'\r'</span>  ||
00127                                      <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[i] == 0
00128                                     )
00129                           ) {
00130                         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( ReturnedString )) {
00131                             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[i] = 0;
00132                         }
00133                         i -= 1;
00134                     }
00135 
00136                     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( ReturnedString )) {
00137                         <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(Buffer);
00138                         }
00139                     <span class="keywordflow">else</span> {
00140                         ReturnedString-&gt;Buffer = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00141                         ReturnedString-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(i+1);
00142                         ReturnedString-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(i+1);
00143                     }
00144                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00145                     <span class="keywordflow">break</span>;
00146                 }
00147                 MessageBlock += 1;
00148             }
00149         }
00150     } except ( EXCEPTION_EXECUTE_HANDLER ) {
00151         ;
00152     }
00153 
00154     <span class="keywordflow">return</span> Result;
00155 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="bugcheck.c::KeRegisterBugCheckCallback" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN KeRegisterBugCheckCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">PKBUGCHECK_CALLBACK_RECORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CallbackRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a113">PKBUGCHECK_CALLBACK_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CallbackRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Component</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01123">1123</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a236">BufferEmpty</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a237">BufferInserted</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02770">KeBugCheckCallbackListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02771">KeBugCheckCallbackLock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02149">PKBUGCHECK_CALLBACK_ROUTINE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01133                    :
01134 
01135     This function registers a bug check callback record. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system
01136     crashes, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified function will be called during bug check
01137     processing so <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> may dump additional state in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified bug check
01138     buffer.
01139 
01140     N.B. Bug check callback <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> are called in reverse order of
01141          registration, i.e., in LIFO order.
01142 
01143 Arguments:
01144 
01145     CallbackRecord - Supplies a pointer to a callback record.
01146 
01147     CallbackRoutine - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callback routine.
01148 
01149     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check buffer.
01150 
01151     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check buffer in bytes.
01152 
01153     Component - Supplies a pointer to a zero terminated component
01154         identifier.
01155 
01156 Return Value:
01157 
01158     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified bug check callback record <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully registered,
01159     then a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01160 
01161 --*/
01162 
01163 {
01164 
01165     BOOLEAN Inserted;
01166     KIRQL OldIrql;
01167 
01168     <span class="comment">//</span>
01169     <span class="comment">// Raise IRQL to HIGH_LEVEL and acquire the bug check callback list</span>
01170     <span class="comment">// spinlock.</span>
01171     <span class="comment">//</span>
01172 
01173     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
01174     KiAcquireSpinLock(&amp;KeBugCheckCallbackLock);
01175 
01176     <span class="comment">//</span>
01177     <span class="comment">// If the specified callback record is currently not registered, then</span>
01178     <span class="comment">// register the callback record.</span>
01179     <span class="comment">//</span>
01180 
01181     Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01182     <span class="keywordflow">if</span> (CallbackRecord-&gt;State == <a class="code" href="../../d4/d9/ke_8h.html#a410a236">BufferEmpty</a>) {
01183         CallbackRecord-&gt;CallbackRoutine = CallbackRoutine;
01184         CallbackRecord-&gt;Buffer = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01185         CallbackRecord-&gt;Length = Length;
01186         CallbackRecord-&gt;Component = Component;
01187         CallbackRecord-&gt;Checksum =
01188             ((ULONG_PTR)CallbackRoutine + (ULONG_PTR)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> + Length + (ULONG_PTR)Component);
01189 
01190         CallbackRecord-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a410a237">BufferInserted</a>;
01191         InsertHeadList(&amp;KeBugCheckCallbackListHead, &amp;CallbackRecord-&gt;Entry);
01192         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01193     }
01194 
01195     <span class="comment">//</span>
01196     <span class="comment">// Release the bug check callback spinlock, lower IRQL to its previous</span>
01197     <span class="comment">// value, and return whether the callback record was successfully</span>
01198     <span class="comment">// registered.</span>
01199     <span class="comment">//</span>
01200 
01201     KiReleaseSpinLock(&amp;KeBugCheckCallbackLock);
01202     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
01203     <span class="keywordflow">return</span> Inserted;
01204 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="bugcheck.c::KiBugCheckDebugBreak" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiBugCheckDebugBreak           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>BreakStatus</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00184">184</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, and <a class="el" href="../../d3/d6/hal_8h-source.html#l01606">HalHaltSystem</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>.
<p>
<pre class="fragment"><div>00187 {
00188     <span class="keywordflow">do</span> {
00189         <span class="keywordflow">try</span> {
00190 
00191             <span class="comment">//</span>
00192             <span class="comment">// Issue a breakpoint</span>
00193             <span class="comment">//</span>
00194 
00195             DbgBreakPointWithStatus (BreakStatus);
00196 
00197         } except(EXCEPTION_EXECUTE_HANDLER) {
00198 
00199             <span class="comment">//</span>
00200             <span class="comment">// Failure to issue breakpoint, halt the system</span>
00201             <span class="comment">//</span>
00202 
00203             <span class="keywordflow">try</span> {
00204 
00205                 <a class="code" href="../../d2/d7/hal_8h.html#a43">HalHaltSystem</a>();
00206 
00207             } except(EXCEPTION_EXECUTE_HANDLER) {
00208 
00209                 <span class="keywordflow">for</span> (;;) {
00210                 }
00211             }
00212 
00213             <span class="keywordflow">for</span> (;;) {
00214             }
00215         }
00216     } <span class="keywordflow">while</span> (BreakStatus != DBG_STATUS_BUGCHECK_FIRST);
00217 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="bugcheck.c::KiDumpParameterImages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDumpParameterImages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>BugCheckParameters</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfParameters</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a116">PKE_BUGCHECK_UNICODE_TO_ANSI</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeToAnsiRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00317">317</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00350">FirstPrint</a>, <a class="el" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString()</a>, <a class="el" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader()</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00028">MmDbgReadCheck()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02836">MmLocateUnloadedDriver()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02216">PKE_BUGCHECK_UNICODE_TO_ANSI</a>, <a class="el" href="../../d9/d8/imagedir_8c-source.html#l00029">RtlImageNtHeader()</a>, <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>00326                    :
00327 
00328     This function formats and displays <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image names of boogcheck parameters
00329     that happen to match an address in an image.
00330 
00331 Arguments:
00332 
00333     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to a buffer to be used to output machine
00334         state information.
00335 
00336     BugCheckParameters - Supplies additional bugcheck information.
00337 
00338     NumberOfParameters - <span class="keyword">sizeof</span> BugCheckParameters array.
00339 
00340     UnicodeToAnsiRoutine - Supplies a pointer to a routine to convert <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>
00341         strings to Ansi strings without touching paged <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> tables.
00342 
00343 Return Value:
00344 
00345     None.
00346 
00347 --*/
00348 
00349 {
00350     PUNICODE_STRING BugCheckDriver;
00351     PLIST_ENTRY ModuleListHead;
00352     PLIST_ENTRY Next;
00353     ULONG i;
00354     PLDR_DATA_TABLE_ENTRY DataTableEntry;
00355     PVOID ImageBase;
00356     UCHAR AnsiBuffer[ 32 ];
00357     ULONG DateStamp;
00358     PIMAGE_NT_HEADERS NtHeaders;
00359     BOOLEAN <a class="code" href="../../d2/d2/ex_2pool_8c.html#a41">FirstPrint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00360     BOOLEAN InKernelOrHal;
00361 
00362     <span class="comment">//</span>
00363     <span class="comment">// At this point the context record contains the machine state at the</span>
00364     <span class="comment">// call to bug check.</span>
00365     <span class="comment">//</span>
00366     <span class="comment">// Put out the system version and the title line with the PSR and FSR.</span>
00367     <span class="comment">//</span>
00368 
00369     <span class="comment">//</span>
00370     <span class="comment">// Check to see if any BugCheckParameters are valid code addresses.</span>
00371     <span class="comment">// If so, print them for the user.</span>
00372     <span class="comment">//</span>
00373 
00374     <span class="keywordflow">for</span> (i = 0; i &lt; NumberOfParameters; i += 1) {
00375         ImageBase = <a class="code" href="../../d8/d0/ppc_2dmpstate_8c.html#a4">KiPcToFileHeader</a>((PVOID) BugCheckParameters[i],
00376                                      &amp;DataTableEntry,
00377                                      FALSE,
00378                                      &amp;InKernelOrHal);
00379         <span class="keywordflow">if</span> (ImageBase == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00380             BugCheckDriver = <a class="code" href="../../d8/d8/sysload_8c.html#a58">MmLocateUnloadedDriver</a> ((PVOID)BugCheckParameters[i]);
00381             <span class="keywordflow">if</span> (BugCheckDriver == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00382                 <span class="keywordflow">continue</span>;
00383             }
00384             ImageBase = (PVOID)BugCheckParameters[i];
00385             DateStamp = 0;
00386             (*UnicodeToAnsiRoutine) (BugCheckDriver,
00387                                      AnsiBuffer,
00388                                      <span class="keyword">sizeof</span> (AnsiBuffer));
00389         }
00390         <span class="keywordflow">else</span> {
00391             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(DataTableEntry-&gt;DllBase) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00392 
00393                 NtHeaders = <a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(DataTableEntry-&gt;DllBase);
00394                 DateStamp = NtHeaders-&gt;FileHeader.TimeDateStamp;
00395 
00396             } <span class="keywordflow">else</span> {
00397                 DateStamp = 0;
00398             }
00399             (*UnicodeToAnsiRoutine)( &amp;DataTableEntry-&gt;BaseDllName,
00400                                      AnsiBuffer,
00401                                      <span class="keyword">sizeof</span>( AnsiBuffer ));
00402         }
00403 
00404         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a> (Buffer, <span class="stringliteral">"%s** Address %p base at %p, DateStamp %08lx - %-12.12s\n"</span>,
00405             FirstPrint ? <span class="stringliteral">"\n*"</span>:<span class="stringliteral">"*"</span>,
00406                 BugCheckParameters[i],
00407                 ImageBase,
00408                 DateStamp,
00409                 AnsiBuffer);
00410 
00411         <a class="code" href="../../d0/d1/inbv_8h.html#a9">InbvDisplayString</a>(Buffer);
00412         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a41">FirstPrint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00413     }
00414 
00415     <span class="keywordflow">return</span>;
00416 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="bugcheck.c::KiPcToFileHeader" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID KiPcToFileHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>PcValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLDR_DATA_TABLE_ENTRY *&nbsp;</td>
          <td class="mdname" nowrap> <em>DataTableEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>DriversOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>InKernelOrHal</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00220">220</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02773">KeLoaderBlock</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01844">_LOADER_PARAMETER_BLOCK::LoadOrderListHead</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00028">MmDbgReadCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00582">PsLoadedModuleList</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00229                    :
00230 
00231     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of an image that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00232     specified PcValue. An image contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue
00233     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ImageBase, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ImageBase plus <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00234     <span class="keyword">virtual</span> image.
00235 
00236 Arguments:
00237 
00238     PcValue - Supplies a PcValue.
00239 
00240     DataTableEntry - Supplies a pointer to a variable that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00241         address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data table entry that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image.
00242 
00243     DriversOnly - Supplies <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel and <a class="code" href="../../d0/d2/genxx_8h.html#a21">HAL</a> should be skipped.
00244 
00245     InKernelOrHal - Set to <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d2/genxx_8h.html#a21">HAL</a>.
00246         This <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> has meaning <span class="keywordflow">if</span> DriversOnly <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00247 
00248 Return Value:
00249 
00250     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - No image was found that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PcValue.
00251 
00252     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00253         PcValue.
00254 
00255 --*/
00256 
00257 {
00258     ULONG i;
00259     PLIST_ENTRY ModuleListHead;
00260     PLDR_DATA_TABLE_ENTRY Entry;
00261     PLIST_ENTRY Next;
00262     ULONG_PTR Bounds;
00263     PVOID ReturnBase, Base;
00264 
00265     <span class="comment">//</span>
00266     <span class="comment">// If the module list has been initialized, then scan the list to</span>
00267     <span class="comment">// locate the appropriate entry.</span>
00268     <span class="comment">//</span>
00269 
00270     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00271         ModuleListHead = &amp;<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o0">LoadOrderListHead</a>;
00272 
00273     } <span class="keywordflow">else</span> {
00274         ModuleListHead = &amp;<a class="code" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a>;
00275     }
00276 
00277     *InKernelOrHal = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00278 
00279     ReturnBase = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00280     Next = ModuleListHead-&gt;Flink;
00281     <span class="keywordflow">if</span> (Next != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00282         i = 0;
00283         <span class="keywordflow">while</span> (Next != ModuleListHead) {
00284             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(Next) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00285                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00286             }
00287             i += 1;
00288             <span class="keywordflow">if</span> ((i &lt;= 2) &amp;&amp; (DriversOnly == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
00289                 Next = Next-&gt;Flink;
00290                 <span class="keywordflow">continue</span>;
00291             }
00292 
00293             Entry = CONTAINING_RECORD(Next,
00294                                       LDR_DATA_TABLE_ENTRY,
00295                                       InLoadOrderLinks);
00296 
00297             Next = Next-&gt;Flink;
00298             Base = Entry-&gt;DllBase;
00299             Bounds = (ULONG_PTR)Base + Entry-&gt;SizeOfImage;
00300             <span class="keywordflow">if</span> ((ULONG_PTR)PcValue &gt;= (ULONG_PTR)Base &amp;&amp; (ULONG_PTR)PcValue &lt; Bounds) {
00301                 *DataTableEntry = Entry;
00302                 ReturnBase = Base;
00303                 <span class="keywordflow">if</span> (i &lt;= 2) {
00304                     *InKernelOrHal = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305                 }
00306                 <span class="keywordflow">break</span>;
00307             }
00308         }
00309     }
00310 
00311     <span class="keywordflow">return</span> ReturnBase;
00312 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="bugcheck.c::KiScanBugCheckCallbackList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiScanBugCheckCallbackList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01207">1207</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l02157">_KBUGCHECK_CALLBACK_RECORD::Buffer</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a239">BufferFinished</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a240">BufferIncomplete</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a237">BufferInserted</a>, <a class="el" href="../../d4/d9/ke_8h.html#a410a238">BufferStarted</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02156">_KBUGCHECK_CALLBACK_RECORD::CallbackRoutine</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02160">_KBUGCHECK_CALLBACK_RECORD::Checksum</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02159">_KBUGCHECK_CALLBACK_RECORD::Component</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02155">_KBUGCHECK_CALLBACK_RECORD::Entry</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d4/d9/ke_8h.html#a114">KBUGCHECK_CALLBACK_RECORD</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02770">KeBugCheckCallbackListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02158">_KBUGCHECK_CALLBACK_RECORD::Length</a>, <a class="el" href="../../d5/d5/ppc_2debugsup_8c-source.html#l00028">MmDbgReadCheck()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02161">_KBUGCHECK_CALLBACK_RECORD::State</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.
<p>
<pre class="fragment"><div>01213                    :
01214 
01215     This function scans <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check callback list and calls each bug
01216     check callback routine so <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> can dump component specific information
01217     that may identify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cause of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check.
01218 
01219     N.B. The scan of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bug check callback list <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed VERY
01220         carefully. Bug check callback <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> are called at <a class="code" href="../../d6/d7/halmips_8h.html#a57">HIGH_LEVEL</a>
01221         and may not acquire ANY resources.
01222 
01223 Arguments:
01224 
01225     None.
01226 
01227 Return Value:
01228 
01229     None.
01230 
01231 --*/
01232 
01233 {
01234 
01235     <a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">PKBUGCHECK_CALLBACK_RECORD</a> CallbackRecord;
01236     ULONG_PTR Checksum;
01237     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01238     PLIST_ENTRY LastEntry;
01239     PLIST_ENTRY ListHead;
01240     PLIST_ENTRY NextEntry;
01241     PUCHAR Source;
01242 
01243     <span class="comment">//</span>
01244     <span class="comment">// If the bug check callback listhead is not initialized, then the</span>
01245     <span class="comment">// bug check has occured before the system has gotten far enough</span>
01246     <span class="comment">// in the initialization code to enable anyone to register a callback.</span>
01247     <span class="comment">//</span>
01248 
01249     ListHead = &amp;<a class="code" href="../../d4/d9/ke_8h.html#a127">KeBugCheckCallbackListHead</a>;
01250     <span class="keywordflow">if</span> ((ListHead-&gt;Flink != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (ListHead-&gt;Blink != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01251 
01252         <span class="comment">//</span>
01253         <span class="comment">// Scan the bug check callback list.</span>
01254         <span class="comment">//</span>
01255 
01256         LastEntry = ListHead;
01257         NextEntry = ListHead-&gt;Flink;
01258         <span class="keywordflow">while</span> (NextEntry != ListHead) {
01259 
01260             <span class="comment">//</span>
01261             <span class="comment">// The next entry address must be aligned properly, the</span>
01262             <span class="comment">// callback record must be readable, and the callback record</span>
01263             <span class="comment">// must have back link to the last entry.</span>
01264             <span class="comment">//</span>
01265 
01266             <span class="keywordflow">if</span> (((ULONG_PTR)NextEntry &amp; (<span class="keyword">sizeof</span>(ULONG_PTR) - 1)) != 0) {
01267                 <span class="keywordflow">return</span>;
01268 
01269             } <span class="keywordflow">else</span> {
01270                 CallbackRecord = CONTAINING_RECORD(NextEntry,
01271                                                    <a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">KBUGCHECK_CALLBACK_RECORD</a>,
01272                                                    Entry);
01273 
01274                 Source = (PUCHAR)CallbackRecord;
01275                 <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html">KBUGCHECK_CALLBACK_RECORD</a>); <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
01276                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>((PVOID)Source) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01277                         <span class="keywordflow">return</span>;
01278                     }
01279 
01280                     Source += 1;
01281                 }
01282 
01283                 <span class="keywordflow">if</span> (CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o0">Entry</a>.Blink != LastEntry) {
01284                     <span class="keywordflow">return</span>;
01285                 }
01286 
01287                 <span class="comment">//</span>
01288                 <span class="comment">// If the callback record has a state of inserted and the</span>
01289                 <span class="comment">// computed checksum matches the callback record checksum,</span>
01290                 <span class="comment">// then call the specified bug check callback routine.</span>
01291                 <span class="comment">//</span>
01292 
01293                 Checksum = (ULONG_PTR)CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o1">CallbackRoutine</a>;
01294                 Checksum += (ULONG_PTR)CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o2">Buffer</a>;
01295                 Checksum += CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o3">Length</a>;
01296                 Checksum += (ULONG_PTR)CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o4">Component</a>;
01297                 <span class="keywordflow">if</span> ((CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o6">State</a> == <a class="code" href="../../d4/d9/ke_8h.html#a410a237">BufferInserted</a>) &amp;&amp;
01298                     (CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o5">Checksum</a> == Checksum)) {
01299 
01300                     <span class="comment">//</span>
01301                     <span class="comment">// Call the specified bug check callback routine and</span>
01302                     <span class="comment">// handle any exceptions that occur.</span>
01303                     <span class="comment">//</span>
01304 
01305                     CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o6">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a410a238">BufferStarted</a>;
01306                     <span class="keywordflow">try</span> {
01307                         (CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o1">CallbackRoutine</a>)(CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o2">Buffer</a>,
01308                                                           CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o3">Length</a>);
01309 
01310                         CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o6">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a410a239">BufferFinished</a>;
01311 
01312                     } except(EXCEPTION_EXECUTE_HANDLER) {
01313                         CallbackRecord-&gt;<a class="code" href="../../d4/d5/struct__KBUGCHECK__CALLBACK__RECORD.html#o6">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a410a240">BufferIncomplete</a>;
01314                     }
01315                 }
01316             }
01317 
01318             LastEntry = NextEntry;
01319             NextEntry = NextEntry-&gt;Flink;
01320         }
01321     }
01322 
01323     <span class="keywordflow">return</span>;
01324 }
}
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="bugcheck.c::ExPoolCodeEnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a18">ExPoolCodeEnd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00037">37</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="bugcheck.c::ExPoolCodeStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a17">ExPoolCodeStart</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00036">36</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="bugcheck.c::KdDebuggerDataBlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KDDEBUGGER_DATA64 <a class="el" href="../../d9/d1/bugcheck_8c.html#a2">KdDebuggerDataBlock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00034">34</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="bugcheck.c::KeBugCheckCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d9/d1/bugcheck_8c.html#a9">KeBugCheckCount</a> = 1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00066">66</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="bugcheck.c::KiBugCheckData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR <a class="el" href="../../d9/d1/bugcheck_8c.html#a10">KiBugCheckData</a>[5]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00093">93</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="bugcheck.c::KiBugCheckDriver" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PUNICODE_STRING <a class="el" href="../../d9/d1/bugcheck_8c.html#a11">KiBugCheckDriver</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00094">94</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="bugcheck.c::MmPoolCodeEnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a20">MmPoolCodeEnd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00039">39</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="bugcheck.c::MmPoolCodeStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a19">MmPoolCodeStart</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00038">38</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="bugcheck.c::MmPteCodeEnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a22">MmPteCodeEnd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00041">41</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="bugcheck.c::MmPteCodeStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a21">MmPteCodeStart</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00040">40</a> of file <a class="el" href="../../d0/d1/bugcheck_8c-source.html">bugcheck.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06395">MiLocateKernelSections()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:58 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
