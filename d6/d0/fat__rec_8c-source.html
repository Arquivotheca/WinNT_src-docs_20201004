<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: fat_rec.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>fat_rec.c</h1><a href="../../d5/d1/fat__rec_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1992  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    fat_rec.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the mini-file system recognizer for FAT.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Darryl E. Havens (darrylh) 8-dec-1992</span>
00016 <span class="comment"></span>
00017 <span class="comment">Environment:</span>
00018 <span class="comment"></span>
00019 <span class="comment">    Kernel mode, local to I/O system</span>
00020 <span class="comment"></span>
00021 <span class="comment">Revision History:</span>
00022 <span class="comment"></span>
00023 <span class="comment"></span>
00024 <span class="comment">--*/</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="../../d7/d7/fs__rec_8h.html">fs_rec.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="../../d6/d1/fat__rec_8h.html">fat_rec.h</a>"</span>
00028 
00029 <span class="comment">//</span>
00030 <span class="comment">//  The local debug trace level</span>
00031 <span class="comment">//</span>
00032 
<a name="l00033"></a><a class="code" href="../../d5/d1/fat__rec_8c.html#a0">00033</a> <span class="preprocessor">#define Dbg                              (FSREC_DEBUG_LEVEL_FAT)</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,FatRecFsControl)</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,IsFatVolume)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,UnpackBiosParameterBlock)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#endif // ALLOC_PRAGMA</span>
00040 <span class="preprocessor"></span>
00041 
00042 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00043"></a><a class="code" href="../../d7/d7/fs__rec_8h.html#a35">00043</a> <a class="code" href="../../d7/d7/fs__rec_8h.html#a35">FatRecFsControl</a>(
00044     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00045     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00046     )
00047 
00048 <span class="comment">/*++</span>
00049 <span class="comment"></span>
00050 <span class="comment">Routine Description:</span>
00051 <span class="comment"></span>
00052 <span class="comment">    This function performs the mount and driver reload functions for this mini-</span>
00053 <span class="comment">    file system recognizer driver.</span>
00054 <span class="comment"></span>
00055 <span class="comment">Arguments:</span>
00056 <span class="comment"></span>
00057 <span class="comment">    DeviceObject - Pointer to this driver's device object.</span>
00058 <span class="comment"></span>
00059 <span class="comment">    Irp - Pointer to the I/O Request Packet (IRP) representing the function to</span>
00060 <span class="comment">        be performed.</span>
00061 <span class="comment"></span>
00062 <span class="comment">Return Value:</span>
00063 <span class="comment"></span>
00064 <span class="comment">    The function value is the final status of the operation.</span>
00065 <span class="comment"></span>
00066 <span class="comment"></span>
00067 <span class="comment">--*/</span>
00068 
00069 {
00070     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00071     <a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">PIO_STACK_LOCATION</a> irpSp;
00072     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> deviceExtension;
00073     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> targetDevice;
00074     <a class="code" href="../../d9/d7/struct__PACKED__BOOT__SECTOR.html">PPACKED_BOOT_SECTOR</a> buffer;
00075     LARGE_INTEGER byteOffset;
00076     UNICODE_STRING driverName;
00077     ULONG bytesPerSector;
00078     BOOLEAN isDeviceFailure = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00079 
00080     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00081 
00082     <span class="comment">//</span>
00083     <span class="comment">// Begin by determining what function that is to be performed.</span>
00084     <span class="comment">//</span>
00085 
00086     deviceExtension = (<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>) DeviceObject-&gt;DeviceExtension;
00087     irpSp = <a class="code" href="../../d0/d5/io_8h.html#a228">IoGetCurrentIrpStackLocation</a>( <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a> );
00088 
00089     <span class="keywordflow">switch</span> ( irpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o1">MinorFunction</a> ) {
00090 
00091     <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a47">IRP_MN_MOUNT_VOLUME</a>:
00092 
00093         <span class="comment">//</span>
00094         <span class="comment">// Attempt to mount a volume:  Determine whether or not the volume in</span>
00095         <span class="comment">// question is a FAT volume and, if so, let the I/O system know that it</span>
00096         <span class="comment">// is by returning a special status code so that this driver can get</span>
00097         <span class="comment">// called back to load the FAT file system.</span>
00098         <span class="comment">//</span>
00099 
00100         status = STATUS_UNRECOGNIZED_VOLUME;
00101 
00102         <span class="comment">//</span>
00103         <span class="comment">// Attempt to determine whether or not the target volume being mounted</span>
00104         <span class="comment">// is a FAT volume.  Note that if an error occurs, and this is a floppy</span>
00105         <span class="comment">// drive, and the error occurred on the actual read from the device,</span>
00106         <span class="comment">// then the FAT file system will actually be loaded to handle the</span>
00107         <span class="comment">// problem since this driver is a place holder and does not need to</span>
00108         <span class="comment">// know all of the protocols for handling floppy errors.</span>
00109         <span class="comment">//</span>
00110 
00111         targetDevice = irpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o11">Parameters</a>.MountVolume.DeviceObject;
00112 
00113         <span class="comment">//</span>
00114         <span class="comment">//  First retrieve the sector size for this media.</span>
00115         <span class="comment">//</span>
00116 
00117         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7/fs__rec_8h.html#a30">FsRecGetDeviceSectorSize</a>( targetDevice,
00118                                       &amp;bytesPerSector )) {
00119 
00120             byteOffset.QuadPart = 0;
00121             buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00122 
00123             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7/fs__rec_8h.html#a32">FsRecReadBlock</a>( targetDevice,
00124                                 &amp;byteOffset,
00125                                 512,
00126                                 bytesPerSector,
00127                                 &amp;buffer,
00128                                 &amp;isDeviceFailure ) &amp;&amp;
00129                 <a class="code" href="../../d6/d1/fat__rec_8h.html#a15">IsFatVolume</a>( buffer )) {
00130                     
00131                 status = STATUS_FS_DRIVER_REQUIRED;
00132                 
00133             }
00134 
00135             <span class="keywordflow">if</span> (buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00136                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( buffer );
00137             }
00138             
00139          } <span class="keywordflow">else</span> {
00140 
00141              <span class="comment">//</span>
00142              <span class="comment">//  Devices that can't get us this much ...</span>
00143              <span class="comment">//</span>
00144 
00145              isDeviceFailure = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00146          }
00147             
00148          <span class="comment">//</span>
00149          <span class="comment">//  See if we should make the real filesystem take a shot at a wacky floppy.</span>
00150          <span class="comment">//</span>
00151          
00152          <span class="keywordflow">if</span> (isDeviceFailure) {
00153              <span class="keywordflow">if</span> (targetDevice-&gt;<a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html#o9">Characteristics</a> &amp; FILE_FLOPPY_DISKETTE) {
00154                  status = STATUS_FS_DRIVER_REQUIRED;
00155              }
00156          }
00157 
00158          <span class="keywordflow">break</span>;
00159 
00160     <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a49">IRP_MN_LOAD_FILE_SYSTEM</a>:
00161 
00162         status = <a class="code" href="../../d7/d7/fs__rec_8h.html#a29">FsRecLoadFileSystem</a>( DeviceObject,
00163                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Services\\Fastfat"</span> );
00164         <span class="keywordflow">break</span>;
00165 
00166     <span class="keywordflow">default</span>:
00167         status = STATUS_INVALID_DEVICE_REQUEST;
00168 
00169     }
00170 
00171     <span class="comment">//</span>
00172     <span class="comment">// Finally, complete the request and return the same status code to the</span>
00173     <span class="comment">// caller.</span>
00174     <span class="comment">//</span>
00175 
00176     <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>-&gt;<a class="code" href="../../d0/d2/struct__IRP.html#o9">IoStatus</a>.Status = status;
00177     <a class="code" href="../../d0/d5/io_8h.html#a224">IoCompleteRequest</a>( <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>, <a class="code" href="../../d7/d8/exboosts_8h.html#a3">IO_NO_INCREMENT</a> );
00178 
00179     <span class="keywordflow">return</span> status;
00180 }
00181 
00182 
00183 BOOLEAN
<a name="l00184"></a><a class="code" href="../../d6/d1/fat__rec_8h.html#a15">00184</a> <a class="code" href="../../d6/d1/fat__rec_8h.html#a15">IsFatVolume</a>(
00185     IN <a class="code" href="../../d9/d7/struct__PACKED__BOOT__SECTOR.html">PPACKED_BOOT_SECTOR</a> Buffer
00186     )
00187 
00188 <span class="comment">/*++</span>
00189 <span class="comment"></span>
00190 <span class="comment">Routine Description:</span>
00191 <span class="comment"></span>
00192 <span class="comment">    This routine looks at the buffer passed in which contains the FAT boot</span>
00193 <span class="comment">    sector and determines whether or not it represents an actual FAT boot</span>
00194 <span class="comment">    sector.</span>
00195 <span class="comment"></span>
00196 <span class="comment">Arguments:</span>
00197 <span class="comment"></span>
00198 <span class="comment">    Buffer - Pointer to buffer containing potential boot block.</span>
00199 <span class="comment"></span>
00200 <span class="comment">Return Value:</span>
00201 <span class="comment"></span>
00202 <span class="comment">    The function returns TRUE if the buffer contains a recognizable FAT boot</span>
00203 <span class="comment">    sector, otherwise it returns FALSE.</span>
00204 <span class="comment"></span>
00205 <span class="comment">--*/</span>
00206 
00207 {
00208     <a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html">BIOS_PARAMETER_BLOCK</a> bios;
00209     BOOLEAN result;
00210 
00211     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00212 
00213     <span class="comment">//</span>
00214     <span class="comment">// Begin by unpacking the Bios Parameter Block that is packed in the boot</span>
00215     <span class="comment">// sector so that it can be examined without incurring alignment faults.</span>
00216     <span class="comment">//</span>
00217 
00218     <a class="code" href="../../d6/d1/fat__rec_8h.html#a16">UnpackBiosParameterBlock</a>( &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;PackedBpb, &amp;bios );
00219 
00220     <span class="comment">//</span>
00221     <span class="comment">// Assume that the sector represents a FAT boot block and then determine</span>
00222     <span class="comment">// whether or not it really does.</span>
00223     <span class="comment">//</span>
00224 
00225     result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00226 
00227     <span class="keywordflow">if</span> (bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o5">Sectors</a>) {
00228         bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o11">LargeSectors</a> = 0;
00229     }
00230 
00231     <span class="comment">// FMR Jul.11.1994 NaokiM - Fujitsu -</span>
00232     <span class="comment">// FMR boot sector has 'IPL1' string at the beginnig.</span>
00233 
00234     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Jump[0] != 0x49 &amp;&amp; <span class="comment">/* FMR */</span>
00235         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Jump[0] != 0xe9 &amp;&amp;
00236         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Jump[0] != 0xeb) {
00237 
00238         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00239 
00240 
00241     <span class="comment">// FMR Jul.11.1994 NaokiM - Fujitsu -</span>
00242     <span class="comment">// Sector size of FMR partition is 2048.</span>
00243 
00244     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o0">BytesPerSector</a> !=  128 &amp;&amp;
00245                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o0">BytesPerSector</a> !=  256 &amp;&amp;
00246                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o0">BytesPerSector</a> !=  512 &amp;&amp;
00247                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o0">BytesPerSector</a> != 1024 &amp;&amp;
00248                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o0">BytesPerSector</a> != 2048 &amp;&amp; <span class="comment">/* FMR */</span>
00249                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o0">BytesPerSector</a> != 4096) {
00250 
00251         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00252 
00253     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> !=  1 &amp;&amp;
00254                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> !=  2 &amp;&amp;
00255                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> !=  4 &amp;&amp;
00256                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> !=  8 &amp;&amp;
00257                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> != 16 &amp;&amp;
00258                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> != 32 &amp;&amp;
00259                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> != 64 &amp;&amp;
00260                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o1">SectorsPerCluster</a> != 128) {
00261 
00262         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00263 
00264     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o2">ReservedSectors</a>) {
00265 
00266         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00267 
00268     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o3">Fats</a>) {
00269 
00270         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">// Prior to DOS 3.2 might contains value in both of Sectors and</span>
00274     <span class="comment">// Sectors Large.</span>
00275     <span class="comment">//</span>
00276     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o5">Sectors</a> &amp;&amp; !bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o11">LargeSectors</a>) {
00277 
00278         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00279 
00280     <span class="comment">// FMR Jul.11.1994 NaokiM - Fujitsu -</span>
00281     <span class="comment">// 1. Media descriptor of FMR partitions is 0xfa.</span>
00282     <span class="comment">// 2. Media descriptor of partitions formated by FMR OS/2 is 0x00.</span>
00283     <span class="comment">// 3. Media descriptor of floppy disks formated by FMR DOS is 0x01.</span>
00284 
00285     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0x00 &amp;&amp; <span class="comment">/* FMR */</span>
00286                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0x01 &amp;&amp; <span class="comment">/* FMR */</span>
00287                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xf0 &amp;&amp;
00288                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xf8 &amp;&amp;
00289                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xf9 &amp;&amp;
00290                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xfa &amp;&amp; <span class="comment">/* FMR */</span>
00291                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xfb &amp;&amp;
00292                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xfc &amp;&amp;
00293                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xfd &amp;&amp;
00294                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xfe &amp;&amp;
00295                bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o6">Media</a> != 0xff) {
00296 
00297         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00298 
00299     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o7">SectorsPerFat</a> != 0 &amp;&amp; bios.<a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html#o4">RootEntries</a> == 0) {
00300 
00301         result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00302     }
00303 
00304     <span class="keywordflow">return</span> result;
00305 }
00306 
00307 
00308 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00309"></a><a class="code" href="../../d6/d1/fat__rec_8h.html#a16">00309</a> <a class="code" href="../../d6/d1/fat__rec_8h.html#a16">UnpackBiosParameterBlock</a>(
00310     IN <a class="code" href="../../d8/d7/struct__PACKED__BIOS__PARAMETER__BLOCK.html">PPACKED_BIOS_PARAMETER_BLOCK</a> Bios,
00311     OUT <a class="code" href="../../d1/d1/structBIOS__PARAMETER__BLOCK.html">PBIOS_PARAMETER_BLOCK</a> UnpackedBios
00312     )
00313 
00314 <span class="comment">/*++</span>
00315 <span class="comment"></span>
00316 <span class="comment">Routine Description:</span>
00317 <span class="comment"></span>
00318 <span class="comment">    This routine copies a packed Bios Parameter Block to an unpacked Bios</span>
00319 <span class="comment">    Parameter Block.</span>
00320 <span class="comment"></span>
00321 <span class="comment">Arguments:</span>
00322 <span class="comment"></span>
00323 <span class="comment">    Bios - Pointer to the packed Bios Parameter Block.</span>
00324 <span class="comment"></span>
00325 <span class="comment">    UnpackedBios - Pointer to the unpacked Bios Parameter Block.</span>
00326 <span class="comment"></span>
00327 <span class="comment">Return Value:</span>
00328 <span class="comment"></span>
00329 <span class="comment">    None.</span>
00330 <span class="comment"></span>
00331 <span class="comment">--*/</span>
00332 
00333 {
00334     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00335 
00336     <span class="comment">//</span>
00337     <span class="comment">// Unpack the Bios Parameter Block.</span>
00338     <span class="comment">//</span>
00339 
00340     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;BytesPerSector, &amp;Bios-&gt;BytesPerSector[0] );
00341     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;BytesPerSector, &amp;Bios-&gt;BytesPerSector[0] );
00342     <a class="code" href="../../d6/d1/fat__rec_8h.html#a0">CopyUchar1</a>( &amp;UnpackedBios-&gt;SectorsPerCluster, &amp;Bios-&gt;SectorsPerCluster[0] );
00343     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;ReservedSectors, &amp;Bios-&gt;ReservedSectors[0] );
00344     <a class="code" href="../../d6/d1/fat__rec_8h.html#a0">CopyUchar1</a>( &amp;UnpackedBios-&gt;Fats, &amp;Bios-&gt;Fats[0] );
00345     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;RootEntries, &amp;Bios-&gt;RootEntries[0] );
00346     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;Sectors, &amp;Bios-&gt;Sectors[0] );
00347     <a class="code" href="../../d6/d1/fat__rec_8h.html#a0">CopyUchar1</a>( &amp;UnpackedBios-&gt;Media, &amp;Bios-&gt;Media[0] );
00348     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;SectorsPerFat, &amp;Bios-&gt;SectorsPerFat[0] );
00349     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;SectorsPerTrack, &amp;Bios-&gt;SectorsPerTrack[0] );
00350     <a class="code" href="../../d6/d1/fat__rec_8h.html#a1">CopyUchar2</a>( &amp;UnpackedBios-&gt;Heads, &amp;Bios-&gt;Heads[0] );
00351     <a class="code" href="../../d6/d1/fat__rec_8h.html#a2">CopyUchar4</a>( &amp;UnpackedBios-&gt;HiddenSectors, &amp;Bios-&gt;HiddenSectors[0] );
00352     <a class="code" href="../../d6/d1/fat__rec_8h.html#a2">CopyUchar4</a>( &amp;UnpackedBios-&gt;LargeSectors, &amp;Bios-&gt;LargeSectors[0] );
00353 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:58 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
