<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: psctxmip.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>psctxmip.c File Reference</h1><code>#include "<a class="el" href="../../d9/d0/psp_8h-source.html">psp.h</a>"</code><br>

<p>
<a href="../../d7/d9/psctxmip_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONGLONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/psctxmip_8c.html#a0">PspGetSavedValue</a> (IN PVOID ContextPointer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/psctxmip_8c.html#a1">PspSetSavedValue</a> (IN ULONGLONG ContextValue, IN PVOID ContextPointer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/psctxmip_8c.html#a2">PspGetContext</a> (IN PKTRAP_FRAME TrapFrame, IN PKNONVOLATILE_CONTEXT_POINTERS ContextPointers, IN OUT PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/psctxmip_8c.html#a3">PspSetContext</a> (IN OUT PKTRAP_FRAME TrapFrame, IN PKNONVOLATILE_CONTEXT_POINTERS ContextPointers, IN PCONTEXT ContextRecord, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ProcessorMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/psctxmip_8c.html#a4">PspGetSetContextSpecialApc</a> (IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *NormalRoutine, IN PVOID *NormalContext, IN PVOID *SystemArgument1, IN PVOID *SystemArgument2)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="psctxmip.c::PspGetContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspGetContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKNONVOLATILE_CONTEXT_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextPointers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00107">107</a> of file <a class="el" href="../../d7/d9/psctxmip_8c-source.html">psctxmip.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00244">CONTEXT_EXTENDED_INTEGER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, and <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00024">PspGetSavedValue()</a>.
<p>
<pre class="fragment"><div>00115                    :
00116 
00117     This function selectively moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap frame
00118     and nonvolatile context to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context record.
00119 
00120 Arguments:
00121 
00122     TrapFrame - Supplies a pointer to a trap frame.
00123 
00124     ContextPointers - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of context pointers record.
00125 
00126     ContextRecord - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context record.
00127 
00128 Return Value:
00129 
00130     None.
00131 
00132 --*/
00133 
00134 {
00135 
00136     ULONG ContextFlags;
00137     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00138 
00139     <span class="comment">//</span>
00140     <span class="comment">// Get context.</span>
00141     <span class="comment">//</span>
00142 
00143     ContextFlags = ContextRecord-&gt;ContextFlags;
00144     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) {
00145 
00146         <span class="comment">//</span>
00147         <span class="comment">// Get integer registers gp, sp, ra, FIR, and PSR.</span>
00148         <span class="comment">//</span>
00149 
00150         ContextRecord-&gt;Fir = TrapFrame-&gt;Fir;
00151         ContextRecord-&gt;Psr = TrapFrame-&gt;Psr;
00152         <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) {
00153             ContextRecord-&gt;IntGp = (ULONG)TrapFrame-&gt;XIntGp;
00154             ContextRecord-&gt;IntSp = (ULONG)TrapFrame-&gt;XIntSp;
00155             ContextRecord-&gt;IntRa = (ULONG)TrapFrame-&gt;XIntRa;
00156 
00157         } <span class="keywordflow">else</span> {
00158             ContextRecord-&gt;XIntGp = TrapFrame-&gt;XIntGp;
00159             ContextRecord-&gt;XIntSp = TrapFrame-&gt;XIntSp;
00160             ContextRecord-&gt;XIntRa = TrapFrame-&gt;XIntRa;
00161         }
00162     }
00163 
00164     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) {
00165 
00166         <span class="comment">//</span>
00167         <span class="comment">// Get integer registers zero, and, at - t9, k0, k1, lo, and hi.</span>
00168         <span class="comment">//</span>
00169 
00170         <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) {
00171             ContextRecord-&gt;IntZero = 0;
00172             ContextRecord-&gt;IntAt = (ULONG)TrapFrame-&gt;XIntAt;
00173             ContextRecord-&gt;IntV0 = (ULONG)TrapFrame-&gt;XIntV0;
00174             ContextRecord-&gt;IntV1 = (ULONG)TrapFrame-&gt;XIntV1;
00175             ContextRecord-&gt;IntA0 = (ULONG)TrapFrame-&gt;XIntA0;
00176             ContextRecord-&gt;IntA1 = (ULONG)TrapFrame-&gt;XIntA1;
00177             ContextRecord-&gt;IntA2 = (ULONG)TrapFrame-&gt;XIntA2;
00178             ContextRecord-&gt;IntA3 = (ULONG)TrapFrame-&gt;XIntA3;
00179             ContextRecord-&gt;IntT0 = (ULONG)TrapFrame-&gt;XIntT0;
00180             ContextRecord-&gt;IntT1 = (ULONG)TrapFrame-&gt;XIntT1;
00181             ContextRecord-&gt;IntT2 = (ULONG)TrapFrame-&gt;XIntT2;
00182             ContextRecord-&gt;IntT3 = (ULONG)TrapFrame-&gt;XIntT3;
00183             ContextRecord-&gt;IntT4 = (ULONG)TrapFrame-&gt;XIntT4;
00184             ContextRecord-&gt;IntT5 = (ULONG)TrapFrame-&gt;XIntT5;
00185             ContextRecord-&gt;IntT6 = (ULONG)TrapFrame-&gt;XIntT6;
00186             ContextRecord-&gt;IntT7 = (ULONG)TrapFrame-&gt;XIntT7;
00187             ContextRecord-&gt;IntT8 = (ULONG)TrapFrame-&gt;XIntT8;
00188             ContextRecord-&gt;IntT9 = (ULONG)TrapFrame-&gt;XIntT9;
00189             ContextRecord-&gt;IntK0 = 0;
00190             ContextRecord-&gt;IntK1 = 0;
00191             ContextRecord-&gt;IntLo = (ULONG)TrapFrame-&gt;XIntLo;
00192             ContextRecord-&gt;IntHi = (ULONG)TrapFrame-&gt;XIntHi;
00193 
00194         } <span class="keywordflow">else</span> {
00195             ContextRecord-&gt;XIntZero = 0;
00196             ContextRecord-&gt;XIntAt = TrapFrame-&gt;XIntAt;
00197             ContextRecord-&gt;XIntV0 = TrapFrame-&gt;XIntV0;
00198             ContextRecord-&gt;XIntV1 = TrapFrame-&gt;XIntV1;
00199             ContextRecord-&gt;XIntA0 = TrapFrame-&gt;XIntA0;
00200             ContextRecord-&gt;XIntA1 = TrapFrame-&gt;XIntA1;
00201             ContextRecord-&gt;XIntA2 = TrapFrame-&gt;XIntA2;
00202             ContextRecord-&gt;XIntA3 = TrapFrame-&gt;XIntA3;
00203             ContextRecord-&gt;XIntT0 = TrapFrame-&gt;XIntT0;
00204             ContextRecord-&gt;XIntT1 = TrapFrame-&gt;XIntT1;
00205             ContextRecord-&gt;XIntT2 = TrapFrame-&gt;XIntT2;
00206             ContextRecord-&gt;XIntT3 = TrapFrame-&gt;XIntT3;
00207             ContextRecord-&gt;XIntT4 = TrapFrame-&gt;XIntT4;
00208             ContextRecord-&gt;XIntT5 = TrapFrame-&gt;XIntT5;
00209             ContextRecord-&gt;XIntT6 = TrapFrame-&gt;XIntT6;
00210             ContextRecord-&gt;XIntT7 = TrapFrame-&gt;XIntT7;
00211             ContextRecord-&gt;XIntT8 = TrapFrame-&gt;XIntT8;
00212             ContextRecord-&gt;XIntT9 = TrapFrame-&gt;XIntT9;
00213             ContextRecord-&gt;XIntK0 = 0;
00214             ContextRecord-&gt;XIntK1 = 0;
00215             ContextRecord-&gt;XIntLo = TrapFrame-&gt;XIntLo;
00216             ContextRecord-&gt;XIntHi = TrapFrame-&gt;XIntHi;
00217         }
00218 
00219         <span class="comment">//</span>
00220         <span class="comment">// Get nonvolatile integer registers s0 - s7, and s8.</span>
00221         <span class="comment">//</span>
00222 
00223         <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) {
00224             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 7;
00225             <span class="keywordflow">do</span> {
00226                 <span class="keywordflow">if</span> (TrapFrame-&gt;SavedFlag == 0) {
00227                     (&amp;ContextRecord-&gt;IntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] =
00228                         (ULONG)<a class="code" href="../../d6/d0/psctxmip_8c.html#a0">PspGetSavedValue</a>((&amp;ContextPointers-&gt;XIntS0)[Index]);
00229 
00230                 } <span class="keywordflow">else</span> {
00231                     (&amp;ContextRecord-&gt;IntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (ULONG)(&amp;TrapFrame-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00232                 }
00233 
00234                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> -= 1;
00235             } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &gt;= 0);
00236             ContextRecord-&gt;IntS8 = (ULONG)TrapFrame-&gt;XIntS8;
00237 
00238         } <span class="keywordflow">else</span> {
00239             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 7;
00240             <span class="keywordflow">do</span> {
00241                 <span class="keywordflow">if</span> (TrapFrame-&gt;SavedFlag == 0) {
00242                     (&amp;ContextRecord-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] =
00243                         <a class="code" href="../../d6/d0/psctxmip_8c.html#a0">PspGetSavedValue</a>((&amp;ContextPointers-&gt;XIntS0)[Index]);
00244 
00245                 } <span class="keywordflow">else</span> {
00246                     (&amp;ContextRecord-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (&amp;TrapFrame-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00247                 }
00248 
00249                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> -= 1;
00250             } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &gt;= 0);
00251             ContextRecord-&gt;XIntS8 = TrapFrame-&gt;XIntS8;
00252         }
00253     }
00254 
00255     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) {
00256 
00257         <span class="comment">//</span>
00258         <span class="comment">// Get volatile floating registers f0 - f19.</span>
00259         <span class="comment">//</span>
00260 
00261         RtlMoveMemory(&amp;ContextRecord-&gt;FltF0, &amp;TrapFrame-&gt;FltF0,
00262                      <span class="keyword">sizeof</span>(ULONG) * (20));
00263 
00264         <span class="comment">//</span>
00265         <span class="comment">// Get nonvolatile floating registers f20 - f31.</span>
00266         <span class="comment">//</span>
00267 
00268         ContextRecord-&gt;FltF20 = *ContextPointers-&gt;FltF20;
00269         ContextRecord-&gt;FltF21 = *ContextPointers-&gt;FltF21;
00270         ContextRecord-&gt;FltF22 = *ContextPointers-&gt;FltF22;
00271         ContextRecord-&gt;FltF23 = *ContextPointers-&gt;FltF23;
00272         ContextRecord-&gt;FltF24 = *ContextPointers-&gt;FltF24;
00273         ContextRecord-&gt;FltF25 = *ContextPointers-&gt;FltF25;
00274         ContextRecord-&gt;FltF26 = *ContextPointers-&gt;FltF26;
00275         ContextRecord-&gt;FltF27 = *ContextPointers-&gt;FltF27;
00276         ContextRecord-&gt;FltF28 = *ContextPointers-&gt;FltF28;
00277         ContextRecord-&gt;FltF29 = *ContextPointers-&gt;FltF29;
00278         ContextRecord-&gt;FltF30 = *ContextPointers-&gt;FltF30;
00279         ContextRecord-&gt;FltF31 = *ContextPointers-&gt;FltF31;
00280 
00281         <span class="comment">//</span>
00282         <span class="comment">// Get floating status register.</span>
00283         <span class="comment">//</span>
00284 
00285         ContextRecord-&gt;Fsr = TrapFrame-&gt;Fsr;
00286     }
00287 
00288     <span class="keywordflow">return</span>;
00289 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="psctxmip.c::PspGetSavedValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONGLONG PspGetSavedValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ContextPointer</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00024">24</a> of file <a class="el" href="../../d7/d9/psctxmip_8c-source.html">psctxmip.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00107">PspGetContext()</a>.
<p>
<pre class="fragment"><div>00030                    :
00031 
00032     This function loads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context value specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> argument
00033     pointer.
00034 
00035     N.B. The <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> bit of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operand <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00036 
00037 Arguments:
00038 
00039     ContextPointer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context value that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00040         loaded.
00041 
00042 Return Value:
00043 
00044     The value specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> argument pointer.
00045 
00046 --*/
00047 
00048 {
00049 
00050     <span class="comment">//</span>
00051     <span class="comment">// If the low bit of the argument pointer is zero, then the argument</span>
00052     <span class="comment">// value is 32-bits. Otherwise, the argument value is 64-bits.</span>
00053     <span class="comment">//</span>
00054 
00055     <span class="keywordflow">if</span> (((ULONG)ContextPointer &amp; 1) != 0) {
00056         <span class="keywordflow">return</span> *((PULONGLONG)((ULONG)ContextPointer &amp; ~1));
00057 
00058     } <span class="keywordflow">else</span> {
00059         <span class="keywordflow">return</span> *((PLONG)ContextPointer);
00060     }
00061 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="psctxmip.c::PspGetSetContextSpecialApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspGetSetContextSpecialApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Apc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00475">475</a> of file <a class="el" href="../../d7/d9/psctxmip_8c-source.html">psctxmip.c</a>.
<p>
References <a class="el" href="../../d9/d0/psp_8h-source.html#l00080">_GETSETCONTEXT::Context</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00556">_KTHREAD::InitialStack</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00078">_GETSETCONTEXT::Mode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00079">_GETSETCONTEXT::OperationComplete</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d9/psctxalp_8c-source.html#l00029">PspGetContext()</a>, <a class="el" href="../../d4/d9/psctx386_8c-source.html#l00088">PspSetContext()</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00348">RtlLookupFunctionEntry()</a>, <a class="el" href="../../d1/d6/ppc_2vunwind_8c-source.html#l00467">RtlVirtualUnwind()</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00347">_ETHREAD::Tcb</a>.
<p>
<pre class="fragment"><div>00485                    :
00486 
00487     This function either captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00488     thread, or sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread. The
00489     operation <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> determined by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of SystemArgument1. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a>
00490     zero value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used <span class="keywordflow">for</span> get context, and a nonzero value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used
00491     <span class="keywordflow">for</span> set context.
00492 
00493 Arguments:
00494 
00495     Apc - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object that caused entry
00496           into <span class="keyword">this</span> routine.
00497 
00498     NormalRoutine - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> normal routine function that
00499         was specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC was initialized. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00500         used.
00501 
00502     NormalContext - Supplies a pointer to an arbitrary data structure that
00503         was specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC was initialized. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00504         used.
00505 
00506     SystemArgument1, SystemArgument2 - Supplies a set of two pointer to two
00507         arguments that contain untyped data. These parameters are not used.
00508 
00509 Return Value:
00510 
00511     None.
00512 
00513 --*/
00514 
00515 {
00516 
00517     <a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html">PGETSETCONTEXT</a> ContextBlock;
00518     KNONVOLATILE_CONTEXT_POINTERS ContextPointers;
00519     CONTEXT ContextRecord;
00520     ULONG ControlPc;
00521     ULONG EstablisherFrame;
00522     PRUNTIME_FUNCTION FunctionEntry;
00523     BOOLEAN InFunction;
00524     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
00525     ULONG TrapFrame1;
00526     ULONG TrapFrame2;
00527 
00528     <span class="comment">//</span>
00529     <span class="comment">// Get the address of the context block and compute the address of the</span>
00530     <span class="comment">// system entry trap frame.</span>
00531     <span class="comment">//</span>
00532 
00533     ContextBlock = CONTAINING_RECORD(Apc, <a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html">GETSETCONTEXT</a>, Apc);
00534     Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00535     TrapFrame1 = (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o2">InitialStack</a> - KTRAP_FRAME_LENGTH;
00536     TrapFrame2 = (ULONG)Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o2">InitialStack</a> - KTRAP_FRAME_LENGTH - KTRAP_FRAME_ARGUMENTS;
00537 
00538     <span class="comment">//</span>
00539     <span class="comment">// Capture the current thread context and set the initial control PC</span>
00540     <span class="comment">// value.</span>
00541     <span class="comment">//</span>
00542 
00543     RtlCaptureContext(&amp;ContextRecord);
00544     ControlPc = (ULONG)ContextRecord.XIntRa;
00545 
00546     <span class="comment">//</span>
00547     <span class="comment">// Initialize context pointers for the nonvolatile integer and floating</span>
00548     <span class="comment">// registers.</span>
00549     <span class="comment">//</span>
00550 
00551     ContextPointers.XIntS0 = &amp;ContextRecord.XIntS0;
00552     ContextPointers.XIntS1 = &amp;ContextRecord.XIntS1;
00553     ContextPointers.XIntS2 = &amp;ContextRecord.XIntS2;
00554     ContextPointers.XIntS3 = &amp;ContextRecord.XIntS3;
00555     ContextPointers.XIntS4 = &amp;ContextRecord.XIntS4;
00556     ContextPointers.XIntS5 = &amp;ContextRecord.XIntS5;
00557     ContextPointers.XIntS6 = &amp;ContextRecord.XIntS6;
00558     ContextPointers.XIntS7 = &amp;ContextRecord.XIntS7;
00559 
00560     ContextPointers.FltF20 = &amp;ContextRecord.FltF20;
00561     ContextPointers.FltF21 = &amp;ContextRecord.FltF21;
00562     ContextPointers.FltF22 = &amp;ContextRecord.FltF22;
00563     ContextPointers.FltF23 = &amp;ContextRecord.FltF23;
00564     ContextPointers.FltF24 = &amp;ContextRecord.FltF24;
00565     ContextPointers.FltF25 = &amp;ContextRecord.FltF25;
00566     ContextPointers.FltF26 = &amp;ContextRecord.FltF26;
00567     ContextPointers.FltF27 = &amp;ContextRecord.FltF27;
00568     ContextPointers.FltF28 = &amp;ContextRecord.FltF28;
00569     ContextPointers.FltF29 = &amp;ContextRecord.FltF29;
00570     ContextPointers.FltF30 = &amp;ContextRecord.FltF30;
00571     ContextPointers.FltF31 = &amp;ContextRecord.FltF31;
00572 
00573     <span class="comment">//</span>
00574     <span class="comment">// Start with the frame specified by the context record and virtually</span>
00575     <span class="comment">// unwind call frames until the system entry trap frame is encountered.</span>
00576     <span class="comment">//</span>
00577 
00578     <span class="keywordflow">do</span> {
00579 
00580         <span class="comment">//</span>
00581         <span class="comment">// Lookup the function table entry using the point at which control</span>
00582         <span class="comment">// left the procedure.</span>
00583         <span class="comment">//</span>
00584 
00585         FunctionEntry = <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a8">RtlLookupFunctionEntry</a>(ControlPc);
00586 
00587         <span class="comment">//</span>
00588         <span class="comment">// If there is a function table entry for the routine, then virtually</span>
00589         <span class="comment">// unwind to the caller of the current routine to obtain the address</span>
00590         <span class="comment">// where control left the caller. Otherwise, the function is a leaf</span>
00591         <span class="comment">// function and the return address register contains the address of</span>
00592         <span class="comment">// where control left the caller.</span>
00593         <span class="comment">//</span>
00594 
00595         <span class="keywordflow">if</span> (FunctionEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00596             ControlPc = <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a>(ControlPc | 1,
00597                                          FunctionEntry,
00598                                          &amp;ContextRecord,
00599                                          &amp;InFunction,
00600                                          &amp;EstablisherFrame,
00601                                          &amp;ContextPointers);
00602 
00603         } <span class="keywordflow">else</span> {
00604             ControlPc = (ULONG)ContextRecord.XIntRa;
00605         }
00606 
00607     } <span class="keywordflow">while</span> (((ULONG)ContextRecord.XIntSp != TrapFrame1) &amp;&amp;
00608              (((ULONG)ContextRecord.XIntSp != TrapFrame2) ||
00609              (ControlPc &lt; PCR-&gt;SystemServiceDispatchStart) ||
00610              (ControlPc &gt;= PCR-&gt;SystemServiceDispatchEnd)));
00611 
00612     <span class="comment">//</span>
00613     <span class="comment">// If system argument one is nonzero, then set the context of the current</span>
00614     <span class="comment">// thread. Otherwise, get the context of the current thread.</span>
00615     <span class="comment">//</span>
00616 
00617     <span class="keywordflow">if</span> (Apc-&gt;SystemArgument1 != 0) {
00618 
00619         <span class="comment">//</span>
00620         <span class="comment">// Set context of current thread.</span>
00621         <span class="comment">//</span>
00622 
00623         <a class="code" href="../../d8/d1/psp_8h.html#a72">PspSetContext</a>((PKTRAP_FRAME)TrapFrame1,
00624                       &amp;ContextPointers,
00625                       &amp;ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o3">Context</a>,
00626                       ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o1">Mode</a>);
00627 
00628     } <span class="keywordflow">else</span> {
00629 
00630         <span class="comment">//</span>
00631         <span class="comment">// Get context of current thread.</span>
00632         <span class="comment">//</span>
00633 
00634         <a class="code" href="../../d8/d1/psp_8h.html#a73">PspGetContext</a>((PKTRAP_FRAME)TrapFrame1,
00635                       &amp;ContextPointers,
00636                       &amp;ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o3">Context</a>);
00637     }
00638 
00639     <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;ContextBlock-&gt;<a class="code" href="../../d1/d2/struct__GETSETCONTEXT.html#o2">OperationComplete</a>, 0, FALSE);
00640     <span class="keywordflow">return</span>;
00641 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="psctxmip.c::PspSetContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspSetContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKNONVOLATILE_CONTEXT_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextPointers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessorMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00292">292</a> of file <a class="el" href="../../d7/d9/psctxmip_8c-source.html">psctxmip.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00244">CONTEXT_EXTENDED_INTEGER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, and <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00064">PspSetSavedValue()</a>.
<p>
<pre class="fragment"><div>00301                    :
00302 
00303     This function selectively moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context
00304     record to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap frame and nonvolatile context.
00305 
00306 Arguments:
00307 
00308     TrapFrame - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a trap frame.
00309 
00310     ContextPointers - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context pointers record.
00311 
00312     ContextRecord - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a context record.
00313 
00314     ProcessorMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode to use when sanitizing
00315         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d2/festate_8h.html#a2">PSR</a> and FSR.
00316 
00317 Return Value:
00318 
00319     None.
00320 
00321 --*/
00322 
00323 {
00324 
00325     ULONG ContextFlags;
00326     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00327 
00328     <span class="comment">//</span>
00329     <span class="comment">// Set context.</span>
00330     <span class="comment">//</span>
00331 
00332     ContextFlags = ContextRecord-&gt;ContextFlags;
00333     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) {
00334 
00335         <span class="comment">//</span>
00336         <span class="comment">// Set integer registers gp, sp, ra, FIR, and PSR.</span>
00337         <span class="comment">//</span>
00338 
00339         TrapFrame-&gt;Fir = ContextRecord-&gt;Fir;
00340         TrapFrame-&gt;Psr = SANITIZE_PSR(ContextRecord-&gt;Psr, ProcessorMode);
00341         <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) {
00342             TrapFrame-&gt;XIntGp = (LONG)ContextRecord-&gt;IntGp;
00343             TrapFrame-&gt;XIntSp = (LONG)ContextRecord-&gt;IntSp;
00344             TrapFrame-&gt;XIntRa = (LONG)ContextRecord-&gt;IntRa;
00345 
00346         } <span class="keywordflow">else</span> {
00347             TrapFrame-&gt;XIntGp = ContextRecord-&gt;XIntGp;
00348             TrapFrame-&gt;XIntSp = ContextRecord-&gt;XIntSp;
00349             TrapFrame-&gt;XIntRa = ContextRecord-&gt;XIntRa;
00350         }
00351     }
00352 
00353     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) {
00354 
00355         <span class="comment">//</span>
00356         <span class="comment">// Set integer registers at - t9, lo, and hi.</span>
00357         <span class="comment">//</span>
00358 
00359         <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) {
00360             TrapFrame-&gt;XIntAt = (LONG)ContextRecord-&gt;IntAt;
00361             TrapFrame-&gt;XIntV0 = (LONG)ContextRecord-&gt;IntV0;
00362             TrapFrame-&gt;XIntV1 = (LONG)ContextRecord-&gt;IntV1;
00363             TrapFrame-&gt;XIntA0 = (LONG)ContextRecord-&gt;IntA0;
00364             TrapFrame-&gt;XIntA1 = (LONG)ContextRecord-&gt;IntA1;
00365             TrapFrame-&gt;XIntA2 = (LONG)ContextRecord-&gt;IntA2;
00366             TrapFrame-&gt;XIntA3 = (LONG)ContextRecord-&gt;IntA3;
00367             TrapFrame-&gt;XIntT0 = (LONG)ContextRecord-&gt;IntT0;
00368             TrapFrame-&gt;XIntT1 = (LONG)ContextRecord-&gt;IntT1;
00369             TrapFrame-&gt;XIntT2 = (LONG)ContextRecord-&gt;IntT2;
00370             TrapFrame-&gt;XIntT3 = (LONG)ContextRecord-&gt;IntT3;
00371             TrapFrame-&gt;XIntT4 = (LONG)ContextRecord-&gt;IntT4;
00372             TrapFrame-&gt;XIntT5 = (LONG)ContextRecord-&gt;IntT5;
00373             TrapFrame-&gt;XIntT6 = (LONG)ContextRecord-&gt;IntT6;
00374             TrapFrame-&gt;XIntT7 = (LONG)ContextRecord-&gt;IntT7;
00375             TrapFrame-&gt;XIntT8 = (LONG)ContextRecord-&gt;IntT8;
00376             TrapFrame-&gt;XIntT9 = (LONG)ContextRecord-&gt;IntT9;
00377             TrapFrame-&gt;XIntLo = (LONG)ContextRecord-&gt;IntLo;
00378             TrapFrame-&gt;XIntHi = (LONG)ContextRecord-&gt;IntHi;
00379 
00380         } <span class="keywordflow">else</span> {
00381             TrapFrame-&gt;XIntAt = ContextRecord-&gt;XIntAt;
00382             TrapFrame-&gt;XIntV0 = ContextRecord-&gt;XIntV0;
00383             TrapFrame-&gt;XIntV1 = ContextRecord-&gt;XIntV1;
00384             TrapFrame-&gt;XIntA0 = ContextRecord-&gt;XIntA0;
00385             TrapFrame-&gt;XIntA1 = ContextRecord-&gt;XIntA1;
00386             TrapFrame-&gt;XIntA2 = ContextRecord-&gt;XIntA2;
00387             TrapFrame-&gt;XIntA3 = ContextRecord-&gt;XIntA3;
00388             TrapFrame-&gt;XIntT0 = ContextRecord-&gt;XIntT0;
00389             TrapFrame-&gt;XIntT1 = ContextRecord-&gt;XIntT1;
00390             TrapFrame-&gt;XIntT2 = ContextRecord-&gt;XIntT2;
00391             TrapFrame-&gt;XIntT3 = ContextRecord-&gt;XIntT3;
00392             TrapFrame-&gt;XIntT4 = ContextRecord-&gt;XIntT4;
00393             TrapFrame-&gt;XIntT5 = ContextRecord-&gt;XIntT5;
00394             TrapFrame-&gt;XIntT6 = ContextRecord-&gt;XIntT6;
00395             TrapFrame-&gt;XIntT7 = ContextRecord-&gt;XIntT7;
00396             TrapFrame-&gt;XIntT8 = ContextRecord-&gt;XIntT8;
00397             TrapFrame-&gt;XIntT9 = ContextRecord-&gt;XIntT9;
00398             TrapFrame-&gt;XIntLo = ContextRecord-&gt;XIntLo;
00399             TrapFrame-&gt;XIntHi = ContextRecord-&gt;XIntHi;
00400         }
00401 
00402         <span class="comment">//</span>
00403         <span class="comment">// Set nonvolatile integer registers s0 - s7, and s8.</span>
00404         <span class="comment">//</span>
00405 
00406         <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a157">CONTEXT_EXTENDED_INTEGER</a>) {
00407             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 7;
00408             <span class="keywordflow">do</span> {
00409                 <span class="keywordflow">if</span> (TrapFrame-&gt;SavedFlag == 0) {
00410                     <a class="code" href="../../d6/d0/psctxmip_8c.html#a1">PspSetSavedValue</a>((LONG)(&amp;ContextRecord-&gt;IntS0)[Index],
00411                                      (&amp;ContextPointers-&gt;XIntS0)[Index]);
00412 
00413                 } <span class="keywordflow">else</span> {
00414                     (&amp;TrapFrame-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (LONG)(&amp;ContextRecord-&gt;IntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00415                 }
00416 
00417                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> -= 1;
00418             } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &gt;= 0);
00419             TrapFrame-&gt;XIntS8 = (LONG)ContextRecord-&gt;IntS8;
00420 
00421         } <span class="keywordflow">else</span> {
00422             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 7;
00423             <span class="keywordflow">do</span> {
00424                 <span class="keywordflow">if</span> (TrapFrame-&gt;SavedFlag == 0) {
00425                     <a class="code" href="../../d6/d0/psctxmip_8c.html#a1">PspSetSavedValue</a>((&amp;ContextRecord-&gt;XIntS0)[Index],
00426                                      (&amp;ContextPointers-&gt;XIntS0)[Index]);
00427 
00428                 } <span class="keywordflow">else</span> {
00429                     (&amp;TrapFrame-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (&amp;ContextRecord-&gt;XIntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00430                 }
00431 
00432                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> -= 1;
00433             } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &gt;= 0);
00434             TrapFrame-&gt;XIntS8 = ContextRecord-&gt;XIntS8;
00435         }
00436     }
00437 
00438     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) {
00439 
00440         <span class="comment">//</span>
00441         <span class="comment">// Set volatile floating registers f0 - f19.</span>
00442         <span class="comment">//</span>
00443 
00444         RtlMoveMemory(&amp;TrapFrame-&gt;FltF0, &amp;ContextRecord-&gt;FltF0,
00445                      <span class="keyword">sizeof</span>(ULONG) * (20));
00446 
00447         <span class="comment">//</span>
00448         <span class="comment">// Set nonvolatile floating registers f20 - f31.</span>
00449         <span class="comment">//</span>
00450 
00451         *ContextPointers-&gt;FltF20 = ContextRecord-&gt;FltF20;
00452         *ContextPointers-&gt;FltF21 = ContextRecord-&gt;FltF21;
00453         *ContextPointers-&gt;FltF22 = ContextRecord-&gt;FltF22;
00454         *ContextPointers-&gt;FltF23 = ContextRecord-&gt;FltF23;
00455         *ContextPointers-&gt;FltF24 = ContextRecord-&gt;FltF24;
00456         *ContextPointers-&gt;FltF25 = ContextRecord-&gt;FltF25;
00457         *ContextPointers-&gt;FltF26 = ContextRecord-&gt;FltF26;
00458         *ContextPointers-&gt;FltF27 = ContextRecord-&gt;FltF27;
00459         *ContextPointers-&gt;FltF28 = ContextRecord-&gt;FltF28;
00460         *ContextPointers-&gt;FltF29 = ContextRecord-&gt;FltF29;
00461         *ContextPointers-&gt;FltF30 = ContextRecord-&gt;FltF30;
00462         *ContextPointers-&gt;FltF31 = ContextRecord-&gt;FltF31;
00463 
00464         <span class="comment">//</span>
00465         <span class="comment">// Set floating status register.</span>
00466         <span class="comment">//</span>
00467 
00468         TrapFrame-&gt;Fsr = SANITIZE_FSR(ContextRecord-&gt;Fsr, ProcessorMode);
00469     }
00470 
00471     <span class="keywordflow">return</span>;
00472 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="psctxmip.c::PspSetSavedValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspSetSavedValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextPointer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00064">64</a> of file <a class="el" href="../../d7/d9/psctxmip_8c-source.html">psctxmip.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00292">PspSetContext()</a>.
<p>
<pre class="fragment"><div>00071                    :
00072 
00073     This function stores <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context value specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> location
00074     specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> argument pointer.
00075 
00076     N.B. The <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> bit of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operand <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00077 
00078 Arguments:
00079 
00080     ContextValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context value to be stored.
00081 
00082     ContextPointer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context value that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00083         stored.
00084 
00085 Return Value:
00086 
00087     None.
00088 
00089 --*/
00090 
00091 {
00092 
00093     <span class="comment">//</span>
00094     <span class="comment">// If the low bit of the argument pointer is zero, then the argument</span>
00095     <span class="comment">// value is 32-bits. Otherwise, the argument value is 64-bits.</span>
00096     <span class="comment">//</span>
00097 
00098     <span class="keywordflow">if</span> (((ULONG)ContextPointer &amp; 1) != 0) {
00099         *((PULONGLONG)((ULONG)ContextPointer &amp; ~1)) = ContextValue;
00100 
00101     } <span class="keywordflow">else</span> {
00102         *((PULONG)ContextPointer) = (ULONG)ContextValue;
00103     }
00104 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:23 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
