<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: immime.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>immime.c File Reference</h1><code>#include "<a class="el" href="../../d9/d2/w32_2ntuser_2imm_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d7/d9/immime_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">tagSELECTCONTEXT_ENUM</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(x)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a>(x)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a2">IME_T_EUDC_DIC_SIZE</a>&nbsp;&nbsp;&nbsp;80</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">tagSELECTCONTEXT_ENUM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a3">SCE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">tagSELECTCONTEXT_ENUM</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a4">PSCE</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a5">NotifyIMEProc</a> (HIMC hImc, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a6">SelectContextProc</a> (HIMC hImc, <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">PSCE</a> psce)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a7">InquireIme</a> (<a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a8">LoadIME</a> (<a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a> piiex, <a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a9">UnloadIME</a> (<a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi, BOOL fTerminateIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a10">LoadImeDpi</a> (HKL hKL, BOOL fLock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a11">FindOrLoadImeDpi</a> (HKL hKL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a12">ImmLoadIME</a> (HKL hKL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a13">ImmUnloadIME</a> (HKL hKL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a14">ImmFreeLayout</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwFlag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a15">ImmActivateLayout</a> (HKL hSelKL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a16">ImmConfigureIMEA</a> (HKL hKL, HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwMode, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a17">ImmConfigureIMEW</a> (HKL hKL, HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwMode, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a18">ImmEscapeA</a> (HKL hKL, HIMC hImc, UINT uSubFunc, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a19">ImmEscapeW</a> (HKL hKL, HIMC hImc, UINT uSubFunc, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a20">ImmPenAuxInput</a> (HWND hwndSender, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a21">ImmSendMessageToActiveDefImeWndW</a> (UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/immime_8c.html#a22">ImmNotifyIME</a> (HIMC hImc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwAction, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIndex, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwValue)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="immime.c::GET_IMEPROC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GET_IMEPROC          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">x&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keywordflow">if</span> (!(pImeDpi-&gt;pfn.##x = (PVOID) GetProcAddress(pImeDpi-&gt;hInst, #x))) {   \
        RIPMSG1(RIP_WARNING, <span class="stringliteral">"LoadIME: "</span> #x <span class="stringliteral">" not supported in %ws"</span>, wszImeFile);           \
        <span class="keywordflow">goto</span> LoadIME_ErrOut; }
</div></pre>
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00131">LoadIME()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="immime.c::GET_IMEPROCT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GET_IMEPROCT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">x&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keywordflow">if</span> (!(pImeDpi-&gt;pfn.##x.t = (PVOID) GetProcAddress(pImeDpi-&gt;hInst, #x))) { \
        RIPMSG1(RIP_WARNING, <span class="stringliteral">"LoadIME: "</span> #x <span class="stringliteral">" not supported in %ws"</span>, wszImeFile);           \
        <span class="keywordflow">goto</span> LoadIME_ErrOut; }
</div></pre>
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00131">LoadIME()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="immime.c::IME_T_EUDC_DIC_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IME_T_EUDC_DIC_SIZE&nbsp;&nbsp;&nbsp;80          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00835">835</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00849">ImmEscapeA()</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00999">ImmEscapeW()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a4" doxytag="immime.c::PSCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">tagSELECTCONTEXT_ENUM</a> * <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">PSCE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="immime.c::SCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">tagSELECTCONTEXT_ENUM</a>  <a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">SCE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="immime.c::FindOrLoadImeDpi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> FindOrLoadImeDpi           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hKL</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">327</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00793">ImmLockImeDpi()</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00149">IS_IME_KBDLAYOUT</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00234">LoadImeDpi()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">ImmConfigureIMEA()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00707">ImmConfigureIMEW()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00539">ImmEnumRegisterWordA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00642">ImmEnumRegisterWordW()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00849">ImmEscapeA()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00999">ImmEscapeW()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01841">ImmGetConversionListA()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01964">ImmGetConversionListW()</a>, <a class="el" href="../../d5/d0/layout_8c-source.html#l00202">ImmGetProperty()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00397">ImmGetRegisterWordStyleA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00469">ImmGetRegisterWordStyleW()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l01128">ImmPenAuxInput()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00025">ImmRegisterWordA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00116">ImmRegisterWordW()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00211">ImmUnregisterWordA()</a>, and <a class="el" href="../../d7/d6/regword_8c-source.html#l00302">ImmUnregisterWordW()</a>.
<p>
<pre class="fragment"><div>00329 {
00330     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00331 
00332     <span class="comment">/*</span>
00333 <span class="comment">     * Non IME based keyboard layout doesn't have IMEDPI.</span>
00334 <span class="comment">     */</span>
00335     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(hKL))
00336         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00337 
00338     pImeDpi = <a class="code" href="../../d9/d0/immuser_8h.html#a45">ImmLockImeDpi</a>(hKL);
00339     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00340         pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a10">LoadImeDpi</a>(hKL, TRUE);
00341 
00342     <span class="keywordflow">return</span> pImeDpi;
00343 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="immime.c::ImmActivateLayout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmActivateLayout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hSelKL</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00495">495</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00508">_CLIENTINFO::CI_flags</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00570">CI_INPUTCONTEXT_REINIT</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00016">tagSELECTCONTEXT_ENUM::hSelKL</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00017">tagSELECTCONTEXT_ENUM::hUnSelKL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d8/d5/w32_2ntuser_2imm_2context_8c-source.html#l01211">ImmEnumInputContext()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00027">ImmGetDefaultIMEWnd()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00346">ImmLoadIME()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00793">ImmLockImeDpi()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00021">NotifyIMEProc()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l13037">NtUserSetThreadLayoutHandles()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00031">SelectContextProc()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>.
<p>
<pre class="fragment"><div>00497 {
00498     HKL     hUnSelKL;
00499     HWND    hWndDefaultIme;
00500     <a class="code" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">SCE</a>     sce;
00501     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwCPS;
00502     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00503     BOOLEAN fOptimizeActivation = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00504 
00505     hUnSelKL = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0);
00506 
00507     {
00508         <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pClientInfo = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00509 
00510         <span class="keywordflow">if</span> (pClientInfo-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> &amp; <a class="code" href="../../d1/d0/inc_2user_8h.html#a105">CI_INPUTCONTEXT_REINIT</a>) {
00511             fOptimizeActivation = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00512         }
00513     }
00514 
00515     <span class="comment">/*</span>
00516 <span class="comment">     * if already current active, do nothing</span>
00517 <span class="comment">     */</span>
00518     <span class="keywordflow">if</span> (hUnSelKL == hSelKL &amp;&amp; fOptimizeActivation)
00519         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00520 
00521     <a class="code" href="../../d9/d0/immuser_8h.html#a37">ImmLoadIME</a>(hSelKL);
00522 
00523     <span class="keywordflow">if</span> (hUnSelKL != hSelKL) {
00524         pImeDpi = <a class="code" href="../../d9/d0/immuser_8h.html#a45">ImmLockImeDpi</a>(hUnSelKL);
00525         <span class="keywordflow">if</span> (pImeDpi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00526             <span class="comment">/*</span>
00527 <span class="comment">             * Send out CPS_CANCEL or CPS_COMPLETE to every input</span>
00528 <span class="comment">             * context assoicated to window(s) created by this thread.</span>
00529 <span class="comment">             * Starting from SUR, we only assoicate input context to window created</span>
00530 <span class="comment">             * by the same thread.</span>
00531 <span class="comment">             */</span>
00532             dwCPS = (pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_COMPLETE_ON_UNSELECT) ? CPS_COMPLETE : CPS_CANCEL;
00533             <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00534             <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a19">ImmEnumInputContext</a>(0, NotifyIMEProc, dwCPS);
00535         }
00536 
00537         hWndDefaultIme = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a4">ImmGetDefaultIMEWnd</a>(NULL);
00538 
00539         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hWndDefaultIme))
00540             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWndDefaultIme, WM_IME_SELECT, FALSE, (LPARAM)hUnSelKL);
00541 
00542         <span class="comment">/*</span>
00543 <span class="comment">         * This is the time to update the kernel side layout handles.</span>
00544 <span class="comment">         * We must do this before sending WM_IME_SELECT.</span>
00545 <span class="comment">         */</span>
00546         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a399">NtUserSetThreadLayoutHandles</a>(hSelKL, hUnSelKL);
00547     }
00548 
00549     <span class="comment">/*</span>
00550 <span class="comment">     * Unselect and select input context(s).</span>
00551 <span class="comment">     */</span>
00552     sce.<a class="code" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html#o0">hSelKL</a>   = hSelKL;
00553     sce.<a class="code" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html#o1">hUnSelKL</a> = hUnSelKL;
00554     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a19">ImmEnumInputContext</a>(0, (IMCENUMPROC)SelectContextProc, (LPARAM)&amp;sce);
00555 
00556     <span class="comment">/*</span>
00557 <span class="comment">     * inform UI select after all hIMC select</span>
00558 <span class="comment">     */</span>
00559     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hWndDefaultIme))
00560         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWndDefaultIme, WM_IME_SELECT, TRUE, (LPARAM)hSelKL);
00561 
00562     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00563 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="immime.c::ImmConfigureIMEA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmConfigureIMEA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">575</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">FindOrLoadImeDpi()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00182">IMECodePage</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00083">tagIMEDPI::_tagImeFunctions::ImeConfigure</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00707">ImmConfigureIMEW()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01178">TestWindowProcess()</a>, and <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00707">ImmConfigureIMEW()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00932">TransEnterWordRegisterMode()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00828">TransSendVKey()</a>.
<p>
<pre class="fragment"><div>00580 {
00581     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pWnd;
00582     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00583     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00584 
00585     <span class="keywordflow">if</span> ((pWnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hWnd)) == (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00586         RIPMSG1(RIP_WARNING,
00587               <span class="stringliteral">"ImmConfigureIMEA: invalid window handle %x"</span>, hWnd);
00588         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00589     }
00590 
00591     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a16">TestWindowProcess</a>(pWnd)) {
00592         RIPMSG1(RIP_WARNING,
00593               <span class="stringliteral">"ImmConfigureIMEA: hWnd=%lx belongs to different process!"</span>, hWnd);
00594         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00595     }
00596 
00597     pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a11">FindOrLoadImeDpi</a>(hKL);
00598     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00599         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmConfigureIMEA: no pImeDpi entry."</span>);
00600         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00601     }
00602 
00603     <span class="keywordflow">if</span> (!(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_UNICODE) || lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00604         <span class="comment">/*</span>
00605 <span class="comment">         * Doesn't need A/W conversion. Calls directly to IME to</span>
00606 <span class="comment">         * bring up the configuration dialogbox.</span>
00607 <span class="comment">         */</span>
00608             <span class="comment">// This message handles by Console IME.</span>
00609             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_IME_SYSTEM, IMS_OPENPROPERTYWINDOW, 0L);
00610         fRet = (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o19">ImeConfigure</a>)(hKL, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, dwMode, lpData);
00611             <span class="comment">// This message handles by Console IME.</span>
00612             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_IME_SYSTEM, IMS_CLOSEPROPERTYWINDOW, 0L);
00613         <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00614         <span class="keywordflow">return</span> fRet;
00615     }
00616 
00617     <span class="comment">/*</span>
00618 <span class="comment">     * ANSI caller, Unicode IME. Needs A/W conversion on lpData when</span>
00619 <span class="comment">     * dwMode == IME_CONFIG_REGISTERWORD. In this case, lpData points</span>
00620 <span class="comment">     * to a structure of REGISTERWORDA.</span>
00621 <span class="comment">     */</span>
00622     <span class="keywordflow">switch</span> (dwMode) {
00623     <span class="keywordflow">case</span> IME_CONFIG_REGISTERWORD:
00624         {
00625             LPREGISTERWORDA lpRegisterWordA;
00626             REGISTERWORDW   RegisterWordW;
00627             <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>          lpBuffer;
00628             ULONG           cbBuffer;
00629             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>             i;
00630 
00631             lpRegisterWordA = (LPREGISTERWORDA)lpData;
00632             cbBuffer = 0;
00633             lpBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00634 
00635             <span class="keywordflow">if</span> (lpRegisterWordA-&gt;lpReading != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00636                 cbBuffer += <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpRegisterWordA-&gt;lpReading) + 1;
00637 
00638             <span class="keywordflow">if</span> (lpRegisterWordA-&gt;lpWord != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00639                 cbBuffer += <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpRegisterWordA-&gt;lpWord) + 1;
00640 
00641             <span class="keywordflow">if</span> (cbBuffer != 0) {
00642                 cbBuffer *= <span class="keyword">sizeof</span>(WCHAR);
00643                 <span class="keywordflow">if</span> ((lpBuffer = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>(0, cbBuffer)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00644                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmConfigureIMEA: memory failure."</span>);
00645                     <span class="keywordflow">break</span>;
00646                 }
00647             }
00648 
00649             <span class="keywordflow">if</span> (lpRegisterWordA-&gt;lpReading != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00650                 RegisterWordW.lpReading = lpBuffer;
00651                 i = MultiByteToWideChar(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00652                                         (DWORD)MB_PRECOMPOSED,
00653                                         (LPSTR)lpRegisterWordA-&gt;lpReading,
00654                                         (INT)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpRegisterWordA-&gt;lpReading),
00655                                         (LPWSTR)RegisterWordW.lpReading,
00656                                         (INT)(cbBuffer/<span class="keyword">sizeof</span>(WCHAR)));
00657                 RegisterWordW.lpReading[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00658                 cbBuffer -= (i * <span class="keyword">sizeof</span>(WCHAR));
00659             }
00660             <span class="keywordflow">else</span> {
00661                 RegisterWordW.lpReading = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00662             }
00663 
00664             <span class="keywordflow">if</span> (lpRegisterWordA-&gt;lpWord != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00665                 <span class="keywordflow">if</span> (RegisterWordW.lpReading != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00666                     RegisterWordW.lpWord = &amp;RegisterWordW.lpReading[i+1];
00667                 <span class="keywordflow">else</span>
00668                     RegisterWordW.lpWord = lpBuffer;
00669                 i = MultiByteToWideChar(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00670                                         (DWORD)MB_PRECOMPOSED,
00671                                         (LPSTR)lpRegisterWordA-&gt;lpWord,
00672                                         (INT)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpRegisterWordA-&gt;lpWord),
00673                                         (LPWSTR)RegisterWordW.lpWord,
00674                                         (INT)(cbBuffer/<span class="keyword">sizeof</span>(WCHAR)));
00675                 RegisterWordW.lpWord[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00676             }
00677             <span class="keywordflow">else</span>
00678                 RegisterWordW.lpWord = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00679 
00680             fRet = <a class="code" href="../../d6/d0/immime_8c.html#a17">ImmConfigureIMEW</a>(hKL, hWnd, dwMode, &amp;RegisterWordW);
00681 
00682             <span class="keywordflow">if</span> (lpBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00683                 <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(lpBuffer);
00684 
00685             <span class="keywordflow">break</span>;
00686         }
00687     <span class="keywordflow">default</span>:
00688         fRet = <a class="code" href="../../d6/d0/immime_8c.html#a17">ImmConfigureIMEW</a>(hKL, hWnd, dwMode, lpData);
00689         <span class="keywordflow">break</span>;
00690     }
00691 
00692     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00693 
00694     <span class="keywordflow">return</span> fRet;
00695 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="immime.c::ImmConfigureIMEW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmConfigureIMEW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00707">707</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">FindOrLoadImeDpi()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00182">IMECodePage</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00083">tagIMEDPI::_tagImeFunctions::ImeConfigure</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">ImmConfigureIMEA()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01178">TestWindowProcess()</a>, and <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">ImmConfigureIMEA()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00932">TransEnterWordRegisterMode()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00828">TransSendVKey()</a>.
<p>
<pre class="fragment"><div>00712 {
00713     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pWnd;
00714     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00715     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00716 
00717     <span class="keywordflow">if</span> ((pWnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hWnd)) == (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00718         RIPMSG1(RIP_WARNING,
00719               <span class="stringliteral">"ImmConfigureIMEA: invalid window handle %x"</span>, hWnd);
00720         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00721     }
00722 
00723     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a16">TestWindowProcess</a>(pWnd)) {
00724         RIPMSG1(RIP_WARNING,
00725               <span class="stringliteral">"ImmConfigureIMEA: hWnd=%lx belongs to different process!"</span>, hWnd);
00726         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00727     }
00728 
00729     pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a11">FindOrLoadImeDpi</a>(hKL);
00730     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00731         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmConfigureIMEA: no pImeDpi entry."</span>);
00732         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00733     }
00734 
00735     <span class="keywordflow">if</span> ((pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_UNICODE) || lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00736         <span class="comment">/*</span>
00737 <span class="comment">         * Doesn't need A/W conversion. Calls directly to IME to</span>
00738 <span class="comment">         * bring up the configuration dialogbox.</span>
00739 <span class="comment">         */</span>
00740             <span class="comment">// This message handles by Console IME.</span>
00741             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_IME_SYSTEM, IMS_OPENPROPERTYWINDOW, 0L);
00742         fRet = (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o19">ImeConfigure</a>)(hKL, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, dwMode, lpData);
00743             <span class="comment">// This message handles by Console IME.</span>
00744             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWnd, WM_IME_SYSTEM, IMS_CLOSEPROPERTYWINDOW, 0L);
00745         <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00746         <span class="keywordflow">return</span> fRet;
00747     }
00748 
00749     <span class="comment">/*</span>
00750 <span class="comment">     * Unicode caller, ANSI IME. Needs A/W conversion on lpData when</span>
00751 <span class="comment">     * dwMode == IME_CONFIG_REGISTERWORD. In this case, lpData points</span>
00752 <span class="comment">     * to a structure of REGISTERWORDW.</span>
00753 <span class="comment">     */</span>
00754     <span class="keywordflow">switch</span> (dwMode) {
00755     <span class="keywordflow">case</span> IME_CONFIG_REGISTERWORD:
00756         {
00757             LPREGISTERWORDW lpRegisterWordW;
00758             REGISTERWORDA   RegisterWordA;
00759             <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>          lpBuffer;
00760             ULONG           cbBuffer;
00761             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            bUDC;
00762             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>             i;
00763 
00764             lpRegisterWordW = (LPREGISTERWORDW)lpData;
00765             cbBuffer = 0;
00766             lpBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00767 
00768             <span class="keywordflow">if</span> (lpRegisterWordW-&gt;lpReading != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00769                 cbBuffer += wcslen(lpRegisterWordW-&gt;lpReading) + 1;
00770 
00771             <span class="keywordflow">if</span> (lpRegisterWordW-&gt;lpWord != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00772                 cbBuffer += wcslen(lpRegisterWordW-&gt;lpWord) + 1;
00773 
00774             <span class="keywordflow">if</span> (cbBuffer != 0) {
00775                 cbBuffer *= <span class="keyword">sizeof</span>(WCHAR);
00776                 <span class="keywordflow">if</span> ((lpBuffer = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>(0, cbBuffer)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00777                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmConfigureIMEW: memory failure."</span>);
00778                     <span class="keywordflow">break</span>;
00779                 }
00780             }
00781 
00782             <span class="keywordflow">if</span> (lpRegisterWordW-&gt;lpReading != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00783                 RegisterWordA.lpReading = lpBuffer;
00784                 i = WideCharToMultiByte(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00785                                         (DWORD)0,
00786                                         (LPWSTR)lpRegisterWordW-&gt;lpReading,
00787                                         (INT)wcslen(lpRegisterWordW-&gt;lpReading),
00788                                         (LPSTR)RegisterWordA.lpReading,
00789                                         (INT)cbBuffer,
00790                                         (LPSTR)NULL,
00791                                         (LPBOOL)&amp;bUDC);
00792                 RegisterWordA.lpReading[i] = <span class="charliteral">'\0'</span>;
00793                 cbBuffer -= (i * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));
00794             }
00795             <span class="keywordflow">else</span> {
00796                 RegisterWordA.lpReading = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00797             }
00798 
00799             <span class="keywordflow">if</span> (lpRegisterWordW-&gt;lpWord != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00800                 <span class="keywordflow">if</span> (RegisterWordA.lpReading != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00801                     RegisterWordA.lpWord = &amp;RegisterWordA.lpReading[i+1];
00802                 <span class="keywordflow">else</span>
00803                     RegisterWordA.lpWord = lpBuffer;
00804                 i = WideCharToMultiByte(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00805                                         (DWORD)0,
00806                                         (LPWSTR)lpRegisterWordW-&gt;lpWord,
00807                                         (INT)wcslen(lpRegisterWordW-&gt;lpWord),
00808                                         (LPSTR)RegisterWordA.lpWord,
00809                                         (INT)cbBuffer,
00810                                         (LPSTR)NULL,
00811                                         (LPBOOL)&amp;bUDC);
00812                 RegisterWordA.lpWord[i] = <span class="charliteral">'\0'</span>;
00813             }
00814             <span class="keywordflow">else</span>
00815                 RegisterWordA.lpWord = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00816 
00817             fRet = <a class="code" href="../../d6/d0/immime_8c.html#a16">ImmConfigureIMEA</a>(hKL, hWnd, dwMode, &amp;RegisterWordA);
00818 
00819             <span class="keywordflow">if</span> (lpBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00820                 <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(lpBuffer);
00821 
00822             <span class="keywordflow">break</span>;
00823         }
00824     <span class="keywordflow">default</span>:
00825         fRet = <a class="code" href="../../d6/d0/immime_8c.html#a16">ImmConfigureIMEA</a>(hKL, hWnd, dwMode, lpData);
00826         <span class="keywordflow">break</span>;
00827     }
00828 
00829     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00830 
00831     <span class="keywordflow">return</span> fRet;
00832 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="immime.c::ImmEscapeA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT WINAPI ImmEscapeA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uSubFunc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00849">849</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">FindOrLoadImeDpi()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00835">IME_T_EUDC_DIC_SIZE</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00182">IMECodePage</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00085">tagIMEDPI::_tagImeFunctions::ImeEscape</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00999">ImmEscapeW()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00999">ImmEscapeW()</a>.
<p>
<pre class="fragment"><div>00854 {
00855     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00856     LRESULT lRet = 0;
00857 
00858     pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a11">FindOrLoadImeDpi</a>(hKL);
00859     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00860         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmEscapeA: no pImeDpi entry."</span>);
00861         <span class="keywordflow">return</span> lRet;
00862     }
00863 
00864     <span class="keywordflow">if</span> ((pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_UNICODE) == 0 || lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00865         <span class="comment">/*</span>
00866 <span class="comment">         * Doesn't need A/W conversion. Calls directly to IME to</span>
00867 <span class="comment">         * bring up the configuration dialogbox.</span>
00868 <span class="comment">         */</span>
00869         lRet = (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o21">ImeEscape</a>)(hImc, uSubFunc, lpData);
00870         <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00871         <span class="keywordflow">return</span> lRet;
00872     }
00873 
00874     <span class="comment">/*</span>
00875 <span class="comment">     * ANSI caller, Unicode IME. Needs A/W conversion depending on</span>
00876 <span class="comment">     * uSubFunc.</span>
00877 <span class="comment">     */</span>
00878     <span class="keywordflow">switch</span> (uSubFunc) {
00879     <span class="keywordflow">case</span> IME_ESC_GET_EUDC_DICTIONARY:
00880     <span class="keywordflow">case</span> IME_ESC_IME_NAME:
00881     <span class="keywordflow">case</span> IME_ESC_GETHELPFILENAME:
00882         {
00883             WCHAR wszData[<a class="code" href="../../d6/d0/immime_8c.html#a2">IME_T_EUDC_DIC_SIZE</a>];
00884             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bUDC;
00885             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>   i;
00886 
00887             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a19">ImmEscapeW</a>(hKL, hImc, uSubFunc, (LPVOID)wszData);
00888 
00889             <span class="keywordflow">if</span> (lRet != 0) {
00890 
00891                 <span class="keywordflow">try</span> {
00892                     i = WideCharToMultiByte(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00893                                             (DWORD)0,
00894                                             (LPWSTR)wszData,         <span class="comment">// src</span>
00895                                             (INT)wcslen(wszData),
00896                                             (LPSTR)lpData,           <span class="comment">// dest</span>
00897                                             (INT)IME_T_EUDC_DIC_SIZE,
00898                                             (LPSTR)NULL,
00899                                             (LPBOOL)&amp;bUDC);
00900                     ((LPSTR)lpData)[i] = <span class="charliteral">'\0'</span>;
00901                 }
00902                 except (EXCEPTION_EXECUTE_HANDLER) {
00903                     lRet = 0;
00904                 }
00905             }
00906 
00907             <span class="keywordflow">break</span>;
00908         }
00909 
00910     <span class="keywordflow">case</span> IME_ESC_SET_EUDC_DICTIONARY:
00911     <span class="keywordflow">case</span> IME_ESC_HANJA_MODE:
00912         {
00913             WCHAR wszData[<a class="code" href="../../d6/d0/immime_8c.html#a2">IME_T_EUDC_DIC_SIZE</a>];
00914             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>   i;
00915 
00916             i = MultiByteToWideChar(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00917                                     (DWORD)MB_PRECOMPOSED,
00918                                     (LPSTR)lpData,             <span class="comment">// src</span>
00919                                     (INT)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpData),
00920                                     (LPWSTR)wszData,          <span class="comment">// dest</span>
00921                                     (INT)<span class="keyword">sizeof</span>(wszData)/<span class="keyword">sizeof</span>(WCHAR));
00922             wszData[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00923 
00924             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a19">ImmEscapeW</a>(hKL, hImc, uSubFunc, (LPVOID)wszData);
00925 
00926             <span class="keywordflow">break</span>;
00927         }
00928 
00929     <span class="keywordflow">case</span> IME_ESC_SEQUENCE_TO_INTERNAL:
00930         {
00931             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    szData[4];
00932             WCHAR   wszData[4];
00933             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>     i = 0;
00934 
00935             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a19">ImmEscapeW</a>(hKL, hImc, uSubFunc, lpData);
00936 
00937             <span class="keywordflow">if</span> (HIWORD(lRet))
00938                 wszData[i++] = HIWORD(lRet);
00939 
00940             <span class="keywordflow">if</span> (LOWORD(lRet))
00941                 wszData[i++] = LOWORD(lRet);
00942 
00943             i = WideCharToMultiByte(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00944                                     (DWORD)0,
00945                                     (LPWSTR)wszData,        <span class="comment">// src</span>
00946                                     (INT)i,
00947                                     (LPSTR)szData,          <span class="comment">// dest</span>
00948                                     (INT)<span class="keyword">sizeof</span>(szData),
00949                                     (LPSTR)NULL,
00950                                     (LPBOOL)NULL);
00951 
00952             <span class="keywordflow">switch</span> (i) {
00953             <span class="keywordflow">case</span> 1:
00954                 lRet = MAKELONG(MAKEWORD(szData[0], 0), 0);
00955                 <span class="keywordflow">break</span>;
00956 
00957             <span class="keywordflow">case</span> 2:
00958                 lRet = MAKELONG(MAKEWORD(szData[1], szData[0]), 0);
00959                 <span class="keywordflow">break</span>;
00960 
00961             <span class="keywordflow">case</span> 3:
00962                 lRet = MAKELONG(MAKEWORD(szData[2], szData[1]), MAKEWORD(szData[0], 0));
00963                 <span class="keywordflow">break</span>;
00964 
00965             <span class="keywordflow">case</span> 4:
00966                 lRet = MAKELONG(MAKEWORD(szData[3], szData[2]), MAKEWORD(szData[1], szData[0]));
00967                 <span class="keywordflow">break</span>;
00968 
00969             <span class="keywordflow">default</span>:
00970                 lRet = 0;
00971                 <span class="keywordflow">break</span>;
00972             }
00973 
00974             <span class="keywordflow">break</span>;
00975         }
00976     <span class="keywordflow">default</span>:
00977         lRet = <a class="code" href="../../d6/d0/immime_8c.html#a19">ImmEscapeW</a>(hKL, hImc, uSubFunc, lpData);
00978         <span class="keywordflow">break</span>;
00979     }
00980 
00981     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00982 
00983     <span class="keywordflow">return</span> lRet;
00984 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="immime.c::ImmEscapeW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT WINAPI ImmEscapeW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uSubFunc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00999">999</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">FindOrLoadImeDpi()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00835">IME_T_EUDC_DIC_SIZE</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00182">IMECodePage</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00085">tagIMEDPI::_tagImeFunctions::ImeEscape</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00849">ImmEscapeA()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00849">ImmEscapeA()</a>.
<p>
<pre class="fragment"><div>01004 {
01005     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
01006     LRESULT lRet = 0;
01007 
01008     pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a11">FindOrLoadImeDpi</a>(hKL);
01009     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01010         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmEscapeW: no pImeDpi entry."</span>);
01011         <span class="keywordflow">return</span> lRet;
01012     }
01013 
01014     <span class="keywordflow">if</span> ((pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_UNICODE) || lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01015         <span class="comment">/*</span>
01016 <span class="comment">         * Doesn't need W/A conversion. Calls directly to IME to</span>
01017 <span class="comment">         * bring up the configuration dialogbox.</span>
01018 <span class="comment">         */</span>
01019         lRet = (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o21">ImeEscape</a>)(hImc, uSubFunc, lpData);
01020         <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
01021         <span class="keywordflow">return</span> lRet;
01022     }
01023 
01024     <span class="comment">/*</span>
01025 <span class="comment">     * Unicode caller, ANSI IME. Needs W/A conversion depending on</span>
01026 <span class="comment">     * uSubFunc.</span>
01027 <span class="comment">     */</span>
01028     <span class="keywordflow">switch</span> (uSubFunc) {
01029     <span class="keywordflow">case</span> IME_ESC_GET_EUDC_DICTIONARY:
01030     <span class="keywordflow">case</span> IME_ESC_IME_NAME:
01031     <span class="keywordflow">case</span> IME_ESC_GETHELPFILENAME:
01032         {
01033             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> szData[<a class="code" href="../../d6/d0/immime_8c.html#a2">IME_T_EUDC_DIC_SIZE</a>];
01034             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>  i;
01035 
01036             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a18">ImmEscapeA</a>(hKL, hImc, uSubFunc, (LPVOID)szData);
01037 
01038             <span class="keywordflow">if</span> (lRet != 0) {
01039 
01040                 <span class="keywordflow">try</span> {
01041                     i = MultiByteToWideChar(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
01042                                             (DWORD)MB_PRECOMPOSED,
01043                                             (LPSTR)szData,          <span class="comment">// src</span>
01044                                             (INT)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(szData),
01045                                             (LPWSTR)lpData,         <span class="comment">// dest</span>
01046                                             (INT)IME_T_EUDC_DIC_SIZE);
01047                     ((LPWSTR)lpData)[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01048                 }
01049                 except (EXCEPTION_EXECUTE_HANDLER) {
01050                     lRet = 0;
01051                 }
01052             }
01053 
01054             <span class="keywordflow">break</span>;
01055         }
01056 
01057     <span class="keywordflow">case</span> IME_ESC_SET_EUDC_DICTIONARY:
01058     <span class="keywordflow">case</span> IME_ESC_HANJA_MODE:
01059         {
01060             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> szData[<a class="code" href="../../d6/d0/immime_8c.html#a2">IME_T_EUDC_DIC_SIZE</a>];
01061             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bUDC;
01062             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>  i;
01063 
01064             i = WideCharToMultiByte(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
01065                                     (DWORD)0,
01066                                     (LPWSTR)lpData,          <span class="comment">// src</span>
01067                                     (INT)wcslen(lpData),
01068                                     (LPSTR)szData,          <span class="comment">// dest</span>
01069                                     (INT)<span class="keyword">sizeof</span>(szData),
01070                                     (LPSTR)NULL,
01071                                     (LPBOOL)&amp;bUDC);
01072             szData[i] = <span class="charliteral">'\0'</span>;
01073 
01074             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a18">ImmEscapeA</a>(hKL, hImc, uSubFunc, (LPVOID)szData);
01075 
01076             <span class="keywordflow">break</span>;
01077         }
01078 
01079     <span class="keywordflow">case</span> IME_ESC_SEQUENCE_TO_INTERNAL:
01080         {
01081             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    szData[4];
01082             WCHAR   wszData[4];
01083             <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>     i = 0;
01084 
01085             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a18">ImmEscapeA</a>(hKL, hImc, uSubFunc, lpData);
01086 
01087             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(lRet)))
01088                 szData[i++] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(lRet));
01089 
01090             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(LOWORD(lRet)))
01091                 szData[i++] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(LOWORD(lRet));
01092 
01093             i = MultiByteToWideChar(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
01094                                     (DWORD)MB_PRECOMPOSED,
01095                                     (LPSTR)szData,            <span class="comment">// src</span>
01096                                     i,
01097                                     (LPWSTR)wszData,          <span class="comment">// dest</span>
01098                                     (INT)<span class="keyword">sizeof</span>(wszData)/<span class="keyword">sizeof</span>(WCHAR));
01099 
01100             <span class="keywordflow">switch</span> (i) {
01101             <span class="keywordflow">case</span> 1:
01102                 lRet = MAKELONG(wszData[0], 0);
01103                 <span class="keywordflow">break</span>;
01104 
01105             <span class="keywordflow">case</span> 2:
01106                 lRet = MAKELONG(wszData[1], wszData[0]);
01107                 <span class="keywordflow">break</span>;
01108 
01109             <span class="keywordflow">default</span>:
01110                 lRet = 0;
01111                 <span class="keywordflow">break</span>;
01112             }
01113 
01114             <span class="keywordflow">break</span>;
01115         }
01116 
01117     <span class="keywordflow">default</span>:
01118         lRet = <a class="code" href="../../d6/d0/immime_8c.html#a18">ImmEscapeA</a>(hKL, hImc, uSubFunc, lpData);
01119         <span class="keywordflow">break</span>;
01120     }
01121 
01122     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
01123 
01124     <span class="keywordflow">return</span> lRet;
01125 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="immime.c::ImmFreeLayout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmFreeLayout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwFlag</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00416">416</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00034">gcsImeDpi</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00033">gpImeDpi</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00069">tagIMEDPI::hKL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00052">IFL_DEACTIVATEIME</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00053">IFL_UNLOADIME</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00365">ImmUnloadIME()</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00149">IS_IME_KBDLAYOUT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04463">LoadKeyboardLayoutW()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00067">tagIMEDPI::pNext</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>.
<p>
<pre class="fragment"><div>00418 {
00419     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00420     HKL   *phklRoot, hklCurrent;
00421     WCHAR  pwszNonImeKLID[KL_NAMELENGTH];
00422     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   nLayouts, uNonImeKLID = 0, i;
00423 
00424     hklCurrent = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0);
00425 
00426     <span class="keywordflow">switch</span> (dwFlag) {
00427 
00428     <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/immstruc_8h.html#a15">IFL_DEACTIVATEIME</a>:
00429         <span class="comment">/*</span>
00430 <span class="comment">         * Do nothing if no IME to be deactivated.</span>
00431 <span class="comment">         */</span>
00432         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(hklCurrent))
00433             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00434 
00435         <span class="comment">/*</span>
00436 <span class="comment">         * Deactivate IME based layout by activating a non-IME based</span>
00437 <span class="comment">         * keyboard layout.</span>
00438 <span class="comment">         */</span>
00439         uNonImeKLID = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)LANGIDFROMLCID(GetSystemDefaultLCID());
00440 
00441         nLayouts = GetKeyboardLayoutList(0, NULL);
00442 
00443         <span class="keywordflow">if</span> (nLayouts != 0) {
00444             phklRoot = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>(0, nLayouts * <span class="keyword">sizeof</span>(HKL));
00445             <span class="keywordflow">if</span> (phklRoot == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00446                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00447 
00448             nLayouts = GetKeyboardLayoutList(nLayouts, phklRoot);
00449 
00450             <span class="keywordflow">for</span> (i = 0; i &lt; nLayouts &amp;&amp; <a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(phklRoot[i]); i++) ;
00451 
00452             <span class="keywordflow">if</span> (i &lt; nLayouts)
00453                 uNonImeKLID = HandleToUlong(phklRoot[i]) &amp; 0xffff;
00454 
00455             <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(phklRoot);
00456         }
00457 
00458         wsprintf(pwszNonImeKLID, L<span class="stringliteral">"%08x"</span>, uNonImeKLID);
00459 
00460         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/client_8c.html#a151">LoadKeyboardLayoutW</a>(pwszNonImeKLID, KLF_ACTIVATE) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00461             RIPMSG1(RIP_WARNING, <span class="stringliteral">"ImmFreeLayout: LoadKeyboardLayoutW(%S, KLF_ACTIVATE) failed. Trying 00000409"</span>, pwszNonImeKLID);
00462             <span class="comment">// Somehow it failed (probably a bad setup), let's try</span>
00463             <span class="comment">// 409 KL, which should be installed on all localized NTs.</span>
00464             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/client_8c.html#a151">LoadKeyboardLayoutW</a>(L<span class="stringliteral">"00000409"</span>, KLF_ACTIVATE | KLF_FAILSAFE) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00465                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"LoadKeyboardLayoutW(00000409) failed either. will try NULL."</span>);
00466             }
00467         }
00468 
00469         <span class="keywordflow">break</span>;
00470 
00471     <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/immstruc_8h.html#a16">IFL_UNLOADIME</a>:
00472         RtlEnterCriticalSection(&amp;gcsImeDpi);
00473 UnloadImeDpiLoop:
00474         <span class="keywordflow">for</span> (pImeDpi = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a>; pImeDpi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pImeDpi = pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a>) {
00475             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0/immuser_8h.html#a38">ImmUnloadIME</a>(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o2">hKL</a>))
00476                 <span class="keywordflow">goto</span> UnloadImeDpiLoop;        <span class="comment">// Rescan as list was updated.</span>
00477         }
00478         RtlLeaveCriticalSection(&amp;gcsImeDpi);
00479         <span class="keywordflow">break</span>;
00480 
00481     <span class="keywordflow">default</span>:
00482         {
00483             HKL hklFlag = (HKL)LongToHandle( dwFlag );
00484             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(hklFlag) &amp;&amp; hklFlag != hklCurrent) {
00485                 <a class="code" href="../../d9/d0/immuser_8h.html#a38">ImmUnloadIME</a>(hklFlag);
00486             }
00487         }
00488         <span class="keywordflow">break</span>;
00489     }
00490 
00491     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00492 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="immime.c::ImmLoadIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmLoadIME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hKL</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00346">346</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00769">ImmGetImeDpi()</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00149">IS_IME_KBDLAYOUT</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00234">LoadImeDpi()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00495">ImmActivateLayout()</a>.
<p>
<pre class="fragment"><div>00348 {
00349     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00350 
00351     <span class="comment">/*</span>
00352 <span class="comment">     * Non IME based keyboard layout doesn't have IMEDPI.</span>
00353 <span class="comment">     */</span>
00354     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d5/conimep_8h.html#a49">IS_IME_KBDLAYOUT</a>(hKL))
00355         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00356 
00357     pImeDpi = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a30">ImmGetImeDpi</a>(hKL);
00358     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00359         pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a10">LoadImeDpi</a>(hKL, FALSE);
00360 
00361     <span class="keywordflow">return</span> (pImeDpi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00362 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="immime.c::ImmNotifyIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmNotifyIME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwAction</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l01294">1294</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00152">GetInputContextThread</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00793">ImmLockImeDpi()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00090">tagIMEDPI::_tagImeFunctions::NotifyIME</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, and <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00955">ImmSystemHandler()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00021">NotifyIMEProc()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l00080">OpenCandidateJapan()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l00606">OpenCandidateKorea()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l00433">OpenCandidatePRC()</a>, <a class="el" href="../../d8/d6/country2_8c-source.html#l00264">OpenCandidateTaiwan()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00828">TransSendVKey()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00331">TransSetOpenJ()</a>.
<p>
<pre class="fragment"><div>01299 {
01300     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
01301     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    bRet;
01302 
01303     <span class="keywordflow">if</span> (hImc != <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> &amp;&amp;
01304             <a class="code" href="../../d4/d0/immcli_8h.html#a15">GetInputContextThread</a>(hImc) != GetCurrentThreadId()) {
01305         RIPMSG1(RIP_WARNING,
01306               <span class="stringliteral">"ImmNotifyIME: Invalid input context access %lx."</span>, hImc);
01307         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01308     }
01309 
01310     pImeDpi = <a class="code" href="../../d9/d0/immuser_8h.html#a45">ImmLockImeDpi</a>(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0));
01311     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01312         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01313 
01314     bRet = (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o26">NotifyIME</a>)(hImc, dwAction, dwIndex, dwValue);
01315 
01316     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
01317 
01318     <span class="keywordflow">return</span> bRet;
01319 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="immime.c::ImmPenAuxInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmPenAuxInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndSender</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l01128">1128</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">FindOrLoadImeDpi()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00090">GetFocus()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00643">GetKeyboardLayoutCP()</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00085">tagIMEDPI::_tagImeFunctions::ImeEscape</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00059">ImmAssert</a>, <a class="el" href="../../d8/d5/w32_2ntuser_2imm_2context_8c-source.html#l00201">ImmGetContext()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01129 {
01130     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01131     PCOPYDATASTRUCT lpCopyData = (PCOPYDATASTRUCT)lpData;
01132     PENINPUTDATA* lpPenInputData = (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)lpCopyData-&gt;lpData;
01133     IMEPENDATA ImePenData;
01134     HWND hwnd;
01135     HIMC himc;
01136     HKL hkl;
01137     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwData = 0 ;
01138     LPDWORD lpdwData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01139 
01140     UNREFERENCED_PARAMETER(hwndSender);
01141 
01142     <span class="keywordflow">if</span> (lpCopyData-&gt;dwData != LM_IMM_MAGIC || lpCopyData-&gt;cbData &lt; <span class="keyword">sizeof</span>(PENINPUTDATA)) {
01143         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: invalid COPYDATASTRUCT signagure."</span>);
01144         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01145     }
01146 
01147     <span class="keywordflow">if</span> (lpPenInputData-&gt;dwVersion != 0) {
01148         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: invalid Pendata version."</span>);
01149         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01150     }
01151 
01152     hwnd = <a class="code" href="../../d3/d8/winmgrc_8c.html#a11">GetFocus</a>();
01153     hkl = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0);
01154     <span class="keywordflow">if</span> (hwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || hkl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || (himc = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01155         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: hwnd, hkl or himc cannot be aquired."</span>);
01156         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01157     }
01158 
01159     <span class="keywordflow">if</span> ((pImeDpi = <a class="code" href="../../d6/d0/immime_8c.html#a11">FindOrLoadImeDpi</a>(hkl)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01160         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: IME DPI cannot be found."</span>);
01161         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01162     }
01163 
01164     <span class="keywordflow">do</span> {    <span class="comment">// dummy loop (execute just once) so that we can 'break' in case of unexpected errors</span>
01165         dwData = IME_ESC_PENAUXDATA;
01166         <span class="keywordflow">if</span> (!pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o21">ImeEscape</a>(himc, IME_ESC_QUERY_SUPPORT, (LPVOID)&amp;dwData)) {
01167             <span class="comment">//</span>
01168             <span class="comment">// IME_ESC_PENAUXDATA is not supported by the current IME.</span>
01169             <span class="comment">//</span>
01170             RIPMSG1(RIP_VERBOSE, <span class="stringliteral">"ImmPenAuxInput: IME(hkl=%08x) does not support IME_ESC_PENDATA"</span>, hkl);
01171             <span class="keywordflow">break</span>;
01172         }
01173 
01174         dwData = 0; <span class="comment">// Be prepared for unexpected exodus</span>
01175 
01176         <span class="comment">//</span>
01177         <span class="comment">// Makeup the IMEPENDATA structure.</span>
01178         <span class="comment">//</span>
01179 
01180         RtlZeroMemory(&amp;ImePenData, <span class="keyword">sizeof</span> ImePenData);
01181 
01182         ImePenData.dwCount = lpPenInputData-&gt;cnt;
01183 
01184         <span class="keywordflow">if</span> (lpPenInputData-&gt;flags &amp; ~(LMDATA_SYMBOL_DWORD | LMDATA_SKIP_WORD | LMDATA_SCORE_WORD)) {
01185             RIPMSG1(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: flag out of range (0x%08x)"</span>, lpPenInputData-&gt;flags);
01186         }
01187 
01188         <span class="comment">//</span>
01189         <span class="comment">// Setup the structure for IME.</span>
01190         <span class="comment">//</span>
01191 
01192         <span class="keywordflow">if</span> (lpPenInputData-&gt;flags &amp; LMDATA_SYMBOL_DWORD) {
01193             <span class="keywordflow">if</span> (lpPenInputData-&gt;dwOffsetSymbols &gt; lpCopyData-&gt;cbData ||
01194                     lpPenInputData-&gt;dwOffsetSymbols + lpPenInputData-&gt;cnt * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) &gt; lpCopyData-&gt;cbData) {
01195                 <span class="comment">//</span>
01196                 <span class="comment">// Invalid structure</span>
01197                 <span class="comment">//</span>
01198                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: illegal dwOffsetSymbols (0x%x)"</span>, lpPenInputData-&gt;dwOffsetSymbols);
01199                 <span class="keywordflow">break</span>;
01200             }
01201             ImePenData.wd.lpSymbol = (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)&amp;lpPenInputData-&gt;ab[lpPenInputData-&gt;dwOffsetSymbols];
01202             ImePenData.dwFlags |= IME_PEN_SYMBOL;
01203 
01204             <span class="comment">//</span>
01205             <span class="comment">// If it's ANSI IME, we need to translate the symbols</span>
01206             <span class="comment">//</span>
01207             <span class="keywordflow">if</span> ((pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_UNICODE) == 0) {
01208                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> wCodePage = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a26">GetKeyboardLayoutCP</a>(hkl);
01209                 <span class="keywordtype">int</span> i;
01210 
01211                 lpdwData = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>(HEAP_ZERO_MEMORY, <span class="keyword">sizeof</span> *lpdwData * ImePenData.dwCount);
01212                 <span class="keywordflow">if</span> (lpdwData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01213                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: could not allocate lpdwData"</span>);
01214                     <span class="keywordflow">break</span>;
01215                 }
01216                 <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keywordtype">int</span>)ImePenData.dwCount; ++i) {
01217                     LPSTR lpstr = (LPSTR)(lpdwData + i);
01218 
01219                     <span class="comment">// Assuming little endian:</span>
01220                     WCSToMBEx(wCodePage,
01221                               (LPCWSTR)(ImePenData.wd.lpSymbol + i), 1,
01222                               &amp;lpstr, 2,
01223                               FALSE);
01224                     <a class="code" href="../../d4/d0/immcli_8h.html#a2">ImmAssert</a>(HIWORD(lpdwData[i]) == 0);
01225 
01226                     <span class="comment">// Copy the high word (column #).</span>
01227                     lpdwData[i] |= (ImePenData.wd.lpSymbol[i] &amp; ~0xffff);
01228                 }
01229                 ImePenData.wd.lpSymbol = lpdwData;
01230             }
01231 
01232         }
01233 
01234         <span class="keywordflow">if</span> (lpPenInputData-&gt;flags &amp; LMDATA_SKIP_WORD) {
01235             <span class="keywordflow">if</span> (lpPenInputData-&gt;dwOffsetSkip &gt; lpCopyData-&gt;cbData ||
01236                     lpPenInputData-&gt;dwOffsetSkip + lpPenInputData-&gt;cnt * <span class="keyword">sizeof</span>(WORD) &gt; lpCopyData-&gt;cbData) {
01237                 <span class="comment">//</span>
01238                 <span class="comment">// Invalid structure</span>
01239                 <span class="comment">//</span>
01240                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: illegal dwOffsetSkip (0x%x)"</span>, lpPenInputData-&gt;dwOffsetSkip);
01241                 <span class="keywordflow">break</span>;
01242             }
01243             ImePenData.wd.lpSkip = (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)&amp;lpPenInputData-&gt;ab[lpPenInputData-&gt;dwOffsetSkip];
01244             ImePenData.dwFlags |= IME_PEN_SKIP;
01245         }
01246 
01247         <span class="keywordflow">if</span> (lpPenInputData-&gt;flags &amp; LMDATA_SCORE_WORD) {
01248             <span class="keywordflow">if</span> (lpPenInputData-&gt;dwOffsetScore &gt; lpCopyData-&gt;cbData ||
01249                     lpPenInputData-&gt;dwOffsetScore + lpPenInputData-&gt;cnt * <span class="keyword">sizeof</span>(WORD) &gt; lpCopyData-&gt;cbData) {
01250                 <span class="comment">//</span>
01251                 <span class="comment">// Invalid structure</span>
01252                 <span class="comment">//</span>
01253                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"ImmPenAuxInput: illegal dwOffsetScore (0x%x)"</span>, lpPenInputData-&gt;dwOffsetScore);
01254                 <span class="keywordflow">break</span>;
01255             }
01256             ImePenData.wd.lpScore = (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)&amp;lpPenInputData-&gt;ab[lpPenInputData-&gt;dwOffsetScore];
01257             ImePenData.dwFlags |= IME_PEN_SCORE;
01258         }
01259         dwData = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o21">ImeEscape</a>(himc, IME_ESC_PENAUXDATA, &amp;ImePenData);
01260     } <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01261 
01262     <span class="keywordflow">if</span> (lpdwData) {
01263         <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(lpdwData);
01264     }
01265 
01266     <a class="code" href="../../d4/d0/immcli_8h.html#a2">ImmAssert</a>(pImeDpi);
01267     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
01268 
01269     <span class="keywordflow">return</span> dwData;
01270 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="immime.c::ImmSendMessageToActiveDefImeWndW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT WINAPI ImmSendMessageToActiveDefImeWndW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l01272">1272</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09643">NtUserQueryWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>.
<p>
<pre class="fragment"><div>01276 {
01277     HWND hwndIme;
01278 
01279     <span class="comment">//</span>
01280     <span class="comment">// Today we only support this for WM_COPYDATA</span>
01281     <span class="comment">//</span>
01282     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_COPYDATA) {
01283         <span class="keywordflow">return</span> 0;
01284     }
01285 
01286     hwndIme = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a328">NtUserQueryWindow</a>((HWND)wParam, WindowActiveDefaultImeWindow);
01287     <span class="keywordflow">if</span> (hwndIme == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01288         <span class="keywordflow">return</span> 0;
01289     }
01290 
01291     <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwndIme, msg, wParam, lParam);
01292 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="immime.c::ImmUnloadIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ImmUnloadIME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hKL</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00365">365</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00073">tagIMEDPI::cLock</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00074">tagIMEDPI::dwFlag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00034">gcsImeDpi</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00033">gpImeDpi</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00069">tagIMEDPI::hKL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00063">IMEDPI_UNLOADED</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00067">tagIMEDPI::pNext</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00212">UnloadIME()</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00416">ImmFreeLayout()</a>.
<p>
<pre class="fragment"><div>00367 {
00368     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi, pImeDpiT;
00369 
00370     RtlEnterCriticalSection(&amp;gcsImeDpi);
00371 
00372     pImeDpi = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a>;
00373 
00374     <span class="keywordflow">while</span> (pImeDpi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o2">hKL</a> != hKL)
00375         pImeDpi = pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a>;
00376 
00377     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00378         RtlLeaveCriticalSection(&amp;gcsImeDpi);
00379         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00380     }
00381     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o6">cLock</a> != 0) {
00382         pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o7">dwFlag</a> |= <a class="code" href="../../d9/d0/immuser_8h.html#a4">IMEDPI_UNLOADED</a>;
00383         RtlLeaveCriticalSection(&amp;gcsImeDpi);
00384         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00385     }
00386 
00387     <span class="comment">/*</span>
00388 <span class="comment">     * Unlink it.</span>
00389 <span class="comment">     */</span>
00390     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a> == pImeDpi) {
00391         <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a> = pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a>;
00392     }
00393     <span class="keywordflow">else</span> {
00394         pImeDpiT = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a>;
00395 
00396         <span class="keywordflow">while</span> (pImeDpiT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pImeDpiT-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a> != pImeDpi)
00397             pImeDpiT = pImeDpiT-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a>;
00398 
00399         <span class="keywordflow">if</span> (pImeDpiT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00400             pImeDpiT-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a> = pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a>;
00401     }
00402 
00403     <span class="comment">/*</span>
00404 <span class="comment">     * Unload the IME DLL.</span>
00405 <span class="comment">     */</span>
00406     <a class="code" href="../../d6/d0/immime_8c.html#a9">UnloadIME</a>(pImeDpi, TRUE);
00407 
00408     <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(pImeDpi);
00409 
00410     RtlLeaveCriticalSection(&amp;gcsImeDpi);
00411 
00412     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00413 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="immime.c::InquireIme" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InquireIme           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pImeDpi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00040">40</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00071">tagIMEDPI::dwCodePage</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00068">tagIMEDPI::hInst</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00067">IM_UI_CLASS_SIZE</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00182">IMECodePage</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o3">tagIMEDPI::_tagImeFunctions::ImeInquire</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07799">NtUserGetThreadState()</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02827">TIF_16BIT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d0/d0/immuser_8h-source.html#l00072">tagIMEDPI::wszUIClass</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00131">LoadIME()</a>.
<p>
<pre class="fragment"><div>00042 {
00043     WNDCLASS    wc;
00044     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        ClassName[<a class="code" href="../../d8/d0/immstruc_8h.html#a24">IM_UI_CLASS_SIZE</a> * <span class="keyword">sizeof</span>(WCHAR)];
00045     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwSystemInfoFlags;
00046     PIMEINFO    pImeInfo = &amp;pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>;
00047 
00048     dwSystemInfoFlags = (<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a287">NtUserGetThreadState</a>(UserThreadStateIsWinlogonThread))
00049                       ? IME_SYSINFO_WINLOGON : 0;
00050 
00051     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;dwTIFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>)
00052         dwSystemInfoFlags |= IME_SYSINFO_WOW16;
00053 
00054     (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o3">ImeInquire</a>.w)(pImeInfo, (PVOID)ClassName, dwSystemInfoFlags);
00055 
00056     <span class="comment">/*</span>
00057 <span class="comment">     * parameter checking for each fields.</span>
00058 <span class="comment">     */</span>
00059     <span class="keywordflow">if</span> (pImeInfo-&gt;dwPrivateDataSize == 0)
00060         pImeInfo-&gt;dwPrivateDataSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>);
00061 
00062     <span class="keywordflow">if</span> (pImeInfo-&gt;fdwProperty &amp; ~(IME_PROP_ALL)) {
00063         RIPMSG0(RIP_WARNING, <span class="stringliteral">"wrong property"</span>);
00064         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00065     }
00066 
00067     <span class="keywordflow">if</span> (pImeInfo-&gt;fdwConversionCaps &amp; ~(IME_CMODE_ALL)) {
00068         RIPMSG0(RIP_WARNING, <span class="stringliteral">"wrong conversion capabilities"</span>);
00069         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00070     }
00071 
00072     <span class="keywordflow">if</span> (pImeInfo-&gt;fdwSentenceCaps &amp; ~(IME_SMODE_ALL)) {
00073         RIPMSG0(RIP_WARNING, <span class="stringliteral">"wrong sentence capabilities"</span>);
00074         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00075     }
00076 
00077     <span class="keywordflow">if</span> (pImeInfo-&gt;fdwUICaps &amp; ~(UI_CAP_ALL)) {
00078         RIPMSG0(RIP_WARNING, <span class="stringliteral">"wrong UI capabilities"</span>);
00079         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00080     }
00081 
00082     <span class="keywordflow">if</span> (pImeInfo-&gt;fdwSCSCaps &amp; ~(SCS_CAP_ALL)) {
00083         RIPMSG0(RIP_WARNING, <span class="stringliteral">"wrong set comp string capabilities"</span>);
00084         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00085     }
00086 
00087     <span class="keywordflow">if</span> (pImeInfo-&gt;fdwSelectCaps &amp; ~(SELECT_CAP_ALL)) {
00088         RIPMSG0(RIP_WARNING, <span class="stringliteral">"wrong select capabilities"</span>);
00089         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00090     }
00091 
00092     <span class="keywordflow">if</span> (!(pImeInfo-&gt;fdwProperty &amp; IME_PROP_UNICODE)) {
00093 
00094         <span class="comment">/*</span>
00095 <span class="comment">         * This is ANSI IME. Ensure that it is usable under current system</span>
00096 <span class="comment">         * codepage.</span>
00097 <span class="comment">         */</span>
00098         <span class="keywordflow">if</span> (pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o4">dwCodePage</a> != GetACP() &amp;&amp; pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o4">dwCodePage</a> != CP_ACP) {
00099             <span class="comment">// Note: in the future, if possible, these reference to dwCodepage</span>
00100             <span class="comment">// should be IMECodePage()...</span>
00101             RIPMSG1(RIP_WARNING, <span class="stringliteral">"incompatible codepage(%d) for ANSI IME"</span>, pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o4">dwCodePage</a>);
00102             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00103         }
00104 
00105         <span class="comment">/*</span>
00106 <span class="comment">         * ANSI -&gt; Unicode Class name.</span>
00107 <span class="comment">         */</span>
00108         MultiByteToWideChar(<a class="code" href="../../d4/d0/immcli_8h.html#a25">IMECodePage</a>(pImeDpi),
00109                             (DWORD)MB_PRECOMPOSED,
00110                             (LPSTR)ClassName,               <span class="comment">// src</span>
00111                             (INT)-1,
00112                             pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>,            <span class="comment">// dest</span>
00113                             IM_UI_CLASS_SIZE);
00114     } <span class="keywordflow">else</span> {
00115         RtlCopyMemory(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>, ClassName, <span class="keyword">sizeof</span>(ClassName));
00116     }
00117     pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>[<a class="code" href="../../d8/d0/immstruc_8h.html#a24">IM_UI_CLASS_SIZE</a>-1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00118 
00119     <span class="keywordflow">if</span> (!GetClassInfoW((HINSTANCE)pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a>, pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>, &amp;wc)) {
00120         RIPMSG1(RIP_WARNING, <span class="stringliteral">"UI class (%ws) not found in this IME"</span>, pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>);
00121         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wc.cbWndExtra &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) * 2) {
00123         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UI class cbWndExtra problem"</span>);
00124         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00125     }
00126 
00127     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00128 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="immime.c::LoadIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL LoadIME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>piiex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pImeDpi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00131">131</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00105">tagIMEINFOEX::fLoadFlag</a>, <a class="el" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a>, <a class="el" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00095">GetSystemPathName()</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00068">tagIMEDPI::hInst</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00062">IMEF_LOADED</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00061">IMEF_LOADERROR</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00060">IMEF_NONLOAD</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00092">tagIMEDPI::_tagImeFunctions::ImeGetImeMenuItems</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00101">tagIMEINFOEX::ImeInfo</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00040">InquireIme()</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12800">NtUserSetImeInfoEx()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00109">tagIMEINFOEX::wszImeFile</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00072">tagIMEDPI::wszUIClass</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00102">tagIMEINFOEX::wszUIClass</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00234">LoadImeDpi()</a>.
<p>
<pre class="fragment"><div>00134 {
00135     WCHAR wszImeFile[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00136     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fSuccess;
00137 
00138     <a class="code" href="../../d3/d1/layime_8c.html#a17">GetSystemPathName</a>(wszImeFile, piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o9">wszImeFile</a>, MAX_PATH);
00139 
00140     pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a> = LoadLibraryW(wszImeFile);
00141 
00142     <span class="keywordflow">if</span> (!pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a>) {
00143         RIPMSG1(RIP_WARNING, <span class="stringliteral">"LoadIME: LoadLibraryW(%ws) failed"</span>, wszImeFile);
00144         <span class="keywordflow">goto</span> LoadIME_ErrOut;
00145     }
00146 
00147 <span class="preprocessor">#define GET_IMEPROCT(x) \</span>
00148 <span class="preprocessor">    if (!(pImeDpi-&gt;pfn.##x.t = (PVOID) GetProcAddress(pImeDpi-&gt;hInst, #x))) { \</span>
00149 <span class="preprocessor">        RIPMSG1(RIP_WARNING, "LoadIME: " #x " not supported in %ws", wszImeFile);           \</span>
00150 <span class="preprocessor">        goto LoadIME_ErrOut; }</span>
00151 <span class="preprocessor"></span>
00152 <span class="preprocessor">#define GET_IMEPROC(x) \</span>
00153 <span class="preprocessor">    if (!(pImeDpi-&gt;pfn.##x = (PVOID) GetProcAddress(pImeDpi-&gt;hInst, #x))) {   \</span>
00154 <span class="preprocessor">        RIPMSG1(RIP_WARNING, "LoadIME: " #x " not supported in %ws", wszImeFile);           \</span>
00155 <span class="preprocessor">        goto LoadIME_ErrOut; }</span>
00156 <span class="preprocessor"></span>
00157     <a class="code" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(ImeInquire);
00158     <a class="code" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(ImeConversionList);
00159     <a class="code" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(ImeRegisterWord);
00160     <a class="code" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(ImeUnregisterWord);
00161     <a class="code" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(ImeGetRegisterWordStyle);
00162     <a class="code" href="../../d6/d0/immime_8c.html#a0">GET_IMEPROCT</a>(ImeEnumRegisterWord);
00163     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeConfigure);
00164     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeDestroy);
00165     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeEscape);
00166     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeProcessKey);
00167     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeSelect);
00168     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeSetActiveContext);
00169     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeToAsciiEx);
00170     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (NotifyIME);
00171     <a class="code" href="../../d6/d0/immime_8c.html#a1">GET_IMEPROC</a> (ImeSetCompositionString);
00172 
00173     <span class="comment">// 4.0 IMEs don't have this entry. could be NULL.</span>
00174     pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o28">ImeGetImeMenuItems</a> = (PVOID)GetProcAddress(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a>, <span class="stringliteral">"ImeGetImeMenuItems"</span>);
00175 
00176 <span class="preprocessor">#undef GET_IMEPROCT</span>
00177 <span class="preprocessor"></span><span class="preprocessor">#undef GET_IMEPROC</span>
00178 <span class="preprocessor"></span>
00179     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/immime_8c.html#a7">InquireIme</a>(pImeDpi)) {
00180         RIPMSG0(RIP_WARNING, <span class="stringliteral">"LoadIME: InquireIme failed"</span>);
00181 LoadIME_ErrOut:
00182         FreeLibrary(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a>);
00183         pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00184         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00185     }
00186     <span class="keywordflow">else</span> {
00187         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00188     }
00189 
00190     <span class="comment">/*</span>
00191 <span class="comment">     * Update kernel side IMEINFOEX for this keyboard layout if</span>
00192 <span class="comment">     * this is its first loading.</span>
00193 <span class="comment">     */</span>
00194     <span class="keywordflow">if</span> (piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o5">fLoadFlag</a> == <a class="code" href="../../d8/d0/immstruc_8h.html#a18">IMEF_NONLOAD</a>) {
00195         <span class="keywordflow">if</span> (fSuccess) {
00196             RtlCopyMemory((PBYTE)&amp;piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>,
00197                           (PBYTE)&amp;pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>, <span class="keyword">sizeof</span>(IMEINFO));
00198             RtlCopyMemory((PBYTE)piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o2">wszUIClass</a>,
00199                           (PBYTE)pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>, <span class="keyword">sizeof</span>(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>));
00200             piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o5">fLoadFlag</a> = <a class="code" href="../../d8/d0/immstruc_8h.html#a20">IMEF_LOADED</a>;
00201         }
00202         <span class="keywordflow">else</span> {
00203             piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o5">fLoadFlag</a> = <a class="code" href="../../d8/d0/immstruc_8h.html#a19">IMEF_LOADERROR</a>;
00204         }
00205         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a392">NtUserSetImeInfoEx</a>(piiex);
00206     }
00207 
00208     <span class="keywordflow">return</span> fSuccess;
00209 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="immime.c::LoadImeDpi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> LoadImeDpi           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fLock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00234">234</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d0/d0/immuser_8h-source.html#l00073">tagIMEDPI::cLock</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00071">tagIMEDPI::dwCodePage</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00074">tagIMEDPI::dwFlag</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00105">tagIMEINFOEX::fLoadFlag</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00034">gcsImeDpi</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00033">gpImeDpi</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00069">tagIMEDPI::hKL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00064">IMEDPI_UNLOCKUNLOAD</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00061">IMEF_LOADERROR</a>, <a class="el" href="../../d8/d0/immstruc_8h.html#a75a52">ImeInfoExKeyboardLayout</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00769">ImmGetImeDpi()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00876">ImmGetImeInfoEx()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00131">LoadIME()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00067">tagIMEDPI::pNext</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00212">UnloadIME()</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00327">FindOrLoadImeDpi()</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00346">ImmLoadIME()</a>.
<p>
<pre class="fragment"><div>00237 {
00238     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>        pImeDpi, pImeDpiT;
00239     <a class="code" href="../../d0/d8/structtagIMEINFOEX.html">IMEINFOEX</a>      iiex;
00240 
00241     <span class="comment">/*</span>
00242 <span class="comment">     * Query the IME information.</span>
00243 <span class="comment">     */</span>
00244     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d0/immuser_8h.html#a47">ImmGetImeInfoEx</a>(&amp;iiex, ImeInfoExKeyboardLayout, &amp;hKL)) {
00245         RIPMSG1(RIP_WARNING, <span class="stringliteral">"LoadImeDpi: ImmGetImeInfoEx(%lx) failed"</span>, hKL);
00246         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00247     }
00248 
00249     <span class="comment">/*</span>
00250 <span class="comment">     * Win95 behaviour: If there was an IME load error for this layout,</span>
00251 <span class="comment">     * further attempt to load the same IME layout will be rejected.</span>
00252 <span class="comment">     */</span>
00253     <span class="keywordflow">if</span> (iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o5">fLoadFlag</a> == <a class="code" href="../../d8/d0/immstruc_8h.html#a19">IMEF_LOADERROR</a>)
00254         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00255 
00256     <span class="comment">/*</span>
00257 <span class="comment">     * Allocate a new IMEDPI for this layout.</span>
00258 <span class="comment">     */</span>
00259     pImeDpi = (<a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>)<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>(HEAP_ZERO_MEMORY, <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/structtagIMEDPI.html">IMEDPI</a>));
00260     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00261         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00262 
00263     pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o2">hKL</a> = hKL;
00264 
00265     <span class="comment">// get code page of IME</span>
00266     {
00267         CHARSETINFO cs;
00268         <span class="keywordflow">if</span> (TranslateCharsetInfo((DWORD*)LOWORD(HandleToUlong(hKL)), &amp;cs, TCI_SRCLOCALE)) {
00269             pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o4">dwCodePage</a> = cs.ciACP;
00270         }
00271         <span class="keywordflow">else</span> {
00272             pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o4">dwCodePage</a> = CP_ACP;
00273         }
00274     }
00275 
00276     <span class="comment">/*</span>
00277 <span class="comment">     * Load up IME DLL.</span>
00278 <span class="comment">     */</span>
00279     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/immime_8c.html#a8">LoadIME</a>(&amp;iiex, pImeDpi)) {
00280         <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(pImeDpi);
00281         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00282     }
00283 
00284     <span class="comment">/*</span>
00285 <span class="comment">     * Link in the newly allocated entry.</span>
00286 <span class="comment">     */</span>
00287     RtlEnterCriticalSection(&amp;gcsImeDpi);
00288 
00289     pImeDpiT = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a30">ImmGetImeDpi</a>(hKL);
00290 
00291     <span class="keywordflow">if</span> (pImeDpiT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00292         <span class="keywordflow">if</span> (fLock) {
00293             <span class="comment">/*</span>
00294 <span class="comment">             * Newly loaded with lock, will unload upon unlock.</span>
00295 <span class="comment">             */</span>
00296             pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o6">cLock</a> = 1;
00297             pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o7">dwFlag</a> |= <a class="code" href="../../d9/d0/immuser_8h.html#a5">IMEDPI_UNLOCKUNLOAD</a>;
00298         }
00299 
00300         <span class="comment">/*</span>
00301 <span class="comment">         * Update the global list for this new pImeDpi entry.</span>
00302 <span class="comment">         */</span>
00303         pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a> = <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a>;
00304         <a class="code" href="../../d2/d6/ntuser_2imm_2globals_8c.html#a7">gpImeDpi</a> = pImeDpi;
00305 
00306         RtlLeaveCriticalSection(&amp;gcsImeDpi);
00307     }
00308     <span class="keywordflow">else</span> {
00309 
00310         <span class="keywordflow">if</span> (!fLock) {
00311             pImeDpiT-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o7">dwFlag</a> &amp;= ~<a class="code" href="../../d9/d0/immuser_8h.html#a5">IMEDPI_UNLOCKUNLOAD</a>;
00312         }
00313 
00314         <span class="comment">/*</span>
00315 <span class="comment">         * The same IME has been loaded, discard this extra entry.</span>
00316 <span class="comment">         */</span>
00317         RtlLeaveCriticalSection(&amp;gcsImeDpi);
00318         <a class="code" href="../../d6/d0/immime_8c.html#a9">UnloadIME</a>(pImeDpi, FALSE);
00319         <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(pImeDpi);
00320         pImeDpi = pImeDpiT;
00321     }
00322 
00323     <span class="keywordflow">return</span> pImeDpi;
00324 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="immime.c::NotifyIMEProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL NotifyIMEProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00021">21</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l01294">ImmNotifyIME()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00495">ImmActivateLayout()</a>.
<p>
<pre class="fragment"><div>00024 {
00025     UserAssert(lParam == CPS_COMPLETE || lParam == CPS_CANCEL);
00026     <a class="code" href="../../d6/d0/immime_8c.html#a22">ImmNotifyIME</a>(hImc, NI_COMPOSITIONSTR, (DWORD)lParam, 0);
00027     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00028 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="immime.c::SelectContextProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SelectContextProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html">PSCE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psce</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00031">31</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00016">tagSELECTCONTEXT_ENUM::hSelKL</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00017">tagSELECTCONTEXT_ENUM::hUnSelKL</a>, <a class="el" href="../../d8/d5/w32_2ntuser_2imm_2context_8c-source.html#l00837">SelectInputContext()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/immime_8c-source.html#l00495">ImmActivateLayout()</a>.
<p>
<pre class="fragment"><div>00034 {
00035     <a class="code" href="../../d4/d0/immcli_8h.html#a70">SelectInputContext</a>(psce-&gt;<a class="code" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html#o0">hSelKL</a>, psce-&gt;<a class="code" href="../../d9/d5/structtagSELECTCONTEXT__ENUM.html#o1">hUnSelKL</a>, hImc);
00036     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00037 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="immime.c::UnloadIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnloadIME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pImeDpi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fTerminateIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/immime_8c-source.html#l00212">212</a> of file <a class="el" href="../../d7/d9/immime_8c-source.html">immime.c</a>.
<p>
References <a class="el" href="../../d0/d0/immuser_8h-source.html#l00068">tagIMEDPI::hInst</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00084">tagIMEDPI::_tagImeFunctions::ImeDestroy</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d7/structtagIMEDPI.html#o8">tagIMEDPI::pfn</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00050">ImmDisableIME()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00365">ImmUnloadIME()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, and <a class="el" href="../../d7/d9/immime_8c-source.html#l00234">LoadImeDpi()</a>.
<p>
<pre class="fragment"><div>00215 {
00216     <span class="keywordflow">if</span> (pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00217         RIPMSG0(RIP_WARNING, <span class="stringliteral">"UnloadIME: No IME's hInst."</span>);
00218         <span class="keywordflow">return</span>;
00219     }
00220 
00221     <span class="keywordflow">if</span> (fTerminateIme) {
00222         <span class="comment">/*</span>
00223 <span class="comment">         * Destroy IME first.</span>
00224 <span class="comment">         */</span>
00225         (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o20">ImeDestroy</a>)(0);
00226     }
00227 
00228     FreeLibrary(pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a>);
00229     pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00230 
00231     <span class="keywordflow">return</span>;
00232 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:10 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
