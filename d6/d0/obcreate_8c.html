<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: obcreate.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>obcreate.c File Reference</h1><code>#include "<a class="el" href="../../d6/d0/obp_8h-source.html">obp.h</a>"</code><br>

<p>
<a href="../../d7/d9/obcreate_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a5">ObCreateObject</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ProbeMode, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> OwnershipMode, IN OUT PVOID ParseContext OPTIONAL, IN ULONG ObjectBodySize, IN ULONG PagedPoolCharge, IN ULONG NonPagedPoolCharge, OUT PVOID *Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a6">ObpCaptureObjectCreateInformation</a> (IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ProbeMode, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, IN OUT PUNICODE_STRING CapturedObjectName, IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a> ObjectCreateInfo, IN LOGICAL UseLookaside)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a7">ObpCaptureObjectName</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ProbeMode, IN PUNICODE_STRING ObjectName, IN OUT PUNICODE_STRING CapturedObjectName, IN LOGICAL UseLookaside)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a8">ObpAllocateObjectNameBuffer</a> (IN ULONG Length, IN LOGICAL UseLookaside, IN OUT PUNICODE_STRING ObjectName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a9">ObpFreeObjectNameBuffer</a> (OUT PUNICODE_STRING ObjectName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a10">ObDeleteCapturedInsertInfo</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a11">ObpAllocateObject</a> (IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a> ObjectCreateInfo, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> OwnershipMode, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType OPTIONAL, IN PUNICODE_STRING ObjectName, IN ULONG ObjectBodySize, OUT <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> *ReturnedObjectHeader)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a12">ObpFreeObject</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a13">ObFreeObjectCreateInfoBuffer</a> (IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a> ObjectCreateInfo)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a0">ObpObjectsCreated</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a1">ObpObjectsWithPoolQuota</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a2">ObpObjectsWithHandleDB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a3">ObpObjectsWithName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d0/obcreate_8c.html#a4">ObpObjectsWithCreatorInfo</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="obcreate.c::ObCreateObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObCreateObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProbeMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OwnershipMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID ParseContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectBodySize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedPoolCharge</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedPoolCharge</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">55</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00284">_OBJECT_CREATE_INFORMATION::Attributes</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00313">_OBJECT_HEADER::Body</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00289">_OBJECT_CREATE_INFORMATION::NonPagedPoolCharge</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00351">OB_FLAG_PERMANENT_OBJECT</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00519">ObpAllocateObjectCreateInfoBuffer</a>, <a class="el" href="../../d5/d1/obp_8h.html#a58">ObpCaptureObjectCreateInformation()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00547">ObpFreeObjectCreateInfoBuffer</a>, <a class="el" href="../../d5/d1/obp_8h.html#a61">ObpFreeObjectNameBuffer()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00436">ObpReleaseObjectCreateInformation</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00288">_OBJECT_CREATE_INFORMATION::PagedPoolCharge</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01684">SeCreatePermanentPrivilege</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00222">ExCreateCallback()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l03917">IoCreateController()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04073">IoCreateDevice()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01071">IoCreateDriver()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05378">IoCreateStreamFileObject()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05535">IoCreateStreamFileObjectLite()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02272">IopInitializeAttributesAndCreateObject()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d7/d5/lpccreat_8c-source.html#l00136">LpcpCreatePort()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00768">MiSectionInitialization()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00101">NtCreateChannel()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00032">NtCreateDirectoryObject()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00131">NtCreateEventPair()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00051">NtCreateIoCompletion()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00048">NtCreateJobObject()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00156">NtCreateMutant()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00199">NtCreateProfile()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00123">NtCreateSemaphore()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00056">NtCreateSuperSection()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00052">NtCreateSymbolicLinkObject()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00444">NtCreateTimer()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00348">NtOpenChannel()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00069                    :
00070 
00071     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a> allocates space <span class="keywordflow">for</span> an NT Object from either
00072     Paged or NonPaged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>. It captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> optional name and
00073     SECURITY_DESCRIPTOR parameters <span class="keywordflow">for</span> later use when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00074     inserted into an object table.  No quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> charged at <span class="keyword">this</span> time.
00075     That occurs when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted into an object table.
00076 
00077 Arguments:
00078 
00079     ProbeMode - The processor mode to consider when doing a probe
00080         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input parameters
00081 
00082     ObjectType - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> returned by <a class="code" href="../../d4/d0/ob_8h.html#a67">ObCreateObjectType</a>
00083         that gives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object being created.
00084 
00085     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00086         being created (such as its name)
00087 
00088     OwnershipMode - The processor mode of who <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> going to own <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00089 
00090     ParseContext - Ignored
00091 
00092     ObjectBodySize - Number of bytes to allocate <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object body.  The
00093         object body immediately follows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object header in memory and are
00094         part of a single allocation.
00095 
00096     PagedPoolCharge - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to charge <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00097         object.  If zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> charge <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00098         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.
00099 
00100     NonPagedPoolCharge - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of nonpaged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to charge <span class="keywordflow">for</span>
00101         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  If zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> charge <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00102         object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.
00103 
00104     Object - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly created object
00105 
00106 Return Value:
00107 
00108     Following errors can occur:
00109 
00110         - invalid object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
00111         - insufficient memory
00112 
00113 --*/
00114 
00115 {
00116     UNICODE_STRING CapturedObjectName;
00117     <a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a> ObjectCreateInfo;
00118     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00119     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00120 
00121     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00122 
00123     <span class="comment">//</span>
00124     <span class="comment">//  Allocate a buffer to capture the object creation information.</span>
00125     <span class="comment">//</span>
00126 
00127     ObjectCreateInfo = <a class="code" href="../../d5/d1/obp_8h.html#a31">ObpAllocateObjectCreateInfoBuffer</a>();
00128 
00129     <span class="keywordflow">if</span> (ObjectCreateInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00130 
00131         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INSUFFICIENT_RESOURCES;
00132 
00133     } <span class="keywordflow">else</span> {
00134 
00135         <span class="comment">//</span>
00136         <span class="comment">//  Capture the object attributes, quality of service, and object</span>
00137         <span class="comment">//  name, if specified. Otherwise, initialize the captured object</span>
00138         <span class="comment">//  name, the security quality of service, and the create attributes</span>
00139         <span class="comment">//  to default values.</span>
00140         <span class="comment">//</span>
00141 
00142         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a58">ObpCaptureObjectCreateInformation</a>( ObjectType,
00143                                                     ProbeMode,
00144                                                     ObjectAttributes,
00145                                                     &amp;CapturedObjectName,
00146                                                     ObjectCreateInfo,
00147                                                     FALSE );
00148 
00149         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00150 
00151             <span class="comment">//</span>
00152             <span class="comment">//  If the creation attributes are invalid, then return an error</span>
00153             <span class="comment">//  status.</span>
00154             <span class="comment">//</span>
00155 
00156             <span class="keywordflow">if</span> (ObjectType-&gt;TypeInfo.InvalidAttributes &amp; ObjectCreateInfo-&gt;<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html#o0">Attributes</a>) {
00157 
00158                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00159 
00160             } <span class="keywordflow">else</span> {
00161 
00162                 <span class="comment">//</span>
00163                 <span class="comment">//  Set the paged and nonpaged pool quota charges for the</span>
00164                 <span class="comment">//  object allocation.</span>
00165                 <span class="comment">//</span>
00166 
00167                 <span class="keywordflow">if</span> (PagedPoolCharge == 0) {
00168 
00169                     PagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultPagedPoolCharge;
00170                 }
00171 
00172                 <span class="keywordflow">if</span> (NonPagedPoolCharge == 0) {
00173 
00174                     NonPagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultNonPagedPoolCharge;
00175                 }
00176 
00177                 ObjectCreateInfo-&gt;<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html#o4">PagedPoolCharge</a> = PagedPoolCharge;
00178                 ObjectCreateInfo-&gt;<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html#o5">NonPagedPoolCharge</a> = NonPagedPoolCharge;
00179 
00180                 <span class="comment">//</span>
00181                 <span class="comment">//  Allocate and initialize the object.</span>
00182                 <span class="comment">//</span>
00183 
00184                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a62">ObpAllocateObject</a>( ObjectCreateInfo,
00185                                             OwnershipMode,
00186                                             ObjectType,
00187                                             &amp;CapturedObjectName,
00188                                             ObjectBodySize,
00189                                             &amp;ObjectHeader );
00190 
00191                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00192 
00193                     <span class="comment">//</span>
00194                     <span class="comment">//  If a permanent object is being created, then check if</span>
00195                     <span class="comment">//  the caller has the appropriate privilege.</span>
00196                     <span class="comment">//</span>
00197 
00198                     *Object = &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o11">Body</a>;
00199 
00200                     <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>) {
00201 
00202                         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d4/privileg_8c.html#a3">SeSinglePrivilegeCheck</a>( SeCreatePermanentPrivilege,
00203                                                      ProbeMode)) {
00204 
00205                             <a class="code" href="../../d5/d1/obp_8h.html#a63">ObpFreeObject</a>(*Object);
00206 
00207                             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PRIVILEGE_NOT_HELD;
00208                         }
00209                     }
00210 
00211                     <span class="comment">//</span>
00212                     <span class="comment">//  Here is the only successful path out of this module but</span>
00213                     <span class="comment">//  this path can also return privilege not held.</span>
00214                     <span class="comment">//</span>
00215 
00216                     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00217                 }
00218             }
00219 
00220             <span class="comment">//</span>
00221             <span class="comment">//  An error path, free the create information.</span>
00222             <span class="comment">//</span>
00223 
00224             <a class="code" href="../../d5/d1/obp_8h.html#a30">ObpReleaseObjectCreateInformation</a>(ObjectCreateInfo);
00225 
00226             <span class="keywordflow">if</span> (CapturedObjectName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00227 
00228                 <a class="code" href="../../d5/d1/obp_8h.html#a61">ObpFreeObjectNameBuffer</a>(&amp;CapturedObjectName);
00229             }
00230         }
00231 
00232         <span class="comment">//</span>
00233         <span class="comment">//  An error path, free object creation information buffer.</span>
00234         <span class="comment">//</span>
00235 
00236         <a class="code" href="../../d5/d1/obp_8h.html#a32">ObpFreeObjectCreateInfoBuffer</a>(ObjectCreateInfo);
00237     }
00238 
00239     <span class="comment">//</span>
00240     <span class="comment">//  An error path</span>
00241     <span class="comment">//</span>
00242 
00243     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00244 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="obcreate.c::ObDeleteCapturedInsertInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID ObDeleteCapturedInsertInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00713">713</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00347">OB_FLAG_NEW_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00308">_OBJECT_HEADER::ObjectCreateInfo</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00431">ObpFreeObjectCreateInformation</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>.
<p>
<pre class="fragment"><div>00719                    :
00720 
00721     This function frees <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation information that could be pointed at
00722     by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object header.
00723 
00724 Arguments:
00725 
00726     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being modified
00727 
00728 Return Value:
00729 
00730     None.
00731 
00732 --*/
00733 
00734 {
00735     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00736 
00737     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00738 
00739     <span class="comment">//</span>
00740     <span class="comment">//  Get the address of the object header and free the object create</span>
00741     <span class="comment">//  information object if the object is being created.</span>
00742     <span class="comment">//</span>
00743 
00744     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(Object);
00745 
00746     <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a1">OB_FLAG_NEW_OBJECT</a>) {
00747 
00748         <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00749 
00750             <a class="code" href="../../d5/d1/obp_8h.html#a29">ObpFreeObjectCreateInformation</a>(ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a>);
00751 
00752             ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00753         }
00754     }
00755 
00756     <span class="keywordflow">return</span>;
00757 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="obcreate.c::ObFreeObjectCreateInfoBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL ObFreeObjectCreateInfoBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ObjectCreateInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01279">1279</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d6/d0/obp_8h-source.html#l00547">ObpFreeObjectCreateInfoBuffer</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05535">IoCreateStreamFileObjectLite()</a>.
<p>
<pre class="fragment"><div>01285                    :
01286 
01287     This function frees a create information buffer.  Called from IO component
01288 
01289     N.B. This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> nonpageable.
01290 
01291 Arguments:
01292 
01293     ObjectCreateInfo - Supplies a pointer to a create information buffer.
01294 
01295 Return Value:
01296 
01297     None.
01298 
01299 --*/
01300 
01301 {
01302     <a class="code" href="../../d5/d1/obp_8h.html#a32">ObpFreeObjectCreateInfoBuffer</a>( ObjectCreateInfo );
01303 
01304     <span class="keywordflow">return</span>;
01305 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="obcreate.c::ObpAllocateObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObpAllocateObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreateInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OwnershipMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectBodySize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnedObjectHeader</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">761</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00343">_OBJECT_HEADER_CREATOR_INFO::CreatorBackTraceIndex</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00342">_OBJECT_HEADER_CREATOR_INFO::CreatorUniqueProcess</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00331">_OBJECT_HEADER_NAME_INFO::Directory</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00320">_OBJECT_HEADER_QUOTA_INFO::ExclusiveProcess</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00257">_OBJECT_HANDLE_COUNT_ENTRY::HandleCount</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00299">_OBJECT_HEADER::HandleCount</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00304">_OBJECT_HEADER::HandleInfoOffset</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00332">_OBJECT_HEADER_NAME_INFO::Name</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00303">_OBJECT_HEADER::NameInfoOffset</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00318">_OBJECT_HEADER_QUOTA_INFO::NonPagedPoolCharge</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00349">OB_FLAG_CREATOR_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00350">OB_FLAG_EXCLUSIVE_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00348">OB_FLAG_KERNEL_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00347">OB_FLAG_NEW_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00351">OB_FLAG_PERMANENT_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00353">OB_FLAG_SINGLE_HANDLE_ENTRY</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00308">_OBJECT_HEADER::ObjectCreateInfo</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00047">ObpObjectsCreated</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00051">ObpObjectsWithCreatorInfo</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00049">ObpObjectsWithHandleDB</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00050">ObpObjectsWithName</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00048">ObpObjectsWithPoolQuota</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00317">_OBJECT_HEADER_QUOTA_INFO::PagedPoolCharge</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00297">_OBJECT_HEADER::PointerCount</a>, <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00281">PROTECTED_POOL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00305">_OBJECT_HEADER::QuotaInfoOffset</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00062">SE_DEFAULT_SECURITY_QUOTA</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00312">_OBJECT_HEADER::SecurityDescriptor</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00319">_OBJECT_HEADER_QUOTA_INFO::SecurityDescriptorCharge</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00326">_OBJECT_HEADER_HANDLE_INFO::SingleEntry</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00341">_OBJECT_HEADER_CREATOR_INFO::TypeList</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, and <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>.
<p>
<pre class="fragment"><div>00772                    :
00773 
00774     This routine allocates a <span class="keyword">new</span> object including <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object header
00775     and body from <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> and fill in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate fields.
00776 
00777 Arguments:
00778 
00779     ObjectCreateInfo - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object
00780 
00781     OwnershipMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode of who <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> going to own
00782         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00783 
00784     ObjectType - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being
00785         created. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object create info not null then <span class="keyword">this</span> field must
00786         be supplied.
00787 
00788     ObjectName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being created
00789 
00790     ObjectBodySize - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> body of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00791         being created
00792 
00793     ReturnedObjectHeader - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object header <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00794         newly created objet.
00795 
00796 Return Value:
00797 
00798     An appropriate status value.
00799 
00800 --*/
00801 
00802 {
00803     ULONG HeaderSize;
00804     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00805     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00806     PVOID ZoneSegment;
00807     ULONG QuotaInfoSize;
00808     ULONG HandleInfoSize;
00809     ULONG NameInfoSize;
00810     ULONG CreatorInfoSize;
00811     <a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a> QuotaInfo;
00812     <a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">POBJECT_HEADER_HANDLE_INFO</a> HandleInfo;
00813     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
00814     <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a> CreatorInfo;
00815     <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType;
00816 
00817     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00818 
00819     <a class="code" href="../../d6/d0/obcreate_8c.html#a0">ObpObjectsCreated</a> += 1;
00820 
00821     <span class="comment">//</span>
00822     <span class="comment">//  Compute the sizes of the optional object header components.</span>
00823     <span class="comment">//</span>
00824 
00825     <span class="keywordflow">if</span> (ObjectCreateInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00826 
00827         QuotaInfoSize = 0;
00828         HandleInfoSize = 0;
00829         NameInfoSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a> );
00830         CreatorInfoSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">OBJECT_HEADER_CREATOR_INFO</a> );
00831 
00832     } <span class="keywordflow">else</span> {
00833 
00834         <span class="comment">//</span>
00835         <span class="comment">//  The caller specified some additional object create info</span>
00836         <span class="comment">//</span>
00837         <span class="comment">//  First check to see if we need to set the quota</span>
00838         <span class="comment">//</span>
00839 
00840         <span class="keywordflow">if</span> (ObjectCreateInfo-&gt;PagedPoolCharge != ObjectType-&gt;TypeInfo.DefaultPagedPoolCharge ||
00841             ObjectCreateInfo-&gt;NonPagedPoolCharge != ObjectType-&gt;TypeInfo.DefaultNonPagedPoolCharge ||
00842             ObjectCreateInfo-&gt;SecurityDescriptorCharge &gt; <a class="code" href="../../d0/d5/se_8h.html#a0">SE_DEFAULT_SECURITY_QUOTA</a> ||
00843             (ObjectCreateInfo-&gt;Attributes &amp; OBJ_EXCLUSIVE)) {
00844 
00845             QuotaInfoSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">OBJECT_HEADER_QUOTA_INFO</a> );
00846             <a class="code" href="../../d6/d0/obcreate_8c.html#a1">ObpObjectsWithPoolQuota</a> += 1;
00847 
00848         } <span class="keywordflow">else</span> {
00849 
00850             QuotaInfoSize = 0;
00851         }
00852 
00853         <span class="comment">//</span>
00854         <span class="comment">//  Check if we are to allocate space to maintain handle counts</span>
00855         <span class="comment">//</span>
00856 
00857         <span class="keywordflow">if</span> (ObjectType-&gt;TypeInfo.MaintainHandleCount) {
00858 
00859             HandleInfoSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">OBJECT_HEADER_HANDLE_INFO</a> );
00860             <a class="code" href="../../d6/d0/obcreate_8c.html#a2">ObpObjectsWithHandleDB</a> += 1;
00861 
00862         } <span class="keywordflow">else</span> {
00863 
00864             HandleInfoSize = 0;
00865         }
00866 
00867         <span class="comment">//</span>
00868         <span class="comment">//  Check if we are to allocate space for the name</span>
00869         <span class="comment">//</span>
00870 
00871         <span class="keywordflow">if</span> (ObjectName-&gt;Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00872 
00873             NameInfoSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a> );
00874             <a class="code" href="../../d6/d0/obcreate_8c.html#a3">ObpObjectsWithName</a> += 1;
00875 
00876         } <span class="keywordflow">else</span> {
00877 
00878             NameInfoSize = 0;
00879         }
00880 
00881         <span class="comment">//</span>
00882         <span class="comment">//  Finally check if we are to maintain the creator info</span>
00883         <span class="comment">//</span>
00884 
00885         <span class="keywordflow">if</span> (ObjectType-&gt;TypeInfo.MaintainTypeList) {
00886 
00887             CreatorInfoSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">OBJECT_HEADER_CREATOR_INFO</a> );
00888             <a class="code" href="../../d6/d0/obcreate_8c.html#a4">ObpObjectsWithCreatorInfo</a> += 1;
00889 
00890         } <span class="keywordflow">else</span> {
00891 
00892             CreatorInfoSize = 0;
00893         }
00894     }
00895 
00896     <span class="comment">//</span>
00897     <span class="comment">//  Now compute the total header size</span>
00898     <span class="comment">//</span>
00899 
00900     HeaderSize = QuotaInfoSize +
00901                  HandleInfoSize +
00902                  NameInfoSize +
00903                  CreatorInfoSize +
00904                  FIELD_OFFSET( <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a>, Body );
00905 
00906     <span class="comment">//</span>
00907     <span class="comment">//  Allocate and initialize the object.</span>
00908     <span class="comment">//</span>
00909     <span class="comment">//  If the object type is not specified or specifies nonpaged pool,</span>
00910     <span class="comment">//  then allocate the object from nonpaged pool.</span>
00911     <span class="comment">//  Otherwise, allocate the object from paged pool.</span>
00912     <span class="comment">//</span>
00913 
00914     <span class="keywordflow">if</span> ((ObjectType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (ObjectType-&gt;TypeInfo.PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>)) {
00915 
00916         PoolType = <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>;
00917 
00918     } <span class="keywordflow">else</span> {
00919 
00920         PoolType = <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>;
00921     }
00922 
00923     ObjectHeader = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PoolType,
00924                                           HeaderSize + ObjectBodySize,
00925                                           (ObjectType == NULL ? 'TjbO' : ObjectType-&gt;Key) |
00926                                             PROTECTED_POOL );
00927 
00928     <span class="keywordflow">if</span> (ObjectHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00929 
00930         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00931     }
00932 
00933     <span class="comment">//</span>
00934     <span class="comment">//  Now based on if we are to put in the quota, handle, name, or creator info we</span>
00935     <span class="comment">//  will do the extra work.  This order is very important because we rely on</span>
00936     <span class="comment">//  it to free the object.</span>
00937     <span class="comment">//</span>
00938 
00939     <span class="keywordflow">if</span> (QuotaInfoSize != 0) {
00940 
00941         QuotaInfo = (<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a>)ObjectHeader;
00942         QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o0">PagedPoolCharge</a> = ObjectCreateInfo-&gt;PagedPoolCharge;
00943         QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o1">NonPagedPoolCharge</a> = ObjectCreateInfo-&gt;NonPagedPoolCharge;
00944         QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o2">SecurityDescriptorCharge</a> = ObjectCreateInfo-&gt;SecurityDescriptorCharge;
00945         QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o3">ExclusiveProcess</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00946         ObjectHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(QuotaInfo + 1);
00947     }
00948 
00949     <span class="keywordflow">if</span> (HandleInfoSize != 0) {
00950 
00951         HandleInfo = (<a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">POBJECT_HEADER_HANDLE_INFO</a>)ObjectHeader;
00952         HandleInfo-&gt;<a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html#o1">SingleEntry</a>.<a class="code" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html#o1">HandleCount</a> = 0;
00953         ObjectHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(HandleInfo + 1);
00954     }
00955 
00956     <span class="keywordflow">if</span> (NameInfoSize != 0) {
00957 
00958         NameInfo = (<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a>)ObjectHeader;
00959         NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a> = *ObjectName;
00960         NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00961         ObjectHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(NameInfo + 1);
00962     }
00963 
00964     <span class="keywordflow">if</span> (CreatorInfoSize != 0) {
00965 
00966         CreatorInfo = (<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a>)ObjectHeader;
00967         CreatorInfo-&gt;<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html#o2">CreatorBackTraceIndex</a> = 0;
00968         CreatorInfo-&gt;<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html#o1">CreatorUniqueProcess</a> = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;UniqueProcessId;
00969         InitializeListHead( &amp;CreatorInfo-&gt;<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html#o0">TypeList</a> );
00970         ObjectHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(CreatorInfo + 1);
00971     }
00972 
00973     <span class="comment">//</span>
00974     <span class="comment">//  Compute the proper offsets based on what we have</span>
00975     <span class="comment">//</span>
00976 
00977     <span class="keywordflow">if</span> (QuotaInfoSize != 0) {
00978 
00979         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o6">QuotaInfoOffset</a> = (UCHAR)(QuotaInfoSize + HandleInfoSize + NameInfoSize + CreatorInfoSize);
00980 
00981     } <span class="keywordflow">else</span> {
00982 
00983         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o6">QuotaInfoOffset</a> = 0;
00984     }
00985 
00986     <span class="keywordflow">if</span> (HandleInfoSize != 0) {
00987 
00988         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o5">HandleInfoOffset</a> = (UCHAR)(HandleInfoSize + NameInfoSize + CreatorInfoSize);
00989 
00990     } <span class="keywordflow">else</span> {
00991 
00992         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o5">HandleInfoOffset</a> = 0;
00993     }
00994 
00995     <span class="keywordflow">if</span> (NameInfoSize != 0) {
00996 
00997         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o4">NameInfoOffset</a> =  (UCHAR)(NameInfoSize + CreatorInfoSize);
00998 
00999     } <span class="keywordflow">else</span> {
01000 
01001         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o4">NameInfoOffset</a> = 0;
01002     }
01003 
01004     <span class="comment">//</span>
01005     <span class="comment">//  Say that this is a new object, and conditionally set the other flags</span>
01006     <span class="comment">//</span>
01007 
01008     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> = <a class="code" href="../../d4/d0/ob_8h.html#a1">OB_FLAG_NEW_OBJECT</a>;
01009 
01010     <span class="keywordflow">if</span> (CreatorInfoSize != 0) {
01011 
01012         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> |= <a class="code" href="../../d4/d0/ob_8h.html#a3">OB_FLAG_CREATOR_INFO</a>;
01013     }
01014 
01015     <span class="keywordflow">if</span> (HandleInfoSize != 0) {
01016 
01017         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> |= <a class="code" href="../../d4/d0/ob_8h.html#a7">OB_FLAG_SINGLE_HANDLE_ENTRY</a>;
01018     }
01019 
01020     <span class="comment">//</span>
01021     <span class="comment">//  Set the counters and its type</span>
01022     <span class="comment">//</span>
01023 
01024     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o0">PointerCount</a> = 1;
01025     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o1">HandleCount</a> = 0;
01026     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a> = ObjectType;
01027 
01028     <span class="comment">//</span>
01029     <span class="comment">//  Initialize the object header.</span>
01030     <span class="comment">//</span>
01031     <span class="comment">//  N.B. The initialization of the object header is done field by</span>
01032     <span class="comment">//       field rather than zeroing the memory and then initializing</span>
01033     <span class="comment">//       the pertinent fields.</span>
01034     <span class="comment">//</span>
01035     <span class="comment">//  N.B. It is assumed that the caller will initialize the object</span>
01036     <span class="comment">//       attributes, object ownership, and parse context.</span>
01037     <span class="comment">//</span>
01038 
01039     <span class="keywordflow">if</span> (OwnershipMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
01040 
01041         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> |= <a class="code" href="../../d4/d0/ob_8h.html#a2">OB_FLAG_KERNEL_OBJECT</a>;
01042     }
01043 
01044     <span class="keywordflow">if</span> (ObjectCreateInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01045         ObjectCreateInfo-&gt;Attributes &amp; OBJ_PERMANENT ) {
01046 
01047         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> |= <a class="code" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>;
01048     }
01049 
01050     <span class="keywordflow">if</span> ((ObjectCreateInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
01051         (ObjectCreateInfo-&gt;Attributes &amp; OBJ_EXCLUSIVE)) {
01052 
01053         ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> |= <a class="code" href="../../d4/d0/ob_8h.html#a4">OB_FLAG_EXCLUSIVE_OBJECT</a>;
01054     }
01055 
01056     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a> = ObjectCreateInfo;
01057     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o10">SecurityDescriptor</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01058 
01059     <span class="keywordflow">if</span> (ObjectType != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01060 
01061         ObjectType-&gt;TotalNumberOfObjects += 1;
01062 
01063         <span class="keywordflow">if</span> (ObjectType-&gt;TotalNumberOfObjects &gt; ObjectType-&gt;HighWaterNumberOfObjects) {
01064 
01065             ObjectType-&gt;HighWaterNumberOfObjects = ObjectType-&gt;TotalNumberOfObjects;
01066         }
01067     }
01068 
01069 <span class="preprocessor">#if DBG</span>
01070 <span class="preprocessor"></span>
01071     <span class="comment">//</span>
01072     <span class="comment">//  On a checked build echo out allocs</span>
01073     <span class="comment">//</span>
01074 
01075     <span class="keywordflow">if</span> (ObpShowAllocAndFree) {
01076 
01077         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"OB: Alloc %lx (%lx) %04lu"</span>, ObjectHeader, ObjectHeader, ObjectBodySize );
01078 
01079         <span class="keywordflow">if</span> (ObjectType) {
01080 
01081             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" - %wZ\n"</span>, &amp;ObjectType-&gt;Name );
01082 
01083         } <span class="keywordflow">else</span> {
01084 
01085             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" - Type\n"</span> );
01086         }
01087     }
01088 <span class="preprocessor">#endif</span>
01089 <span class="preprocessor"></span>
01090     *ReturnedObjectHeader = ObjectHeader;
01091 
01092     <span class="keywordflow">return</span> STATUS_SUCCESS;
01093 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="obcreate.c::ObpAllocateObjectNameBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWCHAR ObpAllocateObjectNameBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>UseLookaside</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00583">583</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01011">ExAllocateFromPPNPagedLookasideList()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00390">OBJECT_NAME_BUFFER_SIZE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00438">ObpCaptureObjectName()</a>.
<p>
<pre class="fragment"><div>00591                    :
00592 
00593     This function allocates an object name buffer.
00594 
00595     N.B. This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> nonpageable.
00596 
00597 Arguments:
00598 
00599     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> required buffer in bytes.
00600 
00601     UseLookaside - Supplies a logical variable that determines whether an
00602         attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to allocate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name buffer from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lookaside list.
00603 
00604     ObjectName - Supplies a pointer to a name buffer string descriptor.
00605 
00606 Return Value:
00607 
00608     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successful, then name buffer string descriptor
00609     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> initialized and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00610     function value. Otherwise, a value of <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00611 
00612 --*/
00613 
00614 {
00615     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00616     ULONG Maximum;
00617     KIRQL OldIrql;
00618     PKPRCB Prcb;
00619 
00620     <span class="comment">//</span>
00621     <span class="comment">//  If allocation from the lookaside lists is specified and the buffer</span>
00622     <span class="comment">//  size is less than the size of lookaside list entries, then attempt</span>
00623     <span class="comment">//  to allocate the name buffer from the lookaside lists. Otherwise,</span>
00624     <span class="comment">//  attempt to allocate the name buffer from nonpaged pool.</span>
00625     <span class="comment">//</span>
00626 
00627     Maximum = Length + <span class="keyword">sizeof</span>(WCHAR);
00628 
00629     <span class="keywordflow">if</span> ((UseLookaside == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) || (Maximum &gt; <a class="code" href="../../d5/d1/obp_8h.html#a23">OBJECT_NAME_BUFFER_SIZE</a>)) {
00630 
00631         <span class="comment">//</span>
00632         <span class="comment">//  Attempt to allocate the buffer from nonpaged pool.</span>
00633         <span class="comment">//</span>
00634 
00635         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(NonPagedPool, Maximum, 'mNbO');
00636 
00637     } <span class="keywordflow">else</span> {
00638 
00639         <span class="comment">//</span>
00640         <span class="comment">//  Attempt to allocate the name buffer from the lookaside list. If</span>
00641         <span class="comment">//  the allocation attempt fails, then attempt to allocate the name</span>
00642         <span class="comment">//  buffer from pool.</span>
00643         <span class="comment">//</span>
00644 
00645         Maximum = <a class="code" href="../../d5/d1/obp_8h.html#a23">OBJECT_NAME_BUFFER_SIZE</a>;
00646         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d5/d8/ex_8h.html#a254">ExAllocateFromPPNPagedLookasideList</a>(LookasideNameBufferList);
00647     }
00648 
00649     <span class="comment">//</span>
00650     <span class="comment">//  Initialize the string descriptor and return the buffer address.</span>
00651     <span class="comment">//</span>
00652 
00653     ObjectName-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Length;
00654     ObjectName-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Maximum;
00655     ObjectName-&gt;Buffer = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00656 
00657     <span class="keywordflow">return</span> (PWCHAR)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00658 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="obcreate.c::ObpCaptureObjectCreateInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObpCaptureObjectCreateInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProbeMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreateInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>UseLookaside</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00248">248</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00438">ObpCaptureObjectName()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00436">ObpReleaseObjectCreateInformation</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00053">SeCaptureSecurityDescriptor()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02350">SeComputeQuotaInformationSize()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00676">SeComputeSecurityQuota</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00037">SecurityQos</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00259                    :
00260 
00261     This function captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object creation information and stuff
00262     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input variable ObjectCreateInfo
00263 
00264 Arguments:
00265 
00266     ObjectType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object we expect to capture,
00267         currently ignored.
00268 
00269     ProbeMode - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode <span class="keywordflow">for</span> doing our parameter
00270         probes
00271 
00272     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object attributes we are trying
00273         to capture
00274 
00275     CapturedObjectName - Recieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being created
00276 
00277     ObjectCreateInfo - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00278         like its root, attributes, and security information
00279 
00280     UseLookaside - Specifies <span class="keywordflow">if</span> we are to allocate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured name
00281         buffer from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lookaside list or from straight <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
00282 
00283 Return Value:
00284 
00285     An appropriate status value
00286 
00287 --*/
00288 
00289 {
00290     PUNICODE_STRING ObjectName;
00291     PSECURITY_DESCRIPTOR SecurityDescriptor;
00292     PSECURITY_QUALITY_OF_SERVICE <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>;
00293     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00294     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00295 
00296     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00297 
00298     <span class="comment">//</span>
00299     <span class="comment">//  Capture the object attributes, the security quality of service, if</span>
00300     <span class="comment">//  specified, and object name, if specified.</span>
00301     <span class="comment">//</span>
00302 
00303     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00304 
00305     RtlZeroMemory(ObjectCreateInfo, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">OBJECT_CREATE_INFORMATION</a>));
00306 
00307     <span class="keywordflow">try</span> {
00308 
00309         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ObjectAttributes)) {
00310 
00311             <span class="comment">//</span>
00312             <span class="comment">//  Probe the object attributes if necessary.</span>
00313             <span class="comment">//</span>
00314 
00315             <span class="keywordflow">if</span> (ProbeMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00316 
00317                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( ObjectAttributes,
00318                               <span class="keyword">sizeof</span>(OBJECT_ATTRIBUTES),
00319                               <span class="keyword">sizeof</span>(ULONG) );
00320             }
00321 
00322             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;Length != <span class="keyword">sizeof</span>(OBJECT_ATTRIBUTES) ||
00323                 (<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;Attributes &amp; ~OBJ_VALID_ATTRIBUTES)) {
00324 
00325                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00326 
00327                 <span class="keywordflow">goto</span> failureExit;
00328             }
00329 
00330             <span class="comment">//</span>
00331             <span class="comment">//  Capture the object attributes.</span>
00332             <span class="comment">//</span>
00333 
00334             ObjectCreateInfo-&gt;RootDirectory = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;RootDirectory;
00335             ObjectCreateInfo-&gt;Attributes = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;Attributes &amp; OBJ_VALID_ATTRIBUTES;
00336             ObjectName = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;ObjectName;
00337             SecurityDescriptor = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;SecurityDescriptor;
00338             <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a> = <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>-&gt;SecurityQualityOfService;
00339 
00340             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SecurityDescriptor)) {
00341 
00342                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( SecurityDescriptor,
00343                                                       ProbeMode,
00344                                                       PagedPool,
00345                                                       TRUE,
00346                                                       &amp;ObjectCreateInfo-&gt;SecurityDescriptor );
00347 
00348                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00349 
00350                     KdPrint(( <span class="stringliteral">"OB: Failed to capture security descriptor at %08x - Status == %08x\n"</span>,
00351                               SecurityDescriptor,
00352                               Status) );
00353 
00354                     <span class="comment">//</span>
00355                     <span class="comment">//  The cleanup routine depends on this being NULL if it isn't</span>
00356                     <span class="comment">//  allocated.  SeCaptureSecurityDescriptor may modify this</span>
00357                     <span class="comment">//  parameter even if it fails.</span>
00358                     <span class="comment">//</span>
00359 
00360                     ObjectCreateInfo-&gt;SecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00361 
00362                     <span class="keywordflow">goto</span> failureExit;
00363                 }
00364 
00365                 <a class="code" href="../../d2/d5/se_2capture_8c.html#a16">SeComputeQuotaInformationSize</a>(  ObjectCreateInfo-&gt;SecurityDescriptor,
00366                                                 &amp;Size );
00367 
00368                 ObjectCreateInfo-&gt;SecurityDescriptorCharge = <a class="code" href="../../d0/d5/se_8h.html#a15">SeComputeSecurityQuota</a>( Size );
00369                 ObjectCreateInfo-&gt;ProbeMode = ProbeMode;
00370             }
00371 
00372             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SecurityQos)) {
00373 
00374                 <span class="keywordflow">if</span> (ProbeMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00375 
00376                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( SecurityQos, <span class="keyword">sizeof</span>(*SecurityQos), <span class="keyword">sizeof</span>(ULONG));
00377                 }
00378 
00379                 ObjectCreateInfo-&gt;SecurityQualityOfService = *<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>;
00380                 ObjectCreateInfo-&gt;SecurityQos = &amp;ObjectCreateInfo-&gt;SecurityQualityOfService;
00381             }
00382 
00383         } <span class="keywordflow">else</span> {
00384 
00385             ObjectName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00386         }
00387 
00388     } except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00389 
00390         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00391 
00392         <span class="keywordflow">goto</span> failureExit;
00393     }
00394 
00395     <span class="comment">//</span>
00396     <span class="comment">//  If an object name is specified, then capture the object name.</span>
00397     <span class="comment">//  Otherwise, initialize the object name descriptor and check for</span>
00398     <span class="comment">//  an incorrectly specified root directory.</span>
00399     <span class="comment">//</span>
00400 
00401     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ObjectName)) {
00402 
00403         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a59">ObpCaptureObjectName</a>( ProbeMode,
00404                                        ObjectName,
00405                                        CapturedObjectName,
00406                                        UseLookaside );
00407 
00408     } <span class="keywordflow">else</span> {
00409 
00410         CapturedObjectName-&gt;Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00411         CapturedObjectName-&gt;Length = 0;
00412         CapturedObjectName-&gt;MaximumLength = 0;
00413 
00414         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ObjectCreateInfo-&gt;RootDirectory)) {
00415 
00416             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_NAME_INVALID;
00417         }
00418     }
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">//  If the completion status is not successful, and a security quality</span>
00422     <span class="comment">//  of service parameter was specified, then free the security quality</span>
00423     <span class="comment">//  of service memory.</span>
00424     <span class="comment">//</span>
00425 
00426 failureExit:
00427 
00428     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00429 
00430         <a class="code" href="../../d5/d1/obp_8h.html#a30">ObpReleaseObjectCreateInformation</a>(ObjectCreateInfo);
00431     }
00432 
00433     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00434 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="obcreate.c::ObpCaptureObjectName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObpCaptureObjectName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProbeMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LOGICAL&nbsp;</td>
          <td class="mdname" nowrap> <em>UseLookaside</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00438">438</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00583">ObpAllocateObjectNameBuffer()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01417">ProbeAndReadUnicodeString</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00248">ObpCaptureObjectCreateInformation()</a>, and <a class="el" href="../../d8/d0/obref_8c-source.html#l00844">ObReferenceObjectByName()</a>.
<p>
<pre class="fragment"><div>00447                    :
00448 
00449     This function captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object name but first verifies that
00450     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> at least properly sized.
00451 
00452 Arguments:
00453 
00454     ProbeMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode to use when probing
00455         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object name
00456 
00457     ObjectName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's version of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object name
00458 
00459     CapturedObjectName - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured verified version
00460         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object name
00461 
00462     UseLookaside - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured name buffer should be
00463         allocated from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lookaside list or from straight <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00464 
00465 Return Value:
00466 
00467     An appropriate status value
00468 
00469 --*/
00470 
00471 {
00472     PWCH FreeBuffer;
00473     UNICODE_STRING InputObjectName;
00474     ULONG Length;
00475     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00476 
00477     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">//  Initialize the object name descriptor and capture the specified name</span>
00481     <span class="comment">//  string.</span>
00482     <span class="comment">//</span>
00483 
00484     CapturedObjectName-&gt;Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00485     CapturedObjectName-&gt;Length = 0;
00486     CapturedObjectName-&gt;MaximumLength = 0;
00487 
00488     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00489 
00490     <span class="keywordflow">try</span> {
00491 
00492         <span class="comment">//</span>
00493         <span class="comment">//  Probe and capture the name string descriptor and probe the</span>
00494         <span class="comment">//  name string, if necessary.</span>
00495         <span class="comment">//</span>
00496 
00497         FreeBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00498 
00499         <span class="keywordflow">if</span> (ProbeMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00500 
00501             InputObjectName = <a class="code" href="../../d5/d8/ex_8h.html#a26">ProbeAndReadUnicodeString</a>(ObjectName);
00502 
00503             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( InputObjectName.Buffer,
00504                           InputObjectName.Length,
00505                           <span class="keyword">sizeof</span>(WCHAR) );
00506 
00507         } <span class="keywordflow">else</span> {
00508 
00509             InputObjectName = *ObjectName;
00510         }
00511 
00512         <span class="comment">//</span>
00513         <span class="comment">//  If the length of the string is not zero, then capture the string.</span>
00514         <span class="comment">//</span>
00515 
00516         <span class="keywordflow">if</span> (InputObjectName.Length != 0) {
00517 
00518             <span class="comment">//</span>
00519             <span class="comment">//  If the length of the string is not an even multiple of the</span>
00520             <span class="comment">//  size of a UNICODE character or cannot be zero terminated,</span>
00521             <span class="comment">//  then return an error.</span>
00522             <span class="comment">//</span>
00523 
00524             Length = InputObjectName.Length;
00525 
00526             <span class="keywordflow">if</span> (((Length &amp; (<span class="keyword">sizeof</span>(WCHAR) - 1)) != 0) ||
00527                 (Length == (MAXUSHORT - <span class="keyword">sizeof</span>(WCHAR) + 1))) {
00528 
00529                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_NAME_INVALID;
00530 
00531             } <span class="keywordflow">else</span> {
00532 
00533                 <span class="comment">//</span>
00534                 <span class="comment">//  Allocate a buffer for the specified name string.</span>
00535                 <span class="comment">//</span>
00536                 <span class="comment">//  N.B. The name buffer allocation routine adds one</span>
00537                 <span class="comment">//       UNICODE character to the length and initializes</span>
00538                 <span class="comment">//       the string descriptor.</span>
00539                 <span class="comment">//</span>
00540 
00541                 FreeBuffer = <a class="code" href="../../d5/d1/obp_8h.html#a60">ObpAllocateObjectNameBuffer</a>( Length,
00542                                                           UseLookaside,
00543                                                           CapturedObjectName );
00544 
00545                 <span class="keywordflow">if</span> (FreeBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00546 
00547                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INSUFFICIENT_RESOURCES;
00548 
00549                 } <span class="keywordflow">else</span> {
00550 
00551                     <span class="comment">//</span>
00552                     <span class="comment">//  Copy the specified name string to the destination</span>
00553                     <span class="comment">//  buffer.</span>
00554                     <span class="comment">//</span>
00555 
00556                     RtlMoveMemory(FreeBuffer, InputObjectName.Buffer, Length);
00557 
00558                     <span class="comment">//</span>
00559                     <span class="comment">//  Zero terminate the name string and initialize the</span>
00560                     <span class="comment">//  string descriptor.</span>
00561                     <span class="comment">//</span>
00562 
00563                     FreeBuffer[Length / <span class="keyword">sizeof</span>(WCHAR)] = UNICODE_NULL;
00564                 }
00565             }
00566         }
00567 
00568     } except(<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00569 
00570         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00571 
00572         <span class="keywordflow">if</span> (FreeBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00573 
00574             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(FreeBuffer);
00575         }
00576     }
00577 
00578     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00579 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="obcreate.c::ObpFreeObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL ObpFreeObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">1098</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00175">_OBJECT_TYPE_INITIALIZER::DefaultNonPagedPoolCharge</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00174">_OBJECT_TYPE_INITIALIZER::DefaultPagedPoolCharge</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00291">ExFreePoolWithTag</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00325">_OBJECT_HEADER_HANDLE_INFO::HandleCountDataBase</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00189">_OBJECT_TYPE::Name</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00332">_OBJECT_HEADER_NAME_INFO::Name</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00318">_OBJECT_HEADER_QUOTA_INFO::NonPagedPoolCharge</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00352">OB_FLAG_DEFAULT_SECURITY_QUOTA</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00347">OB_FLAG_NEW_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00353">OB_FLAG_SINGLE_HANDLE_ENTRY</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00371">OBJECT_HEADER_TO_CREATOR_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00365">OBJECT_HEADER_TO_HANDLE_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00368">OBJECT_HEADER_TO_NAME_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00362">OBJECT_HEADER_TO_QUOTA_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00431">ObpFreeObjectCreateInformation</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00317">_OBJECT_HEADER_QUOTA_INFO::PagedPoolCharge</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00281">PROTECTED_POOL</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00174">PsReturnSharedPoolQuota()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00062">SE_DEFAULT_SECURITY_QUOTA</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00319">_OBJECT_HEADER_QUOTA_INFO::SecurityDescriptorCharge</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00192">_OBJECT_TYPE::TotalNumberOfObjects</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, and <a class="el" href="../../d8/d0/obref_8c-source.html#l01370">ObpRemoveObjectRoutine()</a>.
<p>
<pre class="fragment"><div>01104                    :
01105 
01106     This routine undoes <a class="code" href="../../d6/d0/obcreate_8c.html#a11">ObpAllocateObject</a>.  It returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object back to free <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
01107 
01108 Arguments:
01109 
01110     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> body of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being freed.
01111 
01112 Return Value:
01113 
01114     None.
01115 
01116 --*/
01117 
01118 {
01119     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01120     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
01121     <a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a> QuotaInfo;
01122     <a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">POBJECT_HEADER_HANDLE_INFO</a> HandleInfo;
01123     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
01124     <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a> CreatorInfo;
01125     PVOID FreeBuffer;
01126     ULONG NonPagedPoolCharge;
01127     ULONG PagedPoolCharge;
01128 
01129     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01130 
01131     <span class="comment">//</span>
01132     <span class="comment">//  Get the address of the object header.</span>
01133     <span class="comment">//</span>
01134 
01135     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(Object);
01136     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
01137 
01138     <span class="comment">//</span>
01139     <span class="comment">//  Now from the header determine the start of the allocation.  We need</span>
01140     <span class="comment">//  to backup based on what precedes the header.  The order is very</span>
01141     <span class="comment">//  important and must be the inverse of that used by ObpAllocateObject</span>
01142     <span class="comment">//</span>
01143 
01144     FreeBuffer = ObjectHeader;
01145 
01146     CreatorInfo = <a class="code" href="../../d4/d0/ob_8h.html#a13">OBJECT_HEADER_TO_CREATOR_INFO</a>( ObjectHeader );
01147 
01148     <span class="keywordflow">if</span> (CreatorInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01149 
01150         FreeBuffer = CreatorInfo;
01151     }
01152 
01153     NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
01154 
01155     <span class="keywordflow">if</span> (NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01156 
01157         FreeBuffer = NameInfo;
01158     }
01159 
01160     HandleInfo = <a class="code" href="../../d4/d0/ob_8h.html#a11">OBJECT_HEADER_TO_HANDLE_INFO</a>( ObjectHeader );
01161 
01162     <span class="keywordflow">if</span> (HandleInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01163 
01164         FreeBuffer = HandleInfo;
01165     }
01166 
01167     QuotaInfo = <a class="code" href="../../d4/d0/ob_8h.html#a10">OBJECT_HEADER_TO_QUOTA_INFO</a>( ObjectHeader );
01168 
01169     <span class="keywordflow">if</span> (QuotaInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01170 
01171         FreeBuffer = QuotaInfo;
01172     }
01173 
01174 <span class="preprocessor">#if DBG</span>
01175 <span class="preprocessor"></span>
01176     <span class="comment">//</span>
01177     <span class="comment">//  On a checked build echo out frees</span>
01178     <span class="comment">//</span>
01179 
01180     <span class="keywordflow">if</span> (ObpShowAllocAndFree) {
01181 
01182         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"OB: Free  %lx (%lx) - Type: %wZ\n"</span>, ObjectHeader, ObjectHeader, &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a> );
01183     }
01184 <span class="preprocessor">#endif</span>
01185 <span class="preprocessor"></span>
01186     <span class="comment">//</span>
01187     <span class="comment">//  Decrement the number of objects of this type</span>
01188     <span class="comment">//</span>
01189 
01190     ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o5">TotalNumberOfObjects</a> -= 1;
01191 
01192     <span class="comment">//</span>
01193     <span class="comment">//  Check where we were in the object initialization phase.  This</span>
01194     <span class="comment">//  flag really only tests if we have charged quota for this object.</span>
01195     <span class="comment">//  This is because the object create info and the quota block charged</span>
01196     <span class="comment">//  are unioned together.</span>
01197     <span class="comment">//</span>
01198 
01199     <span class="keywordflow">if</span> (ObjectHeader-&gt;Flags &amp; <a class="code" href="../../d4/d0/ob_8h.html#a1">OB_FLAG_NEW_OBJECT</a>) {
01200 
01201         <span class="keywordflow">if</span> (ObjectHeader-&gt;ObjectCreateInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01202 
01203             <a class="code" href="../../d5/d1/obp_8h.html#a29">ObpFreeObjectCreateInformation</a>( ObjectHeader-&gt;ObjectCreateInfo );
01204 
01205             ObjectHeader-&gt;ObjectCreateInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01206         }
01207 
01208     } <span class="keywordflow">else</span> {
01209 
01210         <span class="keywordflow">if</span> (ObjectHeader-&gt;QuotaBlockCharged != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01211 
01212             <span class="keywordflow">if</span> (QuotaInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01213 
01214                 PagedPoolCharge = QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o0">PagedPoolCharge</a> +
01215                                   QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o2">SecurityDescriptorCharge</a>;
01216 
01217                 NonPagedPoolCharge = QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o1">NonPagedPoolCharge</a>;
01218 
01219             } <span class="keywordflow">else</span> {
01220 
01221                 PagedPoolCharge = ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o10">DefaultPagedPoolCharge</a>;
01222 
01223                 <span class="keywordflow">if</span> (ObjectHeader-&gt;Flags &amp; <a class="code" href="../../d4/d0/ob_8h.html#a6">OB_FLAG_DEFAULT_SECURITY_QUOTA</a> ) {
01224 
01225                     PagedPoolCharge += <a class="code" href="../../d0/d5/se_8h.html#a0">SE_DEFAULT_SECURITY_QUOTA</a>;
01226                 }
01227 
01228                 NonPagedPoolCharge = ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o11">DefaultNonPagedPoolCharge</a>;
01229             }
01230 
01231             <a class="code" href="../../d0/d2/psquota_8c.html#a1">PsReturnSharedPoolQuota</a>( ObjectHeader-&gt;QuotaBlockCharged,
01232                                      PagedPoolCharge,
01233                                      NonPagedPoolCharge );
01234         }
01235     }
01236 
01237     <span class="keywordflow">if</span> ((HandleInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
01238         ((ObjectHeader-&gt;Flags &amp; <a class="code" href="../../d4/d0/ob_8h.html#a7">OB_FLAG_SINGLE_HANDLE_ENTRY</a>) == 0)) {
01239 
01240         <span class="comment">//</span>
01241         <span class="comment">//  If a handle database has been allocated, then free the memory.</span>
01242         <span class="comment">//</span>
01243 
01244         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( HandleInfo-&gt;<a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html#o0">HandleCountDataBase</a> );
01245 
01246         HandleInfo-&gt;<a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html#o0">HandleCountDataBase</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01247     }
01248 
01249     <span class="comment">//</span>
01250     <span class="comment">//  If a name string buffer has been allocated, then free the memory.</span>
01251     <span class="comment">//</span>
01252 
01253     <span class="keywordflow">if</span> (NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01254 
01255         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer );
01256 
01257         NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01258     }
01259 
01260     <span class="comment">//</span>
01261     <span class="comment">//  Trash type field so we don't get far if we attempt to</span>
01262     <span class="comment">//  use a stale object pointer to this object.</span>
01263     <span class="comment">//</span>
01264     <span class="comment">//  Sundown Note: trash it by zero-extended it. </span>
01265     <span class="comment">//                sign-extension will create a valid kernel address.</span>
01266 
01267 
01268     ObjectHeader-&gt;Type = UIntToPtr(0xBAD0B0B0); 
01269     <a class="code" href="../../d5/d8/ex_8h.html#a7">ExFreePoolWithTag</a>( FreeBuffer,
01270                        (ObjectType == NULL ? 'TjbO' : ObjectType-&gt;Key) |
01271                             PROTECTED_POOL );
01272 
01273     <span class="keywordflow">return</span>;
01274 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="obcreate.c::ObpFreeObjectNameBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL ObpFreeObjectNameBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ObjectName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00663">663</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01077">ExFreeToPPNPagedLookasideList()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>, and <a class="el" href="../../d6/d0/obp_8h-source.html#l00390">OBJECT_NAME_BUFFER_SIZE</a>.
<p>
<pre class="fragment"><div>00669                    :
00670 
00671     This function frees an object name buffer.
00672 
00673     N.B. This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> nonpageable.
00674 
00675 Arguments:
00676 
00677     ObjectName - Supplies a pointer to a name buffer string descriptor.
00678 
00679 Return Value:
00680 
00681     None.
00682 
00683 --*/
00684 
00685 {
00686     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00687     KIRQL OldIrql;
00688     PKPRCB Prcb;
00689 
00690     <span class="comment">//</span>
00691     <span class="comment">//  If the size of the buffer is not equal to the size of lookaside list</span>
00692     <span class="comment">//  entries, then  free the buffer to pool. Otherwise, free the buffer to</span>
00693     <span class="comment">//  the lookaside list.</span>
00694     <span class="comment">//</span>
00695 
00696     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = ObjectName-&gt;Buffer;
00697 
00698     <span class="keywordflow">if</span> (ObjectName-&gt;MaximumLength != <a class="code" href="../../d5/d1/obp_8h.html#a23">OBJECT_NAME_BUFFER_SIZE</a>) {
00699 
00700         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Buffer);
00701 
00702     } <span class="keywordflow">else</span> {
00703 
00704         <a class="code" href="../../d5/d8/ex_8h.html#a255">ExFreeToPPNPagedLookasideList</a>(LookasideNameBufferList, Buffer);
00705     }
00706 
00707     <span class="keywordflow">return</span>;
00708 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="obcreate.c::ObpObjectsCreated" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d0/obcreate_8c.html#a0">ObpObjectsCreated</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00047">47</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="obcreate.c::ObpObjectsWithCreatorInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d0/obcreate_8c.html#a4">ObpObjectsWithCreatorInfo</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00051">51</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="obcreate.c::ObpObjectsWithHandleDB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d0/obcreate_8c.html#a2">ObpObjectsWithHandleDB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00049">49</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="obcreate.c::ObpObjectsWithName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d0/obcreate_8c.html#a3">ObpObjectsWithName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00050">50</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="obcreate.c::ObpObjectsWithPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d0/obcreate_8c.html#a1">ObpObjectsWithPoolQuota</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00048">48</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
