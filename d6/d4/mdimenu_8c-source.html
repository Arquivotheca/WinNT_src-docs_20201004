<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mdimenu.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mdimenu.c</h1><a href="../../d5/d5/mdimenu_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/***************************************************************************\</span>
00002 <span class="comment">*</span>
00003 <span class="comment">*  MDIMENU.C -</span>
00004 <span class="comment">*</span>
00005 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">*      MDI "Window" Menu Support</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* History</span>
00010 <span class="comment">* 11-14-90 MikeHar     Ported from windows</span>
00011 <span class="comment">* 14-Feb-1991 mikeke   Added Revalidation code</span>
00012 <span class="comment">/****************************************************************************/</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00015 <span class="preprocessor">#pragma hdrstop</span>
00016 <span class="preprocessor"></span>
00017 <span class="comment">/***************************************************************************\</span>
00018 <span class="comment">* FindPwndChild</span>
00019 <span class="comment">*</span>
00020 <span class="comment">* History:</span>
00021 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00022 <span class="comment">\***************************************************************************/</span>
00023 
<a name="l00024"></a><a class="code" href="../../d6/d0/usercli_8h.html#a775">00024</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d0/usercli_8h.html#a775">FindPwndChild</a>(
00025     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndMDI,
00026     UINT wChildID)
00027 {
00028     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00029 
00030     <span class="keywordflow">for</span> (pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndMDI, spwndChild);
00031             pwndT &amp;&amp; (pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> || PtrToUlong(pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) != wChildID);
00032             pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndT, spwndNext))
00033         ;
00034 
00035     <span class="keywordflow">return</span> pwndT;
00036 }
00037 
00038 
00039 <span class="comment">/***************************************************************************\</span>
00040 <span class="comment">* MakeMenuItem</span>
00041 <span class="comment">*</span>
00042 <span class="comment">* History:</span>
00043 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00044 <span class="comment">*  4-16-91 Win31 Merge</span>
00045 <span class="comment">\***************************************************************************/</span>
00046 
<a name="l00047"></a><a class="code" href="../../d6/d0/usercli_8h.html#a776">00047</a> <span class="keywordtype">int</span> <a class="code" href="../../d6/d0/usercli_8h.html#a776">MakeMenuItem</a>(
00048     LPWSTR lpOut,
00049     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00050 {
00051     <a class="code" href="../../d8/d0/structtagMDI.html">PMDI</a> pmdi;
00052     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> rgParm;
00053     <span class="keywordtype">int</span> cch = 0;
00054     WCHAR string[160];
00055     LPWSTR lpstr;
00056     <span class="keywordtype">int</span> i = 0;
00057 
00058     <span class="comment">/*</span>
00059 <span class="comment">     * Get a pointer to the MDI structure</span>
00060 <span class="comment">     */</span>
00061     pmdi = ((<a class="code" href="../../d0/d1/structtagMDIWND.html">PMDIWND</a>)(<a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent)))-&gt;pmdi;
00062 
00063     *lpOut = 0;
00064 
00065     rgParm = PtrToUlong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) - (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a274">FIRST</a>(pmdi) + 1;
00066 
00067     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
00068         lpstr = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, strName.Buffer);
00069 
00070         <span class="comment">/*</span>
00071 <span class="comment">         * Search for an &amp; in the title string and duplicate it so that we don't</span>
00072 <span class="comment">         * get bogus accelerators.</span>
00073 <span class="comment">         */</span>
00074         <span class="keywordflow">while</span> (*lpstr &amp;&amp; i &lt; ((<span class="keyword">sizeof</span>(string) / <span class="keyword">sizeof</span>(WCHAR)) - 1)) {
00075             string[i] = *lpstr;
00076             i++;
00077             <span class="keywordflow">if</span> (*lpstr == TEXT(<span class="charliteral">'&amp;'</span>))
00078                 string[i++] = TEXT(<span class="charliteral">'&amp;'</span>);
00079 
00080             lpstr++;
00081         }
00082 
00083         string[i] = 0;
00084         cch = <a class="code" href="../../d6/d0/wsprintf_8c.html#a10">wsprintfW</a>(lpOut, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"&amp;%d %ws"</span>, rgParm, string);
00085 
00086     } <span class="keywordflow">else</span> {
00087 
00088         <span class="comment">/*</span>
00089 <span class="comment">         * Handle the case of MDI children without any window title text.</span>
00090 <span class="comment">         */</span>
00091         cch = <a class="code" href="../../d6/d0/wsprintf_8c.html#a10">wsprintfW</a>(lpOut, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"&amp;%d "</span>, rgParm);
00092     }
00093 
00094     <span class="keywordflow">return</span> cch;
00095 }
00096 
00097 <span class="comment">/***************************************************************************\</span>
00098 <span class="comment">* ModifyMenuItem</span>
00099 <span class="comment">*</span>
00100 <span class="comment">* History:</span>
00101 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00102 <span class="comment">\***************************************************************************/</span>
00103 
<a name="l00104"></a><a class="code" href="../../d6/d0/usercli_8h.html#a777">00104</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a777">ModifyMenuItem</a>(
00105     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00106 {
00107     <a class="code" href="../../d8/d0/structtagMDI.html">PMDI</a> pmdi;
00108     WCHAR sz[200];
00109     MENUITEMINFO    mii;
00110     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00111     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu;
00112 
00113     <span class="comment">/*</span>
00114 <span class="comment">     * Get a pointer to the MDI structure</span>
00115 <span class="comment">     */</span>
00116     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00117     pmdi = ((<a class="code" href="../../d0/d1/structtagMDIWND.html">PMDIWND</a>)pwndParent)-&gt;pmdi;
00118 
00119     <span class="keywordflow">if</span> (PtrToUlong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) &gt; <a class="code" href="../../d6/d0/usercli_8h.html#a274">FIRST</a>(pmdi) + (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)8)
00120         <span class="keywordflow">return</span>;
00121 
00122     mii.cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00123     mii.fMask = MIIM_STRING;
00124     mii.dwTypeData = sz;
00125 
00126     <span class="comment">/*</span>
00127 <span class="comment">     * Parent is MDI Client.</span>
00128 <span class="comment">     */</span>
00129     <a class="code" href="../../d6/d0/usercli_8h.html#a776">MakeMenuItem</a>(sz, pwnd);
00130 
00131     <span class="comment">/*</span>
00132 <span class="comment">     * Changing the active child?  Check it.</span>
00133 <span class="comment">     */</span>
00134     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd) == <a class="code" href="../../d6/d0/usercli_8h.html#a272">ACTIVE</a>(pmdi)) {
00135         mii.fMask |= MIIM_STATE;
00136         mii.fState = MFS_CHECKED;
00137     }
00138 
00139     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndParent, spwndParent);
00140 
00141     <span class="keywordflow">if</span> (pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) {
00142 
00143         <span class="comment">/*</span>
00144 <span class="comment">         * Bug# 21566. If spmenu is NULL we used to fail</span>
00145 <span class="comment">         * because REBASEALWAYS is trying to get the kernel</span>
00146 <span class="comment">         * address of NULL based on pwndParent</span>
00147 <span class="comment">         */</span>
00148         pmenu = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndParent, spmenu);
00149         <span class="comment">/*</span>
00150 <span class="comment">         * Internal call to SetMenuItemInfo</span>
00151 <span class="comment">         */</span>
00152         <a class="code" href="../../d6/d0/usercli_8h.html#a771">ThunkedMenuItemInfo</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pmenu), PtrToUlong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>), <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;mii, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00153     }
00154 }
00155 
00156 <span class="comment">/***************************************************************************\</span>
00157 <span class="comment">* MDIAddSysMenu</span>
00158 <span class="comment">*</span>
00159 <span class="comment">* Insert the MDI child's system menu onto the existing Menu.</span>
00160 <span class="comment">*</span>
00161 <span class="comment">* History:</span>
00162 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00163 <span class="comment">\***************************************************************************/</span>
00164 
<a name="l00165"></a><a class="code" href="../../d6/d0/usercli_8h.html#a778">00165</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d0/usercli_8h.html#a778">MDIAddSysMenu</a>(
00166     HMENU hMenuFrame,
00167     HWND hwndChild)
00168 {
00169     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
00170     MENUITEMINFO    mii;
00171     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenuChild;
00172 
00173 
00174 <span class="comment">// LATER -- look at passing pwndChild in -- FritzS</span>
00175 
00176     UserAssert(<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwndChild));
00177     pwndChild = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndChild);
00178     <span class="keywordflow">if</span> (!hMenuFrame || !pwndChild || !pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>) {
00179         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00180     }
00181 
00182     <span class="comment">/*</span>
00183 <span class="comment">     * We don't need the pMenuChild pointer but the handle. However, if you</span>
00184 <span class="comment">     * do PtoH(_GetSubMenu()), you end up calling the function twice</span>
00185 <span class="comment">     */</span>
00186     pMenuChild = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a15">_GetSubMenu</a> (<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndChild, spmenuSys), 0);
00187     <span class="keywordflow">if</span> (!pMenuChild) {
00188         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00189     }
00190 
00191 <span class="comment">// Add MDI system button as first menu item</span>
00192     mii.cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00193     mii.fMask = MIIM_SUBMENU | MIIM_DATA | MIIM_BITMAP;  <span class="comment">// Add MIIM_DATA because of hack described below</span>
00194     mii.hSubMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pMenuChild);
00195 <span class="comment">// Fritzs -- this won't work.</span>
00196 <span class="comment">//    mii.dwTypeData = (LPSTR) MAKELONG(MENUHBM_SYSTEM, GetWindowSmIcon(hwndChild));</span>
00197     mii.hbmpItem = HBMMENU_SYSTEM;
00198 <span class="comment">// FritzS -- so, we sneak the icon into ItemData</span>
00199     mii.dwItemData = (ULONG_PTR)hwndChild;
00200 
00201     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(hMenuFrame, 0, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii))
00202         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00203 
00204     <span class="comment">// TimeLine 6.1 gets confused by the extra Min/Close buttons,</span>
00205     <span class="comment">// don't add them if WFOLDUI</span>
00206 
00207     mii.fMask = MIIM_ID | MIIM_FTYPE | MIIM_BITMAP;
00208     mii.fType = MFT_RIGHTJUSTIFY;
00209 
00210     pwndChild = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndChild);
00211     <span class="keywordflow">if</span> (!pwndChild) {
00212         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenuFrame, 0, MF_BYPOSITION);
00213         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00214     }
00215 
00216 
00217     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a587">WFOLDUI</a>))
00218     {
00219         <span class="comment">// Add Minimize button as last menu item</span>
00220         mii.hbmpItem = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a636">WFMINBOX</a>) ? HBMMENU_MBAR_MINIMIZE : HBMMENU_MBAR_MINIMIZE_D);
00221         mii.wID = SC_MINIMIZE;
00222 
00223         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(hMenuFrame, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii))
00224         {
00225             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenuFrame, 0, MF_BYPOSITION);
00226             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00227         }
00228         mii.fType &amp;= ~MFT_RIGHTJUSTIFY;
00229     }
00230 
00231     <span class="comment">// Add Restore button as last menu item</span>
00232     mii.hbmpItem = HBMMENU_MBAR_RESTORE;
00233     mii.wID = SC_RESTORE;
00234 
00235     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(hMenuFrame, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii)) {
00236         <span class="comment">// BOGUS -- we gotta remove the MINIMIZE button too</span>
00237         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenuFrame, 0, MF_BYPOSITION);
00238         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00239     }
00240 
00241     pwndChild = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndChild);
00242     <span class="keywordflow">if</span> (!pwndChild) {
00243         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenuFrame, 0, MF_BYPOSITION);
00244         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00245     }
00246 
00247     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a587">WFOLDUI</a>))
00248     {
00249         <span class="comment">// Add Close button as last menu item</span>
00250         mii.hbmpItem = (<a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a1">xxxMNCanClose</a>(pwndChild) ? HBMMENU_MBAR_CLOSE : HBMMENU_MBAR_CLOSE_D);
00251         mii.wID = SC_CLOSE;
00252 
00253         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(hMenuFrame, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii))
00254         {
00255             <span class="comment">// BOGUS -- we gotta remove the MINIMIZE and RESTORE buttons too</span>
00256             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenuFrame, 0, MF_BYPOSITION);
00257             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00258         }
00259     }
00260 
00261     <span class="comment">/*</span>
00262 <span class="comment">     * Set the menu items to proper state since we just maximized it.  Note</span>
00263 <span class="comment">     * setsysmenu doesn't work if we've cleared the sysmenu bit so do it now...</span>
00264 <span class="comment">     */</span>
00265     <a class="code" href="../../d6/d0/usercli_8h.html#a229">NtUserSetSysMenu</a>(hwndChild);
00266 
00267     <span class="comment">/*</span>
00268 <span class="comment">     * This is so that if the user brings up the child sysmenu, it's sure</span>
00269 <span class="comment">     * to be that in the frame menu bar...</span>
00270 <span class="comment">     */</span>
00271     <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>);
00272 
00273     <span class="comment">/*</span>
00274 <span class="comment">     * Make sure that the child's frame is redrawn to reflect the removed</span>
00275 <span class="comment">     * system menu.</span>
00276 <span class="comment">     */</span>
00277     <a class="code" href="../../d6/d0/usercli_8h.html#a222">NtUserRedrawFrame</a>(hwndChild);
00278 
00279     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00280 }
00281 
00282 <span class="comment">/***************************************************************************\</span>
00283 <span class="comment">* MDIRemoveSysMenu</span>
00284 <span class="comment">*</span>
00285 <span class="comment">* History:</span>
00286 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00287 <span class="comment">\***************************************************************************/</span>
00288 
<a name="l00289"></a><a class="code" href="../../d6/d0/usercli_8h.html#a779">00289</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d0/usercli_8h.html#a779">MDIRemoveSysMenu</a>(
00290     HMENU hMenuFrame,
00291     HWND hwndChild)
00292 {
00293     <span class="keywordtype">int</span> iLastItem;
00294     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    iLastCmd;
00295     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
00296 
00297 <span class="comment">// LATER -- look at passing pwndChild in -- FritzS</span>
00298 
00299     <span class="keywordflow">if</span> (hMenuFrame == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00300         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00301 
00302     pwndChild = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndChild);
00303 
00304     <span class="keywordflow">if</span> (pwndChild == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00305         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00306 
00307     iLastItem = <a class="code" href="../../d3/d9/client_2wow_8c.html#a8">GetMenuItemCount</a>(hMenuFrame) - 1;
00308     iLastCmd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a587">WFOLDUI</a>) ? SC_RESTORE : SC_CLOSE;
00309 
00310     <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) <a class="code" href="../../d3/d9/client_2wow_8c.html#a9">GetMenuItemID</a>(hMenuFrame, iLastItem) != iLastCmd)
00311         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00312 
00313     <span class="comment">/*</span>
00314 <span class="comment">     * Enable the sysmenu in the child window.</span>
00315 <span class="comment">     */</span>
00316     <a class="code" href="../../d4/d1/userk_8h.html#a1628">SetWindowState</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>);
00317 
00318     <span class="comment">/*</span>
00319 <span class="comment">     * Take the child sysmenu popup out of the frame menu.</span>
00320 <span class="comment">     */</span>
00321     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hMenuFrame, 0, MF_BYPOSITION);
00322 
00323     <span class="comment">/*</span>
00324 <span class="comment">     * Delete the restore button from the menu bar.</span>
00325 <span class="comment">     */</span>
00326     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a154">NtUserDeleteMenu</a>(hMenuFrame, iLastItem - 1, MF_BYPOSITION);
00327 
00328     pwndChild = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndChild);
00329     <span class="keywordflow">if</span> (pwndChild == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00330         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00331 
00332     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a587">WFOLDUI</a>)) {
00333         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a154">NtUserDeleteMenu</a>(hMenuFrame, iLastItem - 2, MF_BYPOSITION);
00334         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a154">NtUserDeleteMenu</a>(hMenuFrame, iLastItem - 3, MF_BYPOSITION);
00335     }
00336 
00337     <span class="comment">/*</span>
00338 <span class="comment">     * Make sure that the child's frame is redrawn to reflect the added</span>
00339 <span class="comment">     * system menu.</span>
00340 <span class="comment">     */</span>
00341     <a class="code" href="../../d6/d0/usercli_8h.html#a222">NtUserRedrawFrame</a>(hwndChild);
00342 
00343     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00344 }
00345 
00346 <span class="comment">/***************************************************************************\</span>
00347 <span class="comment">* AppendToWindowsMenu</span>
00348 <span class="comment">*</span>
00349 <span class="comment">* Add the title of the MDI child window 'hwndChild' to the bottom of the</span>
00350 <span class="comment">* "Window" menu (or add the "More Windows ..." item) if there's room.</span>
00351 <span class="comment">*</span>
00352 <span class="comment">*   MDI Child #                    Add</span>
00353 <span class="comment">*  -------------          --------------------</span>
00354 <span class="comment">*   &lt; MAXITEMS             Child # and Title</span>
00355 <span class="comment">*   = MAXITEMS             "More Windows ..."</span>
00356 <span class="comment">*   &gt; MAXITEMS             nothing</span>
00357 <span class="comment">*</span>
00358 <span class="comment">* History:</span>
00359 <span class="comment">* 17-Mar-1992 mikeke   from win31</span>
00360 <span class="comment">\***************************************************************************/</span>
00361 
<a name="l00362"></a><a class="code" href="../../d5/d5/mdimenu_8c.html#a5">00362</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> PASCAL <a class="code" href="../../d5/d5/mdimenu_8c.html#a5">AppendToWindowsMenu</a>(
00363     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndMDI,
00364     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild)
00365 {
00366     <a class="code" href="../../d8/d0/structtagMDI.html">PMDI</a> pmdi;
00367     WCHAR szMenuItem[165];
00368     <span class="keywordtype">int</span> item;
00369     MENUITEMINFO    mii;
00370 
00371     <span class="comment">/*</span>
00372 <span class="comment">     * Get a pointer to the MDI structure</span>
00373 <span class="comment">     */</span>
00374     pmdi = ((<a class="code" href="../../d0/d1/structtagMDIWND.html">PMDIWND</a>)pwndMDI)-&gt;pmdi;
00375 
00376     item = PtrToUlong(pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) - <a class="code" href="../../d6/d0/usercli_8h.html#a274">FIRST</a>(pmdi);
00377 
00378     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a273">WINDOW</a>(pmdi) &amp;&amp; (item &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a260">MAXITEMS</a>)) {
00379         mii.cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00380         <span class="keywordflow">if</span> (!item) {
00381 
00382             <span class="comment">/*</span>
00383 <span class="comment">             * Add separator before first item</span>
00384 <span class="comment">             */</span>
00385             mii.fMask = MIIM_FTYPE;
00386             mii.fType = MFT_SEPARATOR;
00387             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a273">WINDOW</a>(pmdi), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii))
00388                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00389         }
00390 
00391         <span class="keywordflow">if</span> (item == (<a class="code" href="../../d6/d0/usercli_8h.html#a260">MAXITEMS</a> - 1))
00392             LoadString(<a class="code" href="../../d1/d8/clglobal_8c.html#a6">hmodUser</a>, <a class="code" href="../../d6/d0/usercli_8h.html#a158">STR_MOREWINDOWS</a>, szMenuItem,
00393                        <span class="keyword">sizeof</span>(szMenuItem) / <span class="keyword">sizeof</span>(WCHAR));
00394         <span class="keywordflow">else</span>
00395             <a class="code" href="../../d6/d0/usercli_8h.html#a776">MakeMenuItem</a>(szMenuItem, pwndChild);
00396 
00397         mii.fMask = MIIM_ID | MIIM_STRING;
00398         mii.wID = PtrToUlong(pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
00399         mii.dwTypeData = szMenuItem;
00400         mii.cch = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00401         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a273">WINDOW</a>(pmdi), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii))
00402             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00403     }
00404     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00405 }
00406 
00407 <span class="comment">/***************************************************************************\</span>
00408 <span class="comment">* SwitchWindowsMenus</span>
00409 <span class="comment">*</span>
00410 <span class="comment">* Switch the "Window" menu in the frame menu bar 'hMenu' from</span>
00411 <span class="comment">* 'hOldWindow' to 'hNewWindow'</span>
00412 <span class="comment">*</span>
00413 <span class="comment">* History:</span>
00414 <span class="comment">* 17-Mar-1992 mikeke    from win31</span>
00415 <span class="comment">\***************************************************************************/</span>
00416 
<a name="l00417"></a><a class="code" href="../../d5/d5/mdimenu_8c.html#a6">00417</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d5/d5/mdimenu_8c.html#a6">SwitchWindowsMenus</a>(
00418     HMENU hmenu,
00419     HMENU hOldWindow,
00420     HMENU hNewWindow)
00421 {
00422     <span class="keywordtype">int</span> i;
00423     HMENU hsubMenu;
00424     WCHAR szMenuName[128];
00425     MENUITEMINFO    mii;
00426 
00427     <span class="keywordflow">if</span> (hOldWindow == hNewWindow)
00428         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00429 
00430     mii.cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00431 
00432     <span class="comment">/*</span>
00433 <span class="comment">     * Determine position of old "Window" menu</span>
00434 <span class="comment">     */</span>
00435     <span class="keywordflow">for</span> (i = 0; hsubMenu = <a class="code" href="../../d3/d9/client_2wow_8c.html#a14">GetSubMenu</a>(hmenu, i); i++) {
00436         <span class="keywordflow">if</span> (hsubMenu == hOldWindow)
00437         {
00438             <span class="comment">// Extract the name of the old menu to use it for the new menu</span>
00439             mii.fMask = MIIM_STRING;
00440             mii.dwTypeData = szMenuName;
00441             mii.cch = <span class="keyword">sizeof</span>(szMenuName)/<span class="keyword">sizeof</span>(WCHAR);
00442             <a class="code" href="../../d6/d0/usercli_8h.html#a767">GetMenuItemInfoInternalW</a>(hmenu, i, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii);
00443             <span class="comment">// Out with the old, in with the new</span>
00444             <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a218">NtUserRemoveMenu</a>(hmenu, i, MF_BYPOSITION))
00445                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00446 
00447             mii.fMask |= MIIM_SUBMENU;
00448             mii.hSubMenu = hNewWindow;
00449             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a>(hmenu, i, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, &amp;mii));
00450         }
00451     }
00452 
00453     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00454 }
00455 
00456 <span class="comment">/***************************************************************************\</span>
00457 <span class="comment">* ShiftMenuIDs</span>
00458 <span class="comment">*</span>
00459 <span class="comment">* Shift the id's of the MDI child windows of the MDI client window 'hWnd'</span>
00460 <span class="comment">* down by 1 (id--) starting with the child window 'hwndVictim' -- moving</span>
00461 <span class="comment">* 'hwndVictim' to the end of the list</span>
00462 <span class="comment">*</span>
00463 <span class="comment">* History:</span>
00464 <span class="comment">* 17-Mar-1992 mikeke   from win31</span>
00465 <span class="comment">\***************************************************************************/</span>
00466 
<a name="l00467"></a><a class="code" href="../../d6/d0/usercli_8h.html#a780">00467</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a780">ShiftMenuIDs</a>(
00468     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00469     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndVictim)
00470 {
00471     <a class="code" href="../../d8/d0/structtagMDI.html">PMDI</a> pmdi;
00472     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
00473     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00474     <span class="comment">/*</span>
00475 <span class="comment">     * Get a pointer to the MDI structure</span>
00476 <span class="comment">     */</span>
00477     pmdi = ((<a class="code" href="../../d0/d1/structtagMDIWND.html">PMDIWND</a>)pwnd)-&gt;pmdi;
00478 
00479     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndVictim, spwndParent);
00480     pwndChild = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndParent, spwndChild);
00481 
00482     <span class="keywordflow">while</span> (pwndChild) {
00483         <span class="keywordflow">if</span> (!pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> &amp;&amp; (pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a> &gt; pwndVictim-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)) {
00484             <a class="code" href="../../d5/d9/cltxt_8h.html#a12">SetWindowLongPtr</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndChild), GWLP_ID, PtrToUlong(pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) - 1);
00485         }
00486         pwndChild = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndChild, spwndNext);
00487     }
00488 
00489     <a class="code" href="../../d5/d9/cltxt_8h.html#a12">SetWindowLongPtr</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndVictim), GWLP_ID, <a class="code" href="../../d6/d0/usercli_8h.html#a274">FIRST</a>(pmdi) + <a class="code" href="../../d6/d0/usercli_8h.html#a270">CKIDS</a>(pmdi) - 1);
00490 }
00491 
00492 <span class="comment">/***************************************************************************\</span>
00493 <span class="comment">* MDISetMenu</span>
00494 <span class="comment">*</span>
00495 <span class="comment">* History:</span>
00496 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00497 <span class="comment">\***************************************************************************/</span>
00498 
<a name="l00499"></a><a class="code" href="../../d6/d0/usercli_8h.html#a781">00499</a> HMENU <a class="code" href="../../d6/d0/usercli_8h.html#a781">MDISetMenu</a>(
00500     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndMDI,
00501     BOOL fRefresh,
00502     HMENU hNewSys,
00503     HMENU hNewWindow)
00504 {
00505     <span class="keywordtype">int</span> i;
00506     <span class="keywordtype">int</span> iFirst;
00507     <span class="keywordtype">int</span> item;
00508     <a class="code" href="../../d8/d0/structtagMDI.html">PMDI</a> pmdi;
00509     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00510     HMENU hOldSys;
00511     HMENU hOldWindow;
00512     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
00513 
00514     <span class="comment">/*</span>
00515 <span class="comment">     * Get a pointer to the MDI structure</span>
00516 <span class="comment">     */</span>
00517     pmdi = ((<a class="code" href="../../d0/d1/structtagMDIWND.html">PMDIWND</a>)pwndMDI)-&gt;pmdi;
00518 
00519     <span class="comment">/*</span>
00520 <span class="comment">     * Save the old values</span>
00521 <span class="comment">     */</span>
00522     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndMDI, spwndParent);
00523     hOldSys = <a class="code" href="../../d3/d9/client_2wow_8c.html#a7">GetMenu</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent));
00524     hOldWindow = <a class="code" href="../../d6/d0/usercli_8h.html#a273">WINDOW</a>(pmdi);
00525 
00526     <span class="keywordflow">if</span> (fRefresh) {
00527         hNewSys = hOldSys;
00528         hNewWindow = hOldWindow;
00529     }
00530 
00531     <span class="comment">/*</span>
00532 <span class="comment">     * Change the Frame Menu.</span>
00533 <span class="comment">     */</span>
00534     <span class="keywordflow">if</span> (hNewSys &amp;&amp; (hNewSys != hOldSys)) {
00535         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a271">MAXED</a>(pmdi))
00536             <a class="code" href="../../d6/d0/usercli_8h.html#a779">MDIRemoveSysMenu</a>(hOldSys, <a class="code" href="../../d6/d0/usercli_8h.html#a271">MAXED</a>(pmdi));
00537 
00538         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a226">NtUserSetMenu</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), hNewSys, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00539 
00540         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a271">MAXED</a>(pmdi))
00541             <a class="code" href="../../d6/d0/usercli_8h.html#a778">MDIAddSysMenu</a>(hNewSys, <a class="code" href="../../d6/d0/usercli_8h.html#a271">MAXED</a>(pmdi));
00542     } <span class="keywordflow">else</span>
00543         hNewSys = hOldSys;
00544 
00545     <span class="comment">/*</span>
00546 <span class="comment">     * Now update the Window menu.</span>
00547 <span class="comment">     */</span>
00548     <span class="keywordflow">if</span> (fRefresh || (hOldWindow != hNewWindow)) {
00549         iFirst = <a class="code" href="../../d6/d0/usercli_8h.html#a274">FIRST</a>(pmdi);
00550 
00551         <span class="keywordflow">if</span> (hOldWindow) {
00552             <span class="keywordtype">int</span> cItems = <a class="code" href="../../d3/d9/client_2wow_8c.html#a8">GetMenuItemCount</a>(hOldWindow);
00553 
00554             <span class="keywordflow">for</span> (i = cItems - 1; i &gt;= 0; i--) {
00555                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9/client_2wow_8c.html#a10">GetMenuState</a>(hOldWindow, i, MF_BYPOSITION) &amp; MF_SEPARATOR)
00556                    <span class="keywordflow">break</span>;
00557             }
00558             <span class="keywordflow">if</span> ((i &gt;= 0) &amp;&amp; (<a class="code" href="../../d3/d9/client_2wow_8c.html#a9">GetMenuItemID</a>(hOldWindow, i + 1) == (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)iFirst)) {
00559                 <span class="keywordtype">int</span> idTrim = i;
00560 
00561                 <span class="keywordflow">for</span> (i = idTrim; i &lt; cItems; i++)
00562                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a154">NtUserDeleteMenu</a>(hOldWindow, idTrim, MF_BYPOSITION);
00563             }
00564         }
00565 
00566         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;<a class="code" href="../../d6/d0/usercli_8h.html#a273">WINDOW</a>(pmdi), hNewWindow);
00567 
00568         <span class="keywordflow">if</span> (hNewWindow != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00569 
00570            <span class="comment">/*</span>
00571 <span class="comment">            * Add the list of child windows to the new window</span>
00572 <span class="comment">            */</span>
00573            <span class="keywordflow">for</span> (i = 0, item = 0; ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)i &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a270">CKIDS</a>(pmdi)) &amp;&amp; (item &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a260">MAXITEMS</a>);
00574                     i++) {
00575                pwndChild = <a class="code" href="../../d6/d0/usercli_8h.html#a775">FindPwndChild</a>(pwndMDI, iFirst + item);
00576                <span class="keywordflow">if</span> (pwndChild != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00577                    <span class="keywordflow">if</span> ((!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>) &amp;&amp;
00578                           (LOWORD(pwndMDI-&gt;style) &amp; 0x0001)) ||
00579                           <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00580                        <a class="code" href="../../d6/d0/usercli_8h.html#a780">ShiftMenuIDs</a>(pwndMDI, pwndChild);
00581                    } <span class="keywordflow">else</span> {
00582                        <a class="code" href="../../d5/d5/mdimenu_8c.html#a5">AppendToWindowsMenu</a>(pwndMDI, pwndChild);
00583                        item++;
00584                    }
00585                }
00586            }
00587 
00588            <span class="comment">/*</span>
00589 <span class="comment">            * Add checkmark by the active child's menu item</span>
00590 <span class="comment">            */</span>
00591            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a272">ACTIVE</a>(pmdi))
00592                <a class="code" href="../../d7/d7/menuc_8c.html#a0">CheckMenuItem</a>(hNewWindow, (WORD)GetWindowID(<a class="code" href="../../d6/d0/usercli_8h.html#a272">ACTIVE</a>(pmdi)),
00593                        MF_BYCOMMAND | MF_CHECKED);
00594         }
00595 
00596         <span class="comment">/*</span>
00597 <span class="comment">         * Out with the old, in with the new</span>
00598 <span class="comment">         */</span>
00599         <a class="code" href="../../d5/d5/mdimenu_8c.html#a6">SwitchWindowsMenus</a>(hNewSys, hOldWindow, hNewWindow);
00600     }
00601     <span class="keywordflow">return</span> hOldSys;
00602 }
00603 
00604 <span class="comment">/***************************************************************************\</span>
00605 <span class="comment">* xxxInitActivateDlg</span>
00606 <span class="comment">*</span>
00607 <span class="comment">* History:</span>
00608 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00609 <span class="comment">\***************************************************************************/</span>
00610 
<a name="l00611"></a><a class="code" href="../../d5/d5/mdimenu_8c.html#a9">00611</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d5/mdimenu_8c.html#a9">xxxInitActivateDlg</a>(
00612     HWND hwnd,
00613     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndMDI)
00614 {
00615     <a class="code" href="../../d8/d0/structtagMDI.html">PMDI</a> pmdi;
00616     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wKid;
00617     HWND hwndT;
00618     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00619     WCHAR <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a768">CCHTITLEMAX</a>];
00620     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndT;
00621     SIZE <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00622     HDC hDC;
00623     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> width = 0;
00624 
00625     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndMDI);
00626 
00627     <span class="comment">/*</span>
00628 <span class="comment">     * Get a pointer to the MDI structure</span>
00629 <span class="comment">     */</span>
00630     pmdi = ((<a class="code" href="../../d0/d1/structtagMDIWND.html">PMDIWND</a>)pwndMDI)-&gt;pmdi;
00631 
00632     hDC = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(hwnd);
00633 
00634     <span class="comment">/*</span>
00635 <span class="comment">     * Insert the list of titles.</span>
00636 <span class="comment">     * Note the wKid-th item in the listbox has ID wKid+FIRST(pwnd), so that</span>
00637 <span class="comment">     * the listbox is in creation order (like the menu).  This is also</span>
00638 <span class="comment">     * helpful when we go to select one...</span>
00639 <span class="comment">     */</span>
00640 
00641     <span class="keywordflow">for</span> (wKid = 0; wKid &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a270">CKIDS</a>(pmdi); wKid++) {
00642         pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a775">FindPwndChild</a>(pwndMDI, (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(wKid + <a class="code" href="../../d6/d0/usercli_8h.html#a274">FIRST</a>(pmdi)));
00643 
00644         <span class="keywordflow">if</span> (pwndT &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00645             <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndT, &amp;tlpwndT);
00646             <a class="code" href="../../d5/d9/cltxt_8h.html#a21">GetWindowText</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndT), <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a768">CCHTITLEMAX</a>);
00647             <a class="code" href="../../d5/d9/cltxt_8h.html#a18">SendDlgItemMessage</a>(hwnd, 100, LB_ADDSTRING, 0, (LPARAM)<a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>);
00648             GetTextExtentPoint(hDC, <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>, lstrlen(<a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>);
00649             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.cx &gt; (LONG)width) {
00650                 width = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.cx;
00651             }
00652             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00653         }
00654     }
00655 
00656     <span class="comment">/*</span>
00657 <span class="comment">     * Select the currently active window.</span>
00658 <span class="comment">     */</span>
00659     <a class="code" href="../../d5/d9/cltxt_8h.html#a18">SendDlgItemMessage</a>(hwnd, 100, LB_SETTOPINDEX, <a class="code" href="../../d6/d0/usercli_8h.html#a260">MAXITEMS</a> - 1, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00660     <a class="code" href="../../d5/d9/cltxt_8h.html#a18">SendDlgItemMessage</a>(hwnd, 100, LB_SETCURSEL, <a class="code" href="../../d6/d0/usercli_8h.html#a260">MAXITEMS</a> - 1, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00661 
00662     <span class="comment">/*</span>
00663 <span class="comment">     * Set the horizontal extent of the list box to the longest window title.</span>
00664 <span class="comment">     */</span>
00665     <a class="code" href="../../d5/d9/cltxt_8h.html#a18">SendDlgItemMessage</a>(hwnd, 100, LB_SETHORIZONTALEXTENT, width, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00666     <a class="code" href="../../d6/d0/usercli_8h.html#a211">NtUserReleaseDC</a>(hwnd, hDC);
00667 
00668     <span class="comment">/*</span>
00669 <span class="comment">     * Set the focus to the listbox.</span>
00670 <span class="comment">     */</span>
00671     hwndT = <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(hwnd, 100);
00672     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a225">NtUserSetFocus</a>(hwndT);
00673 }
00674 
00675 <span class="comment">/***************************************************************************\</span>
00676 <span class="comment">* MDIActivateDlgSize</span>
00677 <span class="comment">*</span>
00678 <span class="comment">* The minimum allowed size and the previous one are saved as properties</span>
00679 <span class="comment">* of the parent window.</span>
00680 <span class="comment">*</span>
00681 <span class="comment">* History:</span>
00682 <span class="comment">* Oct 97 MCostea Created</span>
00683 <span class="comment">\***************************************************************************/</span>
00684 
<a name="l00685"></a><a class="code" href="../../d5/d5/mdimenu_8c.html#a10">00685</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d5/mdimenu_8c.html#a10">MDIActivateDlgSize</a>(HWND hwnd, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)
00686 {
00687     <a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">PMDIACTIVATEPOS</a> pPos;
00688     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndList, pwndButtonLeft, pwndButtonRight;
00689     HDWP hdwp;
00690     <span class="keywordtype">int</span>  deltaX, deltaY;
00691 
00692     pPos = (<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">PMDIACTIVATEPOS</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a27">GetProp</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a13">GetParent</a>(hwnd), <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a>));
00693     <span class="keywordflow">if</span> (pPos == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00694         <span class="keywordflow">return</span>;
00695     }
00696 
00697     <span class="comment">/*</span>
00698 <span class="comment">     * Retrieve the children</span>
00699 <span class="comment">     */</span>
00700     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00701         <span class="keywordflow">return</span>;
00702     }
00703     pwndList = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndChild);
00704     pwndButtonLeft  = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndList, spwndNext);
00705     pwndButtonRight = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndButtonLeft, spwndNext);
00706 
00707     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndList) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a>);
00708     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndButtonLeft) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>);
00709     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndButtonRight) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>);
00710     UserAssert(pwndButtonRight-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left &gt; pwndButtonLeft-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left);
00711 
00712     deltaX = width - pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o0">cx</a>;
00713     deltaY = height - pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o1">cy</a>;
00714 
00715     pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o0">cx</a> = width;
00716     pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o1">cy</a> = height;
00717 
00718     <span class="comment">/*</span>
00719 <span class="comment">     * Move/resize the child windows accordingly</span>
00720 <span class="comment">     */</span>
00721     hdwp = <a class="code" href="../../d6/d0/usercli_8h.html#a213">NtUserBeginDeferWindowPos</a>(3);
00722 
00723     <span class="keywordflow">if</span> (hdwp)
00724     {
00725         hdwp = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a108">NtUserDeferWindowPos</a>( hdwp,
00726                                <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pwndList),
00727                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00728                                0,
00729                                0,
00730                                deltaX + pwndList-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwndList-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left,
00731                                deltaY + pwndList-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwndList-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top,
00732                                SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE );
00733 
00734         <span class="keywordflow">if</span> (hdwp)
00735         {
00736             hdwp = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a108">NtUserDeferWindowPos</a>(hdwp,
00737                                <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pwndButtonLeft),
00738                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00739                                pwndButtonLeft-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00740                                deltaY + pwndButtonLeft-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top,
00741                                0,
00742                                0,
00743                                SWP_NOSIZE | SWP_NOZORDER | SWP_NOACTIVATE );
00744 
00745 
00746             <span class="keywordflow">if</span> (hdwp)
00747             {
00748                 hdwp = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a108">NtUserDeferWindowPos</a>( hdwp,
00749                                <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pwndButtonRight),
00750                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00751                                pwndButtonRight-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00752                                deltaY + pwndButtonRight-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top,
00753                                0,
00754                                0,
00755                                SWP_NOSIZE | SWP_NOZORDER | SWP_NOACTIVATE );
00756             }
00757 
00758         }
00759         <span class="keywordflow">if</span> (hdwp) {
00760             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a109">NtUserEndDeferWindowPosEx</a>(hdwp, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00761         }
00762     }
00763 }
00764 
00765 <span class="comment">/***************************************************************************\</span>
00766 <span class="comment">* MDIActivateDlgInit</span>
00767 <span class="comment">*</span>
00768 <span class="comment">* The minimum allowed size and the previous one are saved as properties</span>
00769 <span class="comment">* of the parent window.</span>
00770 <span class="comment">*</span>
00771 <span class="comment">* History:</span>
00772 <span class="comment">* Oct 97 MCostea Created</span>
00773 <span class="comment">\***************************************************************************/</span>
00774 
<a name="l00775"></a><a class="code" href="../../d5/d5/mdimenu_8c.html#a11">00775</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d5/mdimenu_8c.html#a11">MDIActivateDlgInit</a>(HWND hwnd, LPARAM lParam)
00776 {
00777     <a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">PMDIACTIVATEPOS</a> pPos;
00778     HWND  hwndParent;
00779     RECT  rc;
00780 
00781     <a class="code" href="../../d5/d5/mdimenu_8c.html#a9">xxxInitActivateDlg</a>(hwnd, (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)lParam);
00782 
00783     hwndParent = <a class="code" href="../../d3/d9/client_2wow_8c.html#a13">GetParent</a>(hwnd);
00784     <span class="comment">/*</span>
00785 <span class="comment">     * Preserve the previous size of the dialog, if any</span>
00786 <span class="comment">     */</span>
00787     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a> == 0) {
00788 
00789         <a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a> = AddAtomW(<a class="code" href="../../d6/d0/usercli_8h.html#a279">MDIACTIVATE_PROP_NAME</a>);
00790         UserAssert(<a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a>);
00791     }
00792 
00793     <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(hwnd, &amp;rc);
00794 
00795     pPos = (<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">PMDIACTIVATEPOS</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a27">GetProp</a>(hwndParent, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a>));
00796     <span class="comment">/*</span>
00797 <span class="comment">     * If the dialog was used before, retrieve it's size</span>
00798 <span class="comment">     */</span>
00799     <span class="keywordflow">if</span> (pPos != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00800 
00801         <span class="keywordtype">int</span> cxBorder, cyBorder, cx, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00802 
00803         <span class="comment">/*</span>
00804 <span class="comment">         * The stored size and the ones in WM_SIZE are client window coordinates</span>
00805 <span class="comment">         * Need to adjust them for NtUserSetWindowPos and WM_INITDIALOG</span>
00806 <span class="comment">         */</span>
00807         cxBorder = rc.right - rc.left;
00808         cyBorder = rc.bottom - rc.top;
00809         <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hwnd, &amp;rc);
00810         cxBorder -= rc.right - rc.left;
00811         cyBorder -= rc.bottom - rc.top;
00812 
00813         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a115">NtUserSetWindowPos</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0, 0,
00814                            pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o0">cx</a> + cxBorder,
00815                            pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o1">cy</a> + cyBorder,
00816                            SWP_NOMOVE | SWP_NOZORDER | SWP_NOOWNERZORDER
00817                            | SWP_NOSENDCHANGING | SWP_NOREDRAW);
00818         cx = pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o0">cx</a>;
00819         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o1">cy</a>;
00820         pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o0">cx</a> = pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o2">cxMin</a> - cxBorder;
00821         pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o1">cy</a> = pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o3">cyMin</a> - cyBorder;
00822         <a class="code" href="../../d5/d5/mdimenu_8c.html#a10">MDIActivateDlgSize</a>(hwnd, cx, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00823 
00824     } <span class="keywordflow">else</span> {
00825         <span class="comment">/*</span>
00826 <span class="comment">         *</span>
00827 <span class="comment">         */</span>
00828         pPos = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">MDIACTIVATEPOS</a>));
00829         <span class="keywordflow">if</span> (pPos == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00830             <span class="keywordflow">return</span>;
00831         }
00832         pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o2">cxMin</a> = rc.right - rc.left;
00833         pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o3">cyMin</a> = rc.bottom - rc.top;
00834 
00835         <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(hwnd, &amp;rc);
00836         pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o0">cx</a> = rc.right - rc.left;
00837         pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o1">cy</a> = rc.bottom - rc.top;
00838         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a29">SetProp</a>(hwndParent, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a>), (HANDLE)pPos);
00839     }
00840 }
00841 
00842 <span class="comment">/***************************************************************************\</span>
00843 <span class="comment">* MDIActivateDlgProc</span>
00844 <span class="comment">*</span>
00845 <span class="comment">* History:</span>
00846 <span class="comment">* 11-14-90 MikeHar Ported from windows</span>
00847 <span class="comment">\***************************************************************************/</span>
00848 
<a name="l00849"></a><a class="code" href="../../d5/d5/mdimenu_8c.html#a12">00849</a> INT_PTR <a class="code" href="../../d5/d5/mdimenu_8c.html#a12">MDIActivateDlgProcWorker</a>(
00850     HWND hwnd,
00851     UINT wMsg,
00852     WPARAM wParam,
00853     LPARAM lParam)
00854 {
00855     <span class="keywordtype">int</span> i;
00856 
00857     <span class="keywordflow">switch</span> (wMsg) {
00858 
00859     <span class="keywordflow">case</span> WM_INITDIALOG:
00860         <span class="comment">/*</span>
00861 <span class="comment">         * NOTE: Code above uses DialogBoxParam, passing pwndMDI in the low</span>
00862 <span class="comment">         * word of the parameter...</span>
00863 <span class="comment">         */</span>
00864         <a class="code" href="../../d5/d5/mdimenu_8c.html#a11">MDIActivateDlgInit</a>(hwnd, lParam);
00865         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00866 
00867     <span class="keywordflow">case</span> WM_COMMAND:
00868         i = -2;
00869 
00870         <span class="keywordflow">switch</span> (LOWORD(wParam)) {
00871 
00872         <span class="comment">/*</span>
00873 <span class="comment">         * Listbox doubleclicks act like OK...</span>
00874 <span class="comment">         */</span>
00875         <span class="keywordflow">case</span> 100:
00876             <span class="keywordflow">if</span> (HIWORD(wParam) != LBN_DBLCLK)
00877                 <span class="keywordflow">break</span>;
00878 
00879         <span class="comment">/*</span>
00880 <span class="comment">         ** FALL THRU **</span>
00881 <span class="comment">         */</span>
00882         <span class="keywordflow">case</span> IDOK:
00883             i = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a18">SendDlgItemMessage</a>(hwnd, 100, LB_GETCURSEL, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00884 
00885         <span class="comment">/*</span>
00886 <span class="comment">         ** FALL THRU **</span>
00887 <span class="comment">         */</span>
00888         <span class="keywordflow">case</span> IDCANCEL:
00889             <a class="code" href="../../d2/d9/dlgend_8c.html#a0">EndDialog</a>(hwnd, i);
00890             <span class="keywordflow">break</span>;
00891         <span class="keywordflow">default</span>:
00892             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00893         }
00894         <span class="keywordflow">break</span>;
00895 
00896     <span class="keywordflow">case</span> WM_SIZE:
00897         <a class="code" href="../../d5/d5/mdimenu_8c.html#a10">MDIActivateDlgSize</a>(hwnd, LOWORD(lParam), HIWORD(lParam));
00898         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00899 
00900     <span class="keywordflow">case</span> WM_GETMINMAXINFO:
00901         {
00902             <a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">PMDIACTIVATEPOS</a> pPos;
00903 
00904             <span class="keywordflow">if</span> (pPos = (<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html">PMDIACTIVATEPOS</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a27">GetProp</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a13">GetParent</a>(hwnd), <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a21">atomMDIActivateProp</a>))) {
00905                  ((LPMINMAXINFO)lParam)-&gt;ptMinTrackSize.x = pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o2">cxMin</a>;
00906                  ((LPMINMAXINFO)lParam)-&gt;ptMinTrackSize.y = pPos-&gt;<a class="code" href="../../d9/d0/structtagMDIACTIVATEPOS.html#o3">cyMin</a>;
00907             }
00908             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00909         }
00910 
00911     <span class="keywordflow">default</span>:
00912         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00913     }
00914     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00915 }
00916 
<a name="l00917"></a><a class="code" href="../../d6/d0/usercli_8h.html#a594">00917</a> INT_PTR WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a594">MDIActivateDlgProcA</a>(
00918     HWND hwnd,
00919     UINT message,
00920     WPARAM wParam,
00921     LPARAM lParam)
00922 {
00923     <span class="keywordflow">return</span> <a class="code" href="../../d5/d5/mdimenu_8c.html#a12">MDIActivateDlgProcWorker</a>(hwnd, message, wParam, lParam);
00924 }
00925 
<a name="l00926"></a><a class="code" href="../../d6/d0/usercli_8h.html#a595">00926</a> INT_PTR WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a595">MDIActivateDlgProcW</a>(
00927     HWND hwnd,
00928     UINT message,
00929     WPARAM wParam,
00930     LPARAM lParam)
00931 {
00932     <span class="keywordflow">return</span> <a class="code" href="../../d5/d5/mdimenu_8c.html#a12">MDIActivateDlgProcWorker</a>(hwnd, message, wParam, lParam);
00933 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:42 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
