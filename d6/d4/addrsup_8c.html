<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: addrsup.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>addrsup.c File Reference</h1><code>#include "<a class="el" href="../../d5/d7/mi_8h-source.html">mi.h</a>"</code><br>

<p>
<a href="../../d7/d3/addrsup_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a0">MiReorderTree</a> (IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node, IN OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *Root)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a1">MiGetNextNode</a> (IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a2">MiGetPreviousNode</a> (IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a3">MiGetFirstNode</a> (IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Root)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a4">MiInsertNode</a> (IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node, IN OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *Root)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a5">MiRemoveNode</a> (IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node, IN OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *Root)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a6">MiLocateAddressInTree</a> (IN ULONG_PTR Vpn, IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *Root)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a7">MiCheckForConflictingNode</a> (IN ULONG_PTR StartVpn, IN ULONG_PTR EndVpn, IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Root)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a8">MiFindEmptyAddressRangeInTree</a> (IN SIZE_T SizeOfRange, IN ULONG_PTR Alignment, IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Root, OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *PreviousVad)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/addrsup_8c.html#a9">MiFindEmptyAddressRangeDownTree</a> (IN SIZE_T SizeOfRange, IN PVOID HighestAddressToEndAt, IN ULONG_PTR Alignment, IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Root)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a7" doxytag="addrsup.c::MiCheckForConflictingNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> MiCheckForConflictingNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>StartVpn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>EndVpn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01068">1068</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02280">_MMADDRESS_NODE::EndingVpn</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02279">_MMADDRESS_NODE::StartingVpn</a>.
<p>
<pre class="fragment"><div>01076                    :
01077 
01078     The function determines <span class="keywordflow">if</span> any addresses between a given starting and
01079     ending address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> contained within a <span class="keyword">virtual</span> address descriptor.
01080 
01081 Arguments:
01082 
01083     StartVpn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to locate a containing
01084                       descriptor.
01085 
01086     EndVpn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address to locate a containing
01087                       descriptor.
01088 
01089 Return Value:
01090 
01091     Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first conflicting <span class="keyword">virtual</span> address descriptor
01092     <span class="keywordflow">if</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found, otherwise a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01093 
01094 --*/
01095 
01096 {
01097     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node;
01098 
01099     Node = Root;
01100 
01101     <span class="keywordflow">for</span> (;;) {
01102 
01103         <span class="keywordflow">if</span> (Node == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01104             <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01105         }
01106 
01107         <span class="keywordflow">if</span> (StartVpn &gt; Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>) {
01108             Node = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
01109 
01110         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (EndVpn &lt; Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>) {
01111             Node = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
01112 
01113         } <span class="keywordflow">else</span> {
01114 
01115             <span class="comment">//</span>
01116             <span class="comment">// The starting address is less than or equal to the end VA</span>
01117             <span class="comment">// and the ending address is greater than or equal to the</span>
01118             <span class="comment">// start va.  Return this node.</span>
01119             <span class="comment">//</span>
01120 
01121             <span class="keywordflow">return</span> Node;
01122         }
01123     }
01124 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="addrsup.c::MiFindEmptyAddressRangeDownTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID MiFindEmptyAddressRangeDownTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>SizeOfRange</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HighestAddressToEndAt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Alignment</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01252">1252</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02280">_MMADDRESS_NODE::EndingVpn</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00389">MI_ALIGN_TO_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00334">MI_ROUND_TO_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00761">MI_VA_TO_VPN</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00763">MI_VPN_TO_VA</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00765">MI_VPN_TO_VA_ENDING</a>, <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00362">MiGetPreviousNode()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00096">MM_HIGHEST_VAD_ADDRESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02279">_MMADDRESS_NODE::StartingVpn</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00154">MiFindEmptySectionBaseDown()</a>.
<p>
<pre class="fragment"><div>01261                    :
01262 
01263     The function examines <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptors to locate
01264     an unused range of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified size and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting
01265     address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range.  The function examines from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a>
01266     addresses down and ensures that starting address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> less than
01267     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address.
01268 
01269 Arguments:
01270 
01271     SizeOfRange - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range to locate.
01272 
01273     HighestAddressToEndAt - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address that limits
01274                             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ending address.  The ending
01275                             address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> located range must be less
01276                             than <span class="keyword">this</span> address.
01277 
01278     Alignment - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alignment <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address.  Must be
01279                  a power of 2 and greater than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page_size.
01280 
01281     Root - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree to search through.
01282 
01283 Return Value:
01284 
01285     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting address of a suitable range.
01286 
01287 --*/
01288 
01289 {
01290     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node;
01291     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> PreviousNode;
01292     ULONG_PTR AlignedEndingVa;
01293     PVOID OptimalStart;
01294     ULONG_PTR OptimalStartVpn;
01295     ULONG_PTR HighestVpn;
01296     ULONG_PTR AlignmentVpn;
01297 
01298     SizeOfRange = <a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a> (SizeOfRange, PAGE_SIZE);
01299 
01300     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (HighestAddressToEndAt != NULL);
01301     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (HighestAddressToEndAt &lt;= (PVOID)((ULONG_PTR)MM_HIGHEST_VAD_ADDRESS + 1));
01302 
01303     HighestVpn = <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (HighestAddressToEndAt);
01304 
01305     <span class="comment">//</span>
01306     <span class="comment">// Locate the Node with the highest starting address.</span>
01307     <span class="comment">//</span>
01308 
01309     OptimalStart = (PVOID)(<a class="code" href="../../d4/d8/mi_8h.html#a92">MI_ALIGN_TO_SIZE</a>(
01310                            (((ULONG_PTR)HighestAddressToEndAt + 1) - SizeOfRange),
01311                            Alignment));
01312     Node = Root;
01313 
01314     <span class="keywordflow">if</span> (Node == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01315 
01316         <span class="comment">//</span>
01317         <span class="comment">// The tree is empty, any range is okay.</span>
01318         <span class="comment">//</span>
01319 
01320         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)(OptimalStart);
01321     }
01322 
01323     <span class="comment">//</span>
01324     <span class="comment">// See if an empty slot exists to hold this range, locate the largest</span>
01325     <span class="comment">// element in the tree.</span>
01326     <span class="comment">//</span>
01327 
01328     <span class="keywordflow">while</span> (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01329         Node = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
01330     }
01331 
01332     <span class="comment">//</span>
01333     <span class="comment">// Check to see if a range exists between the highest address VAD</span>
01334     <span class="comment">// and the highest address to end at.</span>
01335     <span class="comment">//</span>
01336 
01337     AlignedEndingVa = (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a> ((ULONG_PTR)MI_VPN_TO_VA_ENDING (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>),
01338                                                Alignment);
01339 
01340     <span class="keywordflow">if</span> (AlignedEndingVa &lt; (ULONG_PTR)HighestAddressToEndAt) {
01341 
01342         <span class="keywordflow">if</span> ( SizeOfRange &lt; ((ULONG_PTR)HighestAddressToEndAt - AlignedEndingVa)) {
01343 
01344             <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)(<a class="code" href="../../d4/d8/mi_8h.html#a92">MI_ALIGN_TO_SIZE</a>(
01345                                   ((ULONG_PTR)HighestAddressToEndAt - SizeOfRange),
01346                                   Alignment));
01347         }
01348     }
01349 
01350     <span class="comment">//</span>
01351     <span class="comment">// Walk the tree backwards looking for a fit.</span>
01352     <span class="comment">//</span>
01353 
01354     OptimalStartVpn = <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (OptimalStart);
01355     AlignmentVpn = <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (Alignment);
01356 
01357     <span class="keywordflow">for</span> (;;) {
01358 
01359         PreviousNode = <a class="code" href="../../d4/d8/mi_8h.html#a839">MiGetPreviousNode</a> (Node);
01360 
01361         <span class="keywordflow">if</span> (PreviousNode != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01362 
01363             <span class="comment">//</span>
01364             <span class="comment">// Is the ending Va below the top of the address to end at.</span>
01365             <span class="comment">//</span>
01366 
01367             <span class="keywordflow">if</span> (PreviousNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a> &lt; OptimalStartVpn) {
01368                 <span class="keywordflow">if</span> ((SizeOfRange &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>) &lt;=
01369                     ((ULONG_PTR)Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> -
01370                     (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(1 + PreviousNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>,
01371                                             AlignmentVpn))) {
01372 
01373                     <span class="comment">//</span>
01374                     <span class="comment">// See if the optimal start will fit between these</span>
01375                     <span class="comment">// two VADs.</span>
01376                     <span class="comment">//</span>
01377 
01378                     <span class="keywordflow">if</span> ((OptimalStartVpn &gt; PreviousNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>) &amp;&amp;
01379                         (HighestVpn &lt; Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>)) {
01380                         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)(OptimalStart);
01381                     }
01382 
01383                     <span class="comment">//</span>
01384                     <span class="comment">// Check to ensure that the ending address aligned upwards</span>
01385                     <span class="comment">// is not greater than the starting address.</span>
01386                     <span class="comment">//</span>
01387 
01388                     <span class="keywordflow">if</span> ((ULONG_PTR)Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> &gt;
01389                             (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(1 + PreviousNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>,
01390                                                     AlignmentVpn)) {
01391 
01392                         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d8/mi_8h.html#a92">MI_ALIGN_TO_SIZE</a>(
01393                                             (ULONG_PTR)MI_VPN_TO_VA (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>) - SizeOfRange,
01394                                             Alignment);
01395                     }
01396                 }
01397             }
01398         } <span class="keywordflow">else</span> {
01399 
01400             <span class="comment">//</span>
01401             <span class="comment">// No more descriptors, check to see if this fits into the remainder</span>
01402             <span class="comment">// of the address space.</span>
01403             <span class="comment">//</span>
01404 
01405             <span class="keywordflow">if</span> (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> &gt; <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (MM_LOWEST_USER_ADDRESS)) {
01406                 <span class="keywordflow">if</span> ((SizeOfRange &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>) &lt;=
01407                     ((ULONG_PTR)Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> - <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (MM_LOWEST_USER_ADDRESS))) {
01408 
01409                     <span class="comment">//</span>
01410                     <span class="comment">// See if the optimal start will fit between these</span>
01411                     <span class="comment">// two VADs.</span>
01412                     <span class="comment">//</span>
01413 
01414                     <span class="keywordflow">if</span> (HighestVpn &lt; Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>) {
01415                         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)(OptimalStart);
01416                     }
01417 
01418                     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d8/mi_8h.html#a92">MI_ALIGN_TO_SIZE</a>(
01419                                   (ULONG_PTR)MI_VPN_TO_VA (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>) - SizeOfRange,
01420                                   Alignment);
01421                 }
01422             } <span class="keywordflow">else</span> {
01423                 <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_NO_MEMORY);
01424             }
01425         }
01426         Node = PreviousNode;
01427     }
01428 }
<span class="preprocessor">#if DBG</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="addrsup.c::MiFindEmptyAddressRangeInTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID MiFindEmptyAddressRangeInTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>SizeOfRange</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Alignment</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousVad</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01127">1127</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02280">_MMADDRESS_NODE::EndingVpn</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00334">MI_ROUND_TO_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00761">MI_VA_TO_VPN</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00763">MI_VPN_TO_VA</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00765">MI_VPN_TO_VA_ENDING</a>, <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00297">MiGetNextNode()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00096">MM_HIGHEST_VAD_ADDRESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02279">_MMADDRESS_NODE::StartingVpn</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l00094">X64K</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00431">MiFindEmptyAddressRange()</a>.
<p>
<pre class="fragment"><div>01136                    :
01137 
01138     The function examines <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptors to locate
01139     an unused range of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified size and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting
01140     address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range.
01141 
01142 Arguments:
01143 
01144     SizeOfRange - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range to locate.
01145 
01146     Alignment - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alignment <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address.  Must be
01147                  a power of 2 and greater than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page_size.
01148 
01149     Root - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree to search through.
01150 
01151     PreviousVad - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vad which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> before <span class="keyword">this</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> found
01152                   address range.
01153 
01154 Return Value:
01155 
01156     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting address of a suitable range.
01157 
01158 --*/
01159 
01160 {
01161     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Node;
01162     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> NextNode;
01163     ULONG_PTR AlignmentVpn;
01164 
01165     AlignmentVpn = Alignment &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>;
01166 
01167     <span class="comment">//</span>
01168     <span class="comment">// Locate the Node with the lowest starting address.</span>
01169     <span class="comment">//</span>
01170 
01171     SizeOfRange = (SizeOfRange + (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)) &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>;
01172     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (SizeOfRange != 0);
01173 
01174     Node = Root;
01175 
01176     <span class="keywordflow">if</span> (Node == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01177         <span class="keywordflow">return</span> MM_LOWEST_USER_ADDRESS;
01178     }
01179     <span class="keywordflow">while</span> (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01180         Node = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
01181     }
01182 
01183     <span class="comment">//</span>
01184     <span class="comment">// Check to see if a range exists between the lowest address VAD</span>
01185     <span class="comment">// and lowest user address.</span>
01186     <span class="comment">//</span>
01187 
01188     <span class="keywordflow">if</span> (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> &gt; <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (MM_LOWEST_USER_ADDRESS)) {
01189         <span class="keywordflow">if</span> ( SizeOfRange &lt;
01190             (Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> - <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (MM_LOWEST_USER_ADDRESS))) {
01191 
01192             *PreviousVad = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01193             <span class="keywordflow">return</span> MM_LOWEST_USER_ADDRESS;
01194         }
01195     }
01196 
01197     <span class="keywordflow">for</span> (;;) {
01198 
01199         NextNode = <a class="code" href="../../d4/d8/mi_8h.html#a838">MiGetNextNode</a> (Node);
01200 
01201         <span class="keywordflow">if</span> (NextNode != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01202 
01203             <span class="keywordflow">if</span> (SizeOfRange &lt;=
01204                 ((ULONG_PTR)NextNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> -
01205                                 <a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(1 + Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>,
01206                                                  AlignmentVpn))) {
01207 
01208                 <span class="comment">//</span>
01209                 <span class="comment">// Check to ensure that the ending address aligned upwards</span>
01210                 <span class="comment">// is not greater than the starting address.</span>
01211                 <span class="comment">//</span>
01212 
01213                 <span class="keywordflow">if</span> ((ULONG_PTR)NextNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a> &gt;
01214                         <a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(1 + Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>,
01215                                          AlignmentVpn)) {
01216 
01217                     *PreviousVad = Node;
01218                     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(
01219                                    (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a109">MI_VPN_TO_VA_ENDING</a>(Node-&gt;EndingVpn),
01220                                           Alignment);
01221                 }
01222             }
01223 
01224         } <span class="keywordflow">else</span> {
01225 
01226             <span class="comment">//</span>
01227             <span class="comment">// No more descriptors, check to see if this fits into the remainder</span>
01228             <span class="comment">// of the address space.</span>
01229             <span class="comment">//</span>
01230 
01231             <span class="keywordflow">if</span> ((((ULONG_PTR)Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a> + <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a>(X64K)) &lt;
01232                     <a class="code" href="../../d4/d8/mi_8h.html#a107">MI_VA_TO_VPN</a> (MM_HIGHEST_VAD_ADDRESS))
01233                         &amp;&amp;
01234                 (SizeOfRange &lt;=
01235                     ((ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a19">MM_HIGHEST_VAD_ADDRESS</a> -
01236                          (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(
01237                          (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a108">MI_VPN_TO_VA</a>(Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>), Alignment)))) {
01238 
01239                 *PreviousVad = Node;
01240                 <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d8/mi_8h.html#a90">MI_ROUND_TO_SIZE</a>(
01241                                     (ULONG_PTR)<a class="code" href="../../d4/d8/mi_8h.html#a109">MI_VPN_TO_VA_ENDING</a>(Node-&gt;EndingVpn),
01242                                     Alignment);
01243             } <span class="keywordflow">else</span> {
01244                 <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a> (STATUS_NO_MEMORY);
01245             }
01246         }
01247         Node = NextNode;
01248     }
01249 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="addrsup.c::MiGetFirstNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL MiGetFirstNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Root</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00424">424</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00430                    :
00431 
00432     This function locates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor which contains
00433     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address range which logically <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> first within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address space.
00434 
00435 Arguments:
00436 
00437     None.
00438 
00439 Return Value:
00440 
00441     Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00442     first address range, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> none.
00443 
00444 --*/
00445 
00446 {
00447     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> First;
00448 
00449     First = Root;
00450 
00451     <span class="keywordflow">if</span> (First == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00452         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00453     }
00454 
00455     <span class="keywordflow">while</span> (First-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00456         First = First-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00457     }
00458 
00459     <span class="keywordflow">return</span> First;
00460 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="addrsup.c::MiGetNextNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL MiGetNextNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Node</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00297">297</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02281">_MMADDRESS_NODE::Parent</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>.
<p>
Referenced by <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01127">MiFindEmptyAddressRangeInTree()</a>.
<p>
<pre class="fragment"><div>00303                    :
00304 
00305     This function locates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor which contains
00306     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address range which logically follows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address range.
00307 
00308 Arguments:
00309 
00310     Node - Supplies a pointer to a <span class="keyword">virtual</span> address descriptor.
00311 
00312 Return Value:
00313 
00314     Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00315     next address range, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> none.
00316 
00317 --*/
00318 
00319 {
00320     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Next;
00321     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Parent;
00322     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Left;
00323 
00324     Next = Node;
00325 
00326     <span class="keywordflow">if</span> (Next-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00327 
00328         <span class="keywordflow">while</span> ((Parent = Next-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>) != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00329 
00330             <span class="comment">//</span>
00331             <span class="comment">// Locate the first ancestor of this node of which this</span>
00332             <span class="comment">// node is the left child of and return that node as the</span>
00333             <span class="comment">// next element.</span>
00334             <span class="comment">//</span>
00335 
00336             <span class="keywordflow">if</span> (Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> == Next) {
00337                 <span class="keywordflow">return</span> Parent;
00338             }
00339 
00340             Next = Parent;
00341 
00342         }
00343 
00344         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00345     }
00346 
00347     <span class="comment">//</span>
00348     <span class="comment">// A right child exists, locate the left most child of that right child.</span>
00349     <span class="comment">//</span>
00350 
00351     Next = Next-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00352 
00353     <span class="keywordflow">while</span> ((Left = Next-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00354         Next = Left;
00355     }
00356     <span class="keywordflow">return</span> Next;
00357 
00358 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="addrsup.c::MiGetPreviousNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL MiGetPreviousNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Node</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00362">362</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02281">_MMADDRESS_NODE::Parent</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>.
<p>
Referenced by <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01252">MiFindEmptyAddressRangeDownTree()</a>.
<p>
<pre class="fragment"><div>00368                    :
00369 
00370     This function locates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor which contains
00371     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address range which logically precedes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <span class="keyword">virtual</span>
00372     address descriptor.
00373 
00374 Arguments:
00375 
00376     Node - Supplies a pointer to a <span class="keyword">virtual</span> address descriptor.
00377 
00378 Return Value:
00379 
00380     Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00381     next address range, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> none.
00382 
00383 --*/
00384 
00385 {
00386     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Previous;
00387 
00388     Previous = Node;
00389 
00390     <span class="keywordflow">if</span> (Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00391 
00392 
00393         <span class="keywordflow">while</span> (Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00394 
00395             <span class="comment">//</span>
00396             <span class="comment">// Locate the first ancestor of this node of which this</span>
00397             <span class="comment">// node is the right child of and return that node as the</span>
00398             <span class="comment">// Previous element.</span>
00399             <span class="comment">//</span>
00400 
00401             <span class="keywordflow">if</span> (Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> == Previous) {
00402                 <span class="keywordflow">return</span> Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00403             }
00404 
00405             Previous = Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00406 
00407         }
00408         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00409     }
00410 
00411     <span class="comment">//</span>
00412     <span class="comment">// A left child exists, locate the right most child of that left child.</span>
00413     <span class="comment">//</span>
00414 
00415     Previous = Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00416     <span class="keywordflow">while</span> (Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> != (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00417         Previous = Previous-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00418     }
00419     <span class="keywordflow">return</span> Previous;
00420 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="addrsup.c::MiInsertNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL MiInsertNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00464">464</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00045">MiReorderTree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02281">_MMADDRESS_NODE::Parent</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02279">_MMADDRESS_NODE::StartingVpn</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00079">MiInsertBasedSection()</a>, and <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>.
<p>
<pre class="fragment"><div>00471                    :
00472 
00473     This function inserts a <span class="keyword">virtual</span> address descriptor into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree and
00474     reorders <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> splay tree as appropriate.
00475 
00476 Arguments:
00477 
00478     Node - Supplies a pointer to a <span class="keyword">virtual</span> address descriptor
00479 
00480 
00481 Return Value:
00482 
00483     None.
00484 
00485 --*/
00486 
00487 {
00488     ULONG Level = 0;
00489     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Parent;
00490 
00491     <span class="comment">//</span>
00492     <span class="comment">// Initialize virtual address descriptor child links.</span>
00493     <span class="comment">//</span>
00494 
00495     Node-&gt;LeftChild = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00496     Node-&gt;RightChild = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00497 
00498     <span class="comment">//</span>
00499     <span class="comment">// If the tree is empty, then establish this virtual address descriptor</span>
00500     <span class="comment">// as the root of the tree.</span>
00501     <span class="comment">// Otherwise descend the tree to find the correct place to</span>
00502     <span class="comment">// insert the descriptor.</span>
00503     <span class="comment">//</span>
00504 
00505     Parent = *Root;
00506     <span class="keywordflow">if</span> (!Parent) {
00507         *Root = Node;
00508         Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00509     } <span class="keywordflow">else</span> {
00510 
00511         <span class="keywordflow">for</span> (;;) {
00512 
00513             Level += 1;
00514             <span class="keywordflow">if</span> (Level == 15) {
00515                 <a class="code" href="../../d6/d4/addrsup_8c.html#a0">MiReorderTree</a>(Parent, Root);
00516             }
00517 
00518             <span class="comment">//</span>
00519             <span class="comment">// If the starting address for this virtual address descriptor</span>
00520             <span class="comment">// is less than the parent starting address, then</span>
00521             <span class="comment">// follow the left child link. Else follow the right child link.</span>
00522             <span class="comment">//</span>
00523 
00524             <span class="keywordflow">if</span> (Node-&gt;StartingVpn &lt; Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>) {
00525 
00526                 <span class="comment">//</span>
00527                 <span class="comment">// Starting address of the virtual address descriptor is less</span>
00528                 <span class="comment">// than the parent starting virtual address.</span>
00529                 <span class="comment">// Follow left child link if not null. Otherwise</span>
00530                 <span class="comment">// insert the descriptor as the left child of the parent and</span>
00531                 <span class="comment">// reorder the tree.</span>
00532                 <span class="comment">//</span>
00533 
00534                 <span class="keywordflow">if</span> (Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00535                     Parent = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00536                 } <span class="keywordflow">else</span> {
00537                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = Node;
00538                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00539                     <span class="comment">// MiReorderTree(Node, Root);</span>
00540                     <span class="keywordflow">break</span>;
00541                 }
00542             } <span class="keywordflow">else</span> {
00543 
00544                 <span class="comment">//</span>
00545                 <span class="comment">// Starting address of the virtual address descriptor is greater</span>
00546                 <span class="comment">// than the parent starting virtual address.</span>
00547                 <span class="comment">// Follow right child link if not null. Otherwise</span>
00548                 <span class="comment">// insert the descriptor as the right child of the parent and</span>
00549                 <span class="comment">// reorder the tree.</span>
00550                 <span class="comment">//</span>
00551 
00552                 <span class="keywordflow">if</span> (Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00553                     Parent = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00554                 } <span class="keywordflow">else</span> {
00555                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = Node;
00556                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00557                     <span class="comment">// MiReorderTree(Node, Root);</span>
00558                     <span class="keywordflow">break</span>;
00559                 }
00560             }
00561         }
00562     }
00563     <span class="keywordflow">return</span>;
00564 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="addrsup.c::MiLocateAddressInTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> FASTCALL MiLocateAddressInTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Vpn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01001">1001</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02280">_MMADDRESS_NODE::EndingVpn</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00045">MiReorderTree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02279">_MMADDRESS_NODE::StartingVpn</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00380">MiLocateAddress()</a>.
<p>
<pre class="fragment"><div>01008                    :
01009 
01010     The function locates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor which describes
01011     a given address.
01012 
01013 Arguments:
01014 
01015     Vpn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> page number to locate a descriptor
01016                      <span class="keywordflow">for</span>.
01017 
01018 Return Value:
01019 
01020     Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">virtual</span> address descriptor which contains
01021     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied <span class="keyword">virtual</span> address or <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> none was located.
01022 
01023 --*/
01024 
01025 {
01026 
01027     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Parent;
01028     ULONG Level = 0;
01029 
01030     Parent = *Root;
01031 
01032     <span class="keywordflow">for</span> (;;) {
01033 
01034         <span class="keywordflow">if</span> (Parent == (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01035             <span class="keywordflow">return</span> (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01036         }
01037 
01038         <span class="keywordflow">if</span> (Level == 20) {
01039 
01040             <span class="comment">//</span>
01041             <span class="comment">// There are 20 nodes above this point, reorder the</span>
01042             <span class="comment">// tree with this node as the root.</span>
01043             <span class="comment">//</span>
01044 
01045             <a class="code" href="../../d6/d4/addrsup_8c.html#a0">MiReorderTree</a>(Parent, Root);
01046         }
01047 
01048         <span class="keywordflow">if</span> (Vpn &lt; Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o0">StartingVpn</a>) {
01049             Parent = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
01050             Level += 1;
01051 
01052         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Vpn &gt; Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o1">EndingVpn</a>) {
01053             Parent = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
01054             Level += 1;
01055 
01056         } <span class="keywordflow">else</span> {
01057 
01058             <span class="comment">//</span>
01059             <span class="comment">// The address is within the start and end range.</span>
01060             <span class="comment">//</span>
01061 
01062             <span class="keywordflow">return</span> Parent;
01063         }
01064     }
01065 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="addrsup.c::MiRemoveNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL MiRemoveNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00568">568</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02281">_MMADDRESS_NODE::Parent</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00118">MiRemoveBasedSection()</a>, and <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>.
<p>
<pre class="fragment"><div>00575                    :
00576 
00577     This function removes a <span class="keyword">virtual</span> address descriptor from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree and
00578     reorders <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> splay tree as appropriate.
00579 
00580 Arguments:
00581 
00582     Node - Supplies a pointer to a <span class="keyword">virtual</span> address descriptor.
00583 
00584 Return Value:
00585 
00586     None.
00587 
00588 --*/
00589 
00590 {
00591 
00592     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> LeftChild;
00593     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> RightChild;
00594     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> SplayNode;
00595 
00596 
00597     LeftChild = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00598     RightChild = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00599 
00600 
00601     <span class="comment">//</span>
00602     <span class="comment">// If the Node is the root of the tree, then establish new root. Else</span>
00603     <span class="comment">// isolate splay case and perform splay tree transformation.</span>
00604     <span class="comment">//</span>
00605 
00606     <span class="keywordflow">if</span> (Node == *Root) {
00607 
00608         <span class="comment">//</span>
00609         <span class="comment">// This Node is the root of the tree. There are four cases to</span>
00610         <span class="comment">// handle:</span>
00611         <span class="comment">//</span>
00612         <span class="comment">//  1. the descriptor has no children</span>
00613         <span class="comment">//  2. the descriptor has a left child but no right child</span>
00614         <span class="comment">//  3. the descriptor has a right child but no left child</span>
00615         <span class="comment">//  4. the descriptor has both a right child and a left child</span>
00616         <span class="comment">//</span>
00617 
00618         <span class="keywordflow">if</span> (LeftChild) {
00619             <span class="keywordflow">if</span> (RightChild) {
00620 
00621                 <span class="comment">//</span>
00622                 <span class="comment">// The descriptor has both a left child and a right child.</span>
00623                 <span class="comment">//</span>
00624 
00625                 <span class="keywordflow">if</span> (LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00626 
00627                     <span class="comment">//</span>
00628                     <span class="comment">// The left child has a right child. Make the right most</span>
00629                     <span class="comment">// descendent of the right child of the left child the</span>
00630                     <span class="comment">// new root of the tree.</span>
00631                     <span class="comment">//</span>
00632                     <span class="comment">// Pictorially:</span>
00633                     <span class="comment">//</span>
00634                     <span class="comment">//      R          R</span>
00635                     <span class="comment">//      |          |</span>
00636                     <span class="comment">//      X          Z</span>
00637                     <span class="comment">//     / \        / \</span>
00638                     <span class="comment">//    A   B  -&gt;  A   B</span>
00639                     <span class="comment">//     \          \</span>
00640                     <span class="comment">//      .          .</span>
00641                     <span class="comment">//       \</span>
00642                     <span class="comment">//        Z</span>
00643                     <span class="comment">//</span>
00644 
00645                     SplayNode = LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00646                     <span class="keywordflow">while</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00647                         SplayNode = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00648                     }
00649                     *Root = SplayNode;
00650                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00651                     <span class="keywordflow">if</span> (SplayNode-&gt;LeftChild) {
00652                         SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00653                     }
00654                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00655                     LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00656                     RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00657                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = LeftChild;
00658                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = RightChild;
00659                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00660 
00661                     <span class="comment">//</span>
00662                     <span class="comment">// The right child has a left child. Make the left most</span>
00663                     <span class="comment">// descendent of the left child of the right child the</span>
00664                     <span class="comment">// new root of the tree.</span>
00665                     <span class="comment">//</span>
00666                     <span class="comment">// Pictorially:</span>
00667                     <span class="comment">//</span>
00668                     <span class="comment">//      R          R</span>
00669                     <span class="comment">//      |          |</span>
00670                     <span class="comment">//      X          Z</span>
00671                     <span class="comment">//     / \        / \</span>
00672                     <span class="comment">//    A   B  -&gt;  A   B</span>
00673                     <span class="comment">//       /          /</span>
00674                     <span class="comment">//      .          .</span>
00675                     <span class="comment">//     /</span>
00676                     <span class="comment">//    Z</span>
00677                     <span class="comment">//</span>
00678 
00679                     SplayNode = RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00680                     <span class="keywordflow">while</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00681                         SplayNode = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00682                     }
00683                     *Root = SplayNode;
00684                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00685                     <span class="keywordflow">if</span> (SplayNode-&gt;RightChild) {
00686                         SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00687                     }
00688                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00689                     LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00690                     RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00691                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = LeftChild;
00692                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = RightChild;
00693                 } <span class="keywordflow">else</span> {
00694 
00695                     <span class="comment">//</span>
00696                     <span class="comment">// The left child of the descriptor does not have a right child,</span>
00697                     <span class="comment">// and the right child of the descriptor does not have a left</span>
00698                     <span class="comment">// child. Make the left child of the descriptor the new root of</span>
00699                     <span class="comment">// the tree.</span>
00700                     <span class="comment">//</span>
00701                     <span class="comment">// Pictorially:</span>
00702                     <span class="comment">//</span>
00703                     <span class="comment">//      R          R</span>
00704                     <span class="comment">//      |          |</span>
00705                     <span class="comment">//      X          A</span>
00706                     <span class="comment">//     / \        / \</span>
00707                     <span class="comment">//    A   B  -&gt;  .   B</span>
00708                     <span class="comment">//   /          /</span>
00709                     <span class="comment">//  .</span>
00710                     <span class="comment">//</span>
00711 
00712                     *Root = LeftChild;
00713                     LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00714                     LeftChild-&gt;RightChild = RightChild;
00715                     LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = LeftChild;
00716                 }
00717             } <span class="keywordflow">else</span> {
00718 
00719                 <span class="comment">//</span>
00720                 <span class="comment">// The descriptor has a left child, but does not have a right child.</span>
00721                 <span class="comment">// Make the left child the new root of the tree.</span>
00722                 <span class="comment">//</span>
00723                 <span class="comment">// Pictorially:</span>
00724                 <span class="comment">//</span>
00725                 <span class="comment">//       R      R</span>
00726                 <span class="comment">//       |      |</span>
00727                 <span class="comment">//       X  -&gt;  A</span>
00728                 <span class="comment">//      /</span>
00729                 <span class="comment">//     A</span>
00730                 <span class="comment">//</span>
00731 
00732                 *Root = LeftChild;
00733                 LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00734             }
00735         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RightChild) {
00736 
00737             <span class="comment">//</span>
00738             <span class="comment">// The descriptor has a right child, but does not have a left child.</span>
00739             <span class="comment">// Make the right child the new root of the tree.</span>
00740             <span class="comment">//</span>
00741             <span class="comment">// Pictorially:</span>
00742             <span class="comment">//</span>
00743             <span class="comment">//       R         R</span>
00744             <span class="comment">//       |         |</span>
00745             <span class="comment">//       X    -&gt;   A</span>
00746             <span class="comment">//        \</span>
00747             <span class="comment">//         A</span>
00748             <span class="comment">//</span>
00749 
00750             *Root = RightChild;
00751             RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00752             <span class="keywordflow">while</span> (RightChild-&gt;LeftChild) {
00753                 RightChild = RightChild-&gt;LeftChild;
00754             }
00755         } <span class="keywordflow">else</span> {
00756 
00757             <span class="comment">//</span>
00758             <span class="comment">// The descriptor has neither a left child nor a right child. The</span>
00759             <span class="comment">// tree will be empty after removing the descriptor.</span>
00760             <span class="comment">//</span>
00761             <span class="comment">// Pictorially:</span>
00762             <span class="comment">//</span>
00763             <span class="comment">//      R      R</span>
00764             <span class="comment">//      |  -&gt;</span>
00765             <span class="comment">//      X</span>
00766             <span class="comment">//</span>
00767 
00768             *Root = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00769         }
00770     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LeftChild) {
00771         <span class="keywordflow">if</span> (RightChild) {
00772 
00773             <span class="comment">//</span>
00774             <span class="comment">// The descriptor has both a left child and a right child.</span>
00775             <span class="comment">//</span>
00776 
00777             <span class="keywordflow">if</span> (LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00778 
00779                 <span class="comment">//</span>
00780                 <span class="comment">// The left child has a right child. Make the right most</span>
00781                 <span class="comment">// descendent of the right child of the left child the new</span>
00782                 <span class="comment">// root of the subtree.</span>
00783                 <span class="comment">//</span>
00784                 <span class="comment">// Pictorially:</span>
00785                 <span class="comment">//</span>
00786                 <span class="comment">//        P      P</span>
00787                 <span class="comment">//       /        \</span>
00788                 <span class="comment">//      X          X</span>
00789                 <span class="comment">//     / \        / \</span>
00790                 <span class="comment">//    A   B  or  A   B</span>
00791                 <span class="comment">//     \          \</span>
00792                 <span class="comment">//      .          .</span>
00793                 <span class="comment">//       \          \</span>
00794                 <span class="comment">//        Z          Z</span>
00795                 <span class="comment">//</span>
00796                 <span class="comment">//           |</span>
00797                 <span class="comment">//           v</span>
00798                 <span class="comment">//</span>
00799                 <span class="comment">//        P      P</span>
00800                 <span class="comment">//       /        \</span>
00801                 <span class="comment">//      Z          Z</span>
00802                 <span class="comment">//     / \        / \</span>
00803                 <span class="comment">//    A   B  or  A   B</span>
00804                 <span class="comment">//     \          \</span>
00805                 <span class="comment">//      .          .</span>
00806                 <span class="comment">//</span>
00807 
00808                 SplayNode = LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00809                 <span class="keywordflow">while</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00810                     SplayNode = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00811                 }
00812                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00813                 <span class="keywordflow">if</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00814                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00815                 }
00816                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00817                 <span class="keywordflow">if</span> (Node == Node-&gt;Parent-&gt;LeftChild) {
00818                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode;
00819                 } <span class="keywordflow">else</span> {
00820                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode;
00821                 }
00822                 LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00823                 RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00824                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = LeftChild;
00825                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = RightChild;
00826             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00827 
00828                 <span class="comment">//</span>
00829                 <span class="comment">// The right child has a left child. Make the left most</span>
00830                 <span class="comment">// descendent of the left child of the right child the</span>
00831                 <span class="comment">// new root of the subtree.</span>
00832                 <span class="comment">//</span>
00833                 <span class="comment">// Pictorially:</span>
00834                 <span class="comment">//</span>
00835                 <span class="comment">//        P      P</span>
00836                 <span class="comment">//       /        \</span>
00837                 <span class="comment">//      X          X</span>
00838                 <span class="comment">//     / \        / \</span>
00839                 <span class="comment">//    A   B  or  A   B</span>
00840                 <span class="comment">//       /          /</span>
00841                 <span class="comment">//      .          .</span>
00842                 <span class="comment">//     /          /</span>
00843                 <span class="comment">//    Z          Z</span>
00844                 <span class="comment">//</span>
00845                 <span class="comment">//           |</span>
00846                 <span class="comment">//           v</span>
00847                 <span class="comment">//</span>
00848                 <span class="comment">//        P      P</span>
00849                 <span class="comment">//       /        \</span>
00850                 <span class="comment">//      Z          Z</span>
00851                 <span class="comment">//     / \        / \</span>
00852                 <span class="comment">//    A   B  or  A   B</span>
00853                 <span class="comment">//       /          /</span>
00854                 <span class="comment">//      .          .</span>
00855                 <span class="comment">//</span>
00856 
00857                 SplayNode = RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00858                 <span class="keywordflow">while</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00859                     SplayNode = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00860                 }
00861                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00862                 <span class="keywordflow">if</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00863                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00864                 }
00865                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00866                 <span class="keywordflow">if</span> (Node == Node-&gt;Parent-&gt;LeftChild) {
00867                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode;
00868                 } <span class="keywordflow">else</span> {
00869                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode;
00870                 }
00871                 LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00872                 RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00873                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = LeftChild;
00874                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = RightChild;
00875             } <span class="keywordflow">else</span> {
00876 
00877                 <span class="comment">//</span>
00878                 <span class="comment">// The left child of the descriptor does not have a right child,</span>
00879                 <span class="comment">// and the right child of the descriptor does node have a left</span>
00880                 <span class="comment">// child. Make the left child of the descriptor the new root of</span>
00881                 <span class="comment">// the subtree.</span>
00882                 <span class="comment">//</span>
00883                 <span class="comment">// Pictorially:</span>
00884                 <span class="comment">//</span>
00885                 <span class="comment">//        P      P</span>
00886                 <span class="comment">//       /        \</span>
00887                 <span class="comment">//      X          X</span>
00888                 <span class="comment">//     / \        / \</span>
00889                 <span class="comment">//    A   B  or  A   B</span>
00890                 <span class="comment">//   /          /</span>
00891                 <span class="comment">//  .          .</span>
00892                 <span class="comment">//</span>
00893                 <span class="comment">//           |</span>
00894                 <span class="comment">//           v</span>
00895                 <span class="comment">//</span>
00896                 <span class="comment">//        P      P</span>
00897                 <span class="comment">//       /        \</span>
00898                 <span class="comment">//      A          A</span>
00899                 <span class="comment">//     / \        / \</span>
00900                 <span class="comment">//    .   B  or  .   B</span>
00901                 <span class="comment">//   /          /</span>
00902                 <span class="comment">//</span>
00903 
00904                 SplayNode = LeftChild;
00905                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00906                 <span class="keywordflow">if</span> (Node == Node-&gt;Parent-&gt;LeftChild) {
00907                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode;
00908                 } <span class="keywordflow">else</span> {
00909                     Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode;
00910                 }
00911                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = RightChild;
00912                 RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00913             }
00914         } <span class="keywordflow">else</span> {
00915 
00916             <span class="comment">//</span>
00917             <span class="comment">// The descriptor has a left child, but does not have a right child.</span>
00918             <span class="comment">// Make the left child the new root of the subtree.</span>
00919             <span class="comment">//</span>
00920             <span class="comment">// Pictorially:</span>
00921             <span class="comment">//</span>
00922             <span class="comment">//        P   P</span>
00923             <span class="comment">//       /     \</span>
00924             <span class="comment">//      X   or  X</span>
00925             <span class="comment">//     /       /</span>
00926             <span class="comment">//    A       A</span>
00927             <span class="comment">//</span>
00928             <span class="comment">//          |</span>
00929             <span class="comment">//          v</span>
00930             <span class="comment">//</span>
00931             <span class="comment">//        P   P</span>
00932             <span class="comment">//       /     \</span>
00933             <span class="comment">//      A       A</span>
00934             <span class="comment">//</span>
00935 
00936             LeftChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00937             <span class="keywordflow">if</span> (Node == Node-&gt;Parent-&gt;LeftChild) {
00938                 Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = LeftChild;
00939             } <span class="keywordflow">else</span> {
00940                 Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = LeftChild;
00941             }
00942         }
00943     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RightChild) {
00944 
00945         <span class="comment">//</span>
00946         <span class="comment">// descriptor has a right child, but does not have a left child. Make</span>
00947         <span class="comment">// the right child the new root of the subtree.</span>
00948         <span class="comment">//</span>
00949         <span class="comment">// Pictorially:</span>
00950         <span class="comment">//</span>
00951         <span class="comment">//        P   P</span>
00952         <span class="comment">//       /     \</span>
00953         <span class="comment">//      X   or  X</span>
00954         <span class="comment">//       \       \</span>
00955         <span class="comment">//        A       A</span>
00956         <span class="comment">//</span>
00957         <span class="comment">//          |</span>
00958         <span class="comment">//          v</span>
00959         <span class="comment">//</span>
00960         <span class="comment">//        P   P</span>
00961         <span class="comment">//       /     \</span>
00962         <span class="comment">//      A       A</span>
00963         <span class="comment">//</span>
00964 
00965         RightChild-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00966         <span class="keywordflow">if</span> (Node == Node-&gt;Parent-&gt;LeftChild) {
00967             Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = RightChild;
00968         } <span class="keywordflow">else</span> {
00969             Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = RightChild;
00970         }
00971     } <span class="keywordflow">else</span> {
00972 
00973         <span class="comment">//</span>
00974         <span class="comment">// The descriptor has neither a left child nor a right child. Delete</span>
00975         <span class="comment">// the descriptor from the tree and adjust its parent right or left</span>
00976         <span class="comment">// link.</span>
00977         <span class="comment">//</span>
00978         <span class="comment">// Pictorially:</span>
00979         <span class="comment">//</span>
00980         <span class="comment">//        P   P</span>
00981         <span class="comment">//       /     \</span>
00982         <span class="comment">//      X   or  X</span>
00983         <span class="comment">//</span>
00984         <span class="comment">//          |</span>
00985         <span class="comment">//          v</span>
00986         <span class="comment">//</span>
00987         <span class="comment">//        P   P</span>
00988         <span class="comment">//</span>
00989 
00990         <span class="keywordflow">if</span> (Node == Node-&gt;Parent-&gt;LeftChild) {
00991             Node-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00992         } <span class="keywordflow">else</span> {
00993             Node-&gt;Parent-&gt;RightChild = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00994         }
00995     }
00996     <span class="keywordflow">return</span>;
00997 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="addrsup.c::MiReorderTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MiReorderTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Root</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00045">45</a> of file <a class="el" href="../../d7/d3/addrsup_8c-source.html">addrsup.c</a>.
<p>
References <a class="el" href="../../d5/d7/mi_8h-source.html#l02282">_MMADDRESS_NODE::LeftChild</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02281">_MMADDRESS_NODE::Parent</a>, and <a class="el" href="../../d5/d7/mi_8h-source.html#l02283">_MMADDRESS_NODE::RightChild</a>.
<p>
Referenced by <a class="el" href="../../d7/d3/addrsup_8c-source.html#l00464">MiInsertNode()</a>, and <a class="el" href="../../d7/d3/addrsup_8c-source.html#l01001">MiLocateAddressInTree()</a>.
<p>
<pre class="fragment"><div>00052                    :
00053 
00054     This function reorders <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Node tree by applying various splay <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a>
00055     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a local function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> insert Node
00056     routine.
00057 
00058 Arguments:
00059 
00060     Node - Supplies a pointer to a <span class="keyword">virtual</span> address descriptor.
00061 
00062 Return Value:
00063 
00064     None.
00065 
00066 --*/
00067 
00068 {
00069     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> GrandParent;
00070     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> Parent;
00071     <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> SplayNode;
00072 
00073     <span class="comment">//</span>
00074     <span class="comment">// Reorder Node tree to make it as balanced as possible with as little</span>
00075     <span class="comment">// work as possible.</span>
00076     <span class="comment">//</span>
00077 
00078     SplayNode = Node;
00079 
00080     <span class="keywordflow">while</span> (SplayNode != *Root) {
00081 
00082         Parent = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00083         <span class="keywordflow">if</span> (Parent == *Root) {
00084 
00085             <span class="comment">//</span>
00086             <span class="comment">// Splay node's parent is the root of the tree. Rotate the tree</span>
00087             <span class="comment">// left or right depending on whether the splay node is the left</span>
00088             <span class="comment">// of right child of its parent.</span>
00089             <span class="comment">//</span>
00090             <span class="comment">// Pictorially:</span>
00091             <span class="comment">//</span>
00092             <span class="comment">//            Right                 Left</span>
00093             <span class="comment">//</span>
00094             <span class="comment">//          P        X          P          X</span>
00095             <span class="comment">//         / \      / \        / \        / \</span>
00096             <span class="comment">//        X   C -&gt; A   P      C   X  -&gt;  P   A</span>
00097             <span class="comment">//       / \          / \        / \    / \</span>
00098             <span class="comment">//      A   B        B   C      B   A  C   B</span>
00099             <span class="comment">//</span>
00100 
00101             *Root = SplayNode;
00102             SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00103             Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00104             <span class="keywordflow">if</span> (SplayNode == Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00105 
00106                 <span class="comment">//</span>
00107                 <span class="comment">// Splay node is the left child of its parent. Rotate tree</span>
00108                 <span class="comment">// right.</span>
00109                 <span class="comment">//</span>
00110 
00111                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00112                 <span class="keywordflow">if</span> (SplayNode-&gt;RightChild) {
00113                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00114                 }
00115                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = Parent;
00116             } <span class="keywordflow">else</span> {
00117 
00118                 <span class="comment">//</span>
00119                 <span class="comment">// Splay node is the right child of its parent. Rotate tree</span>
00120                 <span class="comment">// left.</span>
00121                 <span class="comment">//</span>
00122 
00123                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00124                 <span class="keywordflow">if</span> (SplayNode-&gt;LeftChild) {
00125                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00126                 }
00127                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = Parent;
00128             }
00129             <span class="keywordflow">break</span>;
00130         } <span class="keywordflow">else</span> {
00131             GrandParent = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00132             <span class="keywordflow">if</span> ((SplayNode == Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) &amp;&amp;
00133                (Parent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>)) {
00134 
00135                 <span class="comment">//</span>
00136                 <span class="comment">// Both the splay node and the parent node are left children</span>
00137                 <span class="comment">// of their parents. Rotate tree right and make the parent</span>
00138                 <span class="comment">// the root of the new subtree.</span>
00139                 <span class="comment">//</span>
00140                 <span class="comment">// Pictorially:</span>
00141                 <span class="comment">//</span>
00142                 <span class="comment">//        G                 P</span>
00143                 <span class="comment">//       / \              /   \</span>
00144                 <span class="comment">//      P   D            X     G</span>
00145                 <span class="comment">//     / \       -&gt;     / \   / \</span>
00146                 <span class="comment">//    X   C            A   B C   D</span>
00147                 <span class="comment">//   / \</span>
00148                 <span class="comment">//  A   B</span>
00149                 <span class="comment">//</span>
00150 
00151                 <span class="keywordflow">if</span> (GrandParent == *Root) {
00152                     *Root = Parent;
00153                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00154                 } <span class="keywordflow">else</span> {
00155                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00156                     <span class="keywordflow">if</span> (GrandParent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00157                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = Parent;
00158                     } <span class="keywordflow">else</span> {
00159                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = Parent;
00160                     }
00161                 }
00162                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00163                 <span class="keywordflow">if</span> (Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00164                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent;
00165                 }
00166                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00167                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = GrandParent;
00168                 SplayNode = Parent;
00169             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((SplayNode == Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) &amp;&amp;
00170                       (Parent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>)) {
00171 
00172                 <span class="comment">//</span>
00173                 <span class="comment">// Both the splay node and the parent node are right children</span>
00174                 <span class="comment">// of their parents. Rotate tree left and make the parent</span>
00175                 <span class="comment">// the root of the new subtree.</span>
00176                 <span class="comment">//</span>
00177                 <span class="comment">// Pictorially:</span>
00178                 <span class="comment">//</span>
00179                 <span class="comment">//        G                 P</span>
00180                 <span class="comment">//       / \              /   \</span>
00181                 <span class="comment">//      D   P            G     X</span>
00182                 <span class="comment">//         / \   -&gt;     / \   / \</span>
00183                 <span class="comment">//        C   X        D   C B   A</span>
00184                 <span class="comment">//           / \</span>
00185                 <span class="comment">//          A   B</span>
00186                 <span class="comment">//</span>
00187 
00188                 <span class="keywordflow">if</span> (GrandParent == *Root) {
00189                     *Root = Parent;
00190                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00191                 } <span class="keywordflow">else</span> {
00192                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00193                     <span class="keywordflow">if</span> (GrandParent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00194                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = Parent;
00195                     } <span class="keywordflow">else</span> {
00196                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = Parent;
00197                     }
00198                 }
00199                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00200                 <span class="keywordflow">if</span> (Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00201                     Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent;
00202                 }
00203                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00204                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = GrandParent;
00205                 SplayNode = Parent;
00206             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((SplayNode == Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) &amp;&amp;
00207                       (Parent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>)) {
00208 
00209                 <span class="comment">//</span>
00210                 <span class="comment">// Splay node is the left child of its parent and parent is</span>
00211                 <span class="comment">// the right child of its parent. Rotate tree left and make</span>
00212                 <span class="comment">// splay node the root of the new subtree.</span>
00213                 <span class="comment">//</span>
00214                 <span class="comment">// Pictorially:</span>
00215                 <span class="comment">//</span>
00216                 <span class="comment">//      G                 X</span>
00217                 <span class="comment">//     / \              /   \</span>
00218                 <span class="comment">//    A   P            G     P</span>
00219                 <span class="comment">//       / \    -&gt;    / \   / \</span>
00220                 <span class="comment">//      X   D        A   B C   D</span>
00221                 <span class="comment">//     / \</span>
00222                 <span class="comment">//    B   C</span>
00223                 <span class="comment">//</span>
00224 
00225                 <span class="keywordflow">if</span> (GrandParent == *Root) {
00226                     *Root = SplayNode;
00227                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00228                 } <span class="keywordflow">else</span> {
00229                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00230                     <span class="keywordflow">if</span> (GrandParent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00231                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode;
00232                     } <span class="keywordflow">else</span> {
00233                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode;
00234                     }
00235                 }
00236                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00237                 <span class="keywordflow">if</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00238                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00239                 }
00240                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00241                 <span class="keywordflow">if</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00242                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent;
00243                 }
00244                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00245                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00246                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = GrandParent;
00247                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = Parent;
00248             } <span class="keywordflow">else</span> {
00249 
00250                 <span class="comment">//</span>
00251                 <span class="comment">// Splay node is the right child of its parent and parent is</span>
00252                 <span class="comment">// the left child of its parent. Rotate tree right and make</span>
00253                 <span class="comment">// splay node the root of the new subtree.</span>
00254                 <span class="comment">//</span>
00255                 <span class="comment">// Pictorially:</span>
00256                 <span class="comment">//</span>
00257                 <span class="comment">//       G                 X</span>
00258                 <span class="comment">//      / \              /   \</span>
00259                 <span class="comment">//     P   A            P     G</span>
00260                 <span class="comment">//    / \        -&gt;    / \   / \</span>
00261                 <span class="comment">//   D   X            D   C B   A</span>
00262                 <span class="comment">//      / \</span>
00263                 <span class="comment">//     C   B</span>
00264                 <span class="comment">//</span>
00265 
00266                 <span class="keywordflow">if</span> (GrandParent == *Root) {
00267                     *Root = SplayNode;
00268                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = (<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00269                 } <span class="keywordflow">else</span> {
00270                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>;
00271                     <span class="keywordflow">if</span> (GrandParent == GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00272                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode;
00273                     } <span class="keywordflow">else</span> {
00274                         GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode;
00275                     }
00276                 }
00277                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>;
00278                 <span class="keywordflow">if</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>) {
00279                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = Parent;
00280                 }
00281                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>;
00282                 <span class="keywordflow">if</span> (SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>) {
00283                     SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a>-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = GrandParent;
00284                 }
00285                 Parent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00286                 GrandParent-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o2">Parent</a> = SplayNode;
00287                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o3">LeftChild</a> = Parent;
00288                 SplayNode-&gt;<a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html#o4">RightChild</a> = GrandParent;
00289             }
00290         }
00291     }
00292     <span class="keywordflow">return</span>;
00293 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:50 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
