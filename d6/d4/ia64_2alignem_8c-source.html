<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: alignem.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>alignem.c</h1><a href="../../d5/d5/ia64_2alignem_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    alignem.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implement the code necessary to emulate unaliged data</span>
00012 <span class="comment">    references.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    David N. Cutler (davec) 17-Jun-1991</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Kernel mode only.</span>
00021 <span class="comment"></span>
00022 <span class="comment">Revision History:</span>
00023 <span class="comment"></span>
00024 <span class="comment">--*/</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/ki_8h.html">ki.h</a>"</span>
00027 
<a name="l00028"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a0">00028</a> <span class="preprocessor">#define OPCODE_MASK      0x1EF00000000</span>
00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a1">00030</a> <span class="preprocessor">#define LD_OP            0x08000000000 </span>
<a name="l00031"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a2">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define LDS_OP           0x08100000000</span>
<a name="l00032"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a3">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define LDA_OP           0x08200000000</span>
<a name="l00033"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a4">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define LDSA_OP          0x08300000000</span>
<a name="l00034"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a5">00034</a> <span class="preprocessor"></span><span class="preprocessor">#define LDBIAS_OP        0x08400000000</span>
<a name="l00035"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a6">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define LDACQ_OP         0x08500000000</span>
<a name="l00036"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a7">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define LDCCLR_OP        0x08800000000</span>
<a name="l00037"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a8">00037</a> <span class="preprocessor"></span><span class="preprocessor">#define LDCNC_OP         0x08900000000</span>
<a name="l00038"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a9">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define LDCCLRACQ_OP     0x08A00000000</span>
<a name="l00039"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a10">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define ST_OP            0x08C00000000</span>
<a name="l00040"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a11">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define STREL_OP         0x08D00000000</span>
00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a12">00042</a> <span class="preprocessor">#define LD_IMM_OP        0x0A000000000 </span>
<a name="l00043"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a13">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define LDS_IMM_OP       0x0A100000000</span>
<a name="l00044"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a14">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define LDA_IMM_OP       0x0A200000000</span>
<a name="l00045"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a15">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define LDSA_IMM_OP      0x0A300000000</span>
<a name="l00046"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a16">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define LDBIAS_IMM_OP    0x0A400000000</span>
<a name="l00047"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a17">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define LDACQ_IMM_OP     0x0A500000000</span>
<a name="l00048"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a18">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define LDCCLR_IMM_OP    0x0A800000000</span>
<a name="l00049"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a19">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define LDCNC_IMM_OP     0x0A900000000</span>
<a name="l00050"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a20">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define LDCCLRACQ_IMM_OP 0x0AA00000000</span>
<a name="l00051"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a21">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define ST_IMM_OP        0x0AC00000000</span>
<a name="l00052"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a22">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define STREL_IMM_OP     0x0AD00000000</span>
00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a23">00054</a> <span class="preprocessor">#define LDF_OP           0x0C000000000</span>
<a name="l00055"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a24">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFS_OP          0x0C100000000</span>
<a name="l00056"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a25">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFA_OP          0x0C200000000</span>
<a name="l00057"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a26">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFSA_OP         0x0C300000000</span>
<a name="l00058"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a27">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFCCLR_OP       0x0C800000000</span>
<a name="l00059"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a28">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFCNC_OP        0x0C900000000</span>
<a name="l00060"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a29">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define STF_OP           0x0CC00000000</span>
00061 <span class="preprocessor"></span>
<a name="l00062"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a30">00062</a> <span class="preprocessor">#define LDF_IMM_OP       0x0E000000000</span>
<a name="l00063"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a31">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFS_IMM_OP      0x0E100000000</span>
<a name="l00064"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a32">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFA_IMM_OP      0x0E200000000</span>
<a name="l00065"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a33">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFSA_IMM_OP     0x0E300000000</span>
<a name="l00066"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a34">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFCCLR_IMM_OP   0x0E800000000</span>
<a name="l00067"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a35">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define LDFCNC_IMM_OP    0x0E900000000</span>
<a name="l00068"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a36">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define STF_IMM_OP       0x0EC00000000</span>
00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html">00070</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d3/struct__INST__FORMAT.html">_INST_FORMAT</a> {
00071     <span class="keyword">union </span>{
00072         <span class="keyword">struct </span>{
<a name="l00073"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o0">00073</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o0">qp</a>:   6;
<a name="l00074"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o1">00074</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o1">r1</a>:   7;
<a name="l00075"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o2">00075</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o2">r2</a>:   7;
<a name="l00076"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o3">00076</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o3">r3</a>:   7;
<a name="l00077"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o4">00077</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o4">x</a>:    1;
<a name="l00078"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o5">00078</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o5">hint</a>: 2;
<a name="l00079"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o6">00079</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o6">x6</a>:   6;
<a name="l00080"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o7">00080</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o7">m</a>:    1;
<a name="l00081"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o8">00081</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o8">Op</a>:   4;
<a name="l00082"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o9">00082</a>             ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o9">Rsv</a>: 23; 
00083         } i_field;
<a name="l00084"></a><a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o11">00084</a>         ULONGLONG <a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o11">Ulong64</a>;
00085     } u;
00086 } <a class="code" href="../../d1/d3/struct__INST__FORMAT.html">INST_FORMAT</a>;
00087 
00088 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00089 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a38">KiEmulateLoad</a>(
00090     IN PVOID UnalignedAddress,
00091     IN ULONG OperandSize,
00092     IN PVOID Data
00093     );
00094 
00095 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00096 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a39">KiEmulateStore</a>(
00097     IN PVOID UnalignedAddress,
00098     IN ULONG OperandSize,
00099     IN PVOID Data
00100     );
00101 
00102 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00103 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(
00104     IN PVOID UnalignedAddress,
00105     IN ULONG OperandSize,
00106     IN PVOID Data
00107     );
00108 
00109 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00110 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a41">KiEmulateStoreFloat</a>(
00111     IN PVOID UnalignedAddress,
00112     IN ULONG OperandSize,
00113     IN PVOID Data
00114     );
00115 
00116 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00117 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a42">KiEmulateLoadFloat80</a>(
00118     IN PVOID UnalignedAddress, 
00119     OUT PVOID FloatData
00120     );
00121 
00122 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00123 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a43">KiEmulateLoadFloatInt</a>(
00124     IN PVOID UnalignedAddress, 
00125     OUT PVOID FloatData
00126     );
00127 
00128 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00129 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a44">KiEmulateLoadFloat32</a>(
00130     IN PVOID UnalignedAddress, 
00131     OUT PVOID FloatData
00132     );
00133 
00134 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00135 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a45">KiEmulateLoadFloat64</a>(
00136     IN PVOID UnalignedAddress, 
00137     OUT PVOID FloatData
00138     );
00139 
00140 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00141 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a46">KiEmulateStoreFloat80</a>(
00142     IN PVOID UnalignedAddress, 
00143     OUT PVOID FloatData
00144     );
00145 
00146 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00147 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a47">KiEmulateStoreFloatInt</a>(
00148     IN PVOID UnalignedAddress, 
00149     OUT PVOID FloatData
00150     );
00151 
00152 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00153 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a48">KiEmulateStoreFloat32</a>(
00154     IN PVOID UnalignedAddress, 
00155     OUT PVOID FloatData
00156     );
00157 
00158 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00159 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a49">KiEmulateStoreFloat64</a>(
00160     IN PVOID UnalignedAddress, 
00161     OUT PVOID FloatData
00162     );
00163 
00164 
00165 BOOLEAN
<a name="l00166"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a50">00166</a> <a class="code" href="../../d7/d5/ppc_2alignem_8c.html#a18">KiEmulateReference</a> (
00167     IN OUT PEXCEPTION_RECORD ExceptionRecord,
00168     IN OUT PKEXCEPTION_FRAME ExceptionFrame,
00169     IN OUT PKTRAP_FRAME TrapFrame
00170     )
00171 
00172 <span class="comment">/*++</span>
00173 <span class="comment"></span>
00174 <span class="comment">Routine Description:</span>
00175 <span class="comment"></span>
00176 <span class="comment">    This function is called to emulate an unaligned data reference to an</span>
00177 <span class="comment">    address in the user part of the address space.</span>
00178 <span class="comment"></span>
00179 <span class="comment">Arguments:</span>
00180 <span class="comment"></span>
00181 <span class="comment">    ExceptionRecord - Supplies a pointer to an exception record.</span>
00182 <span class="comment"></span>
00183 <span class="comment">    ExceptionFrame - Supplies a pointer to an exception frame.</span>
00184 <span class="comment"></span>
00185 <span class="comment">    TrapFrame - Supplies a pointer to a trap frame.</span>
00186 <span class="comment"></span>
00187 <span class="comment">Return Value:</span>
00188 <span class="comment"></span>
00189 <span class="comment">    A value of TRUE is returned if the data reference is successfully</span>
00190 <span class="comment">    emulated. Otherwise, a value of FALSE is returned.</span>
00191 <span class="comment"></span>
00192 <span class="comment">--*/</span>
00193 
00194 {
00195 
00196     PVOID EffectiveAddress;
00197     PVOID ExceptionAddress;
00198     KIRQL  OldIrql;
00199 
00200     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00201     <a class="code" href="../../d1/d3/struct__INST__FORMAT.html">INST_FORMAT</a> FaultInstruction;
00202     ULONGLONG Opcode;
00203     ULONGLONG Reg2Value;
00204     ULONGLONG Reg3Value;
00205     ULONGLONG BundleLow;
00206     ULONGLONG BundleHigh;
00207     ULONGLONG Syllable;
00208     ULONGLONG Data = 0;
00209     FLOAT128 FloatData = {0, 0};
00210     ULONG OpSize;
00211     ULONG ImmValue;
00212     ULONG Length;
00213 
00214 
00215     <span class="comment">//</span>
00216     <span class="comment">// Must flush the RSE to synchronize the RSE and backing store contents</span>
00217     <span class="comment">//</span>
00218 
00219     KiFlushRse();
00220 
00221     <span class="comment">//</span>
00222     <span class="comment">// Call out to profile interrupt if alignment profiling is active</span>
00223     <span class="comment">//</span>
00224 
00225     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/kernldat_8c.html#a52">KiProfileAlignmentFixup</a>) {
00226 
00227         <span class="keywordflow">if</span> (++<a class="code" href="../../d5/d9/kernldat_8c.html#a54">KiProfileAlignmentFixupCount</a> &gt;= <a class="code" href="../../d5/d9/kernldat_8c.html#a53">KiProfileAlignmentFixupInterval</a>) {
00228 
00229             <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a56">PROFILE_LEVEL</a>, &amp;OldIrql);
00230             <a class="code" href="../../d5/d9/kernldat_8c.html#a54">KiProfileAlignmentFixupCount</a> = 0;
00231             <a class="code" href="../../d1/d9/clock_8c.html#a6">KeProfileInterruptWithSource</a>(TrapFrame, ProfileAlignmentFixup);
00232             <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00233 
00234         }
00235     }
00236 
00237     <span class="comment">//</span>
00238     <span class="comment">// Save the original exception address in case another exception</span>
00239     <span class="comment">// occurs.</span>
00240     <span class="comment">//</span>
00241 
00242     EffectiveAddress = (PVOID) ExceptionRecord-&gt;ExceptionInformation[1]; 
00243     ExceptionAddress = (PVOID) TrapFrame-&gt;StIIP;
00244 
00245     <span class="comment">//</span>
00246     <span class="comment">// Capture previous mode from trap frame not current thread.</span>
00247     <span class="comment">//</span>
00248 
00249     PreviousMode = (<a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>) TrapFrame-&gt;PreviousMode;
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// Any exception that occurs during the attempted emulation of the</span>
00253     <span class="comment">// unaligned reference causes the emulation to be aborted. The new</span>
00254     <span class="comment">// exception code and information is copied to the original exception</span>
00255     <span class="comment">// record and a value of FALSE is returned.</span>
00256     <span class="comment">//</span>
00257 
00258     <span class="keywordflow">try</span> {
00259 
00260 
00261         BundleLow = *((ULONGLONG *)ExceptionAddress);
00262         BundleHigh = *(((ULONGLONG *)ExceptionAddress) + 1);
00263 
00264         Syllable = (TrapFrame-&gt;StIPSR &gt;&gt; PSR_RI) &amp; 0x3;
00265 
00266         <span class="keywordflow">switch</span> (Syllable) {
00267         <span class="keywordflow">case</span> 0: 
00268             FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.Ulong64 = (BundleLow &gt;&gt; 5);
00269             <span class="keywordflow">break</span>;
00270         <span class="keywordflow">case</span> 1:
00271             FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.Ulong64 = (BundleLow &gt;&gt; 46) | (BundleHigh &lt;&lt; 18);
00272             <span class="keywordflow">break</span>;
00273         <span class="keywordflow">case</span> 2:
00274             FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.Ulong64 = (BundleHigh &gt;&gt; 23);
00275         <span class="keywordflow">case</span> 3: 
00276         <span class="keywordflow">default</span>: 
00277             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00278         }
00279     
00280         Opcode = FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.Ulong64 &amp; <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a0">OPCODE_MASK</a>;
00281         OpSize = (ULONG)FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x6 &amp; 0x3;
00282 
00283         <span class="keywordflow">switch</span> (Opcode) {
00284 
00285         <span class="comment">//    </span>
00286         <span class="comment">// speculative and speculative advanced load</span>
00287         <span class="comment">//</span>
00288 
00289         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a2">LDS_OP</a>:
00290         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a4">LDSA_OP</a>:    
00291         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a13">LDS_IMM_OP</a>:
00292         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a15">LDSA_IMM_OP</a>:
00293         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a24">LDFS_OP</a>:
00294         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a26">LDFSA_OP</a>:
00295         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a31">LDFS_IMM_OP</a>:
00296 
00297             <span class="comment">//</span>
00298             <span class="comment">// return NaT value to the target register</span>
00299             <span class="comment">//</span>
00300 
00301             TrapFrame-&gt;StIPSR |= (1i64 &lt;&lt; PSR_ED);
00302 
00303             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00304 
00305         <span class="comment">//</span>
00306         <span class="comment">// normal, advance, and check load</span>
00307         <span class="comment">//</span>
00308 
00309         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a1">LD_OP</a>:
00310         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a3">LDA_OP</a>:
00311         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a5">LDBIAS_OP</a>:
00312         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a7">LDCCLR_OP</a>:
00313         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a8">LDCNC_OP</a>:
00314         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a6">LDACQ_OP</a>:
00315         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a9">LDCCLRACQ_OP</a>:
00316 
00317             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x == 1) {
00318                 
00319                 <span class="comment">//</span>
00320                 <span class="comment">// xField must be 0</span>
00321                 <span class="comment">//</span>
00322 
00323                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00324             }
00325     
00326             <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00327                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( EffectiveAddress,
00328                               1 &lt;&lt; OpSize,
00329                               <span class="keyword">sizeof</span>(UCHAR) );
00330             }
00331             <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a38">KiEmulateLoad</a>(EffectiveAddress, OpSize, &amp;Data);
00332             <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1,
00333                                 Data,
00334                                 ExceptionFrame,
00335                                 TrapFrame );
00336 
00337             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00338 
00339                 <span class="comment">//</span>
00340                 <span class="comment">// Update the address register (R3)</span>
00341                 <span class="comment">//</span>
00342                 
00343 
00344                 Reg2Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00345                                                 ExceptionFrame,
00346                                                 TrapFrame );
00347 
00348                 Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00349                                                 ExceptionFrame,
00350                                                 TrapFrame );
00351 
00352                 <span class="comment">//</span>
00353                 <span class="comment">// register update form</span>
00354                 <span class="comment">//</span>
00355 
00356                 Reg3Value = Reg2Value + Reg3Value;
00357 
00358                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a> ((ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3, 
00359                                     Reg3Value,
00360                                     ExceptionFrame,
00361                                     TrapFrame);
00362             }
00363 
00364             <span class="keywordflow">if</span> ((Opcode == <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a6">LDACQ_OP</a>) || (Opcode == <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a9">LDCCLRACQ_OP</a>)) {
00365 
00366                 <span class="comment">//</span>
00367                 <span class="comment">// all future access should occur after unaligned memory accesses</span>
00368                 <span class="comment">//</span>
00369 
00370                 __mf();
00371             }
00372 
00373             <span class="keywordflow">break</span>;
00374 
00375         <span class="comment">//</span>
00376         <span class="comment">// normal, advance, and check load</span>
00377         <span class="comment">//     immidiate updated form</span>
00378         <span class="comment">//</span>
00379 
00380         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a12">LD_IMM_OP</a>:
00381         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a14">LDA_IMM_OP</a>:
00382         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a16">LDBIAS_IMM_OP</a>:
00383         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a18">LDCCLR_IMM_OP</a>:
00384         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a19">LDCNC_IMM_OP</a>:
00385         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a17">LDACQ_IMM_OP</a>:
00386         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a20">LDCCLRACQ_IMM_OP</a>:
00387 
00388             <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00389                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( EffectiveAddress,
00390                               1 &lt;&lt; OpSize,
00391                               <span class="keyword">sizeof</span>(UCHAR) );
00392             }
00393             <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a38">KiEmulateLoad</a>(EffectiveAddress, OpSize, &amp;Data);
00394             <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1,
00395                                 Data,
00396                                 ExceptionFrame,
00397                                 TrapFrame );
00398 
00399             <span class="comment">//</span>
00400             <span class="comment">// Update the address register R3</span>
00401             <span class="comment">//</span>
00402 
00403             Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00404                                             ExceptionFrame,
00405                                             TrapFrame );
00406 
00407             <span class="comment">//</span>
00408             <span class="comment">// immediate update form</span>
00409             <span class="comment">//</span>
00410 
00411             ImmValue = (ULONG)(FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2 
00412                              + (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x &lt;&lt; 7));
00413 
00414             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00415 
00416                 ImmValue = 0xFFFFFFFFFFFFFF00 | ImmValue;
00417 
00418             } 
00419 
00420             Reg3Value = Reg3Value + ImmValue;
00421 
00422             <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00423                                 Reg3Value,
00424                                 ExceptionFrame,
00425                                 TrapFrame );
00426             
00427             <span class="keywordflow">if</span> ((Opcode == <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a17">LDACQ_IMM_OP</a>) || (Opcode == <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a20">LDCCLRACQ_IMM_OP</a>)) {
00428 
00429                 <span class="comment">//</span>
00430                 <span class="comment">// all future access should occur after unaligned memory accesses</span>
00431                 <span class="comment">//</span>
00432 
00433                 __mf();
00434             }
00435 
00436             <span class="keywordflow">break</span>;
00437 
00438         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a23">LDF_OP</a>:
00439         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a25">LDFA_OP</a>:
00440         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a27">LDFCCLR_OP</a>:
00441         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a28">LDFCNC_OP</a>:
00442 
00443             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x == 1) {
00444 
00445                 <span class="comment">//</span>
00446                 <span class="comment">// floating point load pair</span>
00447                 <span class="comment">//</span>
00448 
00449                 <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00450 
00451                     <span class="comment">//</span>
00452                     <span class="comment">// m field must be zero</span>
00453                     <span class="comment">//</span>
00454 
00455                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00456                 
00457                 }
00458 
00459                 <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00460 
00461                     <span class="keywordflow">switch</span> (OpSize) {
00462                     <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00463                     <span class="keywordflow">case</span> 1: Length = 8; <span class="keywordflow">break</span>;
00464                     <span class="keywordflow">case</span> 2: Length = 4; <span class="keywordflow">break</span>;
00465                     <span class="keywordflow">case</span> 3: Length = 8; <span class="keywordflow">break</span>;
00466                     <span class="keywordflow">default</span>: 
00467                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00468                     }
00469 
00470                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( EffectiveAddress,
00471                                   Length &lt;&lt; 1,
00472                                   <span class="keyword">sizeof</span>(UCHAR) );
00473                 }
00474 
00475                 <span class="comment">//</span>
00476                 <span class="comment">// emulate the 1st half of the pair</span>
00477                 <span class="comment">//</span>
00478 
00479                 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(EffectiveAddress, OpSize, &amp;FloatData);
00480                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1,
00481                                          FloatData,
00482                                          ExceptionFrame,
00483                                          TrapFrame );
00484 
00485                 <span class="comment">//</span>
00486                 <span class="comment">// emulate the 2nd half of the pair</span>
00487                 <span class="comment">//</span>
00488 
00489                 EffectiveAddress = (PVOID)((ULONG_PTR)EffectiveAddress + Length);
00490 
00491                 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(EffectiveAddress, OpSize, &amp;FloatData);
00492                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00493                                          FloatData,
00494                                          ExceptionFrame,
00495                                          TrapFrame );
00496 
00497             } <span class="keywordflow">else</span> {
00498 
00499                 <span class="comment">//</span>
00500                 <span class="comment">// floating point single load</span>
00501                 <span class="comment">//</span>
00502 
00503                 <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00504 
00505                     <span class="keywordflow">switch</span> (OpSize) {
00506                     <span class="keywordflow">case</span> 0: Length = 16; <span class="keywordflow">break</span>;
00507                     <span class="keywordflow">case</span> 1: Length = 8; <span class="keywordflow">break</span>;
00508                     <span class="keywordflow">case</span> 2: Length = 4; <span class="keywordflow">break</span>;
00509                     <span class="keywordflow">case</span> 3: Length = 8; <span class="keywordflow">break</span>;
00510                     <span class="keywordflow">default</span>: 
00511                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00512                     }
00513 
00514                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( EffectiveAddress,
00515                                   Length,
00516                                   <span class="keyword">sizeof</span>(UCHAR) );
00517                 }
00518 
00519                 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(EffectiveAddress, OpSize, &amp;FloatData);
00520                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1,
00521                                          FloatData,
00522                                          ExceptionFrame,
00523                                          TrapFrame );
00524 
00525                 <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00526                     
00527                     <span class="comment">//</span>
00528                     <span class="comment">// update the address register (R3)</span>
00529                     <span class="comment">//</span>
00530 
00531                     Reg2Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00532                                                     ExceptionFrame,
00533                                                     TrapFrame );
00534                 
00535                     Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00536                                                     ExceptionFrame,
00537                                                     TrapFrame );
00538                     <span class="comment">//</span>
00539                     <span class="comment">// register update form</span>
00540                     <span class="comment">//</span>
00541                 
00542                     Reg3Value = Reg2Value + Reg3Value;
00543 
00544                     <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a> ((ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3, 
00545                                         Reg3Value,
00546                                         ExceptionFrame,
00547                                         TrapFrame);
00548                 }
00549             }
00550                 
00551             <span class="keywordflow">break</span>;
00552 
00553         <span class="comment">//    </span>
00554         <span class="comment">// normal, advanced and checked floating point load </span>
00555         <span class="comment">//    immediate updated form</span>
00556         <span class="comment">//</span>
00557 
00558         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a30">LDF_IMM_OP</a>:
00559         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a32">LDFA_IMM_OP</a>:
00560         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a34">LDFCCLR_IMM_OP</a>:
00561         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a35">LDFCNC_IMM_OP</a>:
00562 
00563             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x == 1) {
00564 
00565                 <span class="comment">//</span>
00566                 <span class="comment">// floating point load pair</span>
00567                 <span class="comment">//</span>
00568 
00569                 <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 0) {
00570 
00571                     <span class="comment">//</span>
00572                     <span class="comment">// m field must be one</span>
00573                     <span class="comment">//</span>
00574 
00575                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00576                 
00577                 }
00578 
00579                 <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00580 
00581                     <span class="keywordflow">switch</span> (OpSize) {
00582                     <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00583                     <span class="keywordflow">case</span> 1: Length = 8; <span class="keywordflow">break</span>;
00584                     <span class="keywordflow">case</span> 2: Length = 8; <span class="keywordflow">break</span>;
00585                     <span class="keywordflow">case</span> 3: Length = 4; <span class="keywordflow">break</span>;
00586                     <span class="keywordflow">default</span>: 
00587                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00588                     }
00589 
00590                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( EffectiveAddress,
00591                                   Length &lt;&lt; 1,
00592                                   <span class="keyword">sizeof</span>(UCHAR) );
00593                 }
00594 
00595                 <span class="comment">//</span>
00596                 <span class="comment">// emulate the 1st half of the pair</span>
00597                 <span class="comment">//</span>
00598 
00599                 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(EffectiveAddress, OpSize, &amp;FloatData);
00600                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1,
00601                                          FloatData,
00602                                          ExceptionFrame,
00603                                          TrapFrame );
00604 
00605                 EffectiveAddress = (PVOID)((ULONG_PTR)EffectiveAddress + Length);
00606 
00607                 <span class="comment">//</span>
00608                 <span class="comment">// emulate the 2nd half of the pair</span>
00609                 <span class="comment">//</span>
00610 
00611                 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(EffectiveAddress, OpSize, &amp;FloatData);
00612                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00613                                          FloatData,
00614                                          ExceptionFrame,
00615                                          TrapFrame );
00616 
00617                 <span class="comment">//</span>
00618                 <span class="comment">// Update the address register (R3)</span>
00619                 <span class="comment">//</span>
00620 
00621                 Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00622                                                 ExceptionFrame,
00623                                                 TrapFrame );
00624 
00625                 <span class="comment">//</span>
00626                 <span class="comment">// immediate update form</span>
00627                 <span class="comment">//</span>
00628 
00629                 ImmValue = Length &lt;&lt; 1;
00630                 
00631                 Reg3Value = Reg3Value + ImmValue;
00632 
00633                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00634                                     Reg3Value,
00635                                     ExceptionFrame,
00636                                     TrapFrame );
00637 
00638             } <span class="keywordflow">else</span> {
00639                 
00640                 <span class="comment">//</span>
00641                 <span class="comment">// floating point single load</span>
00642                 <span class="comment">// </span>
00643 
00644                 <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00645                     
00646                     <span class="keywordflow">switch</span> (OpSize) {
00647                     <span class="keywordflow">case</span> 0: Length = 16; <span class="keywordflow">break</span>;
00648                     <span class="keywordflow">case</span> 1: Length = 8; <span class="keywordflow">break</span>;
00649                     <span class="keywordflow">case</span> 2: Length = 4; <span class="keywordflow">break</span>;
00650                     <span class="keywordflow">case</span> 3: Length = 8; <span class="keywordflow">break</span>;
00651                     <span class="keywordflow">default</span>: 
00652                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00653                     }
00654 
00655                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( EffectiveAddress,
00656                                   Length,
00657                                   <span class="keyword">sizeof</span>(UCHAR) );
00658                 }
00659                 <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(EffectiveAddress, OpSize, &amp;FloatData);
00660                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a3">KiSetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1,
00661                                          FloatData,
00662                                          ExceptionFrame,
00663                                          TrapFrame );
00664 
00665                 <span class="comment">//</span>
00666                 <span class="comment">// Update the address register (R3)</span>
00667                 <span class="comment">//</span>
00668 
00669                 Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00670                                                 ExceptionFrame,
00671                                                 TrapFrame );
00672 
00673                 <span class="comment">//</span>
00674                 <span class="comment">// immediate update form</span>
00675                 <span class="comment">//</span>
00676 
00677                 ImmValue = (ULONG)(FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2 
00678                              + (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x &lt;&lt; 7));
00679 
00680                 <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00681 
00682                     ImmValue = 0xFFFFFFFFFFFFFF00 | ImmValue;
00683 
00684                 } 
00685 
00686                 Reg3Value = Reg3Value + ImmValue;
00687 
00688                 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00689                                     Reg3Value,
00690                                     ExceptionFrame,
00691                                     TrapFrame );
00692             }
00693              
00694             <span class="keywordflow">break</span>;
00695 
00696 
00697         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a11">STREL_OP</a>:
00698 
00699              __mf();
00700 
00701         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a10">ST_OP</a>:
00702 
00703             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x == 1) {
00704                 
00705                 <span class="comment">//</span>
00706                 <span class="comment">// xField must be 0</span>
00707                 <span class="comment">//</span>
00708 
00709                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00710             }
00711 
00712             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00713 
00714                 <span class="comment">//</span>
00715                 <span class="comment">// no register update form defined</span>
00716                 <span class="comment">//</span>
00717 
00718                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00719             }
00720     
00721             <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00722                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>( EffectiveAddress,
00723                                1 &lt;&lt; OpSize,
00724                                <span class="keyword">sizeof</span>(UCHAR) );
00725             }
00726             Data = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00727                                        ExceptionFrame,
00728                                        TrapFrame );
00729 
00730             <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a39">KiEmulateStore</a>( EffectiveAddress, OpSize, &amp;Data);
00731 
00732             <span class="keywordflow">break</span>;
00733             
00734         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a22">STREL_IMM_OP</a>:
00735 
00736             __mf();
00737 
00738         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a21">ST_IMM_OP</a>:
00739 
00740             <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00741                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>( EffectiveAddress,
00742                                1 &lt;&lt; OpSize,
00743                                <span class="keyword">sizeof</span>(UCHAR) );
00744             }
00745             Data = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00746                                        ExceptionFrame,
00747                                        TrapFrame );
00748 
00749             <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a39">KiEmulateStore</a>( EffectiveAddress, OpSize, &amp;Data);
00750 
00751             <span class="comment">//</span>
00752             <span class="comment">// update the address register (R3)</span>
00753             <span class="comment">//</span>
00754 
00755             Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00756                                        ExceptionFrame,
00757                                        TrapFrame );
00758 
00759             <span class="comment">//</span>
00760             <span class="comment">// immediate update form</span>
00761             <span class="comment">//</span>
00762 
00763             ImmValue = (ULONG)(FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1 
00764                              + (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x &lt;&lt; 7));
00765 
00766             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00767 
00768                 ImmValue = 0xFFFFFFFFFFFFFF00 | ImmValue;
00769 
00770             } 
00771 
00772             Reg3Value = Reg3Value + ImmValue;
00773 
00774             <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00775                                 Reg3Value,
00776                                 ExceptionFrame,
00777                                 TrapFrame );
00778             
00779             <span class="keywordflow">break</span>;
00780             
00781 
00782         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a29">STF_OP</a>:    
00783     
00784             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x) {
00785 
00786                 <span class="comment">//</span>
00787                 <span class="comment">// x field must be 0 </span>
00788                 <span class="comment">//</span>
00789 
00790                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00791             }
00792 
00793             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m) {
00794 
00795                 <span class="comment">//</span>
00796                 <span class="comment">// no register update form defined</span>
00797                 <span class="comment">//</span>
00798 
00799                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00800             }
00801 
00802             <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00803 
00804                 <span class="keywordflow">switch</span> (OpSize) {
00805                 <span class="keywordflow">case</span> 0: Length = 16; <span class="keywordflow">break</span>;
00806                 <span class="keywordflow">case</span> 1: Length = 8; <span class="keywordflow">break</span>;
00807                 <span class="keywordflow">case</span> 2: Length = 4; <span class="keywordflow">break</span>;
00808                 <span class="keywordflow">case</span> 3: Length = 8; <span class="keywordflow">break</span>;
00809                 <span class="keywordflow">default</span>: 
00810                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00811                 }
00812                 
00813                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>( EffectiveAddress,
00814                                Length,
00815                                <span class="keyword">sizeof</span>(UCHAR) );
00816             }
00817             FloatData = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a2">KiGetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00818                                              ExceptionFrame,
00819                                              TrapFrame );
00820 
00821             <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a41">KiEmulateStoreFloat</a>( EffectiveAddress, OpSize, &amp;FloatData);
00822 
00823             <span class="keywordflow">break</span>;
00824             
00825         <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a36">STF_IMM_OP</a>:    
00826 
00827             <span class="keywordflow">if</span>( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ){
00828 
00829                 <span class="keywordflow">switch</span> (OpSize) {
00830                 <span class="keywordflow">case</span> 0: Length = 16; <span class="keywordflow">break</span>;
00831                 <span class="keywordflow">case</span> 1: Length = 8; <span class="keywordflow">break</span>;
00832                 <span class="keywordflow">case</span> 2: Length = 4; <span class="keywordflow">break</span>;
00833                 <span class="keywordflow">case</span> 3: Length = 8; <span class="keywordflow">break</span>;
00834                 <span class="keywordflow">default</span>: 
00835                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00836                 }
00837                 
00838                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>( EffectiveAddress,
00839                                Length,
00840                                <span class="keyword">sizeof</span>(UCHAR) );
00841             }
00842             FloatData = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a2">KiGetFloatRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r2,
00843                                              ExceptionFrame,
00844                                              TrapFrame );
00845 
00846             <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a41">KiEmulateStoreFloat</a>( EffectiveAddress, OpSize, &amp;FloatData);
00847 
00848             <span class="comment">//</span>
00849             <span class="comment">// update the address register (R3)</span>
00850             <span class="comment">//</span>
00851 
00852             Reg3Value = <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00853                                             ExceptionFrame,
00854                                             TrapFrame );
00855             <span class="comment">//</span>
00856             <span class="comment">// immediate update form</span>
00857             <span class="comment">//</span>
00858 
00859             ImmValue = (ULONG)(FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r1 
00860                              + (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.x &lt;&lt; 7));
00861 
00862             <span class="keywordflow">if</span> (FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.m == 1) {
00863 
00864                 ImmValue = 0xFFFFFFFFFFFFFF00 | ImmValue;
00865 
00866             }
00867 
00868             Reg3Value = Reg3Value + ImmValue;
00869 
00870             <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a>( (ULONG) FaultInstruction.<a class="code" href="../../d1/d3/struct__INST__FORMAT.html#o12">u</a>.i_field.r3,
00871                                 Reg3Value,
00872                                 ExceptionFrame,
00873                                 TrapFrame );
00874             
00875             <span class="keywordflow">break</span>;
00876             
00877         <span class="keywordflow">default</span>:
00878 
00879             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00880 
00881         }
00882 
00883         <span class="comment">//</span>
00884         <span class="comment">// advance instruction pointer</span>
00885         <span class="comment">//</span>
00886 
00887         <a class="code" href="../../d4/d5/ia64_2trapc_8c.html#a13">KiAdvanceInstPointer</a>(TrapFrame);
00888 
00889         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00890 
00891     <span class="comment">//</span>
00892     <span class="comment">// If an exception occurs, then copy the new exception information to the</span>
00893     <span class="comment">// original exception record and handle the exception.</span>
00894     <span class="comment">//</span>
00895 
00896     } except (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a>(ExceptionRecord,
00897                                (GetExceptionInformation())-&gt;ExceptionRecord)) {
00898 
00899         <span class="comment">//</span>
00900         <span class="comment">// Preserve the original exception address.</span>
00901         <span class="comment">//</span>
00902 
00903         ExceptionRecord-&gt;ExceptionAddress = ExceptionAddress;
00904     }
00905 
00906     <span class="comment">//</span>
00907     <span class="comment">// Return a value of FALSE.</span>
00908     <span class="comment">//</span>
00909 
00910     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00911 }
00912 
00913 
00914 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00915"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a38">00915</a> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a38">KiEmulateLoad</a>(
00916     IN PVOID UnalignedAddress,
00917     IN ULONG OperandSize,
00918     IN PVOID Data
00919     )
00920 
00921 <span class="comment">/*++</span>
00922 <span class="comment"></span>
00923 <span class="comment">Routine Description:</span>
00924 <span class="comment"></span>
00925 <span class="comment">    This routine returns the integer value stored at the unaligned</span>
00926 <span class="comment">    address passed in UnalignedAddress.</span>
00927 <span class="comment"></span>
00928 <span class="comment">Arguments:</span>
00929 <span class="comment"></span>
00930 <span class="comment">    UnalignedAddress - Supplies a pointer to data value.</span>
00931 <span class="comment"></span>
00932 <span class="comment">    OperandSize - Supplies the size of data to be loaded</span>
00933 <span class="comment"></span>
00934 <span class="comment">    Data - Supplies a pointer to be filled for data</span>
00935 <span class="comment">   </span>
00936 <span class="comment">Return Value:</span>
00937 <span class="comment"></span>
00938 <span class="comment">    The value at the address pointed to by UnalignedAddress.</span>
00939 <span class="comment"></span>
00940 <span class="comment">--*/</span>
00941 
00942 {
00943     PUCHAR Source;
00944     PUCHAR Destination;
00945     ULONG i;
00946 
00947     Source = (PUCHAR) UnalignedAddress; 
00948     Destination = (PUCHAR) Data;
00949     OperandSize = 1 &lt;&lt; OperandSize; 
00950 
00951     <span class="keywordflow">for</span> (i = 0; i &lt; OperandSize; i++) {
00952 
00953         *Destination++ = *Source++;
00954 
00955     }
00956 
00957     <span class="keywordflow">return</span>;
00958 }
00959 
00960 
00961 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00962"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a39">00962</a> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a39">KiEmulateStore</a>(
00963     IN PVOID UnalignedAddress,
00964     IN ULONG OperandSize,
00965     IN PVOID Data
00966     )
00967 <span class="comment">/*++</span>
00968 <span class="comment"></span>
00969 <span class="comment">Routine Description:</span>
00970 <span class="comment"></span>
00971 <span class="comment">    This routine store the integer value at the unaligned</span>
00972 <span class="comment">    address passed in UnalignedAddress.</span>
00973 <span class="comment"></span>
00974 <span class="comment">Arguments:</span>
00975 <span class="comment"></span>
00976 <span class="comment">    UnalignedAddress - Supplies a pointer to be stored</span>
00977 <span class="comment"></span>
00978 <span class="comment">    OperandSize - Supplies the size of data to be storeed</span>
00979 <span class="comment"></span>
00980 <span class="comment">    Data - Supplies a pointer to data value</span>
00981 <span class="comment">   </span>
00982 <span class="comment">Return Value:</span>
00983 <span class="comment"></span>
00984 <span class="comment">    The value at the address pointed to by UnalignedAddress.</span>
00985 <span class="comment"></span>
00986 <span class="comment">--*/</span>
00987 {
00988     PUCHAR Source;
00989     PUCHAR Destination;
00990     ULONG i;
00991 
00992     Source = (PUCHAR) Data; 
00993     Destination = (PUCHAR) UnalignedAddress;
00994     OperandSize = 1 &lt;&lt; OperandSize; 
00995 
00996     <span class="keywordflow">for</span> (i = 0; i &lt; OperandSize; i++) {
00997 
00998         *Destination++ = *Source++;
00999 
01000     }
01001 
01002     <span class="keywordflow">return</span>;
01003 }
01004 
01005 
01006 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01007"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">01007</a> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a51">KiEmulateLoadFloat</a>(
01008     IN PVOID UnalignedAddress,
01009     IN ULONG OperandSize,
01010     IN OUT PVOID Data
01011     )
01012 
01013 <span class="comment">/*++</span>
01014 <span class="comment"></span>
01015 <span class="comment">Routine Description:</span>
01016 <span class="comment"></span>
01017 <span class="comment">    This routine returns the floating point value stored at the unaligned</span>
01018 <span class="comment">    address passed in UnalignedAddress.</span>
01019 <span class="comment"></span>
01020 <span class="comment">Arguments:</span>
01021 <span class="comment"></span>
01022 <span class="comment">    UnalignedAddress - Supplies a pointer to floating point data value.</span>
01023 <span class="comment"></span>
01024 <span class="comment">    OperandSize - Supplies the size of data to be loaded</span>
01025 <span class="comment"></span>
01026 <span class="comment">    Data - Supplies a pointer to be filled for data</span>
01027 <span class="comment">   </span>
01028 <span class="comment">Return Value:</span>
01029 <span class="comment"></span>
01030 <span class="comment">    The value at the address pointed to by UnalignedAddress.</span>
01031 <span class="comment"></span>
01032 <span class="comment">--*/</span>
01033 
01034 {
01035     FLOAT128 FloatData;
01036 
01037     RtlMoveMemory(&amp;FloatData, UnalignedAddress, <span class="keyword">sizeof</span>(FLOAT128));
01038 
01039     <span class="keywordflow">switch</span> (OperandSize) {
01040 
01041     <span class="keywordflow">case</span> 0:
01042         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a42">KiEmulateLoadFloat80</a>(&amp;FloatData, Data);
01043         <span class="keywordflow">return</span>;
01044 
01045     <span class="keywordflow">case</span> 1:
01046         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a43">KiEmulateLoadFloatInt</a>(&amp;FloatData, Data);
01047         <span class="keywordflow">return</span>;
01048 
01049     <span class="keywordflow">case</span> 2:
01050         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a44">KiEmulateLoadFloat32</a>(&amp;FloatData, Data);
01051         <span class="keywordflow">return</span>;
01052 
01053     <span class="keywordflow">case</span> 3: 
01054         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a45">KiEmulateLoadFloat64</a>(&amp;FloatData, Data);
01055         <span class="keywordflow">return</span>;
01056 
01057     <span class="keywordflow">default</span>:
01058         <span class="keywordflow">return</span>;
01059     }
01060 }
01061 
01062 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01063"></a><a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a41">01063</a> <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a41">KiEmulateStoreFloat</a>(
01064     IN PVOID UnalignedAddress,
01065     IN ULONG OperandSize,
01066     IN PVOID Data
01067     )
01068 
01069 <span class="comment">/*++</span>
01070 <span class="comment"></span>
01071 <span class="comment">Routine Description:</span>
01072 <span class="comment"></span>
01073 <span class="comment">    This routine stores the floating point value stored at the unaligned</span>
01074 <span class="comment">    address passed in UnalignedAddress.</span>
01075 <span class="comment"></span>
01076 <span class="comment">Arguments:</span>
01077 <span class="comment"></span>
01078 <span class="comment">    UnalignedAddress - Supplies a pointer to be stored.</span>
01079 <span class="comment"></span>
01080 <span class="comment">    OperandSize - Supplies the size of data to be loaded</span>
01081 <span class="comment"></span>
01082 <span class="comment">    Data - Supplies a pointer to floating point data</span>
01083 <span class="comment">   </span>
01084 <span class="comment">Return Value:</span>
01085 <span class="comment"></span>
01086 <span class="comment">    The value at the address pointed to by UnalignedAddress.</span>
01087 <span class="comment"></span>
01088 <span class="comment">--*/</span>
01089 
01090 {
01091     FLOAT128 FloatData;
01092     ULONG Length;
01093 
01094     <span class="keywordflow">switch</span> (OperandSize) {
01095 
01096     <span class="keywordflow">case</span> 0:
01097         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a46">KiEmulateStoreFloat80</a>(&amp;FloatData, Data);
01098         Length = 16;
01099         <span class="keywordflow">break</span>;
01100 
01101     <span class="keywordflow">case</span> 1:
01102         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a47">KiEmulateStoreFloatInt</a>(&amp;FloatData, Data);
01103         Length = 8;
01104         <span class="keywordflow">break</span>;
01105 
01106     <span class="keywordflow">case</span> 2:
01107         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a48">KiEmulateStoreFloat32</a>(&amp;FloatData, Data);
01108         Length = 4;
01109         <span class="keywordflow">break</span>;
01110 
01111     <span class="keywordflow">case</span> 3: 
01112         <a class="code" href="../../d5/d5/ia64_2alignem_8c.html#a49">KiEmulateStoreFloat64</a>(&amp;FloatData, Data);
01113         Length = 8;
01114         <span class="keywordflow">break</span>;
01115 
01116     <span class="keywordflow">default</span>:
01117         <span class="keywordflow">return</span>;
01118     }
01119 
01120     RtlMoveMemory(UnalignedAddress, &amp;FloatData, Length);
01121 }
01122 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:13 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
