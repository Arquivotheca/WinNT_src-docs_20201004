<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: statctl.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>statctl.c</h1><a href="../../d5/d5/statctl_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************************************************************\</span>
00002 <span class="comment">*</span>
00003 <span class="comment">*  STATIC.C</span>
00004 <span class="comment">*</span>
00005 <span class="comment">*  Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">*  Static Dialog Controls Routines</span>
00008 <span class="comment">*</span>
00009 <span class="comment">*  13-Nov-1990 mikeke   from win3</span>
00010 <span class="comment">*  29-Jan-1991 IanJa    StaticPaint -&gt; xxxStaticPaint; partial revalidation</span>
00011 <span class="comment">*  01-Nov-1994 ChrisWil merged in Daytona/Chicago w/Ani-Icons.</span>
00012 <span class="comment">*</span>
00013 <span class="comment">\****************************************************************************/</span>
00014 
00015 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00016 <span class="preprocessor">#pragma hdrstop</span>
00017 <span class="preprocessor"></span>
00018 <span class="comment">/*</span>
00019 <span class="comment"> * Local Routines.</span>
00020 <span class="comment"> */</span>
00021 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>   <a class="code" href="../../d5/d5/statctl_8c.html#a13">xxxNextAniIconStep</a>(<a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a>);
00022 HANDLE <a class="code" href="../../d5/d5/statctl_8c.html#a14">xxxSetStaticImage</a>(<a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a>,HANDLE,BOOL);
00023 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d5/statctl_8c.html#a15">xxxStaticLoadImage</a>(<a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a>,LPWSTR);
00024 
00025 
00026 <span class="comment">/*</span>
00027 <span class="comment"> * Type table.  This is used for validation of the</span>
00028 <span class="comment"> * image-types.  For the PPC release we won't support</span>
00029 <span class="comment"> * the metafile format, but others are OK.</span>
00030 <span class="comment"> */</span>
<a name="l00031"></a><a class="code" href="../../d5/d5/statctl_8c.html#a0">00031</a> <span class="preprocessor">#define IMAGE_STMMAX    IMAGE_ENHMETAFILE+1</span>
00032 <span class="preprocessor"></span>
<a name="l00033"></a><a class="code" href="../../d5/d5/statctl_8c.html#a10">00033</a> <span class="keyword">static</span> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d5/d5/statctl_8c.html#a10">rgbType</a>[<a class="code" href="../../d5/d5/statctl_8c.html#a0">IMAGE_STMMAX</a>] = {
00034     SS_BITMAP,       <span class="comment">// IMAGE_BITMAP</span>
00035     SS_ICON,         <span class="comment">// IMAGE_CURSOR</span>
00036     SS_ICON,         <span class="comment">// IMAGE_ICON</span>
00037     SS_ENHMETAFILE   <span class="comment">// IMAGE_ENHMETAFILE</span>
00038 };
00039 
00040 
00041 <span class="comment">/*</span>
00042 <span class="comment"> * LOBYTE of SS_ style is index into this array</span>
00043 <span class="comment"> */</span>
<a name="l00044"></a><a class="code" href="../../d5/d5/statctl_8c.html#a1">00044</a> <span class="preprocessor">#define STK_OWNER       0x00</span>
<a name="l00045"></a><a class="code" href="../../d5/d5/statctl_8c.html#a2">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define STK_IMAGE       0x01</span>
<a name="l00046"></a><a class="code" href="../../d5/d5/statctl_8c.html#a3">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define STK_TEXT        0x02</span>
<a name="l00047"></a><a class="code" href="../../d5/d5/statctl_8c.html#a4">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define STK_GRAPHIC     0x03</span>
<a name="l00048"></a><a class="code" href="../../d5/d5/statctl_8c.html#a5">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define STK_TYPE        0x03</span>
00049 <span class="preprocessor"></span>
<a name="l00050"></a><a class="code" href="../../d5/d5/statctl_8c.html#a6">00050</a> <span class="preprocessor">#define STK_ERASE       0x04</span>
<a name="l00051"></a><a class="code" href="../../d5/d5/statctl_8c.html#a7">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define STK_USEFONT     0x08</span>
<a name="l00052"></a><a class="code" href="../../d5/d5/statctl_8c.html#a8">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define STK_USETEXT     0x10</span>
00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="../../d5/d5/statctl_8c.html#a11">00054</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[] = {
00055     <a class="code" href="../../d5/d5/statctl_8c.html#a3">STK_TEXT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a6">STK_ERASE</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>,       <span class="comment">// SS_LEFT</span>
00056     <a class="code" href="../../d5/d5/statctl_8c.html#a3">STK_TEXT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a6">STK_ERASE</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>,       <span class="comment">// SS_CENTER</span>
00057     <a class="code" href="../../d5/d5/statctl_8c.html#a3">STK_TEXT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a6">STK_ERASE</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>,       <span class="comment">// SS_RIGHT</span>
00058     <a class="code" href="../../d5/d5/statctl_8c.html#a2">STK_IMAGE</a>,                                              <span class="comment">// SS_ICON</span>
00059     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_BLACKRECT</span>
00060     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_GRAYRECT</span>
00061     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_WHITERECT</span>
00062     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_BLACKFRAME</span>
00063     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_GRAYFRAME</span>
00064     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_WHITEFRAME</span>
00065     <a class="code" href="../../d5/d5/statctl_8c.html#a1">STK_OWNER</a>,                                              <span class="comment">// SS_USERITEM</span>
00066     <a class="code" href="../../d5/d5/statctl_8c.html#a3">STK_TEXT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>,                   <span class="comment">// SS_SIMPLE</span>
00067     <a class="code" href="../../d5/d5/statctl_8c.html#a3">STK_TEXT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a6">STK_ERASE</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>,       <span class="comment">// SS_LEFTNOWORDWRAP</span>
00068     <a class="code" href="../../d5/d5/statctl_8c.html#a1">STK_OWNER</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>,                  <span class="comment">// SS_OWNERDRAW</span>
00069     <a class="code" href="../../d5/d5/statctl_8c.html#a2">STK_IMAGE</a>,                                              <span class="comment">// SS_BITMAP</span>
00070     <a class="code" href="../../d5/d5/statctl_8c.html#a2">STK_IMAGE</a> | <a class="code" href="../../d5/d5/statctl_8c.html#a6">STK_ERASE</a>,                                  <span class="comment">// SS_ENHMETAFILE</span>
00071     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_ETCHEDHORZ</span>
00072     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>,                                            <span class="comment">// SS_ETCHEDVERT</span>
00073     <a class="code" href="../../d5/d5/statctl_8c.html#a4">STK_GRAPHIC</a>                                             <span class="comment">// SS_ETCHEDFRAME</span>
00074 };
00075 
<a name="l00076"></a><a class="code" href="../../d5/d5/statctl_8c.html#a12">00076</a> <a class="code" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a> <a class="code" href="../../d5/d5/statctl_8c.html#a12">StaticLookaside</a>;
00077 
00078 <span class="comment">/*</span>
00079 <span class="comment"> * Common macros for image handling.</span>
00080 <span class="comment"> */</span>
<a name="l00081"></a><a class="code" href="../../d5/d5/statctl_8c.html#a9">00081</a> <span class="preprocessor">#define IsValidImage(imageType, realType, max) \</span>
00082 <span class="preprocessor">    ((imageType &lt; max) &amp;&amp; (rgbType[imageType] == realType))</span>
00083 <span class="preprocessor"></span>
00084 
00085 <span class="comment">/***************************************************************************\</span>
00086 <span class="comment">*</span>
00087 <span class="comment">*  SetStaticImage()</span>
00088 <span class="comment">*</span>
00089 <span class="comment">*  Sets bitmap/icon of static guy, either in response to a STM_SETxxxx</span>
00090 <span class="comment">*  message, or at create time.</span>
00091 <span class="comment">*</span>
00092 <span class="comment">\***************************************************************************/</span>
00093 
<a name="l00094"></a><a class="code" href="../../d5/d5/statctl_8c.html#a14">00094</a> HANDLE <a class="code" href="../../d5/d5/statctl_8c.html#a14">xxxSetStaticImage</a>(
00095     <a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a>  pstat,
00096     HANDLE hImage,
00097     BOOL   fDeleteIt)
00098 {
00099     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   bType;
00100     RECT   rc;
00101     RECT   rcWindow;
00102     HANDLE hImageOld;
00103     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  dwRate;
00104     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   cicur;
00105     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fAnimated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00106     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>   pwnd = pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o0">spwnd</a>;
00107     HWND   hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00108 
00109     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00110 
00111     bType = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a717">SFTYPEMASK</a>);
00112 
00113     <span class="comment">/*</span>
00114 <span class="comment">     * If this is an old-ani-icon, then delete its timer.</span>
00115 <span class="comment">     */</span>
00116     <span class="keywordflow">if</span> ((bType == SS_ICON) &amp;&amp; pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o4">cicur</a> &gt; 1) {
00117         <span class="comment">/*</span>
00118 <span class="comment">         *  Old cursor was an animated cursor, so kill</span>
00119 <span class="comment">         *  the timer that is used to animate it.</span>
00120 <span class="comment">         */</span>
00121         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a208">NtUserKillTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a54">IDSYS_STANIMATE</a>);
00122     }
00123 
00124     <span class="comment">/*</span>
00125 <span class="comment">     * Initialize the old-image return value.</span>
00126 <span class="comment">     */</span>
00127     hImageOld = pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>;
00128 
00129     rc.right = rc.bottom = 0;
00130 
00131     <span class="keywordflow">if</span> (hImage != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00132 
00133         <span class="keywordflow">switch</span> (bType) {
00134 
00135             <span class="keywordflow">case</span> SS_ENHMETAFILE: {
00136                 <span class="comment">/*</span>
00137 <span class="comment">                 * We do NOT resize the window.</span>
00138 <span class="comment">                 */</span>
00139                 rc.right  = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right  - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00140                 rc.bottom = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00141                 <span class="keywordflow">break</span>;
00142             }
00143 
00144             <span class="keywordflow">case</span> SS_BITMAP: {
00145 
00146                     BITMAP bmp;
00147 
00148                     <span class="keywordflow">if</span> (GetObject(hImage, <span class="keyword">sizeof</span>(BITMAP), &amp;bmp)) {
00149                         rc.right  = bmp.bmWidth;
00150                         rc.bottom = bmp.bmHeight;
00151                     }
00152                 }
00153                 <span class="keywordflow">break</span>;
00154 
00155             <span class="keywordflow">case</span> SS_ICON: {
00156 
00157                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a106">NtUserGetIconSize</a>(hImage, 0, &amp;rc.right, &amp;rc.bottom);
00158                     rc.bottom /= 2;
00159 
00160                     pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o4">cicur</a> = 0;
00161                     pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a> = 0;
00162 
00163                     <span class="comment">// Perhaps we can do something like shell\cpl\main\mouseptr.c</span>
00164                     <span class="comment">// here, and make GetCursorFrameInfo obsolete.</span>
00165                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/clres_8c.html#a62">GetCursorFrameInfo</a>(hImage, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0, &amp;dwRate, &amp;cicur)) {
00166                         fAnimated = (cicur &gt; 1);
00167                         pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o4">cicur</a> = cicur;
00168                     }
00169                 }
00170                 <span class="keywordflow">break</span>;
00171         }
00172     }
00173 
00174     pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a> = hImage;
00175     pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o2">fDeleteIt</a> = fDeleteIt;
00176 
00177 
00178     <span class="comment">/*</span>
00179 <span class="comment">     *  Resize static to fit.</span>
00180 <span class="comment">     *  Do NOT do this for SS_CENTERIMAGE</span>
00181 <span class="comment">     */</span>
00182     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a720">SFCENTERIMAGE</a>))
00183     {
00184         <span class="comment">/*</span>
00185 <span class="comment">         *  Get current window rect in parent's client coordinates.</span>
00186 <span class="comment">         */</span>
00187         <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">GetRect</a>(pwnd, &amp;rcWindow, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a903">GRECT_WINDOW</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a907">GRECT_PARENTCOORDS</a>);
00188 
00189         <span class="comment">/*</span>
00190 <span class="comment">         * Get new window dimensions</span>
00191 <span class="comment">         */</span>
00192         rc.left = 0;
00193         rc.top = 0;
00194 
00195         <span class="keywordflow">if</span> (rc.right &amp;&amp; rc.bottom) {
00196             <a class="code" href="../../d1/d0/inc_2user_8h.html#a1195">_AdjustWindowRectEx</a>(&amp;rc, pwnd-&gt;style, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, pwnd-&gt;ExStyle);
00197             rc.right  -= rc.left;
00198             rc.bottom -= rc.top;
00199         }
00200 
00201         rc.left = rcWindow.left;
00202         rc.top = rcWindow.top;
00203 
00204         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a115">NtUserSetWindowPos</a>(
00205                 hwnd,
00206                 HWND_TOP,
00207                 0,
00208                 0,
00209                 rc.right,
00210                 rc.bottom,
00211                 SWP_NOMOVE | SWP_NOACTIVATE | SWP_NOZORDER);
00212     }
00213 
00214     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>)) {
00215         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00216         <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a>(hwnd);
00217     }
00218 
00219 
00220     <span class="comment">/*</span>
00221 <span class="comment">     * If this is an aimated-icon, then start the timer for</span>
00222 <span class="comment">     * the animation sequence.</span>
00223 <span class="comment">     */</span>
00224     <span class="keywordflow">if</span>(fAnimated) {
00225         <span class="comment">// Perhaps we can do something like shell\cpl\main\mouseptr.c</span>
00226         <span class="comment">// here, and make GetCursorFrameInfo obsolete.</span>
00227         <a class="code" href="../../d4/d9/clres_8c.html#a62">GetCursorFrameInfo</a>(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a>, &amp;dwRate, &amp;cicur);
00228         dwRate = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(200, dwRate * 100 / 6);
00229         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a230">NtUserSetTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a54">IDSYS_STANIMATE</a>, dwRate, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00230     }
00231 
00232     <span class="keywordflow">return</span> hImageOld;
00233 }
00234 
00235 
00236 <span class="comment">/***************************************************************************\</span>
00237 <span class="comment">*</span>
00238 <span class="comment">*  StaticLoadImage()</span>
00239 <span class="comment">*</span>
00240 <span class="comment">*  Loads the icon or bitmap from the app's resource file if a name was</span>
00241 <span class="comment">*  specified in the dialog template.  We assume that the name is the name</span>
00242 <span class="comment">*  of the resource to load.</span>
00243 <span class="comment">*</span>
00244 <span class="comment">\***************************************************************************/</span>
00245 
<a name="l00246"></a><a class="code" href="../../d5/d5/statctl_8c.html#a15">00246</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d5/statctl_8c.html#a15">xxxStaticLoadImage</a>(
00247     <a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a>  pstat,
00248     LPWSTR lpszName)
00249 {
00250     HANDLE hImage = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00251     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>   pwnd = pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o0">spwnd</a>;
00252 
00253     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00254 
00255     <span class="keywordflow">if</span> (lpszName &amp;&amp; *lpszName) {
00256 
00257         <span class="comment">/*</span>
00258 <span class="comment">         * Only try to load the icon/bitmap if the string is non null.</span>
00259 <span class="comment">         */</span>
00260         <span class="keywordflow">if</span> (*(<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> *)lpszName == 0xFF)
00261             lpszName = MAKEINTRESOURCE(((LPWORD)lpszName)[1]);
00262 
00263         <span class="comment">/*</span>
00264 <span class="comment">         * Load the image.  If it can't be found in the app, try the</span>
00265 <span class="comment">         * display driver.</span>
00266 <span class="comment">         */</span>
00267         <span class="keywordflow">if</span> (lpszName) {
00268 
00269             <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a717">SFTYPEMASK</a>)) {
00270             <span class="keywordflow">case</span> SS_BITMAP:
00271 
00272                 <span class="comment">/*</span>
00273 <span class="comment">                 * If the window is not owned by the server, first call</span>
00274 <span class="comment">                 * back out to the client.</span>
00275 <span class="comment">                 */</span>
00276                 <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a> &amp;&amp; pwnd-&gt;hModule)
00277                     hImage = LoadBitmap(pwnd-&gt;hModule, lpszName);
00278 
00279                 <span class="comment">/*</span>
00280 <span class="comment">                 * If the above didn't load it, try loading it from the</span>
00281 <span class="comment">                 * display driver (hmod == NULL).</span>
00282 <span class="comment">                 */</span>
00283                 <span class="keywordflow">if</span> (hImage == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00284                     hImage = LoadBitmap(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpszName);
00285                 <span class="keywordflow">break</span>;
00286 
00287             <span class="keywordflow">case</span> SS_ICON:
00288                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a722">SFREALSIZEIMAGE</a>)) {
00289                     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a> &amp;&amp; pwnd-&gt;hModule) {
00290                         hImage = LoadImage(pwnd-&gt;hModule, lpszName, IMAGE_ICON, 0, 0, 0);
00291                     }
00292                 } <span class="keywordflow">else</span> {
00293                     <span class="comment">/*</span>
00294 <span class="comment">                     * If the window is not owned by the server, first call</span>
00295 <span class="comment">                     * back out to the client.  Try loading both icons/cursor</span>
00296 <span class="comment">                     * types.</span>
00297 <span class="comment">                     */</span>
00298                     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a> &amp;&amp; pwnd-&gt;hModule) {
00299 
00300                         hImage = LoadIcon(pwnd-&gt;hModule, lpszName);
00301 
00302                         <span class="comment">/*</span>
00303 <span class="comment">                         * We will also try to load a cursor-format if the</span>
00304 <span class="comment">                         * window is a 4.0 compatible.  Icons/Cursors are really</span>
00305 <span class="comment">                         * the same.  We don't do this for 3.x apps for the</span>
00306 <span class="comment">                         * usual compatibility reasons.</span>
00307 <span class="comment">                         */</span>
00308                         <span class="keywordflow">if</span> ((hImage == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00309                             hImage = LoadCursor(pwnd-&gt;hModule, lpszName);
00310                         }
00311                     }
00312 
00313                     <span class="comment">/*</span>
00314 <span class="comment">                     * If the above didn't load it, try loading it from the</span>
00315 <span class="comment">                     * display driver (hmod == NULL).</span>
00316 <span class="comment">                     */</span>
00317                     <span class="keywordflow">if</span> (hImage == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00318                         hImage = LoadIcon(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpszName);
00319                     }
00320                 }
00321 
00322                 <span class="keywordflow">break</span>;
00323             }
00324 
00325             <span class="comment">/*</span>
00326 <span class="comment">             * Set the image if it was loaded.</span>
00327 <span class="comment">             */</span>
00328             <span class="keywordflow">if</span> (hImage)
00329                 <a class="code" href="../../d5/d5/statctl_8c.html#a14">xxxSetStaticImage</a>(pstat, hImage, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00330 
00331         }
00332     }
00333 }
00334 
00335 
00336 <span class="comment">/***************************************************************************\</span>
00337 <span class="comment">* StaticCallback()</span>
00338 <span class="comment">*</span>
00339 <span class="comment">* Draws text statics, called by DrawState.</span>
00340 <span class="comment">*</span>
00341 <span class="comment">* History:</span>
00342 <span class="comment">\***************************************************************************/</span>
00343 
<a name="l00344"></a><a class="code" href="../../d5/d5/statctl_8c.html#a16">00344</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> CALLBACK <a class="code" href="../../d5/d5/statctl_8c.html#a16">StaticCallback</a>(
00345     HDC  hdc,
00346     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00347     BOOL fUnused,
00348     <span class="keywordtype">int</span>  cx,
00349     <span class="keywordtype">int</span>  cy)
00350 {
00351     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   style;
00352     LPWSTR lpszName;
00353     RECT   rc;
00354     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   bType;
00355 
00356     UNREFERENCED_PARAMETER(fUnused);
00357 
00358     bType = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a717">SFTYPEMASK</a>);
00359     UserAssert(<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>);
00360 
00361     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
00362         lpszName = <a class="code" href="../../d6/d0/usercli_8h.html#a26">REBASE</a>(pwnd, strName.Buffer);
00363 
00364         style = DT_NOCLIP | DT_EXPANDTABS;
00365 
00366         <span class="keywordflow">if</span> (bType != <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(SS_LEFTNOWORDWRAP)) {
00367             style |= DT_WORDBREAK;
00368             style |= (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(bType - <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(SS_LEFT));
00369 
00370             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a724">SFEDITCONTROL</a>))
00371                 style |= DT_EDITCONTROL;
00372         }
00373 
00374         <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a725">SFELLIPSISMASK</a>)) {
00375         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(SS_ENDELLIPSIS)):
00376             style |= DT_END_ELLIPSIS | DT_SINGLELINE;
00377             <span class="keywordflow">break</span>;
00378 
00379         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(SS_PATHELLIPSIS)):
00380             style |= DT_PATH_ELLIPSIS | DT_SINGLELINE;
00381             <span class="keywordflow">break</span>;
00382 
00383         <span class="keywordflow">case</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(SS_WORDELLIPSIS)):
00384             style |= DT_WORD_ELLIPSIS | DT_SINGLELINE;
00385             <span class="keywordflow">break</span>;
00386         }
00387 
00388         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a718">SFNOPREFIX</a>))
00389             style |= DT_NOPREFIX;
00390 
00391         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a720">SFCENTERIMAGE</a>))
00392             style |= DT_VCENTER | DT_SINGLELINE;
00393 
00394         rc.left     = 0;
00395         rc.top      = 0;
00396         rc.right    = cx;
00397         rc.bottom   = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00398 
00399         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>)) {
00400             style |= DT_HIDEPREFIX;
00401         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<a class="code" href="../../d3/d7/structtagSTATWND.html">PSTATWND</a>)pwnd)-&gt;pstat-&gt;fPaintKbdCuesOnly) {
00402             style |= DT_PREFIXONLY;
00403         }
00404 
00405         <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a51">DrawTextExW</a>(hdc, lpszName, -1, &amp;rc, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)style, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00406 
00407     }
00408 
00409     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00410 }
00411 
00412 
00413 <span class="comment">/***************************************************************************\</span>
00414 <span class="comment">* xxxStaticPaint</span>
00415 <span class="comment">*</span>
00416 <span class="comment">* History:</span>
00417 <span class="comment">\***************************************************************************/</span>
00418 
<a name="l00419"></a><a class="code" href="../../d5/d5/statctl_8c.html#a17">00419</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d5/statctl_8c.html#a17">xxxStaticPaint</a>(
00420     <a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a> pstat,
00421     HDC   hdc,
00422     BOOL  fClip)
00423 {
00424     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>   pwndParent;
00425     RECT   rc;
00426     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   cmd;
00427     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   bType;
00428     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fFont;
00429     HBRUSH hbrControl;
00430     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   oldAlign;
00431 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00432 <span class="preprocessor"></span>    <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  dwOldLayout=0;
00433 <span class="preprocessor">#endif</span>
00434 <span class="preprocessor"></span>
00435     HANDLE hfontOld = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00436     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o0">spwnd</a>;
00437     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00438 
00439     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00440 
00441     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>))
00442     {
00443         oldAlign = GetTextAlign(hdc);
00444         SetTextAlign(hdc, oldAlign | TA_RTLREADING);
00445     }
00446 
00447     bType = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a717">SFTYPEMASK</a>);
00448     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rc);
00449 
00450     <span class="keywordflow">if</span> (fClip) {
00451         IntersectClipRect(hdc, rc.left, rc.top, rc.right, rc.bottom);
00452     }
00453 
00454     fFont = (<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a>) &amp;&amp; (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o1">hFont</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00455 
00456     <span class="keywordflow">if</span> (fFont) {
00457         hfontOld = SelectObject(hdc, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o1">hFont</a>);
00458     }
00459 
00460 
00461     <span class="comment">/*</span>
00462 <span class="comment">     * Send WM_CTLCOLORSTATIC to all statics (even frames) for 1.03</span>
00463 <span class="comment">     * compatibility.</span>
00464 <span class="comment">     */</span>
00465     SetBkMode(hdc, OPAQUE);
00466     hbrControl = <a class="code" href="../../d6/d0/usercli_8h.html#a235">GetControlBrush</a>(hwnd, hdc, WM_CTLCOLORSTATIC);
00467 
00468 
00469     <span class="comment">/*</span>
00470 <span class="comment">     * Do we erase the background?  We don't for SS_OWNERDRAW</span>
00471 <span class="comment">     * and STK_GRAPHIC kind of things.</span>
00472 <span class="comment">     */</span>
00473     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00474     <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a6">STK_ERASE</a>) &amp;&amp; !pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o6">fPaintKbdCuesOnly</a>) {
00475         <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), hwnd, hdc, hbrControl, &amp;rc);
00476     }
00477 
00478     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(bType)) {
00479     <span class="keywordflow">case</span> SS_ICON:
00480 
00481         <span class="keywordflow">if</span> (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>) {
00482 
00483             <span class="keywordtype">int</span>     cx;
00484             <span class="keywordtype">int</span>     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00485             POINT   pt;
00486 
00487 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00488 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,WEFLAYOUTRTL)) {
00489                 dwOldLayout = SetLayoutWidth(hdc, -1, 0);
00490             }
00491 <span class="preprocessor">#endif</span>
00492 <span class="preprocessor"></span>            <span class="comment">/*</span>
00493 <span class="comment">             * Perform the correct rect-setup.</span>
00494 <span class="comment">             */</span>
00495             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a720">SFCENTERIMAGE</a>)) {
00496 
00497                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a106">NtUserGetIconSize</a>(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a>, &amp;cx, &amp;<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00498                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> &gt;&gt;= 1;
00499 
00500                 rc.left   = (rc.right  - cx) / 2;
00501                 rc.right  = (rc.left   + cx);
00502                 rc.top    = (rc.bottom - <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>) / 2;
00503                 rc.bottom = (rc.top    + <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00504 
00505             } <span class="keywordflow">else</span> {
00506 
00507                 cx = rc.right  - rc.left;
00508                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = rc.bottom - rc.top;
00509             }
00510 
00511 
00512             <span class="comment">/*</span>
00513 <span class="comment">             * Output the icon.  If it's animated, we indicate</span>
00514 <span class="comment">             * the step-frame to output.</span>
00515 <span class="comment">             */</span>
00516             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndParent) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00517                 SetBrushOrgEx(hdc, 0, 0, &amp;pt);
00518             } <span class="keywordflow">else</span> {
00519                 SetBrushOrgEx(
00520                         hdc,
00521                         pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00522                         pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top,
00523                         &amp;pt);
00524             }
00525 
00526             <a class="code" href="../../d3/d8/client_8c.html#a50">DrawIconEx</a>(hdc, rc.left, rc.top, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>, cx, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>,
00527                        pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a>, hbrControl, DI_NORMAL);
00528 
00529             SetBrushOrgEx(hdc, pt.x, pt.y, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00530 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00531 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,WEFLAYOUTRTL)) {
00532                 SetLayoutWidth(hdc, -1, dwOldLayout);
00533             }
00534 <span class="preprocessor">#endif</span>
00535 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
00536 
00537             <span class="comment">/*</span>
00538 <span class="comment">             * Empty!  Need to erase.</span>
00539 <span class="comment">             */</span>
00540             <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), hwnd, hdc, hbrControl, &amp;rc);
00541         }
00542         <span class="keywordflow">break</span>;
00543 
00544     <span class="keywordflow">case</span> SS_BITMAP:
00545 
00546         <span class="keywordflow">if</span> (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>) {
00547 
00548             BITMAP  bmp;
00549             HBITMAP hbmpT;
00550             RECT    rcTmp;
00551             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fErase;
00552 
00553 
00554             <span class="comment">/*</span>
00555 <span class="comment">             * Get the bitmap information.  If this fails, then we</span>
00556 <span class="comment">             * can assume somethings wrong with its format...don't</span>
00557 <span class="comment">             * draw in this case.</span>
00558 <span class="comment">             */</span>
00559             <span class="keywordflow">if</span> (GetObject(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>, <span class="keyword">sizeof</span>(BITMAP), &amp;bmp)) {
00560 
00561                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a720">SFCENTERIMAGE</a>)) {
00562 
00563                     fErase = ((bmp.bmWidth  &lt; rc.right) ||
00564                               (bmp.bmHeight &lt; rc.bottom));
00565 
00566                     rc.left   = (rc.right  - bmp.bmWidth)  &gt;&gt; 1;
00567                     rc.right  = (rc.left   + bmp.bmWidth);
00568                     rc.top    = (rc.bottom - bmp.bmHeight) &gt;&gt; 1;
00569                     rc.bottom = (rc.top    + bmp.bmHeight);
00570 
00571                 } <span class="keywordflow">else</span> {
00572 
00573                     fErase = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00574                 }
00575 
00576                 <span class="comment">/*</span>
00577 <span class="comment">                 * Select in the bitmap and blt it to the client-surface.</span>
00578 <span class="comment">                 */</span>
00579                 RtlEnterCriticalSection(&amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a23">gcsHdc</a>);
00580                 hbmpT = SelectObject(<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a>, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>);
00581                 StretchBlt(hdc, rc.left, rc.top, rc.right-rc.left,
00582                            rc.bottom-rc.top, <a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a>, 0, 0, bmp.bmWidth,
00583                            bmp.bmHeight, SRCCOPY|NOMIRRORBITMAP);
00584 
00585                 <span class="comment">/*</span>
00586 <span class="comment">                 * Only need to erase the background if the image is</span>
00587 <span class="comment">                 * centered and it's smaller than the client-area.</span>
00588 <span class="comment">                 */</span>
00589                 <span class="keywordflow">if</span> (fErase) {
00590 
00591                     HBRUSH hbr;
00592 
00593                     <span class="keywordflow">if</span> (hbr = CreateSolidBrush(GetPixel(<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a>, 0, 0))) {
00594 
00595                         POLYPATBLT PolyData;
00596 
00597                         ExcludeClipRect(hdc, rc.left, rc.top,
00598                                         rc.right, rc.bottom);
00599 
00600                         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rcTmp);
00601 
00602                         PolyData.x  = 0;
00603                         PolyData.y  = 0;
00604                         PolyData.cx = rcTmp.right;
00605                         PolyData.cy = rcTmp.bottom;
00606                         PolyData.BrClr.hbr = hbr;
00607 
00608                         PolyPatBlt(hdc,PATCOPY,&amp;PolyData,1,PPB_BRUSH);
00609 
00610                         DeleteObject(hbr);
00611                     }
00612                 }
00613 
00614                 <span class="keywordflow">if</span> (hbmpT) {
00615                     SelectObject(<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a>, hbmpT);
00616                 }
00617                 RtlLeaveCriticalSection(&amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a23">gcsHdc</a>);
00618             }
00619         }
00620         <span class="keywordflow">break</span>;
00621 
00622     <span class="keywordflow">case</span> SS_ENHMETAFILE:
00623 
00624         <span class="keywordflow">if</span> (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>) {
00625 
00626             RECT rcl;
00627 
00628             rcl.left   = rc.left;
00629             rcl.top    = rc.top;
00630             rcl.right  = rc.right;
00631             rcl.bottom = rc.bottom;
00632 
00633             PlayEnhMetaFile(hdc, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>, &amp;rcl);
00634         }
00635         <span class="keywordflow">break</span>;
00636 
00637     <span class="keywordflow">case</span> SS_OWNERDRAW: {
00638 
00639             DRAWITEMSTRUCT dis;
00640 
00641             dis.CtlType    = ODT_STATIC;
00642             dis.CtlID      = PtrToUlong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
00643             dis.itemAction = ODA_DRAWENTIRE;
00644             dis.itemState  = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>) ? ODS_DISABLED : 0);
00645             dis.hwndItem   = hwnd;
00646             dis.hDC        = hdc;
00647             dis.itemData   = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00648             dis.rcItem     = rc;
00649 
00650             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>)) {
00651                 dis.itemState |= ODS_NOACCEL;
00652             }
00653 
00654             <span class="comment">/*</span>
00655 <span class="comment">             * Send a WM_DRAWITEM message to the parent.</span>
00656 <span class="comment">             */</span>
00657             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), WM_DRAWITEM, (WPARAM)dis.CtlID, (LPARAM)&amp;dis);
00658         }
00659         <span class="keywordflow">break</span>;
00660 
00661     <span class="keywordflow">case</span> SS_LEFT:
00662     <span class="keywordflow">case</span> SS_CENTER:
00663     <span class="keywordflow">case</span> SS_RIGHT:
00664     <span class="keywordflow">case</span> SS_LEFTNOWORDWRAP:
00665 
00666         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
00667 
00668             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> dstFlags;
00669 
00670             dstFlags = DST_COMPLEX;
00671 
00672             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>)) {
00673 <span class="preprocessor">#ifdef LATER</span>
00674 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SLOWMACHINE) &amp;&amp;
00675                    (GetBkColor(hdc)  != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(GRAYTEXT))) {
00676 
00677                     SetTextColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(GRAYTEXT));
00678                 }
00679                 <span class="keywordflow">else</span>
00680 <span class="preprocessor">#endif</span>
00681 <span class="preprocessor"></span>                    dstFlags |= DSS_DISABLED;
00682             }
00683 
00684             DrawState(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(WINDOWTEXT),
00685                 (DRAWSTATEPROC)<a class="code" href="../../d5/d5/statctl_8c.html#a16">StaticCallback</a>,(LPARAM)pwnd, (WPARAM)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00686                 rc.left, rc.top, rc.right - rc.left, rc.bottom - rc.top,
00687                 dstFlags);
00688         }
00689         <span class="keywordflow">break</span>;
00690 
00691     <span class="keywordflow">case</span> SS_SIMPLE: {
00692 
00693             LPWSTR lpName;
00694             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cchName;
00695 
00696 
00697             <span class="comment">/*</span>
00698 <span class="comment">             * The "Simple" bType assumes everything, including the following:</span>
00699 <span class="comment">             *  1. The Text exists and fits on one line.</span>
00700 <span class="comment">             *  2. The Static item is always enabled.</span>
00701 <span class="comment">             *  3. The Static item is never changed to be a shorter string.</span>
00702 <span class="comment">             *  4. The Parent never responds to the CTLCOLOR message</span>
00703 <span class="comment">             */</span>
00704             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
00705                 lpName = <a class="code" href="../../d6/d0/usercli_8h.html#a26">REBASE</a>(pwnd, strName.Buffer);
00706                 cchName = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> / <span class="keyword">sizeof</span>(WCHAR);
00707             } <span class="keywordflow">else</span> {
00708                 lpName = (LPWSTR)<a class="code" href="../../d1/d8/clglobal_8c.html#a13">szNull</a>;
00709                 cchName = 0;
00710             }
00711 
00712             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a718">SFNOPREFIX</a>)) {
00713                 ExtTextOut(hdc, rc.left, rc.top, ETO_OPAQUE | ETO_CLIPPED,
00714                                 &amp;rc, lpName, cchName, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00715             } <span class="keywordflow">else</span> {
00716                 <span class="comment">/*</span>
00717 <span class="comment">                 * Use OPAQUE for speed.</span>
00718 <span class="comment">                 */</span>
00719                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00720                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a623">WEFPUIACCELHIDDEN</a>)) {
00721                     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = DT_HIDEPREFIX;
00722                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o6">fPaintKbdCuesOnly</a>) {
00723                     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = DT_PREFIXONLY;
00724                 } <span class="keywordflow">else</span> {
00725                     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = 0;
00726                 }
00727 
00728                 <a class="code" href="../../d6/d0/usercli_8h.html#a425">PSMTextOut</a>(hdc, rc.left, rc.top,
00729                         lpName, cchName, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>);
00730             }
00731         }
00732         <span class="keywordflow">break</span>;
00733 
00734     <span class="keywordflow">case</span> SS_BLACKFRAME:
00735         cmd = (COLOR_3DDKSHADOW &lt;&lt; 3);
00736         <span class="keywordflow">goto</span> StatFrame;
00737 
00738     <span class="keywordflow">case</span> SS_GRAYFRAME:
00739         cmd = (COLOR_3DSHADOW &lt;&lt; 3);
00740         <span class="keywordflow">goto</span> StatFrame;
00741 
00742     <span class="keywordflow">case</span> SS_WHITEFRAME:
00743         cmd = (COLOR_3DHILIGHT &lt;&lt; 3);
00744 StatFrame:
00745         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc, &amp;rc, 1, cmd);
00746         <span class="keywordflow">break</span>;
00747 
00748     <span class="keywordflow">case</span> SS_BLACKRECT:
00749         hbrControl = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DDKSHADOW);
00750         <span class="keywordflow">goto</span> StatRect;
00751 
00752     <span class="keywordflow">case</span> SS_GRAYRECT:
00753         hbrControl = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DSHADOW);
00754         <span class="keywordflow">goto</span> StatRect;
00755 
00756     <span class="keywordflow">case</span> SS_WHITERECT:
00757         hbrControl = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DHILIGHT);
00758 StatRect:
00759         <a class="code" href="../../d6/d0/usercli_8h.html#a645">PaintRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), hwnd, hdc, hbrControl, &amp;rc);
00760         <span class="keywordflow">break</span>;
00761 
00762     <span class="keywordflow">case</span> SS_ETCHEDFRAME:
00763         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rc, EDGE_ETCHED, BF_RECT);
00764         <span class="keywordflow">break</span>;
00765     }
00766 
00767     <span class="keywordflow">if</span> (hfontOld) {
00768         SelectObject(hdc, hfontOld);
00769     }
00770 
00771     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>)) {
00772         SetTextAlign(hdc, oldAlign);
00773     }
00774 
00775 }
00776 
00777 
00778 <span class="comment">/***************************************************************************\</span>
00779 <span class="comment">*</span>
00780 <span class="comment">*  StaticRepaint()</span>
00781 <span class="comment">*</span>
00782 <span class="comment">\***************************************************************************/</span>
00783 
<a name="l00784"></a><a class="code" href="../../d5/d5/statctl_8c.html#a18">00784</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d5/statctl_8c.html#a18">StaticRepaint</a>(
00785     <a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a> pstat)
00786 {
00787     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o0">spwnd</a>;
00788 
00789     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd)) {
00790 
00791         HDC hdc;
00792         HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00793 
00794         <span class="keywordflow">if</span> (hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(hwnd)) {
00795             <a class="code" href="../../d5/d5/statctl_8c.html#a17">xxxStaticPaint</a>(pstat, hdc, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00796             <a class="code" href="../../d6/d0/usercli_8h.html#a211">NtUserReleaseDC</a>(hwnd, hdc);
00797         }
00798     }
00799 }
00800 
00801 
00802 <span class="comment">/***************************************************************************\</span>
00803 <span class="comment">*</span>
00804 <span class="comment">*  StaticNotifyParent()</span>
00805 <span class="comment">*</span>
00806 <span class="comment">*  Sends WM_COMMAND notification messages.</span>
00807 <span class="comment">*</span>
00808 <span class="comment">\***************************************************************************/</span>
00809 
00810 <span class="comment">// LATER mikeke why do we have multiple versions of notifyparent?</span>
00811 
<a name="l00812"></a><a class="code" href="../../d5/d5/statctl_8c.html#a19">00812</a> LRESULT <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> PASCAL <a class="code" href="../../d5/d5/statctl_8c.html#a19">StaticNotifyParent</a>(
00813     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00814     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent,
00815     <span class="keywordtype">int</span>  nCode)
00816 {
00817     LRESULT lret;
00818     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwndParent;
00819 
00820     UserAssert(pwnd);
00821 
00822     <span class="keywordflow">if</span> (!pwndParent) {
00823         pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00824     }
00825 
00826     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndParent, &amp;tlpwndParent);
00827     lret = <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent), WM_COMMAND,
00828                        MAKELONG(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>), nCode), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
00829     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00830 
00831     <span class="keywordflow">return</span> lret;
00832 }
00833 
00834 <span class="comment">/***************************************************************************\</span>
00835 <span class="comment">* StaticWndProc</span>
00836 <span class="comment">*</span>
00837 <span class="comment">* History:</span>
00838 <span class="comment">\***************************************************************************/</span>
00839 
<a name="l00840"></a><a class="code" href="../../d6/d0/usercli_8h.html#a613">00840</a> LRESULT <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a> <a class="code" href="../../d6/d0/usercli_8h.html#a613">StaticWndProcWorker</a>(
00841     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwnd,
00842     UINT  message,
00843     WPARAM wParam,
00844     LPARAM lParam,
00845     DWORD fAnsi)
00846 {
00847     HWND        hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00848     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        bType;
00849     <a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a>       pstat;
00850     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fInit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00851 
00852     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00853 
00854     <a class="code" href="../../d6/d0/usercli_8h.html#a28">VALIDATECLASSANDSIZE</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a207">FNID_STATIC</a>);
00855     <a class="code" href="../../d6/d0/usercli_8h.html#a29">INITCONTROLLOOKASIDE</a>(&amp;<a class="code" href="../../d5/d5/statctl_8c.html#a12">StaticLookaside</a>, <a class="code" href="../../d1/d7/structtagSTAT.html">STAT</a>, spwnd, 8);
00856 
00857     <span class="comment">/*</span>
00858 <span class="comment">     * If the control is not interested in this message,</span>
00859 <span class="comment">     * pass it to DefWindowProc.</span>
00860 <span class="comment">     */</span>
00861     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a10">FWINDOWMSG</a>(message, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a207">FNID_STATIC</a>))
00862         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, fAnsi);
00863 
00864     <span class="comment">/*</span>
00865 <span class="comment">     * Get the pstat for the given window now since we will use it a lot in</span>
00866 <span class="comment">     * various handlers. This was stored using SetWindowLong(hwnd,0,pstat) when</span>
00867 <span class="comment">     * we initially created the static control.</span>
00868 <span class="comment">     */</span>
00869     pstat = ((<a class="code" href="../../d3/d7/structtagSTATWND.html">PSTATWND</a>)pwnd)-&gt;pstat;
00870 
00871     <span class="comment">/*</span>
00872 <span class="comment">     * Get the control's type</span>
00873 <span class="comment">     */</span>
00874     bType = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a717">SFTYPEMASK</a>);
00875 
00876     <span class="keywordflow">switch</span> (message) {
00877     <span class="keywordflow">case</span> STM_GETICON:
00878         wParam = IMAGE_ICON;
00879 
00880     <span class="keywordflow">case</span> STM_GETIMAGE:
00881         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/btnctl_8c.html#a7">IsValidImage</a>(wParam, bType, <a class="code" href="../../d5/d5/statctl_8c.html#a0">IMAGE_STMMAX</a>)) {
00882             <span class="keywordflow">return</span> (LRESULT)pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>;
00883         }
00884         <span class="keywordflow">break</span>;
00885 
00886     <span class="keywordflow">case</span> STM_SETICON:
00887         lParam = (LPARAM)wParam;
00888         wParam = IMAGE_ICON;
00889 
00890     <span class="keywordflow">case</span> STM_SETIMAGE:
00891         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/btnctl_8c.html#a7">IsValidImage</a>(wParam, bType, <a class="code" href="../../d5/d5/statctl_8c.html#a0">IMAGE_STMMAX</a>)) {
00892             <span class="keywordflow">return</span> (LRESULT)<a class="code" href="../../d5/d5/statctl_8c.html#a14">xxxSetStaticImage</a>(pstat, (HANDLE)lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00893         }
00894         <span class="keywordflow">break</span>;
00895 
00896     <span class="keywordflow">case</span> WM_ERASEBKGND:
00897 
00898         <span class="comment">/*</span>
00899 <span class="comment">         * The control will be erased in xxxStaticPaint().</span>
00900 <span class="comment">         */</span>
00901         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00902 
00903     <span class="keywordflow">case</span> WM_PRINTCLIENT:
00904         <a class="code" href="../../d5/d5/statctl_8c.html#a17">xxxStaticPaint</a>(pstat, (HDC)wParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00905         <span class="keywordflow">break</span>;
00906 
00907     <span class="keywordflow">case</span> WM_PAINT:
00908         {
00909             HDC         hdc;
00910             PAINTSTRUCT ps;
00911 
00912             <span class="keywordflow">if</span> ((hdc = (HDC)wParam) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00913                 hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a246">NtUserBeginPaint</a>(hwnd, &amp;ps);
00914             }
00915 
00916             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd)) {
00917                 <a class="code" href="../../d5/d5/statctl_8c.html#a17">xxxStaticPaint</a>(pstat, hdc, !wParam);
00918             }
00919 
00920             <span class="comment">/*</span>
00921 <span class="comment">             * If hwnd was destroyed, BeginPaint was automatically undone.</span>
00922 <span class="comment">             */</span>
00923             <span class="keywordflow">if</span> (!wParam) {
00924                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a248">NtUserEndPaint</a>(hwnd, &amp;ps);
00925             }
00926         }
00927         <span class="keywordflow">break</span>;
00928 
00929     <span class="keywordflow">case</span> WM_CREATE:
00930 
00931         <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a5">STK_TYPE</a>) == <a class="code" href="../../d5/d5/statctl_8c.html#a2">STK_IMAGE</a>) {
00932             <span class="comment">/*</span>
00933 <span class="comment">             *  Pull the name from LPCREATESTRUCT like Win95 does</span>
00934 <span class="comment">             */</span>
00935             LPWSTR  lpszName;
00936             LPSTR   lpszAnsiName;
00937             <span class="keyword">struct </span>{
00938                 WORD tag;
00939                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> ordLo;
00940                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> ordHi;
00941             } dwUnicodeOrdinal;
00942 
00943             <span class="keywordflow">if</span> (fAnsi) {
00944                 <span class="comment">/*</span>
00945 <span class="comment">                 *  Convert the ANSI string to unicode if it exists</span>
00946 <span class="comment">                 */</span>
00947                 lpszAnsiName = (LPSTR)((LPCREATESTRUCT)lParam)-&gt;lpszName;
00948                 <span class="keywordflow">if</span> (lpszAnsiName) {
00949                     <span class="keywordflow">if</span> (lpszAnsiName[0] == (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)0xff) {
00950                         <span class="comment">/*</span>
00951 <span class="comment">                         * Convert ANSI ordinal to UNICODE ordinal</span>
00952 <span class="comment">                         */</span>
00953                         dwUnicodeOrdinal.tag = 0xFFFF;
00954                         dwUnicodeOrdinal.ordLo = lpszAnsiName[1];
00955                         dwUnicodeOrdinal.ordHi = lpszAnsiName[2];
00956                         lpszName = (LPWSTR)&amp;dwUnicodeOrdinal;
00957                     } <span class="keywordflow">else</span> {
00958                         <a class="code" href="../../d5/d6/chartran_8c.html#a3">MBToWCSEx</a>(0, lpszAnsiName, -1, &amp;lpszName, -1, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00959                     }
00960                 } <span class="keywordflow">else</span> {
00961                     lpszName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00962                 }
00963             } <span class="keywordflow">else</span> {
00964                 lpszName = (LPWSTR)(((LPCREATESTRUCT)lParam)-&gt;lpszName);
00965             }
00966 
00967             <span class="comment">/*</span>
00968 <span class="comment">             *  Load the image</span>
00969 <span class="comment">             */</span>
00970             <a class="code" href="../../d5/d5/statctl_8c.html#a15">xxxStaticLoadImage</a>(pstat, lpszName);
00971 
00972             <span class="keywordflow">if</span> (fAnsi &amp;&amp;
00973                     lpszName &amp;&amp;
00974                     lpszName != (LPWSTR)&amp;dwUnicodeOrdinal) {
00975                 <span class="comment">/*</span>
00976 <span class="comment">                 *  Free the converted ANSI string</span>
00977 <span class="comment">                 */</span>
00978                 LocalFree(lpszName);
00979             }
00980         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bType == SS_ETCHEDHORZ || bType == SS_ETCHEDVERT) {
00981 
00982             <span class="comment">/*</span>
00983 <span class="comment">             * Resize static window to fit edge.  Horizontal dudes</span>
00984 <span class="comment">             * make bottom one edge from top, vertical dudes make</span>
00985 <span class="comment">             * right edge one edge from left.</span>
00986 <span class="comment">             */</span>
00987 
00988             RECT    rcClient;
00989 
00990             <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, &amp;rcClient);
00991             <span class="keywordflow">if</span> (bType == SS_ETCHEDHORZ)
00992                 rcClient.bottom = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00993             <span class="keywordflow">else</span>
00994                 rcClient.right = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00995 
00996             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a115">NtUserSetWindowPos</a>(hwnd, HWND_TOP, 0, 0, rcClient.right,
00997                 rcClient.bottom, SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);
00998         }
00999         <span class="keywordflow">break</span>;
01000 
01001     <span class="keywordflow">case</span> WM_DESTROY:
01002         <span class="keywordflow">if</span> (((<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a5">STK_TYPE</a>) == <a class="code" href="../../d5/d5/statctl_8c.html#a2">STK_IMAGE</a>) &amp;&amp;
01003             (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)                  &amp;&amp;
01004             (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o2">fDeleteIt</a>)) {
01005 
01006             <span class="keywordflow">if</span> (bType == SS_BITMAP) {
01007                 DeleteObject(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>);
01008             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bType == SS_ICON) {
01009                 <span class="keywordflow">if</span> (pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o4">cicur</a> &gt; 1) {
01010                     <span class="comment">/*</span>
01011 <span class="comment">                     *  Kill the animated cursor timer</span>
01012 <span class="comment">                     */</span>
01013                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a208">NtUserKillTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a54">IDSYS_STANIMATE</a>);
01014                 }
01015                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a156">NtUserDestroyCursor</a>((HCURSOR)(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a532">CURSOR_CALLFROMCLIENT</a>);
01016             }
01017         }
01018         <span class="keywordflow">break</span>;
01019 
01020     <span class="keywordflow">case</span> WM_NCCREATE:
01021         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a624">WEFRIGHT</a>)) {
01022             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a285">NtUserAlterWindowStyle</a>(hwnd, SS_TYPEMASK, SS_RIGHT);
01023         }
01024 
01025         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a723">SFSUNKEN</a>) ||
01026             ((bType == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(SS_ETCHEDHORZ)) || (bType == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(SS_ETCHEDVERT)))) {
01027             <a class="code" href="../../d4/d1/userk_8h.html#a1628">SetWindowState</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a628">WEFSTATICEDGE</a>);
01028         }
01029         <span class="keywordflow">goto</span> CallDWP;
01030 
01031     <span class="keywordflow">case</span> WM_NCDESTROY:
01032     <span class="keywordflow">case</span> WM_FINALDESTROY:
01033         <span class="keywordflow">if</span> (pstat) {
01034             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o0">spwnd</a>);
01035             <a class="code" href="../../d6/d0/usercli_8h.html#a408">FreeLookasideEntry</a>(&amp;<a class="code" href="../../d5/d5/statctl_8c.html#a12">StaticLookaside</a>, pstat);
01036         }
01037         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a284">NtUserSetWindowFNID</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>);
01038         <span class="keywordflow">break</span>;
01039 
01040     <span class="keywordflow">case</span> WM_NCHITTEST:
01041         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a719">SFNOTIFY</a>) ? HTCLIENT : HTTRANSPARENT);
01042 
01043     <span class="keywordflow">case</span> WM_LBUTTONDOWN:
01044     <span class="keywordflow">case</span> WM_NCLBUTTONDOWN:
01045         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a719">SFNOTIFY</a>)) {
01046 
01047             <span class="comment">/*</span>
01048 <span class="comment">             * It is acceptable for an app to destroy a static label</span>
01049 <span class="comment">             * in response to a STN_CLICKED notification.</span>
01050 <span class="comment">             */</span>
01051             <a class="code" href="../../d5/d5/statctl_8c.html#a19">StaticNotifyParent</a>(pwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, STN_CLICKED);
01052         }
01053         <span class="keywordflow">break</span>;
01054 
01055     <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
01056     <span class="keywordflow">case</span> WM_NCLBUTTONDBLCLK:
01057         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a719">SFNOTIFY</a>)) {
01058 
01059             <span class="comment">/*</span>
01060 <span class="comment">             * It is acceptable for an app to destroy a static label in</span>
01061 <span class="comment">             * response to a STN_DBLCLK notification.</span>
01062 <span class="comment">             */</span>
01063             <a class="code" href="../../d5/d5/statctl_8c.html#a19">StaticNotifyParent</a>(pwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, STN_DBLCLK);
01064         }
01065         <span class="keywordflow">break</span>;
01066 
01067     <span class="keywordflow">case</span> WM_SETTEXT:
01068         <span class="comment">/*</span>
01069 <span class="comment">         *  No more hack to set icon/bitmap via WM_SETTEXT!</span>
01070 <span class="comment">         */</span>
01071         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a8">STK_USETEXT</a>) {
01072             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a622">_DefSetText</a>(hwnd, (LPWSTR)lParam, fAnsi)) {
01073                 <a class="code" href="../../d5/d5/statctl_8c.html#a18">StaticRepaint</a>(pstat);
01074                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01075             }
01076         }
01077         <span class="keywordflow">break</span>;
01078 
01079     <span class="keywordflow">case</span> WM_ENABLE:
01080         <a class="code" href="../../d5/d5/statctl_8c.html#a18">StaticRepaint</a>(pstat);
01081         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a719">SFNOTIFY</a>)) {
01082             <a class="code" href="../../d5/d5/statctl_8c.html#a19">StaticNotifyParent</a>(pwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (wParam ? STN_ENABLE : STN_DISABLE));
01083         }
01084         <span class="keywordflow">break</span>;
01085 
01086     <span class="keywordflow">case</span> WM_GETDLGCODE:
01087         <span class="keywordflow">return</span> (LONG)DLGC_STATIC;
01088 
01089     <span class="keywordflow">case</span> WM_SETFONT:
01090 
01091         <span class="comment">/*</span>
01092 <span class="comment">         * wParam - handle to the font</span>
01093 <span class="comment">         * lParam - if true, redraw else don't</span>
01094 <span class="comment">         */</span>
01095         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a>) {
01096 
01097             pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o1">hFont</a> = (HANDLE)wParam;
01098 
01099             <span class="keywordflow">if</span> (lParam &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>)) {
01100                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01101                 <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a>(hwnd);
01102             }
01103         }
01104         <span class="keywordflow">break</span>;
01105 
01106     <span class="keywordflow">case</span> WM_GETFONT:
01107         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/statctl_8c.html#a11">rgstk</a>[bType] &amp; <a class="code" href="../../d5/d5/statctl_8c.html#a7">STK_USEFONT</a>) {
01108             <span class="keywordflow">return</span> (LRESULT)pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o1">hFont</a>;
01109         }
01110         <span class="keywordflow">break</span>;
01111 
01112     <span class="keywordflow">case</span> WM_TIMER:
01113         <span class="keywordflow">if</span> (wParam == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a54">IDSYS_STANIMATE</a>) {
01114             <a class="code" href="../../d5/d5/statctl_8c.html#a13">xxxNextAniIconStep</a>(pstat);
01115         }
01116         <span class="keywordflow">break</span>;
01117 
01118     <span class="comment">/*</span>
01119 <span class="comment">     *  case WM_GETTEXT:</span>
01120 <span class="comment">     *  No more hack to get icon/bitmap via WM_GETTEXT!</span>
01121 <span class="comment">     */</span>
01122 
01123     <span class="keywordflow">case</span> WM_INPUTLANGCHANGEREQUEST:
01124         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a128">IS_MIDEAST_ENABLED</a>()) {
01125             <span class="comment">/*</span>
01126 <span class="comment">             * #115190</span>
01127 <span class="comment">             * If the window is one of controls on top of dialogbox,</span>
01128 <span class="comment">             * let the parent dialog handle it.</span>
01129 <span class="comment">             */</span>
01130             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>) {
01131                 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, spwndParent);
01132                 <span class="keywordflow">if</span> (pwndParent) {
01133                     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pclsParent = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwndParent, pcls);
01134 
01135                     UserAssert(pclsParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01136                     <span class="keywordflow">if</span> (pclsParent-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a76">ICLS_DIALOG</a>]) {
01137                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwndParent, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01138                     }
01139                 }
01140             }
01141         }
01142         <span class="keywordflow">goto</span> CallDWP;
01143 
01144     <span class="keywordflow">case</span> WM_UPDATEUISTATE:
01145         {
01146             <span class="comment">/*</span>
01147 <span class="comment">             * DWP will change the UIState bits accordingly</span>
01148 <span class="comment">             */</span>
01149             <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, fAnsi);
01150 
01151             <span class="keywordflow">if</span> (HIWORD(wParam) &amp; UISF_HIDEACCEL) {
01152                 <span class="comment">/*</span>
01153 <span class="comment">                 * Change in AccelHidden state: need to repaint</span>
01154 <span class="comment">                 */</span>
01155                 <span class="keywordflow">if</span> (ISSSTEXTOROD(bType)) {
01156                     pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o6">fPaintKbdCuesOnly</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01157                     <a class="code" href="../../d5/d5/statctl_8c.html#a18">StaticRepaint</a>(pstat);
01158                     pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o6">fPaintKbdCuesOnly</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01159                 }
01160             }
01161         }
01162         <span class="keywordflow">break</span>;
01163 
01164     <span class="keywordflow">default</span>:
01165 CallDWP:
01166         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, message, wParam, lParam, fAnsi);
01167     }
01168 
01169     <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01170 }
01171 
01172 
<a name="l01173"></a><a class="code" href="../../d6/d0/usercli_8h.html#a584">01173</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a584">StaticWndProcA</a>(
01174     HWND hwnd,
01175     UINT message,
01176     WPARAM wParam,
01177     LPARAM lParam)
01178 {
01179     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
01180 
01181     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01182         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01183     }
01184 
01185     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a613">StaticWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01186 }
01187 
<a name="l01188"></a><a class="code" href="../../d6/d0/usercli_8h.html#a585">01188</a> LRESULT WINAPI <a class="code" href="../../d6/d0/usercli_8h.html#a585">StaticWndProcW</a>(
01189     HWND hwnd,
01190     UINT message,
01191     WPARAM wParam,
01192     LPARAM lParam)
01193 {
01194     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
01195 
01196     <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01197         <span class="keywordflow">return</span> (0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01198     }
01199 
01200     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a613">StaticWndProcWorker</a>(pwnd, message, wParam, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01201 }
01202 
01203 <span class="comment">/***************************************************************************\</span>
01204 <span class="comment">* Next Animated Icon Step</span>
01205 <span class="comment">*</span>
01206 <span class="comment">* Advances to the next step in an animaged icon.</span>
01207 <span class="comment">*</span>
01208 <span class="comment">*</span>
01209 <span class="comment">\***************************************************************************/</span>
01210 
<a name="l01211"></a><a class="code" href="../../d5/d5/statctl_8c.html#a13">01211</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d5/d5/statctl_8c.html#a13">xxxNextAniIconStep</a>(
01212     <a class="code" href="../../d1/d7/structtagSTAT.html">PSTAT</a> pstat)
01213 {
01214     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRate;
01215     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o0">spwnd</a>;
01216     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
01217 
01218     <span class="comment">/*</span>
01219 <span class="comment">     * Stop the timer for the next animation step.</span>
01220 <span class="comment">     */</span>
01221     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a208">NtUserKillTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a54">IDSYS_STANIMATE</a>);
01222 
01223     <span class="keywordflow">if</span> (++(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a>) &gt;= pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o4">cicur</a>) {
01224         pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a> = 0;
01225     }
01226 
01227     <span class="comment">// Perhaps we can do something like shell\cpl\main\mouseptr.c</span>
01228     <span class="comment">// here, and make GetCursorFrameInfo obsolete.</span>
01229     <a class="code" href="../../d4/d9/clres_8c.html#a62">GetCursorFrameInfo</a>(pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o3">hImage</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o5">iicur</a>, &amp;dwRate, &amp;pstat-&gt;<a class="code" href="../../d1/d7/structtagSTAT.html#o4">cicur</a>);
01230     dwRate = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(200, dwRate * 100 / 6);
01231 
01232     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(hwnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01233     <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a>(hwnd);
01234 
01235     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a230">NtUserSetTimer</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a54">IDSYS_STANIMATE</a>, dwRate, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01236 }
01237 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:52 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
