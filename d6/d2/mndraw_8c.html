<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mndraw.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mndraw.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d7/d1/mndraw_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a0">SRCSTENCIL</a>&nbsp;&nbsp;&nbsp;0x00B8074AL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a1">MENU_STRLEN</a>&nbsp;&nbsp;&nbsp;255</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>__inline BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a2">MNIsCachedBmpOnly</a> (<a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a3">mnDrawHilite</a> (<a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a4">MNDrawMenu3DHotTracking</a> (HDC hdc, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a5">MNDrawArrow</a> (HDC hdcIn, <a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> ppopup, UINT uArrow)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a6">MNDrawFullNC</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdcIn, <a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> ppopup)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a7">MNEraseBackground</a> (HDC hdc, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu, int x, int y, int cx, int <a class="el" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a8">MNAnimate</a> (<a class="el" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a> pMenuState, BOOL fIterate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a9">DrawMenuItemCheckMark</a> (HDC hdc, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem, int xPos)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a10">xxxDrawItemUnderline</a> (<a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem, HDC hdc, int xLeft, int yTop, LPWSTR pszMenu, LONG lResLo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a11">xxxDrawMenuItemText</a> (<a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem, HDC hdc, int xLeft, int yTop, LPWSTR lpsz, int cch, BOOL fShowUnderlines)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a12">xxxSendMenuDrawItemMessage</a> (HDC hdc, UINT itemAction, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem, BOOL fBitmap, int iOffset)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a13">CalcbfExtra</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a14">MNDrawInsertionBar</a> (HDC hdc, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a15">xxxDrawMenuItem</a> (HDC hdc, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a16">SetupFakeMDIAppStuff</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> lpMenu, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> lpItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a17">xxxRealDrawMenuItem</a> (HDC hdc, <a class="el" href="../../d3/d0/structGRAYMENU.html">PGRAYMENU</a> pGray, int cx, int <a class="el" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a18">xxxMenuBarDraw</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdc, int cxFrame, int cyFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a19">xxxMenuDraw</a> (HDC hdc, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a20">xxxDrawMenuBar</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a21">xxxMNInvertItem</a> (<a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> ppopupmenu, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu, int itemNumber, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndNotify, BOOL fOn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a22">xxxDrawMenuBarTemp</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdc, LPRECT lprc, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, HFONT hfont)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/mndraw_8c.html#a23">xxxDrawMenuBarUnderlines</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fShow)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="mndraw.c::MENU_STRLEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MENU_STRLEN&nbsp;&nbsp;&nbsp;255          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00019">19</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l02082">xxxDrawMenuBarUnderlines()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00565">xxxDrawMenuItemText()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mndraw.c::SRCSTENCIL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SRCSTENCIL&nbsp;&nbsp;&nbsp;0x00B8074AL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00017">17</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a13" doxytag="mndraw.c::CalcbfExtra" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline UINT CalcbfExtra           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00675">675</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00204">SYSRGB</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01534">xxxMenuDraw()</a>.
<p>
<pre class="fragment"><div>00676 {
00677 <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>)) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DSHADOW) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>)))
00678         <span class="keywordflow">return</span> BF_FLAT | BF_MONO;
00679     <span class="keywordflow">else</span>
00680         <span class="keywordflow">return</span> 0;
00681 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="mndraw.c::DrawMenuItemCheckMark" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DrawMenuItemCheckMark           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xPos</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00409">409</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00019">BC_INVERT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00029">BC_NOMIRROR</a>, <a class="el" href="../../d9/d1/mngray_8c-source.html#l00448">BltColor()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01020">tagOEMBITMAPINFO::cx</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01021">tagOEMBITMAPINFO::cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00494">ghdcMem2</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02607">tagITEM::hbmpChecked</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02608">tagITEM::hbmpUnchecked</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02103">tagDISPLAYINFO::hdcGray</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01023">OBI_MENUBULLET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01022">OBI_MENUCHECK</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00016">SRCSTENCIL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01018">tagOEMBITMAPINFO::x</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01019">tagOEMBITMAPINFO::y</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00410 {
00411     <span class="keywordtype">int</span>     yCenter;
00412     HBITMAP hbm;
00413     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   textColorSave;
00414     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   bkColorSave;
00415     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fChecked;
00416     <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a>  pOem;
00417     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00418     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = <a class="code" href="../../d9/d2/mngrayc_8c.html#a3">BC_INVERT</a>;
00419 
00420     UserAssert(hdc != ghdcMem2);
00421     pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>;
00422     yCenter = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>;
00423     <span class="keywordflow">if</span> (yCenter &lt; 0)
00424         yCenter = 0;
00425     yCenter /= 2;
00426 
00427     fChecked = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_CHECKED);
00428 
00429     <span class="keywordflow">if</span> (hbm = (fChecked) ? pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o4">hbmpChecked</a> : pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o5">hbmpUnchecked</a>) {
00430         HBITMAP hbmSave;
00431 
00432         <span class="comment">// Use the app supplied bitmaps.</span>
00433         <span class="keywordflow">if</span> (hbmSave = GreSelectBitmap(ghdcMem2, hbm)) {
00434 
00435             textColorSave = GreSetTextColor(hdc, 0x00000000L);
00436             bkColorSave   = GreSetBkColor  (hdc, 0x00FFFFFFL);
00437 
00438             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER))
00439                 xPos = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>;
00440 
00441             GreBitBlt(hdc,
00442                       xPos,
00443                       yCenter,
00444                       pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>,
00445                       pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
00446                       ghdcMem2,
00447                       0,
00448                       0,
00449                       SRCSTENCIL,
00450                       0x00FFFFFF);
00451 
00452             GreSetTextColor(hdc, textColorSave);
00453             GreSetBkColor(hdc, bkColorSave);
00454 
00455             GreSelectBitmap(ghdcMem2, hbmSave);
00456         }
00457 
00458     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fChecked) {
00459 
00460         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RADIOCHECK))
00461             pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a331">OBI_MENUBULLET</a>;
00462 
00463         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER))
00464             xPos = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>;
00465 
00466 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00467 <span class="preprocessor"></span>        <span class="comment">// 389917: Mirror active menu's check mark if hdc is mirroed.</span>
00468         <span class="keywordflow">if</span> ((GreGetLayout(hdc) &amp; LAYOUT_RTL) &amp;&amp; (hdc != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o5">hdcGray</a>)) {
00469             <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a3">BC_NOMIRROR</a>;
00470         }
00471 <span class="preprocessor">#endif</span>
00472 <span class="preprocessor"></span>        <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdc,
00473                  NULL,
00474                  <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
00475                  xPos,
00476                  yCenter,
00477                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>,
00478                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
00479                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>,
00480                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>,
00481                  dwFlags);
00482     } <span class="keywordflow">else</span> {
00483         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00484     }
00485 
00486     <span class="keywordflow">return</span> fRet;
00487 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="mndraw.c::MNAnimate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MNAnimate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenuState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fIterate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00290">290</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d1/timers_8c-source.html#l00414">_KillTimer()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03510">CMS_QANIMATION</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03246">tagMENUSTATE::cxAni</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03247">tagMENUSTATE::cyAni</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03243">tagMENUSTATE::dwAniStartTime</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02133">ExGetExclusiveWaiterCount()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02160">ExGetSharedWaiterCount()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06746">FADE_MENU</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00309">gcxMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00310">gcyMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00757">gpresUser</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03242">tagMENUSTATE::hdcWndAni</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03221">tagMENUSTATE::iAniDropDir</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00304">IDSYS_MNANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03244">tagMENUSTATE::ixAni</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03245">tagMENUSTATE::iyAni</a>, <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00414">MNDestroyAnimationBitmap()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04812">PAS_HORZ</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04808">PAS_LEFT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04810">PAS_UP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04813">PAS_VERT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03201">tagMENUSTATE::pGlobalPopupMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02893">tagPOPUPMENU::spwndActivePopup</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00918">StopFade()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06754">TestFadeFlags()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/mnchange_8c-source.html#l01027">MNGetPopupFromMenu()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02517">xxxMNCloseHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02818">xxxMNSelectItem()</a>, and <a class="el" href="../../d3/d2/mnpopup_8c-source.html#l00052">xxxTrackPopupMenuEx()</a>.
<p>
<pre class="fragment"><div>00291 {
00292     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwTimeElapsed;
00293     <span class="keywordtype">int</span>     x, y, xOff, yOff, xLast, yLast;
00294 
00295     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1982">TestFadeFlags</a>(FADE_MENU)) {
00296         <span class="keywordflow">if</span> (!fIterate) {
00297             <a class="code" href="../../d8/d4/sprite_8c.html#a22">StopFade</a>();
00298         }
00299         <span class="keywordflow">return</span>;
00300     }
00301 
00302     <span class="comment">/*</span>
00303 <span class="comment">     * If we're not animating, bail</span>
00304 <span class="comment">     */</span>
00305     <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o34">hdcWndAni</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00306         <span class="keywordflow">return</span>;
00307     }
00308 
00309     <span class="comment">/*</span>
00310 <span class="comment">     * The active popup must be visible. It's supposed to be the</span>
00311 <span class="comment">     *  window we're animating</span>
00312 <span class="comment">     */</span>
00313     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o31">spwndActivePopup</a>, WFVISIBLE));
00314 
00315     <span class="comment">/*</span>
00316 <span class="comment">     * End animation if asked to do so, if it's taking too long</span>
00317 <span class="comment">     *  or someone is waiting for the critical section</span>
00318 <span class="comment">     */</span>
00319     dwTimeElapsed = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>() - pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o35">dwAniStartTime</a>;
00320     <span class="keywordflow">if</span> (!fIterate
00321             || (dwTimeElapsed &gt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a916">CMS_QANIMATION</a>)
00322             || (<a class="code" href="../../d5/d8/ex_8h.html#a278">ExGetExclusiveWaiterCount</a>(gpresUser) &gt; 0)
00323             || (<a class="code" href="../../d5/d8/ex_8h.html#a279">ExGetSharedWaiterCount</a>(gpresUser) &gt; 0)) {
00324 
00325         GreBitBlt(pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o34">hdcWndAni</a>, 0, 0, pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o38">cxAni</a>, pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o39">cyAni</a>, pMenuState-&gt;hdcAni,
00326             0, 0, SRCCOPY | NOMIRRORBITMAP, 0xFFFFFF);
00327 
00328         <span class="keywordflow">goto</span> AnimationCompleted;
00329     }
00330 
00331     <span class="comment">/*</span>
00332 <span class="comment">     * Remember current animation point and calculate new one</span>
00333 <span class="comment">     */</span>
00334     xLast = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a>;
00335     yLast = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a>;
00336     <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o20">iAniDropDir</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a542">PAS_HORZ</a>) {
00337         pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(gcxMenuFontChar, dwTimeElapsed, CMS_QANIMATION / 20);
00338         <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a> &gt; pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o38">cxAni</a>) {
00339             pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a> = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o38">cxAni</a>;
00340         }
00341     }
00342 
00343     <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o20">iAniDropDir</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a543">PAS_VERT</a>) {
00344         pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(gcyMenuFontChar, dwTimeElapsed, CMS_QANIMATION / 10);
00345         <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a> &gt; pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o39">cyAni</a>) {
00346             pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a> = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o39">cyAni</a>;
00347         }
00348     }
00349 
00350      <span class="comment">/*</span>
00351 <span class="comment">      * if no change -- bail out</span>
00352 <span class="comment">      */</span>
00353     <span class="keywordflow">if</span> ((pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a> == xLast) &amp;&amp; (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a> == yLast)) {
00354         <span class="keywordflow">return</span>;
00355     }
00356 
00357     <span class="comment">/*</span>
00358 <span class="comment">     * Calculate source and dest coordinates</span>
00359 <span class="comment">     */</span>
00360     <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o20">iAniDropDir</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a538">PAS_LEFT</a>) {
00361         x = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o38">cxAni</a> - pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a>;
00362         xOff = 0;
00363     } <span class="keywordflow">else</span> {
00364         xOff = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o38">cxAni</a> - pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a>;
00365         x = 0;
00366     }
00367 
00368     <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o20">iAniDropDir</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a540">PAS_UP</a>) {
00369         y = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o39">cyAni</a> - pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a>;
00370         yOff = 0;
00371     } <span class="keywordflow">else</span> {
00372         yOff = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o39">cyAni</a> - pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a>;
00373         y = 0;
00374     }
00375 
00376     <span class="comment">/*</span>
00377 <span class="comment">     * Do it</span>
00378 <span class="comment">     */</span>
00379     GreBitBlt(pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o34">hdcWndAni</a>, x, y, pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a>, pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a>,
00380               pMenuState-&gt;hdcAni, xOff, yOff, SRCCOPY | NOMIRRORBITMAP, 0xFFFFFF);
00381 
00382     <span class="comment">/*</span>
00383 <span class="comment">     * Check if we're done</span>
00384 <span class="comment">     */</span>
00385     <span class="keywordflow">if</span> ((pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o38">cxAni</a> == pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o36">ixAni</a>)
00386             &amp;&amp; (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o39">cyAni</a> == pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o37">iyAni</a>)) {
00387 
00388 AnimationCompleted:
00389 
00390         <a class="code" href="../../d4/d1/userk_8h.html#a1349">MNDestroyAnimationBitmap</a>(pMenuState);
00391         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o34">hdcWndAni</a>);
00392         pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o34">hdcWndAni</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00393         <a class="code" href="../../d4/d1/userk_8h.html#a1720">_KillTimer</a>(pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o31">spwndActivePopup</a>, IDSYS_MNANIMATE);
00394     }
00395 
00396 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mndraw.c::MNDrawArrow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MNDrawArrow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ppopup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uArrow</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00102">102</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00029">BitBltSysBmp()</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00729">DrawFrameControl()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02806">tagMENU::dwArrowsOn</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00314">gcyMenuScrollArrow</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02764">MFMWFP_UPARROW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02630">MSA_ATBOTTOM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02629">MSA_ATTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02627">MSA_OFF</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01027">OBI_MENUARROWDOWN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01024">OBI_MENUARROWUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01022">OBI_MENUCHECK</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02881">tagPOPUPMENU::spmenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02868">tagPOPUPMENU::spwndPopupMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00181">MNDrawFullNC()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01697">xxxMNInvertItem()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00495">xxxMNSetTop()</a>.
<p>
<pre class="fragment"><div>00103 {
00104     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwnd = ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o26">spwndPopupMenu</a>;
00105     HDC     hdc;
00106     <span class="keywordtype">int</span>     x, y;
00107     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwBmp;
00108     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwAtCheck;
00109     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwState;
00110 
00111     <span class="keywordflow">if</span> (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a759">MSA_OFF</a>) {
00112         <span class="keywordflow">return</span>;
00113     }
00114 
00115     <span class="keywordflow">if</span> (hdcIn == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00116         hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_USESTYLE | DCX_WINDOW | DCX_LOCKWINDOWUPDATE);
00117     } <span class="keywordflow">else</span> {
00118         hdc = hdcIn;
00119     }
00120 
00121     x = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
00122     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>, MNS_NOCHECK)) {
00123        <span class="comment">/*</span>
00124 <span class="comment">        * Win9x:  x += MNByteAlignItem(oemInfo.bm[OBI_MENUCHECK].cx);</span>
00125 <span class="comment">        */</span>
00126         x += <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>].cx;
00127     } <span class="keywordflow">else</span> {
00128         x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) * 2;
00129     }
00130 
00131     <span class="keywordflow">if</span> (uArrow == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a779">MFMWFP_UPARROW</a>) {
00132         y = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
00133         dwBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a332">OBI_MENUARROWUP</a>;
00134         dwAtCheck = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a761">MSA_ATTOP</a>;
00135         dwState = DFCS_MENUARROWUP;
00136     } <span class="keywordflow">else</span> {
00137         y = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME) - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a144">gcyMenuScrollArrow</a>;
00138         dwBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a335">OBI_MENUARROWDOWN</a>;
00139         dwAtCheck = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a762">MSA_ATBOTTOM</a>;
00140         dwState = DFCS_MENUARROWDOWN;
00141     }
00142 
00143     <span class="keywordflow">if</span> (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> == dwAtCheck) {
00144         <span class="comment">/*</span>
00145 <span class="comment">         * go 2 ahead to inactive state bitmap</span>
00146 <span class="comment">         */</span>
00147         dwBmp += 2;
00148         dwState |= DFCS_INACTIVE;
00149     }
00150 
00151     <span class="keywordflow">if</span> (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00152         <span class="comment">/*</span>
00153 <span class="comment">         * for menus with background brushes, we can't do a straight blt</span>
00154 <span class="comment">         * of the scroll arrows 'cause the background wouldn't be right;</span>
00155 <span class="comment">         * need to call DrawFrameControl with DFCS_TRANSPARENT instead</span>
00156 <span class="comment">         */</span>
00157         RECT rc;
00158         rc.top = y;
00159         rc.left = x;
00160         rc.right  = x + <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a332">OBI_MENUARROWUP</a>].cx;
00161         rc.bottom = y + <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a332">OBI_MENUARROWUP</a>].cy;
00162         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a14">DrawFrameControl</a>(hdc, &amp;rc, DFC_MENU, dwState | DFCS_TRANSPARENT);
00163     } <span class="keywordflow">else</span> {
00164         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, x, y, dwBmp);
00165         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, x, y, dwBmp);
00166     }
00167 
00168     <span class="keywordflow">if</span> (hdcIn == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00169         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00170     }
00171 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="mndraw.c::MNDrawFullNC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MNDrawFullNC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ppopup</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00181">181</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00719">DF_3DFACE</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00896">DrawEdge()</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l01188">DrawFrame()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00314">gcyMenuScrollArrow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02765">MFMWFP_DOWNARROW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02764">MFMWFP_UPARROW</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00102">MNDrawArrow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04743">MNGetToppItem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02881">tagPOPUPMENU::spmenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00495">xxxMNSetTop()</a>.
<p>
<pre class="fragment"><div>00182 {
00183     RECT rc;
00184     HDC hdc;
00185     HBRUSH hbrOld;
00186     <span class="keywordtype">int</span> yTop, yBottom;
00187     POINT ptOrg;
00188     <span class="keywordflow">if</span> (hdcIn == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00189         hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_USESTYLE | DCX_WINDOW | DCX_LOCKWINDOWUPDATE);
00190     } <span class="keywordflow">else</span> {
00191         hdc = hdcIn;
00192     }
00193 
00194     rc.left = rc.top = 0;
00195     rc.right = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00196     rc.bottom = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00197     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rc, EDGE_RAISED, (BF_RECT | BF_ADJUST));
00198     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc, &amp;rc, 1, DF_3DFACE);
00199     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rc, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00200 
00201     yTop = rc.top;
00202     yBottom = rc.bottom - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a144">gcyMenuScrollArrow</a>;
00203 
00204     GreGetBrushOrg(hdc, &amp;ptOrg);
00205     <span class="keywordflow">if</span> (ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00206         GreSetBrushOrg(hdc, 0,
00207                 -(<span class="keywordtype">int</span>)<a class="code" href="../../d4/d1/userk_8h.html#a1324">MNGetToppItem</a>(ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>)-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>, NULL);
00208         hbrOld = GreSelectBrush(hdc, ppopup-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a>);
00209     } <span class="keywordflow">else</span> {
00210         hbrOld = GreSelectBrush(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>));
00211     }
00212 
00213     rc.right -= rc.left;
00214     GrePatBlt(hdc, rc.left, yTop, rc.right, gcyMenuScrollArrow, PATCOPY);
00215     <a class="code" href="../../d4/d1/userk_8h.html#a1341">MNDrawArrow</a>(hdc, ppopup, MFMWFP_UPARROW);
00216     GrePatBlt(hdc, rc.left, yBottom, rc.right, gcyMenuScrollArrow, PATCOPY);
00217     <a class="code" href="../../d4/d1/userk_8h.html#a1341">MNDrawArrow</a>(hdc, ppopup, MFMWFP_DOWNARROW);
00218 
00219     GreSetBrushOrg(hdc, ptOrg.x, ptOrg.y, NULL);
00220     GreSelectBrush(hdc, hbrOld);
00221 
00222     <span class="keywordflow">if</span> (hdcIn == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00223         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00224     }
00225 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mndraw.c::mnDrawHilite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL mnDrawHilite           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pItem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00039">39</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00025">MNIsCachedBmpOnly()</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01697">xxxMNInvertItem()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00617">xxxSendMenuDrawItemMessage()</a>.
<p>
<pre class="fragment"><div>00040 {
00041     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HILITE)
00042             &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_GAPDROP)
00043             &amp;&amp; !<a class="code" href="../../d6/d2/mndraw_8c.html#a2">MNIsCachedBmpOnly</a>(pItem);
00044 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="mndraw.c::MNDrawInsertionBar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MNDrawInsertionBar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00688">688</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01534">xxxMenuDraw()</a>.
<p>
<pre class="fragment"><div>00689 {
00690     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fTop;
00691     POLYPATBLT PolyData [3], *ppd;
00692 
00693     <span class="comment">/*</span>
00694 <span class="comment">     * If no insertion bar for this item, bail</span>
00695 <span class="comment">     */</span>
00696     fTop = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_TOPGAPDROP);
00697     <span class="keywordflow">if</span> (!fTop &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, (MFS_BOTTOMGAPDROP))) {
00698         <span class="keywordflow">return</span>;
00699     }
00700 
00701     <span class="comment">/*</span>
00702 <span class="comment">     * Vertical line on the left</span>
00703 <span class="comment">     */</span>
00704     ppd = PolyData;
00705     ppd-&gt;x = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDRAG);
00706     ppd-&gt;cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDRAG);
00707     ppd-&gt;cy = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYDRAG);
00708     <span class="keywordflow">if</span> (fTop) {
00709         ppd-&gt;y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00710     } <span class="keywordflow">else</span> {
00711         ppd-&gt;y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - ppd-&gt;cy;
00712     }
00713     ppd-&gt;BrClr.hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(HIGHLIGHT);
00714 
00715     <span class="comment">/*</span>
00716 <span class="comment">     * Horizontal line in the middle</span>
00717 <span class="comment">     */</span>
00718     ppd++;
00719     ppd-&gt;x = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + (2 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDRAG));
00720     ppd-&gt;cx = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - (4 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDRAG));
00721     ppd-&gt;cy = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYDRAG) / 2;
00722     <span class="keywordflow">if</span> (fTop) {
00723         ppd-&gt;y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00724     } <span class="keywordflow">else</span> {
00725         ppd-&gt;y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - ppd-&gt;cy;
00726     }
00727     ppd-&gt;BrClr.hbr = PolyData-&gt;BrClr.hbr;
00728 
00729     <span class="comment">/*</span>
00730 <span class="comment">     * Vertical line on the right</span>
00731 <span class="comment">     */</span>
00732     ppd++;
00733     ppd-&gt;x = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - (2 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDRAG));
00734     ppd-&gt;cx = PolyData-&gt;cx;
00735     ppd-&gt;cy = PolyData-&gt;cy;
00736     ppd-&gt;y = PolyData-&gt;y;
00737     ppd-&gt;BrClr.hbr = PolyData-&gt;BrClr.hbr;
00738 
00739     GrePolyPatBlt(hdc, PATCOPY, PolyData, 3, PPB_BRUSH);
00740 
00741 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mndraw.c::MNDrawMenu3DHotTracking" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MNDrawMenu3DHotTracking           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00052">52</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02780">ClearMFS</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04819">CXMENU3DEDGE</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04820">CYMENU3DEDGE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02619">tagITEM::hbmp</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00643">MFISPOPUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02778">SetMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00053 {
00054     HBRUSH hbrTopLeft, hbrBottomRight;
00055     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDrawEdge;
00056 
00057     <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_CACHEDBMP))
00058         <span class="keywordflow">return</span>;
00059 
00060     fDrawEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00061 
00062     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFISPOPUP)) {
00063         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HILITE)) {
00064             hbrTopLeft = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DSHADOW);
00065             hbrBottomRight = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DHILIGHT);
00066             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a787">SetMFS</a>(pItem, MFS_HOTTRACKDRAWN);
00067             fDrawEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00068         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HOTTRACK)) {
00069             hbrTopLeft = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DHILIGHT);
00070             hbrBottomRight = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DSHADOW);
00071             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a787">SetMFS</a>(pItem, MFS_HOTTRACKDRAWN);
00072             fDrawEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00073         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HOTTRACKDRAWN)) {
00074             hbrTopLeft = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>);
00075             hbrBottomRight = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>);
00076             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a789">ClearMFS</a>(pItem, MFS_HOTTRACKDRAWN);
00077             fDrawEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00078         }
00079     }
00080 
00081     <span class="keywordflow">if</span> (fDrawEdge) {
00082         <span class="keywordtype">int</span> x = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>, y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00083         <span class="keywordtype">int</span> cx = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
00084         HBRUSH hbrOld = GreSelectBrush(hdc, hbrTopLeft);
00085         GrePatBlt(hdc, x, y, cx - CXMENU3DEDGE, CYMENU3DEDGE, PATCOPY);
00086         GrePatBlt(hdc, x, y, CXMENU3DEDGE, cy - CYMENU3DEDGE, PATCOPY);
00087         GreSelectBrush(hdc, hbrBottomRight);
00088         GrePatBlt(hdc, x, y + cy - CYMENU3DEDGE, cx - CXMENU3DEDGE, CYMENU3DEDGE, PATCOPY);
00089         GrePatBlt(hdc, x + cx - CYMENU3DEDGE, y, CXMENU3DEDGE, cy, PATCOPY);
00090         GreSelectBrush(hdc, hbrOld);
00091     }
00092 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="mndraw.c::MNEraseBackground" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MNEraseBackground           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cy</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00235">235</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02806">tagMENU::dwArrowsOn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00314">gcyMenuScrollArrow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00646">MFWINDOWDC</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04743">MNGetToppItem()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04780">MNXBORDER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04781">MNYBORDER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02627">MSA_OFF</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01697">xxxMNInvertItem()</a>.
<p>
<pre class="fragment"><div>00236 {
00237     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSetOrg;
00238     HBRUSH hbrOld;
00239     POINT ptOrg;
00240 
00241     UserAssert(pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != NULL);
00242 
00243     fSetOrg = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00244     GreGetBrushOrg(hdc, &amp;ptOrg);
00245     <span class="comment">/*</span>
00246 <span class="comment">     * If we have scrollbars</span>
00247 <span class="comment">     */</span>
00248     <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a759">MSA_OFF</a>) {
00249         <span class="comment">/*</span>
00250 <span class="comment">         * If not drawing on the client area only</span>
00251 <span class="comment">         */</span>
00252         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFWINDOWDC)) {
00253             ptOrg.x = 0;
00254             ptOrg.y = -(<span class="keywordtype">int</span>)<a class="code" href="../../d4/d1/userk_8h.html#a1324">MNGetToppItem</a>(pmenu)-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00255         } <span class="keywordflow">else</span> {
00256             ptOrg.x = -<a class="code" href="../../d4/d1/userk_8h.html#a526">MNXBORDER</a>;
00257             ptOrg.y = -<a class="code" href="../../d4/d1/userk_8h.html#a527">MNYBORDER</a> - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a144">gcyMenuScrollArrow</a> - <a class="code" href="../../d4/d1/userk_8h.html#a1324">MNGetToppItem</a>(pmenu)-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00258         }
00259     } <span class="keywordflow">else</span> {
00260         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFWINDOWDC)) {
00261             ptOrg.x = <a class="code" href="../../d4/d1/userk_8h.html#a526">MNXBORDER</a>;
00262             ptOrg.y = <a class="code" href="../../d4/d1/userk_8h.html#a527">MNYBORDER</a>;
00263         } <span class="keywordflow">else</span> {
00264             fSetOrg = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00265         }
00266     }
00267 
00268     <span class="keywordflow">if</span> (fSetOrg) {
00269         GreSetBrushOrg(hdc, ptOrg.x, ptOrg.y, &amp;ptOrg);
00270     }
00271     hbrOld = GreSelectBrush(hdc, pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a>);
00272 
00273     GrePatBlt(hdc, x, y, cx, cy, PATCOPY);
00274 
00275     <span class="keywordflow">if</span> (fSetOrg) {
00276         GreSetBrushOrg(hdc, ptOrg.x, ptOrg.y, NULL);
00277     }
00278     GreSelectBrush(hdc, hbrOld);
00279 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mndraw.c::MNIsCachedBmpOnly" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline BOOL MNIsCachedBmpOnly           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pItem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00025">25</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02609">tagITEM::lpstr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00039">mnDrawHilite()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00026 {
00027     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_CACHEDBMP) &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00028 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="mndraw.c::SetupFakeMDIAppStuff" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetupFakeMDIAppStuff           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpItem</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00724">724</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00026">_GetMenuDefaultItem()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00654">_SetCloseDefault()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02611">tagITEM::dwItemData</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00678">FindFakeMDIChild()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00725 {
00726     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>   pSubMenu;
00727     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndParent;
00728     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndChild;
00729 
00730     <span class="keywordflow">if</span> (!(pSubMenu = lpItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>))
00731         <span class="keywordflow">return</span>;
00732 
00733     pwndParent = lpMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>;
00734 
00735     <span class="comment">//</span>
00736     <span class="comment">// Set up the default menu item.  Project and FoxPro renumber their</span>
00737     <span class="comment">// IDs so we do some special stuff for them, among others.</span>
00738     <span class="comment">//</span>
00739     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, WFWIN40COMPAT))
00740     {
00741         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a0">_GetMenuDefaultItem</a>(pSubMenu, TRUE, GMDI_USEDISABLED) == -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)
00742             <a class="code" href="../../d5/d3/mnsys_8c.html#a0">_SetCloseDefault</a>(pSubMenu);
00743     }
00744 
00745     <span class="comment">//</span>
00746     <span class="comment">// Don't touch the HIWORD if we don't find an HWND.  That way apps</span>
00747     <span class="comment">// like Excel which have starting-up maxed children can benefit a little.</span>
00748     <span class="comment">// The first time the menu bar is redrawn, the child isn't visible/</span>
00749     <span class="comment">// around (they add the item too early).  But if it redraws later, or</span>
00750     <span class="comment">// you max a child, the icon will kick in.</span>
00751     <span class="comment">//</span>
00752     <span class="keywordflow">if</span> (pwndChild = <a class="code" href="../../d5/d3/mnsys_8c.html#a1">FindFakeMDIChild</a>(pwndParent)) {
00753         lpItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a> = (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndChild);
00754 <span class="comment">//        lpItem-&gt;dwTypeData = MAKELONG(LOWORD(lpItem-&gt;dwTypeData), HW16(hwndChild));</span>
00755     }
00756 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="mndraw.c::xxxDrawItemUnderline" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDrawItemUnderline           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xLeft</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>yTop</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>lResLo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00498">498</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03529">CALL_LPK</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00311">gcxMenuFontOverhang</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00313">gcyMenuFontAscent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03527">LPK_INSTALLED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02758">tagITEM::ulWidth</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02757">tagITEM::ulX</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05295">UNDERLINE_RECALC</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l02082">xxxDrawMenuBarUnderlines()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00565">xxxDrawMenuItemText()</a>.
<p>
<pre class="fragment"><div>00500 {
00501     <span class="keywordtype">int</span>   cx;
00502     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00503     <span class="comment">//</span>
00504     <span class="comment">// LOWORD of result is 0xFFFF if there is no underlined character.</span>
00505     <span class="comment">// Therefore ulX must be valid or be UNDERLINE_RECALC because the item</span>
00506     <span class="comment">// or menu mode changed.</span>
00507     <span class="comment">//</span>
00508     <span class="comment">// Bail out if there isn't one.</span>
00509     <span class="comment">//</span>
00510     <span class="keywordflow">if</span> (lResLo == 0xFFFF)
00511         <span class="keywordflow">return</span>;
00512 
00513     <span class="comment">//</span>
00514     <span class="comment">// For proportional fonts, or if an LPK is installed, find starting</span>
00515     <span class="comment">// point of underline</span>
00516     <span class="comment">//</span>
00517     <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a> == <a class="code" href="../../d4/d1/userk_8h.html#a570">UNDERLINE_RECALC</a>) || (<a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>()-&gt;dwLpkEntryPoints &amp; <a class="code" href="../../d4/d1/userk_8h.html#a392">LPK_INSTALLED</a>)) {
00518         <span class="keywordflow">if</span> (lResLo != 0) {
00519             SIZE size;
00520 
00521             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00522                 <a class="code" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW</a>(hdc, pszMenu, lResLo, &amp;size);
00523             } <span class="keywordflow">else</span> {
00524                 GreGetTextExtentW(hdc, pszMenu, lResLo, &amp;size, GGTE_WIN3_EXTENT);
00525             }
00526             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a> = size.cx - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a141">gcxMenuFontOverhang</a>;
00527         } <span class="keywordflow">else</span>
00528             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a> = 0;
00529     }
00530 
00531     xLeft += pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a>;
00532 
00533     <span class="comment">//</span>
00534     <span class="comment">// Adjust for proportional font when setting the length of the underline</span>
00535     <span class="comment">// and height of text.</span>
00536     <span class="comment">//</span>
00537     <span class="comment">// Calculate underline width.</span>
00538     <span class="keywordflow">if</span> (!pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a>) {
00539         SIZE size;
00540 
00541         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00542             <a class="code" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW</a>(hdc, pszMenu + lResLo, 1, &amp;size);
00543         } <span class="keywordflow">else</span> {
00544             GreGetTextExtentW(hdc, pszMenu + lResLo, 1, &amp;size, GGTE_WIN3_EXTENT);
00545         }
00546         pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a> = size.cx - <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a141">gcxMenuFontOverhang</a>;
00547     }
00548     cx = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a>;
00549 
00550     <span class="comment">// Get ascent of text (units above baseline) so that underline can be drawn</span>
00551     <span class="comment">// below the text</span>
00552     yTop += <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a143">gcyMenuFontAscent</a>;
00553 
00554     <span class="comment">// Proper brush should be selected into dc.</span>
00555     GrePatBlt(hdc, xLeft, yTop, pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER), PATCOPY);
00556 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="mndraw.c::xxxDrawMenuBar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDrawMenuBar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01670">1670</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00192">xxxRedrawFrame()</a>.
<p>
<pre class="fragment"><div>01672 {
01673     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01674 
01675     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
01676         <a class="code" href="../../d4/d1/userk_8h.html#a1499">xxxRedrawFrame</a>(pwnd);
01677     }
01678 
01679     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01680 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="mndraw.c::xxxDrawMenuBarTemp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xxxDrawMenuBarTemp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>hfont</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01972">1972</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02794">tagMENU::cyMenu</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00309">gcxMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00311">gcxMenuFontOverhang</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00313">gcyMenuFontAscent</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00310">gcyMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00312">gcyMenuFontExternLeading</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01829">GetCharDimensions()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00307">ghMenuFont</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00190">gSystemCPCharSet</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d1/mncomput_8c-source.html#l00706">xxxMenuBarCompute()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01534">xxxMenuDraw()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09444">NtUserDrawMenuBarTemp()</a>.
<p>
<pre class="fragment"><div>01978 {
01979     <span class="keywordtype">int</span>          cyMenu;
01980     HFONT        hOldFont;
01981     HFONT        hFontSave;
01982     <span class="keywordtype">int</span>          cxCharSave;
01983     <span class="keywordtype">int</span>          cxOverhangSave;
01984     <span class="keywordtype">int</span>          cyCharSave;
01985     <span class="keywordtype">int</span>          cyLeadingSave;
01986     <span class="keywordtype">int</span>          cyAscentSave;
01987     <span class="keywordtype">int</span>          cySizeSave;
01988     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwndNotify;
01989     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>          tlpwndNotify;
01990 
01991     hFontSave       = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>;
01992     cxCharSave      = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>;
01993     cxOverhangSave  = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a141">gcxMenuFontOverhang</a>;
01994     cyCharSave      = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a>;
01995     cyLeadingSave   = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a>;
01996     cyAscentSave    = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a143">gcyMenuFontAscent</a>;
01997     cySizeSave      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE);
01998 
01999     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
02000     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pMenu);
02001 
02002     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, &amp;tlpwndNotify);
02003     pwndNotify = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>;
02004 
02005     cyMenu = lprc-&gt;bottom - lprc-&gt;top;
02006 
02007     <span class="keywordflow">if</span> (hfont) {
02008         TEXTMETRIC  textMetrics;
02009 
02010         <span class="comment">/*</span>
02011 <span class="comment">         *  Compute the new menu font info if needed</span>
02012 <span class="comment">         */</span>
02013         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a> = hfont;
02014         hOldFont = GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), ghMenuFont);
02015         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a> = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a72">GetCharDimensions</a>(
02016                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), &amp;textMetrics, &amp;gcyMenuFontChar);
02017 
02018         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a141">gcxMenuFontOverhang</a> = textMetrics.tmOverhang;
02019         GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), hOldFont);
02020 
02021 <span class="preprocessor">#if 0   // FYI: #254237 removing KOR hack</span>
02022 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a71">gSystemCPCharSet</a> == HANGUL_CHARSET) {
02023             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a> -= textMetrics.tmInternalLeading - 2;
02024         }
02025 <span class="preprocessor">#endif</span>
02026 <span class="preprocessor"></span>
02027         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> = textMetrics.tmExternalLeading;
02028 
02029         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a143">gcyMenuFontAscent</a> = textMetrics.tmAscent + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
02030     }
02031 
02032     cyMenu -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
02033     cyMenu = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(cyMenu, (gcyMenuFontChar + gcyMenuFontExternLeading + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE)));
02034     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE) = cyMenu;
02035     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENU) = cyMenu + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
02036 
02037     <span class="comment">/*</span>
02038 <span class="comment">     *  Compute the dimensons of the menu (hope that we don't leave the</span>
02039 <span class="comment">     *  USER critical section)</span>
02040 <span class="comment">     */</span>
02041     <a class="code" href="../../d4/d1/userk_8h.html#a1396">xxxMenuBarCompute</a>(pMenu, pwnd, lprc-&gt;top, lprc-&gt;left, lprc-&gt;right);
02042 
02043     <span class="comment">/*</span>
02044 <span class="comment">     *  Draw menu border in menu color</span>
02045 <span class="comment">     */</span>
02046     lprc-&gt;bottom = lprc-&gt;top + pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
02047     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, lprc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>));
02048 
02049     <span class="comment">/*</span>
02050 <span class="comment">     *  Finally, draw the menu itself.</span>
02051 <span class="comment">     */</span>
02052     <a class="code" href="../../d4/d1/userk_8h.html#a1383">xxxMenuDraw</a>(hdc, pMenu);
02053 
02054     <span class="comment">/*</span>
02055 <span class="comment">     *  Restore the old state</span>
02056 <span class="comment">     */</span>
02057     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>              = hFontSave;
02058     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>          = cxCharSave;
02059     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a141">gcxMenuFontOverhang</a>      = cxOverhangSave;
02060     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a>          = cyCharSave;
02061     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> = cyLeadingSave;
02062     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a143">gcyMenuFontAscent</a>        = cyAscentSave;
02063     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE)      = cySizeSave;
02064 
02065     cyMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENU);
02066     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENU) = cySizeSave + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
02067 
02068     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, pwndNotify);
02069     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndNotify);
02070 
02071     <span class="keywordflow">return</span> cyMenu;
02072 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="mndraw.c::xxxDrawMenuBarUnderlines" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDrawMenuBarUnderlines           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fShow</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l02082">2082</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06586">ACCF_KEYBOARDPREF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03529">CALL_LPK</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02750">tagITEM::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02775">ClearMF</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00309">gcxMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00310">gcyMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00312">gcyMenuFontExternLeading</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01033">GetAppCompatFlags2()</a>, <a class="el" href="../../d6/d1/rtl_2drawtext_8c-source.html#l00806">GetPrefixCount()</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00307">ghMenuFont</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02609">tagITEM::lpstr</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00019">MENU_STRLEN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00645">MFUNDERLINE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04782">MNXSPACE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01022">OBI_MENUCHECK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02774">SetMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00204">SYSRGB</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06602">TEST_BOOL_ACCF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05280">TestEffectInvertUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03454">TextPointer</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01704">ThreadLockPool</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01710">ThreadUnlockAndFreePool</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02259">WFMPRESENT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00498">xxxDrawItemUnderline()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent()</a>, <a class="el" href="../../d6/d9/kernel_2text_8c-source.html#l00041">xxxPSMTextOut()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00617">xxxSendMenuDrawItemMessage()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, and <a class="el" href="../../d2/d2/mnloop_8c-source.html#l00584">xxxEndMenuLoop()</a>.
<p>
<pre class="fragment"><div>02083 {
02084     HDC hdc;
02085     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu;
02086     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pitem;
02087     ULONG i, yTop, cyTemp;
02088     LPWSTR psz;
02089     WCHAR  szMenu[<a class="code" href="../../d6/d2/mndraw_8c.html#a1">MENU_STRLEN</a>], *pchOut;
02090     LONG result;
02091     HBRUSH hbr;
02092     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlmenu;
02093     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
02094     <span class="keywordtype">int</span> xLeft;
02095     LPWSTR lpsz;
02096     SIZE extent;
02097 
02098     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
02099 
02100     <span class="comment">/*</span>
02101 <span class="comment">     * Bail if menu underlines are always on.</span>
02102 <span class="comment">     */</span>
02103     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_KEYBOARDPREF) || <a class="code" href="../../d4/d1/userk_8h.html#a568">TestEffectInvertUP</a>(KEYBOARDCUES)
02104         || (<a class="code" href="../../d6/d3/queue_8c.html#a35">GetAppCompatFlags2</a>(VER40) &amp; GACF2_KCOFF)) {
02105         <span class="keywordflow">return</span>;
02106     }
02107 
02108     <span class="comment">// if there is no menu, bail out right away</span>
02109 
02110     pwnd = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pwnd);
02111     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMPRESENT))
02112         <span class="keywordflow">return</span>;
02113     <span class="comment">/*</span>
02114 <span class="comment">     * We don't clear WFMPRESENT when the menu is unlocked so make sure we have one</span>
02115 <span class="comment">     */</span>
02116     pmenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>;
02117     <span class="keywordflow">if</span> (pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02118         <span class="keywordflow">return</span>;
02119     }
02120 
02121     <span class="comment">/*</span>
02122 <span class="comment">     * set/clear the underline state. There are cases when the</span>
02123 <span class="comment">     *  menu loop doesn't remove the keys from the queue; so after</span>
02124 <span class="comment">     *  exiting we might get here but nothing needs to be drawn</span>
02125 <span class="comment">     */</span>
02126     <span class="keywordflow">if</span> (fShow) {
02127         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFUNDERLINE)) {
02128             <span class="keywordflow">return</span>;
02129         }
02130         hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(MENUTEXT);
02131         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a784">SetMF</a>(pmenu, MFUNDERLINE);
02132     } <span class="keywordflow">else</span> {
02133         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFUNDERLINE)) {
02134             <span class="keywordflow">return</span>;
02135         }
02136         <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02137             hbr = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a>;
02138         } <span class="keywordflow">else</span> {
02139             hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>);
02140         }
02141         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a785">ClearMF</a>(pmenu, MFUNDERLINE);
02142     }
02143 
02144     pitem = (<a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>)pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>;
02145 
02146     hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_WINDOW | DCX_USESTYLE | DCX_CACHE);
02147 
02148     <span class="comment">// select in the correct brush and font</span>
02149 
02150     GreSelectFont(hdc, ghMenuFont);
02151 
02152     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pmenu, &amp;tlmenu);
02153     <span class="keywordflow">for</span> (i = 0; i &lt; pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>; i++, pitem++) {
02154         <span class="keywordflow">if</span> (((psz = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a909">TextPointer</a>(pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02155                 &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pitem, MFT_OWNERDRAW)) {
02156             <span class="keywordflow">continue</span>;
02157         }
02158 
02159         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pitem, MFT_OWNERDRAW)) {
02160             GreSetViewportOrg(hdc, 0, 0, NULL);
02161         } <span class="keywordflow">else</span> {
02162             GreSetViewportOrg(hdc, pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>, pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>, NULL);
02163         }
02164 
02165         <span class="comment">// this funky xLeft and yTop calculation stolen from RealDrawMenuItem</span>
02166 
02167         yTop = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a>;
02168         cyTemp = pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a> + <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> +
02169                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
02170         <span class="keywordflow">if</span> (cyTemp &gt; 0) {
02171             yTop += (cyTemp / 2);
02172         }
02173 
02174         <span class="keywordflow">if</span> (fShow &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pitem, MFS_HOTTRACK)) {
02175             GreSelectBrush(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(HOTLIGHT));
02176         } <span class="keywordflow">else</span> {
02177             GreSelectBrush(hdc, hbr);
02178         }
02179 
02180         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pitem, MFT_OWNERDRAW)) {
02181             <a class="code" href="../../d6/d2/mndraw_8c.html#a12">xxxSendMenuDrawItemMessage</a>(hdc, ODA_DRAWENTIRE, pmenu, pitem, FALSE, 0);
02182         } <span class="keywordflow">else</span> {
02183             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tl;
02184 
02185             <span class="keywordflow">if</span> (pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a> &gt; <a class="code" href="../../d6/d2/mndraw_8c.html#a1">MENU_STRLEN</a>) {
02186                 pchOut = (WCHAR*)UserAllocPool((pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>+1) * <span class="keyword">sizeof</span>(WCHAR), TAG_RTL);
02187                 <span class="keywordflow">if</span> (pchOut == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02188                     <span class="keywordflow">return</span>;
02189                 <a class="code" href="../../d4/d1/userk_8h.html#a137">ThreadLockPool</a>(ptiCurrent, pchOut, &amp;tl);
02190             } <span class="keywordflow">else</span> {
02191                 pchOut = szMenu;
02192             }
02193             
02194             xLeft = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>;
02195 
02196             <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pitem, MFT_RIGHTORDER) &amp;&amp; 
02197                  ((lpsz  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a909">TextPointer</a>(pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
02198             {
02199                 <a class="code" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent</a>(hdc, lpsz, pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>, &amp;extent);
02200                 xLeft += (pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>].cx + <a class="code" href="../../d4/d1/userk_8h.html#a528">MNXSPACE</a>) - extent.cx);
02201             }
02202 
02203             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
02204                 <span class="keywordflow">if</span> (!fShow) {
02205                     <span class="comment">//Becuase PSMTextOut does not use PatBlt it uses ExtTextOut.</span>
02206                     GreSetTextColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>));
02207                 }
02208                 <a class="code" href="../../d4/d1/userk_8h.html#a1407">xxxPSMTextOut</a>(hdc, xLeft, yTop, psz, pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>, DT_PREFIXONLY);
02209 
02210             } <span class="keywordflow">else</span> {
02211                 result = <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a39">GetPrefixCount</a>(psz, pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>, pchOut, pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>);
02212                 <a class="code" href="../../d6/d2/mndraw_8c.html#a10">xxxDrawItemUnderline</a>(pitem, hdc, xLeft, yTop, pchOut,
02213                     LOWORD(result));
02214             }
02215             <span class="keywordflow">if</span> (pchOut != szMenu) {
02216                     <a class="code" href="../../d4/d1/userk_8h.html#a139">ThreadUnlockAndFreePool</a>(ptiCurrent, &amp;tl);
02217             }
02218         }
02219     }
02220     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlmenu);
02221 
02222     <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
02223 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="mndraw.c::xxxDrawMenuItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDrawMenuItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">750</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00019">BC_INVERT</a>, <a class="el" href="../../d9/d1/mngray_8c-source.html#l00448">BltColor()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01020">tagOEMBITMAPINFO::cx</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01021">tagOEMBITMAPINFO::cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04707">DMI_INVERT</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00309">gcxMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00308">ghMenuFontDef</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00647">MFINACTIVE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00643">MFISPOPUP</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00039">mnDrawHilite()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00688">MNDrawInsertionBar()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00052">MNDrawMenu3DHotTracking()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00025">MNIsCachedBmpOnly()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01021">OBI_MENUARROW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01052">OBI_MENUARROW_L</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03281">PGRAYMENU</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03279">GRAYMENU::pItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03278">GRAYMENU::pMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00236">SYSHBRUSH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00204">SYSRGB</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01018">tagOEMBITMAPINFO::x</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, <a class="el" href="../../d9/d1/mngray_8c-source.html#l00169">xxxDrawState()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00617">xxxSendMenuDrawItemMessage()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01019">tagOEMBITMAPINFO::y</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00733">xxxHotTrackMenu()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01534">xxxMenuDraw()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01697">xxxMNInvertItem()</a>.
<p>
<pre class="fragment"><div>00755 {
00756     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fHilite;
00757     HFONT   hfnOld;
00758     <span class="keywordtype">int</span>     tcExtra;
00759     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    uFlags;
00760     <span class="keywordtype">int</span>     iBkSave;
00761     hfnOld = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00762     uFlags = DST_COMPLEX;
00763 
00764 
00765     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pMenu);
00766 
00767     <span class="comment">/*</span>
00768 <span class="comment">     * If the insertion bar is on (MFS_GAPDROP), don't draw the item hilited</span>
00769 <span class="comment">     */</span>
00770     fHilite = <a class="code" href="../../d6/d2/mndraw_8c.html#a3">mnDrawHilite</a>(pItem);
00771 
00772 
00773     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_DEFAULT))
00774     {
00775         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00776             hfnOld = GreSelectFont(hdc, ghMenuFontDef);
00777         <span class="keywordflow">else</span>
00778         {
00779             uFlags |= DSS_DEFAULT;
00780             tcExtra = GreGetTextCharacterExtra(hdc);
00781             GreSetTextCharacterExtra(hdc, tcExtra + 1 + (gcxMenuFontChar / <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar));
00782         }
00783     }
00784 
00785     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_OWNERDRAW)) {
00786 
00787         <span class="comment">/*</span>
00788 <span class="comment">         * If ownerdraw, just set the default menu colors since the app is</span>
00789 <span class="comment">         * responsible for handling the rest.</span>
00790 <span class="comment">         */</span>
00791         GreSetTextColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(MENUTEXT));
00792         GreSetBkColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>));
00793 
00794         <span class="comment">/*</span>
00795 <span class="comment">         * Send drawitem message since this is an ownerdraw item.</span>
00796 <span class="comment">         */</span>
00797         <a class="code" href="../../d6/d2/mndraw_8c.html#a12">xxxSendMenuDrawItemMessage</a>(hdc,
00798                 (UINT)((dwFlags &amp; DMI_INVERT) ? ODA_SELECT : ODA_DRAWENTIRE),
00799                 pMenu, pItem,FALSE,0);
00800 
00801         <span class="comment">// Draw the hierarchical arrow for the cascade menu.</span>
00802         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFISPOPUP) &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
00803         {
00804             <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem;
00805             HBRUSH hbr = fHilite ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(HIGHLIGHTTEXT) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(MENUTEXT);
00806 
00807             pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)
00808                                            ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a360">OBI_MENUARROW_L</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a329">OBI_MENUARROW</a>);
00809 
00810             <span class="comment">// This item has a hierarchical popup associated with it. Draw the</span>
00811             <span class="comment">// bitmap dealy to signify its presence. Note we check if fPopup is set</span>
00812             <span class="comment">// so that this isn't drawn for toplevel menus that have popups.</span>
00813 
00814             <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdc,
00815                      hbr,
00816                      <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
00817                      <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)
00818                          ? pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a> :
00819                            pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>,
00820                      pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> + <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((INT)(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - 2 - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>) / 2,
00821                                         0),
00822                      pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>,
00823                      pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
00824                      pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>,
00825                      pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>,
00826                      BC_INVERT);
00827         }
00828     } <span class="keywordflow">else</span> {
00829         <span class="keywordtype">int</span>         icolBack;
00830         <span class="keywordtype">int</span>         icolFore;
00831         <a class="code" href="../../d3/d0/structGRAYMENU.html">GRAYMENU</a>    gm;
00832 
00833         <span class="comment">//</span>
00834         <span class="comment">// Setup colors and state</span>
00835         <span class="comment">//</span>
00836         <span class="keywordflow">if</span> (fHilite &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFISPOPUP)) {
00837             icolBack = COLOR_HIGHLIGHT;
00838             icolFore = COLOR_HIGHLIGHTTEXT;
00839         } <span class="keywordflow">else</span> {
00840             icolBack = COLOR_MENU;
00841             icolFore = COLOR_MENUTEXT;
00842         }
00843 
00844         <span class="comment">// B#4157 - Lotus doesn't like it if we draw</span>
00845         <span class="comment">// its disabled menu items in GRAY, t-arthb</span>
00846         <span class="comment">// MAKE SURE MF_GRAYED stays 0x0001 NOT 0x0003 for this to fix</span>
00847 
00848         <span class="comment">/*</span>
00849 <span class="comment">         * System bitmaps are already grayed so don't draw them disabled</span>
00850 <span class="comment">         *  if the menu is inactive</span>
00851 <span class="comment">         */</span>
00852         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d2/mndraw_8c.html#a2">MNIsCachedBmpOnly</a>(pItem)
00853                     &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MF_GRAYED) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFINACTIVE))) {
00854             <span class="comment">//</span>
00855             <span class="comment">// Only do embossing if menu color is same as 3D color.  The</span>
00856             <span class="comment">// emboss uses 3D hilight &amp; 3D shadow, which doesn't look cool</span>
00857             <span class="comment">// on a different background.</span>
00858             <span class="comment">//</span>
00859             <span class="keywordflow">if</span> ((icolBack == COLOR_HIGHLIGHT) ||
00860                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DFACE)) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SLOWMACHINE)) {
00861                 <span class="comment">//</span>
00862                 <span class="comment">// If gray text won't show up on background, then dither.</span>
00863                 <span class="comment">//</span>
00864                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(GRAYTEXT) == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[icolBack])
00865                     uFlags |= DSS_UNION;
00866                 <span class="keywordflow">else</span>
00867                     icolFore = COLOR_GRAYTEXT;
00868             } <span class="keywordflow">else</span>
00869             {
00870                 <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DSHADOW) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>)) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>)))
00871                     uFlags |= DSS_UNION;
00872                 <span class="keywordflow">else</span>
00873                     uFlags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFINACTIVE) ? DSS_INACTIVE : DSS_DISABLED;
00874             }
00875         }
00876 
00877         GreSetBkColor(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[icolBack]);
00878         GreSetTextColor(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[icolFore]);
00879         <span class="keywordflow">if</span> (((<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a524">DMI_INVERT</a>) &amp;&amp; (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
00880                 || fHilite) {
00881 
00882             POLYPATBLT PolyData;
00883 
00884             <span class="comment">/*</span>
00885 <span class="comment">             * Only fill the background if we're being called on behalf of</span>
00886 <span class="comment">             * MNInvertItem. This is so that we don't waste time filling</span>
00887 <span class="comment">             * the unselected rect when the menu is first pulled down.</span>
00888 <span class="comment">             * If the menu has a background brush and we were called by</span>
00889 <span class="comment">             * MNInvertItem, that function will have already taken care of</span>
00890 <span class="comment">             * filling the background</span>
00891 <span class="comment">             */</span>
00892 
00893             PolyData.x         = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
00894             PolyData.y         = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00895             PolyData.cx        = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>;
00896             PolyData.cy        = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
00897             PolyData.BrClr.hbr = <a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icolBack);
00898 
00899             GrePolyPatBlt(hdc, PATCOPY, &amp;PolyData, 1, PPB_BRUSH);
00900         }
00901 
00902         <span class="keywordflow">if</span> (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00903             iBkSave = GreSetBkMode(hdc, TRANSPARENT);
00904         }
00905         GreSelectBrush(hdc, <a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icolFore));
00906 
00907         <span class="comment">//</span>
00908         <span class="comment">// Draw the image</span>
00909         <span class="comment">//</span>
00910         gm.<a class="code" href="../../d3/d0/structGRAYMENU.html#o1">pItem</a>   = pItem;
00911         gm.<a class="code" href="../../d3/d0/structGRAYMENU.html#o0">pMenu</a>   = pMenu;
00912 
00913         <a class="code" href="../../d4/d1/userk_8h.html#a1761">xxxDrawState</a>(hdc,
00914             <a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(icolFore),
00915             (LPARAM)(<a class="code" href="../../d3/d0/structGRAYMENU.html">PGRAYMENU</a>)&amp;gm,
00916             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>,
00917             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>,
00918             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>,
00919             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>,
00920             uFlags);
00921 
00922         <a class="code" href="../../d6/d2/mndraw_8c.html#a4">MNDrawMenu3DHotTracking</a>(hdc, pMenu, pItem);
00923     }
00924 
00925     <span class="comment">/*</span>
00926 <span class="comment">     * Draw the drop insertion bar, if any</span>
00927 <span class="comment">     */</span>
00928     <a class="code" href="../../d6/d2/mndraw_8c.html#a14">MNDrawInsertionBar</a> (hdc, pItem);
00929 
00930 
00931     <span class="keywordflow">if</span> (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00932         GreSetBkMode(hdc, iBkSave);
00933 
00934     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_DEFAULT))
00935     {
00936         <span class="keywordflow">if</span> (hfnOld)
00937             GreSelectFont(hdc, hfnOld);
00938         <span class="keywordflow">else</span>
00939             GreSetTextCharacterExtra(hdc, tcExtra);
00940     }
00941 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="mndraw.c::xxxDrawMenuItemText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDrawMenuItemText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xLeft</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>yTop</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpsz</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cch</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fShowUnderlines</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00565">565</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06586">ACCF_KEYBOARDPREF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03529">CALL_LPK</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01033">GetAppCompatFlags2()</a>, <a class="el" href="../../d6/d1/rtl_2drawtext_8c-source.html#l00806">GetPrefixCount()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00019">MENU_STRLEN</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06602">TEST_BOOL_ACCF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05280">TestEffectInvertUP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01704">ThreadLockPool</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01710">ThreadUnlockAndFreePool</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1411">xxxClientExtTextOutW()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00498">xxxDrawItemUnderline()</a>, and <a class="el" href="../../d6/d9/kernel_2text_8c-source.html#l00041">xxxPSMTextOut()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00567 {
00568     LONG  result;
00569     WCHAR  szMenu[<a class="code" href="../../d6/d2/mndraw_8c.html#a1">MENU_STRLEN</a>], *pchOut;
00570     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00571     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tl;
00572 
00573     <span class="keywordflow">if</span> (cch &gt; <a class="code" href="../../d6/d2/mndraw_8c.html#a1">MENU_STRLEN</a>) {
00574         pchOut = (WCHAR*)UserAllocPool((cch+1) * <span class="keyword">sizeof</span>(WCHAR), TAG_RTL);
00575         <span class="keywordflow">if</span> (pchOut == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00576             <span class="keywordflow">return</span>;
00577         <a class="code" href="../../d4/d1/userk_8h.html#a137">ThreadLockPool</a>(ptiCurrent, pchOut, &amp;tl);
00578     } <span class="keywordflow">else</span> {
00579         pchOut = szMenu;
00580     }
00581     result = <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a39">GetPrefixCount</a>(lpsz, cch, pchOut, cch);
00582 
00583     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00584         <a class="code" href="../../d4/d1/userk_8h.html#a1411">xxxClientExtTextOutW</a>(hdc, xLeft, yTop, 0, NULL, pchOut, cch - HIWORD(result), NULL);
00585     } <span class="keywordflow">else</span> {
00586         GreExtTextOutW(hdc, xLeft, yTop, 0, NULL, pchOut, cch - HIWORD(result), NULL);
00587     }
00588 
00589     <span class="keywordflow">if</span> (fShowUnderlines || <a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_KEYBOARDPREF) || <a class="code" href="../../d4/d1/userk_8h.html#a568">TestEffectInvertUP</a>(KEYBOARDCUES)
00590                         || (<a class="code" href="../../d6/d3/queue_8c.html#a35">GetAppCompatFlags2</a>(VER40) &amp; GACF2_KCOFF)) {
00591         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00592             <a class="code" href="../../d4/d1/userk_8h.html#a1407">xxxPSMTextOut</a>(hdc, xLeft, yTop, lpsz, cch, DT_PREFIXONLY);
00593         } <span class="keywordflow">else</span>{
00594             <a class="code" href="../../d6/d2/mndraw_8c.html#a10">xxxDrawItemUnderline</a>(pItem, hdc, xLeft, yTop, pchOut, LOWORD(result));
00595         }
00596     }
00597     <span class="keywordflow">if</span> (pchOut != szMenu) {
00598         <a class="code" href="../../d4/d1/userk_8h.html#a139">ThreadUnlockAndFreePool</a>(ptiCurrent, &amp;tl);
00599     }
00600 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="mndraw.c::xxxMenuBarDraw" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xxxMenuBarDraw           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cxFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cyFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01373">1373</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02775">ClearMF</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00057">CreateEmptyRgn()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02793">tagMENU::cxMenu</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02794">tagMENU::cyMenu</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01033">GetAppCompatFlags2()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06919">GetCaptionHeight()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00647">MFINACTIVE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02774">SetMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02571">TestwndFrameOn</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02367">WEFEDGEMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02308">WFOLDUI</a>, <a class="el" href="../../d5/d1/mncomput_8c-source.html#l00706">xxxMenuBarCompute()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01534">xxxMenuDraw()</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00076">xxxDrawWindowFrame()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00696">xxxDWP_DoNCActivate()</a>.
<p>
<pre class="fragment"><div>01378 {
01379     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cxMenuMax;
01380     <span class="keywordtype">int</span> yTop;
01381     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
01382     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fClipped = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01383     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpmenu;
01384     HRGN hrgnVisSave;
01385     HBRUSH hbrT;
01386     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01387 
01388     <span class="comment">/*</span>
01389 <span class="comment">     * Lock the menu so we can poke around</span>
01390 <span class="comment">     */</span>
01391     pMenu = (<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>;
01392     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01393         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
01394 
01395     <span class="comment">/*</span>
01396 <span class="comment">     * NT5 menus are drawn inactive when the window is not active.</span>
01397 <span class="comment">     */</span>
01398     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a743">TestwndFrameOn</a>(pwnd) || (<a class="code" href="../../d6/d3/queue_8c.html#a35">GetAppCompatFlags2</a>(VER40) &amp; GACF2_ACTIVEMENUS)) {
01399         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a785">ClearMF</a>(pMenu, MFINACTIVE);
01400     } <span class="keywordflow">else</span> {
01401         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a784">SetMF</a>(pMenu, MFINACTIVE);
01402     }
01403 
01404     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pMenu, &amp;tlpmenu);
01405 
01406     yTop = cyFrame;
01407     yTop += <a class="code" href="../../d4/d1/userk_8h.html#a2017">GetCaptionHeight</a>(pwnd);
01408 
01409 
01410     <span class="comment">/*</span>
01411 <span class="comment">     * Calculate maximum available horizontal real estate</span>
01412 <span class="comment">     */</span>
01413     cxMenuMax = (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left) - cxFrame * 2;
01414 
01415     <span class="comment">/*</span>
01416 <span class="comment">     * If the menu has switched windows, or if either count is 0,</span>
01417 <span class="comment">     * then we need to recompute the menu width.</span>
01418 <span class="comment">     */</span>
01419     <span class="keywordflow">if</span> (pwnd != pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a> ||
01420             pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a> == 0 ||
01421             pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a> == 0) {
01422 
01423         <a class="code" href="../../d4/d1/userk_8h.html#a1396">xxxMenuBarCompute</a>(pMenu, pwnd, yTop, cxFrame, cxMenuMax);
01424     }
01425 
01426     <span class="comment">/*</span>
01427 <span class="comment">     * If the menu rectangle is wider than allowed, or the</span>
01428 <span class="comment">     * bottom would overlap the size border, we need to clip.</span>
01429 <span class="comment">     */</span>
01430     <span class="keywordflow">if</span> (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a> &gt; cxMenuMax ||
01431             (<span class="keywordtype">int</span>)(yTop + pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>) &gt; (<span class="keywordtype">int</span>)((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top)
01432             - cyFrame)) {
01433 
01434         <span class="comment">/*</span>
01435 <span class="comment">         * Lock the display while we're playing around with visrgns.  Make</span>
01436 <span class="comment">         * a local copy of the saved-visrgn so it can be restored in case</span>
01437 <span class="comment">         * we make a callback (i.e. WM_DRAWITEM).</span>
01438 <span class="comment">         */</span>
01439         GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01440 
01441         fClipped = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01442 
01443 <span class="preprocessor">        #ifdef LATER</span>
01444 <span class="preprocessor"></span>        <span class="comment">// mikeke don't use the visrgn here if possible</span>
01445         hrgnVisSave = GreCreateRectRgn(
01446              pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + cxFrame,
01447              pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top,
01448              pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + cxFrame + cxMenuMax,
01449              pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - cyFrame);
01450         GreExtSelectClipRgn(hdc, hrgnVisSave, RGN_COPY);
01451         GreSetMetaRgn(hdc);
01452         GreDeleteObject(hrgnVisSave);
01453 <span class="preprocessor">        #else</span>
01454 <span class="preprocessor"></span>        hrgnVisSave = <a class="code" href="../../d4/d1/userk_8h.html#a1162">CreateEmptyRgn</a>();
01455         GreCopyVisRgn(hdc,hrgnVisSave);
01456         GreIntersectVisRect(hdc, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + cxFrame,
01457                               pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top,
01458                               pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + cxFrame + cxMenuMax,
01459                               pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - cyFrame);
01460 
01461 <span class="preprocessor">        #endif</span>
01462 <span class="preprocessor"></span>
01463         GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01464     }
01465 
01466     {
01467         POLYPATBLT PolyData[2];
01468 
01469         PolyData[0].x         = cxFrame;
01470         PolyData[0].y         = yTop;
01471         PolyData[0].cx        = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a>;
01472         PolyData[0].cy        = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
01473         PolyData[0].BrClr.hbr = (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a>) ? pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>);
01474 
01475         PolyData[1].x         = cxFrame;
01476         PolyData[1].y         = yTop + pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
01477         PolyData[1].cx        = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a>;
01478         PolyData[1].cy        = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
01479         PolyData[1].BrClr.hbr = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFEDGEMASK) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFOLDUI))? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DFACE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(WINDOWFRAME);
01480 
01481         GrePolyPatBlt(hdc,PATCOPY,&amp;PolyData[0],2,PPB_BRUSH);
01482 
01483         <span class="comment">//</span>
01484         <span class="comment">// Draw menu background in MENU color</span>
01485         <span class="comment">//</span>
01486         <span class="comment">//hbrT = GreSelectBrush(hdc, SYSHBR(MENU));</span>
01487         <span class="comment">//GrePatBlt(hdc, cxFrame, yTop, pMenu-&gt;cxMenu, pMenu-&gt;cyMenu, PATCOPY);</span>
01488 
01489         <span class="comment">//</span>
01490         <span class="comment">// Draw border under menu in proper BORDER color</span>
01491         <span class="comment">//</span>
01492         <span class="comment">//GreSelectBrush(hdc, (TestWF(pwnd, WEFEDGEMASK) &amp;&amp; !TestWF(pwnd, WFOLDUI))? SYSHBR(3DFACE) : SYSHBR(WINDOWFRAME));</span>
01493         <span class="comment">//GrePatBlt(hdc, cxFrame, yTop + pMenu-&gt;cyMenu, pMenu-&gt;cxMenu, SYSMET(CYBORDER), PATCOPY);</span>
01494 
01495 
01496     }
01497 
01498     <span class="comment">/*</span>
01499 <span class="comment">     * Finally, draw the menu itself.</span>
01500 <span class="comment">     */</span>
01501 
01502     hbrT = GreSelectBrush(hdc, (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFEDGEMASK) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFOLDUI))? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DFACE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(WINDOWFRAME));
01503     <a class="code" href="../../d4/d1/userk_8h.html#a1383">xxxMenuDraw</a>(hdc, pMenu);
01504     GreSelectBrush(hdc, hbrT);
01505 
01506     <span class="keywordflow">if</span> (fClipped) {
01507 <span class="preprocessor">        #ifdef LATER</span>
01508 <span class="preprocessor"></span>        <span class="comment">// mikeke don't use the visrgn here if possible</span>
01509         hrgnVisSave = <a class="code" href="../../d4/d1/userk_8h.html#a1162">CreateEmptyRgn</a>();
01510         GreExtSelectClipRgn(hdc, hrgnVisSave, RGN_COPY);
01511         GreSetMetaRgn(hdc);
01512         GreDeleteObject(hrgnVisSave);
01513 <span class="preprocessor">        #else</span>
01514 <span class="preprocessor"></span>        GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01515         GreSelectVisRgn(hdc, hrgnVisSave, SVR_DELETEOLD);
01516         GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01517 <span class="preprocessor">        #endif</span>
01518 <span class="preprocessor"></span>    }
01519 
01520     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpmenu);
01521     <span class="keywordflow">return</span>(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01522 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="mndraw.c::xxxMenuDraw" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxMenuDraw           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmenu</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01534">1534</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00675">CalcbfExtra()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02794">tagMENU::cyMenu</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00896">DrawEdge()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02806">tagMENU::dwArrowsOn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03357">tagTHREADINFO::dwExpWinVer</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00307">ghMenuFont</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02804">tagMENU::iTop</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00643">MFISPOPUP</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00688">MNDrawInsertionBar()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04743">MNGetToppItem()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02627">MSA_OFF</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01972">xxxDrawMenuBarTemp()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01373">xxxMenuBarDraw()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>.
<p>
<pre class="fragment"><div>01537 {
01538     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
01539     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
01540     RECT rcItem;
01541     HFONT       hFontOld;
01542     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>        bfExtra;
01543     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01544     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>        oldAlign;
01545     <span class="keywordtype">int</span>         iBkSave;
01546     POINT       ptOrg;
01547     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pmenu);
01548 
01549     <span class="keywordflow">if</span> (pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01550         RIPERR0(ERROR_INVALID_HANDLE,
01551                 RIP_WARNING,
01552                 <span class="stringliteral">"Invalid menu handle \"pmenu\" (NULL) to xxxMenuDraw"</span>);
01553 
01554         <span class="keywordflow">return</span>;
01555     }
01556 
01557     GreGetViewportOrg(hdc, &amp;ptOrg);
01558     hFontOld = GreSelectFont(hdc, ghMenuFont);
01559 
01560     oldAlign = <a class="code" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign</a>(hdc);
01561     <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a> &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>, MFT_RIGHTORDER))
01562         <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdc, oldAlign | TA_RTLREADING);
01563 
01564     bfExtra = <a class="code" href="../../d6/d2/mndraw_8c.html#a13">CalcbfExtra</a>();
01565 
01566     <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01567         iBkSave = GreSetBkMode(hdc, TRANSPARENT);
01568     }
01569 
01570     <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a759">MSA_OFF</a>) {
01571         pItem = <a class="code" href="../../d4/d1/userk_8h.html#a1324">MNGetToppItem</a>(pmenu);
01572         GreSetViewportOrg(hdc, ptOrg.x, ptOrg.y - ((<span class="keywordtype">int</span>)pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>), NULL);
01573         i = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o14">iTop</a>;
01574     } <span class="keywordflow">else</span> {
01575         pItem = (<a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>)pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>;
01576         i = 0;
01577     }
01578 
01579     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = 0;
01580     <span class="keywordflow">for</span> (; i &lt; pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>; i++, pItem++) {
01581         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_MENUBARBREAK) &amp;&amp;
01582                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFISPOPUP)) {
01583 
01584             <span class="comment">//</span>
01585             <span class="comment">// Draw a vertical etch.  This is done by calling DrawEdge(),</span>
01586             <span class="comment">// sunken, with BF_LEFT | BF_RIGHT.</span>
01587             <span class="comment">//</span>
01588             <span class="keywordflow">if</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER) &amp;&amp; i) {
01589                 <span class="comment">//</span>
01590                 <span class="comment">// going backwards, so the correct place is just before the</span>
01591                 <span class="comment">// _previous_ item.</span>
01592                 <span class="comment">//</span>
01593                 <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pi;
01594 
01595                 pi            = pItem - 1;
01596                 rcItem.left   = pi-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
01597                 rcItem.top    = 0;
01598                 rcItem.right  = pi-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
01599                 rcItem.bottom = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
01600             } <span class="keywordflow">else</span> {
01601                 rcItem.left     = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
01602                 rcItem.top      = 0;
01603                 rcItem.right    = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
01604                 rcItem.bottom   = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
01605             }
01606 
01607             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rcItem, BDR_SUNKENOUTER, BF_LEFT | BF_RIGHT | bfExtra);
01608         }
01609         <span class="comment">/*</span>
01610 <span class="comment">         * If this is a separator, draw it and return.</span>
01611 <span class="comment">         * If version is less than 4.0  don't test the MFT_OWNERDRAW</span>
01612 <span class="comment">         * flag. Bug 21922; App MaxEda has both separator and Ownerdraw</span>
01613 <span class="comment">         * flags on. In 3.51 we didn't test the OwnerDraw flag</span>
01614 <span class="comment">         */</span>
01615         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_SEPARATOR)
01616                 &amp;&amp; (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_OWNERDRAW)
01617                     || (LOWORD(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o25">dwExpWinVer</a>) &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>))) {
01618 
01619             <span class="comment">/*</span>
01620 <span class="comment">             * Draw a horizontal etch.</span>
01621 <span class="comment">             */</span>
01622             <span class="keywordtype">int</span> yT = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> + (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> / 2) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
01623             RECT rcItem;
01624 
01625             rcItem.left     = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + 1;
01626             rcItem.top       = yT;
01627             rcItem.right    = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - 1;
01628             rcItem.bottom   = yT + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01629 
01630             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rcItem, BDR_SUNKENOUTER, BF_TOP | BF_BOTTOM | bfExtra);
01631             <span class="comment">/*</span>
01632 <span class="comment">             * Draw drop insertion bar, if any.</span>
01633 <span class="comment">             */</span>
01634             <a class="code" href="../../d6/d2/mndraw_8c.html#a14">MNDrawInsertionBar</a> (hdc, pItem);
01635 
01636         } <span class="keywordflow">else</span> {
01637             <a class="code" href="../../d4/d1/userk_8h.html#a1315">xxxDrawMenuItem</a>(hdc, pmenu, pItem, 0);
01638         }
01639 
01640         <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a759">MSA_OFF</a>) {
01641             <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> += pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
01642             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> &gt; pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>) {
01643                 <span class="comment">/*</span>
01644 <span class="comment">                 * this is a scrollable menu and the item just drawn falls below</span>
01645 <span class="comment">                 * the bottom of the visible menu -- no need to draw any further</span>
01646 <span class="comment">                 */</span>
01647                 <span class="keywordflow">break</span>;
01648             }
01649         }
01650     } <span class="comment">/* for (; i &lt; pmenu-&gt;cItems; i++, pItem++) */</span>
01651 
01652     <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01653         GreSetBkMode(hdc, iBkSave);
01654     }
01655     GreSetViewportOrg(hdc, ptOrg.x, ptOrg.y, NULL);
01656     <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdc, oldAlign);
01657     GreSelectFont(hdc, hFontOld);
01658 
01659 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="mndraw.c::xxxMNInvertItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> xxxMNInvertItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ppopupmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>itemNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndNotify</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fOn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01697">1697</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00148">_GetDC()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00201">_GetWindowDC()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02780">ClearMFS</a>, <a class="el" href="../../d4/d5/visrgn_8c-source.html#l00057">CreateEmptyRgn()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02794">tagMENU::cyMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04707">DMI_INVERT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02806">tagMENU::dwArrowsOn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00307">ghMenuFont</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02619">tagITEM::hbmp</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02652">tagMENU::hbrBack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02804">tagMENU::iTop</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00643">MFISPOPUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02765">MFMWFP_DOWNARROW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02764">MFMWFP_UPARROW</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00102">MNDrawArrow()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00039">mnDrawHilite()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00235">MNEraseBackground()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04743">MNGetToppItem()</a>, <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00025">MNPositionSysMenu()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02627">MSA_OFF</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02778">SetMFS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02868">tagPOPUPMENU::spwndPopupMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>, <a class="el" href="../../d8/d6/menuc_8c-source.html#l00270">xxxGetSysMenuHandle()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00495">xxxMNSetTop()</a>, <a class="el" href="../../d4/d2/mnsel_8c-source.html#l00029">xxxSendMenuSelect()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l01430">xxxUpdateWindow()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/mnaccel_8c-source.html#l00117">xxxHiliteMenuItem()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02818">xxxMNSelectItem()</a>.
<p>
<pre class="fragment"><div>01703 {
01704     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01705     HDC hdc;
01706     <span class="keywordtype">int</span> y, iNewTop;
01707     RECT rcItem;
01708     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSysMenuIcon = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01709     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenusys;
01710     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fClipped = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01711     HFONT   hOldFont;
01712     HRGN hrgnVisSave;
01713     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
01714     POINT ptOrg;
01715     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
01716     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> oldAlign;
01717 
01718     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pmenu);
01719     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndNotify);
01720 
01721     <span class="comment">/*</span>
01722 <span class="comment">     * If we are in the middle of trying to get out of menu mode, hMenu</span>
01723 <span class="comment">     * and/or pwndNotify will be NULL, so just bail out now.</span>
01724 <span class="comment">     */</span>
01725     <span class="keywordflow">if</span> ((pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (pwndNotify == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01726         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01727     }
01728 
01729 
01730     <span class="comment">/*</span>
01731 <span class="comment">     * If ppopupmenu is NULL, we're not in menu mode (i.e, call from</span>
01732 <span class="comment">     *  HiliteMenuItem).</span>
01733 <span class="comment">     */</span>
01734     <span class="keywordflow">if</span> (ppopupmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01735         pwnd = pwndNotify;
01736     } <span class="keywordflow">else</span> {
01737         pwnd = ppopupmenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o26">spwndPopupMenu</a>;
01738     }
01739 
01740     <span class="keywordflow">if</span> (pwnd != pwndNotify) {
01741         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
01742     }
01743 
01744 
01745     <span class="keywordflow">if</span> (itemNumber &lt; 0) {
01746 
01747         <span class="keywordflow">if</span> (ppopupmenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01748             <span class="keywordflow">if</span> ((itemNumber == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a779">MFMWFP_UPARROW</a>) || (itemNumber == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a780">MFMWFP_DOWNARROW</a>)) {
01749                 <a class="code" href="../../d4/d1/userk_8h.html#a1341">MNDrawArrow</a>(NULL, ppopupmenu, itemNumber);
01750             }
01751         }
01752 
01753         <a class="code" href="../../d4/d1/userk_8h.html#a1389">xxxSendMenuSelect</a>(pwndNotify, pwnd, pmenu, itemNumber);
01754         <span class="keywordflow">goto</span> SeeYa;
01755     }
01756 
01757     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFISPOPUP)) {
01758         pmenusys = <a class="code" href="../../d4/d1/userk_8h.html#a1403">xxxGetSysMenuHandle</a>(pwndNotify);
01759         <span class="keywordflow">if</span> (pmenu == pmenusys) {
01760             <a class="code" href="../../d4/d1/userk_8h.html#a1387">MNPositionSysMenu</a>(pwndNotify, pmenusys);
01761             fSysMenuIcon = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01762         }
01763     }
01764 
01765     <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)itemNumber &gt;= pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>)
01766         <span class="keywordflow">goto</span> SeeYa;
01767 
01768     pItem = &amp;pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>[itemNumber];
01769 
01770     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFISPOPUP) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndNotify, WFMINIMIZED)) {
01771 
01772         <span class="comment">/*</span>
01773 <span class="comment">         * Skip inverting top level menus if the window is iconic.</span>
01774 <span class="comment">         */</span>
01775         <span class="keywordflow">goto</span> SeeYa;
01776     }
01777 
01778     <span class="comment">/*</span>
01779 <span class="comment">     * Is this a separator?</span>
01780 <span class="comment">     */</span>
01781     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_SEPARATOR)) {
01782         <span class="keywordflow">goto</span> SendSelectMsg;
01783     }
01784 
01785     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HILITE) == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)fOn) {
01786 
01787         <span class="comment">/*</span>
01788 <span class="comment">         * Item's state isn't really changing.  Just return.</span>
01789 <span class="comment">         */</span>
01790         <span class="keywordflow">goto</span> SeeYa;
01791     }
01792 
01793     <span class="keywordflow">if</span> (fOn &amp;&amp; (ppopupmenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a759">MSA_OFF</a>)) {
01794         <span class="comment">/*</span>
01795 <span class="comment">         * when selecting an item, ensure that the item is fully visible</span>
01796 <span class="comment">         * BUGBUG -- for mouse use, partially visible should be acceptable</span>
01797 <span class="comment">         *        -- can we get mouse info down this far ?</span>
01798 <span class="comment">         */</span>
01799 
01800         <span class="keywordflow">if</span> (itemNumber &lt; pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o14">iTop</a>) {
01801             iNewTop = itemNumber;
01802             <span class="keywordflow">goto</span> NewTop;
01803         } <span class="keywordflow">else</span> {
01804             <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pWalk = <a class="code" href="../../d4/d1/userk_8h.html#a1324">MNGetToppItem</a>(pmenu);
01805             <span class="keywordtype">int</span> dy = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - pWalk-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> - pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>;
01806             iNewTop = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o14">iTop</a>;
01807             <span class="keywordflow">while</span> ((dy &gt; 0) &amp;&amp; (iNewTop &lt; (<span class="keywordtype">int</span>)pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>)) {
01808                 dy -= pWalk-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
01809                 pWalk++;
01810                 iNewTop++;
01811             }
01812             <span class="keywordflow">if</span> (iNewTop &gt;= (<span class="keywordtype">int</span>)pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>) {
01813                 iNewTop = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
01814             }
01815 NewTop:
01816             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1365">xxxMNSetTop</a>(ppopupmenu, iNewTop)) {
01817                 <a class="code" href="../../d4/d1/userk_8h.html#a1673">xxxUpdateWindow</a>(pwnd);
01818             }
01819         }
01820     }
01821 
01822     rcItem.left     = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
01823     rcItem.top      = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
01824     rcItem.right    = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>;
01825     rcItem.bottom   = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a> + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
01826 
01827     y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>;
01828 
01829     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFISPOPUP)) {
01830         hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1694">_GetDC</a>(pwnd);
01831     } <span class="keywordflow">else</span> {
01832         hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1696">_GetWindowDC</a>(pwnd);
01833         <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX) &amp;&amp; !fSysMenuIcon) {
01834 
01835             <span class="comment">/*</span>
01836 <span class="comment">             * If the window is small enough that some of the menu bar has been</span>
01837 <span class="comment">             * obscured by the frame, we don't want to draw on the bottom of the</span>
01838 <span class="comment">             * sizing frame.  Note that we don't want to do this if we are</span>
01839 <span class="comment">             * inverting the system menu icon since that will be clipped to the</span>
01840 <span class="comment">             * window rect.  (otherwise we end up with only half the sys menu</span>
01841 <span class="comment">             * icon inverted)</span>
01842 <span class="comment">             */</span>
01843             <span class="keywordtype">int</span> xMenuMax = (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZEFRAME);
01844 
01845             <span class="keywordflow">if</span> (rcItem.right &gt; xMenuMax ||
01846                     rcItem.bottom &gt; ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom -
01847                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME))) {
01848 
01849                 <span class="comment">/*</span>
01850 <span class="comment">                 * Lock the display while we're playing around with visrgns.</span>
01851 <span class="comment">                 * Make a local copy of the visrgn, so that it can be</span>
01852 <span class="comment">                 * properly restored on potential callbacks (i.e. WM_DRAWITEM).</span>
01853 <span class="comment">                 */</span>
01854                 GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01855 
01856                 fClipped = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01857 
01858 <span class="preprocessor">                #ifdef LATER</span>
01859 <span class="preprocessor"></span>                <span class="comment">// mikeke - don't use the visrgn here if possible</span>
01860                 hrgnVisSave = GreCreateRectRgn(
01861                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + rcItem.left,
01862                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top + rcItem.top,
01863                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + xMenuMax,
01864                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME));
01865                 GreExtSelectClipRgn(hdc, hrgnVisSave, RGN_COPY);
01866                 GreSetMetaRgn(hdc);
01867                 GreDeleteObject(hrgnVisSave);
01868 <span class="preprocessor">                #else</span>
01869 <span class="preprocessor"></span>                hrgnVisSave = <a class="code" href="../../d4/d1/userk_8h.html#a1162">CreateEmptyRgn</a>();
01870                 GreCopyVisRgn(hdc,hrgnVisSave);
01871                 GreIntersectVisRect(hdc,
01872                         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + rcItem.left,
01873                         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top + rcItem.top,
01874                         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left + xMenuMax,
01875                         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME));
01876 <span class="preprocessor">                #endif</span>
01877 <span class="preprocessor"></span>
01878                 GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01879             }
01880         }
01881     }
01882 
01883     oldAlign = <a class="code" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign</a>(hdc);
01884     <span class="keywordflow">if</span> (pItem &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER))
01885         <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdc, oldAlign | TA_RTLREADING);
01886 
01887     hOldFont = GreSelectFont(hdc, ghMenuFont);
01888     GreGetViewportOrg(hdc, &amp;ptOrg);
01889 
01890     <span class="keywordflow">if</span> (fOn) {
01891         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a787">SetMFS</a>(pItem, MFS_HILITE);
01892     } <span class="keywordflow">else</span> {
01893         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a789">ClearMFS</a>(pItem, MFS_HILITE);
01894     }
01895 
01896     <span class="keywordflow">if</span> (!fSysMenuIcon
01897         &amp;&amp; ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> != HBMMENU_SYSTEM)
01898             || (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFISPOPUP)))) {
01899 
01900         <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o16">dwArrowsOn</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a759">MSA_OFF</a>) {
01901             GreSetViewportOrg(hdc, ptOrg.x, ptOrg.y - ((<span class="keywordtype">int</span>)<a class="code" href="../../d4/d1/userk_8h.html#a1324">MNGetToppItem</a>(pmenu)-&gt;yItem), NULL);
01902         }
01903 
01904         <span class="keywordflow">if</span> ((pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01905                 &amp;&amp; !<a class="code" href="../../d6/d2/mndraw_8c.html#a3">mnDrawHilite</a>(pItem)
01906                 &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_OWNERDRAW)) {
01907 
01908             <span class="comment">/*</span>
01909 <span class="comment">             * fill the background here so xxxDrawMenuItem doesn't have to fool</span>
01910 <span class="comment">             * around with hbrBack</span>
01911 <span class="comment">             */</span>
01912             <span class="keywordtype">int</span> iBkSave = GreSetBkMode(hdc, TRANSPARENT);
01913             <a class="code" href="../../d4/d1/userk_8h.html#a1342">MNEraseBackground</a> (hdc, pmenu,
01914                     pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>, pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>,
01915                     pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>, pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>);
01916             GreSetBkMode(hdc, iBkSave);
01917         }
01918 
01919         <a class="code" href="../../d4/d1/userk_8h.html#a1315">xxxDrawMenuItem</a>(hdc, pmenu, pItem, DMI_INVERT);
01920     }
01921 
01922 
01923     <span class="keywordflow">if</span> (fClipped) {
01924         GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01925         GreSelectVisRgn(hdc, hrgnVisSave, SVR_DELETEOLD);
01926         GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
01927     }
01928 
01929     GreSelectFont(hdc, hOldFont);
01930     GreSetViewportOrg(hdc, ptOrg.x, ptOrg.y, NULL);
01931     <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdc, oldAlign);
01932     <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
01933 
01934 SendSelectMsg:
01935     <span class="comment">/*</span>
01936 <span class="comment">     * send select msg only if we are selecting an item.</span>
01937 <span class="comment">     */</span>
01938     <span class="keywordflow">if</span> (fOn) {
01939         <a class="code" href="../../d4/d1/userk_8h.html#a1389">xxxSendMenuSelect</a>(pwndNotify, pwnd, pmenu, itemNumber);
01940     }
01941 
01942 SeeYa:
01943     <span class="keywordflow">if</span> (pwnd != pwndNotify) {
01944         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01945     }
01946 
01947     <span class="keywordflow">return</span>(pItem);
01948 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="mndraw.c::xxxRealDrawMenuItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CALLBACK xxxRealDrawMenuItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d0/structGRAYMENU.html">PGRAYMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pGray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cy</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">954</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d1/d8/wmicon_8c-source.html#l00093">_DrawIconEx()</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00019">BC_INVERT</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00029">BitBltSysBmp()</a>, <a class="el" href="../../d9/d1/mngray_8c-source.html#l00448">BltColor()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02750">tagITEM::cch</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03855">CH_HELPPREFIX</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01020">tagOEMBITMAPINFO::cx</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02760">tagITEM::cxBmp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04819">CXMENU3DEDGE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02795">tagMENU::cxTextAlign</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01021">tagOEMBITMAPINFO::cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02761">tagITEM::cyBmp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04820">CYMENU3DEDGE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00944">DOBI_PUSHED</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00409">DrawMenuItemCheckMark()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03357">tagTHREADINFO::dwExpWinVer</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02611">tagITEM::dwItemData</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02756">tagITEM::dxTab</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d4/w32_2ntuser_2rtl_2random_8c-source.html#l00080">FindCharPosition()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00309">gcxMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00310">gcyMenuFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00312">gcyMenuFontExternLeading</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00494">ghdcMem2</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02619">tagITEM::hbmp</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00353">HMValidateHandleNoRip()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02609">tagITEM::lpstr</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00643">MFISPOPUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00645">MFUNDERLINE</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00039">mnDrawHilite()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04783">MNLEFTMARGIN</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04782">MNXSPACE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00977">OBI_CLOSE_MBAR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00980">OBI_CLOSE_MBAR_I</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01053">OBI_COUNT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01021">OBI_MENUARROW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01052">OBI_MENUARROW_L</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01022">OBI_MENUCHECK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01046">OBI_POPUPFIRST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00981">OBI_REDUCE_MBAR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00984">OBI_REDUCE_MBAR_I</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00985">OBI_RESTORE_MBAR</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02318">PICON</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03279">GRAYMENU::pItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03278">GRAYMENU::pMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00724">SetupFakeMDIAppStuff()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00016">SRCSTENCIL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02772">SYSICO</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03454">TextPointer</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00906">TYPE_WINDOW</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01018">tagOEMBITMAPINFO::x</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00565">xxxDrawMenuItemText()</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00306">xxxGetWindowSmIcon()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent()</a>, <a class="el" href="../../d6/d9/kernel_2text_8c-source.html#l00041">xxxPSMTextOut()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00617">xxxSendMenuDrawItemMessage()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01019">tagOEMBITMAPINFO::y</a>.
<p>
Referenced by <a class="el" href="../../d9/d1/mngray_8c-source.html#l00169">xxxDrawState()</a>.
<p>
<pre class="fragment"><div>00959 {
00960     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>  pMenu;
00961     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>  pItem;
00962     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fPopup;
00963     <span class="keywordtype">int</span>     cch;
00964     <span class="keywordtype">int</span>     xLeft;
00965     <span class="keywordtype">int</span>     yTop;
00966     <span class="keywordtype">int</span>     tp;
00967     <span class="keywordtype">int</span>     rp;
00968     LPWSTR   lpsz;
00969     <span class="keywordtype">int</span>     cyTemp;
00970     <span class="keywordtype">int</span>     xHilite = 0;
00971     <span class="keywordtype">int</span>     yHilite = 0;
00972     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>     tlpwndChild;
00973     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00974     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fCheckDrawn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00975     <span class="keywordtype">int</span>     xFarLeft;
00976     <span class="comment">//</span>
00977     <span class="comment">// BOGUS</span>
00978     <span class="comment">// Use cx and cy instead of lpItem-&gt;cxItem, lpItem-&gt;cyItem to</span>
00979     <span class="comment">// speed stuff up.</span>
00980     <span class="comment">//</span>
00981     pMenu = pGray-&gt;<a class="code" href="../../d3/d0/structGRAYMENU.html#o0">pMenu</a>;
00982     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pMenu);
00983     pItem = pGray-&gt;<a class="code" href="../../d3/d0/structGRAYMENU.html#o1">pItem</a>;
00984     fPopup = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFISPOPUP);
00985 
00986     <span class="keywordflow">if</span> (fPopup) {
00987         xLeft = <a class="code" href="../../d4/d1/userk_8h.html#a529">MNLEFTMARGIN</a>;
00988         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MNS_NOCHECK)) {
00989             xLeft += <a class="code" href="../../d4/d1/userk_8h.html#a528">MNXSPACE</a>;
00990         } <span class="keywordflow">else</span> {
00991             fCheckDrawn = <a class="code" href="../../d6/d2/mndraw_8c.html#a9">DrawMenuItemCheckMark</a>(hdc, pItem, xLeft);
00992             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MNS_CHECKORBMP)
00993                     || ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || fCheckDrawn)) {
00994 
00995                 xLeft += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)
00996                             ? 0 : (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>].cx + <a class="code" href="../../d4/d1/userk_8h.html#a528">MNXSPACE</a>);
00997             }
00998         }
00999     } <span class="keywordflow">else</span> {
01000         xLeft = 0;
01001 
01002         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HILITE)) {
01003             xHilite = <a class="code" href="../../d4/d1/userk_8h.html#a544">CXMENU3DEDGE</a>;
01004             yHilite = <a class="code" href="../../d4/d1/userk_8h.html#a545">CYMENU3DEDGE</a>;
01005         }
01006     }
01007 
01008     <span class="comment">/*</span>
01009 <span class="comment">     * If there is not bitmap or we don't to draw it, go draw the text</span>
01010 <span class="comment">     */</span>
01011     <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01012         || (fCheckDrawn
01013             &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MNS_CHECKORBMP))) {
01014         <span class="keywordflow">goto</span> RealDrawMenuItemText;
01015     }
01016 
01017     <span class="comment">/*</span>
01018 <span class="comment">     * Draw the bitmap</span>
01019 <span class="comment">     */</span>
01020     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_CACHEDBMP)) {
01021         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> == HBMMENU_SYSTEM) {
01022             <span class="comment">/*</span>
01023 <span class="comment">             * Drawing app icon (system menu)</span>
01024 <span class="comment">             */</span>
01025             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwndChild;
01026             <a class="code" href="../../d1/d0/inc_2user_8h.html#a529">PICON</a> pIcon = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01027             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cyUse, cxUse;
01028 
01029 AintNothingLikeTheRealMDIThing:
01030             <span class="keywordflow">if</span> (!(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a>))
01031                 <a class="code" href="../../d5/d3/mnsys_8c.html#a14">SetupFakeMDIAppStuff</a>(pMenu, pItem);
01032 
01033             pwndChild = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>((HWND)(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a>),TYPE_WINDOW);
01034             <span class="keywordflow">if</span> (!pwndChild)
01035             {
01036                 <span class="comment">//</span>
01037                 <span class="comment">// Oops, child window isn't valid anymore.  Go find</span>
01038                 <span class="comment">// the new one.</span>
01039                 <span class="comment">//</span>
01040                 <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a>)
01041                 {
01042                     pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a> = 0;
01043                     <span class="keywordflow">goto</span> AintNothingLikeTheRealMDIThing;
01044                 }
01045 
01046                 pIcon = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01047             }
01048             <span class="keywordflow">else</span> {
01049                 <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndChild, &amp;tlpwndChild);
01050                 pIcon = <a class="code" href="../../d4/d1/userk_8h.html#a1437">xxxGetWindowSmIcon</a>(pwndChild, FALSE);
01051                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndChild);
01052             }
01053 
01054 
01055             <span class="keywordflow">if</span> (!pIcon)
01056                 pIcon = <a class="code" href="../../d4/d1/userk_8h.html#a320">SYSICO</a>(WINLOGO);
01057 
01058             cyUse = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01059             cxUse = cx - (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) * 2);
01060             <span class="comment">/*</span>
01061 <span class="comment">             * If this is a popup, make sure that no weird</span>
01062 <span class="comment">             *  width/height stretch takes place.</span>
01063 <span class="comment">             */</span>
01064             <span class="keywordflow">if</span> (fPopup &amp;&amp; (cyUse &lt; cxUse)) {
01065                 cxUse = cyUse;
01066             }
01067 
01068             <a class="code" href="../../d0/d9/wmicon_8c.html#a4">_DrawIconEx</a>(hdc, xLeft + (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) * 2),
01069                   <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER), pIcon, cxUse,
01070                   cyUse, 0, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>), DI_NORMAL);
01071 
01072         } <span class="keywordflow">else</span> {
01073             <span class="comment">/*</span>
01074 <span class="comment">             * This is a cached bitmap</span>
01075 <span class="comment">             */</span>
01076             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wBmp;
01077             <span class="keywordtype">int</span> xBmpLeft = xLeft;
01078             <span class="keywordtype">int</span> y;
01079             <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem;
01080 
01081             <span class="keywordflow">switch</span> ((ULONG_PTR)pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>) {
01082                 <span class="keywordflow">case</span> (ULONG_PTR)HBMMENU_MBAR_RESTORE:
01083                     wBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a293">OBI_RESTORE_MBAR</a>;
01084                     <span class="keywordflow">goto</span> DrawSysBmp;
01085 
01086                 <span class="keywordflow">case</span> (ULONG_PTR)HBMMENU_MBAR_MINIMIZE:
01087                     wBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a289">OBI_REDUCE_MBAR</a>;
01088                     xBmpLeft += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01089                     <span class="keywordflow">goto</span> DrawSysBmp;
01090 
01091                 <span class="keywordflow">case</span> (ULONG_PTR)HBMMENU_MBAR_CLOSE:
01092                     wBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a285">OBI_CLOSE_MBAR</a>;
01093                     <span class="keywordflow">goto</span> DrawSysBmp;
01094 
01095                 <span class="keywordflow">case</span> (ULONG_PTR)HBMMENU_MBAR_CLOSE_D:
01096                     wBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a288">OBI_CLOSE_MBAR_I</a>;
01097                     <span class="keywordflow">goto</span> DrawSysBmp2;
01098 
01099                 <span class="keywordflow">case</span> (ULONG_PTR)HBMMENU_MBAR_MINIMIZE_D:
01100                     wBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a292">OBI_REDUCE_MBAR_I</a>;
01101                     xBmpLeft += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01102                     <span class="keywordflow">goto</span> DrawSysBmp2;
01103 
01104 DrawSysBmp:
01105                     <span class="comment">/*</span>
01106 <span class="comment">                     * Select proper bitmap based on the item state</span>
01107 <span class="comment">                     */</span>
01108                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_HILITE)) {
01109                         wBmp += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a257">DOBI_PUSHED</a>;
01110                     }
01111 
01112 DrawSysBmp2:
01113                     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, xBmpLeft, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE), wBmp);
01114                     <span class="keywordflow">break</span>;
01115 
01116                 <span class="keywordflow">default</span>:
01117                     UserAssert((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> &gt;= HBMMENU_POPUPFIRST)
01118                                 &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> &lt;= HBMMENU_POPUPLAST));
01119 
01120                     wBmp = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a354">OBI_POPUPFIRST</a> + HandleToUlong(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>) - HandleToUlong(HBMMENU_POPUPFIRST);
01121                     UserAssert(wBmp &lt; OBI_COUNT);
01122 
01123                     pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + wBmp;
01124                     y = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>) / 2;
01125                     <span class="keywordflow">if</span> (y &lt; 0) {
01126                         y = 0;
01127                     }
01128                     <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdc, NULL, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), xLeft, y,
01129                              pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>, pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>, BC_INVERT);
01130                     <span class="keywordflow">break</span>;
01131             }
01132 
01133         } <span class="comment">/* if (pItem-&gt;hbmp == HBMMENU_SYSTEM) */</span>
01134 
01135 
01136     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> == HBMMENU_CALLBACK) {
01137         <span class="comment">/*</span>
01138 <span class="comment">         * Owner draw bitmap</span>
01139 <span class="comment">         */</span>
01140         <a class="code" href="../../d6/d2/mndraw_8c.html#a12">xxxSendMenuDrawItemMessage</a>(hdc,ODA_DRAWENTIRE, pMenu, pItem, TRUE, xLeft);
01141 
01142     } <span class="keywordflow">else</span> {
01143         <span class="comment">/*</span>
01144 <span class="comment">         * Drawing a regular bitmap.</span>
01145 <span class="comment">         */</span>
01146 
01147         <span class="keywordtype">int</span> dx, dy;
01148         HBITMAP hbmSave;
01149 
01150         <span class="comment">//</span>
01151         <span class="comment">// Is this the zero'th item in a menu bar that's not all</span>
01152         <span class="comment">// bitmaps?  Hmm, sounds like it could be a fake MDI dude.</span>
01153         <span class="comment">// If it is, use the windows icon instead</span>
01154         <span class="comment">//</span>
01155         <span class="comment">/*</span>
01156 <span class="comment">         * Let's fail this for &gt; 4.0 apps so we can get rid of</span>
01157 <span class="comment">         *  this horrible hack someday. The HBMMENU_ constants</span>
01158 <span class="comment">         *  have been made public so people can use them freely.</span>
01159 <span class="comment">         *</span>
01160 <span class="comment">         * Note: even if the app is marked as 4.0, he could be</span>
01161 <span class="comment">         * recompiled and may utilizes the new feature in NT5 menu.</span>
01162 <span class="comment">         * So just in case, we have to check both dwItemData and lpstr</span>
01163 <span class="comment">         * so that the menu could have bitmap, dwItemData and a menu string.</span>
01164 <span class="comment">         *</span>
01165 <span class="comment">         */</span>
01166         <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o25">dwExpWinVer</a> &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>) {
01167             <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a> &amp;&amp; pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01168                 <span class="keywordflow">goto</span> AintNothingLikeTheRealMDIThing;
01169             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fPopup &amp;&amp;
01170                     (pItem == pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>) &amp;&amp;
01171                     (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a> &gt; 1) &amp;&amp;
01172                     !(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>[1].<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>) &amp;&amp;
01173                     (pItem-&gt;spSubMenu)) {
01174                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"Fake MDI detected, using window icon in place of bitmap"</span>);
01175                 <span class="keywordflow">goto</span> AintNothingLikeTheRealMDIThing;
01176             }
01177         }
01178 
01179         UserAssert(hdc != ghdcMem2);
01180 
01181         dx = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o17">cxBmp</a>;
01182 
01183         <span class="keywordflow">if</span> (fPopup) {
01184             dy = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o18">cyBmp</a>;
01185 
01186             <span class="comment">//</span>
01187             <span class="comment">// Center bitmap in middle of item area</span>
01188             <span class="comment">//</span>
01189             cyTemp = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - dy);
01190             <span class="keywordflow">if</span> (cyTemp &gt; 0)
01191                 cyTemp = cyTemp / 2;
01192             <span class="keywordflow">else</span>
01193                 cyTemp = 0;
01194         } <span class="keywordflow">else</span> {
01195             dy = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o18">cyBmp</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE));
01196             cyTemp = 0;
01197             <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01198                 xLeft += <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>;
01199             }
01200         }
01201 
01202         <span class="keywordflow">if</span> (hbmSave = GreSelectBitmap(ghdcMem2, pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>)) {
01203             BITMAP  bmp;
01204             <span class="comment">//</span>
01205             <span class="comment">// Draw the bitmap leaving some room on the left for the</span>
01206             <span class="comment">// optional check mark if we are in a popup menu. (as opposed</span>
01207             <span class="comment">// to a top level menu bar).</span>
01208             <span class="comment">//</span>
01209             <span class="comment">// We can do cool stuff with monochrome bitmap itmes</span>
01210             <span class="comment">// by merging with the current colors.</span>
01211             <span class="comment">//</span>
01212             <span class="comment">// If the item is selected and the bitmap isn't monochrome,</span>
01213             <span class="comment">// we just invert the thing when we draw it.  We can't do</span>
01214             <span class="comment">// anything more clever unless we want to convert to</span>
01215             <span class="comment">// monochrome.</span>
01216             <span class="comment">//</span>
01217             GreExtGetObjectW(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>, <span class="keyword">sizeof</span>(bmp), (LPSTR)&amp;bmp);
01218             GreBitBlt(hdc, xLeft + xHilite, cyTemp + xHilite, dx, dy, ghdcMem2, 0, 0,
01219                 (bmp.bmPlanes * bmp.bmBitsPixel == 1)   ?
01220                 SRCSTENCIL                              :
01221                 (<a class="code" href="../../d6/d2/mndraw_8c.html#a3">mnDrawHilite</a>(pItem) ? NOTSRCCOPY : SRCCOPY),
01222                 0x00FFFFFF);
01223             GreSelectBitmap(ghdcMem2, hbmSave);
01224         } <span class="keywordflow">else</span> {
01225             RIPMSG3(RIP_WARNING, <span class="stringliteral">"Menu 0x%08X, item 0x%08X: Tried to draw invalid bitmap 0x%08X"</span>, pMenu, pItem, pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>) ;
01226         }
01227     }
01228 
01229 
01230 RealDrawMenuItemText:
01231     <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01232         <span class="comment">/*</span>
01233 <span class="comment">         * We want the text in all popup menu items to be aligned</span>
01234 <span class="comment">         *  if an alignment offset is available.</span>
01235 <span class="comment">         */</span>
01236         <span class="keywordflow">if</span> (fPopup &amp;&amp; (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o7">cxTextAlign</a> != 0)) {
01237             xLeft = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o7">cxTextAlign</a>;
01238         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01239             xLeft += pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o17">cxBmp</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01240         }
01241 
01242         <span class="comment">// This item is a text string item. Display it.</span>
01243         yTop = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a>;
01244 
01245         cyTemp = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a> + <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01246         <span class="keywordflow">if</span> (cyTemp &gt; 0)
01247             yTop += (cyTemp / 2);
01248 
01249         <span class="keywordflow">if</span> (!fPopup &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01250             xLeft += <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>;
01251         }
01252 
01253         lpsz = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a909">TextPointer</a>(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>);
01254         <span class="keywordflow">if</span> (lpsz!=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01255             cch = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>;
01256 
01257             <span class="comment">// Even though we no longer support any funky handling of the</span>
01258             <span class="comment">// help prefix character, we still need to eat it up if we run</span>
01259             <span class="comment">// across it so that the menu item is drawn correctly</span>
01260             <span class="keywordflow">if</span> ((*lpsz == <a class="code" href="../../d4/d1/userk_8h.html#a469">CH_HELPPREFIX</a>) &amp;&amp; !fPopup) {
01261                 <span class="comment">// Skip help prefix character.</span>
01262                 lpsz++;
01263                 cch--;
01264             }
01265 
01266             <span class="comment">// tp will contain the character position of the \t indicator</span>
01267             <span class="comment">// in the menu string.  This is where we add a tab to the string.</span>
01268             <span class="comment">//</span>
01269             <span class="comment">// rp will contain the character position of the \a indicator</span>
01270             <span class="comment">// in the string.  All text following this is right aligned.</span>
01271             tp = <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a1">FindCharPosition</a>(lpsz, TEXT(<span class="charliteral">'\t'</span>));
01272             rp = <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a1">FindCharPosition</a>(lpsz, TEXT(<span class="charliteral">'\t'</span>) - 1);
01273 
01274             xFarLeft = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>].cx + <a class="code" href="../../d4/d1/userk_8h.html#a528">MNXSPACE</a>);
01275 
01276             <span class="keywordflow">if</span> (rp &amp;&amp; (rp != cch)) {
01277                 <span class="comment">// Display all the text up to the \a</span>
01278                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER) &amp;&amp; fPopup) {
01279                     SIZE extent;
01280 
01281                     <a class="code" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent</a>(hdc, lpsz, rp, &amp;extent);
01282                     xLeft = xFarLeft - extent.cx;
01283                 }
01284                 <a class="code" href="../../d6/d2/mndraw_8c.html#a11">xxxDrawMenuItemText</a>(pItem, hdc, xLeft + xHilite, yTop + xHilite, lpsz, rp,
01285                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFUNDERLINE));
01286 
01287                 <span class="comment">// Do we also have a tab beyond the \a ??</span>
01288                 <span class="keywordflow">if</span> (tp &gt; rp + 1) {
01289                     SIZE extent;
01290 
01291                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER) &amp;&amp; fPopup) {
01292                         xLeft = xFarLeft - pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o13">dxTab</a> ;
01293                     } <span class="keywordflow">else</span> {
01294                         <a class="code" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent</a>(hdc, lpsz + rp + 1,
01295                                 (UINT)(tp - rp - 1), &amp;extent);
01296                         xLeft = (<span class="keywordtype">int</span>)(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o13">dxTab</a> - extent.cx);
01297                     }
01298                     <span class="comment">//</span>
01299                     <span class="comment">// lotus in Hebrew make their menus by putting the</span>
01300                     <span class="comment">// accelerator on the left and the text on the right</span>
01301                     <span class="comment">//</span>
01302                     <a class="code" href="../../d4/d1/userk_8h.html#a1407">xxxPSMTextOut</a>(hdc, xLeft, yTop, (LPWSTR)(lpsz + rp + 1), tp - rp - 1,
01303                                   <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFUNDERLINE) ? 0 : DT_HIDEPREFIX);
01304                 }
01305              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tp &amp;&amp; rp == cch) {
01306                 <span class="comment">// Display text up to the tab position</span>
01307                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)) {
01308                     SIZE extent;
01309 
01310                     <a class="code" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent</a>(hdc, lpsz, tp, &amp;extent);
01311                     xLeft = xFarLeft - extent.cx;
01312                     <span class="keywordflow">if</span> (!fPopup &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01313                         xLeft += <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>;
01314                     }
01315                 }
01316                 <a class="code" href="../../d6/d2/mndraw_8c.html#a11">xxxDrawMenuItemText</a>(pItem, hdc, xLeft + xHilite, yTop + xHilite, lpsz, tp,
01317                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFUNDERLINE));
01318              }
01319 
01320             <span class="comment">// Any text left to display (like after the tab) ??</span>
01321             <span class="keywordflow">if</span> (tp &lt; cch - 1) {
01322                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER) &amp;&amp; fPopup) {
01323                     SIZE extent;
01324 
01325                     <a class="code" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent</a>(hdc, lpsz + tp + 1, (<span class="keywordtype">int</span>)cch - tp - 1, &amp;extent);
01326                     xLeft = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o13">dxTab</a> - extent.cx;
01327                 } <span class="keywordflow">else</span> {
01328                     xLeft = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o13">dxTab</a> + <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a>;
01329                 }
01330                 <a class="code" href="../../d4/d1/userk_8h.html#a1407">xxxPSMTextOut</a>(hdc, xLeft, yTop, lpsz + tp + 1, cch - tp - 1,
01331                               <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFUNDERLINE) ? 0 : DT_HIDEPREFIX);
01332             }
01333         }
01334     }
01335 
01336     <span class="comment">//</span>
01337     <span class="comment">// Draw the hierarchical arrow for the cascade menu.</span>
01338     <span class="comment">//</span>
01339     <span class="keywordflow">if</span> (fPopup &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01340         <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem;
01341 
01342         pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)
01343                                ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a360">OBI_MENUARROW_L</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a329">OBI_MENUARROW</a>);
01344 
01345         <span class="comment">// This item has a hierarchical popup associated with it. Draw the</span>
01346         <span class="comment">// bitmap dealy to signify its presence. Note we check if fPopup is set</span>
01347         <span class="comment">// so that this isn't drawn for toplevel menus that have popups.</span>
01348 
01349         <a class="code" href="../../d4/d1/userk_8h.html#a1501">BltColor</a>(hdc,
01350                  NULL,
01351                  <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
01352                  <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_RIGHTORDER)
01353                  ? pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a> :
01354                    pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a> - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>,
01355                  <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((INT)(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - 2 - pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>) / 2, 0),
01356                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>,
01357                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
01358                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>,
01359                  pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>,
01360                  BC_INVERT);
01361     }
01362 
01363     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01364 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="mndraw.c::xxxSendMenuDrawItemMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxSendMenuDrawItemMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>itemAction</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fBitmap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>iOffset</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00617">617</a> of file <a class="el" href="../../d7/d1/mndraw_8c-source.html">mndraw.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02760">tagITEM::cxBmp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02754">tagITEM::cxItem</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02761">tagITEM::cyBmp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02755">tagITEM::cyItem</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02611">tagITEM::dwItemData</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02744">tagITEM::fState</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00647">MFINACTIVE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00645">MFUNDERLINE</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00039">mnDrawHilite()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02745">tagITEM::wID</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l02082">xxxDrawMenuBarUnderlines()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00750">xxxDrawMenuItem()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00624 {
00625     DRAWITEMSTRUCT dis;
00626     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndNotify;
00627     <span class="keywordtype">int</span> y;
00628 
00629     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pmenu);
00630 
00631     dis.CtlType = ODT_MENU;
00632     dis.CtlID = 0;
00633 
00634     dis.itemID = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>;
00635 
00636     dis.itemAction = itemAction;
00637     dis.itemState   =
00638          ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MF_GRAYED)       ? ODS_GRAYED    : 0) |
00639          ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_DEFAULT)     ? ODS_DEFAULT   : 0) |
00640          ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_CHECKED)     ? ODS_CHECKED   : 0) |
00641          ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_DISABLED)    ? ODS_DISABLED  : 0) |
00642          (<a class="code" href="../../d6/d2/mndraw_8c.html#a3">mnDrawHilite</a>(pItem)               ? ODS_SELECTED  : 0) |
00643          ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_HOTTRACK)    ? ODS_HOTLIGHT  : 0) |
00644          (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFINACTIVE)         ? ODS_INACTIVE  : 0) |
00645          (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFUNDERLINE)       ? ODS_NOACCEL : 0);
00646 
00647     dis.hwndItem = (HWND)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pmenu);
00648     dis.hDC = hdc;
00649 
00650     y = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00651     <span class="keywordflow">if</span> (fBitmap) {
00652         y = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a> - pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o18">cyBmp</a>) / 2;
00653     }
00654 
00655     dis.rcItem.left     = iOffset + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
00656     dis.rcItem.top      = y;
00657     dis.rcItem.right    = iOffset + pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a> + (fBitmap ? pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o17">cxBmp</a> : pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>);
00658     dis.rcItem.bottom   = y + (fBitmap ? pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o18">cyBmp</a> : pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>);
00659     dis.itemData = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a>;
00660 
00661     <span class="keywordflow">if</span> (pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00662         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, &amp;tlpwndNotify);
00663         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, WM_DRAWITEM, 0, (LPARAM)&amp;dis);
00664         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndNotify);
00665     }
00666 
00667 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:47 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
